function Set_Eff_Text(id, wzid, str,dh)
    local z = {['特效文字1'] = 1,['特效文字2'] = 2,['特效文字3'] = 3,['特效文字4'] = 4,['特效文字0'] = 0}
    local wz = ''
    if z[wzid] ~= nil then 
        wzid = z[wzid]
    end
    wz = "特效文字"..wzid
	local t = {}
    local twz = WAR.Person[id][wz]
	if twz == nil then 
	   twz = ''
	else 
	   t[#t+1] = twz
	end
    if twz == '' then
	   WAR.TXWZ[wz][id] = {}
	   WAR.TXWZ[wz][id][str] = 1
       t[#t+1] = str
	else
	    if WAR.TXWZ[wz][id] ~= nil then
	        if WAR.TXWZ[wz][id][str] == nil then
				WAR.TXWZ[wz][id][str] = 1
				t[#t+1] = str
			end	 
		end
	end 
	if wzid == 4 then
		twz = table.concat(t,'・')
	else 
	    twz = table.concat(t,'+')
	end
	WAR.Person[id][wz] = twz
	if dh ~= nil then
		if WAR.Person[id]['护盾'] ~= nil and WAR.Person[id]['护盾'] > 0 then
			WAR.Person[id]['特效动画'] = -1
		elseif WAR.Person[id]['特效动画'] == -1 then
			WAR.Person[id]['特效动画'] = dh
		end	
	end
end

--顶部特效文字 
function TXWZXS(str,cl,n)
    if n == nil then 
	   n = 0
	end
	local i = n 
	if i > 20 then 
		i = 20 
	end	
    Cat('实时特效动画')
    Cls()
    Cat('实时特效动画2')
	DrawStrBox(-1, 24, str, cl, 10 + i)
	ShowScreen()
	lib.Delay(CC.BattleDelay)
    if n == 40 then
	   return
	else
	   return TXWZXS(str,cl,n+5)
	end
end

--返回两人之间的实际距离
function War_realjl(ida, idb)
	if ida == nil then
		ida = WAR.CurID
	end
	CleanWarMap(3, 255)
	local x = WAR.Person[ida]["坐标X"]
	local y = WAR.Person[ida]["坐标Y"]
	local steparray = {}
	steparray[0] = {}
	steparray[0].bushu = {}
	steparray[0].x = {}
	steparray[0].y = {}
	SetWarMap(x, y, 3, 0)
	steparray[0].num = 1
	steparray[0].bushu[1] = 0		--还能移动的步数
	steparray[0].x[1] = x
	steparray[0].y[1] = y
	return War_FindNextStep1(steparray, 0, ida, idb)
end

--AI选择目标的函数
function unnamed(kfid)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local kungfuid = JY.Person[pid]["武功" .. kfid]
	local kungfulv = JY.Person[pid]["武功等级" .. kfid]	
	if kungfulv == 999 then
		kungfulv = 11
	else
		kungfulv = math.modf(kungfulv / 100) + 1
    end
	if WAR.DJHB2[1] ~= nil then
		kungfuid = 44
		kungfulv = 11
	elseif WAR.DJHB1[1] ~= nil then
		kungfuid = 67
		kungfulv = 11
	end
	--刀剑合璧
    --local st1 = lib.GetTime()
	local m1, m2, a1, a2, a3, a4, a5 = refw(kungfuid, kungfulv)
	local mfw = {m1, m2}
	local atkfw = {a1, a2, a3, a4, a5}
	if kungfulv == 11 then
		kungfulv = 10
	end
	--AI也用新的威力判定
	local kungfuatk = get_skill_power(pid, kungfuid, kungfulv)
	local atkarray = {}
	local num = 0
    CleanWarMap(4, -1)
    --local st2 = lib.GetTime()
	
	--夜雨楼如影随形特效
	local flg = 0
	
	local movearray = War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"],0)

		
    --夜雨楼如影随形特效
	for i = 0, WAR.Person[WAR.CurID]["移动步数"] do
		local step_num = movearray[i].num
		if step_num ~= nil then
			for j = 1, step_num do
				local xx = movearray[i].x[j]
				local yy = movearray[i].y[j]
				num = num + 1
				atkarray[num] = {}
				atkarray[num].x, atkarray[num].y = xx, yy
				atkarray[num].p, atkarray[num].ax, atkarray[num].ay = GetAtkNum(xx, yy, mfw, atkfw, kungfuatk)
			end
		end
	end
	for i = 1, num - 1 do
		for j = i + 1, num do
			if atkarray[i].p < atkarray[j].p then
				atkarray[i], atkarray[j] = atkarray[j], atkarray[i]
			end
		end
    end
    --local st4 = lib.GetTime()
    if atkarray[1].p > 0 then
		for i = 2, num do
			if atkarray[i].p == 0 or atkarray[i].p < atkarray[1].p / 2 then
				num = i - 1
				break;
			end
        end
        --[[
		for i = 1, num do
			if WAR.Person[WAR.CurID]["我方"] == true then
				--flag: approach enemies.
                --atkarray[i].p = atkarray[i].p + GetMovePoint(atkarray[i].x, atkarray[i].y)
                atkarray[i].p = atkarray[i].p + GetMovePoint(atkarray[i].x, atkarray[i].y, 1)
			--else
				--flag: aviod enemies. avoiding as many enemies as possible while retaining targeting the spot with higher threat
				atkarray[i].p = atkarray[i].p + GetMovePoint(atkarray[i].x, atkarray[i].y, 1)
			end
        end
        ]]
		for i = 1, num - 1 do
			for j = i + 1, num do
				if atkarray[i].p < atkarray[j].p then
					atkarray[i], atkarray[j] = atkarray[j], atkarray[i]
				elseif atkarray[i].p == atkarray[j].p and math.random(2) > 1 then
					atkarray[i], atkarray[j] = atkarray[j], atkarray[i]
				end
			end
        end
        --[[
		for i = 2, num do
			if atkarray[i].p < atkarray[1].p *4/5 then
				num = i - 1
				break;
			end
        end
        ]]
		--local st5 = lib.GetTime()
		local select = 1--math.random(num)
		--say('时间1'..st1..'*'..'时间2'..st2..'*'..'时间3'..st3..'*'..'时间4'..st4..'*'..'时间5'..st5,1)
		War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
		War_MovePerson(atkarray[select].x, atkarray[select].y)
		if WAR.DJHB1[1] ~= nil then
			War_Fight_Sub(WAR.CurID, kfid, WAR.DJHB1[1], WAR.DJHB1[2])
		elseif WAR.DJHB2[2] ~= nil then
			War_Fight_Sub(WAR.CurID, kfid, WAR.DJHB2[1], WAR.DJHB2[2])
		else
			War_Fight_Sub(WAR.CurID, kfid, atkarray[select].ax, atkarray[select].ay)
		end	
		if fjpd(WAR.CurID) then 
			return
		end
	else
		if fjpd(WAR.CurID) then 
			return
        end	
		if WAR.DJHB1[1] ~= nil then
			War_Fight_Sub(WAR.CurID, kfid, WAR.DJHB1[1], WAR.DJHB1[2])
		elseif WAR.DJHB2[2] ~= nil then
			War_Fight_Sub(WAR.CurID, kfid, WAR.DJHB2[1], WAR.DJHB2[2])
		else
			--War_Fight_Sub(WAR.CurID, kfid, atkarray[select].ax, atkarray[select].ay)
		end
		--剑魔BOSS
        if match_ID(pid,592) then
            War_Fight_Sub(WAR.CurID, kfid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"])
            return
        end
		--观止
        if match_ID(pid,456) then
            War_Fight_Sub(WAR.CurID, kfid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"])
            return
        end
		--东方不败，打不到人会瞬移
		if (pid == 27 or pid == 777) and kuihuameiying() then
			unnamed(kfid)
		else
		--打不到人，考虑吃药
		local jl, nx, ny = War_realjl()
		AutoMove()
		--默认为休息
		local what_to_do = 0
		local can_eat_drug = 0
		--非我方，会考虑吃药
		if WAR.Person[WAR.CurID]["我方"] == false then
			can_eat_drug = 1
		--如果是我方，只有在队且允许才会吃药
		else
			if isteam(pid) and JY.Person[pid]["是否吃药"] == 1 then
				can_eat_drug = 1
			end
		end
		--侠客正岛主战不吃药
		--洪七公居洪七公不吃药
		if WAR.Person[WAR.CurID]["我方"] == false and (WAR.ZDDH == 188 or WAR.ZDDH == 257) then
			can_eat_drug = 0
		end
		--左右第二下，不能吃药
		if WAR.ZYHB == 2 then
			can_eat_drug = 0
		end
		--1:吃体力药 2：吃血 3：医疗 4：吃内力 5：吃解毒
		    if can_eat_drug == 1 then
			    local r = -1
			--体力低于10，吃体力药
			    if JY.Person[pid]["体力"] < 10 then
				    r = War_ThinkDrug(4)
				    if r >= 0 then
					    what_to_do = 1
				    end
				end
			    local rate = -1
			    if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 5 then
				    rate = 90
		       	elseif JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 4 then
				    rate = 70
			    elseif JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 3 then
				    rate = 50
			    elseif JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 2 then
				    rate = 25
			    end
			--内伤也增加吃血药几率
			    if JY.Person[pid]["受伤程度"] > 50 then
				    rate = rate + 50
			    end
		      	if Rnd(100) < rate then
				    r = War_ThinkDrug(2)
				    if r >= 0 then				--如果有药吃药 
					    what_to_do = 2
					else
					    r = War_ThinkDoctor()		--如果没有药，考虑医疗
					    if r >= 0 then
						    what_to_do = 3
						end
					end
				end
			--考虑内力
			    rate = -1
			    if JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] / 6 then
				    rate = 100
			    elseif JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] / 5 then
			       	rate = 75
			    elseif JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] / 4 then
				    rate = 50
			    end
			    if Rnd(100) < rate then
				    r = War_ThinkDrug(3)
				    if r >= 0 then
					    what_to_do = 4
				    end
			    end
			    rate = -1
			    if CC.PersonAttribMax["中毒程度"] * 3 / 4 < JY.Person[pid]["中毒程度"] then
				    rate = 60
			    else
				    if CC.PersonAttribMax["中毒程度"] / 2 < JY.Person[pid]["中毒程度"] then
					    rate = 30
				    end
			    end
			--半血以下，才吃解毒药
			    if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 2 and Rnd(100) < rate then
				    r = War_ThinkDrug(6)
				    if r >= 0 then
					    what_to_do = 5
				    end
			    end
		    end
		--吃药flag 2：生命 3：内力 4：体力 6：解毒
		    if what_to_do == 0 then
			    War_RestMenu()
		    elseif what_to_do == 1 then
			    War_AutoEatDrug(4)
			elseif what_to_do == 2 then
			    War_AutoEatDrug(2)
		    elseif what_to_do == 3 then
			    War_AutoDoctor()
		    elseif what_to_do == 4 then
			    War_AutoEatDrug(3)	
		    elseif what_to_do == 5 then
			    War_AutoEatDrug(6)
			end
		end
	end
end

function AutoMove()
	local x, y = nil, nil
	local minDest = math.huge
	local enemyid=War_AutoSelectEnemy()   --选择最近敌人

	--夜雨楼如影随形
	if enemyid == -1 then 
		return Cat('随机移动')
	end
	War_CalMoveStep(WAR.CurID,100,0);   --计算移动步数 假设最大100步

	for i= 0,CC.WarWidth-1 do
		for j=0,CC.WarHeight-1 do
			local dest=GetWarMap(i,j,3);
			if dest <128 then
				local dx=math.abs(i-WAR.Person[enemyid]["坐标X"])
				local dy=math.abs(j-WAR.Person[enemyid]["坐标Y"])
				if minDest>(dx+dy) then        --此时x,y是距离敌人的最短路径，虽然可能被围住
					minDest=dx+dy;
					x=i;
					y=j;
				elseif minDest==(dx+dy) then
					if Rnd(2)==0 then
						x=i;
						y=j;
					end
				end
			end
		end
	end

	if minDest<math.huge then   --有路可走
	    while true do    --从目的位置反着找到可以移动的位置，作为移动的次序
			local i=GetWarMap(x,y,3);
			if i<=WAR.Person[WAR.CurID]["移动步数"] then
				break;
			end

			if GetWarMap(x-1,y,3)==i-1 then
				x=x-1;
			elseif GetWarMap(x+1,y,3)==i-1 then
				x=x+1;
			elseif GetWarMap(x,y-1,3)==i-1 then
				y=y-1;
			elseif GetWarMap(x,y+1,3)==i-1 then
				y=y+1;
			end
	    end
		War_MovePerson(x,y);    --移动到相应的位置
	end
end

function GetMovePoint(x, y, flag)
	local point = 0
    local wofang = WAR.Person[WAR.CurID]["我方"]
    local bs = WAR.Person[WAR.CurID]["移动步数"]
	local movearray = MY_CalMoveStep(x, y, bs, 1)
	for i = 1, bs do
		local step_num = movearray[i].num
		if step_num ~= nil then
			if step_num == 0 then
				break;
			end
			for j = 1, step_num do
				local xx = movearray[i].x[j]
				local yy = movearray[i].y[j]
				local v = GetWarMap(xx, yy, 2)
				if v ~= -1 then
					if v == WAR.CurID then
						break;
					else   
						if WAR.Person[v]["我方"] == wofang then
							point = point + i * 2 - 26
						elseif WAR.Person[v]["我方"] ~= wofang then
							if flag ~= nil then
								point = point + i - 17
							else
								point = point + 26 - i
							end
						end
					end
				end
			end
		end
	end
	return point
end

function MY_CalMoveStep(x, y, stepmax, flag)
	CleanWarMap(3, 255)
	local steparray = {}
	for i = 0, stepmax do
		steparray[i] = {}
		steparray[i].bushu = {}
		steparray[i].x = {}
		steparray[i].y = {}
	end
	SetWarMap(x, y, 3, 0)
	steparray[0].num = 1
	steparray[0].bushu[1] = stepmax
	steparray[0].x[1] = x
	steparray[0].y[1] = y
	War_FindNextStep(steparray, 0, flag)
	return steparray
end

function GetAtkNum(x, y, movfw, atkfw, atk)
  local point = {}
  local num = 0
  local kind, len = movfw[1], movfw[2]
  
  if kind == 0 then
    local array = MY_CalMoveStep(x, y, len, 1)
    for i = 0, len do
      local step_num = array[i].num
      if step_num ~= nil then
        if step_num == 0 then
          break;
        end
	      for j = 1, step_num do
	        num = num + 1
	        point[num] = {array[i].x[j], array[i].y[j]}
	      end
	    end
    end
  elseif kind == 1 then
    local array = MY_CalMoveStep(x, y, len * 2, 1)
    for r = 1, len * 2 do
      for i = 0, r do
        local j = r - i
        if len < i or len < j then
          SetWarMap(x + i, y + j, 3, 255)
          SetWarMap(x + i, y - j, 3, 255)
          SetWarMap(x - i, y + j, 3, 255)
          SetWarMap(x - i, y - j, 3, 255)
        end
      end
    end
    for i = 0, len do
      local step_num = array[i].num
      if step_num ~= nil then
        if step_num == 0 then
          break;
        end
	      for j = 1, step_num do
	        if GetWarMap(array[i].x[j], array[i].y[j], 3) < 128 then
	          num = num + 1
	          point[num] = {array[i].x[j], array[i].y[j]}
	        end
	      end
	    end
    end
  elseif kind == 2 then
    if not len then
      len = 1
    end
    for i = 1, len do
      if x + i < CC.WarWidth - 1 and GetWarMap(x + i, y, 1) > 0 and CC.WarWater[GetWarMap(x + i, y, 0)] == nil then
        break;
      end
      num = num + 1
      point[num] = {x + i, y}
    end
    for i = 1, len do
      if x - i > 0 and GetWarMap(x - i, y, 1) > 0 and CC.WarWater[GetWarMap(x - i, y, 0)] == nil then
        break;
      end
      num = num + 1
      point[num] = {x - i, y}
    end
    for i = 1, len do
      if y + i < CC.WarHeight - 1 and GetWarMap(x, y + i, 1) > 0 and CC.WarWater[GetWarMap(x, y + i, 0)] == nil then
        break;
      end
      num = num + 1
      point[num] = {x, y + i}
    end
    for i = 1, len do
      if y - i > 0 and GetWarMap(x, y - i, 1) > 0 and CC.WarWater[GetWarMap(x, y - i, 0)] == nil then
        break;
      end
      num = num + 1
      point[num] = {x, y - i}
    end
  elseif kind == 3 then
    if x + 1 < CC.WarWidth - 1 and GetWarMap(x + 1, y, 1) == 0 and CC.WarWater[GetWarMap(x + 1, y, 0)] == nil then
      num = num + 1
      point[num] = {x + 1, y}
    end
    if x - 1 > 0 and GetWarMap(x - 1, y, 1) == 0 and CC.WarWater[GetWarMap(x - 1, y, 0)] == nil then
      num = num + 1
      point[num] = {x - 1, y}
    end
    if y + 1 < CC.WarHeight - 1 and GetWarMap(x, y + 1, 1) == 0 and CC.WarWater[GetWarMap(x, y + 1, 0)] == nil then
      num = num + 1
      point[num] = {x, y + 1}
    end
    if y - 1 > 0 and GetWarMap(x, y - 1, 1) == 0 and CC.WarWater[GetWarMap(x, y - 1, 0)] == nil then
      num = num + 1
      point[num] = {x, y - 1}
    end
    if x + 1 < CC.WarWidth - 1 and y + 1 < CC.WarHeight - 1 and GetWarMap(x + 1, y + 1, 1) == 0 and CC.WarWater[GetWarMap(x + 1, y + 1, 0)] == nil then
      num = num + 1
      point[num] = {x + 1, y + 1}
    end
    if x - 1 > 0 and y + 1 < CC.WarHeight - 1 and GetWarMap(x - 1, y + 1, 1) == 0 and CC.WarWater[GetWarMap(x - 1, y + 1, 0)] == nil then
      num = num + 1
      point[num] = {x - 1, y + 1}
    end
    if x + 1 < CC.WarWidth - 1 and y - 1 > 0 and GetWarMap(x + 1, y - 1, 1) == 0 and CC.WarWater[GetWarMap(x + 1, y - 1, 0)] == nil then
      num = num + 1
      point[num] = {x + 1, y - 1}
    end
    if x - 1 > 0 and y - 1 > 0 and GetWarMap(x - 1, y - 1, 1) == 0 and CC.WarWater[GetWarMap(x - 1, y - 1, 0)] == nil then
    	num = num + 1
    	point[num] = {x - 1, y - 1}
  	end
  end
  local maxx, maxy, maxnum, atknum = 0, 0, 0, 0
  

  for i = 1, num do
    atknum = GetWarMap(point[i][1], point[i][2], 4)
    
    if atknum == -1 or atkfw[1] > 9 then
      atknum = WarDrawAtt(point[i][1], point[i][2], atkfw, 2, x, y, atk)
      SetWarMap(point[i][1], point[i][2], 4, atknum)
    end
    if atknum~= nil and maxnum < atknum then
      maxnum, maxx, maxy = atknum, point[i][1], point[i][2]
    end
  end
  
  return maxnum, maxx, maxy
end

function War_FindNextStep1(steparray,step,id,idb)      --设置下一步可移动的坐标
	--被上面的函数调用   
	local num=0;
	local step1=step+1;
	
	steparray[step1]={};
	steparray[step1].bushu={};
	steparray[step1].x={};
	steparray[step1].y={};
	
	local function fujinnum(tx,ty)
		local tnum=0
		local wofang=WAR.Person[id]["我方"]
		local tv;
		tv=GetWarMap(tx+1,ty,2);
		if idb==nil then
			if tv~=-1 then
				if WAR.Person[tv]["我方"]~=wofang then
					return -1
				end
			end
		elseif tv==idb then
			return -1
		end
		if tv~=-1 then
			if WAR.Person[tv]["我方"]~=wofang then
				tnum=tnum+1
			end
		end
		tv=GetWarMap(tx-1,ty,2);
		if idb==nil then
			if tv~=-1 then
				if WAR.Person[tv]["我方"]~=wofang then
					return -1
				end
			end
		elseif tv==idb then
			return -1
		end
		if tv~=-1 then
			if WAR.Person[tv]["我方"]~=wofang then
				tnum=tnum+1
			end
		end
		tv=GetWarMap(tx,ty+1,2);
		if idb==nil then
			if tv~=-1 then
				if WAR.Person[tv]["我方"]~=wofang then
					return -1
				end
			end
		elseif tv==idb then
			return -1
		end
		if tv~=-1 then
			if WAR.Person[tv]["我方"]~=wofang then
				tnum=tnum+1
			end
		end
		tv=GetWarMap(tx,ty-1,2);
		if idb==nil then
			if tv~=-1 then
				if WAR.Person[tv]["我方"]~=wofang then
					return -1
				end
			end
		elseif tv==idb then
			return -1
		end
		if tv~=-1 then
			if WAR.Person[tv]["我方"]~=wofang then
				tnum=tnum+1
			end
		end
		return tnum
	end
	
	for i=1,steparray[step].num do
		--if steparray[step].bushu[i]<128 then
		steparray[step].bushu[i]=steparray[step].bushu[i]+1;
	    local x=steparray[step].x[i];
	    local y=steparray[step].y[i];
	    if x+1<CC.WarWidth-1 then                        --当前步数的相邻格
		    local v=GetWarMap(x+1,y,3);
			if v ==255 and War_CanMoveXY(x+1,y,0)==true then
                num= num+1;
                steparray[step1].x[num]=x+1;
                steparray[step1].y[num]=y;
				SetWarMap(x+1,y,3,step1);
				local mnum=fujinnum(x+1,y);
				if mnum==-1 then 
					return steparray[step].bushu[i],x+1,y
				else
					steparray[step1].bushu[num]=steparray[step].bushu[i]+mnum;
				end
			end
		end

	    if x-1>0 then                        --当前步数的相邻格
		    local v=GetWarMap(x-1,y,3);
			if v ==255 and War_CanMoveXY(x-1,y,0)==true then
                 num=num+1;
                steparray[step1].x[num]=x-1;
                steparray[step1].y[num]=y;
				SetWarMap(x-1,y,3,step1);
				local mnum=fujinnum(x-1,y);
				if mnum==-1 then 
					return steparray[step].bushu[i],x-1,y
				else
					steparray[step1].bushu[num]=steparray[step].bushu[i]+mnum;
				end
			end
		end

	    if y+1<CC.WarHeight-1 then                        --当前步数的相邻格
		    local v=GetWarMap(x,y+1,3);
			if v ==255 and War_CanMoveXY(x,y+1,0)==true then
                 num= num+1;
                steparray[step1].x[num]=x;
                steparray[step1].y[num]=y+1;
				SetWarMap(x,y+1,3,step1);
				local mnum=fujinnum(x,y+1);
				if mnum==-1 then 
					return steparray[step].bushu[i],x,y+1
				else
					steparray[step1].bushu[num]=steparray[step].bushu[i]+mnum;
				end
			end
		end

	    if y-1>0 then                        --当前步数的相邻格
		    local v=GetWarMap(x ,y-1,3);
			if v ==255 and War_CanMoveXY(x,y-1,0)==true then
                num= num+1;
                steparray[step1].x[num]=x ;
                steparray[step1].y[num]=y-1;
				SetWarMap(x ,y-1,3,step1);
				local mnum=fujinnum(x,y-1);
				if mnum==-1 then 
					return steparray[step].bushu[i],x,y-1
				else
					steparray[step1].bushu[num]=steparray[step].bushu[i]+mnum;
				end
			end
		end
		--end
	end
	if num==0 then return -1 end;
    steparray[step1].num=num;
	for i=1,num-1 do
		for j=i+1,num do
			if steparray[step1].bushu[i]>steparray[step1].bushu[j] then
				steparray[step1].bushu[i],steparray[step1].bushu[j]=steparray[step1].bushu[j],steparray[step1].bushu[i]
				steparray[step1].x[i],steparray[step1].x[j]=steparray[step1].x[j],steparray[step1].x[i]
				steparray[step1].y[i],steparray[step1].y[j]=steparray[step1].y[j],steparray[step1].y[i]
			end
		end
	end

	return War_FindNextStep1(steparray,step1,id,idb)
end
--修炼物品
function War_PersonTrainDrug(pid)
	local p = JY.Person[pid]
	local thingid = p["修炼物品"]
	if thingid < 0 then
		return 
	end
	if JY.Thing[thingid]["练出物品需经验"] <= 0 then
		return 
	end

	local needpoint = (7 - math.modf(p["资质"] / 15)) * JY.Thing[thingid]["练出物品需经验"]
	if p["物品修炼点数"] < needpoint then
		return 
	end
	  
	local haveMaterial = 0
	local MaterialNum = -1
	for i = 1, CC.MyThingNum do
		if JY.Base["物品" .. i] == JY.Thing[thingid]["需材料"] then
			haveMaterial = 1
			MaterialNum = JY.Base["物品数量" .. i]
		end
	end
  
	--材料足够
	if haveMaterial == 1 then
		local enough = {}
		local canMake = 0
		for i = 1, 5 do
			if JY.Thing[thingid]["练出物品" .. i] >= 0 and JY.Thing[thingid]["需要物品数量" .. i] <= MaterialNum then
				canMake = 1
				enough[i] = 1
			else
				enough[i] = 0
			end
		end
		--可以练出
		if canMake == 1 then
			local makeID = nil
			while true do
				makeID = Rnd(5) + 1
				if thingid == 221 and pid == 88 and enough[4] == 1 then
					makeID = 4
				end
				if thingid == 220 and pid == 89 and enough[4] == 1 then
					makeID = 4
				end
				if thingid == 458 then
					makeID = 1
				end	
				if enough[makeID] == 1 then
					break;
				end
			end
			
			local newThingID = JY.Thing[thingid]["练出物品" .. makeID]
			local makenum = 1
			DrawStrBoxWaitKey(string.format("%s 制造出 %s", p["姓名"], JY.Thing[newThingID]["名称"]), C_WHITE, CC.DefaultFont)
			if newThingID >= 22 and newThingID <= 25 and QGQH(pid,2,2) then
				makenum = makenum + math.random(2,4)
			end	
			if newThingID == 34 then
				makenum = math.random(3,5)
			end	
			if instruct_18(newThingID) == true then
				instruct_32(newThingID, makenum)
			else
				instruct_32(newThingID, makenum)
			end
			instruct_32(JY.Thing[thingid]["需材料"], -JY.Thing[thingid]["需要物品数量" .. makeID])
			p["物品修炼点数"] = 0
		end
	end
end
--计算敌人中毒点数
--pid 使毒人，
--enemyid  中毒人
function War_PoisonHurt(pid, enemyid)
    local eid = WAR.Person[enemyid]["人物编号"]
	local vv = math.modf((JY.Person[pid]["用毒能力"] - JY.Person[eid]["抗毒能力"]) / 4)
	local yd = JY.Person[pid]["用毒能力"]
	
	--胡青牛在场王难姑用毒+50
	if JY.Status == GAME_WMAP then
		for i,v in pairs(CC.AddPoi) do
			if match_ID(pid, v[1]) then
				for wid = 0, WAR.PersonNum - 1 do
					if match_ID(WAR.Person[wid]["人物编号"], v[2]) and WAR.Person[wid]["死亡"] == false then
						vv = vv + v[3] / 4
					end
				end
			end
		end
		--毒经
		if YishuZJ(pid,192) then
			WAR.Person[enemyid]["Life_Before_Hit"] = JY.Person[eid]["生命"]
			JY.Person[eid]["生命"] = JY.Person[eid]["生命"] - JY.Person[eid]["生命最大值"]*0.1
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) - math.modf(JY.Person[eid]["生命最大值"]*0.1)
			if JY.Person[eid]["生命"] < 1 then
				JY.Person[eid]["生命"] = 0
			end
			WAR.TXXS[eid] = 1
			local zt = {'中毒不解','龙眠毒','创伤','西域奇毒','出血蛇毒','破甲蛇毒','神经蛇毒','冰魄毒'}
			local a = math.random(1,8)
			local n = math.random(5,10)
			addbuff(eid,WAR.PD[zt[a]],n)
		end
	end
	vv = vv - JY.Person[eid]["内力"]/100
	vv = math.modf(vv)
	if vv < 0 then
		vv = 0
    end
    if myzd(enemyid) then 
        vv = 0
    end
	return AddPersonAttrib(eid, "中毒程度", vv)
end

--人物按轻功进行排序
function WarPersonSort(flag)
	for i = 0, WAR.PersonNum - 1 do
		local id = WAR.Person[i]["人物编号"]
		local add = 0
		local p = JY.Person[id]

		--逍遥游
		if Curr_QG(id,2) then
		    add = add + 400
		end
		WAR.Person[i]["轻功"] = Qg(i) + (add)
	end
	if flag ~= nil then
		return 
	end
	for i = 0, WAR.PersonNum - 2 do
		local maxid = i
		for j = i, WAR.PersonNum - 1 do
			if WAR.Person[maxid]["轻功"] < WAR.Person[j]["轻功"] then
				maxid = j;
			end
		end
		WAR.Person[maxid], WAR.Person[i] = WAR.Person[i], WAR.Person[maxid]
	end
end

--显示非攻击时的点数
function War_Show_Count(id, str)
	if JY.Restart == 1 then
		return
	end
	
	local pid = WAR.Person[id]["人物编号"];
	local x = WAR.Person[id]["坐标X"];
	local y = WAR.Person[id]["坐标Y"];
	
	local hp = WAR.Person[id]["生命点数"];
	local mp = WAR.Person[id]["内力点数"];
	local tl = WAR.Person[id]["体力点数"];
	local ed = WAR.Person[id]["中毒点数"];
	local dd = WAR.Person[id]["解毒点数"];
	local ns = WAR.Person[id]["内伤点数"];
  
	local show = {x, y, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil};		--x, y, 生命, 内力, 体力, 封穴, 流血, 中毒, 解毒, 内伤，冰封，灼烧
	
	if hp ~= nil and hp ~= 0 then		--显示生命
		if hp > 0 then
			show[3] = "生命+"..hp;
		else
			show[3] = "生命"..hp;
		end
	end
	
	if mp ~= nil and mp ~= 0 then		--显示内力
		if mp > 0 then
			show[5] = "内力+"..mp;
		else
			show[5] = "内力"..mp;
		end
	end
	
	if tl ~= nil and tl ~= 0 then		--显示体力
		if tl > 0 then
			show[6] = "体力+"..tl;
		else
			show[6] = "体力"..tl;
		end
	end
	
    if WAR.FXXS[WAR.Person[id]["人物编号"]] ~= nil and WAR.FXXS[WAR.Person[id]["人物编号"]] == 1 then			--显示是否封穴
        --if WAR.FXDS[WAR.Person[id]["人物编号"]] ~= nil and WAR.FXDS[WAR.Person[id]["人物编号"]] > 0 then
		if JY.Person[WAR.Person[id]["人物编号"]]["封穴程度"] > 0 then	
		  show[7] = "封穴 "..JY.Person[WAR.Person[id]["人物编号"]]["封穴程度"]
        end
       	WAR.FXXS[WAR.Person[id]["人物编号"]] = 0
    end
      
    if WAR.LXXS[WAR.Person[id]["人物编号"]] ~=nil and WAR.LXXS[WAR.Person[id]["人物编号"]] == 1 then		--显示是否被流血
        if JY.Person[WAR.Person[id]["人物编号"]]["流血程度"] > 0 then 
		  show[8] = "流血 "..JY.Person[WAR.Person[id]["人物编号"]]["流血程度"]
        end
        WAR.LXXS[WAR.Person[id]["人物编号"]] = 0
    end
	
	if ed ~= nil and ed ~= 0 then		--显示中毒
		show[9] = "中毒+"..ed;
	end
	
	if dd ~= nil and dd ~= 0 then		--显示解毒
		show[4] = "中毒-"..dd;
	end
	
	if ns ~= nil and ns ~= 0 then		--显示内伤
		if ns > 0 then
			show[10] = "内伤↑"..ns;
		else
			show[10] = "内伤↓"..-ns;
		end
	end
	
    if WAR.BFXS[WAR.Person[id]["人物编号"]] == 1 then		--显示是否被冰封
        if JY.Person[WAR.Person[id]["人物编号"]]["冰封程度"] > 0 then
            show[11] = "冰封 "..JY.Person[WAR.Person[id]["人物编号"]]["冰封程度"];
        end
		WAR.BFXS[WAR.Person[id]["人物编号"]] = 0
	end
		
    if WAR.ZSXS[WAR.Person[id]["人物编号"]] == 1 then		--显示是否被灼烧
        if JY.Person[WAR.Person[id]["人物编号"]]["灼烧程度"] > 0 then
            show[12] = "灼烧 "..JY.Person[WAR.Person[id]["人物编号"]]["灼烧程度"];
        end
		WAR.ZSXS[WAR.Person[id]["人物编号"]] = 0
	end
	
	--记录哪个位置上有点数
	local showValue = {};
	local showNum = 0;
	for i=3, 12 do
		if show[i] ~= nil then
			showNum = showNum + 1;
			showValue[showNum] = i;
		end
	end

	if showNum == 0 then
		return;
	end
	
	local hb = GetS(JY.SubScene, x, y, 4);
  
	local ll = string.len(show[showValue[1]]);	--长度
	
	local w = ll * CC.DefaultFont / 2 + 1
	local clip = {x1 = CC.ScreenW / 2 - w/2 - CC.XScale/2, y1 = CC.YScale + CC.ScreenH / 2 - hb, x2 = CC.XScale + CC.ScreenW / 2 + w, y2 = CC.YScale + CC.ScreenH / 2 + CC.DefaultFont + 1}
	local area = (clip.x2 - clip.x1) * (clip.y2 - clip.y1) + CC.DefaultFont*4		--绘画的范围
	--local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)		--绘画句柄

	for i = 5, 18 do
		if JY.Restart == 1 then
			break
		end
		local tstart = lib.GetTime()
		local y_off = i * 2
		
		--lib.SetClip(0, 0, CC.ScreenW, CC.ScreenH)
		--lib.LoadSur(surid, 0, 0)
		--显示文字
		Cat('实时特效动画')
        Cls()
        Cat('实时特效动画2')
		if str ~= nil then
			DrawString(clip.x1 - #str*CC.Fontsmall/5 + 30, clip.y1 - y_off - CC.DefaultFont*4, str, C_WHITE, CC.Fontsmall);
		end
		for j=1, showNum do
			local c = showValue[j] - 1;
			if showValue[j] == 3 and (string.sub(show[3],1,1) == "-" or string.sub(show[3],2,2) == "-") then		--减少生命，显示为红色
				c = 1;
			end
			DrawString(clip.x1, clip.y1 - y_off - (showNum-j+1)*CC.DefaultFont, show[showValue[j]], WAR.L_EffectColor[c], CC.DefaultFont); 	
		end 
		ShowScreen()
		lib.Delay(CC.BattleDelay)
	end
  
	--lib.SetClip(0, 0, 0, 0)		--清除
	WAR.Person[id]["生命点数"] = nil;
	WAR.Person[id]["内力点数"] = nil;
	WAR.Person[id]["体力点数"] = nil;
	WAR.Person[id]["中毒点数"] = nil;
	WAR.Person[id]["解毒点数"] = nil;
	WAR.Person[id]["内伤点数"] = nil;
	Cls()
	--lib.FreeSur(surid)
end

--计算医疗量
--id1 医疗id2, 返回id2生命增加点数
function ExecDoctor(id1, id2)
	if JY.Person[id1]["体力"] < 50 then
		return 0
	end
	local add = JY.Person[id1]["医疗能力"]
	local value = JY.Person[id2]["受伤程度"]
	if add + 20 < value then
		return 0
	end
  
	-- 平一指，医疗量和杀人数有关
	if (match_ID(id1, 28) or match_ID(id1, 9889)) and JY.Status == GAME_WMAP then
		add = math.modf(JY.Person[id1]["医疗能力"] * (1 + WAR.PYZ / 10))
	end
	--战斗中使用医术
	if JY.Status == GAME_WMAP then
		--子午针灸
		if YishuZJ(id1,187) then
			WAR.PD['子午'][id2] = 1
		end	
		--华佗
		if YishuZJ(id1,188) then
			WAR.PD['华佗'][id2] = 1
		end	
		--青牛
		if YishuZJ(id1,189) then
			WAR.PD['青牛'][id2] = 10
		end	
		--千金
		if YishuZJ(id1,190) then
			if WAR.PD['千金'][id2] ~= nil then
				WAR.PD['千金'][id2] = nil
			else
			    WAR.PD['千金'][id2] = 1
			end
		end	
		--黄帝
		if YishuZJ(id1,191) then
			WAR.PD['黄帝'][id2] = 1
		end
	end
  
	--战斗状态的医疗
	--胡斐在场程灵素医疗+120
	--王难姑在场胡青牛医疗+50
	if JY.Status == GAME_WMAP then
		for i,v in pairs(CC.AddDoc) do
			if match_ID(id1, v[1]) then
				for wid = 0, WAR.PersonNum - 1 do
					if match_ID(WAR.Person[wid]["人物编号"], v[2]) and WAR.Person[wid]["死亡"] == false then
						add = add + v[3]
					end
				end
			end
		end
	end
  
	add = add - (add) * value / 200
	add = math.modf(add) + Rnd(5)
  
	local n = AddPersonAttrib(id2, "受伤程度", -math.modf((add) / 8))
	--蓝烟清：医疗时显示内伤减少
	if JY.Status == GAME_WMAP then
		local p = -1;
		for wid = 0, WAR.PersonNum - 1 do
			if WAR.Person[wid]["人物编号"] == id2 and WAR.Person[wid]["死亡"] == false then
				p = wid;
				break;
			end
		end
		if p ~= -1 and p ~= nil and n ~= nil then
			WAR.Person[p]["内伤点数"] = n
		end
	end
	return AddPersonAttrib(id2, "生命", add)
end

--无酒不欢：计算武功伤害，WAR.CurID为攻击方
function War_WugongHurtLife(enemyid, wugong, level, ang, x, y)
    
end

-- 绘制战斗地图
-- flag=0  绘制基本战斗地图
--     =1  显示可移动的路径，(v1,v2)当前移动坐标，白色背景(雪地战斗)
--     =2  显示可移动的路径，(v1,v2)当前移动坐标，黑色背景
--     =3  命中的人物用白色轮廓显示
--     =4  战斗动作动画  v1 战斗人物pic, v2贴图所属的加载文件id
--                       v3 武功效果pic  -1表示没有武功效果
function WarDrawMap(flag, v1, v2, v3, v4, v5, ex, ey, px, py)
	local x
	local y
	if JY.Status == GAME_WMAP then
		x = WAR.Person[WAR.CurID]["坐标X"]
		y = WAR.Person[WAR.CurID]["坐标Y"]
	else
		x = JY.Base["人X1"]
		y = JY.Base["人Y1"]
	end		
	
	if not v4 then
		v4 = JY.SubScene
	end
	if not v5 then
		v5 = -1;
	end
	
	px = px or 0
	
	py = py or 0
	
	if flag == 0 then
		lib.DrawWarMap(0, x, y, 0, 0, -1, v4)
	elseif flag == 1 then
		--胡斐居，雪山，有间客栈，凌霄城，北京城，华山绝顶
		if v4 == 0 or v4 == 2 or v4 == 3 or v4 == 39 or v4 == 107 or v4 == 111 then
			lib.DrawWarMap(1, x, y, v1, v2, -1, v4)
		else
			lib.DrawWarMap(2, x, y, v1, v2, -1, v4)
		end
	elseif flag == 2 then
			lib.DrawWarMap(3, x, y, 0, 0, -1, v4)
	elseif flag == 4 then
		--ex = (ex or 0) + 25
		--ey = (ey or 0) + 25
		lib.DrawWarMap(4, x, y, v1, v2, v3, v4,v5, ex, ey)
	--单人动画
	elseif flag == 6 then
		lib.DrawWarMap(6, x, y, v1, v2, v3, v4,v5, ex, ey, px, py)

	--防御动画
	elseif flag == 7 then
		lib.DrawWarMap(7, x, y, 0, 0, v3, v4,v5, ex, ey, px, py)
	end
  
	if WAR.ShowHead == 1 then
		WarShowHead()
	end
	
	if CONFIG.HPDisplay == 1 then
		if WAR.ShowHP == 1 then
			HP_Display_When_Idle()	--常态显血
		end
	end
end

--敌方战斗数据
function WarSelectEnemy()
	--敌方数据特别调整
	if PNLBD[WAR.ZDDH] ~= nil then
		PNLBD[WAR.ZDDH]()
	end
  
    if WAR.ZDDH == 354 then 
        local x = 20
        local y = 46
        for i = 1,#CC.HSLJ2 do
            local id = CC.HSLJ2[i]
            WAR.Person[WAR.PersonNum]["人物编号"] = id
            WAR.Person[WAR.PersonNum]["我方"] = false
            WAR.Person[WAR.PersonNum]["坐标X"] = x
            WAR.Person[WAR.PersonNum]["坐标Y"] = y
            WAR.Person[WAR.PersonNum]["死亡"] = false
            WAR.Person[WAR.PersonNum]["人方向"] = 0
            WAR.PersonNum = WAR.PersonNum + 1
            x = x + 1
            if x == 34 then 
                x = 20
                y = y - 2
            end
        end
    else
			--冰糖恋：单挑陈达海
      if WAR.ZDDH == 92 and GetS(87,31,33,5) == 1 then
          for i=2,5 do	
              WAR.Data["敌人" .. i] = -1;
          end
      end
			--神门十三剑
			if WAR.ZDDH == 267 then
				for i=1,5 do
					WAR.Data["敌人" .. i] = -1;
				end
				WAR.Data["敌人1" ] = 699
				WAR.Data["敌人2" ] = 278
				JY.Person[278]["姓名"] = "陈友谅"
				JY.Person[278]["生命最大值"] = 500*JY.Base["难度"]
				JY.Person[278]["生命"] = 500*JY.Base["难度"]
				JY.Person[278]["内力最大值"] = 1000*JY.Base["难度"]
				JY.Person[278]["内力"] = 1000*JY.Base["难度"]
				JY.Person[278]["攻击力"] = JY.Person[278]["攻击力"] + 50
				JY.Person[278]["防御力"] = JY.Person[278]["防御力"] + 50
				JY.Person[278]["轻功"] = JY.Person[278]["轻功"] + 50					
				JY.Person[278]["武功1"]	= 229
				JY.Person[278]["武功等级1"]	= 999
				JY.Person[278]["武功2"]	= 90
				JY.Person[278]["武功等级2"]	= 999
				JY.Person[278]["主运内功"]	= 90
				JY.Person[699]["武功1"]	= 205
				JY.Person[699]["武功等级1"]	= 999
				JY.Person[699]["武功2"]	= 241
				JY.Person[699]["武功等级2"]	= 999	
				JY.Person[699]["主运内功"]	= 241
				JY.Person[699]["攻击力"] = JY.Person[278]["攻击力"] + 50
				JY.Person[699]["防御力"] = JY.Person[278]["防御力"] + 50
				JY.Person[699]["轻功"] = JY.Person[278]["轻功"] + 50									
			end	               
      --无酒不欢：新论剑敌人
      if WAR.ZDDH == 266 then
          WAR.Data["敌人1"] = GetS(85, 40, 38, 4)
      end
      if WAR.ZDDH == 3 and JY.Person[3]['品德'] == 100 then
      	for i = 7, 10 do 
      		WAR.Data['敌人'..i] = 440+i
      	end	 
      end
      if WAR.ZDDH == 437 and psx(517,'品德') == 100 then
					WAR.Data["敌人1"] = 525
					WAR.Data["敌人2"] = 526
      end	
      if WAR.ZDDH == 439 then
      	if psx(517,'品德') == 100 then
					WAR.Data["敌人1"] = 525
					WAR.Data["敌人2"] = 526
					for k = 3,5 do
						WAR.Data["敌人"..k] = -1
					end	
				else
					for k = 1,20 do
						if WAR.Data["敌人"..k] == 527 then
							WAR.Data["敌人"..k] = -1
						end	
					end
				end		
      end
      for i = 1, 20 do
            if WAR.Data["敌人" .. i] > 0 then
                WAR.Person[WAR.PersonNum]["人物编号"] = WAR.Data["敌人" .. i]
                WAR.Person[WAR.PersonNum]["我方"] = false
                WAR.Person[WAR.PersonNum]["坐标X"] = WAR.Data["敌方X" .. i]
                WAR.Person[WAR.PersonNum]["坐标Y"] = WAR.Data["敌方Y" .. i]
                WAR.Person[WAR.PersonNum]["死亡"] = false
                WAR.Person[WAR.PersonNum]["人方向"] = 1
                
                --无酒不欢：调整战斗初始面向
                --战海大富
                if WAR.ZDDH == 259 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 2
                end
                --双挑公孙止
                if WAR.ZDDH == 273 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                --杨过单金轮
                if WAR.ZDDH == 275 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                --战杨龙
                if WAR.ZDDH == 75 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                --蒙哥
                if WAR.ZDDH == 278 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                --芷若夺掌门
                if WAR.ZDDH == 279 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                --单挑赵敏
                if WAR.ZDDH == 293 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                --玄冥二老
                if WAR.ZDDH == 295 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                --三挑岳不群
                if WAR.ZDDH == 298 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 2
                end
                --侠客邪
                if WAR.ZDDH == 170 then
                    WAR.Person[WAR.PersonNum]["人方向"] = 3
                end
                WAR.PersonNum = WAR.PersonNum + 1
            end
        end
    end
end

--计算战斗人物贴图
function WarCalPersonPic(id)
	
	--local n = 5106
	--n = n + JY.Person[WAR.Person[id]["人物编号"]]["头像代号"] * 8 + WAR.Person[id]["人方向"] * 2
	

	local pid = WAR.Person[id]['人物编号']
	local t = 0
	local n = 0
	for i = 1,5 do 
		if JY.Person[pid]['出招动画帧数'..i] > 0 then 
			t = JY.Person[pid]['出招动画帧数'..i]
			break
		end
	end

	n = n + WAR.Person[id]["人方向"]*t*2
	return n
end

--计算标准主角特殊行走贴图
function WarCalPersonPic2(id, gender)
	local n = 5058
	if gender == 1 then
		n = 5010
	end
	n = n + WAR.Person[id]["人方向"] * 12
	return n
end

--战斗是否结束
function War_isEnd()
	for i = 0, WAR.PersonNum - 1 do
		fuhuo(i)
		Cat('数值显示')
	end	
	for i = 0, WAR.PersonNum - 1 do
		local id = WAR.Person[i]["人物编号"]
		if WAR.PD['九命猫'][id] ~= nil and WAR.PD['九命猫'][id] > 0 and WAR.SXTJ < 500 then
			if WAR.Person[i]["死亡"] == true then
				WAR.Person[i]["死亡"] = false
			end
			if JY.Person[id]["生命"] < JY.Person[id]["生命最大值"]/2 then
				JY.Person[id]["生命"] = math.modf(JY.Person[id]["生命最大值"]/2)
				WarSetPerson()
			end
		end
		if JY.Person[id]["生命"] <= 0 then
			WAR.Person[i]["死亡"] = true
			if WAR.Person[i]["死亡"] == true then 
		        for j = 0,WAR.PersonNum -1 do 
		            if WAR.Person[j]["我方"] == WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then 
						if WAR.TMMS[400 + WAR.Person[j]["人物编号"]] == WAR.Person[i]["人物编号"] then
				            WAR.TMMS[400 + WAR.Person[j]["人物编号"]] = nil
						end
				    end
			    end
		    end
		end
	end
	Cat('实时特效动画')
	WarSetPerson()
  Cls()
  Cat('实时特效动画2')
	ShowScreen()
	lib.Delay(CC.BattleDelay)
	local myNum = 0
	local EmenyNum = 0
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["死亡"] == false then
			if WAR.Person[i]["我方"] == true then
				myNum = 1
			else
				EmenyNum = 1
			end
		end
	end
	if EmenyNum == 0 then
		return 1;
	end
	if myNum == 0 then
		return 2;
	end
	return 0
end

--无酒不欢：战斗是否结束2
function War_isEnd2()
	local myNum = 0
	local EmenyNum = 0
    for i = 0, WAR.PersonNum - 1 do
        if WAR.Person[i]["死亡"] == false then
			if JY.Person[WAR.Person[i]["人物编号"]]['生命'] > 0 then
                if WAR.Person[i]["我方"] == true then
                    myNum = 1
                else
                    EmenyNum = 1
                end 
            end
		end
	end

	if EmenyNum == 0 then
		return 1;
	end
	if myNum == 0 then
		return 2;
	end
	return 0
end

function WarSet()
	WAR.WGWL = 0		--记录武功10级的攻击力
	WAR.ZYHB = 0		--左右互搏，1：发动左右的回合，2：左右的额外回合
	--WAR.ZYHBP = -1		--记录发动左右的人的编号
	WAR.ZHB = 0			--周伯通的追加左右判定
	WAR.DZY = 0 		--打断左右效果
	WAR.DLJ = 0			--打噙B粜Ч
	WAR.AQBS = 0		--暗器倍数
	WAR.BJ = 0			--暴击
	WAR.XK = 0			--西狂之怒啸
	WAR.XK2 = nil
	WAR.DXZL = 0			--东邪之怒
	WAR.DXZL2 = nil	
	WAR.SKXYXS = 0			--
	WAR.YBY = 0			--杨冰羽
	WAR.TD = -1			--偷盗
	WAR.TDnum = 0		--偷盗数量
	WAR.HTSS = 0		--医生大招
	WAR.ZSF = 0			--张三丰万法自然
	WAR.QLBLX = 0		--李白千里不留行
	WAR.XZZ = 0			--虚竹福泽加护
	WAR.KFKJ = 0		--封不平狂风快剑
	WAR.HTS = 0			--何铁手五毒随机2-5倍威力
	WAR.ZWX = 0	
	WAR.KHZF = 0
	WAR.JYZJ_FXJ = 0	--	飞絮劲
    WAR.DZTG_DZS = 0	--	大宗师
	WAR.CQSX_WZSX = 0	
	WAR.MTJJ = 0          --喵太极奥义
	WAR.FS = 0			--四帮主之战，乔峰用铁掌
	WAR.ZBT = 1			--周伯通，每行动一次，攻击时伤害一+10%
	WAR.HTG = 1			--花铁杆每行动一次，集气+1
	WAR.BGSJ = 0		--不归三境第一境
	WAR.QXJH = 0		--七星聚会	
	WAR.ZWQJZ = 0		--真武七截阵
	WAR.HQT = 0			--霍青桐 杀体力
	WAR.CY = 0			--程英 杀内力
	WAR.HDWZ = 0		--霍都随机上毒
	WAR.ZJZ = 0			--朱九真，随机得到食材
	WAR.YJ = 0			--阎基偷钱
	WAR.HDAQ = 0        --获得暗器
	WAR.DJGZ = 0		--刀剑归真
	WAR.NSFEWSS = 0		--你是风儿我是沙
	WAR.DJHB = 0		--刀剑合璧
	WAR.DFMQ = 0		--大伏魔拳	
	WAR.WS = 0			--误伤
	WAR.ACT = 1			--连击回数
	WAR.ACT1 = 1        --另外的连击限制
	WAR.WDKTJ = 0		--	
	WAR.HZGX = 0		--标记修改
	WAR.SZAS = 0 --霜之哀
	WAR.LYSH = 0 		--两仪守护
	WAR.AJFHNP1 = 0 	--
	WAR.SJHB = 0		--双剑合壁
	WAR.SJHB_G = 0		--双剑合壁.攻
	WAR.SJHB_S = 0		--双剑合壁.守		
	WAR.DZXY = 0		--斗转星移
	WAR.YTTL = 0        --协同追击
	WAR.LXZQ = 0		--拳主大招
	WAR.LXYZ = 0		--指主大招
	WAR.JSYX = 0		--剑神大招
	WAR.QLJG = 0		--青莲剑歌大招
	WAR.DJD = 0
	WAR.LKQS = 0        --龙跨千山
	WAR.SL23 = 0	
	WAR.ASKD = 0		--刀主大招
	WAR.LXBR = 0		--龙象大招
	WAR.LXBRZ = 0
	WAR.LXZL10 = 0			--龙象之力暴怒，忽视绝对气防	
	WAR.XC_WLCZ = 0			--
	WAR.YZG=0	
	WAR.XC_JJNP = 0			--	
	WAR.YZHYZ = 0		--刀主大招增加怒气计数
	WAR.GCTJ = 0		--奇门大招
	WAR.JSTG = 0		--天罡大招
	WAR.YTML = 0 		--毒王大招
	WAR.SLSS = 0 		--梁萧 星罗散手	
	WAR.NGXS = 0		--内功攻击的系数
	WAR.TXZZ = 0		--太玄之重
	WAR.MMGJ = 0		--盲目攻击
	WAR.CMGJ = 0		--刺目攻击
	WAR.TGJF = 0        --同归剑法
	WAR.WMYH = 0        --无明业火
	WAR.TFBW = 0		--听风辨位的文字记录
	WAR.TLDWX = 0		--天罗地网的文字记录
	WAR.JSAY = 0		--金蛇奥义
	WAR.QMJ = 0			--青蟒剑
	WAR.JYSZ = 0		--九阴神爪
	WAR.OYFXL = 0 		--欧阳锋根据蛤蟆蓄力增加伤害
	WAR.LXXL = 0 		--梁萧蓄力增加伤害	
	WAR.XDLeech = 0		--血刀吸血量
	WAR.TZLeech = 0
	WAR.RMXX = 0	    --入魔吸血
	WAR.WYXLeech = 0	--韦一笑吸血量
	WAR.YLXX = 0		--殷离吸血量	标记修改
	WAR.ZZTM = 0 		--庄子天魔
	WAR.QZWDS = 0		--千蛛万毒手吸血量	
	WAR.TMGLeech = 0	--天魔功吸血量
	WAR.BHLeech = 0		--碧海吸血量
	WAR.BMSGXL = 0		--北冥吸内	
	WAR.XHSJ = 0		--血河神鉴吸血量
	WAR.WDRX = 0		--宋远桥使用太极拳或太极剑攻击后自动进入防御状态
	WAR.WDXL = 0        --武当派4级弟子使用太极拳或剑攻击后进入蓄力状态
	WAR.SLGFH = 0		--空性使用龙爪手
	WAR.SWJGS = 0		--空闻使用金刚手
	WAR.KMZWD = 0 		--周伯通空明之武道
	WAR.XTQKG = 0       --先天乾坤功
	WAR.ARJY = 0		--黯然极意
	WAR.ARJY1 = 0		--黯然极意	
	WAR.YLTW = 0		--云罗天网	
	WAR.SSYB = 0		--殊死一搏	
	WAR.LFHX = 0 		--林朝英流风回雪
	WAR.LWSWD = 0		--	
	WAR.YQFSQ = 0		--一气化三清	
	WAR.QXWXJ = 0		--七弦无形剑 莫大	
	WAR.YYBJ = 0 		--郭靖：有余不尽
	WAR.SEYB = 0
	WAR.MHSN = 0 		--	
    WAR.KZJYBF = 0      --
	WAR.BJYPYZ = 0 		--	
	WAR.BJYJF = 0 		--		
	WAR.YNXJ = 0		--玉女心经：夭矫空碧
	WAR.HXZYJ = 0		--会心之一击
	WAR.QQSH1 = 0		--琴棋书画之持瑶琴
	WAR.QQSH2 = 0		--琴棋书画之妙笔丹青
	WAR.QQSH3 = 0		--琴棋书画之倚天屠龙功
	WAR.QSAY = 0		--七伤奥义
	WAR.YZQS = 0		--一震七伤
	WAR.HYYQ=0
	WAR.TYJQ = 0		--阿青天元剑气
	WAR.WWWJ = 0
	WAR.LDJT = 0		--雷动九天
	WAR.CXLZ = 0	
	WAR.QBLL = 0		--
	WAR.SZXM = 0		--
    WAR.BLCC = 0
	WAR.XMJDHS = 0
	WAR.XMHSQ = 0	
	WAR.JTYJ1 = 0		--
	WAR.HZD_1 = 0		--陆渐海之道，上善若水，
	WAR.HZD_2 = 0		--陆渐海之道，海纳百川		
	WAR.OYK = 0 		--欧阳克灵蛇拳
	WAR.YTZ = 0 		--游坦之 标记修改
	WAR.HZJHS = 1		--虎爪绝户手
	WAR.DN=0			--鹤笔翁
    WAR.JXG_SJG =0      --鲸息功 神鲸歌
	WAR.JQBYH = 0		--六脉：剑气碧烟横
	WAR.CMDF = 0		--沧溟刀法
	WAR.NZQK = 0		--逆转乾坤
	WAR.BXCF = 0 		--袁承志碧血长风
	WAR.XMCX = 0 		--西门吹雪
	WAR.DDLZ = 0 		--点点连斩
	WAR.LJXD = 0 		--立即行动
	WAR.LJXD1 = 0 		--立即行动1		
	WAR.SBSYR = 0 		--李白十步杀一人
	WAR.FLHS1 = 0		--其疾如风
	WAR.FLHS2 = 0		--其徐如林
	WAR.FLHS4 = 0		--不动如山	
	WAR.FLHS6 = 0
	WAR.FLHS3 = 0
	WAR.FLHS5 = 0	--难知如阴
	WAR.SSESS1 = 0		--三十二身相.诸天相
	WAR.SSESS4 = 0		--三十二身相.白毫相
	WAR.SSESS5 = 0		--三十二身相.神鱼相
	WAR.SSESS6 = 0		--三十二身相.马王相
	WAR.NGJL = 0		--当前加力内功编号
	WAR.NGHT = 0		--当前护体内功编号
	WAR.CQSX = 0		--除却四相
	WAR.ZWWW = 0		--坐忘勿我
	WAR.BMXH = 0		--三大吸功
 	WAR.HDJY = 0		--胡刀极意   	
	WAR.CM = 0 			--沧溟开关
	WAR.DR = 0 			--叠刃计数
	WAR.BTJS = 0		--补天劫手
	WAR.ZYYD = 0		--记录左右的圣火移动步数
	WAR.LMSJwav = 0		--六脉神剑的音效
	WAR.JNTM = 0		--鸡你太美
	WAR.JGZ_DMZ = 0		--达摩掌
	WAR.LHQ_BNZ = 0		--般若掌
	WAR.WD_CLSZ = 0		--赤练神掌
	WAR.LHFSD = 0		--连环腐尸毒
	WAR.XHDB = 0        --玄寒毒爆
	WAR.HLZB = 0        --八荒降龙・荒龙震爆
	WAR.QZ_QXJF = 0		--七星剑法
	WAR.BXXHSJ = 0		--	
	WAR.ShowHead = 0	--显示右下角头像信息
	WAR.Effect = 0		--本次攻击的效果，2：伤害，3：杀内，4：医疗，5：上毒，6：解毒
	WAR.Delay = 0
	WAR.LifeNum = 0
	WAR.TZ_MRF = 0		--慕容复指令
	WAR.KHBX = 0		--葵花刺目
	WAR.BFX = 0			--必封穴
	WAR.BLX = 0			--必流血
	WAR.BBF = 0 		--必冰封
	WAR.BZS = 0			--必灼烧
	WAR.GSWS = 0 		--盖世无双
	--WAR.SSESS = 0 		--陆渐三十二身相
	--WAR.JGFX = 0 		--陆渐金刚法相	
	WAR.TWLJ = 0 		--天外连击
	WAR.DJJJ_LJ = 0
	WAR.JYLJ = 0 		--九阴连击	
	WAR.hit_DGQB = 0	--无酒不欢：独孤求败反击的特效显示
	WAR.ZZRZY = 0      --周芷若左右互搏
	WAR.XTTX = 0			--先天调息
	WAR.WFCZ = 0			--万佛朝宗
	WAR.BXAY_1 = 0			--辟邪奥义
	WAR.MZSH = 0			--阿紫曼珠沙华，每杀一个人+200气攻气防
	WAR.XZSC = 0
	WAR.YGAR = 0        --杨过黯然事件
   
	WAR.SZSD = -1			--被死战锁定的目标
	WAR.BJGX = 0
	WAR.JJZC = 0		--九剑真传的4种主动攻击特效
	WAR.JJDJ = 0 		--九剑荡剑式回气
	WAR.Dodge = 0		--判定是否闪避

	WAR.CXLC = 0		--狄云赤心连城
    WAR.YTLJ = 0		--倚天连击	
	WAR.CXLC_Count = 0	--狄云赤心连城计数
	WAR.WLLJ_Count = 0
	WAR.FQY = 0			--风清扬无招胜有招
	WAR.GHQH = 0		--黄衫女 广寒清辉
	WAR.LXXZD = 0	    --梁萧 谐之道	
	WAR.LPZ = 0			--林平之回气
	WAR.JMZL = 0
	WAR.L_TLD = 0;		--装备屠龙刀特效，1流血
	WAR.PJTX1 = 0
    WAR.YLSJJ = 0
	WAR.NZZ1 = 0
	WAR.BXZS = 0				--辟邪招式
	WAR.JYZS = 0				--九阳招式
	WAR.JYSS = 0				--九阴摄魂
	WAR.ZHAJ = 0                --中华傲诀
	WAR.KHSZ = 0			--葵花神针
	WAR.YYLZ = 0			--夜雨楼主
	WAR.KHSZ1 = 0      --葵花神针＋葵花神功
	WAR.ZWYJF = 0			--有剑诀的五岳剑法，无视绝对气防
	WAR.TXZS = 0 			--太玄招式
	WAR.LMZS = 0
	WAR.WYSJ = 0
	WAR.WGZS = 0
	WAR.AJFHNP = 0	        -- 阿九	
	WAR.JuHuo = 0			--举火燎原
	WAR.LiRen = 0			--利刃寒锋
	WAR.BRXL = 0			--般若蓄力
	WAR.LWX = 0				--李文秀的破气防特效
	WAR.PDJN = 0			--陈家洛庖丁解牛
	WAR.KF = 0	
	WAR.ATNum = 1
	WAR.RULAISZ = 0
	WAR.RULAISZ_1 = 0
	WAR.TDJW = 0 --天刀九问
	WAR.DJTS = 0 --大九天手
	WAR.SHPS = 0           --山河破碎
end	

--设置战斗全局变量
function WarSetGlobal()
	WAR = {}
	WAR.Data = {}
	WAR.Person = {}
	WAR.MCRS = 0 --无酒不欢：每场战斗选的人数
	for i = 0, 100 do
		WAR.Person[i] = {}
		WAR.Person[i]["人物编号"] = -1
		WAR.Person[i]["我方"] = true
		WAR.Person[i]["坐标X"] = -1
		WAR.Person[i]["坐标Y"] = -1
		WAR.Person[i]["死亡"] = true
		WAR.Person[i]["闪避"] = false;
		WAR.Person[i]["人方向"] = -1
		WAR.Person[i]["贴图"] = -1
		WAR.Person[i]["贴图类型"] = 0
		WAR.Person[i]["轻功"] = 0
		WAR.Person[i]["移动步数"] = 0
		WAR.Person[i]["经验"] = 0
		WAR.Person[i]["自动选择对手"] = -1
		WAR.Person[i].Move = {}
		WAR.Person[i].Action = {}
		WAR.Person[i].Time = 0
		WAR.Person[i].TimeAdd = 0
		WAR.Person[i].SpdAdd = 0
		WAR.Person[i].Point = 0
		WAR.Person[i]["特效动画"] = -1
		WAR.Person[i]["反击武功"] = -1
		WAR.Person[i]["追击武功"] = -1
		WAR.Person[i]["特效文字0"] = nil
		WAR.Person[i]["特效文字1"] = nil
		WAR.Person[i]["特效文字2"] = nil
		WAR.Person[i]["特效文字3"] = nil
		WAR.Person[i]["特效文字4"] = nil	--无酒不欢：加到这里 8-11
		WAR.Person[i]["先手反击"] = -1
		WAR.Person[i]["反击"] = -1
		WAR.Person[i]["护盾"] = -1
		WAR.Person[i]["护盾贴图"] = -1
		WAR.Person[i]["护盾贴图1"] = -1
		WAR.Person[i]["护盾贴图2"] = -1
		WAR.Person[i]["护盾贴图3"] = -1
		WAR.Person[i]["护盾贴图index"] = 0
		WAR.Person[i]["护盾延迟"] = nil
		WAR.Person[i]["神游太虚"] = nil
	end
  
	WAR.LSTF = {}		--临时天赋
	WAR.PersonNum = 0	
	WAR.AutoFight = 0
	WAR.CurID = -1
	WAR.MissPd = 0
	--门派
	WAR.SLSQF = 0--少林寺拳法
	WAR.SLSZF = 0--少林寺指法
	WAR.SLSDF = 0--少林寺刀法
	WAR.SLSQM = 0--少林寺奇门
	WAR.JGDQZ = 0--少林金刚殿拳掌
	WAR.JGDZF = 0--少林金刚殿指法
	WAR.LHTDF = 0--少林罗汉堂刀法
	WAR.LHTQM = 0--少林罗汉堂奇门
	WAR.LYWC = 0 --两仪微尘阵
	WAR.ZSSS = 0		--张三
	WAR.LSFE = 0		--李四
	WAR.MTSD = 0    --喵太极
	WAR.SXTJ = 0		--时序
	WAR.SSX_Counter = 0	--三时序计数器
	WAR.WSX_Counter = 0	--五时序计数器
	WAR.LSX_Counter = 0	--六时序计数器
	WAR.JSX_Counter = 0	--九时序计数器
	WAR.BDQS = 0		--王重阳北斗真打状态层数
	WAR.XYS = 4			--萧远山杀破狼
	WAR.QCF = 0			--戚长发复活
	WAR.WQTS_TY = 0		--忘情天书 天意	
	WAR.XMH = 0			--薛慕华 复活一个人
	WAR.ZSHY = {}		--转瞬红颜计数器
	WAR.LMSS = {}		--老谋深算计数器
	WAR.TDWJ = {}		--天地无极计数器
	WAR.CYDT = {}		--纯阳道体计数器
	WAR.QWHW = {}		--情为何物计数器
	WAR.BHCS = {}		--碧海潮生曲计数器
	WAR.TMMTJ = {}		--唐门喵太极计数器
	WAR.JTJQ = {}		--九天剑气计数器
	WAR.YMJ = {}        --云梦涧计数器
	WAR.NJSK = {}       --凝结时空计数器
	WAR.WDYX = {}       --万道由心计数器
	WAR.WCY = {}		--一灯复活
	WAR.CYZX = {} 		--王重阳复活
	WAR.ZHRM = {} 		--萧远山走火入魔
	WAR.JSBD = {}		--金蛇牙突
	WAR.YTJS = {} 		--金蛇
	WAR.LMC = 0 		--金蛇判定
	WAR.ZH001=0			--召唤计数（召唤模版）
	WAR.OWN = 1
	WAR.YJDD = 1        --援军
	WAR.SXJ = 0
	WAR.BFTX = 0
	WAR.KTAY1 = 0
	WAR.KTAY2 = 0
	WAR.MJCJ = 10        --明教
	WAR.SSNSD = 1        --三尸脑神丹
	WAR.MKZS = 0
	WAR.DUIZHAO = 0     --对招
	WAR.HEJI = 0        --合击
	WAR.KHCM = {}       --对招
	WAR.ZXQJ = {}       --紫霞气劲
	
	WAR.YQQF = 0        --野球拳
	WAR.SSJF = 0        --神山剑法
	
	WAR.LWZN = {}       --龙象般若功
    WAR.LXQJ = {}       --龙象般若功
    WAR.LXJQ = 0        --龙象般若功
	WAR.LXBL = 0        --龙象般若功
	WAR.LXFM = 0
	WAR.LHFM = 0
	WAR.SZH = 0
	WAR.HYDQ = {}       --火焰刀
	WAR.HYDJ = {}       --火焰刀
	WAR.HYDQJ = 0       --火焰刀
	WAR.HYDNJ = 0       --火焰刀
	WAR.JJBS = {}       --紫霞剑劲  
	WAR.XWGJ = {}       --玄武罡劲
	WAR.XWRJ = {}       --玄武柔劲
	WAR.XWQJ = 0        --玄武气劲
	WAR.XWQG = 0        --玄武气劲
	WAR.JYZQ = {}       --九阴真气
	WAR.JYHT1 = 0       --九阳真气
    WAR.JYHT2 = 0       --九阴真气
	WAR.ZXQJ1 = 0       --紫霞气劲
	WAR.XTZQ = {}       --先天真气
	WAR.XTZQ1 = 0       --先天真气
	WAR.QSZQ = 0
	--WAR.JYFXJ = {}      --九阴飞絮劲
	WAR.JYFXJ = 0       --飞絮劲
    --WAR.FXHJ = 0        --飞絮劲
    WAR.FXHJ1 = 0       --飞絮劲
    WAR.FXHJ2 = 0       --飞絮劲
    WAR.FXHJ3 = 0       --飞絮劲
    WAR.FXHJ4 = 0       --飞絮劲
	--WAR.ZBT = {}        --十里坡剑神
	WAR.ZBT1 = 0        --螺旋九影
	WAR.ZBT2 = 0        --螺旋九影
	WAR.ZBT3 = 0        --螺旋九影
	WAR.YHDF = {}       --摄魂
	WAR.YHDF1 = 0       --摄魂
	WAR.CJSZ = 0        --摧坚神爪
	WAR.JYXL = 0        --九阴降龙
	WAR.XTZJ = 0        --重剑真传
	WAR.HMJT = {}       --蛤蟆九天
	WAR.DZAY = {}       --斗转星移
	WAR.L_NYZH = {}     --逆运走火
	WAR.SLCS = {}       --擒龙功
	WAR.SLCS1 = {}       --擒龙功
	WAR.KLYH = 0        --擒龙功
	WAR.KLST = 0        --擒龙功
	WAR.WWDZ = {}       --唯我独尊
	WAR.TJSG = {}       --太极神功
	WAR.XMJYS = 6       --虾米绝影闪
	WAR.DQJYS = 8       --斗气绝影闪
	WAR.JYS = 3         --绝影闪
	WAR.CLB = 0         --苍狼步
	WAR.SLS = 5         --隼龙闪
	WAR.SLB = 0         --隼龙步
	WAR.CYTJ = {}       --纯阳太极
	WAR.CYAY = 0        --纯阳奥义
	WAR.YFHS = 0        --妖风祸世
	WAR.YYEQ1 = 0       --阴阳二气
	WAR.XTTJ1 = 0       --先天太极
	WAR.QGQC1 = 0       --倾国倾城
	WAR.SZQK1 = 0       --神足乾坤
	WAR.YSHB1 = 0       --易水寒冰
	WAR.QX1 = {}        --玉女心经
	WAR.ARJX = 0        --黯然销魂掌
	WAR.NYAR = 0		--逆运黯然
	WAR.LMJQ = 0        --六脉神剑
	WAR.LMJF = {}       --六脉神剑
	WAR.LMAY = 0        --六脉神剑
	WAR.DGJJ = {}       --独孤九剑
    WAR.DGJJ_ZJS = 0    --总决式
    WAR.DGJJ_PJS = 0    --破剑式
    WAR.DGJJ_PDS = 0    --破刀式
    WAR.DGJJ_PQS = 0    --破枪式
    WAR.DGJJ_PBS = 0    --破鞭式
    WAR.DGJJ_PSS = 0    --破索式
    WAR.DGJJ_PZS = 0    --破掌式
    WAR.DGJJ_PJS1 = 0   --破箭式
    WAR.DGJJ_PQS1 = 0   --破气式
    WAR.DGJJ_LDXJ = 0   --料敌先机 九剑归一
	WAR.PJS = 0         --独孤九剑
	WAR.PJS1 = 0        --独孤九剑
    WAR.PJS2 = 0        --独孤九剑
	WAR.XTCJ = 0        --独孤剑境
	WAR.AZ = 0          --独孤剑境
	WAR.POISON = {}     --独孤剑境
	WAR.DGJY = {}       --独孤剑意
	WAR.DGJY1 = 0       --独孤剑意
	WAR.TJZS = {}       --老张拉人
	WAR.HYZF = 0        --幻阴指法
	WAR.QTSPQ = 0       --七探蛇盘枪
	WAR.XMMD = 0        --虾米魔刀
	WAR.XMSZ = 0        --玄冥神掌
	WAR.XMSZ1 = 0       --玄冥神掌+寒冰真气
	WAR.XMSZ2 = 0       --玄冥神掌+寒冰真气
	WAR.XMSZ3 = 0       --玄冥神掌+寒冰真气
	WAR.XMSZ4 = 0       --玄冥神掌+寒冰真气
	WAR.BLJJ = 0		--狂风迅雷功组合
	WAR.JWDF = 0        --金乌刀法
	WAR.FQDF = 0        --夫妻刀法
	WAR.QLXL = 0        --擒龙降龙
	WAR.BHXL = 0        --八荒降龙
	WAR.YNSX = 0        --玉女素心剑法
	WAR.YNSX1 = 0
	WAR.QZJF = 0        --全真剑法特效
	WAR.QZJQ = {}       --全真剑气
	WAR.QZJQ1 = 0       --全真剑气
	WAR.YYLMJJF = 0
	WAR.TXQL = 0        --太玄青莲
	WAR.TXQL1 = 0       --太玄青莲
	WAR.KHFJ = {}       --葵花反击
	WAR.HFXZ = {}       --后发先至
	WAR.YFZ = {}        --玉蜂针 
	WAR.CSFJ = {}       --车神的反击
	WAR.CLFJ = {}       --真龙反击	
	WAR.HLFJ = {}       --护龙山庄反击
	WAR.WDFJ = {}       --五毒教反击
	WAR.SWFJ = {}       --兽王庄反击
	WAR.JYXLF = {}      --九阴降龙
	WAR.JXBH = {}       --鲸息碧海
	WAR.YJZD = {}       --以静制动
	WAR.YJZD1 = {}       --以静制动
	WAR.WSZA = {}       --逍遥派无视障碍物
	WAR.LMWZ = {}       --狸猫尾针
	WAR.KHCS = 0        --葵花重生
	WAR.BHLY = 0        --八荒六阳
	WAR.BHHJ = 0        --碧海幻境
	WAR.QCHP = 0        --青城指令
	WAR.QCLJ = 0        --青城指令
	WAR.RWSZ = 0         --让我三招
	WAR.XSBC = 0         --小拾背刺
	WAR.KHHD1 = 0       --葵花护盾
	WAR.BYCX = {}       --八心穿音
	WAR.YXMQ = 0        --玉箫剑法
    WAR.BYB = 0         --玉箫剑法
	WAR.XWSD = {}       --黄天无极响尾蛇
	WAR.GLJS = 0        --黄天无极割裂
	WAR.LBPM = 0        --朝廷移动
	WAR.LYBF = 0        --落英神剑掌
	WAR.BFZ = 0        --朝廷百夫长受伤
	WAR.TMZF = 0        --朝廷铁马阵
	WAR.YSJG = 0        --朝廷守势
	WAR.CTWM1 = 0        --朝廷武穆
	WAR.CTWM2 = 0        --朝廷武穆
	WAR.CTWM3 = 0        --朝廷武穆
	WAR.CTWM4 = 0        --朝廷武穆
	WAR.CTWM5 = 0        --朝廷武穆
	WAR.CTYQ = 0       --朝廷岳枪
	WAR.SDWLB = 0      --闪电五连鞭
	WAR.XLSDL = 0      --祥龙三叠浪
	WAR.TFJS = 0 --天佛降世
	WAR.SPIRIT = {}     --战意
    WAR.SPIRITMAX = {}  --战意
    WAR.SPIRITMIN = {}  --战意
	WAR.MYCHAIN = 0     --连锁
    WAR.URCHAIN = 0     --连锁
    WAR.MYCHAINADD = 0  --连锁
    WAR.URCHAINADD = 0  --连锁
	WAR.GBBZ = 0        --丐帮帮主
	WAR.TJZX0 = {}       --张三丰太极之形
    WAR.TJZX1 = {}       --张三丰太极之形
    WAR.TJZX2 = {}       --张三丰太极之形
	WAR.BG = {}         --武当八卦
	WAR.WJ = {}         --武当无极
    WAR.TJJSJS = {}      --太极计算减伤
	WAR.LMBJ = 0        --全真
    WAR.LMBJ1 = 0       --全真
    WAR.LMBJ2 = 0       --全真
    WAR.LMBJ3 = 0       --全真
    WAR.LMBJ4 = 0       --全真
    WAR.LMBJ5 = 0       --全真
    WAR.LMBJ6 = 0       --全真
    WAR.LMBJ7 = 0       --全真
    WAR.LMBJ8 = 0       --全真
    WAR.LMBJ9 = 0       --全真
	WAR.THSB = 0        --桃花三宝
	WAR.TH_BHMY = 0
    WAR.THSB1 = 0       --真・桃花三宝
    WAR.THSB2 = 0       --真・桃花三宝
    WAR.THSB3 = 0       --真・桃花三宝
    WAR.THSB4 = 0       --真・桃花三宝
	WAR.MCF = 0         --明教
    WAR.MCF2 = 0        --明教
	WAR.JZSEG = 0       --金钟十二关
	WAR.XMPM = 0        --罗汉堂嗔恶退散
	WAR.KMWD = 0
    WAR.KMWD1 = 0
    WAR.KMWD2 = 0
	WAR.DMZF = 0
	WAR.BPYZ = 0        --暗器特效
	WAR.BPYZ1 = 0
	WAR.SSFZ = 0        --生死符
	WAR.SSFZ1 = 0       --生死符
	WAR.PLLH = 0       --霹雳弹
	WAR.PLLHD = 0      --霹雳雷
	WAR.TGZ = 0        --透骨针
	WAR.TGZ1 = 0       --透骨针
	WAR.HXSZ = 0       --黑血神针
	WAR.HXSZ1 = 0      --黑血神针
	WAR.XXQG = {}      --日月神教捧月派吸星气攻
	WAR.XXQF = {}      --日月神教捧月派吸星气防
	WAR.ZLJS = 0       --斩流剑术
	WAR.ZLJS1 = 0      --斩流剑术
	WAR.ZLJS2 = 0      --斩流剑术
	WAR.ZLJS3 = 0      --斩流剑术
	WAR.ZLJS4 = 0      --斩流剑术
	WAR.ZLJS5 = 0      --斩流剑术
	WAR.ZLJS6 = 0      --斩流剑术
	WAR.WYWX = {}      --无影无相
	WAR.QSAY = 0       --七伤奥义
	WAR.YYDL = 0       --阴阳倒乱
	WAR.YYDL1 = 0      --阴阳倒乱
	WAR.YYDL2 = {}	   --阴阳倒乱
	WAR.HSYFD = 0      --阴风刀法
	WAR.YFDLW = 0      --阴风刀法
	WAR.TMMS = {}      --唐门模式
    WAR.QJBMS = {}     --唐门模式
	WAR.ZOMBIE = {}    --唐门返魂
    WAR.DPJ = {}       --唐门模式夺魄箭
    WAR.HXB1 = {}      --唐门模式夺魄箭
    WAR.ACSJ = {}      --唐门模式暗藏杀机
    WAR.JTJD = {}      --唐门模式暗藏杀机
	WAR.TMFJ = {}      --唐门反击
	WAR.BYLH = 0       --唐门模式
    WAR.HXB = 0        --唐门模式夺魄箭
    WAR.JTJD1 = 0      --唐门模式荆天棘地
    WAR.ZXJ = 0        --唐门模式夺魄箭
    WAR.CXN = 0        --唐门模式夺魄箭
    WAR.LZZ = 0        --唐门模式夺魄箭
	WAR.HXB = 0        --唐门模式夺魄箭 
	WAR.BYLH = 0       --唐门模式夺魄箭
	WAR.JTJD1 = 0      --唐门模式荆天棘地
	WAR.SGSF = 0       --七伤拳
    WAR.SFJZ = 0       --玄武真功
	WAR.HGB = {}       --幻光步
	WAR.SHML = {}      --幻光步
	WAR.SXG = 0
	WAR.GXHM = {}      --龟息蛤蟆诀
	WAR.TDSWX = 0      --天地随我心
	WAR.LRXL = 0       --路人降龙
	WAR.WDSL = 0       --万道森罗
	WAR.NFZQ = 0       --南凤朱雀
	WAR.QFQXM = {}     --拳法奇穴生命（敌）
	WAR.QFQXN = {}     --拳法奇穴内力（敌）
	WAR.QFMQX = {}     --拳法奇穴生命（我）
	WAR.QFNQX = {}     --拳法奇穴内力（我）
	
	WAR.ZFBJ1 = 0      --指法暴击
	WAR.ZFBJ2 = 0      --指法暴击
	WAR.ZFBJ3 = 0      --指法暴击
	WAR.ZFBJ4 = 0      --指法暴击
	WAR.JXSMD = {}     --剑法生命（敌）
	WAR.JXNLD = {}     --剑法内力（敌）
	WAR.JXSMW = {}     --剑法生命（我）
	WAR.JXNLW = {}     --剑法内力（我）
	WAR.ZFQXM = {}     --指法奇穴生命
	WAR.ZFQXN = {}     --指法奇穴内力
	WAR.DSZS = {}	   --点桑专属
	WAR.XMYZ = 0        
	
	WAR.NTJQ1 = 0      --怒涛海潮
	WAR.CXBN = 0       --畅想暴怒技
	WAR.GSWS1 = {}     --丐世无双 
	WAR.GSWS2 = {}     --丐世无双
	WAR.GSWS3 = 0      --丐世无双
	WAR.HLKH1 = {}     --护龙葵花
	WAR.HLKH2 = {}     --护龙葵花
	WAR.HLKH3 = 0      --护龙葵花
	WAR.TJDJ1 = {}     --天机刀剑
	WAR.TJDJ2 = {}     --天机刀剑
	WAR.TJDJ3 = 0      --天机刀剑
	WAR.DJHB1 = {}     --刀剑合璧 
	WAR.DJHB2 = {}     --刀剑合璧 
	WAR.DJHB3 = 0      --刀剑合璧 
	WAR.DLYZ1 = 0      --多罗叶
	WAR.EMBN = 0       --峨眉暴怒技
	WAR.EVENT1 = 0     --计算event
	WAR.YWSS = 0       --岳王散手
	WAR.XSXM = 0       --洗髓须弥
	WAR.BXJF = 0       --辟邪剑法
	WAR.BXJQ = {}      --辟邪剑气
	WAR.BXJJ1 = {}     --辟邪剑诀
	WAR.BXJJ2 = {}     --辟邪剑诀
	WAR.SHJL = {}      --伤害记录
	WAR.TJQJ = 0       --太极拳剑
	WAR.TJJD = 0       --天剑绝刀
	WAR.TJPL = 0       --增援
	WAR.MMJF = 0       --莫名剑法
	WAR.MMJF1 = 0      --莫名剑法
	WAR.MMJF2 = 0      --莫名剑法
	WAR.MMJF3 = 0      --莫名剑法
	WAR.MMJF4 = 0      --莫名剑法
	WAR.MMJF5 = 0      --莫名剑法
	WAR.MMJF6 = 0      --莫名剑法
	WAR.MMJF7 = 0      --莫名剑法
	WAR.MMJF8 = 0      --莫名剑法
	WAR.MMJF9 = 0      --莫名剑法
	WAR.MMJF10 = 0     --莫名剑法
	WAR.WZJS = {}      --位置计算
	WAR.JXFS = 0       --剑血浮生
	WAR.TJFJ = 0       --莫名剑法
	WAR.WTJJ = 0       --无天绝剑
	WAR.WTJJ1 = 0      --无天绝剑
	WAR.WTJJ2 = 0      --无天绝剑
	WAR.WTJJ3 = 0      --无天绝剑
	WAR.WTJJ4 = 0      --无天绝剑
	WAR.WTJJ5 = 0      --无天绝剑
	WAR.WTJJ6 = 0      --无天绝剑
	WAR.WTJJ7 = 0      --无天绝剑
	WAR.WTJJ8 = 0      --无天绝剑
	WAR.WTJJ9 = 0      --无天绝剑
	WAR.WTJJ10 = 0     --无天绝剑
	WAR.WTJJ11 = 0     --无天绝剑
	WAR.WTJJ12 = 0     --无天绝剑
	WAR.WTJJ13 = 0     --无天绝剑
	WAR.WTJJ14 = 0     --无天绝剑
	WAR.ZBX = 0       --醉八仙
	WAR.TJXL = 0       --太极功蓄力
	WAR.LXLL = 0       --龙象之力
	WAR.YINGSHA = {}   --剑气留形
	WAR.YTTLLV = {}    --追击判定
	WAR.LKQSPD = {}    --龙跨千山
	WAR.KMBD = 0       --空明北斗
	WAR.PLSF = nil      --霹雳身法
	WAR.SFBJ = 0       --尚方宝剑
	WAR.HLFS = 0       --护龙山庄分身
	WAR.HLZL1 = 0      --护龙指令
	WAR.TJGJ = 0       --天机宫指令
	WAR.Stop = {}      --禁止移动位置
	WAR.XIANSHU_COUNT_INONEACTION = 0 --只有第一次耗费体力内力
	WAR.YFS_COUNT = {}	 --分身数目
	WAR.CHLY = 0 -- 残火领域
	WAR.CHTD = 0
	WAR.ZDDSSF = 0
	
	--出手判定
	WAR.ATK = {['人物'] = nil,['人物table'] = {},['人物pd'] = {},['中断'] = false
				}
    
    --常驻函数
	WarSet()
	
	WAR.PYZ = 0			--平一指杀人
	
	
	WAR.ZDDH = -1		--战斗代号
	WAR.NO1 = -1		--旧版论剑第一名
	WAR.zhangsanfeng = 0
	WAR.TJAY = 0		--太极奥义
	

	WAR.DZXYLV = {}
	--WAR.fthurt = 0		--乾坤反弹的伤害

	
	WAR.TLDW = {}		--天罗地网

    --战场人物是否存在某个天赋，用于改善循环
    WAR.TF = {}

    --战场人物是否存在某个天赋，用于改善循环
    WAR.TF1 = {}

    --战场人物是否存在某个武功，用于改善循环
	WAR.WG = {}

    --Boss判定
    WAR.Boss = {}

	--记录特效文字
    WAR.TXWZ = {['特效文字0'] = {},['特效文字1'] = {},['特效文字2'] = {},['特效文字3'] = {},['特效文字4'] = {},['特效文字5'] = {}}
    
	--判定数据，统一书写
	WAR.PD = {
			['同时出招'] = {},
			['受击判定'] = {},
			['动画判定'] = {},
			['乾'] = {},			--八卦・乾特效
			['坤'] = {},			--八卦・坤特效
			['震'] = {},			--八卦・震特效
			['巽'] = {},			--八卦・巽特效
			['坎'] = {},			--八卦・坎特效
			['离'] = {},			--八卦・离特效
			['艮'] = {},			--八卦・艮特效
			['兑'] = {},			--八卦・兑特效
			['刀剑绝技'] = {},     --刀剑绝技
			['你是风儿我是沙1'] = {},     --你是风儿我是沙
			['你是风儿我是沙2'] = {},     --你是风儿我是沙
			['临'] = {},			--八卦・兑特效
			['兵'] = {},			--八卦・兑特效
			['斗'] = {},			--八卦・兑特效
			['者'] = {},			--八卦・兑特效
			['列'] = {},			--八卦・兑特效
			['阵'] = {},			--八卦・兑特效
			['皆'] = {},			--八卦・兑特效
			['在'] = {},			--八卦・兑特效
			['前'] = {},			--八卦・兑特效
			['插队判定'] = {},
			['不败金刚'] = {},
			['甩锅发动'] = {},
			['玄之又玄'] = {},
			['神游太虚'] = {},	
			['顾影自怜'] = {},
			['蛇行狸翻'] = {},
			['氤氲紫气'] = {},
			['如来神掌'] = {},
            ['金刚般若'] = {},	
			['疾如风'] = {},
			['侵如火'] = {},
			['守如山'] = {},
			['徐如林'] = {},
			['无量禅震'] = {},
			['诸法无我'] = {},
			['偷天换日'] = {},
			['梅长苏'] = {},
			['叠刃'] = {},
			['先天护盾CD'] = {},
            ['先天护盾'] = {},
			['金刚护盾'] = {},
			['神足护盾'] = {},	--标记修改
            ['坐忘无我'] = {},
            ['天魔金身'] = {},
			['葵花护盾'] = {},
			['怒涛剑气'] = {},
			['九阳护盾'] = {},
			['阴阳二气'] = {},
			['先天太极'] = {},
			['倾国倾城'] = {},
			['神足乾坤'] = {},
			['神足真气'] = {},
			['长生真气'] = {},
			['易水寒冰'] = {},
			['菩提金身'] = {},
			['万毒炼体'] = {},
			['毒龙吞天'] = {},
			['借力打力'] = {},
			['蛤蟆蓄力'] = {},
			['鲸息蓄力'] = {},
			['般若内爆'] = {},
			['太极蓄力'] = {},
			['长生蓄力'] = {},
			['复活状态'] = {},
			['走火状态'] = {},
			['先天罡气'] = {},
			['太极蓄劲'] = {},
			['气阻中门'] = {},
			['玄铁剑创'] = {},
			['九剑破尽'] = {},
			['野球拳'] = {},
			['西瓜刀'] = {},
			['西瓜刀・残刀'] = {},
			['西瓜刀・天人'] = {},
			['长生诀'] = {},
			['雪花六出'] = {},
			['太极奥义・厚积薄发'] = {},
			['降龙・双龙取水'] = {}, --行动后可以再次攻击（不是左右）
			['降龙・亢龙有悔'] = {},--敌方防御下降30%
			['降龙・潜龙勿用'] = {},--行动后自动防御
			['降龙・震惊百里'] = {},--敌方昏迷
			['降龙・飞龙在天'] = {},--一回合集气1.5倍
			['降龙・见龙在田'] = {},--必中
			['降龙・有余不尽'] = {},--增加真伤
			['黯然值'] = {},
			['黯然・行尸走肉'] = {},
			['黯然・饮恨吞声'] = {},
			['黯然・无中生有'] = {},
			['黯然・六神不安'] = {},
			['黯然・倒行逆施'] = {},
			['黯然・穷途末路'] = {},
			['黯然・呆若木鸡'] = {},
			['穿山虎铁臂神拳'] = {},
			['龙爪手'] = {},
			['火延'] = {},
			['复活・龙啸九天'] = {},
			['回气'] = {},
			['绊字决'] = {},
			['封字决'] = {},
			['缠字决'] = {},
			['挑字决'] = {},
			['引字决'] = {},
			['戳字决'] = {},
			['曲夕烟隙'] = {},
			['曲径通幽'] = {},
			['八酒杯'] = {},
			['梨花酒'] = {},
			['玉露酒'] = {},
			['五宝花蜜酒'] = {},			
			['即墨老酒'] = {},
			['白云熊胆'] = {},
			['天香续命'] = {},
			['小还丹'] = {},
			['黄连解毒'] = {},
			['牛黄血蝎'] = {},
			['六阳正气'] = {},
			['万佛朝宗'] = {},
			['辟邪剑意'] = {},
			['洞火'] = {},
			['中庸'] = {},
			['立地成佛'] = {},
			['放下屠刀'] = {},
			['菩提咒'] = {},
			['金刚咒'] = {},
			['创伤'] = {},
			['禁疗'] = {},
			['瞬息千里'] = {},
			['飞云回转刀'] = {},
			['破剑八刀'] = {},
			['破剑八刀CD'] = {},
			['扶摇九天'] = {},
			['金蛇缠丝手CD'] = {},
			['无形气墙'] = {},
			['奇门五转'] = {},
			['吸星真气'] = {},
			['独孤剑势'] = {},
			['独孤破招'] = {},
			['九阴破体'] = {},
			['逍遥御风闪避'] = {},
			['凌波微步闪避'] = {},
			['神行百变闪避'] = {},
			['七星阵步闪避'] = {},
			['流云逐月闪避'] = {},
			['入魔'] = {},
			['傲寒六诀'] = {},
			['御气纵横'] = {},
			['时序出手'] = {},
			['奇门流血'] = {},
			['奇门内伤'] = {},
			['奇门封穴'] = {},
			['浩然罡气'] = {},
			['虎啸龙吟'] = {},
			['受想行识'] = {},
			['亦复如是'] = {},
			['虚弱状态'] = {},
			['散功状态'] = {},
			['无明业火'] = {},
			['利刃寒锋'] = {},
			['走火入魔'] = {},
			['无招胜有招'] = {},
			['灵蛇拳'] = {},
			['集气倒退'] = {},
			['琴音状态'] = {},
			['冰冻状态'] = {},
			['迟缓状态'] = {},
			['混乱状态'] = {},
			['魅惑状态'] = {},--一定回合内改变阵营
			['度化状态'] = {},--回合结束后改变阵营
			['魔岭玫瑰'] = {},--一定时序内改变阵营
			['脆弱状态'] = {},
			['锁足状态'] = {},
			['盲目状态'] = {},
			['同归状态'] = {},
			['恐惧状态'] = {},
			['昏迷状态'] = {},
			['参合状态'] = {},
			['辰宿列张'] = {},
			['沉睡状态'] = {},
			['麻痹状态'] = {},
			['头晕目眩'] = {},
			['生死符'] = {},
			['流云飞袖'] = {},
			['扫荡群魔'] = {},
			['辟邪连击'] = {},
			['刺目'] = {},
			['六脉招式'] = {},
			['降龙招式'] = {},
			['黯然招式'] = {},
			['打狗招式'] = {},
			['火焰招式'] = {},
			['九剑招式'] = {},--暴走状态2
			['暴走状态2'] = {},
			['暴走状态'] = {},
			["战意爆发"] = {},--战意爆发
			['怒气爆发'] = {},--控制怒气爆发的动画用，没有其他功能
			['接化发'] = {},
			['金蛇幻毒'] ={}, --金蛇幻杀 
			['十方无敌'] = {},
			['凝结时空'] = {},
			['岳家枪诀'] = {},
			['花涧如雾'] = {},
			['倚天屠龙'] = {},
			['白蟒鞭法'] = {},
			['降龙虚劲'] = {}, --九阴降龙
			['羽蛇腾云'] = {}, --九阴降龙
			['不破防'] = {},
			['必杀气'] = {},
			['神兵'] = {},--一定时序伤害气攻增加1.5倍
			['内伤恢复'] = {},
			['冰封恢复'] = {},
			['灼烧恢复'] = {},
			['封穴恢复'] = {},
			['中毒恢复'] = {},
			['流血恢复'] = {},
			['体力恢复'] = {},
			['必连击'] = {},
			['杀内力'] = {},
			['增加气攻'] = {},--强制杀气
			['增加伤害'] = {},--增加伤害
			['必暴击'] = {},
			['负面状态'] = {},
			['必冰封'] = {},
			['必灼烧'] = {},
			['集气速度'] = {},
			['闪避'] = {},
			['强运'] = {}, --提高概率一回合
			['必命中'] = {},
			['时序闪避'] = {},       --隐蔽
			['免疫反击'] = {}, 
			['免疫断连'] = {}, 
			['免疫内伤'] = {}, --免疫此状态一回合
			['免疫中毒'] = {}, --免疫此状态一回合
			['免疫冰封'] = {}, --免疫此状态一回合
			['免疫灼烧'] = {}, --免疫此状态一回合
			['免疫封穴'] = {}, --免疫此状态一回合
			['免疫流血'] = {}, --免疫此状态一回合
			['免疫杀气'] = {}, --免疫此状态一回合
			['血战到底'] = {},
			['复活无效'] = {},
			['西域奇毒'] = {},--照生命比例扣血
			['中毒不解'] = {},--一定时序内中毒量无论如何都不会减少
			['伤重不治'] = {},--一定时序内内伤量无论如何都不会减少
			['焚炎不尽'] = {},--一定时序内灼烧量无论如何都不会减少
			['玄冰不化'] = {},--一定时序内冰封量无论如何都不会减少
			['血流不止'] = {},--一定时序内流血量无论如何都不会减少
			['凝冰成铠'] = {},--利用冰封增加自己抗性
			['基础蛊毒'] = {},--行动后集气回复减少，增幅毒性爆发的减血
			['九阳反震'] = {},--行动后集气回复减少
			['互搏真谛杀气'] = {},
			['互搏真谛蓄力'] = {},
			['再次行动'] = {},
			['刺猬状态'] = {},
			['格挡状态'] = {},
			['坚甲状态'] = {},
			['败血破命'] = {}, --敌方内功加力时，会对自己附加流血，并机率根据当前流血值扣减生命。
			['残劲袭魄'] = {}, --敌方内功加力时，会对自己上内伤，且该次攻击气攻为零、伤害大幅下降。
			['寒毒入体'] = {}, --寒毒入体
			['火毒攻心'] = {}, --火毒攻心
			['五蕴炽盛'] = {}, --五蕴炽盛
			['封气绝脉'] = {}, --封气绝脉：解除封穴时集气倒退150～200
			['力竭'] = {}, --一定回合内，敌人体力消耗倍增，恢复速率降低
			['霸王破甲'] = {}, --一定时序内，敌人防御、轻功降低，必破气防
			['机率下降'] = {},
			['冰冻扣血'] = {}, --与冰冻状态搭配扣血
			['举火燎原'] = {},
			["飞天步"] = {}, -- 飞天步天轻效果，移动增加
			["飞天步1"] = {}, --飞天步进阶减伤效果
			['邪魅苍生'] = {},--凌波微步高阶效果
			["登云"] = {},
			["登云1"] = {},--梯云高阶特效
			["太玄组合攻击1"] = {},--十步杀一人
			["太玄组合攻击2"] = {},--吴钩霜雪明
			["TXZHATK3"] = {},--邯郸先震惊
			["太玄组合攻击4"] = {},--三杯吐然诺
			["太玄组合攻击5"] = {},--白手太玄经
			["太玄组合防御1"] = {},
			["太玄组合防御2"] = {},
			["太玄组合防御3"] = {},
			["太玄组合防御4"] = {},
			['九阳组合判定'] =  {},
			['九阴组合判定'] =  {},
			['易筋组合判定'] =  {},
			['太极组合判定'] =  {},
			['白驼逆运判定'] = {},
			['易筋不死'] =  {},
			['金雁功闪避'] = {},--金雁功高阶瞬移
			['金雁功闪避1'] = {},
			['精神错乱'] = {},--打敌人加血√
			['神经蛇毒'] = {}, --机率判定必然失败√
			['出血蛇毒'] = {},--√
			['破甲蛇毒'] = {},--√
			['怒气负面效果1'] = {},--爆怒不加速、加内伤和灼烧
			['怒气负面效果2'] = {},--爆怒时怒气值接减半或是附加利刃天罗
			["分身判定"] = {}, --判断自己是不是发动过分身
			["分身判定1"]= {}, --用来做死后复活
			["分身瞬动"] = {}, --让分身第一回合瞬动
			["分身上限"] = {},--O定分身上限
			["鬼如来"] = {}, --使得到此状态者被打到爆怒时入魔
			["冰心状态"] = {},--被打怒气不增加
			['怯战状态'] = {},--至下一次行动前不增加战意
			["重度内伤"] = {},--内伤带来的减速增加、加力护体效果转为负面、被攻击时若有内伤则伤害增加
			["龙爪毒"] = {},--龙爪手打出的负面状态
			['诛仙状态'] ={},--三指诛仙效果，敌方回写不能超过1/2
			['逍遥醉步'] ={},--逍遥醉步效果
			['逍遥醉步计时'] ={},
			['微醺'] ={},
			['炼铁劲'] ={},
			['氤氤氲氲'] ={},  --氤氤氲氲
			['生命恢复停止'] ={},
			['内力恢复停止'] ={},
			['断土狂雷'] ={},--行动后对周遭敌人的伤害
			['冰魄毒'] ={},--集气位置越高速度越低
			['三垣'] ={}, -- 0~30天市、31~60太微、61~90紫薇√
			['血淬'] ={},--增加兵器伤害√
			['易筋恢复'] ={},--
			['业力引爆'] ={},
			['业障缠身'] ={},
			['点穴大师1'] = {},
			['点穴大师2'] = {},
			['点穴大师3'] = {},
			['辟邪断刃'] = {},
			['辟邪破甲'] = {},
			['苍龙破'] = {},
			['天生牙'] = {},
			['狱龙破'] = {},
			['铁碎牙'] = {},
			['暴流破'] = {},
			['锁穴奇劲'] = {},
			['天问刀气'] = {},
			['玄冥透骨'] = {},
			['玄冥透骨1'] = {},
			['玄冥玄毒'] = {},
			['玄冥冥寒'] = {},
			['阴气污染'] = {},
			['阳气侵蚀'] = {},
			['圣火无中生有'] = {},
			['圣火三虚七实'] = {},
			['鬼禅六断'] = {},
			['暗香疏影'] = {},
			['八雷神'] = {},
			['灵蛇拳法'] = {},
			['龙眠毒'] = {},
			['风无形'] = {},
			['帝释天临'] = {}, --擒龙降龙
			['降龙尊相'] = {}, --擒龙降龙
			['四海龙王'] = {}, --擒龙降龙
			['荒天龙灭'] = {}, --八荒降龙
			['升龙天威'] = {}, --八荒降龙
			['荒龙爆'] = {}, --八荒降龙
			['疯魔'] = {}, --八荒降龙
			['噬魂'] = {}, --八荒降龙
			['战神状态'] = {},
			['刚柔混劲'] = {},
			['黯然销魂'] = {},
			['忘情日明'] = {},
			['忘情风流'] = {},
			['忘情云翳'] = {},
			['忘情我无'] = {},
			['剑荡十方'] = {},
			['般若蓄力'] = {},
			['般若休息'] = {},
			['般若集中'] = {},
			['般若防御'] = {},
			['般若等待'] = {},
			['金刚萨'] = {},
			['照见诸法'] = {},
			['强制减伤'] = {},
			['强制增伤'] = {},
			['轮回末'] = {},
			['涅盘初'] = {},
			['罗汉血'] = {},
			['金刚力'] = {},
			['伏魔逆气'] = {},
			['玄武逆行'] = {},
			['破军'] = {},
			['强人锁男'] = {},--强人锁男
			['魔之甲'] = {},
			['周公剑意'] = {},
			['感电状态'] = {},
			['寒冰魄'] = {},
			['烈火核'] = {},
			['食心蛊'] = {},
			['缚身蛇'] = {},
			['御雷阵'] = {},
			['惊雷咒'] = {},
			['苦难达摩'] = {},--储存伤害
			['鲸龟沉眠'] = {},
			['七剑合一'] = {},
			['辟鸿蒙'] = {},
			['遮影'] = {},--夜雨楼如影随形特效
			['影随'] = {},--夜雨楼如影随形特效
			['雪遁'] = {},--踏雪无痕特效
			['雪夜追猎'] = {},
			['云龙三折'] = {},
			['潜影突袭'] = {},
			['夜雨反击'] = {},
			['夜雨绵延'] = {},
			['龙啸九天'] = {},
			['唯识剑意1'] = {},
			['唯识剑意2'] = {},
			['唯识剑意3'] = {},
			['柳如絮'] = {},
			['先天真气1'] = {},
			['先天真气2'] = {},
			['先天真气3'] = {},
			['透骨针1'] = {},
			['透骨针2'] = {},
			['透骨针3'] = {},
			['黑血毒'] = {},
			['枪神诀1'] = {},
			['枪神诀2'] = {},
			['枪神诀3'] = {},
			['九阴摄魂'] = {},
			['青霜辟邪'] = {},
			['九阴伏魔1'] = {},
			['九阴伏魔2'] = {},
			['九阴伏魔3'] = {},
			['山河破'] = {},
			['东方浩然'] = {},
			['龙跨千山'] = {},
			['虎啸神州'] = {},
			['剑气长江'] = {},
			['剑傲中华'] = {},
			['剑气留形'] = {},
			['青牛'] = {},
			['子午'] = {},
			['黄帝'] = {},
			['千金'] = {},
			['华佗'] = {},
			--时序流失
			['生命流失'] = {},
			['内力流失'] = {},
			['体力流失'] = {},
			--暴怒--------------------------------------------------------------
			['玩家暴怒'] = {},
			['电脑暴怒'] = {},
			--个人专属特效（请放在这里注明禁止泛用）-----------------------------
			['雪羽战神'] = {},   --宗主专属
			["龙女天罗"] = {},--龙女主运天罗八格内敌方不闪避
			['毗婆舍那'] = {}, --达摩
			['独孤求败'] = {}, --独孤
			['无我之境'] = {}, --独孤
			['复活・一灯'] = {},
			['复活・天佛'] = {},
			['复活・王重阳'] = {},
			['复活・长生'] = {},
			['复活・神照'] = {},
			['复活・天意'] = {},
			['复活・阿九'] = {},
			['复活・戚长发'] = {},
			['天关阵4'] = {}, --天关
			['天绝剑气'] = {},
			['万剑归宗'] = {},
			['南凤朱雀'] = {},
			['残火太刀'] = {},
			['死葬发动'] = {},
			['死葬者'] = {},
			['残日狱衣'] = {},
			['花天'] ={}, -- √
			['初芽'] ={}, -- √
			['含苞'] ={}, -- √
			['绽放'] ={}, -- √
			['凋零'] ={}, -- √
			['喵姐观战'] = {},
			['虚邪剑来'] = {},
			['虚邪剑域'] = {},
			['虚邪夜玄'] = {},
			['虚邪极日1'] = {},
			['虚邪极日2'] = {},
			['虚邪蚀月1'] = {},
			['虚邪蚀月2'] = {},
			['虚邪止水'] = {},
			['虚邪散魂1'] = {},
			['虚邪散魂2'] = {},
			['虚邪断空'] = {},
			['虚邪乱魄1'] = {},
			['虚邪乱魄2'] = {},
			['虚邪断时'] = {},
			['虚邪不染尘'] = {},
			['点点暴走'] = {},
			['点点诡计'] = {},
			['点点咳嗽'] = {},
			['圣火阵法'] = {}, 
			['九命猫'] = {},
			['遮蔽'] = {},
			['颠倒的世界'] = {},
			['颠倒的世界CD'] = {},
			['南子燎原枪'] = {},
			['燎原枪1'] = {},
			['燎原枪2'] = {},
			['燎原枪4'] = {},
			['路人无明'] = {},
			['南子脏焰'] = {},
			['仙息护体'] = {},
			['九霄剑气1'] = {},
			['九霄剑气2'] = {},
			['幽冥血河1'] = {},--血魔
			['幽冥血河2'] = {},--血魔
			--奇穴-----------------------------------------------------------------------
			['涤瑕次数'] = {},
			['涤瑕格挡'] = {},
			['九龙天'] = {},
			['鬼龙袭'] = {},
			--门派-----------------------------------------------------------------------
			['醉八仙'] = {},--醉八仙
			['锁喉1'] = {},--锁喉
			['锁喉'] = {},--锁喉
			['毒击'] = {},
			['三笑逍遥散'] = {},--三笑逍遥散
			['绿火星毒'] = {},
			['星宿奇毒'] = {},
			['连环腐尸毒'] = {},		
			['天道印记'] = {},
			['纯阳蓄力'] = {},	
			['武当纯阳'] = {},
			['无极剑环'] = {},
			['以静制动1'] = {},--以静制动1
			['以静制动2'] = {},--以静制动2
			['以静制动3'] = {},--以静制动3金刚不坏
			['不漏琉璃'] = {},--金刚不坏
			['金刚不坏'] = {},--金刚不坏
			['金刚手'] = {}, 
			['罗汉果位'] = {},
			['罗汉刀奇'] = {},
			['金刚指断肢'] = {},
			['金刚指绝脉'] = {},
			['三入地狱'] = {},
			['斗战胜佛'] = {},
			['血魔'] = {},--血魔
			['换血'] = {},--换血 
			['凝血纹印'] = {},
			['血色诅咒'] = {},
			['血海飘香'] = {},
			['逍遥无相'] = {},
			['逍遥八荒'] = {},
			['逍遥长春'] = {},
			['逍遥北冥'] = {},
			['白驼蛇蛊'] = {},
			['逆转经脉'] = {},
			['凝毒化血'] = {},
			['万毒归元'] = {},--万毒归元
			['九花玉露'] = {},--九花玉露		
			['碧海幻境'] = {},--九花玉露		
			['光明圣火'] = {},
			['秘孔战术'] = {},--秘孔战术		
			['回魂仙梦'] = {},--回魂仙梦
			['封印'] = {},--封印
			['神教逆杀'] = {},--神教逆杀
			['日月吸星'] = {},
			['三尸脑神丹'] = {},
			['昆仑门派指令1'] = {},--昆仑门派指令
			['昆仑门派指令2'] = {},--昆仑门派指令
			['顺逆两仪1'] = {},--昆仑刀剑阵
			['顺逆两仪2'] = {},--昆仑刀剑阵
			['顺逆两仪3'] = {},--昆仑刀剑阵
			['顺逆两仪4'] = {},--昆仑刀剑阵
			['风雷惊蛰1'] = {},--昆仑刀剑阵
			['风雷惊蛰2'] = {},--昆仑刀剑阵
			['风雷惊蛰3'] = {},--昆仑刀剑阵
			['风雷惊蛰4'] = {},--昆仑刀剑阵
			['霜炎九重1'] = {},--昆仑刀剑阵
			['霜炎九重2'] = {},--昆仑刀剑阵
			['天剑绝刀1'] = {},--昆仑刀剑阵
			['天剑绝刀2'] = {},--昆仑刀剑阵
			['两倍攻击'] = {},--两倍攻击
			['明教指令1'] = {},--明教指令1
			['明教指令2'] = {},--明教指令1
			['明教指令3'] = {},--明教指令1
			['明教指令4'] = {},--明教指令1
			['明尊白莲'] = {},--明教指令1
			['明尊逆转'] = {},--乾坤组合
			['伤害储存'] = {},--伤害储存
			['伤害储存1'] = {},--伤害储存1，特殊用途
			["转龙呼吸"] = {},--大理转龙
			["易水寒诀"] = {},--易水寒诀
			["雪羽冰封"] = {},--冰封突破上限
			['霜之哀伤'] = {},   --雪羽门派专属，不要拿去别的地方用
			['真利刃寒锋'] = {}, --雪羽门派专属，不要拿去别的地方用
			['易水四寒'] = {},   --雪羽门派专属，不要拿去别的地方用
			['易水四寒1'] = {},  --雪羽门派专属，不要拿去别的地方用
			['易水四寒2'] = {},  --雪羽门派专属，不要拿去别的地方用
			['易水四寒3'] = {},  --雪羽门派专属，不要拿去别的地方用
			['冰覆双极'] = {},   --雪羽门派专属，不要拿去别的地方用
			["山珍海味"] = {},
			["深入骨髓"] = {},
			["八门金锁1"] = {},
			["八门金锁2"] = {},
			["八门金锁3"] = {},
			["八门金锁4"] = {},
			["一阳指劲"] = {},
			["六脉剑指"] = {},
			['天南易阳'] = {},
			["峨眉临济"] = {},
			["峨眉士气"] = {},
			["七伤拳阴"] = {},
			["七伤拳阳"] = {},
			["七伤拳木"] = {},
			["七伤拳火"] = {},
			["七伤拳土"] = {},
			["阴阳双劲"] = {},
			["阴阳双极"] = {},
			["阳神降世"] = {},
			["阴圣再临"] = {},
			["摧肝肠"] = {},
			["伤肺决"] = {},
			["意恍惚"] = {},
			['天地之心'] = {},
			['龙风1'] = {},
			['龙风'] = {},
			['鹤云'] = {},
			['大小幽明'] = {},
			['四智妙法'] = {},
			['大圆镜智'] = {},
			['断命四绝句'] = {},
			['无明夜'] = {},
			['无始无明'] = {},
			['夜雨涨秋池'] = {},
			['断命四绝句1'] = {},
			['血衣剑法'] = {},
			['血衣剑法1'] = {},
			['血衣剑法5'] = {},
			['无常索命诀'] =  {},
			['无常索命诀4'] =  {},
			['无常索命诀5'] =  {},
			['见破武学'] = {},
			['见破累计'] = {},
			['满江红'] = {}, 
			['续战'] = {}, 
			['威慑'] = {}, 
			['血袍艳花'] = {},
			['枯血泣魂'] = {},
			['极乐血海'] = {},
			['魂无常'] = {}, 
			['命无常'] = {}, 
			['极阴无相1'] = {},
			['极阴无相2'] = {},
			['极阴无相3'] = {},
			['极阴无相4'] = {},
			['极阴无相5'] = {},
			['极阴无相6'] = {},
			['降龙逆光掌1'] = {},
			['降龙逆光掌2'] = {},
			['真左右互搏'] = {},
			['刀剑不转'] = {}, --纯粹为了使胡刀苗剑互相带出的效果不影响阴阳倒乱的洋刀因任特效顺序触发
			['护龙剑法'] = {},
			['护龙空手'] = {},
			['护龙特殊'] = {},
			['护龙军师'] = {},
			['后土阵'] = {}, --护龙军师大阵
			['黄金阵'] = {}, --护龙军师大阵
			['灌木阵'] = {}, --护龙军师大阵
			['烈火阵'] = {}, --护龙军师大阵
			['烈诅咒'] = {}, --护龙军师大阵
			['驱水阵'] = {}, --护龙军师大阵
			['全屏攻击'] = {},
			['极意攻击'] = {},
			['云梦涧1'] = {},
			['云梦涧2'] = {},
			['云梦涧4'] = {},
			['兽血沸腾'] = {},--兽王庄
			['虎辟'] = {},
			['五毒教1'] = {},
			['兽王蛇毒'] = {},
			['兽王创伤'] = {},
			['兽王负面'] = {},
			['兽王恢复'] = {},
    }
	WAR.YDBS = 0
	WAR.LBPM = 0
	WAR.SYWGZ = 0
	WAR.XXQF = {}
	WAR.XXQG = {}
	WAR.WYJF = 0
	WAR.WYJF1 = 0
	WAR.WYLW1 = 0
	WAR.WYLW2 = 0
	WAR.WYLW3 = 0
	WAR.WYLW4 = 0
	WAR.WYLW5 = 0
	WAR.HZHQ = 0
	WAR.YSSH = 0
	WAR.YSSH1 = 0
	WAR.YSSH2 = 0
	WAR.YSSH3 = 0
	WAR.YSSH4 = 0
	
	
	
	
	--正面BUF，2表示可以自身使用，1表示即使偷取了BUF自己也没有效果格挡天罗
	WAR.Buf = {{'六阳正气',2},{'黄连解毒',2},{'牛黄血蝎',2},{'小还丹',2},{'天香续命',2},{'白云熊胆',2},
				{'即墨老酒',2},{'玉露酒',2},{'梨花酒',2},{'五宝花蜜酒',2},{'诸法无我',2},{'皆',1},{'前',1},{'在',1},{'阵',1},
				{'列',1},{'者',1},{'斗',1},{'兵',1},{'临',1},{'西瓜刀・天人',2},{'西瓜刀・残刀',2},
				{'太极蓄力',1},{'蛤蟆蓄力',1},{'鲸息蓄力',1},{'疾如风',2},{'长生诀',2},{'凌波微步闪避',2},{'流云逐月闪避',2},{'七星阵步闪避',2},{'逍遥御风闪避',2},{'闪避',1}--{'先天护盾',1},护盾无法偷取
				}

	--正面BUF，2表示可以自身使用，1表示即使偷取了BUF自己也没有效果			
	WAR.Buf2 = {{'TJZX',1},{'HZD_QF',1},{'SLSX',2},{'YSJF',2},{'WTL_LDJT',2},{'ZTHF',2},{'QGZT',2},
				{'SSESS',1},{'JGFX',1},{'XLFD',1},{'JTYJ',2},{'Focus',1},{'TSSB',2},{'CSHF',2},{'XYYF',1},
				{'JFJQ',2},{'BTZT',2},{'WAR.XZBFZT',2},
				}
	
	
	--特级时序异常（各种奇特buff，所有清除）
	WAR.Debuf = {
		{'无招胜有招',1},{'蛇行狸翻',1},{'玄武逆行',1},{'回魂仙梦',1},
		{'禁疗',1},{'魔岭玫瑰',1},{'忘情风流',1},{'刺目',1},
		{"霸王破甲",1},{'机率下降',1},{'力竭',1},
		{'阴气污染',1},{'阳气侵蚀',1},
		{'精神错乱',1},{'气阻中门',1},{'南子脏焰',1},{"疯魔",1},{'冰心状态',1},
		{'天绝剑气',1},{'万剑归宗',1},{'枪神诀1',1},{'枪神诀2',1},
	}
	--特技回合异常（各种奇特buff，所有清除）
	WAR.Debuf1 = {
	    {'头晕目眩',1},{'辰宿列张',1},{'忘情日明',1},
		{'毒击',1},{'怒气负面效果2',1},{'昏迷状态',1},{'燎原枪2',1},
	}
	--高级时序异常（集狻p血橹鳎高级清除）
	WAR.Debuf2 = {
	    {'走火入魔',1},{'灵蛇拳',1},{'伏魔逆气',1},
		{'生命恢复停止',1},{'神教逆杀',1},{'无明业火',1}, 
		{'业力引爆',1},{'忘情云翳',1},{'邪魅苍生',1},{'神经蛇毒',1},{'重度内伤',1},
		{'封印',1},{'黯然销魂',1},{'唯识剑意2',1},{'南凤朱雀',1},
	}
	--高级回合异常，高级清除
	WAR.Debuf3 = {
	    {'混乱状态',1},{'魅惑状态',1},{'内力恢复停止',1},
		{'洞火',1},{'怒气负面效果1',1},{'放下屠刀',1},
		{'基础蛊毒',1},{'九阳反震',1},{'冰魄毒',1},
	}
	--低级时序异常（影攻防橹鳎低级清除）
	WAR.Debuf4 = {
		{'利刃寒锋',1},
		{'冰冻状态',1},{'迟缓状态',1},{'散功状态',1},{'虚弱状态',1},
		{'冰冻扣血',1},{'举火燎原',1},{'创伤',1},
	}
	--低级回合异常（影攻防橹鳎低级清除）
	WAR.Debuf5 = {
	    {'脆弱状态',1},{'锁足状态',1},{'参合状态',1},{'金刚咒',1},
	}
	--门派高级时序异常（所有清除可以加速清除）
	WAR.Debuf6 = {
	    {'绿火星毒',1},{'连环腐尸毒',1}, --星宿
		{'逍遥无相',1},{'逍遥八荒',1},{'逍遥长春',1},{'逍遥北冥',1},  --逍遥派
		{'白驼蛇蛊',1},   --白驼山
		{'先天真气2',1},               --全真
	    {'深入骨髓',1},{'龙啸九天',1},         --中华阁
		{'枯血泣魂',1},{'命无常',1},        --夜雨楼
	    {'六脉剑指',1},{'天南易阳',1}, --大理
		{'八门金锁4',1}, --桃花
	    {'峨眉临济',1},  --峨眉
	    {'七伤拳火',1},{'伤肺决',1},  --崆峒
		{'真利刃寒锋',1},   --雪羽宗
		{'云梦涧2',1}, {'云梦涧4',1},           --云梦涧
		{'护龙军师',1},{'护龙特殊',1},{'护龙空手',1},            --护龙         
	}
	--门派高级回合异常（所有清除可以加速清除）
	WAR.Debuf7 = {
	    {'怯战状态',1},{'金刚指绝脉',1},    --少林
	    {'花涧如雾',1},    --花涧派
	    {'龙眠毒',1},   --白驼山
		{'摧肝肠',1},  --崆峒
	    {'极阴无相1',1},{'极阴无相5',1},  --夜雨楼
		{'大小幽明',1},  --峨眉
	}
	--门派中级时序异常（高级清除可以加速清除）
	WAR.Debuf8 = {
	    {'星宿奇毒',1},                                                                       --星宿
		{'日月吸星',1}, {'扫荡群魔',1},              --日月
		{'阴阳双劲',1},{'七伤拳木',1},{'意恍惚',1},  --崆峒
		{'一阳指劲',1},  --大理
		{'光明圣火',1},   --明教
	}
	--门派低级时序异常（中级清除可以加速清除）
	WAR.Debuf9 = {
		{'云梦涧1',1},   --云梦涧
		{'八门金锁1',1},{'八门金锁3',1}, --桃花
		{'七伤拳阳',1},{'七伤拳土',1},{'七伤拳阴',1},    --崆峒
	}
	--中级时序异常（中级清除可以加速清除）
	WAR.Debuf10 = {
	    {'集气倒退',1},
		{'辟邪断刃',1},{'辟邪破甲',1},{'枪神诀3',1},
		{'岳家枪诀',1},{'忘情我无',1},{'西域奇毒',1},{'出血蛇毒',1},
		{'倚天屠龙',1},{'白蟒鞭法',1},{'刚柔混劲',1},{'玄冥透骨',1},{'玄冥透骨1',1},
	}
	--中级回合异常（中级清除可以加速清除）
	WAR.Debuf11 = {
	    {'恐惧状态',1},{'同归状态',1},{'麻痹状态',1},{'破甲蛇毒',1},{'盲目状态',1},
	}
	--陷阱
	WAR.Debuf15 = {
	    {'残劲袭魄',1},{'败血破命',1},{'火毒攻心',1},{'寒毒入体',1},{'五蕴炽盛',1},{'封气绝脉',1},
	}
	--毒布武林 标记修改
	WAR.Debuf18 = {
		{'散功状态',1},{'扫荡群魔',1},{'机率下降',1},{"创伤",1},{'破军',1},{'西域奇毒',1},{'龙眠毒',1},
		{'出血蛇毒',1},{'破甲蛇毒',1},{'冰魄毒',1},{'精神错乱',1},{'神经蛇毒',1},{'中毒不解',1},{'毒击',1},
	}
	--集气停止效果
	--"沉睡状态""无招胜有招""十方无敌"'真利刃寒锋'"利刃寒锋""走火入魔"'锁喉''锁喉1''以静制动1'
	WAR.Debuf19 = {
		{'走火入魔',1},{"无招胜有招",1},{"十方无敌",1},{'真利刃寒锋',1},{"利刃寒锋",1},
		{'锁喉',1},{'锁喉1',1},
	}
	-----部分不列入解除的debuf写在这里备忘：例如点穴大师、天问刀气、 暗香
	WAR.Debuf99 = {
	{'受想行识',1},{'荒天龙灭',1},{'罗汉血',1},{'荒龙爆',1},{'度化状态',1},
	{'黯然・呆若木鸡',1},{'点穴大师1',1},{'点穴大师2',1},{'点穴大师3',1},{'业障缠身',1},
	{'天问刀气',1},{'LWZN',1},{'LXQJ',1},{'HYDJ',1},{'HYDQ',1}, {'生死符',1},{'狱龙破',1},{'武当纯阳',1},
	{'BYCX',1},{'YHDF',1},{'琴音状态',1},{'龙爪毒',1},{'沉睡状态',1},{'JYZT',1},{'降龙虚劲',1},
	{'金蛇幻毒',1},{'诛仙状态',1},{'破军',1},{'雪羽冰封',1},{'极乐血海',1},
	{'中毒不解',1},{'伤重不治',1},{'焚炎不尽',1},{'玄冰不化',1},{'血流不止',1},
	}
	WAR.TGCD = {[348] = 10,
	}
	WAR.CD = 0  --天关的CD
	
    WAR.BLCC_1 = {}		

	WAR.TXXS = {} 		--特效点数显示

	WAR.tmp = {}		-- 100：基础   200：蛤蟆功蓄力，1000：欧阳锋逆运走火，1500：鲸息功蓄力，2000：太极拳蓄力，3000：神照复活，4000：太虚剑意蓄力，5000：头像编号
	WAR.Actup = {}		--蓄力记录
	WAR.Defup = {}		--防御记录
	WAR.Wait = {}		--等待记录
	WAR.Focus = {}		--集中记录
	WAR.HMGXL = {}		--蛤蟆蓄力增加300集气
	WAR.Weakspot = {}	--破绽计数
	WAR.LQZ = {}		--怒气值
	WAR.FXDS = {}		--封穴点数
	WAR.FXXS = {}		--封穴显示
	WAR.LXZT = {}		--流血点数
	WAR.LXXS = {}		--流血显示
	WAR.BFXS = {}		--冰封显示
	WAR.ZSXS = {}		--灼烧显示
	WAR.SZJPYX = {}		--已经提供过实战的人记录（被打死的）
	WAR.DXMX = {}		--大须弥相
	WAR.TZ_DY = 0		--段誉指令
	WAR.TZ_XZ = 0		--虚竹指令
	WAR.TXZQ = {}		--太玄之轻
	WAR.DZZ = {}		--三十二身相 大自在相
	WAR.FGPZ = {}		--		
	WAR.JJJ = {}		--将进酒
	WAR.JQSDXS = {} 	--无酒不欢：集气速度显示
	WAR.WXFS = nil		--李秋水无相分身的编号记录
	WAR.JJPZ = {} 		--无酒不欢：九剑破招
	WAR.TKJQ = {}		--太空卸劲减少集气
	WAR.TKJQ1 = {}  	--真互搏用的太空卸劲记录
	WAR.BHJQ = {}		--碧海惊涛掌招式4减少集气	
	WAR.TJZX = {}		--太极之形记录
	WAR.WFCZ = 0		--万佛朝宗 标记修改
	WAR.TXSH = {}		--天仙锁魂
	WAR.BXAY = {}		--辟邪剑意
	WAR.HZD_QF = {}		--曲风记录
	WAR.ZXXS = {}		--紫霞蓄力
	WAR.GMYS = 0		--范遥挨打加减伤
	WAR.GMZS = {}		--被杨逍打中的人记录
	WAR.JXCSPD = 0	
	WAR.JYFX = {}		--九阳7时序解除封穴
	WAR.YSHJ = {}		--易水寒决图穷匕见	
	WAR.QYBY = {}		--林朝英轻云蔽月，每50时序可触发一次，免疫伤害10时序
	WAR.JBMY = {}       --剑步谜影
	WAR.MHBF = {}       --梅花步法
	WAR.HLJG = {}       --护龙山庄金刚不坏
	WAR.CFDH = {}       --乘风蹈海
	WAR.TMYJ = 0
	WAR.TMYJ1 = 0
	WAR.MXSX1 = 0       --魔心四相
	WAR.MXSX2 = 0
	WAR.MXSX3 = 0
	WAR.MXSX4 = 0
	WAR.JSLZ = 0--九死龙爪
	WAR.SZZX = 0--三指诛仙
	WAR.JGZT = 0--金刚周天组合
	WAR.GBZY = 0--丐帮战意
	WAR.GBJY = 0--丐帮净衣
	WAR.GBJY1 = 0--丐帮净衣大招
	WAR.LTS = 0 --铁掌组合炼铁手
	WAR.YSCM1 = 0 --易水沧溟刀
	WAR.YSCM2 = 0 --易水沧溟刀
	WAR.YSCM3 = 0 --易水沧溟刀
	WAR.XZ_YB = {}		--小昭影步记录
	WAR.HP_Bonus_Count = {}	--记录血量翻倍的编号
	WAR.L_EffectColor = {}					--异常状态的颜色显示
	WAR.L_EffectColor[1] = M_Silver;		--显示减少生命
	WAR.L_EffectColor[2] = M_Pink;			--显示增加生命
	WAR.L_EffectColor[3] = M_LightBlue;		--显示解毒
	WAR.L_EffectColor[4] = M_DeepSkyBlue;	--显示内力减少和增加
	WAR.L_EffectColor[5] = M_PaleGreen;		--显示体力减少和增加
	WAR.L_EffectColor[6] = C_GOLD;			--显示封穴
	WAR.L_EffectColor[7] = M_Red;			--显示流血
	WAR.L_EffectColor[8] = LightGreen;		--显示中毒
	WAR.L_EffectColor[9] = PinkRed;			--显示内伤减少和增加
	WAR.L_EffectColor[10] = LightSkyBlue;	--显示冰封
	WAR.L_EffectColor[11] = C_ORANGE;		--显示灼烧
	WAR.L_EffectColor[12] = M_Red;			--显示灼烧
	WAR.L_HQNZL = {};		--胡青牛指令，持续回血回内伤 
	WAR.L_QKDNY = {};		--设定攻击多个人时，乾坤只能被反一次
	WAR.XDLZ = {};			--记录被血刀老祖杀掉的人
	WAR.ShowHP = 1			--血条显示
	WAR.WZ = {}             --记录文字
    WAR.WZ1 = {}            --记录文字
	WAR.ZQHT = 0 			--是否触发真气护体
	WAR.CSHF = {}			--长生回复 
	WAR.BTZT = {}			--霸体状态	
	WAR.JDYJ = {}			--剑胆琴心增加御剑能力
	WAR.YWDJ = {}           --一苇渡江增加轻功能力
	WAR.GXZT = {}           --龟息周天增加防御能力
	WAR.BLJC1 = {}          --碧落九重剑・加重岩
	WAR.SLSX = {}			--金轮，十龙十象
	WAR.HQT_ZL= {}           --霍青桐指令
	WAR.HQT_CD= 0           --霍青桐指令
	WAR.JYZT = {}			--阿紫，禁药状态
	WAR.QGZT = {}			--倾国状态
	WAR.PJJL = {} 
	WAR.PJJL1 = {} 
	WAR.Adapt = {}
	for i = 0, 765 do--角色总数
	    WAR.Adapt[i] = {}
	end
	WAR.YSJF = {}			--玉石俱焚
	WAR.XLFD = {}			--小李飞刀
    WAR.JTYJ = {}			--惊天一剑

    WAR.JFJQ = {}			--疾风状态清0	
	WAR.ZYCD = 0
	WAR.XZBFZT = {}			    --血战八方ZT
    WAR.WTL_PJTL= {}	
    WAR.WTL_1= {}	
	WAR.JSZT1 ={}          --丘处机计时状态已方
	
	WAR.JSZT2 ={}          --通用计时状态敌方	
	
	
	WAR.BiXieZhaoShi = {}        --辟邪招式	
	WAR.BXLQ = {}				--辟邪冷却记录
	WAR.BXCD = {0,2,3,3,4,5}	--辟邪冷却时间
	WAR.BXCD1 = {0,1,2,2,3,4}	--辟邪冷却时间
	WAR.LMCD = {0,1,2,3,3,5} 
	WAR.LMLQ = {}
	WAR.JYLQ = {}				--九阳冷却记录	
	WAR.JYCD = {0,1,5}	       --九阳九阳冷却时间
	WAR.JIUYANGZhaoShi = {}     --九阳招式	
	

	WAR.SSESS = {}			--三十二身相
	WAR.JGFX = {}			--陆渐金刚法相	

	WAR.XYYF = {}			--逍遥御风
	WAR.XYYF_10 = 0			--本回合逍遥御风累积至9点
	WAR.YFCS = 0			--逍遥御风次数
	WAR.QMWZ = 0			--奇门五转

	WAR.ZQTL = {}			--紫气天罗

	WAR.Miss = {}			--闪避的miss显示
    WAR.WTL_LDJT = {} 
	WAR.ZTHF = {}	
    WAR.ZHHF = {}					
	WAR.FHJZ = 0 			--张家辉的复活戒指
    WAR.FUHUOZT={}	
	WAR.YSJZ = 0 			--张家辉的隐身戒指
	WAR.FW = {}
    WAR.Atid = -1
	CleanWarMap(7, 0)
end


--显示人物的战斗信息，包括头像，生命，内力等
function WarShowHead(id)
	if not id then
		id = WAR.CurID
	end
	if id < 0 then
		return 
	end
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local pid = WAR.Person[id]["人物编号"]
	local p = JY.Person[pid]
	local h = CC.FontSMALL
	local width = CC.FontSMALL*11 - 6
	local height = (CC.FontSMALL+CC.RowPixel)*9 - 12
	local x1, y1 = nil, nil
	local i = 1
	local size = CC.FontSmall3

	if WAR.Person[id]["我方"] == true then
		x1 = CC.ScreenW - width - 6
		y1 = CC.ScreenH - height - CC.ScreenH/6 -6
		lib.LoadPNG(91, 28 * 2 ,x1, y1+height+CC.ScreenH/30-309, 1)
		lib.LoadPNG(91, 62 * 2 ,x1, y1+height+CC.ScreenH/30-309, 1)
	end
	if WAR.Person[id]["我方"] == false then		
        x1 = 10
        y1 = 95
	    lib.LoadPNG(91, 28 * 2 ,x1,by*20, 1)
	    lib.LoadPNG(91, 62 * 2 ,x1,by*20, 1)		
	end
	local headw, headh = lib.GetPNGXY(1, p["半身像"])
	local headx = (width - headw) / 2
	local heady = (CC.ScreenH/5 - headh) / 2
	--头像信息
	local headid = JY.Person[pid]["半身像"]
	if WAR.Person[id]["我方"] then
      lib.LoadPNG(1, headid*2, CC.ScreenW/1360*849+bx*415,CC.ScreenH/768*421+by*60-56, 2)
	else
      lib.LoadPNG(1, headid*2, CC.ScreenW/1360*99+10,CC.ScreenH/768*73+by*20, 2)
	end		 
	---------------------------------------------------------状态显示---------------------------------------------------------
	
		local zt_num = 0
		if WAR.ZDDH == 348 then 
			local ss = {[5] = '徐如林',[27] = '疾如风',[50] = '侵如火',[114] = '守如山'}
			if WAR.PD["天关阵4"][pid] ~= nil then 
				local sm = ss[WAR.PD["天关阵4"][pid]]
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 101 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len(sm)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, sm, C_GOLD, size)				
				else
					lib.LoadPNG(98, 101 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, sm, C_WHITE, size)
				end
				zt_num = zt_num + 1
			end
		end
		--入魔	
		if  WAR.PD["入魔"][pid] ~= nil and WAR.PD["入魔"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 138 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("入魔")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "入魔", C_GOLD, size)				
			else
				lib.LoadPNG(98, 138 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "入魔", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		if WAR.L_NYZH[pid] ~= nil and WAR.L_NYZH[pid] == 2 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 138 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("逆运暴走")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "逆运暴走", C_GOLD, size)				
			else
				lib.LoadPNG(98, 138 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "逆运暴走", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--六阳正气	
		if   WAR.PD["六阳正气"][pid] ~= nil and WAR.PD["六阳正气"][pid] > 0 then
			local tjzx = WAR.PD["六阳正气"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 136 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("六阳正气:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "六阳正气:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 136 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "六阳正气:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		--暴走状态2298
		if WAR.PD["暴走状态"][pid] ~= nil and WAR.PD["暴走状态"][pid] > 0  then
			local tjzx = WAR.PD["暴走状态"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 75 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("暴走:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "暴走:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 75 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "暴走:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--怒气负面效果1
		if WAR.PD["怒气负面效果1"][pid] ~= nil and WAR.PD["怒气负面效果1"][pid] > 0  then
			local tjzx = WAR.PD["怒气负面效果1"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 75 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("怒气负面效果1:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "怒气负面效果1:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 75 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "怒气负面效果1:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--怒气负面效果2
		if WAR.PD["怒气负面效果2"][pid] ~= nil and WAR.PD["怒气负面效果2"][pid] > 0  then
			local tjzx = WAR.PD["怒气负面效果2"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 75 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("怒气负面效果2:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "怒气负面效果2:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 75 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "怒气负面效果2:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--牛黄血蝎丹	
		if   WAR.PD["牛黄血蝎"][pid] ~= nil and WAR.PD["牛黄血蝎"][pid] > 0 then
			local tjzx = WAR.PD["牛黄血蝎"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 136 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("牛黄血蝎:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "牛黄血蝎:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 136 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "牛黄血蝎:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		
		--黄莲解毒丸	
		if   WAR.PD["黄连解毒"][pid] ~= nil and WAR.PD["黄连解毒"][pid] > 0 then
			local tjzx = WAR.PD["黄连解毒"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 136 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("黄连解毒:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "黄连解毒:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 136 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "黄连解毒:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
		--小还丹	
		if   WAR.PD["小还丹"][pid] ~= nil and WAR.PD["小还丹"][pid] > 0 then
			local tjzx = WAR.PD["小还丹"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 136 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("小还丹:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "小还丹:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 136 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "小还丹:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
		--天香续命膏	
		if   WAR.PD["天香续命"][pid] ~= nil and WAR.PD["天香续命"][pid] > 0 then
			local tjzx = WAR.PD["天香续命"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 136 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("天香续命:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "天香续命:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 136 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "天香续命:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
		
		--白云熊胆	
		if   WAR.PD["白云熊胆"][pid] ~= nil and WAR.PD["白云熊胆"][pid] > 0 then
			local tjzx = WAR.PD["白云熊胆"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 136 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("白云熊胆:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "白云熊胆:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 136 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "白云熊胆:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		--五宝花蜜酒	
		if   WAR.PD["五宝花蜜酒"][pid] ~= nil and WAR.PD["五宝花蜜酒"][pid] > 0 then
			local tjzx = WAR.PD["五宝花蜜酒"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 137 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("五宝花蜜酒:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "五宝花蜜酒:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 137 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)		
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "五宝花蜜酒:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		--即墨老酒	
		if   WAR.PD["即墨老酒"][pid] ~= nil and WAR.PD["即墨老酒"][pid] > 0 then
			local tjzx = WAR.PD["即墨老酒"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 137 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("即墨老酒:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "即墨老酒:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 137 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)		
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "即墨老酒:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
		--玉露酒	
		if   WAR.PD["玉露酒"][pid] ~= nil and WAR.PD["玉露酒"][pid] > 0 then
			local tjzx = WAR.PD["玉露酒"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 137 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("玉露酒:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "玉露酒:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 137 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "玉露酒:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		--梨花酒	
		if  WAR.PD["梨花酒"][pid] ~= nil and WAR.PD["梨花酒"][pid] > 0 then
			local tjzx = WAR.PD["梨花酒"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 137 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("梨花酒:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "梨花酒:"..tjzx, C_GOLD, size)				
			else
				lib.LoadPNG(98, 137 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)	
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "梨花酒:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end			
		--诸法无我	
		if   WAR.PD["诸法无我"][pid] ~= nil and WAR.PD["诸法无我"][pid] > 0 then
			local tjzx = WAR.PD["诸法无我"][pid] or 0

			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 98 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("诸法无我:"..tjzx.."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "诸法无我:"..tjzx.."层", C_GOLD, size)				
			else
				lib.LoadPNG(98, 98 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "诸法无我:"..tjzx.."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
			--皆
		if WAR.PD["皆"][pid] ~= nil and WAR.PD["皆"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 134 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("皆-智拳印:必击中破绽")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "皆-智拳印:必击中破绽", C_GOLD, size)
			else
				lib.LoadPNG(98, 134 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "皆-智拳印:必击中破绽", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end			
			--前
		if WAR.PD["前"][pid] ~= nil and WAR.PD["前"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 133 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("前-宝瓶印:攻击范围扩大")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "前-宝瓶印:攻击范围扩大", C_GOLD, size)
			else
				lib.LoadPNG(98, 133 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "前-宝瓶印:攻击范围扩大", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
			--在
		if WAR.PD["在"][pid] ~= nil and WAR.PD["在"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 132 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("在-日轮印:攻击必灼烧")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "在-日轮印:攻击必灼烧", C_GOLD, size)
			else
				lib.LoadPNG(98, 132 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "在-日轮印:攻击必灼烧", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
			--阵
		if WAR.PD["阵"][pid] ~= nil and WAR.PD["阵"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 131 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("阵-内缚印:击中目标内力-200")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,  "阵-内缚印:击中目标内力-200", C_GOLD, size)
			else
				lib.LoadPNG(98, 131 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "阵-内缚印:击中目标内力-200", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
			--列
		if WAR.PD["列"][pid] ~= nil and WAR.PD["列"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 130 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("列-外缚印:击中移动-3")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "列-外缚印:击中移动-3", C_GOLD, size)
			else
				lib.LoadPNG(98, 130 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "列-外缚印:击中移动-3", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
			--者
		if WAR.PD["者"][pid] ~= nil and WAR.PD["者"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 129 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("者-内狮子印:气防提升500")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "者-内狮子印:气防提升500", C_GOLD, size)
			else
				lib.LoadPNG(98, 129 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "者-内狮子印:气防提升500", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
			--斗
		if WAR.PD["斗"][pid] ~= nil and WAR.PD["斗"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 128 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("斗-外狮子印:气攻提升500")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,  "斗-外狮子印:气攻提升500", C_GOLD, size)
			else
				lib.LoadPNG(98, 128 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "斗-外狮子印:气攻提升500", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
			--兵
		if WAR.PD["兵"][pid] ~= nil and WAR.PD["兵"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 127 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("兵-大金刚轮印:破防40%")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,  "兵-大金刚轮印:破防40%", C_GOLD, size)
			else
				lib.LoadPNG(98, 127 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "兵-大金刚轮印:破防40%", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
			--临
		if WAR.PD["临"][pid] ~= nil and WAR.PD["临"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 126 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("临-不动根本印:减伤至500点")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "临-不动根本印:减伤至500点", C_GOLD, size)
			else
				lib.LoadPNG(98, 126 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "临-不动根本印:减伤至500点", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
	    
			--天人合一
		if WAR.PD["西瓜刀・天人"][pid] ~= nil and WAR.PD["西瓜刀・天人"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 49 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				 DrawString(CC.ScreenW/1360*705+bx*380-string.len("天人合一")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "天人合一", C_GOLD, size)
			else
				lib.LoadPNG(98, 49 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "天人合一", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
	    
		--西瓜残刀
		if WAR.PD["西瓜刀・残刀"][pid] ~= nil then
	        local cs = 0
	        local sx = 0
	        if WAR.PD["西瓜刀・残刀"][pid][1] ~= nil then 
	            cs = WAR.PD["西瓜刀・残刀"][pid][1]..'层'
	        end
	        if WAR.PD["西瓜刀・残刀"][pid][2] ~= nil then 
	            sx = WAR.PD["西瓜刀・残刀"][pid][2]..'时序'
	        end
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 135 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("天残地缺:"..cs..sx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"天残地缺:"..cs..sx, C_GOLD, size)
			else
				lib.LoadPNG(98, 135 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "天残地缺:"..cs..sx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--天魔金身
		if WAR.PD['天魔金身'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 85 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("天魔金身:"..WAR.PD['天魔金身'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "天魔金身:"..WAR.PD['天魔金身'][pid].."时序", C_GOLD, size)			
			else
				lib.LoadPNG(98, 85 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "天魔金身:"..WAR.PD['天魔金身'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--止杀CD	
		if  match_ID(pid, 68) and WAR.JSZT1[pid] ~= nil then
		local tjzx = WAR.JSZT1[pid] or 0
			if tjzx == 0 then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 58 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("止杀CD:"..tjzx.."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "止杀CD:"..tjzx.."回合", C_GOLD, size)
				else
					lib.LoadPNG(98, 58 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "止杀可使用", C_WHITE, size)
				end
			else
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 57 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
					DrawString(CC.ScreenW/1360*550, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "止杀CD:"..tjzx.."回合", C_WHITE, size)
					 DrawString(CC.ScreenW/1360*705+bx*380-string.len("止杀CD:"..tjzx.."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "止杀CD:"..tjzx.."回合", C_GOLD, size)
				else
					lib.LoadPNG(98, 57 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num,"止杀可使用", C_WHITE, size)
				end
			end
			zt_num = zt_num + 1
		end	
		
		--文泰来计时CD倒计时冷确计算
		if match_ID(pid, 151) and WAR.WTL_1[pid] ~= nil then
		        local tjzx = WAR.WTL_1[pid] or 0
			    if tjzx == 0 then
					if WAR.Person[id]["我方"] == true then
						lib.LoadPNG(98, 125 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )			
						 DrawString(CC.ScreenW/1360*705+bx*380-string.len("否极泰来CD:"..tjzx.."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "否极泰来CD:"..tjzx.."时序", C_GOLD, size)
					else
						lib.LoadPNG(98, 6 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
						DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "否极泰来激活", C_WHITE, size)
					end
				else
					if WAR.Person[id]["我方"] == true then
						lib.LoadPNG(98, 125 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					  DrawString(CC.ScreenW/1360*705+bx*380-string.len("否极泰来CD:"..tjzx.."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "否极泰来CD:"..tjzx.."时序", C_GOLD, size)
					else
						lib.LoadPNG(98, 8 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
						DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num,"否极泰来CD:"..tjzx.."时序", C_WHITE, size)
					end
				end
				zt_num = zt_num + 1
		end	
	    --否极泰来
		if WAR.WTL_PJTL[pid] ~= nil then
			local tjzx = WAR.TJZX[pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 159 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("否极泰来:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "否极泰来:"..tjzx, C_GOLD, size)
			else
				lib.LoadPNG(98, 159 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "否极泰来:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--万佛朝宗显示
			if match_ID(pid, 577) then
			local tjzx = WAR.WFCZ or 0	--标记修改
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 25 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("万佛朝宗:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "万佛朝宗:"..tjzx, C_GOLD, size)	
			else
				lib.LoadPNG(98, 25 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "万佛朝宗:"..tjzx, C_GOLD , size)
			end
			zt_num = zt_num + 1
		end	
		
		--辟邪剑意显示WAR.BXJQ
			if match_ID(pid, 457) and CC.TX["笑傲邪线"] > 0 then
			local tjzx = WAR.BXAY[pid] or 0	--标记修改
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 96 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("辟邪剑意:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "辟邪剑意:"..tjzx, C_GOLD, size)	
			else
				lib.LoadPNG(98, 96 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "辟邪剑意:"..tjzx, C_GOLD , size)
			end
			zt_num = zt_num + 1
		end	
	    
		--太极之形显示
		if Curr_NG(pid, 171) then
			local tjzx = WAR.TJZX[pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 2 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("太极之形:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "太极之形:"..tjzx, C_GOLD, size)
			else
				lib.LoadPNG(98, 2 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "太极之形:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
	    if WAR.PD['借力打力'][pid] ~= nil then
			local tjzx = WAR.PD['借力打力'][pid]
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 203 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("借力打力:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "借力打力:"..tjzx, C_GOLD, size)
			else
				lib.LoadPNG(98, 203 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "借力打力:"..tjzx, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--曲风显示
		if match_ID(pid, 586) then
			local qf = WAR.HZD_QF[pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 70 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )			
	           DrawString(CC.ScreenW/1360*705+bx*380-string.len("曲风:"..qf)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "曲风:"..qf, C_GOLD, size)			
			else
				lib.LoadPNG(98, 70 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "曲风:"..qf, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--岳灵珊，慧中灵剑显示
		if match_ID(pid, 79) or match_ID(pid, 9842) then
			local JF = 0
			for i = 1, JY.Base["武功数量"] do
				if JY.Wugong[JY.Person[pid]["武功" .. i]]["武功类型"] == 3 then
					JF = JF + 1
				end
			end
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 4 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("慧中灵剑:"..JF)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "慧中灵剑:"..JF, C_GOLD, size)
			else
				lib.LoadPNG(98, 4 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "慧中灵剑:"..JF, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--剑胆琴心显示
		if WGZH(pid,47,73) then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 5 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("剑胆琴心")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "剑胆琴心", C_GOLD, size)
			else
				lib.LoadPNG(98, 5 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "剑胆琴心", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--辟邪剑气显示WAR.BXJQ
		if WAR.BXJQ[pid] ~= nil then
			local tjzx = WAR.BXJQ[pid] or 0	--标记修改
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 96 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("辟邪剑气:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "辟邪剑气:"..tjzx, C_GOLD, size)	
			else
				lib.LoadPNG(98, 96 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "辟邪剑气:"..tjzx, C_GOLD , size)
			end
			zt_num = zt_num + 1
		end	
		--紫霞剑气显示
		if WAR.ZXQJ[pid] ~= nil then
			local tjzx = WAR.ZXQJ[pid] or 0	--标记修改
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 579 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("紫霞气劲:"..tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "紫霞气劲:"..tjzx, C_GOLD, size)	
			else
				lib.LoadPNG(98, 579 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "紫霞气劲:"..tjzx, C_GOLD , size)
			end
			zt_num = zt_num + 1
		end
		--无明业火显示	
		if WAR.PD["无明业火"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 6 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("无明业火:"..WAR.PD["无明业火"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "无明业火:"..WAR.PD["无明业火"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 6 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "无明业火:"..WAR.PD["无明业火"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--神教逆杀显示	
		if WAR.PD["神教逆杀"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 107 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("神教逆杀:"..WAR.PD["神教逆杀"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "神教逆杀:"..WAR.PD["神教逆杀"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 107 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "神教逆杀:"..WAR.PD["神教逆杀"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--回魂仙梦显示	
		if WAR.PD["回魂仙梦"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 297 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("回魂仙梦:"..WAR.PD["回魂仙梦"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "回魂仙梦:"..WAR.PD["回魂仙梦"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 297 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "回魂仙梦:"..WAR.PD["回魂仙梦"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--诛仙状态显示	
		if WAR.PD["诛仙状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 192 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("诛仙状态:"..WAR.PD["诛仙状态"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "诛仙状态:"..WAR.PD["诛仙状态"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 192 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "诛仙状态:"..WAR.PD["诛仙状态"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无招胜有招显示	
		if WAR.PD["无招胜有招"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98,369 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("无招胜有招:"..WAR.PD["无招胜有招"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "无招胜有招:"..WAR.PD["无招胜有招"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98,369 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "无招胜有招:"..WAR.PD["无招胜有招"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--十方无敌	
		if WAR.PD["十方无敌"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98,125 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("十方无敌:"..WAR.PD["十方无敌"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "十方无敌:"..WAR.PD["十方无敌"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98,125 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "十方无敌:"..WAR.PD["十方无敌"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--邪魅苍生显示	
		if WAR.PD["邪魅苍生"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 23 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("邪魅苍生:"..WAR.PD["邪魅苍生"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "邪魅苍生:"..WAR.PD["邪魅苍生"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 23 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "邪魅苍生:"..WAR.PD["邪魅苍生"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--禁疗显示	
		if WAR.PD["禁疗"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 10 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("禁疗(长生组合免疫):"..WAR.PD["禁疗"][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "禁疗(长生组合免疫):"..WAR.PD["禁疗"][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 10 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "禁疗(长生组合免疫):"..WAR.PD["禁疗"][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
	    --伤害储存
		if WAR.PD["伤害储存"][pid] ~= nil and WAR.PD["伤害储存"][pid] > 0 then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 173 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("伤害储存:"..WAR.PD["伤害储存"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "伤害储存:"..WAR.PD["伤害储存"][pid], C_GOLD, size)
				else
					lib.LoadPNG(98, 173 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "伤害储存:"..WAR.PD["伤害储存"][pid], C_WHITE, size)
				end
				zt_num = zt_num + 1
		end
		--苦难达摩
		if WAR.PD["苦难达摩"][pid] ~= nil and WAR.PD["苦难达摩"][pid] > 0 then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 452 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("苦行僧:"..WAR.PD["苦难达摩"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "苦行僧:"..WAR.PD["苦难达摩"][pid], C_GOLD, size)
				else
					lib.LoadPNG(98, 452 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "苦行僧:"..WAR.PD["苦难达摩"][pid], C_WHITE, size)
				end
				zt_num = zt_num + 1
		end
		--王重阳1 同归剑法	
		if WAR.PD["同归状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 6 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("同归")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "同归", C_GOLD, size)
			else
				lib.LoadPNG(98, 6 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "同归", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		
		
		--无酒不欢：举火燎原，金乌+燃木+火焰刀，造成引燃效果
		if WAR.PD['举火燎原'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 8 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("引燃状态:"..WAR.PD['举火燎原'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "引燃状态:"..WAR.PD['举火燎原'][pid].."时序", C_GOLD, size)			
			else
				lib.LoadPNG(98, 8 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "引燃状态:"..WAR.PD['举火燎原'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--业力引爆
		if WAR.PD['业力引爆'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 409 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("业力引爆:"..WAR.PD['业力引爆'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "业力引爆:"..WAR.PD['业力引爆'][pid].."时序", C_GOLD, size)			
			else
				lib.LoadPNG(98, 409 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "业力引爆:"..WAR.PD['业力引爆'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--秘孔战术果
		if WAR.PD["秘孔战术"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 636 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("死亡倒计:"..WAR.PD["秘孔战术"][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"死亡倒计:"..WAR.PD["秘孔战术"][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 636 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "死亡倒计:"..WAR.PD["秘孔战术"][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：利刃寒锋，修罗+阴风+沧溟，造成冻结效果 集气倒退
		if WAR.PD["利刃寒锋"][pid] ~= nil or WAR.PD["真利刃寒锋"][pid] ~= nil then
			local a = (WAR.PD["利刃寒锋"][pid] or 0)+(WAR.PD['真利刃寒锋'][pid] or 0)
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 9 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("冻结状态:"..a.."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"冻结状态:"..a.."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 9 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "冻结状态:"..a.."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--萧远山走火入魔
		if WAR.PD["走火入魔"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 22 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("走火入魔:"..WAR.PD["走火入魔"][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"走火入魔:"..WAR.PD["走火入魔"][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 22 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "走火入魔:"..WAR.PD["走火入魔"][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--锁穴奇劲
		if WAR.PD["锁穴奇劲"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 72 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("锁穴奇劲:"..WAR.PD["锁穴奇劲"][pid].."值")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"锁穴奇劲:"..WAR.PD["锁穴奇劲"][pid].."值", C_GOLD, size)
			else
				lib.LoadPNG(98, 72 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "锁穴奇劲:"..WAR.PD["锁穴奇劲"][pid].."值", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--285 暗香・
		if WAR.PD["暗香疏影"][pid] ~= nil then
			local axzl = {"失魂香","忘心香","迷情香","幻梦香"}
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 285 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("暗香:"..axzl[WAR.PD["暗香疏影"][pid]])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"暗香:"..axzl[WAR.PD["暗香疏影"][pid]], C_GOLD, size)
			else
				lib.LoadPNG(98, 285 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "暗香:"..axzl[WAR.PD["暗香疏影"][pid]], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--203 暗香・
		if WAR.PD["易水寒诀"][pid] ~= nil then
			
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 203 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("易水寒诀:"..WAR.PD["易水寒诀"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"易水寒诀:"..WAR.PD["易水寒诀"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 203 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "易水寒诀:"..WAR.PD["易水寒诀"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：被死战锁定的目标
		if pid == WAR.SZSD then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 10 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("死战目标")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "死战目标", C_GOLD, size)
			else
				lib.LoadPNG(98, 10 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "死战目标", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--无酒不欢：金轮 十龙十象状态
		if WAR.SLSX[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 11 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("十龙十象")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "十龙十象", C_GOLD, size)
			else
				lib.LoadPNG(98, 11 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "十龙十象", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--无酒不欢：昏迷状态
		if WAR.PD["昏迷状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 12 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("昏迷状态")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "昏迷状态", C_GOLD, size)
			else
				lib.LoadPNG(98, 12 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "昏迷状态", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--无酒不欢：阿紫曼珠沙华
		if match_ID(pid, 47) or match_ID(pid, 9886) then
			--local tjzx = WAR.TJZX[pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 13 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
	            DrawString(CC.ScreenW/1360*705+bx*380-string.len("曼珠沙华:" .. WAR.MZSH)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "曼珠沙华:" .. WAR.MZSH, C_GOLD, size)
			else
				lib.LoadPNG(98, 13 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "曼珠沙华:" .. WAR.MZSH, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--无酒不欢：血战沙场
		if WGZH(pid,198,200) then
			--local tjzx = WAR.TJZX[pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 13 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
	            DrawString(CC.ScreenW/1360*705+bx*380-string.len("血战沙场:" .. WAR.XZSC)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "血战沙场:" .. WAR.XZSC, C_GOLD, size)
			else
				lib.LoadPNG(98, 13 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "血战沙场:" .. WAR.XZSC, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--太极蓄力
		if WAR.PD["太极蓄力"][pid]~= nil and WAR.PD["太极蓄力"][pid] > 0 then	
			local tjzx = WAR.PD["太极蓄力"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 104 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("太极蓄力值:" .. WAR.PD["太极蓄力"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "太极蓄力值:" .. WAR.PD["太极蓄力"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 104 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "太极蓄力值:" .. WAR.PD["太极蓄力"][pid], C_WHITE, size*0.8)
			end
			zt_num = zt_num + 1
		end	
		--太极蓄力
		if WAR.PD["太极蓄劲"][pid]~= nil and WAR.PD["太极蓄劲"][pid] > 0 then	
			local tjzx = WAR.PD["太极蓄劲"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 104 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("太极蓄劲:" .. WAR.PD["太极蓄劲"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "太极蓄劲:" .. WAR.PD["太极蓄劲"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 104 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "太极蓄劲:" .. WAR.PD["太极蓄劲"][pid].."层", C_WHITE, size*0.8)
			end
			zt_num = zt_num + 1
		end	
		
		--羽蛇腾云
		if WAR.PD["羽蛇腾云"][pid]~= nil and WAR.PD["羽蛇腾云"][pid] > 0 then	
			local tjzx = WAR.PD["羽蛇腾云"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 249 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("羽蛇腾云值:" .. WAR.PD["羽蛇腾云"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "羽蛇腾云值:" .. WAR.PD["羽蛇腾云"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 249 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "羽蛇腾云值:" .. WAR.PD["羽蛇腾云"][pid], C_WHITE, size*0.8)
			end
			zt_num = zt_num + 1
		end	
	    --太极内伤
		if WAR.YJZD1[pid]~= nil and WAR.YJZD1[pid] > 0 then	
			local tjzx = math.modf(WAR.YJZD1[pid])
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 205 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("太极破内:" .. tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "太极破内:" .. tjzx, C_GOLD, size)
			else
				lib.LoadPNG(98, 205 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "太极破内:" .. tjzx, C_WHITE, size*0.8)
			end
			zt_num = zt_num + 1
		end
		--太极八卦
		if WAR.BG[pid]~= nil and WAR.BG[pid] > 0 then	
			local tjzx = math.modf(WAR.BG[pid])
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 205 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("八卦值:" .. tjzx)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "八卦值:" .. tjzx, C_GOLD, size)
			else
				lib.LoadPNG(98, 205 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "八卦值:" .. tjzx, C_WHITE, size*0.8)
			end
			zt_num = zt_num + 1
		end
		
		--太极无极
		if WAR.WJ[pid]~= nil and WAR.WJ[pid] > 0 then		
			local tjzx = (WAR.WJ[pid] or 0)
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 204 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("无极值:" .. WAR.WJ[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "无极值:" .. WAR.WJ[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 204 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "无极值:" .. WAR.WJ[pid], C_WHITE, size*0.8)
			end
			zt_num = zt_num + 1
		end
		--蛤蟆功蓄力
		if WAR.PD["蛤蟆蓄力"][pid]~= nil and WAR.PD["蛤蟆蓄力"][pid] > 0 then	
			local tjzx = WAR.PD["蛤蟆蓄力"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 95 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("蛤蟆蓄力值:" .. WAR.PD["蛤蟆蓄力"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "蛤蟆蓄力值:" .. WAR.PD["蛤蟆蓄力"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 95 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "蛤蟆蓄力值:" .. WAR.PD["蛤蟆蓄力"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--蛤蟆功蓄力
		if WAR.HMJT[pid]~= nil and WAR.HMJT[pid] > 0 then	
			local tjzx = WAR.HMJT[pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 95 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("蛤蟆气弹值:" .. WAR.HMJT[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "蛤蟆气弹值:" .. WAR.HMJT[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 95 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "蛤蟆气弹值:" .. WAR.HMJT[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--鲸息功蓄力
		if WAR.PD["鲸息蓄力"][pid]~= nil and WAR.PD["鲸息蓄力"][pid] > 0 then	
			local tjzx = WAR.PD["鲸息蓄力"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 89 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("鲸息蓄力值:" .. WAR.PD["鲸息蓄力"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "鲸息蓄力值:" .. WAR.PD["鲸息蓄力"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 89 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "鲸息蓄力值:" .. WAR.PD["鲸息蓄力"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		
		--金刚护盾
		if WAR.PD["金刚护盾"][pid]~= nil and WAR.PD["金刚护盾"][pid] > 0 then	
			--local tjzx = WAR.PD["金刚护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 117 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("金刚护盾值:" .. WAR.PD["金刚护盾"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "金刚护盾值:" .. WAR.PD["金刚护盾"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 117 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "金刚护盾值:" .. WAR.PD["金刚护盾"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
		--神足护盾	标记修改
		if WAR.PD["神足护盾"][pid]~= nil and WAR.PD["神足护盾"][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 101 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("神足护盾值:" .. WAR.PD["神足护盾"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "神足护盾值:" .. WAR.PD["神足护盾"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 101 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "神足护盾值:" .. WAR.PD["神足护盾"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
	    --阴阳二气	标记修改
		if WAR.PD['阴阳二气'][pid]~= nil and WAR.PD['阴阳二气'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 32 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("太极护盾层:" .. WAR.PD['阴阳二气'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "太极护盾层:" .. WAR.PD['阴阳二气'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 32 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "太极护盾层:" .. WAR.PD['阴阳二气'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--先天太极	标记修改
		if WAR.PD['先天太极'][pid]~= nil and WAR.PD['先天太极'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 205 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("先天太极护盾层:" .. WAR.PD['先天太极'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "先天太极护盾层:" .. WAR.PD['先天太极'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 205 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "先天太极护盾层:" .. WAR.PD['先天太极'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--倾国倾城	标记修改
		if WAR.PD['倾国倾城'][pid]~= nil and WAR.PD['倾国倾城'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 620 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("倾国倾城层:" .. WAR.PD['倾国倾城'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "倾国倾城层:" .. WAR.PD['倾国倾城'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 620 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "倾国倾城层:" .. WAR.PD['倾国倾城'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--神足乾坤	标记修改
		if WAR.PD['神足乾坤'][pid]~= nil and WAR.PD['神足乾坤'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 378 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("神足乾坤护盾层:" .. WAR.PD['神足乾坤'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "神足乾坤护盾层:" .. WAR.PD['神足乾坤'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 378 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "神足乾坤盾层:" .. WAR.PD['神足乾坤'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--先天太极	标记修改
		if WAR.PD['阳神降世'][pid]~= nil and WAR.PD['阳神降世'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 430 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("阳神降世")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "阳神降世", C_GOLD, size)
			else
				lib.LoadPNG(98, 430 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "阳神降世", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--先天太极	标记修改
		if WAR.PD['阴圣再临'][pid]~= nil and WAR.PD['阴圣再临'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 431 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("阴圣再临")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "阴圣再临", C_GOLD, size)
			else
				lib.LoadPNG(98, 431 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "阴圣再临", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--万毒炼体	标记修改
		if WAR.PD['万毒炼体'][pid]~= nil and WAR.PD['万毒炼体'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 205 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("万毒炼体层:" .. WAR.PD['万毒炼体'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "万毒炼体层:" .. WAR.PD['万毒炼体'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 205 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "万毒炼体层:" .. WAR.PD['万毒炼体'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--易水寒	标记修改
		if WAR.PD['易水寒冰'][pid]~= nil and WAR.PD['易水寒冰'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 632 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("易水寒冰层:" .. WAR.PD['易水寒冰'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "易水寒冰层:" .. WAR.PD['易水寒冰'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 632 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "易水寒冰层:" .. WAR.PD['易水寒冰'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--九阳护盾	标记修改
		if WAR.PD['九阳护盾'][pid]~= nil and WAR.PD['九阳护盾'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 309 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("九阳护盾层:" .. WAR.PD['九阳护盾'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "九阳护盾层:" .. WAR.PD['九阳护盾'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 309 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "九阳护盾层:" .. WAR.PD['九阳护盾'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--先天护盾	标记修改
		if WAR.PD['先天护盾'][pid]~= nil and WAR.PD['先天护盾'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 211 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("先天罡气值:" .. WAR.PD['先天护盾'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "先天罡气值:" .. WAR.PD['先天护盾'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 211 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "先天罡气值:" .. WAR.PD['先天护盾'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--轻云	标记修改
		if WAR.QYBY[pid]~= nil and WAR.QYBY[pid] > 40 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 3 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("轻云敝月开启中")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"轻云敝月开启中", C_GOLD, size)
			else
				lib.LoadPNG(98, 3 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "轻云敝月开启中", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--剑步	标记修改
		if WAR.JBMY[pid]~= nil and WAR.JBMY[pid] > 15 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 212 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("剑步谜影开启中")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"剑步谜影开启中", C_GOLD, size)
			else
				lib.LoadPNG(98, 212 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "剑步谜影开启中", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--明心见性	标记修改
		if WAR.HLJG[pid]~= nil and WAR.HLJG[pid] > 15 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 365 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("明心见性开启中")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"明心见性开启中", C_GOLD, size)
			else
				lib.LoadPNG(98, 365 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "明心见性开启中", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--乘风蹈海	标记修改
		if WAR.CFDH[pid]~= nil and WAR.CFDH[pid] > 15 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 365 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("乘风蹈海开启中")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"乘风蹈海开启中", C_GOLD, size)
			else
				lib.LoadPNG(98, 365 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "乘风蹈海开启中", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--风霜扑面	标记修改
		if WAR.YSHJ[pid]~= nil then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 474 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("易水寒免疫攻击")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"易水寒免疫攻击", C_GOLD, size)
			else
				lib.LoadPNG(98, 474 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "易水寒免疫攻击", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--梅花步 标记修改
		if WAR.MHBF[pid]~= nil and WAR.MHBF[pid] > 20 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 285 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("梅花无痕开启中")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"梅花无痕开启中", C_GOLD, size)
			else
				lib.LoadPNG(98, 285 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "梅花无痕开启中", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--奇门五转	标记修改
		if WAR.PD['奇门五转'][pid]~= nil and WAR.PD['奇门五转'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 207 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("遁甲护罩值:" .. WAR.PD['奇门五转'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "遁甲护罩值:" .. WAR.PD['奇门五转'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 207 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "遁甲护罩值:" .. WAR.PD['奇门五转'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		
		--奇门五转	标记修改
		if WAR.PD["吸星真气"][pid]~= nil and WAR.PD["吸星真气"][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 207 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("吸星护盾值:" .. WAR.PD["吸星真气"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "吸星护盾值:" .. WAR.PD["吸星真气"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 207 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "吸星护盾值:" .. WAR.PD["吸星真气"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		
		--九阴真气	标记修改
		if WAR.JYZQ[pid]~= nil and WAR.JYZQ[pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 145 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("九阴真气层:" .. WAR.JYZQ[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "九阴真气层:" .. WAR.JYZQ[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 145 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "九阴真气层:" .. WAR.JYZQ[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		
	    --先天真气	标记修改
		if WAR.XTZQ[pid]~= nil and WAR.XTZQ[pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 391 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("先天真气层:" .. WAR.XTZQ[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "先天真气层:" .. WAR.XTZQ[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 391 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "先天真气层:" .. WAR.XTZQ[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
			--紫霞蓄力
		if WAR.ZXXS[pid]~= nil and WAR.ZXXS[pid] > 0 then	
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 145 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("紫霞蓄势层:" .. WAR.ZXXS[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "紫霞蓄势层:" .. WAR.ZXXS[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 145 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "紫霞蓄势层:" .. WAR.ZXXS[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--长生真气	标记修改
		if WAR.PD['长生真气'][pid]~= nil and WAR.PD['长生真气'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 166 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("长生真气层:" .. WAR.PD['长生真气'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "长生真气层:" .. WAR.PD['长生真气'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 166 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "长生真气层:" .. WAR.PD['长生真气'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--长生真气	标记修改
		if WAR.PD['长生蓄力'][pid]~= nil and WAR.PD['长生蓄力'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 406 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("长生蓄力值:" .. WAR.PD['长生蓄力'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "长生蓄力值:" .. WAR.PD['长生蓄力'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 406 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "长生蓄力值:" .. WAR.PD['长生蓄力'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
			--铁掌炼铁劲
		if WAR.PD['炼铁劲'][pid] ~= nil then
			local str = "炼铁劲："
			local pd = WAR.PD['炼铁劲'][pid]
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 109 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len(str .. pd)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, str .. pd, C_GOLD, size)
			else
				lib.LoadPNG(98, 109 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, str .. pd, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--氤氤氲氲
		if WAR.PD["氤氤氲氲"][pid]~= nil and WAR.PD["氤氤氲氲"][pid] > 0 then	
			local pd = WAR.PD["氤氤氲氲"][pid]
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 545 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("氤氤氲氲:" .. pd)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "氤氤氲氲:" .. pd, C_GOLD, size)
			else
				lib.LoadPNG(98, 545 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "氤氤氲氲:" .. pd, C_WHITE, size*0.8)
			end
			zt_num = zt_num + 1
		end	
		--独孤剑意
		if WAR.DGJY[pid]~= nil and WAR.DGJY[pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 55 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("独孤剑意层:" .. WAR.DGJY[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "独孤剑意层:" .. WAR.DGJY[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 55 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "独孤剑意层:" .. WAR.DGJY[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--剑荡十方
		if WAR.PD['剑荡十方'][pid]~= nil and WAR.PD['剑荡十方'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 151 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("荡剑式:" .. WAR.PD['剑荡十方'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "荡剑式:" .. WAR.PD['剑荡十方'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 151 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "荡剑式:" .. WAR.PD['剑荡十方'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--怒涛剑气
		if WAR.PD['怒涛剑气'][pid]~= nil and WAR.PD['怒涛剑气'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 196 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("怒涛气劲层:" .. WAR.PD['怒涛剑气'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "怒涛气劲层:" .. WAR.PD['怒涛剑气'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 196 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "怒涛气劲层:" .. WAR.PD['怒涛剑气'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--全真剑气
		if WAR.QZJQ[pid]~= nil and WAR.QZJQ[pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 4 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("全真剑气层:" .. WAR.QZJQ[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "全真剑气层:" .. WAR.QZJQ[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 4 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "全真剑气层:" .. WAR.QZJQ[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--葵花护盾
		if WAR.PD['葵花护盾'][pid]~= nil and WAR.PD['葵花护盾'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 600 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("葵花真气层:" .. WAR.PD['葵花护盾'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "葵花真气层:" .. WAR.PD['葵花护盾'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 600 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "葵花真气层:" .. WAR.PD['葵花护盾'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--登云	标记修改
		if WAR.PD['登云1'][pid]~= nil and WAR.PD['登云1'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 193 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("登云状态:" .. WAR.PD['登云1'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "登云状态:" .. WAR.PD['登云1'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 193 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "登云状态:" .. WAR.PD['登云1'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--花天
		if WAR.PD['花天'][pid]~= nil and WAR.PD['花天'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 613 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("花天:" .. WAR.PD['花天'][pid].."层数")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "花天:" .. WAR.PD['花天'][pid].."层数", C_GOLD, size)
			else
				lib.LoadPNG(98, 613 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "花天:" .. WAR.PD['花天'][pid].."层数", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--鬼禅六断	标记修改
		if WAR.PD['鬼禅六断'][pid]~= nil and WAR.PD['鬼禅六断'][pid] > 0 then	
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 356 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("杀生证道值:" .. WAR.PD['鬼禅六断'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "杀生证道值:" .. WAR.PD['鬼禅六断'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 356 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "杀生证道值:" .. WAR.PD['鬼禅六断'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--阴阳无极	标记修改
		if WAR.PD['阴阳双极'][pid]~= nil and WAR.PD['阴阳双极'][pid] >= 0  then	
			local str = ""
			if WAR.PD['阴阳双极'][pid] < 31 then
				str = "阳极"
			else
				str = "阴极"
			end		
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 230 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("双极态:" .. str)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "双极态:" .. str, C_GOLD, size)
			else
				lib.LoadPNG(98, 230 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "双极态:" .. str, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--鲸龟沉眠
		if WAR.PD['鲸龟沉眠'][pid]~= nil and WAR.PD['鲸龟沉眠'][pid] > 0 then	
			local tjzx = WAR.PD["鲸龟沉眠"][pid] or 0
			local str = ""
			if WAR.PD['鲸龟沉眠'][pid] == 2 then
				str = "鲸跃"
			else
				str = "神龟"
			end	
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 587 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("沉眠:" ..str)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "沉眠:" ..str, C_GOLD, size)
			else
				lib.LoadPNG(98, 587 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "沉眠:" ..str, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--战神状态	标记修改
		if WAR.PD['战神状态'][pid]~= nil and WAR.PD['战神状态'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 352 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("战神:" .. WAR.PD['战神状态'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "战神:" .. WAR.PD['战神状态'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 352 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "战神:" ..WAR.PD['战神状态'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--神兵状态	标记修改
		if WAR.PD['神兵'][pid]~= nil and WAR.PD['神兵'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 164 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("神兵:" .. WAR.PD['神兵'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "神兵:" .. WAR.PD['神兵'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 164 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "神兵:" ..WAR.PD['神兵'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--精神错乱	标记修改
		if WAR.PD['精神错乱'][pid]~= nil and WAR.PD['精神错乱'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 569 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("精神错乱:" .. WAR.PD['精神错乱'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "精神错乱:" .. WAR.PD['精神错乱'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 569 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "精神错乱:" .. WAR.PD['精神错乱'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--心神丧失	标记修改
		if WAR.PD['神经蛇毒'][pid]~= nil and WAR.PD['神经蛇毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 94 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("心神丧失:" .. WAR.PD['神经蛇毒'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "心神丧失:" .. WAR.PD['神经蛇毒'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 94 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "心神丧失:" .. WAR.PD['神经蛇毒'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--霸王破甲	标记修改
		if WAR.PD['霸王破甲'][pid]~= nil and WAR.PD['霸王破甲'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 565 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("霸王破甲:" .. WAR.PD['霸王破甲'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "霸王破甲:" .. WAR.PD['霸王破甲'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 565 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "霸王破甲:" .. WAR.PD['霸王破甲'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--力竭	标记修改
		if WAR.PD['力竭'][pid]~= nil and WAR.PD['力竭'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 449 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("停止回体:" .. WAR.PD['力竭'][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "停止回体:" .. WAR.PD['力竭'][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 449 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "停止回体:" .. WAR.PD['力竭'][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--玄冥透骨	标记修改
		if WAR.PD['玄冥透骨'][pid]~= nil and WAR.PD['玄冥透骨'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 217 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("玄冥透骨:" .. WAR.PD['玄冥透骨'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "玄冥透骨:" .. WAR.PD['玄冥透骨'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 217 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "玄冥透骨:" .. WAR.PD['玄冥透骨'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--玄冥透骨1	标记修改
		if WAR.PD['玄冥透骨1'][pid]~= nil and WAR.PD['玄冥透骨1'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 217 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("玄冥透骨1:" .. WAR.PD['玄冥透骨1'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "玄冥透骨1:" .. WAR.PD['玄冥透骨1'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 217 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "玄冥透骨1:" .. WAR.PD['玄冥透骨1'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--绿火星毒	标记修改
		if WAR.PD['绿火星毒'][pid]~= nil and WAR.PD['绿火星毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 617 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("绿火星毒:" .. WAR.PD['绿火星毒'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "绿火星毒:" .. WAR.PD['绿火星毒'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 617 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "绿火星毒:" .. WAR.PD['绿火星毒'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--狱龙破	标记修改
		if WAR.PD['狱龙破'][pid]~= nil and WAR.PD['狱龙破'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 639 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("狱龙破:" .. WAR.PD['狱龙破'][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "狱龙破:" .. WAR.PD['狱龙破'][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 639 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "狱龙破:" .. WAR.PD['狱龙破'][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--出血蛇毒	标记修改
		if WAR.PD['出血蛇毒'][pid]~= nil and WAR.PD['出血蛇毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 94 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("毒血裂创:" .. WAR.PD['出血蛇毒'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "毒血裂创:" .. WAR.PD['出血蛇毒'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 94 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "毒血裂创:" .. WAR.PD['出血蛇毒'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：破甲蛇毒	标记修改
		if WAR.PD["破甲蛇毒"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 94 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("破甲蛇毒:" .. WAR.PD["破甲蛇毒"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "破甲蛇毒:" .. WAR.PD["破甲蛇毒"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 94 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "破甲蛇毒:" .. WAR.PD["破甲蛇毒"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--剧毒
		if WAR.PD['西域奇毒'][pid]~= nil and WAR.PD['西域奇毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 94 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("剧毒:" .. WAR.PD['西域奇毒'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "剧毒:" .. WAR.PD['西域奇毒'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 94 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "剧毒:" .. WAR.PD['西域奇毒'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--金蛇幻毒
		if WAR.PD['金蛇幻毒'][pid]~= nil and WAR.PD['金蛇幻毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 586 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("金蛇蛊:" .. WAR.PD['金蛇幻毒'][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "金蛇蛊:" .. WAR.PD['金蛇幻毒'][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 586 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "金蛇蛊:" .. WAR.PD['金蛇幻毒'][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--黑血毒
		if WAR.PD['黑血毒'][pid]~= nil and WAR.PD['黑血毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 241 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("黑血毒:" .. WAR.PD['黑血毒'][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "黑血毒:" .. WAR.PD['黑血毒'][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 241 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "黑血毒:" .. WAR.PD['黑血毒'][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--阴气污染
		if WAR.PD['阴气污染'][pid]~= nil and WAR.PD['阴气污染'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 492 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("阴气污染:" .. WAR.PD['阴气污染'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "阴气污染:" .. WAR.PD['阴气污染'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 492 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "阴气污染:" .. WAR.PD['阴气污染'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--霜炎九重2
		if WAR.PD['霜炎九重2'][pid]~= nil and WAR.PD['霜炎九重2'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 43 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("冰火两重天:" .. WAR.PD['霜炎九重2'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "冰火两重天:" .. WAR.PD['霜炎九重2'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 43 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "冰火两重天:" .. WAR.PD['霜炎九重2'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--阳气侵蚀
		if WAR.PD['阳气侵蚀'][pid]~= nil and WAR.PD['阳气侵蚀'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 43 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("阳气侵蚀:" .. WAR.PD['阳气侵蚀'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "阳气侵蚀:" .. WAR.PD['阳气侵蚀'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 43 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "阳气侵蚀:" .. WAR.PD['阳气侵蚀'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--生命恢复停止
		if WAR.PD['生命恢复停止'][pid]~= nil and WAR.PD['生命恢复停止'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 455 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("停止回血:" .. WAR.PD['生命恢复停止'][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "停止回血:" .. WAR.PD['生命恢复停止'][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 455 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "停止回血:" .. WAR.PD['生命恢复停止'][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--内力恢复停止
		if WAR.PD['内力恢复停止'][pid]~= nil and WAR.PD['内力恢复停止'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 455 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("停止回内:" .. WAR.PD['内力恢复停止'][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "停止回内:" .. WAR.PD['内力恢复停止'][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 455 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "停止回内:" .. WAR.PD['内力恢复停止'][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--创伤
		if WAR.PD['创伤'][pid]~= nil and WAR.PD['创伤'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 610 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("创伤:" .. WAR.PD['创伤'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "创伤:" .. WAR.PD['创伤'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 610 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "创伤:" .. WAR.PD['创伤'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--灵蛇拳
		if WAR.PD['灵蛇拳'][pid]~= nil and WAR.PD['灵蛇拳'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 624 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("集气紊乱:" .. WAR.PD['灵蛇拳'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "集气紊乱:" .. WAR.PD['灵蛇拳'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 624 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "集气紊乱:" .. WAR.PD['灵蛇拳'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--逆转经脉
		if WAR.PD['逆转经脉'][pid]~= nil and WAR.PD['逆转经脉'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 624 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("经脉错乱:" .. WAR.PD['逆转经脉'][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "经脉错乱:" .. WAR.PD['逆转经脉'][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 624 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "经脉错乱:" .. WAR.PD['逆转经脉'][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--凝毒化血
		if WAR.PD['凝毒化血'][pid]~= nil and WAR.PD['凝毒化血'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 547 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("毒障:" .. WAR.PD['凝毒化血'][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "毒障:" .. WAR.PD['凝毒化血'][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 547 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "毒障:" .. WAR.PD['凝毒化血'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--白驼蛇蛊
		if WAR.PD['白驼蛇蛊'][pid]~= nil and WAR.PD['白驼蛇蛊'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 624 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("灵蛇蛊:" .. WAR.PD['白驼蛇蛊'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "灵蛇蛊:" .. WAR.PD['白驼蛇蛊'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 624 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "灵蛇蛊:" .. WAR.PD['白驼蛇蛊'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--封印
		if WAR.PD['封印'][pid]~= nil and WAR.PD['封印'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 279 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("封印状态:" .. WAR.PD['封印'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "封印状态:" .. WAR.PD['封印'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 279 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "封印状态:" .. WAR.PD['封印'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--初芽
		if WAR.PD['初芽'][pid]~= nil and WAR.PD['初芽'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 613 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("初芽:" .. WAR.PD['初芽'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "初芽:" .. WAR.PD['初芽'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 613 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "初芽:" .. WAR.PD['初芽'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--含苞
		if WAR.PD['含苞'][pid]~= nil and WAR.PD['含苞'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 613 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("含苞:" .. WAR.PD['含苞'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "含苞:" .. WAR.PD['含苞'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 613 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "含苞:" .. WAR.PD['含苞'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--绽放
		if WAR.PD['绽放'][pid]~= nil and WAR.PD['绽放'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 613 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("绽放:" .. WAR.PD['绽放'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "绽放:" .. WAR.PD['绽放'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 613 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "绽放:" .. WAR.PD['绽放'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--凋零
		if WAR.PD['凋零'][pid]~= nil and WAR.PD['凋零'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 613 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("凋零:" .. WAR.PD['凋零'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "凋零:" .. WAR.PD['凋零'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 613 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "凋零:" .. WAR.PD['凋零'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--降龙虚劲
		if WAR.PD['降龙虚劲'][pid]~= nil and WAR.PD['降龙虚劲'][pid] > 0 then	
			local tjzx = WAR.PD["降龙虚劲"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 66 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("降龙虚劲:" ..tjzx.."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "降龙虚劲:" ..tjzx.."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 66 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "降龙虚劲:" ..tjzx.."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--九死龙爪
		if WAR.PD['龙爪毒'][pid]~= nil and WAR.PD['龙爪毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 94 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("龙爪毒劲:" .. WAR.PD['龙爪毒'][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "龙爪毒劲:" .. WAR.PD['龙爪毒'][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 94 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "龙爪毒劲:" .. WAR.PD['龙爪毒'][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--集气倒走显示	
		if (WAR.PD["伏魔逆气"][pid] ~= nil or WAR.PD['集气倒退'][pid] or WAR.PD['玄武逆行'][pid] ~= nil) then
			local a = (WAR.PD["伏魔逆气"][pid] or 0)+(WAR.PD['集气倒退'][pid] or 0)+(WAR.PD['玄武逆行'][pid] or 0)
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 399 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("集气倒走:"..a.."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "集气倒走:"..a.."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 399 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "集气倒走:"..a.."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--细雨花
		if WAR.PD['夜雨绵延'][pid]~= nil and WAR.PD['夜雨绵延'][pid] > 0 then	
			local tjzx = WAR.PD["夜雨绵延"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 612 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("夜雨绵延:" ..tjzx.."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "夜雨绵延:" ..tjzx.."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 612 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "夜雨绵延:" ..tjzx.."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--细雨花
		if WAR.PD['周公剑意'][pid]~= nil and WAR.PD['周公剑意'][pid] > 0 then	
			local tjzx = WAR.PD["周公剑意"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 439 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("周公剑意:" ..tjzx.."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "周公剑意:" ..tjzx.."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 439 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "周公剑意:" ..tjzx.."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--九命猫
		if WAR.PD['九命猫'][pid]~= nil and WAR.PD['九命猫'][pid] > 0 then	
			local tjzx = WAR.PD["九命猫"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 1 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("剩余生命:" ..tjzx.."条")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "剩余生命:" ..tjzx.."条", C_GOLD, size)
			else
				lib.LoadPNG(98, 1 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "剩余生命:" ..tjzx.."条", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--破军显示	
		if WAR.PD["破军"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 304 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("内功停运:"..WAR.PD["破军"][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "内功停运:"..WAR.PD["破军"][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 304 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "内功停运:"..WAR.PD["破军"][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--毒击显示	
		if WAR.PD["毒击"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 603 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("毒击:"..WAR.PD["毒击"][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "毒击:"..WAR.PD["毒击"][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 603 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "毒击:"..WAR.PD["毒击"][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--光明圣火显示	
		if WAR.PD["光明圣火"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 527 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("圣火不灭:"..WAR.PD["光明圣火"][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "圣火不灭:"..WAR.PD["光明圣火"][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 527 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "圣火不灭:"..WAR.PD["光明圣火"][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--圣火无中生有	
		if WAR.PD["圣火无中生有"][pid] ~= nil and WAR.PD["圣火无中生有"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 527 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("无中生有:"..WAR.PD["圣火无中生有"][pid].."积累")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "无中生有:"..WAR.PD["圣火无中生有"][pid].."积累", C_GOLD, size)
			else
				lib.LoadPNG(98, 527 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "无中生有:"..WAR.PD["圣火无中生有"][pid].."积累", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--冰魄毒
		if WAR.PD['冰魄毒'][pid]~= nil and WAR.PD['冰魄毒'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 65 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("冰魄毒:" .. WAR.PD['冰魄毒'][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "冰魄毒:" .. WAR.PD['冰魄毒'][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 65 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "冰魄毒:" .. WAR.PD['冰魄毒'][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--帝释天临
		if WAR.PD['帝释天临'][pid]~= nil and WAR.PD['帝释天临'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 530 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("帝释天临:" .. WAR.PD['帝释天临'][pid].."层数")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "帝释天临:" .. WAR.PD['帝释天临'][pid].."层数", C_GOLD, size)
			else
				lib.LoadPNG(98, 530 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "帝释天临:" .. WAR.PD['帝释天临'][pid].."层数", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--降龙尊相
		if WAR.PD['降龙尊相'][pid]~= nil and WAR.PD['降龙尊相'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 513 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("降龙尊相:" .. WAR.PD['降龙尊相'][pid].."层数")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "降龙尊相:" .. WAR.PD['降龙尊相'][pid].."层数", C_GOLD, size)
			else
				lib.LoadPNG(98, 513 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "降龙尊相:" .. WAR.PD['降龙尊相'][pid].."层数", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--四海龙王
		if WAR.PD['四海龙王'][pid]~= nil and WAR.PD['四海龙王'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 599 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("四海龙王:" .. WAR.PD['四海龙王'][pid].."层数")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "四海龙王:" .. WAR.PD['四海龙王'][pid].."层数", C_GOLD, size)
			else
				lib.LoadPNG(98, 599 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "四海龙王:" .. WAR.PD['四海龙王'][pid].."层数", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--转龙呼吸
		if WAR.PD['转龙呼吸'][pid]~= nil and WAR.PD['转龙呼吸'][pid] > 0 then	
			--local tjzx = WAR.PD["神足护盾"][pid] or 0
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 514 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("转龙呼吸:" .. WAR.PD['转龙呼吸'][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "转龙呼吸:" .. WAR.PD['转龙呼吸'][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 514 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "转龙呼吸:" .. WAR.PD['转龙呼吸'][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--无酒不欢：禁药状态
		if WAR.JYZT[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 14 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("力量的代价")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "力量的代价", C_GOLD, size)
			else
				lib.LoadPNG(98, 14 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "力量的代价", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--无酒不欢：沉睡状态
		if WAR.PD["沉睡状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 15 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("沉睡状态")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "沉睡状态", C_GOLD, size)
			else
				lib.LoadPNG(98, 15 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "沉睡状态", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		
		--碧落九重剑：重
		if WAR.BLJC1[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 139 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("加重岩:" .. WAR.BLJC1[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "加重岩:" .. WAR.BLJC1[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 139 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "加重岩:" .. WAR.BLJC1[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：混乱状态
		if WAR.PD["混乱状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 18 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("混乱状态:" .. WAR.PD["混乱状态"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "混乱状态:" .. WAR.PD["混乱状态"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 18 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "混乱状态:" .. WAR.PD["混乱状态"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：荒天龙灭
		if WAR.PD["荒天龙灭"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 563 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("荒天龙灭:" .. WAR.PD["荒天龙灭"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "荒天龙灭:" .. WAR.PD["荒天龙灭"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 563 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "荒天龙灭:" .. WAR.PD["荒天龙灭"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：洞火
		if WAR.PD["洞火"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 36 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("洞火:" .. WAR.PD["洞火"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "洞火:" .. WAR.PD["洞火"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 36 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "洞火:" .. WAR.PD["洞火"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：头晕目眩
		if WAR.PD["头晕目眩"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 18 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("头晕目眩:" .. WAR.PD["头晕目眩"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "头晕目眩:" .. WAR.PD["头晕目眩"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 18 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "头晕目眩:" .. WAR.PD["头晕目眩"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：疯魔状态
		if WAR.PD["疯魔"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 79 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("疯魔:" .. WAR.PD["疯魔"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "疯魔:" .. WAR.PD["疯魔"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 79 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "疯魔:" .. WAR.PD["疯魔"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：基础蛊毒
		if WAR.PD["基础蛊毒"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 592 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("基础蛊毒:" .. WAR.PD["基础蛊毒"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "基础蛊毒:" .. WAR.PD["基础蛊毒"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 592 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "基础蛊毒:" .. WAR.PD["基础蛊毒"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：残劲袭魄
		if WAR.PD["残劲袭魄"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 540 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("残劲袭魄:" .. WAR.PD["残劲袭魄"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "残劲袭魄:" .. WAR.PD["残劲袭魄"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 540 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "残劲袭魄:" .. WAR.PD["残劲袭魄"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：外伤状态2
		if WAR.PD["败血破命"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 540 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("败血破命:" .. WAR.PD["败血破命"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "败血破命:" .. WAR.PD["败血破命"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 540 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "败血破命:" .. WAR.PD["败血破命"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：外伤状态3
		if WAR.PD["火毒攻心"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 540 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("火毒攻心:" .. WAR.PD["火毒攻心"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "火毒攻心:" .. WAR.PD["火毒攻心"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 540 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "火毒攻心:" .. WAR.PD["火毒攻心"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：外伤状态4
		if WAR.PD["寒毒入体"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 540 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("寒毒入体:" .. WAR.PD["寒毒入体"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "寒毒入体:" .. WAR.PD["寒毒入体"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 540 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "寒毒入体:" .. WAR.PD["寒毒入体"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：外伤状态5
		if WAR.PD["五蕴炽盛"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 540 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("五蕴炽盛:" .. WAR.PD["五蕴炽盛"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "五蕴炽盛:" .. WAR.PD["五蕴炽盛"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 540 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "五蕴炽盛:" .. WAR.PD["五蕴炽盛"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：封气绝脉
		if WAR.PD["封气绝脉"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 540 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("封气绝脉:" .. WAR.PD["封气绝脉"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "封气绝脉:" .. WAR.PD["封气绝脉"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 540 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "封气绝脉:" .. WAR.PD["封气绝脉"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		if WAR.PD['黯然值'][pid] ~= nil then
			if WAR.PD['黯然值'][pid] < 100 then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 123 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("黯然:" .. WAR.PD["黯然值"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "黯然:" .. WAR.PD["黯然值"][pid].."层", C_GOLD, size)
				else
					lib.LoadPNG(98, 123 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "黯然:" .. WAR.PD["黯然值"][pid].."层", C_WHITE, size)
				end
			else
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 123 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("黯然:此心已寂")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "黯然:此心已寂", C_GOLD, size)
				else
					lib.LoadPNG(98, 123 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "黯然:此心已寂", C_WHITE, size)
				end
			end	
			zt_num = zt_num + 1
		end	
		
		--散功状态
		if WAR.PD["散功状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 17 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("散功状态:" .. WAR.PD["散功状态"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "散功状态:" .. WAR.PD["散功状态"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 17 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "散功状态:" .. WAR.PD["散功状态"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--冰心状态
		if WAR.PD["冰心状态"][pid] ~= nil then
			local str = "冰心状态："
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 65 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len(str..WAR.PD['冰心状态'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, str..WAR.PD['冰心状态'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 65 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, str..WAR.PD['冰心状态'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--重度内伤
		if WAR.PD["重度内伤"][pid] ~= nil then
			local str = "重度内伤："
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 103 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len(str..WAR.PD['重度内伤'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, str..WAR.PD['重度内伤'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 103 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, str..WAR.PD['重度内伤'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
	    
		
		--参合效果状态
		if WAR.PD["参合状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 116 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("参合" .. WAR.PD["参合状态"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "参合" .. WAR.PD["参合状态"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 116 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "参合" .. WAR.PD["参合状态"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end

		if WAR.PD["霜之哀伤"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 116 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("叠刃:" .. WAR.PD["霜之哀伤"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "叠刃:" .. WAR.PD["霜之哀伤"][pid].."层",C_GOLD, size)
			else
				lib.LoadPNG(98, 116 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "叠刃:" .. WAR.PD["霜之哀伤"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：琴音状态
		if WAR.PD["琴音状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 19 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("琴音" .. WAR.PD["琴音状态"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "琴音" .. WAR.PD["琴音状态"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 19 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "琴音" .. WAR.PD["琴音状态"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：冰冻状态
		if WAR.PD["冰冻状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 83 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("冰冻" .. WAR.PD["冰冻状态"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "冰冻" .. WAR.PD["冰冻状态"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 83 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "冰冻" .. WAR.PD["冰冻状态"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：冰冻扣血
		if WAR.PD["冰冻扣血"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 475 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("冰冻扣血" .. WAR.PD["冰冻扣血"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "冰冻扣血" .. WAR.PD["冰冻扣血"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 457 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "冰冻扣血" .. WAR.PD["冰冻扣血"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--止杀状态
		if WAR.PD["恐惧状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 58 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("剑胆琴心")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "止杀状态", C_GOLD, size)
			else
				lib.LoadPNG(98, 58 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "止杀状态:" .. WAR.PD["恐惧状态"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--霍青桐指令状态
		if WAR.HQT_ZL[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 117 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("号令三军:" .. WAR.HQT_ZL[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "号令三军:" .. WAR.HQT_ZL[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 117 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "号令三军:" .. WAR.HQT_ZL[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		--梅长苏偷天换日
		if WAR.PD["偷天换日"][pid] ~= nil  then
		 if  WAR.PD["偷天换日"][pid] >= 100  then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 85 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("偷天换日")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "偷天换日", C_GOLD, size)
				else
					lib.LoadPNG(98, 85 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "偷天换日", C_WHITE, size)
				end
			   else
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 66 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("火寒毒发作:" .. WAR.PD["偷天换日"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "火寒毒发作:" .. WAR.PD["偷天换日"][pid], C_GOLD, size)
				else
					lib.LoadPNG(98, 66 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num,"火寒毒发作:" .. WAR.PD["偷天换日"][pid], C_WHITE, size)
				end
				end
			zt_num = zt_num + 1
		end		
		--大周天回复 养生主
		if WAR.ZTHF[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 110 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len( "养生主:" .. WAR.ZTHF[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,  "养生主:" .. WAR.ZTHF[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 110 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "养生主:" .. WAR.ZTHF[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
	    
		--忏悔状态
		if WAR.PD["受想行识"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 20 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("清净罪孽:" .. WAR.PD["受想行识"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "清净罪孽:" .. WAR.PD["受想行识"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 20 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "清净罪孽:" .. WAR.PD["受想行识"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--无酒不欢：虚弱状态
		if WAR.PD["虚弱状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 20 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("虚弱状态:" .. WAR.PD["虚弱状态"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "虚弱状态:" .. WAR.PD["虚弱状态"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 20 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "虚弱状态:" .. WAR.PD["虚弱状态"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
	    
		--脆弱状态
		if WAR.PD["脆弱状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 20 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("脆弱状态:" .. WAR.PD["脆弱状态"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "脆弱状态:" .. WAR.PD["脆弱状态"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 20 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "脆弱状态:" .. WAR.PD["脆弱状态"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--放下屠刀
		if WAR.PD["放下屠刀"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 20 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("伤害降低:" .. WAR.PD["放下屠刀"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "伤害降低:" .. WAR.PD["放下屠刀"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 20 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "伤害降低:" .. WAR.PD["放下屠刀"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
		
		--菩提咒
		if WAR.PD["般若等待"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 512 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("般若等待:" .. WAR.PD["般若等待"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "般若等待:" .. WAR.PD["般若等待"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 512 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "般若等待:" .. WAR.PD["般若等待"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--菩提咒
		if WAR.PD["般若蓄力"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 512 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("般若蓄力:" .. WAR.PD["般若蓄力"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "般若蓄力:" .. WAR.PD["般若蓄力"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 512 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "般若蓄力:" .. WAR.PD["般若蓄力"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--菩提咒
		if WAR.PD["般若休息"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 512 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("般若休息:" .. WAR.PD["般若休息"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "般若休息:" .. WAR.PD["般若休息"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 512 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "般若休息:" .. WAR.PD["般若休息"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--菩提咒
		if WAR.PD["般若防御"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 512 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("般若防御:" .. WAR.PD["般若防御"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "般若防御:" .. WAR.PD["般若防御"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 512 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "般若防御:" .. WAR.PD["般若防御"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--罗汉血
		if WAR.PD["罗汉血"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 509 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("罗汉血:" .. WAR.PD["罗汉血"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "罗汉血:" .. WAR.PD["罗汉血"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 509 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "罗汉血:" .. WAR.PD["罗汉血"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--度化状态
		if WAR.PD["度化状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 98 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("皈依我佛剩余:" .. WAR.PD["度化状态"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "皈依我佛剩余:" .. WAR.PD["度化状态"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 98 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "皈依我佛剩余:" .. WAR.PD["度化状态"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--烈诅咒
		if WAR.PD['烈诅咒'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 103 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("烈火焚心:" .. WAR.PD["烈诅咒"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "烈火焚心:" .. WAR.PD["烈诅咒"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 103 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "烈火焚心:" .. WAR.PD["烈诅咒"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--血淬
		if WAR.PD['血淬'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 343 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("血淬:" .. WAR.PD["血淬"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "血淬:" .. WAR.PD["血淬"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 343 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "血淬:" .. WAR.PD["血淬"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--血色诅咒
		if WAR.PD['血色诅咒'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 566 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("血色诅咒:" .. WAR.PD["血色诅咒"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "血色诅咒:" .. WAR.PD["血色诅咒"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 566 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "血色诅咒:" .. WAR.PD["血色诅咒"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--凝血纹印
		if WAR.PD['凝血纹印'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 536 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("凝血纹印:" .. WAR.PD["凝血纹印"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "凝血纹印:" .. WAR.PD["凝血纹印"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 536 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "凝血纹印:" .. WAR.PD["凝血纹印"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--周天星辰
		if WAR.PD["三垣"][pid] ~= nil then
			local str = ""
			if WAR.PD["三垣"][pid] >= 0 and WAR.PD["三垣"][pid] < 30 then
				str = "天市垣"
			elseif WAR.PD["三垣"][pid] >= 31 and WAR.PD["三垣"][pid] < 61 then
				str = "太微垣"
			elseif WAR.PD["三垣"][pid] >= 61 and WAR.PD["三垣"][pid] < 91 then
				str = "紫薇垣"
			else
			end
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 205 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len(str)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, str, C_GOLD, size)
			else
				lib.LoadPNG(98, 205 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, str, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
				
		--魅惑状态
		if WAR.PD["魅惑状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 40 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("魅惑状态:" .. WAR.PD["魅惑状态"][pid].."回合")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "魅惑状态:" .. WAR.PD["魅惑状态"][pid].."回合", C_GOLD, size)
			else
				lib.LoadPNG(98, 40 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "魅惑状态:" .. WAR.PD["魅惑状态"][pid].."回合", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
		if WAR.PD["魔岭玫瑰"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 620 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("万道森罗・控:" .. WAR.PD["魔岭玫瑰"][pid].."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "万道森罗・控:" .. WAR.PD["魔岭玫瑰"][pid].."时序", C_GOLD, size)
			else
				lib.LoadPNG(98, 620 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "万道森罗・控:" .. WAR.PD["魔岭玫瑰"][pid].."时序", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end		
		
		--无酒不欢：倾国状态
		if WAR.QGZT[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 21 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("反伤剩余" .. WAR.QGZT[pid].."次")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "反伤剩余" .. WAR.QGZT[pid].."次", C_GOLD, size)
			else
				lib.LoadPNG(98, 21 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "反伤剩余" .. WAR.QGZT[pid].."次", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--无酒不欢：盲目状态
		if WAR.PD["盲目状态"][pid] == 2 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 22 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("盲目状态")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "盲目状态", C_GOLD, size)
			else
				lib.LoadPNG(98, 22 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "盲目状态", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
			
		--无酒不欢：其疾如风
		--if WAR.FLHS1 == 1 and match_ID(pid,27) and WAR.ZDDH == 348  then
		if WAR.PD['疾如风'][pid] ~= nil then	
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 24 * 2 ,  CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("其疾如风")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "其疾如风", C_GOLD, size)
			else
				lib.LoadPNG(98, 24 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "其疾如风", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	

	 	if WAR.SSESS[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 25 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("一合相:" .. WAR.SSESS[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "一合相:" .. WAR.SSESS[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 25 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "一合相:" .. WAR.SSESS[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--陆渐金刚法相
	   if WAR.JGFX[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 11 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("金刚法相:" .. WAR.JGFX[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,"金刚法相:" .. WAR.JGFX[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 11 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "金刚法相:" .. WAR.JGFX[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--李寻欢 蜻蜓三抄水
		if match_ID(pid,498) then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 3 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("蜻蜓三抄水开启")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "蜻蜓三抄水开启", C_GOLD, size)
			else
				lib.LoadPNG(98, 3 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "蜻蜓三抄水开启", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
			--李寻欢 小李飞刀
		if WAR.XLFD[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 26 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("例不虚发:" .. WAR.XLFD[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "例不虚发:" .. WAR.XLFD[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 26 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "例不虚发:" .. WAR.XLFD[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end	
			--萧秋水 天剑BUFF
		if WAR.JTYJ[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 55 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len( "天剑:" .. WAR.JTYJ[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num,  "天剑:" .. WAR.JTYJ[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 55 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "天剑:" .. WAR.JTYJ[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end				
		
		--集中状态
		if WAR.Focus[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 14 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("心念合一")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "心念合一", C_GOLD, size)
			else
				lib.LoadPNG(98, 14 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "心念合一", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		--隐蔽状态
		if WAR.PD['时序闪避'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 69 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("隐蔽")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "隐蔽", C_GOLD, size)
			else
				lib.LoadPNG(98, 69 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "隐蔽", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--摄魂状态
		--if WAR.YHDF[pid] ~= nil then
		if WAR.PD['九阴摄魂'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 74 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("摄魂")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "摄魂", C_GOLD, size)
			else
				lib.LoadPNG(98, 74 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "摄魂", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--长生回天 回复
		if WAR.CSHF[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 14 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("氤氲紫气:"..WAR.CSHF[pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "氤氲紫气:"..WAR.CSHF[pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 14 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "氤氲紫气:"..WAR.CSHF[pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end

			--长生回天 回复
		if WAR.PD['长生诀'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 67 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("顾道长生:"..WAR.PD['长生诀'][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "长生回天:"..WAR.PD['长生诀'][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 67 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "顾道长生:"..WAR.PD['长生诀'][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--麻痹状态
		if WAR.PD["感电状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 29 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("感电状态"..WAR.PD["感电状态"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "感电状态"..WAR.PD["感电状态"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 29 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "感电状态"..WAR.PD["感电状态"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--麻痹状态
		if WAR.PD["麻痹状态"][pid] ~= nil and WAR.PD["麻痹状态"][pid] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 29 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("麻痹：移动-"..WAR.PD["麻痹状态"][pid])/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "麻痹：移动-"..WAR.PD["麻痹状态"][pid], C_GOLD, size)
			else
				lib.LoadPNG(98, 29 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "麻痹：移动-"..WAR.PD["麻痹状态"][pid], C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--三笑逍遥散
		if WAR.PD["三笑逍遥散"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 64 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("三笑逍遥散" .. WAR.PD["三笑逍遥散"][pid].."次")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "三笑逍遥散" .. WAR.PD["三笑逍遥散"][pid].."次", C_GOLD, size)
			else
				lib.LoadPNG(98, 64 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "三笑逍遥散" .. WAR.PD["三笑逍遥散"][pid].."次", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--锁足状态
		if WAR.PD["锁足状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 29 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("锁足状态")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "锁足状态", C_GOLD, size)
			else
				lib.LoadPNG(98, 29 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "锁足状态", C_WHITE, size)
					end	
			zt_num = zt_num + 1
		end	
		--锁足状态
		if WAR.PD["强人锁男"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 186 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("强人锁男")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "强人锁男", C_GOLD, size)
			else
				lib.LoadPNG(98, 186 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "强人锁男", C_WHITE, size)
					end	
			zt_num = zt_num + 1
		end	
			--迟缓状态
		if WAR.PD["迟缓状态"][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 64 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("迟缓" .. WAR.PD["迟缓状态"][pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "迟缓" .. WAR.PD["迟缓状态"][pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 64 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "迟缓" .. WAR.PD["迟缓状态"][pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--疾风集气状态
		if WAR.JFJQ[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 47 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("疾风" .. WAR.JFJQ[pid].."层")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "疾风" .. WAR.JFJQ[pid].."层", C_GOLD, size)
			else
				lib.LoadPNG(98, 47 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "疾风" .. WAR.JFJQ[pid].."层", C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--集气上升
		if WAR.PD['集气速度'][pid] ~= nil then
			if WAR.PD['集气速度'][pid] > 0 then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 48 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("集气上升")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "集气上升", C_GOLD, size)
				else
					lib.LoadPNG(98, 48 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "集气上升", C_WHITE, size)
				end	
				zt_num = zt_num + 1
			elseif WAR.PD['集气速度'][pid] < 0 and (not QGQH(pid,186,1)) then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 454 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("集气下降")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "集气下降", C_GOLD, size)
				else
					lib.LoadPNG(98, 454 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "集气下降", C_WHITE, size)
				end	
				zt_num = zt_num + 1
			end	
		end
		--机率下降
		if WAR.PD['机率下降'][pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 455 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("机率下降")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "机率下降", C_GOLD, size)
			else
				lib.LoadPNG(98, 455 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "机率下降", C_WHITE, size)
			end	
			zt_num = zt_num + 1
		end	
		--逍遥御风
		if XiaoYaoYF(pid)  then
			local count = WAR.XYYF[pid] or 0
			local count1 = WAR.PD['逍遥御风闪避'][pid]
			if WAR.PD['逍遥御风闪避'][pid] == nil  then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 105 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("逍遥御风:"..count)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "逍遥御风:"..count, C_GOLD, size)
				else
					lib.LoadPNG(98, 105 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "逍遥御风:"..count, C_WHITE, size)
				end
			else
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 44 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("逍遥御风"..count1)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "逍遥御风"..count1, C_GOLD, size)
				else
					lib.LoadPNG(98, 44 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "逍遥御风"..count1, C_WHITE, size)
				end
			end
			zt_num = zt_num + 1
		end	
		--张家辉的隐身戒指
		if JY.Person[pid]["防具"] == 304 then
			if WAR.YSJZ == 0 then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 30 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("隐匿中……")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "隐匿中……", C_GOLD, size)
				else
					lib.LoadPNG(98, 30 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "隐匿中……", C_WHITE, size)
				end
			else
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 31 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("下次隐匿:"..WAR.YSJZ)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "下次隐匿:"..WAR.YSJZ, C_GOLD, size)
				else
					lib.LoadPNG(98, 31 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "下次隐匿:"..WAR.YSJZ, C_WHITE, size)
				end
			end
			zt_num = zt_num + 1
		end
		--中庸内置CD
		if ZhongYongZD1(pid) then
	        local cd = WAR.PD['中庸'][pid] or 0
	        local mcd = 25
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 124 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("中庸CD:"..mcd)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "中庸CD:"..mcd, C_GOLD, size)
			else
				lib.LoadPNG(98, 124 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "中庸CD:"..mcd, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		
		if ZhongYongZD2(pid)  then
	        local cd = WAR.PD['中庸'][pid] or 0
	        local mcd = 25
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 124 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("中庸JL:"..mcd)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "中庸JL:"..mcd, C_GOLD, size)
				else
					lib.LoadPNG(98, 124 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "中庸JL:"..mcd, C_WHITE, size)
				end
			zt_num = zt_num + 1
		end
		--指挥CD
		if  match_ID(pid,74) then
		 if  WAR.HQT_CD == 0  then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 118 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("指挥可使用")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "指挥可使用", C_GOLD, size)
				else
					lib.LoadPNG(98, 118 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "指挥可使用", C_WHITE, size)
				end
			   else
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 119 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2 )
					DrawString(CC.ScreenW/1360*705+bx*380-string.len("指挥CD:"..WAR.HQT_CD.."时序")/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "指挥CD:"..WAR.HQT_CD.."时序", C_GOLD, size)
				else
					lib.LoadPNG(98, 119 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
					DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num,"指挥CD:"..WAR.HQT_CD.."时序", C_WHITE, size)
				end
				end
			zt_num = zt_num + 1
		end		
		--绝影闪
		if pid == 0 and JY.Base["标准"] > 0 and WAR.JYS > 0  then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 3 * 2 , CC.ScreenW/1360*705+bx*424, CC.ScreenH/768*667 -(size*2+CC.RowPixel*2)*zt_num+by*67, 2)
				DrawString(CC.ScreenW/1360*705+bx*380-string.len("绝影闪次数:" ..WAR.JYS)/2*size, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num, "绝影闪次数:"..WAR.JYS, C_GOLD, size)
			else
				lib.LoadPNG(98, 3 * 2 , x1 + width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*zt_num, 1)
				DrawString(x1 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*zt_num, "绝影闪次数:" ..WAR.JYS, C_WHITE, size)
			end
			zt_num = zt_num + 1
		end
		--第二排显示增益buff
		local zt_num1 = 0
		--复活显示
		if WAR.FUHUOZT[pid]~= nil then
			local count = WAR.PD['复活・长生'][pid] or 0
			if WAR.PD['复活・长生'][pid] == nil then
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 1 * 2 , x1 -195- size*9- CC.RowPixel, CC.ScreenH - size*2 - CC.RowPixel*2 - (size*2+CC.RowPixel*2)*zt_num1, 1)
					DrawString(x1 - 195 - size*6- CC.RowPixel, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num1, "已复活", C_WHITE, size)
				else
					lib.LoadPNG(98, 1 * 2 , x1 +195+ width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), 1)
					DrawString(x1 + 195 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), "已复活", C_WHITE, size)
				end
				zt_num1 = zt_num1 + 1
			else
				if WAR.Person[id]["我方"] == true then
					lib.LoadPNG(98, 1 * 2 , x1 -195- size*9- CC.RowPixel, CC.ScreenH - size*2 - CC.RowPixel*2 - (size*2+CC.RowPixel*2)*zt_num1, 1)
					DrawString(x1 - 195 - size*6- CC.RowPixel, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num1, "已复活"..count.."次", C_WHITE, size)
				else
					lib.LoadPNG(98, 1 * 2 , x1 +195+ width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), 1)
					DrawString(x1 + 195 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), "已复活"..count.."次", C_WHITE, size)
				end
				zt_num1 = zt_num1 + 1
			end
		end
		--迷踪步显示
		if pid == 0 and JY.Person[615]["论剑奖励"] == 1 and JY.Base['标准'] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 3 * 2 , x1 -195- size*9- CC.RowPixel, CC.ScreenH - size*2 - CC.RowPixel*2 - (size*2+CC.RowPixel*2)*zt_num1, 1)
				DrawString(x1 - 195 - size*6- CC.RowPixel, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num1, "迷踪步开启", C_WHITE, size)
			else
				lib.LoadPNG(98, 3 * 2 , x1 +195+ width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), 1)
				DrawString(x1 + 195 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), "迷踪步开启", C_WHITE, size)
			end
			zt_num1 = zt_num1 + 1
		end
		--血战到底
		if WAR.PD['血战到底'][pid]~= nil and WAR.PD['血战到底'][pid] == 1 then	
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 147 * 2 , x1 -195- size*9- CC.RowPixel, CC.ScreenH - size*2 - CC.RowPixel*2 - (size*2+CC.RowPixel*2)*zt_num1, 1)
				DrawString(x1 - 195 - size*6- CC.RowPixel, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num1, "血战到底", C_WHITE, size)
			else
				lib.LoadPNG(98, 147 * 2 , x1 +195+ width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), 1)
				DrawString(x1 + 195 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), "血战到底", C_WHITE, size)
			end
			zt_num1 = zt_num1 + 1
		end
		--极限挑战显示
		if pid == 0 and JY.Person[456]["论剑奖励"] > 0 then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 371 * 2 , x1 -195- size*9- CC.RowPixel, CC.ScreenH - size*2 - CC.RowPixel*2 - (size*2+CC.RowPixel*2)*zt_num1, 1)
				DrawString(x1 - 195 - size*6- CC.RowPixel, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num1, "极限模式", C_WHITE, size)
			else
				lib.LoadPNG(98, 371 * 2 , x1 +195+ width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), 1)
				DrawString(x1 + 195 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), "极限模式", C_WHITE, size)
			end
			zt_num1 = zt_num1 + 1
		end
		--霸体状态
		if WAR.BTZT[pid] ~= nil then
			if WAR.Person[id]["我方"] == true then
				lib.LoadPNG(98, 8 * 2 , x1 -195- size*9- CC.RowPixel, CC.ScreenH - size*2 - CC.RowPixel*2 - (size*2+CC.RowPixel*2)*zt_num1, 1)
				DrawString(x1 - 195 - size*6- CC.RowPixel, CC.ScreenH - size - CC.RowPixel*3 + 1 - (size*2+CC.RowPixel*2)*zt_num1, "霸体状态", C_WHITE, size)
			else
				lib.LoadPNG(98, 8 * 2 , x1 +195+ width + CC.RowPixel, CC.RowPixel + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), 1)
				DrawString(x1 + 195 + width + size*2 + CC.RowPixel*3, size + 3 + (size*2+CC.RowPixel*2)*(zt_num1+1), "霸体状态", C_WHITE, size)
			end
			zt_num1 = zt_num1 + 1
		end
	--------------------------------------------------------------------------------------------------------------------------
	x1 = x1 + CC.RowPixel
	y1 = y1 + CC.RowPixel + CC.ScreenH/6 - 12
	local color = nil
	if p["受伤程度"] < p["中毒程度"] then
		if p["中毒程度"] == 0 then
			color = RGB(252, 148, 16)
		elseif p["中毒程度"] < 50 then
			color = RGB(120, 208, 88)
		else
			color = RGB(56, 136, 36)
		end
	elseif p["受伤程度"] < 33 then
		color = RGB(236, 200, 40)
	elseif p["受伤程度"] < 66 then
		color = RGB(244, 128, 32)
	else
		color = RGB(232, 32, 44)
	end
	local yy1 = y1 + CC.RowPixel + CC.ScreenH/15 - 100
	local zi = {}
	local name = p["姓名"]
  local namelen  = string.len(name) / 2	
	local chain = 0
	for i = 1,namelen do
		zi[i] = string.sub(name, i * 2 - 1, i * 2)
		if WAR.Person[id]['我方'] == true then
			DrawString(x1, yy1+12-156, zi[i], color, CC.DefaultFont*0.9)
		else
			DrawString(x1, yy1+12-156, zi[i], color, CC.DefaultFont*0.9)
		end		
		yy1 = yy1 + CC.DefaultFont*0.9
	end
	--有运功时的显示
	
	local ayy1 = y1 + CC.RowPixel + CC.ScreenH*0.05 +CC.DefaultFont-12
	if WAR.Person[id]['我方'] == false then
		ayy1 = y1 + CC.RowPixel + CC.ScreenH*0.038 +CC.DefaultFont-12
	end	
	if p["主运内功"] > 0 then
		DrawString(x1+60, ayy1-47-CC.DefaultFont*2,JY.Wugong[p["主运内功"]]["名称"], TG_Red_Bright, CC.DefaultFont*0.7)
	else
		DrawString(x1+60, ayy1-47-CC.DefaultFont*2,"未运功", TG_Red_Bright, CC.DefaultFont*0.7)
	--end		
	end

	local ayy2 = y1 + CC.RowPixel + CC.ScreenH*0.083 +CC.DefaultFont-10
	if WAR.Person[id]['我方'] == false then
		ayy2 = y1 + CC.RowPixel + CC.ScreenH*0.075 +CC.DefaultFont-10
	end 
	if p["门派技能1"] > 1 then
		DrawString(x1+60, ayy2-47-CC.DefaultFont*2,JY.Wugong[p["门派技能1"]]["名称"], TG_Red_Bright, CC.DefaultFont*0.7)
	elseif p["门派技能1"] == 1 then
		DrawString(x1+60, ayy2-47-CC.DefaultFont*2,"未运功", TG_Red_Bright, CC.DefaultFont*0.7)
	else
		DrawString(x1+60, ayy2-47-CC.DefaultFont*2,"未开启", TG_Red_Bright, CC.DefaultFont*0.7)	
	end
	--连锁
	if WAR.Person[WAR.CurID]["我方"] then
	    chain = WAR.MYCHAIN
	else
	    chain = WAR.URCHAIN
	end
	
	local ayy3 =y1 + CC.RowPixel + CC.ScreenH/10 +CC.DefaultFont-11
	if WAR.Person[id]['我方'] == false then
		ayy3 = y1 + CC.RowPixel + CC.ScreenH*0.1 +CC.DefaultFont-16
	end
	if p["主运轻功"] > 0 then
		DrawString(x1+60, ayy3-30-CC.DefaultFont*2, JY.Wugong[p["主运轻功"]]["名称"], M_DeepSkyBlue, CC.DefaultFont*0.7)
	else
		DrawString(x1+60, ayy3-30-CC.DefaultFont*2, "未运功", M_DeepSkyBlue, CC.DefaultFont*0.7)
	end	
	--颜色条
	local pcx = x1 + 3 - CC.RowPixel + 2;
	local pcy = y1 + CC.RowPixel +1+30
  local pcx1 = x1 + 3 - CC.RowPixel + 2+9;
  if WAR.Person[id]['我方'] == false then
  	pcy = y1 + CC.RowPixel +1+25
  end		
	--生命条
	lib.LoadPNG(91, 35 * 2 , pcx  , pcy, 1)
	local pcw, pch = lib.GetPNGXY(91, 31 * 2);  
	lib.SetClip(pcx1, pcy, pcx1 + (p["生命"]/p["生命最大值"])*(pcw-10), pcy + pch)
	lib.LoadPNG(91, 31 * 2 , pcx  , pcy, 1)
	pcy = pcy + CC.RowPixel + size -2
	lib.SetClip(0,0,0,0)
  
	--内力条
	lib.LoadPNG(91, 35 * 2 , pcx  , pcy, 1)
	local pcw, pch = lib.GetPNGXY(91, 32 * 2);
	lib.SetClip(pcx1, pcy, pcx1+ (p["内力"]/p["内力最大值"])*(pcw-18), pcy+ pch)
	lib.LoadPNG(91, 32 * 2 , pcx  , pcy, 1)
	pcy = pcy + CC.RowPixel + size -2
	lib.SetClip(0,0,0,0)
  
	--体力条
	lib.LoadPNG(91, 35 * 2 , pcx  , pcy, 1)
	local pcw, pch = lib.GetPNGXY(91, 34 * 2);
	lib.SetClip(pcx, pcy, pcx + (p["体力"]/100)*(pcw-10), pcy + pch)
	lib.LoadPNG(91, 34 * 2 , pcx  , pcy, 1)
	pcy = pcy + CC.RowPixel + size -2
	lib.SetClip(0,0,0,0)
  
	local lifexs = "命 "..p["生命"]
	local nlxs = "内 "..p["内力"]
	local tlxs = "体 "..p["体力"]
	local lqzxs = WAR.LQZ[pid] or 0;	--怒气
	local zdxs = p["中毒程度"]
  
	local nsxs = p["受伤程度"];		--内伤
	local bfxs = p["冰封程度"];		--冰封
	local zsxs = p["灼烧程度"];		--灼烧
	local fxxs = p["封穴程度"]--WAR.FXDS[pid] or 0;		--封穴
	local lxxs = p["流血程度"]--WAR.LXZT[pid] or 0;		--流血
	local zyxs = WAR.SPIRIT[pid] or 0
  
  local stry1 = y1
  if WAR.Person[id]['我方'] == true then
  	stry1 = y1 +5
  end	
	DrawString(x1 + 9, stry1 + 6+29, lifexs, M_White, CC.FontSMALL)
	DrawString(x1 + 9, stry1 + size + 11+29, nlxs, M_White, CC.FontSMALL)
	DrawString(x1 + 9, stry1 + 2*size + 16+29, tlxs, M_White, CC.FontSMALL)

	y1 = y1 + 3*(CC.RowPixel + size) + 4
  if WAR.Person[id]['我方'] == false then
  	y1 = y1-7
  end
	local myx1 = 3;
	local myy1 = 28;
	--怒气
	--DrawString(x1 + myx1, y1 + myy1, "怒气", C_RED, size)
	if lqzxs == 100 then
		lqzxs = "极"
	end
	DrawString(x1 + myx1 + size*2 + 10, y1 + myy1, lqzxs, C_RED, size)
	
	myx1 = 3;
	myx1 = myx1 + size * 4;
	if zyxs == 200 then
		zyxs = "爆"
	end 
	DrawString(x1 + size*5/2 + myx1, y1 + myy1, zyxs, M_DeepSkyBlue, size)

	--冰封
	myx1 = 3;
	myy1 = myy1 + size + 2;
	if bfxs == 100 then
		bfxs = "极"
	end	
	DrawString(x1 + myx1 + size*2 + 10, y1 + myy1, bfxs, M_LightBlue, size)
	--灼烧
	myx1 = myx1 + size * 4;
	if zsxs == 100 then
		zsxs = "极"
	end
  	DrawString(x1 + size*5/2 + myx1, y1 + myy1, zsxs, C_ORANGE, size)
	--封穴
	myx1 = 3;
	myy1 = myy1 + size + 2;
	if fxxs == 50 then
		fxxs = "极"
	end
	DrawString(x1 + myx1 + size*2 + 10, y1 + myy1, fxxs, C_GOLD, size)
	--流血
	myx1 = myx1 + size * 4;
	if lxxs == 100 then
		lxxs = "极"
	end
  	DrawString(x1 + size*5/2 + myx1, y1 + myy1, lxxs, M_DarkRed, size)
	--内伤
	myx1 = 3;
	myy1 = myy1 + size + 2;
	if nsxs == 100 then
		nsxs = "极"
	end
	DrawString(x1 + myx1 + size*2 + 10, y1 + myy1, nsxs, PinkRed, size)
	--中毒
	myx1 = myx1 + size * 4;
	if zdxs == 150 then
		zdxs = "极"
	end
	DrawString(x1 + size*5/2 + myx1, y1 + myy1, zdxs, LimeGreen, size)	
	
	if WAR.Person[id]["我方"] == false then
		y1 = y1 + 3*(CC.RowPixel + size) +16
	   lib.LoadPNG(91, 27 * 2 ,x1-6,y1+25, 1)	 
		local hl = 1
		for i = 1, 4 do
			local wp = p["携带物品" .. i]
			local wps = p["携带物品数量" .. i]
			if wp >= 0 then
				local wpm = JY.Thing[wp]["名称"]
				DrawString(x1+2, y1 + hl * (size+CC.RowPixel) , wpm .. wps, C_WHITE, size)
				hl = hl + 1
			end
		end
	end
end

--自动选择合适的武功
function War_AutoSelectWugong()
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local probability = {}
	local wugongnum = JY.Base["武功数量"]
	for i = 1, JY.Base["武功数量"] do
		local wugongid = JY.Person[pid]["武功" .. i]
		if wugongid > 0 then
			if JY.Wugong[wugongid]["伤害类型"] == 0 then
		  
				--选择杀生命的武功，必须消耗内力比现有内力小，起码可以发出一级的武功。
				if JY.Wugong[wugongid]["消耗内力点数"] <= JY.Person[pid]["内力"] then
					local level = math.modf(JY.Person[pid]["武功等级" .. i] / 100) + 1
					probability[i] = get_skill_power(pid, wugongid, level)	--无酒不欢：采用新公式
				else
					probability[i] = 0
				end
				
				--轻功不可攻击特技不可攻击
				if JY.Wugong[wugongid]["武功类型"] == 7 or wugongid == 85 or wugongid == 87 or wugongid == 88 or wugongid == 144 or wugongid == 175  or wugongid == 182  or wugongid == 199 or wugongid == 43  then
					probability[i] = 0
				end
					
				--内功攻击
				if yongnei(wugongid)  then
				
					if isteam(pid) == false and i == 1 then 				--NPC会用第一格内功
					
					elseif pid == 0 and JY.Base["畅想"] > 0 and i == 1 then --畅想会用第一格内功
			  
					elseif wugongid == 105 and (match_ID(pid, 36) or match_ID(pid, 27))then		--林平之 东方 使用葵花神功
					
					elseif wugongid == 102 and JXPD(pid, 38, 1) then		--石破天 使用太玄神功
					elseif wugongid == 106 and match_ID(pid, 638) then		--斗酒僧 九阳神功					
					
					elseif wugongid == 106 and match_ID(pid, 9) then		--张无忌 使用九阳神功
					
					elseif wugongid == 94 and match_ID(pid, 37) then		--狄云 使用神经照
					
					elseif wugongid == 108 and match_ID(pid, 114) then		--扫地 使用易筋经
					
					elseif wugongid == 93 and match_ID(pid, 66) then		--小昭 使用圣火
					
					elseif wugongid == 104 and match_ID(pid, 60) then		--欧阳锋 使用逆运
					
					elseif wugongid == 103 and (match_ID(pid, 39) or match_ID(pid, 40))then		--侠客岛主 使用龙象
						
					elseif --[[(pid == 0 and GetS(4, 5, 5, 5) == 5) or --]]actor(pid,6) or match_ID(pid, 9985) or match_ID(pid, 577) then		--天罡  诸行无常使用内功
						
					else
						probability[i] = 0
					end
				end

				--斗转星移
				if wugongid == 43 and match_ID(pid, 51) == false and match_ID(pid, 679) == false then
					probability[i] = 0
				end
				
				--乔峰不用打狗
				if wugongid == 80 and pid == 50 then
					probability[i] = 0
				end
				
				--商剑鸣不用八卦刀
				if wugongid == 231 and pid == 722 then
					probability[i] = 0
				end
				--商夫人不用八卦掌
				if wugongid == 230 and pid == 737 then
					probability[i] = 0
				end
				
				--黄药师不用玉萧落英
				if (wugongid == 12 or wugongid == 38) and pid == 57 then
					probability[i] = 0
				end
				
				--葵尊不用透骨寒袖
				if (wugongid == 127 or wugongid == 201) and (pid == 27 or pid == 777) then
					probability[i] = 0
				end
				
				--周伯通不用太极拳
				if wugongid == 16 and pid == 64 then
					probability[i] = 0
				end
				--慕容博不用参合剑气
				if wugongid == 265 and pid == 113 then
					probability[i] = 0
				end
				--斗酒不使用九阳神功
				if wugongid == 106 and pid == 638 then
					probability[i] = 0
				end
				--何足道不使用胡刀苗剑、金乌雪山
				if (wugongid == 35 or wugongid == 44 or wugongid == 55 or wugongid == 61 or wugongid == 67) and pid == 586 then
					probability[i] = 0
				end
				--二十大欧阳锋不用逆运蛤蟆
				if (wugongid == 95 or wugongid == 104) and pid == 60 and WAR.ZDDH == 289 then
					probability[i] = 0
				end
				--圣火三使不用圣火神功
				if wugongid == 174 and (pid == 173 or pid == 174 or pid == 175) then
					probability[i] = 0
				end	
				--襄阳金轮不用龙象
				--神邪战三绝不用龙象
				--二十大不用龙象
				if wugongid == 103 and pid == 62 and (WAR.ZDDH == 275 or WAR.ZDDH == 277 or WAR.ZDDH == 289) then
					probability[i] = 0
				end
				
				--刀剑归真胡一刀不用苗剑
				if wugongid == 44 and pid == 633 and WAR.ZDDH == 280 then
					probability[i] = 0
				end
				
				--刀剑合璧苗人凤不用胡刀
				if wugongid == 67 and pid == 3 and WAR.ZDDH == 280 then
					probability[i] = 0
				end
				
				if wugongid == 4 and pid == 311 and WAR.ZDDH == 314 then
					probability[i] = 0
				end
				if wugongid == 105 and (pid == 27 or pid == 777) then
					probability[i] = 0
				end
				--左冷禅不用其他几个五岳剑法
				if pid == 22  and (wugongid == 30 or wugongid == 31 or wugongid == 32 or wugongid == 34) then
					probability[i] = 0
				end
			else
				probability[i] = 0		 --自动不会杀内力
			end
		else
			wugongnum = i - 1
			break;
		end
	end
  
	if wugongnum ==  0 then			--如果没有武功，直接返回-1
		return -1;
	end

	local maxoffense = 0			--计算最大攻击力
	for i = 1, wugongnum do
		if maxoffense < probability[i] then
			maxoffense = probability[i]
		end
	end
	
	local mynum = 0					--计算我方和敌人个数
	local enemynum = 0
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["死亡"] == false then
			if WAR.Person[i]["我方"] == WAR.Person[WAR.CurID]["我方"] then
				mynum = mynum + 1
			else
				enemynum = enemynum + 1
			end
		end
	end
	
	
	local factor = 0			--敌人人数影响因子，敌人多则对线面等攻击多人武功的选择概率增加
	if mynum < enemynum then
		factor = 2
	else
		factor = 1
	end
	
	for i = 1, wugongnum do		--考虑其他概率效果
		local wugongid = JY.Person[pid]["武功" .. i]
		if probability[i] > 0 then
			if probability[i] < maxoffense*3/4 then		--去掉攻击力小的武功
				probability[i] = 0
			else
				local level = math.modf(JY.Person[pid]["武功等级" .. i] / 100) + 1
				probability[i] = probability[i] + JY.Wugong[wugongid]["移动范围".. level]  * factor*10
				if JY.Wugong[wugongid]["杀伤范围" .. level] > 0 then
					probability[i] = probability[i] + JY.Wugong[wugongid]["杀伤范围" .. level]* factor*10
				end
			end
		end
	end
	
	local s = {}			--按照概率依次累加
	local maxnum = 0
	for i = 1, wugongnum do
		s[i] = maxnum
		maxnum = maxnum + probability[i]
	end
	s[wugongnum + 1] = maxnum
	if maxnum == 0 then		--没有可以选择的武功
		return -1
	end
	
	local v = Rnd(maxnum)		--产生随机数
	local selectid = 0
	for i = 1, wugongnum do		--根据产生的随机数，寻找落在哪个武功区间
		if s[i] <= v and v < s[i + 1] then
			selectid = i
		end
	end
	return selectid
end

--战斗武功选择菜单
--sb star为无意义参数，仅为防止代码语法错误跳出
function War_FightMenu(sb, star, wgnum)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local numwugong = 0
	local menu = {}
	local canuse = {}
	local c = 0;
	for i = 1, JY.Base["武功数量"] do
		local tmp = JY.Person[pid]["武功" .. i]
		if tmp > 0 then
			menu[i] = {JY.Wugong[tmp]["名称"], nil, 1}
	
			--内功无法攻击
			--游坦之可以 标记修改
			if (match_ID(pid, 9985) == false) and yongnei(tmp) then
				menu[i][3] = 0
			end
			
			--轻功无法攻击
			if JY.Wugong[tmp]["武功类型"] == 7 or (tmp == 85 or tmp == 87 or tmp == 88 or tmp == 144 or tmp == 175  or tmp == 182  or tmp == 199) then
				menu[i][3] = 0
			end
		
			--除公孙止外，阴阳倒乱都不能用来攻击
			if match_ID(pid,616) == false and tmp == 77 then
				menu[i][3] = 0
			end	
			--如果主角是天罡，内功可攻击，畅想第一格内功可攻击
			if (actor(pid,6) or (pid == 0 and JY.Base["畅想"] > 0 and i == 1)) and yongnei(tmp) then
				menu[i][3] = 1
			end
			--林平之 东方 萧半和 显示葵花神功
			if tmp == 105 and (match_ID(pid, 36) or match_ID(pid, 27) or match_ID(pid, 189) or match_ID(pid, 777)) then
				menu[i][3] = 1
			end
		   
			--石破天 显示太玄神功
			if tmp == 102 and JXPD(pid, 38, 1) then
				menu[i][3] = 1
			end
		  
			--张无忌 显示九阳神功
			if tmp == 106 and match_ID(pid, 9) then
				menu[i][3] = 1
			end
			--斗酒僧 显示九阳神功
			if tmp == 106 and match_ID(pid, 638) then
				menu[i][3] = 1
			end			
		  
			--狄云 显示神经照
			if tmp == 94 and match_ID(pid, 37) then
				menu[i][3] = 1
			end
		  		  
			--欧阳锋 显示逆运
			if tmp == 104 and match_ID(pid, 60) then
				menu[i][3] = 1
			end

			--小昭 显示圣火
			if tmp == 93 and match_ID(pid, 66) then
				menu[i][3] = 1
			end
		  
			--内力少不显示
			if JY.Person[pid]["内力"] < JY.Wugong[tmp]["消耗内力点数"] then
				menu[i][3] = 0
			end

			--体力低于10不显示
			if JY.Person[pid]["体力"] < 10 then
				menu[i][3] = 0
			end
			  
			numwugong = numwugong + 1
		  
			if menu[i][3] == 1 then
				c = c + 1
				canuse[c] = i
			end
		end
	end
	if c == 0 then
		return 0
	end
	if wgnum == nil then
		local r = nil
		r = Cat('菜单',menu, numwugong, 0,CC.MainMenuX, CC.MainMenuY, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
		if r == 0 then
			return 0
		end
		WAR.ShowHead = 0
		if freefight(pid) then    --逍遥派无视障碍
		    WAR.WSZA[pid] = 1
		end
		local r2 = War_Fight_Sub(WAR.CurID, r)
		WAR.WSZA[pid] = 1          --逍遥派无视障碍
		WAR.ShowHead = 1
		Cls()
		return r2
	--无酒不欢：数字快捷键直接使用武功
	else
		if wgnum <= c then
			WAR.ShowHead = 0
			local r2 = War_Fight_Sub(WAR.CurID, canuse[wgnum])
			WAR.ShowHead = 1
			Cls()
			return r2
		else
			return 0
		end
	end
end
--自动战斗
function War_Auto()
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	WAR.ShowHead = 1
	Cat('实时特效动画')
    WarDrawMap(0)
    Cat('实时特效动画2')
	ShowScreen()
	lib.Delay(CC.BattleDelay)
	WAR.ShowHead = 0
	if CC.AutoWarShowHead == 1 then
		WAR.ShowHead = 1
	end
    if WAR.PD["混乱状态"][pid] ~= nil or WAR.PD["荒天龙灭"][pid] ~= nil then 
        Cat('随机移动')
    end

    --随机移动
    local tf57 = hastf(WAR.CurID,57,2)
    if tf57 ~= nil then
        for i = 0,WAR.PersonNum - 1 do
            if WAR.Person[i]['死亡'] == false and WAR.Person[i]['我方'] ~= WAR.Person[WAR.CurID]['我方'] then
                local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
                local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
                if offset1 <= 9 and offset2 <= 9 and math.random(100) <= 25 then
                    Cat('随机移动')
                end
            end
        end
    end

	local autotype = War_Think()
	--一言止杀
    if autotype == 1 and WAR.PD["恐惧状态"][pid] ~= nil then
		WarDrawMap(0); --不加这条则动画位置无法正常显示
		CurIDTXDH(WAR.CurID, 122,1,"止杀状态中",C_ORANGE)
	    autotype =0
	end
	
	if autotype == 1 and WAR.PD["放下屠刀"][pid] ~= nil and math.random(10) < 5 then
		WarDrawMap(0); --不加这条则动画位置无法正常显示
		CurIDTXDH(WAR.CurID, 155,1,"我佛慈悲",C_ORANGE)
	    autotype =0
	end
	
	if autotype == 1 and JLSD(0,30,pid) and WAR.PD["荒天龙灭"][pid] ~= nil then
		WarDrawMap(0); --不加这条则动画位置无法正常显示
		CurIDTXDH(WAR.CurID, 372,1,"荒天龙灭",C_ORANGE)
	    autotype =0
	end
	
	if autotype == 1 and WAR.PD["封印"][pid] ~= nil then
		WarDrawMap(0); --不加这条则动画位置无法正常显示
		CurIDTXDH(WAR.CurID, 78,1,"诸般封印",C_ORANGE)
	    autotype =0
	end
	--连锁
	local chain 
	if WAR.Person[WAR.CurID]["我方"] then
		chain = WAR.MYCHAIN
	else
	    chain = WAR.URCHAIN
	end
    
	if WAR.PD["受想行识"][pid] == 1 then
		autotype = 0
	end
	if WAR.PD["三尸脑神丹"][pid] ~= nil then
		autotype = 1
	end
	if autotype == 0 then
		War_AutoEscape()
		War_RestMenu()
	elseif autotype == 1 then
		War_AutoFight()
        --say('1',1)
	elseif autotype == 2 then
		War_AutoEscape()
		War_AutoEatDrug(2)
	elseif autotype == 3 then
		War_AutoEscape()
		War_AutoEatDrug(3)
	elseif autotype == 4 then
		War_AutoEscape()
		War_AutoEatDrug(4)
	elseif autotype == 5 then
		War_AutoEscape()
		War_AutoDoctor()
	elseif autotype == 6 then
		War_AutoEscape()
		War_AutoEatDrug(6)
	elseif autotype == 7 then
		War_RestMenu()
	elseif autotype == 8 then
		War_DefupMenu()
	end
	return 0
end

--自动战斗时 做思考
--吃药的flag：2 生命；3内力；4体力；6 解毒
function War_Think()
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local r = -1
	local minNeili = War_GetMinNeiLi(pid)
	local can_eat_drug = 0
	--非我方，会考虑吃药
	if WAR.Person[WAR.CurID]["我方"] == false then
		can_eat_drug = 1
	--如果是我方，只有在队且允许才会吃药
	else
		if isteam(pid) and JY.Person[pid]["是否吃药"] == 1 then
			can_eat_drug = 1
		end
	end
	--侠客正岛主战不吃药
	--洪七公居洪七公不吃药
	if WAR.Person[WAR.CurID]["我方"] == false and (WAR.ZDDH == 188 or WAR.ZDDH == 257) then
		can_eat_drug = 0
	end
	--可以吃药的话
	if can_eat_drug == 1 then 
		--吃体力药
		local eat_eng_drug = 0
		if isteam(pid) then
			local fz = {50, 30, 10}
			if JY.Person[pid]["体力"] < fz[JY.Person[pid]["体力阈值"]] then
				eat_eng_drug = 1
			end
		else
			if JY.Person[pid]["体力"] < 10 then
				eat_eng_drug = 1
			end
		end
		if eat_eng_drug == 1 then
			r = War_ThinkDrug(4)
			if r >= 0 then
			  return r
			end
			return 0
		end
		
		--吃血药
		local eat_hp_drug = 0
		if isteam(pid) then
			local fz = {0.7, 0.5, 0.3}
			if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"]*fz[JY.Person[pid]["生命阈值"]] then
				eat_hp_drug = 1
			end
		else
			--根据生命确定吃血药几率
			local rate = -1
			if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 5 then
				rate = 90
			elseif JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 4 then
				rate = 70
			elseif JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 3 then
				rate = 50
			elseif JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 2 then
				rate = 25
			end
			
			--内伤也增加吃血药几率
			if JY.Person[pid]["受伤程度"] > 50 then
				rate = rate + 50
			end
			
			--暴气时，不吃药
			if Rnd(100) < rate and WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] ~= 100 then
				eat_hp_drug = 1
			end
		end
		if eat_hp_drug == 1 then
			r = War_ThinkDrug(2)
			if r >= 0 then				--如果有药吃药
				return r
			else
				r = War_ThinkDoctor()		--如果没有药，考虑医疗
				if r >= 0 then
					return r
				end
			end
		end
		
		--吃内力药
		local eat_mp_drug = 0
		if isteam(pid) then
			local fz = {0.7, 0.5, 0.3}
			if JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"]*fz[JY.Person[pid]["内力阈值"]] then
				eat_mp_drug = 1
			end
		else
			--考虑内力
			local rate = -1
			if JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] / 6 then
				rate = 100
			elseif JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] / 5 then
				rate = 75
			elseif JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] / 4 then
				rate = 50
			end

			if Rnd(100) < rate or minNeili > JY.Person[pid]["内力"] then
				eat_mp_drug = 1
			end
		end
		if eat_mp_drug == 1 then
			r = War_ThinkDrug(3)
			if r >= 0 then
				return r
			end
		end
	  
		local jdrate = -1
		if CC.PersonAttribMax["中毒程度"] * 3 / 4 < JY.Person[pid]["中毒程度"] then
			jdrate = 60
		else
			if CC.PersonAttribMax["中毒程度"] / 2 < JY.Person[pid]["中毒程度"] then
				jdrate = 30
			end
		end
	  
		--半血以下吃解毒药
		--暴怒不吃解毒药
		if Rnd(100) < jdrate and JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 2 and WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] ~= 100 then
			r = War_ThinkDrug(6)
			if r >= 0 then
				return r
			end
		end
	end
	
	if isteam(pid) then 
		if JY.Person[pid]["行为模式"] == 4 then
			r = 0
		elseif JY.Person[pid]["行为模式"] == 3 then
			r = 7
		elseif JY.Person[pid]["行为模式"] == 2 then
			r = 8
		elseif JY.Person[pid]["行为模式"] == 1 then
			if minNeili <= JY.Person[pid]["内力"] and JY.Person[pid]["体力"] > 10 then
				r = 1
			else
				r = 0
			end
		end
	else
		if minNeili <= JY.Person[pid]["内力"] and JY.Person[pid]["体力"] > 10 then
			r = 1
		else
			r = 0
		end
	end
	return r
end

--自动攻击
function War_AutoFight()
	local pid = WAR.Person[WAR.CurID]["人物编号"]
    local wugongnum;

	if JY.Person[pid]["优先使用"] ~= 0 then
		for i = 1, JY.Base["武功数量"] do
			if JY.Person[pid]["武功"..i] == JY.Person[pid]["优先使用"] then
				wugongnum = i
				break
			end
		end
		--加一条防止被洗掉等意外
		if wugongnum == nil then
			wugongnum = War_AutoSelectWugong()
		end
	else
		wugongnum = War_AutoSelectWugong()
    end
	if wugongnum <= 0 then
		War_AutoEscape()
		War_RestMenu()
		return 
	end
	unnamed(wugongnum)
end

--人物升级
function War_AddPersonLVUP(pid)
	local tmplevel = JY.Person[pid]["等级"]
	if CC.Level <= tmplevel then
		return false
	end
	if JY.Person[pid]["经验"] < CC.Exp[tmplevel] then
		return false
	end
	while CC.Exp[tmplevel] <= JY.Person[pid]["经验"] do
		tmplevel = tmplevel + 1
		if CC.Level <= tmplevel then
			break;
		end
	end
    
    tmplevel = 30
    
	DrawStrBoxWaitKey(string.format("%s 升级了", JY.Person[pid]["姓名"]), C_WHITE, CC.DefaultFont)
	--计算提升的等级
	local leveladd = tmplevel - JY.Person[pid]["等级"]
	
	JY.Person[pid]["等级"] = 30--JY.Person[pid]["等级"] + leveladd
	
	--提高生命增长
	--AddPersonAttrib(pid, "生命最大值", (JY.Person[pid]["生命增长"] ) * leveladd * 4)
	Hp_Max(pid)
	JY.Person[pid]["体力"] = CC.PersonAttribMax["体力"]
	JY.Person[pid]["受伤程度"] = 0
	JY.Person[pid]["中毒程度"] = 0
    
	local theadd = JY.Person[pid]["资质"] / 4
	--聪明人内力加少。。。
	--增加内力的成长
	AddPersonAttrib(pid, "内力最大值", math.modf(leveladd * ((16 - JY.Person[pid]["生命增长"]) * 7 + 210 / (theadd + 1))))
	
	--天罡内力每级额外加50
	if actor(pid,6) then
        AddPersonAttrib(pid, "内力最大值", 50 * leveladd)
	end
	JY.Person[pid]["内力"] = JY.Person[pid]["内力最大值"]
	local p_zz = JY.Person[pid]["资质"];
	--循环提升等级，累加属性
	for i = 1, leveladd do
		local ups;
		ups = 3 
		--队友郭靖 20级之后，每级6点
		if pid == 55 and JY.Person[pid]["等级"] > 20 then
			ups = 6
		end
		local nfqg = 0
		if JY.Base['畅想'] == 546 then
			nfqg = 3
		end		  
		AddPersonAttrib(pid, "攻击力", ups)
		AddPersonAttrib(pid, "防御力", ups)
		AddPersonAttrib(pid, "轻功", ups + nfqg)

		
		--修复医疗、用毒、解毒能力不与等级挂钩的问题
		if JY.Person[pid]["医疗能力"] >= 20 then
			AddPersonAttrib(pid, "医疗能力", 2)
		end
		if JY.Person[pid]["用毒能力"] >= 20 then
			AddPersonAttrib(pid, "用毒能力", 2)
		end
		--if JY.Person[pid]["解毒能力"] >= 20 then
			--AddPersonAttrib(pid, "解毒能力", 2)
		--end
		
		--队友陈家洛 升级加五围
		if pid == 75 then
			if JY.Person[pid]["拳掌功夫"] >= 0 then
				AddPersonAttrib(pid, "拳掌功夫", (300))
			end
			if JY.Person[pid]["指法技巧"] >= 0 then
				AddPersonAttrib(pid, "指法技巧", (300))
			end
			if JY.Person[pid]["御剑能力"] >= 0 then
				AddPersonAttrib(pid, "御剑能力", (300))
			end
			if JY.Person[pid]["耍刀技巧"] >= 0 then
				AddPersonAttrib(pid, "耍刀技巧", (300))
			end
			if JY.Person[pid]["特殊兵器"] >= 0 then
				AddPersonAttrib(pid, "特殊兵器", (300))
			end
		end

		
		--暗器每级提高
		if JY.Person[pid]["暗器技巧"] >= 20 then
			AddPersonAttrib(pid, "暗器技巧", 2)
		end
	end

	local ey = 1;  --每级的自由点数
	ey = ey + JY.Base["难度"];
	
	local n = ey*leveladd;		--计算随机额外点数
	n = n + math.ceil(p_zz*2.5*leveladd/29)

	
	--加点
	local gj = JY.Person[pid]["攻击力"];
	local fy = JY.Person[pid]["防御力"];
	local qg = JY.Person[pid]["轻功"];
	local tmpN = n;
	
	--天赋ID
	local tfid;
	--主角
	if pid == 0 then
		--标主
		if JY.Base["标准"] > 0 then
			tfid = 280 + JY.Base["标准"]
		--特殊
		elseif JY.Base["特殊"] > 0 then
			tfid = 289 + JY.Base["特殊"]
		--畅想
		else
			tfid = JY.Base["畅想"]
		end
	--队友
	else
		tfid = pid
	end
	
	--升级加点界面
	local current = 1
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		--ShowPersonStatus_sub(pid, 1, 1, tfid, -17, 1)
		--PersonStatusA(pid)
		
		--local gjl = JY.Person[pid]["攻击力"]
		--local fyl = JY.Person[pid]["防御力"]
		--local qgl = JY.Person[pid]["轻功"]
		local n = 0
		local sw = ""
		DrawString(CC.ScreenW/4-CC.Fontsmall*6-2-10,CC.ScreenH/2+100-15,string.format("可分配点数：%d 点",tmpN) ,C_ORANGE, CC.Fontsmall*0.7);
		for i = 1, 3 do
			local shade_color = C_GOLD
			if i ==  current then
				shade_color = PinkRed
			end
			if i == 1 then 
				n = JY.Person[pid]["攻击力"]
				sw = " 攻击力 "
			elseif i == 2 then
				n = JY.Person[pid]["防御力"]
				sw = " 防御力 "
			elseif i == 3 then 
				n = JY.Person[pid]["轻功"]
				sw = " 轻功 "
			end
			DrawString(CC.ScreenW/4-CC.Fontsmall*7-30, CC.ScreenH/2+100+24+i*(CC.FontSmall4+CC.PersonStateRowPixel)-40, "→"..sw..n,shade_color, CC.Fontsmall*0.7);
		end
		--PersonStatusA(pid)
		ShowScreen()
		local keypress, ktype, mx, my = WaitKey()
		--lib.Delay(CC.Frame)
		if ktype == 1 then
			if keypress == VK_UP then
				current = current - 1
				if current < 1 then
					current = 3
				end
			elseif keypress == VK_DOWN then
				current = current + 1
				if current > 3 then
					current = 1
				end
			elseif keypress == VK_LEFT  then--and tmpN < n
				if current == 1 and JY.Person[pid]["攻击力"] > gj then
					JY.Person[pid]["攻击力"] = JY.Person[pid]["攻击力"]-1
					tmpN = tmpN+1
				elseif current == 2 and JY.Person[pid]["防御力"] > fy then
					JY.Person[pid]["防御力"] = JY.Person[pid]["防御力"]-1
					tmpN = tmpN+1
				elseif current == 3 and JY.Person[pid]["轻功"] > qg then
					JY.Person[pid]["轻功"] = JY.Person[pid]["轻功"]-1
					tmpN = tmpN+1
				end
			elseif keypress == VK_RIGHT and tmpN > 0 then
				if current == 1 and JY.Person[pid]["攻击力"] < 1000 then
					JY.Person[pid]["攻击力"] = JY.Person[pid]["攻击力"]+1
					tmpN = tmpN-1
				elseif current == 2 and JY.Person[pid]["防御力"] < 1000 then
					JY.Person[pid]["防御力"] = JY.Person[pid]["防御力"]+1
					tmpN = tmpN-1
				elseif current == 3 and JY.Person[pid]["轻功"] < 1000 then
					JY.Person[pid]["轻功"] = JY.Person[pid]["轻功"]+1
					tmpN = tmpN-1
				end
			elseif keypress==VK_SPACE or keypress==VK_RETURN then
				if tmpN == 0 or (JY.Person[pid]["攻击力"] == 1000 and JY.Person[pid]["防御力"] == 1000 and JY.Person[pid]["轻功"] == 1000) then
					Cls();
					break
				else
					DrawStrBoxWaitKey("对不起，"..JY.Person[pid]["姓名"].."还有剩余的点数没加!", C_WHITE, CC.DefaultFont)
				end
			end
		end
	end
	return true
end

--人参
function War_DARENSHEN(pid,amount)
	
	local n = amount*10;		--计算随机额外点数
	
	--加点
	local gj = JY.Person[pid]["攻击力"];
	local fy = JY.Person[pid]["防御力"];
	local qg = JY.Person[pid]["轻功"];
	local tmpN = n;
	
	--天赋ID
	local tfid;
	--主角
	if pid == 0 then
		--标主
		if JY.Base["标准"] > 0 then
			tfid = 280 + JY.Base["标准"]
		--特殊
		elseif JY.Base["特殊"] > 0 then
			tfid = 289 + JY.Base["特殊"]
		--畅想
		else
			tfid = JY.Base["畅想"]
		end
	--队友
	else
		tfid = pid
	end
	
	--升级加点界面
	local current = 1
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		--ShowPersonStatus_sub(pid, 1, 1, tfid, -17, 1)
		--PersonStatus(pid)
		DrawString(CC.ScreenW/4-CC.Fontsmall*6-2+28-10,CC.ScreenH/2+30,string.format("可分配点数：%d 点",tmpN) ,C_ORANGE, CC.Fontsmall*1.2);
		for i = 1, 3 do
			local shade_color = C_GOLD
			local sw = {'攻击力','防御力','轻功'}
			if i ==  current then
				shade_color = PinkRed
			end
			DrawString(CC.ScreenW/4-CC.Fontsmall*7-30, CC.ScreenH/2+100+24+i*(CC.FontSmall4+CC.PersonStateRowPixel)-40, "→"..sw[i]..'：'..JY.Person[pid][sw[i]],shade_color, CC.Fontsmall*1.2);
		end
		ShowScreen()
		local keypress, ktype, mx, my = WaitKey()
		--lib.Delay(CC.Frame)
		if ktype == 1 then
			if keypress == VK_UP then
				current = current - 1
				if current < 1 then
					current = 3
				end
			elseif keypress == VK_DOWN then
				current = current + 1
				if current > 3 then
					current = 1
				end
			elseif keypress == VK_LEFT and tmpN < n then
				if current == 1 and JY.Person[pid]["攻击力"] > gj then
					JY.Person[pid]["攻击力"] = JY.Person[pid]["攻击力"]-1
					tmpN = tmpN+1
				elseif current == 2 and JY.Person[pid]["防御力"] > fy then
					JY.Person[pid]["防御力"] = JY.Person[pid]["防御力"]-1
					tmpN = tmpN+1
				elseif current == 3 and JY.Person[pid]["轻功"] > qg then
					JY.Person[pid]["轻功"] = JY.Person[pid]["轻功"]-1
					tmpN = tmpN+1
				end
			elseif keypress == VK_RIGHT and tmpN > 0 then
				if current == 1 and JY.Person[pid]["攻击力"] < 1000 then
					JY.Person[pid]["攻击力"] = JY.Person[pid]["攻击力"]+1
					tmpN = tmpN-1
				elseif current == 2 and JY.Person[pid]["防御力"] < 1000 then
					JY.Person[pid]["防御力"] = JY.Person[pid]["防御力"]+1
					tmpN = tmpN-1
				elseif current == 3 and JY.Person[pid]["轻功"] < 1000 then
					JY.Person[pid]["轻功"] = JY.Person[pid]["轻功"]+1
					tmpN = tmpN-1
				end
			elseif keypress==VK_SPACE or keypress==VK_RETURN then
				if tmpN == 0 or (JY.Person[pid]["攻击力"] == 1000 and JY.Person[pid]["防御力"] == 1000 and JY.Person[pid]["轻功"] == 1000) then
					Cls();
					break
				else
					DrawStrBoxWaitKey("对不起，"..JY.Person[pid]["姓名"].."还有剩余的点数没加!", C_WHITE, CC.DefaultFont)
				end
			end
		end
	end
	return true
end

--蟠桃
function War_DAPANTAO(pid,amount)
	
	local n = amount*10;		--计算随机额外点数
	
	--加点
	local QZ = JY.Person[pid]["拳掌功夫"];
	local ZF = JY.Person[pid]["指法技巧"];
	local YJ = JY.Person[pid]["御剑能力"];
	local SD = JY.Person[pid]["耍刀技巧"];
	local TS = JY.Person[pid]["特殊兵器"];
	local tmpN = n;
	
	--天赋ID
	local tfid;
	--主角
	if pid == 0 then
		--标主
		if JY.Base["标准"] > 0 then
			tfid = 280 + JY.Base["标准"]
		--特殊
		elseif JY.Base["特殊"] > 0 then
			tfid = 289 + JY.Base["特殊"]
		--畅想
		else
			tfid = JY.Base["畅想"]
		end
	--队友
	else
		tfid = pid
	end
	
	--升级加点界面
	local current = 1
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		local n = 0
		local sw = ""
		--ShowPersonStatus_sub(pid, 1, 1, tfid, -17, 1)
		--PersonStatus(pid)
		DrawString(CC.ScreenW/4-CC.Fontsmall*6+10,CC.ScreenH/2+30,string.format("可分配点数：%d 点",tmpN) ,C_ORANGE, CC.Fontsmall*1.2);
		--DrawString(CC.ScreenW/4-CC.Fontsmall*6-2+28-10,CC.ScreenH/2+100+20-15,string.format("可分配点数：%d 点",tmpN) ,C_ORANGE, CC.Fontsmall*0.7);
		for i = 1, 5 do
			local shade_color = C_GOLD
			if i ==  current then
				shade_color = PinkRed
			end
			if i == 1 then 
				n = JY.Person[pid]["拳掌功夫"]
				sw = " 拳掌功夫 "
			elseif i == 2 then
				n = JY.Person[pid]["指法技巧"]
				sw = " 指法技巧 "
			elseif i == 3 then 
				n = JY.Person[pid]["御剑能力"]
				sw = " 御剑能力 "
			elseif i == 4 then 
				n = JY.Person[pid]["耍刀技巧"]
				sw = " 耍刀技巧 "
			elseif i == 5 then 
				n = JY.Person[pid]["特殊兵器"]
				sw = " 特殊兵器 "
			end
			--DrawString(CC.ScreenW/4-CC.Fontsmall*7-30, CC.ScreenH/2+100+24+i*(CC.FontSmall4+CC.PersonStateRowPixel)-40, "→",shade_color, CC.Fontsmall*0.7);
			DrawString(CC.ScreenW/4-CC.Fontsmall*7-30, CC.ScreenH/2+100+24+i*(CC.FontSmall4+CC.PersonStateRowPixel)-40, "→"..sw..n,shade_color, CC.Fontsmall*1.2);
			--DrawString(CC.ScreenW/4-CC.Fontsmall*7-30, CC.ScreenH/2+100+110+i*(CC.FontSmall4+CC.PersonStateRowPixel)*0.7-40, "→",shade_color, CC.Fontsmall*0.7);
		end
		ShowScreen()
		local keypress, ktype, mx, my = WaitKey()
		--lib.Delay(CC.Frame)
		if ktype == 1 then
			if keypress == VK_UP then
				current = current - 1
				if current < 1 then
					current = 5
				end
			elseif keypress == VK_DOWN then
				current = current + 1
				if current > 5 then
					current = 1
				end
			elseif keypress == VK_LEFT and tmpN < n then
				if current == 1 and JY.Person[pid]["拳掌功夫"] > QZ then
					JY.Person[pid]["拳掌功夫"] = JY.Person[pid]["拳掌功夫"]-1
					tmpN = tmpN+1
				elseif current == 2 and JY.Person[pid]["指法技巧"] > ZF then
					JY.Person[pid]["指法技巧"] = JY.Person[pid]["指法技巧"]-1
					tmpN = tmpN+1
				elseif current == 3 and JY.Person[pid]["御剑能力"] > YJ then
					JY.Person[pid]["御剑能力"] = JY.Person[pid]["御剑能力"]-1
					tmpN = tmpN+1
				elseif current == 4 and JY.Person[pid]["耍刀技巧"] > SD then
					JY.Person[pid]["耍刀技巧"] = JY.Person[pid]["耍刀技巧"]-1
					tmpN = tmpN+1
				elseif current == 5 and JY.Person[pid]["特殊兵器"] > TS then
					JY.Person[pid]["特殊兵器"] = JY.Person[pid]["特殊兵器"]-1
					tmpN = tmpN+1
				end
			elseif keypress == VK_RIGHT and tmpN > 0 then
				if current == 1 and JY.Person[pid]["拳掌功夫"] < 999 then
					JY.Person[pid]["拳掌功夫"] = JY.Person[pid]["拳掌功夫"]+1
					tmpN = tmpN-1
				elseif current == 2 and JY.Person[pid]["指法技巧"] < 999 then
					JY.Person[pid]["指法技巧"] = JY.Person[pid]["指法技巧"]+1
					tmpN = tmpN-1
				elseif current == 3 and JY.Person[pid]["御剑能力"] < 999 then
					JY.Person[pid]["御剑能力"] = JY.Person[pid]["御剑能力"]+1
					tmpN = tmpN-1
				elseif current == 4 and JY.Person[pid]["耍刀技巧"] < 999 then
					JY.Person[pid]["耍刀技巧"] = JY.Person[pid]["耍刀技巧"]+1
					tmpN = tmpN-1
				elseif current == 5 and JY.Person[pid]["特殊兵器"] < 999 then
					JY.Person[pid]["特殊兵器"] = JY.Person[pid]["特殊兵器"]+1
					tmpN = tmpN-1
				end
			elseif keypress==VK_SPACE or keypress==VK_RETURN then
				if tmpN == 0 or (JY.Person[pid]["拳掌功夫"] == 999 and JY.Person[pid]["指法技巧"] == 999 and JY.Person[pid]["御剑能力"] == 999 and JY.Person[pid]["耍刀技巧"] == 999 and JY.Person[pid]["特殊兵器"] == 999) then
					Cls();
					break
				else
					DrawStrBoxWaitKey("对不起，"..JY.Person[pid]["姓名"].."还有剩余的点数没加!", C_WHITE, CC.DefaultFont)
				end
			end
		end
	end
	return true
end

--战斗结束处理函数
--isexp 经验值
--warStatus 战斗状态
function War_EndPersonData(isexp, warStatus)
	--无酒不欢：血量还原函数
	Health_in_Battle_Reset()
	--无酒不欢：战后状态恢复
	for i = 0, WAR.PersonNum - 1 do
		local pid = WAR.Person[i]["人物编号"]
		--敌方回复满状态
		if isteam(pid) == false then
			JY.Person[pid]["生命"] = JY.Person[pid]["生命最大值"]
			JY.Person[pid]["内力"] = JY.Person[pid]["内力最大值"]
			JY.Person[pid]["体力"] = CC.PersonAttribMax["体力"]
			JY.Person[pid]["受伤程度"] = 0
			JY.Person[pid]["中毒程度"] = 0
			JY.Person[pid]["冰封程度"] = 0
			JY.Person[pid]["灼烧程度"] = 0
			JY.Person[pid]["流血程度"] = 0
			JY.Person[pid]["封穴程度"] = 0
		--我方恢复状态
		else	
			JY.Person[pid]["生命"] = JY.Person[pid]["生命最大值"]
			JY.Person[pid]["内力"] = JY.Person[pid]["内力最大值"]
			JY.Person[pid]["体力"] = CC.PersonAttribMax["体力"]
			JY.Person[pid]["受伤程度"] = 0
			JY.Person[pid]["中毒程度"] = 0
			JY.Person[pid]["冰封程度"] = 0
			JY.Person[pid]["灼烧程度"] = 0
			JY.Person[pid]["流血程度"] = 0
			JY.Person[pid]["封穴程度"] = 0
			--出战统计
			JY.Person[pid]["出战"] = JY.Person[pid]["出战"] + 1
		end
	end

	--乔峰武功回复
	JY.Person[50]["武功1"] = 26
	JY.Wugong[13]["名称"] = "铁掌"
	
			--花铁杆
	if JY.Base["畅想"]==52 then
			JY.Person[0]["姓名"]= "花铁杆"
			JY.Person[0]["代号"]=52
			JY.Person[0]["头像代号"]=52
		    JY.Person[0]["半身像"]=52		
			JY.Person[0]["出招动画帧数1"]=0
			JY.Person[0]["出招动画帧数2"]=0
			JY.Person[0]["出招动画帧数3"]=0
			JY.Person[0]["出招动画帧数4"]=0
			JY.Person[0]["出招动画帧数5"]=6
			JY.Person[0]["出招动画延迟1"]=0
			JY.Person[0]["出招动画延迟2"]=0
			JY.Person[0]["出招动画延迟3"]=0
			JY.Person[0]["出招动画延迟4"]=0
			JY.Person[0]["出招动画延迟5"]=5
			JY.Person[0]["武功音效延迟1"]=0
			JY.Person[0]["武功音效延迟2"]=0
			JY.Person[0]["武功音效延迟3"]=0
			JY.Person[0]["武功音效延迟4"]=0
			JY.Person[0]["武功音效延迟5"]=4
		end

	
	--花铁杆武功恢复
	if JY.Base["畅想"] == 52 then
		JY.Person[0]["武功1"] = 70
	end
	
	--破丐帮打狗阵
	if WAR.ZDDH == 82 then
		SetS(10, 0, 18, 0, 1)
	end
  
	--梅庄 秃笔翁战斗后
	if WAR.ZDDH == 44 then
		instruct_3(55, 6, 1, 0, 0, 0, 0, -2, -2, -2, 0, -2, -2)
		instruct_3(55, 7, 1, 0, 0, 0, 0, -2, -2, -2, 0, -2, -2)
	end
  
	--梅庄 黑白子战斗
	if WAR.ZDDH == 45 then
		instruct_3(55, 9, 1, 0, 0, 0, 0, -2, -2, -2, 0, -2, -2)
	end
  
	--梅庄 黄钟公战斗
	if WAR.ZDDH == 46 then
		instruct_3(55, 13, 0, 0, 0, 0, 0, -2, -2, -2, 0, -2, -2)
	end
  
  	--葵花尊者战斗胜利
	--用东方的品德记录
	if WAR.ZDDH == 54 and CC.TX["笑傲邪线"] == 1 and WAR.MCRS == 1 then
		CC.TX["笑傲邪线"] = 2
        CC.TG[9967] = 1
	end		
	
    if WAR.ZDDH == 100 and warStatus == 1 then
	    JY.Person[344]["品德"] = 10
    end
	--战斗失败，并且无经验
	if warStatus == 2 and isexp == 0 then
		return 
	end
  
	--统计活的人数
	local liveNum = 0
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["我方"] == true and JY.Person[WAR.Person[i]["人物编号"]]["生命"] > 0 then
			liveNum = liveNum + 1
		end
	end
  
	--分配经验
	local canyu = false
	if warStatus == 1 then
		if WAR.Data["经验"] < 1000 then
			WAR.Data["经验"] = 1000
		end
		--超级木桩和木桩的经验
		if WAR.ZDDH == 226 then
			WAR.Data["经验"] = 45000
		end
		for i = 0, WAR.PersonNum - 1 do
			local pid = WAR.Person[i]["人物编号"]
			if WAR.Person[i]["我方"] == true and inteam(pid) and JY.Person[pid]["生命"] > 0 then
				if pid == 0 then
					canyu = true
				end
				--超级木桩的经验
				if WAR.ZDDH == 226 then
					WAR.Person[i]["经验"] = 120000
					if PersonKF(pid,106) and (PersonKF(pid,90) or PersonKF(pid,375)) then
						SetTF(pid,9849,1)
					end	
					if pid == 0 and JY.Person[pid]['畅想分阶'] > 5 and match_ID(pid,9743) == false and JY.Person[456]["论剑奖励"] < 1 then
						SetTF(0,9743,1)
					end
					if pid == 0 and JY.Person[pid]['畅想分阶'] < 2 and match_ID(pid,9743) then
						SetTF(0,9743,nil)
					end
					if pid == 0 and JY.Person[114]["论剑奖励"] == 1 and match_ID(pid,9986) == false then
						SetTF(0,9986,1)
					end
				else
					WAR.Person[i]["经验"] = WAR.Person[i]["经验"] + math.modf(WAR.Data["经验"] / (liveNum))
				end
				--小无经验翻倍
				if PersonKF(pid, 98) then
					WAR.Person[i]["经验"] = WAR.Person[i]["经验"] + math.modf(WAR.Data["经验"] / (liveNum))
				end
			end
		end
	end
  
	--把等级放在修炼秘籍的后面
	for i = 0, WAR.PersonNum - 1 do
		local pid = WAR.Person[i]["人物编号"]
		if WAR.Person[i]["我方"] == true and inteam(pid) then
			--无酒不欢：小于30级，或者身上有物品才显示对话框提示
			if JY.Person[pid]["等级"] < 30 or JY.Person[pid]["修炼物品"] >= 0 then
				-- DrawStrBoxWaitKey(string.format("%s 获得经验点数11 %d", JY.Person[pid]["姓名"], WAR.Person[i]["经验"]), C_WHITE, CC.DefaultFont)
				local bx,by = CC.ScreenW/1360,CC.ScreenH/768
				Cls()
				local name = "Ｏ"..JY.Person[pid]["姓名"].."Ｗ经验".."Ｏ"..WAR.Person[i]["经验"].."Ｗ点"
				lib.LoadPNG(91,121*2,CC.ScreenW/1360*355+bx*212,CC.ScreenH/768*373+by*33.5,1)
				tjm(CC.ScreenW/1360*425+bx*212,CC.ScreenH/768*386+by*33.5,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
				ShowScreen()
				WaitKey()
				Cls()
			end
			--修炼物品
			AddPersonAttrib(pid, "物品修炼点数", math.modf(WAR.Person[i]["经验"] * 8 / 10))
			AddPersonAttrib(pid, "修炼点数", math.modf(WAR.Person[i]["经验"] * 8 / 10))
			if JY.Person[pid]["修炼点数"] < 0 then
				JY.Person[pid]["修炼点数"] = 0
			end
			War_PersonTrainBook(pid)     --修炼秘籍
			War_PersonTrainDrug(pid)		 --修炼药品
			--把等级放在修炼秘籍的后面
			AddPersonAttrib(pid, "经验", math.modf(WAR.Person[i]["经验"] / 2))
			War_AddPersonLVUP(pid)
		else
			AddPersonAttrib(pid, "经验", WAR.Person[i]["经验"])
		end
	end
  
	--青城四秀
	if WAR.ZDDH == 48 then
		SetS(57, 52, 29, 1, 0)
		SetS(57, 52, 30, 1, 0)
	--一灯居，欧阳锋，裘千刃
	elseif WAR.ZDDH == 175 then
		instruct_3(32, 12, 1, 0, 0, 0, 0, 0, 0, 0, -2, -2, -2)
	--破打狗阵
	elseif WAR.ZDDH == 82 then
		SetS(10, 0, 18, 0, 1)
	--木人巷
	elseif WAR.ZDDH == 214 then
		SetS(10, 0, 19, 0, 1)
	--侠客邪
	elseif WAR.ZDDH == 170 then
		JY.Scene[JY.SubScene]["进门音乐"] = -1
	end

	if JY.Restart == 1 then
		return
	end
end

--执行战斗，自动和手动战斗都调用
--id战斗人物编号
--wugongnum 使用的武功在位置
--x,y为战斗场景坐标
function War_Fight_Sub(id, wugongnum, x, y)
  WAR.Person[id]['特效动画'] = -1
  WAR.Person[id]['特效文字0'] = nil
	WAR.Person[id]['特效文字1'] = nil
	WAR.Person[id]['特效文字2'] = nil
	WAR.Person[id]['特效文字3'] = nil
	WAR.Person[id]['特效文字4'] = nil

	--WAR.WS = 1
	local pid = WAR.Person[id]["人物编号"]
	local x0, y0 = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
	local wugong = 0
	WAR.PD['动画判定'][pid] = nil
	if JY.Person[pid]['生命'] <= 0 then
		do return end
	end	
	if wugongnum < 100 then
		wugong = JY.Person[pid]["武功" .. wugongnum]
	else
		wugong = wugongnum - 100
		wugongnum = 1
		for i = 1, JY.Base["武功数量"] do
			if JY.Person[pid]["武功" .. i] == 43  then	--如果学习有斗转星移
				wugongnum = i							--记录斗转武功位置
				break;
			end
		end
    if x ~= nil and y ~= nil then
        x = WAR.Person[WAR.CurID]["坐标X"] - x
        y = WAR.Person[WAR.CurID]["坐标Y"] - y
    end
		WarDrawMap(0)   
		local fj = "反击"		--斗转错误
		--斗转星移提示的文字
		if WAR.DZXYLV[pid] == 150 then
			fj = string.format("%s发动耀若日星反击", JY.Person[pid]["姓名"])
		elseif WAR.DZXYLV[pid] == 100 then
			if WAR.YJZD[pid] == 1 then
				fj = string.format("%s以静制动", JY.Person[pid]["姓名"])
				CurIDTXDH(WAR.CurID,382,1,'太极奥义・一气并流')
			elseif WAR.PD['大圆镜智'][pid] == 1 then
				fj = string.format("%s圆镜照世", JY.Person[pid]["姓名"])
			else
				fj = string.format("%s镜心", JY.Person[pid]["姓名"])
			end	
		elseif WAR.DZXYLV[pid] == 80 then
		    if WAR.JYXLF[pid] == 1 then
				fj = string.format("%s融汇贯通", JY.Person[pid]["姓名"])
				CurIDTXDH(WAR.CurID,111,1,'九阴降龙・天蝮之屈')	
			elseif WAR.JXBH[pid] == 1 then
			    fj = string.format("%s融会贯通", JY.Person[pid]["姓名"])
				CurIDTXDH(WAR.CurID,140,1,'碧海惊涛・海流六奇') 	
			else
				fj = string.format("%s发动幻梦星辰反击", JY.Person[pid]["姓名"])
			end	
		elseif WAR.DZXYLV[pid] == 70 then
			fj = string.format("%s发动离合参商反击", JY.Person[pid]["姓名"])
		elseif WAR.DZXYLV[pid] == 60 then
			fj = string.format("%s发动斗转星移反击", JY.Person[pid]["姓名"])
		elseif WAR.DZXYLV[pid] == 50 then
			fj = string.format("%s发动北斗移辰反击", JY.Person[pid]["姓名"])
		end
		--追击判定
		if WAR.YTTLLV[pid] == 90 then
			fj = string.format("%s发动协同追击", JY.Person[pid]["姓名"])
			--color = M_Indigo
		elseif WAR.YTTLLV[pid] == 110 then
		    fj = string.format("%s发动连续追击", JY.Person[pid]["姓名"])
		elseif WAR.YTTLLV[pid] == 130 then
		    fj = string.format("%s发动草木皆剑", JY.Person[pid]["姓名"])
		end
		TXWZXS(fj,C_ORANGE)
		
	end
	
	--八荒六阳
	if wugong == 8 and (PersonKF(pid,101) or match_ID(pid,117) or match_ID(pid,634)) then
		WAR.BHLY = JY.Wugong[8]["移动范围10"] 
		JY.Wugong[8]["移动范围10"] = 10
	end
	--易筋须弥山
    if wugong == 24 and PersonKF(pid,108) then 
		WAR.XSXM = JY.Wugong[24]["移动范围10"]
		JY.Wugong[24]["移动范围10"] = 10
	end
	--擒龙降龙
	if wugong == 26 and (PersonKF(pid,204) or match_ID(pid,50)) then 
		WAR.JYXL = JY.Wugong[26]["移动范围10"]
		JY.Wugong[26]["移动范围10"] = 15
	end	
	--辟邪剑法
	if wugong == 48 and (Curr_NG(pid,105) or JXPD(pid,19,1)) then
		WAR.BXJF = JY.Wugong[48]["移动范围10"]
		JY.Wugong[48]["移动范围10"] = 8
	end
	--岳王散手
	if wugong == 198 and PersonKF(pid,199) then 
		WAR.YWSS = JY.Wugong[198]["移动范围10"]
		JY.Wugong[198]["移动范围10"] = 10 
	end 	
	--朝廷岳家枪法
	if wugong == 200 and PersonKF(pid,199) and MPTX(pid,23,4) then 
	    WAR.CTYQ = JY.Wugong[200]["移动范围10"]
	    JY.Wugong[200]["移动范围10"] = 10
	end
	
	WAR.WGWL = JY.Wugong[wugong]["攻击力10"]
	local fightscope = JY.Wugong[wugong]["攻击范围"]		--没啥用的玩意
	local kfkind = JY.Wugong[wugong]["武功类型"]
	local level = JY.Person[pid]["武功等级" .. wugongnum]   --判断武功是否为极

	 	
	
	--防止以后不指定主角的情况下被斗转带出特效
	--九阳归0
	WAR.JYZS = 0 
	--碧海归0
	WAR.LXBHZS = 0
	WAR.BHJTZ = 0
	
	if level == 999 then
		level = 11
	else
		level = math.modf(level / 100) + 1
	end
	WAR.ShowHead = 0

	local m1, m2, a1, a2, a3, a4, a5,a6 = refw(wugong, level)  --获取武功的范围
		
	local movefanwei = {m1, m2}				--可移动的范围
	local atkfanwei = {a1, a2, a3, a4, a5}	--攻击范围
	 
	x, y = War_FightSelectType(movefanwei, atkfanwei, x, y,wugong)
    --取消时顺带恢复技能释放 九阳 碧海 招式
	--防止出现选择武功后取消的情况
	if x == nil  then
		WAR.JYZS = 0;		
		WAR.LXBHZS = 0;
		return 0
	end 		
	
	--擒龙降龙
  if WAR.JYXL > 0  then	
		JY.Wugong[26]["移动范围10"] = WAR.JYXL
		WAR.JYXL = 0
	end
	
	--八荒六阳
	if WAR.BHLY > 0 then
		JY.Wugong[8]["移动范围10"] = WAR.BHLY
		WAR.BHLY = 0
	end
	
	--易筋须弥山
    if WAR.XSXM > 0 then 
		JY.Wugong[24]["移动范围10"] = WAR.XSXM
		WAR.XSXM = 0
	end	
	
	--岳王散手
	if WAR.YWSS > 0 then
		JY.Wugong[198]["移动范围10"] = WAR.YWSS
		WAR.YWSS = 0
	end
	
	--朝廷岳家枪法
	if WAR.CTYQ > 0 then 
	  JY.Wugong[200]["移动范围10"] = WAR.CTYQ
		WAR.CTYQ = 0
	end	
	
	--辟邪剑法
	if WAR.BXJF > 0 then
		JY.Wugong[48]["移动范围10"] = WAR.BXJF
		WAR.BXJF = 0 
	end

	Cat('遮影DH2',WAR.CurID)

	if WAR.Person[WAR.CurID]["贴图"] ~= WarCalPersonPic(WAR.CurID) then
		WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
		SetWarMap(x0,y0, 5, WAR.Person[WAR.CurID]["贴图"])
		--WarDrawMap(0)
        Cat('实时特效动画')
        WarDrawMap(0)
        Cat('实时特效动画2')
		ShowScreen()
		lib.Delay(CC.BattleDelay)
	end
	
	--使用了九阳，该招式进入冷却，
	--[[
	if  wugong == 106 and level == 11 and  WAR.JYCD[WAR.JYZS] ~= nil and WAR.JYCD[WAR.JYZS] > 0 and isteam(pid)  and WAR.DZXY == 0 and WAR.AutoFight == 0 and WAR.ZYHB ==0 then
		WAR.JYLQ[pid][WAR.JYZS] = WAR.JYCD[WAR.JYZS] + 1
	end
	--使用了辟邪，该招式进入冷却
	--林平之无冷却
	if wugong == 48 and level == 11 and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0  then
		if Curr_NG(pid,105) then
			WAR.BXCD[WAR.BXZS] = WAR.BXCD1[WAR.BXZS]
		end
		if not match_ID(pid, 36) then
			WAR.BXLQ[pid][WAR.BXZS] = (WAR.BXCD[WAR.BXZS]or 0) + 1
		end	
	end
	]]
	--if wugong == 49 and level == 11 and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0  then
		--WAR.LMLQ[pid][WAR.PD["六脉招式"][pid]] = WAR.LMCD[WAR.PD["六脉招式"][pid]] + 1
		--WAR.LMLQ[pid][WAR.LMZS] = WAR.LMCD[WAR.LMZS] + 1
	--end
	--判断合击
	
	--[[
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[WAR.CurID]["我方"] == WAR.Person[i]["我方"] and i ~= WAR.CurID and WAR.Person[i]["死亡"] == false then
			local nx = WAR.Person[i]["坐标X"]
			local ny = WAR.Person[i]["坐标Y"]
			local fid = WAR.Person[i]["人物编号"]
			for j = 1, JY.Base["武功数量"] do
				if JY.Person[fid]["武功" .. j] == wugong then         
					if math.abs(nx-x0)+math.abs(ny-y0)<9 then
						local flagx, flagy = 0, 0
						if math.abs(nx - x0) <= 1 then
							flagx = 1
						end
						if math.abs(ny - y0) <= 1 then
							flagy = 1
						end
						if x0 == nx then
							flagy = 1
						end
						if y0 == ny then
							flagx = 1
						end
						if between(x, x0, nx, flagx) and between(y, y0, ny, flagy) then
							ZHEN_ID = i
							WAR.Person[i]["人方向"] = 3 - War_Direct(x0, y0, x, y)
							break;
						end
					end
				end
			end
			if ZHEN_ID >= 0 then
				break;
			end
		end
		if WAR.DUIZHAO == 1 and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
			i ~= WAR.CurID and WAR.Person[i]["死亡"] == false and 
			match_ID(WAR.Person[i]["人物编号"],27)  and math.random(10) > 6 then--
			ZHEN_ID = i
			WAR.DUIZHAO = 10
			break
		end
		if WAR.DUIZHAO == 2 and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
			i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and 
			match_ID(WAR.Person[i]["人物编号"],50)  and math.random(10) > 6 then--
				ZHEN_ID = i
		    WAR.DUIZHAO = 20
			break
		end
		if WAR.DUIZHAO == 3 and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
			i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and 
			match_ID(WAR.Person[i]["人物编号"],5) and math.random(10) > 6 then-- 
		   
			ZHEN_ID = i
		    WAR.DUIZHAO = 30
		   break
		end
		if WAR.DUIZHAO == 4 and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
			i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and 
			match_ID(WAR.Person[i]["人物编号"],114) and math.random(10) > 6  then-- and 
		    
			ZHEN_ID = i
		   WAR.DUIZHAO = 40
		   break
		end
		if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
			i ~= WAR.CurID and WAR.Person[i]["死亡"] == false and  psx(WAR.Person[i]["人物编号"],"门派技能3") == 2  and math.random(10) > 6 then--
		  
			ZHEN_ID = i
		    WAR.DUIZHAO = 50
		    break
		end
		if WAR.DUIZHAO == 6 and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
			i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and 
			match_ID(WAR.Person[i]["人物编号"],520) and math.random(10) > 6 then
		   
			ZHEN_ID = i
		    WAR.DUIZHAO = 60
		   break
		end
	end]]

	--攻击次数
	WAR.ATNum = 1
	--判定左右 --斗转星移不触发左右
	if ZYHBPD(pid) > 0 and WAR.ZYHB == 0 and fjpd(WAR.CurID) == false then
		--判断左右，71-资质
		local jczyjl = (71 - JY.Person[pid]['资质'])
		local zyjl = 0
		if zyjl < 0 then
			zyjl = 0
		end
		--郭靖80%
		if match_ID(pid, 55) then
			zyjl = 80
		end
		if match_ID(pid, 455) then
			zyjl = 80
		end
		--小龙女70%
		if match_ID(pid, 59) or match_ID(pid, 9832) then
			zyjl = 70
		end
		--周芷若50%
		if match_ID(pid, 631) and WAR.ZZRZY == 1 then
			zyjl = 50
		end
		if jczyjl > zyjl then
			zyjl = jczyjl
		end	
		--暴怒+20%
		if BNJQ(pid) then
			zyjl = zyjl + 20
		end		
		--周伯通支线完成后，主角+20%
		if match_ID(pid,0) and JY.Person[64]["品德"] == 80 then
			zyjl = zyjl + 20
		end
		--阴阳铁布
		if PersonKF(pid,77) and PersonKF(pid,196) then
			zyjl = zyjl + 10
		end	
		--上限100%
		if zyjl > 100 then
			zyjl = 100
		end
		--周伯通100% 
		if ZYHBPD(pid) == 2 then
			zyjl = 100
		end

		if math.random(100) <= zyjl then
			WAR.ZYHB = 1
		end
	end
	--玉女素心M合
	if wugong == 139 and ((PersonKF(pid,100) and PersonKF(pid,154)) or match_ID(pid,605) or match_ID(pid,526)) and WAR.ZYHB == 0 and fjpd(WAR.CurID) == false then
		local jl = 20
		if MPTX(pid,3) then
			jl = 35
		end	
		if WAR.DZXY == 0 and ZYHBPD(pid) == 0 and JLSD(0,jl,pid) then
			WAR.ZYHB = 1
		end
	end
	--刀剑互搏
	if PersonKF(pid,77) and (PersonKF(pid,196) or match_ID(pid,616)) and (yongjian(wugong) or yongdao(wugong)) and WAR.ZYHB == 0 and fjpd(WAR.CurID) == false then
		if JLSD(10,40,pid) and WAR.DZXY == 0 then
			WAR.ZYHB = 1
		end
	end
	--周伯通触发一次左右后，有几率根据资质追加第二次左右，畅想专属
	if ZYHBPD(pid) == 2 and WAR.ZYHB == 2 and WAR.ZHB == 0 then
		local zyjl = 80 - JY.Person[pid]["资质"]
		--周伯通支线完成后，主角+20%
		if zyjl < 0 then
			zyjl = 0
		end
		if match_ID(pid,0) and JY.Person[64]["品德"] == 80 then
			zyjl = zyjl + 20
		end
		--斗转星移不触发左右
		if (JLSD(0,zyjl, pid) or match_ID(pid,64)) and fjpd(WAR.CurID) == false then
			WAR.ZHB = 1
		end
	end
	
	if WAR.ZYHB == 1 and WAR.PD['天剑绝刀2'][pid] ~= nil and JLSD(0,math.modf(WAR.PD['天剑绝刀2'][pid]*15)+10,pid) then
		WAR.ZYHB = 0
		WAR.ZHB = 0
	end	
	--左右互搏特效显示
	if WAR.ZYHB == 2 then
		if WAR.ZHB == 2 then
			WAR.PD['真左右互搏'][pid] = 1
			CurIDTXDH(WAR.CurID,429,1,'左右互搏・真谛')
		elseif wugong == 139 and ((PersonKF(pid,100) and PersonKF(pid,154)) or match_ID(pid,605)) then
			Set_Eff_Text(WAR.CurID,4,"玉女素心・双剑精绝")
		elseif PersonKF(pid,77) and (PersonKF(pid,196) or match_ID(pid,616)) and (yongjian(wugong) or yongdao(wugong)) then
			Set_Eff_Text(WAR.CurID,4,"刀剑互搏")
		else
			Set_Eff_Text(WAR.CurID,4,"左右互搏")
		end
	end		 	 
	
	--无酒不欢：连击率用函数计算
	local LJ;
	
	LJ = Person_LJ(pid)
	if yongzhi(wugong) and ZHIQX(pid,'冥河雪涌') >= 1 then	
		local zhilj = math.modf((ZHIQX(pid,'冥河雪涌')*10+20))
		LJ = LJ + zhilj
	end		
	
	

	if WAR.PD['风雷惊蛰1'][pid] ~= nil then
		LJ = LJ + 30
	end	
	
	if WAR.PD['风雷惊蛰2'][pid] ~= nil then
		LJ = LJ - 30
	end
	if WAR.PD['九剑破尽'][pid] ~= nil and WAR.PD['九剑破尽'][pid] > 0 then
		LJ = LJ - (WAR.PD['九剑破尽'][pid] or 0)
	end
	--连击率上限100
	if LJ > 100 then
		LJ = 100 
	end
	if LJ < 1 then
		LJ = 1
	end
	
	if math.random(100) <= LJ then
		if WAR.ATNum < 2 then
			WAR.ATNum = 2
		end	
	end

	--高连击武功
	local glj = { 1, 7, 34, 37, 55, 57, 70, 77, 156}
	for i = 1, 9 do
		if JY.Person[pid]["武功" .. wugongnum] == glj[i] and JLSD(10, 70, pid) then
			if WAR.ATNum < 2 then
				WAR.ATNum = 2
			end
		end
	end
	-----------------必连击---------------------------------------------
	local BLJ = 1
	--连击次数追加
    if wugong == 115 then--三花聚顶掌必连击
		BLJ = 2
	elseif wugong == 70 then --中平枪法必连击
	    BLJ = 2
	elseif wugong == 187 then --擒龙手必连击
	    BLJ = 2
	elseif wugong == 188 then --猿公剑法必连击
	    BLJ = 2
	elseif WAR.HSYFD == 2 then --圣火阴风
	    BLJ = 2
	elseif (wugong == 3 or wugong == 21) and XHDB(pid) then --玄寒毒爆组合必连击
	    BLJ = 2
	elseif (JY.Person[pid]["武器"] == 217 or JY.Person[pid]["武器"] == 218 or WGZH(pid,54,62) or match_ID(pid, 77)) and wugong == 62 then --装备鸳鸯刀、萧中慧、天衣无缝组合，夫妻必连
	    BLJ = 2
	elseif wugong == 114 and (match_ID(pid, 37) or match_ID(pid, 589)) then --狄云，水笙连城必连击
	    BLJ = 2
	elseif WAR.PD["太极蓄力"][pid] ~= nil and WAR.PD["太极蓄力"][pid] > 600 then --张三丰、太极神功组合蓄力超过600，必连
	    if match_ID(pid,5) or NGQH(pid,171) or JLSD(10,60,pid) then
			BLJ = 2
		end
	elseif wugong == 46 and JY.Person[pid]["武器"] == 236 then --蓝烟清：装备真武剑使用太极剑法必连击
	    BLJ = 2
	elseif (NGQH(pid,104) or JLSD(10,40,pid)) and WAR.L_NYZH[pid] ~= nil then  --逆运蛤蟆
	    BLJ = 2
	elseif WAR.YLSJJ == 1 and BNJQ(pid) then ----玉女十九剑 满怒必连
	    BLJ = 2
	elseif match_ID(pid,568) and wugong == 200 then --岳云 岳家枪法必连
	    BLJ = 2
	elseif match_ID(pid,9752) and wugong == 234 then --五行六合掌天赋必连击
	    BLJ = 2
	elseif match_ID(pid,9751) and wugong == 13 then --铁掌天赋必连击
	    BLJ = 2
	elseif match_ID(pid,9750) and wugong == 129 then --旋风扫叶腿天赋必连击
	    BLJ = 2
	elseif (wugong == 39 or wugong == 42 or wugong == 139) and WGZH(pid,39,42) then --双剑合壁 必三连
	    BLJ = 3
	elseif wugong >= 30 and wugong <= 34 and JLSD(30, WuyueJFSL(pid)*5+30, pid) then --五岳剑法组合额外连击
	    BLJ = 3
	elseif yongdao(wugong) and WGZH(pid,54,62) and JLSD(30, 60,pid) then --天衣无缝组合，刀法30%几率3连击
	    BLJ = 3
	elseif match_ID(pid, 102) and wugong == 17 and JLSD(20, 75, pid) then--枯荣一阳指高连
	    BLJ = 3
	elseif (JXPD(pid,24,1) or match_ID(pid, 9891)) and wugong == 27 then --余沧海觉醒后松风剑法必连击
	    BLJ = 3
	elseif (match_ID(pid, 59) or match_ID(pid, 455)) and wugong == 139 and JLSD(20, 75, pid) then --小龙女玉女素心剑高连击
	    BLJ = 3
	elseif match_ID(pid,54) and (PersonKF(pid,90) or PersonKF(pid,375)) and JLSD(10,60,pid) then --袁承志学会混元功高几率三连
	    BLJ = 3
	elseif wugong == 34 and WYJJ(pid) and WAR.ATNum == 2 then --进阶太岳，连击时为三连击
	    BLJ = 3
	elseif yongjian(wugong) and (match_ID(pid,141) or match_ID(pid,9840)) and WAR.ATNum == 2 then --成不忧，剑法连击时为三连击
	    BLJ = 3
	elseif match_ID(pid, 311) or match_ID(pid, 9753) then --三连陈正德
	    BLJ = 3
	elseif WGZH(pid,29,114) and yongjian(wugong) and (JLSD(20,60,pid) or BNJQ(pid)) then  --素质三连
		BLJ = 3
	elseif (wugong == 49 and (PersonKF(pid,17) or match_ID(pid,53))) or match_ID(pid,499) then --六脉神剑
	    BLJ = 3
	elseif NGQH(pid,171) and WAR.Actup[pid] == 1 then --太极纯阳
	    BLJ = 3
	elseif match_ID(pid, 517) then
	    BLJ = 10
	end
	--必连击
	if WAR.PD['必连击'][pid] ~= nil and WAR.PD['必连击'][pid] > 1 then
		local n = WAR.PD['必连击'][pid]
		WAR.PD['必连击'][pid] = nil
		if JLSD(0, 30, pid) then
			n = n + 1
		end
		if WAR.ATNum < n then
			WAR.ATNum = n
		end
	end
	--入魔
	if WAR.PD['入魔'][pid] ~= nil and WAR.PD['入魔'][pid] == 1 then
		if JLSD(0,50,pid) and WAR.ATNum < 3 then
			WAR.ATNum = 3
        elseif WAR.ATNum < 2 then
			WAR.ATNum = 2
		end
	end
	if yongzhi(wugong) and ZHIQX(pid,'冰寒雪冷') >= 1 and JLSD(20,50,pid) then	
		WAR.ATNum = WAR.ATNum + ZHIQX(pid,'冰寒雪冷')
	end		
	--连击结算
	if WAR.ATNum < BLJ then
	    WAR.ATNum = BLJ
	end
	------------------高连击追加------------------ 
	--天外，有33%几率连击
	if Given_WG(pid, wugong) and WAR.TWLJ ~= 2 and (JLSD(33,66,pid) or WAR.PD['风雷惊蛰1'][pid] ~= nil or (match_ID(pid,0) and JY.Person[605]["论剑奖励"] == 1)) then
		if WAR.ATNum < 3 then
			if (JLSD(33,66,pid) or WAR.PD['风雷惊蛰1'][pid] ~= nil or (match_ID(pid,0) and JY.Person[605]["论剑奖励"] == 1)) and WAR.PD['风雷惊蛰2'][pid] == nil then
				WAR.ATNum = 3
				WAR.TWLJ = 1
			else
			    WAR.ATNum = 2
				WAR.TWLJ = 1
			end
		else
		    WAR.TWLJ = 2
		end
	end
	if WAR.PD['风雷惊蛰2'][pid] ~= nil then
		if WAR.ATNum > 2 then
		    WAR.ATNum = WAR.ATNum - 1
		end
	end
	--桃花绝技，有40%几率三连击，暴怒必触发
	if (wugong == 12 or wugong == 18 or wugong == 38) and WGZH(pid,12,18) and (BNJQ(pid) or JLSD(35,75,pid)) then
		if WAR.ATNum < 3 then
			WAR.ATNum = 3
			TXWZXS("桃花影落飞神剑，碧海潮生按玉箫", PinkRed)
		end
	end
	--罗汉伏魔杖法
	if ((wugong == 86 and PersonKF(pid,96)) or (match_ID(pid, 577))) and JLSD(50,80,pid) then 
		local nq = (WAR.LQZ[pid] or 0)/50
		if WAR.ATNum < 3 + nq then
			WAR.ATNum = WAR.ATNum + nq
			Set_Eff_Text(WAR.CurID,2,"伏魔杖法・拨云见日")
		end
	end
	--峨眉暴怒技
	if WAR.EMBN == 1 then
		local em = math.random(3,5)
		if WAR.ATNum < em and JLSD(20, 75, pid) then
			WAR.ATNum = em
		end
	end
	--玉女心经：进趋如风，第一击有几率发动，追加一次连击
	if Curr_NG(pid, 154) and WAR.ACT == 1 then
		local ynjl = 0;
		if match_ID(pid,0) then
			ynjl = 5
		end
		if match_ID(pid,640) then
			ynjl = 100
		end
		if BNJQ(pid) then
			ynjl = 100
		end
		if JLSD(0, 30 + JY.Base["天书数量"]*2 + ynjl, pid) then
			WAR.ATNum = WAR.ATNum + 1
			Set_Eff_Text(WAR.CurID,1,"进趋如风");
		end
	end
	--太虚剑意剑法50%几率三连击，
    if PersonKF(pid,152)  and yongjian(wugong) then
        local jl = 30
	    if Curr_NG(pid,152) then
		    jl = 50
		end
		if math.random(100) <= jl then
			if WAR.ATNum < 3 then
				WAR.ATNum = 3
				TXWZXS("三环套月", PinkRed)
			end
		end
	end
	--擒龙罗汉
	if NGQH(pid,204) then
		if WAR.ATNum < 4 then
			WAR.ATNum = 4
		end
		if JLSD(10,50,pid) then
			WAR.ATNum = WAR.ATNum + 2
		end	 
		WAR.SLCS[pid] = WAR.ATNum
	end 	
	--摘星功天轻
	if TFQG(pid,296) then
		local jl = math.modf(psx(pid,"用毒能力")*0.02)
		if JLSD(5,jl,pid) then
			if WAR.ATNum < 7 then
			    WAR.ATNum = WAR.ATNum + 2
			end
		end
	end
	--何太冲，40%几率动如雷震，暴怒必触发
	if match_ID(pid, 7) and (BNJQ(pid) or JLSD(35, 75, pid)) then
		if WAR.ATNum < 3 then
			WAR.ATNum = 3
		end
		TXWZXS("昆仑秘传・太清剑法・迅雷大三式", M_Red)
	end
	--东方不败
	if (match_ID(pid, 27) or match_ID(pid, 777)) and (BNJQ(pid) or JLSD(10,40,pid)) then
		WAR.ATNum = WAR.ATNum + 1
		TXWZXS("风云再起", PinkRed)
	end
	--三连＆黄衫女、黄裳、万寿道藏
	if (match_ID(pid, 637) or match_ID(pid, 640) or match_ID(pid, 9929)) and WAR.JYLJ == 1 then
		if JLSD(20,60,pid) or BNJQ(pid) then
		    if WAR.ATNum < 3 then
				WAR.ATNum = 3
			end
		else
			if WAR.ATNum < 2 then
				WAR.ATNum = 2
			end
		end
	end
	--齐木思
	if WAR.YQQF > 0 then
		if WAR.ATNum < 3 then
			WAR.ATNum = 3 
		end 
	end 		
	
	--不归三境第二境
	if match_ID(pid,9739) and JY.Base["天书数量"] > 4 and BNJQ(pid) then
		if WAR.ATNum < 3 then
			WAR.ATNum = 3
			Set_Eff_Text(WAR.CurID,"特效文字2","不归三境.第二境");
		end
	end
	
	--倚天连击
	if (JY.Person[pid]["武器"] == 37 or PersonKF(pid,41)) and yongjian(wugong) then
	    local jl = 0;
        if JY.Person[pid]["御剑能力"] > 200 then
			jl = jl + (TrueYJ(pid)*0.1);	
		end
        if jl > 0 then
			--暴怒必触发
			if BNJQ(pid) or jl > Rnd(100) then
				if WAR.ATNum < 6 then
		            WAR.ATNum = WAR.ATNum + 1
				end
				Set_Eff_Text(WAR.CurID,"特效文字0","谁与争锋");
	        end	
	    end
	end
	--剑魔BOSS模式
	if match_ID(pid,592) then
		WAR.PD['独孤剑势'][pid] = WAR.PD['独孤剑势'][pid] or 1
		if WAR.PD['独孤剑势'][pid] ~= nil and WAR.PD['独孤剑势'][pid] > 0 then
			if math.random(10) < (WAR.PD['独孤剑势'][pid]) then
				if WAR.ATNum < 9 then
					WAR.ATNum = WAR.ATNum + 1
				end
			end
		end
	end
	--陆渐三十二身相 神鱼相，33%追加连击一次 
	if match_ID(pid, 497) and WAR.SSESS[pid] ~= nil and WAR.SSESS4 < 1 
	and (BNJQ(pid) or JLSD(20,53,pid)) and JY.Base["天书数量"] > 0 then
		WAR.ATNum = WAR.ATNum + 1
        WAR.SSESS4 = WAR.SSESS4 +1
		Set_Eff_Text(WAR.CurID,"特效文字2","神鱼相");
	end
	--释迦掷象功\尼摩星\化功大法必定单击
	if (wugong == 357 or wugong == 87 or match_ID(pid, 159) or match_ID(pid, 9895)) and WAR.ACT > 1 then
		WAR.ATNum = 1
		WAR.TWLJ = 2
		WAR.ACT = 10
	end
  
	WAR.ACT = 1
	WAR.ACT1 = 1
	WAR.SSESS4 = 0	--三十二身相

	--斗转
	if WAR.DZXY > 0 then
		if WAR.DZXYLV[pid] ~= nil and WAR.DZXYLV[pid] ~= 150 then
			WAR.ATNum = 1
		end
		--慕容博两次，其他人一次
		if (match_ID(pid, 113) or match_ID(pid, 9882)) and WAR.DZXYLV[pid] ~= nil then
			if WAR.ATNum < 2 then
				WAR.ATNum = 2
			end
		end
		if (psx(pid,"门派技能3") == 2 or match_ID(pid, 529)) and WAR.DZXYLV[pid] ~= nil and WAR.DZXYLV[pid] == 150 then
			if WAR.ATNum < 3 then
				WAR.ATNum = 3
			end
		end
	end
	--追击
	if WAR.YTTL > 0 then
		if WAR.YTTLLV[pid] ~= nil and WAR.YTTLLV[pid] == 90 then
			WAR.ATNum = 1
		elseif WAR.YTTLLV[pid] ~= nil and WAR.YTTLLV[pid] == 110 then
			if WAR.ATNum ~= 2 then
				WAR.ATNum = 2
			end
		elseif WAR.YTTLLV[pid] ~= nil and WAR.YTTLLV[pid] == 130 then
		    if WAR.ATNum ~= 3 then
				WAR.ATNum = 3
			end
		end
	end
	if WAR.LKQS > 0 then
		if WAR.LKQSPD[pid] ~= nil and WAR.LKQSPD[pid] > 0 then
			WAR.ATNum = 2
		end	
	end 		
	--------连击抽税--------------------------------------------------------------
	if WAR.ATNum > 3 then
		local ljcs = 8 - JY.Person[pid]['畅想分阶'] - (WAR.PD['灌木阵'][pid] or 0)
		if math.random(9) > ljcs then
			WAR.ATNum = limitX(math.ceil(WAR.ATNum * 0.8),3,9)
		end
	end		
	----------------------------连击循环开始--------------------------------------------
	local kf = wugong
	WAR.WS = 1
	while WAR.ACT <= WAR.ATNum and WAR.ACT <= 9  do --and WAR.ACT1 < 9
	wugong = kf
    local lohanxie = (10 - (WAR.PD['罗汉血'][pid] or 0) - (WAR.PD['灌木阵'][pid] or 0))
		if WAR.ACT > lohanxie then
			break
		end
		if WAR.PD['辰宿列张'][pid] == 1 and math.random(10) < 3 then
			break
        end
		--竹大帮改	
		if WAR.PD['凝结时空'][pid] == 1 then
			break
        end
		if JY.Restart == 1 then
            break
        end
		if JY.Person[pid]["内力"] < JY.Wugong[wugong]['消耗内力点数'] then
			break
		end
		if JY.Person[pid]['体力'] < 5 then
			break
		end
		if WAR.ZDDH == 237 and pid == 18 and WAR.ACT > 1 then
			break
		end
		
	    lib.GetKey()
     
		
		if WAR.BJ == 1 then		--暴击
			WAR.BJ = 0
		end
		if WAR.LXJQ >= 1 then   --龙象神足
		    WAR.LXJQ = 0
	    end 	
		if WAR.LXBL > 0 then    ---龙象神足
			WAR.LXBL = 0        
		end
		if WAR.XWQJ > 0 then   --玄武气劲
			WAR.XWQJ = 0 
		end 
		if WAR.XWQG > 0 then   --玄武气劲
			WAR.XWQG = 0
		end		
		if WAR.LXFM > 0 then	
			WAR.LXFM = 0
		end
			
		if WAR.LHFM > 0 then
			WAR.LHFM = 0
		end	
		
		if WAR.SZH > 0 then
			WAR.SZH = 0
		end	

		if WAR.HYDQJ >= 1 then  --小无相火焰刀
		    WAR.HYDQJ = 0
	    end 
		
		if WAR.HYDNJ > 0 then  --小无相火焰刀
		    WAR.HYDNJ = 0
	    end
		
		--if WAR.YHDF1 >= 1 then  --摄魂
		    --WAR.YHDF1 = 0
	    --end 
		
		if WAR.PJS > 0 then     --独孤九剑
	        WAR.PJS = 0
	    end
		if WAR.PJS1 > 0 then    --独孤九剑
	        WAR.PJS1 = 0
	    end
	    if WAR.PJS2 > 0 then    --独孤九剑
	        WAR.PJS2 = 0
	    end
		if WAR.TFJS > 0 then
			WAR.TFJS = 0
		end	
		WAR.PD['以静制动2'][pid] = nil
		if WAR.PD['以静制动3'][pid] == 1 then
			WAR.PD['以静制动3'][pid] = nil
			WAR.PD['以静制动2'][pid] = {
			JY.Person[pid]["受伤程度"], 
			JY.Person[pid]["中毒程度"], 
			--WAR.FXDS[pid],
			JY.Person[pid]["冰封程度"],
			JY.Person[pid]["灼烧程度"],
			JY.Person[pid]["封穴程度"],
			JY.Person[pid]["流血程度"],
			WAR.PD['迟缓状态'][pid],
			}	
			AddPersonAttrib(pid,"受伤程度",-JY.Person[pid]["受伤程度"])
			AddPersonAttrib(pid,"中毒程度",-JY.Person[pid]["中毒程度"])
			AddPersonAttrib(pid,"冰封程度",-JY.Person[pid]["冰封程度"])
			AddPersonAttrib(pid,"灼烧程度",-JY.Person[pid]["灼烧程度"])
			AddPersonAttrib(pid,"封穴程度",-JY.Person[pid]["封穴程度"])
			AddPersonAttrib(pid,"流血程度",-JY.Person[pid]["流血程度"])
			WAR.PD['迟缓状态'][pid] = nil
			DIYdisplay(CC.ASKILL[4][2])
		end
		if WAR.PD["先天罡气"][pid] ~= nil then
			WAR.PD["先天罡气"][pid] = nil
		end
		-------------------------------------------------------------------------------------------------
		---------------------------------------攻击后清零------------------------------------------------
		-------------------------------------------------------------------------------------------------
		WAR.PD['先天真气1'][pid] = nil
		WAR.PD['天道印记'][pid] = nil
		WAR.PD['血海飘香'][pid] = nil
		WAR.PD['扶摇九天'][pid] = nil
		WAR.PD['玩家暴怒'][pid] = nil
		WAR.PD['电脑暴怒'][pid] = nil
		WAR.PD['亦复如是'][pid] = nil
		WAR.PD['虎啸龙吟'][pid] = nil
		WAR.PD['奇门内伤'][pid] = nil	
		WAR.PD['奇门流血'][pid] = nil	
		WAR.PD['奇门封穴'][pid] = nil		
		WAR.PD['浩然罡气'][pid] = nil
		WAR.PD['野球拳'][pid] = nil
		WAR.PD['西瓜刀'][pid] = nil
		WAR.PD["金刚般若"][pid] = nil
		WAR.PD['照见诸法'][pid] = nil
		WAR.PD['雪花六出'][pid] = nil
		WAR.PD['太极奥义・厚积薄发'][pid] = nil
		WAR.PD['降龙・亢龙有悔'][pid] = nil
		WAR.PD['降龙・震惊百里'][pid] = nil
		WAR.PD['降龙・见龙在田'][pid] = nil
		WAR.PD['黯然・饮恨吞声'][pid] = nil
		WAR.PD['黯然・六神不安'][pid] = nil
		WAR.PD['黯然・行尸走肉'][pid] = nil
		WAR.PD['黯然・穷途末路'][pid] = nil
		WAR.PD['黯然・倒行逆施'][pid] = nil
		WAR.PD['穿山虎铁臂神拳'][pid] = nil		
		WAR.PD['龙爪手'][pid] = nil
		WAR.PD['火延'][pid] = nil
		WAR.PD['侵如火'][pid] = nil
		WAR.PD['绊字决'][pid] = nil
		WAR.PD['封字决'][pid] = nil
		WAR.PD['挑字决'][pid] = nil 
		WAR.PD['戳字决'][pid] = nil
		WAR.PD['曲夕烟隙'][pid] = nil
		WAR.PD['曲径通幽'][pid] = nil
		--读WAR.PD['万佛朝宗'][pid] = nil	
		WAR.PD['九阴破体'][pid] = nil
		WAR.PD['忘情日明'][pid] = nil
		WAR.PD["万佛朝宗"][pid] = nil
		WAR.PD['强运'][pid] = nil
		WAR.PD['必冰封'][pid] = nil
		WAR.PD['必灼烧'][pid] = nil
		WAR.PD["必命中"][pid] = nil
		WAR.PD['必连击'][pid] = nil
		WAR.PD['杀内力'][pid] = nil
		WAR.PD['免疫反击'][pid] = nil
		WAR.PD['免疫断连'][pid] = nil
		WAR.PD['增加气攻'][pid] = nil
		WAR.PD['增加伤害'][pid] = nil
		WAR.PD['必暴击'][pid] = nil
		--WAR.PD['负面状态'][pid] = nil
		WAR.PD['集气速度'][pid] = nil
		WAR.TKJQ1[pid] = nil
		WAR.PD["TXZHATK3"][pid] = nil
		WAR.PD["太玄组合攻击4"][pid] = nil
		WAR.PD["太玄组合攻击5"][pid] = nil
		WAR.PD['全屏攻击'][pid] = nil
		WAR.PD['极意攻击'][pid] = nil
		--门派全场战斗变量----
		WAR.JGDQZ = 0--少林金刚殿拳掌
		WAR.JGDZF = 0--少林金刚殿指法
		WAR.LHTDF = 0--少林罗汉堂刀法
		WAR.LHTQM = 0--少林罗汉堂奇门
		WAR.WYJF = 0
		WAR.WYJF1 = 0
		WAR.WYLW1 = 0
		WAR.WYLW2 = 0
		WAR.WYLW3 = 0
		WAR.WYLW4 = 0
		WAR.WYLW5 = 0
		WAR.YSSH = 0
		WAR.YSSH1 = 0
		WAR.YSSH2 = 0
		WAR.YSSH3 = 0
		WAR.YSSH4 = 0
		if WAR.TMYJ > 0 then
			WAR.TMYJ = 0
		end	
		WAR.TMYJ1 = 0
		WAR.MXSX1 = 0
		WAR.MXSX2 = 0
		WAR.MXSX3 = 0
		WAR.MXSX4 = 0
		WAR.SYWGZ = 0
		WAR.JSLZ = 0
		WAR.JGZT = 0
		WAR.LXBRZ = 0
		WAR.JZSEG = 0
		WAR.GBBZ = 0
		WAR.ZLJS1 = 0
		WAR.ZLJS2 = 0
		WAR.ZLJS3 = 0
		WAR.ZLJS4 = 0
		WAR.ZLJS5 = 0
		WAR.ZLJS6 = 0
		WAR.QSAY = 0 
		WAR.YYDL = 0
		WAR.YYDL1 = 0
		WAR.HSYFD = 0
		WAR.YFDLW = 0
		WAR.SGSF = 0
		WAR.SFJZ = 0
		WAR.EMBN = 0
		WAR.MMJF = 0
		WAR.MMJF1 = 0       
	    WAR.MMJF2 = 0      
	    WAR.MMJF3 = 0       
	    WAR.MMJF4 = 0       
	    WAR.MMJF5 = 0       
	    WAR.MMJF6 = 0       
	    WAR.MMJF7 = 0       
	    WAR.MMJF8 = 0   
		WAR.MMJF9 = 0
		WAR.MMJF10 = 0    
		WAR.WTJJ = 0       
	    WAR.WTJJ1 = 0      
	    WAR.WTJJ2 = 0      
	    WAR.WTJJ3 = 0      
	    WAR.WTJJ4 = 0      
	    WAR.WTJJ5 = 0      
	    WAR.WTJJ6 = 0      
	    WAR.WTJJ7 = 0      
	    WAR.WTJJ8 = 0      
	    WAR.WTJJ9 = 0      
	    WAR.WTJJ10 = 0     
	    WAR.WTJJ11 = 0     
	    WAR.WTJJ12 = 0     
	    WAR.WTJJ13 = 0     
	    WAR.WTJJ14 = 0     
		WAR.ZBX = 0         
		WAR.LXLL = 0 
		WAR.JYFXJ = 0
		WAR.FXHJ1 = 0
		WAR.FXHJ3 = 0
		WAR.FXHJ4 = 0
		WAR.KMBD = 0
		WAR.TDSWS = 0
		WAR.CTWM1 = 0 --朝廷武穆
		WAR.CTWM2 = 0 --朝廷武穆
		WAR.CTWM3 = 0 --朝廷武穆
		WAR.CTWM4 = 0 --朝廷武穆
		WAR.CTWM5 = 0 --朝廷武穆
		WAR.LRXL = 0
		WAR.CHTD = 0
		WAR.SHPS = 0
		WAR.DGJJ_LDXJ = 0
		WAR.ZFBJ1 = 0
		WAR.ZFBJ2 = 0
		WAR.ZFBJ3 = 0
		WAR.ZFBJ4 = 0
		WAR.QLXLJL = 0
		WAR.LMAY = 0
		WAR.SFBJ = 0
		WAR.TJGJ = 0
		WAR.POISON = 0
		if WAR.DJGZ == 1 then	--刀剑归真
			WAR.DJGZ = 0
		end
		if WAR.NSFEWSS == 1 then	--你是风儿我是沙
			WAR.NSFEWSS = 0
		end
		if WAR.CY == 1 then		--程英 杀内力
			WAR.CY = 0
		end
		WAR.JYZJ_FXJ= 0
		WAR.DFMQ = 0		--大伏魔拳	
		WAR.NGJL = 0		--当前加力内功编号
		WAR.KHBX = 0		--葵花刺目
		WAR.LXZQ = 0
		WAR.LXYZ = 0
		WAR.GCTJ = 0
		WAR.ASKD = 0
		WAR.LXBR = 0
		WAR.JSYX = 0
		WAR.JLJG = 0
		WAR.BMXH = 0
		WAR.BMSGXL=0
		WAR.DZTG_DZS=0
		WAR.CQSX_WZSX=0
		WAR.TD = -1
		WAR.TDnum = 0
        WAR.TZ_XZ = 0		--虚竹指令
        WAR.JGZ_DMZ = 0		--达摩掌
        WAR.LHQ_BNZ = 0		--般若掌
		WAR.XDLX = 0		--血刀流血
        WAR.WD_CLSZ = 0		--赤练神掌
		WAR.LHFSD = 0		--连环腐尸毒
		WAR.XHDB = 0        --玄寒毒爆
		WAR.HLZB = 0        --八荒降龙・荒龙震爆
        WAR.QZ_QXJF = 0		--七星剑法	
        WAR.BXXHSJ = 0		--
        WAR.LWSWD = 0		--	
        WAR.TXZQ = {}		--太玄之轻清除记录
        WAR.HSHD = {}		--黄赏气盾	
        WAR.DZZ = {}		--三十二身相 大自在相 大自在清除记录
        WAR.FGPZ = {}		--	
        WAR.JJJ = {}		--将进酒清除记录
        CleanWarMap(4, 0)           --全屏
        WAR.SJHB_G =0
        WAR.L_TLD = 0		--装备屠龙刀特效，流血
        WAR.YLSJJ = 0
        WAR.NZZ1 = 0	
        WAR.JGSL = 0 		--大金刚神力
        WAR.CXLC = 0		--狄云赤心连城
        WAR.YTLJ = 0		--倚天连击	
        WAR.FQY = 0			--风清扬无招胜有招
        WAR.GHQH = 0		--黄衫女广寒清辉	
        WAR.LXXZD = 0		--梁萧谐之道
        WAR.AJFHNP = 0		--
        WAR.YTML = 0 		--毒王大招
        WAR.SLSS = 0 		--梁萧 星罗散手	
        WAR.JSTG = 0		--天罡大招
        WAR.TXZZ = 0		--太玄之重
		WAR.MMGJ = 0		--盲目攻击
		WAR.CMGJ = 0		--盲目攻击	
        WAR.TGJF = 0        --同归剑法
		WAR.WMYH = 0        --无明业火
		WAR.JSAY = 0		--金蛇奥义
		WAR.QMJ = 0			--青蟒剑
		WAR.CZD = 0			--陈正德
		WAR.YQHS = 0		--朝廷岳枪
		WAR.DJTS = 0
		WAR.JYSS = 0				--九阴摄魂
		WAR.ZHAJ = 0                --中华傲诀
        if WAR.WDKTJ > 0 then
			WAR.WDKTJ = 0
			if WAR.YJZD[pid] == 1 and tjqfj(pid) then
				WAR.PD['借力打力'][pid] = nil
				WAR.BG[pid] = nil
				if WAR.PD['太极蓄力'][pid] ~= nil then
					WAR.PD['太极蓄力'][pid] = math.modf(WAR.PD['太极蓄力'][pid]*(7-JY.Person[pid]['畅想分阶'])*0.1)
				end
			end			
		end	
		WAR.HZGX = 0		--标记修改
		WAR.SZAS = 0
        WAR.GHQH = 0		--	
        WAR.YQFSQ = 0		--一气化三清	
		WAR.THSB = 0        --桃花三宝
		WAR.TH_BHMY = 0
		WAR.THSB1 = 0       --真・桃花三宝
		WAR.THSB2 = 0       --真・桃花三宝
		WAR.THSB3 = 0       --真・桃花三宝
		WAR.THSB4 = 0       --真・桃花三宝
        
        WAR.QXWXJ = 0		--七弦无形剑 莫大	
        WAR.OYFXL = 0 		--欧阳锋根据蛤蟆蓄力增加伤害
        WAR.LXXL = 0 		--梁萧蓄力增加伤害	
        WAR.XDLeech = 0		--血刀吸血量
		WAR.TZLeech = 0 		--吸血套装
        WAR.RMXX = 0	    --入魔吸血 
        WAR.WYXLeech = 0	--韦一笑吸血量
		WAR.YZHLeech = 0	--云中鹤吸血量
		WAR.QZWDS = 0		--殷离吸血量
		WAR.YLXX = 0 		--千蛛万毒手吸血	标记修改
		WAR.ZZTM = 0 		--庄子天魔
        WAR.TMGLeech = 0	--天魔功吸内量
        WAR.BHGLeech = 0	--碧海吸血量	
        WAR.XHSJ = 0		--血河神鉴吸血量
        WAR.KMZWD = 0 		--周伯通空明之武道
		WAR.XTQKG = 0       --先天乾坤功
        WAR.LFHX = 0 		--林朝英流风回雪
        WAR.YNXJ = 0		--夭矫空碧
		WAR.BRLJ = 0		--般若连击
        WAR.HXZYJ = 0		--会心之一击
        WAR.YYBJ = 0 		--郭靖：有余不尽
        WAR.SEYB = 0	
        WAR.BHJTZ = 0 		--		
        WAR.MHSN = 0 		--	
        WAR.KZJYBF = 0      --
        WAR.BJYPYZ = 0 		--
        WAR.XMJDHS = 0

        WAR.BJYJF = 0      --碧海招式
        WAR.BHJTZ1= 0
        WAR.BHJTZ2= 0
        WAR.BHJTZ3= 0
        WAR.BHJTZ4= 0
        WAR.BHJTZ5= 0
        WAR.BHJTZ6= 0
        
        WAR.DSP_LM1=0   --六脉大招
        WAR.DSP_LM2=0	    
        WAR.DSP_LM3=0	
        WAR.DSP_LM4=0
        
        WAR.NGXS = 0		--内功攻击的系数
        WAR.TYJQ = 0		--阿青天元剑气
        WAR.WWWJ = 0
        WAR.HYYQ=0
        WAR.LDJT = 0
        WAR.CXLZ = 0	
        WAR.QBLL = 0		--
        WAR.SZXM = 0		--	
        WAR.BLCC = 0
        WAR.BLCC_1 = {}	
        WAR.PD['血衣剑法'][pid] = {}
		WAR.PD['无常索命诀'][pid] = {}
		WAR.PD['血衣剑法5'][pid] = nil
		WAR.PD['血衣剑法1'][pid] = nil
		WAR.PD['无常索命诀4'][pid] = nil
		WAR.PD['无常索命诀5'][pid] = nil
		if WAR.PD['燎原枪1'][pid] ~= nil then
			WAR.PD['燎原枪1'][pid] = nil
		end	
		WAR.PD['天地之心'][pid] = nil
		WAR.PD['四智妙法'][pid] = nil
		WAR.XMHSQ = 0		
        WAR.JTYJ1 = 0		--惊天一剑
        WAR.HZD_1 = 0		--陆渐海之道，上善若水，
        WAR.HZD_2 = 0		--陆渐海之道，海纳百川		
        WAR.OYK = 0 		--欧阳克灵蛇拳
        WAR.YTZ = 0 		--游坦之 标记修改		
		WAR.HZJHS = 0		--虎爪绝户手
		WAR.LDJM = 0		--六道尽灭
		WAR.DN=0			--鹤笔翁
		WAR.YKDD = 0 		--玄慈一空到底
        WAR.JQBYH = 0		--六脉：剑气碧烟横
        WAR.LPZ = 0			--林平之回气
        WAR.JXG_SJG =0      --鲸息功 神鲸歌
        
        WAR.QQSH1 = 0		--琴棋书画之持瑶琴
        WAR.QQSH2 = 0		--琴棋书画之妙笔丹青
        WAR.QQSH3 = 0		--琴棋书画之倚天屠龙功
        WAR.QSAY = 0		--七伤奥义
        WAR.CMDF = 0		--沧溟刀法
        WAR.ZWX = 0	
		WAR.KHZF = 0
        WAR.HTS = 0			--何铁手五毒随机2-5倍威力
        WAR.YZQS = 0		--一震七伤
        
        WAR.JJZC = 0		--九剑真传的4种主动攻击特效，攻击后会清0
        WAR.JMZL = 0
        
        WAR.ZWYJF = 0		--有剑诀的五岳剑法，无视绝对气防
        
        WAR.MTJJ = 0          --喵太极奥义
        WAR.JuHuo = 0			--举火燎原
        WAR.LiRen = 0			--利刃寒锋
		WAR.TYJW = 0            --萧秋水・腾云
        WAR.BRXL = 0			--般若蓄力
        WAR.LWX = 0				--李文秀的破气防特效
        WAR.LXZL10 = 0			--龙象之力暴怒，忽视绝对气防 
        WAR.XC_WLCZ = 0			--	
		WAR.YZG=0
        WAR.XC_JJNP = 0		
        WAR.PDJN = 0			--陈家洛庖丁解牛	
		WAR.HJY = 0			--花间游
        WAR.L_QKDNY = {}	--重新计算乾坤大挪移是否被反弹过
        WAR.TXXS = {} 		--特效点数显示
        WAR.RULAISZ = 0
        WAR.RULAISZ_1 = 0
		-----新增组合的部分攻击特效归零----------------------
		WAR.KLYH = 0
		WAR.CJSZ = 0
		WAR.XTZJ = 0
		WAR.HYZF = 0        --幻阴指法
		WAR.QTSPQ = 0       --七探蛇盘枪
		WAR.XMMD = 0        --虾米魔刀
		WAR.XMSZ = 0        --玄冥神掌
		WAR.XMSZ1 = 0       --玄冥神掌+寒冰真气
		WAR.XMSZ2 = 0       --玄冥神掌+寒冰真气
		WAR.XMSZ3 = 0       --玄冥神掌+寒冰真气
		WAR.XMSZ4 = 0       --玄冥神掌+寒冰真气
		WAR.ARJX = 0
		WAR.NYAR = 0
		WAR.JWDF = 0        --金乌刀法
		WAR.FQDF = 0        --夫妻刀法
		WAR.QLXL = 0        --擒龙降龙
		WAR.QLXLJL = 0      --擒龙降龙
		WAR.BHXL = 0        --八荒降龙
		WAR.YNSX = 0        --玉女素心剑法
		WAR.YNSX1 = 0
		WAR.QZJF = 0        --全真剑法特效 
		WAR.YXMQ = 0        --玉箫剑法
		WAR.LYBF = 0        --落英神剑掌
		WAR.SDWLB = 0
		WAR.XLSDL = 0       --降龙三叠浪
		WAR.XWXZX = 0 --小无相杂学
		WAR.KHSZ1 = 0--葵花神针＋葵花神功
		WAR.HZHQ = 0 --寒冰绵掌+寒冰真气
		WAR.HTSFX = 0 --黄天兽法相
		WAR.HTZRL = 0 --黄天自然流
		WAR.TJJD = 0
		WAR.YSCM1 = 0 --易水沧溟刀
		WAR.YSCM2 = 0 --易水沧溟刀
		WAR.YSCM3 = 0 --易水沧溟刀
		WAR.YYLMJJF = 0
		WAR.TJZX_LJ = 0
		WAR.YQQF = 0       --野球拳
		WAR.SSJF = 0       --神山剑法
		WAR.TXQL = 0       --太玄青莲
		if WAR.LTS > 0 then
			WAR.LTS = 0
		end	
		--无酒不欢：计算内功加力
        local ng = 0
		if JY.Person[pid]["主运内功"] > 0 then
		local cur_NG = JY.Person[pid]["主运内功"]
		    --吸功，金刚不坏，五岳剑诀不加力
		    if cur_NG ~= 85 and cur_NG ~= 87 and cur_NG ~= 88 then
				local cur_NGL = 0;
				for i = 1, JY.Base["武功数量"] do
					if JY.Person[pid]["武功"..i] ==  cur_NG then
						cur_NGL = JY.Person[pid]["武功等级" .. i];
						if cur_NGL == 999 then
							cur_NGL = 11
						else
						    cur_NGL = math.modf(cur_NGL / 100) + 1
						end
						break;
					end
				end
				--主运内功有35%的高优先级判定
				if cur_NGL ~= 0 then 
					local dd = limitX(JY.Person[pid]['品德'],0,100)
					if NGQH(pid,108) and JLSD(30,dd,pid) then
						ng = get_skill_power(pid, 108, 11);
						ng = ng + math.modf(ng * math.random(5)*0.1)
						Set_Eff_Text(WAR.CurID,2,"易筋真谛加力")
						WAR.Person[id]["特效动画"] = 155
						WAR.NGJL = 108
						Cat('清除中级异常',WAR.CurID)
						if WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[pid] > 100 then
							ztd(WAR.CurID,"生命点数",math.modf(ng*0.1))
							ztd(WAR.CurID,"内力点数",math.modf(ng*0.2))
							ztd(WAR.CurID,"体力点数",math.modf(ng*0.03))
						end
					elseif JLSD(30, 65, pid) then
					    if WAR.PD['夜雨绵延'][pid] ~= nil then
							Set_Eff_Text(WAR.CurID,2,"夜雨绵延・经滞脉塞")
							WAR.PD['西域奇毒'][pid] = 20
							ztd(WAR.CurID,'中毒点数',20)
							WAR.PD['夜雨绵延'][pid] = (WAR.PD['夜雨绵延'][pid] or 0) + 5
						else		
						    ng = get_skill_power(pid, cur_NG, cur_NGL);
						    --WAR.Person[id]["特效文字2"] = JY.Wugong[JY.Person[pid]["主运内功"]]["名称"] .. "加力"
							Set_Eff_Text(WAR.CurID,2,JY.Wugong[JY.Person[pid]["主运内功"]]["名称"] .. "加力")
							WAR.Person[id]["特效动画"] = 93
							WAR.NGJL = JY.Person[pid]["主运内功"];
							if WAR.NGJL == 354 then
								local a = math.random(2)
								if a == 1 then
									WAR.NGJL = JY.Wugong[354]['冰封系数']
								else
								    WAR.NGJL = JY.Wugong[354]['灼烧系数']
								end
							end
							if WAR.NGJL == 381 then
								local a = math.random(2)
								if a == 1 then
									WAR.NGJL = JY.Wugong[381]['冰封系数']
								else
								    WAR.NGJL = JY.Wugong[381]['灼烧系数']
								end
							end						
						end	
					end
				end	
			end
			--如果没有触发主运内功加力，再判定一般加力
        else
            local N_JL = {};		
            local num = 0;	--当前学了多少个内功
            for i = 1, JY.Base["武功数量"] do
				local kfid = JY.Person[pid]["武功" .. i]
				local kflvl = JY.Person[pid]["武功等级" .. i]
				if kflvl == 999 then
					kflvl = 11
				else
				    kflvl = math.modf(kflvl / 100) + 1	
				end
				--先把内功都存入表格，吸功，金刚不坏，风林六如，五岳剑诀不加力
				if yongnei(kfid) and kfid ~= 85 and kfid ~= 87 and kfid ~= 88 then
					num = num + 1;
					N_JL[num] = {kfid,i,get_skill_power(pid, kfid, kflvl)};
				end
			end 
            --如果学有内功
            if num > 0 then	
                --按照威力从大到小排序，威力一样的话按照面板的先后顺序
                for i = 1, num - 1 do
                    for j = i + 1, num do
                        if N_JL[i][3] < N_JL[j][3] or (N_JL[i][3] == N_JL[j][3] and N_JL[i][2] > N_JL[j][2])then
                            N_JL[i], N_JL[j] = N_JL[j], N_JL[i]
                        end
                    end
                end
                --按顺序判定触发
                for i = 1, num do
                    --王重阳北斗七闪状态必定加力
                    if (match_ID(pid, 129) and WAR.BDQS > 0) or myrandom(10, pid) then
						ng = N_JL[i][3];
						if WAR.PD['重度内伤'][pid] ~= nil then
							ng = -math.modf(ng*2)
						end	
                        --WAR.Person[id]["特效文字2"] = JY.Wugong[N_JL[i][1]]["名称"] .. "加力"
                        Set_Eff_Text(WAR.CurID, "特效文字2", JY.Wugong[N_JL[i][1]]["名称"] .. "加力")
                        WAR.Person[id]["特效动画"] = 87 + math.random(6)
                        WAR.NGJL = N_JL[i][1];
                        break;
                    end
                end
            end
        end
		--攻击时计算连锁次数
		if WAR.Person[WAR.CurID]["我方"] then
			WAR.URCHAIN = 0
			if WAR.MYCHAINADD == 0 then
				WAR.MYCHAINADD = 0
				if WAR.MYCHAIN >= 0 then
					WAR.MYCHAIN = WAR.MYCHAIN + 1
				else
					WAR.MYCHAIN = WAR.MYCHAIN + 1
				end
				if WAR.MYCHAIN > 30 then WAR.MYCHAIN = 30 end
			end
		else
			WAR.MYCHAIN  = 0
			if WAR.URCHAINADD == 0 then
				WAR.URCHAINADD = 0
				if WAR.URCHAIN >= 0 then
					WAR.URCHAIN = WAR.URCHAIN + 1
				else
					WAR.URCHAIN = WAR.URCHAIN + 1
				end			
				if WAR.URCHAIN > 30 then WAR.URCHAIN = 30 end
			end		
		end
		if WAR.SPIRIT[pid] == nil then
			WAR.SPIRIT[pid] = 10
		end
		--战意爆发
		if WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[pid] >= 200 and WAR.PD["战意爆发"][pid] == nil then
			WAR.SPIRIT[pid] = 200
			local s = WAR.CurID
			--WAR.CurID = i
			WarDrawMap(0)
			--CurIDTXDH(WAR.CurID, 6, 1, "战意爆发")
			WAR.PD["战意爆发"][pid] = 1
		end
		--判断攻击次数大于1，显示连击
		if WAR.ACT > 1 and WAR.PD["刀剑绝技"][pid] == nil then
			local A = "连击"
			if WAR.TWLJ == 1 then
				A = "天赋外功.炉火纯青"
			end
			if WAR.TJZX_LJ == 1 then
			    A = "太极之形.圆转不断"
			end
			--东方不败
			if match_ID(pid, 27) or match_ID(pid, 777) then
				A = "风云再起"
			end
            --丐帮擒龙战意
			if MPTX(pid,2,3) and Curr_NG(pid,204) then
				if WAR.ACT == 2 and JLSD(10,90,pid) then
					WAR.GBZY = 1
					A = "傲血战意"
				elseif WAR.ACT == 3 and JLSD(10,70,pid) then
				    WAR.GBZY = 2
					A = "傲骨战意"
				elseif WAR.ACT == 4 and JLSD(10,50,pid) then
				    WAR.GBZY = 3
					A = "傲天战意"
				elseif WAR.ACT > 4 then
				    WAR.GBZY = WAR.ACT
				    A = "傲天战意"
				end
			end
			--夫妻刀法
			if wugong == 62 then
				--萧中慧
				if match_ID(pid, 77) then
					A = "碧箫声里双鸣凤"
				--主角男性	
				elseif pid == 0 and JY.Person[0]["性别"] == 0 then
				    A = "英雄无双风流婿"
				--主角女性
				elseif pid == 0 and JY.Person[0]["性别"] ~= 0 then
				    A = "刀光掩映孔雀屏"
				end
            end
			Set_Eff_Text(WAR.CurID,4,A)
		end
		---------------------------暴击结算-----------------------------------------
		--无酒不欢：暴击率用函数计算
        local BJ;
        BJ = Person_BJ(pid)
    
		--重剑真传
        if WAR.XTZJ == 1 then
	        BJ = BJ + 60
        end 		
		--黯然大招
		if WAR.ARJX == 2 then
			BJ = BJ + 60
		end	
		--齐木思
		if WAR.YQQF == 1 then
			BJ =BJ + 70
		end 	
		--指法暴击
		if yongzhi(wugong) and ZHIQX(pid,'万魄枯魂') >= 1 and JLSD(20,50,pid) then	
			BJ = BJ + math.modf((ZHIQX(pid,'万魄枯魂')*10)+10)
		end 	
		if WAR.PD['九剑破尽'][pid] ~= nil and WAR.PD['九剑破尽'][pid] > 0 then
			BJ = BJ - (WAR.PD['九剑破尽'][pid] or 0)
		end
		--逆运蛤蟆
		if (NGQH(pid,104) or JLSD(10,40,pid)) and WAR.L_NYZH[pid] ~= nil then 
			BJ = BJ + 30 
		end
		--初生牛犊
		if match_ID(pid,9743) then
			BJ = BJ + 50 
		end
        --一刀流
		if MPTX(pid,11) then
			BJ = BJ + 50
			if match_ID(pid,741) or match_ID(pid,742) then --噩梦
		        BJ = 100
	        end	 
		end
		--达摩九阳
		if wugong == 140 and WAR.PD["苦难达摩"][pid] ~= nil and WAR.PD["苦难达摩"][pid] > 0 then
			local kn =  (WAR.PD["苦难达摩"][pid] or 0) / 30
			BJ = BJ + math.modf(kn)
		end
		--龙象大力杵
	    if (wugong == 83 and Curr_NG(pid,103)) or match_ID(pid,62) then	
			BJ = BJ + 60
		end
		--唐门模式1
		if MPTX(pid,9) then 
            BJ = BJ + 40
        end	
		--暴击率上限100
        if BJ > 100 then
            BJ = 100
        end
		if BJ < 1 then
            BJ = 1
        end
        if JLSD(0,BJ,pid) then
            WAR.BJ = 1
        end
		--必暴击武功
		local gbj = {11, 13, 28, 33, 58, 59, 72, 75, 114}
		for i = 1, 9 do
			if JY.Person[pid]["武功" .. wugongnum] == gbj[i] and JLSD(20, 75, pid) then
				WAR.BJ = 1
			end
			break;
        end
		--碧海几率破气防
		if PersonKF(pid, 248) then
			if JLSD(0, 40, pid) then
                WAR.BJ = 1
				WAR.PD["必杀气"][pid] = 1
            end
		end
		--绣花针，忽视绝对气防 
        if JY.Person[pid]["武器"] == 349 or match_ID(pid,27) or match_ID(pid,777) then
			WAR.PD["必杀气"][pid] = 1
			ng = ng + 800
        end
        --装备玄铁剑，配合玄铁剑法
        --1级50%暴击率，6级100%
        --6级解锁破尽天下，必暴击，无视绝对气防
        if (JY.Person[pid]["武器"] == 36 or PDTZ(pid,JY.Person[pid]["武器"]) or PersonKF(pid,252)) and wugong == 45 then
            if JLSD(0, 40 + JY.Person[pid]["实战"]/20, pid) then
                WAR.BJ = 1
            end
            if WAR.BJ == 1 then
                WAR.PD["必杀气"][pid] = 1
				ng = ng + 2000
                Set_Eff_Text(WAR.CurID,"特效文字0","重剑无锋・破尽天下");
            end
        end
        	
        --碧海招式5必暴击 滴水劲
        if WAR.BHJTZ5== 1  then
   		    WAR.BJ = 1
		end			
        --弹指神通，配合桃花绝技，必暴击
        if wugong == 18 and WGZH(pid,12,18) then
            WAR.BJ = 1
        end
        --余沧海觉醒后松风剑法必暴击
        if wugong == 27 and (JXPD(pid,24,1) or JXPD(pid,9891,1))  then
            WAR.BJ = 1
        end
        --傲世神罡
        if match_ID(pid,9989) or match_ID(pid,50) or match_ID(pid,567) then
            WAR.BJ = 1
        end
        --无量禅震
        if wugong == 86 and match_ID(pid,9994) then
            WAR.BJ = 1
        end
		--龙象之力
		if WAR.LXLL == 1 then
			WAR.BJ = 1
		end 	
		--金刚般若 大金刚掌
		if wugong == 22 and JinGangBR(pid) then
			WAR.BJ = 1 
		end
		--天魔功，必暴击
		if Curr_NG(pid, 160) then
			WAR.BJ = 1
		end
		--醉八仙
		if WAR.ZBX == 6 then
			WAR.BJ = 1 
		end
		--南山黄沙
		if wugong == 53 and WGZH(pid,53,78) then
	 		WAR.BJ = 1 
		end
		--奇门剪刀
		if wugong == 56 and WGZH(pid,56,75) then
			WAR.BJ = 1
		end
		if PersonKF(pid, 252) and JLSD(0, 50, pid) then
			WAR.BJ = 1
		end
		if match_ID(pid,9761) and wugong == 155 then
			WAR.BJ = 1
		end
		if match_ID(pid,9760) and wugong == 36 then
            WAR.BJ = 1
        end
        if match_ID(pid,568) and wugong == 198 then
            WAR.BJ = 1
        end
		--兽王庄
		if MPTX(pid,27) then
			WAR.BJ = 1
		end 	
    
		--如果暴击
        if WAR.BJ == 1 then
            WAR.Person[id]["特效动画"] = 89		--暴击特效动画
            local str = ""
            if match_ID(pid, 50) then			--乔峰特效文字
                local r = nil
                r = math.random(3)
                if r == 1 then
          	        str = "教单于折箭・六军辟易・奋英雄怒" 
                elseif r == 2 then
          	        str = "虽万千人吾往矣"	
                elseif r == 3 then
                    str = "胡汉恩仇・须倾英雄泪"   
                end
            end
			if match_ID(pid, 112) and WAR.ZHRM[pid] == nil and WAR.XYS > 0 then --萧远山特效文字
				if WAR.XYS == 3 then
					str = "七杀・搅乱世界之贼"	
				elseif WAR.XYS == 2 then
					str = "破军・纵横天下之将" 	
				elseif WAR.XYS == 1 then
					str = "贪狼・奸险诡诈之士" 
				end
			end
			--临济峨眉
			if NGQH(pid,247) then
				ztd(WAR.CurID,'体力点数',math.random(5,15))
				if (WAR.PD['回气'][pid] or 0) < 300 then
					addbuff(pid,WAR.PD['回气'],300)
				end
				WAR.PD['天地之心'][pid] = 1
				str = '临济桩法・天地之心'
			end	
			if str ~= "" then
				Set_Eff_Text(WAR.CurID,4,str)
			else	
  	            Set_Eff_Text(WAR.CurID,4,'暴击')
			end	
        end
		---------------对招或合击---------------and match_ID(WAR.Person[ZHEN_ID]["人物编号"],0)
		local ZHEN_ID = -1
		for heji = 0, WAR.PersonNum -1 do 
			if dead(heji) == false then
				if WAR.PD['同时出招'][WAR.Person[heji]['人物编号']] ~= nil then
					ZHEN_ID = WAR.PD['同时出招'][WAR.Person[heji]['人物编号']]
					break
				end
			end
		end				
		WarDrawAtt(x, y, atkfanwei, 3)
		if ZHEN_ID >= 0 then
			WarDrawAtt(WAR.Person[ZHEN_ID]["坐标X"] + x0 - x, WAR.Person[ZHEN_ID]["坐标Y"] + y0 - y, atkfanwei, 3)
		end
        Cat('神游太虚2')
		--木凭 顾影自怜
		Cat('顾影自怜')
		----------------------------------------------------------------------------------------------
		---------------------------------------------人物出手后-----------------------------------------
		----------------------------------------------------------------------------------------------
		--东方其疾如风・天关阵
		if match_ID(pid,27) and isteam(pid) == false and WAR.ZDDH == 348 and JLSD(10,40,pid) then
			WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字0","其疾如风");
			WAR.PD['疾如风'][pid] = (WAR.PD['疾如风'][pid] or 0) + 1
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					WAR.Person[j].Time = WAR.Person[j].Time + 100
				end
				if WAR.Person[j].Time > 980 then
					WAR.Person[j].Time = 980
				end
			end
		end
		--龙木岛主
		if (match_ID(pid,40) or match_ID(pid,39)) and JLSD(10,60,pid) then
			WAR.SLSX[pid] = 1
			WAR.LXBRZ = math.random(2)
			if WAR.LXBRZ == 1 then
				TXWZXS("龙之力量・刚猛无俦",M_Red)
			else
				TXWZXS("木之刚毅・般若大智",M_Red)
			end	
		end
		--陈家洛庖丁解牛
		if match_ID(pid,75) and JLSD(20,70,pid) then
			WAR.PDJN = 1
			Set_Eff_Text(id,"特效文字1","庖丁解牛")
		end
		--岳灵珊五岳神剑
		if match_ID(pid,79) and JXPD(pid,79,1) and yongjian(wugong) then
			WAR.WYSJ = math.random(1,5)
		end
		--扫地老僧
		if match_ID(pid,114) and BNJQ(pid) then
			Set_Eff_Text(id,1,'立地成佛')
		end
		--宋远桥虎爪
		if ((wugong == 244 and match_ID(pid,171)) or (wugong == 244 and PersonKF(pid,187)) or match_ID(pid,765)) and (JLSD(40,60,pid) or BNJQ(pid))  then
			Cls()
			DrawStrBox(-1, -1, "虎爪奥义・鸡飞蛋打", C_ORANGE, CC.DefaultFont)
			ShowScreen()
			lib.Delay(500)
			WAR.HZJHS = 1
		end
		--东方点点
		if match_ID(pid,457) and WAR.PD['虚邪剑来'][pid] == 1 and yongjian(wugong) then
			local str = ""
			if JLSD(10,40,pid) then
				WAR.PD['虚邪夜玄'][pid] = 15
				str = str.."・夜玄"
			end	
			if JLSD(10,40,pid) then
				WAR.PD['虚邪极日1'][pid] = 1
				str = str.."・极日"
			end	
			if JLSD(10,40,pid) then
				WAR.PD['虚邪蚀月1'][pid] = 1
				str = str.."・蚀月"
			end	
			if JLSD(10,40,pid) then
				WAR.PD['虚邪止水'][pid] = 1
				str = str.."・止水"
				Cat('清除高级异常',WAR.CurID)
			end	
			if JLSD(10,40,pid) then
				WAR.PD['虚邪散魂1'][pid] = 1
				str = str.."・散魂"
			end
			if JLSD(10,40,pid) then
				WAR.PD['虚邪乱魄1'][pid] = 1
				str = str.."・乱魄"
			end
			if JLSD(10,40,pid) then
				for j = 0,WAR.PersonNum-1 do
					local jid = WAR.Person[j]['人物编号']
					if dead(j) == false and DWPD(WAR.CurID,j) then
						WAR.PD['虚邪断空'][jid] = limitX((WAR.PD['虚邪断空'][jid] or 0) +1,0,3)
						if WAR.PD['虚邪断空'][jid] == 3 then
							JY.Person[jid]['主运内功'] = 0
							if JY.Person[jid]['门派技能1'] >= 1 then
								JY.Person[jid]['门派技能1'] = 1
							else
								JY.Person[jid]['门派技能1'] = 0
							end
						end			
					end
				end		
				str = str.."・断空"
			end
			if BNJQ(pid)  then
				
				local bx,by = CC.ScreenW*0,CC.ScreenH*0
				if WAR.ACT == 1 then
					for k = 281,335 do
						Cat('实时特效动画')
						Cls()
						Cat('实时特效动画2')
						lib.LoadPNG(91, k * 2 , bx, by, 1)
						ShowScreen();
						--ShowScreen();
						lib.Delay(CC.BattleDelay*1.85)
					end
				end	
				TXWZXS('虚邪奥义・无尽界空・终焉寂灭',C_BLUE)
				for j = 0,WAR.PersonNum-1 do
					local jid = WAR.Person[j]['人物编号']
					if dead(j) == false and DWPD(WAR.CurID,j) then
						ztd(j,'生命点数',-math.modf(psx(jid,'生命最大值')*0.5))
					end
				end
			end	
			Set_Eff_Text(WAR.CurID,1,'虚邪剑式'..str)
		end
		--西门吹雪
        if JXPD(pid,500,1)  then
            WAR.XMJDHS = 1
            ng = ng +1000
			Set_Eff_Text(id,"特效文字0","剑道化身・破苍穹")
        end
		--竹风雨滴
		if match_ID(pid,520) then
			WAR.MMJF = math.random(1,10)
			local MMJF = "莫名剑法・"
			local WZTS = {"名动一时","剑火无名","悲痛莫名","隐姓埋名","莫名其妙","名不经传","一剑成名","名动江湖","名不虚传","怨忿莫名"}
			WAR.Person[id]["特效文字2"] = MMJF..WZTS[WAR.MMJF];
			if WAR.MMJF == 1 then
				WAR.MMJF1 = 1
			end 
			if WAR.MMJF == 2 then
				WAR.MMJF2 = 1
			end 	
			if WAR.MMJF == 3 then
				WAR.MMJF3 = 1
			end 
			if WAR.MMJF == 4 then
				WAR.MMJF4 = 1
			end 
			if WAR.MMJF == 5 then
				WAR.MMJF5 = 1
			end 
			if WAR.MMJF == 6 then
				WAR.MMJF6 = 1
			end 
			if WAR.MMJF == 7 then
				WAR.MMJF7 = 1
			end 
			if WAR.MMJF == 8 then
				WAR.MMJF8 = 1
			end 
			if WAR.MMJF == 9 then
				WAR.MMJF9 = 1
			end 
			if WAR.MMJF == 10 then
				WAR.MMJF10 = 1
			end 
		end
		--竹风雨滴
		if match_ID(pid,520) then
			WAR.WTJJ = math.random(1,14)
			local WTJJ = "无天绝剑・"
			local WZTS = {"天地初开","气涌山河","剑渡迷津","英雄无觅","剑傲群雄","杀剑还情","万剑同悲","独我为天","狂龙吞天","群雄四起","同傲四方","倚窗寄傲","一剑横空","万剑藏锋"}
			WAR.Person[id]["特效文字0"] = WTJJ..WZTS[WAR.WTJJ];
			if WAR.WTJJ == 1 then
				WAR.WTJJ1 = 1
			end 
			if WAR.WTJJ == 2 then
				WAR.WTJJ2 = 1
			end 
			if WAR.WTJJ == 3 then
				WAR.WTJJ3 = 1
			end 
			if WAR.WTJJ == 4 then
				WAR.WTJJ4 = 1
			end 
			if WAR.WTJJ == 5 then
				WAR.WTJJ5 = 1
			end 
			if WAR.WTJJ == 6 then
				WAR.WTJJ6 = 1
			end 
			if WAR.WTJJ == 7 then
				WAR.WTJJ7 = 1
			end 
			if WAR.WTJJ == 8 then
				WAR.WTJJ8 = 1
			end 
			if WAR.WTJJ == 9 then
				WAR.WTJJ9 = 1
			end 
			if WAR.WTJJ == 10 then
				for j = 0, WAR.PersonNum - 1 do
					if nokillspeed(j) == false and DWPD(WAR.CurID,j) and dead(j) == false then
						ztd(j,'集气位置',-200)
					end	
				end
			end 
			if WAR.WTJJ == 11 then
				WAR.WTJJ11 = 1
			end 
			if WAR.WTJJ == 12 then
				WAR.WTJJ12 = 1
			end 
			if WAR.WTJJ == 13 then
				WAR.WTJJ13 = 1
			end 
			if WAR.WTJJ == 14 then
				WAR.WTJJ14 = 1
			end 
		end	
		--竹风雨滴
		if match_ID(pid,520) or match_ID(pid,741) or match_ID(pid,742) then
			local a = math.random(4)
	        if a == 1 then 
				for j = 0, WAR.PersonNum - 1 do 
			        local df = WAR.Person[j]["人物编号"] 
			        if DWPD(WAR.CurID,j) and dead(j) == false then
						ztd(j,WAR.FXXS,math.random(10,20))
			        end
				end
				Set_Eff_Text(id,3,"无上剑道・无形道")
			elseif a == 2 then 	
			    for i = 0, WAR.PersonNum - 1 do 
			        if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
				        WAR.Person[i].Time = math.max(WAR.Person[i].Time -300, -600)
			        end
		        end
				Set_Eff_Text(id,3,"无上剑道・无情道")
			elseif a == 3 then 
			    local x1 = WAR.Person[WAR.CurID]["坐标X"];
		        local y1 = WAR.Person[WAR.CurID]["坐标Y"];
		        for ex = x1 - 10, x1 + 10 do
			        for ey = y1 - 10, y1 + 10 do
				        SetWarMap(ex, ey, 4, 1)
				        if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
				            local ep = GetWarMap(ex, ey, 2)
					        if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
						        WAR.PD["麻痹状态"][WAR.Person[ep]["人物编号"]] = 10;
						        SetWarMap(ex, ey, 4, 4)	
					        end
				        end
			        end
		        end	
				Set_Eff_Text(id,3,"无上剑道・无名道")
			elseif a == 4 then
			    for i = 0, WAR.PersonNum - 1 do 
				    if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
						ztd(i,"内伤点数",50)
			        end
		        end	
				Set_Eff_Text(id,3,"无上剑道・无我道")
			end			
        end
		--竹风雨滴
		if match_ID(pid,520) then
			local huiful = 2
	        local huifux = 2
			if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] then
				huiful = math.modf(JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"])
				--ztd(WAR.CurID,"生命点数",huiful)
				JY.Person[pid]["生命"] = JY.Person[pid]["生命"] + huiful
				huifux ="天绝剑意恢复生命"..huiful
				DrawStrBox(-1,-1,huifux,C_GOLD,CC.Fontbig);
				ShowScreen();
				lib.Delay(200);
				Cls()
			end
			if JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] then
				huiful = math.modf(JY.Person[pid]["内力最大值"]-JY.Person[pid]["内力"])
				--ztd(WAR.CurID,"内力点数",huiful)
				JY.Person[pid]["内力"] = JY.Person[pid]["内力"] + huiful
				huifux ="天绝剑气恢复内力"..huiful
				DrawStrBox(-1,-1,huifux,C_GOLD,CC.Fontbig);
				ShowScreen();
				lib.Delay(200);
				Cls()
			end
			if JY.Person[pid]["体力"] < 100 then
				huiful = math.modf(100-JY.Person[pid]["体力"])
				--ztd(WAR.CurID,"体力点数",huiful)
				JY.Person[pid]["体力"] = JY.Person[pid]["体力"] + huiful
				huifux ="天绝剑气恢复体力"..huiful
				DrawStrBox(-1,-1,huifux,C_GOLD,CC.Fontbig);
				ShowScreen();
				lib.Delay(200);
				Cls()
			end
	    end
		--倾城之恋
		if match_ID(pid,520) and ((WAR.LQZ[pid] or 0) >= 90 or (WAR.SPIRIT[pid] or 0 ) >= 150) then
			zssdz(pid)
			WAR.ATNum = 1
			WAR.TWLJ = 2
			for i = 40, 80 do
				NewDrawString(-1, -1, "神州最强 倾城之恋", C_GOLD, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "神州最强 倾城之恋", C_GOLD, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end	
			local x1 = WAR.Person[WAR.CurID]["坐标X"];
			local y1 = WAR.Person[WAR.CurID]["坐标Y"];
			for ex = x1 - 99, x1 + 99 do
				for ey = y1 - 99, y1 + 99 do
					SetWarMap(ex, ey, 4, 1)
					if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
						local ep = GetWarMap(ex, ey, 2)
						if WAR.Person[ep]["死亡"] == false and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
							ztd(ep,'生命点数',-JY.Person[WAR.Person[ep]['人物编号']]['生命'])
							JY.Person[WAR.Person[ep]['人物编号']]['生命'] = 0
							if JY.Person[WAR.Person[ep]["人物编号"]]["生命"] <= 0 then
								WAR.Person[ep]["死亡"] = true 		
							end
						end
					end
				end	
			end
		end
		--竹风雨滴血脉压制东方点点
		if WAR.XMYZ == 0 then
			for i = 0, WAR.PersonNum - 1 do
				local wj = WAR.Person[i]["人物编号"]
				if match_ID(wj,520) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["人物编号"] == 457 and DWPD(WAR.CurID,j) and dead(j) == false then
							say("原来是竹老板，打不过，我闪！！！",457,1)
							WAR.Person[j]["死亡"] = true
							lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, -1)
							lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, -1)
							WarDrawMap(0)
							break
						end
					end
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["人物编号"] == 531 and DWPD(WAR.CurID,j) and dead(j) == false then
							say("原来是竹老板，打不过，我闪！！！",531,1)
							WAR.Person[j]["死亡"] = true
							lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, -1)
							lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, -1)
							WarDrawMap(0)
							break
						end
					end
				end
			end
		end
		--竹风雨滴
		if WAR.WZJS[pid] == 1 and WAR.JXFS > 0 then
			ztd(WAR.CurID,'生命点数',-WAR.JXFS * 75)
			WAR.JXFS = 0
			WAR.WZJS[pid] = nil
		end
		--竹风雨滴
		if match_ID(pid,520) then
			WAR.XWQJ = math.random(10)
			local WZTS = {"一","二","三","四","五","六","七","八","九","十"}
			Set_Eff_Text(WAR.CurID,1,"天绝剑意・"..WZTS[WAR.XWQJ].."道罡气")
			if JLSD(0,40,pid) then
				for p = 0, WAR.PersonNum -1 do
					local jqid = WAR.Person[p]["人物编号"]
					if DWPD(WAR.CurID,p) and dead(p) == false then
						WAR.XWGJ[jqid] = limitX((WAR.XWGJ[jqid] or 0) + 1,0,10)
					end
				end
			end
		end
		--喵姐剑法
		if match_ID(pid,526) and yongjian(wugong) then
			WAR.YYLMJJF = 1
		end
		--路人降龙
		if wugong == 26 and match_ID(pid,527) then
			WAR.LRXL = math.random(3)
			local str = ""
			if WAR.LRXL == 1 then
				ng=ng+1000
				if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
			  	WAR.PD['极意攻击'][pid] = 8
		  	end
				str = "降龙・亢龙"
			elseif WAR.LRXL == 2 then
			    str = "降龙・飞龙"
			elseif WAR.LRXL == 3 then
			    str = "降龙・潜龙"
			end
			Set_Eff_Text(WAR.CurID,3,str)
        end
        --路人降龙
		if wugong == 26 and match_ID(pid,527) then
			local zbx = {'吕洞宾・醉酒提壶力千斤','铁拐李・旋争膝撞醉还真','汉钟离・醉步抱埕兜心顶','张果老・醉酒抛杯踢连环'
						,'韩湘子・擒腕擎胸醉吹箫','蓝采和・单提敬酒拦腰破','曹国舅・仙人敬酒锁喉扣','何仙姑・弹腰献酒醉荡步'}
			WAR.ZBX = math.random(1,8)
			CurIDTXDH(WAR.CurID,168,1,'醉八仙')
			Set_Eff_Text(WAR.CurID, 4,zbx[WAR.ZBX])	
		end
		--达摩
		if match_ID(pid,577) then
			WAR.PD["毗婆舍那"][pid] = 1
		end
		--达摩真伤
		if WAR.PD["毗婆舍那"][pid] == 1 then
			for j = 0, WAR.PersonNum - 1 do
				local df = WAR.Person[j]["人物编号"] 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					addbuff(df,WAR.PD['玄铁剑创'],5)
					ztd(j,'生命点数',-math.modf(JY.Person[df]["生命最大值"]*0.02))
				end
			end
			WAR.PD["毗婆舍那"][pid] = nil
		end
		--步惊云 剑廿三  6格
		if match_ID(pid,584) and (JY.Base["天书数量"] > 8 or isteam(pid) == false) and 230 <= TrueYJ(pid) and BNJQ(pid) and yongjian(wugong) then
			CleanWarMap(4, 0)
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
					local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
					local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
					if offset1 <= 7 and offset2 <= 7 then
						SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
					end
				end
			end
			ng = ng + 1000
			WAR.WS = 1
			for n = 1, 20 do
				local i = n
				if i > 10 then 
					i = 10
				end
				Cat('实时特效动画')
				Cls()
				Cat('实时特效动画2')
				NewDrawString(-1, -1, " 剑圣再临--" .. "圣灵・『剑廿三』", C_GOLD, CC.DefaultFont + i*2)
				ShowScreen()
				lib.Delay(CC.BattleDelay)
			end
			WAR.SL23 = 1
		end
		--鹤笔翁
		if match_ID(pid,647) and BNJQ(pid) then
			WAR.DN = 1
			Set_Eff_Text(id,"特效文字0","此地可是白门楼")	
		end
		--噩梦
		if (match_ID(pid,741) or match_ID(pid,742)) and JY.Person[pid]["生命"] > 0 then
			local a = TrueYJ(pid)
			local b = 1000
			local c = JY.Person[pid]["生命增长"]
			ztd(WAR.CurID,"生命点数",a)
			ztd(WAR.CurID,"内力点数",b)
			ztd(WAR.CurID,"体力点数",10)
			ztd(WAR.CurID,"内伤点数",-c)
			ztd(WAR.CurID,"中毒点数",-c)
			CurIDTXDH(WAR.CurID, 90, 1, "剑气调息")
		end
		--万道森罗
		if match_ID(pid,747) or match_ID(pid,520) then 
			WAR.WDSL = math.random(8)
			local wdsl = {"天","地","奇","正","阴","阳","生","灭"}
			CurIDTXDH(WAR.CurID,154,1,"万道森罗・"..wdsl[WAR.WDSL],M_Red)
		end
		--蔷薇
		if match_ID(pid,758) then
			WAR.NFZQ = math.random(7)
			local nfzq = {"百鸟朝凤","鸾凤和鸣","青鸾火凤","凤舞九天","凤皇来仪","凤靡鸾","凤舞九天"}
			CurIDTXDH(WAR.CurID,112,1,"南凤朱雀枪・"..nfzq[WAR.NFZQ],M_Red)
			if WAR.NFZQ == 1 then
				WAR.ATNum = WAR.ATNum + 2
			end
		end	
		--初生牛犊
		if match_ID(pid,9743) and JY.Person[pid]["生命"] > 0 and JLSD(20,50,pid) then
			ztd(WAR.CurID,"生命点数",100)
			ztd(WAR.CurID,"内力点数",200)
			ztd(WAR.CurID,"内伤点数",-2)
			ztd(WAR.CurID,"中毒点数",-2)
			ztd(WAR.CurID,"体力点数",2)
			CurIDTXDH(WAR.CurID, 59, 1, "气力充盈")
		end
		--奇门护盾攻击9848
		if WAR.PD['奇门五转'][pid] ~= nil and WAR.PD['奇门五转'][pid] > 600 and (match_ID(pid,9848) or match_ID(pid,57)) and JLSD(40,90,pid) then
			for j = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[j]["人物编号"]
				local a = math.modf((WAR.PD['奇门五转'][pid] or 0)*0.5)
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"生命点数",-a)
				end
			end
			WAR.PD['奇门五转'][pid] = nil
			Cat('护盾停止',WAR.CurID)
		end
		--欧阳克，暴怒使用雪山白驼掌，变为灵蛇拳
		if (match_ID(pid,61) or match_ID(pid,9856)) and wugong == 9 and BNJQ(pid) then
			WAR.OYK = 1
			Set_Eff_Text(id,"特效文字1","灵蛇拳")
		end
		--郭襄
        if match_ID(pid,626) or match_ID(pid,9859) and WAR.ACT == 1 then
            for j = 0, WAR.PersonNum - 1 do
                local mid = WAR.Person[j]["人物编号"]
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
                    if JY.Person[mid]["内力"] > 300 then
						ztd(j,"内力点数",-300)
                    else
					    JY.Person[mid]["内力"] = 1
						ztd(j,"生命点数",-50)
                    end
                end
				Set_Eff_Text(id, "特效文字1","魔音・万花轮舞曲")
            end
        end
		--黄药师，第一次攻击，伤内力300，内力不足500追加伤害
        if match_ID(pid,57) or match_ID(pid,9860) then
            local pd = false 
            if WAR.ACT == 1 then 
                pd = true 
            end
            if WAR.ACT > 1 and JLSD(0,30,pid) then 
                pd = true 
            end
            --东邪BOSS
            if isteam(pid) == false and match_ID(pid,57) then 
                pd = true
            end
            if pd == true then
                for j = 0, WAR.PersonNum - 1 do
                    local mid = WAR.Person[j]["人物编号"]
                    if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
                        if JY.Person[mid]["内力"] > 500 then
                            ztd(j,"内力点数",-500)
                        else
                            JY.Person[mid]["内力"] = 0
                            ztd(j,"生命点数",-100)
                        end
                        --概率混乱
                        if JLSD(0,30,pid) then 
							if WAR.PD["灵蛇拳"][mid] == nil then
								WAR.PD["灵蛇拳"][mid] = 6
							end
                        end
                    end
                end
				Set_Eff_Text(id, "特效文字1","魔音・碧海潮生曲")
            end
        end
		--玄慈般若掌极意 集气倒退
		if (match_ID(pid,70) or match_ID(pid,9880)) and yongquan(wugong) and BNJQ(pid) then
			WAR.LHQ_BNZ = 1 
			WAR.YKDD = 1
			TXWZXS("般若掌最高境界",M_DarkRed)
		end
		--游坦之 使用冰蚕毒掌
		if match_ID(pid,48) or match_ID(pid,9885) then
			WAR.YTZ = 1
			Set_Eff_Text(id,"特效文字1","千年冰蚕")
		end
		--其疾如风
		if match_ID(pid,9973) or match_ID(pid,759) or WAR.PD['风雷惊蛰3'][pid] ~= nil then 
			local jl = 40
			if match_ID(pid,759) then
				jl = 50
			end
			if JLSD(10,jl,pid) then	
				WAR.Person[id]["特效动画"] = 6
				Set_Eff_Text(id,"特效文字0","其疾如风");
				WAR.PD['疾如风'][pid] = (WAR.PD['疾如风'][pid] or 0) + 1
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
						WAR.Person[j].Time = WAR.Person[j].Time + 100
						if WAR.Person[j].Time > 980 then
							WAR.Person[j].Time = 980
						end
					end
				end
			end  
		end
		--畅想暴怒技
		if pid == 0 and JY.Base["畅想"] > 0 then
			if BNJQ(pid) then
				WAR.PD['玩家暴怒'][pid] = 1
				Set_Eff_Text(id,1,"义愤填膺")
			end 
		end
		--电脑暴怒技
		if inteam(pid) == false then
			if BNJQ(pid) then
				WAR.PD['电脑暴怒'][pid] = 1
				Set_Eff_Text(id,1,"怒不可遏")
			end 
		end
		--野球拳境
		if ((actor(pid,2) and yongzhi(wugong) and JY.Person[pid]["指法技巧"] >= 300) 
		or (actor(pid,1) and yongquan(wugong) and JY.Person[pid]["拳掌功夫"] >= 300)) and JY.Person[pid]["实战"] >= 300 then 
			local gl = math.modf(JY.Person[pid]["实战"]/20)
			if JLSD(0,25+gl,pid) then
				local str = {'猜拳・拳崩如山','猜拳・裁云剪水','猜拳・星罗云布'}
				local a = math.random(3)
				WAR.PD['野球拳'][pid] = a
				if WAR.PD['野球拳'][pid] == 3 then
					ng = ng +1000
					if (WAR.PD['极意攻击'][pid] or 0) < 5 then 
						WAR.PD['极意攻击'][pid] = 5
					end
				end
				Set_Eff_Text(id,"特效文字3",str[a])
			end
		end
		--西瓜刀界
		if actor(pid,4) and yongdao(wugong) and JY.Person[pid]["耍刀技巧"] >= 300 and JY.Person[pid]["实战"] >= 300 then
			local gl = math.modf(JY.Person[pid]["实战"]/20)
			if JLSD(0,25+gl,pid) then
				local str = {'刀・迎风回浪','刀・阴阳交错','刀・草木成佛','刀・天人合一'}
				local a = math.random(4)
				if a < 4 then
					WAR.PD['西瓜刀'][pid] = a
				else
					WAR.PD['西瓜刀・天人'][pid] = 2
				end
				Set_Eff_Text(id,"特效文字3",str[a])
			end
			if WAR.PD['西瓜刀・残刀'][pid] == nil then 
				WAR.PD['西瓜刀・残刀'][pid] = {}
				WAR.PD['西瓜刀・残刀'][pid][1] = 1
				WAR.PD['西瓜刀・残刀'][pid][2] = 50
			else
				WAR.PD['西瓜刀・残刀'][pid][1] = (WAR.PD['西瓜刀・残刀'][pid][1] or 0) + 1 
				if WAR.PD['西瓜刀・残刀'][pid][1] > 20 then 
					WAR.PD['西瓜刀・残刀'][pid][1] = 20
				end
				WAR.PD['西瓜刀・残刀'][pid][2] = 50
			end
		end
		if match_ID(pid,0) and JY.Person[604]["论剑奖励"] == 1 then
			WAR.PD['必命中'][pid] = 1
		end
		--山河破
		if ((pid == 0 and JY.Base["标准"] > 0 and JY.Base["天书数量"] >= 6) or match_ID(pid,759)) and JLSD(20,50,pid) then
			WAR.SHPS = 1
			for i = 40, 80 do
				NewDrawString(-1, -1, "风天流 山河破", M_DeepSkyBlue, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "风天流 山河破", M_DeepSkyBlue, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end	
		end
		--极限挑战npc攻击
		if (not inteam(pid)) and JY.Person[456]["论剑奖励"] > 0 then
			local jx = {90,70,60,45,30,20,10,0}
			local jsjx = jx[JY.Person[pid]['畅想分阶']+1]
			local gj = math.random(1,4)
			if math.random(100) <= jsjx then
				if gj == 1 then
					WAR.PD['强运'][pid] = 1
					WAR.PD['野球拳'][pid] = 1
					Set_Eff_Text(WAR.CurID,"特效文字3","强运")
				elseif gj == 2 then
					WAR.PD['必命中'][pid] =  1
					if WAR.ATNum < 3 then
						WAR.ATNum = WAR.ATNum + 1
					end
					Set_Eff_Text(WAR.CurID,"特效文字3","凝神")
				elseif gj == 3 then
					WAR.BJ = 1
					WAR.PD['免疫反击'][pid] =  1
					Set_Eff_Text(WAR.CurID,"特效文字3","虎贲")
				elseif gj == 4 then
					WAR.PD['侵如火'][pid] = 1
					Set_Eff_Text(WAR.CurID,"特效文字3","气海")
				end
			end
		end
		--蓄力攻击
		if WAR.Actup[pid] ~= nil then
			--主运蛤蟆，追加杀气
			if Curr_NG(pid, 95)  then
				ng = ng + 1200
			else
				ng = ng + 600
			end
			local str = "蓄力攻击"
			if WAR.SLSX[pid] ~= nil then
				str = str .. "・十龙十象"
			end
			Set_Eff_Text(id,"特效文字1",str)
		end
		--怒气暴发，气攻+1200
		if BNJQ(pid) and WAR.DZXY ~= 1 then
			WAR.HXZYJ = 1
			ng = ng + 1000
		end
		----------------------------------------------------------------------------------
		-----------------------------内功出手后特效---------------------------------------
		----------------------------------------------------------------------------------
		--图穷匕见
		if Curr_NG(pid,43) and WAR.PD['易水寒诀'][pid] ~=nil and WAR.PD['易水寒诀'][pid] > 85 and JLSD(0,9,pid) and WAR.YSHJ[pid] == nil then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"]  then
					ztd(j,'集气位置',-999)
				end
			end
			WAR.YSHJ[pid] = 20
			Set_Eff_Text(id,"特效文字1","图穷匕见")
		end
		--北冥神功
		if (PersonKF(pid, 85) and JLSD(45, 75, pid)) or (Curr_NG(pid, 85) and JLSD(20, 70, pid)) then
			if WAR.Person[id]["特效动画"] == -1 then
				WAR.Person[id]["特效动画"] = math.fmod(85, 10) + 85
			end
			Set_Eff_Text(id,"特效文字2","北冥神功");
			WAR.BMXH = 1
			--北冥神功升级
			for w = 1, JY.Base["武功数量"] do
				if JY.Person[pid]["武功" .. w] < 0 then
					break;
				end
				if JY.Person[pid]["武功" .. w] == 85 then
					JY.Person[pid]["武功等级" .. w] = JY.Person[pid]["武功等级" .. w] + 50
					if JY.Person[pid]["武功等级" .. w] > 999 then
						JY.Person[pid]["武功等级" .. w] = 999
					end
					break;
				end
			end
		end
		--化功大法・九死龙爪必触发
		if ((PersonKF(pid, 87) and (JLSD(45, 75, pid) or WAR.JSLZ > 0)) or (Curr_NG(pid, 87) and JLSD(20, 70, pid))) then
			if WAR.Person[id]["特效动画"] == -1 then
				WAR.Person[id]["特效动画"] = math.fmod(87, 10) + 85
			end
			Set_Eff_Text(id,"特效文字2","化功大法");
			WAR.BMXH = 3
			--化功大法升级
			for w = 1, JY.Base["武功数量"] do
				if JY.Person[pid]["武功" .. w] < 0 then
					break;
				end
				if JY.Person[pid]["武功" .. w] == 87 then
					JY.Person[pid]["武功等级" .. w] = JY.Person[pid]["武功等级" .. w] + 50
					if JY.Person[pid]["武功等级" .. w] > 999 then
						JY.Person[pid]["武功等级" .. w] = 999
					end
					break;
				end
			end
		end
		--吸星大法・魔帝必然触发
		if (PersonKF(pid,88) and JLSD(0,30,pid)) or (Curr_NG(pid,88) and JLSD(0,40,pid)) or (match_ID(pid,189) and JLSD(0,50,pid)) or match_ID(pid,26) then
			if WAR.Person[id]["特效动画"] == -1 then
				WAR.Person[id]["特效动画"] = math.fmod(88, 10) + 85
			end
			Set_Eff_Text(id,"特效文字2","吸星大法");
			--吸星大法升级
			for w = 1, JY.Base["武功数量"] do
				if JY.Person[pid]["武功" .. w] < 0 then
					break;
				end
				if JY.Person[pid]["武功" .. w] == 88 then
					JY.Person[pid]["武功等级" .. w] = JY.Person[pid]["武功等级" .. w] + 50
					if JY.Person[pid]["武功等级" .. w] > 999 then
						JY.Person[pid]["武功等级" .. w] = 999
					end
					break;
				end
			end
		end
		--狮子吼
		--狮子吼故意分开写，解决大雷音印与斗战狮吼的触发问题
		if PersonKF(pid, 92) or PersonKF(pid,91) then
			local nl = JY.Person[pid]["内力"];
			local f = 0;
			local chance = 40
			--主运提高效果
			if Curr_NG(pid, 92) or Curr_NG(pid,91) or WAR.LHFM == 1 then
				chance = 100
			end
			--使用狮吼功
			if JLSD(0,chance,pid) or wugong == 91 or wugong == 92 then
				WAR.SZH = 1
				if NGQH(pid,96) then
					WAR.SZH = 2
				end
			end
		end
		--圣火神功
		if PersonKF(pid,93) and TrueTS(pid) >= 200 then
			WAR.DHBUFF = 1
		end
		--罗汉伏魔加力文字特效
		--同时学有易筋神功+罗汉伏魔功，主运易筋神功必出“罗汉伏魔”特效
		--石破天必出罗汉伏魔
		if (Curr_NG(pid, 96) and WAR.NGJL > 0) or (Curr_NG(pid,108) and PersonKF(pid,96)) 
		or (match_ID(pid,9894) and PersonKF(pid,96)) or (match_ID(pid,38) and PersonKF(pid,96)) or WAR.SZH == 2
		or (match_ID(pid,0) and CC.TX['少林掌院选择'] == 2) then
			Set_Eff_Text(id, "特效文字1", "罗汉伏魔")
			if NGQH(pid,96) then
				WAR.LHFM = 1
				zhanyi(pid,15)
			end
		end
		--主运太玄，太玄之重，不加怒
		if Curr_NG(pid, 102) and JLSD(20, 35 + math.modf(JY.Person[pid]["实战"]/25), pid) and match_ID(pid, 39) == false then
			WAR.TXZZ = 1
			Set_Eff_Text(id,"特效文字1","太玄之重")
		end
		--九阴破体
		if Curr_NG(pid,107) and rwnlxz(pid,0) then
			if WAR.ACT == 1 or (WAR.ACT > 1 and JLSD(0,30,pid)) then
				WAR.PD['九阴破体'][pid] = 1
				Set_Eff_Text(WAR.CurID,"特效文字2","九阴破体");
			end
		end
		--九阴飞絮劲
		if PersonKF(pid,107) and rwnlxz(pid,0) then
			local jl = 40
			if JLSD(0,jl,pid) or BNJQ(pid) then
				WAR.JYZJ_FXJ = 1
				Set_Eff_Text(WAR.CurID,"特效文字1","飞絮劲");
			end
		end
		--主运太极神功，太极之形增加连击
		if Curr_NG(pid, 171) and WAR.TJZX[pid] ~= nil and WAR.TJZX[pid] >= 5 then
			WAR.ATNum = WAR.ATNum + 1
			WAR.TJZX[pid] = WAR.TJZX[pid] - 5
			if WAR.TJZX[pid] < 1 then
				WAR.TJZX[pid] = nil
			end
			WAR.TJZX_LJ = 1
		end
		--忘情天书萧秋水 水逝
		if (match_ID(pid, 652) or Curr_NG(pid,177)) and JY.Base["天书数量"] > 1 and JLSD(0, 35, pid) then
			WAR.LFHX = 1
			WAR.Person[id]["特效动画"] = 17
			Set_Eff_Text(id, "特效文字3", "水逝")
			if NGQH(pid,177) then
				WAR.LiRen = 1
				WAR.YTZ = 1
				WAR.Person[id]["特效动画"] = 152
				Set_Eff_Text(id, "特效文字3", "海啸")
			end
		end
		--忘情天书萧秋水 火延
		if (match_ID(pid, 652) or Curr_NG(pid,177)) and JLSD(0, 35, pid) and JY.Base["天书数量"] > 2  then
			WAR.PD['火延'][pid] = 1
			WAR.Person[id]["特效动画"] = 7
			Set_Eff_Text(id, "特效文字3", "火延")
			if NGQH(pid,177) then
				WAR.JuHuo = 1
				WAR.WMYH = 1
				WAR.Person[id]["特效动画"] = 112
				Set_Eff_Text(id, "特效文字3", "焚灭")
			end
		end
		--忘情天书萧秋水 云翳
		if (match_ID(pid, 652) or Curr_NG(pid,177)) and JY.Base["天书数量"] > 4 then
			if JLSD(0, 35, pid) then
				WAR.JJZC = 2
				Set_Eff_Text(id, "特效文字3", "云翳")
				if NGQH(pid,177) then
					Set_Eff_Text(id, "特效文字3", "遮天")
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if nokillspeed(j) == false then
								ztd(j,'集气位置',-200)
							end
						end
					end
				end
			end
		end
		--鲸息功 神鲸歌・集气紊乱
		if Curr_NG(pid,180) and JLSD(0,30,pid) then
			WAR.JXG_SJG = 1
			Set_Eff_Text(id,"特效文字1","神鲸歌")
		end
		--大周天功 大宗师
		if PersonKF(pid,190) then
			local jl = 30
			if Curr_NG(pid,190) then
				jl = 50
			end
			if JLSD(0,jl,pid) or BNJQ(pid) then
				WAR.DZTG_DZS = 1
				Set_Eff_Text(WAR.CurID,"特效文字1","大宗师");
			end
		end
		--全真心法
		if PersonKF(pid,210) and JY.Person[pid]["生命"] > 0 then
			ztd(WAR.CurID,"生命点数",100)
			ztd(WAR.CurID,"内力点数",100)
			ztd(WAR.CurID,"体力点数",3)
		end
		--临济十二庄
		if Curr_NG(pid,247) then
			WAR.PD['内伤恢复'][pid] = 3
			WAR.PD['冰封恢复'][pid] = 2
			WAR.PD['灼烧恢复'][pid] = 2
			WAR.PD['流血恢复'][pid] = 2
			WAR.PD['封穴恢复'][pid] = 1
			WAR.PD['必连击'][pid] = 2
		end
		--碧海潮生功
		if Curr_NG(pid,248) then
			WAR.PD['内伤恢复'][pid] = 3
			WAR.PD['增加气攻'][pid] = 300
			WAR.PD['杀内力'][pid] = 1
		end
		--金关玉锁诀
		if Curr_NG(pid,249) then
			WAR.PD['内伤恢复'][pid] = 3
			if JLSD(0,40,pid) then
				WAR.PD['负面状态'][pid] = 1
			end
		end
		--冰火阴阳诀
		if Curr_NG(pid,250) then
			WAR.PD['内伤恢复'][pid] = 3
			WAR.PD['必冰封'][pid] = 1
			WAR.PD['必灼烧'][pid] = 1
			WAR.JuHuo = 1
			WAR.LiRen = 1
		end
		--奇门遁甲
		if Curr_NG(pid,251) then
			WAR.PD['内伤恢复'][pid] = 3
		end
		if PersonKF(pid,251) then
			addbuff(pid,WAR.PD['集气速度'],3)
			if JLSD(10,30,pid) then
				WAR.PD['闪避'][pid] = 1
			end
		end
		--天霄狂浪，全体集气减100
		if (Curr_NG(pid,252) or (PersonKF(pid,252) and WAR.ACT == 1)) and BNJQ(pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-100) 
					end	
				end
			end
		end
		--中华傲诀
		if NGQH(pid,359) or match_ID(pid,750) then
			local str = ""
			WAR.ZHAJ = math.random(1,5)
			if WAR.ZHAJ == 1 then
				str = "・东方浩然"
			elseif WAR.ZHAJ == 2 then
				str = "・龙跨千山"
			elseif WAR.ZHAJ == 3 then
				str = "・虎啸神州"
			elseif WAR.ZHAJ == 4 then
				str = "・剑气长江"
			elseif WAR.ZHAJ == 5 then
				str = "・剑傲中华"
			end
			for i = 40, 80 do
				NewDrawString(-1, -1, "中华傲诀"..str, M_Red, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "中华傲诀"..str, M_Red, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end
		end
		-----------------------------------------------------------------------------------------
		--------------------------------内功主运组合出手后特效-----------------------------------
		-----------------------------------------------------------------------------------------
		--蛤蟆逆运
		if NGQH(pid,95) and WAR.ACT == 1 then
			if (WAR.HMJT[pid] or 0) >= 2000 then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						if nokillspeed(j) == false then
							ztd(j,'集气位置',WAR.HMJT[pid]/6)
						end	
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字1","气吞山河・崩")
			end
		end
		--纯阳太极
		if NGQH(pid,99) then
			WAR.CYTJ[pid] = 1
			Set_Eff_Text(WAR.CurID, "特效文字3","纯阳无极")
		end
		--先天神照
		if NGQH(pid,100) and WAR.XTZQ[pid] ~= nil and WAR.XTZQ[pid] > 0 then
			local cs = ""
			local names = 
			{{1,"一"},
			{2, "二"},
			{3, "三"},
			{4, "四"},
			{5, "五"},
			{6, "六"},
			{7, "七"},	
			}
			for i,v in ipairs(names) do
				if v[1] == WAR.XTZQ[pid] then
					cs = v[2]
					break
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字1","先天真气"..cs.."层")
			WAR.XTZQ[pid] = WAR.XTZQ[pid] - 1
			if WAR.XTZQ[pid] <= 0 then 
				WAR.XTZQ[pid] = nil
			end
		end
		--先天神照
		if NGQH(pid,100) and JY.Person[pid]["生命"] > 0 then
			local a = JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"]
			local b = JY.Person[pid]["内力"]/JY.Person[pid]["内力最大值"]
			if b <= a then 
				CurIDTXDH(WAR.CurID, 105, 1, "内力互通")
				ztd(WAR.CurID,"内力点数",math.random(1000,1500+25*(101-JY.Person[pid]["资质"])))
			else
				CurIDTXDH(WAR.CurID, 115, 1, "气汇百脉")
				local xt = WAR.PD["先天护盾"][pid] or 0
				local tz = JY.Person[pid]["生命增长"]
				ztd(WAR.CurID,"生命点数",xt)
				ztd(WAR.CurID,"内伤点数",-tz)
				ztd(WAR.CurID,"中毒点数",-tz)
				Cat('清除低级异常',WAR.CurID)
			end 
		end
		--八荒北冥
		if NGQH(pid,101) then
			if WAR.PD['时序闪避'][pid] == nil then
				WAR.PD['时序闪避'][pid] = 10
				Set_Eff_Text(WAR.CurID, "特效文字3","八荒六合")
			end
			local aa = math.random(1,2)
			if aa == 1 then 
				WAR.PD['必灼烧'][pid] = 1
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then				
						WAR.PD["无明业火"][tmppid] = 10
						WAR.PD["阳气侵蚀"][tmppid] = 10
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字2","八荒・纯阳至尊")
			else
				WAR.PD['必冰封'][pid] = 1
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then				
						WAR.PD["利刃寒锋"][tmppid] = 10
						WAR.PD["阴气污染"][tmppid] = 10
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字2","八灭・倒转阴阳")
			end
		end
		--太玄乾坤--local WZTS = {"十步杀一人 千里不留行","赵客缦胡缨 吴钩霜雪明","救赵挥金锤 邯郸先震惊","三杯吐然诺 五岳倒为轻","谁能书阁下 白首太玄经"}
		if NGQH(pid,102) then 
			--WAR.PD["太玄组合攻击"][pid] = 1
			local jl = math.modf(JY.Person[pid]["实战"]/50)
			if JLSD(10,35+jl,pid) or BNJQ(pid) then
				WAR.PD["太玄组合攻击5"][pid] = 1
				WAR.PD["集气速度"][pid] = (WAR.PD["集气速度"][pid] or 0) + 5
				Set_Eff_Text(WAR.CurID, "特效文字0", "谁能书阁下 白首太玄经")	
			end
			if JLSD(10,45+jl,pid) and WAR.PD["太玄组合攻击1"][pid] == nil then
				WAR.PD["集气速度"][pid] = (WAR.PD["集气速度"][pid] or 0) + 5
				WAR.PD["太玄组合攻击1"][pid] = 3
				if WAR.PD["太玄组合攻击5"][pid] == nil then
					Set_Eff_Text(WAR.CurID, "特效文字3", "十步杀一人 千里不留行")
				end
			end
			if JLSD(10,45+jl,pid) and WAR.PD["太玄组合攻击2"][pid] == nil then
				WAR.PD["太玄组合攻击2"][pid] = 50
				if WAR.PD["太玄组合攻击5"][pid] == nil then
					Set_Eff_Text(WAR.CurID, "特效文字1", "赵客缦胡缨 吴钩霜雪明")
				end
			end
			if JLSD(10,45+jl,pid) and WAR.PD["TXZHATK3"][pid] == nil then
				WAR.PD["TXZHATK3"][pid] = 1
				if WAR.PD["太玄组合攻击5"][pid] == nil then
					Set_Eff_Text(WAR.CurID, "特效文字2", "救赵挥金锤 邯郸先震惊")
				end
			end
			if JLSD(10,45+jl,pid) then
				WAR.PD["太玄组合攻击4"][pid] = 1
				if WAR.PD["太玄组合攻击5"][pid] == nil then
					Set_Eff_Text(WAR.CurID, "特效文字2", "三杯吐然诺 五岳倒为轻")
				end
			end
			--[[if ZYJQ(pid) then
				WAR.TXZS = math.random(5)
			end--]]
		end
		--龙象神足
		if NGQH(pid,103) then		
			if match_ID(pid,62) or match_ID(pid,9931) then
				WAR.LXBL = math.random(11,13)
			else
				WAR.LXBL = math.random(1,13)
			end
			local WZTS = {"一","二","三","四","五","六","七","八","九","十","十一","十二","十三"}
			if match_ID(pid, 634) then 
				Set_Eff_Text(id,"特效文字1","无相・"..WZTS[WAR.LXBL].."龙"..WZTS[WAR.LXBL].."象")
			else
				Set_Eff_Text(id,"特效文字1",WZTS[WAR.LXBL].."龙"..WZTS[WAR.LXBL].."象")	
			end
			if JLSD(0,40,pid) then
				WAR.LXJQ = 1
				for p = 0, WAR.PersonNum - 1 do
					local id = WAR.Person[p]["人物编号"]
					if DWPD(WAR.CurID,p) and dead(p) == false then
						addbuff(id,WAR.LWZN,1,10)
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字2","血龙之怒")	
			end
		end
		--神照龟息
		if NGQH(pid,94) then
			ztd(WAR.CurID,"生命点数",330)
			ztd(WAR.CurID,"内力点数",260)
			ztd(WAR.CurID,'体力点数',4)
			ztd(WAR.CurID,"内伤点数",-8)
			CurIDTXDH(WAR.CurID, 137, 1, "起有太初・神照自生");
		end
		--葵花紫霞
		if (NGQH(pid,105) or match_ID(pid,27) or match_ID(pid,777)) and JY.Person[pid]["生命"] > 0 then 
			ztd(WAR.CurID,"生命点数",300)
			ztd(WAR.CurID,"内力点数",300)
			ztd(WAR.CurID,'体力点数',3)
			ztd(WAR.CurID,"内伤点数",-10)
			CurIDTXDH(WAR.CurID, 148, 1, "天人化生・万物滋养");
		end
		--九阳怒涛
		if NGQH(pid,106) then
			ztd(WAR.CurID,'体力点数',9)	
			local jynl = math.modf((JY.Person[pid]["内力最大值"] or 0) * 0.3)
			if JY.Person[pid]["内力"] < jynl then
				JY.Person[pid]["内力"] = jynl
			end
			if ZYJQ(pid) then
				WAR.JYZS = math.random(3)
			end
		end
		--九阴太极	
		if (NGQH(pid,107) and JLSD(20,50,pid)) or (match_ID(pid,637) and JLSD(0,50,pid)) then
			WAR.JYSS = 1
			local size = 60
			local x = CC.ScreenW/2;
			local y = CC.ScreenH/2;
			local offx = (#"【九阴神功・摄魂】")*size/4
			local offy = size/2
			for k = 1,10 do
				Cat('实时特效动画')
				Cls()
				Cat('实时特效动画2')
				lib.Background(0,y-50,CC.ScreenW,y+50,98)
				DrawString(x-offx,y-offy,"【九阴神功・摄魂】",M_DeepSkyBlue,size);  
				ShowScreen();
				lib.Delay(CC.BattleDelay)
			end
		end
		--九阴太极	
		if NGQH(pid,107) and WAR.JYZQ[pid] ~= nil and WAR.JYZQ[pid] > 0 then
			local cs = ""
			local names = 
			{{1,"一"},
			{2, "二"},
			{3, "三"},
			{4, "四"},
			{5, "五"},
			{6, "六"},
			{7, "七"},	
			{8, "八"},
			{9, "九"},
			}
			for i,v in ipairs(names) do
				if v[1] == WAR.JYZQ[pid] then
					cs = v[2]
					break
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字1","九阴破体真气"..cs.."层")
			WAR.JYZQ[pid] = WAR.JYZQ[pid] - 1
			if WAR.JYZQ[pid] <= 0 then 
				WAR.JYZQ[pid] = nil 
			end
		end
		--九阴太极
		if NGQH(pid,107) then
			if WAR.ZBT3 > 0 then
				local a = WAR.ZBT3
				local str = a.."重".."气劲"	
				CurIDTXDH(WAR.CurID, 136, 1 ,"螺旋九影")
				CurIDTXDH(WAR.CurID, 133, 1 ,str)
				Set_Eff_Text(WAR.CurID, "特效文字1","螺旋九影".."・"..str)
				WAR.ZBT3 = WAR.ZBT3 - 1
				if WAR.ZBT3 < 0 then
					WAR.ZBT3 = 0
				end
			end
			if JLSD(50,80,pid) then
				WAR.JYFXJ = math.random(1,13)
				local WZTS = {"一道","二道","三道","四道","五道","六道","七道","八道","九道","十道","十一道","十二道","十三道"}
				Set_Eff_Text(WAR.CurID, "特效文字2","九阴飞絮・"..WZTS[WAR.JYFXJ])
				if WAR.JYFXJ <= 4 then 
					WAR.FXHJ1 = 1
				end
				if WAR.JYFXJ >= 5 and WAR.JYFXJ <= 8 then 
					
				end
				if WAR.JYFXJ >= 9 and WAR.JYFXJ <= 12 then 
					WAR.FXHJ3 = 1
				end
				if WAR.JYFXJ == 13 then 
					WAR.FXHJ4 = 1
				end
			end
			if JLSD(10,55,pid) then
				WAR.CJSZ = 1
				Set_Eff_Text(WAR.CurID, "特效文字3","九阴真劲・无坚不摧")
			end
		end
		--易筋经组合
		if NGQH(pid,108) and BNJQ(pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local nl = math.modf((JY.Person[pid]["内力"] + JY.Person[pid]["内力最大值"]) / 2)
					local tmpid = WAR.Person[j]["人物编号"]
					local enemynl = math.modf(JY.Person[tmpid]["内力"]*0.6)
					local tmpshaqi = math.modf((nl - enemynl) / 10)
					if tmpshaqi < 0 then tmpshaqi = 0 end
					ztd(j,'生命点数',-tmpshaqi)
					if nokillspeed(j) == false then    
						ztd(j,'集气位置',-(100+tmpshaqi))
					end
				end
			end
		end
		--玉女先天
		if NGQH(pid,154) then 
			for j = 0, WAR.PersonNum - 1 do
				local jd = WAR.Person[j]["人物编号"]
				if dead(j) == false and DWPD(WAR.CurID,j) then
					WAR.QX1[jd] = 1	
					if WAR.LQZ[jd] ~= nil and WAR.LQZ[jd] > 0 then
						local nq = math.modf(WAR.LQZ[jd]/10)
						if nq > 50 then
							nq = 50
						end
						ztd(j,"生命点数",-nq*20)
						WAR.LQZ[jd] = math.modf(WAR.LQZ[jd]*0.9)
					end
				end
			end
		end
		--天魔易筋
		if NGQH(pid,160) then
			if yongzhi(wugong) then
				WAR.TMYJ = math.random(7)
				Set_Eff_Text(WAR.CurID, "特效文字0", "破甲尖锋七旋指")
			elseif yongdao(wugong) then
				WAR.TMYJ1 = 1
				Set_Eff_Text(WAR.CurID, "特效文字0", "如是我斩")
			else
				WAR.TMYJ = 1
			end	
		end
		--太极纯阳
		if NGQH(pid,171) then
			if WAR.TJSG[pid] == nil then
				WAR.TJSG[pid] = 0
			elseif WAR.TJSG[pid] >= 2000 then
				ng = ng + WAR.TJSG[pid]
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if nokillspeed(j) == false then
							ztd(j,'集气位置', -math.modf(WAR.TJSG[pid]/5))
						end	
						ztd(j,'生命点数',-math.modf(WAR.TJSG[pid]/3))
					end
				end
				WAR.TJSG[pid] = nil
				Set_Eff_Text(WAR.CurID,"特效文字2","太极・蓄势待发");
			end
			if (WAR.PD['太极蓄力'][pid] or 0) <= 2000 then
				WAR.Actup[pid] = 1	
				WAR.PD['太极蓄力'][pid] = limitX((WAR.PD['太极蓄力'][pid] or 0) + 100,0,2000)
				CurIDTXDH(WAR.CurID, 79, 1 ,"太极蓄力・阴阳无极")
			end
			if BNJQ(pid) then
				WAR.PD['太极奥义・厚积薄发'][pid] = 1
				if WAR.ACT == 1 then
					for i = 40, 80 do
						NewDrawString(-1, -1, "太极奥义 厚积薄发", C_GOLD, i)
						ShowScreen()
						if i == 80 then
							Cls()
							NewDrawString(-1, -1, "太极奥义 厚积薄发", C_GOLD, i)
							ShowScreen()
							lib.Delay(400)
						else
							lib.Delay(1)
						end
					end
				end
			end
		end
		--忘情天书
		if NGQH(pid,177) or match_ID(pid,652) then
			if JLSD(20,50,pid) then
				WAR.PD['时序闪避'][pid] = 30 
				Set_Eff_Text(id,1,"忘情天书・月映")
			end
		end
		--长春北冥
		if NGQH(pid,183) or match_ID(pid,520) then
			for i = 0, CC.WarWidth - 1 do
				for j = 0, CC.WarHeight - 1 do
					local effect = GetWarMap(i, j, 4)
					if 0 < effect then
						local emeny = GetWarMap(i, j, 2)
						if 0 <= emeny and WAR.Person[emeny]["我方"] == WAR.Person[emeny]["我方"] and emeny ~= WAR.CurID then
							local tp = WAR.Person[emeny]["人物编号"];
							AddPersonAttrib(tp,"受伤程度",-JY.Person[tp]["受伤程度"])
							AddPersonAttrib(tp,"冰封程度",-JY.Person[tp]["冰封程度"])
							AddPersonAttrib(tp,"灼烧程度",-JY.Person[tp]["灼烧程度"])
							AddPersonAttrib(tp,"中毒程度",-JY.Person[tp]["中毒程度"])
							AddPersonAttrib(tp,"封穴程度",-JY.Person[tp]["封穴程度"])
							AddPersonAttrib(tp,"流血程度",-JY.Person[tp]["流血程度"])
							SetWarMap(i, j, 4, 2)
						end
					end
				end
			end
			if JLSD(50,80,pid) then	
				WAR.BBF = 1
				WAR.BZS = 1
				WAR.LiRen = 1 
				WAR.WMYH = 1
				local a = JY.Person[pid]["内力"]/30
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then	
						ztd(j,"生命点数",-a)
						ztd(j,"内力点数",-a)
					end	
					Set_Eff_Text(id,1,"不老长春・气冲阴阳")
				end		
			end
		end
		--长春北冥
		if NGQH(pid,183) then
			local haonei = JY.Wugong[wugong]["消耗内力点数"] * 5
			if JY.Person[pid]["内力"] + haonei > JY.Person[pid]["内力最大值"] then
				JY.Person[pid]["内力"] = JY.Person[pid]["内力最大值"]
			else
				ztd(WAR.CurID,"内力点数",haonei)
				Set_Eff_Text(id,"特效文字2","不老长春")
			end
		end
        --长春北冥
		if NGQH(pid,183) then
			local huiful = 2
	        local huifux = 2
		    if math.random(100) > 50 then
			    if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] then
				    huiful = math.modf((JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"]) * 0.5)
				    --ztd(WAR.CurID,"生命点数",huiful)
					JY.Person[pid]["生命"] = JY.Person[pid]["生命"] + huiful
				    huifux ="不老长春恢复生命"..huiful
				    DrawStrBox(-1,-1,huifux,C_GOLD,CC.Fontbig);
				    ShowScreen();
				    lib.Delay(200);
				    Cls()
			    end
		    else
			    if JY.Person[pid]["内力"] < JY.Person[pid]["内力最大值"] then
				    huiful = math.modf((JY.Person[pid]["内力最大值"]-JY.Person[pid]["内力"]) * 0.5)
				    --ztd(WAR.CurID,"内力点数",huiful)
					JY.Person[pid]["内力"] = JY.Person[pid]["内力"] + huiful
				    huifux ="不老长春恢复内力"..huiful
				    DrawStrBox(-1,-1,huifux,C_GOLD,CC.Fontbig);
				    ShowScreen();
				    lib.Delay(200);
				    Cls()
			    end
		    end
	    end
		--擒龙罗汉
		if NGQH(pid,204) then
			if JLSD(10,60,pid) then
				WAR.KLYH = 1
				Set_Eff_Text(id, "特效文字3","擒龙战技・狂龙怒息")
			end
			if JLSD(30,60,pid) then
				WAR.KLST = 1 
				Set_Eff_Text(id, "特效文字1","擒龙奥义・困龙升天")
			end
		end
		--临济峨眉+龙象般若功
		if NGQH(pid,247) and PersonKF(pid,103) and WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[pid] >= 120 then
			WAR.PD['四智妙法'][pid] = math.random(3)
			local str = ""
			if WAR.PD['四智妙法'][pid] == 1 then
				str = '成所作智'
			elseif WAR.PD['四智妙法'][pid] == 2 then
				str = '妙观察智'
			else
				str = '平等性智'
			end
			if BNJQ(pid) and psxper(WAR.CurID,'生命',0.3) and WAR.PD['大圆镜智'][pid] == nil then
				WAR.PD['四智妙法'][pid] = 4
				str = '大圆镜智'
				ztd(WAR.CurID,'生命点数',psx(pid,'生命最大值'))
				ztd(WAR.CurID,'内力点数',psx(pid,'内力最大值'))
				Cat('清除高级异常',WAR.CurID)
				WAR.PD['大圆镜智'][pid] = 1
			end
			Set_Eff_Text(WAR.CurID,3,'四智妙法・'..str)			 
		end
		--临济峨眉
		if WAR.PD['鹤云'][pid] ~= nil and WAR.PD['鹤云'][pid] > 0 then
			CurIDTXDH(WAR.CurID, 133, 1, "龙鹤气劲・风蚀云噬")
			local a = math.modf(JY.Person[pid]['生命最大值']*0.1)
			if psx(pid,'生命') < a then
				ztd(WAR.CurID,'生命点数',-WAR.PD['鹤云'][pid])
			else
				ztd(WAR.CurID,'生命点数',-WAR.PD['鹤云'][pid])
				if psx(pid,'生命') < a then
					JY.Person[pid]['生命'] = a
				end
			end
			WAR.PD['鹤云'][pid] = nil
			WAR.PD['五蕴炽盛'][pid] = 1
		end
		--金P周天
		if NGQH(pid,249) and JLSD(10,60,pid) and yongquan(wugong) then
			WAR.JGZT = 1
			Set_Eff_Text(WAR.CurID,1,"⒁獠印に勃z千")
		end
		--怒涛气劲
		if NGQH(pid,252) and WAR.PD['怒涛剑气'][pid] ~= nil and WAR.PD['怒涛剑气'][pid] > 0 then
			local cs = ""
			local names = 
			{{1,"一"},
			{2, "二"},
			{3, "三"},
			{4, "四"},
			{5, "五"},
			{6, "六"},
			{7, "七"},	
			{8, "八"},
			{9, "九"},
			}
			for i,v in ipairs(names) do
				if v[1] == WAR.PD['怒涛剑气'][pid] then
					cs = v[2]
					break
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字1","海潮气劲・"..cs.."重")
			WAR.PD['怒涛剑气'][pid] = WAR.PD['怒涛剑气'][pid] - 1
			if WAR.PD['怒涛剑气'][pid] <= 0 then 
				WAR.PD['怒涛剑气'][pid] = nil 
				Cat('护盾停止',WAR.CurID)
			end
		end
		--玄武真功
		if NGQH(pid,315) and JY.Person[pid]["实战"] >= 300 then
			local str = ""
			local a = math.random(1,3)
			if match_ID(pid,520) then
				a = math.random(2,3)
				for j = 0, WAR.PersonNum - 1 do 
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if WAR.PD['十方无敌'][WAR.Person[j]["人物编号"]] == nil then
							WAR.PD['十方无敌'][WAR.Person[j]["人物编号"]] = 10
						end
					end
				end
			end
			if a == 1 then
				str = "・守招・十方无敌"
				for j = 0, WAR.PersonNum - 1 do 
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						WAR.PD['十方无敌'][WAR.Person[j]["人物编号"]] = 100
					end
				end
			elseif a == 2 then
				str = "・杀招・十方皆杀"
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,"生命点数",-500)
						ztd(j,"内力点数",-1000)
					end
				end
			elseif a == 3 then
				str = "・灭招・十方皆灭"
				WAR.SFJZ = 1
				if (WAR.PD['极意攻击'][pid] or 0) < 15 then 
					WAR.PD['极意攻击'][pid] = 15
				end
			end	
			Set_Eff_Text(WAR.CurID, "特效文字3","玄武真功"..str)
		end
		--玄武真功
		if Curr_NG(pid,315) or match_ID(pid,520) then
			local str = ""
			if JLSD(25,70,pid) then
				if yongquan(wugong) or match_ID(pid,520) then
					str = "玄武真功・进招・山海拳经"
					for j = 0, WAR.PersonNum - 1 do
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local fhurt = (JY.Person[tmppid]["受伤程度"] or 0)
							ztd(j,'生命点数', -fhurt)
							ztd(j,'内伤点数', 25)
						end
					end
				elseif yongzhi(wugong) or match_ID(pid,520) then
				    str = "玄武真功・进招・圆融金指"
					for j = 0, WAR.PersonNum - 1 do
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if JY.Person[WAR.Person[j]["人物编号"]]["封穴程度"] > 40 then
								ztd(j,'生命点数',-JY.Person[WAR.Person[j]["人物编号"]]["封穴程度"])
								ztd(j,WAR.FXXS,3)
								WAR.PD['逆转经脉'][tmppid] = 2
							else
							    ztd(j,WAR.FXXS,5)
							end
						end
                    end
				elseif yongjian(wugong) or match_ID(pid,520) then
				    str = "玄武真功・进招・天命剑道"
					for j = 0, WAR.PersonNum - 1 do
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if JY.Person[tmppid]["流血程度"] > 50 then
								ztd(j,'内力点数',-JY.Person[tmppid]["流血程度"])
								ztd(j,'生命点数',-JY.Person[tmppid]["流血程度"])
							else
							    ztd(j,WAR.LXXS,20)
								WAR.PD['血流不止'][tmppid] = 10
							end
						end
                    end
				elseif yongdao(wugong) or match_ID(pid,520) then
				    str = "玄武真功・进招・无二刀法"
					local ad = math.random(3,5)
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if JY.Person[WAR.Person[j]["人物编号"]]["体力"] > 10 then
								ztd(j,'体力点数',-ad)
							else
							    ztd(j,'体力点数', -JY.Person[WAR.Person[j]["人物编号"]]["体力"])
								ztd(j,'生命点数',-10*ad)
							end
						end
                    end
				elseif yongte(wugong) or match_ID(pid,520) then
				    str = "玄武真功・进招・虎啸棍集"
					local sh = TrueTS(pid)/4
					if WAR.SHJL[pid] ~= nil then
						sh = sh+(WAR.SHJL[pid])/4
					end
					for j = 0, WAR.PersonNum - 1 do
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							ztd(j,'生命点数', -math.modf(sh))
						end
					end
				end
			end
			Set_Eff_Text(WAR.CurID,"特效文字3",str)
		end
		-----------------------------------------------------------------------------------------
		--------------------------------内功被动组合攻击后特效-----------------------------------
		-----------------------------------------------------------------------------------------
		--混元紫霞
		if NGQHB(pid,90) and JY.Person[pid]["体力"] == 100 and JLSD(20,55,pid) then	
			for j = 0,WAR.PersonNum - 1 do 
				if dead(j) == false and DWPD(WAR.CurID,j) then
					if nokillspeed(j) == false then
						if WAR.Person[j].Time > 250 then
							WAR.Person[j].Time = 250
						end
					end
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字1","混元紫霞・气海翻腾")
		end
		--金刚狮王吼
		if NGQHB(pid,91) then
			if (JY.Person[pid]["内力"] >= 8000 or match_ID(pid,149)) and JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do 
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,'集气位置', -50)
						if WAR.PD['无招胜有招'][tmppid] == nil then
							WAR.PD['无招胜有招'][tmppid] = 10
						end
					end
				end
				Set_Eff_Text(id, "特效文字2","金佛怒吼・魂飞魄散") 
			end 
			if (JY.Person[pid]["内力"] >= 6000 or match_ID(pid,13)) and JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do 
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,'集气位置', -50)
						if WAR.PD['伏魔逆气'][tmppid] == nil then
							WAR.PD['伏魔逆气'][tmppid] = 10
						end
					end
				end
				Set_Eff_Text(id, "特效文字2","狮王咆哮・心惊胆颤")
			end 
			if (JY.Person[pid]["内力"] >= 4000 or match_ID(pid,149)) and JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do 
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,WAR.FXXS,10)	
						ztd(j,'集气位置', -50)
						addbuff(tmppid,WAR.PD['逆转经脉'],1,3)
					end
				end
				Set_Eff_Text(id, "特效文字2","金佛怒吼・气震百穴")
		    end 
			if (JY.Person[pid]["内力"] >= 2000 or match_ID(pid,13)) and JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do 
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,'内伤点数',30)	
						ztd(j,'集气位置', -50)
						if WAR.PD['精神错乱'][tmppid] == nil then
							WAR.PD['精神错乱'][tmppid] = 10
						end
					end
				end
				Set_Eff_Text(id, "特效文字2","狮王咆哮・肝肠俱裂")
			end	
		end
		--罗汉周天
		if NGQHB(pid,96) and JY.Person[pid]["生命"] > 0 then
			ztd(WAR.CurID,"生命点数",200)
			ztd(WAR.CurID,"内力点数",400)
			ztd(WAR.CurID,"内伤点数",-4)
			ztd(WAR.CurID,"中毒点数",-4)
			ztd(WAR.CurID,"体力点数",4)
			CurIDTXDH(WAR.CurID, 9, 1, "罗汉周天功调息")
		end
		--庄子天魔
		if NGQHB(pid,160) then 
			if BNJQ(pid) then
				if WAR.ACT == 1 then
					WAR.ZZTM = 1
				end
			end
		end
		--碧海五转
		if NGQHB(pid,248) and JLSD(20,50,pid) then	
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
                    if JY.Person[WAR.Person[j]["人物编号"]]["内力"] > 60 then
						ztd(j,"内力点数",-60)
                    else
          	            ztd(j,"内力点数",-JY.Person[WAR.Person[j]["人物编号"]]["内力"])
          	            ztd(j,"生命点数",-60)
                    end
                end
            end
			Set_Eff_Text(WAR.CurID, "特效文字3","桃花乐音・碧海潮生曲")
		end
		--碧海五转
		if NGQHB(pid,248) then
			local str = ""
		    local p = JY.Person[pid]
		    local a = math.random(4)
			for j = 1, WAR.PersonNum-1 do 
				local eid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false then
					if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if a == 1 then--悲曲
							if WAR.LQZ[eid] ~= nil then
								str = "・潮音・悲曲・芳魂辞泪"
								local b = WAR.LQZ[eid] or 0
								ztd(j,"生命点数",-b*4)
								nuqi(eid,-math.modf(b/2))
							end
						elseif a == 2 then--欢曲
							str = "・潮音・欢曲・红烛鸾帐"
							ztd(j,WAR.ZSXS,20)
							ztd(j,WAR.BFXS,20)
							WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + 3
							WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + 3
						elseif a == 3 then
							str = "・潮音・离曲・不思难忘"
							if math.random(10) > 3 then
								if WAR.PD['利刃寒锋'][eid] == nil then
									WAR.PD['利刃寒锋'][eid] = 10
								end
							else
								WAR.PD['集气速度'][eid] = (WAR.PD['集气速度'][eid] or 0) - 3
							end
						end
					else
						if a == 4 then
							str = "・潮音・合曲・湖桥伞下"
							ztd(j,"生命点数",150)
							ztd(j,"内力点数",300)
							ztd(j,"体力点数",3)
						end
				    end
			    end
		    end
			Set_Eff_Text(WAR.CurID, "特效文字2","碧海潮生曲"..str)
		end
		-----------------------------------------------------------------------------------------
		--------------------------------外功组合出手后特效---------------------------------------
		-----------------------------------------------------------------------------------------
		--乾坤鹰爪
		if ((wugong == 4 and PersonKF(pid,97)) or match_ID(pid,12)) then
			if JLSD(20,50,pid) then
				for i = 0, WAR.PersonNum - 1 do 
					if dead(i) == false and DWPD(WAR.CurID,i) then
						ztd(i,WAR.FXXS,math.random(5,15))
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字2","鹰爪擒拿・辗转腾挪")
			end 
		end
		--寒冰绵掌+寒冰真气
		if wugong == 5 and (PersonKF(pid,216) or PersonKF(pid,43) or match_ID(pid,14)) then
			local str = ""
			WAR.HZHQ = math.random(4)
			if WAR.HZHQ == 1 then
				str = "春寒阴云"
			elseif WAR.HZHQ == 2 then
				str = "夏寒瀑雨"
			elseif WAR.HZHQ == 3 then
				addbuff(pid,WAR.PD['集气速度'],10)
				str = "秋寒瑟风"
			elseif WAR.HZHQ == 4 then
				str = "冬寒风雪"
				for j = 0, WAR.PersonNum -1 do 
					local df = WAR.Person[j]["人物编号"] 
					if dead(j) == false and DWPD(WAR.CurID,j) and RealJL(WAR.CurID,j,7) then
						ztd(j,WAR.BFXS,20)
					end
				end
			end
			Set_Eff_Text(WAR.CurID,1,str)	
		end
		--灵蛇拳+蛤蟆功
		if wugong == 9 and Curr_NG(pid,95) and (JLSD(10,55,pid) or match_ID(pid,60) or match_ID(pid,61)) then
			WAR.PD['灵蛇拳法'][pid] = math.random(1,8)
			local a = WAR.PD['灵蛇拳法'][pid]
			local str = {'烈火毒','玄冰毒','七死毒','冰魄毒','剧蛇毒','龙眠毒','蛇蛊毒','蛤蟆毒'}
			ztd(WAR.CurID,'中毒点数',15)
			if psx(pid,'中毒程度') >= 100 and JLSD(10,45,pid) then
				CurIDTXDH(WAR.CurID,208,1,'灵蛇真秘・八岐天灾')
				for j = 0, WAR.PersonNum -1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local jid = WAR.Person[j]['人物编号']
						ztd(j,'中毒点数',25)
						ztd(j,'体力点数',-10)
						if JLSD(10,45,pid) then
							ztd(j,'集气位置',-math.modf(psx(jid,'中毒程度')))
							addbuff(jid,WAR.PD['灵蛇拳'],10,15)
						end
					end
				end
			end
			Set_Eff_Text(WAR.CurID,3,'八岐怪毒・'..str[a])		--,193
		end
		--九阴极意 
		if wugong == 11 and level == 11 and (Curr_NG(pid,107) or match_ID(pid,637) or match_ID(pid,640))  then
			WAR.JYSZ = 1
			WAR.WS = 1
			ng = ng + 1000
			if (WAR.PD['极意攻击'][pid] or 0) < (level) / 2 + 1 then
				WAR.PD['极意攻击'][pid] = (level) / 2 + 1
			end
			if WAR.JYSZ == 1 and WAR.ACT > 1  then
				WAR.JYLJ = 1
				TXWZXS("九阴神爪・无坚不摧",M_DeepSkyBlue)
			end
		end
		--九阴白骨爪九阴组合
		if (wugong == 11 and Curr_NG(pid,107)) or match_ID(pid,637) then
			if JLSD(25,60,pid) then
				War_ActupMenu()
				Set_Eff_Text(WAR.CurID, "特效文字3","摧坚神爪・五指发劲")
			end
		end
		--碧海落英
		if (wugong == 12 and PersonKF(pid,248)) or (wugong == 18 and match_ID(pid,57)) then
			WAR.LYBF = math.random(3)
			local str = ""
			if WAR.LYBF == 1 then
				str = "景严・落英散华"
				ng = ng + 1000
				if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
					WAR.PD['极意攻击'][pid] = 7
				end
			elseif WAR.LYBF == 2 then
				str = "亢景・落英汇聚"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local b = JY.Person[tmppid]["流血程度"]
						ztd(j,'集气位置',-50)
						ztd(j,WAR.LXXS,math.random(1,10))
						ztd(j,'内伤点数',b)
					end	
				end
			elseif WAR.LYBF == 3 then
				str = "终景・黄帝剑掌"
			end 
			Set_Eff_Text(WAR.CurID,2,"千本樱・"..str)
		end
		--纯阳太极拳
		if wugong == 16 and ((PersonKF(pid,99) and JLSD(10,55,pid) and WAR.ACT == 1) or match_ID(pid,5)) then
			CurIDTXDH(WAR.CurID,159,1,"太极拳法・运转如流")
			for j = 0, WAR.PersonNum - 1 do
				if DWPD(WAR.CurID,j) and dead(j) == false then
					local aa = math.abs(WAR.Person[j]["坐标X"] - WAR.Person[WAR.CurID]["坐标X"]) + math.abs(WAR.Person[j]["坐标Y"] - WAR.Person[WAR.CurID]["坐标Y"])
					local killjq = 0
					if aa < 99 and aa > 1 then
						local x, y = WE_xy(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]-1)
						SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, -1)
						SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, -1)
						WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"] = x, y
						SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, WAR.Person[j]["贴图"])
						SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, WAR.CurID)
						SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 10, JY.Person[WAR.Person[j]["人物编号"]]['头像代号'])
						killjq = (99 - aa) * 2
					elseif aa <= 1 then
						killjq = 200
					end
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-killjq)
					end
					--[[ lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, -1)
				lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, -1)
				WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"] = x, y
				lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, WAR.Person[j]["贴图"])
				lib.SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, j)]]
					--WarDrawMap(0)
				end	
			end	
		end  
		--擒龙手+擒龙功
		if wugong == 187 and Curr_NG(pid,204) and JLSD(20,60,pid) then
			CurIDTXDH(WAR.CurID,219,1,"擒龙奥义・天锁苍龙")
			for j = 0, WAR.PersonNum - 1 do
				if DWPD(WAR.CurID,j) and dead(j) == false then
					local aa = math.abs(WAR.Person[j]["坐标X"] - WAR.Person[WAR.CurID]["坐标X"]) + math.abs(WAR.Person[j]["坐标Y"] - WAR.Person[WAR.CurID]["坐标Y"])
					local killjq = 0
					if aa < 99 and aa > 1 then
						SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, -1)
				        SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, -1)
				        WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"] = x, y
				        SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 5, WAR.Person[j]["贴图"])
				        SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 2, j)
					    WarDrawMap(0)
					end 
				end 		
			end 
		end 	
		--枯禅一阳指
		if (wugong == 17 and (PersonKF(pid,207) or match_ID(pid,65))) or match_ID(pid,499) then 
			if JLSD(20,50,pid) or match_ID(pid,499) then
				CurIDTXDH(WAR.CurID, 105, 1, "变化无穷・虚实莫测")
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local bb = JY.Person[tmppid]["流血程度"]
						local aa = JY.Person[tmppid]["流血程度"] * 2 + JY.Person[tmppid]["受伤程度"]
						ztd(j,WAR.LXXS,math.random(10,20))
						ztd(j,"内伤点数",bb)
						ztd(j,'生命点数',-aa)
						if nokillspeed(j) == false then
							ztd(j,'集气位置',-50)
						end
					end
				end
			end
			if JLSD(30,60,pid) or match_ID(pid,499) then
				Set_Eff_Text(id, "特效文字2","空手进招・暗点大穴")
				for i = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[i]["人物编号"]
					if dead(i) == false and DWPD(WAR.CurID,i) then
						ztd(i,WAR.FXXS,math.random(2,7))
						WAR.PD["点穴大师1"][tmppid] = 1
					end
				end
			end
		end
		--奇门弹指 攻击前概率向随机一名敌人射击暗器
		if wugong == 18 and (Curr_NG(pid,251) or match_ID(pid,57)) and JLSD(20,60,pid) then
			local list = {}
			for j = 0,WAR.PersonNum-1 do
				if DWPD(WAR.CurID,j) and dead(j) == false then
					table.insert(list,j)
				end
			end
			if list[1] ~= nil then
				local ri = list[math.random(#list)]
				War_ExecuteMenu_Sub(WAR.Person[ri]["坐标X"],WAR.Person[ri]["坐标Y"], 4, 34)
			end
		end
		--寒冰幻阴
		if wugong == 19 and (PersonKF(pid,216) or PersonKF(pid,43) or match_ID(pid,18)) then
			WAR.HYZF = math.random(4)
			local str = ""
			if WAR.HYZF == 1 then
				str = "一指凝血脉"
			elseif WAR.HYZF == 2 then
				str = "二指损任督"
			elseif WAR.HYZF == 3 then
				str = "三指破心神"
			elseif WAR.HYZF == 4 then
				str = "无相幻阴・三分天下"	
				ng = ng + 800
				WAR.WS = 1
			end 
			Set_Eff_Text(WAR.CurID,2,str)
		end
		--龙爪奥义
		if wugong == 20 then
			if match_ID(pid,0) and JY.Person[170]["声望"] == 30 then
				TXWZXS('百发百中穿心抓奶龙爪手', PinkRed)
				WAR.PD['龙爪手'][pid] = 1
			end
		end
		--紫气天罗 附带冰冻
		if WGZH(pid,21,118) then
			Set_Eff_Text(WAR.CurID,1, "紫气天罗",80)
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"]  then
					addbuff(WAR.Person[j]['人物编号'],WAR.PD['冰冻状态'],math.random(2,4))
					addbuff(WAR.Person[j]['人物编号'],WAR.PD['冰冻扣血'],math.random(2,4))
				end
			end
		end
		--五毒玄冥
		if wugong == 21 and (PersonKF(pid,220) or match_ID(pid,647) or match_ID(pid,523)) then
			WAR.XMSZ = math.random(4)
			local str = ""
			if WAR.XMSZ == 1 then
				str = "玄冥・毒吞天下"
			elseif WAR.XMSZ == 2 then
				str = "玄冥・寒冰"
			elseif WAR.XMSZ == 3 then
				str = "玄冥冰毒"
			elseif WAR.XMSZ == 4 then
				str = "玄冥火毒"
			end 
			local juli = limitX(math.modf(TrueQZ(pid)*0.01),3)
			local a = math.random(5,10)
			for j = 0, WAR.PersonNum -1 do
				if dead(j) == false and DWPD(WAR.CurID,j) and RealJL(WAR.CurID,j,juli) then
					local jid = WAR.Person[j]['人物编号']
					addbuff(jid,WAR.PD['玄冥玄毒'],a)
					if match_ID(pid,523) then
						addbuff(jid,WAR.PD['玄冥玄毒'],a)
					end	
					if WAR.PD['玄冥玄毒'][jid] ~= nil and WAR.PD['玄冥玄毒'][jid] >= 50 then
						ztd(j,'生命点数',-math.modf(psx(jid,'生命最大值')*WAR.PD['玄冥玄毒'][jid]*0.01))
						WAR.PD['玄冥玄毒'][jid] = math.random(10)
					end
				end
			end
			Set_Eff_Text(WAR.CurID,2,str)
		end
		--梵洛音七探蛇盘枪
		if wugong == 200 and match_ID(pid,760) then
			WAR.QTSPQ = math.random(7)
			local str = ""
			if WAR.QTSPQ == 1 then 
				str = "七探蛇盘枪・单骑破阵"
			elseif WAR.QTSPQ == 2 then 
				str = "七探蛇盘枪・枪出如龙"
			elseif WAR.QTSPQ == 3 then 
				str = "七探蛇盘枪・子龙朱雀"	
			elseif WAR.QTSPQ == 4 then 
				str = "七探蛇盘枪・日月双华"	
			elseif WAR.QTSPQ == 5 then 
				str = "七探蛇盘枪・端坐霜天"	
			elseif WAR.QTSPQ == 6 then 
				str = "七探蛇盘枪・横扫千军"
			elseif WAR.QTSPQ == 7 then 
				str = "七探蛇盘枪・化蛟覆海"
			end		
		    Set_Eff_Text(WAR.CurID,2,str)
		end	
		--虾米魔刀
		if wugong == 371 and match_ID(pid,759) then
			WAR.XMMD = math.random(4)
			local str = ""
			if WAR.XMMD == 1 then
				str = "魔刀・舍神"
			elseif WAR.XMMD == 2 then
			    str = "魔刀・弃佛"		
			elseif WAR.XMMD == 3 then
			    str = "魔刀・离经"	
			elseif WAR.XMMD == 4 then
			    str = "魔刀・叛道"	
			end 
			Set_Eff_Text(WAR.CurID,2,str)
		end	
		--齐木思
		if wugong == 109 and match_ID(pid,776) then
			WAR.YQQF = math.random(1,3)
			local str = ""
			if WAR.YQQF == 1 then
				str = "【野球拳法】・石头"
			elseif WAR.YQQF == 2 then 
			    str = "【野球拳法】・剪刀"
			elseif WAR.YQQF == 3 then 
			    str = "【野球拳法】・布"		
			end
			Set_Eff_Text(WAR.CurID,2,str)
		end 											
		--寒冰玄冥 寒冰绵掌5 寒冰真气216 化骨绵掌118
		if (wugong == 21 and (PersonKF(pid,216) or PersonKF(pid,43) or match_ID(pid,648) or match_ID(pid,523))) 
		or (match_ID(pid,514) and wugong == 153 and PersonKF(pid,43)) then
			local str = ""
			if PersonKF(pid,43) or match_ID(pid,523) then
				WAR.XMSZ1 = 11
			else
				WAR.XMSZ1 = 1
			end	
			if JLSD(10,65,pid) then	
				WAR.XMSZ2 = 1
				str = str.."・冻海冰川"
			end	
			if JLSD(10,65,pid) then	
				WAR.XMSZ3 = 1
				str = str.."・寒山霜岭"
			end		
			if JLSD(10,65,pid) then	
				WAR.XMSZ4 = 1
				TXWZXS("玄冥・傲雪凌霜",C_GOLD)
			end	
			if str ~= "" then
				Set_Eff_Text(WAR.CurID,1,"玄冥"..str)
			end	
			Set_Eff_Text(WAR.CurID,3,"玄冥・狂寒王座")
		end
		--大力金刚组合
		if QFZH(pid,wugong,144) then
			local str = '金刚四正・金刚般若'
			if WAR.Actup[pid] ~= nil  then
				str = str .. '・照见诸法'
				local n = 0
				for k = 1, JY.Base['武功数量'] do
					if JY.Person[pid]['武功'..k] > 0 then
						n = n + 1
					end
				end
				if n > 0 then
					WAR.PD['照见诸法'][pid] = n
				end	
			end
			if JLSD(10,50,pid) then
				nuqi(pid,15)
				str = str .. '・怒相行深'
			end
			if BNJQ(pid) then
				TXWZXS('金刚四正・怒相行深・金刚怒目',C_RED)
				for j = 0,WAR.PersonNum -1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						if math.random(10) > 5 then
							WAR.PD['恐惧状态'][WAR.Person[j]['人物编号']] = 1
						end
					end
				end
			end
			Set_Eff_Text(WAR.CurID,3,str)
		end
		--七伤拳阴阳 
		if wugong == 23 then
			WAR.QSAY = math.random(1,7)
			if PersonKF(pid,221) or match_ID(pid,8) or match_ID(pid,13) or match_ID(pid,167) or match_ID(pid,168) then
				WAR.SGSF = WAR.QSAY
			end
			local str = ""
			if WAR.QSAY == 1 or WAR.SGSF == 1 then
				str = "损心决"
			elseif WAR.QSAY == 2 or WAR.SGSF == 2 then
				str = "伤肺决"	
			elseif WAR.QSAY == 3 or WAR.SGSF == 3 then	
				str = "摧肝肠决"
			elseif WAR.QSAY == 4 or WAR.SGSF == 4 then	
				str = "藏离决"
			elseif WAR.QSAY == 5 or WAR.SGSF == 5 then	
				str = "精失决"
			elseif WAR.QSAY == 6 or WAR.SGSF == 6 then	
				str = "意恍惚决"
			elseif WAR.QSAY == 7 or WAR.SGSF == 7 then	
				str = "七伤总决"			
			end
			Set_Eff_Text(WAR.CurID,2,"七伤奥义・"..str)
			if BNJQ(pid) or JLSD(30,60,pid) then
				WAR.YZQS = 1
				ng = ng + 777
				if WAR.PD['摧肝肠'][pid] ~= nil then
					WAR.PD['摧肝肠'][pid] = nil
				end
				ztd(WAR.CurID,"生命点数",math.modf(JY.Person[pid]["内力"]/7))
				ztd(WAR.CurID,"内力点数",math.modf(JY.Person[pid]["生命"]/7))
				Set_Eff_Text(id, "特效文字1", "七伤大成・强身健体")
			end
		end
		--易筋须弥山
		if (wugong == 24 and PersonKF(pid,108)) or match_ID(pid, 577) then 
			if JLSD(10,40,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						ztd(j,WAR.FXXS,math.random(5,15))
						ztd(j,WAR.LXXS,math.random(10,33))
						ztd(j,"内伤点数",math.random(10,33))
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字2", "三千世界・不染于尘")
			end
		end
		--逆运黯然
		if wugong == 25 and ((PersonKF(pid,104) and Curr_NG(pid,252)) or match_ID(pid,58)) then
			WAR.NYAR = math.random(3)
			local str = ""
			if WAR.NYAR == 1 then
				str = "黯然・魂牵梦萦"
				for j = 0, WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						ztd(j,"集气位置",-200)
					end
				end
			end	
			if WAR.NYAR == 2 then
				str = "黯然・力不从心"
			end
			if WAR.NYAR == 3 then
				str = "黯然・拖泥带水"
			end
			if str ~= "" then
				CurIDTXDH(WAR.CurID,153,1,str,M_Red)
			end
		end
		--黯然大招
		if wugong == 25 and WAR.PD['黯然值'][pid] ~= nil and WAR.PD['黯然值'][pid] > 0 and math.random(100) <= WAR.PD['黯然值'][pid] then
			WAR.ARJX = math.random(5)
			if WAR.ARJX == 5 then
				local list = {}
				for j = 0,WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						table.insert(list,j)
					end
				end
				if list[1] ~= nil then
					local ri = list[math.random(#list)]
					WAR.PD['魅惑状态'][WAR.Person[ri]['人物编号']] = 3
					SetWarMap(WAR.Person[ri]['坐标X'],WAR.Person[ri]['坐标Y'],4,2)
				end
			end
		end
		--无酒不欢：黯然极意和三叠浪、黯然奥义
		if wugong == 25 then
			local m = 1
			local jl = 0
			if WAR.PD['黯然・无中生有'][pid] == 2 then
				m = 2
			end
			jl = limitX(TrueQZ(pid)/28,0,30)
			if actor(pid,1) then
				jl = limitX(TrueQZ(pid)/20,0,35)
			end
			jl=jl+ (1- JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"])*25	
			jl=math.modf(jl)
			local a = math.random(m,6)
			if JLSD(0,jl,pid) or Curr_NG(pid,252) or match_ID(pid,58) then
				if WAR.ATNum < 6 and WAR.PD['黯然值'][pid] ~= nil then
					WAR.ATNum = WAR.ATNum + math.modf(WAR.PD['黯然值'][pid]*0.03)
				end
				if a == 1 then
					if WAR.PD['黯然・无中生有'][pid] == nil then
						WAR.PD['黯然・无中生有'][pid] = 1
						TXWZXS('黯然・无中生有', LimeGreen)
					end
				elseif a == 2 then
					WAR.PD['黯然・饮恨吞声'][pid] = 1
					TXWZXS('黯然・饮恨吞声', LimeGreen)
				elseif a == 3 then 
					WAR.PD['黯然・行尸走肉'][pid] = 1
					TXWZXS('黯然・行尸走肉', LimeGreen)
				elseif a == 4 then 
					WAR.PD['黯然・穷途末路'][pid] = 1
					TXWZXS('黯然・穷途末路', LimeGreen)
				elseif a == 5 then 
					WAR.PD['黯然・六神不安'][pid] = 1
					TXWZXS('黯然・六神不安', LimeGreen)
				elseif a == 6 then 
					WAR.PD['黯然・倒行逆施'][pid] = 1
					TXWZXS('黯然・倒行逆施', LimeGreen)
				end
			end
			--杨过必触发，其他人概率或暴怒
			if BNJQ(pid) or JLSD(0,jl,pid) or match_ID(pid,58) then	
				WAR.ARJY = 1			
				--三叠浪，限杨过
				if match_ID(pid, 58) and WAR.ATNum < 3 then       
					if JXPD(pid,58,1) then
						WAR.ATNum = 6;
						TXWZXS("黯然销魂.物我两忘.黯然六叠浪", M_DeepSkyBlue)
					else
						WAR.ATNum = 3;
						TXWZXS("黯然销魂.黯然三叠浪", M_DeepSkyBlue)
					end
				elseif WAR.ATNum < 2 then
					WAR.ATNum = 2;
				end			
			end
		end
		--降龙奥义
		--狂龙天征	
		if wugong == 26 then
			local jl = 0
			local m = 1
			if WAR.PD['降龙・双龙取水'][pid] == 2 then
				m = 2
			end
			jl = limitX(TrueQZ(pid)/14,0,25)
			--拳主
			if actor(pid,1) then
				jl = limitX(TrueQZ(pid)/10,0,35)
			end
			--主运擒龙
			if Curr_NG(pid,204) then 
				jl = jl + 5
			end
			jl=math.modf(jl)
			local a = math.random(m,7)
			if JLSD(0,jl,pid) or match_ID(pid,9865) or match_ID(pid,50) then
				if a == 1 then
					if WAR.PD['降龙・双龙取水'][pid] == nil then
						WAR.PD['降龙・双龙取水'][pid] = 1
						TXWZXS('降龙极意・双龙取水', M_Red)
					end
				elseif a == 2 then 
					WAR.PD['降龙・亢龙有悔'][pid] = 1
					TXWZXS('降龙极意・亢龙有悔', M_Red)
				elseif a == 3 then 
					WAR.PD['降龙・潜龙勿用'][pid] = 1
					TXWZXS('降龙极意・潜龙勿用', M_Red)
				elseif a == 4 then 
					WAR.PD['降龙・震惊百里'][pid] = 1
					TXWZXS('降龙极意・震惊百里', M_Red)
				elseif a == 5 then 
					WAR.PD['降龙・飞龙在天'][pid] = 1
					TXWZXS('降龙极意・飞龙在天', M_Red)
				elseif a == 6 then 
					WAR.PD['降龙・见龙在田'][pid] = 1
					TXWZXS('降龙极意・见龙在田', M_Red)
				elseif a == 7 then
					WAR.ATNum = WAR.ATNum + 1
					if WAR.ATNum < 6 then
						WAR.ATNum = WAR.ATNum + math.random(2)
					else
						WAR.ATNum = WAR.ATNum + 1
					end
					TXWZXS('降龙极意・时乘六龙', M_Red)
				end
			end
			if JLSD(0,jl,pid) or match_ID(pid,9861) or match_ID(pid,50) or JY.Person[pid]["武器"] == 300 then
				local display = "六军辟易.奋英雄怒.降龙三叠浪"
				local color = M_Red
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
					WAR.PD["虎啸龙吟"][pid] = 1
				end
				--暴怒有50%几率出六叠浪
				if BNJQ(pid) and JLSD(25,75,pid) and WAR.ATNum < 6 then
					display = "虎啸龙吟.帝释天威.降龙六叠浪"
					WAR.ATNum = 6
					WAR.PD["虎啸龙吟"][pid] = 2
					color = C_GOLD
				end
				TXWZXS(display,color)
				--NPC乔峰回内
				if isteam(pid) == false then
					if JY.Person[pid]["内力"] < 1200 then
						JY.Person[pid]["内力"] = 1200 + math.random(800)
					end
				end
			end
			--有余不尽
			if (JY.Person[pid]["拳掌功夫"] >= 200 or match_ID(pid,50)) and ((JLSD(20,45,pid) and WAR.ACT < 7) or BNJQ(pid) or match_ID(pid,9861)) then
				PlayWavAtk(69)
				WAR.PD['降龙・有余不尽'][pid] = 1
				for i = 1, 30 do
					DrawStrBox(-1, 24, "降龙奥义・有余不尽", M_Red, 10 + i)
					ShowScreen()
					lib.Delay(10)
				end
			end
		end
		--擒龙降龙
		if (wugong == 26 and (Curr_NG(pid,204) or match_ID(pid,50))) or ((wugong == 80 and match_ID(pid,764)) and JLSD(20,65,pid)) then
			local haonei = JY.Wugong[wugong]["消耗内力点数"] * 3
			if JY.Person[pid]["内力"] + haonei > JY.Person[pid]["内力最大值"] then
				JY.Person[pid]["内力"] = JY.Person[pid]["内力最大值"]
			else
				ztd(WAR.CurID,"内力点数",haonei)
			end
			Set_Eff_Text(id,"特效文字2","龙魂不灭");
		end
		--擒龙降龙
		if wugong == 26 and (Curr_NG(pid,204) or match_ID(pid,50)) then
			WAR.QLXL = math.random(3)
			local str = ""
			if WAR.QLXL == 1 then
				str = "帝释天临・御雷龙"
			elseif WAR.QLXL == 2 then
				str = "降龙尊相・伏魔龙"
			elseif WAR.QLXL == 3 then
				str = "四海王威・播雨龙"
			end
			Set_Eff_Text(WAR.CurID,2,str)
		end
		--擒龙降龙
		if wugong == 26 and (Curr_NG(pid,204) or match_ID(pid,50)) and JLSD(20,60,pid) then
			WAR.XLSDL = 1
			if WAR.ATNum < 6 then
				WAR.ATNum = 6
			end	
			local color = M_DeepSkyBlue
            local n = {'一叠浪','二叠浪','三叠浪'}
			local mbg = {'降龙三叠浪・刚劲','降龙三叠浪・柔劲','降龙三叠浪・混劲'}
            local display = "秘技三叠浪・"
            if WAR.ACT > 0 and WAR.ACT < 3 then
                display = display..n[WAR.ACT]
                TXWZXS(display, color)
				local bx,by = CC.ScreenW/1360,CC.ScreenH/768
				lib.LoadPNG(91, 2 * 2 , 295+bx*212, 295+by*33.5, 1)
				ShowScreen();
				local size = 60
				local x = CC.ScreenW/2;
				local y = CC.ScreenH/2;
				local offx1 = (#"【")*size/4
				local offx2 = (#mbg[WAR.ACT])*size/4
				local offx3 = (#"】")*size/4
				local offx = offx1+offx2+offx3
				local offy = size/2
				for k = 1,10 do
					Cat('实时特效动画')
					Cls()
					Cat('实时特效动画2')
					lib.Background(0,y-50,CC.ScreenW,y+50,98)
					DrawString(x-offx,y-offy,"【"..mbg[WAR.ACT].."】",C_GOLD,size);  
					ShowScreen();
					lib.Delay(CC.BattleDelay)
				end
			end
		end
		--九阴降龙
		if wugong == 26 and (Curr_NG(pid,107) or (match_ID(pid,527) and Curr_NG(pid,367))) then
			WAR.BHXL = math.random(4)
			local str = ""
			if WAR.BHXL == 1 then
				str = "升龙威"
				for j = 0, WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						local eid = WAR.Person[j]['人物编号']
						WAR.PD['升龙天威'][eid] = limitX((WAR.PD['升龙天威'][eid] or 0)+5,0,20)
					end
				end	
			elseif WAR.BHXL == 2 then
				str = "五龙噬"
			elseif WAR.BHXL == 3 then
				str = "苍龙落"
			elseif WAR.BHXL == 4 then
				str = "荒龙爆"
			end
			Set_Eff_Text(WAR.CurID,2,str)
			if JLSD(30,60,pid) then
				War_RestMenu()
				Set_Eff_Text(WAR.CurID,3,"羽蛇化龙")
			end
		end
		--琴箫和鸣・玉箫攻击
		if (wugong == 38 and WGZH(pid,38,73)) or match_ID(pid,747) then
			if JLSD(0,40,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) == false then
						ztd(j,"生命点数",333)
						ztd(j,"体力点数",3)
					end 	
				end
				Set_Eff_Text(WAR.CurID,3,"琴箫和鸣・玉箫")
			end
		end
		--碧海玉箫
		if (wugong == 38 and PersonKF(pid,248)) or (wugong == 18 and match_ID(pid,57)) then
			WAR.YXMQ = math.random(3)
			local str = ""
			if WAR.YXMQ == 1 then
				local a = math.random(1,5)
				str = "・八音穿心"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if DWPD(WAR.CurID,j) and dead(j) == false then
						local b = math.modf(JY.Person[tmppid]["内力"]/500)
						ztd(j,"体力点数",-a)
						ztd(j,"内伤点数",b)
						WAR.BYCX[tmppid] = 1
					end
				end
			elseif WAR.YXMQ == 2 then
				local a = math.random(2,8)
				str = "・次声震脉"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if DWPD(WAR.CurID,j) and dead(j) == false then
						local ns = JY.Person[tmppid]["受伤程度"]
						local lx = JY.Person[tmppid]["流血程度"]*2
						ztd(j,WAR.LXXS,ns)
						ztd(j,"生命点数",-lx)
						ztd(j,"内伤点数",-ns/2)
					end
				end
			elseif WAR.YXMQ == 3 then
				str = "・阎魔蟋蟀"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if DWPD(WAR.CurID,j) and dead(j) == false then
						WAR.PD['利刃寒锋'][tmppid] = limitX((WAR.PD['利刃寒锋'][tmppid] or 0) + 3,0,15)
					end
				end
			end
			Set_Eff_Text(WAR.CurID,2,"碧海潮生曲"..str)
		end
		--全真剑法
		if wugong == 39 and (PersonKF(pid,210) or MPTX(pid,16,2) or PersonKF(pid,100) or (match_ID(pid,68) and MPTX(pid,16))) then
			local str = ""
			WAR.QZJF = math.random(3)
			if WAR.QZJF == 1 then
				str = "・明河共影"	
			elseif WAR.QZJF == 2 then
				str = "・兰尽蕉暗"
			elseif WAR.QZJF == 3 then
				str = "・胡霜千里"
			end
			Set_Eff_Text(WAR.CurID,"特效文字2","全真剑法"..str)
		end
		--全真剑法进阶
		if (wugong == 39 and (PersonKF(pid,100) or MPTX(pid,16,2))) or (MPTX(pid,16,3) and yongjian(wugong) and Curr_NG(pid,100)) then
			WAR.QZ_QXJF = math.random(7)
			if WAR.QZ_QXJF == 2 then
				WAR.PD['坚甲状态'][pid] = (WAR.PD['坚甲状态'][pid] or 0) + 15
			elseif WAR.QZ_QXJF == 3 then
				nuqi(pid,15)
				zhanyi(pid,math.random(20,50))
				if WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] > 60 and WAR.LQZ[pid] < 101 then
					if JLSD(10,55,pid) then
						WAR.LQZ[pid] = 100
					end
				end
			elseif WAR.QZ_QXJF == 4 then
				Cat('清除中级异常',WAR.CurID)
				WAR.PD['必冰封'][pid] = 1
			elseif WAR.QZ_QXJF == 6 then	
				WAR.PD['神兵'][pid] = limitX((WAR.PD['神兵'][pid] or 0) + 15,0,30)
				WAR.PD['天香续命'][pid] = limitX((WAR.PD['天香续命'][pid] or 0) + 15,0,60)
			end
			if WAR.QZJQ[pid] ~= nil and WAR.QZJQ[pid] > 0 then
				WAR.PD['侵如火'][pid] = 1
				WAR.QZJQ[pid] = WAR.QZJQ[pid] - 1
				if WAR.QZJQ[pid] <= 0 then 
					WAR.QZJQ[pid] = nil 
				end
			end
		end
		--玉女剑法
		if wugong == 42 and (Curr_NG(pid,154) or match_ID(pid,605)) then
			WAR.YNSX = math.random(1,6)
			local str = {'・浪迹天涯','・花前月下','・冷月窥人','・清饮小酌','・小园艺菊','・举案齐眉'}
			Set_Eff_Text(WAR.CurID,2,"玉女剑法"..str[WAR.YNSX])
		end
		--怒涛玄铁
		if (wugong == 45 and (match_ID(pid,58) or match_ID(pid,530) or PersonKF(pid,252)) and JLSD(10,40,pid)) or (match_ID(pid, 592) and JLSD(20,70,pid)) then
			for j = 0, WAR.PersonNum - 1 do
				local id = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-100)
					end
					if math.random(10) < 3 then
						WAR.PD["昏迷状态"][id] = 1
					end
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字1","玄铁重剑・倒劈")
		end
		--独孤九剑
		if ((wugong == 47 and PersonKF(pid,184)) or match_ID(pid,592)) and WAR.DGJY[pid] ~= nil and WAR.DGJY[pid] > 0 then
			local cs = ""
			local names = 
			{{1,"一"},
			{2, "二"},
			{3, "三"},
			{4, "四"},
			{5, "五"},
			{6, "六"},
			{7, "七"},
			{8, "八"},
			{9, "九"},	
			}
			for i,v in ipairs(names) do
				if v[1] == WAR.DGJY[pid] then
					cs = v[2]
					break
				end
			end
			Set_Eff_Text(id, "特效文字3","独孤剑意・"..cs.."重")
			WAR.DGJY[pid] = WAR.DGJY[pid] - 1
			if WAR.DGJY[pid] <= 0 then 
				WAR.DGJY[pid] = nil 
			end
		end
		--独孤九剑
		if Cat('九剑真传',pid,wugong) then
			local aa = math.random(1,9)
			local str = ""
			WAR.BFX = 1
			WAR.BLX = 1
			WAR.BBF = 1
			WAR.BZS = 1
			WAR.DGJJ_ZJS = aa
			ng = ng + 300 * aa
			if ZYJQ(pid) then
				WAR.DGJJ_LDXJ = 1
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 1 or WAR.DGJJ_ZJS == 1 or WAR.DGJJ_LDXJ == 1 then
				str = "破剑"
				WAR.PJS = 1
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 2 or WAR.DGJJ_ZJS == 2 or WAR.DGJJ_LDXJ == 1 then
				str = "破刀"
				WAR.PD['降龙・震惊百里'][pid] = 1
				WAR.JuHuo = 1
				WAR.LiRen = 1
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 3 or WAR.DGJJ_ZJS == 3 or WAR.DGJJ_LDXJ == 1 then
				str = "破枪"
				WAR.PJS1 = 1
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false then
						if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							WAR.Person[j].Time = WAR.Person[j].Time - 133
							if WAR.Person[j].Time < -133 then 
								WAR.Person[j].Time = -133
							end
						else
							WAR.Person[j].Time = WAR.Person[j].Time + 133
							if WAR.Person[j].Time > 999 then
								WAR.Person[j].Time = 999
							end
						end
					end
				end
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 4 or WAR.DGJJ_ZJS == 4 or WAR.DGJJ_LDXJ == 1 then
				str = "破鞭"
				local psjl = math.random(11,19)
				if match_ID(pid,592) then
					psjl = 9
				end
				for j = 0, WAR.PersonNum-1 do 
					local df = WAR.Person[j]["人物编号"] 
					local offset1 = math.abs(WAR.Person[j]["坐标X"] - WAR.Person[WAR.CurID]["坐标X"]) 
					local offset2 = math.abs(WAR.Person[j]["坐标Y"] - WAR.Person[WAR.CurID]["坐标Y"])	
					if WAR.Person[j]["死亡"] == false and offset1 <= 9 and offset2 <= 9 and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,"生命点数",-math.modf((JY.Person[pid]["内力"] + JY.Person[df]["内力"])/psjl))
					end
				end
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 5 or WAR.DGJJ_ZJS == 5 or WAR.DGJJ_LDXJ == 1 then
				str = "破索"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then			
						WAR.PD["麻痹状态"][tmppid] = (WAR.PD["麻痹状态"][tmppid] or 0) + 2
						WAR.PD["气阻中门"][tmppid] = (WAR.PD["气阻中门"][tmppid] or 0) + 2
					end
				end
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 6 or WAR.DGJJ_ZJS == 6 or WAR.DGJJ_LDXJ == 1 then
				str = "破掌"
				WAR.PJS2 = 1
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 7 or WAR.DGJJ_ZJS == 7 or WAR.DGJJ_LDXJ == 1 then
				str = "破箭"
				WAR.BXZS = 4
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then	
						ztd(j,"内伤点数",math.random(10,50))
						WAR.PD["伤重不治"][tmppid] = (WAR.PD["伤重不治"][tmppid] or 0) + 5
						addbuff(tmppid,WAR.PD['重度内伤'],5,10)
					end
				end
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 8 or WAR.DGJJ_ZJS == 8 or WAR.DGJJ_LDXJ == 1 then
				str = "破气"
				for j = 0, WAR.PersonNum - 1 do	
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if JY.Person[tmppid]["内力"] < 999 then
							JY.Person[tmppid]["内力"] = 1
							WAR.PD["内力恢复停止"][tmppid] = 1
							WAR.TXXS[tmppid] = 1
						else
							ztd(j,'内力点数',-math.random(999,1999))
							WAR.PD["散功状态"][tmppid] = 10
						end
					end
				end
			end
			if JLSD(10,40,pid) or WAR.PD['独孤剑势'][pid] == 9 or WAR.DGJJ_ZJS == 9 or WAR.DGJJ_LDXJ == 1 then
				str = "破尽天下"
				WAR.POISON = 1
				if WAR.PD["九剑破尽"][pid] ~= nil then
					WAR.PD["九剑破尽"][pid] = nil
				end
			end
			Set_Eff_Text(id, "特效文字1","奥义・总决式".."・"..str)
		end
		--九剑真传，剑法主动攻击必然触发4种特效之一
        if Cat('九剑真传',pid,wugong) then
            local t = math.random(4)
            local wz = {"离剑式","倒剑式","撩剑式","荡剑式"}
            WAR.JJZC = t
			Set_Eff_Text(id,"特效文字1","九剑真传・"..wz[t])
			if WAR.PD["回气"][pid] == nil then
				WAR.PD["回气"][pid] = 300
				Set_Eff_Text(WAR.CurID,"特效文字3","有进无退")
			end
        end
		--葵花辟邪
		if wugong == 48 and PersonKF(pid,105) then
			WAR.BXZS = math.random(6)
			--辟邪组合连击
			if WAR.BXZS == 6 and WAR.PD["辟邪连击"][pid] == nil then
				if JLSD(0,50,pid) then
					if WAR.ATNum < 4 then
						WAR.ATNum = 4
					end
				else
					if WAR.ATNum < 3 then
						WAR.ATNum = 3
					end
				end
				WAR.PD["辟邪连击"][pid] = 1
				for i = 1,WAR.PersonNum do
					if dead(i) == false and DWPD(WAR.CurID,i) then
						WAR.PD["恐惧状态"][pid] = 1
					end
				end
			end
			if Curr_NG(pid,105) or JXPD(pid,19,1) then
				CurIDTXDH(WAR.CurID, 400,1,"辟邪剑诀・流星飞堕")
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if DWPD(WAR.CurID,j) and dead(j) == false then   
						if nokillspeed(j) == false then
							ztd(j,"集气位置",-20)
						end
						ztd(j,"生命点数",-math.modf(JY.Person[tmppid]["生命最大值"]/40))
					end
				end	
			end	
		end
		--六脉神剑奥义
		if ((wugong == 49 and ((PersonKF(pid,17) and Curr_NG(pid,314)) or match_ID(pid,53))) and (ZYJQ(pid) or BNJQ(pid))) or ((match_ID(pid,499) or match_ID(pid,774) and JLSD(0,50,pid))) then
			WAR.LMAY = 1
			for i = 40, 80 do
				NewDrawString(-1, -1, "六脉奥义・剑气纵横", C_GOLD, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "六脉奥义・剑气纵横", C_GOLD, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end
		end
		--六脉一阳
		if (wugong == 49 and (PersonKF(pid,17) or match_ID(pid,53))) or match_ID(pid,499) or match_ID(pid,774) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then	
					ztd(j,WAR.FXXS,math.random(16,26))
					ztd(j,'体力点数',-6)
				end			
			end
			Set_Eff_Text(id,"特效文字2","六脉剑气");
		end
		--六脉神剑
		if wugong == 49 or match_ID(pid,499) or match_ID(pid,774) then
			local gl = math.modf(JY.Person[pid]["实战"]/20)
			--学会一阳指
			if PersonKF(pid, 17) then
				gl = gl + 20
			end
			if match_ID(pid,499) or JLSD(0,25+gl,pid) then
				local bh = math.random(4)
				if bh == 1 then
					WAR.DSP_LM1 = 1
					Set_Eff_Text(id,"特效文字1","剑逆天光");
				elseif bh == 2 then
					WAR.DSP_LM2 = 1
					WAR.ATNum = WAR.ATNum + 1
					Set_Eff_Text(id,"特效文字1","剑煌镜影");
				elseif bh == 3 then
					WAR.BJ = 1
					WAR.DSP_LM3 = 1
					Set_Eff_Text(id,"特效文字1","南柯万剑");
				elseif bh == 4 then
					WAR.DSP_LM4 = 1
					Set_Eff_Text(id,"特效文字1","皇玺剑印");
				end
				if myrandom(1+gl,pid) or (match_ID(pid,53) and myrandom(level+gl,pid)) then --段誉
					ng = ng + 1000
					if match_ID(pid,53) then
						WAR.LMSJwav = 1
						WAR.WS = 1
					end
				end
				if PersonKF(pid,314) or match_ID(pid,499) or match_ID(pid,9893) then --六脉剑气
					local jl = 50
					if PersonKF(pid,207) then
						jl = jl + 10 
					end
					if JLSD(20,jl,pid) or match_ID(pid,499) or match_ID(pid,9893) then
						WAR.JQBYH = 1
						Set_Eff_Text(id, "特效文字3", "剑气碧烟横")
					end
				end
				if (PersonKF(pid,17) and Curr_NG(pid,314)) or match_ID(pid,53) or match_ID(pid,499) then --六脉天南
					WAR.LMJQ = math.random(6)
					local str = {'六脉剑气・少商剑','六脉剑气・商阳剑','六脉剑气・中冲剑','六脉剑气・关冲剑','六脉剑气・少冲剑','六脉剑气・少泽剑'}
					Set_Eff_Text(WAR.CurID,2,str[WAR.LMJQ])
				end
			end
		end
		--混元狂风刀
		if (wugong == 55 and (PersonKF(pid,90) or PersonKF(pid,375) or match_ID(pid,29)))
		or (wugong == 78 and (PersonKF(pid,90) or PersonKF(pid,375)) and PersonKF(pid,55)) then
			if JLSD(30,60,pid) then
				CurIDTXDH(WAR.CurID,374, 1, "狂风刀法・破")
				local nl = math.modf((JY.Person[pid]["内力"]*2 + JY.Person[pid]["内力最大值"])/3)
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local tmpid=WAR.Person[j]["人物编号"]
						local enemynl = math.modf(JY.Person[tmpid]["内力"]*0.7)
						local tmpshaqi = math.modf((nl - enemynl) / 40)
						if tmpshaqi < 0 then tmpshaqi = 0 end
						ztd(j,'集气位置',-(50+tmpshaqi))
					end
				end	
			end
		end
		--黄沙万里鞭+天罗地网
		if (wugong == 78 or wugong == 55) and Curr_QG(pid,148) and WGZH(pid,78,55) then
			local yy = WAR.PD["氤氤氲氲"][pid] or 0
			if yy ~= nil and yy >= 50 then
				WAR.HTSFX = math.random(3)
				local str = {'黄天无极・响蛇鸣','黄天无极・蝎尾针','黄天无极・沙蜥噬'}
				Set_Eff_Text(WAR.CurID,2,str[WAR.HTSFX])
			end
			if yy ~= nil and yy >= 70 then
				WAR.HTZRL = math.random(3)
				local str1 =  {'黄天无极・风掠境','黄天无极・沙弥漫','黄天无极・水枯竭'}
				Set_Eff_Text(WAR.CurID,2,str1[WAR.HTZRL])	
			end
		end
		--天魔修罗刀鬼禅六断
		if (wugong == 58 and PersonKF(pid,160)) or ((wugong == 58 or wugong == 66 or wugong == 63) and MPTX(pid,6,2)) then
			local str = "・无妄成法"
			if WAR.ATNum < 6 then
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				else
					if JLSD(10,45,pid) then
						WAR.ATNum = WAR.ATNum + 1
					end
				end
			end	
			if WAR.PD['鬼禅六断'][pid] ~= nil then
				local gz = WAR.PD['鬼禅六断'][pid]
				if gz >= 3000 then
					str = "・梵鬼同悲"
				elseif gz >= 2000 then
					str = "・众相唯灭"
				elseif gz >= 1500 then
					str = "・辅轮天葬"
				elseif gz >= 1000 then
					str = "・屠印杀界"
				elseif gz >= 500 then
					str = "・神迷堕世"
				end
				for i = 0,WAR.PersonNum - 1 do
					if WAR.Person[i]['死亡'] == false and WAR.Person[i]['我方'] ~= WAR.Person[WAR.CurID]['我方'] then
						local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
						local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
						local a = math.modf(gz/100)
						local eid = WAR.Person[i]["人物编号"]
						if offset1 <= a and offset2 <= a then
							ztd(i,WAR.ZSXS,10)
							WAR.Person[i]["特效动画"] = 98
							if gz >= 500 then
								WAR.PD['混乱状态'][eid] = 2
								addbuff(eid,WAR.PD['重度内伤'],10,15)
							end
							if gz >= 1000 then
								ztd(i,"生命点数",-math.random(50,200))
								ztd(i,"内力点数",-math.random(200,500))
							end
							if gz >= 1500 then
								ztd(i,"内伤点数",math.random(10,50))
								ztd(i,"生命点数",-(psx(eid,"受伤程度")*math.random(3)))
								WAR.Person[i]["特效动画"] = 123
							end
							if gz >= 2000 then
								local a = math.modf(120 - psx(pid,"品德"))
								ztd(i,"集气位置",-a)
								WAR.SPIRIT[eid] = limitX((WAR.SPIRIT[eid] or 0) - 10,10,200)
								ztd(i,WAR.FXXS,5)
							end	
							if gz >= 3000 then
								WAR.PD['精神错乱'][eid] = 10
								local a = math.modf(math.abs(120-psx(eid,"品德"))*8)
								if a > 500 then a = 500 end 
								ztd(i,"生命点数",-a)
							end
							WAR.TXXS[WAR.Person[i]["人物编号"]] = 1
						end
					end
				end
			end
			Set_Eff_Text(WAR.CurID,3,"鬼禅六断"..str)	
		end
		--太玄金乌
		if (wugong == 61 and (PersonKF(pid,102) or Curr_NG(pid,96))) or JXPD(pid,38,1) then
			WAR.JWDF = math.random(5)
			local str = {'烈阳・开门揖盗','烈阳・梅雪逢夏','烈阳・千钧压驼','烈阳・大海沉沙','烈阳・赤日炎炎'}
			Set_Eff_Text(WAR.CurID,2,str[WAR.JWDF])
			if JLSD(60,90,pid) then
				if WAR.Actup[pid] == nil then
					WAR.Actup[pid] = 1
					Set_Eff_Text(id, "特效文字3","金乌烈阳")
				end
			end
		end
		--太玄青莲
		if wugong == 167 and (Curr_NG(pid,102) or match_ID(pid,636)) then
			WAR.TXQL = math.random(4)
			local str = ""
			if WAR.TXQL == 1 then
				str = "我本楚狂人・凤歌笑孔丘"
			elseif WAR.TXQL == 2 then
				str = "手持绿玉杖・朝别黄鹤楼"
			elseif WAR.TXQL == 3 then
				str = "五岳寻仙不辞远・一生好入名山游"
			elseif WAR.TXQL == 4 then 
			    str = "庐山秀出南斗傍・屏风九叠云锦张"	
			end
			Set_Eff_Text(WAR.CurID,2,str)
		end
        --太玄青莲
		if wugong == 167 and (Curr_NG(pid,102) or match_ID(pid,636)) then
		    zssdz(pid)
			WAR.TXQL1 = math.random(6)
			local txql1 = {"影落明湖青黛光","金阙前开二峰长・银河倒挂三石梁","香炉瀑布遥相望・回崖沓嶂凌苍苍","翠影红霞映朝日・鸟飞不到吴天长","登高壮观天地间・大江茫茫去不还","黄云万里动风色・白波九道流雪山"}
			CurIDTXDH(WAR.CurID,141,1,"庐山谣・"..txql1[WAR.TXQL1],M_DeepSkyBlue)
			if WAR.TXQL1 == 1 then
				WAR.ATNum = WAR.ATNum + 2
			end
			if WAR.TXQL1 == 2 then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) == false then
						ztd(j,"生命点数",200)
						ztd(j,"内力点数",600)
						ztd(j,"体力点数",3)
					end 
				end
			end
			if WAR.BLJJ == 3 then
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if DWPD(WAR.CurID,j) and dead(j) == false then   
						if nokillspeed(j) == false then
							ztd(j,"集气位置",-150)
						end
						ztd(j,"生命点数",-math.modf(JY.Person[tmppid]["生命最大值"]/30))
					end
				end	
			end
			if WAR.BLJJ == 4 then
				nuqi(pid,math.random(8,22))
			end	
			if WAR.BLJJ == 5 then
				zhanyi(pid,math.random(9,23)*2)
			end	
			if WAR.BLJJ == 6 then
				if (WAR.PD['极意攻击'][pid] or 0) <= 7 then
					WAR.PD['极意攻击'][pid] = 7
				end
			end
		end		
		
		--冰火夫妻
		if wugong == 62 and PersonKF(pid,250) then
			WAR.FQDF = math.random(6)
			local str = {'女貌郎才珠万斛 天教艳质为眷属','清风引佩下瑶台 明月照妆成金屋','刀光掩映孔雀屏 喜结丝萝在乔木',
			'英雄无双风流婿 却扇洞房燃花烛','碧箫声里双鸣凤 今朝有女颜如玉','千金一刻庆良宵 占断人间天上福'}
			Set_Eff_Text(WAR.CurID,2,str[WAR.FQDF])
		end
		--纯阳玄虚
		if (wugong == 64 and PersonKF(pid,99)) or (yongdao(wugong) and MPTX(pid,4,3) and PersonKF(pid,99)) or match_ID(pid,5) then
			if JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,WAR.LXXS,math.random(10,20))
						local a = psx(tmppid,"流血程度")
						ztd(j,'生命点数',-a)
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字2","纯阳玄虚・不定虚实")
			end
		end
		--龙象火焰刀 
		if wugong == 66 and ((Curr_NG(pid,103) or match_ID(pid,103)) or match_ID(pid,771)) then
			if JY.Person[pid]["资质"] > 30 or match_ID(pid,103) then
				WAR.HYDNJ = math.random(6,10)
			elseif JY.Person[pid]["资质"] <= 30 then
				WAR.HYDNJ = math.random(1, 5)
			end
			local WZTS = {"一","二","三","四","五","六","七","八","九","十"}
			if match_ID(pid,103) then 
				Set_Eff_Text(id,1,"火焰刀意・"..WZTS[WAR.HYDNJ].."层气劲")
			else
				Set_Eff_Text(id,1,"火焰・"..WZTS[WAR.HYDNJ].."层刀劲")
			end
			if JLSD(0,40,pid) then
				WAR.HYDQJ = 1
				for p = 0, WAR.PersonNum - 1 do
					if dead(p) == false and DWPD(WAR.CurID,p) then
						if WAR.HYDQ[WAR.Person[p]["人物编号"]]  == nil then 
							WAR.HYDQ[WAR.Person[p]["人物编号"]] = 1 
						else 
							WAR.HYDQ[WAR.Person[p]["人物编号"]] = WAR.HYDQ[WAR.Person[p]["人物编号"]] + 1
						end
						if WAR.HYDQ[WAR.Person[p]["人物编号"]] > 10 then 
							WAR.HYDQ[WAR.Person[p]["人物编号"]] = 10 
						end
					end
				end
			end
			local a = 0
			a = math.random(1,3)
			if a == 1 then
				for i = 0, WAR.PersonNum - 1 do
					if DWPD(WAR.CurID,i) and dead(i) == false then
						if WAR.Person[i].Time > 0 then
							WAR.Person[i].Time = 0
						end
						ztd(i,WAR.FXXS,math.random(10,20))
					end
				end
				Set_Eff_Text(id, "特效文字2","火焰刀・凝集")
			elseif a == 2 then
				local nl = math.modf((JY.Person[pid]["内力"]*2 + JY.Person[pid]["内力最大值"])/3)
				for j = 0, WAR.PersonNum - 1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						local tmpid = WAR.Person[j]["人物编号"]
						local tmpshaqi = math.modf((nl - 5000) / 500)
						if tmpshaqi < 1 then tmpshaqi = 1 end
						if tmpshaqi > 10 then tmpshaqi = 10 end
						WAR.PD["集气速度"][tmpid] = (WAR.PD["集气速度"][tmpid] or 0) - tmpshaqi
						if WAR.PD["麻痹状态"][tmpid] == nil then
							WAR.PD["麻痹状态"][tmpid] = math.random(tmpshaqi)
						end
					end
				end
				Set_Eff_Text(id, "特效文字3","火焰刀・虚无缥缈")
			elseif a == 3 then
				local x1 = WAR.Person[WAR.CurID]["坐标X"];
				local y1 = WAR.Person[WAR.CurID]["坐标Y"];
				for ex = x1 - 9, x1 + 9 do
					for ey = y1 - 9, y1 + 9 do
						SetWarMap(ex, ey, 4, 1)
						if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
							local ep = GetWarMap(ex, ey, 2)
							if DWPD(WAR.CurID,ep) and dead(ep) == false then
								local tmppid = WAR.Person[ep]["人物编号"]
								local zs = JY.Person[tmppid]["灼烧程度"]
								ztd(ep,'生命点数',-(zs + 30))
								ztd(ep,'内力点数',-(zs + 30))
							end
						end
					end
				end
				Set_Eff_Text(id, "特效文字3","火焰刀・虚劲伤人")
			end
		end
		--胡刀飞天
		if wugong == 67 and (Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350) or match_ID(pid,633) or JXPD(pid,1,1)) then
			if WAR.PD['天生牙'][pid] ~= nil then
				WAR.PD['苍龙破'][pid] = limitX((WAR.PD['苍龙破'][pid] or 0) + math.random(3),0,10)
				Set_Eff_Text(WAR.CurID,1,'胡刀・天生牙')
				WAR.PD['天生牙'][pid] = 2
				if JLSD(10,45,pid) then
					nuqi(pid,10)
				end	
			end	
			if WAR.Actup[pid] ~= nil then
				Set_Eff_Text(WAR.CurID,1,'胡刀・铁碎牙')
			end	
			if WAR.Defup[pid] ~= nil then
				Set_Eff_Text(WAR.CurID,1,'胡刀・丛云牙')
			end
			if ZYJQ(pid) then
				for i = 40, 80 do
					NewDrawString(-1, -1, "霸刀绝意 斩刃冥道", M_DeepSkyBlue, i)
					ShowScreen()
					if i == 80 then
						Cls()
						NewDrawString(-1, -1, "霸刀绝意 斩刃冥道", M_DeepSkyBlue, i)
						ShowScreen()
						lib.Delay(400)
					else
						lib.Delay(1)
					end
				end
				Set_Eff_Text(WAR.CurID,1,'斩刃冥道')
			end
			Set_Eff_Text(WAR.CurID,3,'天下霸道三刀')
		end
		--剑胆琴心 持瑶琴回血3%，减少10内伤 标记修改
		if wugong == 73 and WGZH(pid,47,73) then
			Set_Eff_Text(id, "特效文字3", "清心普善咒",89)
			local HP=math.modf(JY.Person[pid]["生命最大值"]/20)	
			ztd(WAR.CurID,"生命点数",HP)
			ztd(WAR.CurID,"内伤点数",-10)
		end
		--琴箫和鸣・琴攻击
		if (wugong == 73 and WGZH(pid,38,73)) or match_ID(pid,747) then
			if JLSD(0,40,pid) then	
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) == false then
						ztd(j,"攘Φ闶",333)
						ztd(j,"内伤点数",-3)
					end 	
				end
				Set_Eff_Text(id, "特效文字3","琴箫和鸣・古琴")
			end	
		end
		--吸星持瑶琴
		if ((wugong == 73 and PersonKF(pid,88)) or match_ID(pid,747)) then 
			if math.random(10) < 4 then
				for i = 0, WAR.PersonNum - 1 do 
					if dead(i) == false and DWPD(WAR.CurID,i) then
						ztd(i,WAR.FXXS,math.random(10,15))
					end
				end
				Set_Eff_Text(id, "特效文字3","天下风云出我辈・一入江湖岁月催")
			else 
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) == false then
						ztd(j,"生命点数",300)
						ztd(j,"内力点数",400)
						ztd(j,"体力点数",5)
					end 
				end
				Set_Eff_Text(id, "特效文字2","王图霸业谈笑中・不胜人生一场醉")
			end		
		end
		--打狗奥义
		if wugong == 80 then 
			local gl = 0
			local m = 1
			if actor(pid,5) or match_ID(pid,69) then
				gl = limitX(TrueTS(pid)/10,0,50)
			else
				gl = limitX(TrueTS(pid)/14,0,30)
			end
			if Curr_NG(pid,204) then
				gl = gl + 10
			end
			if (JY.Person[pid]["武器"] == 49 and JY.Thing[49]["装备等级"] >=5) then
				gl = gl + 10
			end
			local a = math.random(m,6)
			if JLSD(0,gl,pid) or match_ID(pid,9989) or match_ID(pid,69) or match_ID(pid,764) then
				if a == 1 then 
					WAR.PD['缠字决'][pid] = 1
					if Curr_NG(pid,204) then
						for j = 0, WAR.PersonNum - 1 do
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then			
								if nokillspeed(j) == false then
									ztd(j,'集气位置',-math.random(50,100))
								end
							end
						end
					end
					TXWZXS('打狗奥义・缠字决', M_Red)
				elseif a == 2 then 
					WAR.PD['封字决'][pid] = 1
					TXWZXS('打狗奥义・封字决', M_Red)
				elseif a == 3 then
					if WAR.ATNum < 3 then
						WAR.ATNum = 3
					else
						WAR.ATNum = WAR.ATNum + 1
					end
					if Curr_NG(pid,204) then
						WAR.PD['免疫封穴'][pid] = 1
						WAR.PD['免疫内伤'][pid] = 1
						WAR.PD['免疫中毒'][pid] = 1
					end
					TXWZXS('打狗奥义・转字决', M_Red)
				elseif a == 4 then 
					WAR.PD['绊字决'][pid] = 1
					if Curr_NG(pid,204) then
						for j = 0, WAR.PersonNum - 1 do
							local tmppid = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then			
								WAR.PD["洞火"][tmppid] = 1
							end
						end
					end
					TXWZXS('打狗奥义・绊字决', M_Red)
				elseif a == 5 then 
					WAR.PD['挑字决'][pid] = 1
					TXWZXS('打狗奥义・挑字决', M_Red)
				elseif a == 6 then 
					WAR.PD['戳字决'][pid] = 1
					if Curr_NG(pid,204) then
						WAR.KHBX = 2
						WAR.WS = 1
					end
					TXWZXS('打狗奥义・戳字决', M_Red)
				end
				if level == 11 and JLSD(10,gl,pid) then 
					ng = ng + 1000
					if (WAR.PD['极意攻击'][pid] or 0) < 6 then 
						WAR.PD['极意攻击'][pid] = 6
					end
					if Curr_NG(pid,204) then --擒龙打狗
						for j = 0, WAR.PersonNum - 1 do
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then			
								ztd(j,"生命点数",-300)
								ztd(j,"内力点数",-600)
							end
						end
					end
					Set_Eff_Text(id, "特效文字0", '打狗棒法绝学・天下无狗',89)
				end
			end
		end
		--龙象大力杵
		if (wugong == 83 and Curr_NG(pid,103)) or match_ID(pid,62) then	
			if WAR.Actup[pid] == nil then
				WAR.Actup[pid] = 1
				Set_Eff_Text(id, "特效文字3", "大力法相・力贯三千")
			end
		end
		--罗汉伏魔杖法
		if ((wugong == 86 and PersonKF(pid,96)) or (match_ID(pid, 577))) and JLSD(33,63,pid) then 
			for j = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then			
					WAR.PD["麻痹状态"][tmppid] = (WAR.PD["麻痹状态"][tmppid] or 0) + 1
				end
			end
			Set_Eff_Text(id, "特效文字0","伏魔杖法・大鹏展翅")
		end
		--天魔指
		if wugong == 132 or wugong == 133 or wugong == 136 or wugong == 137 then
			if (JY.Person[pid]["品德"] < 5 and Curr_NG(pid,163)) or Curr_NG(pid,160) then
				if WAR.ATNum < 4 and JLSD(10,50,pid) then
					WAR.ATNum = 4
				end	
				if ChuQueSX(pid) >= 1 and (JLSD(10,50,pid) or WAR.ACT == 1) then
					WAR.MXSX1 = 1
					Set_Eff_Text(WAR.CurID, "特效文字3", "魔执我相")
				end
				if ChuQueSX(pid) >= 2 and (JLSD(10,50,pid) or WAR.ACT == 2) then
					WAR.MXSX2 = 1
					Set_Eff_Text(WAR.CurID, "特效文字3", "魔执人相")
				end
				if ChuQueSX(pid) >= 3 and (JLSD(10,50,pid) or WAR.ACT == 3) then
					WAR.MXSX3 = 1
					WAR.WS = 1
					ng = ng + 1200
					if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
						WAR.PD['极意攻击'][pid] = 9
					end
					Set_Eff_Text(WAR.CurID, "特效文字3", "众生魔相")
				end
				if ChuQueSX(pid) >= 4 and (JLSD(10,50,pid) or WAR.ACT == 4) then
					WAR.MXSX4 = 1
					Set_Eff_Text(WAR.CurID, "特效文字3", "无佛冥相")
				end
			end	
		end
		--玉女素心剑法
		if (wugong == 139 and ((PersonKF(pid,100) and PersonKF(pid,154)) or match_ID(pid,605))) or WAR.YYLMJJF == 1 then
			WAR.YNSX1 = WAR.ACT
			WAR.YNSX = math.random(6)
		    local str = ""
		    if WAR.YNSX == 1 then
			    str = "・浪迹天涯"	
		    elseif WAR.YNSX == 2 then
			    str = "・花前月下"	
		    elseif WAR.YNSX == 3 then
			    str = "・冷月窥人"	
		    elseif WAR.YNSX == 4 then
			    str = "・清饮小酌"	
		    elseif WAR.YNSX == 5 then
			    str = "・小园艺菊"		
		    elseif WAR.YNSX == 6 then
			    str = "・举案齐眉"		
		    end
			local str1 = ""
			WAR.QZJF = math.random(3)
			if WAR.QZJF == 1 then
			    str1 = str.."・明河共影"	
		    elseif WAR.QZJF == 2 then
			    str1 = str.."・兰尽蕉暗"	
		    elseif WAR.QZJF == 3 then
			    str1 = str.."・胡霜千里"
			end	
			--玉女素心剑
			if WAR.YNSX1 > 0 and WAR.ZYHB > 1 then
				local n = 0
				for j = 0, WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						local jid = WAR.Person[j]['人物编号']
						if TrueYJ(pid) > math.modf(TrueYJ(jid)*0.75) then
							WAR.PD['虚弱状态'][jid] = (WAR.PD['虚弱状态'][jid] or 0) + 15
							local jx = TrueYJ(pid) - math.modf(TrueYJ(jid)*0.75)
							if jx > 500 then jx = 500 end
							if JLSD(10,45,pid) then
								ztd(j,"生命点数",-jx)
							end	
							n = n * 1
						end
					end
				end
				if n > 0 then
					n = math.random(n+1)
					for j = 0, WAR.PersonNum-1 do
						if DWPD(WAR.CurID,j) and dead(j) == false then
							ztd(j,"集气位置",-(n*50))
						end
					end
					WAR.PD['回气'][pid] = (WAR.PD['回气'][pid] or 0) + (n*100)
				end	
				CurIDTXDH(WAR.CurID,83,1,"纤手翩剑脱红尘")
			end
			Set_Eff_Text(WAR.CurID,2,"玉女素心"..str1)
		end
		--达摩九阳
		if wugong == 140 and JFZH(pid,140,243) then
			WAR.BFX = 1
			if WAR.PD['苦难达摩'][pid] ~= nil and WAR.PD['苦难达摩'][pid] == 2000 then
				WAR.PD['负面状态'][pid] = 1
				WAR.PD['必连击'][pid] = 2
				WAR.PD['苦难达摩'][pid] = 0
				Set_Eff_Text(enemyid, "特效文字2", "苦难菩提・只履西归",119)
			end
		end
		--圣火阴风 
		if wugong == 174 and (PersonKF(pid,93) or match_ID(pid,641)) then
			WAR.YFDLW = math.random(1,3)
			local str = {'初之舞・月白','次之舞・白涟','叁之舞・白刃'}
			Set_Eff_Text(WAR.CurID,2,"圣火寒刃・"..str[WAR.YFDLW])
		end
		--鲸息碧海
		if match_ID(pid,635) or (wugong == 179 and (Curr_NG(pid,180) or (PersonKF(pid,180) and JLSD(0,40,pid)))) then
			local bh = math.random(6)
			if bh == 1 then
				WAR.BHJTZ1 = 1
				Set_Eff_Text(id,"特效文字1","阴阳流");
			elseif bh == 2 then
				WAR.BHJTZ3 = 1
				if WAR.BTZT[pid] == nil then
					WAR.BTZT[pid] = 1
				end
				Set_Eff_Text(id,"特效文字1","生灭道");
			elseif bh == 3 then
				Set_Eff_Text(id,"特效文字1","漩涡劲");
				WAR.ATNum = WAR.ATNum + 1
			elseif bh == 4 then
				WAR.BHJTZ5= 1
				Set_Eff_Text(id,"特效文字1","滴水劲");
			elseif bh == 5 then
				WAR.BHJTZ2= 1
				ng = ng + 1000
				if (WAR.PD['极意攻击'][pid] or 0) < 5 then 
					WAR.PD['极意攻击'][pid] = 5
				end
				Set_Eff_Text(id,"特效文字1","滔天");
			elseif bh == 6 then
				WAR.BHJTZ6= 1
				Set_Eff_Text(id,"特效文字1","陷空力");
			end
		end
		--长生井月
		if wugong == 181 and (PersonKF(pid,203) or match_ID(pid,578)) and WAR.ACT == 1 then
			CurIDTXDH(WAR.CurID, 108, 1, "胜而后求战・败而后求胜")
			local nl = math.modf((JY.Person[pid]["内力"]*2+JY.Person[pid]["内力最大值"])/2.5)
			for j = 0, WAR.PersonNum - 1 do
				local tmpid = WAR.Person[j]["人物编号"]
				if dead(j) == false and DWPD(WAR.CurID,j) then
					local enemynl = math.modf(JY.Person[tmpid]["内力"]/2)
					local tmpshaqi = math.modf((nl-enemynl)/40)
					if tmpshaqi < 0 then tmpshaqi = 0 end    
					ztd(j,'集气位置',-(200+tmpshaqi))
					ztd(j,'生命点数',-(200+tmpshaqi))
				end 			
			end
		end
		--长生井月
		if wugong == 181 and (PersonKF(pid,203) or match_ID(pid,578)) then
			WAR.KZJYBF = math.random(1,8)
			if WAR.KZJYBF == 2 then
				WAR.PD['必冰封'][pid] = 1
			end 
			if WAR.KZJYBF == 1 then
				WAR.PD['必灼烧'][pid] = 1
			end
		end
		
		--般若金刚 连击伤害杀气反增
		if QFZH(pid,wugong,91) then
			WAR.BRLJ = 1
			if WAR.ACT > 2 and WAR.ACT < 6 then
				WAR.PD['必命中'][pid] = 1
				TXWZXS("三世因果", C_GOLD)
			end
			if WAR.ACT > 5 then
				WAR.PD['必命中'][pid] = 1
				WAR.PD["毗婆舍那"][pid] = 1
				TXWZXS("佛海无边", C_GOLD)
			end
		end
		--般若金刚
		if wugong == 189 and (WAR.PD['金刚力'][pid] or 0) >= 100 and (BNJQ(pid) or ZYJQ(pid)) then
			WAR.LDJM = 1
			WAR.PD['金刚萨'][pid] = 30
			WAR.PD['金刚力'][pid] = 0
			for i = 40, 80 do
				NewDrawString(-1, -1, "金刚怒目・菩萨低眉", C_GOLD, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "金刚怒目・菩萨低眉", C_GOLD, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end
		end
		--般若金刚
		if wugong == 189 and QFZH(pid,wugong,91) and WAR.Focus[pid] ~= nil then
			local qz = math.modf(TrueQZ(pid)/99)
			for j = 0, WAR.PersonNum - 1 do
				if dead(j) == false and DWPD(WAR.CurID,j) and RealJL(WAR.CurID,j,qz) then
					ztd(j,"生命点数",-qz*11)
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-qz)
					end
				end
			end
			if PersonKF(pid,108) and JLSD(20,43,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) and RealJL(WAR.CurID,j,qz) then
						WAR.PD['业力引爆'][WAR.Person[j]["人物编号"]] = 20
						WAR.PD['业障缠身'][WAR.Person[j]["人物编号"]] = 31
					end
				end
			end
		end
		--金刚般若
		if (Curr_NG(pid,108) or match_ID(pid,149)) and JinGangBR(pid) and JLSD(20,40,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if dead(j) == false and DWPD(WAR.CurID,j) then
					local tmppid = WAR.Person[j]["人物编号"]
					WAR.PD['业力引爆'][tmppid] = limitX((WAR.PD['业力引爆'][tmppid] or 0)+10,0,30)
				end
			end
		end
		--周天庖丁
		if wugong == 193 and PersonKF(pid,190) then
			if JLSD(10,50,pid) then
				WAR.BLX = 1
			end
			if JLSD(10,45,pid) then
				WAR.PD['回气'][pid] = (WAR.PD['回气'][pid] or 0) + 200
				if BNJQ(pid) then
					WAR.PD['集气速度'][pid] = (WAR.PD['集气速度'][pid] or 0) + 10
					Set_Eff_Text(id,2,"游刃似有馀",237)
				end
			end
			if JLSD(10,35,pid) then
				WAR.ATNum = WAR.ATNum + 1
				WAR.SPIRIT[pid] = limitX((WAR.SPIRIT[pid] or 0) + 10,0,200)
				Set_Eff_Text(id,2,"解牛数千回",237)
			end
		end
		--岳王散手
		if wugong == 198 and PersonKF(pid,199) and JLSD(15,50,pid) and JY.Person[pid]["生命"] > 0 then
			ztd(WAR.CurID,"生命点数",150)
			ztd(WAR.CurID,"内力点数",300)
			ztd(WAR.CurID,"内伤点数",-3)
			ztd(WAR.CurID,"中毒点数",-3)
			ztd(WAR.CurID,"体力点数",3)
			CurIDTXDH(WAR.CurID, 88, 1, "岳王散手・气盈力充")
		end
		--南子燎原枪法
		if (wugong == 68 or wugong == 70 or wugong == 165 or wugong == 200) and (match_ID(pid,525) or match_ID(pid,9754)) then
			local str = '燎原百击・'
			local str1 = {'斜挑式','横扫式','格勾式','无枪式・'}
			WAR.PD['南子燎原枪'][pid] = math.random(3)
			if WAR.PD['南子燎原枪'][pid] == 2 then
				WAR.BJ = 1
				ng = ng + 1000
				if (WAR.PD['极意攻击'][pid] or 0) <= 5+math.modf((WAR.SPIRIT[pid] or 0)*0.1) then
					WAR.PD['极意攻击'][pid] = 5+math.modf((WAR.SPIRIT[pid] or 0)*0.1)
				end
			end		
			if WAR.ACT == 1 then
				if BNJQ(pid) then
					TXWZXS(str..'三十击・威凌天下',C_RED)
					if WAR.PD['九阳护盾'][pid] == nil then
						WAR.PD['九阳护盾'][pid] = 1
						if WAR.Person[WAR.CurID]['护盾'] == nil or WAR.Person[WAR.CurID]['护盾'] <= -1 then
							WAR.Person[WAR.CurID]['护盾'] = 6
							Cat('实时特效动画')
							Cls()
							Cat('实时特效动画2')
						end
					end
					WAR.PD['全屏攻击'][pid] = 1
				end	
				CurIDTXDH(WAR.CurID,144,1,str..'三十击・无定击',C_RED)
				for j=0,WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and dead(j) == false and RealJL(WAR.CurID,j,8) then
						ztd(j,'生命点数',-math.random(150,350))
					end
				end
				zhanyi(pid,math.random(10,15))
			end
			if WAR.Actup[pid] ~= nil then
				WAR.PD['燎原枪1'][pid] = 1
				for j=0,WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						ztd(j,'生命点数',-math.modf(psx(pid,'灼烧程度')*math.random(3,10)))
						ztd(j,'体力点数',-math.modf(psx(pid,'灼烧程度')*0.3))
					end
				end
			end	
			if WAR.Actup[pid] ~= nil then
				Set_Eff_Text(WAR.CurID,1,str..str1[4]..str1[WAR.PD['南子燎原枪'][pid]])
			else
				Set_Eff_Text(WAR.CurID,1,str..str1[WAR.PD['南子燎原枪'][pid]])
			end
		end
		--血战沙场
		if (wugong == 200 or wugong == 198) and WGZH(pid,198,200) then
			local jl = 2+WAR.XZSC
			local tim = 1
			if WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] > 0 then
				jl = jl+math.modf(WAR.LQZ[pid]*0.02)
			end
			if BNJQ(pid) then
				jl = jl*2
			end
			while tim < jl + 1 do 
				local dam = math.random(10,20)
				if MPTX(pid,23) then
					local mp = MPDJ(pid) or 1
					if match_ID(pid,568) then
						mp = 4 
					end
					dam = dam * math.random(1,mp)
				end
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
						local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
						if offset1 <= 8 and offset2 <= 8 then
							WAR.Person[id]["特效文字0"] = "醉卧沙场君莫笑・古来征战几人回？"
							WAR.Person[i]["特效动画"] = 420
							ztd(i,"生命点数",-dam)
						end
					end
				end
				tim = tim + 1;
			end		
			if JLSD(50,90,pid) then
				nuqi(pid,8)
				Set_Eff_Text(WAR.CurID,"特效文字2","壮志难酬・怒发冲冠")
			end
		end
		--葵花点穴手・点穴大师
		if wugong == 226 and Curr_NG(pid,105) and (PersonKF(pid,127) or PersonKF(pid,126)) and WAR.ACT < 3 then
			WAR.PD['免疫断连'][pid] = 1
		end
		--周公剑意
		if wugong == 271 and PersonKF(pid,356) and JLSD(0,40,pid) then
			WAR.PD['周公剑意'][pid] = limitX((WAR.PD['周公剑意'][pid] or 0) + 1,0,7)
			if WAR.PD['周公剑意'][pid] == 7 then
				if BNJQ(pid) then
					if (WAR.PD['必连击'][pid] or 0) < 2 then 
						WAR.PD['必连击'][pid] = 2
					end
					if (WAR.PD['极意攻击'][pid] or 0) < 7 then
						WAR.PD['极意攻击'][pid] = 7
					end
					for j = 0, WAR.PersonNum - 1 do
						local id = WAR.Person[j]["人物编号"]
						if dead(j) == false and DWPD(WAR.CurID,j) then
							if WAR.PD['枪神诀2'][id] == nil then
								WAR.PD['枪神诀2'][id] = 12
							end
						end
					end
				end
			end
		end
		--葵花神针+葵花神功
		if wugong == 313 and (Curr_NG(pid,105) or JXPD(pid,27,2) or match_ID(pid,777)) then
			local str = ""
			local a = 0
			WAR.BLX = 1
			if BNJQ(pid) then
				WAR.PD["必杀气"][pid] = 1
				ng = ng + 800
			end	
			for zd = 0,WAR.PersonNum-1 do 
				if WAR.Person[zd]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[zd]["死亡"] == false then
					local zdid = WAR.Person[zd]["人物编号"]
					if WAR.JQSDXS[zdid]~= nil and WAR.JQSDXS[zdid] > a then
						a = WAR.JQSDXS[zdid]
					end	
				end
			end	
			if a > 0 and (WAR.JQSDXS[pid] or 0) > a and JLSD(10,30,pid) and WAR.PD['降龙・双龙取水'][pid] == nil then
				WAR.PD['降龙・双龙取水'][pid] = 1
				local size = 60
				local x = CC.ScreenW/2;
				local y = CC.ScreenH/2;
				local offx = (#"【葵花神针・破空千影】")*size/4
				local offy = size/2
				for k = 1,10 do
					Cat('实时特效动画')
					Cls()
					Cat('实时特效动画2')
					lib.Background(0,y-50,CC.ScreenW,y+50,98)
					DrawString(x-offx,y-offy,"【葵花神针・破空千影】",C_GOLD,size);  
					ShowScreen();
					lib.Delay(CC.BattleDelay)
				end
			end	
			if JLSD(10,40,pid) then
				WAR.PD['降龙・飞龙在天'][pid] = 1
				WAR.PD['降龙・见龙在田'][pid] = 1
				WAR.PD['增加气攻'][pid] = 1200
				if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
					WAR.PD['极意攻击'][pid] = 7
				end
				Set_Eff_Text(WAR.CurID,0,"葵花神针・空寂之蝉",60)
			end
			WAR.KHSZ1 = math.random(4)
			if WAR.KHSZ1 == 1 then
				str = "・依云"
				for zd = 0,WAR.PersonNum-1 do 
					if WAR.Person[zd]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[zd]["死亡"] == false then
						local zdid = WAR.Person[zd]["人物编号"]
						WAR.PD['迟缓状态'][zdid] = 30
						WAR.PD['毒击'][zdid] = 30
						WAR.PD['锁足状态'][zdid] = 1
					end
				end
				Set_Eff_Text(WAR.CurID,2,"葵花神针"..str,60)
			elseif WAR.KHSZ1 == 2 then
				str = "・光君"
				for zd = 0,WAR.PersonNum-1 do 
					if WAR.Person[zd]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[zd]["死亡"] == false then
						local zdid = WAR.Person[zd]["人物编号"]
						WAR.PD['刺目'][zdid] = 2
					end
					if WAR.Person[zd]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[zd]["死亡"] == false then
						local zdid = WAR.Person[zd]["人物编号"]
						WAR.PD['刺目'][zdid] = nil
						WAR.PD['盲目状态'][zdid] = nil
					end
				end
				Set_Eff_Text(WAR.CurID,1,"葵花神针"..str,60)
			elseif WAR.KHSZ1 == 3 then
				str = "・六合"
				WAR.PD["神兵"][pid] = 20
				WAR.PD['内伤恢复'][pid] = 3
				WAR.PD['封穴恢复'][pid] = 5
				WAR.PD['中毒恢复'][pid] = 3
				WAR.BJ = 1
				Set_Eff_Text(WAR.CurID,3,"葵花神针"..str,60)
			elseif WAR.KHSZ1 == 4 then
				str = "・随风"
				WAR.PD['集气速度'][pid] = (WAR.PD['集气速度'][pid] or 0) + 10
				for zd = 0,WAR.PersonNum-1 do 
					if WAR.Person[zd]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[zd]["死亡"] == false then
						local zdid = WAR.Person[zd]["人物编号"]
						WAR.TKJQ[zdid] = math.random(2,4)
					end
				end
				Set_Eff_Text(WAR.CurID,2,"葵花神针"..str,60)
			end
		end
		--天刀九问组合（天刀＋井月＋长生）
		if wugong == 335 and PersonKF(pid,181) and (PersonKF(pid,203) or PersonKF(pid,94)) then
			WAR.WS = 1
			if WAR.TDJW > 9 then
				WAR.TDJW = 0
			end
			if WAR.ATNum < 3 then
				WAR.ATNum = WAR.ATNum + 1
			end	
			WAR.TDJW = WAR.TDJW + 1
			if ZYBF(pid) then
				WAR.DLJ = 1
				for i = 40, 80 do
					NewDrawString(-1, -1, "天刀终问・刀道武途・其有尽乎", C_GOLD, i)
					ShowScreen()
					if i == 80 then
						Cls()
						NewDrawString(-1, -1, "天刀终问・刀道武途・其有尽乎", C_GOLD, i)
						ShowScreen()
						lib.Delay(400)
					else
						lib.Delay(1)
					end
				end	
			else
				if WAR.TDJW == 1 or WAR.TDJW == 10 then
					Set_Eff_Text(WAR.CurID,3,"上下未形 何由考之")
					for j = 0, WAR.PersonNum - 1 do			      	  
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == false then
							WAR.TXXS[tmppid] = 1
							WAR.LXXS[tmppid] = 1
							ztd(j,"内伤点数",100)
							ztd(j,WAR.LXXS,20)
							if JLSD(10,40,tmppid) then
								WAR.PD["混乱状态"][tmppid] = 1
							end
						end						
					end	  	
				elseif WAR.TDJW == 2 or WAR.TDJW == 10 then
					Set_Eff_Text(WAR.CurID,3,"阴阳三合 何本何无")
					for i = 0, WAR.PersonNum - 1 do 
						if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
							ztd(i,WAR.FXXS,7)
							if psx(WAR.Person[i]["人物编号"],"内力性质") == 0 then
								WAR.PD['举火燎原'][WAR.Person[i]["人物编号"]] = 15
							elseif psx(WAR.Person[i]["人物编号"],"内力性质") == 1 then
								WAR.PD['冰冻状态'][WAR.Person[i]["人物编号"]] = (WAR.PD['冰冻状态'][WAR.Person[i]["人物编号"]] or 0) + 15
								WAR.PD['冰冻扣血'][WAR.Person[i]["人物编号"]] = (WAR.PD['冰冻扣血'][WAR.Person[i]["人物编号"]] or 0) + 15
							else
								WAR.PD['举火燎原'][WAR.Person[i]["人物编号"]] = 15
								WAR.PD['冰冻状态'][WAR.Person[i]["人物编号"]] = (WAR.PD['冰冻状态'][WAR.Person[i]["人物编号"]] or 0) + 15
								WAR.PD['冰冻扣血'][WAR.Person[i]["人物编号"]] = (WAR.PD['冰冻扣血'][WAR.Person[i]["人物编号"]] or 0) + 15
							end	
							WAR.TXXS[WAR.Person[i]["人物编号"]] = 1
						end
					end
				elseif WAR.TDJW == 3 or WAR.TDJW == 10 then
					Set_Eff_Text(WAR.CurID,3,"地方九则 何以坟之")
					for i = 0, WAR.PersonNum - 1 do 
						if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
							if WAR.Person[i].Time > 0 then
						        WAR.Person[i].Time = 0
					        end
							WAR.PD['脆弱状态'][WAR.Person[i]["人物编号"]] = 3
							WAR.PD['集气速度'][WAR.Person[i]["人物编号"]] = (WAR.PD['集气速度'][WAR.Person[i]["人物编号"]] or 0) - 10
						end
					end
				elseif WAR.TDJW == 4 or WAR.TDJW == 10 then
					Set_Eff_Text(WAR.CurID,2,"增城九重 其高几里")
					WAR.BTZT[pid] = 1
				elseif WAR.TDJW == 5 or WAR.TDJW == 10 then
					WAR.PD['侵如火'][pid] = 1
					Set_Eff_Text(WAR.CurID,2,"因有t龙 负熊以游")
				elseif WAR.TDJW == 6 or WAR.TDJW == 10 then
					ng = ng + 999
					if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
						WAR.PD['极意攻击'][pid] = 8
					end
					Set_Eff_Text(WAR.CurID,2,"一蛇吞象 厥大何如")
				elseif WAR.TDJW == 7 or WAR.TDJW == 10 then
					Set_Eff_Text(WAR.CurID,1,"天式纵横 阳离爰死")
				elseif WAR.TDJW == 8 or WAR.TDJW == 10 then
					Set_Eff_Text(WAR.CurID,1,"女娲有体 孰则匠之")
				elseif WAR.TDJW == 9 or WAR.TDJW == 10 then
					Set_Eff_Text(WAR.CurID,1,"天命反侧 何罚何佑")
					local tdzy = {}
					local n = 0
					for j = 0, WAR.PersonNum -1 do
						local jid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false then
							if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
								WAR.PD['天问刀气'][jid] = 1
							else
								--if j > 0 then
									tdzy[#tdzy+1] = j
								--end	
							end	
						end
					end	
					if tdzy ~= nil and #tdzy > 0 then
						if #tdzy == 1 and tdzy[1] == 0 then
							n = 0
						else	
							n = tdzy[math.random(#tdzy)]
						end	
						ztd(n,"生命点数",JY.Person[WAR.Person[n]["人物编号"]]["生命最大值"]*0.5)
						ztd(n,"内力点数",JY.Person[WAR.Person[n]["人物编号"]]["内力最大值"]*0.5)
						ztd(n,"体力点数",50)
						Cat("清除中级异常",n)
						local s = WAR.CurID
						WAR.CurID = n
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 66, 1 ,"天命护佑")
						WAR.CurID = s
					end	
				end
			end		
		end
		--大九天手
		if wugong == 340 and Curr_NG(pid,97) then
			WAR.DJTS = math.random(1,9)
			if WAR.DJTS == 2 then
				if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
					WAR.PD['极意攻击'][pid] = 9
				end
			elseif WAR.DJTS == 7 then
				addbuff(pid,WAR.PD['天香续命'],10)	
				addbuff(pid,WAR.PD['白云熊胆'],10)	
			end	
		end
		if yongwu(wugong,360) and Curr_NG(pid,93) then
			WAR.PD['圣火三虚七实'][pid] = 1
		end	

		--狂风迅雷功组合
		if wugong == 341 and ((PersonKF(pid,341) and (PersonKF(pid,55) or PersonKF(pid,162)) and (Curr_NG(pid,103) or Curr_NG(pid,367))) or match_ID(pid,517)) then
			zssdz(pid)
			WAR.BLJJ = math.random(8)
			WAR.PD['八雷神'][pid] = 1
			local bljj = {"千鸟飞鸣","狩雷击","鸣雷吼","烈雷","天鸣黑雷网","裂心之雷","烈雷之刃","万灭悍雷"}
			CurIDTXDH(WAR.CurID,105,1,"八雷禁绝・"..bljj[WAR.BLJJ],M_DeepSkyBlue)
			if WAR.BLJJ == 1 then
				WAR.ATNum = WAR.ATNum + 1
			end
			if WAR.BLJJ == 3 then
				for j = 0, WAR.PersonNum-1 do 
					local jid = WAR.Person[j]['人物编号']
					if DWPD(WAR.CurID,j) and dead(j) == false then
						WAR.PD['迟缓状态'][jid] = (WAR.PD['迟缓状态'][jid] or 0) + math.random(15,25)
						ztd(j,"内伤点数",math.random(10,35))
						if psx(jid,"受伤程度") >= 80 then
							addbuff(jid,WAR.PD['灵蛇拳'],10,15)
						end	
					end
				end
			end
			if WAR.BLJJ == 4 then
				nuqi(pid,math.random(5,20))
				zhanyi(pid,math.random(5,20)*2)
			end	
			if WAR.BLJJ == 5 then
				if (WAR.PD['极意攻击'][pid] or 0) <= 8 then
					WAR.PD['极意攻击'][pid] = 8
				end
			end
		end
		--大伏魔九阴
		if (wugong == 342 and Curr_NG(pid,107)) or match_ID(pid,637) then
			local jl = 50
			if match_ID(pid,637) then
				jl = 65
			end
			if JLSD(20,jl,pid) then
				WAR.PD["九阴伏魔2"][pid] = 20
				Set_Eff_Text(WAR.CurID,"特效文字1","九阴拳劲・赤劲")
			end
			if JLSD(20,jl,pid) then
				for j = 0, WAR.PersonNum-1 do
					local df = WAR.Person[j]["人物编号"] 
					if DWPD(WAR.CurID,j) and dead(j) == false and RealJL(j,WAR.CurID,9) then
						ztd(j,WAR.ZSXS,9)
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字1","九阴拳劲・凤凰哀歌")
			end
		end
		--万剑归宗
		if wugong == 374 and PersonKF(pid,106) and PersonKF(pid,107) and JY.Person[pid]["生命"] > 0 then
			local a = TrueYJ(pid)
			local b = 1000
			local c = 5 + math.modf(JY.Person[pid]["受伤程度"] / 10)
			ztd(WAR.CurID,"生命点数",a)
			ztd(WAR.CurID,"内力点数",b)
			ztd(WAR.CurID,"体力点数",10)
			ztd(WAR.CurID,"内伤点数",-c)
			ztd(WAR.CurID,"中毒点数",-c)
			CurIDTXDH(WAR.CurID, 86, 1, "万气自生")
		end

		--五岳剑法神剑进阶效果
		if (wugong == 30 and Curr_NG(pid,259) and WYXF(pid)) 
			or ((wugong == 377  or JXPD(pid,79,1)) and WAR.WYSJ == 1) 
			or (wugong == 377 and WAR.WYSJ > 0 and JLSD(10,40,pid)) 
			or (JXPD(pid,457,2) and JLSD(0,50,pid)) 
			or (pid == 0 and JY.Person[592]["论剑奖励"] == 2 and JLSD(0,50,pid)) then
			WAR.WYLW1 = math.random(4)
			local str = ""		
			if WAR.WYLW1 == 1 then
				str = "北堂壬水・惊涛拍岸"
				if WAR.ATNum < 3 then
					WAR.ATNum = math.random(3,5)
					TXWZXS("北堂壬水・惊涛拍岸",M_RoyalBlue)
				else
					WAR.BJ = 1
				end	
			elseif WAR.WYLW1 == 2 then
				str = "北堂壬水・千里冰封"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local bb = JY.Person[tmppid]["冰封程度"]*3
						ztd(j,WAR.BFXS,math.random(20,30))
						ztd(j,"内力点数",-bb)
					end
				end	
			elseif WAR.WYLW1 == 3 then
				str = "北堂癸水・润物无声"
			elseif WAR.WYLW1 == 4 then
				str = "北堂癸水・阴寒侵袭"
			end   		
			Set_Eff_Text(WAR.CurID, "特效文字2", str) 
			if WAR.ACT == 1 and WAR.WYSJ > 0 then
				WAR.Person[id]["特效动画"] = 132
			end
		end
		if (wugong == 31 and Curr_NG(pid,264) and WYXF(pid)) 
			or ((wugong == 377  or JXPD(pid,79,1)) and WAR.WYSJ == 2) 
			or (wugong == 377 and WAR.WYSJ > 0 and JLSD(10,40,pid)) 
			or (JXPD(pid,457,2) and JLSD(0,50,pid)) 
			or (pid == 0 and JY.Person[592]["论剑奖励"] == 2 and JLSD(0,50,pid)) then
			WAR.WYLW2 = math.random(4)
			local str = ""
			if  WAR.WYLW2 == 1 then
				str = "东方甲木・巨木锤击"
			elseif WAR.WYLW2 == 2 then
				str = "东方甲木・茂木成林"
				WAR.PD['徐如林'][pid] = limitX((WAR.PD['徐如林'][pid] or 0) + math.random(2, 3),0,20)
			elseif WAR.WYLW2 == 3 then
				str = "东方乙木・藤蔓纠缠"
			elseif WAR.WYLW2 == 4 then
				str = "东方乙木・青霉蔓延"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then				
						ztd(j,"中毒点数",math.random(20,30))
						if WAR.PD['中毒不解'][tmppid] == nil then
							WAR.PD['中毒不解'][tmppid] = math.modf(JY.Person[pid]["实战"]/25) 
						end	
					end
				end
			end	   		
			Set_Eff_Text(WAR.CurID, "特效文字2", str) 
			if WAR.ACT == 1 and WAR.WYSJ > 0 then
				WAR.Person[id]["特效动画"] = 132
			end			
		end	
		
		if (wugong == 32 and Curr_NG(pid,263) and WYXF(pid)) 
			or ((wugong == 377  or JXPD(pid,79,1)) and WAR.WYSJ == 3) 
			or (wugong == 377 and WAR.WYSJ > 0 and JLSD(10,40,pid)) 
			or (JXPD(pid,457,2) and JLSD(0,50,pid)) 
			or (pid == 0 and JY.Person[592]["论剑奖励"] == 2 and JLSD(0,50,pid)) then 
			local str = ""
			WAR.WYLW3 = math.random(4)	
			if WAR.WYLW3 == 1 then
				str = "南宫丙火・烈火焚城"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then		
						local bb = JY.Person[tmppid]["灼烧程度"]*3		
						ztd(j,WAR.ZSXS,math.random(20,30))
						ztd(j,"生命点数",-bb)
					end
				end
			elseif WAR.WYLW3 == 2 then
				str = "南宫丙火・松明抚斩"--根据敌方内力现值和自身剑系数增加伤害
			elseif WAR.WYLW3 == 3 then
				str = "南宫丁火・火毒攻心"--对敌方必上火毒攻心，若敌方灼烧超过40以上，则有机率上点燃
			elseif WAR.WYLW3 == 4 then
				str = "南宫丁火・怒火中烧"--爆怒时触发，直接增加50内伤以及25的灼烧，在满怒气期间集气紊乱
			end   		
			Set_Eff_Text(WAR.CurID, "特效文字2", str) 	
			if WAR.ACT == 1 and WAR.WYSJ > 0 then
				WAR.Person[id]["特效动画"] = 132
			end
		end	
		
		if (wugong == 33 and Curr_NG(pid,216) and WYXF(pid)) 
			or ((wugong == 377  or JXPD(pid,79,1)) and WAR.WYSJ == 4) 
			or (wugong == 377 and WAR.WYSJ > 0 and JLSD(10,40,pid)) 
			or (JXPD(pid,457,2) and JLSD(0,50,pid)) 
			or (pid == 0 and JY.Person[592]["论剑奖励"] == 2 and JLSD(0,50,pid)) then
			local str = ""
			WAR.WYLW4 = math.random(4)	
			if  WAR.WYLW4 == 1 then
				str = "中央戊土・峰峦如聚"
				addbuff(pid,WAR.PD['守如山'],math.random(3))
				WAR.PD['不破防'][pid] = 1
			elseif WAR.WYLW4 == 2 then
				str = "中央戊土・乱石穿空"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,'内伤点数',15)
						if nokillspeed(j) == false then
							ztd(j,'集气位置', -psx(tmppid,'受伤程度'))
						end
					end
				end	
			elseif WAR.WYLW4 == 3 then
				str = "中央已土・沙瀑大葬"
				local ns = math.random(2,4)*5
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local ss = JY.Person[tmppid]["受伤程度"]*3
						addbuff(tmppid,WAR.PD['迟缓状态'],ns,40)
						ztd(j,"生命点数",-ss)
					end
				end
			elseif WAR.WYLW4 == 4 then
				str = "中央已土・流沙囚牢"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then	
						addbuff(tmppid,WAR.PD['麻痹状态'],1,10)	
						addbuff(tmppid,WAR.PD['残劲袭魄'],1,1)	
					end
				end
			end   		
			Set_Eff_Text(WAR.CurID, "特效文字2", str)
			if WAR.ACT == 1 and WAR.WYSJ > 0 then
				WAR.Person[id]["特效动画"] = 132
			end
		end	
		
		if (wugong == 34 and Curr_NG(pid,89) and WYXF(pid)) 
			or ((wugong == 377  or JXPD(pid,79,1)) and WAR.WYSJ == 5) 
			or (wugong == 377 and WAR.WYSJ > 0 and JLSD(10,40,pid)) 
			or (JXPD(pid,457,2) and JLSD(0,50,pid)) 
			or (pid == 0 and JY.Person[592]["论剑奖励"] == 2 and JLSD(0,50,pid)) 
			or (JXPD(pid,35,2) and JY.Person[35]['论剑奖励'] == 2 and yongjian(wugong)) then
			local str = ""
			WAR.WYLW5 = math.random(4)
			
			if WAR.WYLW5 == 1 then
				str = "西门庚金・金石可镂"
			elseif WAR.WYLW5 == 2 then
				str = "西门庚金・电光连环"
				--全屏
				WAR.QPGJ = 1
				WAR.PD['全屏攻击'][pid] = 1
			elseif WAR.WYLW5 == 3 then
				str = "西门辛金・经脉寸断"
			elseif WAR.WYLW5 == 4 then
				str = "西门辛金・金光夺目"
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						addbuff(tmppid,WAR.PD['盲目状态'],1,2)	
					end
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字2", str)
			if WAR.ACT == 1 and WAR.WYSJ > 0 then
				WAR.Person[id]["特效动画"] = 132
			end
		end
		--五岳心法主运搭配效果
		----1东2南3西4北5中
		if WAR.WYJF < 6 then
			if wugong == 34 and ((PersonKF(pid,216) and JLSD(10,40,pid)) or Curr_NG(pid,216)) then
				WAR.WYJF = 5--内伤
			end
			if wugong == 33 and ((PersonKF(pid,89) and JLSD(10,40,pid)) or Curr_NG(pid,89)) then
				WAR.WYJF = 3 -- 流血
				if WAR.ATNum >= 2 then
					WAR.BJ = 1
				else
					WAR.ATNum = WAR.ATNum + 1
				end	
			end	
			if wugong == 32 and ((PersonKF(pid,263) and JLSD(10,40,pid)) or Curr_NG(pid,263)) then
				WAR.WYJF = 2 --灼烧
				
			end	
			if wugong == 31 and ((PersonKF(pid,264) and JLSD(10,40,pid)) or Curr_NG(pid,264)) then
				WAR.WYJF = 1 --封穴
				
			end
			if wugong == 30 and ((PersonKF(pid,259) and JLSD(10,40,pid)) or Curr_NG(pid,259)) then
				WAR.WYJF = 4 --迟缓
			end
		end
		if WAR.WYJF == 1 then
			Set_Eff_Text(WAR.CurID, "特效文字3", "东岳如座・封")
		end
		if WAR.WYJF == 2 then
			Set_Eff_Text(WAR.CurID, "特效文字3", "南岳如飞・刺")
		end
		if WAR.WYJF == 3 then
			Set_Eff_Text(WAR.CurID, "特效文字3", "西岳如立・连")
		end
		if WAR.WYJF == 4 then
			Set_Eff_Text(WAR.CurID, "特效文字3", "北岳如行・徐")
		end
		if WAR.WYJF == 5 then
			Set_Eff_Text(WAR.CurID, "特效文字3", "中岳如卧・镇")
		end
		--------------------------------------------多武功-----------------------------------------------
		--易水四寒
		if (PersonKF(pid,21) or PersonKF(pid,153)) and Curr_NG(pid,43) then
			local str = ""
			local yssh = {WAR.YSSH1,WAR.YSSH2,WAR.YSSH3,WAR.YSSH4}
			local shstr = {'・玄天寒','・冥狱寒','・沧海寒','・溟渊寒'}
			local pd = false
			if match_ID(pid,514) then
				pd = true
			elseif MPTX(pid,20,4) and (yongquan(wugong) or yongdao(wugong)) and wgnlxz(wugong) ~= 1 then
				pd = true
			elseif WAR.PD['易水四寒'][pid] == 5 and (yongquan(wugong) or yongdao(wugong)) then
				pd = true
			end	
			if pd == true then
				local jl = 40
				if WAR.PD['易水四寒'][pid] == 5 then jl = 100 end
				if JLSD(0,jl,pid) then
					yssh[1] = 1
					str = str..shstr[1]
				end	
				if JLSD(0,jl,pid) then
					yssh[2] = 1
					str = str..shstr[2]
				end
				if JLSD(0,jl,pid) then
					yssh[3] = 1
					str = str..shstr[3]
					for j = 0, WAR.PersonNum-1 do
						if dead(j) == false and DWPD(WAR.CurID,j) then
							local jd = WAR.Person[j]['人物编号']
							WAR.PD['冰覆双极'][jd] = 1
						end
					end	
				end
				if JLSD(0,jl,pid) then
					yssh[4] = 1
					str = str..shstr[4]
				end
				if str ~= "" then
					Set_Eff_Text(WAR.CurID,2,'四寒'..str)
				end	
			else
				local a = math.random(4)
				yssh[a] = 1
				Set_Eff_Text(WAR.CurID,3,'四寒'..shstr[a])
			end	
			if WAR.YSSH1 == 1 then
				ztd(WAR.CurID,WAR.BFXS,100)
			end	
		end
		--阴阳铁布衫
		if PersonKF(pid,77) and (PersonKF(pid,196) or match_ID(pid,616)) then	
			if yongjian(wugong) or yongdao(wugong) then
				if WAR.ATNum < 2 then
					WAR.ATNum = 2
				end	
				WAR.YYDL = math.random(1,4)
				if WAR.YYDL == 4 then
					WAR.PD['全屏攻击'][pid] = 1
				end	
				if WAR.ZYHB < 2 then
					if yongjian(wugong) then
						WAR.YYDL2[pid] = 1--记录剑，转刀
					elseif yongdao(wugong) then	
						WAR.YYDL2[pid] = 2--记录刀，转剑
					end	
				end
				TXWZXS("阴阳顺逆・刀剑双绝",M_LightBlue)
			end
			if wugong == 77 and pid == 616 then
				WAR.YYDL = math.random(1,4)
			end	
			if WAR.YYDL2[pid] == 1 and yongdao(wugong) and WAR.ZYHB == 2 and WAR.PD['刀剑不转'][pid] == nil then
				WAR.YYDL2[pid] = 4 --先剑后刀
			end	
			if WAR.YYDL2[pid] == 3 then
				WAR.YYDL1 = math.random(5,7)
				WAR.PD['刀剑绝技'][pid] = 2
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
			end	
			if WAR.YYDL2[pid] == 3 and yongjian(wugong) and WAR.PD['真左右互搏'][pid] == 1 and WAR.PD['刀剑不转'][pid] == nil then
				WAR.YYDL2[pid] = 5 --先剑后刀再剑
			end
			if WAR.YYDL2[pid] == 5 then
				WAR.YYDL1 = 11
				WAR.PD['刀剑绝技'][pid] = 2
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
			end	
			if WAR.YYDL2[pid] == 2 and yongjian (wugong) and WAR.ZYHB == 2 and WAR.PD['刀剑不转'][pid] == nil then
				WAR.YYDL2[pid] = 3 --先刀后剑
			end	
			if WAR.YYDL2[pid] == 4 then
				WAR.YYDL1 = math.random(8,10)
				WAR.PD['刀剑绝技'][pid] = 2	
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
			end	
			if WAR.YYDL2[pid] == 4 and yongdao(wugong) and WAR.PD['真左右互搏'][pid] == 1 and WAR.PD['刀剑不转'][pid] == nil then
				WAR.YYDL2[pid] = 6 --先刀后剑再刀
			end	
			if WAR.YYDL2[pid] == 6 then
				WAR.YYDL1 = 11
				WAR.PD['刀剑绝技'][pid] = 2
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
			end	
			local str = ""
			local str1 = ""
			if WAR.YYDL == 1 then
				str = "刀剑顺行・黑剑真剑"
			elseif WAR.YYDL == 2 then
			    str = "刀剑逆转・黑剑伪剑"	
			elseif WAR.YYDL == 3 then
			    str = "刀剑顺行・金刀为刀"	
			elseif WAR.YYDL == 4 then
			    str = "刀剑逆转・金刀非刀"	
			end
			if WAR.YYDL1 == 5 then
			    str1 = "阳刃化刀・渔网阵"	
			elseif WAR.YYDL1 == 6 then
			    str1 = "阳刃化刀・烈阳舞"	
			elseif WAR.YYDL1 == 7 then
			    str1 = "阳刃化刀・一文字"	
			elseif WAR.YYDL1 == 8 then
			    str1 = "阴刃化剑・枣核钉"
			    AddPersonAttrib(pid,"暗器技巧",math.random(3,5))	
			elseif WAR.YYDL1 == 9 then
			    str1 = "阴刃化剑・霜雪扬"	
			elseif WAR.YYDL1 == 10 then
			    str1 = "阴刃化剑・天丛云"
			    local a = math.modf(JY.Person[pid]["生命最大值"]*0.1)
				local b = math.modf(JY.Person[pid]["内力最大值"]*0.1)
				zhanyi(pid,math.random(5,15)) 
				ztd(WAR.CurID,'生命点数',a)
				ztd(WAR.CurID,'内力点数',b)
			elseif WAR.YYDL1 == 11 then
				TXWZXS('阳极阴生・阴极阳生・阴阳倒乱・霜剑炎刀断命魂',C_GOLD)
				AddPersonAttrib(pid,"暗器技巧",math.random(3,5))
				local a = math.modf(JY.Person[pid]["生命最大值"]*0.1)
				local b = math.modf(JY.Person[pid]["内力最大值"]*0.1)
				zhanyi(pid,math.random(5,15)) 
				ztd(WAR.CurID,'生命点数',a)
				ztd(WAR.CurID,'内力点数',b)
			end
				Set_Eff_Text(WAR.CurID,2,str)
			if str1 ~= "" then
				Set_Eff_Text(WAR.CurID,1,str1)
			end	
		end
		--小无相杂学
		if (PersonKF(pid,98) and (WAR.WGWL < 500 or (WAR.WGWL >= 500 and JLSD(10,25,pid)))) or (PersonKF(pid,367) and JLSD(10,40,pid)) then
			local str = ""
			if yongquan(wugong) then
				WAR.XWXZX = math.random(2)
				if WAR.XWXZX == 1 then
					str = "之手・扶摇直上"
					if WAR.ATNum < 2 then
						WAR.ATNum = 2
					elseif WAR.ATNum < 4 and JLSD(10,45,pid) then
						WAR.ATNum = WAR.ATNum + 1
					end	
				elseif WAR.XWXZX == 2 then
					str = "之手・鹏飞千里"
					WAR.PD['回气'][pid] = (WAR.PD['回气'][pid] or 0) + 100
				end				
			elseif yongzhi(wugong) then
				WAR.XWXZX = math.random(3,4)
				if WAR.ATNum < 3 then
					if JLSD(10,45,pid) then
						WAR.ATNum = 3
					else
						WAR.ATNum = 2
					end
				end	
				if WAR.XWXZX == 3 then
					str = "之指・一点红"
				elseif WAR.XWXZX == 4 then
					str = "之指・八仙指路"
					WAR.BJ = 1
				end
			elseif yongjian(wugong) then
				WAR.XWXZX = math.random(5,6)
				if WAR.XWXZX == 5 then
					str = "之剑・青龙啸天"
					if JLSD(10,45,pid) then
						WAR.BJ = 1
						Cat('清除低级异常',WAR.CurID)
					end	
				elseif WAR.XWXZX == 6 then
					str = "之剑・凤翼天翔"
				end
			elseif yongdao(wugong) then
				WAR.XWXZX = math.random(7,8)
				if WAR.XWXZX == 7 then
					str = "之刀・剥极而复"
				elseif WAR.XWXZX == 8 then
					str = "之刀・复无极也"
					local a = math.modf((WAR.SPIRIT[pid] or 0)*0.5)
					if WAR.ZYHB == 0 and JLSD(10,a,pid) and WAR.DZXY == 0 and fjpd(WAR.CurID) == false then
						WAR.ZYHB = 1
					end	
				end
			elseif yongte(wugong) then
				WAR.XWXZX = math.random(9,10)
				if WAR.XWXZX == 9 then
					str = "之奇・风随白云飞"
				elseif WAR.XWXZX == 10 then
					str = "之奇・梦中云莱境"
					WAR.WS = 1
					if (WAR.PD['极意攻击'][pid] or 0) <= 6 then
						WAR.PD['极意攻击'][pid] = 6
					end	
				end
			end
			Set_Eff_Text(WAR.CurID,"特效文字3","无相"..str)
		end
		--三指诛仙
		if yongzhi(wugong) then
			local yinz = 0
			local yangz = 0
			local tiaoz = 0
			for k = 1, JY.Base["武功数量"] do 
				local wgid = JY.Person[pid]["武功"..k]
				for i = 0, JY.ThingNum -1 do
					if JY.Thing[i]["需内力性质"] == 0 and JY.Wugong[wgid]["武功类型"] == 2 and JY.Thing[i]["练出武功"] == wgid then
						yinz = yinz + 1
					end	
					if JY.Thing[i]["需内力性质"] == 1 and JY.Wugong[wgid]["武功类型"] == 2 and JY.Thing[i]["练出武功"] == wgid then
						yangz = yangz + 1
					end
					if JY.Thing[i]["需内力性质"] == 2 and JY.Wugong[wgid]["武功类型"] == 2 and JY.Thing[i]["练出武功"] == wgid then
						tiaoz = tiaoz + 1
					end
				end
			end
			if yinz > 0 and yangz > 0 and tiaoz > 0 and WAR.ACT == 1 then
				WAR.SZZX = 1
				if WAR.ATNum < 3 and JLSD(10,50,pid) then
					WAR.ATNum = 3
				end
			end	
			if WAR.SZZX > 0 then
				WAR.SZZX = WAR.SZZX + 1
				if WAR.SZZX > 4 then
					WAR.SZZX = 2
				end
				local color = M_DeepSkyBlue
				local n = {"一指断欲・难返蓬瀛","二指灭道・重堕轮回","三指诛仙・魄形俱丧・万劫周回生不复"}
				local display = n[WAR.SZZX-1]
				TXWZXS(display, color)
				if WAR.SZZX == 3 then
					CurIDTXDH(WAR.CurID,6,1,"一重蓄力")
					War_ActupMenu()
					CurIDTXDH(WAR.CurID,6,1,"二重蓄力")
					War_ActupMenu()
				end		
			end	
		end
		--闪电五连鞭
		if (PersonKF(pid,90) or PersonKF(pid,375)) and PersonKF(pid,99) and (wugong == 16 or wugong == 164 or wugong == 306) then
			WAR.SDWLB = 1
			if WAR.ATNum < 5 then
				WAR.ATNum = 5
			end	
			if WAR.ACT == 5 and MPTX(pid,4,2) == false then
				WAR.PD['灵蛇拳'][pid] = 10
			end	
			local color = M_DeepSkyBlue
            local n = {'一鞭','二鞭','三鞭','四鞭','五鞭'}
			local mbg = {'偷袭老同志','不讲武德','以和为贵','点到为止','耗子尾汁'}
            local display = "混元形意・闪电五连"
            if WAR.ACT > 0 and WAR.ACT < 6 then
                display = display..n[WAR.ACT]
                TXWZXS(display, color)
				local bx,by = CC.ScreenW/1360,CC.ScreenH/768
				lib.LoadPNG(91, 2 * 2 , 295+bx*212, 295+by*33.5, 1)
				ShowScreen();
				local size = 60
				local x = CC.ScreenW/2;
				local y = CC.ScreenH/2;
				local offx1 = (#"【")*size/4
				local offx2 = (#mbg[WAR.ACT])*size/4
				local offx3 = (#"】")*size/4
				local offx = offx1+offx2+offx3
				local offy = size/2
				for k = 1,10 do
					Cat('实时特效动画')
					Cls()
					Cat('实时特效动画2')
					lib.Background(0,y-50,CC.ScreenW,y+50,98)
					DrawString(x-offx,y-offy,"【"..mbg[WAR.ACT].."】",C_GOLD,size);  
					ShowScreen();
					lib.Delay(CC.BattleDelay)
				end
			end
		end
		--------------------------------------------------------------------------------
		------------------------------装备出手后---------------------------------------------
		--------------------------------------------------------------------------------
		--装备屠龙刀，使用等级为极的刀法，有几率触发两种特效
		if JY.Person[pid]["武器"] == 43 or PersonKF(pid,349) or match_ID(pid,13) then
			if yongdao(wugong)  or match_ID(pid,13) then
				--必流血，并追加等同于武功威力的杀气，50%几率优先判定
				if JLSD(25, 75, pid) then
					WAR.L_TLD = 1;
					Set_Eff_Text(id,"特效文字0","武林至尊.宝刀屠龙");
					--如果没有触发，则还有40%几率触发必定暴击
				elseif JLSD(35, 75, pid) then	
					WAR.BJ = 1
					Set_Eff_Text(id,"特效文字0","号令天下.莫敢不从");
				end
			end
		end
		--------------------------------------------------------------------------------
		------------------------------门派出手后---------------------------------------------
		--------------------------------------------------------------------------------
		--门派被动的攻击面（此处不能牵涉敌方、也不能有hurt）
		--if MPPD(pid) > 0  then
		local n = MPPD(pid)
		local dj = MPDJ(pid) 
		if MPTX(pid,1) then  --星宿
			WAR.SYWGZ = 1
			if  PersonKF(pid,87) then
				WAR.SYWGZ = 2
			end
			--九死龙爪
			if MPTX(pid,1,3) and wugong == 20 then
				WAR.JSLZ = 1
				if JLSD(10,45,pid) then
					WAR.WS = 1
					if (WAR.PD['极意攻击'][pid] or 0) <= 9 then
						WAR.PD['极意攻击'][pid] = 9
					end
					Set_Eff_Text(WAR.CurID,1,"九死龙爪・爪影重重")
				end
				if PersonKF(pid,4) and PersonKF(pid,11) and PersonKF(pid,87) then
					if WAR.ATNum < 3 then
						WAR.ATNum = 3
					end
				end	
			end
		end
		
		if MPTX(pid,2) then  --丐帮
			--目前没有主动攻击效果，主运擒龙功的攻击效果写在别的地方
			--丐帮2级弟子
			--丐帮
			if MPTX(pid,2) and Curr_QG(pid,2) then
				WAR.GBJY = WAR.GBJY + 1
			end
			if MPTX(pid,2,2) and (yongquan(wugong) or yongte(wugong) or WAR.PD['醉八仙'][pid] ~= nil) and  JLSD(20,50,pid) then
			local zbx = {'吕洞宾・醉酒提壶力千斤','铁拐李・旋争膝撞醉还真','汉钟离・醉步抱埕兜心顶','张果老・醉酒抛杯踢连环'
			,'韩湘子・擒腕擎胸醉吹箫','蓝采和・单提敬酒拦腰破','曹国舅・仙人敬酒锁喉扣','何仙姑・弹腰献酒醉荡步'}
			WAR.ZBX = math.random(1,8)
			CurIDTXDH(WAR.CurID,168,1,'醉八仙')
			Set_Eff_Text(WAR.CurID, 3,zbx[WAR.ZBX])	
			--醉八仙效果另写，因为路人
			end
			--降龙打狗大范围
			if MPTX(pid,2,4) and Curr_NG(pid,204) and JLSD(40,80,pid) and (wugong == 26 or wugong == 80) then
				TXWZXS("降龙傲意震八方・打狗追风世无双",M_Red)
				WAR.GBBZ = 1
				local x1 = WAR.Person[WAR.CurID]["坐标X"];
				local y1 = WAR.Person[WAR.CurID]["坐标Y"];
				for ex = x1 - 10, x1 + 10 do
					for ey = y1 - 10, y1 + 10 do
						SetWarMap(ex, ey, 4, 1)
						if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
							local ep = GetWarMap(ex, ey, 2)
							if WAR.Person[WAR.CurID]["我方"] == WAR.Person[ep]["我方"] then
								WAR.ZTHF[WAR.Person[ep]["人物编号"]] = 10;	
								SetWarMap(ex, ey, 4, 4)
							end	
						end
					end
				end
				ng = ng + 2000
				if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
					WAR.PD['极意攻击'][pid] = 8
				end
		  	end
			--丐帮擒龙功
			if wugong == 26 and MPTX(pid,2,3) and Curr_NG(pid,204) then
				WAR.BFX = 1
				ng = ng + 1000
				if (WAR.PD['极意攻击'][pid] or 0) < 5 then 
					WAR.PD['极意攻击'][pid] = 5
				end	
		  	end	 
			if WAR.GBJY > 3 and JLSD(10,30+math.modf(WAR.GBJY*10),pid) and wugong == 80 then
				WAR.BLX = 1
				WAR.BFX = 1
				WAR.GBJY = 0
				WAR.GBJY1 = math.random(2,4)
				WAR.PD['全屏攻击'][pid] = 1
				WAR.WS = 1
				for i = 40, 80 do
					NewDrawString(-1, -1, "打狗奥义 恶犬皆尽", C_GOLD, i)
					ShowScreen()
					if i == 80 then
						Cls()
						NewDrawString(-1, -1, "打狗奥义 恶犬皆尽", C_GOLD, i)
						ShowScreen()
						lib.Delay(400)
					else
						lib.Delay(1)
					end
				end
			end	
		end
		
		if MPTX(pid,3) then  --古墓
			WAR.PD['必杀气'][pid] = 1
			if (wugong == 6 or wugong == 42 or wugong == 139 or wugong == 79) and Curr_QG(pid,148) and JLSD(10,40,pid) then
				WAR.PD['增加气攻'][pid] = (WAR.PD['增加气攻'][pid] or 0) + math.modf(Qg(WAR.CurID) * 0.5)
				if WAR.PD['增加气攻'][pid] > 1000 then WAR.PD['增加气攻'][pid] = 1000 end
				Set_Eff_Text(WAR.CurID, "特效文字3", "天罗・缠劲")
			end
			--古墓2级弟子
			if MPTX(pid,3,2) and Curr_NG(pid,154) and JLSD(20,50,pid) then
				WAR.PD['强运'][pid] = 1
				WAR.PD['免疫反击'][pid] = 1
				Set_Eff_Text(id, "特效文字3", "玉女心经・养生十二少")
			end
			if MPTX(pid,3,2) and Curr_NG(pid,154) and JLSD(20,50,pid) then
				local a = math.random(1,3)
				local b = a * 2
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if JY.Person[WAR.Person[j]["人物编号"]]["体力"] > 9 then
							ztd(j,'体力点数',-b)
						else
						    ztd(j,'体力点数',-JY.Person[WAR.Person[j]["人物编号"]]["体力"])
							ztd(j,'生命点数',-500)
						end
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字3", "玉女心经・养生十二多")
			end
			if MPTX(pid,3,2) and Curr_QG(pid,148) and JLSD(20,50,pid) then
				local c = math.modf(Qg(WAR.CurID)/500+1)
				WAR.ATNum = limitX(WAR.ATNum + c,1,6)
			end
		end
		
		if MPTX(pid,4) then  --武当
			if match_ID(pid,5) then
				dj = 5
			end	
			--武当2级弟子学会纯阳用拳法
			if wugong == 16 and MPTX(pid,4,2) and PersonKF(pid,99) then
				local a = math.modf(JY.Person[pid]["内力"]/500)
				local b = dj
				WAR.BG[pid] = (WAR.BG[pid] or 0) + a * (b + WAR.ACT)
			end
			--武当2级弟子学会纯阳用剑法
			if wugong == 46 and MPTX(pid,4,2) and PersonKF(pid,99) then
				local a = math.modf(JY.Person[pid]["内力"]/500)
				local b = dj
				WAR.WJ[pid] = (WAR.WJ[pid] or 0) + a * (b + WAR.ACT) * 5
			end
			--武当2级弟子无极、八卦
			if MPTX(pid,4,2) then 
				if WAR.BG[pid] ~= nil then
					Set_Eff_Text(WAR.CurID, "特效文字2", "八卦")
				end
				if WAR.WJ[pid] ~= nil then
					Set_Eff_Text(WAR.CurID, "特效文字2", "无极")
				end	
			end	
			--武当2级
			if MPTX(pid,4,2) and PersonKF(pid,99) and JLSD(10,40,pid) then
				WAR.PD['必灼烧'][pid] = 1 
				WAR.PD['杀内力'][pid] = 1
				addbuff(pid,WAR.CSHF,5)
				Set_Eff_Text(id,"特效文字3","纯阳聚气法")
			end
			--武当3级纯阳
			if MPTX(pid,4,3) then
				if JLSD(10,40,pid) then
					if PersonKF(pid,99) and wugong == 46 then
				        local a = math.modf(TrueYJ(pid) / 10)
				        WAR.BG[pid] = (WAR.BG[pid] or 0) + a 
				        WAR.WJ[pid] = (WAR.WJ[pid] or 0) + a 
					end
					if PersonKF(pid,99) and wugong == 16 then
				        local b = math.modf(TrueQZ(pid) / 10)
				        WAR.BG[pid] = (WAR.BG[pid] or 0) + b 
				        WAR.WJ[pid] = (WAR.WJ[pid] or 0) + b 
					end
				end
			end
			--武当4级弟子太极之形
			if MPTX(pid,4,4) and (WAR.TJZX0[pid] or 0) > 0 then 
				local zhongshu = WAR.TJZX0[pid]
				local cishu = 0
				if PersonKF(pid, 99) then
					zhongshu = zhongshu + 1
				end
				for i = 1,zhongshu do
					if math.random(10) >= (9 - zhongshu) then
						cishu = cishu + 1
					end
				end
				WAR.TJZX1[pid] = WAR.TJZX0[pid]
				WAR.TJZX2[pid] = limitX(cishu, 0, 4)
				if WAR.ATNum < 6 then
					WAR.ATNum = limitX(WAR.ATNum + WAR.TJZX2[pid],1, 6)
				end
				WAR.TJZX0[pid] = nil
				if WAR.TJZX2[pid] > 0 then
					Set_Eff_Text(id,"特效文字2","太极之形・自然法道")
				end
			end
			--武当3级弟子太极剑
			if wugong == 46 and MPTX(pid,4,3) and Curr_NG(pid,99) then
				if JLSD(20,50,pid) then
					for j = 0, WAR.PersonNum - 1 do 
						local df = WAR.Person[j]["人物编号"] 
						local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[j]["坐标X"]) 
						local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[j]["坐标Y"])	
						if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false and offset1 <= 8 and offset2 <= 8 then
							WAR.PD['武当纯阳'][WAR.Person[j]["人物编号"]] = 1 
						end
					end 
					Set_Eff_Text(id, "特效文字2", "纯阳剑劲・生生不息")	
				end
			end
			if BNJQ(pid) then
				local a = JY.Person[pid]["品德"]
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if nokillspeed(j) == false then
							ztd(j,'集气位置',-a)
						end
					end
				end
			end
		end
			
		if MPTX(pid,5) then  --少林
			if match_ID(pid,577) then
				dj = 5
			end	
			--少林派
			if MPTX(pid,5,2) then
				local kfid = wugong
				if wugong == 1 or wugong == 347 or wugong == 22 or wugong == 24 or wugong == 189 or (MPTX(pid,5,4) and yongquan(wugong)) then
					WAR.SLSQF = 1
				end
				if wugong == 122 or wugong == 124 or wugong == 128 or kfid == 132 or kfid == 133 or kfid == 136 or kfid == 137 or wugong == 20 or (MPTX(pid,5,4) and yongzhi(wugong)) then
					WAR.SLSZF = 1
				end
				if wugong == 350 or wugong == 57 or wugong == 65 or wugong == 267 or (MPTX(pid,5,4) and yongdao(wugong)) then
					WAR.SLSDF = 1
				end
				if wugong == 194 or wugong == 82	or wugong == 86 or (MPTX(pid,5,4) and yongte(wugong)) then
					WAR.SLSQM = 1
				end
			end
			if PersonKF(pid,208) then
				if (wugong == 1 or wugong == 347) and JLSD(10,40,pid) then
					AddPersonAttrib(pid,'拳掌功夫',1)
				end
				if (wugong == 350 or wugong == 57) and JLSD(10,40,pid) then
					AddPersonAttrib(pid,'耍刀技巧',1)
				end
				if (wugong == 122 or wugong == 124 or wugong == 128) and JLSD(10,40,pid) then
					AddPersonAttrib(pid,'指法技巧',1)
				end
			end	
			--少林二级罗汉堂
			if MPTX(pid,5,2) and Curr_NG(pid,96) then
				if WAR.PD['罗汉果位'][id] ~= nil then
					if WAR.PD['罗汉果位'][id] == 1 then
						Set_Eff_Text(WAR.CurID,2,'罗汉果位')
					else
						Set_Eff_Text(WAR.CurID,1,'降魔真意')
					end
				end
			end						
			--少林二级金刚殿
			if MPTX(pid,5,2) and Curr_NG(pid,144) then
				if WAR.SLSQF > 0 then
					local str = {'明王无生・金刚印','明王无生・梵莲印','明王无生・雷音印'}
					WAR.JGDQZ = math.random(3)
					if WAR.JGDQZ == 3 and  WAR.SZH > 0 then
						Set_Eff_Text(WAR.CurID,3,'明王无生・大雷音印')
						for j = 0, WAR.PersonNum -1 do
							if dead(j) == false and DWPD(j,WAR.CurID) then
								addbuff(WAR.Person[j]['人物编号'],WAR.PD['怯战状态'],1)
								if JLSD(10,25,pid) then
									WAR.PD['昏迷状态'][WAR.Person[j]['人物编号']] = 1
								elseif JLSD(10,45,pid) then
									WAR.PD['头晕目眩'][WAR.Person[j]['人物编号']] = 1
								end
							end
						end
					else
						Set_Eff_Text(WAR.CurID,3,str[WAR.JGDQZ])	
					end					
				end	
				if WAR.SLSZF > 0 then
					local str = {'刚指・断肢','刚指・碎骨','刚指・绝脉'}
					WAR.JGDZF = math.random(3)
					Set_Eff_Text(WAR.CurID,3,str[WAR.JGDZF])
				end	
			end	
			if MPTX(pid,5,2) and Curr_NG(pid,96) then
				if WAR.SLSDF > 0 then
					local str = {'斩业','灭罪','降魔'}
					WAR.LHTDF = math.random(3)
					Set_Eff_Text(WAR.CurID,3,'佛邢'..str[WAR.LHTDF])
				end
				if WAR.SLSQM > 0 then	
					local ng = ng + math.modf(TrueTS(pid)*dj*0.25)
					local str = {'罗汉宣法','怒目荡魔','三入地狱'}
					if WAR.PD['三入地狱'][pid] == nil then
						WAR.LHTQM = math.random(3)
					else
						WAR.LHTQM = math.random(2)
					end
					if WAR.LHTQM == 3 then
						WAR.ATNum = WAR.ATNum + 3
						WAR.PD['三入地狱'][pid] = 1
					end	
					if WAR.LHTQM == 1 then
						if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
							WAR.PD['极意攻击'][pid] = 7
						end
					end	
					Set_Eff_Text(WAR.CurID,3,'伏魔・'..str[WAR.LHTQM])		
				end	
			end	
			--少林3级弟子易筋经
			if MPTX(pid,5,3) and Curr_NG(pid,108) and JLSD(25,55,pid) then
				Set_Eff_Text(WAR.CurID,3,"灭罪真言・莲华洗秽")
				ng = ng + 2000
				if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
					WAR.PD['极意攻击'][pid] = 9
				end
			end
			--少林达摩堂	
			if WAR.SLSZF > 0 and Curr_NG(pid,108) and MPTX(pid,5,3) then
				WAR.DMZF = math.random(1,6)
				local str = ""
				if WAR.DMZF == 1 then
					str="・天人"
				elseif WAR.DMZF == 2 then
					str="・修罗"
				elseif WAR.DMZF == 3 then
					str="・人间"
				elseif WAR.DMZF == 4 then
					str="・畜生"
				elseif WAR.DMZF == 5 then
					str="・饿鬼"
				elseif WAR.DMZF == 6 then
					str="・地狱"
				end
				Set_Eff_Text(WAR.CurID,2,"达摩指爪精要"..str)   
			end
			--少林达摩
			if MPTX(pid,5,3) and Curr_NG(pid,108) then
				if (WAR.SLSQF > 0 or WAR.SLSZF > 0) and JLSD(10,45,pid) then
					WAR.TFJS = 1
					Set_Eff_Text(WAR.CurID, 1, "天佛降世・千手如来")
					if WAR.ATNum < 3 then
						WAR.ATNum = WAR.ATNum + 3
					end
				end	
			end
			--少林易筋经概率全屏
			if MPTX(pid,5,3) and Curr_NG(pid,108) and (BNJQ(pid) or ((WAR.SPIRIT[pid] or 0) > 120 and JLSD(10,40,pid))) then
				CurIDTXDH(WAR.CurID,155,4,"天佛降世・普渡众生")
				WAR.PD['全屏攻击'][pid] = 1
				for i = 0, WAR.PersonNum - 1 do
					if DWPD(WAR.CurID,i) and dead(i) == false then
						local id = WAR.Person[i]["人物编号"]
						local a = JY.Person[id]["品德"] + (WAR.SPIRIT[id] or 0)
						ztd(i,'生命点数',math.modf(a))
						ztd(i,'内力点数',math.modf(a*3))
					end
				end
			end	
		end
			
		if MPTX(pid,6) then  --密宗
			if match_ID(pid,62) or match_ID(pid,97) or match_ID(pid,103) then
				dj = 3
			end	
			if Curr_NG(pid,103) and JLSD(10,50,pid) and MPTX(pid,6,2) then
				WAR.LXFM = 1
				Set_Eff_Text(WAR.CurID, "特效文字3", "大力龙象・神威伏魔")
			end	
			if (match_ID(pid,9931) or yongquan(wugong)) and Curr_NG(pid,103) and (wgnlxz(wugong) == 1 or wgnlxz(wugong) == 2) and JLSD(10,60,pid) then
				WAR.SLSX[pid] = 1
				WAR.LXBRZ = math.random(2)
				if WAR.LXBRZ == 1 then
					TXWZXS("龙象般若掌・刚猛无俦",M_Red)
				else
					TXWZXS("龙象般若掌・般若大智",M_Red)
				end	
			end	
			if MPTX(pid,6,2) and Curr_NG(pid,103) then
				for j = 0, WAR.PersonNum - 1 do
					if DWPD(WAR.CurID,j) and dead(j) == false then
						if nokillspeed(j) == false then
							ztd(j,'集气位置',-50)
						end	
					end
				end
				Set_Eff_Text(WAR.CurID,2,"龙象之力")
			end
			--密宗1级血刀门
			if MPTX(pid,6,1) and wugong == 63 and JLSD(20,50,pid) then
				if JLSD(20,50,pid) then
					WAR.XDLX = 1
					for j = 0, WAR.PersonNum -1 do
						local e = WAR.Person[j]["人物编号"]
						if dead(j) == false and DWPD(WAR.CurID,j) and RealJL(WAR.CurID,j,4) then
							WAR.PD['创伤'][e] = (WAR.PD['创伤'][e] or 0) + math.random(3,6)
						end
					end
					Set_Eff_Text(WAR.CurID,3,"鲜血爆裂")		
				end	
			end
			--密宗2级血刀门
			if MPTX(pid,6,2) and Curr_NG(pid,163)  then 
				if JLSD(20,50,pid) then
					for j = 0, WAR.PersonNum - 1 do
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local lx = math.modf(JY.Person[tmppid]["流血程度"] *0.5)
							ztd(j,WAR.LXXS,-lx)
							ztd(j,WAR.BFXS,lx)
							WAR.PD['冰冻状态'][tmppid] = (WAR.PD['冰冻状态'][tmppid] or 0) + math.modf(lx*0.5)
							WAR.PD['冰冻扣血'][tmppid] = (WAR.PD['冰冻扣血'][tmppid] or 0) + math.modf(lx*0.5)
							if JLSD(0,30,pid) then
								WAR.PD['利刃寒锋'][tmppid] = (lx*0.2)
							end
						end
					end
					Set_Eff_Text(WAR.CurID,3,"血色弥漫")
				end
				if JLSD(20,50,pid) then
					if WAR.PD['血淬'][pid] ~= nil and WAR.PD['血淬'][pid] > 0 then
						local a = math.modf(WAR.PD['血淬'][pid]/3)
						ztd(WAR.CurID,"生命点数",a)
					end 
					Set_Eff_Text(WAR.CurID,3,"饮血寒锋")
				end	
			end
			--密宗暴怒技
			if MPTX(pid,6,1) and BNJQ(pid) then
				local a = limitX(JY.Person[pid]['实战']*0.1,10,100)
				for j = 0, WAR.PersonNum - 1 do
					local id = WAR.Person[j]['人物编号']
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,"内伤点数",a)
						ztd(j,"生命点数",-100)
						WAR.PD["伤重不治"][id] = (WAR.PD["伤重不治"][id] or 0) + 5
					end
				end
			end
		end
		if MPTX(pid,7) then  --逍遥派
			if PersonKF(pid,98) and JLSD(0,50,pid) then
				WAR.QBLL = 1
				Set_Eff_Text(WAR.CurID,1,"七宝琉璃")
			end
			--主运八荒的攻击加成
			if MPTX(pid,7,3) and (Curr_NG(pid,101) or (XiaoYaoYF(pid) and PersonKF(pid,101))) then
				if JLSD(20,55,pid) then
					for j = 0, WAR.PersonNum - 1 do
						if DWPD(WAR.CurID,j) and dead(j) == false then
							ztd(j,WAR.LXXS,math.random(15,30))     
						end
					end
				end
			end
			--主运不老长春的攻击加成
			if (MPTX(pid,7,3) and (Curr_NG(pid,183) or (XiaoYaoYF(pid) and PersonKF(pid,183)))) or match_ID(pid,117) or match_ID(pid,634) then	
				if JLSD(30,55,pid) then
					for j = 0, WAR.PersonNum - 1 do 
						if DWPD(WAR.CurID,j) and dead(j) == false then
							ztd(j,'集气位置',-50)
						end
					end
				end
			end
			--主运小无相的攻击加成
			if MPTX(pid,7,2) and (Curr_NG(pid,98) or (XiaoYaoYF(pid) and PersonKF(pid,98))) then
				if JLSD(20,55,pid) then
					for j = 0, WAR.PersonNum - 1 do 
						if DWPD(WAR.CurID,j) and dead(j) == false then
							ztd(j,WAR.FXXS,math.random(10,20))
						end
					end
				end
			end
		end
			
		if MPTX(pid,8) then  --白驼
			if MPTX(pid,8,3) and Curr_NG(pid,104) then --白驼山3级
				ztd(WAR.CurID,WAR.FXXS,10)
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
			end
		end	
		
		if MPTX(pid,9) then  --唐门
			WAR.PD['戳字决'][pid] = 1
			--唐门模式夺魄箭
			if WAR.TMMS[pid] == 1 then
				if WAR.ACT == 1 then 
					if WAR.DPJ[pid] == nil then
						WAR.DPJ[pid] = 1
					else  
					    WAR.DPJ[pid] = WAR.DPJ[pid] + 1 
	                end
					if (WAR.DPJ[pid] < 3 and WAR.BJ == 1 and JLSD(10,40,pid)) or WAR.DPJ[pid] == 3 then 
						WAR.TMMS[100+pid] = 1
					end
					if WAR.DPJ[pid] == 4 and WAR.BJ == 1 then
						if JLSD(10,60,pid) then 
							Set_Eff_Text(WAR.CurID,3,"妙手连环")
							WAR.TMMS[300 + pid] = 1
							WAR.TMMS[100 + pid] = 1
						end
					end
					if WAR.DPJ[pid] > 4 then 
						WAR.DPJ[pid] = 1 
					end
					WAR.TMMS[200 + pid] = WAR.DPJ[pid]
					if WAR.DPJ[pid] == 4 then
						Set_Eff_Text(WAR.CurID,1,"追命无声")
			        end
	        	end 
				if JLSD(10,40,pid) then 
					WAR.LZZ = 1
					Set_Eff_Text(WAR.CurID,3,"雷震子")     
				end
			    if JLSD(10,40,pid) then 
					WAR.HXB = 1
					Set_Eff_Text(WAR.CurID,3,"化血镖") 
				end
			    if JLSD(10,40,pid) then 
					WAR.CXN = 1
					Set_Eff_Text(WAR.CurID,3,"穿心弩")
			    end
			    if JLSD(10,40,pid) then 
					WAR.ZXJ = 1
					Set_Eff_Text(WAR.CurID,3,"逐星箭")
				end 
		    end
		    if WAR.TMMS[pid] == 2 then
		        if JLSD(10,40,pid) then 
					WAR.HXB = 1
					Set_Eff_Text(WAR.CurID,3,"化血镖")
		        end
		        if JLSD(10,40,pid) then 
					WAR.JTJD1 = 1
					Set_Eff_Text(WAR.CurID,3,"荆天棘地")
		        end
		        if JLSD(10,40,pid) then 
					WAR.BYLH = 1
					Set_Eff_Text(WAR.CurID,3,"暴雨梨花")
		        end
	        end
			--唐门模式
			if WAR.BYLH == 1 and WAR.TMMS[pid] == 2 and WAR.QJBMS[pid] == nil then 
				if (WAR.PD['极意攻击'][pid] or 0) < 10 then 
				  	WAR.PD['极意攻击'][pid] = 10
				end
			end
			--唐门模式
			if WAR.QJBMS[pid] == 3 then   
				if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
				  	WAR.PD['极意攻击'][pid] = 8
				end
			end
		end
		if MPTX(pid,10) then  --桃花岛
			if match_ID(pid,57) then
				dj = 3
			end	
			if match_ID(pid,588) then
				dj = 2
			end
			addbuff(pid,WAR.PD['集气速度'],6)
			--桃花岛1级主运碧海
			if MPTX(pid,10,1) and (Curr_NG(pid,248) or (match_ID(pid,9848) and PersonKF(pid,248))) then
				local jl = 20*dj
				if WAR.ACT == 1 or (WAR.ACT > 1 and JLSD(10,jl,pid)) then
					WAR.TH_BHMY = 1
					Set_Eff_Text(WAR.CurID,0,"桃花秘传・碧海魔音锁人魂")
				end
				if JLSD(20,50,pid) then
					WAR.THSB = 1
					Set_Eff_Text(WAR.CurID,1,"桃花真传・玉漏催银舞神剑")
				end
				if JLSD(20,50,pid) then
					WAR.THSB = 2
					Set_Eff_Text(WAR.CurID,1,"桃花真传・芳华落尽劈空掌")
				end
				if JLSD(20,50,pid) then
					WAR.THSB = 3
					Set_Eff_Text(WAR.CurID,1,"桃花真传・兰花拂面暗疏影")
				end
			end
			--桃花岛1级主运碧海
			if WAR.TH_BHMY == 1 then
				local mpdj2 = dj+1
				local mpdj3 = dj*10
				local kl = mpdj2*100
				for j = 0, WAR.PersonNum - 1 do
					local tid = WAR.Person[j]["人物编号"]
					if DWPD(WAR.CurID,j) and dead(j) == false then
						local tl = math.modf(JY.Person[tid]["内力"]/2)
						if tl > 1 then
							ztd(j,"内力点数", -tl)
						else
							ztd(j,"生命点数", -mpdj3*15)
						end
						if JY.Person[tid]["体力"] > mpdj2*2 then
							ztd(j,'体力点数',-mpdj2*2)
						else
							ztd(j,'生命点数',-kl)
						end
					end
				end
			end
			--桃花岛2级主运遁甲
			if MPTX(pid,10,2) and Curr_NG(pid,251) then   
				WAR.WS = 1
				if JLSD(0,50,pid) then
					if WAR.ATNum < 4 then
						WAR.ATNum = 4
					else
						if WAR.ATNum < 3 then
							WAR.ATNum = 3
						end
					end
				end
				if JLSD(20,50,pid) then
					for j = 0, WAR.PersonNum - 1 do 
						local bb = WAR.ACT
						local aa = math.random(1,2)
						local df = WAR.Person[j]["人物编号"]
						if DWPD(WAR.CurID,j) and dead(j) == false and RealJL(WAR.CurID,j,8) then
							if aa == 1 then
								ztd(j,'生命点数',-math.modf(80*bb))
							else
								ztd(j,'内力点数',-math.modf(80*bb))
							end
						end
					end
				end 
				if JLSD(20,50,pid) then
					local a = JY.Person[pid]["内力"]/20
					for j = 0, WAR.PersonNum - 1 do
						if dead(j) == false and DWPD(WAR.CurID,j) == false then
							ztd(j,'内伤点数',-20)
							ztd(j,'内力点数',a*2)
							ztd(j,'生命点数',a)
						end
					end
					CurIDTXDH(WAR.CurID,212,1,"遁甲奇术・愈")
				end
				if JY.Person[pid]["生命"] > 0 then
					local a = 1
					local b = 1
					local c = 1
					local mpdj = dj * 500
					a = mpdj* 0.15
					b = a * 4
					c = 5 + math.modf(JY.Person[pid]["受伤程度"] / 10)
					ztd(WAR.CurID,"生命点数",a)
					ztd(WAR.CurID,"内力点数",b)
					ztd(WAR.CurID,"内伤点数",-c)
					ztd(WAR.CurID,"中毒点数",-c)
					Set_Eff_Text(WAR.CurID,1,"碧海潮生・东临碣石",135)
				end
			end
			if MPTX(pid,10,2) and Curr_NG(pid,251) then
				local str=""
				local jilv1 = dj*10 --初始几率10
				local jilv2 = 0 			
				if Qg(WAR.CurID) > 200 then --轻功200以上，每20点+1点几率
					jilv2 = jilv2 + math.modf(Qg(WAR.CurID)*0.04)
				end
				if JLSD(10, (jilv1+jilv2), pid) then
					local a = math.random(3)
					if a == 1 then
						WAR.THSB1 = 1  --锁足
						str = "・桃花影落飞神剑"
					elseif a == 2 then
						WAR.THSB2 = 1  --封印
						str = "・弹指易老情空若" 
					elseif a == 3 then
						WAR.THSB3 = 1  --刺目
						str = "・碧海潮生弄玉箫"	
					end
				end
				Set_Eff_Text(WAR.CurID,2,"桃花绝学"..str)
			end
		end
		if MPTX(pid,11) then  --一刀流 	
			WAR.PD['必冰封'][pid] = 1
			WAR.PD['必灼烧'][pid] = 1
			--一刀流
			if WAR.ATNum < 4 then
				WAR.ATNum = WAR.ATNum * 2
			end
			if match_ID(pid,741) or match_ID(pid,742) then --噩梦
				if WAR.ATNum < 5 then
					WAR.ATNum = WAR.ATNum * 3
				end
			end
			--一刀流1级
			if wugong == 151 then
				WAR.JuHuo = 1
				WAR.ZLJS = math.random(1,6)
				local ZLJS = "斩流剑术・奥义・"
				local WZTS = {"无量劫","一之太刀","居合","聚","破","海上生明月"}
				Set_Eff_Text(WAR.CurID,2,ZLJS..WZTS[WAR.ZLJS])
				if WAR.ZLJS == 1 then 
					WAR.ZLJS1 = 1
				end
				if WAR.ZLJS == 2 then 
					WAR.PD['必冰封'][pid] = 1
					WAR.PD['必灼烧'][pid] = 1	
				end
				if WAR.ZLJS == 3 then 
					WAR.ZLJS3 = 1
				end
				if WAR.ZLJS == 4 then 
					WAR.ZLJS4 = 1
					ng = ng + 1000
				end
				if WAR.ZLJS == 5 then 
					WAR.ZLJS5 = 1
					ng = ng + 1000
				end
				if WAR.ZLJS == 6 then 
					WAR.ZLJS6 = 1
					local zq2 = TrueYJ(pid)
					ng = ng + zq2
					if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
						WAR.PD['极意攻击'][pid] = 7
					end
				end
			end
			--一刀流2级
			if MPTX(pid,11,2) and wugong == 151 and Curr_NG(pid,152) then
				local a = math.random(3)
				local str = ""
				if a == 1 then 
					for j = 0, WAR.PersonNum - 1 do 
						if DWPD(WAR.CurID,j) and dead(j) == false and RealJL(WAR.CurID,j,10) then
							WAR.WYWX[WAR.Person[j]["人物编号"]] = 1 
						end
					end
					Set_Eff_Text(WAR.CurID,3,"秘剑演武・无影无相") 
				elseif a == 2 then 	
					for j = 0, WAR.PersonNum - 1 do 
						local df = WAR.Person[j]["人物编号"] 
						if DWPD(WAR.CurID,j) and dead(j) == false then
							ztd(j,'集气位置',-100)
							ztd(j,WAR.FXXS,math.random(3,5))    
						end
					end
					Set_Eff_Text(WAR.CurID,3,"秘剑演武・豪气剑空")
				elseif a == 3 then 
					local x1 = WAR.Person[WAR.CurID]["坐标X"];
					local y1 = WAR.Person[WAR.CurID]["坐标Y"];
					for ex = x1 - 10, x1 + 10 do
						for ey = y1 - 10, y1 + 10 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								if DWPD(WAR.CurID,ep) and dead(ep) == false then
									WAR.PD["锁足状态"][WAR.Person[ep]["人物编号"]] = 1;
									SetWarMap(ex, ey, 4, 4)	
								end 
							end
						end
					end
					Set_Eff_Text(WAR.CurID,3,"秘剑演武・落花无痕")	
				end			
				if math.random(100) > 80 then
					TXWZXS('秘剑演武・天道剑势・玄天剑诀',C_GOLD)
					for j = 0, WAR.PersonNum - 1 do
						local df = WAR.Person[j]["人物编号"]
						if dead(j) == false and DWPD(WAR.CurID,j) then
							if RealJL(WAR.CurID,j,9) then
								ztd(j,'生命点数',-(JY.Person[pid]["内力"]+JY.Person[df]["内力"]))
							else
								ztd(j,'生命点数',-math.modf(JY.Person[df]["内力"]/10))
							end
						end
					end
				end
			end
			if Curr_NG(pid,152) and BNJQ(pid) then
				for j = 0, WAR.PersonNum-1 do 
					if dead(j) == false and DWPD(WAR.CurID,j) then
						if RealJL(WAR.CurID,j,9) then
							ztd(j,"生命点数",-1000)
						end
					end
				end
			end
		end
		if MPTX(pid,12) then  --日月
			 if MPTX(pid,12,2) and Curr_NG(pid,88) and JLSD(30,50,pid) then
				local nl = JY.Person[pid]["内力"]
				for j = 0, WAR.PersonNum -1 do 
					local df = WAR.Person[j]['人物编号']
					if dead(j) == false and DWPD(WAR.CurID,j) then
						ztd(j,'内力点数',-300)
						if RealJL(WAR.CurID,j,7) then
							nl = nl + JY.Person[df]["内力最大值"]-JY.Person[df]["内力"]
							ztd(j,"生命点数",-math.modf(nl/15))
						end
					end
				end	
				Set_Eff_Text(WAR.CurID,2,"常如空箱・恒似深谷")
			end	
		end
		
		if MPTX(pid,13) then  --明教
			if MPTX(pid,13,4) and Curr_NG(pid,93) and (yongdao(wugong) or yongte(wugong) or wugong == 340) then	
				for j = 0, WAR.PersonNum - 1 do
					local p = WAR.Person[j]["人物编号"]
					if dead(j) == false and DWPD(WAR.CurID,j) then
						WAR.PD['光明圣火'][p] = (WAR.PD['光明圣火'][p] or 0) + 20
					end
				end
				Set_Eff_Text(WAR.CurID,2,'燃我圣火')
			end  
			--明教暴怒技
			if MPTX(pid,13,1) and BNJQ(pid) then
				for j = 0, WAR.PersonNum - 1 do
					local p = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,WAR.ZSXS,100)
						WAR.PD['焚炎不尽'][p] = 15
						WAR.PD['阳气侵蚀'][p] = 15
					end
				end
			end
		end
		
		if MPTX(pid,14) then  --五岳剑派
			--夺命连环三仙剑
			if MPTX(pid,14,2) and WAR.SXJ == 1 then
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
					for i = 1, 10 do
						DrawStrBox(-1, 24, "夺命连环三仙剑", C_ORANGE, 20 + i)  
						ShowScreen()
						lib.Delay(20)
					end
				end
			end
			if MPTX(pid,14,1) and wugong >= 30 and wugong <= 34 then
				if (WYJJ(pid) and JLSD(10,40,pid)) or MPTX(pid,14,6) then
					WAR.WYJF = 6
					if WAR.ATNum >= 2 then
						WAR.BJ = 1
					else
						WAR.ATNum = WAR.ATNum + 1
					end	
					Set_Eff_Text(WAR.CurID, "特效文字1", "五岳剑法・剑气冲霄")
				elseif JLSD(10,40,pid) then
					WAR.WYJF = math.random(5)
				end
			end	
			if (MPTX(pid,14,3) and (Curr_NG(pid,90) or Curr_NG(pid,375)) and yongquan(wugong)) or 
			((match_ID(pid,54) or match_ID(pid,185) or match_ID(pid,186) or match_ID(pid,187) or match_ID(pid,188)) and yongquan(wugong)) then
				if JLSD(20,50,pid) then
					for j = 0, WAR.PersonNum - 1 do
						if dead(j) == false and DWPD(WAR.CurID,j) then
							if nokillspeed(j) == false then
								ztd(j,'集气位置',-100)
							end
						end	
					end 	
				end
				Set_Eff_Text(WAR.CurID, "特效文字2","破玉碎岩")
			end
			if MPTX(pid,14,2) and WAR.BFTX == 1 then 
				WAR.PD['全屏攻击'][pid] = 1
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if dead(j) == false and DWPD(WAR.CurID,j) then
						WAR.PD['利刃寒锋'][tmppid] = (WAR.PD['利刃寒锋'][tmppid] or 0) + math.random(1,8)
						WAR.PD['冰冻状态'][tmppid] = (WAR.PD['冰冻状态'][tmppid] or 0) + math.random(20,50)
					end
				end		
			end
		end
		if MPTX(pid,15) then  --大理
			if match_ID(pid,499) or match_ID(pid,65) then
				dj = 4
			end
			ng = ng + math.modf((TrueQZ(pid)+TrueZF(pid))/2*JY.Person[pid]["内力最大值"]/8000*dj+JY.Person[pid]["资质"]*10)
			--大理学会天南易阳
			if PersonKF(pid,314) and JY.Person[pid]["生命"] > 0 then
				local a = JY.Person[pid]["灼烧程度"] 
				local b = JY.Person[pid]["灼烧程度"] * 2
				ztd(WAR.CurID,"内力点数",a)
				ztd(WAR.CurID,"体力点数",b)
				CurIDTXDH(WAR.CurID,76,1, "阳气滋补")
			end
			--大理2级主运枯禅
			if MPTX(pid,15,2) and Curr_NG(pid,207) and WAR.ACT <= 5 then
				local a = 1
				local b = 1
				local c = 1
				local mpdj = dj * 400
				a = mpdj * 0.25
				b = a * 2
				c = 5 + math.modf(JY.Person[pid]["受伤程度"] / 10)
				ztd(WAR.CurID,"生命点数",a)
				ztd(WAR.CurID,"内力点数",b)
				ztd(WAR.CurID,"内伤点数",-c)
				ztd(WAR.CurID,"中毒点数",-c)
				CurIDTXDH(WAR.CurID, 151, 1, "大理心法调息");
			 end	
			--大理3级主运天南
			if MPTX(pid,15,3) and Curr_NG(pid,314) and JLSD(20,55,pid) then	
				local a = JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"]
				local b = JY.Person[pid]["内力"]/JY.Person[pid]["内力最大值"]
				if b < a then 
					CurIDTXDH(WAR.CurID,108,1,"龙气自生")
					ztd(WAR.CurID,"内力点数",math.random(1000,1500))
				end 
			end	
			--大理3级主运天南
			if MPTX(pid,15,3) and Curr_NG(pid,314) and (wugong == 49 or match_ID(pid,499)) then	 
				if JLSD(20,50,pid) then	
					for j = 0, WAR.PersonNum -1 do
						if dead(j) == false and DWPD(WAR.CurID,j) then
							if RealJL(WAR.CurID,j,9) then
								ztd(j, "生命点数",-666)  
							end
						end
					end
					Set_Eff_Text(WAR.CurID, 2,"六脉奥义・剑气纵横")
				end
			end
			if Curr_QG(pid,280) and JLSD(10,40,pid) then
				for j = 0, WAR.PersonNum -1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						WAR.SPIRIT[WAR.Person[j]["人物编号"]] = limitX((WAR.SPIRIT[WAR.Person[j]["人物编号"]] or 0)-5*dj,0,200)
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字3", "天威浩荡")
			end	
		end
		
		if MPTX(pid,16) then  --全真
			WAR.PD["集气速度"][pid] = (WAR.PD["集气速度"][pid] or 0) + math.random(1,3)
			WAR.PD['内伤恢复'][pid] = (WAR.PD["内伤恢复"][pid] or 0) + math.random(1,3)
			WAR.PD['流血恢复'][pid] = (WAR.PD["流血恢复"][pid] or 0) + math.random(1,3)
			--全真
			if MPTX(pid,16,3) and Curr_NG(pid,100) then
				local a = 0
				local c = 0
				if JY.Person[pid]["内力"] > 3000 then
					c = limitX(math.modf((JY.Person[pid]["内力"]-3000)/40),0,30)
				end
				if JY.Person[pid]["内力"] > 1000 then
					a = limitX(math.modf((JY.Person[pid]["内力"]-1000)/2),0,50)
				end
				if JLSD(0,a,pid) and WAR.LMBJ9 == 0 then 
					if JLSD(0,c,pid) then
						WAR.ATNum = WAR.ATNum + 3
					else
						WAR.PD['必连击'][pid] = 3
					end
					WAR.LMBJ9 = 1
				end
				Set_Eff_Text(WAR.CurID, "特效文字3","紫阳剑罡・气化三清")	
			end
			--全真2级弟子主运金关
			if MPTX(pid,16,2) and Curr_NG(pid,249) and yongquan(wugong) and JLSD(20,50,pid) then
				ztd(WAR.CurID, "生命点数", 300)
				ztd(WAR.CurID, "内力点数", 600)
				ztd(WAR.CurID, "体力点数", 3)
				Set_Eff_Text(WAR.CurID, "特效文字3","金关玉锁・任督自转")	
			end	
			if MPTX(pid,16,3) and Curr_NG(pid,100) and JLSD(10,40,pid) then
				local a = 1
				local b = 1
				local c = 1
				a = dj * (JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"]) / 30
				b = dj * (JY.Person[pid]["内力最大值"] - JY.Person[pid]["内力"]) / 30
				c = dj * WAR.ACT
				ztd(WAR.CurID,"生命点数",a)
				ztd(WAR.CurID,"内力点数",b)
				ztd(WAR.CurID,"中毒点数",-c)
				ztd(WAR.CurID,"内伤点数",-c)
				ztd(WAR.CurID,WAR.LXXS,-c)
				CurIDTXDH(WAR.CurID,109, 1, "先天真气调息");
			end		
		end
		if MPTX(pid,17) then  --峨眉	
			--峨眉鼓舞士气
			for j = 0, WAR.PersonNum - 1 do 
				local aa = WAR.Person[j]["人物编号"]
				local cc = 0
				if MPTX(aa,17) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					local bb = 0
					cc = (math.max(bb,100) - 100) / 250
					if cc > 0.5 then
						cc = 0.5
					end
				end
				WAR.PD['峨眉士气'][pid] = cc
			end
			--峨眉2级
			if (MPTX(pid,17,2) and Curr_NG(pid,247) and JLSD(10,45,pid)) or ((match_ID(pid,626) or match_ID(pid,455)) and JLSD(10,60,pid)) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						WAR.PD["盲目状态"][WAR.Person[j]["人物编号"]] = 2
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字2", "玉女丹青・西子洗面")
			end
			--峨眉2级峨眉九阳
			if (MPTX(pid,17,2) and PersonKF(pid,242) and JLSD(20,50,pid)) or (match_ID(pid,626) and JLSD(20,60,pid)) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						if nokillspeed(j) == false then
							ztd(j,'集气位置',-50)
						end	
						ztd(j,WAR.LXXS,math.random(30,50))
					end
				end
			end
			--峨眉2级峨眉九阳
			if (MPTX(pid,17,2) and PersonKF(pid,242) and JLSD(20,50,pid)) then
				ztd(WAR.CurID,"生命点数",300)
				ztd(WAR.CurID,"内力点数",700)
				ztd(WAR.CurID,"内伤点数",-20)
				ztd(WAR.CurID,"中毒点数",-20)
			end
			--峨眉3级
			if MPTX(pid,17,3) and Curr_NG(pid,247) and PersonKF(pid,242) then 
				local str= ""
				local a = math.random(1,4)
				if a == 1 then	
					str = "・东方七宿"
					for j = 0, WAR.PersonNum - 1 do 
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local p = WAR.Person[j]["人物编号"]
							WAR.PD['利刃寒锋'][p] = 20
							WAR.PD['迟缓状态'][p] = (WAR.PD['迟缓状态'][p] or 0) + math.random(10)
						end
					end
				elseif a == 2 then	
					str = "・南方七宿"
					for j = 0, WAR.PersonNum - 1 do 
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local p = WAR.Person[j]["人物编号"]
							WAR.PD['锁足状态'][p] = 1
							WAR.PD['迟缓状态'][p] = (WAR.PD['迟缓状态'][p] or 0) + math.random(10)
						end
					end
				elseif a == 3 then	
					str = "・西方七宿"
					for j = 0, WAR.PersonNum - 1 do 
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local p = WAR.Person[j]["人物编号"]
							WAR.PD['混乱状态'][p] = 1
							WAR.PD['迟缓状态'][p] = (WAR.PD['迟缓状态'][p] or 0) + math.random(10)
						end
					end
				elseif a == 4 then	
					str = "・北方七宿"
					for j = 0, WAR.PersonNum - 1 do 
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local p = WAR.Person[j]["人物编号"]
							WAR.PD['恐惧状态'][p] = 1
							WAR.PD['迟缓状态'][p] = (WAR.PD['迟缓状态'][p] or 0) + math.random(10)
						end
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字1","二十八星宿大阵"..str)				
			end
			--峨眉3级
			if (MPTX(pid,17,2) and Curr_NG(pid,247) and JLSD(10,40,pid)) or ((match_ID(pid,626) or match_ID(pid,455)) and JLSD(10,60,pid)) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						if nokillspeed(j) == false then
							ztd(j,'集气位置',-100)
						end	
						ztd(j,WAR.LXXS,math.random(30,50))
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字3", "玉女丹青・索女掸尘")  
			end
			--峨眉3级
			if (MPTX(pid,17,3) and Curr_NG(pid,247) and JLSD(10,45,pid)) or ((match_ID(pid,626) or match_ID(pid,455)) and JLSD(10,60,pid)) then
				WAR.PD['全屏攻击'][pid] = 1
				Set_Eff_Text(WAR.CurID, "特效文字1", "玉女丹青・文姬挥笔") 
			end
		end
		
		if MPTX(pid,18) then  --崆峒
			if WAR.KTAY1 == 1 then
				Set_Eff_Text(WAR.CurID, "特效文字2", "崆峒秘法・分光两仪")
			end	
			--崆峒3级	
			if MPTX(pid,18,3) and JLSD(20,60,pid) then 	
				local zq = math.modf(TrueQZ(pid) / 120)
				if (WAR.PD['极意攻击'][pid] or 0) < zq then 
					WAR.PD['极意攻击'][pid] = zq
				end
				Set_Eff_Text(WAR.CurID, "特效文字3", "三焦齐逆魂飞扬")
			  end
			--崆峒3级
			if MPTX(pid,18,3) and JLSD(20,60,pid) then
				local a = TrueQZ(pid)
				ztd(WAR.CurID,"生命点数",a)
				ztd(WAR.CurID,"内力点数",a)
				ztd(WAR.CurID,"体力点数",3)
				CurIDTXDH(WAR.CurID, 51, 1, "上清秘气");
			end
		end
		
		if MPTX(pid,19) then  --昆仑
			
		end

		if MPTX(pid,20) and (not match_ID(pid,514)) then  --雪羽宗
			local jl = 40
			if BNJQ(pid) then
				jl = jl + 10
			end	
			if dj >= 3 then
				if WAR.PD['回气'][pid] == nil then
					WAR.PD['回气'][pid] = (WAR.PD['回气'][pid] or 0) + math.modf(WAR.ACT * 10)
				end
			end	
			if dj >= 4 and JLSD(10,40,pid) then
				for j = 0 , WAR.PersonNum-1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						WAR.PD['冰冻状态'][WAR.Person[j]["人物编号"]] = (WAR.PD['冰冻状态'][WAR.Person[j]["人物编号"]] or 0) + 10
					end
				end
			end	
			if (yongquan(wugong) or yongdao(wugong)) and Curr_NG(pid,43) and JLSD(30,70,pid) then
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false then
						if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if WAR.PD['雪羽冰封'][tmppid] == nil then
								WAR.PD['雪羽冰封'][tmppid] = 1
								Set_Eff_Text(WAR.CurID,1,"风嚎雪吼・玄动沧溟")
							end
							if WAR.PD['玄冰不化'][tmppid] == nil then
								WAR.PD['玄冰不化'][tmppid] = 5
							end
						else
							WAR.PD['雪羽冰封'][tmppid] = 1
						end
					end
				end
			end
			if wugong == 153 and Curr_NG(pid,43) and JLSD(0,jl,pid) then
				local a = math.random(3)
				local str = ""
				if a == 1 then
					WAR.YSCM1 = 1
					str = "不见归人・百战无前不念身还"
					for h = 0, WAR.PersonNum-1 do 
						if WAR.Person[h]["死亡"] == false and DWPD(WAR.CurID,h) then
							nuqi(pid,math.random(10,20))
							ztd(h,"集气位置",-200)
						end
					end	
				elseif a == 2 then
					WAR.YSCM2 = 1
					str = "不识归途・千军破阵不寻路返"
					for h = 0, WAR.PersonNum-1 do 
						if WAR.Person[h]["死亡"] == false and DWPD(WAR.CurID,h) then
							WAR.PD['脆弱状态'][WAR.Person[h]["人物编号"]] = math.random(2,5)
							ztd(h,"内力点数",-500)
						end
					end	
				elseif a == 3 then
					WAR.YSCM3 = 1
					WAR.BJ = 1
					WAR.ATNum = limitX(WAR.ATNum + 1,1,9)
					str = "不知归处・万里征战不望故土"
					for h = 0, WAR.PersonNum-1 do 
						if WAR.Person[h]["死亡"] == false and DWPD(WAR.CurID,h) then
							ztd(h,"生命点数",-300)
						end
					end
				end
				Set_Eff_Text(WAR.CurID,1,str,80)	
			end	
		end
		if MPTX(pid,21) then  --花涧派
			if WAR.PD["集气速度"][pid] == nil then
				WAR.PD["集气速度"][pid] = 5
			end
			--花涧基础攻击
			if JLSD(20,50,pid) then
				ztd(WAR.CurID,WAR.FXXS,-10)
				ztd(WAR.CurID,WAR.BFXS,-10)
				ztd(WAR.CurID,WAR.ZSXS,-10)
				ztd(WAR.CurID,WAR.LXXS,-10)
				ztd(WAR.CurID,"内伤点数",-10)
				ztd(WAR.CurID,"中毒点数",-10)
				Set_Eff_Text(WAR.CurID, "特效文字3", "春山烟欲收・天澹星低小")
			end 
			--花涧基础攻击
			if JLSD(20,50,pid) then
				local a = JY.Person[pid]["受伤程度"]
				local b = JY.Person[pid]["中毒程度"]
				local c = JY.Person[pid]["冰封程度"]
				local d = JY.Person[pid]["灼烧程度"]
				local e = JY.Person[pid]["封穴程度"]
				local f = JY.Person[pid]["流血程度"]
				local g = a + b + c + d + e + f
				ztd(WAR.CurID,"生命点数",g)
				Set_Eff_Text(WAR.CurID, "特效文字3", "残月脸边明・别泪临清晓")
			end
			--花涧2级攻击
			if MPTX(pid,21,2) and JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local tmppid = WAR.Person[j]["人物编号"]
						local a = JY.Person[tmppid]["受伤程度"]
						ztd(j,"内伤点数",math.random(30,50))
						ztd(j,'内力点数',-(a * 10))
						ztd(j,'体力点数',-7)
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字2", "折花百式")
			end
			if MPTX(pid,21,2) and JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local tmppid = WAR.Person[j]["人物编号"]
						WAR.PD['昏迷状态'][tmppid] = 1
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字2", "红豆不堪看・满眼相思泪")
			end
			--花涧派3级攻击
			if MPTX(pid,21,3) and JLSD(20,50,pid) then	
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local tmppid = WAR.Person[j]["人物编号"]
						WAR.PD['利刃寒锋'][tmppid] = 20
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字2", "藕花相向野塘中・翠华一去寂无踪")	
			end
		end
		if MPTX(pid,22) then  --中华阁
			if MPTX(pid,22,2) and JLSD(20,50,pid) then 
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local id = WAR.Person[j]["人物编号"]
						local a = math.modf(Atk(WAR.CurID)/8)
						local b = JY.Person[id]["受伤程度"]
						local c = math.modf((a+b)/5)+100
						ztd(j,'生命点数',-c)
						JY.Person[id]["生命"] = JY.Person[id]["生命"] - c
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字2", "庖丁解牛・斩")
			end
			if MPTX(pid,22,3) and JLSD(20,50,pid) then
				if WAR.ATNum < 4 then
					WAR.ATNum = 4
				else
					WAR.ATNum = WAR.ATNum + 1
				end
				for j = 0, WAR.PersonNum-1 do 
					local df = WAR.Person[j]["人物编号"]
					if dead(j) == false and DWPD(WAR.CurID,j) then
						local a = math.modf((JY.Person[pid]["内力"]+JY.Person[df]["内力"])/20)
						if RealJL(WAR.CurID,j,8) then
							a = a + JY.Person[df]["受伤程度"]+JY.Person[df]["冰封程度"]+JY.Person[df]["灼烧程度"]+JY.Person[df]["封穴程度"]+JY.Person[df]["中毒程度"]+JY.Person[df]["流血程度"]
						end
						ztd(j,'生命点数',-a)
					end
					Set_Eff_Text(WAR.CurID, "特效文字2", "账房要诀・满打满算")
				end	
			end
			--中华阁4级
			if MPTX(pid,22,4) and JLSD(20,50,pid) then     
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						ztd(j,"内力点数",-300)
						ztd(j,"生命点数",-100)
					end
				end
			end
		end
		if MPTX(pid,23) then  --朝廷
			WAR.PD['集气速度'][pid] = (WAR.PD['集气速度'][pid] or 0) + 2
			WAR.PD['流血恢复'][pid] = 4
			WAR.PD['内伤恢复'][pid] = 4
			WAR.PD['增加气攻'][pid] = dj*100
			if MPTX(pid,23,4) and Curr_NG(pid,199) and PersonKF(pid,200) and yongte(wugong) then
				local str = ""
				if WAR.LBPM >= 3 then
					str = "兵势"
					WAR.CTWM1 = 1
				end
				if WAR.LBPM >= 5 then
					str = "用间"
					WAR.CTWM2 = 1
				end
				if WAR.LBPM >= 7 then
					str = "虚实"
					WAR.CTWM3 = 1
				end
				if WAR.LBPM >= 9 then
					str = "九变"
					WAR.CTWM4 = 1
					if math.random(6) < 4 then
						WAR.CTWM5 = 1
						WAR.YQHS = 1
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字1","金戈铁马"..str)	
			end
		end
		if MPTX(pid,24) then --夜雨楼
			if match_ID(pid,517) then
				dj = 5
			end
			if match_ID(pid,750) or match_ID(pid,526) then
				dj = 4
			end		
			if (Cat('背刺侧攻') == 2 and JLSD(10,55,pid)) or (Cat('背刺侧攻') == 1 and JLSD(10,35,pid)) then
				for j = 0 , WAR.PersonNum-1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						ztd(j,WAR.LXXS,math.random(10,50))
						WAR.PD['创伤'][WAR.Person[j]["人物编号"]] = (WAR.PD['创伤'][WAR.Person[j]["人物编号"]] or 0) + math.random(10,25)
						ztd(j,'生命点数',-math.modf(psx(WAR.Person[j]['人物编号'],'流血程度')*3))
						WAR.Person[j]['特效动画'] = 48
					end
				end	
			end
			--门派主运攻击特效 小无相 极阴无相
			if match_ID(pid,527) and Curr_NG(pid,367) and wugong == 26 then
				if WAR.ATNum < 5 then
					WAR.ATNum = 5
				end
				for tx = 1, dj do
					if JLSD(10,math.modf(dj*13)+15,pid)  then
						WAR.PD['无常索命诀'][pid][tx] = 1
					end
				end
				if WAR.ACT == 1 then
					for k = 0,WAR.PersonNum-1 do
						if WAR.Person[k]['死亡'] == false and DWPD(WAR.CurID,k) then
							local kid = WAR.Person[k]['人物编号']
							if WAR.PD['魂无常'][kid] ~= nil then
								ztd(k,'生命点数',-WAR.PD['魂无常'][kid])
								WAR.PD['魂无常'][kid] = nil
							end
						end
					end
				end
			end
			if Curr_NG(pid,367) and (yongjian(wugong) or yongte(wugong)) then
				if WAR.ATNum < 4 then
					WAR.ATNum = 4
				end	
				for tx = 1, dj do
					if JLSD(10,math.modf(dj*13)+15,pid) or match_ID(pid,517) then
						WAR.PD['血衣剑法'][pid][tx] = 1
					end
				end
				for tx = 1, dj do
					if JLSD(10,math.modf(dj*13)+15,pid) or match_ID(pid,517) then
						WAR.PD['无常索命诀'][pid][tx] = 1
					end
				end
				if WAR.ACT == 1 then
					for k = 0,WAR.PersonNum-1 do
						if WAR.Person[k]['死亡'] == false and DWPD(WAR.CurID,k) then
							local kid = WAR.Person[k]['人物编号']
							if WAR.PD['魂无常'][kid] ~= nil then
								ztd(k,'生命点数',-WAR.PD['魂无常'][kid])
								WAR.PD['魂无常'][kid] = nil
							end
						end
					end
				end	
			elseif Curr_NG(pid,98) then
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
				if yongjian(wugong) then
					for tx = 1, dj do
						if JLSD(10,math.modf(dj*10)+15,pid) or match_ID(pid,517) then
							WAR.PD['血衣剑法'][pid][tx] = 1
						end
					end
				elseif yongte(wugong) then
					for tx = 1, dj do
						if JLSD(10,math.modf(dj*10)+15,pid) or match_ID(pid,517) then
							WAR.PD['无常索命诀'][pid][tx] = 1
						end
					end
					if WAR.ACT == 1 then
						for k = 0,WAR.PersonNum-1 do
							if WAR.Person[k]['死亡'] == false and DWPD(WAR.CurID,k) then
								local kid = WAR.Person[k]['人物编号']
								if WAR.PD['魂无常'][kid] ~= nil then
									ztd(k,'生命点数',-WAR.PD['魂无常'][kid])
									WAR.PD['魂无常'][kid] = nil
								end
							end
						end
					end
				else
				end
			else	
			end	
			if WAR.PD['血衣剑法'][pid][1] == 1 then 
				WAR.PD['血衣剑法1'][pid] = 1
			end	
			if WAR.PD['血衣剑法'][pid][3] == 1 then
				for k = 0,WAR.PersonNum-1 do
					if WAR.Person[k]['死亡'] == false and DWPD(WAR.CurID,k) then
						local kid = WAR.Person[k]['人物编号']
						ztd(k,WAR.LXXS,dj*7)
						WAR.PD['创伤'][kid] = limitX((WAR.PD['创伤'][kid] or 0) + math.random(5,20),0,30)
						WAR.PD['血流不止'][kid] = 20
						ztd(k,WAR.FXXS,2)
						ztd(k,'生命点数',-math.modf(psx(kid,'流血程度')*5))
					end
				end
			end	
			if WAR.PD['血衣剑法'][pid][5] == 1 then 
				WAR.PD['血衣剑法5'][pid] = 1
				if (WAR.PD['极意攻击'][pid] or 0) < 12 then
					WAR.PD['极意攻击'][pid] = 12
				end
				ng = ng + 1200	 
			end
			if WAR.PD['无常索命诀'][pid][4] == 1 then
				WAR.PD['无常索命诀4'][pid] = 1
			end	
			if WAR.PD['无常索命诀'][pid][5] == 1 then
				WAR.PD['无常索命诀5'][pid] = 1
			end	
			WarDrawMap(0)
			if WAR.PD['血衣剑法'][pid] ~= nil then
				if #WAR.PD['血衣剑法'][pid] > 1 then
					local str = {'一','二','三','四','五'}
					CurIDTXDH(WAR.CurID,124,1,'血衣剑法・'..str[#WAR.PD['血衣剑法'][pid]]..'剑合一')
				else
					local str = {'杜鹃啼血','血袍艳花','凝血封江','枯血泣魂','极乐血海'}
					for l = 1,5 do
						if WAR.PD['血衣剑法'][pid][l] == 1 then
							CurIDTXDH(WAR.CurID,124,1,'血衣剑法・'..str[l])
							break
						end
					end
				end
			end
			if WAR.PD['无常索命诀'][pid] ~= nil then
				if #WAR.PD['无常索命诀'][pid] > 1 then
					local str = {'一','二','三','四','五'}
					CurIDTXDH(WAR.CurID,123,1,'无常索命诀・'..str[#WAR.PD['无常索命诀'][pid]]..'诀合一')
				else
					local str = {'白无常','黑无常','性无常','魂无常','命无常'}
					for l = 1,5 do
						if WAR.PD['无常索命诀'][pid][l] == 1 then
							CurIDTXDH(WAR.CurID,123,1,'无常索命诀・'..str[l])
							break
						end
					end
				end
			end
		end
		if MPTX(pid,25) then --护龙山庄
			--密探剑法
			if (MPTX(pid,25,3) and Curr_NG(pid,365)) or match_ID(pid,748) then
				if yongjian(wugong) and JLSD(20,50,pid) then
					WAR.ATNum = WAR.ATNum + 1
				end
			end
			if (MPTX(pid,25,3) and Curr_NG(pid,365)) or match_ID(pid,748) then
				if yongdao(wugong) and WAR.ACT <= 3 then
					local a = math.modf((JY.Person[pid]["生命最大值"]-JY.Person[pid]["生命"])*0.06+333)
					local zy = (WAR.SPIRIT[pid] or 1)/150
					ztd(WAR.CurID,'生命点数',-JY.Person[pid]["生命最大值"]/10)
					for j = 0, WAR.PersonNum - 1 do
						if dead(j) == false and DWPD(WAR.CurID,j) then
							if nokillspeed(j) == false then
								ztd(j,'集气位置',-300*zy*WAR.ACT)
							end
							ztd(j,'生命点数',-a*zy*WAR.ACT)
						end
					end
					Set_Eff_Text(WAR.CurID,"特效文字3", "雄霸天下・阿鼻祖三刀")
				end	
			end	
			--军师
			if MPTX(pid,25,4) and Curr_NG(pid,366) and JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do
					local p = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						WAR.PD["护龙军师"][p] = 5
					end
				end
				Set_Eff_Text(WAR.CurID,"特效文字2", "五行风云变")	
			end
		end
		if MPTX(pid,26) then --云梦
			for j = 0, WAR.PersonNum -1 do
				local tp = WAR.Person[j]["人物编号"];
				if DWPD(WAR.CurID,j) == false and dead(j) == false then
					ztd(j,'内伤点数',-JY.Person[tp]["受伤程度"])
					ztd(j,'中毒点数',-JY.Person[tp]["中毒程度"])
					ztd(j,WAR.BFXS,-JY.Person[tp]["冰封程度"])
					ztd(j,WAR.ZSXS,-JY.Person[tp]["灼烧程度"])
					ztd(j,WAR.FXXS,-JY.Person[tp]["封穴程度"])
					ztd(j,WAR.LXXS,-JY.Person[tp]["流血程度"])
				end
			end
			--2级弟子				
			if MPTX(pid,26,2) and yongte(wugong) then	
				if JLSD(20,50,pid) then
					local a = JY.Person[pid]["特殊兵器"]
					for j = 0, WAR.PersonNum-1 do 
						local df = WAR.Person[j]["人物编号"]
						if dead(j) == false and DWPD(WAR.CurID,j) then
							local b = JY.Person[df]["特殊兵器"]
							if RealJL(WAR.CurID,j,8) then
								ztd(j,'生命点数',-a)
								ztd(j,'生命点数',-b)
							end
						end
					end
					Set_Eff_Text(WAR.CurID,"特效文字3","其神若何・月射寒江")
				end
			end
			--3级弟子
			if MPTX(pid,26,3) and (yongte(wugong) or match_ID(pid,455)) then
				if JLSD(20,50,pid) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local p = WAR.Person[j]["人物编号"]
							WAR.PD["盲目状态"][p] = 2
							WAR.PD['寒毒入体'][p] = 1
						end
					end
					Set_Eff_Text(WAR.CurID, "特效文字2", "芙蓉不及美人妆・水殿风来珠翠香")
				end
				if JLSD(20,50,pid) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							local p = WAR.Person[j]["人物编号"]
							addbuff(p,WAR.PD['灵蛇拳'],10,15)
							WAR.PD['五蕴炽盛'][p] = 1
						end
					end
					Set_Eff_Text(WAR.CurID, "特效文字2", "俏丽若三春之桃・清素若九秋之菊")
				end
				if JLSD(20,50,pid) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
							local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
							local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
							if offset1 <= 12 and offset2 <= 12 then
								ztd(i,'集气位置',-100)
							end	
						end	
					end
					Set_Eff_Text(WAR.CurID, "特效文字2", "眉梢眼角藏秀气・声音笑貌露温柔")
				end
			end
			--4级弟子				
			if MPTX(pid,26,4) and (yongte(wugong) or match_ID(pid,455)) and JLSD(20,50,pid) then 
				for j = 0, WAR.PersonNum - 1 do
					local p = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						WAR.PD["云梦涧4"][p] = 30
					end
				end	
				Set_Eff_Text(WAR.CurID, "特效文字1", "共道幽香闻十里・绝知芳誉亘千乡")
			end	
		end
		if MPTX(pid,27) then --兽王庄
			local jl = 5*dj + math.modf(Atk(WAR.CurID)/25)
			if JLSD(0,jl,pid) then
				War_ActupMenu()
				Set_Eff_Text(WAR.CurID, "特效文字0","虎痴")
			end
			if WAR.ATNum < 3 then 
				WAR.ATNum = 3
			end
			--2级弟子
			if MPTX(pid,27,2) and yongquan(wugong) then
				WAR.PD['增加气攻'][pid] = dj*200
			end
			if MPTX(pid,27,2) and yongdao(wugong) then
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
						local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
						if offset1 <= 8 and offset2 <= 8 then
							WAR.PD['创伤'][WAR.Person[i]["人物编号"]] = (WAR.PD['创伤'][WAR.Person[i]["人物编号"]] or 0) + math.random(20,30)
						end	
					end	
				end
			end
			--3级弟子
			if MPTX(pid,27,3) and yongdao(wugong) then
				local a = math.random(4)
				local str = ""
				if a == 1 then 
					local x1 = WAR.Person[WAR.CurID]["坐标X"];
					local y1 = WAR.Person[WAR.CurID]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								if DWPD(WAR.CurID,ep) and dead(ep) == false then
									WAR.PD['迟缓状态'][ep] = (WAR.PD['迟缓状态'][ep] or 0) + math.random(15)
									SetWarMap(ex, ey, 4, 4)	
								end 
							end
						end
					end
					Set_Eff_Text(WAR.CurID,2,"凶兽斗气・毕方烈焰") 
				elseif a == 2 then 	
					local x1 = WAR.Person[WAR.CurID]["坐标X"];
					local y1 = WAR.Person[WAR.CurID]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								if DWPD(WAR.CurID,ep) and dead(ep) == false then
									WAR.PD["脆弱状态"][ep]= (WAR.PD['脆弱状态'][ep] or 0) + math.random(3,5)
									SetWarMap(ex, ey, 4, 4)	
								end 
							end
						end
					end
					Set_Eff_Text(WAR.CurID,2,"凶兽斗气・杌气浪")
				elseif a == 3 then 
					local x1 = WAR.Person[WAR.CurID]["坐标X"];
					local y1 = WAR.Person[WAR.CurID]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								if DWPD(WAR.CurID,ep) and dead(ep) == false then
									WAR.PD["恐惧状态"][WAR.Person[ep]["人物编号"]] = 1;
									SetWarMap(ex, ey, 4, 4)	
								end 
							end
						end
					end
					Set_Eff_Text(WAR.CurID,2,"凶兽斗气・相柳寒毒")		
				elseif a == 4 then 	
					local x1 = WAR.Person[WAR.CurID]["坐标X"];
					local y1 = WAR.Person[WAR.CurID]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								if DWPD(WAR.CurID,ep) and dead(ep) == false then
									WAR.PD["混乱状态"][WAR.Person[ep]["人物编号"]] = 1;
									SetWarMap(ex, ey, 4, 4)	
								end 
							end
						end
					end
					Set_Eff_Text(WAR.CurID,2,"凶兽斗气・金鹏流光")		
				end	
			end
		end
		--青城
		if MPTX(pid,28) then
			if JLSD(20,50,pid) then
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
			end	 
			if JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						if nokillspeed(j) == false then
							ztd(j,'集气位置',-100)
						end
						ztd(j,'内伤点数',20)
						ztd(j,WAR.BFXS,20)
					end	
				end 	
			end
			--2级弟子	
			if MPTX(pid,28,2) and yongquan(wugong) then 	
				ztd(WAR.CurID,"体力点数",4)
				CurIDTXDH(WAR.CurID, 71, 1, "枯木逢春");
				if JLSD(20,50,pid) then
					WAR.BJ = 1
					if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
						WAR.PD['极意攻击'][pid] = 7
					end
					Set_Eff_Text(WAR.CurID, "特效文字2", "天罡掌劲・无坚不摧")
				end
			end
			--3级弟子
			if MPTX(pid,28,3) and wugong == 27 and Curr_NG(pid,379) then
				local str= ""
				local a = math.random(1,4)
				for j = 0, WAR.PersonNum - 1 do 
					local p = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if a == 1 then
							str = "・龙吟"
							WAR.PD['利刃寒锋'][p] = 20
							WAR.PD['机率下降'][p] = 20
						elseif a == 2 then	
							str = "・虎啸"
							WAR.PD["刚柔混劲"][p] = 15
							WAR.PD['举火燎原'][p] = 15
						elseif a == 3 then	
							str = "・龙腾"
							WAR.PD['气阻中门'][p] = 10
							WAR.PD['虚弱状态'][p] = (WAR.PD['虚弱状态'][p] or 0) + 10
						elseif a == 4 then
							str = "・虎跃"
							WAR.PD['恐惧状态'][p] = 1
							WAR.PD['创伤'][p] = (WAR.PD['创伤'][p] or 0) + math.random(15,25)
						end
					end
				end
				Set_Eff_Text(WAR.CurID, "特效文字1","雌雄龙虎剑"..str)	
			end 
		end 		
		--五毒教
		if MPTX(pid,29)then
			if WAR.ACT == 1 then
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
			end
		end
		--天机宫
		if MPTX(pid,30) or match_ID(id,635) then
			--1级弟子
			if wugong == 58 then
			    if WAR.ATNum < 2 then
				    WAR.ATNum = 2
			    end
			end
			if wugong == 192 and JLSD(20,50,pid) then
				if (WAR.PD['极意攻击'][pid] or 0) < 8 then
					WAR.PD['极意攻击'][pid] = 8
				end
				ng = ng + 1250	 
			end 
			if wugong == 179 and JLSD(20,50,pid) then	 	 
				for j = 0, WAR.PersonNum - 1 do 
					local p = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then					
						WAR.PD['机率下降'][p] = 15
					end
				end
			end 	
			--2级弟子
			if MPTX(pid,30,2) and wugong == 58 and JLSD(20,50,pid) then 
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						if nokillspeed(j) == false then
							ztd(j,'集气位置',-250)
						end
						ztd(j,'内伤点数',100)
						ztd(j,WAR.LXXS,100)
					end	
				end 
			end 
			if MPTX(pid,30,2) and wugong == 192 and JLSD(20,50,pid) then 
				WAR.PD['全屏攻击'][pid] = 1		
			end 
			if MPTX(pid,30,2) and wugong == 179 and JLSD(20,50,pid) then	 	 
				for j = 0, WAR.PersonNum - 1 do 
					local p = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then					
						WAR.PD['寒毒入体'][p] = 1
					end
				end
			end 
		end 			
		--畋羽
		if match_ID(pid,514) then	
			local jl = 35
			if BNJQ(pid) then
				jl = 100
			end	
			if WAR.PD['回气'][pid] == nil then
				WAR.PD['回气'][pid] = (WAR.PD['回气'][pid] or 0) + math.modf(WAR.ACT * 10)
			end
			if (yongquan(wugong) or yongdao(wugong)) and Curr_NG(pid,43) then
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false then
						if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if WAR.PD['雪羽冰封'][tmppid] == nil then
								WAR.PD['雪羽冰封'][tmppid] = 1
								Set_Eff_Text(WAR.CurID,1,"风嚎雪吼・玄动沧溟")
							end
							if WAR.PD['玄冰不化'][tmppid] == nil then
								WAR.PD['玄冰不化'][tmppid] = 5
							end
						else
						    WAR.PD['雪羽冰封'][tmppid] = 1
						end
					end
				end
			end
			if JLSD(10,jl,pid) or WAR.PD['雪羽战神'][pid] == 1 then
				for j = 0 , WAR.PersonNum-1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						ztd(j,WAR.BFXS,15)
						WAR.PD['冰冻状态'][WAR.Person[j]["人物编号"]] = (WAR.PD['冰冻状态'][WAR.Person[j]["人物编号"]] or 0) + 10
						WAR.PD['冰冻扣血'][WAR.Person[j]["人物编号"]] = (WAR.PD['冰冻扣血'][WAR.Person[j]["人物编号"]] or 0) + 10
						if WAR.PD['冰冻状态'][WAR.Person[j]["人物编号"]] >= 30 then
							WAR.PD['真利刃寒锋'][WAR.Person[j]["人物编号"]] = (WAR.PD['真利刃寒锋'][WAR.Person[j]["人物编号"]] or 0) + 2
						end	
					end
				end
			end	
			local str = ""
			if (wugong == 153 and Curr_NG(pid,43) and JLSD(0,jl,pid)) or (wugong == 21 and Curr_NG(pid,43) and JLSD(0,jl+5,pid)) or WAR.PD['雪羽战神'][pid] == 1 then
				WAR.YSCM1 = 1
				str = str .. "・百战无前不念身还"
				for h = 0, WAR.PersonNum-1 do 
					if WAR.Person[h]["死亡"] == false and DWPD(WAR.CurID,h) then
						nuqi(pid,math.random(10,20))
						ztd(h,"集气位置",-300)
						if WAR.Person[h].Time < -300 then
							WAR.PD['虚弱状态'][WAR.Person[h]['人物编号']] = (WAR.PD['虚弱状态'][WAR.Person[h]['人物编号']] or 0) + 10
							if JLSD(10,30,pid) then
								WAR.PD['破军'][WAR.Person[h]['人物编号']] = 3
							end	
						end	
					end
				end	
			end	
			if (wugong == 153 and Curr_NG(pid,43) and JLSD(0,jl,pid)) or (wugong == 21 and Curr_NG(pid,43) and JLSD(0,jl+15,pid)) or WAR.PD['雪羽战神'][pid] == 1 then
				WAR.YSCM2 = 1
				str = str .. "・千军破阵不寻路返"
				for h = 0, WAR.PersonNum-1 do 
					if WAR.Person[h]["死亡"] == false and DWPD(WAR.CurID,h) then
						WAR.PD['脆弱状态'][WAR.Person[h]["人物编号"]] = math.random(3,5)
						ztd(h,"内力点数",-500)
						if JY.Person[WAR.Person[h]['人物编号']]['内力'] < 1000 then
							ztd(h,"体力点数",-5)
						end	
					end
				end	
			end	
			if ((wugong == 153 or wugong == 21) and Curr_NG(pid,43) and JLSD(0,jl,pid)) or WAR.PD['雪羽战神'][pid] == 1 then
				WAR.YSCM3 = 1
				WAR.BJ = 1
				WAR.ATNum = limitX(WAR.ATNum + 1,1,9)
				str = str .. "・万里征战不望故土"
				for h = 0, WAR.PersonNum-1 do 
					if WAR.Person[h]["死亡"] == false and DWPD(WAR.CurID,h) then
						ztd(h,"生命点数",-300)
						if BNJQ(pid) or WAR.PD['雪羽战神'][pid] == 1 then
							ztd(h,"生命点数",-300)
						end	
					end
				end
			end
			if str ~= "" then
				Set_Eff_Text(WAR.CurID,1,"不归三境"..str,80)
			end	
		end
		--醉八仙特效
		if WAR.ZBX > 0  then
			local z = WAR.ZBX
			if z == 1 then
				WAR.PD['全屏攻击'][pid] = 1 
			end	
			if z == 2 then
				for i = 0, WAR.PersonNum - 1 do 
					if DWPD(WAR.CurID,i) and dead(i) == false then
						ztd(i,'内伤点数',math.random(10,20))
					end
			    end
		    end
		    if z == 3 then
				for i = 0, WAR.PersonNum - 1 do 
					if DWPD(WAR.CurID,i) and dead(i) == false then
					    ztd(i,'集气位置',-50)
					end
				end
			end 
			if z == 4 then
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				else
				    WAR.ATNum = WAR.ATNum + 1
				end
			end
			if z == 5 then
				for i = 0, WAR.PersonNum - 1 do 
					local eid = WAR.Person[i]['人物编号']
					if DWPD(WAR.CurID,i) and dead(i) == false then
						WAR.PD['走火入魔'][eid] = 10
					end
			    end
		    end
			if z == 7 then
				for i = 0, WAR.PersonNum - 1 do 
					if DWPD(WAR.CurID,i) and dead(i) == false then
						ztd(i,WAR.FXXS,math.random(2,7))
					end
			    end
		    end
			if z == 8 then
				WAR.PD['时序闪避'][pid] = (WAR.PD['时序闪避'][pid] or 0) + 15
			end	
		end
		--敌人加强
		if inteam(pid) == false then 
			local nd = JY.Base['难度']
			local fj = 7 - JY.Person[pid]["畅想分阶"]
			ng = ng + nd * fj * 50
	    end
		----------------轻功加强的攻击特效-----------------------
		--主运天罗地网，减少敌方移动
        if Curr_QG(pid,148) then
			Set_Eff_Text(id,"特效文字1","柔网势");
        end
		--黯影迷踪
		if Curr_QG(pid,195) and WAR.PD['时序闪避'][pid] ~= nil then
			if QGQH(pid,195,2) then
				WAR.PD['必命中'][pid] = 1
				WAR.PD['负面状态'][pid] = 1
				if QGQH(pid,195,1) and WAR.ACT == 1 then
					WAR.PD['神兵'][pid] = limitX((WAR.PD['神兵'][pid] or 0) +15,0,30)
				end
				if TFQG(pid,195) and (WAR.LQZ[pid] or 0) < 100 and JLSD(10,45,pid) and WAR.ACT == 1 then
					nuqi(pid,30)
				end	
			end	
		end
		--金雁功 标记修改
		if Curr_QG(pid,223) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 777
			WAR.Person[id]["特效动画"] = 23
            Set_Eff_Text(id,"特效文字2","七星真气");
		end
		--君子风
		if QGQH(pid,262,2) and yongjian(wugong) then
			local a = math.modf(psx(pid,"品德")*0.06)
			local b = math.modf(psx(pid,"品德")*0.3)
			if TFQG(pid,262) then
				a = a + 2
				b = b * 2
			end
			if a < 5 then a = 5 end
			if JLSD(10,b,pid) then
				ng = ng + 1000
				WAR.WS = 1	
				WAR.PD['天香续命'][pid] = limitX((WAR.PD['天香续命'][pid] or 0) + 20,0,100)
				WAR.PD['五宝花蜜酒'][pid] = limitX((WAR.PD['五宝花蜜酒'][pid] or 0) + 20,0,100)
				if (WAR.PD['极意攻击'][pid] or 0) < a then
					WAR.PD['极意攻击'][pid] = a
				end	
				Set_Eff_Text(WAR.CurID,1,"君子风・治国平世")
			end
		end
		--风吟步
		if Curr_QG(pid,300) then
			if WAR.ACT == 1 then
				local a = limitX(WAR.LBPM,0,50)
				nuqi(pid,a)
				zhanyi(pid,a)
				Set_Eff_Text(WAR.CurID,3,'风吟・疾风狂舞')
			end
			if QGQH(pid,300,2) then
				local jl = WAR.JQSDXS[pid] or 0
				if jl > 50 then jl = 50 end
				if JLSD(0,jl,pid) and WAR.PD['降龙・双龙取水'][pid] == nil then
					WAR.PD['降龙・双龙取水'][pid] = 1
					Set_Eff_Text(WAR.CurID,1,'风吟・踏风行歌')
				end	
			end	
		end
		-----------------------外功加强的杀集气特效----------------------
		--天赋外功提高100点气攻
		if Given_WG(pid, wugong) then
			ng = ng + 100
		end
		--玄寒毒爆气攻增加1000
		if (wugong == 3 or wugong == 21) and XHDB(pid) then
	       ng = ng + 1000
	    end
		--玄冥极意，主角有40%几率触发，暴怒必出，玄冥二老必出
		if wugong == 21 and level == 11 then
			local xmjy = 0
			if match_ID(pid,647) or match_ID(pid,648) or match_ID(pid,523) then
				xmjy = 1
			elseif BNJQ(pid) or JLSD(30,70,pid) then
			    xmjy = 1
			end
			if xmjy == 1 then
				Set_Eff_Text(WAR.CurID, "特效文字1", "玄冥极意")
				ng = ng + 1000
				WAR.WS = 1
				TXWZXS("『玄冥神掌・寒阴侵体』", M_DeepSkyBlue)
				if (WAR.PD['极意攻击'][pid] or 0) < 5 then
					WAR.PD['极意攻击'][pid] = 5
				end
			end
		end
		--六龙回天,使用降龙十八掌
		if wugong == 26 then
			local xljl = 0
			if match_ID(pid,50) then
				WAR.Person[id]["特效动画"] = 384
				Set_Eff_Text(id, "特效文字2", "赤血战龙")
			elseif match_ID(pid,55) then
			    WAR.Person[id]["特效动画"] = 387
				Set_Eff_Text(id, "特效文字2", "不羁海龙")
			elseif match_ID(pid,49) then
			    WAR.Person[id]["特效动画"] = 388
				Set_Eff_Text(id, "特效文字2", "荒天幻龙")
			elseif match_ID(pid,527) then
			    WAR.Person[id]["特效动画"] = 389
				Set_Eff_Text(id, "特效文字2", "梦幻天龙")
			elseif match_ID(pid,69) then
			    WAR.Person[id]["特效动画"] = 390
				Set_Eff_Text(id, "特效文字2", "阴阳双龙")
			end
			if PersonKF(pid,204) then
				xljl = 5
				if Curr_NG(pid,204) then
					xljl = xljl + 15
				end	
			end
			--乔峰必出极意，洪七公，郭靖，拳主角40% 擒龙功15%
			if match_ID(pid, 69) or match_ID(pid, 55) or actor(pid,1) then
				xljl = xljl + 40
			end
			if JLSD(30,30 + xljl,pid) or match_ID(pid, 50) then
				TXWZXS(XL18JY[math.random(8)],M_DeepSkyBlue)
				ng = ng + 1000
				if (WAR.PD['极意攻击'][pid] or 0) < ((level) / 2 + 1) then
					WAR.PD['极意攻击'][pid] = ((level) / 2 + 1)
				end	
			end 
		end
		--双剑合壁，连击文字
        if WGZH(pid,39,42) and (wugong == 39 or wugong == 42 or wugong == 139)  then
            Set_Eff_Text(id, "特效文字3", SJHBJFZS[math.random(10)])		 
            ng = ng + 800
            WAR.WS = 1
        end
		--般若金刚
		if wugong == 189 and WAR.PD["金刚萨"][pid] ~= nil then
			ng = ng + 1000
            WAR.WS = 1
            if (WAR.PD['极意攻击'][pid] or 0) < (level) / 2 + 1 then 
				WAR.PD['极意攻击'][pid] = (level) / 2 + 1
			end
        end
		--罗汉拳，易筋经变身，般若掌，60%几率，敌方必出
        if wugong == 1 and PersonKF(pid, 108) then
            if JLSD(20, 80, pid) then
                WAR.LHQ_BNZ = 1
            end
        end
        --五毒神掌，李莫愁变赤练神掌 标记修改
		if wugong == 3 and (match_ID(pid,161) or match_ID(pid,9826) or PersonKF(pid,220)) then
			WAR.WD_CLSZ = 1
			if match_ID(pid, 161) or match_ID(pid, 9826) then
				local zs = {"问世间情是何物","直教人生死相许"}
				Set_Eff_Text(id, "特效文字3", zs[math.random(2)])
			end
			if (match_ID(pid, 161) or match_ID(pid, 9826) or Curr_NG(pid,154)) and JLSD(10,40,pid) then	
				local x1 = WAR.Person[WAR.CurID]["坐标X"];
				local y1 = WAR.Person[WAR.CurID]["坐标Y"];
				for ex = x1 - 8, x1 + 8 do
					for ey = y1 - 8, y1 + 8 do
						SetWarMap(ex, ey, 4, 1)
						if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
							local ep = GetWarMap(ex, ey, 2)
							if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then 
								ztd(ep,'中毒点数',math.random(10,15))
							end
						end
					end
				end
			end	
		end
		--铁掌组合
		if wugong == 13 and (PersonKF(pid,196) or match_ID(pid, 67) or match_ID(pid, 576)) then
			WAR.LTS = math.random(5)
			if WAR.NGJL > 0 then
				WAR.PD['炼铁劲'][pid] = (WAR.PD['炼铁劲'][pid] or 0 ) + math.random(100,200)
			end	
			local str = ""
			if WAR.LTS == 1 then
				str = "化金元诀"
			elseif WAR.LTS == 2 then
				str = "绝木烈罡"	
			elseif WAR.LTS == 3 then
				str = "灭水空焰"
			elseif WAR.LTS == 4 then
				WAR.JuHuo = 1
				str = "御火吞天"
			elseif WAR.LTS == 5 then
				str = "断土狂雷"
				WAR.PD['断土狂雷'][pid] = (WAR.PD['断土狂雷'][pid] or 0) + 1
			end	
			if (WAR.PD['炼铁劲'][pid] or 0 ) >= 700 or BNJQ(pid) then
				ng = ng + 1000
				if (WAR.PD['极意攻击'][pid] or 0) < 8 then
					WAR.PD['极意攻击'][pid] = 8
				end	
				TXWZXS("炼铁极意 焚海断天",M_Red)
			end
			Set_Eff_Text(WAR.CurID,2,str)
		end
		--太极拳，借力打力
        if Curr_NG(pid,171) and (wugong == 16 or wugong == 46) then
            if WAR.PD["太极蓄力"][pid] == nil then
                WAR.PD["太极蓄力"][pid] = 0
            elseif 0 < WAR.PD["太极蓄力"][pid] then
                Set_Eff_Text(id, "特效文字3", "借力打力")
                ng = ng + WAR.PD["太极蓄力"][pid]
            end
        end
		--玄寒毒爆
		if wugong == 21 and XHDB(pid) then
			WAR.XHDB = 1
			if PersonKF(pid,220) and JLSD(10,60,pid) then
				local x1 = WAR.Person[WAR.CurID]["坐标X"];
				local y1 = WAR.Person[WAR.CurID]["坐标Y"];
				local zd = JY.Person[pid]["冰封程度"] or 10
				local sm = JY.Person[pid]["中毒程度"] or 100
				for ex = x1 - 8, x1 + 8 do
					for ey = y1 - 8, y1 + 8 do
						SetWarMap(ex, ey, 4, 1)
						if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
							local ep = GetWarMap(ex, ey, 2)
							if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
								ztd(ep,'中毒点数',zd)
								ztd(ep,'生命点数',-sm) 
							end
						end
					end
				end
			end	
        end
        --大力金刚掌，易筋经变身，达摩掌，60%几率，敌方必出
        if wugong == 22 and PersonKF(pid, 108)  then
            if JLSD(40, 100, pid) then
                WAR.JGZ_DMZ = 1
            end
        end
		
		--辟邪招式4
		if WAR.BXZS == 5 then 
			ng = ng + 1200
			WAR.WS = 1
			if (WAR.PD['极意攻击'][pid] or 0) < 5 then
				WAR.PD['极意攻击'][pid] = 5
			end
		end	
		--九剑真传，荡剑式，攻击后回气+150
        if WAR.JJZC == 4  then
            WAR.JJDJ = 1
        end
		--狂风黄沙组合，攻击回气
        if (wugong == 55 or wugong == 78) and WGZH(pid,78,55) and JLSD(0,50,pid) then
            WAR.KFKJ = 1
            Set_Eff_Text(id, "特效文字3", "万里风沙")
        end
		--血刀大法
		if wugong == 63 and WAR.XDLX == 1 then
	        Set_Eff_Text(WAR.CurID, "特效文字1", "血刀门奥义")
            ng = ng + 500
            TXWZXS("『血刀门奥义・鲜血爆裂』", M_DeepSkyBlue)
            if (WAR.PD['极意攻击'][pid] or 0) < 5 then
				WAR.PD['极意攻击'][pid] = 5
			end	
        end
		--连环腐尸毒 标记修改
		if wugong == 295 and (match_ID(pid,46) or match_ID(pid,9902) or BNJQ(pid) or JLSD(30,70,pid)) then
			WAR.LHFSD = 1
			Set_Eff_Text(WAR.CurID, "特效文字1", "星宿海极意")
            ng = ng + 1000
            TXWZXS("『星宿海奥义・连环腐尸毒』", M_DeepSkyBlue)
            if (WAR.PD['极意攻击'][pid] or 0) < 5 then
				WAR.PD['极意攻击'][pid] = 5
			end	
        end
		--五岳剑法组合，50%几率额外气攻+1000，暴怒必发动，学有五岳剑诀必发动
        if ((wugong >= 30 and wugong <= 34) or wugong == 377) and (BNJQ(pid) or WYJJ(pid) or JLSD(20, WuyueJFSL(pid)*10+20, pid))then
            local qg = 500
            --学会五岳剑诀，气攻再加500，无视绝对气防
            if WYJJ(pid) then
                qg = qg + 500
                WAR.ZWYJF = 1
            end
            ng = ng + qg
			if WYXF(pid) then
				WAR.WYJF1 = 1
			end	
            Set_Eff_Text(id, "特效文字3", "气贯五岳")
        end
		--------------------------内功加强的杀集气-----------------------
		--鲸息功蓄力攻击，斗转不触发
	    if PersonKF(pid, 180) and WAR.DZXY == 0 then
	        if WAR.PD["鲸息蓄力"][pid] == nil then
	            WAR.PD["鲸息蓄力"][pid] = 0
	        elseif WAR.PD["鲸息蓄力"][pid] > 300 then
	            ng = ng + WAR.PD["鲸息蓄力"][pid]
	            Set_Eff_Text(id,2,'一空沧海式')
	            --梁萧提高伤害
	            if match_ID(pid, 635) then
	                WAR.LXXL = WAR.PD["鲸息蓄力"][pid]
	            end
	            WAR.Person[id]["特效动画"] = math.fmod(95, 10) + 85
	            --蓄力清0
	            WAR.PD["鲸息蓄力"][pid] = 0
	        end
	    end
        --蟾震九天，斗转不触发
        if PersonKF(pid, 95) and WAR.DZXY == 0 then
			local str = "蛤蟆神功奥义"
            if (WAR.PD["蛤蟆蓄力"][pid] or 0) > 500 then
                local str = "蟾震九天"
				ng = ng + math.modf(WAR.PD["蛤蟆蓄力"][pid] * 0.6) 
                --欧阳锋提高伤害
			elseif (match_ID(pid, 60) or match_ID(pid, 9857) or MPTX(pid,8)) and (WAR.PD["蛤蟆蓄力"][pid] or 0) > 300 then
				WAR.OYFXL = WAR.PD["蛤蟆蓄力"][pid] * 1.5
				ng = ng + WAR.PD["蛤蟆蓄力"][pid]
				str = str.."・玉蟾・蟾震九天"
				WAR.Person[id]["特效动画"] = 15
			end
			WAR.PD["蛤蟆蓄力"][pid] = 0
			Set_Eff_Text(id,3,str)
        end
		--------------------------人物、天赋杀集气-----------------	
		--论剑风清扬奖励
        if match_ID(pid,0) and (JY.Person[592]["论剑奖励"] == 1 or JY.Person[592]["论剑奖励"] == 2) then
        	ng = ng + 1000
        end
		--论剑打赢阿青
        if match_ID(pid,0) and JY.Person[604]["论剑奖励"] == 1 then
            ng = ng + 1000
	    end
  
		--蒙哥，气攻+2000点
        if match_ID(pid,627) then
            ng = ng + 2000
        end
		--萧半和使用混元功增加1000气攻
        if match_ID(pid,189) and (wugong == 90 or wugong == 306) then
            ng = ng +1000
        end
		--天赋侵略如火
		if (match_ID(pid,9972) or (match_ID(pid,50) and not isteam(pid) and WAR.ZDDH == 348)) and JLSD(10,50,pid) then
			Set_Eff_Text(id,"特效文字0","侵略如火");
			WAR.Person[id]["特效动画"] = 6
			WAR.PD['侵如火'][pid] = 1
			ng = ng + 1000
			if match_ID(pid,50) and not isteam(pid) and WAR.ZDDH == 348 then
				ng = ng + 1000
			end
        end
		--虾米侵略如火
		if match_ID(pid,759) and JLSD(10,50,pid) then
			Set_Eff_Text(id,"特效文字0","侵略如火");
			WAR.Person[id]["特效动画"] = 6
			WAR.PD['侵如火'][pid] = 1
			ng = ng + 1000
        end
        --萧秋水 天书加力
        if match_ID(pid, 652) then
            ng = ng + 1000
            Set_Eff_Text(id,2,'忘情天书加力',83)
        end	
        --鸠摩智
        if match_ID(pid, 103) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 600
            WAR.Person[id]["特效动画"] = math.fmod(98, 10) + 85
            Set_Eff_Text(id, "特效文字2", "明王真气")
        end
		
		--朱子柳
		if match_ID(pid, 122) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 300
            WAR.Person[id]["特效动画"] = math.fmod(88, 10) + 85
            Set_Eff_Text(id, "特效文字2", "人生若只如初见")
        end
        
        --成昆
        if match_ID(pid, 18) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 600

            Set_Eff_Text(id,2,'魔相・幻阴',6)
		end
		
        --何太冲
        if match_ID(pid, 7) then
            ng = ng + 1000
            Set_Eff_Text(id,3,'太清・道生一',6)
        end
        
        --殷天正
        if match_ID(pid, 12) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 500
            WAR.Person[id]["特效动画"] = 67
            Set_Eff_Text(id,"特效文字2","鹰王真气");
        end
        
        --黄药师
        if match_ID(pid, 57) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 600
            WAR.Person[id]["特效动画"] = 95
            Set_Eff_Text(id,"特效文字2","奇门奥义");
        end
        
        --戚长发
        if match_ID(pid, 594) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 600

            WAR.Person[id]["特效动画"] = 93
            Set_Eff_Text(id,"特效文字2","铁锁横江");
        end
        
        --慕容博
        if match_ID(pid, 113) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 600
            WAR.Person[id]["特效动画"] = 93
            Set_Eff_Text(id,"特效文字2","参合真气");
        end
		
		

		--段延庆
		 if (match_ID(pid, 98) or match_ID(pid, 9876)) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 666
            WAR.Person[id]["特效动画"] = 63
            Set_Eff_Text(id,"特效文字2","化子邋遢，观音长发");
        end
		if match_ID(pid, 515) then
            ng = ng + 666
			WAR.Person[id]["特效动画"] = 111
            Set_Eff_Text(id,"特效文字2","大威天龙");
        end
        --任我行 
        if match_ID(pid, 26) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 600
            WAR.Person[id]["特效动画"] = 6
            Set_Eff_Text(id,"特效文字2","魔帝・吸星");
        end
        
        --天罡内功到极无误伤，50%几率发动天罡真气・
        if actor(pid,6) and yongnei(wugong) and level == 11 then
            WAR.WS = 1
            if JLSD(25, 75, pid) then
                Set_Eff_Text(id,3,'天罡真气')
                ng = ng + JY.Wugong[wugong]["攻击力10"]
            end
        end
        --张无忌 斗酒僧 补偿加力
        if match_ID(pid,9) or match_ID(pid,638) and PersonKF(pid,106) then
			if WAR.NGJL == 0 then
				WAR.NGJL = 106
				ng = ng + 1200
				Set_Eff_Text(id, "特效文字2", "九阳神功加力",85+math.fmod(106, 10))
			end
        end
		--狄云，神经照，追加气攻
        if match_ID(pid, 37) and wugong == 94 and level == 11 then
            Set_Eff_Text(id, "特效文字3", "神照功・无影神拳")
            ng = ng + 800
        end
        --阿紫曼珠沙华，每杀一个人+200气攻
        if match_ID(pid, 47) or match_ID(pid, 9886) then
            ng = ng + 200 * WAR.MZSH
        end
        --乔峰擒龙功
        if match_ID(pid,50) and PersonKF(pid,204) then
			if WAR.NGJL == 0 then
				WAR.NGJL = 204
				ng = ng + 1000
				Set_Eff_Text(id, "特效文字2", "擒龙功加力",87+math.random(6))
			end
        end
		--何铁手
        if match_ID(pid, 83) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 500
            WAR.Person[id]["特效动画"] =  92
            Set_Eff_Text(id,"特效文字2","红袖拂风");
        end
        --枯荣
        if match_ID(pid, 102) and (isteam(pid)==false or JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid)) then
            ng = ng + 600
            if math.random(2) == 1 then
                Set_Eff_Text(id,3,'有常无常・双树枯荣',23)
            else
                Set_Eff_Text(id,3,'南北西东・非假非空',23)
            end
        end
        --铜人阵，9个强力铜人，直接触发达摩掌
        if pid > 480 and pid < 490 then
            Set_Eff_Text(id, "特效文字2", "易经筋加力")
            ng = ng + 1200
            WAR.JGZ_DMZ = 1
        end
        
        
        
        --小昭，圣火，追加气攻
        if match_ID(pid, 66) and wugong == 93 and level == 11 then
            local zs = {"赤沙流虹降心火","恍起未明净萦魂","星引瀚光沙劫海","业火焚心无量尊"}
			Set_Eff_Text(id, "特效文字3", zs[math.random(4)])
            ng = ng + 800
        end
        --莫大，追加气攻
        if match_ID(pid, 20) and (JXPD(pid,20,1) or isteam(pid) == false) then
            local zs = {"沧海一声笑","滔滔两岸潮","纷纷世上潮","浮沉记今朝 "}
            Set_Eff_Text(id, "特效文字3", zs[math.random(4)])
            ng = ng + 800
        end	
        --三十二身相追加气攻
        if match_ID(pid, 497) then
            local zs = {"光明相","如狮相","阴藏相","广平相","圆满相","牛王相",}
            Set_Eff_Text(id, "特效文字3", zs[math.random(4)])
            ng = ng + 800
        end
		
		
		--黯然极意
        if WAR.ARJY == 1 then 
			ng = ng + 1200
			WAR.WS = 1
			if (WAR.PD['极意攻击'][pid] or 0) < 5 then
				WAR.PD['极意攻击'][pid] = 5
			end	
		end
		--主运紫霞，50%几率剑系气攻+1000
        if PersonKF(pid,89)  and yongjian(wugong) then
        local jl = 30
        if Curr_NG(pid,89) then
            jl = 50
            end
            if JLSD(0,jl,pid) or BNJQ(pid) then
                ng = ng + 1000
                Set_Eff_Text(id, "特效文字2", "紫霞剑气")
            end
        end
		--五岳剑派
		if WAR.WYJF > 0 then
			if WAR.WYJF == 6 then
				ng = ng + 1000
			else
				ng = ng + 500
			end
		end
        --五岳剑气
        if WYJJ(pid)  and yongjian(wugong) and WAR.ZWYJF == 0 then
        local jl = 30
        if NGQHB(pid,175) then
            jl = 50
            end
            if JLSD(0,jl,pid) or BNJQ(pid) then
                ng = ng + 800
                Set_Eff_Text(id, "特效文字2", "五岳剑气")
            end
        end
        --大金刚神力，增加1200点气攻
        if WAR.JGSL == 1 then
            ng = ng + 800
        end	
        
        --张家辉的隐身戒指
        if JY.Person[pid]["防具"] == 304 then
            local cd = 40
            if JY.Thing[304]["装备等级"] >= 5 then
                cd = 20
            elseif JY.Thing[304]["装备等级"] >=3 then
                cd = 30
            end
            WAR.YSJZ = cd
        end
        
        --装备鸳鸯刀或天衣无缝组合，夫妻鸳鸯追加500气攻
        if (JY.Person[pid]["武器"] == 217 and wugong == 62 and JY.Thing[217]["装备等级"] == 5) or (WGZH(pid,54,62) and wugong == 62) then
            ng = ng + 500
        end
        if (JY.Person[pid]["武器"] == 218 and wugong == 54 and JY.Thing[218]["装备等级"] == 5) or (WGZH(pid,54,62) and wugong == 54) then
            ng = ng + 500
        end
        -- 剑魔再临 
        if WAR.JMZL == 2 then
            ng = ng +800
        end

        --六脉招式 
        if WAR.DSP_LM1 == 1 then
            ng = ng +800
        end	
        --琴棋书画：棋盘招式，额外杀气
        if (wugong == 72 and WGZH(pid,72,73)) or match_ID(pid, 115) then
            ng = ng + 800
            Set_Eff_Text(id, "特效文字3", "棋高一着")
            --50%几率触发再次追加杀气
            if JLSD(20, 70, pid) then
                ng = ng + 500
                Set_Eff_Text(id, "特效文字1", "星罗棋布")
            end
        end

        --沧溟刀法，30%几率，额外杀气，必定流血
        --刀主二次判定
        if wugong == 153 and (JLSD(30, 60, pid) or (actor(pid,4) and JLSD(30,60,pid))) then
			WAR.CMDF = 1
            ng = ng + 1000
            Set_Eff_Text(id, "特效文字1", "颠动沧溟")
        end
        
        -- 龙爪手 额外杀气
        if wugong == 20 then
            ng = ng + 800
            Set_Eff_Text(id, "特效文字1", "批亢捣虚")
        end
        
        --龙象之力
        if PersonKF(pid, 103) and JLSD(20,80,pid) then
            ng = ng + 1000
            if Curr_NG(pid, 103) then
                local nq = math.modf((WAR.LQZ[pid] or 0)/10)
                ng = ng + 100 * nq
                if BNJQ(pid) then
                    WAR.LXZL10 = 1
                end
            end
            Set_Eff_Text(id, "特效文字1", "龙象之力")
        end

        
        --王重阳北斗七闪追加气攻1000点
        if match_ID(pid, 129) and WAR.BDQS > 0 then
            ng = ng + 1000
            local BDQS = {"天枢", "天璇", "天玑", "天权", "玉衡", "开阳", "摇光"}
            Set_Eff_Text(id, "特效文字2", "北斗七闪・"..BDQS[WAR.BDQS])
        end
		
		--萧远山杀破狼加气攻2000点
		if match_ID(pid,112) and WAR.ZHRM[pid] == nil and WAR.XYS > 0 then
			ng = ng + 2000
			if WAR.XYS < 4 then
				local BDQS = {"贪狼", "破军", "七杀"}
				Set_Eff_Text(id,2,"杀破狼・"..BDQS[WAR.XYS])
			end	
		end
		--朱子柳攻击追加气攻666点
        if match_ID(pid, 122) and JLSD(20,70+JY.Base["天书数量"]+math.modf(JY.Person[pid]["实战"]/50),pid) then
            ng = ng + 666
            Set_Eff_Text(id, "特效文字1", "尔乃蛮夷")
        end
        --玄澄 无量禅震 追加10-15点内伤
        if match_ID(pid,9994) then
            WAR.XC_WLCZ= 1 
            Set_Eff_Text(id, "特效文字1", "无量禅震")
        end
		--陈正德鹰爪
        if wugong == 4 and match_ID(pid, 311) then
            WAR.YZG = 1 
            Set_Eff_Text(id, "特效文字1", "天山双鹰・秃鹰")
        end
        --钟灵 使用闪电貂，可偷窃，朱聪妙手空空也可
        --陆渐补天劫手  司空摘星
        if (match_ID(pid, 90) and wugong == 113)  or (match_ID(pid, 131) and wugong == 116) or match_ID(pid, 497) or match_ID(pid, 579) then
            WAR.TD = -2
            --蓝烟清：挑战战斗不可偷东西
            if WAR.ZDDH == 226 or WAR.ZDDH == 79 or WAR.ZDDH == 354 then
                WAR.TD = -1;
            end
        end
        --宋远桥使用太极拳或太极剑攻击后自动进入防御状态
        if match_ID(pid, 171) and (wugong == 16 or wugong == 46) then
            WAR.WDRX = 1
        end
		--武当派4级弟子使用太极拳或太极剑攻击后自动进入蓄力状态
        if MPTX(pid,4,4) and (wugong == 16 or wugong == 46) then
            WAR.WDXL = 1
        end
		--空性使用龙爪手攻击后自动进入等待状态
        if match_ID(pid, 170) and (wugong == 20 or wugong == 135) then
            WAR.SLGFH = 1
        end
		--空闻使用般若掌自动进入蓄力状态
        if match_ID(pid,169) and wugong == 189 then
            WAR.SWJGS = 1
        end
		--空智使用金刚掌后进入防御状态
        if match_ID(pid,766) and wugong == 22 then
            WAR.PD['降龙・潜龙勿用'][pid] = 1
        end
		--五毒神功 五毒神掌随机1-3倍威力 标记修改
        if Curr_NG(pid,220) and  wugong == 3 then
            WAR.HTS = math.random(1, 3)
        end	
        --何铁手五毒随机2-5倍威力
        if (match_ID(pid, 83) or match_ID(pid, 9814)) and  wugong == 3 then
            WAR.HTS = WAR.HTS + math.random(2, 5)
        end
        --周威信随机2-5倍威力
        if match_ID(pid, 612) and  wugong == 206 then
            WAR.ZWX = math.random(2, 5)
        end	
        --卓天雄随机3倍威力
        if match_ID(pid, 613) and  wugong == 206 then
            WAR.ZWX = 3
        end	
        --卓天雄随机3倍威力
        if match_ID(pid, 613) and  wugong == 205 then
            WAR.ZWX = 3
        end
		--葵花点穴手 点穴大师
        if Curr_NG(pid,105) and PersonKF(pid,105) and wugong == 226 then
            WAR.KHZF = math.random(2,4)
        end
        --喵姐 无误伤
        if match_ID(pid, 92) then
            WAR.WS = 1
        end
        
        --欧阳锋 无误伤
        if match_ID(pid, 60) then
            WAR.WS = 1
        end
		
		--杨过 无误伤
		if match_ID(pid, 58) then
			WAR.WS = 1 
		end 	
        
        --东方不败 无误伤
        if match_ID(pid, 27) or match_ID(pid, 777) then
            WAR.WS = 1
        end
        
        --扫地 无误伤
        if match_ID(pid, 114) then
            WAR.WS = 1
        end
	
        --阿青，越女无误伤
        if match_ID(pid, 604) and wugong == 156 then
            WAR.WS = 1
        end
        
        --剑仙剑魔战，独孤无误伤
        if match_ID(pid, 592) and WAR.ZDDH == 291 then
            WAR.WS = 1
        end
        
        --萧中慧使用夫妻刀法 无误伤
        if match_ID(pid, 77) and wugong == 62 then
            WAR.WS = 1
        end
        
        --令狐冲 二觉之后，使用独孤九剑 无误伤
        if JXPD(pid, 35, 2) and wugong == 47 then
            WAR.WS = 1
        end
        
        --玉女素心剑 无误伤
        if wugong == 139 then
            WAR.WS = 1
        end
        
        --金轮法王 气攻+2000
        if match_ID(pid, 62) or match_ID(pid, 9831) then
            ng = ng + 2000
        end
		--天罡每个内功+100气攻
		--浩然罡气
		if match_ID(pid,9946) then
			local hrgq = 0
			for i = 1,JY.Base["武功数量"] do
				if JY.Wugong[JY.Person[pid]["武功" .. i]]["武功类型"] == 6 then
					hrgq = hrgq + 1
				end
			end
			ng = ng + hrgq * 100
		end	
        
        --花铁干，使用中平枪法，气攻+1500
        if (match_ID(pid,52) or match_ID(pid, 9881)) and wugong == 70 then
            Set_Eff_Text(id, "特效文字3", "中平神枪")
            ng = ng + 1000
        end
    
        --张三丰 万法自然，集气从500开始
        if (match_ID(pid, 5) or match_ID(pid, 9820)) and JLSD(0,70,pid) then
            WAR.ZSF = 1
            Set_Eff_Text(id, "特效文字1", "万法自然")
        end

        --陆渐大金刚神力
        if match_ID(pid, 497) and JLSD(0,70,pid) and WAR.JGFX[pid] ~= nil then
            WAR.JGSL = 1
            Set_Eff_Text(id, "特效文字1", "大金刚神力")
        end
        
        --李白 诗酒化行，集气从200开始
        if match_ID(pid, 636) then
            WAR.QLBLX = 1
			if JLSD(0,40,pid) then
				WAR.PD['时序闪避'][pid] = 20 
			end
            Set_Eff_Text(id, "特效文字1", "诗酒化行")
        end

        --虚竹  福泽加护，集气从200开始
        if (match_ID(pid, 49) or match_ID(pid, 9883)) and JLSD(0,60,pid) then
            WAR.XZZ = 1
            Set_Eff_Text(id, "特效文字1", "福泽加护")
        end
        
        --封不平狂风快剑，使用剑法回气
        if (match_ID(pid, 142) or match_ID(pid, 9839)) and yongjian(wugong) then
            WAR.KFKJ = 1
            Set_Eff_Text(id, "特效文字3", "狂风快剑")
        end
        --东方不败 萧半和 葵花点穴手，气攻+1000
        --葵尊必出点穴手
        if wugong == 226 or match_ID(pid, 27) or match_ID(pid, 777) or match_ID(pid, 9890) or JXPD(pid, 189, 1) or (PersonKF(pid, 105) and JLSD(0,40,pid)) then
            ng = ng + 1400
            WAR.BFX = 1
            Set_Eff_Text(id, "特效文字3", "葵花点穴")
        end
        --太虚剑意 万剑归宗
        if Curr_NG(pid, 152) and JLSD(20,70,pid) and yongjian(wugong) then
            ng = ng + 1100
            Set_Eff_Text(id, "特效文字1", "万剑归宗")
        elseif PersonKF(pid,152) and JLSD(20,45,pid) then
            ng = ng + 600
            Set_Eff_Text(id, "特效文字1", "万剑归宗")
        end	
        --曲非烟
        if match_ID(pid,510) then
            if JLSD(0,30,pid) then 
                WAR.PD['曲夕烟隙'][pid] = 1
                Set_Eff_Text(id, "特效文字1", "曲夕烟隙",61)
            end
            if JLSD(0,30,pid) then 
                WAR.PD['曲径通幽'][pid] = 1
                Set_Eff_Text(id, "特效文字1", "曲径通幽",61)
            end
        end


    
        -- 白秀 雪花神剑
        if JXPD(pid,582,1) and (JLSD(20,50+JY.Base["天书数量"],pid) or BNJQ(pid)) then
			WAR.BXXHSJ = 1
        end
        --白秀 雪山剑法
        if wugong == 35 and JXPD(pid,582,1) and WAR.DZXY ~= 1 then
           ng = ng + 600
        end	
        
        if WAR.BXXHSJ == 1 then
            local exng = 0
            local CN_num = {"一式", "二式", "三式", "四式", "五式", "六式", "七式", "八式", "九式", "十式", "十一式","十二式", "十三式","十四式","十五式"}
            for i = 1, JY.Base["武功数量"] do
                if JY.Person[pid]["武功"..i] ~= 35 and JY.Person[pid]["武功等级"..i] == 999 then
                    ng = ng + 100
                    exng = exng + 1
                end
            end
            if exng > 0 then
                Set_Eff_Text(id, "特效文字3", "雪花神剑・"..CN_num[exng])
            end
        end
    
        --天山折梅手，杀气提高
        if wugong == 14 and WAR.DZXY ~= 1 then
            local exng = 0
            local CN_num = {"一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一","十二","十三","十四","十五"}
            for i = 1, JY.Base["武功数量"] do
                if JY.Person[pid]["武功"..i] ~= 14 and JY.Person[pid]["武功等级"..i] == 999 then
                    ng = ng + 100
                    exng = exng + 1
                end
            end
            if exng > 0 then
                Set_Eff_Text(id, "特效文字3", "天山折梅"..CN_num[exng])
            end
        end
        --棋势伤害
        if match_ID(pid,586) and JY.Base["天书数量"] > 0  and WAR.DZXY ~= 1 then
            local zs = {" 十王走马势","长气杀有眼","回龙征","一子解双征"}
            local exng = JY.Base["天书数量"]*1
            local CN_num = {"一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一","十二","十三","十四","十五"}	
            ng = ng + 1000
            Set_Eff_Text(id, "特效文字3", "奕棋・"..CN_num[exng].."势・"..zs[math.random(4)])
        end
        
        --虚竹使用天山六阳掌或折梅手，出生死符，杀集气+1700
        if (wugong == 8 or wugong == 14) and match_ID(pid, 49) and PersonKF(pid, 101) and (JLSD(20, 80, pid) or WAR.NGJL == 98)  and WAR.DZXY ~= 1 then
            Set_Eff_Text(id, "特效文字3", "灵鹫宫绝学・生死符")
            ng = ng + 1000
            WAR.TZ_XZ = 1
        end

        --李文秀使用特系攻击，60%的机率大幅度杀集气
        if (match_ID(pid, 590) or match_ID(pid, 9850)) and yongte(wugong) and JLSD(0, 50 + JY.Base["天书数量"]*2 + math.modf(JY.Person[pid]["实战"]/25), pid) then
            Set_Eff_Text(id, "特效文字3", "心秀天铃・星月争辉")
            ng = ng + 800
            --如有14天书，则忽视绝对气防
            if JY.Base["天书数量"] >= 14 then
                WAR.LWX = 1
            end
        end
        --黄衫女 广寒清辉
        --暴怒必触发
        if JXPD(pid,640,1) and (JLSD(0, 10 + JY.Base["天书数量"]*2, pid) or BNJQ(pid)) and WAR.DZXY ~= 1 then
            ng = ng + 1000
            WAR.GHQH = 1
            Set_Eff_Text(id, "特效文字3", "广寒清辉")
        end
        -- 双剑合壁.攻击
        if WGZH(pid,39,42) and (wugong == 39 or wugong == 42 or wugong == 139)  then
            WAR.SJHB_G = 1
        end
        --梁萧谐之道
        --梁萧华山觉醒领悟谐之道
        if match_ID(pid, 635)  and BNJQ(pid) and (JXPD(pid,635,1) or JY.Person[pid]["实战"] >=500 or isteam(pid) == false) then
            ng = ng + 1000
            WAR.LXXZD = 1
			Set_Eff_Text(id, "特效文字0", "谐之道・天道有常",126)
        end
        --王语嫣御法绝尘
        local YufaJC = 0
        for i = 0, WAR.PersonNum - 1 do
            local yfid = WAR.Person[i]["人物编号"]
            if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and (match_ID(yfid, 76) or match_ID(yfid, 9899)) and Xishu_sum(yfid) >= 500 then
                YufaJC = 1
                break
            end
        end
		------------------------------------------------------------------------------------------
        --------------武功招式加杀集气------------------------------------------------------------
		------------------------------------------------------------------------------------------
        if YufaJC == 0 then
            --风清扬，暴怒九剑触发无招胜有招
            if (match_ID(pid, 140) or match_ID(pid, 9844)) and wugong == 47 and BNJQ(pid) then
                Set_Eff_Text(id, "特效文字3",  "无招胜有招")
                ng = ng + 2000
                WAR.FQY = 1
            --看有没有招式
			elseif CC.KFMove[wugong] ~= nil then
				local cz = 0 
				if JY.Person[pid]["天赋外功1"] == wugong or JY.Person[pid]["天赋外功2"] == wugong then
					cz = cz + 30
				end
				if JY.Wugong[wugong]["武功类型"] == 1 and (PersonKF(pid,241) or PersonKF(pid,216)) then
					if Curr_NG(pid,241) or Curr_NG(pid,216) then
						cz = cz + 20
					else
						cz = cz + 10
					end
				end
				if JY.Wugong[wugong]["武功类型"] == 2 and PersonKF(pid,207) then
					if Curr_NG(pid,207) then
						cz = cz + 20
					else
						cz = cz + 10
					end
				end
				if JY.Wugong[wugong]["武功类型"] == 3 and (PersonKF(pid,89) or PersonKF(pid,242)) then
					if Curr_NG(pid,89) or Curr_NG(pid,242) then
						cz = cz + 20
					else
						cz = cz + 10
					end
				end	
				if JY.Wugong[wugong]["武功类型"] == 4 and PersonKF(pid,235) then
					if Curr_NG(pid,235) then
						cz = cz + 20
					else
						cz = cz + 10
					end
				end							
				if JY.Wugong[wugong]["武功类型"] == 5 and PersonKF(pid,243) then
					if Curr_NG(pid,243) then
						cz = cz + 20
					else
						cz = cz + 10
					end
				end
				if JY.Wugong[wugong]["武功类型"] == 5 and PersonKF(pid,93) then
					if Curr_NG(pid,93) then
						cz = cz + 30
					else
						cz = cz + 16
					end
				end				
				--npc必出招，小无相功加力必出招式，暴怒必出招式，辟邪必出招，太玄必出招	
				if isteam(pid) == false or myrandom(level+cz, pid) or WAR.NGJL == 98 
				or BNJQ(pid) or ((wugong == 48 or wugong == 102 or wugong == 106) and level == 11 and WAR.DZXY == 0) 
				or (wugong == 151  and level == 11 and PersonKF(pid,152)) 
				or (wugong == 226 and PersonKF(pid,201) and (PersonKF(pid,127) or PersonKF(pid,126))) then
				local num
				if wugong == 48 and level == 11 and isteam(pid) and WAR.DZXY ~= 1 and WAR.AutoFight == 0 and WAR.BXZS > 0 then		--辟邪招式固定
					num = WAR.BXZS
				elseif wugong == 106 and level == 11 and isteam(pid) and WAR.DZXY ~= 1 and WAR.AutoFight == 0 and WAR.JYZS > 0 then		--九阳招式固定
				    num = WAR.JYZS
				elseif wugong == 49 and inteam(pid) and isteam(pid) and WAR.DZXY ~= 1 and WAR.AutoFight == 0 and WAR.LMZS > 0 then	--六脉招式固定
				    num = WAR.LMZS
				elseif wugong == 377 and isteam(pid) and WAR.DZXY ~= 1 and WAR.AutoFight == 0 and WAR.WYSJ > 0 then	--五岳神剑招式固定
				    num = WAR.WYSJ
				elseif wugong == 102 and level == 11 and JXPD(pid, 38, 1) and isteam(pid) and WAR.DZXY ~= 1 and WAR.AutoFight == 0 and WAR.TXZS > 0 then	--太玄招式固定
				    num = WAR.TXZS
				else
				    local choice = math.random(#CC.KFMove[wugong])--从数组从随机抽取一个
					num = choice
					if wugong == 26  then
						for i = 1, (1 + (level)) / 2 do
							for j = 1, (1 + (level)) / 2 do
								SetWarMap(WAR.Person[WAR.CurID]["坐标X"] + i * 2 - 1, WAR.Person[WAR.CurID]["坐标Y"] + j * 2 - 1, 4, 1)
								SetWarMap(WAR.Person[WAR.CurID]["坐标X"] - i * 2 + 1, WAR.Person[WAR.CurID]["坐标Y"] + j * 2 - 1, 4, 1)
								SetWarMap(WAR.Person[WAR.CurID]["坐标X"] + i * 2 - 1, WAR.Person[WAR.CurID]["坐标Y"] - j * 2 + 1, 4, 1)
								SetWarMap(WAR.Person[WAR.CurID]["坐标X"] - i * 2 + 1, WAR.Person[WAR.CurID]["坐标Y"] - j * 2 + 1, 4, 1)
							end
						end
					end
				end
				if wugong == 335 and (PersonKF(pid,203) or PersonKF(pid,94)) and PersonKF(pid,181) then
				else
					Set_Eff_Text(id, "特效文字3",CC.KFMove[wugong][num][1])
				end
                ng = ng + CC.KFMove[wugong][num][2]
            end
        end
    end
		---------------------------------------------------------------------------------------------------------------
		----------------------------------------------攻击后追击特效---------------------------------------------------
		---------------------------------------------------------------------------------------------------------------
		--金蛇牙突攻击后生效
		if PersonKF(pid,40) and WAR.JSBD[pid] == nil and War_isEnd() == 0  then --金蛇飞锥
			WAR.LMC = 1
			local x1=WAR.Person[WAR.CurID]["坐标X"]
			local y1=WAR.Person[WAR.CurID]["坐标Y"]
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false and RealJL2(x1,y1, i, 8) then
					WAR.JSBD[pid]= {WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"]}
					break
				end
			end
		end
		--天元剑气
		if (match_ID(pid,9806) or match_ID(pid,604)) and yongjian(wugong) and (JLSD(10,50,pid) or match_ID(pid,604)) 
		and fjpd(WAR.CurID) == false and WAR.Person[id]["追击武功"] == -1 then
			WAR.Person[id]["追击武功"] = wugong	
			WAR.YTTLLV[pid] = 0
			if (Xishu_sum(pid) >= 4000) or (Sanwei_sum(pid) >= 3000) then
			    WAR.YTTLLV[pid] = 2
			elseif JY.Person[0]["中庸"] == 3 then
			    WAR.YTTLLV[pid] = 3
			else
			    WAR.YTTLLV[pid] = 1
			end
		end
		if WAR.PD["龙跨千山"][pid] ~= nil and WAR.PD["龙跨千山"][pid] > 0 and fjpd(WAR.CurID) == false and WAR.Person[id]["追击武功"] == -1 then 
			WAR.Person[id]["追击武功"] = wugong	
			WAR.LKQSPD[pid] = 0
			if (Xishu_sum(pid) >= 100) or (Sanwei_sum(pid) >= 100) then
			    WAR.LKQSPD[pid] = 1
			end
		end 	
		--胡刀苗剑，为极，60%额外气攻
		if (PersonKFJ(pid,67) and PersonKFJ(pid,44) and JLSD(0,60,pid)) or match_ID(pid,3) or match_ID(pid,633) or JXPD(pid,1,1) then
			if wugong == 67 then
				Set_Eff_Text(id, "特效文字1", "胡刀・进步连环刀")
				WAR.L_TLD = 1
			end
			if wugong == 44 then
			    Set_Eff_Text(id, "特效文字1", "苗剑・上步摘星式")
				WAR.WYJF = math.random(5)
			end
        end
       --刀剑合璧
	    if PersonKF(pid,44) and PersonKF(pid,67) and JLSD(0,50,pid) then -- and inteam(pid)
            if wugong == 44 and WAR.DJHB1[1] == nil then
        	    if WAR.DJHB3 == 0 then
        		    WAR.DJHB1 = {x, y}
        	    end	
				WAR.Person[id]["特效动画"] = 6
				Set_Eff_Text(id, "特效文字1", "胡刀苗剑 归真合一")
				WAR.DJGZ = 1
                ng = ng + 1000
				if match_ID(pid,633) or match_ID(pid,3) or JXPD(pid,1,1) or match_ID(pid, 9794) then
					WAR.Person[id]["特效动画"] = 119	   
					WAR.PD["刀剑绝技"][pid] = 1
					WAR.ATNum = WAR.ATNum + 1
					local HDJYLJZS = {"刀剑绝技・苗剑・苏秦背剑","刀剑绝技・苗剑・黄龙吐须","刀剑绝技・苗剑・白鹤舒翅","刀剑绝技・苗剑・怀中抱月","刀剑绝技・苗剑・力劈华山"};
					local A = HDJYLJZS[math.random(5)];
					TXWZXS(A, M_DeepSkyBlue)
				end	
			elseif wugong == 67 and WAR.DJHB2[1] == nil then
			    if WAR.DJHB3 == 0 then
        		    WAR.DJHB2 = {x, y}
        	    end
				WAR.Person[id]["特效动画"] = 6
				Set_Eff_Text(id, "特效文字1", "胡刀苗剑 归真合一")
				WAR.DJGZ = 1
				ng = ng + 1000
				if match_ID(pid,633) or match_ID(pid,3) or JXPD(pid,1,1) or match_ID(pid, 9794) then
					local  HDJYZS = {"刀剑绝技・胡刀・云龙三现","刀剑绝技・胡刀・拜佛听经","刀剑绝技・胡刀・沙鸥掠波","刀剑绝技・胡刀・参拜北斗","刀剑绝技・胡刀・八方藏刀式"};
					local display = HDJYZS[math.random(5)];
					WAR.Person[id]["特效动画"] = 119
					WAR.PD["刀剑绝技"][pid] = 1
					WAR.ATNum = WAR.ATNum + 1
					TXWZXS(display, M_DeepSkyBlue)
				end	
			end	
	    end 
		--刀剑绝技
        if WAR.PD["刀剑绝技"][pid] ~= nil and WAR.PD["刀剑绝技"][pid] < 3 then 
            ng = ng + 1000
            WAR.WS = 1	
            if (WAR.PD['极意攻击'][pid] or 0) < 6 then
				WAR.PD['极意攻击'][pid] = 6
			end		
        end
        --你是风儿我是沙
        if wugong == 78 and PersonKF(pid,55) then
            WAR.NSFEWSS = 1
			WAR.Person[id]["特效动画"] = 178
			if WAR.ACT == 1 then
				local BDQS = {"浪迹天涯・从此并肩看彩霞","朝朝暮暮・不妨踏遍红尘路","莫再留恋・富贵荣华都是假"}
				local A = BDQS[math.random(1,3)];
				Set_Eff_Text(id, "特效文字2",A)
				WAR.PD["你是风儿我是沙1"][pid] = 1
                if WAR.ATNum < 2 then
				    WAR.ATNum = 2
				end
			end
        end
		
        if wugong == 55 and PersonKF(pid,78) then
			WAR.NSFEWSS = 1
			WAR.Person[id]["特效动画"] = 178
			if WAR.ACT == 1 then
				local BDQS = {"浪迹天涯・从此并肩看彩霞","朝朝暮暮・不妨踏遍红尘路","莫再留恋・富贵荣华都是假"}
				local A = BDQS[math.random(1,3)];
				Set_Eff_Text(id, "特效文字2",A)			
				WAR.PD["你是风儿我是沙2"][pid] = 1
				if WAR.ATNum < 2 then
				   WAR.ATNum = 2
				end
			end
        end
		--丐世无双
		if PersonKF(pid,26) and PersonKF(pid,80) and JLSD(30,70,pid) then -- and inteam(pid)
	        if wugong == 26 and WAR.GSWS1[1] == nil then
		        WAR.GSWS1 = {x, y}
		    elseif wugong == 80 and WAR.GSWS2[1] == nil then
		        WAR.GSWS2 = {x, y}
		    end	
		end
		--日月葵花
		if MPTX(pid,12,4) and PersonKF(pid,313) and PersonKF(pid,226) and JLSD(30,70,pid) then
			if wugong == 313 and WAR.HLKH1[1] == nil then	
				WAR.HLKH1 = {x, y}
			elseif wugong == 226 and WAR.HLKH2[1] == nil then
				WAR.HLKH2 = {x, y}
			end
		end
		--天机宫
		if MPTX(pid,30) and PersonKF(pid,58) and PersonKF(pid,192) and JLSD(30,80,pid) then
			if wugong == 58 and WAR.TJDJ1[1] == nil then
				WAR.TJDJ1 = {x,y}
			elseif wugong == 192 and WAR.TJDJ2[1] == nil then
			    WAR.TJDJ2 = {x,y}	
			end
		end 	
	------------------------------------------------攻击极意范围---------------------------------------------
	--大周吸星
	if NGQH(pid,190) and (WAR.PD['三垣'][pid] or 0) > 60 and (WAR.PD['三垣'][pid] or 0) < 91 then
        ng = ng + 1000
        if (WAR.PD['极意攻击'][pid] or 0) < 5 then 
		  	WAR.PD['极意攻击'][pid] = 5
	  	end
		Set_Eff_Text(id,1,"周天星辰・紫薇星降",204)
	end
	
	--北冥六阳
    if ((wugong == 8 and PersonKF(pid,85)) or match_ID(pid, 116) or match_ID(pid, 117) or match_ID(pid, 634)) and JLSD(10,60,pid) then
		Set_Eff_Text(id,"特效文字3","日斜归路晚霞明")
	    ng = ng + 2000
	    if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
		  	WAR.PD['极意攻击'][pid] = 9
	  	end
    end
	--纯阳太极拳
    if ((wugong == 16 and PersonKF(pid,99)) or match_ID(pid, 5)) and JLSD(10,60,pid) then	
		Set_Eff_Text(id,"特效文字3","太极拳法・圆融之道")
	    ng = ng + 1000
	    if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
		  	WAR.PD['极意攻击'][pid] = 7
	  	end
    end
	--开太极 WAR.PD["太极蓄力"][pid] > 600
    if Curr_NG(pid,171) and (wugong == 16 or  wugong == 46) and ((WAR.PD["太极蓄力"][pid] or 0)>=1000 or (WAR.TJZX[pid] or 0) >= 8) then
        local qg = math.modf((JY.Person[pid]["内力"]/JY.Person[pid]["内力最大值"])*1200)
        WAR.WDKTJ = 1
        if (WAR.PD['极意攻击'][pid] or 0) < 8 then
			WAR.PD['极意攻击'][pid] = 8
		end
        ng = ng + qg
        local size = 60
        local x = CC.ScreenW/2;
        local y = CC.ScreenH/2;
        local offx = (#"【太一初分.开太极】")*size/4
        local offy = size/2
        for k = 1,10 do
            Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
            lib.Background(0,y-50,CC.ScreenW,y+50,98)
            DrawString(x-offx,y-offy,"【太一初分.开太极】",C_GOLD,size);  
            ShowScreen();
            lib.Delay(CC.BattleDelay)
        end
    end
	--弹指神通，配合桃花绝技，气攻+1000
    if wugong == 18 and WGZH(pid,12,18) then
        ng = ng + 1000
        Set_Eff_Text(id, "特效文字3", '无影神石')
    end
	--奇门弹指		
	if wugong == 18 and (Curr_NG(pid,251) or match_ID(pid,57)) then
		if JLSD(20,55,pid) then
			if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
				WAR.PD['极意攻击'][pid] = 8
			end
		end
	end
	--阴阳七伤
	if (wugong == 23 and (PersonKF(pid,221) or match_ID(pid,8) or match_ID(pid,167) or match_ID(pid,168))) and JLSD(30,70,pid) then
		Set_Eff_Text(id,"特效文字3","七伤拳劲・力破千军")
		ng = ng + 1500
	    WAR.WS = 1	
		if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
	  	    WAR.PD['极意攻击'][pid] = 7
	  	end
    end
	--怒涛黯然
	if wugong == 25 and (Curr_NG(pid,252) or match_ID(pid,58)) and BNJQ(pid) then	
		Set_Eff_Text(id,"特效文字3","黯然・杞人忧天")
	    local a = 4 + math.modf((WAR.PD['黯然值'][pid] or 0)*0.05)
		ng = ng + 2000
	    if (WAR.PD['极意攻击'][pid] or 0) < a then 
		  	WAR.PD['极意攻击'][pid] = a
	  	end
    end
	--擒龙降龙
    if wugong == 26 and (Curr_NG(pid,204) or match_ID(pid,50)) then 
		WAR.QLXLJL = 1
		Set_Eff_Text(id,"特效文字3","龙吞天下")
	    ng = ng + 2000
	    if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
		  	WAR.PD['极意攻击'][pid] = 9
	  	end
  	end
	--杨过，神雕，剑神、独孤求败 玄铁极意
    --无招式时必触发，暴怒时必出
	if wugong == 45 and (match_ID(pid, 58) or match_ID(pid, 592) or match_ID(pid,530) or actor(pid,3)) then
		local jl = 40 
		if BNJQ(pid) then
			jl = jl * 2
		end
		if JLSD(0,jl,pid)  then
			Set_Eff_Text(id,"特效文字3","重剑真传・浪如山涌剑如虹")
      	    ng = ng + 1200
			local yj = math.modf(TrueYJ(pid)/200)
   			if (WAR.PD['极意攻击'][pid] or 0) < yj then 
		  		WAR.PD['极意攻击'][pid] = yj
	  		end	
        end
    end
	--玄铁剑魔再临
	if Cat('剑魔再临',pid,wugong) then
		local t = math.random(2)
        local wz = {"天极剑渊","破尽天下"}
        WAR.JMZL = t
		Set_Eff_Text(id,1,"剑魔再临・"..wz[t])
		if BNJQ(pid) or ZYJQ(pid) then
			Set_Eff_Text(id,"特效文字3","真・重剑无锋 大巧不工")
			WAR.XTZJ = 1
			ng = ng + 2000
			if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
				WAR.PD['极意攻击'][pid] = 9
			end
		end
    end
	--太极功太极剑
    if ((wugong == 46 and PersonKF(pid,171)) or match_ID(pid,5)) and JLSD(10,60,pid) then	
		Set_Eff_Text(id,"特效文字3","太极剑法・太极圆转")
	    ng = ng + 1000
	    WAR.WS = 1
	    if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
		  	WAR.PD['极意攻击'][pid] = 7
	  	end
    end
	--葵花神功 刺目
	if (wugong == 48 and PersonKF(pid, 105)) or JXPD(pid,19,1) then
		WAR.KHBX = 2
		Set_Eff_Text(id,"特效文字3","辟邪刺目")
	end
	--虾米魔刀
	if wugong == 371 and match_ID(pid,759) and JLSD(30,80,pid) then
        Set_Eff_Text(id,"特效文字3","舍神弃佛・离经叛道")
	    ng = ng + 1000
	    WAR.WS = 1
	    if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
		  	WAR.PD['极意攻击'][pid] = 8
	  	end
    end  
		
	--混元狂风刀
	if ((wugong == 55 and (PersonKF(pid,90) or PersonKF(pid,375))) 
		or (wugong == 78 and (PersonKF(pid,90) or PersonKF(pid,375)) and PersonKF(pid,55))
		or (wugong == 55 and match_ID(pid,29))) and JLSD(20,60,pid) then
		Set_Eff_Text(id,"特效文字3","狂风刀法・风雨交加")
	    local a = TrueSD(pid)
		WAR.BLX = 1
        ng = ng + a * 2
     	if (WAR.PD['极意攻击'][pid] or 0) < 6 then 
		  	WAR.PD['极意攻击'][pid] = 6
	  	end	
    end
	--火焰刀奥义 标记修改
	if wugong == 66 and (JLSD(10,30,pid) or BNJQ(pid)) and JY.Person[103]["声望"] == 30 then
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx = (#"【火焰刀法奥义・火之高兴】")*size/4
		local offy = size/2
		for k = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.Background(0,y-50,CC.ScreenW,y+50,98)
			DrawString(x-offx,y-offy,"【火焰刀法奥义・火之高兴】",C_GOLD,size);  
			ShowScreen();
			lib.Delay(CC.BattleDelay)
		end
		ng = ng + 1000
		WAR.WS = 1
		WAR.HZGX = 1
		if WAR.PD['残火太刀'][pid] ~= nil and ((wugong == 66 and match_ID(pid,103)) or (yongdao(wugong) and match_ID(pid,745) and wgnlxz(wugong) == 1) or (wugong == 66 and match_ID(pid,771))) then
			local str = ""
			if WAR.ATNum < 4 then
				WAR.ATNum = 4
			end
			if (WAR.PD['残火太刀'][pid] == 1 or (JLSD(10,35,pid) and WAR.PD['残火太刀'][pid] ~= nil)) then
				str = "・东・旭日刃"
				WAR.CHTD = 1
			end
			if WAR.PD['残火太刀'][pid] == 2 and CC.TX['死葬者身份'] > 0 and WAR.PD['死葬发动'][pid] == nil then
				str = "・南・火火死葬阵"
				local x, y = WE_xy(WAR.Person[WAR.CurID]["坐标X"]-1, WAR.Person[WAR.CurID]["坐标Y"]-1)
				--友军召唤
				NewWARPersonZJ(CC.TX['死葬者身份'], true, x, y, false, 2)
				WAR.PD['死葬发动'][pid] = 1
				for j = 0 , WAR.PersonNum - 1 do
					if DWPD(WAR.CurID,j) == false and dead(j) == false and WAR.Person[j]['人物编号'] == CC.TX['死葬者身份'] then
						WAR.PD['死葬者'][WAR.Person[j]['人物编号']] = pid
						WAR.PD['秘孔战术'][WAR.Person[j]['人物编号']] = 50
						WAR.LQZ[WAR.Person[j]['人物编号']] = 100
						break
					end
				end
			end	
			if WAR.PD['残火太刀'][pid] == 3 then
				str = "・西・残日狱衣"
			end	
		    if WAR.PD['残火太刀'][pid] == 4 then	
				str = "・北・天地灰烬"
				WAR.CHTD = 2
				WAR.PD['全屏攻击'][pid] = 1
			end
			for i = 40, 80 do
				NewDrawString(-1, -1, "残火太刀"..str, M_Red, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "残火太刀"..str, M_Red, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end
		end
	end
	--蓝烟清：胡家刀法，极意
    --刀系主角40%，胡斐50%，暴怒必出
    --胡一刀70%
    if wugong == 67 and level == 11 and WAR.PD["刀剑绝技"][pid] == nil and 
		(((actor(pid,4) and (BNJQ(pid) or JLSD(30,70,pid)))) or 
		(match_ID(pid, 633) and (BNJQ(pid) or JLSD(20,80,pid))) or 
		(match_ID(pid, 1) and (BNJQ(pid) or JLSD(20,70,pid))) or
		Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350)) then
        local HDJY = {"极意・伏虎式","极意・拜佛听经","极意・穿手藏刀","极意・沙鸥掠波","极意・参拜北斗","极意・闭门铁扇刀",
        "极意・缠身摘心刀","极意・进步连环刀","极意・八方藏刀式"};
		Set_Eff_Text(id, "特效文字3",HDJY[math.random(9)])
        WAR.Person[id]["特效动画"] = 6
        ng = ng + 1000
        WAR.WS = 1
        WAR.HDJY =1
        if (WAR.PD['极意攻击'][pid] or 0) < 5 then 
		  	WAR.PD['极意攻击'][pid] = 5
	  	end
    end
	--龙象大力杵
    if ((wugong == 83 and Curr_NG(pid,103)) or match_ID(pid,62)) and JLSD(20,70,pid) then	
		Set_Eff_Text(id, "特效文字3",'一大三千・大力真禅')
		ng = ng + 3000
	    WAR.WS = 1	
		if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
	  	    WAR.PD['极意攻击'][pid] = 8
	  	end
    end
	--罗汉伏魔杖法
    if ((wugong == 86 and PersonKF(pid,96)) or match_ID(pid, 577)) and JLSD(55,95,pid) then 
		Set_Eff_Text(id,"特效文字3","伏魔杖法・秦王鞭石")
		ng = ng + 1000
		WAR.BFX = 1
	    WAR.BLX = 1
	    WAR.BBF = 1
	    WAR.BZS = 1
	    if (WAR.PD['极意攻击'][pid] or 0) < 6 then 
		  	WAR.PD['极意攻击'][pid] = 6
	  	end	
    end
	--金关三花
    if ((wugong == 115 and Curr_NG(pid,249)) or match_ID(pid,64) or match_ID(pid,129)) and JLSD(25,55,pid) then	
		Set_Eff_Text(id, "特效文字3",'三花未落・乘兴来过・言有生年・未死之日')
		ng = ng + 1200
	    WAR.WS = 1	
		if (WAR.PD['极意攻击'][pid] or 0) < 6 then 
		  	WAR.PD['极意攻击'][pid] = 6
	  	end
    end
	--沧溟刀法奥义 标记修改
	if wugong == 153 and (JLSD(10,35,pid) or BNJQ(pid)) and JY.Person[164]["声望"] == 30 then
	    local size = 60
	    local x = CC.ScreenW/2;
	    local y = CC.ScreenH/2;
	    local offx = (#"【沧溟刀法奥义・霜之哀伤】")*size/4
	    local offy = size/2
	    for k = 1,10 do
	        Cat('实时特效动画')
	        Cls()
	        Cat('实时特效动画2')
	        lib.Background(0,y-50,CC.ScreenW,y+50,98)
	        DrawString(x-offx,y-offy,"【沧溟刀法奥义・霜之哀伤】",C_BLUE,size);  
	        ShowScreen();
	        lib.Delay(CC.BattleDelay)
	    end
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				if nokillspeed(j) == false then
					ztd(j,'集气位置',-(100*WAR.CM)) 
				end
			end
		end
		ng = ng + 1000
		WAR.WS = 1
		WAR.SZAS = 1
	end
	--岳王散手
	if wugong == 198 and PersonKF(pid,199) and JLSD(20,50,pid) then
		Set_Eff_Text(id, "特效文字3",'浮如云出轴・沉似石投江')
	    local zq = math.modf(TrueZF(pid) / 150)
	    WAR.WS = 1
	    if (WAR.PD['极意攻击'][pid] or 0) < zq then 
		  	WAR.PD['极意攻击'][pid] = zq
	    end	
    end
	--葵花点穴手
	if (wugong == 226 and PersonKF(pid,201) and (PersonKF(pid,127) or PersonKF(pid,126))) and JLSD(10,45,pid) then
		if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
		  	WAR.PD['极意攻击'][pid] = 8
	  	end
		Set_Eff_Text(id,1,"葵花点穴・普照向阳",56)
	end
	--天刀九问	标记修改
    if wugong == 335 then
        ng = ng + JY.Base["天书数量"] * 100
        --Set_Eff_Text(id, "特效文字3", '天刀九问')
    end
	--大伏魔九阴
	if (wugong == 342 and (Curr_NG(pid,107) or match_ID(pid,637))) and JLSD(10,55,pid) then	
		Set_Eff_Text(id, "特效文字3",'九阴拳势・威不可挡')
	    if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
		  	WAR.PD['极意攻击'][pid] = 9
	  	end
  	end		
	--剑气碧烟横	
	if WAR.LMAY == 1 then 
		local zf = math.modf(TrueZF(pid)/100) 
		if (WAR.PD['极意攻击'][pid] or 0) < zf then 
		  	WAR.PD['极意攻击'][pid] = zf
		end
    end

	--张三丰，50%机率增加气攻
    if match_ID(pid, 5) and JLSD(30, 80, pid) then
		ng = ng + get_skill_power(pid, wugong, 11)
		Set_Eff_Text(id, "特效文字3", '化朽为奇')
    end
    --王重阳，全真剑法，60%几率重阳剑气777气攻
    if match_ID(pid, 129) and JLSD(20, 80, pid) then
        ng = ng + 777
        Set_Eff_Text(id, "特效文字3", '重阳剑气')
    end
    --九字真言 斗
    if WAR.PD["斗"][pid]~= nil and WAR.PD["斗"][pid] == 1 then
        ng = ng + 800
    end
	--噩梦
	if (match_ID(pid,741) or match_ID(pid,742)) and wugong == 151 then
		if WAR.ZLJS6 == 1 then 
			ng = ng + 5000
            if (WAR.PD['极意攻击'][pid] or 0) < 15 then 
	  			WAR.PD['极意攻击'][pid] = 15
	  		end
	    end
    end	
	--竹风雨滴	
	if WAR.MMJF3 == 1 then
		local zq = math.modf(TrueYJ(pid) / 150)
	    local zq2 = TrueYJ(pid)
	    ng = ng + 1250
   		if (WAR.PD['极意攻击'][pid] or 0) < zq then 
		  	WAR.PD['极意攻击'][pid] = zq 
	    end
	end	
	--莫名剑法
	if WAR.TJFJ == 1 then
		Set_Eff_Text(id, "特效文字3", '莫名剑法・名不经传')
        local a = math.modf(JY.Person[pid]["内力"] / 10)
        ng = ng + a
        WAR.WS = 1
        if (WAR.PD['极意攻击'][pid] or 0) < 20 then 
		  	WAR.PD['极意攻击'][pid] = 20
	  	end
    end
	--车神
	if match_ID(pid,524) and JLSD(15,50,pid) then 
		Set_Eff_Text(id, "特效文字3", '车神真谛・畅通无阻')
		ng = ng + 1250
	    WAR.WS = 1	
		if (WAR.PD['极意攻击'][pid] or 0) < 8 then 
		  	WAR.PD['极意攻击'][pid] = 8
	  	end
    end
	--黯然化境
	if wugong == 25 and match_ID(pid,775) then
		Set_Eff_Text(id, "特效文字3", '黯然销魂者・唯别而已矣')
		ng = ng + 1000
	    WAR.WS = 1	
		if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
		  	WAR.PD['极意攻击'][pid] = 9
	  	end
    end
	--齐木思
	if WAR.YQQF == 3 then 
		ng = ng + 1250
		WAR.WS = 1
		if (WAR.PD['极意攻击'][pid] or 0) < 9 then 
		  	WAR.PD['极意攻击'][pid] = 9
	  	end
    end
	--喵太极，一刀流
    if (match_ID(pid,504) or match_ID(pid,92)) and (BNJQ(pid) or ZYJQ(pid)) then
	    WAR.MTJJ = 1
		WAR.LDJM = 1
		WAR.DN = 1
		local yj = math.modf(TrueYJ(pid) / 150)
		WAR.WS = 1
		ng = ng + 2000
		if (WAR.PD['极意攻击'][pid] or 0) < yj then 
		  	WAR.PD['极意攻击'][pid] = yj
		end	
		Cls()
  		ShowScreen()
    	lib.Delay(40)
        for i = 1, 30 do
		    DrawStrBox(-1, 24, "凝神奥义・天地同归", TG_Red_Bright, 10 + i)
		    ShowScreen()
		    lib.Delay(10)
	    end
    end
	--初生牛犊
	if match_ID(pid,9743) and JLSD(10,30,pid) then
		ng = ng + 1000
	    WAR.WS = 1	
		if (WAR.PD['极意攻击'][pid] or 0) < 6 then 
	  	    WAR.PD['极意攻击'][pid] = 6
	  	end
	end
	--点点领悟
	if ((JY.Person[531]["论剑奖励"] == 1 and match_ID(pid,457)) or (WAR.ZDDH == 456 and pid == 457)) and yongjian(wugong) and BNJQ(pid) then
		WAR.PD['七剑合一'][pid] = 1
		ng = ng + 777
	    WAR.WS = 1
	    if (WAR.PD['极意攻击'][pid] or 0) < 17 then 
		  	WAR.PD['极意攻击'][pid] = 17
		end
        ng = ng + 777
	    WAR.WS = 1
        Cls()
  		ShowScreen()
    	lib.Delay(40)
        for i = 1, 30 do
		    DrawStrBox(-1, 24, "无垢式・空之境界", TG_Red_Bright, 10 + i)
		    ShowScreen()
		    lib.Delay(10)
	    end
	end
    --葵花尊者必刺目
    if match_ID(pid,27) or match_ID(pid,777) or (PersonKF(pid,105) and JLSD(10,20,pid)) or (Curr_NG(pid,105) and JLSD(0,30,pid)) then
        WAR.KHBX = 2
		Set_Eff_Text(id, "特效文字3",'葵花刺目',6)
    end
    --李白七书觉醒后
	if (JXPD(pid, 636,1) or (isteam(pid) == false and match_ID(pid,636))) and yongjian(wugong) and BNJQ(pid) then
		WAR.QLJG  = 1
		ng = ng + 1500
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx = (#"【绝技・青莲剑歌】")*size/4
		local offy = size/2
		for k = 1,10 do
            Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
            lib.Background(0,y-50,CC.ScreenW,y+50,98)
            DrawString(x-offx,y-offy,"【绝技・青莲剑歌】",C_GOLD,size);  
            ShowScreen();
            lib.Delay(CC.BattleDelay)
        end
    end
	--岳老三大剪刀
    if match_ID(pid,44) and wugong == 75 and BNJQ(pid) then
		WAR.DJD  = 1
        local size = 60
        local x = CC.ScreenW/2;
        local y = CC.ScreenH/2;
        local offx = (#"【南海鳄神・大剪刀真传】")*size/4
        local offy = size/2
        for k = 1,10 do
            Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
            lib.Background(0,y-50,CC.ScreenW,y+50,98)
            DrawString(x-offx,y-offy,"【南海鳄神・大剪刀真传】",C_GOLD,size);  
            ShowScreen();
            lib.Delay(CC.BattleDelay)
        end
    end
	--袁承志觉醒后，30%几率出金蛇奥义，夏雪宜暴怒50%出
    if (JXPD(pid, 54, 1) and wugong == 40 and JLSD(10,40,pid)) or (match_ID(pid,639) and (BNJQ(pid) or JLSD(20,70,pid))) then
        WAR.JSAY = 1
        ng = ng + 1000
        for i = 0, WAR.PersonNum - 1 do
            if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
                local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
                local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
                if offset1 <= 5 and offset2 <= 5 then
                    SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
                end
            end
        end
    end
    --血战八方
    if ((WAR.XZBFZT[pid] == 1) or (((MPTX(pid,20,1)) or match_ID(pid,514)) and BNJQ(pid))) and WAR.DZXY ~= 1 and yongdao(wugong) then			
        WAR.WS = 1
		ng = ng + 888
    	if WAR.XZBFZT[pid] ~= nil then
			WAR.XZBFZT[pid] = nil
		end	
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx = (#"【刀法绝技.血战八方】")*size/4
		local offy = size/2
		for k = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.Background(0,y-50,CC.ScreenW,y+50,98)
			DrawString(x-offx,y-offy,"【刀法绝技.血战八方】",C_GOLD,size);  
			ShowScreen();
			lib.Delay(CC.BattleDelay)
		end
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
				local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
				local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
				if offset1 <= 5 and offset2 <= 5 then
					SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
				end
			end			
		end
    end
    --阿九 凤鸣九霄
    if JXPD(pid, 629,1) and BNJQ(pid) and WAR.DZXY ~= 1  then	
		ztd(WAR.CurID,"内力点数",math.modf(JY.Person[pid]["内力"]/10))
        WAR.AJFHNP =1 
        WAR.WS =1
        ng = ng + 800
        local size = 60
        local x = CC.ScreenW/2;
        local y = CC.ScreenH/2;
        local offx = (#"【凤鸣九霄.谁主沉浮】")*size/4
        local offy = size/2
        for k = 1,10 do
            Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
            lib.Background(0,y-50,CC.ScreenW,y+50,98)
            DrawString(x-offx,y-offy,"【凤鸣九霄.谁主沉浮】",C_GOLD,size);  
            ShowScreen();
            lib.Delay(CC.BattleDelay)
        end
        for i = 0, WAR.PersonNum - 1 do
            if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
                local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
                local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
                if offset1 <= 5 and offset2 <= 5 then
                    SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
                end
            end
        end
    end	
    --莫大，50%几率出七弦无形剑奥义
    if match_ID(pid, 20) and (BNJQ(pid) or JLSD(35, 85, pid)) then
		WAR.QXWXJ = 1
        ng = ng + 800
        for i = 0, WAR.PersonNum - 1 do
            if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
                local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
                local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
                if offset1 <= 4 and offset2 <= 4 then
                    SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
                end
            end
        end
    end
	--碧落九重剑
    if (match_ID(pid, 92) or (match_ID(pid,457) and JY.Person[430]["品德"] == 0) or (WAR.ZDDH == 456 and match_ID(pid,457))) 
	and yongjian(wugong) and (math.random(100) < 30 or BNJQ(pid)) then
		if (WAR.PD['极意攻击'][pid] or 0) < 9 then
			WAR.PD['极意攻击'][pid] = 9
		end 
		if JY.Person[pid]["御剑能力"] >= 500 then
			ng = ng + 1000
			Set_Eff_Text(id, "特效文字1",'碧落九重剑',6)
		end
	end
	--点点传授剑招
	if (((match_ID(pid,0) or match_ID(pid,457)) and yongjian(wugong) and JY.Person[349]["品德"] == 100) or (WAR.ZDDH == 456 and match_ID(pid,457))) and JLSD(8,36,pid) then
		for i = 0, WAR.PersonNum - 1 do
			local tmppid = WAR.Person[i]["人物编号"]
			if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
				WAR.BYCX[tmppid] =1
			 end
		end
		CurIDTXDH(WAR.CurID,181,1,"玉箫剑意・波纹音")
	end
	--陈达海青蟒剑
	if match_ID(pid, 137) and wugong == 40 then
		WAR.QMJ = 1
	end
	--陈正德三分剑法
	if (match_ID(pid, 311) or match_ID(pid, 9753)) and wugong == 29 then
		WAR.CZD = 1
	end
    --王重阳1 一气化三清
	if ((match_ID(pid, 129) and (JXPD(pid,129,1) or isteam(pid) == false)) or match_ID(pid, 9851)) and (BNJQ(pid) or JLSD(0,20,pid)) then
        WAR.YQFSQ = 1
	end
	--摄魂
	if WAR.PD['九阴摄魂'][pid] ~= nil and match_ID(pid, 634) == false then
	    CleanWarMap(4, 0)
	    local a = math.random(0,CC.WarWidth)
	    local b = math.random(0,CC.WarHeight)
	    WarDrawAtt(a,b, atkfanwei,3)
	    WAR.WS = 0
	end
	if WAR.PD['虚邪散魂2'][pid] ~= nil then
	    CleanWarMap(4, 0)
	    local a = math.random(0,CC.WarWidth)
	    local b = math.random(0,CC.WarHeight)
	    WarDrawAtt(a,b, atkfanwei,3)
	    WAR.WS = 0
	end
    if WAR.PD['唯识剑意1'][pid] ~= nil then
	    CleanWarMap(4, 0)
	    local a = math.random(0,CC.WarWidth)
	    local b = math.random(0,CC.WarHeight)
	    WarDrawAtt(a,b, atkfanwei,3)
	    WAR.WS = 0
	end
		-----------------------------------------------------------------------------------------------------------------
		-----------------------------------------------奇穴攻击后效果----------------------------------------------------
		-----------------------------------------------------------------------------------------------------------------
    	--拳掌
    	if yongquan(wugong) and QUANQX(pid,'济世为怀') >= 1 and JLSD(20,50,pid) then
			WAR.QFMQX[pid] = 5 * QUANQX(pid,'济世为怀')
		end

		if yongquan(wugong) and QUANQX(pid,'恩泽苍生') >= 1 and JLSD(20,50,pid) then
			WAR.QFNQX[pid] = 5*QUANQX(pid,'恩泽苍生')
		end 	
		
		if yongquan(wugong) and QUANQX(pid,'名动山河') >= 1 and JLSD(20,50,pid) then
			ztd(WAR.CurID,"体力点数",5*QUANQX(pid,'名动山河'))
		end
		--指法
		if yongzhi(wugong) and ZHIQX(pid,'天惊石破') >= 1 and JLSD(20,50,pid) then	
			local a = 2
			if ZHIQX(pid,'天惊石破') >= 3 then
				a = 8
			elseif ZHIQX(pid,'天惊石破') == 2 then
			    a = 4
			end
			WAR.PD['时序闪避'][pid] = (WAR.PD['时序闪避'][pid] or 0) + a
		end 
		if yongzhi(wugong) and ZHIQX(pid,'鬼啸问天') >= 1 then
			WAR.PD['必命中'][pid] = 1
		end
		--剑法
		if yongjian(wugong) and JIANQX(pid,'意转乾坤') >= 1 and JLSD(20,50,pid) then
			ztd(WAR.CurID,"生命点数",math.modf(JIANQX(pid,'意转乾坤')*10)+40)
		end 
		
		if yongjian(wugong) and JIANQX(pid,'情意归心') >= 1 and JLSD(20,50,pid) then
			ztd(WAR.CurID,"体力点数",JIANQX(pid,'情意归心'))
		end 
		--刀法
		if yongdao(wugong) and DAOQX(id,'太虚') >= 1 and JLSD(10,50,pid) then
			local a = DAOQX(id,'太虚')*20*0.01
			local b = (DAOQX(id,'太虚')+5)*2*0.01
			ng = ng + math.modf(ng*a)
			ztd(WAR.CurID,'内力点数',math.modf(psx(pid,'内力最大值')*b))
		end
		if yongdao(wugong) and DAOQX(pid,'象盘古') >= 1 then
			local jl = math.modf(5*(DAOQX(id,'象盘古')+2))
			local fw = DAOQX(id,'象盘古') * 5
			local c = math.modf(5*(DAOQX(id,'象盘古')+1))
			if JLSD(0,jl,pid) then
				if (WAR.PD['极意攻击'][pid] or 0) < fw then
					WAR.PD['极意攻击'][pid] = fw
				end
				addbuff(pid,WAR.PD['战神状态'],c)
			end
		end
		if yongdao(wugong) and DAOQX(pid,'菩提间') >= 1 then
			local jl = DAOQX(pid,'菩提间')*0.1
			if JLSD(0,jl,pid) then
				for j = 0, WAR.PersonNum-1 do 
					if dead(j) == false and DWPD(WAR.CurID,j) == false then
						Cat('清除中级异常',j)
					end
				end
			end			
		end	
		if yongdao(wugong) and DAOQX(pid,'虚影刀') >= 1 and JLSD(10,45,pid) then
			local a= DAOQX(pid,'虚影刀')*2
			addbuff(pid,WAR.PD['时序闪避'],a)
		end
		if yongdao(wugong) and DAOQX(pid,'惊鸿刀') >= 1 and JLSD(10,45,pid) then
			local a= DAOQX(pid,'惊鸿刀')*5
			addbuff(pid,WAR.PD['集气速度'],a)
		end	
		if yongdao(wugong) and DAOQX(pid,'殊狂刀') >= 1 and JLSD(10,45,pid) then
			local a= (DAOQX(pid,'疏狂刀')*2)+4
			nuqi(pid,a)
		end
		if yongdao(wugong) and BNJQ(pid) and DAOQX(pid,'开天地') == 1 then
			WAR.PD['全屏攻击'][pid] = 1
		end	
		if yongdao(wugong) and JLSD(10,40,pid) and DAOQX(pid,'定沧海') == 1 then
			for j = 0, WAR.PersonNum -1 do
				if dead(j) == false and DWPD(WAR.CurID,j) then
					WAR.PD['真利刃寒锋'][WAR.Person[j]['人物编号']] = 15
				end
			end
		end
		if yongdao(wugong) and math.random(100) > 75 and DAOQX(pid,'斩云空') == 1 then
			nuqi(pid,100)
			WAR.SPIRIT[pid] = 200
			local jx = 0
			for j = 0, WAR.PersonNum -1 do
				if dead(j) == false  then
					jx = jx + (WAR.LQZ[WAR.Person[j]['人物编号']] or 0) + (WAR.SPIRIT[WAR.Person[j]['人物编号']] or 0)
					if DWPD(WAR.CurID,j) then
						WAR.LQZ[WAR.Person[j]['人物编号']] = 0
						WAR.SPIRIT[WAR.Person[j]['人物编号']] = 20
					end	
				end
			end
			if jx > 0 then
				for j = 0, WAR.PersonNum -1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						ztd(j,'生命点数',-jx)
					end
				end
			end	
		end			
		--奇门奇穴
		if yongte(wugong) and QIQX(pid,'九龙天') > 0 and JLSD(10,35,pid) and WAR.PD['九龙天'][pid] == nil then
			WAR.BTZT[pid] = 1
			WAR.PD['九龙天'][pid] = 1
		end	

		 ------------------------------------------------------------------------------------
		------------------------------组合全屏攻击------------------------------------------
		------------------------------------------------------------------------------------
		--独孤九剑	
		if WAR.DGJJ_LDXJ == 1 and WAR.ACT == 1 then 
			WAR.PD['全屏攻击'][pid] = 1
			local a = math.modf(JY.Person[pid]["内力"] / 10)
			ng = ng + a
			Cls()
			ShowScreen()
			lib.Delay(40)
			for i = 1, 30 do
				DrawStrBox(-1, 24, "独孤奥义・九剑归一", M_DeepSkyBlue, 10 + i)
				ShowScreen()
				lib.Delay(10)
			end
		end
		--越女剑法必全屏
		if (wugong == 156 and WGZH(pid,156,188)) or WAR.YYLMJJF == 1 then 
			WAR.PD['全屏攻击'][pid] = 1
			Set_Eff_Text(id, "特效文字1",'一人一竹・千军止步')
		end
		--圣火阴风
		if wugong == 174 and PersonKF(pid,93) then	
			WAR.HSYFD = 1
			if JLSD(20,50,pid) then
				WAR.HSYFD = 2
				WAR.PD['全屏攻击'][pid] = 1
				Set_Eff_Text(id, "特效文字1",'万解・白霞罚')
			end
	    end
		--天刀九问第七问
		if wugong == 335 and (WAR.TDJW == 7 or WAR.TDJW == 10) then
			WAR.PD['全屏攻击'][pid] = 1	
            WAR.Person[id]["特效动画"] = 19
		end
		--狂风迅雷扇
		if wugong == 341 and WAR.BLJJ == 8 then
			WAR.PD['全屏攻击'][pid] = 1
        end
		--万剑归宗
		if ((wugong == 374 and PersonKF(pid,106) and PersonKF(pid,107)) or match_ID(pid,520)) and JLSD(20,50,pid) then
			WAR.PD['全屏攻击'][pid] = 1
		end

		--观止
		if match_ID(pid,456) then
			Set_Eff_Text(id, "特效文字3",'观海潮・无量无界')
			WAR.PD['全屏攻击'][pid] = 1
		end
		if WAR.PD['幽冥血河2'][pid] ~= nil then
			local x1 = WAR.Person[WAR.CurID]["坐标X"];
			local y1 = WAR.Person[WAR.CurID]["坐标Y"];
			for ex = x1 - 5, x1 + 5 do
				for ey = y1 - 5, y1 + 5 do
					SetWarMap(ex, ey, 4, 1)
					if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
						local ep = GetWarMap(ex, ey, 2)
					end
				end
			end
			local nuqi = WAR.LQZ[pid] or 0
			if JLSD(10,nuqi+20,pid) or BNJQ(pid) then
				if WAR.PD['精神错乱'][pid] == nil then
					WAR.PD['精神错乱'][pid] = 5
				end
				local list = {}
				for q = 0, WAR.PersonNum - 1 do
					if WAR.Person[q]["死亡"] == false and DWPD(WAR.CurID,q) == false then
						table.insert(list,q)
					end			
				end
				local F_target
				--随机选取一个友方目标
				if list[1] ~= nil then
					F_target = list[math.random(#list)]
					SetWarMap(WAR.Person[F_target]['坐标X'],WAR.Person[F_target]['坐标Y'],4,2)
				end
			end
		end	
		--剑荡十方
		if (WAR.PD["剑荡十方"][pid] or 0) >= 10 then
			if yongjian(wugong) then
				WAR.PD['全屏攻击'][pid] = 1
			end
		end
		--无天绝剑
		if WAR.WTJJ14 == 1 then
			WAR.PD['全屏攻击'][pid] = 1
		end 
		--齐木思
		 if wugong == 110 and match_ID(pid,776) and JLSD(20,70,pid) then 
			WAR.SSJF = 1
			WAR.PD['全屏攻击'][pid] = 1
			for i = 40, 80 do
				NewDrawString(-1, -1, "神山剑诀・一剑镇神州", C_GOLD, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "神山剑诀・一剑镇神州", C_GOLD, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end	
		end 	
		--真龙心法概率全屏攻击
		if (PersonKF(pid,281) and inteam(pid) and JY.ZLXF == 1) or match_ID(pid,524) or match_ID(pid,776) then
			WAR.WS = 1
			local qpjl = math.modf(((JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"]) / JY.Person[pid]["生命最大值"]) * 50)
			if JLSD(10,50 + qpjl,pid) then
				WAR.PD['全屏攻击'][pid] = 1
				Set_Eff_Text(id, "特效文字3",'【龙威镇天地】')
			end 
		end
		--攻击范围变更
		if (WAR.PD['全屏攻击'][pid] ~= nil or WAR.PD['九龙天'][pid] ~= nil) and WAR.PD['大小幽明'][pid] == nil then
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
					SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
				end
			end
		elseif WAR.PD['全屏攻击'][pid] == nil and WAR.PD['极意攻击'][pid] ~= nil and WAR.PD['大小幽明'][pid] == nil then
			local a = WAR.PD['极意攻击'][pid]
			WAR.WS = 1
			for i = 1, a do
				for j = 1, a do
					SetWarMap(x + i - 1, y + j - 1, 4, 1)
					SetWarMap(x - i + 1, y + j - 1, 4, 1)
					SetWarMap(x + i - 1, y - j + 1, 4, 1)
					SetWarMap(x - i + 1, y - j + 1, 4, 1)
				end
			end
		end	
    -----------------对招---------------and match_ID(WAR.Person[j]["人物编号"],0)
		if ZHEN_ID >= 0 and WAR.DUIZHAO > 9 and (WAR.PD['无常索命诀'][pid][5] == nil or WAR.PD['无常索命诀'][pid][5] ~= 1) then
            local tmp_id = WAR.CurID
            WAR.CurID = ZHEN_ID
			local dzid = WAR.Person[ZHEN_ID]["人物编号"] 
			local bdzid = WAR.Person[tmp_id]["人物编号"] 
			SetWarMap(WAR.Person[tmp_id]["坐标X"], WAR.Person[tmp_id]["坐标Y"], 4, 1)
			if WAR.DUIZHAO == 10 then--东方对招and math.random(10) > 6 
				--local dzid = 
				WAR.PD['麻痹状态'][bdzid] = (WAR.PD['麻痹状态'][bdzid] or 0) + 2
				WAR.PD["蛇行狸翻"][bdzid] = limitX((WAR.PD["蛇行狸翻"][bdzid] or 0) + 5,0,40)
				WAR.ZTHF[dzid] = limitX((WAR.ZTHF[dzid] or 0) + 10,0,40)
				WAR.PD["冰冻状态"][dzid] = nil
				WAR.PD["迟缓状态"][dzid] = nil
			elseif WAR.DUIZHAO == 20  then--大王对招and math.random(10) > 6
				if math.random(10) < 4 then
					WAR.PD["昏迷状态"][bdzid] = 1
				elseif JLSD(10,45,dzid) then
					addbuff(bdzid,WAR.PD['重度内伤'],10,15)
				end
				WAR.PD["神兵"][dzid] = (WAR.PD["神兵"][dzid] or 0) + 30 
				WAR.PD["入魔"][dzid] = 1
			elseif WAR.DUIZHAO == 30  then --老张对招	and math.random(10) > 6
				WAR.PD["洞火"][bdzid] = 1
				WAR.PD["封印"][bdzid] = 8
				WAR.PD["长生诀"][dzid] = limitX((WAR.PD["长生诀"][dzid] or 0) + 20,0,100)
				WAR.CSHF[dzid] = limitX((WAR.CSHF[dzid] or 0) + 20,0,100)
			elseif  WAR.DUIZHAO == 40 then --扫地对招	and math.random(10) > 6 
				WAR.PD["放下屠刀"][bdzid] = math.random(5)
				WAR.PD['业障缠身'][bdzid] = 1
				if math.random(10) < 5 then
					WAR.PD["金刚护盾"][dzid] = limitX((WAR.PD["金刚护盾"][dzid] or 0) + 400,0,3000)
				end
				WAR.PD["无形气墙"][dzid] = (WAR.PD["无形气墙"][dzid] or 0) + 800
				WAR.PD["万佛朝宗"][dzid] = 1
			elseif  WAR.DUIZHAO == 50 then --斗转对招
				local a = math.modf(get_skill_power(bdzid,wugong,11)*0.5)
				local b = math.modf(psx(dzid,'内力')*0.1)
				if kfkind > 0 and kfkind < 6 then
				else
					a = math.modf(a*0.5)
				end	
				ztd(tmp_id,"生命点数",-math.modf(a+b))		
			elseif WAR.DUIZHAO == 60  then --竹风雨滴对招	and math.random(10) > 6
			    WAR.PD["天绝剑气"][bdzid] = math.random(15,20)
			    WAR.PD["万剑归宗"][bdzid] = math.random(15,20)
				WAR.PD["威慑"][bdzid] = 10
				WAR.PD["战神状态"][dzid] = limitX((WAR.PD["战神状态"][dzid] or 0) + 20,0,100)
				WAR.BTZT[dzid] = 1
			end 
			WAR.CurID = tmp_id
		end
		
		if math.random(10) < 4 and WAR.DUIZHAO == 0 and (WAR.PD['无常索命诀'][pid][5] == nil or WAR.PD['无常索命诀'][pid][5] ~= 1) then	
			--JY.Base["单通"] == 1 and
			local dzzr = {}
			local n = 0
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false  then
					if match_ID(WAR.Person[j]["人物编号"],27) or match_ID(WAR.Person[j]["人物编号"],50) or match_ID(WAR.Person[j]["人物编号"],5) 
					or match_ID(WAR.Person[j]["人物编号"],114) or match_ID(WAR.Person[j]["人物编号"],520) or match_ID(WAR.Person[j]["人物编号"],777)
					or psx(WAR.Person[j]["人物编号"],"门派技能3") == 2 or (WAR.Person[j]["人物编号"] == 0 and psx(0,"门派技能3") == 2) then
						dzzr[#dzzr+1] = j
					end
				end	
				WAR.WS = 1	
			end
			if #dzzr > 0 then
				n = dzzr[math.random(#dzzr)]
				CleanWarMap(4, 0)
				SetWarMap(WAR.Person[n]["坐标X"], WAR.Person[n]["坐标Y"], 4, 1)
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 4, 1)
				ZHEN_ID = n
				if ZHEN_ID >= 0 then
					WarDrawAtt(WAR.Person[ZHEN_ID]["坐标X"] + x0 - x, WAR.Person[ZHEN_ID]["坐标Y"] + y0 - y, atkfanwei, 3)
				end
				local nid = WAR.Person[n]["人物编号"]
				if match_ID(nid,27) or match_ID(nid,777) then
					WAR.DUIZHAO = 10
					WAR.PD['麻痹状态'][pid] = (WAR.PD['麻痹状态'][pid] or 0) + 2
					WAR.PD["蛇行狸翻"][pid] = (WAR.PD["蛇行狸翻"][pid] or 0) + math.random(8)
					WAR.ZTHF[nid] = 20
					WAR.PD["冰冻状态"][nid] = nil
				    WAR.PD["迟缓状态"][nid] = nil
				elseif match_ID(nid,50) then	
					WAR.DUIZHAO = 20
					if math.random(10) < 4 then
						WAR.PD["昏迷状态"][pid] = 1
					elseif JLSD(10,45,nid) then
						addbuff(pid,WAR.PD['重度内伤'],10,15)
					end
					WAR.PD["神兵"][nid] = (WAR.PD["神兵"][nid] or 0) + 30 
					WAR.PD["入魔"][nid] = 1
				elseif 	match_ID(nid,5) then
					WAR.DUIZHAO = 30
					WAR.PD["洞火"][pid] = 1
					WAR.PD["封印"][pid] = 8
					WAR.PD["长生诀"][nid] = 100   
					WAR.CSHF[nid] = 100
				elseif 	match_ID(nid,114) then
					WAR.DUIZHAO = 40
					WAR.PD["放下屠刀"][pid] = math.random(5)
					WAR.PD['业障缠身'][pid] = 31
					if math.random(10) < 5 then
						WAR.PD["金刚护盾"][nid] = limitX((WAR.PD["金刚护盾"][nid] or 0) + 400,0,2000)
					end
					WAR.PD["无形气墙"][nid] = (WAR.PD["无形气墙"][nid] or 0) + 800
					WAR.PD["万佛朝宗"][nid] = 1
				elseif psx(nid,"门派技能3") == 2 or (nid == 0 and psx(0,"门派技能3") == 2) then --斗转对招
				    local a = math.modf(get_skill_power(pid,wugong,11)*0.5)
					local b = math.modf(psx(nid,'内力')*0.1)
					if kfkind > 0 and kfkind < 6 then
					else
					    a = math.modf(a*0.5)
					end	
					ztd(WAR.CurID,"生命点数",-math.modf(a+b))	
				    WAR.DUIZHAO = 50
				elseif 	match_ID(nid,520) then
					WAR.DUIZHAO = 60
					WAR.PD["天绝剑气"][pid] = math.random(15,20)
			        WAR.PD["万剑归宗"][pid] = math.random(15,20)
					WAR.PD["威慑"][pid] = 10
					WAR.PD["战神状态"][nid] = 100   
					WAR.BTZT[nid] = 1
				end
			end				
		end
		-----------------------------------------------------人物出手特效-----------------------------------------
		local pz = math.modf(JY.Person[0]["实战"] / 25)
		--无酒不欢：斗转第四层，幻梦星辰，反击全体
        if WAR.DZXYLV[pid] == 80 then
            CleanWarMap(4, 0)
            for i = 0, WAR.PersonNum - 1 do
                if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
                    SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
                end
            end
        end
        --斗转大招
		if WAR.DZXYLV[pid] == 150 then
            CleanWarMap(4, 0)
            for i = 0, WAR.PersonNum - 1 do
                if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
                    SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
                end
            end
			for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, "斗转星移・耀若日星", C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end
        end
        --屠龙刀特效一，追加等同于武功威力的杀气
        if WAR.L_TLD == 1 then
            ng = ng + get_skill_power(pid, wugong, 11)
        end

        --鸠摩智  使用火焰刀法，加内伤30，加杀集气800
        --普通角色使用有30%的机率
        --刀主二次判定
        if wugong == 66 and level == 11 and (match_ID(pid, 103) or match_ID(pid, 9873) or JLSD(30,60,pid) 
			or (actor(pid,4) and JLSD(30,70,pid))) then
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,'内伤点数',30)
                end
            end
			Set_Eff_Text(id,"特效文字1","大轮密宗・火焰刀")
            WAR.Person[id]["特效动画"] = 58
            ng = ng + 800
        end
        --井月八法 寇仲
        if match_ID(pid,578) and yongdao(wugong) then
            local df = 0
            for i = 1, JY.Base["武功数量"] do
                if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 4 and JY.Person[0]["武功等级" .. i] == 999 then
                    df = df + 1
                end
            end
			ng = ng + 200*df
        end
        --步惊云 排云掌
        if match_ID(pid, 584) and yongquan(wugong)  then
            local DFWZ = {"一式『流水行云』", "二式『披云戴月』", "三式『翻云覆雨』", "四式『排山倒海』", "五式『乌云蔽日』", "六式『重云深锁』", "七式『撕天排云』", "八式『云海波涛』", 
            "九式『燮云无定』", "十式『殃云天降』", "十一式『云莱仙境』","十二式『愁云惨淡』"}
            if isteam(pid) then
                WAR.BJYPYZ = math.random(0, JY.Base["天书数量"])
                if WAR.BJYPYZ > 12 then
                    WAR.BJYPYZ = 12
                end
                --保底天书数量-5
                if JY.Base["天书数量"] > 5 then
                    if WAR.BJYPYZ < JY.Base["天书数量"] - 5 then
                        WAR.BJYPYZ = JY.Base["天书数量"] - 5
                    end
                end
            else
                WAR.BJYPYZ = math.random(1, 10)
            end
            if WAR.BJYPYZ > 0 then
                ng = ng + (1000 + WAR.BJYPYZ * 50)
				Set_Eff_Text(id,"特效文字0","排云掌・"..DFWZ[WAR.BJYPYZ])
            end
        end	
        --步惊云 圣灵剑法15~22 "圣灵・『剑十』", "圣灵・『剑十一』", "圣灵・『剑十二』", "圣灵・『剑十三』", "圣灵・『剑十四』","圣灵・『剑十』", "圣灵・『剑十一』", 
            --"圣灵・『剑十二』", "圣灵・『剑十三』", "圣灵・『剑十四』",
        if match_ID(pid, 584) and yongjian(wugong) and WAR.SL23 == 0 then
            local txwz = { "圣灵・『剑十五』", "圣灵・『剑十六』", "圣灵・『剑十七』", 
            "圣灵・『剑十八』", "圣灵・『剑十九』", "圣灵・『剑廿』", "圣灵・『剑廿一』", "圣灵・『剑廿二』"}
            if isteam(pid) then
                WAR.BJYJF = math.random(0, JY.Base["天书数量"])
                --保底天书数量-5
                if JY.Base["天书数量"] > 8 then
                    if WAR.BJYJF < JY.Base["天书数量"] - 8 then
                        WAR.BJYJF = JY.Base["天书数量"] - 8
                    end
                        if WAR.BJYJF > 8 then
                    WAR.BJYJF = 8
                end
                end
            else
                WAR.BJYJF = math.random(1, 8)
            end
            if WAR.BJYJF > 0 then
                ng = ng + (1000+ WAR.BJYJF * 80)
				Set_Eff_Text(id,"特效文字0",txwz[WAR.BJYJF])
            end
        end
		--逍遥子梅花三弄
        if  match_ID(pid,634) then
            local txwz = {"一", "二", "三"}	
            WAR.MHSN = math.random(1,3)
			if WAR.MHSN > 0 then
				for j = 0, WAR.PersonNum - 1 do
					local id = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if WAR.MHSN == 1 and WAR.ACT == 1 then
							WAR.PD["玄铁剑创"][id] = (WAR.PD["玄铁剑创"][id] or 0) + 5
						elseif WAR.MHSN == 2 and WAR.ACT == 1 then 	
						    ztd(j,"内力点数",-math.modf(JY.Person[id]["内力最大值"] * 0.05)) 
						elseif WAR.MHSN == 3 and WAR.ACT == 1 then 
						    ztd(j,"集气位置",-300) 	
						end
					end
				end
				ng = ng + WAR.MHSN * 150
				Set_Eff_Text(id,"特效文字1","梅花"..txwz[WAR.MHSN].."弄")
			end
		end
        --步惊云 圣灵剑法1-9
        if match_ID(pid, 584) and yongjian(wugong) and WAR.BJYJF < 1 and WAR.SL23 == 0  then
            local zs = {"圣灵・『剑一』", "圣灵・『剑二』", "圣灵・『剑三』", "圣灵・『剑四』", "圣灵・『剑五』", "圣灵・『剑六』", "圣灵・『剑七』", "圣灵・『剑八』", 
            "圣灵・『剑九』",}
			Set_Eff_Text(id,"特效文字1",zs[math.random(9)])
            ng = ng +1000
        end	
        --郭靖，降龙连击时随机后劲，有余不尽
        if (match_ID(pid, 55) or match_ID(pid, 9865)) and wugong == 26 and WAR.ACT > 1 then
            local txwz = {"一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一","十二","十三"}
            if isteam(pid) then
                WAR.YYBJ = math.random(0, JY.Base["天书数量"])
                if WAR.YYBJ > 13 then
                    WAR.YYBJ = 13
                end
                --保底天书数量-7
                if JY.Base["天书数量"] > 7 then
                    if WAR.YYBJ < JY.Base["天书数量"] - 7 then
                        WAR.YYBJ = JY.Base["天书数量"] - 7
                    end
                end
            else
                WAR.YYBJ = math.random(3,13)
            end
            if WAR.YYBJ > 0 then
                ng = ng + WAR.YYBJ * 150
				Set_Eff_Text(id,"特效文字1","降龙・有余不尽・"..txwz[WAR.YYBJ].."重后劲")
            end
        end

        --万佛朝宗	标记修改
        if match_ID(pid,577) and WAR.DZXY ~= 1 and (JLSD(20,45,pid) or WAR.WFCZ >= 5) then
        WAR.PD["万佛朝宗"][pid] = 1
        TXWZXS("万佛朝宗", C_GOLD)
			if WAR.WFCZ >= 5 then
				WAR.WFCZ = 0
			end
		end
        --仁者
        if actor(pid,7) and JY.Person[pid]["品德"] >= 100 then
            WAR.SEYB = 1
            TXWZXS("仁者无敌", M_DeepSkyBlue)
        end
		--陆无双 五毒
        if JXPD(pid,580,1) and (JLSD(20,70,pid) or BNJQ(pid)) then
			WAR.LWSWD = 1 
			Set_Eff_Text(id,"特效文字1","五毒真经")
        end
		--文泰来 雷动九天
        if (match_ID(pid,151) or match_ID(pid,9847)) and BNJQ(pid) then
			WAR.LDJT = 1 
			Set_Eff_Text(id,"特效文字1","雷动九天")
        end	
        --黄赏 万寿道藏，大伏魔拳
        if (match_ID(pid, 637) or match_ID(pid, 9929)  or wugong==342) and (JLSD(10,30+JY.Base["天书数量"],pid) or BNJQ(pid)) then
            WAR.DFMQ = 1
            WAR.WS = 1
			Set_Eff_Text(id,"特效文字1","损有余而补不足")
        end
        --阿青，天元剑气
        if (match_ID(pid, 604) or match_ID(pid, 9806)) and yongjian(wugong) then
            WAR.TYJQ = 1
			Set_Eff_Text(id,"特效文字1","天元剑气")
		end 
		--达摩普攻
		if match_ID(pid,9939) or match_ID(pid,577) then	
			for j = 0, WAR.PersonNum - 1 do
				local df = WAR.Person[j]["人物编号"] 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					addbuff(df,WAR.PD['玄铁剑创'],5)
					ztd(j,'生命点数',-math.modf(JY.Person[df]["生命最大值"]*2/100))
				end
			end
		end	
		--浩然罡气	
        if match_ID(pid, 9946) and yongte(wugong) and JLSD(0,50,pid) then
            WAR.PD["浩然罡气"][pid] = 1
			Set_Eff_Text(id,"特效文字1","浩然罡气")
        end 
	    --五六七 以气运剪 标记修改		
        if match_ID(pid, 9918) and wugong==75 then
            WAR.PD["以气运剪"][pid] = 1
			Set_Eff_Text(id,"特效文字2","以气运剪")
        end 
        --独孤无视一半剑系
        if match_ID(pid,592) then
            WAR.WWWJ = 1
        end
        --般若金刚掌
        if (wugong == 22 or wugong == 189) and JinGangBR(pid) then
            WAR.PD["金刚般若"][pid] = 1
        end
		--混元一气9795
        if WGZH(pid,306,90) then
			WAR.HYYQ = 1   
			Set_Eff_Text(id,"特效文字1","混元一气")
        end
    	--世尊降魔
    	if ShiZunXM(pid) then
       		local ex_chance = 0
        	if JY.Person[pid]["武器"] == 323 then
                ex_chance = JY.Thing[323]["装备等级"] * 2
        	end
       		if (wugong == 96 or wugong == 86 or wugong == 82 or wugong == 194 ) and (JLSD(20,60+ex_chance,pid) or BNJQ(pid)) then
           		WAR.SZXM = 1
				Set_Eff_Text(id,"特效文字0","世尊降魔")
       		end
    	end	
    	--阿九 凤鸣九宵
        if match_ID(pid, 629) and  WAR.AJFHNP == 1 then
        	WAR.Person[id]["特效动画"] = 154
        end	
        --宁中则 玉女十九剑
        if match_ID(pid, 649) and yongjian(wugong) then
            WAR.YLSJJ = 1
			Set_Eff_Text(id,"特效文字1","玉女十九剑")
			if JLSD(20,80,pid) or BNJQ(pid) then
				WAR.NZZ1 = 1
				Set_Eff_Text(id,"特效文字0","宁氏一剑・无双无对")
			end
        end
        --陆渐海之道，上善若水，敌方系数按0算
        if JXPD(pid,497,1)  and JY.Base["天书数量"] > 9 and BNJQ(pid) then
            WAR.HZD_1 = 1
			Set_Eff_Text(id,"特效文字0","上善若水")
        end
		--陆渐金刚法相
        if match_ID(pid, 497) then
            WAR.JGFX[pid] = 100
        end
		--林殊概率引燃
        if match_ID(pid,508) and JLSD(20,30,pid) then
            WAR.JuHuo = 1
        end	
		--丁当，平时50%几率，暴怒必出
        if JXPD(pid,581,1) and wugong == 61 and JLSD(20,40,pid) then
            Set_Eff_Text(id,"特效文字1","举火燎原")
            WAR.JuHuo = 1
        end
        --林朝英，流风回雪
        if match_ID(pid, 605) and JLSD(20, 80, pid) then
            WAR.LFHX = 1
			Set_Eff_Text(id,"特效文字3","流风回雪")
        end
        --进阶泰山，使用后20时序内闪避
        if wugong == 31 and WYJJ(pid) then
			if JLSD(20,40,pid) then
				if WAR.PD['时序闪避'][pid] == nil then
					WAR.PD['时序闪避'][pid] = 20 
				end
				Set_Eff_Text(id,"特效文字1","峻岭横空")
			end
        end	
        --无酒不欢：利刃寒锋，修罗+阴风+沧溟，冻结效果，平时50%几率，暴怒必出
        if (wugong == 58 or wugong == 174 or wugong == 153) and WGZH(pid,58,174) and JLSD(0,50,pid) then
            Set_Eff_Text(id,"特效文字1","利刃寒锋")
            WAR.LiRen = 1
        end
        --无酒不欢：举火燎原，金乌+燃木+火焰刀，引燃效果，平时50%几率，暴怒必出
        if ((wugong == 61 or wugong == 65 or wugong == 66) and WGZH(pid,61,65)) 
			or ((match_ID(pid,505) or match_ID(pid,9977)) and JLSD(0,50,pid)) then
            Set_Eff_Text(id,"特效文字1","举火燎原")
            WAR.JuHuo = 1
        end
		--使用奇门攻击
		if yongte(wugong) then
			local r = math.random(3)
			if r == 1 then
				WAR.PD["奇门内伤"][pid] = 1
			end
			if r == 2 then
				WAR.PD["奇门流血"][pid] = 1
			end
			if r == 3 then
				WAR.PD["奇门封穴"][pid] = 1
			end
		end
        --逍遥御风
        if XiaoYaoYF(pid) and JLSD(20,70,pid) and (WAR.XYYF[pid] == nil or WAR.XYYF[pid] < 9) and WAR.YFCS < 3 and WAR.PD['逍遥御风闪避'][pid] == nil then
			local str = "逍遥御风"
			WAR.YFCS = WAR.YFCS + 1
			WAR.XYYF[pid] = (WAR.XYYF[pid] or 0) + 1
			if MPTX(pid,7) and Curr_QG(pid,147) and WAR.XYYF[pid] >= 8 then
				WAR.XYYF[pid] = 11
				WAR.PD['逍遥御风闪避'][pid] = 20
				str = "逍遥御风・迅"
			elseif WAR.XYYF[pid] == 9 then
				WAR.XYYF[pid] = 11
				WAR.PD['逍遥御风闪避'][pid] = 10
				str = "逍遥御风・迅"
			end
			Set_Eff_Text(id,"特效文字0",str,153)
        end
        --一灯用一阳指，无明业火
        if match_ID(pid, 65) and wugong == 17 then
			WAR.WMYH = 1
			Set_Eff_Text(id,"特效文字1","无明业火")
        end
        --王重阳1，同归剑法
        if wugong == 39 and JLSD(20,60,pid) and match_ID(pid, 129) then
            WAR.TGJF = 1
			Set_Eff_Text(id,"特效文字1","同归剑法")
        end
        --周伯通空明之武道使敌方不会护体，初始几率25%，每20点实战+1%几率
        if (match_ID(pid, 64) or match_ID(pid,9854)) and JLSD(20, 45 + math.modf(JY.Person[pid]["实战"]/20), pid) then
            WAR.KMZWD = 1
			Set_Eff_Text(id,"特效文字1","空明之武道")
        end
		--先天九阴，50%几率使敌方不会护体
	    if NGQHB(pid,100) and JLSD(20,70,pid) then
		    WAR.XTQKG = 1
			Set_Eff_Text(id,"特效文字1","吸纳天地")
        end
        --琴棋书画：持瑶琴，不加怒
        if (wugong == 73 and WGZH(pid,72,73)) or match_ID(pid, 115) or (wugong == 73 and match_ID(pid, 73)) then
            WAR.QQSH1 = 1
			Set_Eff_Text(id,"特效文字1","琴音悦耳")
            --50%几率触发清怒
            if JLSD(20, 70, pid) then
                WAR.QQSH1 = 2
				Set_Eff_Text(id,"特效文字1","菩提清心")
            end
        end
        --琴棋书画：妙笔丹青，冰封
        if (wugong == 142 and WGZH(pid,72,73)) or match_ID(pid, 115) then
            --60%几率冰封
            if JLSD(20, 80, pid) then
                WAR.QQSH2 = 1
				Set_Eff_Text(id,"特效文字3","画地为牢")
            end
            --30%几率大冰封
            if JLSD(30, 60, pid) then
                WAR.QQSH2 = 2
				Set_Eff_Text(id,"特效文字3","江山如画")
            end
        end
        --琴棋书画：倚天屠龙功，50%几率出特效，伤害提高20%，必封穴
        if ((wugong == 84 and WGZH(pid,72,73)) and JLSD(20, 70, pid)) or match_ID(pid, 115) then
            WAR.QQSH3 = 1
			Set_Eff_Text(id,"特效文字3","秉笔直书")
        end
		--天狼啸月
        if JY.Person[pid]["武器"] == 320 or (PersonKF(pid, 159) and PersonKF(pid, 160) and JLSD(20,80,pid)) then
            Set_Eff_Text(id,"特效文字1","天狼啸月");
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false  then
                    if nokillspeed(j) == false then
						ztd(j,'集气位置',-100)
					end	
					addbuff(WAR.Person[j]["人物编号"],WAR.PD['灵蛇拳'],5,15)
                end
            end
        end
		--无酒不欢：狮子吼
        --狮子吼故意分开写，解决大雷音印与斗战狮吼的触发问题
        if WAR.SZH > 0 or WAR.LHFM == 1 then
			if WAR.Person[id]["特效动画"] == -1 then
				WAR.Person[id]["特效动画"] = math.fmod(92, 10) + 85
			end
			local nl = JY.Person[pid]["内力"];
			local force = 50
			if Curr_NG(pid, 92) or Curr_NG(pid,91) or WAR.LHFM == 1 then
				force = 100
			end
			--一般人需要内力差大于1000，而谢逊只要内力差大于0即可
			local neilicha = 1000
			if match_ID(pid, 13) then
				neilicha = 0
			end
			if JY.Person[pid]["性别"] ~= 0 then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false and (nl - JY.Person[WAR.Person[j]["人物编号"]]["内力"]) > neilicha then
						ztd(j,'集气位置',-(force*2)) 
						if Curr_NG(pid, 92) then
							ztd(j,"内伤点数",math.random(10,18))
						end
					end
				end
				ztd(WAR.CurID,"内力点数",-180)
				Set_Eff_Text(id,"特效文字2","河东狮吼");		
			else
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false and (nl - JY.Person[WAR.Person[j]["人物编号"]]["内力"]) > neilicha then
						ztd(j,'集气位置',-force)
						if Curr_NG(pid, 92) then
							ztd(j,"内伤点数",math.random(5,9))
						end
					end
				end
				Set_Eff_Text(id,"特效文字2","狮子吼");
			end
			if (WAR.LHFM == 1 or WAR.SZH == 2) and PersonKF(pid,91) then
				Set_Eff_Text(WAR.CurID,3,'罗汉狂狮・斗战狮吼')
				for j = 0, WAR.PersonNum -1 do
					if dead(j) == false and DWPD(j,WAR.CurID) == false then
						if j == WAR.CurID then
							zhanyi(WAR.Person[j]['人物编号'],math.random(1,5))
						else	
							zhanyi(WAR.Person[j]['人物编号'],math.random(10,15))
						end
					end
				end
			end			
        end
		--主运玉女：夭矫空碧，连击伤害杀气不减
		--黄衫女必发动
		if Curr_NG(pid,154) and WAR.ACT > 1 then
			local jl = 30 + JY.Base["天书数量"]*2
			if match_ID(pid,640) then
				jl = 100
			end
        	if JLSD(0,jl,pid) then
				WAR.YNXJ = 1
				Set_Eff_Text(id,"特效文字0","夭矫空碧");
			end
        end
        --梁萧 星罗散手，必封穴
        if match_ID(pid,635) then
            WAR.SLSS = 1
			Set_Eff_Text(id,"特效文字3","星罗散手");
        end
        --萧秋水 剑气飞纵 连击伤害杀气不减
        if  match_ID(pid,652) and JY.Base["天书数量"] > 5 then
            WAR.YNXJ = 1
			Set_Eff_Text(id,"特效文字0","剑气飞纵");
        end
		------------------------------------------------------------------------------------------------------------------------------------------
		-----------------------------------------------------------标主攻击大招-------------------------------------------------------------------
		------------------------------------------------------------------------------------------------------------------------------------------
        --主角剑神大招，10格攻击 标记修改
        if (actor(pid,3) or match_ID(pid, 9767)) and 120 <= TrueYJ(pid) and 0 < JY.Person[pid]["武功9"] and yongjian(wugong) and wugong ~= 43 
        	and JLSD(25, 50 +JY.Person[pid]["御剑能力"]*0.0625, pid) and (JXPD(pid,3,1) or JXPD(pid,9767,1) or JY.Person[pid]["实战"] >=500) then
			WAR.PD['全屏攻击'][pid] = 1
            WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字3",ZJTF[3]);
            ng = ng + 1000
            WAR.WS = 1
            for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, ZJTF[3] .. TFSSJ[3], C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end
            WAR.JSYX = 1
        end
        --主角拳系大招
        if (actor(pid,1) or match_ID(pid, 9769)) and 0 < JY.Person[pid]["武功9"] and 120 <= TrueQZ(pid) 
        and JLSD(25, 50 +JY.Person[pid]["拳掌功夫"]*0.1, pid) and yongquan(wugong) and (JXPD(pid,1,1) or JXPD(pid,9769,1) or JY.Person[pid]["实战"] >=500) then
            WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字3",ZJTF[1]);
            ng = ng + 1000
            WAR.WS = 1
            for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, ZJTF[1] .. TFSSJ[1], C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end
            WAR.LXZQ = 1
        end
        
        --主角指法大招
        if (actor(pid,2) or match_ID(pid, 9768)) and 0 < JY.Person[pid]["武功9"] and 120 <= TrueZF(pid) 
        and JLSD(25, 60 + JY.Person[pid]["指法技巧"]*0.1, pid) and yongzhi(wugong) and (JXPD(pid,2,1) or JXPD(pid,9768,1) or JY.Person[pid]["实战"] >=500) then
            WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字3",ZJTF[2]);
            ng = ng + 1000
            WAR.WS = 1
            
            for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, ZJTF[2] .. TFSSJ[2], C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end

            WAR.LXYZ = 1
        end
        
        --主角特系大招
        if (actor(pid,5) or match_ID(pid, 9765)) and 0 < JY.Person[pid]["武功9"] and 120 <= TrueTS(pid) 
        and JLSD(25, 50 + JY.Person[pid]["特殊兵器"]*0.1, pid) and yongte(wugong) and (JXPD(pid,5,1) or JXPD(pid,9765,1) or JY.Person[pid]["实战"] >=500) then
            WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字3",ZJTF[5]);
            ng = ng + 1000
            WAR.WS = 1
            
            for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, ZJTF[5] .. TFSSJ[5], C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end

            WAR.GCTJ = 1
        end
        
        --主角刀系大招
        if (actor(pid,4) or match_ID(pid, 9766)) and 0 < JY.Person[pid]["武功9"] and 120 <= TrueSD(pid) 
        	and JLSD(25, 50 + JY.Person[pid]["耍刀技巧"]*0.1, pid) and yongdao(wugong) and (JXPD(pid,4,1) or JXPD(pid,9766,1) or JY.Person[pid]["实战"] >=500) then
            WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字3",ZJTF[4]);
            ng = ng + 1000
            WAR.WS = 1
            
            for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, ZJTF[4] .. TFSSJ[4], C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end
            WAR.ASKD = 1
            --触发后给自己加怒气25
            WAR.YZHYZ = WAR.YZHYZ + 25
        end
        --主角天罡大招，内功可触发
        if (actor(pid,6) or match_ID(pid, 9764)) and 0 < JY.Person[pid]["武功9"] 
        and JLSD(25, 60 + pz, pid) and (JXPD(pid,6,1) or JXPD(pid,9764,1) or JY.Person[pid]["实战"] >=500) then
            WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字3",ZJTF[6]);
            ng = ng + 1000
            WAR.WS = 1            
            for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, ZJTF[6] .. TFSSJ[6], C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end
            WAR.JSTG = 1
        end
        --主角毒王大招，自身中毒100可触发
        if (actor(pid,9) or match_ID(pid, 9762)) and 0 < JY.Person[pid]["武功9"] 
        and JLSD(25, 60 + pz, pid) and JY.Person[pid]["中毒程度"] > 99 and (JXPD(pid,9,1) or JXPD(pid,9762,1) or JY.Person[pid]["实战"] >=500) then
            WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字3",ZJTF[9]);
            WAR.WS = 1
            for n = 1, 20 do
                local i = n
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                NewDrawString(-1, -1, ZJTF[9] .. TFSSJ[9], C_GOLD, CC.DefaultFont + i*2)
                ShowScreen()
                lib.Delay(CC.BattleDelay)
            end
            WAR.YTML = 1
        end
		--武骧金星：白驼山集毒
		if MPTX(pid,8) and WAR.PD['万毒归元'][pid] ~= nil then 
			Set_Eff_Text(id,"特效文字3","集毒")
		end
		--武骧金星：桃花岛九花玉露
		if MPTX(pid,10) and WAR.PD['九花玉露'][pid] ~= nil then 
			Set_Eff_Text(id,"特效文字3","九花玉露")
		end
		--苗人凤破军的动画和文字
        if match_ID(pid, 3) and WAR.MRF == 1 then
			Set_Eff_Text(id,"特效文字3","破军")
            WAR.Person[id]["特效动画"] = 146
        end
        
        if Given_WG(pid, wugong) and wugong == 35 then
            if WAR.ATNum > 1 then 
                local str = {'一','二','三','四','五','六'}
                WAR.PD['雪花六出'][pid] = math.random(6)
				Set_Eff_Text(id,"特效文字3",str[WAR.PD['雪花六出'][pid]]..'花')
            end
        end
		--六如公子的风火雷
		if match_ID(pid,9778) then
			--local rate = limitX(math.modf(20 + (121-JY.Person[pid]["资质"])/10 + JY.Person[pid]["实战"]/50 + JY.Person[pid]["攻击力"]/50 + JY.Person[pid]["武学常识"]/10),0,100)
			local rate = 45
			local low = 10
			local rf = 0
			local rh = 0
			local rt = 0
			local times = 1
			for i = 1, times do--六如同时出
				if JLSD(low, rate, pid) then
					rf = 1
				end
				if JLSD(low, rate, pid) then
					rh = 1
				end
				if JLSD(low, rate, pid) then
					rt = 1
				end
			end
			--[[for i = 1, times do
				if JLSD(low, rate, pid) then
					local lr = math.random(3)
					if lr == 1 then
						rf = 1
					elseif lr == 2 then
						rh = 1
					elseif lr == 3 then
						rt = 1
					end
				end
			end]]
			--其疾如风
			if rf == 1 then
				WAR.Person[id]["特效动画"] = 73
				Set_Eff_Text(id,"特效文字2","其疾如风")
				WAR.PD['疾如风'][pid] = (WAR.PD['疾如风'][pid] or 0) + 1
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
						WAR.Person[j].Time = WAR.Person[j].Time + 100
						if WAR.Person[j].Time > 980 then
							WAR.Person[j].Time = 980
						end
					end
				end
			end
			--侵略如火
			if rh == 1 then
				WAR.Person[id]["特效动画"] = 7
				Set_Eff_Text(id,"特效文字2","侵略如火")
				ng = ng + 1500
				WAR.PD['侵如火'][pid] = 1
			end
			--动如雷震
			if rt == 1 then
				WAR.Person[id]["特效动画"] = 6
				Set_Eff_Text(id,"特效文字2","动如雷霆")
				if WAR.ATNum < 6 then
					WAR.ATNum = WAR.ATNum + 1
				else
					if JLSD(10,35,pid) then
						WAR.ATNum = WAR.ATNum + 1
					end
				end	
			end
		end
		--虾米动如雷霆
		if (match_ID(pid,759) or WAR.PD['风雷惊蛰3'][pid] ~= nil) and JLSD(10,50,pid) then		
	    WAR.Person[id]["特效动画"] = 6
			Set_Eff_Text(id,"特效文字2","动如雷霆")
			if WAR.ATNum < 6 then
				WAR.ATNum = WAR.ATNum + 1
			else
				if JLSD(10,35,pid) then
					WAR.ATNum = WAR.ATNum + 1
				end
			end			
		end 
			
        --嫖主
		if actor(pid,10) and JXPD(pid,10,3) and JLSD(20,55,pid) then 
			WAR.ATNum = WAR.ATNum + 1
			local size = 60
			local x = CC.ScreenW/2;
			local y = CC.ScreenH/2;
			local offx = (#"【风月无间・嫖如雷霆】")*size/4
			local offy = size/2
			for k = 1,10 do
				Cat('实时特效动画')
				Cls()
				Cat('实时特效动画2')
				lib.Background(0,y-50,CC.ScreenW,y+50,98)
				DrawString(x-offx,y-offy,"【风月无间・嫖如雷霆】",C_GOLD,size);  
				ShowScreen();
				lib.Delay(CC.BattleDelay)
			end
		end
		--程英，使用玉箫剑法，杀内力300
		if ((match_ID(pid,63) or match_ID(pid, 9829)) and wugong == 38) or WAR.PD['杀内力'][pid]~=nil or (PDTZ(pid,JY.Person[pid]["武器"]) and wugong > 0) then
			if PDTZ(pid,JY.Person[pid]["武器"]) then
				local n =  JY.Person[pid]["武器"]
				if Setmeal[n][4] == 24 then
					WAR.CY = 1	
				elseif match_ID(pid, 63) or match_ID(pid, 9829) or WAR.PD['杀内力'][pid]~=nil then
					WAR.CY = 1
				end
			else
				if match_ID(pid, 63) or match_ID(pid, 9829) or WAR.PD['杀内力'][pid]~=nil then
					WAR.CY = 1
				end
			end
		end
		--初生牛犊
		if match_ID(pid,9743) and JLSD(20,50,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-50) 
					end	
				end
			end
		end
        --杨过 攻击，非吼 全体集气减100
        if (match_ID(pid, 58) or match_ID(pid, 9833)) and WAR.XK ~= 2 then
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if nokillspeed(j) == false then
                        ztd(j,'集气位置',-100)	
					end
                end
            end
            Set_Eff_Text(id,"特效文字1","西狂之怒啸")
        end
        --杨过吼
        if WAR.XK == 2 and match_ID(pid, 58) and WAR.Person[WAR.CurID]["我方"] == WAR.XK2 then
            for e = 0, WAR.PersonNum - 1 do
                if WAR.Person[e]["死亡"] == false and WAR.Person[e]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
                    ztd(e,'集气位置',- math.modf(JY.Person[WAR.Person[WAR.CurID]["人物编号"]]["内力"] / 5))
					ztd(e,'攘Φ闶',- math.modf(JY.Person[WAR.Person[WAR.CurID]["人物编号"]]["内力"] / 10))
                    ztd(e,'生命点数',- math.modf(JY.Person[WAR.Person[WAR.CurID]["人物编号"]]["内力"] / 10))
				end
            end
            --吼过之后，内力为0，内力最大值-1000，并且用声望控制上限
            if isteam(pid) then
                JY.Person[pid]["内力"] = 0
                JY.Person[pid]["内力最大值"] = JY.Person[pid]["内力最大值"] - 1000
                JY.Person[300]["声望"] = JY.Person[300]["声望"] + 1
            else
                ztd(WAR.CurID,"内力点数",-1000)  --做敌方内力只减1000
            end
            
            if JY.Person[pid]["内力最大值"] < 500 then
                JY.Person[pid]["内力最大值"] = 500
            end
			Set_Eff_Text(id,"特效文字1","西狂之震怒・雷霆狂啸")
            WAR.Person[id]["特效动画"] = 6
            WAR.XK = 3
        end    
    
        --任盈盈，使用持瑶琴，无形剑气 标记修改
        if (match_ID(pid, 73) or match_ID(pid, 9843)) and wugong == 73 then
			Set_Eff_Text(id,"特效文字3","七绝纵横衍")
            for j = 0, WAR.PersonNum - 1 do
				local ht = 120
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
                    WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
                    --无酒不欢：记录人物血量
                    WAR.Person[j]["Life_Before_Hit"] = JY.Person[WAR.Person[j]["人物编号"]]["生命"]
					ztd(j,"生命点数",-ht)
                    --沉睡状态状态醒来后陷入更深梦境
                    if WAR.PD["沉睡状态"][WAR.Person[j]["人物编号"]] ~= nil then
                        WAR.PD["回魂仙梦"][WAR.Person[j]["人物编号"]] = 10
						WAR.PD["沉睡状态"][WAR.Person[j]["人物编号"]] = nil
                    end
                end
            end
        end
        --七夕任盈盈加强版效果
        if (match_ID(pid, 611) or (match_ID(pid,73) and JXPD(pid,73,1))) and wugong == 73 then
			Set_Eff_Text(id,"特效文字3","魔音搜魂")
			for j = 0, WAR.PersonNum - 1 do
				local mid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"生命点数",-200)
					ztd(j,"内力点数",-300)
					ztd(j,"体力点数",-3)
					WAR.PD["混乱状态"][WAR.Person[j]["人物编号"]] = 1
					if WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] == nil then
						WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] = math.random(8)
					else
						WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] = WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] + math.random(8)
						if WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] > 40 then
							ztd(j,"生命点数",-WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]]*20)
							WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] = nil
						end
					end	
				end
            end
        end
		--成昆鸡你太美
		if match_ID(pid,9912) and JLSD(0,50,pid) then
            for j = 0, WAR.PersonNum - 1 do
                local mid = WAR.Person[j]["人物编号"]
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if WAR.PD["灵蛇拳"][mid] == nil then
						WAR.PD["灵蛇拳"][mid] = 5
					end
					WAR.PD["混乱状态"][mid] = 1
                end
            end
			Set_Eff_Text(id,"特效文字1","鸡你太美")
		end	
        --何足道，攻击时附加琴音状态，上限30层
        if match_ID(pid, 586) then
            WAR.HZD_QF[pid] = (WAR.HZD_QF[pid] or 0) + math.random(2,4)
            if WAR.HZD_QF[pid] > 30 then
                WAR.HZD_QF[pid] = 30
            end
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"]  then
                    if WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] == nil then
                        WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] = math.random(2,3)
                    else
                        WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] = WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] + math.random(3)
                        if WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] > 30 then
                            WAR.PD["琴音状态"][WAR.Person[j]["人物编号"]] = 30
                        end	
                    end
                end	
            end	
			Set_Eff_Text(id,"特效文字1","凤求凰")
        end
        --曲风伤害
        if match_ID(pid,586) and WAR.HZD_QF[pid] > 20 then
            CleanWarMap(4, 0)
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
                    local eid = WAR.Person[j]["人物编号"]
                    local qycs = WAR.PD["琴音状态"][eid] or 0
                    if qycs > 0 then
                        ztd(j,"生命点数",-30*qycs)
                        SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 4, 1)
						WAR.HZD_QF[pid] = nil
                    end
                end
            end
			Set_Eff_Text(id,"特效文字0","百鸟朝凤")
        end
        --程灵素 攻击全屏中毒+20
		--扣除当前血量7%
        if match_ID(pid, 2) then
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local tmppid = WAR.Person[j]["人物编号"]
					local qxht   = math.modf(JY.Person[tmppid]["生命"]*0.07)
					local qxht1   = math.modf(JY.Person[tmppid]["内力"]*0.07)
					--无酒不欢：记录人物血量
					WAR.TXXS[tmppid] = 1
					WAR.Person[j]["Life_Before_Hit"] = JY.Person[tmppid]["生命"]
					ztd(j,"生命点数",-qxht)
					ztd(j,"内力点数",-qxht1)
			        ztd(j,"体力点数",-math.random(7))
			        ztd(j,"中毒点数",math.random(47))
                    WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
                end
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					local yx = math.random(6)
					if yx == 1 then
						WAR.PD['白云熊胆'][WAR.Person[j]["人物编号"]] = 200
					end
					if yx == 2 then
						WAR.PD['天香续命'][WAR.Person[j]["人物编号"]] = 100
					end
					if yx == 3 then
						WAR.PD['小还丹'][WAR.Person[j]["人物编号"]] = 50
					end
					if yx == 4 then
						WAR.PD['黄连解毒'][WAR.Person[j]["人物编号"]] = 50
					end
					if yx == 5 then
						WAR.PD['牛黄血蝎'][WAR.Person[j]["人物编号"]] = 50
					end
					if yx == 6 then
						WAR.PD['六阳正气'][WAR.Person[j]["人物编号"]] = 1
					end	
					WAR.TXXS[WAR.Person[j]["人物编号"]] = 1									
                end 
			end
			if JY.Person[2]['论剑奖励'] == 1000 then
				ztd(WAR.CurID,"生命点数",-math.random(177))
				ztd(WAR.CurID,"内力点数",-math.random(377))
				ztd(WAR.CurID,"体力点数",-math.random(2))
				ztd(WAR.CurID,"中毒点数",math.random(17))
			end	
			if JY.Person[2]['论剑奖励'] ~= 1000 then
				Set_Eff_Text(id,"特效文字1","真・七心海棠")
			else
				Set_Eff_Text(id,"特效文字1","伪・七心海棠")
			end	
			WAR.Person[id]["特效动画"] = 64
        end
		if match_ID(pid, 9904) and (not match_ID(pid,2)) then
			ztd(WAR.CurID,"生命点数",-math.random(77,277))
			ztd(WAR.CurID,"内力点数",-math.random(177,477))
			ztd(WAR.CurID,"体力点数",-math.random(3))
			ztd(WAR.CurID,"中毒点数",math.random(17))
            for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local tmppid = WAR.Person[j]["人物编号"]
					--无酒不欢：记录人物血量
					WAR.TXXS[tmppid] = 1
					WAR.Person[j]["Life_Before_Hit"] = JY.Person[tmppid]["生命"]
					ztd(j,"生命点数", -math.random(177,377))
					ztd(j,"内力点数", -math.random(277,777))
					ztd(j,"中毒点数",math.random(17))
                    WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
                end
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					local yx = math.random(6)
					if yx == 1 then
						WAR.PD['白云熊胆'][WAR.Person[j]["人物编号"]] = 200
					end
					if yx == 2 then
						WAR.PD['天香续命'][WAR.Person[j]["人物编号"]] = 100
					end
					if yx == 3 then
						WAR.PD['小还丹'][WAR.Person[j]["人物编号"]] = 50
					end
					if yx == 4 then
						WAR.PD['黄连解毒'][WAR.Person[j]["人物编号"]] = 50
					end
					if yx == 5 then
						WAR.PD['牛黄血蝎'][WAR.Person[j]["人物编号"]] = 50
					end
					if yx == 6 then
						WAR.PD['六阳正气'][WAR.Person[j]["人物编号"]] = 1
					end	
					WAR.TXXS[WAR.Person[j]["人物编号"]] = 1									
                end 
			end
			Set_Eff_Text(id,"特效文字1","伪・七心海棠")
			WAR.Person[id]["特效动画"] = 64
        end
		--傲寒六决
		if match_ID(pid,9948) then
			local jl = 30
			for i = 0,WAR.PersonNum - 1 do
				if WAR.Person[i]['死亡'] == false and WAR.Person[i]['我方'] ~= WAR.Person[WAR.CurID]['我方'] then
					local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
					local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
					if offset1 <= 10 and offset2 <= 10 then
						ztd(i,WAR.BFXS,20)   
						if match_ID(pid,546) then
							WAR.Person[i]["特效动画"] = 80
							ztd(i,"生命点数",-(psx(WAR.Person[i]["人物编号"],"冰封程度")*math.random(2)))
						end
						if JLSD(0,30,pid) then
							if WAR.PD["利刃寒锋"][WAR.Person[i]["人物编号"]] == nil then
								WAR.PD["利刃寒锋"][WAR.Person[i]["人物编号"]] = 10
							else
							    WAR.PD["利刃寒锋"][WAR.Person[i]["人物编号"]] = (WAR.PD["利刃寒锋"][WAR.Person[i]["人物编号"]] or 0) + 2
							end
                            if match_ID(pid,514) then
							    WAR.PD["真利刃寒锋"][WAR.Person[i]["人物编号"]] = (WAR.PD["真利刃寒锋"][WAR.Person[i]["人物编号"]] or 0) + 2
							end
							WAR.Person[i]["特效动画"] = 116
							WAR.PD['傲寒六诀'][pid] = 1
						end
						WAR.TXXS[WAR.Person[i]["人物编号"]] = 1
					end
				end
			end
			WAR.Person[id]["特效动画"] = 174
		end
        --剑魔BOSS模式
		if match_ID(pid,592) then
			if WAR.PD['独孤剑势'][pid] ~= nil and WAR.PD['独孤剑势'][pid] >= 10 then 
				WAR.PD['独孤剑势'][pid] = 1
			else 
			    WAR.PD['独孤剑势'][pid] = (WAR.PD['独孤剑势'][pid] or 1) + 1
			end
		end
        --剑魔BOSS
        if match_ID(pid,592) then
            local zs = {"独孤一式", "独孤二式", "独孤三式", "独孤四式", "独孤五式", "独孤六式","独孤七式", "独孤八式", "独孤九式", "独孤极意・无招胜有招"};
            local num = WAR.PD['独孤剑势'][pid] or 1;
            local zsnum = WAR.PD['独孤剑势'][pid] or 1;
            local n = 0;
            local person = {};
            --清掉之前的范围
            CleanWarMap(4, 0)
            for i = 0, WAR.PersonNum - 1 do
                if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
                    n = n + 1
                    person[n] = i;
                end
            end
            --根据不同的X攻击不同的敌人
            if n <= num or zsnum >= 10 then
                for i = 1,n do
                    SetWarMap(WAR.Person[person[i]]["坐标X"], WAR.Person[person[i]]["坐标Y"], 4, 1)
                end
            else
                while num > 0 do
                    local t = math.random(n);
                    if person[t] ~= nil then
                        SetWarMap(WAR.Person[person[t]]["坐标X"], WAR.Person[person[t]]["坐标Y"], 4, 1)
                        person[t] = nil;
                        num = num - 1;
                    end
                end
            end
            local str = zs[limitX(zsnum,1, 10)]
            WAR.Person[id]["特效文字3"] = str
            Cls()
            ShowScreen()
            if num >= 10 then		--独孤求败发动极意后，恢复1000命，2000内力，10体力，内伤和中毒减半
				ztd(WAR.CurID,"生命点数",1000)
				ztd(WAR.CurID,"内力点数",2000)
				ztd(WAR.CurID,"体力点数",10)
				ztd(WAR.CurID,"中毒点数",-50)
				ztd(WAR.CurID,"内伤点数",-50)
                WAR.Person[id]["特效动画"] = 6
                for n = 1, 20 do
                    local i = n
                    if i > 10 then 
                        i = 10
                    end
                    Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
                    NewDrawString(-1, -1, str, C_GOLD, CC.DefaultFont + i*2)
                    ShowScreen()
                    lib.Delay(CC.BattleDelay)
                end
            end
        end
        WAR.KF = wugong
        if Fjkx(WAR.CurID) ~= 2 then
            if DGFJ() == 1 then
                return 1
            end
        end
        wugong = WAR.KF
        if JY.Person[pid]["生命"] <= 0 then
            return 1
        end
		
		----------------------------------------------阵法攻击---------------------------------------------------------
        --全真七子，天罡北斗阵，文字显示
        if (pid >= 123 and pid <= 128) or pid == 68 then
            WAR.Person[id]["特效动画"] = 93
			Set_Eff_Text(id,"特效文字2","天罡北斗阵加力")
        end
		--武当七侠，真武七截阵，文字显示
        if (pid >= 532 and pid <= 538)  then
            WAR.Person[id]["特效动画"] = 93
			Set_Eff_Text(id,"特效文字2","真武七截阵加力")
        end
		--松风剑阵
        if (pid >= 211 and pid <= 213) and WAR.ZDDH == 203 then
			Set_Eff_Text(id,"特效文字2","松风剑阵加力")
            WAR.Person[id]["特效动画"] = 68
        end
		--昆仑刀剑阵・正反两仪
		if WAR.PD['顺逆两仪1'][pid] ~= nil and JLSD(0,math.modf(WAR.PD['顺逆两仪1'][pid]*15)+10,pid) then
			if rwnlxz(pid,0) then
				zhanyi(pid,15)
			end	
			if 	rwnlxz(pid,1) then
				WAR.PD['天香续命'][pid] = (WAR.PD['天香续命'][pid] or 0) + 15
				WAR.PD['五宝花蜜酒'][pid] = (WAR.PD['五宝花蜜酒'][pid] or 0) + 15
			end	
			if rwnlxz(pid,2) then
				for a = 0, WAR.PersonNum-1 do 
					if dead(a) == false and DWPD(WAR.CurID,a) then
						ztd(a,"生命点数",math.modf(WAR.PD['顺逆两仪1'][pid]*50))
					end
				end
			end	
		end	
		if WAR.PD['顺逆两仪2'][pid] ~= nil and JLSD(0,math.modf(WAR.PD['顺逆两仪2'][pid]*15)+10,pid) then
			if psx(pid,"内力性质") > 1 then
				for a = 0, WAR.PersonNum-1 do 
					if dead(a) == false and DWPD(WAR.CurID,a) == false then
						ztd(a,"集气位置",-math.modf(WAR.PD['顺逆两仪2'][pid]*20))
					end
				end
			else
				for a = 0, WAR.PersonNum-1 do 
					if dead(a) == false and DWPD(WAR.CurID,a) == false then
						ztd(a,"生命点数",-math.modf(WAR.PD['顺逆两仪2'][pid]*20))
					end
				end
			end	
		end
		--昆仑刀剑阵・胡刀苗剑
		if WAR.PD['风雷惊蛰1'][pid] ~= nil then
			local a = WAR.PD['风雷惊蛰1'][pid]
			if WAR.ACT > 1 and JLSD(0,math.modf(a*15)+10,pid) then
				WAR.PD['神兵'][pid] = limitX((WAR.PD['神兵'][pid] or 0) + 10,0,30)
			end
		end	
		if WAR.PD['风雷惊蛰2'][pid] ~= nil then
			local a = WAR.PD['风雷惊蛰2'][pid]
			if WAR.ACT > 1 and JLSD(0,math.modf(a*15)+10,pid) then
				WAR.PD['虚弱状态'][pid] = limitX((WAR.PD['虚弱状态'][pid] or 0) + 10,0,30)
				if psx(pid,"受伤程度") > 0 then
					ztd(WAR.CurID,"生命点数",-psx(pid,"受伤程度"))
					CurIDTXDH(WAR.CurID,71,1,"怒雷轰顶")
				end	
			end
		end
		if WAR.PD['天剑绝刀1'][pid] ~= nil  and (yongjian(wugong) or yongdao(wugong)) then
			if WAR.ATNum < 2 then
				WAR.ATNum = 2
			end
		end
		if WAR.PD['天剑绝刀1'][pid] ~= nil and JLSD(0,math.modf(WAR.PD['天剑绝刀1'][pid]*15)+10,pid) and (yongjian(wugong) or yongdao(wugong)) then
			WAR.TJJD = 1
			WAR.WS = 1
			TXWZXS("『天剑绝刀・断命合天』", M_DeepSkyBlue)
			if (WAR.PD['极意攻击'][pid] or 0) < 6 then
				WAR.PD['极意攻击'][pid] = 6
			end
		end
		if WAR.PD['天剑绝刀2'][pid] ~= nil then
			if yongjian(wugong) and JLSD(0,math.modf(WAR.PD['天剑绝刀2'][pid]*15)+10,pid) then
				WAR.PD['封气绝脉'][pid] = 1
			end
			if yongdao(wugong) and JLSD(0,math.modf(WAR.PD['天剑绝刀2'][pid]*15)+10,pid) then
				WAR.PD['残劲袭魄'][pid] = 1
			end	
		end
		--------------------------------------攻击后特殊动画-----------------------------
		--开太极的动画
        if WAR.WDKTJ == 1 then
            WAR.Person[id]["特效动画"] = 159
        end
		--斗转幻梦星辰特效动画
		if WAR.DZXYLV[pid] == 80 then
			WAR.Person[id]["特效动画"] = 107
		end
		if WAR.DZXYLV[pid] == 150 then
			WAR.Person[id]["特效动画"] = 423
		end
		--无酒不欢的特效动画
        if pid == 0 and JY.Base["特殊"] == 1 then
            WAR.Person[id]["特效动画"] = 132
        end
		--杀破狼的特效动画	
		if match_ID(pid, 112) and WAR.ZHRM[pid] == nil and WAR.XYS > 0 then
			WAR.Person[id]["特效动画"] = 132
		end
		--北斗七闪的特效动画
        if match_ID(pid,129) and WAR.BDQS > 0 then
            WAR.Person[id]["特效动画"] = 126
        end
        --达摩攻击特效动画
        if match_ID(pid, 577) then
            WAR.Person[id]["特效动画"] = 158
        end
		--梁萧觉醒特效动画
        if JXPD(pid,635,1) then
            WAR.Person[id]["特效动画"] = 126
        end
        --萧秋水觉醒特效动画
        if JXPD(pid,652,1) then
            WAR.Person[id]["特效动画"] = 83
        end
		--
		--花间游根据打击人数增加伤害
		if QGQH(pid,286,2) then
			local Hjds = 0
			for i = 0, CC.WarWidth - 1 do
				for j = 0, CC.WarHeight - 1 do
					local effect = GetWarMap(i, j, 4)
					if 0 < effect then
						local emeny = GetWarMap(i, j, 2)
						if emeny >= 0 and emeny ~= WAR.CurID then
							if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] then
								Hjds = Hjds + 1
							end
						end
					end
				end
			end
			WAR.HJY = Hjds
		end
		---------------------------被攻击后移动类特效-------------------------------------------
		--棉里针
		if math.random(100) < 21 then
				local LFQ_MLZ;
				for i = 0, CC.WarWidth - 1 do
					for j = 0, CC.WarHeight - 1 do
						local effect = GetWarMap(i, j, 4)
						if 0 < effect then
							local emeny = GetWarMap(i, j, 2)
							if emeny >= 0 and emeny ~= WAR.CurID then
								if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] and match_ID(WAR.Person[emeny]["人物编号"], 570) then
								   LFQ_MLZ = emeny
									break;
								end
							end
						end
					end
				end
			if  LFQ_MLZ ~= nil then
			local s = WAR.CurID
			WAR.CurID =  LFQ_MLZ
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 159,1,"四两拨千斤")		
				War_ExecuteMenu_Sub(WAR.Person[s]["坐标X"],  WAR.Person[s]["坐标Y"], 4, math.random(28,35))
				WAR.CurID = s
				LFQ_MLZ = nil
			end
		end
		--龟甲・崩裂
		if math.random(100) < 51 then
			local MJ_MLZ;
			for i = 0, CC.WarWidth - 1 do
				for j = 0, CC.WarHeight - 1 do
					local effect = GetWarMap(i, j, 4)
					if 0 < effect then
						local emeny = GetWarMap(i, j, 2)
						if emeny >= 0 and emeny ~= WAR.CurID then
							if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] 
							and (match_ID(WAR.Person[emeny]["人物编号"], 456)) then
								MJ_MLZ = emeny
								break;
							end
						end
					end
				end
			end
			if MJ_MLZ ~= nil then
				local s = WAR.CurID
				WAR.CurID =  MJ_MLZ
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 171,1,"龟甲・迸裂")
				War_ExecuteMenu_Sub(WAR.Person[s]["坐标X"],  WAR.Person[s]["坐标Y"], 4, math.random(28,35))
				WAR.CurID = s
				MJ_MLZ = nil
			end
		end
		--弹反
		if math.random(100) < 91 then
				local MJ_MLZ;
				for i = 0, CC.WarWidth - 1 do
					for j = 0, CC.WarHeight - 1 do
						local effect = GetWarMap(i, j, 4)
						if 0 < effect then
							local emeny = GetWarMap(i, j, 2)
							if emeny >= 0 and emeny ~= WAR.CurID then
								if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] and (match_ID(WAR.Person[emeny]["人物编号"], 92)) then
								    MJ_MLZ = emeny
									break;
								end
							end
						end
					end
				end
			if  MJ_MLZ ~= nil then
			local s = WAR.CurID
			WAR.CurID =  MJ_MLZ
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 226,1,"见破・弹反")		
				War_ExecuteMenu_Sub(WAR.Person[s]["坐标X"],  WAR.Person[s]["坐标Y"], 4, math.random(28,35))
				WAR.CurID = s
				MJ_MLZ = nil
			end
		end
	    --青青 雷霆万钧
		if math.random(10) > 7 then
				local WQQ_LTWJ;
				for i = 0, CC.WarWidth - 1 do
					for j = 0, CC.WarHeight - 1 do
						local effect = GetWarMap(i, j, 4)
						if 0 < effect then
							local emeny = GetWarMap(i, j, 2)
							if emeny >= 0 and emeny ~= WAR.CurID then
								if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] and match_ID(WAR.Person[emeny]["人物编号"], 91) then
									WQQ_LTWJ = emeny
									break;
								end
							end
						end
					end
				end
			if WQQ_LTWJ ~= nil then
					local s = WAR.CurID
					WAR.CurID = WQQ_LTWJ
					local jl = math.random(2,5)
					local XZ = {}
					local tim = 1
					local num = 0
				while tim < jl+1 do
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
						local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
							if offset1 <= 15 and offset2 <= 15 then
								WAR.TXXS[WAR.Person[i]["人物编号"]] = 1
								table.insert(XZ,i)
								num = num +1
							end
						end
					end
					if XZ == nil or #XZ < 1 then
						break
					end
					local si = XZ[math.random(#XZ)]	
					local dam = math.modf(TrueYJ(s)*0.1)+math.random(10)
					if num > 0 then
						WAR.Person[si]["特效动画"] = 131
						WAR.Person[si]["生命点数"] = (WAR.Person[si]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[si]["人物编号"], "生命", -(dam*10))
						tim = tim + 1
					else
						tim = tim + 1
					end		
				end
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 131,1,"雷霆万钧")
				WAR.CurID = s
				WAR.ACT = 10
				WQQ_LTWJ = nil
			end
		end
		
		--柳如絮
		if math.random(10) > 7 then
				local LRX_DHJY;
				for i = 0, CC.WarWidth - 1 do
					for j = 0, CC.WarHeight - 1 do
						local effect = GetWarMap(i, j, 4)
						if 0 < effect then
							local emeny = GetWarMap(i, j, 2)
							if emeny >= 0 and emeny ~= WAR.CurID then
								if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] and match_ID(WAR.Person[emeny]["人物编号"], 747) then
									LRX_DHJY = emeny
									break;
								end
							end
						end
					end
				end
			if LRX_DHJY ~= nil then
					local s = WAR.CurID
					WAR.CurID = LRX_DHJY
					local jl = math.random(2,5)
					local XZ = {}
					local tim = 1
					local num = 0
				while tim < jl+1 do
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
						local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
							if offset1 <= 30 and offset2 <= 30 then
								WAR.TXXS[WAR.Person[i]["人物编号"]] = 1
								table.insert(XZ,i)
								num = num +1
							end
						end
					end
					if XZ == nil or #XZ < 1 then
						break
					end
					local si = XZ[math.random(#XZ)]
					local dam = math.modf(TrueYJ(s)*0.1)+math.random(10)
					if num > 0 then
						WAR.Person[si]["特效动画"] = 62
						WAR.Person[si]["生命点数"] = (WAR.Person[si]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[si]["人物编号"], "生命", -(dam*10))
						tim = tim + 1
					else
						tim = tim + 1
					end		
				end
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 62,1,"剑气纵横")
				WAR.CurID = s
				WAR.ACT = 10
				LRX_DHJY = nil
			end
		end
        
        --李秋水无相转身，没有触发过，或者分身已死，才可触发，有30%几率触发
        if (WAR.WXFS == nil or (WAR.WXFS ~= nil and WAR.Person[WAR.WXFS]["死亡"] == true)) and math.random(10) < 4 then
            local lqs_WXZS;
            for i = 0, CC.WarWidth - 1 do
                for j = 0, CC.WarHeight - 1 do
                    local effect = GetWarMap(i, j, 4)
                    if 0 < effect then
                        local emeny = GetWarMap(i, j, 2)
                        if emeny >= 0 and emeny ~= WAR.CurID then
                            
                            if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] 
							    and (match_ID(WAR.Person[emeny]["人物编号"], 118) or match_ID(WAR.Person[emeny]["人物编号"], 522)) 
								and WAR.Person[emeny]["人物编号"] == 0 then
                                lqs_WXZS = emeny
                                SetWarMap(i, j, 4, 0)
                                break;
                            end
                        end
                    end
                end
            end
        
            if lqs_WXZS ~= nil then
                
                --ID临时交给李秋水
                local s = WAR.CurID
                WAR.CurID = lqs_WXZS
                local wxlox, wxloy;
                War_CalMoveStep(WAR.CurID, 10, 0)
                local function SelfXY(x, y)
                    local yes = 0
                    if x == WAR.Person[WAR.CurID]["坐标X"] then
                        yes = yes +1
                    end
                    if y == WAR.Person[WAR.CurID]["坐标Y"] then
                        yes = yes +1
                    end
                    if yes == 2 then
                        return true
                    end
                    return false
                end
                local x, y = nil, nil
                while true do
                    x, y = War_SelectMove()
                    if x ~= nil then
                        WAR.ShowHead = 0
                        wxlox, wxloy = x, y
                        break;
                    --ESC退出
                    else
                        WAR.ShowHead = 0
                        x, y = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
                        --wxlox, wxloy = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
                        break;
                    end
                end
                --不在自身位置才能触发幻象
                if SelfXY(x, y) == false then
                    SetWarMap(wxlox, wxloy, 4, 0)
                    --本场还没触发过无相转身，则加入新人物
                    if WAR.WXFS == nil then
                        WAR.Person[WAR.PersonNum]["人物编号"] = 600
                        WAR.Person[WAR.PersonNum]["我方"] = WAR.Person[WAR.CurID]["我方"]
                        WAR.Person[WAR.PersonNum]["坐标X"] = wxlox
                        WAR.Person[WAR.PersonNum]["坐标Y"] = wxloy
                        WAR.Person[WAR.PersonNum]["死亡"] = false
                        WAR.Person[WAR.PersonNum]["人方向"] = WAR.Person[WAR.CurID]["人方向"]
                        WAR.Person[WAR.PersonNum]["贴图"] = WarCalPersonPic(WAR.PersonNum)
                    
                        --lib.PicLoadFile(string.format(CC.FightPicFile[1], JY.Person[600]["头像代号"]), string.format(CC.FightPicFile[2], JY.Person[600]["头像代号"]), 4 + WAR.PersonNum)
                        WAR.JQSDXS[600] = 0	--直接指定集气，以免召唤出来马上被斗转跳出
						WAR.SPIRIT[600] = 0           --初始战意
		                WAR.SPIRITMIN[600] = 0        --战意最低值
	                    WAR.SPIRITMAX[600] = 0        --战意最高值
                        WAR.WXFS = WAR.PersonNum
                        WAR.PersonNum = WAR.PersonNum + 1
                    --已经触发过，则让分身复活
                    else
                        WAR.Person[WAR.WXFS]["死亡"] = false
                        WAR.Person[WAR.WXFS]["我方"] = WAR.Person[WAR.CurID]["我方"]
                        WAR.Person[WAR.WXFS]["坐标X"] = wxlox
                        WAR.Person[WAR.WXFS]["坐标Y"] = wxloy
                        WAR.Person[WAR.WXFS]["人方向"] = WAR.Person[WAR.CurID]["人方向"]
                        WAR.Person[WAR.WXFS]["贴图"] = WarCalPersonPic(WAR.WXFS)
                        JY.Person[600]["生命"] = JY.Person[600]["生命最大值"]
                        JY.Person[600]["内力"] = JY.Person[600]["内力最大值"]
                        JY.Person[600]["体力"] = 100
                        JY.Person[600]["受伤程度"] = 0 
                        JY.Person[600]["中毒程度"] = 0
                        JY.Person[600]["冰封程度"] = 0
                        JY.Person[600]["灼烧程度"] = 0
						JY.Person[600]["封穴程度"] = 0
						JY.Person[600]["流血程度"] = 0
                        WAR.Person[WAR.WXFS].Time = 0
                    end
            
                    --清除自身位置贴图
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
                    --修改自身与幻象坐标
                    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], WAR.Person[WAR.WXFS]["坐标X"], WAR.Person[WAR.WXFS]["坐标Y"] = WAR.Person[WAR.WXFS]["坐标X"], WAR.Person[WAR.WXFS]["坐标Y"],WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
                        
                    --增加幻象贴图
                    SetWarMap(WAR.Person[WAR.WXFS]["坐标X"], WAR.Person[WAR.WXFS]["坐标Y"], 5, WAR.Person[WAR.WXFS]["贴图"])
                    SetWarMap(WAR.Person[WAR.WXFS]["坐标X"], WAR.Person[WAR.WXFS]["坐标Y"], 2, WAR.WXFS)
                    SetWarMap(WAR.Person[WAR.WXFS]["坐标X"], WAR.Person[WAR.WXFS]["坐标Y"],10,JY.Person[WAR.Person[WAR.WXFS]["人物编号"]]['头像代号'])
                    
                    --增加自身贴图
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"],10,JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
                end
                WarDrawMap(0)
                CurIDTXDH(WAR.CurID, 90,1,"无相转身")
                    
                --还原ID并打断连击
                WAR.CurID = s
                WAR.ACT = 10
            end
        end
			
		--霹雳身法
        if (WAR.PLSF == nil or (WAR.PLSF ~= nil and WAR.Person[WAR.PLSF]["死亡"] == true)) and math.random(10) < 4 then
            local lqs_WXZS;
            for i = 0, CC.WarWidth - 1 do
                for j = 0, CC.WarHeight - 1 do
                    local effect = GetWarMap(i, j, 4)
                    if 0 < effect then
                        local emeny = GetWarMap(i, j, 2)
                        if emeny >= 0 and emeny ~= WAR.CurID then                            
                            if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] 
							    and Curr_QG(WAR.Person[emeny]["人物编号"],373)
								and WAR.Person[emeny]["人物编号"] == 0 then
                                lqs_WXZS = emeny
                                SetWarMap(i, j, 4, 0)
                                break;
                            end
                        end
                    end
                end
            end
        
            if lqs_WXZS ~= nil then
                
                --ID临时交给李秋水
                local s = WAR.CurID
                WAR.CurID = lqs_WXZS
                local wxlox, wxloy;
                War_CalMoveStep(WAR.CurID, 20, 0)
                local function SelfXY(x, y)
                    local yes = 0
                    if x == WAR.Person[WAR.CurID]["坐标X"] then
                        yes = yes +1
                    end
                    if y == WAR.Person[WAR.CurID]["坐标Y"] then
                        yes = yes +1
                    end
                    if yes == 2 then
                        return true
                    end
                    return false
                end
                local x, y = nil, nil
                while true do
                    x, y = War_SelectMove()
                    if x ~= nil then
                        WAR.ShowHead = 0
                        wxlox, wxloy = x, y
                        break;
                    --ESC退出
                    else
                        WAR.ShowHead = 0
                        x, y = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
                        --wxlox, wxloy = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
                        break;
                    end
                end
                --不在自身位置才能触发幻象
                if SelfXY(x, y) == false then
                    SetWarMap(wxlox, wxloy, 4, 0)
                    --本场还没触发过无相转身，则加入新人物
                    if WAR.PLSF == nil then
                        WAR.Person[WAR.PersonNum]["人物编号"] = 600
                        WAR.Person[WAR.PersonNum]["我方"] = WAR.Person[WAR.CurID]["我方"]
                        WAR.Person[WAR.PersonNum]["坐标X"] = wxlox
                        WAR.Person[WAR.PersonNum]["坐标Y"] = wxloy
                        WAR.Person[WAR.PersonNum]["死亡"] = false
                        WAR.Person[WAR.PersonNum]["人方向"] = WAR.Person[WAR.CurID]["人方向"]
                        WAR.Person[WAR.PersonNum]["贴图"] = WarCalPersonPic(WAR.PersonNum)
                    
                        --lib.PicLoadFile(string.format(CC.FightPicFile[1], JY.Person[600]["头像代号"]), string.format(CC.FightPicFile[2], JY.Person[600]["头像代号"]), 4 + WAR.PersonNum)
                        WAR.JQSDXS[600] = 0	--直接指定集气，以免召唤出来马上被斗转跳出
						WAR.SPIRIT[600] = 0           --初始战意
		                WAR.SPIRITMIN[600] = 0        --战意最低值
	                    WAR.SPIRITMAX[600] = 0        --战意最高值
                        WAR.PLSF = WAR.PersonNum
                        WAR.PersonNum = WAR.PersonNum + 1
                    --已经触发过，则让分身复活
                    else
                        WAR.Person[WAR.PLSF]["死亡"] = false
                        WAR.Person[WAR.PLSF]["我方"] = WAR.Person[WAR.CurID]["我方"]
                        WAR.Person[WAR.PLSF]["坐标X"] = wxlox
                        WAR.Person[WAR.PLSF]["坐标Y"] = wxloy
                        WAR.Person[WAR.PLSF]["人方向"] = WAR.Person[WAR.CurID]["人方向"]
                        WAR.Person[WAR.PLSF]["贴图"] = WarCalPersonPic(WAR.PLSF)
                        JY.Person[600]["生命"] = JY.Person[600]["生命最大值"]
                        JY.Person[600]["内力"] = JY.Person[600]["内力最大值"]
                        JY.Person[600]["体力"] = 100
                        JY.Person[600]["受伤程度"] = 0 
                        JY.Person[600]["中毒程度"] = 0
                        JY.Person[600]["冰封程度"] = 0
                        JY.Person[600]["灼烧程度"] = 0
						JY.Person[600]["封穴程度"] = 0
						JY.Person[600]["流血程度"] = 0
                        WAR.Person[WAR.PLSF].Time = 0
                    end
            
                    --清除自身位置贴图
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
                    --修改自身与幻象坐标
                    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], WAR.Person[WAR.PLSF]["坐标X"], WAR.Person[WAR.PLSF]["坐标Y"] = WAR.Person[WAR.PLSF]["坐标X"], WAR.Person[WAR.PLSF]["坐标Y"],WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
                        
                    --增加幻象贴图
                    SetWarMap(WAR.Person[WAR.PLSF]["坐标X"], WAR.Person[WAR.PLSF]["坐标Y"], 5, WAR.Person[WAR.PLSF]["贴图"])
                    SetWarMap(WAR.Person[WAR.PLSF]["坐标X"], WAR.Person[WAR.PLSF]["坐标Y"], 2, WAR.PLSF)
                    SetWarMap(WAR.Person[WAR.PLSF]["坐标X"], WAR.Person[WAR.PLSF]["坐标Y"],10,JY.Person[WAR.Person[WAR.PLSF]["人物编号"]]['头像代号'])
                    
                    --增加自身贴图
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
                    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"],10,JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
                end
                WarDrawMap(0)
                CurIDTXDH(WAR.CurID, 374,1,"疾风迅雷")
                    
                --还原ID并打断连击
                WAR.CurID = s
                WAR.ACT = 10
            end
        end		
		
		--无酒不欢：悲天佛悯的先手反击
	    if WAR.ACT == 1 then
		    local hit_DGQB;
		    for i = 0, CC.WarWidth - 1 do
			    for j = 0, CC.WarHeight - 1 do
				    local effect = GetWarMap(i, j, 4)
				    if 0 < effect then
					    local emeny = GetWarMap(i, j, 2)
					    if emeny >= 0 and emeny ~= WAR.CurID then
						    if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] and match_ID(WAR.Person[emeny]["人物编号"], 9983) then
							    hit_DGQB = emeny
							    break;
						    end
					    end
				    end
			    end
			    if hit_DGQB ~= nil then
				    break;
		    	end
	    	end
		    if hit_DGQB ~= nil then
		    	local pre_target_list = {}
		    	local pre_target_num = 0
		    	local tx_1 = WAR.Person[id]["特效文字0"] or nil
		    	local tx_2 = WAR.Person[id]["特效文字1"] or nil
		    	local tx_3 = WAR.Person[id]["特效文字2"] or nil
		    	local tx_4 = WAR.Person[id]["特效文字3"] or nil
		    	local tx_5 = WAR.Person[id]["特效文字4"] or nil
		    	local tx_6 = WAR.Person[id]["特效动画"]
		    	WAR.Person[id]["特效文字0"] = nil
		    	WAR.Person[id]["特效文字1"] = nil
		    	WAR.Person[id]["特效文字2"] = nil
		    	WAR.Person[id]["特效文字3"] = nil
		    	WAR.Person[id]["特效文字4"] = nil
		    	WAR.Person[id]["特效动画"] = -1
		    	WAR.hit_DGQB = 1
		    	WAR.Person[hit_DGQB]["特效动画"] = 142
		    	for i = 0, CC.WarWidth - 1 do
		    		for j = 0, CC.WarHeight - 1 do
				    	local pre_effect = GetWarMap(i, j, 4)
				    	if pre_effect > 0 then
					    	local pre_target = GetWarMap(i, j, 2)
					    	pre_target_num = pre_target_num + 1
					    	pre_target_list[pre_target_num] = {i, j, pre_target, pre_effect}
					    end
				    end
			    end
			    CleanWarMap(4, 0)
			    local s1 = WAR.CurID
			    WAR.CurID = hit_DGQB
			    WAR.Effect = 2
			    for i = 0, WAR.PersonNum - 1 do
				    if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
					    local pid = WAR.Person[WAR.CurID]["人物编号"]
				    	local eid = WAR.Person[i]["人物编号"]
						local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
                        local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
						local dam;
					    dam = First_strike_dam_DG(pid, eid)
						if dam > 0 then
							ztd(i,"生命点数", -dam)
							SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
							if offset1 <= 7 and offset2 <= 7 then
								WAR.PD["金刚咒"][WAR.Person[i]["人物编号"]] = 1 
							end
						end
				    end
			    end
			    WAR.ShowHP = 0
			    War_ShowFight(WAR.Person[hit_DGQB]["人物编号"], 0, 0, 0, 0, 0, 150, -1)
			    WAR.ShowHP = 1
			    WAR.hit_DGQB = 0
			    WAR.Person[hit_DGQB]["特效动画"] = -1
			    --如果被上一步反击死亡，那么该人物的攻击就结束了
			    if JY.Person[WAR.Person[s1]["人物编号"]]["生命"] <= 0 then
				    return 1
		    	else		
			    	WAR.CurID = s1
			    	CleanWarMap(4, 0)
			    	WAR.Effect = 0
			    	for i = 1, pre_target_num do
			    		SetWarMap(pre_target_list[i][1], pre_target_list[i][2], 2, pre_target_list[i][3])
			    		SetWarMap(pre_target_list[i][1], pre_target_list[i][2], 4, pre_target_list[i][4])
			    	end
			    	WAR.Person[id]["特效文字0"] = tx_1
			    	WAR.Person[id]["特效文字1"] = tx_2
			    	WAR.Person[id]["特效文字2"] = tx_3
			    	WAR.Person[id]["特效文字3"] = tx_4
			    	WAR.Person[id]["特效文字4"] = tx_5
			    	WAR.Person[id]["特效动画"] =  tx_6
			    end
		    end
	    end
		
		if WAR.ACT < 10 and WAR.SXG ~= 1 then --幻光步
		    for i = 0, CC.WarWidth - 1 do
			    for j = 0, CC.WarHeight - 1 do
	                local effect = GetWarMap(i, j, 4)
				    if effect > 0 then
					    local tmpem = GetWarMap(i, j, 2)
	    			    if tmpem > -1 and WAR.Person[tmpem]["人物编号"] ~= nil and (Curr_NG(WAR.Person[tmpem]["人物编号"],93) and PersonKF(WAR.Person[tmpem]["人物编号"],97))
						    and inteam(WAR.Person[tmpem]["人物编号"])
						    and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[tmpem]["我方"] and WAR.HGB[100+WAR.Person[tmpem]["人物编号"]] ~= nil then
						    lib.Delay(50)
						    local tmppid = WAR.CurID	
						    WAR.CurID = tmpem	
						    WAR.SHML[WAR.Person[tmppid]["人物编号"]] = 1
						    CurIDTXDH(WAR.CurID, 65,1,"接引离斯毒火海 幻光游世常自在", C_RED)
	                        WarDrawMap(0)
	                        --CurIDTXDH(WAR.CurID, 65,1,"接引离斯毒火海 幻光游世常自在", C_RED)
	                        lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	                        lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
	                        WarDrawMap(0)
	                        --CurIDTXDH(WAR.CurID, 65,1,"接引离斯毒火海 幻光游世常自在", C_RED)
	                        WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = WAR.HGB[100+WAR.Person[WAR.CurID]["人物编号"]][1], WAR.HGB[100+WAR.Person[WAR.CurID]["人物编号"]][2]
	                        WarDrawMap(0)
	                        --CurIDTXDH(WAR.CurID, 65,1,"接引离斯毒火海 幻光游世常自在", C_RED)
	                        lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	                        lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
	                        WarDrawMap(0)
	                        CurIDTXDH(WAR.CurID, 65,1,"接引离斯毒火海 幻光游世常自在", C_RED)
		                    WAR.HGB[100+WAR.Person[WAR.CurID]["人物编号"]] = nil
						    --local nx, ny = War_AutoEscape()
		                    --War_AutoKHYX()
						    WAR.CurID = tmppid
						    lib.Delay(200)					
	    			        --end
					    end
	    		    end
	    	    end
	        end		
	    end

        --随机移动
        local tf97 = hastf(WAR.CurID,97,2)
        if tf97 ~= nil then
            WAR.WS = 0
        end

        --无酒不欢：标主的大招音效
        local dhxg = JY.Wugong[wugong]["武功动画&音效"]
        if WAR.LXZQ == 1 then
            dhxg = 71
        elseif WAR.JSYX == 1 then
            dhxg = 84
        elseif WAR.ASKD == 1 then
            dhxg = 65
        elseif WAR.LXBR == 1 then
            dhxg = 65
        elseif WAR.GCTJ == 1 then
            dhxg = 108
        elseif WAR.JSTG == 1 then
            dhxg = 119
        end
		if wugong == 20 then
			dhxg = 101
		end
		if wugong == 80 then
			dhxg = 110
		end
		if WAR.SDWLB == 1 then
			dhxg = 203
		end	
		
		if wugong == 341 and WAR.BLJJ > 0 then
			dhxg = 71
		end	
		
        --记录攻击方特效文字，防止防御的时候冲突
        WAR.WZ[pid] = {
            WAR.Person[WAR.CurID]['特效文字0'],
            WAR.Person[WAR.CurID]['特效文字1'],
            WAR.Person[WAR.CurID]['特效文字2'],
            WAR.Person[WAR.CurID]['特效文字3'],
            WAR.Person[WAR.CurID]['特效文字4'],
            WAR.Person[WAR.CurID]['特效动画'],
        }

        WAR.Person[WAR.CurID]['特效文字0'] = nil;
        WAR.Person[WAR.CurID]['特效文字1'] = nil;
        WAR.Person[WAR.CurID]['特效文字2'] = nil;
        WAR.Person[WAR.CurID]['特效文字3'] = nil;
        WAR.Person[WAR.CurID]['特效文字4'] = nil;
        WAR.Person[WAR.CurID]['特效动画'] = -1;
        
        
        Cat('伤害结算',wugong,level,ng,x,y,ZHEN_ID)
        for i = 0, WAR.PersonNum -1 do
        	local id = WAR.Person[i]['人物编号']	
        	--生命内力体力异常最后结算	
			if WAR.Person[i]["Realhurt"] ~= nil then	
				WAR.Person[i]['生命点数'] = (WAR.Person[i]['生命点数'] or 0) + AddPersonAttrib(id,'生命',WAR.Person[i]["Realhurt"])
				WAR.Person[i]["Realhurt"] = nil	
			end	
			if WAR.Person[i]['内力点数'] ~= nil then
				WAR.Person[i]['内力点数'] = AddPersonAttrib(id,'内力',WAR.Person[i]['内力点数'])
			end	
			if WAR.Person[i]['体力点数'] ~= nil then
				WAR.Person[i]['体力点数'] = AddPersonAttrib(id,'体力',WAR.Person[i]['体力点数'])
			end	
			if WAR.Person[i]['内伤点数'] ~= nil then
				WAR.Person[i]['内伤点数'] = AddPersonAttrib(id,'受伤程度',WAR.Person[i]['内伤点数'])
			end	
			if WAR.Person[i]['中毒点数'] ~= nil then
				WAR.Person[i]['中毒点数'] = AddPersonAttrib(id,'中毒程度',WAR.Person[i]['中毒点数'])
			end	
			if WAR.BFXS[id] ~= nil then
				AddPersonAttrib(id,'冰封程度',WAR.BFXS[id])
				WAR.BFXS[id] = 1
			end	
			if WAR.ZSXS[id] ~= nil then
				AddPersonAttrib(id,'灼烧程度',WAR.ZSXS[id])
				WAR.ZSXS[id] = 1
			end
			if WAR.FXXS[id] ~= nil then
				AddPersonAttrib(id,'封穴程度',(WAR.FXDS[id] or 0))
				WAR.FXDS[id] = nil
				WAR.FXXS[id] = 1
			end
			if WAR.LXXS[id] ~= nil then
				AddPersonAttrib(id,'流血程度',WAR.LXXS[id])
				WAR.LXXS[id] = 1
			end
			--实力升级
			if inteam(pid) and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[i]['我方'] and JY.Person[id]["生命"] <= 0 and WAR.Person[i]['死亡'] == true then 
				local nd = JY.Base["难度"]
				local zm = limitX(JY.Base["周目"],1,125)
				local xs = 0
				local wc = 0
				--npc随周目增加自身强度
				if nd > 1 then 
					local fd = nd + ((nd-1)*0.33)
					xs = math.modf(zm*fd)
					wc = math.modf(zm*fd)
				end
				local can_nei = {}
				local neilist = {}
				for nei = 0, JY.WugongNum -1 do
					if JY.Wugong[nei]['武功类型'] == 6 and nei ~= 43 and nei ~= 166 and nei ~= 169 and nei ~= 172 and nei ~= 212 and nei ~= 213 and nei ~= 214 and nei ~= 218
					and nei ~= 235 and nei ~= 281 and nei ~= 282 and nei ~= 301 and nei ~= 354 and nei ~= 359 and nei ~= 365 and nei ~= 366 and nei ~= 373 and nei ~= 378 and nei ~= 379
					and nei ~= 381 then
						neilist[#neilist+1] = nei
					end
				end
				while JY.Person[pid]["畅想分阶"] > JY.Person[id]["畅想分阶"] do
					JY.Person[pid]["畅想分阶"] = JY.Person[pid]["畅想分阶"] - 1	
					if pid == 0 and JY.Person[456]["论剑奖励"] ~= 1 then 
						for p = 0, JY.PersonNum-1 do
							if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 and p ~= 739 and p ~= 740 and JY.Person[p]['畅想分阶'] <= JY.Person[0]['畅想分阶'] then
								if nd >= 3 and JY.Person[p]["畅想分阶"] <= 3 then
									xs = xs + nd * math.modf(zm*2)
									wc = wc + nd * math.modf(zm*2)
								end
								xs = math.modf(xs/7*2)
								wc = math.modf(wc/7*2)
								JY.Person[p]["拳掌功夫"] = JY.Person[p]["拳掌功夫"] + xs
								JY.Person[p]["指法技巧"] = JY.Person[p]["指法技巧"] + xs
								JY.Person[p]["御剑能力"] = JY.Person[p]["御剑能力"] + xs
								JY.Person[p]["耍刀技巧"] = JY.Person[p]["耍刀技巧"] + xs
								JY.Person[p]["特殊兵器"] = JY.Person[p]["特殊兵器"] + xs
								JY.Person[p]["武学常识"] = JY.Person[p]["武学常识"] + wc
								JY.Person[p]['实战'] = JY.Person[p]['实战'] + 50
								AddPersonAttrib(p,'生命',math.huge)
								local tt = math.modf(zm*(7-JY.Person[pid]["畅想分阶"]))
								JY.Person[p]["攻击力"] = JY.Person[p]["攻击力"] + tt
								JY.Person[p]["防御力"] = JY.Person[p]["防御力"] + tt
								JY.Person[p]["轻功"] = JY.Person[p]["轻功"] + tt
							end
						end
						--CC.TX['敌人渐进增强'] = math.modf(CC.TX['敌人渐进增强']*(1+(zm/550)))			
					end 
					if pid == 0 then
						--say('内功加强开始',0,1)	
						for p = 0, JY.PersonNum-1 do
							if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 and p ~= 739 and p ~= 740 then
								for k = 1 , #neilist do
									local pd = false
									for j = 1,JY.Base['武功数量'] do
										if neilist[k] == JY.Person[p]['武功'..j] then
											pd = true
										end
									end
									if pd == false then
										can_nei[#can_nei+1] = neilist[k]
									end
								end
								if can_nei ~= nil and #can_nei > 0 then
									local wg = can_nei[math.random(#can_nei)]
									can_nei = {}
									for l = 1, JY.Base['武功数量'] do
										if JY.Person[p]['武功'..l] == 0 then
											JY.Person[p]['武功'..l] = wg
											JY.Person[p]['武功等级'..l] = 999
											break
										end
									end	
								end					
							end
						end
					end
					if JY.Person[pid]["畅想分阶"] == 6 then
						--CC.TX["弟子"] = 1
						AddPersonAttrib(pid,"攻击力",10)
						AddPersonAttrib(pid,"防御力",10)
						AddPersonAttrib(pid,"轻功",10)
						--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)
					end
					if JY.Person[pid]["畅想分阶"] == 5 then
						--CC.TX["三流"] = 1
						AddPersonAttrib(pid,"拳掌功夫",10)
						AddPersonAttrib(pid,"指法技巧",10)
						AddPersonAttrib(pid,"御剑能力",10)
						AddPersonAttrib(pid,"耍刀技巧",10)
						AddPersonAttrib(pid,"特殊兵器",10)
						--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
					end
					if JY.Person[pid]["畅想分阶"] == 4 then
						--CC.TX["二流"] = 1
						AddPersonAttrib(pid,"攻击力", 20)
						AddPersonAttrib(pid,"防御力", 20)
						AddPersonAttrib(pid,"轻功", 20)
						--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
					end
					if JY.Person[pid]["畅想分阶"] == 3 then
						--CC.TX["一流"] = 1
						AddPersonAttrib(pid,"拳掌功夫", 20)
						AddPersonAttrib(pid,"指法技巧", 20)
						AddPersonAttrib(pid,"御剑能力", 20)
						AddPersonAttrib(pid,"耍刀技巧", 20)
						AddPersonAttrib(pid,"特殊兵器", 20)
						--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
					end
					if JY.Person[pid]["畅想分阶"] == 2 then
						--CC.TX["豪侠"] = 1
						AddPersonAttrib(pid,"攻击力",30)
						AddPersonAttrib(pid,"防御力", 30)
						AddPersonAttrib(pid,"轻功", 30)
						if pid ~= 0 and inteam(pid) then
							SetJX(pid,1)
						end	
						--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
					end
					if JY.Person[pid]["畅想分阶"] == 1 then
						--CC.TX["宗师"] = 1
						AddPersonAttrib(pid,"拳掌功夫",30)
						AddPersonAttrib(pid,"指法技巧",30)
						AddPersonAttrib(pid,"御剑能力",30)
						AddPersonAttrib(pid,"耍刀技巧",30)
						AddPersonAttrib(pid,"特殊兵器",30)
						if pid ~= 0 and inteam(pid) then
							 SetJX(pid,1)
						end
						--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
					end
					if JY.Person[pid]["畅想分阶"] == 0 then
						--CC.TX["传说"] = 1
						AddPersonAttrib(pid, "武学常识",100)
						if pid ~= 0 and inteam(pid) then
							 SetJX(pid,1)
						end
						--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
					end
				end					   
			end
		end
		--夜雨楼杀人
		if JY.Person[525]['论剑奖励'] > 0 and pid == 0 and JY.Person[id]["生命"] <= 0 and inteam(id) == false then
			if MPPD(pid) == 24 then
				if JY.Person[525]['论剑奖励'] == 1 and JY.Person[id]['畅想分阶'] <= 5 then
					CC.TX['夜雨暗杀1']=CC.TX['夜雨暗杀1']+1
				end
				if JY.Person[525]['论剑奖励'] == 2 and JY.Person[id]['畅想分阶'] <= 2 then
					CC.TX['夜雨暗杀2']=CC.TX['夜雨暗杀2']+1
				end	
				if JY.Person[525]['论剑奖励'] > 2  then
					if id == JY.Person[525]['论剑奖励']	then
						CC.TX['夜雨暗杀3'] = id
					elseif JY.Person[id]['姓名'] == JY.Person[JY.Person[525]['论剑奖励']]['姓名'] then
						CC.TX['夜雨暗杀3'] = id
					end	
				end		
			else
				if JY.Person[525]['论剑奖励'] == 1 and JY.Person[id]['畅想分阶'] <= 5 then
					CC.TX['夜雨暗杀1']=CC.TX['夜雨暗杀1']+1
				end
				if JY.Person[525]['论剑奖励'] == 2 and JY.Person[id]['畅想分阶'] <= 2 then
					CC.TX['夜雨暗杀2']=CC.TX['夜雨暗杀2']+1
				end	
				if JY.Person[525]['论剑奖励'] > 2  then
					if id == JY.Person[525]['论剑奖励']	then
						CC.TX['夜雨暗杀3'] = id
					elseif JY.Person[id]['姓名'] == JY.Person[JY.Person[525]['论剑奖励']]['姓名'] then
						CC.TX['夜雨暗杀3'] = id
					end	
				end
			end
		end		
	
        --记录攻击方特效文字，防止防御的时候冲突
        WAR.WZ1[pid] = {
            WAR.Person[WAR.CurID]['特效文字0'],
            WAR.Person[WAR.CurID]['特效文字1'],
            WAR.Person[WAR.CurID]['特效文字2'],
            WAR.Person[WAR.CurID]['特效文字3'],
            WAR.Person[WAR.CurID]['特效文字4'],
            WAR.Person[WAR.CurID]['特效动画'],
        }
        
        --无酒不欢：人物的攻击动画和点数显示
        --攻击方动画
		
		War_ShowFight(pid, wugong, JY.Wugong[wugong]["武功类型"], level, x, y, dhxg, ZHEN_ID)
		
		--李莫愁赤练神掌		
		if WAR.ZQTL[1] ~= nil then
			local dam = WAR.ZQTL[1]
			local ybid = WAR.ZQTL[2]
			local bpX = WAR.ZQTL[3]
			local bpY = WAR.ZQTL[4]
			local pid = WAR.ZQTL[5]
			local ran = 5
			for i = 1, 5 do
				WAR.ZQTL[i] = nil
			end
			local ys_list = {}
			local ys_num = 0
			for i = 0, WAR.PersonNum - 1 do
				if GetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4) == 1 then
					ys_num = ys_num + 1
					ys_list[ys_num] = {WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"]}
				end
			end
			local yes = 1
			while (yes == 1) do
				yes = 0
				WAR.Person[ybid]["引爆"] = 1
				WAR.Person[ybid]["特效动画"] = 117
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["引爆"] == nil and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						local bdid = WAR.Person[i]["人物编号"]
						local offset1 = math.abs(bpX - WAR.Person[i]["坐标X"])
						local offset2 = math.abs(bpY - WAR.Person[i]["坐标Y"])
						if offset1 <= ran and offset2 <= ran then
							WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) - dam
							JY.Person[bdid]["生命"] = JY.Person[bdid]["生命"] - dam
							if JY.Person[bdid]["生命"] < 0 then
								JY.Person[bdid]["生命"] = 0
								yes = 1
								ybid = i
								bpX = WAR.Person[i]["坐标X"]
								bpY = WAR.Person[i]["坐标Y"]
							end
							WAR.TXXS[bdid] = 1
						end
					end
				end
				War_ShowFight(-1, 0, 0, 0, 0, 0, 0, 0)
			end
			CleanWarMap(4, 0)
			for i = 1, ys_num do
			SetWarMap(ys_list[i][1], ys_list[i][2], 4, 1)
			end
		end

		
		if WAR.WZ1[pid] ~= nil then
			WAR.Person[WAR.CurID]['特效文字0'] = WAR.WZ1[pid][1]
			WAR.Person[WAR.CurID]['特效文字1'] = WAR.WZ1[pid][2]
			WAR.Person[WAR.CurID]['特效文字2'] = WAR.WZ1[pid][3]
			WAR.Person[WAR.CurID]['特效文字3'] = WAR.WZ1[pid][4]
			WAR.Person[WAR.CurID]['特效文字4'] = WAR.WZ1[pid][5]
			WAR.Person[WAR.CurID]['特效动画'] = WAR.WZ1[pid][6]
		end
        
    Cat('防御方动画')
    Cat('数值显示')
	
	WAR.WZ1[pid] = nil
    local ztstr = {'生命点数','内力点数','体力点数','内伤点数','中毒点数',WAR.BFXS,WAR.ZSXS,WAR.LXXS,WAR.FXXS}
	local ztstr1 = {'生命','内力','体力','受伤程度','中毒程度','冰封程度','灼烧程度','流血程度','封穴程度'}
    --套装吸血，上限400点
	if WAR.PD['残火太刀'][pid] ~= nil and ((wugong == 66 and match_ID(pid,103) or (yongdao(wugong) and match_ID(pid,745) and wgnlxz(wugong) == 1) or(wugong == 66 and match_ID(pid,771)))) then
		WAR.PD['残火太刀'][pid] = WAR.PD['残火太刀'][pid] + 1
		if WAR.PD['残火太刀'][pid] > 4 then
			WAR.PD['残火太刀'][pid] = nil
		end
	end		
	local xxz = 0
	if WAR.TZLeech > 0 then
		xxz = xxz + WAR.TZLeech
	end
	--血刀吸血，上限400点
    if WAR.XDLeech > 0 then
		xxz = xxz + WAR.XDLeech
    end
	--血河神鉴吸血，上限400点
    if WAR.XHSJ > 0 then
    	xxz = xxz + WAR.XHSJ
	end
	--天魔功吸血20%
    if WAR.TMGLeech > 0 then
		xxz = xxz + WAR.TMGLeech
    end
	--入魔吸血，上限400点
	if WAR.RMXX > 0 then
		xxz = xxz + WAR.RMXX
    end	
    --韦一笑吸血10%，上限400点
    if WAR.WYXLeech > 0 then
    	xxz = xxz + WAR.WYXLeech
    end
	--云中鹤吸血10%，上限400点
	if WAR.YZHLeech > 0 then
		xxz = xxz + WAR.YZHLeech
    end
	--殷离吸血
	if WAR.YLXX > 0 then
		xxz = xxz + WAR.YLXX
    end
		--千蛛万毒手吸血，上限300点
	if WAR.QZWDS > 0 then
		xxz = xxz + WAR.QZWDS
    end
	--全真剑法回血
	if wugong == 39 and WAR.QZ_QXJF == 5 then
		xxz = xxz + math.random(200,500)
	end	
    --胡刀回血
	if wugong  == 67 and WAR.PD['铁碎牙'][pid] ~= nil and WAR.PD['铁碎牙'][pid] > 3 then
		xxz = xxz + WAR.PD['铁碎牙'][pid]
		WAR.PD['铁碎牙'][pid] = 1
	end
	if xxz > 0 then
		WAR.Person[WAR.CurID]['生命点数'] = (WAR.Person[WAR.CurID]['生命点数'] or 0) + AddPersonAttrib(pid,'生命',xxz)
	end	
	-----攻击后对己不利状态--------------
	local zbkx = 0
	--无明业火状态，耗损使用的内力的生命
    if WAR.PD["无明业火"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 127,1, "无明业火", C_ORANGE)
		local nlDam = math.modf(math.random(4,14) * JY.Wugong[wugong]["消耗内力点数"])
		zbkx = zbkx -nlDam
		if WAR.PD["一阳指劲"][pid] ~= nil and JY.Person[pid]["灼烧程度"] > 0 then
			local yyDam = math.modf(math.random(4,14) * JY.Wugong[wugong]["消耗内力点数"])
			zbkx = zbkx -yyDam
		end
	end
	--岳家枪诀
	if WAR.PD["岳家枪诀"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 58,1, "红莲劫焰", C_ORANGE)
		zbkx = zbkx -350
	end
	--天绝剑气
	if WAR.PD["天绝剑气"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 62,1, "剑之傲骨・浩然正气", C_ORANGE)
		local a = math.modf(JY.Person[pid]["内力"]/15)
		zbkx = zbkx -a
	end
	--万剑归宗
	if WAR.PD["万剑归宗"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 60,1, "万剑归宗・凌厉无匹", C_ORANGE)
		local a = JY.Person[pid]["御剑能力"]
		zbkx = zbkx -a
	end
	--唯识剑意
	if WAR.PD["唯识剑意2"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 193,1, "唯识剑意・以念成型", C_ORANGE)
		local a = math.modf(JY.Person[pid]["御剑能力"]/2)
		local b = math.modf(JY.Person[pid]["内力"]/4)
		local c = a + b
		zbkx = zbkx -c
	end
	--南凤朱雀
	if WAR.PD["南凤朱雀"][pid] ~= nil then 
		CurIDTXDH(WAR.CurID, 94,1, "火凤燎原", C_ORANGE)
		local a = math.modf(JY.Person[pid]["内力"]/20)
		zbkx = zbkx -a
	end
	--百里青霜
	if WAR.PD["青霜辟邪"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 1,1, "青霜剑气", C_ORANGE)
		zbkx = zbkx -500
	end
	--护龙山庄
	if WAR.PD["护龙空手"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 18,1, "仙鹤神针", C_ORANGE)
		local a = math.modf(JY.Person[pid]["防御力"]/2)
		zbkx = zbkx -a
		WAR.Person[WAR.CurID]['体力点数'] = (WAR.Person[WAR.CurID]['体力点数'] or 0) + AddPersonAttrib(pid,'体力',-4)
	end
	--花涧2级
	if WAR.PD["花涧如雾"][pid] ~= nil then
		CurIDTXDH(WAR.CurID, 66,1, "玉炉香・红蜡泪", C_ORANGE)
		local a = math.modf(JY.Person[pid]["受伤程度"])
		local b = math.modf(JY.Person[pid]["中毒程度"])
		local c = math.modf(JY.Person[pid]["冰封程度"])
		local d = math.modf(JY.Person[pid]["灼烧程度"])
		local e = math.modf(JY.Person[pid]["封穴程度"])
		local f = math.modf(JY.Person[pid]["流血程度"])
		local g = a + b + c + d + e + f
		zbkx = zbkx -g
	end
	--九阴降龙
	if WAR.PD["降龙虚劲"][pid] ~= nil and WAR.PD["降龙虚劲"][pid] > 0 then
		CurIDTXDH(WAR.CurID, 58,1, "降龙虚劲", C_ORANGE)
		local xl = WAR.PD["降龙虚劲"][pid]
		local ss = JY.Person[pid]["受伤程度"]*3+100*xl
		zbkx = zbkx -ss
		WAR.PD["灵蛇拳"][pid] = math.random(5,15)
	end
	if WAR.PD['暗香疏影'][pid] == 4 and JLSD(10,35,pid) then
		WAR.MMGJ = 1
		CurIDTXDH(WAR.CurID,89,1,"暗香如梦・攻击落空", C_ORANGE)
		zbkx = zbkx - math.random(300,500)
    end
	if WAR.PD['忘情日明'][pid] == 1 then
		WAR.MMGJ = 1	
		CurIDTXDH(WAR.CurID,89,1,"双目失明・重度内伤", C_ORANGE)
		zbkx = zbkx - 500
		ztd(WAR.CurID,"内伤点数",50)
		ztd(WAR.CurID,WAR.LXXS,50)
    end
	--九死龙爪毒
	if WAR.PD['龙爪毒'][pid] ~= nil and WAR.PD['龙爪毒'][pid] > 0 then
		if WAR.PD['龙爪毒'][pid] < 4 and JLSD(10,45,pid) then
			WAR.PD['刺目'][pid] = 2
		elseif WAR.PD['龙爪毒'][pid] > 3 and WAR.PD['龙爪毒'][pid] < 7 and JLSD(10,65,pid) then
			WAR.PD['刺目'][pid] = 2
			WAR.PD['基础蛊毒'][pid] = 1
			addbuff(pid,WAR.PD['西域奇毒'],10)
		elseif WAR.PD['龙爪毒'][pid] > 6 and JLSD(10,65,pid) then
			WAR.PD['刺目'][pid] = 2
			WAR.PD['基础蛊毒'][pid] = 1
			zbkx = zbkx - JY.Person[pid]["中毒程度"]*3
			for zd = 0,WAR.PersonNum-1 do 
				local zdid = WAR.Person[zd]["人物编号"]
				if DWPD(WAR.CurID,zd) and dead(zd) == false then
					addbuff(zdid,WAR.PD['西域奇毒'],10)
					addbuff(zdid,WAR.PD['毒击'],10)
					if nokillspeed(zd) == false then
						ztd(zd,'集气位置',-JY.Person[zdid]["中毒程度"]) 
					end	
				end
			end	
		end	
		WAR.PD['龙爪毒'][pid] = WAR.PD['龙爪毒'][pid] + 1
		if WAR.PD['龙爪毒'][pid] > 9 then
			zbkx = zbkx - math.modf(JY.Person[pid]["生命"]/3)
			WAR.PD['龙爪毒'][pid] = nil
		end	
	end
	--竹风雨滴
    if WAR.XWRJ[100 + pid] == 1 then
		CurIDTXDH(WAR.CurID, 58, 1, "剑气・破体")
		for j = 0, WAR.PersonNum -1 do 
			if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then 
				local a = 0 
				if WAR.XWGJ[WAR.Person[j]["人物编号"]] ~= nil and WAR.XWGJ[WAR.Person[j]["人物编号"]] > 0 then 
					a = WAR.XWGJ[WAR.Person[j]["人物编号"]]
				end
				zbkx = zbkx -math.modf(100 * (1 + a * 0.3))
			end
		end
		WAR.XWRJ[100 + pid] = nil
	end
	--竹风雨滴
	if WAR.XWRJ[200+pid] ~= nil and WAR.XWRJ[200+pid] > 0 then
		CurIDTXDH(WAR.CurID, 58, 1, "剑气・噬体")
		local lxkx = WAR.XWRJ[200+pid]
		for j = 0, WAR.PersonNum -1 do 
			if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then 
				local a = 0 
				if WAR.XWGJ[WAR.Person[j]["人物编号"]] ~= nil and WAR.XWGJ[WAR.Person[j]["人物编号"]] > 0 then 
					a = WAR.XWGJ[WAR.Person[j]["人物编号"]]
				end
				zbkx = zbkx -math.modf(lxkx*0.5)
			end
		end 
		WAR.XWRJ[200 + pid] = nil 	
	end 
	--龙象神足
    if WAR.LXQJ[100 + pid] == 1 then
		CurIDTXDH(WAR.CurID, 58, 1, "龙象明劲・爆")
		for j = 0, WAR.PersonNum -1 do 
		    if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then 
			    local a = 0 
			    if WAR.LWZN[WAR.Person[j]["人物编号"]] ~= nil and WAR.LWZN[WAR.Person[j]["人物编号"]] > 0 then 
				    a = WAR.LWZN[WAR.Person[j]["人物编号"]]
				end
				zbkx = zbkx -math.modf(150 * (1 + a * 0.5))
			end
			WAR.LWZN[WAR.Person[j]["人物编号"]] = nil
		end  
		WAR.LXQJ[100 + pid] = nil
	end
	--龙象神足
	if WAR.LXQJ[200+pid] ~= nil and WAR.LXQJ[200+pid] > 0 then
		CurIDTXDH(WAR.CurID, 58, 1, "龙象暗劲・再爆")
		local lxkx = WAR.LXQJ[200+pid] or 0
		for j = 0, WAR.PersonNum -1 do 
			if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then 
				local a = 0 
				if WAR.LWZN[WAR.Person[j]["人物编号"]] ~= nil and WAR.LWZN[WAR.Person[j]["人物编号"]] > 0 then 
					a = WAR.LWZN[WAR.Person[j]["人物编号"]]
				end
				zbkx = zbkx -math.modf(lxkx*0.5)
			end
			WAR.LWZN[WAR.Person[j]["人物编号"]] = nil
		end 
		WAR.LXQJ[200 + pid] = nil
	end 
	--碧海玉箫
	if WAR.BYCX[pid] ~= nil and WAR.BYCX[pid] > 0 then
		CurIDTXDH(WAR.CurID,313,1,"八音穿心")
		local yc = JY.Person[pid]["流血程度"] + JY.Person[pid]["受伤程度"] + JY.Person[pid]["中毒程度"] 
		+ JY.Person[pid]["封穴程度"] + JY.Person[pid]["冰封程度"] + JY.Person[pid]["灼烧程度"]
		local a = math.modf(yc*0.5*(WAR.LBPM+1))
		zbkx = zbkx - a
	end
	--黄天无极割裂
	if WAR.XWSD[pid] ~= nil and WAR.XWSD[pid] > 0 then 
		CurIDTXDH(WAR.CurID,15,1,"血脉破碎")
		local a = math.modf(300*(WAR.LBPM+1))
		zbkx = zbkx - a
	end
	--龙象火焰刀
	if WAR.HYDJ[100 + pid] == 1 then 
		CurIDTXDH(WAR.CurID, 88, 1, "火焰刀气・破体实劲")
		for j = 0, WAR.PersonNum -1 do 
			if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then 
				local a = 0 
				if WAR.HYDQ[WAR.Person[j]["人物编号"]] ~= nil and WAR.HYDQ[WAR.Person[j]["人物编号"]] > 0 then 
					a = WAR.HYDQ[WAR.Person[j]["人物编号"]]
				end
				zbkx = zbkx - math.modf(100 * (1 + a * 0.1))
			end
			WAR.HYDQ[WAR.Person[j]["人物编号"]] = nil
		end
		WAR.HYDJ[100 + pid] = nil  
	end	
	--龙象火焰刀
	if WAR.HYDJ[200 + pid] ~= nil  and WAR.HYDJ[200 + pid] > 1 then
		CurIDTXDH(WAR.CurID, 88, 1, "火焰刀气・破命虚劲")
		local hdkx = math.modf(0.8*WAR.HYDJ[200+pid])
		for j = 0, WAR.PersonNum -1 do 
			if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then 
				zbkx = zbkx -math.modf(hdkx)
			end
			WAR.HYDQ[WAR.Person[j]["人物编号"]] = nil
		end  
		WAR.HYDJ[200 + pid] = nil
	end
	--------------------------------------------加力触发陷阱------------------------------------------
	if WAR.NGJL > 0 then
		if WAR.PD['残劲袭魄'][pid] ~= nil then
			ztd(WAR.CurID,'内伤点数', math.random(10,25))
			zbkx = zbkx - math.modf(JY.Person[pid]["受伤程度"]*2)
			WAR.PD["脆弱状态"][pid] = 2
			ng = math.modf(ng/3)
			Set_Eff_Text(WAR.CurID,"特效文字2","残劲袭魄")
			WAR.PD['残劲袭魄'][pid] = nil				
		end
		if WAR.PD['败血破命'][pid] ~= nil then
			ztd(WAR.CurID,WAR.LXXS,25)
			zbkx = zbkx - math.modf(JY.Person[pid]["流血程度"]*5)
			Set_Eff_Text(WAR.CurID,"特效文字2","败血破命")
			WAR.PD['败血破命'][pid] = nil
		end
		if WAR.PD['血色诅咒'][pid] ~= nil then
			Set_Eff_Text(WAR.CurID,"特效文字2","血咒爆发")
			local xs = (WAR.PD['血色诅咒'][pid] or 0) * 100
			zbkx = zbkx - xs
			if math.random(10) <= 3 then
				WAR.PD['昏迷状态'][pid] = 1
			end
			WAR.PD['血色诅咒'][pid] = nil
		end
		if WAR.PD['火毒攻心'][pid] ~= nil then
			ztd(WAR.CurID,WAR.ZSXS,30)
			zbkx = zbkx - math.modf(JY.Person[pid]["灼烧程度"]*2)
			if JY.Person[pid]["灼烧程度"] >= 50 then
				WAR.PD['无明业火'][pid] = 20
			end	
			Set_Eff_Text(WAR.CurID,"特效文字2","火毒攻心")
			WAR.PD['火毒攻心'][pid] = nil
		end
		if WAR.PD['寒毒入体'][pid] ~= nil then
			ztd(WAR.CurID,WAR.BFXS,30)
			zbkx = zbkx - math.modf(JY.Person[pid]["冰封程度"]*2)
			if JY.Person[pid]["冰封程度"] >= 50 then
				WAR.PD["冰冻状态"][pid] = (WAR.PD["冰冻状态"][pid] or 0) + math.random(10)
				WAR.PD["利刃寒锋"][pid] = (WAR.PD["利刃寒锋"][pid] or 0) + math.random(10)
				WAR.PD['冰冻扣血'][pid] = (WAR.PD['冰冻扣血'][pid] or 0) + math.random(10)
			end	
			Set_Eff_Text(WAR.CurID,"特效文字2","寒毒入体")
			WAR.PD['寒毒入体'][pid] = nil				
		end
		if WAR.PD['五蕴炽盛'][pid] ~= nil then
			local aa=math.random(4)
			local bb=math.random(8)
			ztd(WAR.CurID,WAR.FXXS, 2.5*aa)
			ztd(WAR.CurID,WAR.BFXS, 5*bb)
			ztd(WAR.CurID,WAR.ZSXS, 5*bb)
			ztd(WAR.CurID,WAR.LXXS, 5*bb)
			ztd(WAR.CurID,"中毒点数",5*bb)
			WAR.DLJ = 1
			Set_Eff_Text(WAR.CurID,"特效文字2","五蕴炽盛")
			WAR.PD['五蕴炽盛'][pid] = nil				
		end
		if WAR.PD['毒击'][pid] ~= nil then
			zbkx = zbkx - math.modf(JY.Person[pid]["中毒程度"]*math.random(3))
			WAR.PD["西域奇毒"][pid] = math.modf(JY.Person[pid]["中毒程度"]/10) + math.random(5)
			Set_Eff_Text(WAR.CurID,"特效文字2","毒入骨髓")
			WAR.PD['毒击'][pid] = WAR.PD['毒击'][pid] - 10
			if WAR.PD['毒击'][pid] < 1 then
				WAR.PD['毒击'][pid] = nil
			end
		end	
		if WAR.PD['业障缠身'][pid] == 31 then
			ztd(WAR.CurID,WAR.FXXS, math.random(10,20))
			WAR.PD['封气绝脉'][pid] = 1
			WAR.PD['逆转经脉'][pid] = 2
			WAR.PD['业障缠身'][pid] = nil
		end
		if WAR.PD['噬魂'][pid] ~= nil then
			zbkx = zbkx - 500
			addbuff(pid,WAR.PD["力竭"],1,3)
			WAR.PD["疯魔"][pid] = (WAR.PD["疯魔"][pid] or 0) + math.random(5,15)
			WAR.PD["创伤"][pid] = (WAR.PD["创伤"][pid] or 0) + math.random(1,5)
			WAR.PD['九阴摄魂'][pid] = 1
			WAR.PD['噬魂'][pid] = nil
		end
		if WAR.PD['神教逆杀'][pid] ~= nil then --日月神教
			ztd(WAR.CurID,WAR.LXXS,15)
			ng = 0
			WAR.PD['神教逆杀'][pid] = WAR.PD['神教逆杀'][pid] - 1
			if WAR.PD['神教逆杀'][pid] < 1 then
				WAR.PD['神教逆杀'][pid] = nil
			end
		end
	end
	if zbkx < 0 then
		WAR.Person[WAR.CurID]['生命点数'] = (WAR.Person[WAR.CurID]['生命点数'] or 0) + AddPersonAttrib(pid,'生命',zbkx)
	end
	
    WAR.PD['神游太虚'] = {}
    War_Show_Count(WAR.CurID);--显示当前控制人的点数
    WAR.TFBW = 0		--听风辨位的文字记录恢复
    WAR.TLDWX = 0		--天罗地网的文字记录恢复

    if WAR.FHJZ == 1 then
        DrawStrBoxWaitKey("【Ｇ复活戒指Ｂ】损坏了！", C_ORANGE, CC.DefaultFont, 2)
        WAR.FHJZ = 0
    end
    WAR.Person[WAR.CurID]["经验"] = WAR.Person[WAR.CurID]["经验"] + 2 
    --武功增加经验和升级
    if inteam(pid) then
		if JY.Person[pid]["武功等级" .. wugongnum] < 900 then
			JY.Person[pid]["武功等级" .. wugongnum] = JY.Person[pid]["武功等级" .. wugongnum] + 10
		elseif JY.Person[pid]["武功等级" .. wugongnum] < 999 then
			--无酒不欢：空挥一次到极
			JY.Person[pid]["武功等级" .. wugongnum] = JY.Person[pid]["武功等级" .. wugongnum] + math.modf(JY.Person[pid]["资质"] / 20 + math.random(2)) + 10
			--武功提升为极
			if 999 <= JY.Person[pid]["武功等级" .. wugongnum] then
				JY.Person[pid]["武功等级" .. wugongnum] = 999
				PlayWavAtk(42)
				DrawStrBoxWaitKey(string.format("%s修炼%s到登峰造极", JY.Person[pid]["姓名"], JY.Wugong[JY.Person[pid]["武功" .. wugongnum]]["名称"]), C_ORANGE, CC.DefaultFont)
				if match_ID(pid, 49) and wugong == 14 then
					say("逍遥派的武学果然博大精深，让小僧有醍醐灌顶之感。", 49, 0);
					DrawStrBoxWaitKey("虚竹资质改变！", C_ORANGE, CC.DefaultFont)
					local xid = 49;	--标记修改
					if JY.Base["畅想"] == 49 or JY.Base["畅想"] == 53 then
						xid = 0
					end
					set_potential(xid, 100)
				end
				--畅想专属玉真子嫁衣神功
				if pid == 0 and match_ID(pid, 184) and (wugong == 13 or wugong == 143) and JY.Person[184]["品德"] ~= 40 then
					local jysg=0
					for i = 1, JY.Base["武功数量"] do
						if JY.Person[pid]["武功" .. i] == 143 and JY.Person[pid]["武功等级" .. i] == 999 then
							jysg=jysg+1
						end
						if JY.Person[pid]["武功" .. i] == 13 and JY.Person[pid]["武功等级" .. i] == 999 then
							jysg=jysg+1
						end
					end
					if jysg>1 then
						say("原来这就是嫁衣神功", 0, 1);
						DrawStrBoxWaitKey("玉真子等级改变！", C_ORANGE, CC.DefaultFont)
						JY.Person[0]["等级"] = 1
						JY.Person[184]["品德"] = 40
					end
				end
				--狄云 神照功为极，增加轻功20点
				if match_ID(pid, 37) and wugong == 94 then
					say("神照经当真奇妙，四肢百骸感觉劲力充盈。丁大哥，我一定不会让你失望的！", 37, 0);
					DrawStrBoxWaitKey("狄云领悟神照经的真髓，轻功加二十", C_ORANGE, CC.DefaultFont)
					AddPersonAttrib(pid, "轻功", 20)
				end
				--胡斐，胡家刀法到极，增加50点耍刀技巧
				if match_ID(pid, 1) and wugong == 67 then
					say("刀法真是越练越精妙。", 1, 0);
					DrawStrBoxWaitKey("胡斐攻、防、轻、耍刀技巧各增加50点", C_ORANGE, CC.DefaultFont)
					AddPersonAttrib(pid, "攻击力", 50)
					AddPersonAttrib(pid, "防御力", 50)
					AddPersonAttrib(pid, "轻功", 50)
					AddPersonAttrib(pid, "耍刀技巧", 50)
				end
			end
		end         
		--武功提升普通等级
		if level < math.modf(JY.Person[pid]["武功等级" .. wugongnum] / 100) + 1 then
			level = math.modf(JY.Person[pid]["武功等级" .. wugongnum] / 100) + 1
			for i = 1,10 do
				Cat('实时特效动画')
				Cls()
				Cat('实时特效动画2')
				DrawStrBox(-1, -1, string.format("%s 升为 %d 级", JY.Wugong[JY.Person[pid]["武功" .. wugongnum]]["名称"], level), C_ORANGE, CC.DefaultFont)
				ShowScreen()
				lib.Delay(CC.BattleDelay)
			end
		end
	end
		----------------------------------------------------------------------------------------
		------------------------------攻击后消耗内力--------------------------------------------
		----------------------------------------------------------------------------------------
        --我方，消耗的内力
        if WAR.Person[WAR.CurID]["我方"] then
            local nl = nil
            nl = math.modf((level * 2) / 2.4 * JY.Wugong[wugong]["消耗内力点数"])
            
            --纯阳减少内力消耗
            --主运
            if Curr_NG(pid, 99) then
                nl = math.modf(nl*0.4);
            --被动
            elseif PersonKF(pid, 99) then
                nl = math.modf(nl*0.5);
            end
            if PersonKF(pid, 43) then
            nl = math.modf(nl*0.7)
            end  
            --阳内主运九阳，减少70%耗内
            if Curr_NG(pid, 106) and rwnlxz(pid,1) then
                nl = math.modf(nl*0.3);
            end
			--擒龙降龙
			if wugong == 26 and (Curr_NG(pid,204) or match_ID(pid,50)) then 	
				nl = math.modf(nl*0.2);
			end
			--醉八仙
            if WAR.PD['醉八仙'][pid] ~= nil then
				nl = math.modf(nl/2);
			end
            --石破天觉醒后，太玄消耗减半
            if JXPD(pid, 38, 1) and wugong == 102 then
                nl = math.modf(nl/2);
            end
            
            --段誉六脉消耗减半
            if match_ID(pid, 53) and wugong == 49 then
                nl = math.modf(nl/2);
            end

            --指法主角六脉消耗减半
            if actor(pid,2) and wugong == 49 then
                nl = math.modf(nl/2);
            end
            
            --天外攻击，只消耗一半内力
            if Given_WG(pid, wugong) then
                nl = math.modf(nl/2);
            end
            
            --周伯通论剑奖励，体内消耗减少50%
            if match_ID(pid,0) and JY.Person[64]["论剑奖励"] >= 1 then
                nl = math.modf(nl/2)
            end
			if WAR.PD['暗香疏影'][pid] == 4 then
				nl = nl * 2 
			end
			if WAR.PD['绽放'][pid] ~= nil then
				nl = nl + 200
			end
            AddPersonAttrib(pid, "内力", -(nl))
        --NPC的耗内
        else
			local nl = math.modf((level + 3) / 14) * JY.Wugong[wugong]["消耗内力点数"]
			if WAR.PD['暗香疏影'][pid] == 4 then
				nl = nl * 2
			end	
			if WAR.PD['绽放'][pid] ~= nil then
				nl = nl + 200
			end		
            AddPersonAttrib(pid, "内力", -nl)
        end
    
        if JY.Person[pid]["内力"] < 0 then
            JY.Person[pid]["内力"] = 0
        end
        
        if JY.Person[pid]["生命"] <= 0 then
            break;
        end
		--盲目状态，20%几率攻击无效
        if WAR.PD["盲目状态"][pid] == 2 and JLSD(0,40,pid) then
            WAR.MMGJ = 1
			WAR.Person[WAR.CurID]['特效动画'] = 89
			WAR.Person[WAR.CurID]['特效文字2'] = "盲目状态・攻击无效"
		end
        --刺目状态，100%几率攻击无效
		if WAR.PD["刺目"][pid] == 2  then
            WAR.CMGJ = 1
            WAR.Person[WAR.CurID]['特效动画'] = 89
			WAR.Person[WAR.CurID]['特效文字2'] = "刺目状态・攻击无效"
        end
		if WAR.PD['业障缠身'][pid] == 31 and JLSD(0,50,pid) then
			WAR.MMGJ = 1
			WAR.Person[WAR.CurID]['特效动画'] = 89
			WAR.Person[WAR.CurID]['特效文字2'] = "业障缠身・心绪不宁"
       	end
		if WAR.PD['头晕目眩'][pid] == 1 and JLSD(10,60,pid) then
			WAR.MMGJ = 1
			WAR.Person[WAR.CurID]['特效动画'] = 89
			WAR.Person[WAR.CurID]['特效文字2'] = "头晕目眩・攻击落空"
       	end    
        --微醺状态
		if WAR.PD["微醺"][pid] ~= nil and WAR.PD["微醺"][pid] > 0 and math.random(20) <= WAR.PD['微醺'][pid] then
			WAR.MMGJ = 1
			WAR.Person[WAR.CurID]['特效动画'] = 89
			WAR.Person[WAR.CurID]['特效文字2'] = "醉眼朦胧・攻击无效"
		end
		--意恍惚
		if WAR.PD["意恍惚"][pid] ~= nil and WAR.PD["意恍惚"][pid] > 0 and math.random(10) < 5 then
			WAR.MMGJ = 1
			WAR.Person[WAR.CurID]['特效动画'] = 89
			WAR.Person[WAR.CurID]['特效文字2'] = "神思不定・攻击失准"
		end
		--避免战意为负
		for i = 0, WAR.PersonNum-1 do 
			if WAR.Person[i]["死亡"] == false then
				local id = WAR.Person[i]["人物编号"]
				if WAR.SPIRITMIN[id] ~= nil then
					if (WAR.SPIRIT[id] or 0) < WAR.SPIRITMIN[id] then
						WAR.SPIRIT[id] = WAR.SPIRITMIN[id]
					end
				else
					if (WAR.SPIRIT[id] or 0) < 10 then
						WAR.SPIRIT[id] = 10
					end
				end
			end
		end	
		
        --无酒不欢：被杀气的动态显示
        DrawTimeBar2()
        --太极拳，借力打力，蓄力清除
        WAR.ACT = WAR.ACT + 1   --统计攻击次数累加1
		WAR.ACT1 = WAR.ACT1 + 1
		if WAR.ACT > 1 then
			if WAR.Person[WAR.CurID]["我方"] then
				local nl = nil       
				nl = math.modf((level + 3) / 2) * JY.Wugong[wugong]["消耗内力点数"]
				nl = math.modf(nl*0.5)            
				if Curr_NG(pid, 99) then
					nl = math.modf(nl*0.4);
				elseif PersonKF(pid, 99) then
					nl = math.modf(nl*0.5);
				end
				if PersonKF(pid, 43) then
				nl = math.modf(nl*0.7)
				end  
				if Curr_NG(pid, 106) and rwnlxz(pid,1) then
					nl = math.modf(nl*0.3);
				end            
				if match_ID(pid,50) and wugong == 26 then
					nl = math.modf(nl/2);
				end	
				if JXPD(pid, 38, 1) and wugong == 102 then
					nl = math.modf(nl/2);
				end
				if match_ID(pid, 53) and wugong == 49 then
					nl = math.modf(nl/2);
				end
				if actor(pid,2) and wugong == 49 then
					nl = math.modf(nl/2);
				end
				if Given_WG(pid, wugong) then
					nl = math.modf(nl/2);
				end           
				if match_ID(pid,0) and JY.Person[64]["论剑奖励"] >= 1 then
					nl = math.modf(nl/2)
				end
				if WAR.PD['暗香疏影'][pid] == 4 then
					nl = nl * 2 
				end
				if WAR.PD['绽放'][pid] ~= nil then
					nl = nl + 200
				end
				AddPersonAttrib(pid, "内力", -(nl))
			else
			    local nl = math.modf((level + 3) / 14) * JY.Wugong[wugong]["消耗内力点数"]
			    if WAR.PD['暗香疏影'][pid] == 4 then
					nl = nl * 2 
				end
				if WAR.PD['绽放'][pid] ~= nil then
					nl = nl + 200
				end
				AddPersonAttrib(pid, "内力", -(nl))
			end
			if JY.Person[pid]["内力"] < 0 then
				JY.Person[pid]["内力"] = 0
			end
			if JY.Person[pid]["生命"] <= 0 then
				break;
			end
		end		
		
		--洗髓修练
		if JY.Person[pid]['门派技能4'] >= 1 and JY.Person[pid]['门派技能4'] < 1000 and WAR.NGJL > 0 then--
			local ll = math.modf((7-JY.Person[pid]['畅想分阶'])*math.random(3,10))
			JY.Person[pid]['门派技能4'] = limitX(JY.Person[pid]['门派技能4'] + ll,1,1000)
		end
		--瑜伽修炼
        if JY.Person[pid]['门派技能5'] >= 1 and JY.Person[pid]['门派技能5'] < 801 and WAR.ACT > 1 and wugong > 0 
		and yongnei(wugong) == false and yongqin(wugong) == false then
			local ll = math.random(25,45)
			JY.Person[pid]['门派技能5'] = limitX(JY.Person[pid]['门派技能5'] + ll,1,801)
		end
			
    --[[for i = 0, CC.WarWidth - 1 do
        for j = 0, CC.WarHeight - 1 do
            lib.GetKey()
            local effect = GetWarMap(i, j, 4)
            if 0 < effect then
                local enemyid = GetWarMap(i, j, 2)
                if 0 <= enemyid and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[enemyid]["我方"]  then
                    local eid = WAR.Person[enemyid]['人物编号']
                    n = n + 1;--攻艄仁欠裼撤
                    local eid = WAR.Person[enemyid]["人物编号"]
                    if JY.Person[eid]["生命"] > 0 and WAR.Person[enemyid]["死亡"] == false  then
                        flag = true;
                        break
                    end
                end
            end
        end
    end]]
	--蓝烟清：攻击范围内的敌人全部死亡时取消连击
    local flag = true;
    local n = 0;

    for j = 0, WAR.PersonNum -1 do
    	local jid = WAR.Person[j]['人物编号']
    	if DWPD(WAR.CurID,j) and WAR.PD['受击判定'][jid] == 1 then--
    		--say(jid,0,1) --..WAR.PD['受击判定'][jid]
    		flag = false
    		if JY.Person[jid]['生命'] > 0 then
    			n = n + 1
    		end
    		WAR.PD['受击判定'][jid] = nil
    	end
    end			
    	
		--空挥 flag == true n == 0
		--有人被打，有活人 flag == false n > 0	
    --有人被打，没有活人时中断连击
    if flag == false and n == 0 and match_ID(pid,2) == false then
    	break
    else
    	if JY.Person[pid]["体力"] < 5 or JY.Person[pid]["内力"] < 50 then
    		break
    	end	 	
    end	
    --[[	
    if flag == true and (JY.Person[pid]["体力"] < 5 or JY.Person[pid]["内力"] < 50) then
			flag = false
		end	
			
    --无酒不欢：程灵素不会中断连击
    if flag == false and n > 0 and match_ID(pid,2) == false then
        break
    end
		]]
	--断左右
    if WAR.ZYHB > 0 and WAR.DZY == 1 then
		WAR.DZY = 0
		if ZYHBPD(pid) == 2 then
		elseif wugong == 139 and WAR.YNSX1 > 0 then
		else	
			if NGQH(pid,102) and math.random(10) > 9 then
				WAR.ZYHB = 0
			elseif Curr_NG(pid,102) and math.random(10) > 6 then
				WAR.ZYHB = 0
			end
		end	
	end	
	--断连击
	if WAR.DLJ > 0 and yongte(wugong) and QIQX(pid,'乱春岚') > 0 and BNJQ(pid) then
		WAR.DLJ = 0
	end
	if WAR.ATNum > 1 and WAR.DLJ == 1 then
		WAR.DLJ = 0
		if MyDlj(WAR.CurID) == false then
			WAR.ACT = 10
		end	
	end
    
    --无量禅震
    if WAR.PD['无量禅震'][pid] ~= nil then
        if WAR.PD['无量禅震'][pid].s == 1 and WAR.PD['无量禅震'][pid].n < 6 then
            WAR.ATNum = WAR.ATNum + 1
            WAR.PD['无量禅震'][pid].s = nil
        end
    end

        --计算消耗的体力
        local jtl = 0
        if 1000 <= WAR.WGWL then
            jtl = 9
		elseif 600 <= WAR.WGWL then
            jtl = 7
        elseif 300 <= WAR.WGWL then
            jtl = 5
        elseif 150 <= WAR.WGWL then
            jtl = 3
        else
            jtl = 1
        end
        
        
		--疯魔
		if WAR.PD['疯魔'][pid] ~= nil then
			jtl = jtl + 6
		end
		--混元紫霞
	    if NGQHB(pid,90) then
		    jtl = jtl - 4
	    end
		--太玄被动减少体力消耗2点
        if PersonKF(pid, 102) then
            jtl = jtl - 2
        end
        --装备青驴 体力-2
        if JY.Person[id]["坐骑"] == 339 then
            jtl = jtl - 2
        end
        --九霄中华耗体力-2
        if NGQH(pid,184) then
            jtl = jtl - 2
        end
		--易水寒耗体-2
		if Curr_NG(pid, 43) then
            jtl = jtl - 2
        end
		--主运葵花耗体-2
		if Curr_NG(pid, 105) then
            jtl = jtl - 2
        end
		--周伯通论剑奖励，体内消耗减少50%
        if match_ID(pid,0) and JY.Person[64]["论剑奖励"] >= 1 then
            jtl = jtl/2
        end
        --天赋外功消耗减少30%
        if Given_WG(pid, wugong) then
            jtl = jtl*0.7
        end
		if jtl < 1 then 
            jtl = 1
        end
		
		--混元老祖
	    if match_ID(pid,524) or JXPD(pid,189,1) or match_ID(pid,456) then
		    jtl = 0
	    end
        
        --人厨子攻击不消耗体力
        --NPC只消耗1点
        if match_ID(pid, 89) == false or match_ID(pid, 9828) == false then
            if WAR.Person[WAR.CurID]["我方"] then
                AddPersonAttrib(pid, "体力", -math.ceil(jtl));
            else
                AddPersonAttrib(pid, "体力", -1);
            end
        end
    end

  -------------状态清除-----------------
	--天外连击判定取消
	WAR.TWLJ = 0
	WAR.DJJJ_LJ = 0
	--黯然极意范围恢复
	WAR.ARJY = 0
	WAR.BXZS = 0
	WAR.LMZS = 0
	WAR.WYSJ = 0
	WAR.ARJY1 = 0		--黯然极意	
	--云罗天网恢复
	WAR.YLTW = 0	
	WAR.SSYB = 0		--殊死一搏	
	--九阴极意范围恢复
	WAR.JYSZ = 0
	--九阴极意1范围恢复
	WAR.JYSZ1 = 0
	WAR.XMSZ1 = 0       --玄冥神掌+寒冰真气
	WAR.XMSZ2 = 0       --玄冥神掌+寒冰真气
	WAR.XMSZ3 = 0       --玄冥神掌+寒冰真气
	WAR.XMSZ4 = 0       --玄冥神掌+寒冰真气
	WAR.CYAY = 0
	--门派全场战斗变量----
	WAR.SLSQF = 0--少林寺拳法
	WAR.SLSZF = 0--少林寺指法
	WAR.SLSDF = 0--少林寺刀法
	WAR.SLSQM = 0--少林寺奇门
	if WAR.PD['三入地狱'][pid] ~= nil then
		WAR.PD['三入地狱'][pid] = nil
	end	
	if WAR.PD['时序闪避'][pid] ~= nil then
		WAR.PD['时序闪避'][pid] = nil
	end	
	if WAR.PD["刀剑绝技"][pid] == 2 then
		WAR.PD["刀剑绝技"][pid] = nil
	end	
		
	if WAR.DJHB3 == 1 then
		WAR.DJHB2[1] = nil
		WAR.DJHB2[2] = nil
		WAR.DJHB1[1] = nil
		WAR.DJHB1[2] = nil
		WAR.DJHB3 = 0
		WAR.PD['刀剑不转'][pid] = nil
	end		
	WAR.PD["你是风儿我是沙1"][pid] = nil
	WAR.PD["你是风儿我是沙2"][pid] = nil
	WAR.PD["辟邪连击"][pid] = nil	
	
	--易水沧溟
	if wugong == 153 and WAR.PD['霜之哀伤'][pid] ~= nil and WAR.PD['霜之哀伤'][pid] > 10 then
		if math.random(7,15) < WAR.PD['霜之哀伤'][pid] then
			local aa = math.random(25,50)/100
			WAR.PD['霜之哀伤'][pid] = math.modf(WAR.PD['霜之哀伤'][pid]*aa)
		end
	end	
	--狄云赤心连城计数恢复
	WAR.CXLC_Count = 0
	--无量连击恢复
	WAR.WLLJ_Count = 0
	--逍遥御风计数恢复
	WAR.KLYH = 0
	WAR.YFCS = 0
	WAR.MHSN = 0
	WAR.DJD = 0
	WAR.QLJG = 0
	WAR.QMWZ = 0
	WAR.LMBJ = 0        --全真
    WAR.LMBJ1 = 0       --全真
    WAR.LMBJ2 = 0       --全真
    WAR.LMBJ3 = 0       --全真
    WAR.LMBJ4 = 0       --全真
    WAR.LMBJ5 = 0       --全真
    WAR.LMBJ6 = 0       --全真
    WAR.LMBJ7 = 0       --全真
    WAR.LMBJ8 = 0       --全真
    WAR.LMBJ9 = 0       --全真
  ----------连击结束----------------

	--太极拳，借力打力，蓄力清除
	--张三丰在这里清除
	if wugong == 16 and WAR.YJZD[pid] == 1 and tjqfj(pid) then
		if WAR.PD['借力打力'][pid] ~= nil then
			WAR.PD['借力打力'][pid] = nil
			if math.random(10) > 8 then
				if WAR.PD['太极蓄力'][pid] ~= nil then
					WAR.PD['太极蓄力'][pid] = math.modf(WAR.PD['太极蓄力'][pid]*0.7)
				end
				if WAR.BG[pid] ~= nil then	
					WAR.BG[pid] = math.modf(WAR.BG[pid]*0.7)
				end
				if WAR.WJ[pid] ~= nil then
					WAR.WJ[pid] = math.modf(WAR.WJ[pid]*0.7)
				end
			end	
		elseif WAR.BG[pid] ~= nil then
			local a = math.random(5,9)
			local b = a/10
			WAR.BG[pid] = math.modf(WAR.BG[pid] * b)
			if math.random(10) > 8 then
				if WAR.PD['太极蓄力'][pid] ~= nil then
					WAR.PD['太极蓄力'][pid] = math.modf(WAR.PD['太极蓄力'][pid]*0.7)
				end
				if WAR.WJ[pid] ~= nil then
					WAR.WJ[pid] = math.modf(WAR.WJ[pid]*0.7)
				end
			end
		elseif WAR.PD['太极蓄力'][pid] ~= nil then
			if match_ID(pid, 5) then
				WAR.PD["太极蓄力"][pid] = math.modf( WAR.PD["太极蓄力"][pid]*0.8)
			elseif NGQH(pid,171) then
				WAR.PD["太极蓄力"][pid] = math.modf( WAR.PD["太极蓄力"][pid]*0.3)
			else
			    WAR.PD["太极蓄力"][pid] = 0
			end
			if math.random(10) > 8 then
				if WAR.WJ[pid] ~= nil then
					WAR.WJ[pid] = math.modf(WAR.WJ[pid]*0.7)
				end
			end
		end	
	else
		if (wugong == 16 or wugong == 46 ) and  WAR.PD["太极蓄力"][pid] ~= nil and WAR.PD["太极蓄力"][pid] > 0  then
			if match_ID(pid, 5)  then
				WAR.PD["太极蓄力"][pid] = math.modf( WAR.PD["太极蓄力"][pid]*0.5)
			elseif 	MPTX(4,2) and NGQH(pid,171) then
				WAR.PD["太极蓄力"][pid] = math.modf( WAR.PD["太极蓄力"][pid]*0.1)
			else
			    WAR.PD["太极蓄力"][pid] = 0
			end
		end	
		if MPTX(pid,4,2) and (Curr_NG(pid,99) or PersonKF(pid,171)) and WAR.BG[pid] ~= nil then
			local a = math.random(5,9)
			local b = a/10
			WAR.BG[pid] = math.modf(WAR.BG[pid] * b)
		else		
			WAR.BG[pid] = nil
		end
		if MPTX(pid,4,2) and WAR.WJ[pid] ~= nil then 
			if Curr_NG(pid,99) or PersonKF(pid,171)  then
				local a = (math.random(5,9))/10
				WAR.WJ[pid] = math.modf(WAR.WJ[pid] * a)
			else		
				WAR.WJ[pid] = nil
			end
		end	
	end	
	if WAR.YJZD[pid] ~= nil then
		WAR.YJZD[pid] = nil 
	end	
	--如果触发了逆转乾坤的强化反弹效果，在这里恢复
	if WAR.NZQK > 0 then
		WAR.NZQK = 0
	end
	--丐帮战意恢复，避免被其他反击效果用走
	if WAR.GBZY > 0 then
		WAR.GBZY = 0
	end	
	if WAR.GBJY1 > 0 then
		WAR.GBJY1 = 0
	end	
  
  
  WarSetPerson()

	--斗转星移计算	标记修改
	local dz = {}
	local dznum = 0
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["反击武功"] ~= -1 and WAR.Person[i]["反击武功"] ~= 9999 then --如果反击武功不为空值 和？
			dznum = dznum + 1  --斗转 = 斗转 +1 
			dz[dznum] = {i, WAR.Person[i]["反击武功"], x - WAR.Person[WAR.CurID]["坐标X"], y - WAR.Person[WAR.CurID]["坐标Y"]} -- 斗转人数 = 反击武功 x Y坐标范围内
			WAR.Person[i]["反击武功"] = 9999
		end
	end
	for i = 1, dznum do
		local tmp = WAR.CurID
		WAR.CurID = dz[i][1]
		if WAR.Person[WAR.CurID]['死亡'] == false then
			WAR.DZXY = 1
			if WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 1 then
				WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] = 50
			elseif WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 2 then
				WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] = 60
			elseif WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 3 then
				WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] = 70
			elseif WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 4 then     --三才归元反击比例
				WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] = 80
			elseif WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 5 then	--无酒不欢：斗转大招
				WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] = 100
			elseif WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 6 then	--无酒不欢：斗转觉醒大招
				WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] = 150	
			end
			if WAR.AutoFight == 0 and (WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 100 or WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] == 150) and inteam(WAR.Person[WAR.CurID]['人物编号']) then
				War_Fight_Sub(dz[i][1],dz[i][2]+100)
			elseif WAR.AutoFight == 1 or inteam(WAR.Person[WAR.CurID]['人物编号']) == false or WAR.ZDDH == 354 or ((WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] or 0) < 100) then
				War_Fight_Sub(dz[i][1],dz[i][2]+100,dz[i][3],dz[1][4])	
				--War_AutoFight()
			else
				War_Fight_Sub(dz[i][1], dz[i][2] + 100)
			end
			WAR.Person[WAR.CurID]["反击武功"] = -1
			WAR.DZXYLV[WAR.Person[WAR.CurID]["人物编号"]] = nil
			WAR.CurID = tmp
			WAR.DZXY = 0
		end
	end 
    fjtx()

    --追击计算
	local zj = {}
	local zjnum = 0
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["追击武功"] ~= -1 and WAR.Person[i]["追击武功"] ~= 9999 then
			zjnum = zjnum + 1
			zj[zjnum] = {i, WAR.Person[i]["追击武功"], x + WAR.Person[WAR.CurID]["坐标X"], y + WAR.Person[WAR.CurID]["坐标Y"]}
			WAR.Person[i]["追击武功"] = 9999
		end
	end
	for i = 1, zjnum do
		local tmp = WAR.CurID
		WAR.CurID = zj[i][1]
		if WAR.Person[WAR.CurID]['死亡'] == false then
			WAR.YTTL = 1
			if WAR.YTTLLV[WAR.Person[WAR.CurID]["人物编号"]] == 1 then
				WAR.YTTLLV[WAR.Person[WAR.CurID]["人物编号"]] = 90
			elseif WAR.YTTLLV[WAR.Person[WAR.CurID]["人物编号"]] == 2 then
			    WAR.YTTLLV[WAR.Person[WAR.CurID]["人物编号"]] = 110
			elseif WAR.YTTLLV[WAR.Person[WAR.CurID]["人物编号"]] == 3 then
			    WAR.YTTLLV[WAR.Person[WAR.CurID]["人物编号"]] = 130
			end
			if WAR.AutoFight == 1 or inteam(WAR.Person[WAR.CurID]['人物编号']) == false or WAR.ZDDH == 354 then
				Cat('自动攻击',wugongnum)
			else
				War_Fight_Sub(zj[i][1], zj[i][2] + 100)
			end
			WAR.Person[WAR.CurID]["追击武功"] = -1
			WAR.YTTLLV[WAR.Person[WAR.CurID]["人物编号"]] = nil
			WAR.CurID = tmp	
			WAR.YTTL = 0
		end
	end
	
	
	--反击判定
	for i = 0, WAR.PersonNum - 1 do
		local tmppid = WAR.Person[i]["人物编号"]		
		if WAR.DZXY ~= 1 and WAR.Person[WAR.CurID]['我方'] == false then	
		    --独孤九剑反击
		    if WAR.HFXZ[tmppid] ~= nil then 
			    if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 299);
					WAR.Person[i]["内力点数"] = (WAR.Person[i]["内力点数"] or 0) + AddPersonAttrib(tmppid, "内力", 999);
					WAR.Person[i]["体力点数"] = (WAR.Person[i]["体力点数"] or 0) + AddPersonAttrib(tmppid, "体力", 9);
					WAR.Person[i]["内伤点数"] = (WAR.Person[i]["内伤点数"] or 0) + AddPersonAttrib(tmppid, "受伤程度", -20);	
					WAR.Person[i]["中毒点数"] = (WAR.Person[i]["中毒点数"] or 0) + AddPersonAttrib(tmppid, "中毒程度", -20);	
				    DIYdisplay("九剑奥义・后发先至")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.HFXZ[tmppid][2], WAR.HFXZ[tmppid][3], 4, 33)
				    WAR.HFXZ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.HFXZ[tmppid] = nil
				end	
			end
            --古墓反击
		    if WAR.YFZ[tmppid] ~= nil then 
			    if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i	
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 200);
				    AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("古墓暗器・玉蜂针")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.YFZ[tmppid][2], WAR.YFZ[tmppid][3], 4, 33)
				    WAR.YFZ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.YFZ[tmppid] = nil
				end	
			end
			--车神
			if WAR.CSFJ[tmppid] ~= nil then 
			    if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i	
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 200);
				    AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("来自车神的反击")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.CSFJ[tmppid][2], WAR.CSFJ[tmppid][3], 4, 33)
				    WAR.CSFJ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.CSFJ[tmppid] = nil
				end	
			end
            --唐门反击
		    if WAR.TMFJ[tmppid] ~= nil then 
			    if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i	
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 300);
				    AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("唐门秘技・器绝十方")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.TMFJ[tmppid][2], WAR.TMFJ[tmppid][3], 4, 33)
				    WAR.TMFJ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.TMFJ[tmppid] = nil
				end	
			end
			--真龙反击
			if WAR.CLFJ[tmppid] ~= nil and JY.ZLXF == 1 then
				if JY.Person[tmppid]["生命"] > 0 then
					local tmp = WAR.CurID
					lib.Delay(50)
					WAR.CurID = i
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 150);
					WAR.Person[i]["内力点数"] = (WAR.Person[i]["内力点数"] or 0) + AddPersonAttrib(tmppid, "内力", 800);
					WAR.Person[i]["体力点数"] = (WAR.Person[i]["体力点数"] or 0) + AddPersonAttrib(tmppid, "体力", 7);
					WAR.Person[i]["内伤点数"] = (WAR.Person[i]["内伤点数"] or 0) + AddPersonAttrib(tmppid, "受伤程度", -30)
					WAR.Person[i]["中毒点数"] = (WAR.Person[i]["中毒点数"] or 0) + AddPersonAttrib(tmppid, "中毒程度", -30)
					if WAR.LQZ[tmppid] ~= nil and WAR.LQZ[tmppid] < 100 then
						WAR.LQZ[tmppid] = 100
					end
					DIYdisplay("真龙・逆鳞")
					lib.Delay(100)
					War_ExecuteMenu_Sub(WAR.CLFJ[tmppid][2], WAR.CLFJ[tmppid][3], 4, 32)
					WAR.CLFJ[tmppid] = nil
					WAR.CurID = tmp
				else
					WAR.CLFJ[tmppid] = nil
				end
			end
			--龟甲反击
			if WAR.LMWZ[tmppid] ~= nil then
				if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 150);
					WAR.Person[i]["内力点数"] = (WAR.Person[i]["内力点数"] or 0) + AddPersonAttrib(tmppid, "内力", 300);
				    AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					lib.Delay(50)
				    War_ExecuteMenu_Sub(WAR.LMWZ[tmppid][2], WAR.LMWZ[tmppid][3], 4, 33)
				    WAR.LMWZ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.LMWZ[tmppid] = nil
				end	
			end
			--葵花反击
			if WAR.KHFJ[tmppid] ~= nil then 
			    if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 500);
					WAR.Person[i]["内力点数"] = (WAR.Person[i]["内力点数"] or 0) + AddPersonAttrib(tmppid, "内力", 500);
				    AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("葵花神针・防不胜防")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.KHFJ[tmppid][2], WAR.KHFJ[tmppid][3], 4, 33)
				    WAR.KHFJ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.KHFJ[tmppid] = nil
				end	
			end
			--护龙山庄反击
			if WAR.HLFJ[tmppid] ~= nil then 
			    if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 150);
					WAR.Person[i]["内力点数"] = (WAR.Person[i]["内力点数"] or 0) + AddPersonAttrib(tmppid, "内力", 300);
				    AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("护龙秘技・满天花雨")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.HLFJ[tmppid][2], WAR.HLFJ[tmppid][3], 4, 33)
				    WAR.HLFJ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.HLFJ[tmppid] = nil
				end	
			end
			if WAR.PD['夜雨反击'][tmppid] ~= nil then
				 if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i
				    --AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("绵绵密雨・惘惘幽魂")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.PD['夜雨反击'][tmppid][2], WAR.PD['夜雨反击'][tmppid][3], 4, 33)
				    WAR.PD['夜雨反击'][tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.PD['夜雨反击'][tmppid] = nil
				end
			end	
			--兽王庄反击
			if WAR.SWFJ[tmppid] ~= nil then
				if JY.Person[tmppid]["生命"] > 0 then
					local tmp = WAR.CurID
					lib.Delay(50)
					WAR.CurID = i
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 300);
					WAR.Person[i]["体力点数"] = (WAR.Person[i]["体力点数"] or 0) + AddPersonAttrib(tmppid, "体力", 2);
					AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("颠扑不破")
					lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.SWFJ[tmppid][2], WAR.SWFJ[tmppid][3], 4, 33)
				    WAR.SWFJ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.SWFJ[tmppid] = nil
				end	
			end
			--五毒教反击
			if WAR.WDFJ[tmppid] ~= nil then 
			    if JY.Person[tmppid]["生命"] > 0 then
				    local tmp = WAR.CurID
				    lib.Delay(50)
				    WAR.CurID = i	
					WAR.Person[i]["生命点数"] = (WAR.Person[i]["生命点数"] or 0) + AddPersonAttrib(tmppid, "生命", 300);
					WAR.Person[i]["内力点数"] = (WAR.Person[i]["内力点数"] or 0) + AddPersonAttrib(tmppid, "内力", 500);
					WAR.Person[i]["体力点数"] = (WAR.Person[i]["体力点数"] or 0) + AddPersonAttrib(tmppid, "体力", 5);	
				    AddPersonAttrib(pid,"暗器技巧",math.random(10,25))
					DIYdisplay("五毒暗器・含沙射影")
				    lib.Delay(150)
				    War_ExecuteMenu_Sub(WAR.WDFJ[tmppid][2], WAR.WDFJ[tmppid][3], 4, 33)
				    WAR.WDFJ[tmppid] = nil
				    WAR.CurID = tmp
			    else
				    WAR.WDFJ[tmppid] = nil
				end	
			end
			---并非反击特效，只是写在这里减少系统跑循环的负担， 竹大帮改
			if match_ID(tmppid,527) and JY.Person[tmppid]['生命'] <= 0 and MPTX(tmppid,24) and (WAR.PD['路人无明'][tmppid] == nil or (WAR.PD['路人无明'][tmppid] ~= nil and JLSD(0,25,tmppid))) then
				WAR.PD['路人无明'][tmppid] = 1
				local tmp = WAR.CurID
				lib.Delay(50)
				WAR.CurID = i
				JY.Person[tmppid]['生命'] = 1
				WAR.PD['无明夜'][tmppid] = 50	
				DIYdisplay("绝技・逍遥无明夜")
				lib.Delay(150)
				WAR.CurID = tmp
			end
		end 
	end
	--刀剑合璧	
	if WAR.DJHB2[1] ~= nil then 	
		WAR.DJHB3 = 1
		local n= 0
		for j = 0 ,WAR.PersonNum-1 do
			if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
				n = n + 1
			end
		end
		if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
			for i = 1, CC.Kungfunum do
				if JY.Person[pid]["武功" .. i] == 44 then
					if WAR.PD["刀剑绝技"][pid] == 1 then
						WAR.PD['刀剑绝技'][pid] = 2
					end	
					WAR.PD['刀剑不转'][pid] = 1
					DIYdisplay("刀剑合璧・苗家天剑")
					if WAR.AutoFight == 1 or inteam(WAR.Person[WAR.CurID]['人物编号']) == false then
						--WAR.Person[WAR.CurID]['移动步数'] = 0
						Cat('自动攻击',i)
						--War_Fight_Sub(WAR.CurID, i, WAR.DJHB2[1], WAR.DJHB2[2])
						
					else
						War_Fight_Sub(WAR.CurID, i)
					end	
					break
				end					
			end
		end
		
	end	
	--WAR.DJHB2 = nil
	if WAR.DJHB1[1] ~= nil then 		
		WAR.DJHB3 = 1
		local n= 0
		for j = 0 ,WAR.PersonNum-1 do
			if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
				n = n + 1
			end
		end
		if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
			for i = 1, CC.Kungfunum do
				if JY.Person[pid]["武功" .. i] == 67 then
					if WAR.PD["刀剑绝技"][pid] == 1 then
						WAR.PD['刀剑绝技'][pid] = 2
					end
					WAR.PD['刀剑不转'][pid] = 1
					DIYdisplay("刀剑合璧・胡家绝刀")
					if WAR.AutoFight == 1 or not WAR.Person[WAR.CurID]["我方"] then
						--War_Fight_Sub(WAR.CurID, i, WAR.DJHB1[1], WAR.DJHB1[2])
						--WAR.Person[WAR.CurID]['移动步数'] = 0
						Cat('自动攻击',i)
					else
						War_Fight_Sub(WAR.CurID, i)
					end	
					break
				end					
			end
		end	
		
	end	
	if JY.Restart == 1 then
		return 1
	end
	WAR.PD['无量禅震'][pid] = {}
    --双重攻击
    if WAR.PD['降龙・双龙取水'][pid] ~= nil and WAR.PD['降龙・双龙取水'][pid] == 1 and JY.Person[pid]['生命'] > 0 then
		WAR.PD['降龙・双龙取水'][pid] = 2
        WAR.Person[WAR.CurID]['移动步数'] = 0
        DIYdisplay("秘技・再动")
        if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]['我方'] == false or WAR.ZDDH == 354 then
            Cat('自动攻击',wugongnum)
        else
            War_Fight_Sub(WAR.CurID, wugongnum)
        end
		if match_ID(pid,517) and JLSD(0,80,pid) then
			WAR.PD['降龙・双龙取水'][pid] = nil
		end
    end
	if WAR.PD['长生蓄力'][pid] ~= nil then
		WAR.PD['长生蓄力'][pid] = nil 
	end
	return 1;
end


--无酒不欢：选择移动
--增加7*7的显示flag
function War_SelectMove(flag)
	local x0 = WAR.Person[WAR.CurID]["坐标X"]
	local y0 = WAR.Person[WAR.CurID]["坐标Y"]
	local x = x0
	local y = y0
	if flag ~= nil then
		CleanWarMap(7, 0)
	end
	while true do
		if JY.Restart == 1 then
			break
		end
		local x2 = x
		local y2 = y
		
		Cat('实时特效动画')
	
		WarDrawMap(1, x, y)
		
		if flag ~= nil then
			for i = 1, 4 do
				for j = 1, 4 do
					SetWarMap(x + i - 1, y + j - 1, 7, 1)
					SetWarMap(x - i + 1, y + j - 1, 7, 1)
					SetWarMap(x + i - 1, y - j + 1, 7, 1)
					SetWarMap(x - i + 1, y - j + 1, 7, 1)
				end
			end
			WarDrawMap(1, x, y)
		end
		
		WarShowHead(GetWarMap(x, y, 2))
		
		--如阴时显示集气条
		if WAR.FLHS5 == 2 then
			DrawTimeBar_sub()
		end
        Cat('实时特效动画2')
		ShowScreen()
		
		if flag ~= nil then
			CleanWarMap(7, 0)
		end
	
		lib.Delay(CC.BattleDelay)
		local key, ktype, mx, my = lib.GetKey()
		if key == VK_UP then
			y2 = y - 1
		elseif key == VK_DOWN then
			y2 = y + 1
		elseif key == VK_LEFT then
			x2 = x - 1
		elseif key == VK_RIGHT then
			x2 = x + 1
		elseif key == VK_SPACE or key == VK_RETURN then
			return x, y
		elseif key == VK_ESCAPE or ktype == 4 then
			return nil
		elseif ktype == 2 or ktype == 3 then
			mx = mx - CC.ScreenW / 2
			my = my - CC.ScreenH / 2
			mx = (mx) / CC.XScale
			my = (my) / CC.YScale
			mx, my = (mx + my) / 2, (my - mx) / 2
			if mx > 0 then
				mx = mx + 0.99
			else
				mx = mx - 0.01
			end
			if my > 0 then
				my = my + 0.99
			else
				mx = mx - 0.01
			end
			mx = math.modf(mx)
			my = math.modf(my)
			for i = 0, 10 do
				if mx + i <= 63 then
					if my + i > 63 then
						break;
					end
				end
				local hb = GetS(JY.SubScene, x0 + mx + i, y0 + my + i, 4)

				if math.abs(hb - CC.YScale * i * 2) < 5 then
					mx = mx + i
					my = my + i
				end
			end
			x2, y2 = mx + x0, my + y0
			  
			if ktype == 3 then
				return x, y
			end
		end
    
		--无酒不欢：避免跳出
		if GetWarMap(x2, y2, 3) ~= nil and GetWarMap(x2, y2, 3) < 128 then
			x = x2
			y = y2
		end
	end
end

--获取武功最小内力
function War_GetMinNeiLi(pid)
	local minv = math.huge
	for i = 1, JY.Base["武功数量"] do
		local tmpid = JY.Person[pid]["武功" .. i]
		if tmpid > 0 and JY.Wugong[tmpid]["消耗内力点数"] < minv then
			minv = JY.Wugong[tmpid]["消耗内力点数"]
		end
	end
	return minv
end

--无酒不欢：手动战斗菜单上级
function War_Manual()
	local r = nil
    local pid = WAR.Person[WAR.CurID]['人物编号']
    if WAR.PD["混乱状态"][pid] ~= nil or WAR.PD["荒天龙灭"][pid] ~= nil then
        Cat('随机移动')
    end
    --随机移动
    local tf57 = hastf(WAR.CurID,57,2)
    if tf57 ~= nil then
        if math.random(100) <= 25 then 
            Cat('随机移动')
        end
    end
	local x, y, move, pic, face_dir = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], WAR.Person[WAR.CurID]["移动步数"], WAR.Person[WAR.CurID]["贴图"], WAR.Person[WAR.CurID]["人方向"]
	while true do
		if JY.Restart == 1 then
			break
		end
		WAR.ShowHead = 1
		if MPTX(pid,9) and WAR.TMMS[pid] == 2 then 
	        local a = 0
			for tl = 0, WAR.PersonNum-1 do
				if WAR.Person[tl]["死亡"] == false and WAR.Person[tl]["人物编号"] == 740 then
					a = 1
				end
			end	
			if WAR.ACSJ[100 + pid] == nil or WAR.ACSJ[200 + pid] == nil or WAR.ACSJ[300 + pid] == nil then 
				acsj()
			end
			if WAR.TMMS[400 + pid] == nil and a == 0 and WAR.PD["分身判定"][pid] == nil then
				qjb()  
			end
	    end
		--r = War_Manual_Sub()
		r = Cat('战斗菜单')
		--移动，这里实际返回的应该是-1
		if r == 1 or r == -1 then
			--WAR.Person[WAR.CurID]["移动步数"] = 0 
		--ESC返回
		elseif r == 0 then
			--夜雨楼如影随形特效
			--[[if WAR.PD['影随'][pid] ~= nil then 
				WAR.PD['遮影'][pid] = WAR.PD['影随'][pid]
				WAR.PD['影随'][pid] = nil
			end]]
			--夜雨楼如影随形特效
			if WAR.PD['遮影'][pid] == nil then 
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
				WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], WAR.Person[WAR.CurID]["移动步数"] = x, y, move
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, pic)
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
				--无酒不欢：人物面相也要还原
				WAR.Person[WAR.CurID]["人方向"] = face_dir
			else
				if WAR.Person[WAR.CurID]["坐标X"] ~= x or WAR.Person[WAR.CurID]["坐标Y"] ~= y then
					SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
					SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
					SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
					WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], WAR.Person[WAR.CurID]["移动步数"] = x, y, move
					WAR.Person[WAR.CurID]["人方向"] = face_dir
					if WAR.Stop[x] == nil then
						WAR.Stop[x] = {}
					end
					WAR.Stop[x][y] = 1
				end
			end
		elseif r == 20 then
	
		else
			break;
		end
	end
	WAR.ShowHead = 0
	WarDrawMap(0)
	return r	--无酒不欢：这里的返回值似乎没什么庞
end

function WarTitleSelection()
	local choice = 1
	local buttons ={
	{967,971,100,0,200,0},
	{968,972,100,40,220,40},
	{969,973,100,80,200,80},
	{970,974,100,120,200,120},
	{970,974,100,160,200,160},
	{970,974,100,200,200,200},
	{970,974,100,240,200,240},
	{970,974,100,280,200,280},	
	}
	local function on_button(mx, my)
		local r = 0
			for i = 1, #buttons do
				if mx >= buttons[i][4] and mx <= buttons[i][6] and my >= buttons[i][5] and my <= buttons[i][7] then
					r = i
					break
				end
			end
		return r
	end
	while true do
		if JY.Restart == 1 then
			return
		end
		local keypress, ktype, mx, my = lib.GetKey()
		if keypress == VK_DOWN or keypress == VK_RIGHT then
			choice = choice + 1
			if choice > #buttons then
				choice = 1
			end
		elseif keypress == VK_UP or keypress == VK_LEFT then
			choice = choice - 1
			if choice < 1 then
				choice = #buttons
			end
		else
			if (ktype == 2 or ktype == 3 or ktype == 4 or ktype == 5 or ktype == 6 or ktype == 7 or ktype == 7) then
				local r = on_button(mx, my)
				if r > 0 then
					choice = r
				end
			end
			if keypress == VK_RETURN or (ktype == 9 and on_button(mx, my)>0) then
				break
			end
		end
		Cls()
		for i = 1, #buttons do
			local picid = buttons[i][1]
			if i == choice then
				picid = buttons[i][2]
			end
			lib.LoadPNG(1, picid * 2 , buttons[i][3], buttons[i][4], 1)
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
	end
	return choice
end

	      
--手动战斗菜单
--[[function War_Manual_Sub()
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	--local isEsc = 0
	
	local warmenu = {
	{"移动", War_MoveMenu, 1},	--1
	{"攻击", War_FightMenu, 1},	--2
	{"运功", War_YunGongMenu, 1},	--3
	{"战术", War_TacticsMenu, 1},	--4
     {"其它", War_OtherMenu, 1},	--13  --5		

	{"特色", War_TgrtsMenu, 1},	--11 --6
	{"撤退", War_Retreat, 1},	--12  --7
	{"自动", War_AutoMenu, 1},	--13  --8
	{"门派", War_MPMenu, WAR.OWN}	    --14
	}
  	
   local warmenu = WarTitleSelection()
	if warmenu == 1 then
	War_MoveMenu()
	end
	if warmenu == 2 then
	War_FightMenu()
	end
	if warmenu == 3 then
	War_YunGongMenu()
	end
	if warmenu == 4 then
	War_TacticsMenu()
	end
	if warmenu == 5 then
	War_OtherMenu()
	end	
	if warmenu == 6 then
	War_TgrtsMenu()
	end	
	if warmenu == 7 then
	War_Retreat()
	end	
	if warmenu == 8 then
	War_AutoMenu()
	end		
	if MPPD(pid) == 0 then
		warmenu[9][3] = 0
	else
		local mptype = MPPD(pid)
		local mpdj = MPDJ(pid)
		if mptype == 7 then
			if JY.Base["天书数量"] < 4 or hasthing(252) == false or JY.Person[pid]["体力"] <= 20 then
				warmenu[9][3] = 0
			end	
		elseif mptype == 1 then
			if mpdj < 3 or JY.Person[pid]["体力"] <= 20 then
				warmenu[9][3] = 0
			end	
		else
			if mpdj < 2 or JY.Person[pid]["体力"] <= 20 then
				warmenu[9][3] = 0
			end	
		end
		if mptype == 7 then
			if JY.Base["天书数量"] < 7 or hasthing(66) == false then
				warmenu[9][3] = 0
			end
		end
	end	
	
	]]
	--特色指令
	
	--if JY.Person[pid]["特色指令"] == 1 then
		--如果是畅想
		--if pid == 0 then
		--	warmenu[6][1] = GRTS[JY.Base["畅想"]]
		--else
		--	warmenu[6][1] = GRTS[pid]
		--end
	--else
		--warmenu[6][3] = 0
	--end
	
--[[	
	--虚竹
	if match_ID(pid, 49) then
		--如果没有中生死符的人物则不显示特色指令
		local t = 0
		for i = 0, WAR.PersonNum - 1 do
			local wid = WAR.Person[i]["人物编号"]
			if WAR.PD["生死符"][wid] == 1 and WAR.Person[i]["死亡"] == false then
				t = 1
			end
		end
		if t == 0 then
			warmenu[6][3] = 0
		end
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 then
			warmenu[6][3] = 0
		end
	end
	
	
	
	
	--祖千秋
	if match_ID(pid, 88) then
		--如果周围没有队友不显示特色指令
		local yes = 0
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 5) and i ~= WAR.CurID then
				yes = 1
			end
		end
		if yes == 0 then
			warmenu[6][3] = 0
		end
		--体力小于20不显示特色指令
		--内力小于1000不显示
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end
	
	--不戒和尚
	if match_ID(pid, 593) then
		--如果周围没有队友不显示特色指令
		local yes = 0
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 5) and i ~= WAR.CurID then
				yes = 1
			end
		end
		if yes == 0 then
			warmenu[6][3] = 0
		end
		--体力小于20不显示特色指令
		--内力小于1000不显示
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end

	--人厨子
	if match_ID(pid, 89) then
		--如果周围没有队友不显示特色指令
		local px, py = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
		local mxy = {
					{WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] + 1}, 
					{WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] - 1}, 
					{WAR.Person[WAR.CurID]["坐标X"] + 1, WAR.Person[WAR.CurID]["坐标Y"]}, 
					{WAR.Person[WAR.CurID]["坐标X"] - 1, WAR.Person[WAR.CurID]["坐标Y"]}}

		local yes = 0
		for i = 1, 4 do
			if GetWarMap(mxy[i][1], mxy[i][2], 2) >= 0 then
			local mid = GetWarMap(mxy[i][1], mxy[i][2], 2)
			if inteam(WAR.Person[mid]["人物编号"]) then
				yes = 1
				end
			end  
		end
		if yes == 0 then
			warmenu[6][3] = 0
		end
		--体力小于25不显示特色指令
		if JY.Person[pid]["体力"] < 25 then
			warmenu[6][3] = 0
		end
	end

	--张无忌
	if match_ID(pid, 9) then
		--如果周围没有队友不显示特色指令
		local yes = 0
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 8) and i ~= WAR.CurID then
				yes = 1
			end
		end
		if yes == 0 then
			warmenu[6][3] = 0
		end
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 then
			warmenu[6][3] = 0
		end
	end
 
	--霍青桐指挥指令
	if match_ID(pid, 74) then
		--体力小于10不显示特色指令
		if JY.Person[pid]["体力"] < 10 or JY.Person[pid]["内力"] < 150 or  WAR.HQT_CD > 0 then
			warmenu[6][3] = 0
		end
	end
	
	--慕容复指令 幻梦
	if match_ID(pid, 51) then
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 then
			warmenu[6][3] = 0
		end
	end
	
	--小昭指令 影步
	if match_ID(pid, 66) then
		--体力小于30，或内力小于2000不显示特色指令
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 2000 then
			warmenu[6][3] = 0
		end
	end
  
	--钟灵指令 灵貂
	if match_ID(pid, 90) then
		--体力小于10不显示特色指令
		if JY.Person[pid]["体力"] < 10 then
			warmenu[6][3] = 0
		end
	end
	
	--喵姐指令 变装
	if match_ID(pid, 92) then
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 then
			warmenu[6][3] = 0
		end
	end
	--丘机处 止杀
	if match_ID(pid, 68) then
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 or WAR.JSZT1[pid]> 0 then
			warmenu[6][3] = 0
		end
	end	
	--胡斐指令 飞狐
	if match_ID(pid, 1) then
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 then
			warmenu[6][3] = 0
		end
	end
	
	--鸠摩智指令 幻化
	if match_ID(pid, 103) then
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end
	
	--达尔巴指令 死战
	if match_ID(pid, 160) then
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 or WAR.SZSD ~= -1 then
			warmenu[6][3] = 0
		end
	end
	
	--金轮 龙象
	if match_ID(pid, 62) then
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end
	
	--黄蓉 遁甲
	if match_ID(pid, 56) then
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end
	
	--韦小宝 口才
	if match_ID(pid, 601) then
		if JY.Person[pid]["体力"] < 30 then
			warmenu[6][3] = 0
		end
	end
	
	--苗人凤 破军
	if match_ID(pid, 3) then
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end
	
	--何太冲 铁琴
	if match_ID(pid, 7) then
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end
	

	--李寻欢 飞刀
	if match_ID(pid, 498) then
		if  JY.Person[pid]["内力"] < 1000 then
			warmenu[6][3] = 0
		end
	end	
	--萧秋水 天剑
	if match_ID(pid, 652) and JY.Base["天书数量"] < 7 then
			warmenu[6][3] = 0
		end
	
	--阎基 虚弱
	if match_ID(pid, 4) then	
		if JY.Person[pid]["体力"] < 20 then
			warmenu[6][3] = 0
		end
	end
	
	--杨冰羽 招生
	if match_ID(pid, 514) then	
		if JY.Person[pid]["体力"] < 20 then
			warmenu[6][3] = 0
		end
	end
	
	
	--太极
	if WAR.TJZS[2000 + pid] ~= nil then
		warmenu[1][3] = 0
	end


	--出左右时，移动，解毒，医疗，物品，特色，自动不可见
	if WAR.ZYHB == 2 then
		warmenu[1][3] = 0
		warmenu[5][3] = 0	
		warmenu[8][3] = 0
	end
  
	--体力小于5或者已经移动过时，移动不可见
	if JY.Person[pid]["体力"] <= 5 or WAR.Person[WAR.CurID]["移动步数"] <= 0 then
		warmenu[1][3] = 0
		--isEsc = 1
	end
  
	--判断最小内力，是否可显示攻击
	local minv = War_GetMinNeiLi(pid)
	if JY.Person[pid]["内力"] < minv or JY.Person[pid]["体力"] < 10 then
		warmenu[2][3] = 0
	end

	lib.GetKey()
	Cls()
	DrawTimeBar_sub()
	
	--连锁
    local chain  
	if WAR.Person[WAR.CurID]["我方"] then
		chain = WAR.MYCHAIN
	else
		chain = WAR.URCHAIN
	end	
	
	return Cat('菜单',warmenu, #warmenu, 0, CC.MainMenuX, CC.MainMenuY, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
	
end
]]
--无酒不欢：运功选择菜单
function War_YunGongMenu()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local id = WAR.Person[WAR.CurID]["人物编号"]
	local menu={};
	menu[1]={"运行内功",SelectNeiGongMenu,1};
	--menu[2]={"停运内功",nil,1};
	menu[2]={"运行轻功",SelectQingGongMenu,1};
	--menu[4]={"停运轻功",nil,1};
	local r =  Cat('菜单',menu,#menu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
   -- local r = Cat('菜单',menu,#menu,0,CC.MainMenuX, CC.MainMenuY,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);	
	if r == 0 then 
		return 0
	end	
	local r1 = menu[r][2]()
	if r1 == 2 then
		JY.Person[id]["主运内功"] = 0
		DrawStrBoxWaitKey(JY.Person[id]["姓名"].."停止了运行主内功",C_RED,CC.DefaultFont,nil,LimeGreen)
		return 20;
	elseif r1 == 20 then
		return 20;
	elseif r1 == 4 then
		JY.Person[id]["主运轻功"] = 0
		DrawStrBoxWaitKey(JY.Person[id]["姓名"].."停止了运行主轻功",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
		return 20;
	elseif r1 == 10 then
		return 10;
	end
end

--无酒不欢：选择内功菜单
function SelectNeiGongMenu()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local id, x1, y1 = WAR.Person[WAR.CurID]["人物编号"], WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
	local menu={};
	local a = 0
	for i=1,JY.Base["武功数量"] do
        menu[i]={JY.Wugong[JY.Person[id]["武功" .. i]]["名称"],nil,0};
		if JY.Wugong[JY.Person[id]["武功" .. i]]["武功类型"] == 6 then
			menu[i][3]=1;
		end
		--五岳剑诀不能运
		--if JY.Person[id]["武功" .. i] == 175 then
		--	menu[i][3]=0
		--end
		if menu[i][3] == 1 then 
			a = 1
		end
	end
	if a == 0 then 
		return 0
	end
	local main_neigong =  Cat('菜单',menu,#menu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
   -- local main_neigong =  Cat('菜单',menu,#menu,0,CC.MainMenuX, CC.MainMenuY,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
	if main_neigong ~= nil and main_neigong > 0 then
		CleanWarMap(4, 0)
		SetWarMap(x1, y1, 4, 1)
		War_ShowFight(id, 0, 0, 0, 0, 0, 9)	
		JY.Person[id]["主运内功"] = JY.Person[id]["武功" .. main_neigong]
		if JY.Person[id]["主运内功"] == JY.Person[id]["门派技能1"] then
			JY.Person[id]["门派技能1"] = 1
		end		
		Hp_Max(id)
		if JY.Person[id]["门派技能1"] > 0 then
			for i=1,JY.Base["武功数量"] do
				menu[i]={JY.Wugong[JY.Person[id]["武功" .. i]]["名称"],nil,0};
				if JY.Wugong[JY.Person[id]["武功" .. i]]["武功类型"] == 6 then
					menu[i][3]=1;
				end
				--主运的不能副运
				if JY.Person[id]["武功" .. i] == JY.Person[id]["主运内功"] then
					menu[i][3]=0
				end
				if menu[i][3] == 1 then 
					a = 1
				end
			end
			if a == 0 then 
				return 0
			end
			local main_neigong =  Cat('菜单',menu,#menu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
		   -- local main_neigong =  Cat('菜单',menu,#menu,0,CC.MainMenuX, CC.MainMenuY,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
			if main_neigong ~= nil and main_neigong > 0  then
				CleanWarMap(4, 0)
				SetWarMap(x1, y1, 4, 1)
				War_ShowFight(id, 0, 0, 0, 0, 0, 9)	
				JY.Person[id]["门派技能1"] = JY.Person[id]["武功" .. main_neigong]
				if JY.Person[id]["主运内功"] ~= 104 and JY.Person[id]["门派技能1"] ~=104 and  WAR.L_NYZH[id] ~= nil and WAR.L_NYZH[id] == 2 then
					WAR.L_NYZH[id] = 0
					DrawStrBoxWaitKey(JY.Person[id]["姓名"].."退出逆运暴走状态",C_RED,CC.DefaultFont,nil,LimeGreen)
				elseif (JY.Person[id]["主运内功"] == 104 or JY.Person[id]["门派技能1"] ==104) and NGQH(id,104) then
					WAR.L_NYZH[id] = 2
					DrawStrBoxWaitKey(JY.Person[id]["姓名"].."开启逆运暴走状态",C_RED,CC.DefaultFont,nil,LimeGreen)
				end
			end
		end	
		if Curr_NG(id,104) == false and WAR.L_NYZH[id] ~= nil and WAR.L_NYZH[id] == 2 then
			WAR.L_NYZH[id] = nil
			DrawStrBoxWaitKey(JY.Person[id]["姓名"].."退出逆运暴走状态",C_RED,CC.DefaultFont,nil,LimeGreen)
		elseif Curr_NG(id,104) and NGQH(id,104) and WAR.L_NYZH[id] == nil then
			WAR.L_NYZH[id] = 2
			DrawStrBoxWaitKey(JY.Person[id]["姓名"].."开启逆运暴走状态",C_RED,CC.DefaultFont,nil,LimeGreen)
		end	
		if (Curr_NG(id,190) or (Curr_NG(id,88)and MPTX(id,12))) and PersonKF(id,88) then
			if WAR.PD['三垣'][id] == nil or WAR.PD['三垣'][id] < 0 then
				WAR.PD['三垣'][id] = 0
				DrawStrBoxWaitKey(JY.Person[id]["姓名"].."开启周天星辰阵",C_RED,CC.DefaultFont,nil,LimeGreen)
			end
		end
		return 20;
	end
end

--无酒不欢：选择轻功菜单
function SelectQingGongMenu()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local id, x1, y1 = WAR.Person[WAR.CurID]["人物编号"], WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
	local menu={};
	local a = 0
	for i=1,JY.Base["武功数量"] do
        menu[i]={JY.Wugong[JY.Person[id]["武功" .. i]]["名称"],nil,0};
		if JY.Wugong[JY.Person[id]["武功" .. i]]["武功类型"] == 7 then
			menu[i][3]=1;
		end
		if menu[i][3] == 1 then 
			a = 1
		end
	end
	if a == 0 then 
		return 0
	end
	local main_qinggong =  Cat('菜单',menu,#menu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
   -- local main_qinggong =  Cat('菜单',menu,#menu,0,CC.MainMenuX, CC.MainMenuY,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
	if main_qinggong ~= nil and main_qinggong > 0 then
		CleanWarMap(4, 0)
		SetWarMap(x1, y1, 4, 1)
		War_ShowFight(id, 0, 0, 0, 0, 0, 9)	
		JY.Person[id]["主运轻功"] = JY.Person[id]["武功" .. main_qinggong]
		return 10;
	end
end

--无酒不欢：战术菜单
function War_TacticsMenu()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local menu={};
	menu[1]={"蓄力Ｐ",nil,1};
	menu[2]={"防御Ｄ",nil,1};
	menu[3]={"等待Ｗ",nil,1};
	menu[4]={"集中Ｊ",nil,1};
	menu[5]={"休息Ｒ",nil,1};	
	local r =  Cat('菜单',menu,10,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1,LimeGreen)
   -- local r = Cat('菜单',menu,#menu,0,CC.MainMenuX, CC.MainMenuY,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
	if r >= 1 and r <= 5 then 
		local id  = WAR.Person[WAR.CurID]['人物编号']
		if match_ID(id,517) or match_ID(id,526) or JXPD(id,525,1) then
			else
			Cat('遮影DH2',WAR.CurID)
		end		
	end
	--蓄力
	if r == 1 then
		return War_ActupMenu()
	--防御
	elseif r == 2 then
		return War_DefupMenu()
	--等待
	elseif r == 3 then
		return War_Wait()
	--集中
	elseif r == 4 then
		return War_Focus()
	--休息
	elseif r == 5 then
		return War_RestMenu()
	--快捷键的额外判定	
	elseif r == 6 then
		return 1
	--快捷键的额外判定
	elseif r == 7 then
		return 20
	end
end

--无酒不欢：其它菜单
function War_OtherMenu()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local menu={};
	menu[1]={"用毒Ｖ",nil,1};
	menu[2]={"解毒Ｑ",nil,1};
	menu[3]={"医疗Ｆ",nil,1};
	--menu[4]={"物品",nil,1};
	menu[4]={"状态Ｚ",nil,1};	
	local r =  Cat('菜单',menu,#menu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1,LimeGreen)
   -- local r = Cat('菜单',menu,#menu,0,CC.MainMenuX, CC.MainMenuY,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
	
	--用毒
	if r == 1 then
		return War_PoisonMenu()
	--解毒
	elseif r == 2 then
		return War_DecPoisonMenu()
	--医疗
	elseif r == 3 then
		return War_DoctorMenu()
	--物品
	--elseif r == 4 then
		--return  War_ThingMenu()
	--状态
	elseif r == 4 then
		return  Ckstatus()		
	--快捷键的额外判定
	elseif r == 6 then
		return 1
	--快捷键的额外判定
	elseif r == 7 then
		return 20
	end
end

--修炼武功
function War_PersonTrainBook(pid,thingid)
  	local p = JY.Person[pid]
 	if thingid == nil then
		thingid = p["修炼物品"]
	end	
 	if thingid < 0 then
    	return 
 	end
 	-- JY.Thing[101]["加御剑能力"] = 1
  	-- JY.Thing[123]["加拳掌功夫"] = 1
	local wugongid = JY.Thing[thingid]["练出武功"]
	local wg = 0
	if JY.Person[pid]["武功" .. JY.Base["武功数量"]] > 0 and wugongid >= 0 then
  	for i = 1, JY.Base["武功数量"] do
    		if JY.Thing[thingid]["练出武功"] == JY.Person[pid]["武功" .. i] then
      		wg = 1         
    		end
  	end
		if wg == 0 then		--修复第一版本，不可修炼武功的BUG
			return 
		end
	end
  
  
	local yes1, yes2, kfnum = false, false, nil
	while true do 
		local needpoint = TrainNeedExp(pid)
		if thingid == 118 and MuRongDZ(pid) then
			do return end
		elseif thingid == 547 and JY.Person[pid]['门派技能4'] >= 1 then
			do return end
		elseif thingid == 294 and JY.Person[pid]['门派技能5'] >= 1	then
			do return end
		else	
			if needpoint <= p["修炼点数"] then
				yes1 = true
				AddPersonAttrib(pid, "生命最大值", JY.Thing[thingid]["加生命最大值"])
				--九阴九阳也可以改变内力性质
				if p["内力性质"] ~= 3 and not match_ID(pid,9987) then
					if JY.Thing[thingid]["改变内力性质"] == 2 then 
						p["内力性质"] = 2
					elseif JY.Thing[thingid]["改变内力性质"] == 3 then
						p["内力性质"] = 0
					elseif JY.Thing[thingid]["改变内力性质"] == 4 then
						p["内力性质"] = 1
					end
				end	
				
				--九阴九阳
				JY.Thing[83]["改变内力性质"] = 4 
				JY.Thing[83]["需内力性质"] = 2   
				JY.Thing[84]["改变内力性质"] = 3
				JY.Thing[84]["需内力性质"] = 2  
				
				
				
				if match_ID(pid, 588)  or match_ID(pid, 9862) or match_ID(pid, 9928) or (MPTX(pid,10)) then		--冯衡 双倍属性值
					AddPersonAttrib(pid, "内力最大值", JY.Thing[thingid]["加内力最大值"])
					AddPersonAttrib(pid, "攻击力", JY.Thing[thingid]["加攻击力"] * 4)
					AddPersonAttrib(pid, "轻功", JY.Thing[thingid]["加轻功"] * 4)
					AddPersonAttrib(pid, "防御力", JY.Thing[thingid]["加防御力"] * 4)
					AddPersonAttrib(pid, "医疗能力", JY.Thing[thingid]["加医疗能力"])
					AddPersonAttrib(pid, "用毒能力", JY.Thing[thingid]["加用毒能力"])
					--AddPersonAttrib(pid, "解毒能力", JY.Thing[thingid]["加解毒能力"])
					AddPersonAttrib(pid, "抗毒能力", JY.Thing[thingid]["加抗毒能力"])
				else 
					AddPersonAttrib(pid, "内力最大值", JY.Thing[thingid]["加内力最大值"])
					AddPersonAttrib(pid, "攻击力", JY.Thing[thingid]["加攻击力"] * 2)
					AddPersonAttrib(pid, "轻功", JY.Thing[thingid]["加轻功"] * 2)
					AddPersonAttrib(pid, "防御力", JY.Thing[thingid]["加防御力"] * 2)
					AddPersonAttrib(pid, "医疗能力", JY.Thing[thingid]["加医疗能力"])
					AddPersonAttrib(pid, "用毒能力", JY.Thing[thingid]["加用毒能力"])
				--	AddPersonAttrib(pid, "解毒能力", JY.Thing[thingid]["加解毒能力"])
					AddPersonAttrib(pid, "抗毒能力", JY.Thing[thingid]["加抗毒能力"])
				end
				
				local mp = 1
				local tf = 1
				if match_ID(pid, 56) or match_ID(pid, 77)  or match_ID(pid, 9862) or match_ID(pid, 9863) or match_ID(pid, 9928) then
					tf = 2
				end
				if JY.Thing[thingid]["加拳掌功夫"] > 0 then	
					--桃花岛拳系增加
					if MPTX(pid,10) then
						mp = MPDJ(pid) + 1
					end
					--峨眉拳系增加
					if MPTX(pid,17) then
						mp = 3
					end
					--崆峒拳系增加
					if MPTX(pid,18) then
						mp = 3
					end	
					--丐帮拳系增加
					if MPTX(pid,2) then
						mp = 2
					end
					--古墓拳系增加
					if MPTX(pid,3) then  
						mp = 1.5
					end	
					--雪羽宗拳系增加
					if MPTX(pid,20) or match_ID(pid,514) then
						AddPersonAttrib(pid, "耍刀技巧", JY.Thing[thingid]["加拳掌功夫"])
					end	
					--天机宫拳系增加
					if MPTX(pid,30) then
						mp = 2
					end
					if mp == 1 and tf == 1 then
						AddPersonAttrib(pid, "拳掌功夫", JY.Thing[thingid]["加拳掌功夫"])
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "拳掌功夫", JY.Thing[thingid]["加拳掌功夫"])
						--end
					else
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "拳掌功夫", JY.Thing[thingid]["加拳掌功夫"])
						--end
						if mp >= tf then
							AddPersonAttrib(pid, "拳掌功夫", JY.Thing[thingid]["加拳掌功夫"]*mp)
						else
							AddPersonAttrib(pid, "拳掌功夫", JY.Thing[thingid]["加拳掌功夫"]*tf)
						end
					end
				end	
				if JY.Thing[thingid]["加指法技巧"] > 0 then
					--桃花岛指系增加
					if MPTX(pid,10) then
						mp = 3
					end
					--大理指系增加
					if MPTX(pid,15) then
						mp = 2.5
					end
					
					if mp == 1 and tf == 1 then
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "指法技巧", JY.Thing[thingid]["加指法技巧"])
						--end
						AddPersonAttrib(pid, "指法技巧", JY.Thing[thingid]["加指法技巧"])
					else
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "指法技巧", JY.Thing[thingid]["加指法技巧"])
						--end
						if mp >= tf then
							AddPersonAttrib(pid, "指法技巧", JY.Thing[thingid]["加指法技巧"]*mp)
						else
							AddPersonAttrib(pid, "指法技巧", JY.Thing[thingid]["加指法技巧"]*tf)
						end
					end
				end
				if JY.Thing[thingid]["加御剑能力"] > 0 then
					--桃花岛剑系增加
					if MPTX(pid,10) then
						mp = 3
					end
					--峨眉剑系增加
					if MPTX(pid,17) then
						mp = 3
					end
					--全真剑系增加
					if MPTX(pid,16) then
						mp = 1.5
					end
					--古墓剑系增加
					if MPTX(pid,3) then  
						mp = 2
					end
					--天机剑拳系增加
					if MPTX(pid,30) then
						mp = 2
					end
					if mp == 1 and tf == 1 then
						AddPersonAttrib(pid, "御剑能力", JY.Thing[thingid]["加御剑能力"])
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "御剑能力", JY.Thing[thingid]["加御剑能力"])
						--end
					else
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "御剑能力", JY.Thing[thingid]["加御剑能力"])
						--end
						if mp >= tf then
							AddPersonAttrib(pid, "御剑能力", JY.Thing[thingid]["加御剑能力"]*mp)
						else
							AddPersonAttrib(pid, "御剑能力", JY.Thing[thingid]["加御剑能力"]*tf)
						end
					end					
				end
				if JY.Thing[thingid]["加耍刀技巧"] > 0 then
					--桃花岛刀系增加
					if MPTX(pid,10) then
						mp = 3
					end
					--密宗刀系增加
					if MPTX(pid,6) then
						mp = 1.5
					end	
					--雪羽刀系增加
					if MPTX(pid,20) or match_ID(pid,514) then
						--mp = 1.5
						AddPersonAttrib(pid, "拳掌功夫", JY.Thing[thingid]["加耍刀技巧"])
					end	
					--天机剑刀系增加
					if MPTX(pid,30) then
						mp = 2
					end
					if mp == 1 and tf == 1 then
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "耍刀技巧", JY.Thing[thingid]["加耍刀技巧"])
						--end
						AddPersonAttrib(pid, "耍刀技巧", JY.Thing[thingid]["加耍刀技巧"])
					else
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "耍刀技巧", JY.Thing[thingid]["加耍刀技巧"])
						--end
						if mp >= tf then
							AddPersonAttrib(pid, "耍刀技巧", JY.Thing[thingid]["加耍刀技巧"]*mp)
						else
							AddPersonAttrib(pid, "耍刀技巧", JY.Thing[thingid]["加耍刀技巧"]*tf)
						end
					end
				end
				if JY.Thing[thingid]["加特殊兵器"] > 0 then
					--桃花岛特系增加
					if MPTX(pid,10) then
						mp = 3
					end
					--少林特系增加
					if MPTX(pid,5) then
						mp = 1.5
					end
					--丐帮系增加
					if MPTX(pid,2) then
						mp = 2
					end		
					--古墓特系增加	
					if MPTX(pid,3) then  
						mp = 1.5 
					end
					if mp == 1 and tf == 1 then
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "特殊兵器", JY.Thing[thingid]["加特殊兵器"])
						--end
						AddPersonAttrib(pid, "特殊兵器", JY.Thing[thingid]["加特殊兵器"])
					else
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "特殊兵器", JY.Thing[thingid]["加特殊兵器"])
						--end
						if mp >= tf then
							AddPersonAttrib(pid, "特殊兵器", JY.Thing[thingid]["加特殊兵器"]*mp)
						else
							AddPersonAttrib(pid, "特殊兵器", JY.Thing[thingid]["加特殊兵器"]*tf)
						end
					end
				end
				if JY.Thing[thingid]["加暗器技巧"] > 0 then
					--桃花岛暗器增加
					if MPTX(pid,10) then
						mp = 3
					end
					--古墓暗器增加	
					if MPTX(pid,3) then  
						mp = 1.5 
					end
					if mp == 1 and tf == 1 then
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "暗器技巧", JY.Thing[thingid]["加暗器技巧"])
						--end
						AddPersonAttrib(pid, "暗器技巧", JY.Thing[thingid]["加暗器技巧"])
					else
						--if JY.Base['难度'] > 2 then
							--AddPersonAttrib(pid, "暗器技巧", JY.Thing[thingid]["加暗器技巧"])
						--end
						if mp >= tf then
							AddPersonAttrib(pid, "暗器技巧", JY.Thing[thingid]["加暗器技巧"]*mp)
						else
							AddPersonAttrib(pid, "暗器技巧", JY.Thing[thingid]["加暗器技巧"]*tf)
						end
					end
				end
				--AddPersonAttrib(pid, "暗器技巧", JY.Thing[thingid]["加暗器技巧"])
				if JY.Thing[thingid]["加武学常识"] ~= nil and JY.Thing[thingid]["加武学常识"] > 0 then
					AddPersonAttrib(pid, "武学常识", JY.Thing[thingid]["加武学常识"])
				else
					local wugong = JY.Thing[thingid]['练出武功']
					if wugong ~= nil and wugong > 0 then
						if yongqin(wugong) then
							AddPersonAttrib(pid, "武学常识", math.random(1,3))
						else
							AddPersonAttrib(pid, "武学常识", math.modf(JY.Wugong[wugong]['攻击力10']/400))
						end	
					else
						AddPersonAttrib(pid, "武学常识", math.random(1,2))
					end			
				end	
				AddPersonAttrib(pid, "品德", JY.Thing[thingid]["加品德"])
				AddPersonAttrib(pid, "攻击带毒", JY.Thing[thingid]["加攻击带毒"])
				if JY.Thing[thingid]["加攻击次数"] == 1 then
					if JY.Base["畅想"] == 152 and JY.Person[pid] == JY.Person[0] then
					else
						p["左右互搏"] = 1
					end
				end
				--修炼特殊医术秘籍
				if  p["门派技能6"] < 1 then
					if thingid >= 187 and thingid <= 192 then
						p["门派技能6"] = thingid
					end
				end
				--修炼特殊暗器秘籍
				if JY.Thing[thingid]["未知6"] == 1 and p["门派技能2"] < 1 then
					p["门派技能2"] = thingid
					if thingid == 450 then
						AddPersonAttrib(pid, "防御力", 20)
						AddPersonAttrib(pid, "暗器技巧", 70)
						AddPersonAttrib(pid, "攻击力", 20)
					end	
					if thingid == 458 then
						AddPersonAttrib(pid, "防御力", 20)
						AddPersonAttrib(pid, "暗器技巧", 70)
						AddPersonAttrib(pid, "用毒能力", 20)
					end	
					if thingid == 459 then
						AddPersonAttrib(pid, "暗器技巧", 70)
						AddPersonAttrib(pid, "轻功", 20)
					end
					if thingid == 460 then
						AddPersonAttrib(pid, "暗器技巧", 50)
						AddPersonAttrib(pid, "轻功", 20)
						--AddPersonAttrib(pid, "防御力", JY.Thing[thingid]["加防御力"] * 2)
					end
					if thingid == 469 then
						AddPersonAttrib(pid, "暗器技巧", 60)
						AddPersonAttrib(pid, "轻功", 10)
						AddPersonAttrib(pid, "用毒能力", 30)
					end
					if thingid == 486 then
						AddPersonAttrib(pid, "暗器技巧", 120)
						AddPersonAttrib(pid, "轻功", 100)
						AddPersonAttrib(pid, "用毒能力", 100)
					end	
					if thingid == 489 then
						AddPersonAttrib(pid, "暗器技巧", 60)
						AddPersonAttrib(pid, "攻击带毒", 80)
						AddPersonAttrib(pid, "用毒能力", 80)
					end
					if thingid == 490 then
						AddPersonAttrib(pid, "防御力", 50)
						AddPersonAttrib(pid, "攻击力", 50)
						AddPersonAttrib(pid, "轻功", 50)
					end
				end	
				if thingid == 372 and ZhongYongZD1(pid)==false and ZhongYongZD2(pid)==false then
					local r = JYMsgBox("请选择", "何为中庸之道？*一：天命之谓性*二：率性之谓道", {"一","二"}, 2, 189)				
					if r == 1 then
				   		p["中庸"] = 1
						break
					elseif r == 2 then				
				   		p["中庸"] = 2
						break
					end
				end
				if thingid == 118 and p["门派技能3"] < 1 then
					p["门派技能3"] = 1
				end	
				if thingid == 547 and p["门派技能4"] < 1 then
					p["门派技能4"] = 1
				end
				if thingid == 294 and p['门派技能5'] < 1 then
					p['门派技能5'] = 1
				end	
				p["修炼点数"] = p["修炼点数"] - needpoint

				if wugongid >= 0 then 
					yes2 = true
					local oldwugong = 0
					for i = 1, JY.Base["武功数量"] do
						if p["武功" .. i] == wugongid then
							oldwugong = 1
							p["武功等级" .. i] = math.modf((p["武功等级" .. i] + 100) / 100) * 100
							kfnum = i
							break;
						end
					end
					if oldwugong == 0 then
						for i = 1, JY.Base["武功数量"] do
							if p["武功" .. i] == 0 then
								p["武功" .. i] = wugongid
								p["武功等级" .. i] = 0;
								kfnum = i
								break;
							end
						end
					end	
				end
			else
				break;
			end
		end
	end
	

	if yes1 then
		--p["武功等级" .. kfnum] = 999
		DrawStrBoxWaitKey(string.format("%s 修炼 %s 成功", p["姓名"], JY.Thing[thingid]["名称"]), C_WHITE, CC.DefaultFont)
	end
	if yes2 then
		--无酒不欢：自动到极的判定在这里
		local wugong = wugongid
		if p["武功等级" .. kfnum] == 900 then
			p["武功等级" .. kfnum] = 999
			DrawStrBoxWaitKey(string.format("%s 已修炼到极", JY.Wugong[wugongid]["名称"]), C_WHITE, CC.DefaultFont)
			if match_ID(pid, 49) and wugong == 14 then
        say("逍遥派的武学果然博大精深，让小僧有醍醐灌顶之感。", 49, 0);
        DrawStrBoxWaitKey("虚竹资质改变！", C_ORANGE, CC.DefaultFont)
				local xid = 49;	--标记修改
				if JY.Base["畅想"] == 49 or JY.Base["畅想"] == 53 then
					xid = 0
				end
        set_potential(xid, 100)
      end
			--畅想专属玉真子嫁衣神功
      if pid == 0 and match_ID(pid, 184) and (wugong == 13 or wugong == 143) and JY.Person[184]["品德"] ~= 40 then
				local jysg=0
				for i = 1, JY.Base["武功数量"] do
					if JY.Person[pid]["武功" .. i] == 143 and JY.Person[pid]["武功等级" .. i] == 999 then
						jysg=jysg+1
					end
					if JY.Person[pid]["武功" .. i] == 13 and JY.Person[pid]["武功等级" .. i] == 999 then
						jysg=jysg+1
					end
				end
				if jysg>1 then
					say("原来这就是嫁衣神功", 0, 1);
					DrawStrBoxWaitKey("玉真子等级改变！", C_ORANGE, CC.DefaultFont)
					JY.Person[0]["等级"] = 1
					JY.Person[184]["品德"] = 40
				end
			end
			--狄云 神照功为极，增加轻功20点
      if match_ID(pid, 37) and wugong == 94 then
          say("神照经当真奇妙，四肢百骸感觉劲力充盈。丁大哥，我一定不会让你失望的！", 37, 0);
          DrawStrBoxWaitKey("狄云领悟神照经的真髓，轻功加二十", C_ORANGE, CC.DefaultFont)
          AddPersonAttrib(pid, "轻功", 20)
      end
      --胡斐，胡家刀法到极，增加50点耍刀技巧
      if match_ID(pid, 1) and wugong == 67 then
          say("刀法真是越练越精妙。", 1, 0);
          DrawStrBoxWaitKey("胡斐攻、防、轻、耍刀技巧各增加50点", C_ORANGE, CC.DefaultFont)
          AddPersonAttrib(pid, "攻击力", 50)
          AddPersonAttrib(pid, "防御力", 50)
          AddPersonAttrib(pid, "轻功", 50)
          AddPersonAttrib(pid, "耍刀技巧", 50)
      end
		else
			DrawStrBoxWaitKey(string.format("%s 升为第%s级", JY.Wugong[wugongid]["名称"], math.modf(p["武功等级" .. kfnum] / 100) + 1), C_WHITE, CC.DefaultFont)
		end
	end
	if MPTX(pid,24,3) and PersonKF(pid,380) == false then 
		if thingid == 461 and PersonKF(pid,367) then
			say('极阴无相和夜雨不沾衣真是无比精深……我对于轻功一道，颇有顿悟，似乎可以尝试自创轻功了！',0,1)
			Cat('融合武功',0,7)
			
		elseif thingid == 537 and PersonKF(pid,304) then
			say('极阴无相和夜雨不沾衣真是无比精深……我对于轻功一道，颇有顿悟，似乎可以尝试自创轻功了！',0,1)
			Cat('融合武功',0,7)
		end
	end
	Hp_Max(pid)
end

--武功一脉
Ct['一脉机制'] = function(personid,oldwugong,newwugong)
	if personid == nil or oldwugong == nil or newwugong == nil then
		return 0
	end
	if (personid ~= nil and personid < 0) or (oldwugong ~= nil and oldwugong < 0) or (newwugong ~= nil and newwugong < 0) then
		return 0
	end	 
	if PersonKF(personid,oldwugong) == true and PersonKF(personid,newwugong) == false then
		if DrawStrBoxYesNo(-1, -1,JY.Wugong[oldwugong]['名称']..'与'..JY.Wugong[newwugong]['名称'].."一脉相承，是否将"..JY.Wugong[oldwugong]['名称'].."洗为"..JY.Wugong[newwugong]['名称']..'?', C_WHITE, CC.DefaultFont) then
      for i = 1, JY.Base["武功数量"] do
        if JY.Person[personid]["武功" .. i] == oldwugong then
          JY.Person[personid]["武功" .. i] = newwugong
          JY.Person[personid]["武功等级" .. i] = 50
          if JY.Wugong[oldwugong]['武功类型'] == 6 then
	          if JY.Person[personid]["天赋内功"] == oldwugong then
	            JY.Person[personid]["天赋内功"] = newwugong
	          end
	        elseif JY.Wugong[oldwugong]['武功类型'] ~= nil and JY.Wugong[oldwugong]['武功类型'] < 6 then
	        	if JY.Person[personid]["天赋外功1"] == oldwugong then
	            JY.Person[personid]["天赋外功1"] = newwugong
	          end
	          if JY.Person[personid]["天赋外功2"] == oldwugong then
	            JY.Person[personid]["天赋外功2"] = newwugong
	          end
	        end  
          break
        end
      end
	    return 2
		else
			return 0
		end		
	end
end

--特色指令
function War_TgrtsMenu()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	Cls()
	WAR.ShowHead = 0
	WarDrawMap(0)
	local grts_id;
	--如果是畅想
	if pid == 0 then
		grts_id = JY.Base["畅想"]
	else
		grts_id = pid
	end
	--local 
    --if JY.Person[pid]["特色指令"] == 1 then
	   
	--李清露的特色指令特殊
	if match_ID(pid, 574) then	
		local wg = JYMsgBox("特色指令：" .. GRTS[grts_id], GRTSSAY[grts_id], {"寒袖", "白虹"}, 2,  JY.Person[pid]["半身像"],1)
		if wg == 1 then
			JY.Person[pid]["武功1"] = 201
		elseif wg == 2 then
			JY.Person[pid]["武功1"] = 202
		end
		return 0
	end 	
	--郭襄的指令特殊
	if match_ID(pid, 626) then
		local wg = JYMsgBox("特色指令：" .. GRTS[grts_id], GRTSSAY[grts_id], {"弹指", "玉萧", "落英"}, 3, JY.Person[pid]["半身像"],1)
		if wg == 1 then
			JY.Person[pid]["武功1"] = 18
		elseif wg == 2 then
			JY.Person[pid]["武功1"] = 38
		elseif wg == 3 then
			JY.Person[pid]["武功1"] = 12
		end
		return 0
	--else
		--local yn = JYMsgBox("特色指令：" .. GRTS[grts_id], GRTSSAY[grts_id], {"确定", "取消"}, 2, JY.Person[pid]["半身像"])
		--if yn == 2 then
			--return 0
		--end
	end
	
	--段誉
	if match_ID(pid, 53) then
		if JY.Person[pid]["体力"] > 20 then
			WAR.TZ_DY = 1
			PlayWavE(16)
			CurIDTXDH(WAR.CurID, 72,1, "休迅飞凫 飘忽若神", M_DeepSkyBlue, 15);
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
  
	--虚竹
	if match_ID(pid, 49) then
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 1000 then
		  JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 5
		  JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
		  local ssh = {}
		  local num = 1
		  for i = 0, WAR.PersonNum - 1 do
			local wid = WAR.Person[i]["人物编号"]
			if WAR.PD["生死符"][wid] == 1 and WAR.Person[i]["死亡"] == false then
				--封穴50点
				ztd(wid,WAR.FXXS,50)
				WAR.PD["生死符"][wid] = nil
				if WAR.Person[i].Time > 0 then
					WAR.Person[i].Time = 0
				end
				ssh[num] = {}
				ssh[num][1] = i
				ssh[num][2] = wid
				num = num + 1
			end
		  end
		  local name = {}
		  for i = 1, num - 1 do
			name[i] = {}
			name[i][1] = JY.Person[ssh[i][2]]["姓名"]
			name[i][2] = nil
			name[i][3] = 1
		  end
		  --DrawStrBox(CC.MainMenuX, CC.MainMenuY, "催符：", C_GOLD, CC.DefaultFont)
			local r =  Cat('菜单',name,num-1,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
		 -- Cat('菜单',name, num - 1, 10, CC.MainMenuX, CC.MainMenuY + 45, 0, 0, 1, 0, CC.DefaultFont, C_RED, C_GOLD)
		  Cls()
		  PlayWavAtk(32)
		  CurIDTXDH(WAR.CurID, 72,1, "符掌生死 德折群雄")
		  PlayWavE(8)
		 -- local sssid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
			for DH = 114, 129 do
				Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
				for i = 1, num - 1 do
					local x0 = WAR.Person[WAR.CurID]["坐标X"]
					local y0 = WAR.Person[WAR.CurID]["坐标Y"]
					local dx = WAR.Person[ssh[i][1]]["坐标X"] - x0
					local dy = WAR.Person[ssh[i][1]]["坐标Y"] - y0
					local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
					local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
					local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)

					ry = ry - hb
					
					lib.PicLoadCache(3, DH * 2, rx, ry, 2, 192)
					if DH > 124 then
						DrawString(rx - 10, ry - 15, "封穴", C_GOLD, CC.DefaultFont)
					end
					
				end
				ShowScreen()
				--lib.ShowSurface(0)
				--lib.LoadSur(sssid, 0, 0)
				lib.Delay(CC.BattleDelay)
			end
		 -- lib.FreeSur(sssid)
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
  
  --人厨子
  if match_ID(pid, 89) then
    if JY.Person[pid]["体力"] > 25 and JY.Person[pid]["内力"] > 300 then
      local px, py = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
      local mxy = {
					{WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] + 1}, 
					{WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] - 1}, 
					{WAR.Person[WAR.CurID]["坐标X"] + 1, WAR.Person[WAR.CurID]["坐标Y"]}, 
					{WAR.Person[WAR.CurID]["坐标X"] - 1, WAR.Person[WAR.CurID]["坐标Y"]}}
      local zdp = {}
      local num = 1
      for i = 1, 4 do
        if GetWarMap(mxy[i][1], mxy[i][2], 2) >= 0 then
          local mid = GetWarMap(mxy[i][1], mxy[i][2], 2)
          if inteam(WAR.Person[mid]["人物编号"]) then
          	zdp[num] = WAR.Person[mid]["人物编号"]
          	num = num + 1
        	end
        end
        
      end
      local zdp2 = {}
      for i = 1, num - 1 do
        zdp2[i] = {}
        zdp2[i][1] = JY.Person[zdp[i]]["姓名"] .. "・" .. JY.Person[zdp[i]]["体力"]
        zdp2[i][2] = nil
        zdp2[i][3] = 1
      end
		--DrawStrBox(CC.MainMenuX, CC.MainMenuY, "气补：", C_GOLD, CC.DefaultFont)
		local r =  Cat('菜单',zdp2,num-1,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
		--local r = Cat('菜单',zdp2, num - 1, 10, CC.MainMenuX, CC.MainMenuY + 45, 0, 0, 1, 0, CC.DefaultFont, C_RED, C_GOLD)
		Cls()
		AddPersonAttrib(zdp[r], "体力", 50)
		AddPersonAttrib(pid, "体力", -25)
		AddPersonAttrib(pid, "内力", -300)
		PlayWavE(28)
		--lib.Delay(10)
		CurIDTXDH(WAR.CurID, 86,1, "化气补元")
		local Ocur = WAR.CurID
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["人物编号"] == zdp[r] then
				WAR.CurID = i
			end
		end
		Cat('实时特效动画')
        WarDrawMap(0)
        Cat('实时特效动画2')
		PlayWavE(36)
      --lib.Delay(100)
		lib.Delay(CC.BattleDelay)
		CurIDTXDH(WAR.CurID, 86, 1, "恢复体力50点")
		WAR.CurID = Ocur
		WarDrawMap(0)
    else
    	DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
    	return 0
    end
  end
  
  --张无忌
  if match_ID(pid, 9) then
    if JY.Person[pid]["体力"] > 10 and JY.Person[pid]["内力"] > 500 then
      local nyp = {}
      local num = 1
      for i = 0, WAR.PersonNum - 1 do
        if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 8) and i ~= WAR.CurID then
          nyp[num] = {}
          nyp[num][1] = JY.Person[WAR.Person[i]["人物编号"]]["姓名"]
          nyp[num][2] = nil
          nyp[num][3] = 1
          nyp[num][4] = i
          num = num + 1
        end
      end
      --DrawStrBox(CC.MainMenuX, CC.MainMenuY, "挪移：", C_GOLD, CC.DefaultFont)
		local r =  Cat('菜单',nyp,num-1,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
      --local r = Cat('菜单',nyp, num - 1, 10, CC.MainMenuX, CC.MainMenuY + 45, 0, 0, 1, 0, CC.DefaultFont, C_RED, C_GOLD)
      Cls()
      local mid = WAR.Person[nyp[r][4]]["人物编号"]
      QZXS("请选择要将" .. JY.Person[mid]["姓名"] .. "挪移到什么位置？")
      War_CalMoveStep(WAR.CurID, 8, 1)
		local nx, ny = nil, nil
		while true do
	      nx, ny = War_SelectMove()
	      if nx ~= nil then
		      if lib.GetWarMap(nx, ny, 2) > 0 or lib.GetWarMap(nx, ny, 5) > 0 then
		        QZXS("此处有人！请重新选择")			--此处有人！请重新选择
	      	elseif CC.SceneWater[lib.GetWarMap(nx, ny, 0)] ~= nil then
	        	QZXS("水面，不可进入！请重新选择")		--水面，不可进入！请重新选择
	       	else
	       		break;
	        end
	      end
	    end
	    PlayWavE(5)
	    CurIDTXDH(WAR.CurID, 88,1, "九阳明尊 挪移乾坤")		--九阳明尊 挪移乾坤
	    local Ocur = WAR.CurID
	    WAR.CurID = nyp[r][4]
	    WarDrawMap(0)
	    CurIDTXDH(WAR.CurID, 88,1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    CurIDTXDH(WAR.CurID, 88,1)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    WarDrawMap(0)
	    CurIDTXDH(WAR.CurID, 88,1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    WarDrawMap(0)
	    CurIDTXDH(WAR.CurID, 88,1)
	    WAR.CurID = Ocur
	    AddPersonAttrib(pid, "体力", -10)
	    AddPersonAttrib(pid, "内力", -500)
	    
	  else
	  	DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
	  	return 0
	  end
	end
	
	--祖千秋
	if match_ID(pid, 88) then
	  if JY.Person[pid]["体力"] > 10 and JY.Person[pid]["内力"] > 700 then
	    local dxp = {}
	    local num = 1
	    for i = 0, WAR.PersonNum - 1 do
	      if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 5) and i ~= WAR.CurID then
	        dxp[num] = {}
	        dxp[num][1] = JY.Person[WAR.Person[i]["人物编号"]]["姓名"]
	        dxp[num][2] = nil
	        dxp[num][3] = 1
	        dxp[num][4] = i
	        num = num + 1
	      end
	    end
	    --DrawStrBox(CC.MainMenuX, CC.MainMenuY, "传功：", C_GOLD, 30)
		local r =  Cat('菜单',dxp,num-1,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
	    --local r = Cat('菜单',dxp, num - 1, 10, CC.MainMenuX, CC.MainMenuY + 45, 0, 0, 1, 0, CC.DefaultFont, C_RED, C_GOLD)
	    Cls()
	    local mid = WAR.Person[dxp[r][4]]["人物编号"]
	    PlayWavE(28)
	    --lib.Delay(10)
	    CurIDTXDH(WAR.CurID,87,1, "酒神戏红尘")
	    local Ocur = WAR.CurID
	    WAR.CurID = dxp[r][4]
		Cat('实时特效动画')
        WarDrawMap(0)
        Cat('实时特效动画2')
	    PlayWavE(36)
	    lib.Delay(CC.BattleDelay)
	    CurIDTXDH(WAR.CurID, 87, 1, "集气上升500")
	    WAR.CurID = Ocur
	    WarDrawMap(0)
	    WAR.Person[dxp[r][4]].Time = WAR.Person[dxp[r][4]].Time + 500
	    if WAR.Person[dxp[r][4]].Time > 999 then
	      WAR.Person[dxp[r][4]].Time = 999
	    end
	    AddPersonAttrib(pid, "体力", -10)
	    AddPersonAttrib(pid, "内力", -1000)
	  else
	  	DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
	  	return 0
		end
	end
	
	--不戒
	if match_ID(pid, 593) then
	  if JY.Person[pid]["体力"] > 10 and JY.Person[pid]["内力"] > 700 then
	    local dxp = {}
	    local num = 1
	    for i = 0, WAR.PersonNum - 1 do
	      if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 5) and i ~= WAR.CurID then
	        dxp[num] = {}
	        dxp[num][1] = JY.Person[WAR.Person[i]["人物编号"]]["姓名"]
	        dxp[num][2] = nil
	        dxp[num][3] = 1
	        dxp[num][4] = i
	        num = num + 1
	      end
	    end
		local r =  Cat('菜单',dxp,num-1,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
	    Cls()
	    local mid = WAR.Person[dxp[r][4]]["人物编号"]
	    PlayWavE(28)
	    CurIDTXDH(WAR.CurID,87,1, "不可不戒")
	    local Ocur = WAR.CurID
	    WAR.CurID = dxp[r][4]
		Cat('实时特效动画')
        WarDrawMap(0)
        Cat('实时特效动画2')
	    PlayWavE(36)
	    lib.Delay(CC.BattleDelay)
	    WAR.CurID = Ocur
	    WarDrawMap(0)
		JY.Person[mid]["性别"]=2
		local add, str = AddPersonAttrib(mid, "攻击力", -20)
		DrawStrBoxWaitKey(JY.Person[mid]["姓名"] .. str, C_ORANGE, CC.DefaultFont)
		local add, str = AddPersonAttrib(mid, "防御力", -30)
		DrawStrBoxWaitKey(JY.Person[mid]["姓名"] .. str, C_ORANGE, CC.DefaultFont)
		AddPersonAttrib(pid, "体力", -20)
	    AddPersonAttrib(pid, "内力", -1000)
	  else
	  	DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
	  	return 0
		end
	end
	

	--萧中慧，慧心
	if match_ID(pid, 77) then
		if JY.Person[pid]["生命"] > 500 and JY.Person[pid]["受伤程度"] < 50 then
			local zjwid = nil
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["人物编号"] == 0 and WAR.Person[i]["死亡"] == false then
					zjwid = i
					break
				end
			end
			if zjwid ~= nil then
				DrawStrBoxWaitKey("我心本慧・侠女柔情", C_RED, 36)
				say("２慧妹……！",0,1)
				if JY.Person[0]["性别"] == 0 then
					say("１ｎ哥哥，９请…………２加油！",77,0)
				else
					say("１ｎ姐姐，９请…………２加油！",77,0)
				end
				JY.Person[pid]["生命"] = 0
				JY.Person[pid]["受伤程度"] = 100
				WAR.Person[WAR.CurID].Time = -500
				JY.Person[0]["生命"] = JY.Person[0]["生命最大值"]
				JY.Person[0]["受伤程度"] = 0
				WAR.Person[zjwid].Time = 999
				JY.Person[0]["封穴程度"] = 0
				WAR.LQZ[0] = 100
			else
				DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)		-- "未满足发动条件"
				return 0
			end

		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)		-- "未满足发动条件"
			return 0
		end
	end
	
	--蓝烟清：王难姑特色指令 - 施毒  周围五格范围内的敌人时序中毒并时序减血
	if match_ID(pid, 17) then
		if JY.Person[pid]["体力"] >= 30 and JY.Person[pid]["内力"] >= 300 then
			CleanWarMap(4,0);
			AddPersonAttrib(pid, "体力", -15)
			AddPersonAttrib(pid, "内力", -300)
			local x1 = WAR.Person[WAR.CurID]["坐标X"];
			local y1 = WAR.Person[WAR.CurID]["坐标Y"];
			for ex = x1 - 5, x1 + 5 do
				for ey = y1 - 5, y1 + 5 do
					SetWarMap(ex, ey, 4, 1)
					if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
						local ep = GetWarMap(ex, ey, 2)
						if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
							WAR.PD['毒击'][WAR.Person[ep]["人物编号"]] = 20;			--50时序内持续减中毒+减血
							SetWarMap(ex, ey, 4, 4)
						end
					end
				end
			end
			War_ShowFight(pid,0,0,0,x1,y1,30);
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--brolycjw：胡青牛特色指令 - 群疗  周围五格范围内的队友时序回内伤并按比例回血
	if match_ID(pid, 16) then
		if JY.Person[pid]["体力"] >= 30 and JY.Person[pid]["内力"] >= 300 then
			CleanWarMap(4,0);
			AddPersonAttrib(pid, "体力", -15)
			AddPersonAttrib(pid, "内力", -300)
			local x1 = WAR.Person[WAR.CurID]["坐标X"];
			local y1 = WAR.Person[WAR.CurID]["坐标Y"];
			for ex = x1 - 5, x1 + 5 do
				for ey = y1 - 5, y1 + 5 do
					SetWarMap(ex, ey, 4, 1)
					if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
						local ep = GetWarMap(ex, ey, 2)
						if WAR.Person[WAR.CurID]["我方"] == WAR.Person[ep]["我方"] then
							WAR.L_HQNZL[WAR.Person[ep]["人物编号"]] = 20;			--20时序内持续回血+回内伤
							SetWarMap(ex, ey, 4, 4)
					  
						end
					end
				end
			end
			War_ShowFight(pid,0,0,0,x1,y1,0);
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--慕容复 幻梦
	if match_ID(pid, 51) then
		if JY.Person[pid]["体力"] > 20 then
			WAR.TZ_MRF = 1
			CurIDTXDH(WAR.CurID, 127,1, "顾盼子孙贤 铭记复国志", C_GOLD);
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--小昭 影步
	if match_ID(pid, 66) then
		if JY.Person[pid]["体力"] > 30 and JY.Person[pid]["内力"] > 2000 then
			War_CalMoveStep(WAR.CurID, 10, 0)
			WAR.XZ_YB[1],WAR.XZ_YB[2]=War_SelectMove()
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 20
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 1000
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--钟灵指令 灵貂
	if match_ID(pid, 90) then
		if JY.Person[pid]["体力"] > 10 then
			War_CalMoveStep(WAR.CurID, 8, 1)
			local x,y = War_SelectMove()
			if lib.GetWarMap(x, y, 2) > 0 or lib.GetWarMap(x, y, 5) > 0 then
				local tdID = lib.GetWarMap(x, y, 2)
				if WAR.Person[tdID]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					return 0
				end
				local eid = WAR.Person[tdID]["人物编号"]
				local x0, y0 = WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"]
				local x1, y1 = WAR.Person[tdID]["坐标X"],WAR.Person[tdID]["坐标Y"]
				for i = 1, 4 do
					if 0 < JY.Person[eid]["携带物品数量" .. i] and -1 < JY.Person[eid]["携带物品" .. i] then
						WAR.TD = JY.Person[eid]["携带物品" .. i]
						WAR.TDnum = JY.Person[eid]["携带物品数量" .. i]
						JY.Person[eid]["携带物品数量" .. i] = 0
						JY.Person[eid]["携带物品" .. i] = -1
						break
					end
				end
				WAR.Person[WAR.CurID]["人方向"] = War_Direct(x0, y0, x1, y1)
				CleanWarMap(4, 0)
				SetWarMap(x1, y1, 4, 1)
				WAR.Person[tdID]["中毒点数"] = (WAR.Person[tdID]["中毒点数"] or 0) + AddPersonAttrib(eid, "中毒程度", 50)
				WAR.TXXS[eid] = 1
				War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, 0, 0, 0, 0, 12)
				if WAR.TD ~= -1 then
					if WAR.TD == 118 then
						say("１想要从我慕容复手中偷东西？哼哼，下辈子吧！", 51,0)
					else
						instruct_2(WAR.TD, WAR.TDnum)
					end
					WAR.TD = -1
					WAR.TDnum = 0
				end
				WAR.TXXS[eid] = nil
			else
				return 0
			end
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 5
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--胡斐 飞狐
	if match_ID(pid, 1) then
		if JY.Person[pid]["体力"] > 20 then
			War_CalMoveStep(WAR.CurID, 10, 2)
			local x,y = War_SelectMove()
			if not x then
				return 0
			end
			if GetWarMap(x, y, 1) > 0 or GetWarMap(x, y, 2) > 0 or GetWarMap(x, y, 5) > 0 or CC.WarWater[GetWarMap(x, y, 0)] ~= nil then
				return 0
			else
				CurIDTXDH(WAR.CurID, 25,1, "雪山飞狐", Violet);
				WAR.Person[WAR.CurID]["移动步数"] = 10
				War_MovePerson(x, y, 1)
				WAR.Person[WAR.CurID]["移动步数"] = 0
				JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
			end
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--鸠摩智 幻化
	if match_ID(pid, 103) then
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 1000 then
			local thing = {}
			local thingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				thing[i] = -1
				thingnum[i] = 0
			end
			local num = 0
			for i = 0, CC.MyThingNum - 1 do
				local id = JY.Base["物品" .. i + 1]
				if id >= 0 then
					if JY.Thing[id]["类型"] == 2 and JY.Thing[id]["练出武功"] > -1 then
						thing[num] = id
						thingnum[num] = JY.Base["物品数量" .. i + 1]
						num = num + 1
					end
				end 
			end
			IsViewingKungfuScrolls = 1
			local r = SelectThing(thing, thingnum)
			if r >= 0 then
				WAR.PD["昏迷状态"][pid] = 1
				CurIDTXDH(WAR.CurID, 93,1, "无相幻化", C_GOLD)
				JY.Person[pid]["武功2"]= JY.Thing[r]["练出武功"]
				JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
				JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
				savewg(WAR.CurID)
				return 0
			else
				return 0
			end
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--达尔巴指令 死战
	if match_ID(pid, 160) then
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 1000 then
			War_CalMoveStep(WAR.CurID, 8, 1)
			local x,y = War_SelectMove()
			if lib.GetWarMap(x, y, 2) > 0 or lib.GetWarMap(x, y, 5) > 0 then
				local tdID = lib.GetWarMap(x, y, 2)
				if WAR.Person[tdID]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					return 0
				end
				local eid = WAR.Person[tdID]["人物编号"]
				WAR.SZSD = eid
				
				CurIDTXDH(WAR.CurID, 93,1, "锁定目标", C_GOLD)
				JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
				JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
			else
				return 0
			end
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--金轮 龙象
	if match_ID(pid, 62) then
		if JY.Person[pid]["体力"] > 35 and JY.Person[pid]["内力"] > 3500 then
			War_ActupMenu()
			WAR.SLSX[pid] = 2
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 30
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 3000
			return 0
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end

	--黄蓉 遁甲
	if match_ID(pid, 56) then
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 1000 then
			local x,y = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
			--1绿色，2红色，3蓝色，4紫色
			CleanWarMap(6,-1);
					
			local QMDJ = {"休","生","伤","杜","景","死","惊","开"}
						
			--在自身周围绘制奇阵
			SetWarMap(x,y, 6, math.random(4))
			
			for j=1, 2 do
				SetWarMap(x + math.random(6), y + math.random(6), 6, math.random(4));
				for n = 30, 40 do
					local i = n
					if i > 40 then
						i = 40
					end
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
					ShowScreen()
					lib.Delay(CC.BattleDelay)	
				end
			end
						
			for j=3, 4 do
				SetWarMap(x + math.random(6), y - math.random(6), 6, math.random(4));
				for n = 30, 40 do
					local i = n
					if i > 40 then
						i = 40
					end
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
					ShowScreen()
					lib.Delay(CC.BattleDelay)	
				end
			end
						
			for j=5, 6 do
				SetWarMap(x - math.random(6), y - math.random(6), 6, math.random(4));
				for n = 30, 40 do
					local i = n
					if i > 40 then
						i = 40
					end
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
					ShowScreen()
					lib.Delay(CC.BattleDelay)	
				end
			end
						
			for j=7, 8 do
				SetWarMap(x - math.random(6), y + math.random(6), 6, math.random(4));
				for n = 30, 40 do
					local i = n
					if i > 40 then
						i = 40
					end
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
					ShowScreen()
					lib.Delay(CC.BattleDelay)	
				end
				
			end
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--阿紫，禁药
	if match_ID(pid, 47) then
		WAR.JYZT[pid] = 1
		CurIDTXDH(WAR.CurID, 128,1, "禁药", C_RED);
		return 20
	end
	
	--韦小宝 口才
	if match_ID(pid, 601) or match_ID(pid, 773) then
		if JY.Person[pid]["体力"] > 30 then
			War_CalMoveStep(WAR.CurID, 8, 1)
			local x,y = War_SelectMove()
			if lib.GetWarMap(x, y, 2) > 0 or lib.GetWarMap(x, y, 5) > 0 then
				local tdID = lib.GetWarMap(x, y, 2)
				if WAR.Person[tdID]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					return 0
				end
				local eid = WAR.Person[tdID]["人物编号"]
				WAR.PD["沉睡状态"][eid] = 1
				
				Cls()
				local KC = {"阁下英明神武","鸟生鱼汤"}
				
				for n = 1, #KC + 25 do
					local i = n 
					if i > #KC then 
						i = #KC
					end
					lib.GetKey()
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					DrawString(-1, -1, KC[i], C_GOLD, CC.Fontsmall)
					ShowScreen()
					lib.Delay(CC.BattleDelay)
				end
				Cls()
				local s = WAR.CurID
				WAR.CurID = tdID
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 145,1)
				WAR.CurID = s
				JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 15
			else
				return 0
			end
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--苗人凤指令 破军
	if match_ID(pid, 3) then
		if JY.Person[pid]["体力"] > 30 and JY.Person[pid]["内力"] > 1000 then
			WAR.MRF = 1
			if Cat('武功') == 0 then
			--if War_FightMenu() == 0 then
				return 0
			end
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 30
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
			WAR.MRF = 0
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end

	
	--灭绝，俱焚
	if match_ID(pid, 6) then
		WAR.YSJF[pid] = 100
		CurIDTXDH(WAR.CurID, 124,1, "玉石俱焚", M_Silver);
		return 20
	end

	--谢逊指令 咆哮
	if match_ID(pid, 13) then
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 3000 then
			CurIDTXDH(WAR.CurID, 118,1, "狮王咆哮", C_GOLD)
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then
					WAR.PD["混乱状态"][WAR.Person[j]["人物编号"]] = 2
				end
			end
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 2000
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	--丘处机 一言止杀
	if match_ID(pid, 68) then
		if JY.Person[pid]["体力"] > 20 and WAR.JSZT1[pid]~= nil and WAR.JSZT1[pid] == 0 then
			CurIDTXDH(WAR.CurID, 118,1, "一言止杀", C_GOLD)
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then		
                local offset1 = math.abs(WAR.Person[j]["坐标X"] - WAR.Person[WAR.CurID]["坐标X"])
                local offset2 = math.abs(WAR.Person[j]["坐标Y"] - WAR.Person[WAR.CurID]["坐标Y"])				
				if offset1 < 10 and offset2 < 10 then
				WAR.PD["恐惧状态"][WAR.Person[j]["人物编号"]] = 1
				end
			 end
			end
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 15
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
		WAR.JSZT1[pid]= nil
	end
	--霍青桐统率指令，我方全体防御提升50时序
	if match_ID(pid, 74) then
		if JY.Person[pid]["体力"] > 10 and JY.Person[pid]["内力"] > 150 and WAR.HQT_CD == 0 then
			CurIDTXDH(WAR.CurID, 92,1, "指挥");		--动画显示
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false then
					WAR.HQT_ZL[WAR.Person[i]["人物编号"]] = 50
					WAR.HQT_CD = 2
					WAR.Person[i].Time = WAR.Person[i].Time + 500;
					if WAR.Person[i].Time > 999 then
						WAR.Person[i].Time = 999;
				end
			end
			end
			AddPersonAttrib(pid, "体力", -15)
			AddPersonAttrib(pid, "内力", -500)
			--lib.Delay(100)		
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
	  	return 0
		end
	end

	--何太冲指令 琴音
	if match_ID(pid, 7) then
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 1000 then
			CleanWarMap(4, 0)
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local eid = WAR.Person[j]["人物编号"]
					local qycs = WAR.PD["琴音状态"][eid] or 0
					if qycs > 0 then
						WAR.TXXS[eid] = 1
						--无酒不欢：记录人物血量
						WAR.Person[j]["Life_Before_Hit"] = JY.Person[eid]["生命"]
						ztd(j,"生命点数",- 50*qycs)
						SetWarMap(WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"], 4, 1)
						WAR.PD["琴音状态"][eid] = nil
					end
				end
			end
			War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, 0, 0, 0, 0, 144)
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--阎基指令 虚弱
	if match_ID(pid, 4) then
		if JY.Person[pid]["体力"] > 20 then
			War_CalMoveStep(WAR.CurID, 8, 1)
			local x,y = War_SelectMove()
			if lib.GetWarMap(x, y, 2) > 0 or lib.GetWarMap(x, y, 5) > 0 then
				local tdID = lib.GetWarMap(x, y, 2)
				if WAR.Person[tdID]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					return 0
				end
				local eid = WAR.Person[tdID]["人物编号"]
				local x0, y0 = WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"]
				local x1, y1 = WAR.Person[tdID]["坐标X"],WAR.Person[tdID]["坐标Y"]
				
				WAR.PD["虚弱状态"][eid] = 40
				WAR.Person[WAR.CurID]["人方向"] = War_Direct(x0, y0, x1, y1)
				CleanWarMap(4, 0)
				SetWarMap(x1, y1, 4, 1)
				War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, 0, 0, 0, 0, 148)
			else
				return 0
			end
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	
	--黛绮丝，倾国
	if match_ID(pid, 15) then
	   if JY.Person[pid]['内力'] >= 2000 and JY.Person[pid]["体力"] >= 10 then
		  WAR.QGZT[pid] = 6
		  CurIDTXDH(WAR.CurID, 149,1)
		  JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
		  JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 2000
	   else 
          DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
       end	   
	   return 20
	end
	--杨冰羽，招生	--615修改
	if pid==514 or (pid==0 and JY.Base["畅想"]==514)  then
	   if JY.Person[pid]['内力'] >= 2000 and JY.Person[pid]["体力"] >= 20 and instruct_20()==false and instruct_31(6000) then
		local num = 0
		local e_list = {}
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
				table.insert(e_list, i)
				num = num + 1
			end
		end
		local name = {}
		for i = 1, num do
			name[i] = {}
			name[i][1] = JY.Person[WAR.Person[e_list[i]]['人物编号']]['姓名']
			name[i][2] = nil
			name[i][3] = 1
		end
		DrawStrBox(CC.MainMenuX, CC.MainMenuY, "要把谁收为徒弟？", C_GOLD, CC.DefaultFont)
		local c = ShowMenu(name, num, 10, CC.MainMenuX, CC.MainMenuY + 45, 0, 0, 1, 0, CC.DefaultFont, C_RED, C_GOLD)
		local o_id = WAR.CurID
			if JY.Person[WAR.Person[e_list[c]]['人物编号']]["畅想分阶"] > 2 then
			say("２雪羽宗开课招生了！性感妩媚的师傅，冰山冷艳的师姐，清纯可人的师妹，这些统统没有，宗门连个草屋都没有，人傻钱多的速来。 ",0,2)  --对话
			WAR.CurID = e_list[c]
			WAR.Person[WAR.CurID]["我方"]= true
			instruct_10(WAR.Person[e_list[c]]['人物编号']) 
			instruct_2(174, -6000) 
			else
			say("２失败了，知道因为啥失败吗？他一个厨师不看菜谱看起兵法了，撤！ ",0,2)  --对话
			end
		  JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 20
		  JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 2000
		  WAR.YBY = 1
	   else 
          DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
		  return 0
       end	   
	end
	--喵姐指令 女装
	if match_ID(pid, 92) then
		if JY.Person[pid]["体力"] > 20 then
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 135, 1, "日出东方 唯喵姐不败", C_GOLD)
			lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
			lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
			WarDrawMap(0)
			local mj = {}
			if JY.Person[pid]["性别"] == 0 then
				JY.Person[pid]["头像代号"] = 504
				JY.Person[pid]["半身像"] = 504
				JY.Person[pid]["性别"] = 1
				JY.Person[pid]["武功2"] = 105
				JY.Person[pid]["天赋内功"] = 105
				JY.Person[pid]["主运内功"] = 105
				mj[1]={0,13,0,0,0}
				mj[2]={0,11,0,0,0}
				mj[3]={0,11,0,0,0}
			else
				JY.Person[pid]["头像代号"] = 92
				JY.Person[pid]["半身像"] = 92
				JY.Person[pid]["性别"] = 0
				JY.Person[pid]["武功2"] = 105
				JY.Person[pid]["天赋内功"] = 105
				JY.Person[pid]["主运内功"] = 105
				mj[1]={0,14,0,0,0}
				mj[2]={0,12,0,0,0}
				mj[3]={0,12,0,0,0}
			end
			for i = 1, 5 do
				JY.Person[pid]["出招动画帧数" .. i] = mj[1][i]
				JY.Person[pid]["出招动画延迟" .. i] = mj[2][i]
				JY.Person[pid]["武功音效延迟" .. i] = mj[3][i]
			end	

			WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 135, 1, "日出东方 唯喵不败", C_GOLD)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
            SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 135, 1, "日出东方 唯喵不败", C_GOLD)
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	--李寻欢 飞刀
	if match_ID(pid, 498) then
		if WAR.XLFD[pid] ~= nil then
			WAR.XLFD[pid] = nil
			return 20
		end
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 1000 then
			WAR.XLFD[pid] = 100
			CurIDTXDH(WAR.CurID, 124,1,"小李飞刀",C_GOLD)
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
			return 20
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end	
	--萧秋水 惊天一剑
	if match_ID(pid, 652)  then
		if WAR.JTYJ[pid] ~= nil then
			WAR.JTYJ[pid] = nil
			return 20
		end
		if JY.Person[pid]["体力"] > 20 and JY.Person[pid]["内力"] > 1000 and BNJQ(pid) and WAR.DZXY ~= 1  then
			WAR.JTYJ[pid] = 20
			CurIDTXDH(WAR.CurID, 132,1,"天剑",C_GOLD)
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - 500
			return 20
		else
			DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
			return 0
		end
	end	
	
	--梅长苏 麒麟
	if match_ID(pid, 9969) then
		local ql = 1
		local bx,by = CC.ScreenW/1360,CC.ScreenH/768
		local menu={};
		local mj = {}
		local str = '策马迎风 看人生起伏'
		local p = 507
		local ts = JY.Base['天书数量']
		menu[1]={"换装",nil,1};
		menu[2]={"麒麟不动",nil,1};
		mj[1]={0,10,0,0,0}
		mj[2]={0,9,0,0,0}
		mj[3]={0,9,0,0,0}
		if match_ID(pid, 507) then 
			mj[1]={0,14,0,0,0}
			mj[2]={0,14,0,0,0}
			mj[3]={0,14,0,0,0}
			p = 508
			str = '江左梅郎  麒麟之才'
			ql =  Cat('菜单',menu,#menu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
			if ql == 0 then 
				return 0
			end	
		end
		if ql == 1 then
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 135, 1, str, C_GOLD)
			lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
			lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
			WarDrawMap(0)
			JY.Person[pid]["头像代号"] = JY.Person[p]["头像代号"]
			JY.Person[pid]["半身像"] = JY.Person[p]["半身像"]
			for i = 1, 5 do
				JY.Person[pid]["出招动画帧数" .. i] = mj[1][i]
				JY.Person[pid]["出招动画延迟" .. i] = mj[2][i]
				JY.Person[pid]["武功音效延迟" .. i] = mj[3][i]
			end	
			JY.Base['畅想'] = p
			--lib.PicLoadFile(string.format(CC.FightPicFile[1], JY.Person[pid]["头像代号"]), string.format(CC.FightPicFile[2], JY.Person[pid]["头像代号"]), 4 + WAR.CurID)

			WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 135, 1, str, C_GOLD)
			lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
			lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
            SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 135, 1, str, C_GOLD)
		elseif ql == 2 then 
			if ts <= 0 or JY.Person[pid]['体力'] < 10 then 
				DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
				return 0
			end
			local x = WAR.Person[WAR.CurID]["坐标X"];
			local y = WAR.Person[WAR.CurID]["坐标Y"];
			local page = 1

			War_CalMoveStep(WAR.CurID,255,1)
			Cat('实时特效动画')
            WarDrawMap(1,x,y);	
            Cat('实时特效动画2')
			ShowScreen()
			lib.Delay(CC.BattleDelay)
			x,y = War_SelectMove()
			if x == nil then
				return 0
			end
			local id = -1
			local kfmenu = {}
			local i = GetWarMap(x,y,2)
			local kfid = 0
			local kflv = 0
			if i >= 0 and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				id = WAR.Person[i]['人物编号']
				for j = 1,JY.Base['武功数量'] do 
					if JY.Person[id]['武功'..j] > 0 then 
						kfmenu[#kfmenu+1] = {JY.Wugong[JY.Person[id]['武功'..j]]['名称'],JY.Person[id]['武功'..j],1,JY.Person[id]['武功等级'..j]}
					end
				end
			end
			if #kfmenu == 0 then 
				DrawStrBoxWaitKey("目标无武功可学", C_WHITE, CC.DefaultFont)
				return 0
			end
			local r = Cat('菜单',kfmenu,#kfmenu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
			if r <= 0 then 
				return 0
			end
			
			kfid = kfmenu[r][2]
			kflv = kfmenu[r][4]
			local kfmenu1 = {}
			if ts > JY.Base["武功数量"] then
				ts = JY.Base["武功数量"]
			end
			for j = 1,ts do
				local kn = '空白'
				if JY.Person[pid]['武功'..j] > 0 then 
					kn = JY.Wugong[JY.Person[pid]['武功'..j]]['名称']
				end
				kfmenu1[#kfmenu1+1] = {kn,j,1}
				if JY.Person[pid]['武功'..j] <= 0 then 
					break
				end
			end
			local r1 = Cat('菜单',kfmenu1,#kfmenu1,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
			if r1 <= 0 then 
				return 0
			end
			JY.Person[pid]['武功'..kfmenu1[r1][2]] = kfid
			JY.Person[pid]['武功等级'..kfmenu1[r1][2]] = kflv
			AddPersonAttrib(pid,'体力',-10)
			CurIDTXDH(WAR.CurID, 135, 1, '江左梅郎  麒麟之才', C_GOLD)
		end
	end
	
	Cat('遮影DH2',WAR.CurID)

	return 1
end

--战斗蓄力
function War_ActupMenu()
	local p = WAR.CurID
	local id = WAR.Person[p]["人物编号"]
	local x0, y0 = WAR.Person[p]["坐标X"], WAR.Person[p]["坐标Y"]
	local str = ""
	if JY.Person[id]['生命'] <= 0 then
		return 1
	end	
	--九阴太极
    if NGQH(id,107) then
		WAR.Actup[id] = 2
	    WAR.ZBT3 = WAR.ZBT3 + 1
		if WAR.ZBT3 > 9 then
			WAR.ZBT3 = 9
		end
		local a = WAR.ZBT3
		str = a.."重螺旋气劲"
		CurIDTXDH(WAR.CurID,376,1,str,LightSlateBlue);
	end
	--神照龟息
	if NGQH(id,94) then
		WAR.Actup[id] = 2;
		if WAR.Defup[id] == nil then
			War_DefupMenu()
		end	
		CurIDTXDH(WAR.CurID, 33,1,"道于神行・神游太虚", LightSlateBlue);
	end
	--太极拳
	if (PersonKF(id,16) and PersonKF(id,46)) or match_ID(id,5) then
		WAR.Actup[id] = 2
		WAR.TJQJ = 1
		CurIDTXDH(WAR.CurID, 170,1,"太极奥义・剑罡拳劲", LightSlateBlue);
	end 
	--纯阳功蓄力
	if MPTX(id,4,3) and Curr_NG(id, 99) then
	    WAR.Actup[id] = 2 
		if WAR.Defup[id] == nil then
			War_DefupMenu()
		end
		if JLSD(10,60,id) then
			WAR.PD['纯阳蓄力'][id] = 1
		end
		CurIDTXDH(WAR.CurID,171,1,"纯阳无极・乾坤奥义", LightSlateBlue);
	end
	--太极功蓄力
	if MPTX(id,4,3) and Curr_NG(id,171) then
	    WAR.Actup[id] = 2 
		if WAR.Defup[id] == nil then
			War_DefupMenu()
		end
		WAR.TJXL = 1 	
		CurIDTXDH(WAR.CurID, 167,1,"太极奥义・道我如一", LightSlateBlue);
	end	
	--主运蛤蟆蓄力带防御效果
	if Curr_NG(id,95) and WAR.Actup[id] == nil then
		WAR.Actup[id] = 2;
		if WAR.Defup[id] == nil then
			War_DefupMenu()
		end	
		WAR.HMGXL[id] = 1
		CurIDTXDH(WAR.CurID, 85,1,"蛤蟆蓄力・攻守兼备", LightSlateBlue);
	end
	--被动龙象蓄力带防御效果
	if PersonKF(id, 103) and WAR.Actup[id] == nil then
		WAR.Actup[id] = 2;
		if WAR.Defup[id] == nil then
			War_DefupMenu()
		end
		CurIDTXDH(WAR.CurID, 85, 1,"龙之蓄力・象之防御", LightGreen);
	end
	--被动紫霞蓄力强化
	if PersonKF(id, 89) then
		WAR.Actup[id] = 2
		if isteam(id) then
			WAR.ZXXS[id] = 1 + math.modf(JY.Base["天书数量"]/7)
		elseif MPTX(id,14,2) or JXPD(id,19,1) then  --五岳紫霞蓄力强化
		    WAR.ZXXS[id] = 2 + math.modf(JY.Base["天书数量"]/7)
			WAR.ZXQJ[id] = (WAR.ZXQJ[id] or 0) + math.random(3)
		else
			WAR.ZXXS[id] = 3
		end
		CurIDTXDH(WAR.CurID, 85, 1,"紫霞蓄势・连绵不绝", Violet);
	end
	--标主蓄力必成功
	if id == 0  then
		WAR.Actup[id] = 2
	--密宗蓄力必成功
	elseif MPTX(id,6)  then
		WAR.Actup[id] = 2
	--NPC蓄力必成功
	elseif not isteam(id) then
		WAR.Actup[id] = 2
	--我方，赵敏在场必成功
	elseif ZDGH(WAR.CurID,609) then
		WAR.Actup[id] = 2
	elseif PersonKF(id, 102) then
		WAR.Actup[id] = 2;
		if WAR.Defup[id] == nil then
			War_DefupMenu()
		end
	--常态70%几率成功
	elseif JLSD(15, 85, id) then
		WAR.Actup[id] = 2
	end
	if WAR.Actup[id] ~= 2 then
		for i = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			DrawStrBox(-1, -1, "蓄力失败", C_GOLD, CC.DefaultFont)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	else
		CurIDTXDH(WAR.CurID, 85, 1,"蓄力成功", C_GOLD);
		lib.Delay(CC.BattleDelay)
		--背嵬军武穆
		if MPTX(id,23,3) and Curr_NG(id,199) and WAR.YSJG < 10 then
			WAR.Actup[id] = 2
			WAR.YSJG = WAR.YSJG + 1
			CurIDTXDH(WAR.CurID, 7,1,"屈身守分・以待天时", LightSlateBlue);
		end
		--般若金刚
		if QFZH(id,189,91) then
			WAR.Actup[id] = 2
			WAR.PD['般若蓄力'][id] = 2
			CurIDTXDH(WAR.CurID, 173, 1,"慑伏外道・阿伐岂耶", Dark_Gold);
		    lib.Delay(CC.BattleDelay)
		end
		--胡刀三刀
		if PersonKF(id,67) and (Curr_QG(id,145) or (PersonKF(id,145) and TrueSD(id) >= 350) or match_ID(id,633) or JXPD(id,1,1)) then
			WAR.Actup[id] = 2
			local tsy = {'血玉碎牙','龙麟碎牙','金刚碎牙'}
			WAR.PD['铁碎牙'][id] = math.random(3)
			CurIDTXDH(WAR.CurID, 85, 1,"铁碎牙・变・"..tsy[WAR.PD['铁碎牙'][id]], LightGreen);
			lib.Delay(CC.BattleDelay)
		end	
		--长生组合
		if NGQH(id,203) or ((match_ID(id,505) or match_ID(id,578)) and Curr_NG(id,203)) then
			WAR.Actup[id] = 2
			if math.random(100) > 25 then
				WAR.PD['神兵'][id] = (WAR.PD['神兵'][id] or 0) + 15
				if JLSD(10,30,id) then
					WAR.PD['战神状态'][id] = (WAR.PD['战神状态'][id] or 0) + 10
				end
			end
			CurIDTXDH(WAR.CurID,218, 1,"长生・天人・势", Violet);
			lib.Delay(CC.BattleDelay)
		end
	end
	return 1
end

--战斗防御
function War_DefupMenu()
	local p = WAR.CurID
	local id = WAR.Person[p]["人物编号"]
	local x0, y0 = WAR.Person[p]["坐标X"], WAR.Person[p]["坐标Y"]
	if JY.Person[id]['生命'] <= 0 then
		return 1
	end	
	WAR.Defup[id] = 1
	Cls()
	--local hb = GetS(JY.SubScene, x0, y0, 4)
	local dh = 86
	local str = "防御开始" 
	local color = LimeGreen
	--太玄防御带蓄力
	if PersonKF(id, 102) then
		if WAR.Actup[id] == nil then
			War_ActupMenu()
		end	
		str = "防御开始・太玄蓄力"
		color = C_RED
		CurIDTXDH(WAR.CurID, dh,1,str, color);
		lib.Delay(CC.BattleDelay)
	end
	if WAR.Defup[id] ~= nil and WAR.Defup[id] == 1 then
		CurIDTXDH(WAR.CurID, 86, 1,"防御成功", C_GOLD);
		lib.Delay(CC.BattleDelay)
		--般若金刚
		if QFZH(id,189,91) then
			if WAR.Defup[id] ~= nil then
				str = "无相般若・忘怀绝相"
				WAR.PD['般若防御'][id] = 2
				color = Dark_Gold
				CurIDTXDH(WAR.CurID, 196,1,str, color);
				lib.Delay(CC.BattleDelay)
			end
		end
		--胡刀三刀
		if PersonKF(id,67) and (Curr_QG(id,145) or (PersonKF(id,145) and TrueSD(id) >= 350) or match_ID(id,633) or JXPD(id,1,1)) then
			str = "胡刀三变・丛云牙"
			color = Violet
			CurIDTXDH(WAR.CurID, dh,1,str, color);
			lib.Delay(CC.BattleDelay)
		end
		--长生组合
		if NGQH(id,203) or ((match_ID(id,505) or match_ID(id,578)) and Curr_NG(id,203)) then
			WAR.PD['坚甲状态'][id] = (WAR.PD['坚甲状态'][id] or 0) + 15
			WAR.PD['虚弱状态'][id] = nil
			WAR.PD['脆弱状态'][id] = nil
			if JLSD(10,30,id) and WAR.BTZT[id] == nil then
				WAR.BTZT[id] = 1
			end
			str = "长生・天人・御"
			color = C_GOLD
			CurIDTXDH(WAR.CurID,dh,1,str, color);
			lib.Delay(CC.BattleDelay)
		end
	end
	return 1
end

--设置人物的集气值，返回一个综合值以便循环刷新集气条
function GetJiqi()
	local num, total = 0, 0
	--无酒不欢：轻功对于人物集气的影响函数
	local function getnewmove(x)
		if x <= 0 then 
			return 0
		end
		return math.sqrt(x/7)
		--[[
		if x > 160 then
			return 6 + (x - 160) / 60
		elseif x > 80 then
			return 4 + (x - 80) / 40
		elseif x > 30 then
			return 2 + (x - 30) / 25
		else
			return x / 15
		end
		]]
	end
	--无酒不欢：内力对于人物集气的影响函数
	local function getnewmove1(a, b)
		local x = (a*2+b)/3
		if x > 6000 then
			return 7
		elseif x > 4000 then
			return 5
		elseif x > 2000 then
			return 4
		elseif x > 1000 then
			return 3
		else
			return 2
		end
	end
	--无酒不欢：敌人集气随难度变化
	local function NPCjiqimod(nd)
		local x;
		if nd == 1 then
			return 1.0
		elseif nd == 2 then
			return 2.0
		elseif nd == 3 then
			return 3.0
		elseif nd == 4 then
			return 4.0
		end
	end
	local dgqb = {}			--记录独孤求败的数据
	local max_jq = 0		--记录全场最高集气	
	for i = 0, WAR.PersonNum - 1 do
		if not WAR.Person[i]["死亡"] then
			local id = WAR.Person[i]["人物编号"]
		    WAR.Person[i].TimeAdd = (getnewmove(Qg(i)) + getnewmove1(JY.Person[id]["内力"], JY.Person[id]["内力最大值"]) + JY.Person[id]["体力"]/20)
			if not isteam(id) then
				local nd = JY.Base["难度"] 
				local zm = JY.Base["周目"]
				WAR.Person[i].TimeAdd = math.modf(WAR.Person[i].TimeAdd*(1+nd*zm*0.002))
			end
			WAR.Person[i].TimeAdd = math.modf(WAR.Person[i].TimeAdd)
			local pd = true
			for j = 0, WAR.PersonNum-1 do
				if match_ID(WAR.Person[j]['人物编号'],517) and DWPD(i,j) then
					pd = false
					break
				end
			end
			--蛇行狸翻高阶效果
			if QGQH(id,224,2) and WAR.ZYHB ~= 1 and pd == true then	
				local aa = 45
				local timechange = WAR.Person[i]["Time"]
				local victim = -1
				if JLSD(10, aa, id)	then
					for j = 0,WAR.PersonNum -1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == false then
							if WAR.Person[j]["Time"] > timechange then
								timechange = WAR.Person[j]["Time"]
								victim = j
							end
						end
					end	
					if victim ~= -1 then
						WAR.Person[i]["Time"] = timechange
						if  Curr_NG(id,107) and JLSD(10,55,id) then
							WAR.Person[victim]["Time"] = WAR.Person[i]["Time"]
							ShowScreen();
							lib.Delay(40)
							for i = 12,24 do
								NewDrawString(-1,-1,"蛇行狸翻・应龙行暗",C_GOLD,25+i)
								ShowScreen();
								if i==24 then
									Cls();							
									NewDrawString(-1,-1,"蛇行狸翻・应龙行暗",C_GOLD,25+i)
									ShowScreen();
									lib.Delay(500);
								else
									lib.Delay(1);
								end						
							end
						elseif Curr_NG(id,104) and JLSD(10,50,id) then
							nuqi(id,100)
							ShowScreen();
							lib.Delay(40)
							for i = 12,24 do
								NewDrawString(-1,-1,"蛇行狸翻・螭龙道幻",C_GOLD,25+i)
								ShowScreen();
								if i==24 then
									Cls();							
									NewDrawString(-1,-1,"蛇行狸翻・螭龙道幻",C_GOLD,25+i)
									ShowScreen();
									lib.Delay(500);
								else
									lib.Delay(1);
								end						
							end
						else											                                
							ShowScreen();
							lib.Delay(40)
							for i = 12,24 do
								NewDrawString(-1,-1,"蛇行狸翻・迅蟒周衍",C_GOLD,25+i)
								ShowScreen();
								if i==24 then
									Cls();							
									NewDrawString(-1,-1,"蛇行狸翻・迅蟒周衍",C_GOLD,25+i)
									ShowScreen();
									lib.Delay(500);
								else
									lib.Delay(1);
								end						
							end
						end	
					end
				end	
			end
			--东方消耗葵花护盾移形换影
			if PersonKF(id, 105) and (JXPD(id,27,1) or match_ID(id,777)) and WAR.ZYHB ~= 1 and pd == true then
				local aa = 50
				local timechange = WAR.Person[i]["Time"]
				local victim = -1
				if JLSD(20, aa, id)	then
					for j = 0,WAR.PersonNum -1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == false then
							if WAR.Person[j]["Time"] > timechange then
								timechange = WAR.Person[j]["Time"]
								victim = j
						    end
					    end	
					end
					if victim ~= -1 then
						WAR.Person[i]["Time"] = timechange
						if WAR.PD['葵花护盾'][id] ~= nil and WAR.PD['葵花护盾'][id] > 0 then
							WAR.Person[victim]["Time"] = 0
							WAR.PD['葵花护盾'][id] = WAR.PD['葵花护盾'][id] -1
							if WAR.PD['葵花护盾'][id] == 0 then 
								WAR.PD['葵花护盾'][id] = nil
							end
							Cat('护盾停止',victim)
						end
						ShowScreen();
						lib.Delay(40)
						for i = 12,24 do
							NewDrawString(-1,-1,"葵花身法・移形换影",C_GOLD,25+i)
							ShowScreen();
							if i==24 then
								Cls();							
								NewDrawString(-1,-1,"葵花身法・移形换影",C_GOLD,25+i)
								ShowScreen();
								lib.Delay(500);
							else
								lib.Delay(1);
							end
						end
					end
				end
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------轻内影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			--葵花神功被动，集气+3
			--萧半和觉醒
			if PersonKF(id,105) or (JXPD(id, 189, 1)) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 3
			end
			--玉女心经被动，集气+3
			if PersonKF(id,154) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 3
			end	
			--玄武真功
			if PersonKF(id,315) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
			end
			--主运太极神功，太极之形增加集气
			if Curr_NG(id, 171) and WAR.TJZX[id] ~= nil then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + WAR.TJZX[id]
			end	
			--主运飞天，集气+5 标记修改	
			if Curr_QG(id,145) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 5
			end
			--霹雳身法
			if Curr_QG(id,373) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 20
			end
			--踏雪无痕的额外集气速度增加
			if Curr_QG(id,277) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6
			end	
			--花间游
			if Curr_QG(id,286) then
				local jx = {25,18,12,7,4,2,1,0}
				local jsjx = jx[JY.Person[id]['畅想分阶']+1]
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + jsjx
			end
			--流云逐月
			if Curr_QG(id,290) then
				local jq = WAR.Person[i].TimeAdd
				for ly = 0 , WAR.PersonNum - 1 do
					if WAR.Person[ly].TimeAdd > jq then
						jq = WAR.Person[ly].TimeAdd
					end	
				end
				if jq >  WAR.Person[i].TimeAdd then
					if QGQH(id,290,2) then
						WAR.Person[i].TimeAdd = (WAR.Person[i].TimeAdd or 0) + 30
					else
						WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) +15,0,120)
					end	
				end	
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------组合影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			--初生牛犊
		    if match_ID(id,9743) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6
			end
			--岳王散手		
		     if PersonKF(id,198) and PersonKF(id,199) then 
				local a = math.modf(TrueZF(id) * 0.02)
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + a
			end
			--八荒六阳
			if (PersonKF(id,8) and PersonKF(id,101)) or match_ID(id,117) or match_ID(id,634) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.modf(JY.Person[id]["内力"] * 0.003);	
			end
			--紫霞修罗刀
			if PersonKF(id,58) and (PersonKF(id,89) or PersonKF(id,160)) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
			end	
			--九阴太极
            if NGQH(id,107) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.modf(Qg(i) *0.005)
			end				
			--长春北冥
			if NGQH(id,183) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
			end
			--鲸息九阴
			if NGQH(id,180) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.modf(JY.Person[id]["内力"] * 0.002);	
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------战场影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			--打狗阵
	        if (WAR.ZDDH == 344 or WAR.ZDDH == 84) and isteam(id) == false then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
            end	
			--蓝烟清：真武七截阵
			if (id == 532 or id == 533 or id == 534 or id == 535 or id == 536 or id == 537 or id == 538) and WAR.Person[i]["我方"] == false then
			    local s = 0
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["死亡"] == false and (WAR.Person[j]["人物编号"] == 538 or WAR.Person[j]["人物编号"] == 533 or WAR.Person[j]["人物编号"] == 534 or WAR.Person[j]["人物编号"] ==535 or WAR.Person[j]["人物编号"] == 536 or WAR.Person[j]["人物编号"] == 537 or WAR.Person[j]["人物编号"] == 538) then
                        s = s + 1
                    end
                end
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 7 * s
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------个人影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			--胡斐，乔峰，集气+10
			if match_ID(id, 1) or match_ID(id, 50) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
			end
			--崆峒三老
			if match_ID(id,8) or match_ID(id,166) or match_ID(id,167) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 35   
			end
			--东方不败，集气+6
			if match_ID(id, 27) or match_ID(id, 777) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6
			end
			--酒神喝酒
			if WAR.PD['八酒杯'][id] ~= nil then 
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + WAR.PD['八酒杯'][id] * 3
			end
			--韦一笑，成昆，黄药师
			if match_ID(id, 14) or match_ID(id, 18) or match_ID(id, 57)  then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
			end
			--一灯，重生后额外集气速度+5
			if (match_ID(id, 65) or match_ID(id, 129)) and WAR.FUHUOZT[id] ~= nil then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 5
			end
			--斗气
			if match_ID(id,767) or match_ID(id,768) or match_ID(id,769) or match_ID(id,770) then 
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 13
			end
			--李文秀，每个奇门到极，+2集气
			if match_ID(id, 590) then
				local lwx = 0
				for i = 1, JY.Base["武功数量"] do
					if JY.Wugong[JY.Person[id]["武功" .. i]]["武功类型"] == 5 and JY.Person[id]["武功等级" .. i] == 999 then
						lwx = lwx + 1
					end
				end
				if lwx > 7 then
					lwx = 7
				end
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.modf(lwx*5)
			end
			--公孙止，我方每死亡一个人，集气速度+6
			if match_ID(id, 616) then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == true and WAR.Person[j]["我方"] == WAR.Person[i]["我方"] then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6
					end
				end
			end
			--司空摘星，敌方人越多集气速度越快
			if match_ID(id, 579) then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 5
					end
				end
			end
			--白秀全场集气-5
			for j = 0, WAR.PersonNum - 1 do
				if match_ID(WAR.Person[j]["人物编号"], 582) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 5
					break	
				end
			end
			--谢烟客全场集气-10
			for j = 0, WAR.PersonNum - 1 do
				if match_ID(WAR.Person[j]["人物编号"], 164) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 10
					break	
				end
			end
			--丁不三 丁不四
			local bsbs = 0
				for j = 0, WAR.PersonNum - 1 do
					if match_ID(WAR.Person[j]["人物编号"], 162) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 3
						bsbs = bsbs + 1	
					end
					if match_ID(WAR.Person[j]["人物编号"], 163) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 4
						bsbs = bsbs + 1
					end
				if bsbs > 1 then
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 10		
				end
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------天赋影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			--马踏飞燕
			if match_ID(id, 515) or match_ID(id, 9736) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 5
			end
			--平一指，集气速度额外加成5*杀人数
			if match_ID(id, 28) or match_ID(id,9889) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + WAR.PYZ * 5
			end
			--不归三境第一境，每行动一次，集气速度加二
			if match_ID(id,9739) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + WAR.BGSJ
	        end
			--怒海狂涛
			if match_ID(id,9726) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
	        end
			--万里独行 人越少集气越快
			if match_ID(id, 9962) or match_ID(id, 29) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 20
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[i]["我方"] then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 4
					end
				end
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------门派影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------		
			--古墓基础集气速度
			if MPTX(id,3) then 
				local mpdj = MPDJ(id)
				if match_ID(id,605) then
					mpdj = 3
				end	
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + (5*mpdj)
				if (MPTX(id,3,2) and PersonKF(id,148)) or match_ID(id,59) or match_ID(id,605) then
					WAR.Person[i].TimeAdd = math.modf(WAR.Person[i].TimeAdd+mpdj*Qg(i)/200)	
				end	
			end
            --逍遥派基础集气速度
			if MPTX(id,7) then 
				local mpdj = MPDJ(id)
				if match_ID(id,634) then
					mpdj = 5
				end
				if match_ID(id,116) or match_ID(id,117) or match_ID(id,118) then
					mpdj = 4
				end		
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 2*mpdj
				if PersonKF(id,147) then 
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.modf(Qg(i)/200) + math.modf(JY.Person[id]["内力最大值"]/1000);
				end
				--逍遥派1级
				if MPTX(id,7) then
					if Curr_NG(id,85) or XiaoYaoYF(id) then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6;	
					end
					if Curr_NG(id,101) or XiaoYaoYF(id) then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6;	
					end
					if Curr_NG(id,183) or XiaoYaoYF(id) then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6;	
					end
					if Curr_NG(id,98) or XiaoYaoYF(id) then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 6;	
					end	
				end	
			end
			--白驼山基础集气速度
			if MPTX(id,8) then 
				local mpdj = MPDJ(id)
				if match_ID(id,60) then
					mpdj = 3
				end	
			    WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.modf(JY.Person[id]["中毒程度"]/20*mpdj);
			end
			--桃花岛基础集气速度
			if MPTX(id,10) then 
				local mpdj = MPDJ(id)
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 5
				if MPTX(id,10,2) and PersonKF(id,237) then
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + mpdj*2
				end
			end
			--明教圣火阵
            if MPTX(id,13) then 
				local shz = 0
				local xg = MPDJ(id)
				for j = 0, WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[i]["我方"] and MPTX(tmppid,13) and tmppid ~= id then
						shz = shz + 1
					end
				end
				if shz > 6 then
					shz = 6
				end		
				if shz > 1 then
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + shz * xg
				end
			end	
			--大理基础集气速度
			if MPTX(id,15) then 
			    WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 5;
			end
			--全真基础集气速度
			if MPTX(id,16) then 
				local mpdj = MPDJ(id)
				if match_ID(id,129) then
					mpdj = 5
				end
				if match_ID(id,64) then
					mpdj = 4
				end		
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + JY.Person[id]["生命增长"]+mpdj;
			end
			--峨眉
			if MPTX(id,17) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 12
			end
			--崆峒
			if MPTX(id,18) then
				local a = math.modf(TrueQZ(id)/50)
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + a   
			end
			--昆仑
			if MPTX(id,19) then
				local a = math.modf(TrueYJ(id)/100)
				local b = math.modf(TrueSD(id)/100)
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + a + b    
			end
			--雪羽宗
			if MPTX(id,20) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 8
			end
			--花涧派
			if MPTX(id,21) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 20
			end
			--护龙山庄
			if MPTX(id,25) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10
			end
            --云梦涧
			if MPTX(id,26) then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 12
			end
			--青城
			if MPTX(id,28) then
				local a = JY.Person[id]["内力"]/400
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + a
			end
			--天机宫
			if MPTX(id,30) then
				local a = math.modf(TrueQZ(id)/120)
				local b = math.modf(TrueYJ(id)/120)
				local c = math.modf(TrueSD(id)/120)
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + a + b + c   
			end
			--坐骑
			local zqjq_jc = 0
			if JY.Person[id]["坐骑"] > 0 then
				if JY.Person[id]["坐骑"] == 230 then
				    zqjq_jc = 2
				    if JY.Thing[230]["装备等级"] >= 5 then
					    zqjq_jc = 4
				    elseif JY.Thing[230]["装备等级"] >= 3 then
					    zqjq_jc = 3
					end
					--李文秀的效果翻倍
					if match_ID(id, 590) then
						zqjq_jc = 8
					end
				end
				--装备毛驴 集气速度+10点
				if JY.Person[id]["坐骑"] == 279 then
					--WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 10;
					zqjq_jc = 10
				end
				--装备飞云 集气速度+10点
				if JY.Person[id]["坐骑"] == 264 then
					--WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 12;
					zqjq_jc = 12
				end			
				--装备青驴 集气速度+5点
				if JY.Person[id]["坐骑"] == 339 then
					--WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 5;
					zqjq_jc = 5
				end
				--装备汗血宝马 集气速度+5点
				if JY.Person[id]["坐骑"] == 262 then
					--WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 8;
					zqjq_jc = 8
				end			
				--瘦黄马，血量越低集气越快，50%血+5，0血+10
				if JY.Person[id]["坐骑"] == 284 and JY.Thing[284]["装备等级"] == 6 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"]/2 then
					local spd_add = 5;
					spd_add = spd_add + math.floor(JY.Person[id]["生命最大值"]/2 - JY.Person[id]["生命"]/100)
					--WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + spd_add;
					zqjq_jc = spd_add
				end	
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + zqjq_jc
				--聂风
				if match_ID(id, 546) or match_ID(id, 9911) then
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + zqjq_jc
				end
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------buff影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			--氤氤氲氲
	        if PersonKF(id,78) and Curr_QG(id,148) and PersonKF(id,148) and (WAR.PD['氤氤氲氲'][id] or 0) >= 0 then
				local jq = (WAR.PD['氤氤氲氲'][id] or 0)/10
		        WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.modf(jq)
	        end
			--畅想花铁杆，每行动一次，集气速度加一
			if id == 0 and JY.Base["畅想"] == 52 then
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd+WAR.HTG
	        end
            --剑神，每个剑法到极，+5集气
			if actor(id,3) then
				local jsyx = 0
				for i = 1, JY.Base["武功数量"] do
					if JY.Wugong[JY.Person[id]["武功"..i]]["武功类型"] == 3 and JY.Person[id]["武功等级" .. i] == 999 then
						jsyx = jsyx + 1
					end
				end
				if jsyx > 7 then
					jsyx = 7
				end
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + jsyx * 5
			end
			--苍狼步
			if id == 0 and JY.Base["标准"] > 0 and WAR.CLB > 0	then
				if WAR.CLB > 50 then
					WAR.CLB = 50
				end
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + WAR.CLB
			end
			--隼龙令
			if id == 0 and WAR.SLB > 0	then
				if WAR.SLB > 50 then
					WAR.SLB = 50
				end
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + WAR.SLB
			end
			--山洞妹妹给主角+2集气
			if id == 0 then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["人物编号"] == 92 and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[i]["我方"] then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 2
						break
					end
				end
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------结界影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			--周公剑意
			for j = 0, WAR.PersonNum-1 do 
				local df = WAR.Person[j]["人物编号"] 			
				if WAR.PD['周公剑意'][df] ~= nil and WAR.PD['周公剑意'][df] > 0 then
					if WAR.Person[j]["死亡"] == false then
						if WAR.Person[j]["我方"] == WAR.Person[i]["我方"] then
							WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 2*WAR.PD['周公剑意'][df]
						else
						    WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 2*WAR.PD['周公剑意'][df]
							break
						end
					end
				end	
			end
			--般若集中敌方集气概率暂停
			for j = 0, WAR.PersonNum-1 do 
				local df = WAR.Person[j]["人物编号"]
				if WAR.PD["般若集中"][df] ~= nil then		
					if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false  then
						WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - math.random(20,40)
						break
					end
				end	
			end
			--金关领悟 杀意波动
			for j = 0, WAR.PersonNum - 1 do 
				local df = WAR.Person[j]["人物编号"] 			
				local offset1 = math.abs(WAR.Person[i]["坐标X"] - WAR.Person[j]["坐标X"]) 
				local offset2 = math.abs(WAR.Person[i]["坐标Y"] - WAR.Person[j]["坐标Y"])
				local offset=offset1+offset2
				if ((NGQH(df,249) and PersonKF(df,190)) or match_ID(df,64)) and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
					local xn = math.modf((JY.Person[df]["内力"])/300)
					if xn < 10 then
						xn = 10
					end
					if offset1 <= 10 and offset2 <= 10 then
						xn = math.modf(xn*(2-offset/15))
					end
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - xn
					break	
				end	
			end
			----------------------------------------------------------------------------------------------------
			-------------------------------------通用影响集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			if JY.Person[id]["轻功"] > 200 and JY.Person[id]["主运轻功"] > 0 then
				local jq = math.modf(JY.Person[id]["轻功"]/200)
				if jq > 5 then jq = 5 end
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + jq
				if JY.Person[id]["主运轻功"] == JY.Person[id]["天赋轻功"] then
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 3
				end
			end
			if WAR.PD['徐如林'][id] ~= nil then 
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + WAR.PD['徐如林'][id]
			end	
			if WAR.PD['集气速度'][id] ~= nil and WAR.PD['集气速度'][id] ~= 0 then
				if QGQH(id,186,1) and WAR.PD['集气速度'][id] < 0 then WAR.PD['集气速度'][id] = 0 end
				if WAR.PD['集气速度'][id] > 60 then WAR.PD['集气速度'][id] = 60 end
				local n = WAR.PD['集气速度'][id]
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + n
			end
			--阿紫曼珠沙华，血量越低集气越快，100%血无加成，0血100%加成
			if WAR.JYZT[id] ~= nil then
				local bonus_perctge = 0
				bonus_perctge = 1 - JY.Person[id]["生命"] / JY.Person[id]["生命最大值"]
				WAR.Person[i].TimeAdd = math.modf(WAR.Person[i].TimeAdd * bonus_perctge)
			end
			--蓝烟清：天罡北斗阵
			if (id == 68 or id == 123 or id == 124 or id == 125 or id == 126 or id == 127 or id == 128) and WAR.Person[i]["我方"] == false then
			    local s = 0
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["死亡"] == false and (WAR.Person[j]["人物编号"] == 68 or WAR.Person[j]["人物编号"] == 123 or WAR.Person[j]["人物编号"] == 124 or WAR.Person[j]["人物编号"] ==125 or WAR.Person[j]["人物编号"] == 126 or WAR.Person[j]["人物编号"] == 127 or WAR.Person[j]["人物编号"] == 128) then
                        s = s + 1
                    end
                end
				WAR.Person[i].TimeAdd = math.modf(WAR.Person[i].TimeAdd * (1+s/7))
			end
			if WAR.Person[i].TimeAdd < 0 then
				WAR.Person[i].TimeAdd = 0
			end
		    ----------------------------------------------------------------------------------------------------
			-------------------------------------特殊角色集气速度-----------------------------------------------
			----------------------------------------------------------------------------------------------------
			if max_jq < WAR.Person[i].TimeAdd then
				max_jq = WAR.Person[i].TimeAdd
			end
	        --独孤求败
          	if match_ID(id, 592) or JY.Person[id]["坐骑"] == 312 then
				dgqb = {i, WAR.Person[i].TimeAdd}
			end
			-----------------------------------奇穴集气效果---------------------------------------			
			
			num = num + 1
			total = total + WAR.Person[i].TimeAdd
		end
	end
  	--独孤求败集气锁定全场最高
	if dgqb[1] then
		if dgqb[2] < max_jq then
			total = total - WAR.Person[dgqb[1]].TimeAdd + max_jq + 1
			WAR.Person[dgqb[1]].TimeAdd = max_jq + 1
		end
	end
	--无酒不欢：这个返回值表达不明确，存疑
	WAR.LifeNum = num
	return math.modf(((total) / (num) + (num) - 2))
end


--武功范围选择
function War_KfMove(movefanwei, atkfanwei,wugong)
    local kind = movefanwei[1] or 0
    local len = movefanwei[2] or 0
    local x0 = WAR.Person[WAR.CurID]["坐标X"]
    local y0 = WAR.Person[WAR.CurID]["坐标Y"]
    local x = x0
    local y = y0
	local flag = 1 
	if freefight(WAR.Person[WAR.CurID]["人物编号"]) then      --逍遥派无视障碍物
	    flag = 2
    end
    if kind ~= nil then
        if kind == 0 then
            War_CalMoveStep(WAR.CurID, len, flag)
	    elseif kind == 1 then
	        War_CalMoveStep(WAR.CurID, len * 2, flag)
	        for r = 1, len * 2 do
	            for i = 0, r do
	                local j = r - i
	                if len < i or len < j then
	                    SetWarMap(x0 + i, y0 + j, 3, 255)
	                    SetWarMap(x0 + i, y0 - j, 3, 255)
	                    SetWarMap(x0 - i, y0 + j, 3, 255)
	                    SetWarMap(x0 - i, y0 - j, 3, 255)
	                end
	            end
	        end
	    elseif kind == 2 then
	        War_CalMoveStep(WAR.CurID, len, flag)
	        for i = 1, len - 1 do
	            for j = 1, len - 1 do
	                SetWarMap(x0 + i, y0 + j, 3, 255)
	                SetWarMap(x0 - i, y0 + j, 3, 255)
	                SetWarMap(x0 + i, y0 - j, 3, 255)
	                SetWarMap(x0 - i, y0 - j, 3, 255)
	            end
	        end
	    elseif kind == 3 then
	        War_CalMoveStep(WAR.CurID, 2, flag)
	        SetWarMap(x0 + 2, y0, 3, 255)
	        SetWarMap(x0 - 2, y0, 3, 255)
	        SetWarMap(x0, y0 + 2, 3, 255)
	        SetWarMap(x0, y0 - 2, 3, 255)
	    else
	        War_CalMoveStep(WAR.CurID, 0, flag)
	    end
    end
  
  CleanWarMap(7, 0)
  
  while true do
	if JY.Restart == 1 then
		break
	end
    local x2 = x
    local y2 = y
	Cat('实时特效动画')
    WarDrawMap(1, x, y)
	if wugong == 26 then
		WarDrawAtt(x, y, atkfanwei, 4, nil, nil, nil, 1)
	else
		WarDrawAtt(x, y, atkfanwei, 4)
	end
    --判断合击，判断是否有合击者
	local x0 = WAR.Person[WAR.CurID]["坐标X"]
	local y0 = WAR.Person[WAR.CurID]["坐标Y"]
	local ZHEN_ID = -1;
	for i = 0, WAR.PersonNum - 1 do
		local tid = WAR.Person[i]["人物编号"]
		if WAR.Person[WAR.CurID]["我方"] == WAR.Person[i]["我方"] and i ~= WAR.CurID and WAR.Person[i]["死亡"] == false then
			local nx = WAR.Person[i]["坐标X"]
			local ny = WAR.Person[i]["坐标Y"]
			local fid = WAR.Person[i]["人物编号"]
			local heji = 0
			for j = 1, JY.Base["武功数量"] do
				for j = 1, CC.Kungfunum do
					if JY.Person[fid]["武功" .. j] == wugong then         
						if math.abs(nx-x0)+math.abs(ny-y0)<9 then
							local flagx, flagy = 0, 0
							if math.abs(nx - x0) <= 1 then
								flagx = 1
							end
							if math.abs(ny - y0) <= 1 then
								flagy = 1
							end
							if x0 == nx then
								flagy = 1
							end
							if y0 == ny then
								flagx = 1
							end
							if (between(x, x0, nx, flagx) and between(y, y0, ny, flagy)) then
								--合击人的战场编号
								ZHEN_ID = i
								--绘画合击的范围
								local tmp_id = WAR.CurID
								WAR.CurID = ZHEN_ID
								WarDrawAtt(WAR.Person[ZHEN_ID]["坐标X"] + x0 - x, WAR.Person[ZHEN_ID]["坐标Y"] + y0 - y, atkfanwei, 4)
								SetWarMap(nx,ny,7,3)
								WAR.CurID = tmp_id
								break;
							end
						end
					end
				end
			end
			if ZHEN_ID >= 0 then
				break;
			end
		end
		--and match_ID(WAR.Person[i]["人物编号"],0)
		---if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and match_ID(WAR.Person[i]["人物编号"],27) then
		    --ZHEN_ID = i
		   --WAR.DUIZHAO = 1
			--WAR.KHCM[WAR.Person[i]["人物编号"]] = (WAR.KHCM[WAR.Person[i]["人物编号"]] or 0) + 30
			--say("对招3 |"..WAR.Person[i]["人物编号"],0,1)
			--WAR.PD["冰冻状态"][WAR.Person[i]["人物编号"]] = (WAR.PD["冰冻状态"][WAR.Person[i]["人物编号"]] or 0)+20
			--break
		--end
		--[[if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and match_ID(WAR.Person[i]["人物编号"],50) then
		    ZHEN_ID = i
		    --WAR.DUIZHAO = 2
		   break
		end
		if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and match_ID(WAR.Person[i]["人物编号"],5) then
		    ZHEN_ID = i
		   -- WAR.DUIZHAO = 3
		   break
		end
		if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and i ~= WAR.CurID and WAR.Person[i]["死亡"] == false  and match_ID(WAR.Person[i]["人物编号"],114) then
		    ZHEN_ID = i
		   -- WAR.DUIZHAO = 4
		   break
		end
		if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and i ~= WAR.CurID and WAR.Person[i]["死亡"] == false and (Curr_NG(WAR.Person[i]["人物编号"],43) and PersonKF(WAR.Person[i]["人物编号"],171)) then
		    ZHEN_ID = i
		    --WAR.DUIZHAO = 5
		    break
		end]]
	end
    
	WarDrawMap(1, x, y)
	WarShowHead(GetWarMap(x, y, 2))
	
	--合击人标识
	if ZHEN_ID ~= -1 then
		local nx = WAR.Person[ZHEN_ID]["坐标X"]
		local ny = WAR.Person[ZHEN_ID]["坐标Y"]
		local dx = nx - x0
		local dy = ny - y0
		local size = CC.FontSmall;
		local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)
		local str = ""
		if WAR.Person[ZHEN_ID]["我方"] == WAR.Person[WAR.CurID]["我方"] then
			str = "合击者"
		end	
		DrawString(rx - size*1.5, ry-hb-size/2, str, M_DeepSkyBlue, size*1.5);
	end
	
	--显示可以覆盖的敌人信息
	for i = 0, CC.WarWidth - 1 do
		for j = 0, CC.WarHeight - 1 do
			local target = GetWarMap(i, j, 7)
			if target ~= nil and target == 2 then
				if GetWarMap(i, j, 2) ~= nil and WAR.Person[GetWarMap(i, j, 2)]["人物编号"] ~= nil then
					local x0 = WAR.Person[WAR.CurID]["坐标X"];
					local y0 = WAR.Person[WAR.CurID]["坐标Y"];
					local dx = i - x0
					local dy = j - y0
					local size = CC.FontSmall;
					local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
					local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
					
					local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)

					ry = ry - hb - CC.ScreenH/6;
							
					if ry < 1 then			--加上这个，防止看不到血的情况
						ry = 1;
					end
					
					--显示选中人物的生命值
					local color = RGB(245, 251, 5);
					local hp = JY.Person[WAR.Person[GetWarMap(i, j, 2)]["人物编号"]]["生命"] or 0;
					local maxhp = JY.Person[WAR.Person[GetWarMap(i, j, 2)]["人物编号"]]["生命最大值"] or 0;
					
					local ns = JY.Person[WAR.Person[GetWarMap(i, j, 2)]["人物编号"]]["受伤程度"] or 0;
					local zd = JY.Person[WAR.Person[GetWarMap(i, j, 2)]["人物编号"]]["中毒程度"] or 0;
					local len = #(string.format("%d/%d",hp,maxhp));
					rx = rx - len*size/4;
					
					--颜色根据所受的内伤确定
					if ns < 33 then
						color = RGB(236, 200, 40)
					elseif ns < 66 then
						color = RGB(244, 128, 32)
					else
						color = RGB(232, 32, 44)
					end
					
					DrawString(rx, ry, string.format("%d",hp), color, size);
					DrawString(rx + #string.format("%d",hp)*size/2, ry, "/", C_GOLD, size);
					
					if zd == 0 then
						color = RGB(252, 148, 16)
					elseif zd < 50 then
						color = RGB(120, 208, 88)
					else
						color = RGB(56, 136, 36)
					end
					DrawString(rx + #string.format("%d",hp)*size/2 + size/2 , ry, string.format("%d", maxhp), color, size)
					-------------------对招-----------------------
					if WAR.Person[GetWarMap(i, j, 2)]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and GetWarMap(i, j, 2) ~= WAR.CurID and WAR.Person[GetWarMap(i, j, 2)]["死亡"] == false then
						local dzid = WAR.Person[GetWarMap(i, j, 2)]["人物编号"]
						if (dzid == 27 or (dzid == 0 and match_ID(dzid,27))) or (dzid == 777 or (dzid == 0 and match_ID(dzid,777))) then -- or dzid == 608
							ZHEN_ID = GetWarMap(i, j, 2)
							WAR.DUIZHAO = 1

						elseif dzid == 50 or (dzid == 0 and match_ID(dzid,50))  then
							ZHEN_ID = GetWarMap(i, j, 2)
							WAR.DUIZHAO = 2

						elseif dzid == 5 or (dzid == 0 and match_ID(dzid,5)) then
							ZHEN_ID = GetWarMap(i, j, 2)
							WAR.DUIZHAO = 3

						elseif dzid == 114 or (dzid == 0 and match_ID(dzid,114)) then
							ZHEN_ID = GetWarMap(i, j, 2)
							WAR.DUIZHAO = 4

						elseif psx(dzid,"门派技能3") == 2 or (dzid == 0 and psx(0,"门派技能3") == 2) then
							ZHEN_ID = GetWarMap(i, j, 2)
							WAR.DUIZHAO = 5

						elseif dzid == 520 or (dzid == 0 and match_ID(dzid,520)) then
							ZHEN_ID = GetWarMap(i, j, 2)
							WAR.DUIZHAO = 6

						end

						if ZHEN_ID ~= -1 then
							local nx = WAR.Person[ZHEN_ID]["坐标X"]
							local ny = WAR.Person[ZHEN_ID]["坐标Y"]
							local dx = nx - x0
							local dy = ny - y0
							local size = CC.FontSmall;
							local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
							local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2				
							local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)
							local str = ""
							if WAR.Person[ZHEN_ID]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
								str = "对招"
							end	
							DrawString(rx - size*1.5, ry-hb-size/2, str, M_DeepSkyBlue, size*1.5);
						end
						--[[if ZHEN_ID >= 0 then
							break;
						end]]
					end	
				end
			end
		end
	end
    
	
	
	Cat('实时特效动画2')
    ShowScreen()
	CleanWarMap(7, 0)
	lib.Delay(CC.BattleDelay)
    local key, ktype, mx, my = lib.GetKey()

    if key == VK_UP then
      y2 = y - 1
    elseif key == VK_DOWN then
      y2 = y + 1
    elseif key == VK_LEFT then
      x2 = x - 1
    elseif key == VK_RIGHT then
      x2 = x + 1
    elseif (key == VK_SPACE or key == VK_RETURN) then
      return x, y

    elseif key == VK_ESCAPE or ktype == 4 then
      return nil
    elseif ktype == 2 or ktype == 3 then
      mx = mx - CC.ScreenW / 2
      my = my - CC.ScreenH / 2
      mx = (mx) / CC.XScale
      my = (my) / CC.YScale
      mx, my = (mx + my) / 2, (my - mx) / 2
      if mx > 0 then
        mx = mx + 0.99
      else
        mx = mx - 0.01
      end
      if my > 0 then
        my = my + 0.99
      else
        mx = mx - 0.01
      end
      mx = math.modf(mx)
      my = math.modf(my)
      for i = 1, 20 do
        if mx + i > 63 or my + i > 63 then
           return;
        end
        local hb = GetS(JY.SubScene, mx + i, my + i, 4)

        if math.abs(hb - CC.YScale * i * 2) < 8 then
          mx = mx + i
          my = my + i
        end
      end
      
      x2, y2 = mx + x0, my + y0
	    if ktype == 3 and (kind < 2 or x ~= x0 or y ~= y0) then
	      return x, y					
	    end
	    
    end
    if x2 >= 0 and x2 < CC.WarWidth and y2 >= 0 and y2 < CC.WarHeight then
			if GetWarMap(x2, y2, 3) ~= nil and GetWarMap(x2, y2, 3) < 128 then
	      x = x2
	      y = y2
		  end
		end
		if ZHEN_ID ~= -1 then
			WAR.PD['同时出招'][WAR.Person[ZHEN_ID]['人物编号']] = ZHEN_ID
		end	
	end
end
--WarDrawAtt
--xl为降龙的范围显示
function WarDrawAtt(x, y, fanwei, flag, cx, cy, atk, xl)
  local x0, y0 = nil
  if cx == nil or cy == nil then
    x0 = WAR.Person[WAR.CurID]["坐标X"]
    y0 = WAR.Person[WAR.CurID]["坐标Y"]
  else
    x0, y0 = cx, cy
  end
  local kind = fanwei[1]			--攻击范围
  local len1 = fanwei[2]
  local len2 = fanwei[3]
  local len3 = fanwei[4]
  local len4 = fanwei[5]
  local xy = {}
  local num = 0
  if kind == 0 then
    num = 1
    xy[1] = {x, y}
  elseif kind == 1 then
    if not len1 then
      len1 = 0
    end
    if not len2 then
      len2 = 0
    end
    num = num + 1
    xy[num] = {x, y}
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      num = num + 4
    end
    for i = 1, len2 do
      xy[num + 1] = {x + i, y + i}
      xy[num + 2] = {x - i, y - i}
      xy[num + 3] = {x - i, y + i}
      xy[num + 4] = {x + i, y - i}
      num = num + 4
    end
  elseif kind == 2 then
    for tx = x - len1, x + len1 do
      for ty = y - len1, y + len1 do
        if len1 < math.abs(tx - x) + math.abs(ty - y) then
          
        else
        	num = num + 1
        	xy[num] = {tx, ty}
        end
        
      end
    end
  elseif kind == 3 then
    if not len2 then
      len2 = len1
    end
    local dx, dy = math.abs(x - x0), math.abs(y - y0)
    if dy < dx then
      len1, len2 = len2, len1
    end
    for tx = x - len1, x + len1 do
      for ty = y - len2, y + len2 do
        num = num + 1
        xy[num] = {tx, ty}
      end
    end
  elseif kind == 5 then
    if not len1 then
      len1 = 0
    end
    if not len2 then
      len2 = 0
    end
    num = num + 1
    xy[num] = {x, y}
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      num = num + 4
    end
    if len2 > 0 then
      xy[num + 1] = {x + 1, y + 1}
      xy[num + 2] = {x + 1, y - 1}
      xy[num + 3] = {x - 1, y + 1}
      xy[num + 4] = {x - 1, y - 1}
      num = num + 4
    end
    for i = 2, len2 do
      xy[num + 1] = {x + i, y + 1}
      xy[num + 2] = {x - i, y - 1}
      xy[num + 3] = {x - i, y + 1}
      xy[num + 4] = {x + i, y - 1}
      xy[num + 5] = {x + 1, y + i}
      xy[num + 6] = {x - 1, y - i}
      xy[num + 7] = {x - 1, y + i}
      xy[num + 8] = {x + 1, y - i}
      num = num + 8
    end
  elseif kind == 6 then
    if not len2 then
      len2 = len1
    end
    xy[1] = {x + 1, y}
    xy[2] = {x - 1, y}
    xy[3] = {x, y + 1}
    xy[4] = {x, y - 1}
    num = num + 4
    if len1 > 0 or len2 > 0 then
      xy[5] = {x + 1, y + 1}
      xy[6] = {x + 1, y - 1}
      xy[7] = {x - 1, y + 1}
      xy[8] = {x - 1, y - 1}
      num = num + 4
      for i = 2, len1 do
        xy[num + 1] = {x + i, y + 1}
        xy[num + 2] = {x - i, y + 1}
        xy[num + 3] = {x + i, y - 1}
        xy[num + 4] = {x - i, y - 1}
        num = num + 4
      end
      for i = 2, len2 do
        xy[num + 1] = {x + 1, y + i}
        xy[num + 2] = {x + 1, y - i}
        xy[num + 3] = {x - 1, y + i}
        xy[num + 4] = {x - 1, y - i}
        num = num + 4
      end
    end
 elseif kind == 7 then
    if not len2 then
      len2 = len1
    end
    if len1 == 0 then
      for i = y - len2, y + len2 do
        num = num + 1
        xy[num] = {x, i}
      end
    elseif len2 == 0 then
      for i = x - len1, x + len1 do
        num = num + 1
        xy[num] = {i, y}
      end
    else
      for i = x - len1, x + len1 do
        num = num + 1
        xy[num] = {i, y}
        num = num + 1
        xy[num] = {i, y + len2}
        num = num + 1
        xy[num] = {i, y - len2}
      end
      for i = 1, len2 - 1 do
        xy[num + 1] = {x, y + i}
        xy[num + 2] = {x, y - i}
        xy[num + 3] = {x - len1, y + i}
        xy[num + 4] = {x - len1, y - i}
        xy[num + 5] = {x + len1, y + i}
        xy[num + 6] = {x + len1, y - i}
        num = num + 6
      end
    end
  elseif kind == 8 then
    xy[1] = {x, y}
    num = 1
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      xy[num + 5] = {x + i, y + len1}
      xy[num + 6] = {x - i, y - len1}
      xy[num + 7] = {x + len1, y - i}
      xy[num + 8] = {x - len1, y + i}
      num = num + 8
    end
  elseif kind == 9 then
    xy[1] = {x, y}
    num = 1
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      xy[num + 5] = {x - i, y + len1}
      xy[num + 6] = {x + i, y - len1}
      xy[num + 7] = {x + len1, y + i}
      xy[num + 8] = {x - len1, y - i}
      num = num + 8
    end
  elseif x == x0 and y == y0 then
    return 0
  elseif kind == 10 then
    if not len2 then
      len2 = 0
    end
    if not len3 then
      len3 = 0
    end
    if not len4 then
      len4 = 0
    end
    local fx, fy = x - x0, y - y0
    if fx > 0 then
      fx = 1
    elseif fx < 0 then
      fx = -1
    end
    if fy > 0 then
      fy = 1
    elseif fy < 0 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    dx1 = -(dx1 + fx) / 2
    dx2 = -(dx2 + fx) / 2
    dy1 = -(dy1 + fy) / 2
    dy2 = -(dy2 + fy) / 2
    if dx1 > 0 then
      dx1 = 1
    elseif dx1 < 0 then
      dx1 = -1
    end
    if dx2 > 0 then
      dx2 = 1
    elseif dx2 < 0 then
      dx2 = -1
    end
    if dy1 > 0 then
      dy1 = 1
    elseif dy1 < 0 then
      dy1 = -1
    end
    if dy2 > 0 then
      dy2 = 1
    elseif dy2 < 0 then
      dy2 = -1
    end
    for i = 0, len1 - 1 do
      num = num + 1
      xy[num] = {x + i * fx, y + i * fy}
    end
    for i = 0, len2 - 1 do
      num = num + 1
      xy[num] = {x + dx1 + i * fx, y + dy1 + i * fy}
      num = num + 1
      xy[num] = {x + dx2 + i * fx, y + dy2 + i * fy}
    end
    for i = 0, len3 - 1 do
      num = num + 1
      xy[num] = {x + 2 * dx1 + i * fx, y + 2 * dy1 + i * fy}
      num = num + 1
      xy[num] = {x + 2 * dx2 + i * fx, y + 2 * dy2 + i * fy}
    end
    for i = 0, len4 - 1 do
      num = num + 1
      xy[num] = {x + 3 * dx1 + i * fx, y + 3 * dy1 + i * fy}
      num = num + 1
      xy[num] = {x + 3 * dx2 + i * fx, y + 3 * dy2 + i * fy}
    end
  elseif kind == 11 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    if fx ~= 0 and fy ~= 0 then
      dx1 = -(dx1 + fx) / 2
      dx2 = -(dx2 + fx) / 2
      dy1 = -(dy1 + fy) / 2
      dy2 = -(dy2 + fy) / 2
      len1 = math.modf(len1 * 0.7071)
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, 2 * i + 1 do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    else
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, len1 - i do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    end
  elseif kind == 12 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    if fx ~= 0 and fy ~= 0 then
      dx1 = (dx1 + fx) / 2
      dx2 = (dx2 + fx) / 2
      dy1 = (dy1 + fy) / 2
      dy2 = (dy2 + fy) / 2
      len1 = math.modf(len1 * 1.41421)
      for i = 0, len1 do
        if i <= len1 / 2 then
          num = num + 1
          xy[num] = {x + i * fx, y + i * fy}
        end
        for j = 1, len1 - i * 2 do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    else
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, i do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    end
  elseif kind == 13 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local xx = x + fx * len1
    local yy = y + fy * len1
    for tx = xx - len1, xx + len1 do
      for ty = yy - len1, yy + len1 do
        if len1 < math.abs(tx - xx) + math.abs(ty - yy) then
          break;
        end
        num = num + 1
        xy[num] = {tx, ty}
      end
    end
  else
    return 0
  end
  
	--降龙的范围
	if xl then
		local xl_x = WAR.Person[WAR.CurID]["坐标X"]
		local xl_y = WAR.Person[WAR.CurID]["坐标Y"]
		for i = 1, 11, 2 do
			for j = 1, 11, 2 do
				num = num + 1
				xy[num] = {xl_x - i, xl_y + j}
				num = num + 1
				xy[num] = {xl_x - i, xl_y - j}
				num = num + 1
				xy[num] = {xl_x + i, xl_y + j}
				num = num + 1
				xy[num] = {xl_x + i, xl_y - j}
			end
		end
	end
  
  if flag == 1 then
		local thexy = function(nx, ny, x, y)
	    local dx, dy = nx - x, ny - y
	    local hb = lib.GetS(JY.SubScene, nx, ny, 4)
	    return CC.ScreenW / 2 + CC.XScale * (dx - dy), CC.ScreenH / 2 + CC.YScale * (dx + dy) - hb
    end
    
    for i = 1, num do
    	if xy[i][1] >= 0 and xy[i][1] < CC.WarWidth and xy[i][2] >= 0 and xy[i][2] < CC.WarHeight then
      	local tx, ty = thexy(xy[i][1], xy[i][2], x0, y0)

	      if GetWarMap(xy[i][1], xy[i][2], 2) ~= nil and GetWarMap(xy[i][1], xy[i][2], 2) >= 0 and GetWarMap(xy[i][1], xy[i][2], 2) ~= WAR.CurID then
				if not isteam(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"]) and WAR.Person[WAR.CurID]["我方"] then
		      	local x0 = WAR.Person[WAR.CurID]["坐标X"];
		      	local y0 = WAR.Person[WAR.CurID]["坐标Y"];
		      	local dx = xy[i][1] - x0
		        local dy = xy[i][2] - y0
		        local size = CC.FontSmall;
		        local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		        local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		        
		        local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)

		        ry = ry - hb - CC.ScreenH/6;
						
		        if ry < 1 then			--加上这个，防止看不到血的情况
		        	ry = 1;
		        end
		      	
		      	--显示选中人物的生命值
		      	local color = RGB(245, 251, 5);
		      	local hp = JY.Person[WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"]]["生命"];
		      	local maxhp = JY.Person[WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"]]["生命最大值"];
		      	
		      	local ns = JY.Person[WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"]]["受伤程度"];
		      	local zd = JY.Person[WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"]]["中毒程度"];
		      	local len = #(string.format("%d/%d",hp,maxhp));
		      	rx = rx - len*size/4;
		      	
		      	--颜色根据所受的内伤确定
		      	if ns < 33 then
							color = RGB(236, 200, 40)
						elseif ns < 66 then
							color = RGB(244, 128, 32)
						else
							color = RGB(232, 32, 44)
						end
		      	
		      	DrawString(rx, ry, string.format("%d",hp), color, size);
		      	DrawString(rx + #string.format("%d",hp)*size/2, ry, "/", C_GOLD, size);
		      	
		      	if zd == 0 then
				      color = RGB(252, 148, 16)
				    elseif zd < 50 then
				      color = RGB(120, 208, 88)
				    else
				      color = RGB(56, 136, 36)
				    end
				    DrawString(rx + #string.format("%d",hp)*size/2 + size/2 , ry, string.format("%d", maxhp), color, size)
		      end
		      
	      	--lib.PicLoadCache(0, 0, tx, ty, 2, 200)
	      else
	      	--lib.PicLoadCache(0, 0, tx, ty, 2, 112)
	      end
	      
	    end
    end

  elseif flag == 2 then
    local diwo = WAR.Person[WAR.CurID]["我方"]
    local atknum = 0
    for i = 1, num do
      if xy[i][1] >= 0 and xy[i][1] < CC.WarWidth and xy[i][2] >= 0 and xy[i][2] < CC.WarHeight then
        local id = GetWarMap(xy[i][1], xy[i][2], 2)
      
	      if id ~= -1 and id ~= WAR.CurID then
	        local xa, xb, xc = nil, nil, nil
			local e_diwo = WAR.Person[id]["我方"]
			--张家辉的隐身戒指
			if (JY.Person[WAR.Person[id]["人物编号"]]["防具"] == 304 and WAR.YSJZ == 0) then
				e_diwo = diwo
			end
	        if diwo ~= e_diwo then
				xa = 2
	        else
				xa = 0
	        end
			
			if (WAR.PD["混乱状态"][WAR.Person[WAR.CurID]["人物编号"]] ~= nil) or (WAR.PD["荒天龙灭"][WAR.Person[WAR.CurID]["人物编号"]] ~= nil) then
				if e_diwo == diwo and math.random(100) <= 40 then
					xa = 2
				end
				if e_diwo ~= diwo and math.random(100) <= 40 then 
					xa = 0
				end
			end
			
	        local hp = JY.Person[WAR.Person[id]["人物编号"]]["生命"]
	        if hp < atk / 6 then
	            xb = 2
	        elseif hp < atk / 3 then
	            xb = 1
	        else
	            xb = 0
	        end
	        local danger = JY.Person[WAR.Person[id]["人物编号"]]["内力最大值"]
	        xc = danger / 500
	        atknum = atknum + xa * math.modf(xb * (xc) + 5)
	      end
      end
    end
    return atknum
  elseif flag == 3 then
    for i = 1, num do
    	if xy[i][1] >= 0 and xy[i][1] < CC.WarWidth and xy[i][2] >= 0 and xy[i][2] < CC.WarHeight then
			SetWarMap(xy[i][1], xy[i][2], 4, 1)
		end
    end
	--武功选择范围
  elseif flag == 4 then
    for i = 1, num do
    	if xy[i][1] >= 0 and xy[i][1] < CC.WarWidth and xy[i][2] >= 0 and xy[i][2] < CC.WarHeight then
			if GetWarMap(xy[i][1], xy[i][2], 2) ~= nil and GetWarMap(xy[i][1], xy[i][2], 2) >= 0 then
				--论剑奖励代表是否学有迷踪步
				--自动不触发
				if WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"] == 0 and JY.Person[615]["论剑奖励"] == 1 and JLSD(0,30,0) and WAR.AutoFight == 0 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["我方"] and JY.Base['标准'] > 0 then
					--用阿凡提的品德作为触发迷踪步的判定
					CC.TX["迷踪步"] = 1
				end
				if match_ID(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"], 498) and math.random(10) < 4 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["我方"] then
					--用李寻欢的品德作为触蜻蜓三抄水的判定
					JY.Person[498]["品德"] = 30
				end
				--小昭影步
				if match_ID(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"], 66) and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["我方"] then
					--用小昭的品德作为触发影步的判定
					JY.Person[66]["品德"] = 90
				end
				--兽王庄
				if MPTX(WAR.Person[GetWarMap(xy[i][1], xy[i][2],2)]["人物编号"],27,3) and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[GetWarMap(xy[i][1], xy[i][2],2)]["我方"] then
					--用熊猫河豚来判断
					local jl = 10*MPDJ(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"])
					if JLSD(0,jl+10,WAR.Person[GetWarMap(xy[i][1], xy[i][2],2)]["人物编号"]) or match_ID(WAR.Person[GetWarMap(xy[i][1],xy[i][2],2)]["人物编号"],765) then
						JY.Person[765]["品德"] = 120
					end
				end
				--江澜
				if match_ID(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"], 775) and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["我方"] then
					--用小昭的品德作为触发影步的判定
					local jl = 60
					if JLSD(20,jl,WAR.Person[GetWarMap(xy[i][1], xy[i][2],2)]["人物编号"]) and match_ID(WAR.Person[GetWarMap(xy[i][1],xy[i][2],2)]["人物编号"],775) then
						JY.Person[775]["品德"] = 120
					end
				end
				--与世无争
				if NGQH(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"], 359)and math.random(10) < 6 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["我方"] then
					--用小昭的品德作为触发影步的判定								
					JY.Person[520]["品德"] = 120
				end
				--畅想张无忌逆转乾坤
				--自动不触发
				if ((WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"] == 0 and JY.Base["畅想"] == 9) or match_ID(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"], 9990))  and PersonKF(0, 97) and WAR.AutoFight == 0 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["我方"] then
					--基础35%几率
					local chance = 36
					--每本天书+1几率
					chance = chance + JY.Base["天书数量"]
					if WAR.LQZ[0] == 100 then
						chance = chance + 10
					end
					if JLSD(0,chance,WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"]) then
						CC.TX["逆转乾坤"] = 1
						WAR.WS = 0
					end
				end
			
				--命中的敌方的点为2
				if not isteam(WAR.Person[GetWarMap(xy[i][1], xy[i][2], 2)]["人物编号"]) and WAR.Person[WAR.CurID]["我方"] then
					SetWarMap(xy[i][1], xy[i][2], 7, 2)
				else
					SetWarMap(xy[i][1], xy[i][2], 7, 1)
				end
			else
				SetWarMap(xy[i][1], xy[i][2], 7, 1)
			end
		end
    end
  end
end

PNLBD = {}
--一灯居郭靖
PNLBD[68] = function()
	JY.Person[683]["武功1"] = 26
	JY.Person[683]["武功等级1"] = 999
    JY.Person[683]["武功2"] = 15
	JY.Person[683]["武功等级2"] = 999
    JY.Person[683]["武功3"] = 107
	JY.Person[683]["武功等级3"] = 999
end
--招亲郭靖
PNLBD[76] = function()
	JY.Person[683]["武功1"] = 26
	JY.Person[683]["武功等级1"] = 600
    JY.Person[683]["武功2"] = 15
	JY.Person[683]["武功等级2"] = 500
    JY.Person[683]["武功3"] = 107
	JY.Person[683]["武功等级3"] = 50
end
--明霞岛欧阳锋
PNLBD[171] = function()
    JY.Person[60]["优先使用"] = 9
end
--重阳宫欧阳锋
PNLBD[176] = function()
    JY.Person[60]["优先使用"] = 81
end
--少林掌院考核・三空
PNLBD[311] = function()
	JY.Person[766]["武功5"] = 91
	JY.Person[766]["武功等级5"] = 999
	JY.Person[170]["武功5"] = 243
	JY.Person[170]["武功等级5"] = 999
	JY.Person[170]["武功6"] = 91
	JY.Person[170]["武功等级6"] = 999
	JY.Person[169]['门派技能1'] = 91
	JY.Person[170]['门派技能1'] = 91
	JY.Person[766]['门派技能1'] = 91
end
--死囚牢四大名捕
PNLBD[315] = function()
	JoinMP(448,25,4)
	JY.Person[448]["畅想分阶"] = 2
	JY.Person[448]["坐骑"] = 312
	JoinMP(447,25,3)
	JoinMP(447,25,3)
	JoinMP(447,25,3)
end
--灵鹫宫卓不凡
PNLBD[334] = function()
	JY.Person[565]["畅想分阶"] = 2
	JY.Person[565]["武器"] = 653
	JY.Person[565]["防具"] = 654
	JY.Person[565]["坐骑"] = 655
end
--晋阳战四大名捕
PNLBD[343] = function()
	JoinMP(448,25,4)
	JY.Person[448]["畅想分阶"] = 2
	JoinMP(447,25,3)
	JoinMP(447,25,3)
	JoinMP(447,25,3)
end
--试炼大成点点
PNLBD[456] = function()
    JY.Person[457]["生命"] = 10000
	JY.Person[457]["生命最大值"] = 10000
	JY.Person[457]["武功1"] = 48
	JY.Person[457]["武功等级1"] = 999
	JY.Person[457]["武功2"] = 105
	JY.Person[457]["武功等级2"] = 999
	JY.Person[457]['武功3'] = 301
	JY.Person[457]['武功等级3'] = 999
	JY.Person[457]["武功4"] = 316
	JY.Person[457]["武功等级4"] = 999
	JY.Person[457]["武功5"] = 367
	JY.Person[457]["武功等级5"] = 999
	JY.Person[457]["天赋内功"] = 301
	JY.Person[457]["天赋轻功"] = 316
	JY.Person[457]["天赋外功1"] = 48
	JY.Person[457]['主运内功'] = 301
	JY.Person[457]['门派技能1'] = 367
	JY.Person[457]["畅想分阶"] = 1
	JY.Person[457]["御剑能力"] = 1599
	JY.Person[457]["攻击力"] = 2000
	JY.Person[457]["防御力"] = 2000
	JY.Person[457]["轻功"] = 2000
	JoinMP(457,24,4)
end
--boss 占位暴怒
function BOSSBF(id, x, y)
	local pid = WAR.Person[id]['人物编号']
	if r == 1 then
		return 
	end
	local s = WAR.CurID
	WAR.CurID =  id
	--1绿色，2红色，3蓝色，4紫色
	CleanWarMap(6,-1);
	    	
	local QMDJ = {"天","地","人","鬼"}
				
	--在自身周围绘制奇阵
	SetWarMap(x, y, 4, math.random(4));
	    		
	for j=1, 2 do
	    SetWarMap(x + math.random(4), y + math.random(4), 4, math.random(4));
				for n = 30, 100 do
					local i = n
					if i > 100 then
						i = 100
					end
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
					ShowScreen()
					lib.Delay(CC.BattleDelay)	
				end
		
		
	end
				
	for j=3, 4 do
		SetWarMap(x + math.random(4), y - math.random(4), 4, math.random(4));
				for n = 30, 100 do
					local i = n
					if i > 100 then
						i = 100
					end
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
					ShowScreen()
					lib.Delay(CC.BattleDelay)	
				end
	end
				
	for j=5, 6 do
	    SetWarMap(x - math.random(4), y - math.random(4), 4, math.random(4));
				for n = 30,100 do
					local i = n
					if i > 100 then
						i = 100
					end
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
					ShowScreen()
					lib.Delay(CC.BattleDelay)	
				end
	end
				
	for j=7, 8 do
		SetWarMap(x - math.random(4), y + math.random(4), 4, math.random(4));
		for n = 30, 100 do
			local i = n
			if i > 100 then
				i = 100
			end
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)	
		end
	end
	
	WAR.CurID =  s
end	
	
--黄蓉：奇门遁甲
function WarNewLand(id, x, y)
	if WAR.ZDDH == 226 then
		return 
	end
	local pid = WAR.Person[id]['人物编号']
	local r = JYMsgBox("奇门遁甲", "是否要开启奇门遁甲？", {"否","是"}, 2, JY.Person[pid]["半身像"])
	if r == 1 then
		return 
	end
	local s = WAR.CurID
	WAR.CurID =  id
	--1绿色，2红色，3蓝色，4紫色
	CleanWarMap(6,-1);
	    	
	local QMDJ = {"休","生","伤","杜","景","死","惊","开"}
				
	--在自身周围绘制奇阵
	SetWarMap(x, y, 6, math.random(4));
	    		
	for j=1, 2 do
    SetWarMap(x + math.random(6), y + math.random(6), 6, math.random(4));
		for n = 30, 40 do
			local i = n
			if i > 40 then
				i = 40
			end
			Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
			NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)	
		end
	end
				
	for j=3, 4 do
		SetWarMap(x + math.random(6), y - math.random(6), 6, math.random(4));
		for n = 30, 40 do
			local i = n
			if i > 40 then
				i = 40
			end
			Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
			NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)	
		end
	end
				
	for j=5, 6 do
  	SetWarMap(x - math.random(6), y - math.random(6), 6, math.random(4));
		for n = 30, 40 do
			local i = n
			if i > 40 then
				i = 40
			end
			Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
			NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)	
		end
	end
				
	for j=7, 8 do
		SetWarMap(x - math.random(6), y + math.random(6), 6, math.random(4));
		for n = 30, 40 do
			local i = n
			if i > 40 then
				i = 40
			end
			Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
			NewDrawString(-1, -1, QMDJ[j], C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)	
		end
	end
	
	WAR.CurID =  s
end
	
--[[		if 10 < WAR.SXTJ and WAR.ZDDH == 226 and WAR.ZH001==0 then		
			local dfid
			for i = 0, WAR.PersonNum - 1 do
			local id = WAR.Person[i]["人物编号"]
				if id == 46 then
				dfid = i
				break
				end
			end
		Cls()
		--say("Ｒ２＜你……你是我爹爹……＞", 50, 0)
		--say("Ｒ２＜好孩子，好孩儿，我正是你的爹爹。咱爷儿俩一般的身形相貌，不用记认，谁都知道我是你的老子。＞", 112, 0)
		local x, y = WE_xy(WAR.Person[WAR.CurID]["坐标X"]-1, WAR.Person[WAR.CurID]["坐标Y"]-1)
		--友军召唤
		--NewWARPersonZJ(512, true, x, y, false, 2)
		--敌军召唤		
		NewWARPersonZJ(512, false, x, y, false, 2)	
		WAR.ZH001=WAR.ZH001+1	
			JY.Person[512]["暂时无用"] = JY.Base["畅想"]			
			JY.Person[512]["头像代号"] = JY.Person[0]["头像代号"]
			JY.Person[512]["半身像"] = JY.Person[0]["半身像"]
			JY.Person[512]["天赋内功"]=JY.Person[0]["天赋内功"]
			JY.Person[512]["天赋外功1"]=JY.Person[0]["天赋外功1"]
			JY.Person[512]["天赋外功2"]=JY.Person[0]["天赋外功2"]	
			JY.Person[512]["天赋轻功"]=JY.Person[0]["天赋轻功"]			
			JY.Person[512]["指法技巧"]=JY.Person[0]["指法技巧"]*1.5
			JY.Person[512]["御剑能力"]=JY.Person[0]["御剑能力"]*1.5	
			JY.Person[512]["耍刀技巧"]=JY.Person[0]["耍刀技巧"]*1.5
			JY.Person[512]["特殊兵器"]=JY.Person[0]["特殊兵器"]*1.5
			JY.Person[512]["武学常识"]=JY.Person[0]["武学常识"]*1.5
			JY.Person[512]["攻击带毒"]=JY.Person[0]["攻击带毒"]*1.5
			JY.Person[512]["左右互搏"]=JY.Person[0]["左右互搏"]
			JY.Person[512]["中庸"]=JY.Person[0]["中庸"]
			JY.Person[512]["攻击力"]=JY.Person[0]["攻击力"]
			JY.Person[512]["防御力"]=JY.Person[0]["防御力"]
			JY.Person[512]["轻功"]=JY.Person[0]["轻功"]
			JY.Person[512]["医疗能力"]=JY.Person[0]["医疗能力"]
			JY.Person[512]["用毒能力"]=JY.Person[0]["用毒能力"]
			JY.Person[512]["解毒能力"]=JY.Person[0]["解毒能力"]
			JY.Person[512]["暗器技巧"]=JY.Person[0]["暗器技巧"]
			JY.Person[512]["抗毒能力"]=JY.Person[0]["抗毒能力"]
			JY.Person[512]["个人觉醒"]= JY.Person[0]["个人觉醒"]
			JY.Person[512]["六如觉醒"]= JY.Person[0]["六如觉醒"]
			JY.Person[512]["畅想分阶"]= 0
			for i=1,5 do
				JY.Person[512]["出招动画帧数" .. i]=JY.Person[0]["出招动画帧数" .. i]
				JY.Person[512]["出招动画延迟" .. i]=JY.Person[0]["出招动画延迟" .. i]
				JY.Person[512]["武功音效延迟" .. i]=JY.Person[0]["武功音效延迟" .. i]
			end	
			JY.Person[512]["武器"]=JY.Person[0]["武器"]
			JY.Person[512]["防具"]=JY.Person[0]["防具"]
			JY.Person[512]["坐骑"]=JY.Person[0]["坐骑"]
			JY.Person[512]["生命最大值"] = math.modf(JY.Person[0]["生命最大值"]*1.5)
			JY.Person[512]["生命"] = JY.Person[512]["生命最大值"]
			JY.Person[512]["内力最大值"] = math.modf(JY.Person[0]["内力最大值"]*1.5)
			JY.Person[512]["内力"] =JY.Person[512]["内力最大值"]
			JY.Person[512]["生命增长"] =JY.Person[0]["生命增长"]
			JY.Person[512]["内力性质"] =JY.Person[0]["内力性质"]
			JY.Person[512]["性别"] =JY.Person[0]["性别"]
			JY.Person[512]["资质"] =JY.Person[0]["资质"]
			for j = 1,JY.Base["武功数量"] do
				JY.Person[512]["武功".. j] = JY.Person[0]["武功".. j]
				JY.Person[512]["武功等级" .. j] = JY.Person[0]["武功等级".. j]
			end
		end
--]]		

--战斗主函数
function WarMain(warid, isexp)
	WarLoad(warid)			--初始化战斗数据
	WarSelectTeam_Enhance()	--选择我方（优化版）
	WarSelectEnemy()		--选择敌人
	
	Health_in_Battle()		--无酒不欢：血量翻倍
 
	if JY.Restart == 1 then
		return false
	end
	
	CleanMemory()
	--lib.PicInit()
	lib.ShowSlow(20, 1)
	WarLoadMap(WAR.Data["地图"])	--加载战斗地图
	
	--默认在当前场景战斗
	local BattleField = JY.SubScene
	if WAR.ZDDH == 354 then
        BattleField = 25
    end
	--倚天正线拿九阳战斗
	if WAR.ZDDH == 287 or WAR.ZDDH == 436 then
		BattleField = 116
	end

	for i = 0, CC.WarWidth-1 do
		for j = 0, CC.WarHeight-1 do
			lib.SetWarMap(i, j, 0, lib.GetS(BattleField, i, j, 0))
			lib.SetWarMap(i, j, 1, lib.GetS(BattleField, i, j, 1))
		end
	end
  
	--雪山落花流水战役
	if WAR.ZDDH == 42 then
		SetS(2, 24, 31, 1, 0)
		SetS(2, 30, 34, 1, 0)
		SetS(2, 27, 27, 1, 0)
	end
  
	--旧版华山论剑的擂台
	if WAR.ZDDH == 238 then
		for x = 24, 34 do
			for y = 24, 34 do
				lib.SetWarMap(x, y, 0, 1030)
			end
		end
		for y = 23, 35 do
			lib.SetWarMap(23, y, 1, 1174)
			lib.SetWarMap(35, y, 1, 1174)
		end
		for x = 24, 35 do
			lib.SetWarMap(x, 35, 1, 1174)
			lib.SetWarMap(x, 23, 1, 1174)
		end
		lib.SetWarMap(23, 23, 0, 1174)
		lib.SetWarMap(35, 35, 0, 1174)
		lib.SetWarMap(23, 35, 0, 1174)
		lib.SetWarMap(35, 23, 0, 1174)
		lib.SetWarMap(23, 23, 1, 2960)
		lib.SetWarMap(35, 35, 1, 2960)
		lib.SetWarMap(23, 35, 1, 2960)
		lib.SetWarMap(35, 23, 1, 2960)
	end
	--天关修正地形
	if WAR.ZDDH == 348 or WAR.ZDDH == 349 or WAR.ZDDH == 350 or WAR.ZDDH == 356 or WAR.ZDDH == 357 or WAR.ZDDH == 358 then
		lib.SetWarMap(28, 6, 1, 1843*2)
        lib.SetWarMap(28, 5, 1, 1843*2)		
	end
 
	--20大高手，修正地形
	if WAR.ZDDH == 289 then
		lib.SetWarMap(39, 29, 1, 1417*2)
		lib.SetWarMap(39, 30, 1, 1416*2)
		lib.SetWarMap(39, 31, 1, 1416*2)
		lib.SetWarMap(39, 32, 1, 1417*2)
		for i = 40, 43 do
			lib.SetWarMap(i, 30, 0, 35*2)
			lib.SetWarMap(i, 31, 0, 35*2)
			lib.SetWarMap(i, 32, 0, 35*2)
			lib.SetWarMap(i, 30, 1, 0)
			lib.SetWarMap(i, 32, 1, 0)
		end
		for i = 30, 32 do
			lib.SetWarMap(40, i, 0, 76*2)
			lib.SetWarMap(41, i, 0, 72*2)
		end
		lib.SetWarMap(15, 19, 1, 1843*2)
		lib.SetWarMap(15, 20, 1, 1843*2)
	end
	--20大高手，修正地形
	if WAR.ZDDH == 337 then
		lib.SetWarMap(39, 29, 1, 1417*2)
		lib.SetWarMap(39, 30, 1, 1416*2)
		lib.SetWarMap(39, 31, 1, 1416*2)
		lib.SetWarMap(39, 32, 1, 1417*2)
		for i = 40, 43 do
			lib.SetWarMap(i, 30, 0, 35*2)
			lib.SetWarMap(i, 31, 0, 35*2)
			lib.SetWarMap(i, 32, 0, 35*2)
			lib.SetWarMap(i, 30, 1, 0)
			lib.SetWarMap(i, 32, 1, 0)
		end
		for i = 30, 32 do
			lib.SetWarMap(40, i, 0, 76*2)
			lib.SetWarMap(41, i, 0, 72*2)
		end

	end	
	--战四大山，修正地形
	if WAR.ZDDH == 290 then
		for i = 5, 34 do
			lib.SetWarMap(7, i, 1, 0)
			lib.SetWarMap(9, i, 1, 0)
			lib.SetWarMap(54, i, 1, 0)
			lib.SetWarMap(56, i, 1, 0)
		end
	end
  
	--杀东方不败
	if WAR.ZDDH == 54 then
		lib.SetWarMap(11, 36, 1, 2)
	end
	
	if WAR.ZDDH == 262 then
		JY.Person[149]["主运内功"] = 91
	end
		
	--改变游戏状态
	JY.Status = GAME_WMAP
	  
	--加载贴图文件
	--lib.PicLoadFile(CC.WMAPPicFile[1], CC.WMAPPicFile[2], 0)						--战场贴图，内存区域0
	
	--lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,100))	--人物大头像，内存区域1
	
	--lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)			--物品贴图，内存区域2
	--lib.LoadPNGPath('./data/thing',0,-1,100)
	--lib.PicLoadFile(CC.EFTFile[1], CC.EFTFile[2], 3)								--特效贴图，内存区域3
	--lib.LoadPNGPath('./data/eft',0,-1,100)
	--lib.LoadPNGPath(CC.PTPath, 95, CC.PTNum, limitX(CC.ScreenW/1360*100,0,100))
	
	--lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))
	
	--lib.LoadPNGPath(CC.IconPath, 98, CC.IconNum, limitX(CC.ScreenW/1360*100,0,100))	--状态图标，内存区域98
	
	--lib.LoadPNGPath(CC.HeadPath, 99, CC.HeadNum, 26.923076923)						--人物小头像，用于集气条，内存区域99
   
   -- lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	--半身象
	--lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI	
	--lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92) 
    --lib.LoadPNGPath('./data/bj',0,-1,100)	
	--无酒不欢：随机战斗音乐
	local zdyy = math.random(10) + 99
	
	--15大固定
	if WAR.ZDDH == 133 or WAR.ZDDH == 134 then
		zdyy = 27
	end
	
	--VS少林诸僧战固定
	if WAR.ZDDH == 80 then
		zdyy = 22
	end
	
	if WAR.ZDDH == 377 then
		zdyy = 120
	end
	
	--葵花尊者战固定
	if WAR.ZDDH == 54  then
		zdyy = 112
	end

	--侠客邪固定
	if WAR.ZDDH == 170 then
		zdyy = 119
	end
	
	--蒙哥战固定
	if WAR.ZDDH == 278 then
		zdyy = 110
	end
	
	--武当战三丰固定
	if WAR.ZDDH == 22 then
		zdyy = 113
	end
	
	--20大高手战固定
	if WAR.ZDDH == 289 then
		zdyy = 115
	end
	
	--战四大山固定
	if WAR.ZDDH == 290 then
		zdyy = 117
	end
	
	--剑魔剑仙固定
	if WAR.ZDDH == 291 then
		zdyy = 118
	end
	
	PlayMIDI(zdyy)
	
	--PlayMIDI(WAR.Data["音乐"])  
	  
	local warStatus = nil		 --战斗状态
  
	WarPersonSort()			--按轻功排序
	CleanWarMap(2, -1)
	CleanWarMap(6, -2)

	for i = 0, WAR.PersonNum - 1 do
		
		if i == 0 then
		  WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] = WE_xy(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"])
		else
		  WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] = WE_xy(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], i)
		end
		
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2, i)
		
		local pid = WAR.Person[i]["人物编号"]
		WAR.Person[i]["贴图"] = WarCalPersonPic(i)
        --lib.PicLoadFile(string.format(CC.FightPicFile[1], JY.Person[pid]["头像代号"]), string.format(CC.FightPicFile[2], JY.Person[pid]["头像代号"]), 4 + i)	--人物战斗动作贴图，内存区域4-29（一场战斗上限26人）
        if WAR.ZDDH > 0 then
            WAR.Boss[513] = 1
        end
        if WAR.ZDDH > 0 then
            WAR.Boss[26] = 1
        end
        if WAR.ZDDH > 0 then
            WAR.Boss[592] = 1
		end
        if WAR.ZDDH > 0 then
			WAR.Boss[577] = 1
        end
		if WAR.ZDDH == 54 and WAR.MCRS == 1 then
			WAR.Boss[27] = 1
        end
        savetf(i)
		savewg(i)
	end
	  
	--轻功对移动格子的计算
	--x为战场轻功，y为体力
	local function getnewmove(x, y)
		local mob = x + y * 5
		if mob > 1800 then
			return 8
			elseif mob > 1500 then
			return 7
			elseif mob > 1200 then
			return 6
			elseif mob > 800 then
			return 5
		elseif mob > 500 then
			return 4
		elseif mob > 200 then
			return 3
		else
			return 2
		end
	end
	local function getdelay(x, y)
		return math.modf(1.5 * (x / y + y - 3))
	end
	
	for i = 0, WAR.PersonNum - 1 do
		WAR.Person[i]["贴图"] = WarCalPersonPic(i)
	end
	WarSetPerson()
	WAR.CurID = 0
	WarDrawMap(0)
	lib.ShowSlow(20, 0)
	  
	--无酒不欢：全场人物的初始集气、特效设置
	for i = 0, WAR.PersonNum - 1 do
		local id = WAR.Person[i]["人物编号"]
		WAR.Person[i].Time = 800 - i * 1000 / WAR.PersonNum       
		--奇穴相关
		if QIQX(id,'涤瑕劲') > 0 then
			WAR.PD['涤瑕次数'] = QIQX(id,'涤瑕劲')
		end	
		--岳灵珊 每个剑法+150点初始集气
		if match_ID(id, 79) or match_ID(id, 9842) then
			local JF = 0
			local bh = id
			for i = 1, JY.Base["武功数量"] do
				if JY.Wugong[JY.Person[bh]["武功" .. i]]["武功类型"] == 3 then
					JF = JF + 1
				end
			end
			WAR.Person[i].Time = WAR.Person[i].Time + (JF) * 150
		end
		--护龙山庄
		if MPTX(id,25) then
			WAR.Person[i].Time = WAR.Person[i].Time + 150
		end
		--云梦涧
		if MPTX(id,26) then
			WAR.Person[i].Time = WAR.Person[i].Time + 100
		end 	
		--青城
		if MPTX(id,28) then
			local a = JY.Person[id]["内力"]/40
			WAR.Person[i].Time = WAR.Person[i].Time + a
		end 	
		--圣火神功 初始集气加200和100随机
		if PersonKF(id, 93) then
			WAR.Person[i].Time = WAR.Person[i].Time + 100 + math.random(100)
			if Curr_NG(id,93) then
				WAR.Person[i].Time = WAR.Person[i].Time + 200 + math.random(200)
			end			
		end
		--云龙三折
		if Curr_QG(id,292) then
			WAR.Person[i].Time = WAR.Person[i].Time + 100
			if TFQG(id,292) then
				WAR.Person[i].Time = WAR.Person[i].Time + math.modf(50*(7-JY.Person[id]['畅想分阶']))
			end
		end		
		if WAR.Person[i].Time > 999 then
			WAR.Person[i].Time = 999
		end
		--最低900集气
		if WAR.Person[i].Time < 900 then
			--林平之 初始集气900
			if match_ID(id, 36) then
				WAR.Person[i].Time = 900
			end
			--血刀老祖 初始集气900
			if match_ID(id, 97) then
				WAR.Person[i].Time = 900
			end
			--竹风雨滴
			if match_ID(id,520) then
				WAR.Person[i].Time = 900
			end
			-- 绣花针，进战斗900集气
			if JY.Person[id]["武器"] == 349 or match_ID(id,27) or match_ID(id,777) or (PersonKF(id,313) and PersonKF(id,105)) then
				WAR.Person[i].Time = 900
			end
		end
		--最低998集气
		if WAR.Person[i].Time < 998 then
			if JY.Person[id]["坐骑"] == 312 then
				WAR.Person[i].Time = 998
			end
			--车神
			if match_ID(id,524) then
				WAR.Person[i].Time = 998
			end
			--风清扬
			if match_ID(id, 140) then
				WAR.Person[i].Time = 999
			end
		end
		--最低1000集气
		if WAR.Person[i].Time < 1000 then
			--觉醒令狐冲
			if JXPD(id, 35, 1) or match_ID(id, 9941) or match_ID(id, 9996) then
				WAR.Person[i].Time = 1000
			end
			--独孤九剑	
			if (PersonKF(id,47) and PersonKF(id,184)) or match_ID(id,592) or (WAR.ZDDH == 424 and id == 670) then 
				WAR.Person[i].Time = 1005
			end
		end
		--固定-200集气
		if WAR.Person[i].Time > -200 then
			--木桩的初始集气
			if id == 591 and WAR.ZDDH == 226 then
				WAR.Person[i].Time = -200
			end
			--太监初始集气-200
			if JY.Person[id]["性别"] == 2 and Curr_QG(id,316) == false then
				WAR.Person[i].Time = -200
			end
		end
 		--蛤蟆逆运
		for j = 0, WAR.PersonNum - 1 do
			--敌人不会，已方才会走火失控
			local id = WAR.Person[j]["人物编号"]
			if inteam(id) and PersonKF(id,104) then
				if NGQH(id,104) then
					if WAR.L_NYZH[id] == nil then 
						WAR.L_NYZH[id] = 2 
					end
				else
					if WAR.L_NYZH[id] == nil then 
						WAR.L_NYZH[id] = 1
					end
				end	
			end
		end
		--圣火乾坤
		if Curr_NG(id,93) and PersonKF(id,97) and inteam(id) then
			hgb()
		end
		--大周吸星		
		if (Curr_NG(id,190) and PersonKF(id,88)) or (MPTX(id,12) and Curr_NG(id,88)) then
			WAR.PD['三垣'][id] = 0
		end
		
		--玉女先天・古墓
		if (Curr_NG(id,154) and PersonKF(id,100)) or (MPTX(id,3) and Curr_NG(id,154)) then 
			for j = 0, WAR.PersonNum - 1 do
				local jd = WAR.Person[j]["人物编号"]
				if DWPD(i,j) and WAR.Person[j]["死亡"] == false then
					WAR.QX1[jd] = 1	
				end
			end	
		end 
		--天魔易筋
		if NGQH(id,160) or (Curr_NG(id,160) and match_ID(id,9991)) then
			for j = 0, WAR.PersonNum - 1 do
				local jd = WAR.Person[j]["人物编号"]
				if DWPD(i,j) and WAR.Person[j]["死亡"] == false then
					WAR.PD['复活无效'][jd] = 1
				end
			end	
			if JLSD(10,85,id) then
				local a = math.random(2)
				if a == 1 then
					say("六道同坠、魔劫万千、引渡如来！！！",id,1)
					WAR.Person[i].Time = WAR.Person[i].Time + 200
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							local jd = WAR.Person[j]["人物编号"]
							WAR.PD['蛇行狸翻'][jd] = (WAR.PD['蛇行狸翻'][jd] or 0) + 10
						end	
					end	
				else
					say("魔佛妖僧怪和尚，声声句句鬼如来！",id,1)
					WAR.Person[i].Time = WAR.Person[i].Time + 200
					for j = 0, WAR.PersonNum - 1 do
						local jd = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] == WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							WAR.LQZ[jd] = 100
							WAR.PD['入魔'][jd] = 1
							WAR.PD['鬼如来'][jd] = 1
						end	
					end
				end	
			end
		end
		--阴阳无极判定
		if Curr_NG(id,221) and PersonKF(id,250) then
			if math.random(2) == 1 then
				WAR.PD['阴阳双极'][id] = 0
			else
				WAR.PD['阴阳双极'][id] = 31
			end	
		end	
		--怒涛黯然
		if PersonKF(id,25) and (Curr_NG(id,252) or match_ID(id,58)) then
			local n = 0
			if JY.Base['单通'] == 1 then
				WAR.PD['黯然值'][id] = math.random(20,40)
			else
				for dy = 0,WAR.PersonNum-1 do 
					if DWPD(i,dy) == false and WAR.Person[dy]['死亡'] == false then
						n = n + 1
					end
				end
				WAR.PD['黯然值'][id] = ((6-n)*math.random(4,8)) + 10
			end
			if match_ID(id,58) then
				WAR.PD['黯然值'][id] = (WAR.PD['黯然值'][id] or 0) + 10
			end	
		end	
		
		--易水四寒
		if PersonKF(id,21) and PersonKF(id,153) and Curr_NG(id,43) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false and RealJL(i,j,7) then
					local jd = WAR.Person[j]["人物编号"]
					WAR.PD['易水四寒'][jd] = 1
					WAR.PD['易水四寒1'][jd] = 0
				end	
			end 
		end
		--九霄中华
		if NGQH(id,184) then
			WAR.PD['九霄剑气1'][id] = 1
			for p = 0, WAR.PersonNum-1 do
				if WAR.Person[p]["死亡"] == false then
					if WAR.Person[p]["我方"] ~= WAR.Person[i]["我方"] then
						WAR.PD['九霄剑气2'][WAR.Person[p]["人物编号"]] = 1
					end
				end
			end
		end
		--斗转觉醒
		if MuRongDZ(id) and psx(id,"门派技能3") == 2 then
			for p = 0, WAR.PersonNum-1 do
				if WAR.Person[p]["死亡"] == false then
					if WAR.Person[p]["我方"] ~= WAR.Person[i]["我方"] then
						WAR.DZAY[WAR.Person[p]["人物编号"]] = 1
					end
				end
			end
		end
		--护龙军师大阵
		if MPTX(id,25,4) and Curr_NG(id,366) then
			local zf = math.random(1,5)
			local s = WAR.CurID
			WAR.CurID = i
			WarDrawMap(0)
			if zf == 1 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] == WAR.Person[i]["我方"] then
							WAR.PD['后土阵'][WAR.Person[p]["人物编号"]] = 1
						end
					end
				end
				CurIDTXDH(WAR.CurID,161,1,"五行倒转・后土千变阵")
			end
			if zf == 2 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] == WAR.Person[i]["我方"] then
							WAR.PD['黄金阵'][WAR.Person[p]["人物编号"]] = 1
						end
					end
				end
				CurIDTXDH(WAR.CurID,247,1,"五行倒转・黄金福禄阵")
			end
			if zf == 3 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] ~= WAR.Person[i]["我方"] then
							WAR.PD['灌木阵'][WAR.Person[p]["人物编号"]] = 1
						end
					end
				end
				CurIDTXDH(WAR.CurID,236,1,"五行倒转・灌木缚身阵")
			end
			if zf == 4 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] ~= WAR.Person[i]["我方"] then
							WAR.PD['烈火阵'][WAR.Person[p]["人物编号"]] = 1
						end
					end
				end
				CurIDTXDH(WAR.CurID,191,1,"五行倒转・烈火焚身阵")
			end
			if zf == 5 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] == WAR.Person[i]["我方"] then
							WAR.PD['驱水阵'][WAR.Person[p]["人物编号"]] = 1
						end
					end
				end
				CurIDTXDH(WAR.CurID,223,1,"五行倒转・驱水润物阵")
			end
			WAR.CurID = s
		end
		
		--昆仑刀剑阵
		--两仪剑37 反x刀60 狂L刀55 迅雷276 金醯61 雪山35 胡家刀67 苗家44
		if MPTX(id,19,2) then
			local ly,fl,sy,dj = 0,0,0,0
			local n = MPDJ(id)  
			if match_ID(id,586) or match_ID(id,604) then
				n = 5
			end	
			for k = 1, JY.Base["武功数量"] do
				local kfid = JY.Person[id]["武功"..k]
				if kfid == 37 or kfid == 60 then
					ly = ly + 1
				end
				if kfid == 55 or kfid == 276 then
					fl = fl + 1
				end
				if kfid == 61 or kfid == 35 then
					sy = sy + 1
				end
				if kfid == 67 or kfid == 44 then
					dj = dj + 1
				end
			end	
			if ly == 2 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] == WAR.Person[i]["我方"] then
							WAR.PD['顺逆两仪1'][WAR.Person[p]["人物编号"]] = n
							if Curr_NG(id,375) then
								WAR.PD['顺逆两仪3'][WAR.Person[p]["人物编号"]] = n
							end	
						else
							WAR.PD['顺逆两仪2'][WAR.Person[p]["人物编号"]] = n
							if Curr_NG(id,375) then
								WAR.PD['顺逆两仪4'][WAR.Person[p]["人物编号"]] = n
							end
						end
					end
				end
				local s = WAR.CurID
				WAR.CurID = i
				WarDrawMap(0)
				if Curr_NG(id,375) then
					CurIDTXDH(WAR.CurID,62,1,"昆仑双绝・两仪微尘阵")
				else
				 	CurIDTXDH(WAR.CurID,62,1,"昆仑双绝・顺逆两仪阵")
				end
				WAR.CurID = s
			end
			if fl == 2 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] == WAR.Person[i]["我方"] then
							WAR.PD['风雷惊蛰1'][WAR.Person[p]["人物编号"]] = n
							if Curr_NG(id,375) then
								WAR.PD['风雷惊蛰3'][WAR.Person[p]["人物编号"]] = n
							end	
						else
							WAR.PD['风雷惊蛰2'][WAR.Person[p]["人物编号"]] = n
							if Curr_NG(id,375) then
								WAR.PD['风雷惊蛰4'][WAR.Person[p]["人物编号"]] = n
							end
						end
					end
				end
				local s = WAR.CurID
				WAR.CurID = i
				WarDrawMap(0)
				if Curr_NG(id,375) then
					CurIDTXDH(WAR.CurID,62,1,"昆仑双绝・暴风怒雷阵")
				else
				 	CurIDTXDH(WAR.CurID,62,1,"昆仑双绝・风雷惊蛰阵")
				end
				WAR.CurID = s
			end
			if sy == 2 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] == WAR.Person[i]["我方"] then
							WAR.PD['霜炎九重1'][WAR.Person[p]["人物编号"]] = n
						else
							WAR.PD['霜炎九重2'][WAR.Person[p]["人物编号"]] = n
						end
					end
				end
				local s = WAR.CurID
				WAR.CurID = i
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID,115,1,"昆仑双绝・霜炎九重阵")
				WAR.CurID = s
			end
			if dj == 2 then
				for p = 0, WAR.PersonNum-1 do
					if WAR.Person[p]["死亡"] == false then
						if WAR.Person[p]["我方"] == WAR.Person[i]["我方"] then
							WAR.PD['天剑绝刀1'][WAR.Person[p]["人物编号"]] = n
						else
							WAR.PD['天剑绝刀2'][WAR.Person[p]["人物编号"]] = n
						end
					end
				end
				local s = WAR.CurID
				WAR.CurID = i
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID,119,1,"昆仑双绝・天剑绝刀阵")
				WAR.CurID = s
			end
		end	
		--暗香疏影
		if QGQH(id,316,2) then
			local a = math.random(1,4)
			local axzl = {"失魂香","忘心香","迷情香","幻梦香"}
			for j = 0, WAR.PersonNum-1 do
				if DWPD(i,j) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local jid = WAR.Person[j]["人物编号"]
					WAR.PD['暗香疏影'][jid] = a
				end	
			end
			local s = WAR.CurID
			WAR.CurID = i
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID,158,1,"暗香・"..axzl[a])
			WAR.CurID = s
		end
		--组合判定
		if MPTX(id,8) and Curr_NG(id,104) then
			WAR.PD['白驼逆运判定'][id] = 1
		end
		if PersonKF(id,106) then
			local jyang = 0
			for j = 1, JY.Base['武功数量'] do 
				local wugong = JY.Person[id]['武功'..j]
				if wgnlxz(wugong) == 1 and yongnei(wugong) then
					jyang = jyang + 1
				end
			end
			if jyang >= 2 then
				WAR.PD['九阳组合判定'][id] = 1
			end
		end	
		if PersonKF(id,107) then
			local jyin = 0
			for j = 1, JY.Base['武功数量'] do 
				local wugong = JY.Person[id]['武功'..j]
				if wgnlxz(wugong) == 0 and yongnei(wugong) then
					jyin = jyin + 1
				end
			end
			if jyin >= 2 then
				WAR.PD['九阴组合判定'][id] = 1
			end
		end
		if PersonKF(id,108) then
			local yjin = 0
			for j = 1, JY.Base['武功数量'] do 
				local wugong = JY.Person[id]['武功'..j]
				if PersonKF(id,91) or PersonKF(id,96) or PersonKF(id,106) or PersonKF(id,144) or PersonKF(id,208) or PersonKF(id,242) or PersonKF(id,243) or PersonKF(id,247) then
					yjin = yjin + 1
				end
			end
			if yjin >= 2 then
				WAR.PD['易筋组合判定'][id] = 1
			end
		end
		if PersonKF(id,171) then
			local tjin = 0
			for j = 1, JY.Base['武功数量'] do 
				local wugong = JY.Person[id]['武功'..j]
				if PersonKF(id,85) or PersonKF(id,90) or PersonKF(id,98) or PersonKF(id,99) or PersonKF(id,100) or PersonKF(id,101) or PersonKF(id,190) or PersonKF(id,203) or PersonKF(id,221) or PersonKF(id,225) or PersonKF(id,249) then
					tjin = tjin + 1
				end
			end
			if tjin >= 2 then
				WAR.PD['太极组合判定'][id] = 1
			end
		end
		------------------------------------------------------------------------------------
		-------------------------------------战意设定---------------------------------------
		------------------------------------------------------------------------------------
		--local aa = WAR.Person[i]["人物编号"]
        WAR.SPIRIT[id] = 10          --初始战意
		WAR.SPIRITMIN[id] = 5        --战意最低值
	    WAR.SPIRITMAX[id] = 200      --战意最高值
		--乔峰战意增加
		if match_ID(id, 50) then 
		    WAR.SPIRIT[id] = 30
		    WAR.SPIRITMIN[id] = 30	
		    WAR.SPIRITMAX[id] = 200	
	    end
		--独孤求败战意增加
		if match_ID(id, 592) then 
		    WAR.SPIRIT[id] = 50	
		    WAR.SPIRITMIN[id] = 50		
		    WAR.SPIRITMAX[id] = 200	
	    end
		--竹风雨滴战意增加
		if match_ID(id, 520) then 
		    WAR.SPIRIT[id] = 75	
		    WAR.SPIRITMIN[id] = 75		
		    WAR.SPIRITMAX[id] = 200	
	    end
		--鸠摩智
		if match_ID(id,103) then
			WAR.SPIRIT[id] = 50
		    WAR.SPIRITMIN[id] = 50		
		    WAR.SPIRITMAX[id] = 200	
		end	
		--玩家开场战意爆发
		if WAR.ZDDH == 456 and id == 0 then
			WAR.SPIRIT[id] = 200
		    WAR.SPIRITMIN[id] = 20		
		    WAR.SPIRITMAX[id] = 200	
		end	
		if WAR.ZDDH == 459 and id == 517 then
			WAR.SPIRIT[id] = 200
	        WAR.SPIRITMIN[id] = 20		
	        WAR.SPIRITMAX[id] = 200
	        WAR.LQZ[id] = 100
	    end 
		--天刀九问
		if PersonKF(id,335) and PersonKF(id,181) and PersonKF(id,203) then
			say("向武一心，持刀问天！！",id,1)
			WAR.SPIRIT[id] = math.modf(math.random(3,5)*10)
		end	
		--唐门模式1
		if MPTX(id,9) then 
			if inteam(id) then
				local hh2 = JYMsgBox("攻击模式", "请选择攻击模式？", {"惊羽决", "天罗诡道"}, 2, 569)	
				if hh2 <= 0 then
					return 0
				end
				if hh2 == 1 then 
					WAR.TMMS[id] = 1
				else 
				    WAR.TMMS[id] = 2 
				end
			else
			    WAR.TMMS[id] = 1
			--acsj()
			end
			--WAR.TMMS[WAR.Person[i]["人物编号"]] = 1
		end
		--无酒不欢：非我方开场自动运功
		if inteam(id) == false or WAR.Person[i]["我方"] == false then
			if JY.Person[id]["主运内功"] == 0 and JY.Person[id]["天赋内功"] == 0 and JY.Person[id]["畅想分阶"] > 5 then
				JY.Person[id]["主运内功"] = 225
			end
			if JY.Person[id]["主运内功"] == 0 and JY.Person[id]["天赋内功"] == 0 and JY.Person[id]["畅想分阶"] <= 5 and JY.Person[id]["畅想分阶"] > 2 then
				local clone_choice = CC.NG1[math.random(#CC.NG1)]
				JY.Person[id]["天赋内功"] = clone_choice
				JY.Person[id]["主运内功"] = clone_choice
			end
			if JY.Person[id]["主运内功"] == 0 and JY.Person[id]["天赋内功"] == 0 and JY.Person[id]["畅想分阶"] < 3 then
				local clone_choice = CC.NG2[math.random(#CC.NG2)]
				JY.Person[id]["天赋内功"] = clone_choice
				JY.Person[id]["主运内功"] = clone_choice
			end
			if JY.Person[id]["主运内功"] == 0 and JY.Person[id]["天赋内功"] > 0 then
				JY.Person[id]["主运内功"] = JY.Person[id]["天赋内功"]
			end
			--非我方自动运轻功
			if JY.Person[id]["主运轻功"] == 0 and JY.Person[id]["天赋轻功"] == 0 and JY.Person[id]["畅想分阶"] < 5 and JY.Person[id]["畅想分阶"] > 2 then
				local clone_choice = CC.QG1[math.random(#CC.QG1)]
				JY.Person[id]["主运轻功"] = clone_choice 
				if JY.Person[id]["天赋轻功"] == 0 and JY.Person[456]["论剑奖励"] > 0 then
					JY.Person[id]["天赋轻功"] = clone_choice
				end
			end	
			if JY.Person[id]["主运轻功"] == 0 and JY.Person[id]["天赋轻功"] == 0 and JY.Person[id]["畅想分阶"] < 3 then
				local clone_choice = CC.QG2[math.random(#CC.QG2)]
				JY.Person[id]["主运轻功"] = clone_choice 
				if JY.Person[id]["天赋轻功"] == 0 and JY.Person[456]["论剑奖励"] > 0 then
					JY.Person[id]["天赋轻功"] = clone_choice
				end
			end
			if JY.Person[id]["天赋轻功"] > 0 and JY.Person[id]["主运轻功"] == 0 then
			    JY.Person[id]["主运轻功"] = JY.Person[id]["天赋轻功"]
			end
			--极限挑战
			if JY.Person[456]["论剑奖励"] > 1 then
				if JY.Person[id]["门派技能1"] < 1 then
					JY.Person[id]["门派技能1"] = 1
					if JY.Person[id]["畅想分阶"] == 2 then
						local clone_choice = CC.NG1[math.random(#CC.NG1)]
						JY.Person[id]["门派技能1"] = clone_choice
					end
					if JY.Person[id]["畅想分阶"] < 2 then
						local clone_choice = CC.NG2[math.random(#CC.NG2)]
						JY.Person[id]["门派技能1"] = clone_choice
					end
				end
			end
			if id == 514 then
				if PersonKF(id,252) then
					JY.Person[id]["主运内功"] = 252
				end
				JY.Person[id]["主运轻功"] = 300
			end	
		end
		--点点诡计
		if WAR.ZDDH == 456 and match_ID(id,457) then
			say("小村传人，看在你曾经让我三招的情况下，我勉强给你加个buff吧！",id,457)
			WAR.PD['遮影'][457] = 0
			WAR.PD['影随'][0] = 0
			--WAR.PD['点点诡计'][id] = 1
			WAR.PD['无始无明'][id] = 1
			WAR.PD['九阳护盾'][id] = 9
			WAR.PD['怒涛剑气'][id] = 9
			WAR.PD['长生真气'][id] = 9
			WAR.PD['先天太极'][id] = 1
			WAR.JYZQ[id] = 9
			--WAR.Person[i]["我方"] = true
		end
 
		--葵花护盾
		if NGQH(id,105) or JXPD(id,19,1) or (Curr_NG(id,105) and match_ID(id,9967)) then
			WAR.PD['葵花护盾'][id] = 6
			if WAR.PD['葵花护盾'][id] ~= nil then 
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 7
				end
			end
			
		end
		--九阳护盾
		if NGQH(id,106) or (Curr_NG(id,106) and match_ID(id,9999)) then
			WAR.PD['九阳护盾'][id] = 9
			if WAR.PD['九阳护盾'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 6
				end
			end
		end
		--神足乾坤
		if NGQH(id,233) then
			WAR.PD['神足乾坤'][id] = 6
			if WAR.PD['神足乾坤'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 31
				end
			end
		end
		--易水寒
		if NGQH(id,43) then
			WAR.PD['易水寒冰'][id] = 10
			if WAR.PD['易水寒冰'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 33
				end
			end
		end
		--先天神照
		if NGQH(id,100) then
			WAR.XTZQ[id] = 7
		end
		--九阴破体真气
		if NGQH(id,107) or (Curr_NG(id,107) and match_ID(id,9929)) then
			WAR.JYZQ[id] = 9
		end	
		--阴阳二气
		if NGQH(id,171) then
			WAR.PD['阴阳二气'][id] = 9
			if WAR.PD['阴阳二气'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					if match_ID(id,5) or id == 0 then
						WAR.Person[i]['护盾'] = 25
					else 
					    WAR.Person[i]['护盾'] = 18
					end
				end
			end
		end
		--长生真气
		if NGQH(id,203) then
			WAR.PD['长生真气'][id] = 7
			if WAR.PD['长生真气'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 9
				end
			end
		end
		--怒涛气劲
		if NGQH(id,252) then
			WAR.PD['怒涛剑气'][id] = 9 
			if WAR.PD['怒涛剑气'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 8
				end
			end
		end
		--乾坤龟息
		if Curr_NG(id,97) and PersonKF(id,227) and isteam(id) then
			WAR.PD['明尊逆转'][id] = 1
		end 
		--五岳紫霞
		if (MPTX(id,14,2) and PersonKF(id,89)) or JXPD(id,19,1) then
			WAR.ZXQJ[id] = 10
		end
		--幽冥血河 
		if (PersonKF(id,160) and PersonKF(id,163)) or match_ID(id,97) then
			WAR.PD['幽冥血河1'][id] = 1
			for j = 0, WAR.PersonNum - 1 do
				local df = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false then
					if DWPD(i,j) then
						WAR.PD['幽冥血河2'][df] = 1
					end
				end
			end
			if id == 0 then
				local s = WAR.CurID
				WAR.CurID = i
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID,115, 1,'血河幽冥')
				WAR.CurID = s
			end
		end
		--萧远山杀破狼
		if match_ID(id,112) and JY.Person[id]["生命"] > 0 and WAR.ZHRM[id] == nil and WAR.XYS == 4 then
			WAR.LQZ[id] = 100
			WAR.XYS = 3
			local s = WAR.CurID
			WAR.CurID = i
			WarDrawMap(0); --不加这条则动画位置无法正常显示	
			CurIDTXDH(WAR.CurID, 122,1, "杀破狼", M_DeepSkyBlue, 50);		
			WAR.CurID = s
		end
		--观止
		if match_ID(id,456) then
			if JXPD(id,456,1) then
				WAR.PD['九命猫'][id] = 9
				WAR.QGZT[id] = 18
			end
			for j = 0, WAR.PersonNum - 1 do
				local df = WAR.Person[j]["人物编号"]
				if DWPD(i,j) and WAR.Person[j]["死亡"] == false then
					local s = WAR.CurID
					WAR.CurID = j
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID,245, 1,'往生轮')
					WAR.JYZT[df] = 1
					WAR.CurID = s
				end
			end
		end
		--东方亦
		if match_ID(id,457) then
			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 28
			end
			if Curr_NG(id,301) then
				WAR.PD['虚邪剑来'][id] = 1
			end
			if WAR.ZDDH == 456 then
				WAR.PD['虚邪夜玄'][id] = 15
				WAR.PD['虚邪极日1'][id] = 1
				WAR.PD['虚邪蚀月1'][id] = 1
				WAR.PD['虚邪止水'][id] = 1
				WAR.PD['虚邪散魂1'][id] = 1
				WAR.PD['虚邪乱魄1'][id] = 1
				WAR.PD['免疫反击'][id] = 1
			end
 		end
		--阿青・越女剑
		if match_ID(id,604) then
			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 29
			end
		end
		--默苍离
		if match_ID(id,750) then
			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 27
			end
		end
		--小瞎米
		if match_ID(id,759) then
			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 30
			end
		end
		--江澜
		if match_ID(id,775) then
			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 32
			end
		end
		--蛤蟆逆运
		if Curr_NG(id,95) and PersonKF(id,220) then
			WAR.HMJT[id] = 100
		end
		--御气纵横
		if match_ID(id,9945) then 
			if match_ID(id,456) then
				WAR.PD['御气纵横'][id] = 9
			else
			    WAR.PD['御气纵横'][id] = 20
			end
		end
		--无始无明
		if match_ID(id,517) then
			WAR.PD['无始无明'][id] = 1
			local XZ = {}
			for j = 0, WAR.PersonNum - 1 do
				if DWPD(WAR.CurID,j) and dead(j) == false then
					WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
					table.insert(XZ,j)   
				end
			end
			if XZ[1] ~= nil then
				local ri = XZ[math.random(#XZ)]
				if WAR.PD['遮影'][id] == nil then
					WAR.PD['遮影'][id] = WAR.Person[ri]["人物编号"]
					WAR.PD['影随'][id] = WAR.Person[ri]["人物编号"]
				end
			end
		end
		--先天太极
		if match_ID(id,520) then
			WAR.PD['剑气留形'][id] = 1
			WAR.PD['先天太极'][id] = 8
			if WAR.PD['先天太极'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 22
				end
			end
		end
		--倾国倾城
		if match_ID(id,754) or MPTX(id,26,3) then
			WAR.PD['倾国倾城'][id] = 5
			if WAR.PD['倾国倾城'][id] ~= nil then
				if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 26
				end
			end
		end
		--独孤剑意
		if (PersonKF(id,47) and PersonKF(id,184)) or match_ID(id,592) then
			WAR.DGJY[id] = 9
		end
		--全真剑气
		if PersonKF(id,39) and (PersonKF(id,100) or MPTX(id,16,2)) then 
			WAR.QZJQ[id] = 7
		end
		--坐忘无我
    	if Curr_NG(id,152) then
 	 		WAR.PD['坐忘无我'][id] = 1
 			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 1
			end	
		end		
		--佛法无边
		if (Curr_NG(id,96) or Curr_NG(id,91) or Curr_NG(id,108) or Curr_NG(id,144) or Curr_NG(id,208) or Curr_NG(id,243))
			and match_ID(id,9993) then
		    WAR.PD['金刚护盾'][id] = 400
		end
		--佛法无边
		if match_ID(id,114) then
			WAR.PD['无形气墙'][id] = 800
			--if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				--WAR.Person[i]['护盾'] = 11
			--end
		end
		--菩提金身
		if match_ID(id,577) then
			WAR.PD['金刚护盾'][id] = 2000
			WAR.PD['菩提金身'][id] = 1
			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 19
			end
		end	
		--破剑八刀
		if match_ID(id,9963) then
            if WAR.PD['破剑八刀'][id] == nil then
                WAR.PD['破剑八刀'][id] = 20
                WAR.PD['破剑八刀CD'][id] = 10
                if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
					WAR.Person[i]['护盾'] = 4
				end
				--WAR.Person[i]['护盾'] = 4
				local s = WAR.CurID
				WAR.CurID = i
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 132, 1,'破剑八刀')
				WAR.CurID = s
            end
        end	
		
		if WAR.PD['万毒炼体'][id] ~= nil then
			if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				WAR.Person[i]['护盾'] = 23
			end
		end
        --savetf(i)
	end
		
	if JY.Person[3]['品德'] == 100 then
		if WAR.ZDDH == 3 then
			NewWARPersonZJ(662, true, 29, 23, false, 2);
			WAR.Person[WAR.PersonNum - 1].Time = 1000
			WAR.LQZ[1] = 100
			WAR.SPIRIT[1] = 100
			WAR.SPIRITMIN[1] = 20
			WAR.SPIRITMAX[1] = 200
			say(JY.Person[0]['外号'].."，我来助你！",1, 0)	
			JY.Person[3]['品德'] = 99
		end
		if WAR.ZDDH == 431 then	
			NewWARPersonZJ(662, true, 31, 15, false, 2);
			WAR.Person[WAR.PersonNum - 1].Time = 1000
			WAR.LQZ[1] = 100
			WAR.SPIRIT[1] = 100
			WAR.SPIRITMIN[1] = 20
			WAR.SPIRITMAX[1] = 200
			NewWARPersonZJ(2, true, 32, 15, false, 2);
			WAR.Person[WAR.PersonNum - 1].Time = 1000
			WAR.LQZ[2] = 100
			WAR.SPIRIT[2] = 100
			WAR.SPIRITMIN[2] = 20
			WAR.SPIRITMAX[2] = 200
			say(JY.Person[0]['外号'].."，我们来助你！",1, 0)	
			JY.Person[3]['品德'] = 99
		end	
		if WAR.ZDDH == 433 then	
			NewWARPersonZJ(662, true, 24, 27, false, 2);
			WAR.Person[WAR.PersonNum - 1].Time = 1000
			WAR.LQZ[1] = 100
			WAR.SPIRIT[1] = 100
			WAR.SPIRITMIN[1] = 20
			WAR.SPIRITMAX[1] = 200
			NewWARPersonZJ(2, true, 24, 29, false, 2);
			WAR.Person[WAR.PersonNum - 1].Time = 1000
			WAR.LQZ[2] = 100
			WAR.SPIRIT[2] = 100
			WAR.SPIRITMIN[2] = 20
			WAR.SPIRITMAX[2] = 200
			say(JY.Person[0]['外号'].."，我们来助你！",1, 0)	
			JY.Person[3]['品德'] = 99
		end	
		
	end	
	
	--携带物品的初始化
	for a = 0, WAR.PersonNum - 1 do
		for s = 1, 4 do
			if JY.Person[WAR.Person[a]["人物编号"]]["携带物品数量" .. s] == nil or JY.Person[WAR.Person[a]["人物编号"]]["携带物品数量" .. s] < 1 then
				JY.Person[WAR.Person[a]["人物编号"]]["携带物品" .. s] = -1
				JY.Person[WAR.Person[a]["人物编号"]]["携带物品数量" .. s] = 0;
			end
		end
	end
	
	--笑傲邪线，黑木崖如果单挑东方不败，则东方会以葵花尊者形态出战
	if WAR.ZDDH == 54 and WAR.MCRS == 1 then
		local dfid;
		for i = 0, WAR.PersonNum - 1 do
			local id = WAR.Person[i]["人物编号"]
			if id == 27 then
				dfid = i;
				break
			end
		end
		local orid = WAR.CurID
		WAR.CurID = dfid
		
		Cls()
		local KHZZ = {"面对本座","对方竟敢单独出战","伤自尊啊"}
		
		for n = 1, #KHZZ + 25 do
			local i = n 
			if i > #KHZZ then 
				i = #KHZZ
			end
			lib.GetKey()
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			DrawString(-1, -1, KHZZ[i], C_GOLD, CC.Fontsmall)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
		Cls()
		CurIDTXDH(WAR.CurID, 7, 1)
		
		for n = 1,50 do
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.Background(0,200,CC.ScreenW,400,78)
			NewDrawString(CC.ScreenW, CC.ScreenH/2 + 160, "葵花诀尊者形态", C_GOLD, 80)
			NewDrawString(CC.ScreenW, CC.ScreenH/2 + 360, "看吧 东方在赤红的燃烧", C_RED, 70)
			
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
		Cls()
		local KHZZ2 = {"不知死活的"..JY.Person[0]["外号2"],"好好体验一下死亡的恐怖吧"}

		for n = 1, #KHZZ2 + 25 do
			local i = n 
			if i > #KHZZ2 then 
				i = #KHZZ2
			end
			lib.GetKey()
			Cat('实时特效动画')
      Cls()
      Cat('实时特效动画2')
			DrawString(-1, -1, KHZZ2[i], C_GOLD, CC.Fontsmall)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
		WAR.CurID = orid
	end
	--[[
	if WAR.ZDDH == 348 then
		for n = 1,50 do
			local j = 70 + n
			local k = 60 + n
			if j > 80 then 
				j = 80 
			end
			if k > 70 then 
				k = 70 
			end
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.Background(0,200,CC.ScreenW,400,78)
			NewDrawString(CC.ScreenW, CC.ScreenH/2 + 160, "四神之阵", C_GOLD, j)
			NewDrawString(CC.ScreenW, CC.ScreenH/2 + 360, "风林火山", C_RED, k)
			
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
		Cat('天关阵')
		--local 
		--WAR.PD['天关阵4'] = {5,27,50,114}
	end
	]]
	--圣火三使战开局的文字特效
	if WAR.ZDDH == 14 then
		say("Ｇ１妙风使！", 173, 0)   --妙风使
		say("Ｇ１流云使！", 174, 1)   --流云使
		say("Ｇ１辉月使！Ｈ圣火三绝阵！", 175, 5)   --辉月使！Ｈ圣火三绝阵！
   
		for n = 15,50 do
            local i = n 
            if i > 35 then 
                i = 35   
            end
            lib.GetKey()
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.GetKey()
			NewDrawString(-1, -1, "圣火三绝阵", C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
	
	if WAR.ZDDH == 453 then
		for n = 15,50 do
            local i = n 
            if i > 35 then 
                i = 35   
            end
            lib.GetKey()
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.GetKey()
			NewDrawString(-1, -1, "森 罗 六 合", C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
	
	if WAR.ZDDH == 437 then
		if WAR.PD['雪羽战神'][514] == nil then
			say('来吧，就让你们见识雪羽的骄傲！',514,0)
			WAR.PD['雪羽战神'][514] = 1
			WAR.PD['战神状态'][514] = 999
			WAR.PD['五宝花蜜酒'][514] = 999
		end
	end	
	if WAR.ZDDH == 438 then
		if WAR.PD['雪羽战神'][514] == nil then
			say('百损，此事与你无关，你又是何苦来淌这浑水',514,0)
			say('闭嘴！你的命只有我能取！',523,0)
			say('好个鹣鲽情深大戏啊！你们便是齐上，我又何惧？',0,1)
			WAR.PD['雪羽战神'][514] = 1
			WAR.PD['战神状态'][514] = 999
			WAR.PD['五宝花蜜酒'][514] = 999
		end
	end
	if WAR.ZDDH == 439 then
		say('可恶，居然是喵姐亲临战斗！今日我怕命不久矣！',514,0)
		say('宗主莫慌，看我们寄出杀破狼大阵，化腐朽为神奇！',524,0)
		say('宗主，我也来助你一臂之力！',760,0)
		--say('你们一起上吧，我和喵姐合力砍杀你们！',0,1)
		if WAR.PD['雪羽战神'][514] == nil then
			WAR.PD['雪羽战神'][514] = 1
			WAR.PD['五宝花蜜酒'][514] = 999
		end
	end
	--一灯保护大战
	if WAR.ZDDH == 68 then
		say("不好，师父面对敌人又要心慈手软！", 122, 0)  --对话			
		say("我们快快启用大理四象阵，将师父护在中心", 122, 0)  --对话
		say("<阿弥陀佛>", 65, 0)  --对话	
		say("？？？？？？？？？？？？？？？", 0, 1)  --对话
	end	
	
	--飞飞
	if WAR.ZDDH == 166 then
		say("想当年我们姐妹四人结义金兰，誓要尝尽天下美食！", 455, 0)  --对话			
		say("多年过去，大姐隐居深山，牧羊为乐。二姐已为人妇，相夫教子。小妹随师游历，逍遥浮生。", 455, 0)  --对话
		say("而我，依然不忘初衷。", 455, 0)  --对话	
		say("？？？？？？？？？？？？？？？", 0, 1)  --对话
	end	
	
	--丁不四
	if WAR.ZDDH == 166 then
		say("没想到吧，小老儿我在这埋伏了一手", 163, 0)	  --对话
	end
	
	--李小妹狙击小慕容
	if WAR.ZDDH == 406 then
		say("哎，还是来晚了一步。", 522, 0,"???")	  --对话
		say("哪里来的贼人，居然敢偷袭你慕容爷爷，让你看看慕容家的武学。", 51, 0)	  --对话
		say("慕容家除了斗转星移，其他武学不值一提。", 522, 0,"???")	  --对话
		say("如此狂妄之徒，看招，这就是慕容家的武学。", 51, 0)	  --对话
		say("区区参合指，不过就是一门点穴功夫而已，杀伤力更是渺小。", 522, 0,"???")	  --对话
		say("让你看看什么是真正的武学。", 522, 0,"???")	  --对话
		say("<大惊>这不是虚竹所使的天山六阳掌吗？你到底是谁？？？？", 51, 0,"???")	  --对话
	end 	
	
	--丁当狙击主角
	if WAR.ZDDH == 405 then
		say("你是何人？为什么要偷袭我？", 0, 1)  --对话
		say("因为你把我妹子弄哭了，我就是来揍你的。", 521, 0,"???")	  --对话
		say("你妹子是何人啊？我都没见过。", 0, 1)  --对话
		say("我妹子叫做丁。", 521, 0,"???")	  --对话
		say("就是让我偷酒的小姑娘？我没怎么欺负她呀！", 0, 1)	  --对话
		say("你打了他的心上人石破天。", 521, 0,"???")	  --对话
		say("这............", 0, 1)	  --对话
		say("既然你已经默认了，就不要怪我手下无情。", 521, 0,"???")	  --对话
		say("来呀，谁怕谁！", 0, 1)	  --对话
	end
	--侠客正太玄战李白对话
	if WAR.ZDDH == 302 then
		say("Ｄ２蓬莱文章建安骨，中间小谢又清发。", 636, 0)
		say("Ｄ２俱怀逸兴壮思飞，欲上青天览明月。", 0, 1)
		say("Ｄ２抽刀断水水更流，举杯消愁愁更愁。", 636, 0)
		say("Ｄ２人生在世不称意，明朝散发弄扁舟。", 0, 1)
	end
	
	--天正第五战
	if WAR.ZDDH == 81 then
		say("Ｒ２＜今日一战，如果败了，我慕容复还有何颜面再苟活于世？定要殊死一搏！＞", 51, 0)	
		say("Ｒ２＜古来成大功业者，哪一个不历尽千辛万苦？汉高祖有白登之困，汉光武有冀北之厄，你连勾践、韩信也不如，当真无知无识！姑苏慕容氏的家传武功神奇精奥，当世罕有，只不过你没学到家而已。＞", 113, 0)
	end
	
	--天邪第五战
	if WAR.ZDDH == 251 then
		say("Ｒ２＜你……你是我爹爹……＞", 50, 0)
		say("Ｒ２＜好孩子，好孩儿，我正是你的爹爹。咱爷儿俩一般的身形相貌，不用记认，谁都知道我是你的老子。＞", 112, 0)
	end
	
	--神正单挑金轮
	if WAR.ZDDH == 275 then
		say("Ｒ２＜郭襄大喜，凝目望那两人时，但见左首一人青冠黄衫，正是杨过，右首那人白衣飘飘，却是个美貌女子。两人各执长剑，舞起一团白光，随在神雕身后，冲向高台。郭襄失声叫道“大哥哥，这位就是小龙女么？””＞", 626, 0)
		for n = 15,50 do
			local i = n 
			if i > 35 then 
				i = 35   
			end
			lib.GetKey()
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.GetKey()
			NewDrawString(-1, -1, "龙象般若功.十龙十象", C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)	
		end
		SetJX(62, 1)
		instruct_35(62,4,144,999)
		instruct_35(62,5,196,999)
	end
  
	--论剑打赢阿凡提奖励，绝对先手，且全场敌方位置-500
	if WAR.ZDDH > 0 then
		for j = 0, WAR.PersonNum - 1 do
			if JY.Person[606]["论剑奖励"] == 1 then
				if WAR.Person[j]["人物编号"] == 0  then
					WAR.Person[j].Time = 1005
				else	
					if WAR.Person[j]["我方"] then
						WAR.Person[j].Time = WAR.Person[j].Time - 75
					else
						WAR.Person[j].Time = WAR.Person[j].Time - 500
					end
					if WAR.Person[j].Time < -200 then
						WAR.Person[j].Time = -200
					end
					if WAR.Person[j].Time > 990 then
						WAR.Person[j].Time = 990
					end
				end	
			else	
			end
		end	
	end
	--密道成昆战，我方集气全体为0
	if WAR.ZDDH == 237 then
		for a = 0, WAR.PersonNum - 1 do
			if WAR.Person[a]["我方"] == true then
				WAR.Person[a].Time = 0
			end
		end
	end
	--天关战役，我方集气全体为0
	if WAR.ZDDH == 348 or WAR.ZDDH == 349 or WAR.ZDDH == 350 or WAR.ZDDH == 356 
	    or WAR.ZDDH == 357 or WAR.ZDDH == 358 or WAR.ZDDH == 359 or WAR.ZDDH == 360  then
		for a = 0, WAR.PersonNum - 1 do
			if WAR.Person[a]["我方"] == true then
				WAR.Person[a].Time = 0
			else
				WAR.Person[a].Time = 1000
			end
		end
	end
	--杀破狼阵法
	if WAR.ZDDH == 430 or WAR.ZDDH == 439 then
		for a = 0, WAR.PersonNum - 1 do
			if WAR.Person[a]["我方"] == true then
				WAR.Person[a].Time = 0
			else
				WAR.Person[a].Time = 1000
			end
		end
	end
	--中华阁噩梦谢
	if WAR.ZDDH == 408 then
		for a = 0, WAR.PersonNum - 1 do
			if WAR.Person[a]["我方"] == true then
				WAR.Person[a].Time = 0
			else
				WAR.Person[a].Time = 1000
			end
		end
	end
	--不老长春谷，我方集气全体为0
	if WAR.ZDDH == 303 then
		for a = 0, WAR.PersonNum - 1 do
			if WAR.Person[a]["我方"] == true then
				WAR.Person[a].Time = 0
			else
				WAR.Person[a].Time = 1000
			end
		end
	end
	--六脉剑阵
	if WAR.ZDDH == 376 then
		for a = 0, WAR.PersonNum - 1 do
			if WAR.Person[a]["我方"] == true then
				WAR.Person[a].Time = -200
			else
				WAR.Person[a].Time = 1000
			end
		end
		for n = 15,50 do
            local i = n 
            if i > 35 then 
                i = 35   
            end
            lib.GetKey()
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.GetKey()
			NewDrawString(-1, -1, "六脉剑阵・启！", C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
	if WAR.ZDDH == 226 and JY.Person[0]['六如觉醒'] == 2 then
		local pd = 0
		for i = 0, WAR.PersonNum - 1 do
			local id = WAR.Person[i]["人物编号"]
			if id == 591 then
				pd = pd + 1
			end
			if id == 0 then
				pd = pd + 1
			end
		end
		if actor(0,10) and pd == 2 then 
			say('你来了，我等你很久了。',591,0)
			say('你是？？',0,1)
			say('我就是你，你也是我。',591,0)
			say('我不明白你在说什么...',0,1)
			say('打败我，你自然会明白，来吧！',591,0)
			WAR.JXCSPD = 1
		end
	end
	--丐帮打狗阵
	if WAR.ZDDH ==  344  then
		for n = 15,50 do
            local i = n 
            if i > 35 then 
                i = 35   
            end
            lib.GetKey()
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.GetKey()
			NewDrawString(-1, -1, "真.打狗阵", C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
	--梁萧 谐之道・归藏
	if WAR.ZDDH > 0 and JXPD(0,635,1) then
		for n = 15,50 do
            local i = n 
            if i > 35 then 
                i = 35   
            end
            lib.GetKey()
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.GetKey()
			NewDrawString(-1, -1, "谐之道・归藏", C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
	--陆渐 海之道・海纳百川
	if WAR.ZDDH > 0 and JXPD(0,497,1) then
		for n = 15,50 do
            local i = n 
            if i > 35 then 
                i = 35   
            end
            lib.GetKey()
			Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
			lib.GetKey()
			NewDrawString(-1, -1, "海之道・海纳百川", C_GOLD, CC.DefaultFont+i*2)
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end	
	if WAR.ZDDH == 437 or WAR.ZDDH == 438 then 
	  	for a = 0, WAR.PersonNum - 1 do
	      	if match_ID(WAR.Person[a]["人物编号"], 514) then 
	        	for i = 40, 80 do
	            	NewDrawString(-1, -1, "霜风雪羽 战神再临", C_GOLD, i)
	            	ShowScreen()
	            	if i == 80 then
	                	Cls()
	                	NewDrawString(-1, -1, "霜风雪羽 战神再临", C_GOLD, i)
	                	ShowScreen()
	                	lib.Delay(400)
	                	--WaitKey()
	            	else
	                	lib.Delay(1)
	           		end
	        	end
	    	end
		end
	end
	if WAR.ZDDH >= 0 then 
        for a = 0, WAR.PersonNum - 1 do
            if match_ID(WAR.Person[a]["人物编号"], 5) then 
                for i = 40, 80 do
                    NewDrawString(-1, -1, "阴阳无极 太极宗师", C_GOLD, i)
                    ShowScreen()
                    if i == 80 then
                        Cls()
                        NewDrawString(-1, -1, "阴阳无极 太极宗师", C_GOLD, i)
                        ShowScreen()
                        lib.Delay(400)
                        --WaitKey()
                    else
                        lib.Delay(1)
                    end
                end
	        end
	        if YaoFengHuoShi(WAR.Person[a]["人物编号"],0) then 
                for i = 40, 80 do
                    NewDrawString(-1, -1, "狂沙漫天・妖风祸世", C_GOLD, i)
                    ShowScreen()
                    if i == 80 then
                        Cls()
                        NewDrawString(-1, -1, "狂沙漫天・妖风祸世", C_GOLD, i)
                        ShowScreen()
                        lib.Delay(400)
                        --WaitKey()
                    else
                        lib.Delay(1)
                    end
                end
                WAR.YFHS = 1
	        end
	        if match_ID(WAR.Person[a]["人物编号"], 592) then 
                for i = 40, 80 do
                    NewDrawString(-1, -1, "无剑真魔 但求一败", C_GOLD, i)
                    ShowScreen()
                    if i == 80 then
                        Cls()
                        NewDrawString(-1, -1, "无剑真魔 但求一败", C_GOLD, i)
                        ShowScreen()
                        lib.Delay(400)
                        --WaitKey()
                    else
                        lib.Delay(1)
                    end
                end
	        end
	        if match_ID(WAR.Person[a]["人物编号"], 634) then 
                for i = 40, 80 do
                    NewDrawString(-1, -1, "隐世高人 逍遥祖师", C_GOLD, i)
                    ShowScreen()
                    if i == 80 then
                        Cls()
                        NewDrawString(-1, -1, "隐世高人 逍遥祖师", C_GOLD, i)
                        ShowScreen()
                        lib.Delay(400)
                        --WaitKey()
                    else
                        lib.Delay(1)
                    end
                end
	        end
	        if match_ID(WAR.Person[a]["人物编号"], 637) then 
                for i = 40, 80 do
                    NewDrawString(-1, -1, "万寿道藏 九阴作者", C_GOLD, i)
                    ShowScreen()
                    if i == 80 then
                        Cls()
                        NewDrawString(-1, -1, "万寿道藏 九阴作者", C_GOLD, i)
                        ShowScreen()
                        lib.Delay(400)
                        --WaitKey()
                    else
                        lib.Delay(1)
                    end
                end
	        end
	    end
    end
		
	--组合动画显示
	if CC.CoupleDisplay == 1 then
		local function fightcombo()
			local combo = {}
			for i = 1, #CC.COMBO do
				combo[i] = {CC.COMBO[i][1], CC.COMBO[i][2], CC.COMBO[i][3],0}
			end
			for i = 0, WAR.PersonNum - 1 do
				local t = WAR.Person[i]["人物编号"]
				for j = 1, #combo do
					lib.GetKey()
					if match_ID(t, combo[j][1]) then
						for z = 0, WAR.PersonNum - 1 do
							local t2 = WAR.Person[z]["人物编号"]
							if match_ID(t2, combo[j][2]) and WAR.Person[i]["我方"] == WAR.Person[z]["我方"] then
								combo[j][4] = 1
								break
							end
						end
					end
				end
			end
			for i = 1, #combo do
				if combo[i][4] == 1 then
					local t1 = combo[i][1]
					local t2 = combo[i][2]
					for k = 0, 20 do
                        local j = k 
                        if k > 10 then 
                           k = 10   
                        end
						lib.GetKey()
						local str = JY.Person[t1]["姓名"].."＆"..JY.Person[t2]["姓名"]
						local str2 = combo[i][3]
                        Cat('实时特效动画')
                        Cls()
                        Cat('实时特效动画2')
						DrawBox(150, CC.ScreenH / 3 + 30, CC.ScreenW - 150, CC.ScreenH / 3 * 2 - 20, C_BLACK)
						lib.LoadPNG(1, JY.Person[t1]["半身像"]*2, CC.ScreenW / 4 - 80, CC.ScreenH / 2 - 35, 1)
						lib.LoadPNG(1, JY.Person[t2]["半身像"]*2, CC.ScreenW / 4 + 50, CC.ScreenH / 2 - 35, 1)
						NewDrawString(CC.ScreenW / 2 * 3 - 170, CC.ScreenH + 120, str, C_ORANGE, 25)	
						NewDrawString(CC.ScreenW / 2 * 3 - 170, -1, str2, C_GOLD, 50 + j)
						ShowScreen()							
						lib.Delay(CC.BattleDelay)
					end		
				end
			end
		end
		fightcombo()
	end

	warStatus = 0
	buzhen()	
	
	--Pre_Yungong()	--无酒不欢：战前运功
	
	--黄蓉奇门遁甲，我方才触发
	for j = 0, WAR.PersonNum - 1 do
		if match_ID(WAR.Person[j]["人物编号"], 56) and WAR.Person[j]["我方"] == true then
			WarNewLand(j, WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"])
			break
		end
	end
	

	
	WAR.Delay = GetJiqi()
	local startt, endt = lib.GetTime()
	--战斗主循环
    while true do
		if JY.Restart == 1 then
			return false
		end
		local p = -1
		local id = -1
		WAR.ShowHead = 0
		WAR.CurID = DrawTimeBar()
		if WAR.ZYHB == 1 then
			WAR.ZYHB = 2
		end
		if WAR.ZHB == 1 then
			WAR.ZHB = 2
			--WAR.PD['真左右互搏'][WAR.Person[WAR.CurID]['人物编号']] = 1
		end
		if WAR.ATK['中断'] == true then
			WAR.ATK['中断'] = false
			goto label0
		end
		Cat('人物移动步数')
		WarDrawMap(0)
		lib.GetKey()
		ShowScreen()
		p = WAR.CurID
		id = WAR.Person[p]["人物编号"]
		if WAR.PD['插队判定'][id] ~= nil then
			WAR.PD['插队判定'][id] = nil 
		end
		WAR.PD['动画判定'][id] = nil
		if 0 < War_isEnd() then
			goto label0
		end
		if WAR.Person[p]["死亡"] == false and JY.Person[id]['生命'] > 0 then
	      	WAR.Person[p].Time = 1000
		    --Cat('遮影',p)
		    Cat('实时特效动画')
	        WarDrawMap(0)
	        Cat('实时特效动画2')
	        local keypress = lib.GetKey()
			if WAR.AutoFight == 1 and (keypress == VK_SPACE or keypress == VK_RETURN) then
				WAR.AutoFight = 0
			end
			if keypress == VK_Z  then 
				Ckstatus()
			end
			ShowScreen()
			lib.Delay(CC.BattleDelay)
			WAR.ShowHead = 0
			WAR.Person[p].TimeAdd = 0
			local r = nil
			local pid = WAR.Person[WAR.CurID]["人物编号"]
			WAR.Defup[pid] = nil
			--逍遥御风，行动前恢复
			--左右第二下不会清0
			if WAR.XYYF[pid] ~= nil and WAR.XYYF[pid] == 11 and WAR.ZYHB ~= 2 then
				WAR.XYYF[pid] = nil
			end
			--段誉的指令，行动前恢复
	        if match_ID(pid, 53) then
				WAR.TZ_DY = 0
	        end
			--慕容复的指令，行动前恢复
	        if match_ID(pid, 51) then
				WAR.TZ_MRF = 0
	        end
			WAR.ZSSS = 0		--张三
			WAR.LSFE = 0		--李四
			WAR.MTSD = 0        --喵太极
			--花铁杆
			if pid==0 and JY.Base["畅想"] == 52 then
				CurIDTXDH(WAR.CurID, 104,1,"文体两开花",LimeGreen);
				local clone_choice = CC.HTG[math.random(#CC.HTG)]
				JY.Person[0]["代号"]=JY.Person[clone_choice]["代号"]
				JY.Person[0]["姓名"] = JY.Person[clone_choice]["姓名"]
				JY.Person[0]["头像代号"]=JY.Person[clone_choice]["头像代号"]
			    JY.Person[0]["半身像"]=JY.Person[clone_choice]["半身像"]		
				for i=1,5 do
				JY.Person[0]["出招动画帧数" .. i]=JY.Person[clone_choice]["出招动画帧数" .. i]
				JY.Person[0]["出招动画延迟" .. i]=JY.Person[clone_choice]["出招动画延迟" .. i]
				JY.Person[0]["武功音效延迟" .. i]=JY.Person[clone_choice]["武功音效延迟" .. i]
				end
				if JY.Person[clone_choice]["武功1"] > 0 then
					JY.Person[0]["武功1"]=JY.Person[clone_choice]["武功1"]
				end
				savewg(WAR.CurID)
				CurIDTXDH(WAR.CurID, 104,1,"文体两开花",LimeGreen);
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
	            SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
				WarDrawMap(0)
				DrawTimeBar2()
			end
			--达摩天下武功出少林
			if match_ID(pid,577) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示183
				CurIDTXDH(WAR.CurID, 183,1,"天下武功出少林",LimeGreen);
				local clone_choice = math.random(3,42)
				local clone_choice1 = math.random(43,84)
				local clone_choice2 = math.random(109,143)
				local clone_choice3 = math.random(151,185)
				local clone_choice4 = math.random(187,194)
				local clone_choice5 = math.random(244,279)
				local clone_choice6 = math.random(304,357)
				local num = math.random(7)
				if num == 1 then
				    JY.Person[577]["武功4"] = clone_choice
				    JY.Person[577]["武功等级4"] = 999
				elseif num == 2 then
				    JY.Person[577]["武功4"] = clone_choice1
				    JY.Person[577]["武功等级4"] = 999
				elseif num == 3 then
				    JY.Person[577]["武功4"] = clone_choice2
				    JY.Person[577]["武功等级4"] = 999
				elseif num == 4 then
				    JY.Person[577]["武功4"] = clone_choice3
				    JY.Person[577]["武功等级4"] = 999
				elseif num == 5 then
				    JY.Person[577]["武功4"] = clone_choice4
				    JY.Person[577]["武功等级4"] = 999
				elseif num == 6 then
				    JY.Person[577]["武功4"] = clone_choice5
				    JY.Person[577]["武功等级4"] = 999
				else
				    JY.Person[577]["武功4"] = clone_choice6
				    JY.Person[577]["武功等级4"] = 999
				end
				JY.Person[577]["优先使用"] = JY.Person[577]["武功4"]
				savewg(WAR.CurID)
				DrawTimeBar2()
			end
			--合体技重置
	        if WAR.HEJI ~= 0 then 
			    WAR.HEJI = 0 
			end		
			--行动步数计算重置
			if WAR.YDBS > 0 then
				WAR.YDBS = 0
			end	
			if WAR.LBPM > 0 then
				WAR.LBPM = 0
			end
			--对招重置
			if WAR.DUIZHAO > 0 then 
			    WAR.DUIZHAO = 0 
			end
			--明教重置
			if MPTX(pid,13) then 
				WAR.PD["明教指令1"][pid] = 0
				WAR.PD["明教指令2"][pid] = 0			
			end
			
			--金蛇幻毒
			local jshd = {}
			if (JY.Person[pid]["门派技能2"] == 490 and math.random(10) > 7) or ((JXPD(pid,54,1) or match_ID(pid,83)) and JLSD(0,30,pid)) then
				for jsd = 0, WAR.PersonNum-1 do 
					if WAR.Person[WAR.CurID]['我方']~= WAR.Person[jsd]["我方"] and WAR.Person[jsd]["死亡"] == false then
						local jsdid = WAR.Person[jsd]["人物编号"]
						if WAR.PD['金蛇幻毒'][jsdid] ~= nil then
							jshd[#jshd + 1] = jsd
							local a = math.modf((JY.Person[jsdid]["流血程度"]+JY.Person[jsdid]["中毒程度"]+80)*WAR.PD['金蛇幻毒'][jsdid])
							local b = math.modf(a*1.5)
							ztd(jsd,"生命点数", -a)
							ztd(jsd,"内力点数", -b)
							--WAR.TXXS[jsdid] = 1	
							WAR.PD['金蛇幻毒'][jsdid] = nil
						end
					end
				end
				if #jshd > 0 then
					Cls()
					local ssid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
					for ii = 2984,3001 do
						for ji = 1, #jshd do
							local jindex = jshd[ji];
							--1355, 1365   1343,1353
							--for ii = 1574, 1578 do
							--for ii = 1610, 1616 do
							local x0 = WAR.Person[WAR.CurID]["坐标X"]
							local y0 = WAR.Person[WAR.CurID]["坐标Y"]
							local dx = WAR.Person[jindex]["坐标X"] - x0
							local dy = WAR.Person[jindex]["坐标Y"] - y0
							local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
							local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
							local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)
							if CONFIG.Zoom == 1 then
								hb = hb * 2
							end
							ry = ry - hb
							lib.PicLoadCache(3, ii*2, rx, ry, 0)
							DrawString(rx - 130, ry - 5, "金蛇幻毒・爆发", C_GOLD, 30)
						end
						ShowScreen()
						lib.Delay(40)
						lib.LoadSur(ssid, 0, 0)
					end
					lib.FreeSur(ssid)
				end	
			end
			--小星辰法
			if NGQHB(pid,219) then
				local n = 0
				for j = 0, WAR.PersonNum-1 do
					if WAR.Person[j]['死亡'] == false and DWPD(j,p) then
						n = n + 0.02
					end
				end
				if n > 0.6 then n = 0.6 end
				for hf = 0, WAR.PersonNum -1 do
					if WAR.Person[hf]["死亡"] == false and DWPD(hf,p) == false then
						local hfid = WAR.Person[hf]["人物编号"]
						ztd(hf,"生命点数",math.modf(psx(hfid,"生命最大值")*n))
						ztd(hf,"内力点数",math.modf(psx(hfid,"内力最大值")*n))
						ztd(hf,"体力点数",math.modf(100*n))
					end
				end	
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 72,1,"群星之力・天河",M_DeepSkyBlue)
			end
			--胡刀三刀
			if PersonKF(pid,67) and (Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350) or match_ID(pid,633) or JXPD(pid,1,1)) then
				local a = math.random(3)
				if a == 1 then
					War_ActupMenu()
				elseif a == 2 then
					War_DefupMenu()
				elseif a == 3 then
					War_RestMenu()
				end	
			end
			--极限挑战npc行动前
			if (not inteam(pid)) and JY.Person[456]["论剑奖励"] > 0 then
				local jx = {70,60,35,20,12,8,5,0}
				local jsjx = jx[JY.Person[pid]['畅想分阶']+1]
			    if math.random(100) <= jsjx then
				local a = math.random(3)
				    if a == 1 then
						War_RestMenu()
					elseif a == 2 then
					    if WAR.Focus[pid] == nil then
							War_Focus()
						end
					elseif a == 3 then
					    War_ActupMenu()
					end
				end
				if math.random(100) <= jsjx then
					ztd(WAR.CurID,'生命点数',JY.Base["周目"]*4)
				end
				if math.random(100) <= jsjx then
					ztd(WAR.CurID,'内力点数',JY.Base["周目"]*4)
				end
				if math.random(100) <= jsjx then
					ztd(WAR.CurID,'体力点数',4)
				end
				if math.random(100) <= jsjx then
					nuqi(pid,4)
				end
				if math.random(100) <= jsjx then
					zhanyi(pid,4)
				end 
			end
			--般若金刚行动前
			if QFZH(pid,189,91) then
				local yjin = 0
				for j = 1, JY.Base['武功数量'] do 
					local wugong = JY.Person[pid]['武功'..j]
					if PersonKF(pid,91) or PersonKF(pid,96) or PersonKF(pid,106) or PersonKF(pid,108) or PersonKF(pid,144) or PersonKF(pid,208) or PersonKF(pid,242) or PersonKF(pid,243) or PersonKF(pid,247) then
						yjin = yjin + 1
					end
				end
				if math.random(10) <= yjin then
					War_Focus()
				end
			end
			if WAR.SPIRIT[pid] == nil then
				WAR.SPIRIT[pid] = 10
			end
			--行动前战意爆发
			if WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[pid] >= 200 and WAR.PD["战意爆发"][pid] == nil then
				WAR.SPIRIT[pid] = 200
				local s = WAR.CurID
				--WAR.CurID = i
				WarDrawMap(0)
				--CurIDTXDH(WAR.CurID, 6, 1, "战意爆发")
				WAR.PD["战意爆发"][pid] = 1
			end
			-----------------------------------------------------------------------------------
			--------------------------------行动前特效恢复-------------------------------------
			-----------------------------------------------------------------------------------
			if WAR.PD['内伤恢复'][pid] ~= nil then
				WAR.PD['内伤恢复'][pid] = nil
			end	
			if WAR.PD['冰封恢复'][pid] ~= nil then
				WAR.PD['冰封恢复'][pid] = nil
			end	
			if WAR.PD['灼烧恢复'][pid] ~= nil then
				WAR.PD['灼烧恢复'][pid] = nil
			end	
			if WAR.PD['封穴恢复'][pid] ~= nil then
				WAR.PD['封穴恢复'][pid] = nil
			end	
			if WAR.PD['中毒恢复'][pid] ~= nil then
				WAR.PD['中毒恢复'][pid] = nil
			end	
			if WAR.PD['流血恢复'][pid] ~= nil then
				WAR.PD['流血恢复'][pid] = nil
			end	
			if WAR.PD['体力恢复'][pid] ~= nil then
				WAR.PD['体力恢复'][pid] = nil
			end
			if WAR.PD['怯战状态'][pid] ~= nil then
				WAR.PD['怯战状态'][pid] = nil
			end
			if WAR.PD['不败金刚'][pid] ~= nil and WAR.PD['不败金刚'][pid] > 0 then
				local jg = math.modf((WAR.PD['不败金刚'][pid] or 0)/2)
				local xxx = 2
				if jg > 300 then
					WAR.Person[WAR.CurID]['生命点数'] = (WAR.Person[WAR.CurID]['生命点数'] or 0) + AddPersonAttrib(pid,'生命',-jg)
					xxx ="不败金刚转化溢出伤害"..jg
					DrawStrBox(-1,-1,xxx,C_GOLD,CC.Fontbig);
					ShowScreen();
					lib.Delay(400);
					Cls()
				end
				WAR.PD['不败金刚'][pid] = nil
			end
			if WAR.PD['雪羽战神'][pid] ~= nil then
				Cat('清除所有异常',WAR.CurID)
			end
			if WAR.PD['血战到底'][pid] ~= nil and WAR.PD['血战到底'][pid] == 1 then
				if JY.Person[pid]['畅想分阶'] < 3 then
					Cat('清除高级异常',WAR.CurID)
					if JY.Person[pid]['畅想分阶'] < 2 then
						Cat('清除所有异常',WAR.CurID)
					end
				end
			end
			if WAR.PD['仙息护体'][pid] ~= nil then
				local xx = math.modf((WAR.PD['仙息护体'][pid] or 0)/2)
				local xxx = 2
				if xx > 0 then
					ztd(WAR.CurID,'生命点数',xx)
					ztd(WAR.CurID,'内力点数',xx)
					xxx ="九霄仙息恢复生命、内力"..xx
					DrawStrBox(-1,-1,xxx,C_GOLD,CC.Fontbig);
					ShowScreen();
					lib.Delay(400);
					Cls()
				end
				WAR.PD['仙息护体'][pid] = nil
			end
			--周公剑意
			if WAR.PD['感电状态'][pid] ~= nil then
				addbuff(pid,WAR.PD['麻痹状态'],1)
				local a = math.abs(300-JY.Person[pid]["受伤程度"])
				local b = math.abs(300-JY.Person[pid]["中毒程度"])
				local c = math.abs(500-JY.Person[pid]["冰封程度"])
				local d = math.abs(300-JY.Person[pid]["灼烧程度"])
				local e = math.abs(100-JY.Person[pid]["封穴程度"])
				local f = math.abs(300-JY.Person[pid]["流血程度"])
				local g = a+b+c+d+e+f
				if g > 1000 then
					g = 1000
				end
				ztd(WAR.CurID,'生命点数',-g)
				WAR.PD['感电状态'][pid] = WAR.PD['感电状态'][pid] - 1
				if WAR.PD['感电状态'][pid] < 1 then
					WAR.PD['感电状态'][pid] = nil
				end
			end
			if WAR.PD['御雷阵'][pid] ~= nil then
				local yj = math.modf(TrueYJ(pid)/100)
				for j = 0, WAR.PersonNum -1 do
					local df = WAR.Person[j]["人物编号"]
					if dead(j) == false and DWPD(j,WAR.CurID) and RealJL(WAR.CurID,j,yj) then
						local s = WAR.CurID
						WAR.CurID = j
						WarDrawMap(0); --不加这条则动画位置无法正常显示
						CurIDTXDH(WAR.CurID,131,1,"御雷霹雳",LightSkyBlue);
						WAR.CurID = s
						local sh = yj*(WAR.PD['感电状态'][df] or 1)*(WAR.PD['麻痹状态'][df] or 1)*8
						ztd(j,'生命点数',-math.modf(sh))
						WAR.PD['感电状态'][df] = limitX((WAR.PD['感电状态'][df] or 0) + 1,0,5)
					end
				end
			end
			--医术系统
			--子午
			if WAR.PD['子午'][pid] ~= nil then
				zhanyi(pid,200)
				if WAR.PD["神兵"][pid] == nil then
					WAR.PD["神兵"][pid] = 10
				end
				WAR.PD['子午'][pid] = nil
			end
			--黄帝
			if WAR.PD['黄帝'][pid] ~= nil then
				nuqi(pid,100)
				if WAR.PD["西瓜刀・天人"][pid] == nil then
					WAR.PD["西瓜刀・天人"][pid] = 2
				end
				WAR.PD['黄帝'][pid] = nil
			end
			--千金 逍遥游
			if WAR.PD['千金'][pid] ~= nil then
				local yao = {}
				--local list = {}
				local chiyao
				for i = 0, 13 do
					if hasthing(i) then
						table.insert(yao,i)--药的类型
					end
				end
				if yao[1] ~= nil then
					chiyao = yao[math.random(#yao)]
					UseThing_Type3(chiyao)
				end
			end
			--葵花点穴手
			if WAR.PD['锁穴奇劲'][pid] ~= nil and WAR.PD['锁穴奇劲'][pid] > 0 then
				local sx = WAR.PD['锁穴奇劲'][pid]
				if sx > 1500 then
					sx = 1500 + sx*0.1
				end	
				ztd(WAR.CurID,"生命点数", -math.modf(sx))
				ztd(WAR.CurID,"内力点数", -math.modf(sx*1.5))
				ztd(WAR.CurID,"体力点数", -25)
				zhanyi(pid,-math.modf((WAR.SPIRIT[pid] or 0) * 0.5))
				WAR.PD['恐惧状态'][pid] = 1
				WAR.PD['锁穴奇劲'][pid] = nil
				if psx(pid,"生命") <= math.modf(psx(pid,"生命最大值")*0.07) then
					if math.random(100) > 85 then
						JY.Person[pid]["生命"] = 0
						WarDrawMap(0); 
						CurIDTXDH(WAR.CurID, 78,1,"你已经死了",C_ORANGE);
					else
						if psx(pid,"生命") < 1 then
							JY.Person[pid]["生命"] = 1
						end
					end
				end	
			end
			--夜雨绵延
			if WAR.PD['夜雨绵延'][pid] ~= nil then
				WAR.PD['夜雨绵延'][pid] = math.modf(WAR.PD['夜雨绵延'][pid] * 3)
				ztd(WAR.CurID,'生命点数',-WAR.PD['夜雨绵延'][pid])
				CurIDTXDH(WAR.CurID, 123,1,"夜雨绵延・湿毒附骨",C_ORANGE);
				WAR.PD['夜雨绵延'][pid] = WAR.PD['夜雨绵延'][pid] - math.modf(psx(pid,'用毒能力')*0.02)
				if WAR.PD['夜雨绵延'][pid] <= 0 then
					WAR.PD['夜雨绵延'][pid] = nil
				end
			end		
			--太玄乾坤
			if WAR.PD["太玄组合攻击1"][pid] ~= nil then
				WAR.PD["太玄组合攻击1"][pid] = WAR.PD["太玄组合攻击1"][pid] - 1
				if WAR.PD["太玄组合攻击1"][pid] < 1 then
					WAR.PD["太玄组合攻击1"][pid] = nil
				end
			end	
			--唯我独尊
			if WAR.WWDZ[pid] == 1 then 
				WAR.WWDZ[pid] = nil
			end	
			--老张拉人
			if WAR.TJZS[2000 + pid] ~= nil then
				WAR.TJZS[2000 + pid] = nil 
			end	
			--飞天神行
			if WAR.PD["飞天步"][pid] ~= nil then
				WAR.PD["飞天步"][pid] = WAR.PD["飞天步"][pid] - 1
				if WAR.PD["飞天步"][pid] < 1 then
					WAR.PD["飞天步"][pid] = nil
				end
			end
		    --盲目状态恢复
			if WAR.PD["盲目状态"][pid] == 2 then
				WAR.PD["盲目状态"][pid] =WAR.PD["盲目状态"][pid] - 1
				if WAR.PD["盲目状态"][pid] < 1 then
					WAR.PD["盲目状态"][pid] = nil 
				end
		    end
			--双重攻击
			if WAR.PD['降龙・双龙取水'][pid] == 2 then
				WAR.PD['降龙・双龙取水'][pid] = nil
			end
			--金刚狮子吼
			if WAR.PD["金刚咒"][pid]~=nil  then
				WAR.PD["金刚咒"][pid] = WAR.PD["金刚咒"][pid] - 1
				if WAR.PD["金刚咒"][pid] <= 0 then
					WAR.PD["金刚咒"][pid] = nil
				end
			end
			if WAR.PD["菩提咒"][pid]~=nil  then
				WAR.PD["菩提咒"][pid] = WAR.PD["菩提咒"][pid] - 1
				if WAR.PD["菩提咒"][pid] <= 0 then
					WAR.PD["菩提咒"][pid] = nil
				end
			end	
			if WAR.HQT_CD > 0  then
				WAR.HQT_CD = WAR.HQT_CD - 1
			end
			 
			if WAR.PD['龙风1'][pid] ~= nil then
				WAR.PD['龙风1'][pid] = nil
				WAR.PD['龙风'][pid] = nil 
			end
			if WAR.PD['大小幽明'][pid] ~= nil then
				WAR.PD['大小幽明'][pid]	= nil
			end
			--密宗血魔
			if WAR.PD['血魔'][pid] ~= nil and MPTX(pid,6,2) and (WAR.LQZ[pid] or 0 ) > 100 then
				if PersonKF(pid,160) and PersonKF(pid,58) then
				else
					WAR.LQZ[pid] = 100
				end
			end	
			--夜雨
			if WAR.PD['断命四绝句'][pid] ~= nil then
				local dmwz = {'君问归期未有期','巴山夜雨涨秋池','何时共剪西窗烛','却话巴山夜雨时'}
				WAR.PD['断命四绝句'][pid] = WAR.PD['断命四绝句'][pid] +1
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 98,1,dmwz[WAR.PD['断命四绝句'][pid]],C_BLACK)
				if WAR.PD['断命四绝句'][pid] >= 4 then
					WAR.PD['断命四绝句'][pid] = nil
					JY.Person[pid]['生命'] = math.modf(JY.Person[pid]['生命']*0.1)
				end	
			end	
			--暗香疏影
			if WAR.PD['暗香疏影'][pid] == 3 then
				WAR.PD['混乱状态'][pid] = 2
			end	
			--易筋药师佛身
			if NGQH(pid,108)  then  --and WAR.PD['易筋恢复'][pid] ~= nil	
				local yj = (WAR.PD['易筋恢复'][pid] or 0)
				if WAR.PD['业障缠身'][pid] ~= nil and WAR.PD['业障缠身'][pid] > 30 then
					WAR.PD['业障缠身'][pid] = nil
				end	
				if yj > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					ztd(WAR.CurID,"生命点数", yj)
					CurIDTXDH(WAR.CurID, 104,1,"易筋・药师如来",C_ORANGE);
					WAR.PD['易筋恢复'][pid] = nil
				end	
			end
			--踏雪无痕
			if TFQG(pid,277) then
				if match_ID(pid,97) or match_ID(pid,517) then
					for j = 0, WAR.PersonNum -1 do
						if dead(j) == false and DWPD(j,WAR.CurID) then
							WAR.PD['雪夜追猎'][WAR.Person[j]['人物编号']] = 1
						end
					end
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID,98,1,'血夜・逃杀追猎')			
				else
					local x = WAR.Person[WAR.CurID]["坐标X"];
					local y = WAR.Person[WAR.CurID]["坐标Y"];
					local tiaoren = true
					if WAR.AutoFight == 1 or isteam(pid) == false then
						tiaoren = false
					end	
					while tiaoren do
					    War_CalMoveStep(WAR.CurID, 15, 1)
						local x,y = War_SelectMove()
						if lib.GetWarMap(x, y, 2) > 0 or lib.GetWarMap(x, y, 5) > 0 then
							local tdID = lib.GetWarMap(x, y, 2)
							if WAR.Person[tdID]["我方"] == WAR.Person[WAR.CurID]["我方"] then
								break
							end
							local eid = WAR.Person[tdID]["人物编号"]
							local x0, y0 = WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"]
							local x1, y1 = WAR.Person[tdID]["坐标X"],WAR.Person[tdID]["坐标Y"]
							WAR.PD['雪夜追猎'][eid] = 1
							CleanWarMap(4, 0)
							SetWarMap(x1, y1, 4, 1)
							War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, 0, 0, 0, 0, 98)
							QZXS(JY.Person[eid]["姓名"].."被追猎")
							tiaoren = false
						else
						    break
						end
					end
				end	
			end			
			if WAR.PD['雪夜追猎'][pid] ~= nil then
				WAR.PD['雪夜追猎'][pid] = nil 
			end	
			--云龙三折
			if QGQH(pid,292,2) and WAR.PD['云龙三折'][pid] ~= nil then
				if WAR.PD['云龙三折'][pid] == 3 then
					WAR.PD['云龙三折'][pid] = nil
				else
					WAR.PD['云龙三折'][pid] = WAR.PD['云龙三折'][pid] +1	
				end	
			end
			--沧溟刀叠刃
			if PersonKF(pid,153) and (PersonKF(pid,43) or PersonKF(pid,216)) then
				if PersonKF(pid,43) then
					addbuff(pid,WAR.PD['霜之哀伤'],2,15)
				else
					addbuff(pid,WAR.PD['霜之哀伤'],1,15)
				end
				if PersonKF(pid,21) then
					addbuff(pid,WAR.PD['霜之哀伤'],1,15)
				end
				if match_ID(pid,514) then
					addbuff(pid,WAR.PD['霜之哀伤'],2,15)
				end
				if MPTX(pid,20) then
					addbuff(pid,WAR.PD['霜之哀伤'],math.random(2),15)
				end
			end
			--阿九，行动开始前，60%几率降低敌方集气-150点
			if (match_ID(pid, 629) or match_ID(pid, 9799)) and JLSD(20,80,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(j,WAR.CurID) then
						if nokillspeed(j) == false then
							WAR.Person[j].TimeAdd = WAR.Person[j].TimeAdd - 150
						end	
					end
				end
				DrawTimeBar2()
			end
			--决胜千里 
			if match_ID(pid, 9968) and JLSD(20,80,pid) then
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false then
						if DWPD(j,WAR.CurID) then
							if nokillspeed(j) == false then
								WAR.Person[j].TimeAdd = WAR.Person[j].TimeAdd - 150
							end	
						else
							ztd(j,'集气位置',150)
						end
					end
				end
				DrawTimeBar2()
			end
			
			--七夕任盈盈行动前催动琴音
			if (match_ID(pid, 611) or (match_ID(pid,73) and JXPD(pid,73,1)))  and JY.Person[pid]["生命"]> 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 232,1,"音锁幻境",C_ORANGE);
				for j = 0, WAR.PersonNum - 1 do
					local df = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false and JY.Person[df]["生命"]>0 and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local qycs = WAR.PD["琴音状态"][df] or 0
						if qycs > 0 then
							ztd(j,"生命点数",-30*qycs)
							--沉睡状态的敌人陷入更深的梦境
							if WAR.PD["沉睡状态"][df] ~= nil then
								WAR.PD["回魂仙梦"][df] = 10
							end
							if WAR.PD["沉睡状态"][df] == nil and math.random(40) < qycs then
								WAR.PD["沉睡状态"][df] = 1
							end
						end
						WAR.PD["琴音状态"][df] = (WAR.PD["琴音状态"][df] or 0) - 20
						if WAR.PD["琴音状态"][df] < 1 then
							WAR.PD["琴音状态"][df] = nil
						end	
					end
				end
			end
			--天魔易筋天魔啸
			if NGQH(pid,160) and JLSD(10,40,pid) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 123,1,"天魔・穿心魔啸",C_ORANGE);
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						nuqi(WAR.Person[j]["人物编号"],-20)
					end
				end
			end	
			--昆仑阵
			if WAR.PD['顺逆两仪1'][pid] ~= nil then
				local a = WAR.PD['顺逆两仪1'][pid]
				if JLSD(0,math.modf(a*15)+10,pid) then
					Cat('清除低级异常',WAR.CurID)
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 19,1,"顺两仪・阴阳调",C_ORANGE)
				end	
			end	
			if WAR.PD['顺逆两仪2'][pid] ~= nil then
				local a = WAR.PD['顺逆两仪2'][pid]
				local yczt = {"内伤点数","中毒点数",WAR.BFXS,WAR.LXXS,WAR.ZSXS,WAR.FXXS}
				local yc = ""
				if JLSD(0,math.modf(a*15)+10,pid) then
					for i = 1, 3 do 
						yc = yczt[math.random(#yczt)]
						ztd(WAR.CurID,yc,a*6)
					end	
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 19,1,"逆两仪・阴阳乱",C_ORANGE)
				end	
			end
			if WAR.PD['顺逆两仪3'][pid] ~= nil and WAR.LYWC > 0 then
				local a = limitX(math.modf(WAR.LYWC*0.1),0,1000)
				local b = limitX(math.modf(WAR.LYWC*0.1),0,2000)
				ztd(WAR.CurID,'生命点数',a)
				ztd(WAR.CurID,'内力点数',b)
			end	
			if WAR.PD["昆仑门派指令2"][pid] ~= nil then
				War_RestMenu()
			end
			--双金刚
			if QFZH(pid,22,144) or QFZH(pid,135,144) then
				if JLSD(10,45,pid) then
					War_ActupMenu()
				end
			end		

			--龙行虎步
			if QGQH(pid,280,1) and JLSD(0,40,pid) then
				if (WAR.SPIRIT[pid] or 0) >= 150 then
					zhanyi(pid,50)
				end	
			end
			--丘处机通用计时状态已方
			if match_ID(pid,68) and WAR.JSZT1[pid] == nil then
				WAR.JSZT1[pid] = 3
			end
			--套装效果.调息
			if PDTZ(pid,JY.Person[pid]["武器"]) then
				local n = JY.Person[pid]["武器"]
				if Setmeal[n][4] == 22 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 19,1,"套装特效・调息",C_ORANGE);
					War_RestMenu()
				end
			end 
			--先天调息，行动前休息
			if Curr_NG(pid, 100) then
				local jl = 40
				if MPTX(pid,16) then
					jl = jl + 20
				end
				if match_ID(pid,129) or match_ID(pid,64) then
					jl = 100
				end
				if JLSD(0,jl,pid) then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 19,1,"先天・进战调息",C_ORANGE);
					War_RestMenu()
				end
			end
			--神照龟息
			if NGQH(pid,94) then 
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 203,1,"入神坐照・冥想而坐",C_ORANGE);
				War_RestMenu()
			end 	
			--竹风雨滴
			if match_ID(pid,520) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 392,1,"天剑・调息",C_ORANGE);
				War_RestMenu()
				War_ActupMenu()
			end
			--百里青霜
			if match_ID(pid,762) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 1,1,"真气调息",C_ORANGE);
				War_RestMenu()
				War_ActupMenu()
			end
			--噩梦
			if match_ID(pid,741) or match_ID(pid,742) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 19,1,"剑气护体",C_ORANGE);
				War_RestMenu()
			end
			--悟道乾坤
			if match_ID(pid,515) or match_ID(pid,9735) then 
				WarDrawMap(0); --不加这条则动画位置无法正常显示183
				CurIDTXDH(WAR.CurID, 183,1,"悟道乾坤.道法自然",C_ORANGE);
				Cat('清除中级异常',WAR.CurID)
			end
			--明教
			if JLSD(0,50,pid) and MPTX(pid,13) then
				Cat('清除中级异常',WAR.CurID)
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 154,1,"熊熊圣火・浴火重生",C_ORANGE);
			end
			--九阳抱元守一
			if (Curr_NG(pid,106) and rwnlxz(pid,1)) or match_ID(pid, 9) or match_ID(pid, 638) then 
				Cat('清除高级异常',WAR.CurID)
				if NGQH(pid,106) and JLSD(0,40,pid) then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 78,1,"九阳・抱元守一",C_ORANGE);
					Cat('清除所有异常',WAR.CurID)
				end	
			end
			--玄武真功
			if NGQH(pid,315) and JY.Person[pid]["生命"] > 0 then 
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 393, 1, "玄武真气")
				local a = nil
				local b = nil
				local c = nil
				local d = nil
				a = 800
				b = 1000
				c = 10 + math.modf(JY.Person[pid]["受伤程度"]/10)
				d = 10 + math.modf(JY.Person[pid]["中毒程度"]/10)
				ztd(WAR.CurID,"生命点数", a)
				ztd(WAR.CurID,"内力点数", b)
				ztd(WAR.CurID,"体力点数", 10)
				ztd(WAR.CurID,"内伤点数", -c)
				ztd(WAR.CurID,"中毒点数", -d)
				Cat('清除高级异常',WAR.CurID)
			end
			--独孤九剑
			if (PersonKF(pid,47) and PersonKF(pid,184)) or match_ID(pid,592) or (WAR.ZDDH == 424 and pid == 670) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 428,1,"独孤剑意调息",C_ORANGE);
				War_RestMenu()
				ztd(WAR.CurID,"生命点数", 399)
				ztd(WAR.CurID,"内力点数", 599)
				ztd(WAR.CurID,"体力点数", 9)
				ztd(WAR.CurID,"内伤点数", -9)
				ztd(WAR.CurID,"中毒点数", -9)	
				Cat('清除所有异常',WAR.CurID)
			end
			--阿青，行动前清除异常
		    if match_ID(pid, 604) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID,435,1,"越女剑仙・九霄仙息",C_ORANGE);
				Cat('清除所有异常',WAR.CurID)
		    end
			
			--无始无明
			if match_ID(pid,517) or (match_ID(pid,457) and WAR.ZDDH == 456) then
				Cat('清除所有异常',WAR.CurID)
				WAR.PD["无始无明"][pid] = 1
			end
			
			--五岳紫霞
			if (PersonKF(pid,89) and MPTX(pid,14,2)) or JXPD(pid,19,1) then
				local HN = math.modf((JY.Person[pid]["内力最大值"])*0.3)
				local NL = math.modf((JY.Person[pid]["内力最大值"])*0.3 + JY.Person[pid]["内力"])
				local SM = math.modf((JY.Person[pid]["内力最大值"])*0.3 + JY.Person[pid]["内力"] - JY.Person[pid]["内力最大值"])
				local XX = math.modf((JY.Person[pid]["内力"]/JY.Person[pid]["内力最大值"])*60)
				ztd(WAR.CurID,"内力点数", HN)
				if NL >= JY.Person[pid]["内力最大值"] then
					ztd(WAR.CurID,"生命点数", math.modf(SM*0.2))
				end
				if JLSD(0,XX,pid) then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 179,1,"紫气蕴体",C_ORANGE);
					War_RestMenu()
				end
			end
				
			--天罡北斗阵
			if (pid==68 or pid==123 or pid==124 or pid==125 or pid==126 or pid==127 or pid==128) or (pid==0 and (JY.Base["畅想"]==68 or JY.Base["畅想"]==123)) then
				for n = 15,50 do
	            local i = n 
	            if i > 35 then 
	                i = 35   
	            end
	            lib.GetKey()
				Cat('实时特效动画')
	            Cls()
	            Cat('实时特效动画2')
				lib.GetKey()
				NewDrawString(-1, -1, "天罡北斗阵.七星聚会", C_GOLD, CC.DefaultFont+i*2)
				ShowScreen()
				lib.Delay(CC.BattleDelay)
				end
			end
			--真武七截阵
			if (pid >= 532 and pid <= 538) then
				for n = 15,50 do
	            local i = n 
	            if i > 35 then 
	                i = 35   
	            end
	            lib.GetKey()
				Cat('实时特效动画')
	            Cls()
	            Cat('实时特效动画2')
				lib.GetKey()
				NewDrawString(-1, -1, "真武七截阵.龟蛇二将", C_GOLD, CC.DefaultFont+i*2)
				ShowScreen()
				lib.Delay(CC.BattleDelay)
				end
			end
			--松风剑阵
			if (pid >= 211 and pid <= 213) and WAR.ZDDH == 203 then
				for n = 15,50 do
	            local i = n 
	            if i > 35 then 
	                i = 35   
	            end
	            lib.GetKey()
				Cat('实时特效动画')
	            Cls()
	            Cat('实时特效动画2')
				lib.GetKey()
				NewDrawString(-1, -1, "青城三少.松风剑阵", C_GOLD, CC.DefaultFont+i*2)
				ShowScreen()
				lib.Delay(CC.BattleDelay)
				end
			end
			--金刚伏魔圈
			if match_ID(pid,597) or match_ID(pid,598) or match_ID(pid,599) then
				for n = 15,50 do
	            local i = n 
	            if i > 35 then 
	                i = 35   
	            end
	            lib.GetKey()
				Cat('实时特效动画')
	            Cls()
	            Cat('实时特效动画2')
				lib.GetKey()
				NewDrawString(-1, -1, "金刚伏魔圈.佛力伏魔", C_GOLD, CC.DefaultFont+i*2)
				ShowScreen()
				lib.Delay(CC.BattleDelay)
				end
			end
			--无始无明
			if match_ID(pid,517) and JY.Person[pid]["生命"] > 0 then
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then	
						WAR.PD['命无常'][WAR.Person[i]["人物编号"]]  = 10
						WAR.PD['极乐血海'][WAR.Person[i]["人物编号"]]  = 10
						if JY.Person[WAR.Person[i]["人物编号"]]["流血程度"] < 300 then
							JY.Person[WAR.Person[i]["人物编号"]]["流血程度"] = 300
						end
					end
				end
			end
			--罗汉果位
			if MPTX(pid,5,2) and Curr_NG(pid,96) then
				if WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[pid] > 0 then
					local a = WAR.SPIRIT[pid]
					if JLSD(10,math.modf(a*0.6),pid) then
						WAR.PD['罗汉果位'][pid] = 1
						if NGQH(pid,96) then
							WAR.PD['罗汉果位'][pid] = 2
						end
						addbuff(pid,WAR.PD['罗汉刀奇'],20)
						limitX(WAR.PD['罗汉刀奇'][pid],0,600)
					end
				end
			end	
			--熊猫行动前
			if match_ID(pid,765) then
				addbuff(pid,WAR.PD['兽血沸腾'],6000)
			end
			--金刚狮子吼		
			if Curr_NG(pid, 91) then
				CleanWarMap(4, 0)
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 345,1,"金刚狮子吼",LimeGreen);	
				for i = 0, WAR.PersonNum - 1 do
					if dead(i) == false and RealJL(i,WAR.CurID,8) then
						SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
						if DWPD(i,WAR.CurID) == false then
							WAR.PD["金刚护盾"][WAR.Person[i]["人物编号"]] = limitX((WAR.PD["金刚护盾"][WAR.Person[i]["人物编号"]] or 0) + 200,0,2500)
							if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾']  <= -1 then
								WAR.Person[i]['护盾'] = 2
							end	
							WAR.PD["菩提咒"][WAR.Person[i]["人物编号"]] = 1
						else
							WAR.PD["金刚咒"][WAR.Person[i]["人物编号"]] = 1
							if JLSD(10,30,pid) and nokillspeed(i) == false then
								ztd(i,'集气位置',-200)
							end
						end
					end
				end
				lib.Delay(20)	
				DrawTimeBar2()
			end	

			--紫衫龙王
			if (match_ID(pid,15) or match_ID(pid,9817)) and JY.Person[pid]["生命"] > 0 and JLSD(0,30,pid) then	
				if match_ID(pid,15) then
					WAR.QGZT[pid] = (WAR.QGZT[pid] or 0) + 1
				end
				for i = 0, WAR.PersonNum - 1 do
	                if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then	
						WAR.PD["魅惑状态"][WAR.Person[i]["人物编号"]] = 1
					end
				end
				CurIDTXDH(WAR.CurID, 129,1,"倾国倾城",LimeGreen);	
			end
			--达摩行动前敌人忏悔
			if match_ID(pid,577) and JY.Person[pid]["生命"] > 0 then	
				for i = 0, WAR.PersonNum - 1 do
	                if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then	
						WAR.PD["受想行识"][WAR.Person[i]["人物编号"]] = 1 
						if WAR.PD["度化状态"][WAR.Person[i]["人物编号"]] == nil and JLSD(0,30,pid) then
							WAR.PD["度化状态"][WAR.Person[i]["人物编号"]] = 28
						end
					end
				end
				CurIDTXDH(WAR.CurID, 241,1,"回头是岸",LimeGreen);	
			end
			--玉女先天行动前
			if NGQH(pid,154) then
				for i = 0, WAR.PersonNum - 1 do
					local df = WAR.Person[i]["人物编号"]
	                if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then	
						WAR.QX1[df] = 1
						if WAR.LQZ[df] ~= nil and WAR.LQZ[df] > 0 then
							local nq = math.modf(WAR.LQZ[df]/10)
							if nq > 50 then
								nq = 50
							end
							ztd(i,"生命点数",-nq*20)
							WAR.LQZ[df] = math.modf(WAR.LQZ[df]*0.9)
						end
					end
				end
			end

			--九阴降龙・龙灭 策马
			if ((PersonKF(pid,26) and Curr_NG(pid,107)) or (match_ID(pid,527) and PersonKF(pid,26) and Curr_NG(pid,367) and MPTX(pid,24))) and JLSD(20,50,pid) then	
				for i = 0, WAR.PersonNum - 1 do
	                if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then	  
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0); --不加这条则动画位置无法正常显示
						CurIDTXDH(WAR.CurID, 372,1,"龙灭",LimeGreen);	
						WAR.CurID = s
						WAR.PD["荒天龙灭"][WAR.Person[i]["人物编号"]] = 1 
					end
				end
			end
			--妖风祸世
		    if WAR.YFHS == 1 and YaoFengHuoShi(pid) and math.random(10) <= 6 and JY.Person[pid]["生命"] > 0 then	
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 56,1,"妖风乱魂",C_ORANGE);
	            for i = 0, WAR.PersonNum - 1 do
				    if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then	
					    WAR.PD["混乱状态"][WAR.Person[i]["人物编号"]] = 1
				    end
			    end
		    end	
			--吴侬软语 行动开始前，提升我方100集气
			if (match_ID(pid,105) or match_ID(pid,9871)) and JY.Person[pid]["生命"] > 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 20,1,"吴侬软语",LimeGreen);
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
						ztd(j,'集气位置',100)
					end
				end
				lib.Delay(20)	
				DrawTimeBar2()
			end
			--昆仑刀剑阵
			if WAR.PD['风雷惊蛰3'][pid] ~= nil and JY.Person[pid]["生命"] > 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 20,1,"真・暴风掠境",LimeGreen);
				for j = 0, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(j,WAR.CurID) then
						local jid = WAR.Person[j]['人物编号']
						ztd(j,'集气位置',-100)
						ztd(j,WAR.LXXS,math.random(10,20))
						ztd(j,'内伤点数',math.random(10,20))
						ztd(j,'生命点数',-(psx(jid,'流血程度')+psx(jid,'受伤程度')))
					end
				end
				lib.Delay(20)	
				DrawTimeBar2()
			end	
			
			--峨眉九阳功 行动前概率自动清除基础状态 
			if PersonKF(pid, 242) and JLSD(0,30,pid) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 19,1,"佛光普照",C_ORANGE);
				AddPersonAttrib(pid,"中毒程度",-JY.Person[pid]["中毒程度"])
				AddPersonAttrib(pid,"受伤程度",-JY.Person[pid]["受伤程度"])
				AddPersonAttrib(pid,"灼烧程度",-JY.Person[pid]["灼烧程度"])
				AddPersonAttrib(pid,"冰封程度",-JY.Person[pid]["冰封程度"])
				AddPersonAttrib(pid,"流血程度",-JY.Person[pid]["流血程度"])
				AddPersonAttrib(pid,"封穴程度",-JY.Person[pid]["封穴程度"])
			end
			--东方不败行动前射暗器
			if (JXPD(pid,27,2) and PersonKF(pid,105)) or (match_ID(pid,92) and isteam(pid) == false) or match_ID(pid,777) then
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 201, 1, "葵花神针・破", PinkRed)
				local XZ = {}
				for j = 0, WAR.PersonNum - 1 do
					local df = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then
						table.insert(XZ,j)
						nuqi(df,-30)
					end
				end
				if XZ[1] ~= nil then
					local ri = XZ[math.random(#XZ)]
					War_ExecuteMenu_Sub(WAR.Person[ri]["坐标X"],WAR.Person[ri]["坐标Y"], 4, 34)
					WAR.Person[ri]["生命点数"] = (WAR.Person[ri]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[ri]["人物编号"], "生命", -500)
					WAR.Person[ri]["内力点数"] = (WAR.Person[ri]["内力点数"] or 0) + AddPersonAttrib(WAR.Person[ri]["人物编号"], "内力", -500)
				end
			end
			--云灏天上有敌
			if match_ID(pid,748) then
				local XZ = {}
				for j = 0, WAR.PersonNum - 1 do
					local df = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] == false then
						table.insert(XZ,j)
					end
				end
				if XZ[1] ~= nil then
					local ri = XZ[math.random(#XZ)]
					local sm = JY.Person[pid]["生命最大值"]/5
					local s = WAR.CurID
					WAR.CurID = ri
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID,131,1,"天上有敌・惊雷劫", PinkRed);	
					WAR.CurID = s
					WAR.Person[ri]["生命点数"] = (WAR.Person[ri]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[ri]["人物编号"], "生命", -sm)
				end
			end
			--点点传授剑招
			if (match_ID(pid,0) or match_ID(pid,457)) and JY.Person[350]["品德"] == 100 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID,170,1,"太极剑体・意无形")
				WAR.XTTX = 1
			end
			--唐门模式
	        if WAR.JTJD[pid] == 1 then  
				WAR.JTJD[pid] = nil 
			end
			--唐门模式
			if WAR.TMMS[300+pid] == 1 then 
				WAR.DPJ[pid] = 3
				WAR.TMMS[300+pid] = nil 
			end
			--天仙锁魂
			if match_ID(pid,574) or match_ID(pid,9784) then
	            local txsh = math.random(5)	 
			    for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
	                    if  WAR.PD["虚弱状态"][WAR.Person[j]["人物编号"]] == nil and JLSD(0,60,pid) then     
		                    WAR.PD["虚弱状态"][WAR.Person[j]["人物编号"]] = math.random(15,35)
						end
					end
				end
	        end
			--万佛朝宗	标记修改
			if match_ID(pid,577) then 
				WAR.WFCZ = (WAR.WFCZ or 0) + 1
				if WAR.WFCZ > 5 then
					WAR.WFCZ = 5
				end
			end
			--一刀流剑步 dead
			for j = 0, WAR.PersonNum - 1 do
				if MPTX(WAR.Person[j]["人物编号"],11,2) and Curr_NG(WAR.Person[j]["人物编号"],152) and DWPD(j,WAR.CurID) == false then
					local jl = WAR.LBPM * 15
					if JLSD(0,jl,id) then
						local size = 60
						local x = CC.ScreenW/2;
						local y = CC.ScreenH/2;
						local offx = (#"【一刀忘忧式・残心浮刀斩】")*size/4
						local offy = size/2
						lib.Background(0,y-50,CC.ScreenW,y+50,98)
						DrawString(x-offx,y-offy,"【一刀忘忧式・残心浮刀斩】",C_GOLD,size);  
						ShowScreen();
						lib.Delay(200);
						local pid = WAR.Person[j]["人物编号"]
						for d = 0, WAR.PersonNum - 1 do
							local did = WAR.Person[d]["人物编号"]
							WarDrawMap(0) 
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[d]["我方"] then
								SetWarMap(WAR.Person[d]["坐标X"], WAR.Person[d]["坐标Y"], 4, 1)
								SetWarMap(WAR.Person[d]["坐标X"], WAR.Person[d]["坐标Y"], 4, 4)
								if JY.Person[did]["生命"] <= 1500 or (JY.Person[did]["生命"] <= JY.Person[did]["生命最大值"] * 0.3) then
									JY.Person[did]["生命"] = 0
								else
								    JY.Person[did]["生命"] = math.modf(JY.Person[did]["生命"] * 0.85)
								end
								WAR.TXXS[did] = 1
							end
						end
						War_ShowFight(pid, 0, 0, 0, 0, 0, 422,-1)
						local z = WAR.CurID
						WAR.CurID = j
						War_ExecuteMenu_Sub(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5)
						WAR.CurID = z
					end
					break
				end
			end
			--般若内爆
			if WAR.PD['般若内爆'][pid] ~= nil and (WAR.PD['般若内爆'][pid] or 0) > 800 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 207,1,"无相震裂",C_ORANGE);
				local zb = (WAR.PD['般若内爆'][pid] or 0)
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						ztd(j,"生命点数", -zb)
					end
				end
				WAR.PD["般若内爆"][pid] = nil
			end	
			--黑血毒
			if WAR.PD['黑血毒'][pid] ~= nil and (WAR.PD['黑血毒'][pid] or 0) > 6 then
				local jl = (WAR.PD['黑血毒'][pid] or 0) * 10
				local WZ = (WAR.PD['黑血毒'][pid] or 0) * 2
				if JLSD(5,jl,pid) then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 123,1,"暗毒扩散",C_ORANGE);
					for j = 0, WAR.PersonNum - 1 do
						local df = WAR.Person[j]["人物编号"]
						if dead(j) == false and DWPD(WAR.CurID,j) == false and RealJL(WAR.CurID,j,WZ) then
							ztd(j,"生命点数", -jl*8)
							WAR.PD["西域奇毒"][df] = (WAR.PD["西域奇毒"][df] or 0) + 5
							WAR.PD["黑血毒"][df] = (WAR.PD["黑血毒"][df] or 0) + 1
						end
					end
				end
				if WAR.PD['黑血毒'][pid] > 10 then
					WAR.PD['黑血毒'][pid] = nil
				end 
			end
			--先天护盾
            if Curr_NG(pid,100) and WAR.PD["先天护盾CD"][pid] == nil then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 80,1,"先天罡气护体",C_ORANGE);
				if MPTX(pid,16) and Curr_QG(pid,223) then
					addbuff(pid,WAR.PD["先天护盾"],700,4000)
					WAR.PD["先天护盾CD"][pid] = 18
				else
					addbuff(pid,WAR.PD["先天护盾"],500,3500)
					WAR.PD["先天护盾CD"][pid] = 30
				end
				if WAR.Person[WAR.CurID]['护盾'] == nil or WAR.Person[WAR.CurID]['护盾'] <= -1 then
					WAR.Person[WAR.CurID]['护盾'] = 3
				end
				--WAR.Person[WAR.CurID]['护盾'] = 3
			elseif PersonKF(pid,100) and MPTX(pid,16) and WAR.PD["先天护盾CD"] == nil then
			    WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 80,1,"先天罡气护体",C_ORANGE);
				addbuff(pid,WAR.PD["先天护盾"],300,3000)
				WAR.PD["先天护盾CD"][pid] = 30
				if WAR.Person[WAR.CurID]['护盾'] == nil or WAR.Person[WAR.CurID]['护盾'] <= -1 then
					WAR.Person[WAR.CurID]['护盾'] = 3
				end
			end

			--龙象般若功，自动蓄力
			if Curr_NG(pid, 103) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				War_ActupMenu()
			end	
			
			--易筋须弥山，自动蓄力
			if PersonKF(pid,24) and PersonKF(pid,108) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				War_ActupMenu()
			end	
			
			--九字真言
			if match_ID(pid,9979) and WAR.ZYHB ~= 2 then
				Bagua(pid)
			end
			--魅惑状态只剩一个敌人时不会进行随机	
			if (WAR.PD["魅惑状态"][pid] ~= nil and WAR.PD["魅惑状态"][pid] > 0) or (WAR.PD["魔岭玫瑰"][pid] ~= nil and WAR.PD["魔岭玫瑰"][pid] > 0) then
				local EmenyNum = 0
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false then
						if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							EmenyNum = EmenyNum + 1
						end
					end
				end
				if inteam(pid) then
					if EmenyNum > 1 then
						WAR.Person[p]["我方"] = false
					end
				else
				    if EmenyNum > 1 then
						WAR.Person[p]["我方"] = true
					end
				end
			end
			--乾坤六合阵老张最后撤退
			if WAR.ZDDH == 290 then
				local EmenyNum = 0
				if isteam(pid) == false then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							EmenyNum = EmenyNum + 1
						end
					end
				end
				if match_ID(pid,5) and EmenyNum < 2 then
					if WAR.Person[p]["我方"] == false then
						WAR.Person[p]["死亡"] = true
						say('真是长江后浪推前浪啊，老道年岁已高，已经无心再战了！',5,0)
					end
				end
			end
			--观止为点点输血
			--if WAR.PD['点点诡计'][pid] == 1 then
				--WAR.Person[p]["我方"] = false
				--[[for i = 0, WAR.PersonNum - 1 do
					local wj = WAR.Person[i]["人物编号"]
					if match_ID(wj,457) then
						for j = 0, WAR.PersonNum - 1 do
							if WAR.Person[j]["人物编号"] == 456 and dead(j) == false then
								JY.Person[457]["生命"] = JY.Person[457]["生命"] + (JY.Person[456]["生命"] + JY.Person[456]["内力"]) * 0.3
								JY.Person[456]["生命"] = JY.Person[456]["生命"] * 0.7
								JY.Person[456]["内力"] = JY.Person[456]["内力"] * 0.7
								QZXS("观止为点点输血")
							end
						end
					end
				end--]]
				--WAR.PD['点点诡计'][pid] = nil
			--end
			
			if WAR.PD['点点暴走'][pid] ~= nil then
				if WAR.PD['点点暴走'][pid] > 0 and WAR.PD['点点暴走'][pid] < 31 then
					WAR.Person[p]["我方"] = false
				else
					WAR.Person[p]["我方"] = true
				end
			end	
				
			--达摩恢复状态		
			if match_ID(pid,9939) then
				local pd = false
				if JY.Person[pid]["生命"] == JY.Person[pid]["生命最大值"] then
					pd = true
				end	
				if JY.Person[pid]["内力"] == JY.Person[pid]["内力最大值"] then
					pd = true
				end	
				if JY.Person[pid]["体力"] == 100 then
					pd = true
				end	
				if ZYBF(pid) then
					pd = true
				end
				if BNJQ(pid) then
					pd = true
				end	
				if pd == true then
					Cat('清除高级异常',WAR.CurID)
					local R = math.random(1,4)
					if  R == 1 then
						JY.Person[pid]["生命"] = JY.Person[pid]["生命最大值"]
					end
					if R == 2 then
						JY.Person[pid]["内力"] = JY.Person[pid]["内力最大值"]
					end
					if R == 3 then
						JY.Person[pid]["体力"] = 100
					end
					if R == 4 then
						JY.Person[pid]["体力"] = 100
						JY.Person[pid]["内力"] = JY.Person[pid]["内力最大值"]
						JY.Person[pid]["生命"] = JY.Person[pid]["生命最大值"]
					end				
				end
			end
			--扫地行动前检索
			if match_ID(pid,114) then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID,142,1,"众生平等・则见法性",C_GOLD);
				local sm = JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"]
				local nl = JY.Person[pid]["内力"]/JY.Person[pid]["内力最大值"]
				local tl = JY.Person[pid]["体力"]/100
				if sm < 0.05 then
					sm = 0.05
				end
				for j = 0,WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] ==  false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local sm1 = JY.Person[tmppid]["生命"]/JY.Person[tmppid]["生命最大值"]
						local nl1 = JY.Person[tmppid]["内力"]/JY.Person[tmppid]["内力最大值"]
						local tl1 = JY.Person[tmppid]["体力"]/100
						if sm1 > sm then
							JY.Person[tmppid]["生命"] = sm * JY.Person[tmppid]["生命最大值"]
						end
						if nl1 > nl then
							JY.Person[tmppid]["内力"] = nl * JY.Person[tmppid]["内力最大值"]
						end
						if tl1 > tl then
							JY.Person[tmppid]["体力"] = tl * 100
						end
					end
				end
				for j = 0,WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] ==  false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
						local sm1 = JY.Person[tmppid]["生命"]/JY.Person[tmppid]["生命最大值"]
						local nl1 = JY.Person[tmppid]["内力"]/JY.Person[tmppid]["内力最大值"]
						local tl1 = JY.Person[tmppid]["体力"]/100
						if sm1 < sm then
							JY.Person[tmppid]["生命"] = sm * JY.Person[tmppid]["生命最大值"]
						end
						if nl1 < nl then
							JY.Person[tmppid]["内力"] = nl * JY.Person[tmppid]["内力最大值"]
						end
						if tl1 < tl then
							JY.Person[tmppid]["体力"] = tl * 100
						end
					end
				end
			end
			--毒布武林 标记修改
			if DubuWL(pid) and JY.Person[pid]["生命"] > 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 232,1,"毒布武林",LightGreen);
				local dy = JY.Person[pid]["用毒能力"]
				for j = 0,WAR.PersonNum - 1 do
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["死亡"] ==  false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						if JY.Person[tmppid]["中毒程度"] > 0 then			
							ztd(j,'生命点数',-dy)
						end
						ztd(j,"中毒点数",War_PoisonHurt(pid,j))
						if WAR.PD['中毒不解'][tmppid] == nil then
							WAR.PD['中毒不解'][tmppid] = math.modf(JY.Person[pid]["实战"] / 100)
						end
					end
				end
				for i = 0,WAR.PersonNum - 1 do
					if WAR.Person[i]["死亡"] ==  false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local zid = WAR.Person[i]["人物编号"]
						for j = 1,#WAR.Debuf18 do
							if j == math.random(#WAR.Debuf18) then
								local dbf = WAR.Debuf18[j][1]
								local n = math.random(5,15)
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end
					end
				end
			end
			--喵太极行动前给敌人附加陷阱
			if (JXPD(pid,456,1) or match_ID(pid,92)) and JY.Person[pid]["生命"] > 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 159,1,"九宫八卦阵",LightGreen);
				for i = 0,WAR.PersonNum - 1 do
					if WAR.Person[i]["死亡"] ==  false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local zid = WAR.Person[i]["人物编号"]
						for j = 1,#WAR.Debuf15 do
							if j == math.random(#WAR.Debuf15) then
								local dbf = WAR.Debuf15[j][1]
								local n = 1
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end
					end
				end
			end
			if (match_ID(pid,577) or (WAR.ZDDH == 288 and pid == 664)) and JY.Person[pid]["生命"] > 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 78,1,"受想行识",C_ORANGE);
				local nm = 0
				for i = 0,WAR.PersonNum - 1 do
					if WAR.Person[i]["死亡"] ==  false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local zid = WAR.Person[i]["人物编号"]
						for j = 1,#WAR.Debuf2 do
							if j == math.random(#WAR.Debuf2) then
								local dbf = WAR.Debuf2[j][1]
								local n = math.random(10,15)
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end
						for j = 1,#WAR.Debuf3 do
							if j == math.random(#WAR.Debuf3) then
								local dbf = WAR.Debuf3[j][1]
								local n = math.random(1,2)
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end	
						for j = 1,#WAR.Debuf4 do
							if j == math.random(#WAR.Debuf4) then
								local dbf = WAR.Debuf4[j][1]
								local n = math.random(10,15)
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end
					end
				end
			end

            --施施
			if match_ID(pid,754) and JY.Person[pid]["生命"] > 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 54,1,"纤纤作细步・精妙世无双",LightGreen);
				for i = 0,WAR.PersonNum - 1 do
					if WAR.Person[i]["死亡"] ==  false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local zid = WAR.Person[i]["人物编号"]
						for j = 1,#WAR.Debuf15 do
							if j == math.random(#WAR.Debuf15) then
								local dbf = WAR.Debuf15[j][1]
								local n = 1
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end
					end
				end
			end
            --施施 
			if match_ID(pid,754) and JY.Person[pid]["生命"] > 0 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 61,1,"垆边人似月・皓腕凝霜雪",C_ORANGE);
				local nm = 0
				for i = 0,WAR.PersonNum - 1 do
					if WAR.Person[i]["死亡"] ==  false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						local zid = WAR.Person[i]["人物编号"]
						for j = 1,#WAR.Debuf2 do
							if j == math.random(#WAR.Debuf2) then
								local dbf = WAR.Debuf2[j][1]
								local n = math.random(10,15)
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end
						for j = 1,#WAR.Debuf3 do
							if j == math.random(#WAR.Debuf3) then
								local dbf = WAR.Debuf3[j][1]
								local n = math.random(1,2)
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end	
						for j = 1,#WAR.Debuf4 do
							if j == math.random(#WAR.Debuf4) then
								local dbf = WAR.Debuf4[j][1]
								local n = math.random(10,15)
								if WAR.PD[dbf][zid] == nil then
									WAR.PD[dbf][zid] = n
								else
									WAR.PD[dbf][zid] =  (WAR.PD[dbf][zid] or 0) + n
								end							
								WAR.TXXS[zid] = 1
							end
						end
					end
				end
			end

			--行动时显示血条
			WAR.ShowHP = 1
	        
			reseteffect(WAR.PD['降龙・飞龙在天'],pid)
			WAR.PD['黯然・倒行逆施'][pid] = nil
			WAR.PD['影随'][pid] = nil
			--Cat('遮影DH2',WAR.CurID)
	        ---------------以上行动前效果--------------------------
	        ---------------以下开始行动指令------------------------
			--无酒不欢：行动时，获取指令
			if 0 < War_isEnd() then
				goto label0
			end
			WAR.ZDDSSF = 1
			if WAR.PD['强人锁男'][pid] ~= nil then
				WAR.PD['强人锁男'][pid] = nil
			elseif WAR.PD["喵姐观战"][pid] ~= nil and WAR.PD["喵姐观战"][pid] == 50 then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 94,1,'一动不动',C_ORANGE)	
			elseif WAR.PD['凝结时空'][pid] ~= nil then
			    WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 164,1,"剑心地狱",C_ORANGE)	
			elseif WAR.PD["昏迷状态"][pid] ~= nil and myhm(WAR.CurID) == false then			--昏迷状态
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 94,1,"昏迷中",C_ORANGE)			
			elseif WAR.PD["威慑"][pid] ~= nil and myhm(WAR.CurID) == false then   --朝廷威慑
			    WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 373,1,"威慑中",C_ORANGE)
			elseif WAR.PD["麻痹状态"][pid] ~= nil and math.random(10) < (WAR.PD["麻痹状态"][pid] or 0) and myhm(WAR.CurID) == false then
			    WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 57,1,"麻痹状态",C_ORANGE)	
			elseif WAR.PD["枪神诀2"][pid] ~= nil and myhm(WAR.CurID) == false then
			    WarDrawMap(0); --不加这条则动画位置无法正常显示
				CurIDTXDH(WAR.CurID, 53,1,"霸王惊雷",C_ORANGE)		
			elseif WAR.ZDDH == 354 then
			    r = War_Auto()
			elseif WAR.PD['受想行识'][pid] ~= nil then
				r = War_RestMenu()
			elseif isteam(pid) and WAR.Person[p]["我方"] then
			--混乱状态50%概率自动
				if (WAR.PD["混乱状态"][pid] ~= nil and math.random(100) <= 50) or (WAR.PD["荒天龙灭"][pid] ~= nil) or (WAR.PD["三尸脑神丹"][pid] ~= nil) then
					r = War_Auto()
				elseif WAR.AutoFight == 0 then
					r = War_Manual()
				elseif JY.Person[pid]["禁用自动"] == 1 then
					r = War_Manual()
				else
					r = War_Auto()
				end
			else
				r = War_Auto()
			end
			WAR.ZDDSSF = 0
			if JY.Restart == 1 then
				return false
			end
			--如果发动左右互搏
			if WAR.ZYHB == 1 then
				WAR.ATK['人物'] = p
				WAR.Person[p].Time = 1005
				WAR.ZYYD = 0
				if WAR.ZHB == 0 then	--周伯通的额外左右这里不再重复记录
					WAR.ZYYD = WAR.Person[p]["移动步数"]
				end
				--阎基偷钱
				if WAR.YJ > 0 then
					instruct_2(174, WAR.YJ)
					WAR.YJ = 0
				end
				local pid = WAR.Person[p]['人物编号']
				WAR.PD['动画判定'][pid] = nil
				if PersonKF(pid,67) and (Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350) or match_ID(pid,633) or JXPD(pid,1,1)) then
					WAR.PD['天生牙'][pid] = nil
					WAR.PD['铁碎牙'][pid] = nil
					local a = math.random(3)
					if a == 1 then
						War_ActupMenu()
					elseif a == 2 then
						War_DefupMenu()
					elseif a == 3 then
						War_RestMenu()
					end	
				end
				if JY.Person[id]["生命"] > 0 and JY.Person[id]["中毒程度"] > 0 then
					local heal_amount1;
					local heal_amount;
					local str = "毒性发作"
					heal_amount=JY.Person[id]["生命"]
					heal_amount1=JY.Person[id]["中毒程度"]
					if heal_amount1 > heal_amount then
						heal_amount1 = heal_amount - 1
					end		
					if actor(id,9) then
						ztd(WAR.CurID,"生命点数",heal_amount1)
						ztd(WAR.CurID,"内力点数",heal_amount1)
						str = "万毒炼体"
					elseif Curr_NG(id,233) or MPTX(id,8) then
						ztd(WAR.CurID,"内力点数",heal_amount1)
						str = "引毒归元"
					elseif MPTX(id,1) then
						if PersonKF(id,87) then
							ztd(WAR.CurID,"生命点数",math.modf(heal_amount1*1.5))
						else
							ztd(WAR.CurID,"生命点数",heal_amount1)
						end
						str = "引毒自疗"
					elseif NGQHB(id,87) then
						str = "毒性无效"
					else
						if WAR.PD['基础蛊毒'][id] ~= nil and WAR.PD['基础蛊毒'][id] > 0 then
							ztd(WAR.CurID,"生命点数", -math.modf(heal_amount1 * 1.5))
							WAR.PD['基础蛊毒'][id] = nil
						elseif WAR.PD['夜雨绵延'][id] ~= nil and WAR.PD['夜雨绵延'][id] > 0 then
							ztd(WAR.CurID,"生命点数", -math.modf(heal_amount1 * 3))
						else
							ztd(WAR.CurID,"生命点数", -heal_amount1)
						end
					end
					Cls();
					War_Show_Count(WAR.CurID, str);
				end
			elseif WAR.ZYHB == 2 and WAR.ZHB == 1 then
				WAR.ATK['人物'] = p    
				WAR.Person[p].Time = 1005
				WAR.ZYYD = 0
				if WAR.ZHB == 1 then	--周伯通的额外左右这里不再重复记录
					WAR.ZYYD = WAR.Person[p]["移动步数"]
				end
				--阎基偷钱
				if WAR.YJ > 0 then
					instruct_2(174, WAR.YJ)
					WAR.YJ = 0
				end
				local pid = WAR.Person[p]['人物编号']
				WAR.PD['动画判定'][id] = nil
				if PersonKF(pid,67) and (Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350) or match_ID(pid,633) or JXPD(pid,1,1)) then
					WAR.PD['天生牙'][pid] = nil
					WAR.PD['铁碎牙'][pid] = nil
					local a = math.random(3)
					if a == 1 then
						War_ActupMenu()
					elseif a == 2 then
						War_DefupMenu()
					elseif a == 3 then
						War_RestMenu()
					end	
				end
				if JY.Person[id]["生命"] > 0 and JY.Person[id]["中毒程度"]>0 then
					local heal_amount1;
					local heal_amount;
					local str = "毒性发作"
					heal_amount=JY.Person[id]["生命"]
					heal_amount1=JY.Person[id]["中毒程度"]
					if heal_amount1 > heal_amount then
						heal_amount1 = heal_amount - 1
					end		
					if actor(id,9) then
						ztd(WAR.CurID,"生命点数",heal_amount1)
						ztd(WAR.CurID,"内力点数",heal_amount1)
						str = "万毒炼体"
					elseif Curr_NG(id,233) or MPTX(id,8) then
						ztd(WAR.CurID,"内力点数",heal_amount1)
						str = "引毒归元"
					elseif MPTX(id,1) then
						if PersonKF(id,87) then
							ztd(WAR.CurID,"生命点数",math.modf(heal_amount1*1.5))
						else
							ztd(WAR.CurID,"生命点数",heal_amount1)
						end
						str = "引毒自疗"
					elseif NGQHB(id,87) then
						str = "毒性无效"
					else
						if WAR.PD['基础蛊毒'][id] ~= nil and WAR.PD['基础蛊毒'][id] > 0 then
							ztd(WAR.CurID,"生命点数", -math.modf(heal_amount1 * 1.5))
							WAR.PD['基础蛊毒'][id] = nil
						elseif WAR.PD['夜雨绵延'][id] ~= nil and WAR.PD['夜雨绵延'][id] > 0 then
							ztd(WAR.CurID,"生命点数", -math.modf(heal_amount1 * 3))
						else
							ztd(WAR.CurID,"生命点数", -heal_amount1)
						end
					end
					Cls();
					War_Show_Count(WAR.CurID, str);
				end
			else
				if WAR.ZYHB == 2 then
					WAR.ZYHB = 0
				end
				WAR.PD['动画判定'][pid] = nil
				if WAR.YYDL2[pid] ~= nil then
					if WAR.PD['真左右互搏'][pid] == 1 and WAR.YYDL2[pid] > 4 then
						WAR.YYDL2[pid] = nil
					else
						WAR.YYDL2[pid] = nil
					end
				end		
				--周伯通的追加互搏判定
				if WAR.ZHB == 2 then
					WAR.ZHB = 0
					WAR.PD['真左右互搏'][pid] = nil
				end
				WAR.PD['天生牙'][pid] = nil
				WAR.PD['铁碎牙'][pid] = nil
				WAR.Person[p].Time = WAR.Person[p].Time - 1000
				if WAR.Person[p].Time < -500 then
					WAR.Person[p].Time = -500
				end
				if JY.Person[id]["生命"] > 0 and JY.Person[id]["中毒程度"] > 0 then
					local heal_amount1;
					local heal_amount;
					local str = "毒性发作"
					heal_amount=JY.Person[id]["生命"]
					heal_amount1=JY.Person[id]["中毒程度"]
					if heal_amount1 > heal_amount then
						heal_amount1 = heal_amount - 1
					end		
					if actor(id,9) then
						ztd(WAR.CurID,"生命点数",heal_amount1)
						ztd(WAR.CurID,"内力点数",heal_amount1)
						str = "万毒炼体"
					elseif Curr_NG(id,233) or MPTX(id,8) then
						ztd(WAR.CurID,"内力点数",heal_amount1)
						str = "引毒归元"
					elseif MPTX(id,1) then
						if PersonKF(id,87) then
							ztd(WAR.CurID,"生命点数",math.modf(heal_amount1*1.5))
						else
							ztd(WAR.CurID,"生命点数",heal_amount1)
						end
						str = "引毒自疗"
					elseif NGQHB(id,87) then
						str = "毒性无效"
					else
						if WAR.PD['基础蛊毒'][id] ~= nil and WAR.PD['基础蛊毒'][id] > 0 then
							ztd(WAR.CurID,"生命点数", -math.modf(heal_amount1 * 1.5))
							WAR.PD['基础蛊毒'][id] = nil
						elseif WAR.PD['夜雨绵延'][id] ~= nil and WAR.PD['夜雨绵延'][id] > 0 then
							ztd(WAR.CurID,"生命点数", -math.modf(heal_amount1 * 3))
						else
							ztd(WAR.CurID,"生命点数", -heal_amount1)
						end
					end
					Cls();
					War_Show_Count(WAR.CurID, str);
				end
				------------------------------------------------人物行动后-----------------------------------------------------
				--萧远山・杀破狼
				if match_ID(id,112) then
					if WAR.XYS > 0 then
						WAR.XYS = WAR.XYS - 1
						if WAR.XYS < 1 then
							WAR.XYS = 0
						end
					else
						nuqi(id,-50)
					end
					--[[ if WAR.XYS == 0 then
						CurIDTXDH(WAR.CurID, 124,1,"走火入魔",C_GOLD);
						WAR.ZHRM[id]=5
					end ]]
				end
				--王重阳金雁功特效
				if WAR.PD['复活・王重阳'][id] == 1 and match_ID(id,129) and JY.Person[id]["生命"] > 0 then
					WAR.PD['先天护盾'][id] = (WAR.PD['先天护盾'][id] or 0) + WAR.YDBS * 300			
					if WAR.Person[WAR.CurID]['护盾'] == nil or WAR.Person[WAR.CurID]['护盾'] <= -1 then
						WAR.Person[WAR.CurID]['护盾'] = 3
					end
					Cls();
					War_Show_Count(WAR.CurID, "金雁回翔・重阳道体");
				end
				--阎基偷钱
				if WAR.YJ > 0 then
					instruct_2(174, WAR.YJ)
					WAR.YJ = 0
				end
				--朱九真，随机得到食材
				if match_ID(id, 81) and WAR.ZJZ == 0 and JLSD(0,40,id) then
					instruct_2(210, 10)
					WAR.ZJZ = 1
				end	
				--空性使用龙爪手攻击后自动进入等待状态
				if match_ID(id, 170) and WAR.SLGFH == 1  then
					War_Wait()				
					WAR.SLGFH = 0
				end
				--空闻使用大力金刚掌自动进入蓄力状态
	            if match_ID(id,169) and WAR.SWJGS == 1 then
					War_ActupMenu()				
					WAR.SWJGS = 0
				end
				--武当派4级弟子使太极拳或剑后自动进入蓄力状态
				if WAR.WDXL == 1 then
				    War_ActupMenu()
				    WAR.WDXL = 0
				end
				--宋远桥使用太极拳或太极剑攻击后自动进入防御状态
				if WAR.WDRX == 1 then
					War_DefupMenu()
					WAR.WDRX = 0
				end
				--太极神功自动防御
				if PersonKF(id,171) then
					War_DefupMenu()
				end		
				if WAR.PD['降龙・潜龙勿用'][id] == 1 then 
					War_DefupMenu()
					addbuff(id,WAR.PD['集气速度'],20)
					WAR.PD['降龙・潜龙勿用'][id] = nil
				end
				--辟邪剑意
				if (match_ID(id,457) and CC.TX["笑傲邪线"] > 0) or match_ID(id,92) or (match_ID(id,457) and WAR.ZDDH == 456) then 
					WAR.BXAY[id] = (WAR.BXAY[id] or 0) + 1
					if WAR.BXAY[id] > 3 then
						WAR.BXAY[id] = 3
					end
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 		
							if WAR.BXAY[WAR.Person[j]["人物编号"]] == nil then     
								WAR.BXAY[WAR.Person[j]["人物编号"]] =1
							else
								WAR.BXAY[WAR.Person[j]["人物编号"]] = WAR.BXAY[WAR.Person[j]["人物编号"]] + 1
								if WAR.BXAY[WAR.Person[j]["人物编号"]] > 3 then
									WAR.BXAY[WAR.Person[j]["人物编号"]] = 3
								end	
							end
						end	
					end
				end	
				--辟邪剑意
				if ((match_ID(id,457) and CC.TX["笑傲邪线"] > 0) or match_ID(id,92) or (match_ID(id,457) and WAR.ZDDH == 456)) and WAR.BXAY[id] >= 3 then 
					local size = 60
					local x = CC.ScreenW/2;
					local y = CC.ScreenH/2;
					local offx = (#"【辟邪・断魂斩】】")*size/4
					local offy = size/2
					lib.Background(0,y-50,CC.ScreenW,y+50,98)
					DrawString(x-offx,y-offy,"【辟邪・断魂斩】",C_GOLD,size);  
					ShowScreen();
					lib.Delay(500);	
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID,400,1,"辟邪剑意",C_ORANGE);
					WAR.BXAY_1 = 1
				end
				if WAR.BXAY_1 == 1 then
					CleanWarMap(4, 0)
					for j = 0, WAR.PersonNum - 1 do
						local eid = WAR.Person[j]["人物编号"]
						local qycs = WAR.BXAY[eid] or 0 
						local sh = JY.Person[eid]["生命最大值"]* qycs * 0.05
						local nl = JY.Person[eid]["内力最大值"]* qycs * 0.1
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							ztd(j,"生命点数",-math.modf(sh))
							ztd(j,"内力点数",-math.modf(nl*2))
						end
					end
					War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, 0, 0, 0, 0, 399)
					WAR.BXAY[id] = 0
					WAR.BXAY_1 = 0
				end
				--竹风雨滴
				if match_ID(id,520) and JY.Person[id]["生命"] > 0 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"] then
					ztd(WAR.CurID,"生命点数",5000)
				end
				--步惊云 剑23	
				if WAR.SL23  == 1 and match_ID(id,584) then
					WAR.SL23 = 0
				end
				--施施
				if match_ID(id,754) and JY.Person[id]["生命"] > 0 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"] then
					ztd(WAR.CurID,"生命点数",800)
				end
				--李四
				if (match_ID(id,42) or match_ID(id,9824)) and JY.Person[0]["品德"] <= 60 then
					WAR.LSFE=1
					CleanWarMap(4, 0)
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 155,1,"罚恶")		
					local x1 = WAR.Person[WAR.CurID]["坐标X"]
					local y1 = WAR.Person[WAR.CurID]["坐标Y"]
					War_ExecuteMenu_Sub(x1, y1, 1, -1)
				end
				--张三
				if (match_ID(id,41) or match_ID(id,9825)) and JY.Person[0]["品德"] >= 60 then
					WAR.ZSSS = 1
					CleanWarMap(4, 0)
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 155,1,"赏善")	
					local x1 = WAR.Person[WAR.CurID]["坐标X"]
					local y1 = WAR.Person[WAR.CurID]["坐标Y"]
					War_ExecuteMenu_Sub(x1, y1, 3, -1)
				end
				--汤沛 甘霖惠七省 标记修改
				if ZDGH(WAR.CurID,9923) then	
					ztd(WAR.CurID,"生命点数", 700)
					Cls();
					War_Show_Count(WAR.CurID, "甘霖惠七省");
				end
				--天域幻音
				if ZDGH(WAR.CurID,9998) then	
				    AddPersonAttrib(id,"中毒程度",-JY.Person[id]["中毒程度"])
					AddPersonAttrib(id,"受伤程度",-JY.Person[id]["受伤程度"])
					AddPersonAttrib(id,"灼烧程度",-JY.Person[id]["灼烧程度"])
					AddPersonAttrib(id,"冰封程度",-JY.Person[id]["冰封程度"])
					AddPersonAttrib(id,"流血程度",-JY.Person[id]["流血程度"])
					AddPersonAttrib(id,"封穴程度",-JY.Person[id]["封穴程度"])
					local heal_amount1;
					local heal_amount;
					heal_amount1 = (JY.Person[id]["生命最大值"] - JY.Person[id]["生命"])
					heal_amount = limitX(math.modf(heal_amount1*0.2),500,1000)
					if JY.Base["天书数量"] > 6 then
						heal_amount = math.modf(heal_amount*2)
	                end
					ztd(WAR.CurID,"生命点数", heal_amount)
					Cls();
					War_Show_Count(WAR.CurID, "天域幻音");
				end
				------------------------------------------------内功行动后-----------------------------------------------------
				--易水寒诀
				if Curr_NG(id,43) then
					local j = 5
					if match_ID(id,514) and math.random(10) > 5 then
						j = j + math.modf(math.random(2)*5)
					end	
					if WAR.PD["易水寒诀"][id] == nil or WAR.PD["易水寒诀"][id] == 0 then
						WAR.PD["易水寒诀"][id] = j
					else
						WAR.PD["易水寒诀"][id] = WAR.PD["易水寒诀"][id] + j
					end
					if WAR.PD["易水寒诀"][id] > 100 then
						WAR.PD["易水寒诀"][id] = 100
					end
				end
				--蛤蟆混元
				if NGQHB(id,95) and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 249,1,"混沌.恢复",C_ORANGE);
					ztd(WAR.CurID,"生命点数", math.random(100,150))
					ztd(WAR.CurID,"内力点数", math.random(200,300))
					ztd(WAR.CurID,"体力点数", math.random(1,4))
					local yx = math.random(1,5)
					if yx == 1 then
						WAR.PD['白云熊胆'][id] = 10
					end
					if yx == 2 then
						WAR.PD['天香续命'][id] = 10
					end
					if yx == 3 then
						WAR.PD['小还丹'][id] = 10
					end
					if yx == 4 then
						WAR.PD['黄连解毒'][id] = 10
					end
					if yx == 5 then
						WAR.PD['牛黄血蝎'][id] = 10
					end
				end	
			    --罗汉伏魔功 每回合回复生命
				if PersonKF(id,96) and JY.Person[id]["生命"] > 0 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"] then
					local heal_amount;
					heal_amount = limitX(JY.Person[id]["生命最大值"] - JY.Person[id]["生命"],1000,8000)
					if Curr_NG(id,96) then
						heal_amount = math.modf(heal_amount*0.2)
					else
						heal_amount = math.modf(heal_amount*0.1)
					end
					ztd(WAR.CurID,"生命点数", heal_amount)
					Cls();
					War_Show_Count(WAR.CurID, "罗汉伏魔功恢复生命");
				end
				--太玄乾坤
				if NGQH(id,102) and WAR.PD["太玄组合防御4"][id] == nil and JLSD(0,60,id) then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 311,1,"银鞍照白马 飒沓如流星",LightSkyBlue);
					WAR.PD["太玄组合防御4"][id] = 1
				end
				--九霄中华
				if NGQH(id,184) and WAR.PD['九霄剑气1'][id] ~= nil then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 412,1,"剑气凝聚・散",C_ORANGE)
					for j = 0, WAR.PersonNum - 1 do
						local id = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
							--无酒不欢：记录人物血量
							WAR.Person[j]["Life_Before_Hit"] = JY.Person[WAR.Person[j]["人物编号"]]["生命"]
							WAR.Person[j]["生命点数"] = (WAR.Person[j]["生命点数"] or 0) - math.modf(JY.Person[WAR.Person[j]["人物编号"]]["生命"]*0.1)
							JY.Person[WAR.Person[j]["人物编号"]]["生命"] = math.modf(JY.Person[WAR.Person[j]["人物编号"]]["生命"]*0.9)
							if JY.Person[id]["生命"] < math.modf(JY.Person[id]["生命最大值"]*0.1) then
								JY.Person[id]["生命"] = 0
							end
						end
					end
				end
				if WAR.PD['九霄剑气2'][id] ~= nil then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 413,1,"剑气感应・斩",C_ORANGE)
					for j = 0, WAR.PersonNum - 1 do
						local id = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
							--无酒不欢：记录人物血量
							WAR.Person[j]["Life_Before_Hit"] = JY.Person[WAR.Person[j]["人物编号"]]["生命"]
							WAR.Person[j]["生命点数"] = (WAR.Person[j]["生命点数"] or 0) - math.modf(JY.Person[WAR.Person[j]["人物编号"]]["生命"]*0.1)
							JY.Person[WAR.Person[j]["人物编号"]]["生命"] = math.modf(JY.Person[WAR.Person[j]["人物编号"]]["生命"]*0.9)
							if JY.Person[id]["生命"] < math.modf(JY.Person[id]["生命最大值"]*0.1) then
								JY.Person[id]["生命"] = 0
							end
						end
					end
				end
				--九霄中华行动后
				if NGQH(id,184) then
					local yj = math.modf(TrueYJ(id)/2)
					ztd(WAR.CurID,"生命点数",yj)
					ztd(WAR.CurID,"内力点数",yj)
					if WAR.PD['仙息护体'][id] == nil then
						WAR.PD['仙息护体'][id] = 1
					end
					if WAR.PD["再次行动"][id] == nil then
						WAR.PD["再次行动"][id] = 25
					end
				end
				------------------------------------------------外功行动后-----------------------------------------------------
				--空明北斗
				if WAR.KMBD == 1 and WGZH(id,15,39) and JY.Person[id]["生命"] > 0 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"] then
					ztd(WAR.CurID,"生命点数",500)
				end
				--黯然・呆若木鸡
				if WAR.PD['黯然・呆若木鸡'][id] == 1 then
					if math.random(10) > 8 then
						WAR.PD['黯然・呆若木鸡'][id] = 2
					end
				end
				if WAR.PD['黯然・呆若木鸡'][id] ~= nil then
					if WAR.PD['黯然・呆若木鸡'][id] == 2 then
						War_ActupMenu()
						War_DefupMenu()
						War_RestMenu()
					end	
					WAR.PD['黯然・呆若木鸡'][id] = nil
				end
				--九阴降龙 腾云 
				if PersonKF(id,26) and (PersonKF(id,107) or (match_ID(id,527) and PersonKF(id,367))) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false then
							if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
								if nokillspeed(j) == false then
									WAR.Person[j].TimeAdd = WAR.Person[j].TimeAdd - 100
								end
							else
							    ztd(j,'集气位置',100)
							end
						end	
					end
					DrawTimeBar2()
					War_DefupMenu()
				end
				--慈悲大智 	
				if WGZH(id,57,133) and JY.Person[id]["生命"] > 0 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"] then
					local jl = math.modf(JY.Person[id]["品德"] * 0.3)
			        if JLSD(20,50 + jl,id) then
						local a = math.modf(JY.Person[id]["内力"]*0.15)
						ztd(WAR.CurID,"生命点数",a)
						War_Show_Count(WAR.CurID, "龙树菩提・大智大慧");
					end
				end
				------------------------------------------------门派行动后-----------------------------------------------------
				--武当梯云纵	
				if MPTX(id,4) and Curr_QG(id,149) and WAR.PD['太极蓄力'][id] ~= nil and WAR.PD['太极蓄力'][id] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 72,1,"梯云・万化太极",C_ORANGE);
					local mpdj = MPDJ(id)
					if match_ID(id,5) then
						mpdj = 5
					end
					local jl = math.modf(mpdj*5)
					if match_ID(id,5) then
						WAR.PD['太极蓄力'][id] = math.modf(WAR.PD['太极蓄力'][id]*1.3)
					elseif JLSD(10,50+jl,id) then
					    WAR.PD['太极蓄力'][id] = math.modf(WAR.PD['太极蓄力'][id]*1.2)
					end
				end
				--崆峒4级
				if MPTX(id,18,4) and JY.Person[id]["生命"] > 0 then		
					local a = math.modf((JY.Person[id]["生命最大值"] - JY.Person[id]["生命"])*0.3)
					local b = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.3)
					ztd(WAR.CurID,"生命点数",a)
					ztd(WAR.CurID,"内力点数",b)
					War_Show_Count(WAR.CurID, "崆峒秘技恢复生命内力");
				end
				--昆仑
				if MPTX(id,19,2) and JY.Person[id]["生命"] > 0 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"] then
					local heal_amount;
					heal_amount = limitX(JY.Person[id]["生命最大值"] - JY.Person[id]["生命"],500,1500)
					ztd(WAR.CurID,"生命点数", heal_amount)
					Cls();
					War_Show_Count(WAR.CurID, "昆仑秘法.恢复生命");
	            end
				--花间2级
				if MPTX(id,21,2) and JY.Person[id]["生命"] > 0 then		
					local a = math.modf((JY.Person[id]["生命最大值"] - JY.Person[id]["生命"])*0.3)
					local b = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.3)
					ztd(WAR.CurID,"生命点数",a)
					ztd(WAR.CurID,"内力点数",b)
					War_Show_Count(WAR.CurID, "烟月不知人事改・夜阑还照深宫");
				end
				--背嵬军铁马阵
				if MPTX(id,23,2) and WAR.TMZF < 3 then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							WAR.TMZF= limitX(WAR.TMZF + 1,0,3)
						end
					end	
					lib.Delay(20)			
					DrawTimeBar2()
				end
				--背嵬军
				if MPTX(id,23,3) then
					if JY.Person[id]["生命最大值"] / 2 < JY.Person[id]["生命"] then
						War_ActupMenu()
						CurIDTXDH(WAR.CurID, 85,1,"蓄势冲锋", LimeGreen);
					else
					    War_DefupMenu()
						CurIDTXDH(WAR.CurID, 85,1,"守株待兔", LimeGreen);
					end
				end
				--背嵬军将军令
				if MPTX(id,23,4) and JY.Person[id]["生命"] > 0 then
					local jl = WAR.LBPM * 5
					local xz = 7 * WAR.LBPM
					if WAR.LBPM > 6 then
						WAR.PD['神兵'][id] = (WAR.PD['神兵'][id] or 0) + math.random(5,15)
						WAR.PD['血淬'][id] = (WAR.PD['血淬'][id] or 0) + xz
					end 
					if JLSD(0,10+jl,id) then
						WarDrawMap(0); --不加这条则动画位置无法正常显示
				        CurIDTXDH(WAR.CurID, 140,1,"驰骋沙场",LimeGreen);
						Cat('清除中级异常',WAR.CurID)
					end
					if PersonKF(id,198) and Curr_NG(id,199) then
						WarDrawMap(0); --不加这条则动画位置无法正常显示
					    CurIDTXDH(WAR.CurID, 56,1,"散手连打",C_ORANGE);
						for j = 0, WAR.PersonNum - 1 do
						    local sz = math.modf(JY.Person[id]["实战"] / 8)
						    local sh = sz * WAR.LBPM
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						        ztd(j,"生命点数",-sh)
						    end
					    end
					end
					lib.Delay(10)			
					DrawTimeBar2()
				end
				--背嵬军将军 行动后提升我方全体实战的集气
				if MPTX(id,23,4) and Curr_NG(id,199) and JLSD(10,66,id) and JY.Person[id]["生命"] > 0 then 
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 157,1,"全军突击",C_ORANGE);
					for j = 0, WAR.PersonNum - 1 do
						local sz = math.modf(JY.Person[id]["实战"] * 0.5)
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							ztd(j,'集气位置',sz)
						end
					end	
					lib.Delay(20)			
					DrawTimeBar2()
				end
				--护龙军师大阵
				if MPTX(id,25,4) and Curr_NG(id,366) then
					local dz,gm = 0,0
					for i = 0, WAR.PersonNum - 1 do
						if dead(i) == false then
							if DWPD(WAR.CurID,i) then
								local zid = WAR.Person[i]["人物编号"]
								if WAR.PD['灌木阵'][WAR.Person[i]["人物编号"]] == 1 then
								    gm = math.random(#WAR.Debuf15)
								    local dbf = WAR.Debuf15[gm][1]
								    WAR.PD[dbf][zid] = 1
								    nuqi(zid,-math.random(10,30))
								    zhanyi(zid,-math.random(10,30))
									if nokillspeed(i) == false then
										WAR.Person[i].Time = WAR.Person[i].Time - math.random(100,300)
									end
								    if math.random(2) > 1 then
									    dz = math.random(1,2)
								    else
								        dz = math.random(4,5)
								    end
								    WAR.PD['灌木阵'][WAR.Person[i]["人物编号"]] = nil
								end
								if WAR.PD['烈火阵'][WAR.Person[i]["人物编号"]] == 1 then
								    if WAR.PD['烈诅咒'][zid] ~=nil and WAR.PD['烈诅咒'][zid] > 0 then
									    local zy = (300 - WAR.SPIRIT[zid])/200
									    local zz = math.modf(WAR.PD['烈诅咒'][zid] * zy)
									    ztd(i,"生命点数",-zz)
									    for k = 0,10 do
										    Cat('实时特效动画')
										    Cls()
										    Cat('实时特效动画2')
										    DrawStrBox(-1, -1, "烈火诅咒爆发", C_ORANGE, CC.DefaultFont)
										    ShowScreen();
										    lib.Delay(CC.BattleDelay)
									    end
								    end
								    WAR.PD['烈诅咒'][zid] = nil
								    if math.random(2) > 1 then
									    dz = math.random(1,3)
								    else
								        dz = 5
								    end
								    WAR.PD['烈火阵'][zid] = nil
								end
							else
								if WAR.PD['黄金阵'][WAR.Person[i]["人物编号"]] == 1 then
									if math.random(10) > 7 then
										WAR.PD["战神状态"][WAR.Person[i]["人物编号"]] = 2
									else
										WAR.PD["西瓜刀・天人"][WAR.Person[i]["人物编号"]] = 2
									end
									if math.random(2) > 1 then
										dz = 1
									else
										dz = math.random(3,5)
									end
									WAR.PD['黄金阵'][WAR.Person[i]["人物编号"]] = nil
								end
								if WAR.PD['驱水阵'][WAR.Person[i]["人物编号"]] == 1 then
									local bd = WAR.Person[i]["人物编号"]
									nuqi(bd,math.random(10,30))
									zhanyi(bd,math.random(10,30))
									WAR.Person[i].Time = WAR.Person[i].Time + math.random(100,300)
									ztd(i,"生命点数",math.random(800,2000))
									ztd(i,"内力点数",math.random(800,2000))
									ztd(i,"体力点数",math.random(10,20))
									dz = math.random(1,4)
									WAR.PD['驱水阵'][WAR.Person[i]["人物编号"]] = nil
								end
								if WAR.PD['后土阵'][WAR.Person[i]["人物编号"]] == 1 then
									WAR.PD["再次行动"][WAR.Person[i]["人物编号"]] = 30
									dz = math.random(2,5)
									WAR.PD['后土阵'][WAR.Person[i]["人物编号"]] = nil
								end
							end
						end
					end
					--护龙军师大阵变化
					if dz == 1 then
						for p = 0, WAR.PersonNum-1 do
							if WAR.Person[p]["死亡"] == false then
								if DWPD(WAR.CurID,p) == false then
									WAR.PD['后土阵'][WAR.Person[p]["人物编号"]] = 1
								end
							end
						end
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,161,1,"五行更替・后土千变阵")
					end
					if dz == 2 then
						for p = 0, WAR.PersonNum-1 do
							if WAR.Person[p]["死亡"] == false then
								if DWPD(WAR.CurID,p) == false then
									WAR.PD['黄金阵'][WAR.Person[p]["人物编号"]] = 1
								end
							end
						end
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,247,1,"五行更替・黄金福禄阵")
					end
					if dz == 3 then
						for p = 0, WAR.PersonNum-1 do
							if WAR.Person[p]["死亡"] == false then
								if DWPD(WAR.CurID,p) then
									WAR.PD['灌木阵'][WAR.Person[p]["人物编号"]] = 1
								end
							end
						end
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,236,1,"五行更替・灌木缚身阵")
					end
					if dz == 4 then
						for p = 0, WAR.PersonNum-1 do
							if WAR.Person[p]["死亡"] == false then
								if DWPD(WAR.CurID,p) then
									WAR.PD['烈火阵'][WAR.Person[p]["人物编号"]] = 1
								end
							end
						end
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,191,1,"五行更替・烈火焚身阵")
					end
					if dz == 5 then
						for p = 0, WAR.PersonNum-1 do
							if WAR.Person[p]["死亡"] == false then
								if DWPD(WAR.CurID,p) == false then
									WAR.PD['驱水阵'][WAR.Person[p]["人物编号"]] = 1
								end
							end
						end
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,223,1,"五行更替・驱水润物阵")
					end
				end
				--兽王庄行动后
				if MPTX(id,27) then
					local jl = 5*MPDJ(id) + math.modf(Qg(WAR.CurID)/25)
					if JLSD(0,jl,id) then
						WarDrawMap(0); --不加这条则动画位置无法正常显示
						CurIDTXDH(WAR.CurID,154, 1,"鹰翔", Dark_Gold);
						if WAR.PD["时序闪避"][id] == nil then
							WAR.PD["时序闪避"][id] = 5*MPDJ(id)
						end
					end
					if WAR.PD["兽血沸腾"][id] ~= nil then
						WAR.PD["兽血沸腾"][id] = nil
					end
				end
				--花间2级
				if MPTX(id,30) and JY.Person[id]["生命"] > 0 then		
					ztd(WAR.CurID,"生命点数",500)
					ztd(WAR.CurID,"内力点数",1000)
					ztd(WAR.CurID,"体力点数",10)
					War_Show_Count(WAR.CurID, "浩然正气");
				end
				------------------------------------------------奇穴行动后-----------------------------------------------------
				if WAR.PD['九龙天'][id] ~= nil then
					WAR.PD['九龙天'][id] = nil
				end	
				if QIQX(id,'天魔叱') > 0 and math.random(10) > 7 then
					local yc = {'昏迷状态','魅惑状态','混乱状态'}
					for k = 0, WAR.PersonNum - 1 do
						if dead(k) == false and DWPD(k,p) and RealJL(k,p,8) then
							local kid = WAR.Person[k]['人物编号']
							WAR.PD[yc[math.random(3)]][kid] = 1
							ztd(k,'生命点数',-(psx(kid,'受伤程度')+psx(kid,'中毒程度')+psx(kid,'冰封程度')+psx(kid,'灼烧程度')+psx(kid,'封穴程度')+psx(kid,'流血程度')))
							ztd(k,'内力点数',-(psx(kid,'受伤程度')+psx(kid,'中毒程度')+psx(kid,'冰封程度')+psx(kid,'灼烧程度')+psx(kid,'封穴程度')+psx(kid,'流血程度')))
						end
					end	
				end	
				
				--点点战・战意
				if WAR.RWSZ > 0 and match_ID(id,457) and WAR.ZDDH == 402 then
					if WAR.RWSZ > 0 then
						WAR.LQZ[id] = 100
					end
					if WAR.RWSZ > 1 then
						zhanyi(id,200)
					end
				end
				--神足经 标记修改
				if Curr_NG(id,233) then
					local HD = (WAR.YDBS+1) * JY.Person[id]["生命增长"] * 10
					if WAR.PD["神足护盾"][id] == nil then
						WAR.PD["神足护盾"][id] = HD
					else
					    WAR.PD["神足护盾"][id] = (WAR.PD["神足护盾"][id] or 0) + math.modf(HD * 0.2)
						if WAR.PD["神足护盾"][id] > JY.Person[id]["生命增长"] * 500 then
							WAR.PD["神足护盾"][id] = JY.Person[id]["生命增长"] * 500
						end
					end		
					if WAR.Person[WAR.CurID]['护盾'] == nil or WAR.Person[WAR.CurID]['护盾'] <= - 1 then
						WAR.Person[WAR.CurID]['护盾'] = 21
					end
				end	
				--天魔修罗刀 行动后
				if (PersonKF(id,58) and PersonKF(id,160))
				or (MPTX(id,6,2) and (PersonKF(id,58) or PersonKF(id,63) or PersonKF(id,66))) then
					if WAR.PD['鬼禅六断'][id] == nil then
						WAR.PD['鬼禅六断'][id] = 20
					else
					    local pd = 150 - JY.Person[id]["品德"]
						WAR.PD['鬼禅六断'][id] = (WAR.PD['鬼禅六断'][id] or 0) + pd
						if WAR.PD['鬼禅六断'][id] > 5000 then
							WAR.PD['鬼禅六断'][id] = 5000
						end
					end  
		        end
				--先天调息，行动后休息
				if Curr_NG(id,100) then
					local jl = 40
					if MPTX(id,16) then
						jl = jl + 20
					end
					if match_ID(id,129) or match_ID(id,64) then
						jl = 100
					end
					if JLSD(0,jl,id) then
						WarDrawMap(0); --不加这条则动画位置无法正常显示
						CurIDTXDH(WAR.CurID, 19,1,"先天・收招调息",C_ORANGE);
						War_RestMenu()
					end
				end
				--云灏地府之下
				if match_ID(id,748) then
					local sm = JY.Person[id]["生命"]/JY.Person[id]["生命最大值"]
					local nl = JY.Person[id]["内力"]/JY.Person[id]["内力最大值"]
					local tl = JY.Person[id]["体力"]/100
					if sm >= nl and sm >= tl and nl ~= tl then
						ztd(WAR.CurID,"体力点数",(100-JY.Person[id]["体力"])*sm/2.5)
						ztd(WAR.CurID,"内力点数",(JY.Person[id]["内力最大值"]-JY.Person[id]["内力"])*sm/2.5)
					end
					if nl >= sm and nl >= tl and sm ~= tl then
						ztd(WAR.CurID,"体力点数",(100-JY.Person[id]["体力"])*nl/2.5)
						ztd(WAR.CurID,"生命点数",(JY.Person[id]["生命最大值"]-JY.Person[id]["生命"])*nl/2.5)
					end
					if tl >= sm and tl >= nl and sm ~= nl then
						ztd(WAR.CurID,"内力点数",(JY.Person[id]["内力最大值"]-JY.Person[id]["内力"])*tl/2.5)
						ztd(WAR.CurID,"生命点数",(JY.Person[id]["生命最大值"]-JY.Person[id]["生命"])*tl/2.5)
					end
				end
				--三大神医行动后自动医疗一次,集气增加
				if (match_ID(id,16) or match_ID(id,28) or match_ID(id,45) or (match_ID(id,9943) and math.random(100) < 51)) and JY.Person[id]["生命"] > 0 then 
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					War_AutoDoctor()
					War_Show_Count(WAR.CurID, "妙手仁心");
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							ztd(j,'集气位置',150)
						end
					end				
					lib.Delay(10)
					DrawTimeBar2()
				end
				--松风剑阵
				if (id >= 211 and id <= 213) and WAR.ZDDH == 203 and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
				    CurIDTXDH(WAR.CurID, 138,1,"松风剑浪・波涛汹涌",LimeGreen);
					War_ActupMenu()
				    for j = 0, WAR.PersonNum - 1 do
					    if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							WAR.PD['必连击'][WAR.Person[j]["人物编号"]] = 2
							WAR.PD['增加气攻'][WAR.Person[j]["人物编号"]] = 50
							WAR.JYZJ_FXJ = 1
							ztd(j,'集气位置',200)
					    end
				    end
			        lib.Delay(10)
					DrawTimeBar2()
				end
				--追命行动后追上敌人集气位置
				if match_ID(id,450) and JY.Person[id]["生命"] > 0 then
					local jl = 70
					jl = jl + JY.Base["天书数量"] * 2
					if math.random(100) < jl then
					    local JQ = {}
					    for j = 0, WAR.PersonNum - 1 do
						    JQ[j+1] = WAR.Person[j].Time
						end
						local k = math.random(#JQ)
						if WAR.Person[p].Time < WAR.Person[k-1].Time then
							local zj = WAR.Person[p].Time
							local z = WAR.CurID
							WAR.CurID = p
							WarDrawMap(0)
							CurIDTXDH(WAR.CurID, 66,1,"追命十一・奔腾浪",LightPurple)
							WarDrawMap(0)
							WAR.Person[p].Time = WAR.Person[k-1].Time
							WAR.Person[k-1].Time = zj
							WAR.CurID = z 
						end
					end
				end
				--葵花紫霞行动后追上敌人
				if NGQH(id,105) and JY.Person[id]["生命"] > 0 then
					local jl = 30
					jl = jl + JY.Base["天书数量"] * 2
					if match_ID(id, 27) or match_ID(id, 777) then
						jl = 100
					end
					if math.random(100) <= jl then
					    local JQ = {}
					    for j = 0, WAR.PersonNum - 1 do
						    JQ[j+1] = WAR.Person[j].Time
						end
						local k = math.random(#JQ)
						if WAR.Person[p].Time < WAR.Person[k-1].Time then
							local zj = WAR.Person[p].Time
							local z = WAR.CurID
							WAR.CurID = p
							WarDrawMap(0)
							CurIDTXDH(WAR.CurID, 120,1,"葵花秘技・魅影无形",LightPurple)
							WarDrawMap(0)
							WAR.Person[p].Time = WAR.Person[k-1].Time
							WAR.Person[k-1].Time = zj
							WAR.CurID = z 
						end
					end
				end
				--打狗阵行动后
				if (WAR.ZDDH == 344 or WAR.ZDDH == 84) and isteam(id) == false and JY.Person[id]["生命"] > 0 then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if WAR.PD['锁喉'][WAR.Person[j]["人物编号"]] == nil then
							    WAR.PD['锁喉'][WAR.Person[j]["人物编号"]] = 30
								WAR.PD['锁喉1'][id] = 30
							end
						end
					end
					lib.Delay(10)
					DrawTimeBar2()
				end
				--先天九阴行动后，提升我方150集气
				if (NGQHB(id,100) or match_ID(id, 65)) and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID,409,1,"先天风雅",LimeGreen);
					War_RestMenu()
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							ztd(j,'集气位置',100)
						end
				    end
					lib.Delay(10)
					DrawTimeBar2()
			    end
				--珠落玉盘 行动后提升我方全体100集气
				if (match_ID(id,104) or match_ID(id,9872)) and JY.Person[id]["生命"] > 0 then 
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 22,1,"珠落玉盘",C_ORANGE);
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							ztd(j,'集气位置',100)
						end
					end	
					lib.Delay(20)			
					DrawTimeBar2()
				end
				--昆仑刀剑阵
				if WAR.PD['风雷惊蛰3'][id] ~= nil and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 20,1,"真・暴风掠境",LimeGreen);
					for j = 0, WAR.PersonNum - 1 do
						if dead(j) == false and DWPD(j,WAR.CurID) then
							local jid = WAR.Person[j]['人物编号']
							ztd(j,'集气位置',-100)
							ztd(j,WAR.LXXS,math.random(10,20))
							ztd(j,'内伤点数',math.random(10,20))
							ztd(j,'生命点数',-(psx(jid,'流血程度')+psx(jid,'受伤程度')))
						end
					end
					lib.Delay(20)	
					DrawTimeBar2()
				end
				--极限挑战npc行动后
				if (not inteam(id)) and JY.Person[456]["论剑奖励"] > 0 and JY.Person[id]["生命"] > 0 then
					local jx = {70,60,35,20,12,8,5,0}
					local jsjx = jx[JY.Person[id]['畅想分阶']+1]
					if math.random(100) <= jsjx then
						local a = math.random(1,2)
						if a == 1 then
							War_Wait()
						elseif a == 2 then
						    if WAR.Defup[id] == nil then
								War_DefupMenu()
							end
						end
					end	
					if math.random(100) <= jsjx then
						nuqi(id,4)
					end	
					if math.random(100) <= jsjx then
						zhanyi(id,4)
					end
				end
				--般若金刚行动后
				if QFZH(id,189,91) then
					local yjin = 0
					for j = 1, JY.Base['武功数量'] do 
						local wugong = JY.Person[id]['武功'..j]
						if PersonKF(id,91) or PersonKF(id,96) or PersonKF(id,108) or PersonKF(id,106) 
						or PersonKF(id,144) or PersonKF(id,208) or PersonKF(id,242) or PersonKF(id,243) or PersonKF(id,247) then
							yjin = yjin + 1
						end
					end
					if math.random(10) <= yjin then
						War_Wait()
					end
				end
				--枯荣禅功每回合概率以内力换生命
				if PersonKF(id,207) and JY.Person[id]["生命"] > 0 and JY.Person[id]["内力"] > 0 and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"] then
					local krnl = limitX(math.modf(JY.Person[id]["内力"] / 50),200,800)
					CurIDTXDH(WAR.CurID, 77,1,"亦枯亦荣",C_ORANGE);
					ztd(WAR.CurID,"生命点数",krnl)
					ztd(WAR.CurID,"内力点数",-krnl/2)
				end
				--剑华皈一
				if PersonKF(id,356) and JY.Person[id]["生命"] > 0 and JY.Person[id]["内力"] > 0 then
					local krnl = 0
					if inteam(id) then
						krnl = limitX(math.modf(JY.Person[id]["内力"]/10),0,1000)
					else
					    krnl = limitX(math.modf(JY.Person[id]["内力"]/20),0,500)
					end
					War_Show_Count(WAR.CurID, "剑华皈一");
					Cls();
					ztd(WAR.CurID,"内力点数",-krnl/2)
					if Curr_NG(id,356) then
						ztd(WAR.CurID,"内力点数",-krnl/2)
					end				
				end
				--铁布衫
				if PersonKF(id,196) and JY.Person[id]["生命"] > 0 and JY.Person[id]["内力"] > 0 then
					local krnl = 0
					if inteam(id) then
						krnl = limitX(math.modf(JY.Person[id]["内力"]/10),0,1000)
					else
					    krnl = limitX(math.modf(JY.Person[id]["内力"]/20),0,500)
					end
					War_Show_Count(WAR.CurID, "铁布衫");
					ztd(WAR.CurID,"内力点数", -krnl/2)
					if Curr_NG(id,196) then
						ztd(WAR.CurID,"内力点数", -krnl/2)
					end
				end
		        --密宗
				if MPTX(id,6) and WAR.PD['血魔'][id] == nil and JY.Person[id]["生命"] > 0 then
					local heal_amount;
					heal_amount = (JY.Person[id]["生命最大值"] - JY.Person[id]["生命"])/JY.Person[id]["生命最大值"]
					if PersonKF(id,163) then
						heal_amount = math.modf(heal_amount*0.3)
					else
						heal_amount = math.modf(heal_amount*0.2)
					end
					ztd(WAR.CurID,"生命点数",heal_amount)
					local HN;
					if PersonKF(id,103) then
						HN = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.3)
					else
						HN = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.2)
					end
					ztd(WAR.CurID,"内力点数",HN)
				end	
		        --紫霞神功行动后，回复内力
				if PersonKF(id,89) and JY.Person[id]["生命"] > 0 then
					local HN;
					if Curr_NG(id, 89) then
						HN = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.2)
					--五岳紫霞・
					elseif (PersonKF(id,89) and MPTX(id,14,2)) or JXPD(id,19,1) then
					    HN = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.4)
					else
						HN = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.1)
					end
					ztd(WAR.CurID,"内力点数",HN)
	            end
				--老汉推车 行动后，回复内力 标记修改
				if match_ID(id,9926) and JY.Person[id]["生命"] > 0 then
					local MP1
					local MP2
					MP1 = math.modf(JY.Person[id]["内力最大值"]/2)
					MP2 = math.modf(JY.Person[id]["内力"])
					if MP1 > MP2 then
					local HN;
					HN = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.25)
					ztd(WAR.CurID,"内力点数",HN)
					ztd(WAR.CurID,"体力点数",-1) 
					end
	            end
	            --套装效果.补充内力
				if PDTZ(id,JY.Person[id]["武器"]) and JY.Person[id]["生命"] > 0 then
					local n = JY.Person[id]["武器"]
					if Setmeal[n][4] == 21 then
						local MP1
						local MP2
						MP1 = math.modf(JY.Person[id]["内力最大值"])
						MP2 = math.modf(JY.Person[id]["内力"])
						if MP1>MP2 then
							local HN;
							HN = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.3)
							ztd(WAR.CurID,"内力点数",HN)
							ztd(WAR.CurID,"体力点数",5) 
						end
					end			
				end
				--梅长苏行动后冰封值+10 灼烧值+5
				if match_ID(id,507) and JY.Person[id]["生命"] > 0 then
					local bfz = 0
					local zsz = 0
					bfz = bfz + 10
					zsz =  zsz + 5
					ztd(WAR.CurID,WAR.ZSXS,zsz)
					ztd(WAR.CurID,WAR.BFXS,bfz)
				end     
				--葵花辟邪行动后，为自己附加20时序的辟邪剑气
				if ((PersonKF(id,48) and PersonKF(id,105)) or (PersonKF(id,48) and JXPD(id,19,1))) and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 419,1,"辟邪剑气",C_ORANGE);
					WAR.BXJQ[id] = 20
					lib.Delay(20)			
					DrawTimeBar2()
				end
		        --混元功行动后，减少内伤
				--萧半和
				if (PersonKF(id,90) or PersonKF(id,375) or match_ID(id,189,1)) and JY.Person[id]["生命"] > 0 then
					local NS;
					NS = 5 + math.modf(JY.Person[id]["受伤程度"]/10)
					ztd(WAR.CurID,"内伤点数",-NS)
					Cls();
					local str = "混元功"
					if PersonKF(id,375) then
						str = "混沌气诀"
					end	
					War_Show_Count(WAR.CurID,str.."回复内伤");
				--纯阳混元
				elseif (NGQHB(id,99) and rwnlxz(id,2)) or JXPD(id,189,1) then
					local NS;
					NS = 5 + math.modf(JY.Person[id]["受伤程度"]/5)
					ztd(WAR.CurID,"内伤点数",-NS)
					ztd(WAR.CurID,"体力点数",NS)
					if JLSD(0,30,id) then
						ztd(WAR.CurID,"内伤点数",-JY.Person[id]["受伤程度"])
						ztd(WAR.CurID,"体力点数",100)
					end
					War_Show_Count(WAR.CurID,"混元往生");
			    end
		        --鳄皮护甲 每回合解毒
				if JY.Person[id]["防具"] == 61 and JY.Person[id]["中毒程度"] > 0 then
					local JD = 25 + 10 * (JY.Thing[61]["装备等级"]-1)
					if JY.Person[id]["中毒程度"] < JD then
						JD = JY.Person[id]["中毒程度"]
					end
					ztd(WAR.CurID,"中毒点数",-JD)
					Cls();
					War_Show_Count(WAR.CurID, "鳄皮护甲生化解毒");
				end
				--连环迷踪腿
				if (match_ID(id, 450) or match_ID(id, 9836)) and JY.Person[id]["生命"] > 0 and JLSD(0,50,id) then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 172,1,"连环迷踪腿",C_GOLD);
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
							local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
							local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
							local zt = math.modf(TrueZF(id) / 3)
							if offset1 <= 5 and offset2 <= 5 then
								ztd(i,'生命点数',-zt)
							end
						end
					end	
					Cls();
					Cat('数值显示')
				end
				
				--碧针清掌
				if (match_ID(id, 164) or match_ID(id, 9822)) and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 153,1,"碧针清掌",C_GOLD);
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
							local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
							local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
							local qz = math.modf(TrueQZ(id) / 5)
							if offset1 <= 7 and offset2 <= 7 then
								ztd(i,'生命点数',-qz)
							end
						end
					end
				end
				--密宗血溅十步
				if MPTX(id,6,2) and Curr_NG(id,163) and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 42,1,"血溅十步",C_GOLD);
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
							local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[i]["坐标X"])
							local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[i]["坐标Y"])
							local lx = math.modf(psx(id,'流血程度')/6)
							local nx = math.modf((WAR.PD["凝血纹印"][id] or 0)/150)
							local yd = lx + nx
							if offset1 <= yd and offset2 <= yd then
								ztd(i,'生命点数',-lx*(nx*5+10))
								--敌人昏迷
								if psx(WAR.Person[i]["人物编号"],'流血程度') >= 30 then
									WAR.PD["血色诅咒"][WAR.Person[i]["人物编号"]] = (WAR.PD["血色诅咒"][WAR.Person[i]["人物编号"]] or 0) + 1
								end
								if psx(WAR.Person[i]["人物编号"],'流血程度') >= 50 then
									WAR.PD["昏迷状态"][WAR.Person[i]["人物编号"]] = 1
								end
							end
						end
					end
				end
				--丁春秋
				if (match_ID(id,46) or match_ID(id,9901)) and JY.Person[id]["生命"] > 0 then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 64,1,"三笑销魂散",C_ORANGE);
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							if JY.Person[WAR.Person[j]["人物编号"]]["中毒程度"] > 0 then
								ztd(j,'生命点数',-JY.Person[WAR.Person[j]["人物编号"]]["中毒程度"]*3)
							end
						end
					end
				end
				--剑荡十方
				if match_ID(id, 9772) and JY.Person[id]["生命"] > 0 then
					WAR.PD["剑荡十方"][id] = (WAR.PD["剑荡十方"][id] or 0) + 1
					if JY.Person[id]["生命"] > 0 and WAR.PD["剑荡十方"][id] ~= nil and WAR.PD["剑荡十方"][id] >= 9 then
						WarDrawMap(0); --不加这条则动画位置无法正常显示
						CurIDTXDH(WAR.CurID, 410,1,"剑虽未至・意却伤人",C_ORANGE);
						for j = 0, WAR.PersonNum - 1 do
							local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[j]["坐标X"])
							local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[j]["坐标Y"])
							local offset = offset1+offset2
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
								ztd(j,'生命点数',-50*offset)
							end
							if WAR.PD["剑荡十方"][id] == 11 then
								WAR.PD["剑荡十方"][id] = 1
							end
						end
					end
				end
				------------------------------------------------天赋行动后-----------------------------------------------------
				--降龙罗汉
				if match_ID(id,9728) and JY.Person[id]["生命"] > 0 then		
					ztd(WAR.CurID,"内力点数",700)
					ztd(WAR.CurID,"体力点数",3)
					War_Show_Count(WAR.CurID, "擒龙真气恢复");
				end
				--龙象尊者
				if match_ID(id,9727) and JY.Person[id]["生命"] > 0 then 
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 53,1,"勇猛精进",C_ORANGE);
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							ztd(j,'集气位置',350)
						end
					end	
					lib.Delay(20)			
					DrawTimeBar2()
				end
				------------------------------------------------------------
				------------------战意技专区--------------------------------
				------------------------------------------------------------
				--明王
				if WAR.PD['残日狱衣'][id] ~= nil and (match_ID(id,103) or match_ID(id,745) or match_ID(id,771)) then
					for mw = 0 , WAR.PersonNum - 1 do
						if dead(mw) == false and psx(WAR.Person[mw]['人物编号'],'灼烧程度') > 0 then
							ztd(WAR.CurID,'生命',psx(WAR.Person[mw]['人物编号'],'灼烧程度'))
						end
					end		
					WAR.PD['残日狱衣'][id] = WAR.PD['残日狱衣'][id] - 1
					if WAR.PD['残日狱衣'][id] < 1 then
						WAR.PD['残日狱衣'][id] = nil
						WAR.CHLY = 0
					end
				end		
				------------------------------------------------------------
				----------轻功加强的行动后效果------------------------------
				------------------------------------------------------------
				--运轻功
				if JY.Person[id]['主运轻功'] > 0 then
					WAR.Person[p].Time = WAR.Person[p].Time + math.random(50,100)
				end  
				--飞天神行
				if Curr_QG(id,145) then
					WAR.Person[p].Time = WAR.Person[p].Time + 500
				end
				--凌波微步
				if Curr_QG(id,147) then
					if QGQH(id,147,1) and WAR.YDBS > 0 then
						local aa = WAR.YDBS
						if PersonKF(id,85) then
							aa = aa + 5
						end	
						ztd(WAR.CurID,'内力点数',aa*50)
						ztd(WAR.CurID,'体力点数',aa)
						War_Show_Count(WAR.CurID, "凌波微步・踏海还潮");
					end
				end	
				--天罗地网
		        if Curr_QG(id,148) and match_ID(id,605) then
					WAR.Person[p].Time = WAR.Person[p].Time + 100
				end 
				--一苇渡江
				if Curr_QG(id,186) then
					if JLSD(10,50,id) and JY.Person[id]["封穴程度"] > 0 then
						ztd(WAR.CurID,WAR.FXXS,-math.random(5,10))
						War_Show_Count(WAR.CurID, "一苇渡江・步法足相")
					end
				end
				--黯影迷踪
				if Curr_QG(id,195) then
					if MPTX(id,13) and Curr_NG(id,93) then
					else
						if JLSD(10,40,id) then
							WAR.PD['时序闪避'][id] = limitX((WAR.PD['时序闪避'][id] or 0) + 10,0,30)
						end
					end	
				end	
				--霹雳身法
				if Curr_QG(id,373) then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
				end
				--追魂无影
				if Curr_QG(id,278) then
					WAR.Person[p].Time = WAR.Person[p].Time + 250
					ztd(WAR.CurID,'体力点数',4)
				end 	
				--金雁功
				if QGQH(id,223,1) and WAR.YDBS > 0 then
					WAR.Person[p].Time = WAR.Person[p].Time + math.modf(WAR.YDBS * 50)
					if MPTX(id,16) then
						WAR.Person[p].Time = WAR.Person[p].Time + math.modf(WAR.YDBS * 100)
					end	
					local s = WAR.CurID
					WAR.CurID = p
					--WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 154,1,"金雁横空",C_ORANGE);
					WAR.CurID = s
		        end	
				--暗香疏影
				if QGQH(id,316,2) then
					local a = math.random(1,4)
					local axzl = {"失魂香","忘心香","迷情香","幻梦香"}
					for j = 0, WAR.PersonNum-1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						    local jid = WAR.Person[j]["人物编号"]
						    WAR.PD['暗香疏影'][jid] = a
						end
					end
					CurIDTXDH(WAR.CurID,71,1,"暗香・"..axzl[a])
				end	
				--龙行虎步
				if Curr_QG(id,280) then
					if TFQG(id,280) then
						zhanyi(id,math.random(10,20))
					end
					if match_ID(id,499) and JLSD(10,55,id) then
						for lxhb = 0, WAR.PersonNum - 1 do
							WAR.PD['恐惧状态'][WAR.Person[lxhb]["人物编号"]] = 1
						end
					end	
				end	
				--摘星功
				if QGQH(id,296,2) then
					if JLSD(10,35,id) then
						for d = 0, WAR.PersonNum-1 do
							if DWPD(p,d) and RealJL(p,d,7) and WAR.Person[d]["死亡"] == false then
								local did = WAR.Person[d]["人物编号"]
								WAR.PD['绿火星毒'][did] = math.random(5,9)
							end	
						end	
					end
				end	
				--风吟步
				if Curr_QG(id,300) and MPTX(id,20) then
					local a = WAR.LBPM
					if match_ID(id,514) then
						a = a * 2 + 1
					end
					WAR.PD['易水寒诀'][id] = (WAR.PD['易水寒诀'][id] or 0) + a
				end	
				------------------------------------------------------------------------------------------------
				--------------------------------------------通用行动后回气--------------------------------------
				------------------------------------------------------------------------------------------------
				--通用行动后回气
				if WAR.PD['回气'][id] ~= nil then 
					if (WAR.PD['回气'][id] or 0) > 800 then
						WAR.PD['回气'][id] = 800
					end
					WAR.Person[p].Time = WAR.Person[p].Time + WAR.PD['回气'][id] 
					WAR.PD['回气'][id] = nil
				end
				if WAR.PD['疾如风'][id] ~= nil and WAR.PD['疾如风'][id] > 0 then 
					local rf = WAR.PD['疾如风'][id]
					WAR.Person[p].Time = WAR.Person[p].Time + rf * 300
				    if WAR.Person[p].Time > 980 then
						WAR.Person[p].Time = 980
				    end				
					WAR.PD['疾如风'][id] = nil
				end
				--无酒不欢：等待
				if WAR.Wait[id] == 1 then
					WAR.Wait[id] = 0
					WAR.Person[p].Time = WAR.Person[p].Time + 500
				end
				------------------------------------------------------------------------------------------------
				--------------------------------------------内功行动后回气--------------------------------------
				------------------------------------------------------------------------------------------------
				--太玄乾坤
				if WAR.PD["太玄组合攻击1"][id] ~= nil then
					WAR.Person[p].Time = WAR.Person[p].Time + 100
				end	
				--逮虾户
				if NGQHB(id,199) then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
				end
				--纯阳太极
				if WAR.CYTJ[id] == 1 then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
					WAR.CYTJ[id] = nil
				end 
				--蛤蟆蓄力
				if WAR.HMGXL[id] == 1 then
					WAR.Person[p].Time = WAR.Person[p].Time + 300
					WAR.HMGXL[id] = 0
				end
				--神足经 标记修改
				if Curr_NG(id,233) and WAR.YDBS > 0 then
					local HQ = (WAR.YDBS + 1) * JY.Person[id]["生命增长"] * 5
					WAR.Person[p].Time = WAR.Person[p].Time + HQ
				end 
				--擒龙罗汉
				if NGQH(id,204) then
					if WAR.Actup[id] == 1 then
						WAR.Person[p].Time = WAR.Person[p].Time + 500
					else
					    WAR.Person[p].Time = WAR.Person[p].Time + 250
					end
					if WAR.SLCS[id] ~= nil and WAR.SLCS[id] > 0 then
						WAR.SLCS1[id] = limitX(math.modf(WAR.SLCS[id]*0.5),1,4)
					end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 405, 1, "擒龙傲视")
					WAR.CurID = s
				end
				--太极纯阳
				if NGQH(id,171) then
					WAR.TJSG[id] = limitX((WAR.TJSG[id] or 0) + math.random(200,500),0,5000)
					if WAR.Defup[id] == 1 then
						WAR.Person[p].Time = WAR.Person[p].Time + 300
					else
					    WAR.Person[p].Time = WAR.Person[p].Time + 150
					end
					local s = WAR.CurID
					WAR.CurID = p
					--WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 138,1,"太极圆转",C_ORANGE);
					WAR.CurID = s
		        end		
				--九阴太极
				if NGQH(id,107) and WAR.ZBT3 > 0 then
					local jqxl = JY.Person[id]["轻功"]/10*WAR.ZBT3
					if WAR.Person[p].Time < jqxl then 
						WAR.Person[p].Time = jqxl
					end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID,158,1,"螺旋气劲",C_ORANGE);
					WAR.CurID = s
				end
				--混元真谛
				if match_ID(id,524) then
					local hyzd = (180 - JY.Person[id]["体力"]) * 4
					if WAR.Person[p].Time < hyzd then 
		                WAR.Person[p].Time = hyzd
					end
				end	
				--朝廷百夫长
				if MPTX(id,23,2) then
					local yxfz = math.modf((JY.Person[id]["生命最大值"] - JY.Person[id]["生命"]) / JY.Person[id]["生命最大值"] * 400)
					if WAR.Person[p].Time < yxfz then 
						WAR.Person[p].Time = yxfz
					end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 11,1,"浴血奋战",C_ORANGE);
					WAR.CurID = s
				end	
				------------------------------------------------------------------------------------------------
				--------------------------------------------外功行动后回气--------------------------------------
				------------------------------------------------------------------------------------------------
				--黯然大招
				if WAR.ARJX == 4 then
					WAR.Person[p].Time = WAR.Person[p].Time + 300
				end 
				--九剑真传，荡剑式，回气200
				if WAR.JJDJ == 1 then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
					WAR.JJDJ = 0
				end 	
				------------------------------------------------------------------------------------------------
				--------------------------------------------个人行动后回气--------------------------------------
				------------------------------------------------------------------------------------------------
				
				--林平之根据伤害回气
				if (JXPD(id,36,1) or match_ID(id, 9887)) and WAR.LPZ > 0 then
					WAR.Person[p].Time = WAR.Person[p].Time + WAR.LPZ
					WAR.PD['集气速度'][id] = (WAR.LPZ/40)
					WAR.LPZ = 0
				end
				--虚竹福泽加护
				if match_ID(id, 49) and WAR.XZZ == 1 then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
					WAR.XZZ = 0
				end
				--岳灵珊
				if match_ID(id, 79) or match_ID(id, 9842) then
					local JF = 0
					local bh = id
					for i = 1, JY.Base["武功数量"] do
						if JY.Wugong[JY.Person[bh]["武功" .. i]]["武功类型"] == 3 then
							JF = JF + 1
						end
					end
					WAR.Person[p].Time = WAR.Person[p].Time + (JF) * 150
				end
				--张三丰万法自然 
				if (match_ID(id, 5) or match_ID(id, 9820)) and WAR.ZSF == 1 then
					WAR.Person[p].Time = WAR.Person[p].Time + 500
					if (WAR.TJZX2[id] or 0) > 0 and (WAR.TJZX1[id] or 0) > 0 and WAR.TJZX1[id] > WAR.TJZX2[id] then
						WAR.Person[p].Time = limitX(WAR.Person[p].Time + (WAR.TJZX1[id]-WAR.TJZX2[id])*60,500,700)
						WAR.TJZX1[id] = nil 
						WAR.TJZX2[id] = nil
					end	
					WAR.ZSF = 0
				end
				--封不平狂风快剑
				if (match_ID(id,142) or match_ID(id,9839)) and WAR.KFKJ == 1 then
					WAR.Person[p].Time = WAR.Person[p].Time + 150
					WAR.KFKJ = 0
				end
				--闪电惊鸿
				if match_ID(id,9996) then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
				end
				--萧秋水・腾云
				if WAR.TYJW == 1 and NGQH(id,177) then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
					WAR.TYJW = 0
				end
				--李白诗酒化行 
		        if match_ID(id, 636) and WAR.QLBLX == 1 then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
					WAR.QLBLX = 0
		        end
				--斗气
			    if match_ID(id,767) or match_ID(id,768) or match_ID(id,769) or match_ID(id,770) then 
					WAR.Person[p].Time = WAR.Person[p].Time + 350
				end
				--竹风雨滴
				if match_ID(id,520) then
					if WAR.Person[p].Time < 500 then
						WAR.Person[p].Time = 500
					end
				end
				--点点
				if match_ID(id,457) and WAR.PD['虚邪不染尘'][id] ~= nil and WAR.PD['虚邪不染尘'][id] < 10 then
		    		WAR.Person[p].Time = WAR.Person[p].Time + math.modf(WAR.PD['虚邪不染尘'][id]*100)
				end
				--杨过，行动后集气初始位置额外增加
		        --生命少过二分之一时每少100增加行动后集气位置加100
				if match_ID(id, 58) and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"]/2 then
					local hq = math.modf(600 * (JY.Person[id]["生命最大值"]/2 - JY.Person[id]["生命"]) / JY.Person[id]["生命最大值"])
		        	WAR.Person[p].Time = WAR.Person[p].Time + hq;
					if Curr_QG(id,148) then
						WAR.Person[p].Time = WAR.Person[p].Time + 200
					end	
				end
				--杨过 吼  龙儿~~
				if WAR.XK == 1 then
					for j = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[j]["人物编号"],58) and dead(j) == false and 0 < JY.Person[WAR.Person[j]["人物编号"]]["生命"] then
							if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
								WAR.Person[j].Time = 1005
								say("１Ｒ龙儿－－－－－－！Ｈ５啊－－－－４－－－－３－－－－２－－－－１－－－－－－－－！！！", 58,0)
								WAR.XK = 2
							end	
							WAR.PD['黯然值'][WAR.Person[j]["人物编号"]] = 101
						end
					end
				end	
				------------------------------------------------------------------------------------------------
				--------------------------------------------门派行动后-----------------------------------------
				------------------------------------------------------------------------------------------------
				--古墓2级弟子天罗地网
				if (MPTX(id,3,2) and PersonKF(id,148)) or match_ID(id,59) or match_ID(id,605) then	
					WAR.Person[p].Time = WAR.Person[p].Time + math.modf(Qg(p)*0.2)	
				end
				--少林

				--白驼山
				if MPTX(id,8) then
					WAR.Person[p].Time = WAR.Person[p].Time + 150
				end
				--一刀流
				if MPTX(id,11) then
					local a = math.modf(TrueYJ(p)/3)
					WAR.Person[p].Time = WAR.Person[p].Time + a
					if match_ID(id,741) or match_ID(id,742) then
						WAR.Person[p].Time = WAR.Person[p].Time + a*2
					end
				end
				--一刀流
				if WAR.WYWX[id] == 1 then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							WAR.Person[j].Time = WAR.Person[j].Time - 500
							if WAR.Person[j].Time < -200 then WAR.Person[j].Time = -200 end
						end
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
							WAR.Person[j].Time = WAR.Person[j].Time + 500
							if WAR.Person[j].Time > 1005 then WAR.Person[j].Time = 1005 end
						end
					end
					WAR.WYWX[id] = nil
				end
				--武当纯阳
				if WAR.PD["武当纯阳"][id] ~= nil and WAR.PD["武当纯阳"][id] > 0 then 
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							WAR.Person[j].Time = WAR.Person[j].Time - 200
							if WAR.Person[j].Time < -200 then WAR.Person[j].Time = -200 end
						end
					end
					WAR.PD["武当纯阳"][id] = nil
				end
				--五岳回气
				if MPTX(id,14) then
					local a = 30 * MPDJ(id)
					WAR.Person[p].Time = WAR.Person[p].Time + a
				end
				--花涧
				if MPTX(id,21) then
					WAR.Person[p].Time = WAR.Person[p].Time + 200
				end
				--昆仑阵
				--风雷惊蛰1
				if WAR.PD['风雷惊蛰1'][id] ~= nil then
					local a = WAR.PD['风雷惊蛰1'][id]
					WAR.Person[p].Time = WAR.Person[p].Time + 200
					if JLSD(0,math.modf(a*15)+10,id) then
						WAR.PD['集气速度'][id] = (WAR.PD['集气速度'][id] or 0) + 5
					end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 73,1,"暴风掠境・疾行",C_ORANGE);
					WAR.CurID = s
				end
				if WAR.PD['风雷惊蛰2'][id] ~= nil then
					local a = WAR.PD['风雷惊蛰2'][id]
					WAR.Person[p].Time = WAR.Person[p].Time - 150
					if JLSD(0,math.modf(a*15)+10,id) then
						WAR.PD['集气速度'][id] = (WAR.PD['集气速度'][id] or 0) - 3
					end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 73,1,"暴风掠境・逆巽",C_ORANGE);
					WAR.CurID = s
				end
				--天机宫
				if MPTX(id,30) then
					WAR.Person[p].Time = WAR.Person[p].Time + 300
				end
				------------------------------------------------------------------------------------------------
				--------------------------------------------buff限制回气---------------------------------------
				------------------------------------------------------------------------------------------------
				--灵蛇拳
				if WAR.PD['龙眠毒'][id] ~= nil  then
					if WAR.PD['龙眠毒'][id] > 0 then
						local aa = math.random(WAR.PD['龙眠毒'][id])
						WAR.Person[p].Time = WAR.Person[p].Time - (100*aa)
						if WAR.Person[p].Time < -500 then WAR.Person[p].Time = -500 end
						WAR.PD['龙眠毒'][id] = WAR.PD['龙眠毒'][id] - aa
						if WAR.PD['龙眠毒'][id] <= 0 then
							WAR.PD['龙眠毒'][id] = nil
						end	
					else
						WAR.PD['龙眠毒'][id] = nil
					end	
				end
				--九剑破招减少集气
				if WAR.JJPZ[id] ~= nil then
					WAR.Person[p].Time = WAR.Person[p].Time -200 * WAR.JJPZ[id]
					if WAR.Person[p].Time < -500 then WAR.Person[p].Time = -500 end
					WAR.JJPZ[id] = nil
				end
				--太空卸劲减少敌方集气，增加自己集气
				if WAR.TKJQ[id] ~= nil then
					WAR.Person[p].Time = WAR.Person[p].Time -100 * WAR.TKJQ[id]
					if WAR.Person[p].Time < -500 then WAR.Person[p].Time = -500 end
					WAR.TKJQ[id] = nil
				end
				--蛊毒状态
				if WAR.PD['基础蛊毒'][id] ~= nil and JY.Person[id]["中毒程度"] > 0 then
					WAR.Person[p].Time = WAR.Person[p].Time - (100+JY.Person[id]["中毒程度"])
					if WAR.Person[p].Time < -500 then WAR.Person[p].Time = -500 end
				end
				--九阳怒涛
				if WAR.PD['九阳反震'][id] ~= nil then		
					if QGQH(id,223,2) then
					else
						WAR.Person[p].Time = WAR.Person[p].Time - 240 * (WAR.PD['九阳反震'][id] or 0)
						if WAR.Person[p].Time < -500 then WAR.Person[p].Time = -500 end
					end	
					WAR.PD['九阳反震'][id] = nil
				end	
				--八门
				if WAR.PD["八门金锁3"][id] ~= nil then
					WAR.Person[p].Time = WAR.Person[p].Time - 180
					if WAR.Person[p].Time < -500 then WAR.Person[p].Time = -500 end
					WAR.PD["八门金锁3"][id] = nil
	            end 
				--七伤拳
				if WAR.PD["七伤拳阴"][id] ~= nil then
					WAR.Person[p].Time = WAR.Person[p].Time - 150
					if WAR.Person[p].Time < -500 then WAR.Person[p].Time = -500 end
				end
				------------------------------------------------------------------------------------------------
				--------------------------------------------任何人行动后--------------------------------------
				------------------------------------------------------------------------------------------------
				--不论任何人行动后都会触发的效果
				for bt = 0 ,WAR.PersonNum-1 do 
					local myid = WAR.Person[bt]["人物编号"]
					--WAR.PD['受击判定'][myid] = nil
					if dead(bt) == false then
						if WAR.BTZT[myid] ~= nil and WAR.BTZT[myid] > 1 then
							WAR.BTZT[myid] = nil
						end
						if WAR.PD['免疫内伤'][myid] ~= nil then
							reseteffect(WAR.PD['免疫内伤'],myid)
						end
						if WAR.PD['免疫中毒'][myid] ~= nil then
							reseteffect(WAR.PD['免疫中毒'],myid)
						end
						if WAR.PD['免疫封穴'][myid] ~= nil then
							reseteffect(WAR.PD['免疫封穴'],myid)
						end
						if WAR.PD['免疫冰封'][myid] ~= nil then
							reseteffect(WAR.PD['免疫冰封'],myid)
						end
						if WAR.PD['免疫灼烧'][myid] ~= nil then
							reseteffect(WAR.PD['免疫灼烧'],myid)
						end	
						if WAR.PD['免疫流血'][myid] ~= nil then
							reseteffect(WAR.PD['免疫流血'],myid)
						end 
						if WAR.PD['免疫杀气'][myid] ~= nil then
							reseteffect(WAR.PD['免疫杀气'],myid)
						end 
						if WAR.PD['魔之甲'][myid] == 1 then
							WAR.PD['魔之甲'][myid] = nil
						end	
						WAR.PD['极阴无相6'][myid] = nil
						--WAR.PD['易水寒冰'][myid] = nil
						
						--昆仑派阵法
						if WAR.PD['霜炎九重1'][myid] ~= nil then
							ztd(bt,WAR.BFXS,-psx(myid,"冰封程度"))
							ztd(bt,WAR.ZSXS,-psx(myid,"灼烧程度"))
							WAR.PD['冰冻状态'][myid] = nil
							WAR.PD['冰冻扣血'][myid] = nil
							WAR.PD['无明业火'][myid] = nil
						end
						--天刀九问
						if WAR.PD['天问刀气'][myid] ~= nil then
							local a,b = math.modf(TrueSD(0)-TrueSD(myid)),psx(myid,"内力")
							if a > 0 then
								ztd(bt,"生命点数",-a)
							else
								ztd(bt,"生命点数",-100)
							end	
							ztd(bt,"内力点数",-math.modf(b*0.2))
							for j = 1, 3 do	
								local DN=math.random(1,16)
								if DN==1 then
								WAR.PD["混乱状态"][myid] = math.random(1,3)
								--Set_Eff_Text(enemyid,3,"混乱")
								elseif DN==2 then
								WAR.PD["迟缓状态"][myid] = math.random(5,15)	
								--Set_Eff_Text(enemyid,3,"迟缓")
								elseif DN==3 then
								WAR.PD["虚弱状态"][myid] = math.random(30,50)	
								--Set_Eff_Text(enemyid,3,"虚弱")
								elseif DN==4 then
								WAR.PD["昏迷状态"][myid] = 1
								--Set_Eff_Text(enemyid,3,"昏迷")
								elseif DN==5 then
								WAR.PD["散功状态"][myid] = math.random(25,50)
								--Set_Eff_Text(enemyid,3,"散功")
								elseif DN==6 then
								WAR.PD["灵蛇拳"][myid] = math.random(5,15)
								--Set_Eff_Text(enemyid,3,"迷茫")
								elseif DN==7 then
								WAR.PD["同归状态"][myid] = 1
								--Set_Eff_Text(enemyid,3,"同归")
								elseif DN==8 then
								WAR.PD["无明业火"][myid] = math.random(15,25)
								--Set_Eff_Text(enemyid,3,"业火")
								elseif DN==9 then
								WAR.PD["利刃寒锋"][myid] = math.random(5,10)
								--Set_Eff_Text(enemyid,3,"冻结")
								elseif DN==10 then
								WAR.PD['创伤'][myid] = math.random(20,35)
								--Set_Eff_Text(enemyid,3,"撕裂")
								elseif DN==11 then
								WAR.PD["盲目状态"][myid] = 2
								--Set_Eff_Text(enemyid,3,"盲目")
								elseif DN==12 then
								WAR.PD["集气倒退"][myid] = math.random(10,20)
								--Set_Eff_Text(enemyid,3,"失智")
								elseif DN==13 then
								WAR.PD["冰冻状态"][myid] = math.random(5,15)	
								--Set_Eff_Text(enemyid,3,"冰冻")
								elseif DN==14 then
								WAR.PD["恐惧状态"][myid] = 1	
								--Set_Eff_Text(enemyid,3,"止戈")
								elseif DN==15 then
								WAR.PD["放下屠刀"][myid] = math.random(3,5)	
								--Set_Eff_Text(enemyid,3,"佛系")
								elseif DN==16 then
								WAR.PD['举火燎原'][myid] = math.random(10,25)	
								--Set_Eff_Text(enemyid,3,"点燃")
								end
							end	
							local s= WAR.CurID
							WAR.CurID = bt
							CurIDTXDH(WAR.CurID, 58, 1, "刀如天意・休生去命")
							WAR.PD['天问刀气'][myid] = nil 	
							WAR.CurID = s
						end
						--免疫锁足
						if mysz(bt) then
							WAR.PD["锁足状态"][myid] = nil
						end
						--免疫昏迷
						if myhm(bt) then
							WAR.PD["昏迷状态"][myid] = nil
						end
						--免疫混乱
						if myhl(bt) then
							WAR.PD["混乱状态"][myid] = nil
						end
						--沉睡状态
						if WAR.PD['沉睡状态'][myid] == 1 then
							WAR.PD['沉睡状态'][myid] = 2
						end
						--轻功行动后
						if WAR.PD['龙女天罗'][myid] == 2 then
							WAR.PD['龙女天罗'][myid] = nil 
						end
						if WAR.PD['遮蔽'][myid] == 1 then
							WAR.PD['遮蔽'][myid] = nil 
						end
						if WAR.PD['雪遁'][myid] ~= nil then
							Cat('雪遁DH2',bt)
						end
						--逆转经脉
						if WAR.PD["逆转经脉"][myid] ~= nil then
							ztd(bt,'生命点数',-500)
							WAR.PD["逆转经脉"][myid] = WAR.PD["逆转经脉"][myid] - 1
							if WAR.PD["逆转经脉"][myid] < 1 then
								if JY.Person[myid]['封穴程度'] < 20 and math.random(10) < 3 then
									ztd(bt,WAR.FXXS,20)
								end
								WAR.PD["逆转经脉"][myid] = nil
							end
						end
						--奇穴行动后
						if WAR.PD['内力恢复停止'][myid] ~= nil and WAR.PD['内力恢复停止'][myid] > 0 then
							if JY.Person[myid]["内力"] > math.modf(JY.Person[myid]["内力最大值"]*0.8) then
								JY.Person[myid]["内力"] = math.modf(JY.Person[myid]["内力最大值"]*0.8)
							end
							WAR.PD['内力恢复停止'][myid] = WAR.PD['内力恢复停止'][myid] - 1
							if WAR.PD['内力恢复停止'][myid] <= 0 then
								WAR.PD['内力恢复停止'][myid] = nil
							end
						end
						if WAR.PD['生命恢复停止'][myid] ~= nil and WAR.PD['生命恢复停止'][myid] > 0 then
							if JY.Person[myid]["生命"] > math.modf(JY.Person[myid]["生命最大值"]*0.9) then
								JY.Person[myid]["生命"] = math.modf(JY.Person[myid]["生命最大值"]*0.9)
							end
							WAR.PD['生命恢复停止'][myid] = WAR.PD['生命恢复停止'][myid] - 1
							if WAR.PD['生命恢复停止'][myid] <= 0 then
								WAR.PD['生命恢复停止'][myid] = nil
							end
						end
						if WAR.PD['力竭'][myid] ~= nil and WAR.PD['力竭'][myid] > 0 then
							ztd(bt,'体力点数',-1)
							WAR.PD['力竭'][myid] = WAR.PD['力竭'][myid] - 1
							if WAR.PD['力竭'][myid] <= 0 then
								WAR.PD['力竭'][myid] = nil
							end
						end
						if WAR.PD['诛仙状态'][myid] ~= nil and WAR.PD['诛仙状态'][myid] > 0 then
							if JY.Person[myid]["生命"] > math.modf(JY.Person[myid]["生命最大值"]*0.5) then
								JY.Person[myid]["生命"] = math.modf(JY.Person[myid]["生命最大值"]*0.5)
							end
						end
						--放下屠刀
						if WAR.PD["放下屠刀"][myid]~=nil  then
							WAR.PD["放下屠刀"][myid] = limitX(WAR.PD["放下屠刀"][myid],0,5)
							WAR.PD["放下屠刀"][myid] = WAR.PD["放下屠刀"][myid] - 1
							if WAR.PD["放下屠刀"][myid] <= 0 then
								WAR.PD["放下屠刀"][myid] = nil
							end
						end
						if WAR.PD['涤瑕格挡'][myid] ~= nil and WAR.PD['涤瑕格挡'][myid] > 0 then
							WAR.PD["涤瑕格挡"][myid]= WAR.PD["涤瑕格挡"][myid] - 1
							if WAR.PD["涤瑕格挡"][myid] <= 0 then
								WAR.PD["涤瑕格挡"][myid] = nil
							end
						end
						if QIQX(myid,'涤瑕击') > 0 and WAR.PD['涤瑕次数'][myid] ~= nil and WAR.PD['涤瑕次数'][myid] > 0 then
							local a = QIQX(myid,'涤瑕击')*5
							if psxper(p,'生命',0.5,2) then
								WAR.PD['涤瑕次数'][myid] = WAR.PD['涤瑕次数'][myid] - 1
								if WAR.PD['涤瑕次数'][myid] < 1 then
									WAR.PD['涤瑕次数'][myid] = nil 
								end
								Cat('清除高级异常',bt)
								ztd(bt,'生命点数',JY.Person[myid]['生命最大值']*a*0.01)
								WAR.PD['涤瑕格挡'][myid] = 3
							end
						end	
						--洗髓经二运
						local aa = 1000
						if JY.Base['标准'] == 6 then
							aa = 700
						end
			    		if myid == 0 then
							if JY.Person[myid]['门派技能1'] < 1 and JY.Person[myid]['门派技能4'] >= aa then
								JY.Person[myid]['门派技能1'] = 1
								JY.Person[myid]['门派技能4'] = 1001
								QZXS(JY.Person[myid]['姓名']..'开启第二功体')
								if JY.Person[myid]['内力性质'] ~= 3 then
									JY.Person[myid]['内力性质'] = 3
									QZXS(JY.Person[myid]['姓名']..'内力转化为天罡！')
								end
							end
						else
						    if JY.Person[myid]['门派技能4'] >= 1000 then
								JY.Person[myid]['门派技能4'] = 1001
								if JY.Person[myid]['门派技能1'] < 1 then
									JY.Person[myid]['门派技能1'] = 1
									QZXS(JY.Person[myid]['姓名']..'开启第二功体')
								end
								if JY.Person[myid]['内力性质'] ~= 3 then
									JY.Person[myid]['内力性质'] = 3
									QZXS(JY.Person[myid]['姓名']..'内力转化为天罡！') 	
								end
							end
						end
						--瑜伽二运
						if myid == 0 then
							if JY.Person[myid]['门派技能1'] < 1 and JY.Person[myid]['门派技能5'] >= 800 then
								JY.Person[myid]['门派技能1'] = 1
								JY.Person[myid]['门派技能5'] = 801
								QZXS(JY.Person[myid]['姓名']..'开启第二功体')
							end
						else
						    if JY.Person[myid]['门派技能5'] >= 800 then
								if JY.Person[myid]['门派技能1'] < 1 then
									JY.Person[myid]['门派技能1'] = 1
									QZXS(JY.Person[myid]['姓名']..'开启第二功体')
								end
								JY.Person[myid]['门派技能5'] = 801 	
							end
						end
					end
				end	
				if WAR.Person[p]["死亡"] == false then
					if WAR.PD['虚邪断空'][id] == 3 then
						WAR.PD['虚邪断空'][id] = nil 
					end
				end
				------------------------------------------------------------------------------------------------
				--------------------------------------------护盾行动后增加--------------------------------------
				------------------------------------------------------------------------------------------------
				--九阴太极
				if NGQH(id,107) then
					if WAR.JYZQ[id] == nil then 
						WAR.JYZQ[id] = 1 
				    else 	 
					    WAR.JYZQ[id] = WAR.JYZQ[id] + 1 
				    end
					if WAR.JYZQ[id] >= 9 then 
						WAR.JYZQ[id] = 9
					end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 71, 1, "九晦漩阴・气动天机")
					WAR.CurID = s
				end
	            --先天神照
				if NGQH(id,100) then 
					if WAR.XTZQ[id] == nil then
						WAR.XTZQ[id] = 1
					else 
					    WAR.XTZQ[id] = WAR.XTZQ[id] + 1
					end 
					if WAR.XTZQ[id] >= 7 then
						WAR.XTZQ[id] = 7
					end 
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 80, 1, "气就神交・任督自转")
					WAR.CurID = s
				end
				--九阳怒涛
				if NGQH(id,106) then
					if WAR.PD['九阳护盾'][id] == nil then 
				        WAR.PD['九阳护盾'][id] = 1 
						if WAR.Person[p]["护盾"] == nil or WAR.Person[p]["护盾"] <= -1 then
							WAR.Person[p]["护盾"] = 6
						end	
				    else 	 
	                    WAR.PD['九阳护盾'][id] = WAR.PD['九阳护盾'][id] + 1 
				    end
	                if WAR.PD['九阳护盾'][id] >= 9 then 
	                    WAR.PD['九阳护盾'][id] = 9
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 39, 1, "九曜天阳・气凝护宇")
					WAR.CurID = s
				end	
				--太极纯阳
				if NGQH(id,171) then
					if WAR.PD['阴阳二气'][id] == nil then
						WAR.PD['阴阳二气'][id] = math.random(3)
						if WAR.Person[p]['护盾'] == nil or WAR.Person[p]['护盾'] <= -1 then
							if match_ID(id,5) or id == 0 then
								WAR.Person[p]['护盾'] = 25
							else
							    WAR.Person[p]['护盾'] = 18
							end
						end
					else 
					    WAR.PD['阴阳二气'][id] = WAR.PD['阴阳二气'][id] + 1	  
					end
					if WAR.PD['阴阳二气'][id] >= 9 then 
						WAR.PD['阴阳二气'][id] = 9
					end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 416, 1, "太极奥义・阴阳无极")
					WAR.CurID = s
				end	
				--神足乾坤
				if NGQH(id,233) then
					if WAR.PD['神足乾坤'][id] == nil then 
				        WAR.PD['神足乾坤'][id] = 1 
						if WAR.Person[p]["护盾"] == nil or WAR.Person[p]["护盾"] <= -1 then
							WAR.Person[p]["护盾"] = 31
						end	
				    else 	 
	                    WAR.PD['神足乾坤'][id] = WAR.PD['神足乾坤'][id] + 1 
				    end
	                if WAR.PD['神足乾坤'][id] >= 9 then 
	                    WAR.PD['神足乾坤'][id] = 9
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 85, 1, "摩伽陀国・瑜伽神足")
					WAR.CurID = s
				end 	
				--易水寒
				if NGQH(id,43) then
					if WAR.PD['易水寒冰'][id] == nil then 
				        WAR.PD['易水寒冰'][id] = 1 
						if WAR.Person[p]["护盾"] == nil or WAR.Person[p]["护盾"] <= -1 then
							WAR.Person[p]["护盾"] = 33
						end
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 141, 1, "至阴寒气・凝霜成冰")
					WAR.CurID = s
				end	
				--先天太极
				if match_ID(id,520) then
					if WAR.PD['先天太极'][id] == nil then
						WAR.PD['先天太极'][id] = 1
						if WAR.Person[p]["护盾"] == nil or WAR.Person[p]["护盾"] <= -1 then
							WAR.Person[p]["护盾"] = 22
						end 		
					else 	 
	                    WAR.PD['先天太极'][id] = WAR.PD['先天太极'][id] + 1 
					end
					if WAR.PD['先天太极'][id] >= 8 then 
	                    WAR.PD['先天太极'][id] = 8
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 377, 1, "先天太极・天地自然")
					WAR.CurID = s
				end	
				--倾国倾城
				if match_ID(id,754) or MPTX(id,26,3) then
					if WAR.PD['倾国倾城'][id] == nil then
						WAR.PD['倾国倾城'][id] = 1
						if WAR.Person[p]["护盾"] == nil or WAR.Person[p]["护盾"] <= -1 then
							WAR.Person[p]["护盾"] = 26
						end 		
					else 	 
	                    WAR.PD['倾国倾城'][id] = WAR.PD['倾国倾城'][id] + 1 
					end
					if WAR.PD['倾国倾城'][id] >= 5 then 
	                    WAR.PD['倾国倾城'][id] = 5
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 146, 1, "柔桡轻曼・妩媚纤弱")
					WAR.CurID = s
				end	
				--独孤九剑
	            if (PersonKF(id,47) and PersonKF(id,184)) or match_ID(id,592) or (WAR.ZDDH == 424 and id == 670) then
					if WAR.DGJY[id] == nil then 
				        WAR.DGJY[id] = math.random(3) 
				    else 	 
	                    WAR.DGJY[id] = WAR.DGJY[id] + 1 
				    end
	                if WAR.DGJY[id] >= 9 then 
	                    WAR.DGJY[id] = 9
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 427, 1, "独孤九剑真气")
					WAR.CurID = s
				end	
				--怒涛气劲
				if NGQH(id,252) then
					if WAR.PD['怒涛剑气'][id] == nil then 
				        WAR.PD['怒涛剑气'][id] = 1 
						if WAR.Person[p]["护盾"] == nil or WAR.Person[p]["护盾"] <= -1 then
							WAR.Person[p]["护盾"] = 8
						end	
				    else 	 
	                    WAR.PD['怒涛剑气'][id] = WAR.PD['怒涛剑气'][id] + 1 
				    end
	                if WAR.PD['怒涛剑气'][id] >= 9 then 
	                    WAR.PD['怒涛剑气'][id] = 9
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 66, 1, "潮起潮落")
					WAR.CurID = s
				end	
				--全真剑气
				if PersonKF(id,39) and (PersonKF(id,100) or MPTX(id,16,2)) then
					if WAR.QZJQ[id] == nil then 
				        WAR.QZJQ[id] = 1 
				    else 	 
	                    WAR.QZJQ[id] = WAR.QZJQ[id] + 1 
				    end
	                if WAR.QZJQ[id] >= 7 then 
	                    WAR.QZJQ[id] = 7
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 33, 1, "全真剑气")
					WAR.CurID = s
				end	
				--葵花紫霞
				if NGQH(id,105) or JXPD(id,19,1) then
					if WAR.PD['葵花护盾'][id] == nil then
						WAR.PD['葵花护盾'][id] = 1
						if WAR.Person[p]["护盾"] == nil or WAR.Person[p]["护盾"] <= -1 then
							WAR.Person[p]["护盾"] = 7
						end 		
					else 	 
	                    WAR.PD['葵花护盾'][id] = WAR.PD['葵花护盾'][id] + 1
					end
					if WAR.PD['葵花护盾'][id] > 6 then 
	                    WAR.PD['葵花护盾'][id] = 6
				    end
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 418, 1, "葵花真气・运转周身")
					WAR.CurID = s
				end	
					
				--易筋 宝谶
				if (NGQH(id,108) or (match_ID(id,114) and Curr_NG(id,108))) and JLSD(10,45,id) then
					WAR.PD['集气速度'][id] = (WAR.PD['集气速度'][id] or 0) + math.random(3,10)
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 78, 1, "易筋神髓・弥勒宝谶")
					WAR.CurID = s
				end
				------------------------------------------------------------------------------------------------
				--------------------------------------------buff行动后清除--------------------------------------
				------------------------------------------------------------------------------------------------
				--少林派buff
				if WAR.PD['罗汉果位'][id] ~= nil then
					WAR.PD['罗汉果位'][id] = nil
				end
				if WAR.PD['金刚指绝脉'][id] ~= nil then
					limitX(WAR.PD['金刚指绝脉'][id],0,3)
					WAR.PD['金刚指绝脉'][id] = WAR.PD['金刚指绝脉'][id] -1
					if WAR.PD['金刚指绝脉'][id] < 1 then
						WAR.PD['金刚指绝脉'][id] = nil 
					end
				end
				--昏迷
				if WAR.PD["昏迷状态"][id] ~= nil then
					WAR.PD["昏迷状态"][id] = nil
				end
				--刺目
				if WAR.PD["刺目"][id] ~= nil then
					WAR.PD["刺目"][id] = nil
				end 
				if WAR.PD['头晕目眩'][id] ~= nil then
					WAR.PD['头晕目眩'][id] = nil
				end
				if WAR.PD['麻痹状态'][id] ~= nil then
					WAR.PD['麻痹状态'][id] = nil
				end
				if WAR.PD['洞火'][id] ~= nil then
					WAR.PD['洞火'][id] = nil
				end
				--降龙虚劲
				if WAR.PD["降龙虚劲"][id] ~= nil then
					WAR.PD["降龙虚劲"][id] = nil
				end
				--迟缓
				if WAR.PD["迟缓状态"][id] ~= nil then
					WAR.PD["迟缓状态"][id] = nil
				end
				--冰冻
				if WAR.PD["冰冻状态"][id] ~= nil then
					WAR.PD["冰冻状态"][id] = nil
				end
				if WAR.PD['互搏真谛杀气'][id] ~= nil then
					WAR.Person[p].Time = -200
					WAR.PD['互搏真谛杀气'][id] = nil
				end	
				if WAR.PD['战意爆发'][id] ~= nil then
					WAR.PD['战意爆发'][id] = nil
				end
				if WAR.PD['受想行识'][id] ~= nil then
					ztd(WAR.CurID,WAR.FXXS,50)
					WAR.PD['受想行识'][id] = nil
				end
				if WAR.PD['无始无明'][id] ~= nil then
					Cat('清除所有异常',WAR.CurID)
					local XZ = {}
					for j = 0, WAR.PersonNum - 1 do
						if DWPD(WAR.CurID,j) and dead(j) == false then
							WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
							table.insert(XZ,j)   
						end
					end
					local ri = XZ[math.random(#XZ)]
					if WAR.PD['遮影'][id] == nil then
						if isteam(id) == false then
							WAR.PD['遮影'][id] = 0
							WAR.PD['影随'][0] = 0
						else
							WAR.PD['遮影'][id] = WAR.Person[ri]["人物编号"] or 0
							WAR.PD['影随'][id] = WAR.Person[ri]["人物编号"] or 0
						end
					end
					if match_ID(id,457) then
						for i = 0, WAR.PersonNum - 1 do
							local wj = WAR.Person[i]["人物编号"]
							if match_ID(wj,457) then
								for j = 0, WAR.PersonNum - 1 do
									if (WAR.Person[j]["人物编号"] == 456 or WAR.Person[j]["人物编号"] == 92) and dead(j) == false then
										WAR.Person[p]["我方"] = true
									end
								end
							end
						end
						--WAR.PD['点点诡计'][id] = 1
						WAR.PD['阴圣再临'][id] = 1
					end
					WAR.PD['无始无明'][id] = nil
				end
				--魅惑状态，解除后，敌人状态恢复
				if WAR.PD["魅惑状态"][id] ~= nil then
					if WAR.PD["魅惑状态"][id] > 3 then
						WAR.PD["魅惑状态"][id] = 3
					end
					if NGQH(id,108) then
						WAR.PD["魅惑状态"][id] = nil
					else
					    WAR.PD["魅惑状态"][id] = WAR.PD["魅惑状态"][id] - 1
						if WAR.PD["魅惑状态"][id] < 1 then
							WAR.PD["魅惑状态"][id] = nil
							if inteam(id) or id == 0 then
								WAR.Person[p]["我方"] = true
							else
							    WAR.Person[p]["我方"] = false
							end
						end
					end
				end
				--度化状态，解除后，敌人转化阵营
				if WAR.PD["度化状态"][id] ~= nil then
					if NGQH(id,108) then
						WAR.PD["度化状态"][id] = nil
					else
					    WAR.PD["度化状态"][id] = WAR.PD["度化状态"][id] - 1
						if WAR.PD["度化状态"][id] < 1 then
							if inteam(id) or id == 0 then
								WAR.Person[p]["我方"] = false
							else
							    WAR.Person[p]["我方"] = true
							end
							QZXS(JY.Person[id]["姓名"].."双手合十，颂唱梵音，皈依我佛")
							WAR.PD["度化状态"][id] = nil
						end
					end
				end
				if WAR.PD['锁足状态'][id] ~= nil then
				    WAR.PD['锁足状态'][id] = nil
				end
				if WAR.PD['血战到底'][id] == 1 then
					if JY.Person[id]['畅想分阶'] < 3 then
						Cat('清除高级异常',WAR.CurID)
						if JY.Person[id]['畅想分阶'] < 2 then
							Cat('清除所有异常',WAR.CurID)
						end
					end
					WAR.PD['血战到底'][id] = 2
				end
				--[[ --强制增伤
				if WAR.PD['强制增伤'][id] ~= nil and WAR.PD['强制增伤'][id] > 0 then
					WAR.PD['强制增伤'][id] = nil 
				end ]]
				if WAR.PD['缠字决'][id] == 1 then 
					WAR.PD['缠字决'][id] = nil
				end
				if WAR.PD['辰宿列张'][id] == 1 then 
					WAR.PD['辰宿列张'][id] = nil
				end
				if WAR.PD['西瓜刀・天人'][id] ~= nil then 
					WAR.PD['西瓜刀・天人'][id] = WAR.PD['西瓜刀・天人'][id] - 1 
					if WAR.PD['西瓜刀・天人'][id] < 1 then 
						WAR.PD['西瓜刀・天人'][id] = nil   
					end
				end
				--清除破尽天下
				if match_ID(id,592) then
					if WAR.PJTX1 > 0 then
						WAR.PJTX1 = 0
					end
				end
				--绝影闪
				if id == 0 and JY.Base["标准"] > 0 then 
					local zz = math.modf(JY.Person[id]["资质"] / 25)
					local ts = math.modf(JY.Base["天书数量"] / 5)
					local cs = 0
					cs = 3 + zz + ts
					WAR.JYS = WAR.JYS + 1
					if WAR.JYS > cs then
						WAR.JYS = cs
					end
				end
				--紫霞蓄势状态，蓄力不减
				if WAR.Actup[id] ~= nil then
					if WAR.ZXXS[id] ~= nil then				
						WAR.ZXXS[id] = WAR.ZXXS[id] - 1
						if WAR.ZXXS[id] == 0 then
							WAR.ZXXS[id] = nil
						end
					else
						WAR.Actup[id] = WAR.Actup[id] - 1	--蓄力，行动一次减1
					end
				end
				if WAR.Actup[id] == 0 then
					WAR.Actup[id] = nil
				end
				--王重阳1 同归剑气 1回合
				if WAR.PD["同归状态"][id] ~= nil then
					WAR.PD["同归状态"][id] = nil
				end	
				--止杀
				if WAR.PD["恐惧状态"][id] ~= nil then
					WAR.PD["恐惧状态"][id]= nil
				end
				if NGQH(id,102) and WAR.PD["太玄组合防御3"][id] == nil and JLSD(10,45,id) then
					WAR.PD["太玄组合防御3"][id] = 30
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 377, 1, "事了拂衣去 深藏身与名")
					WAR.CurID = s
				end
				--铁掌断土狂雷
				if WAR.PD['断土狂雷'][id] ~= nil then
					for j = 0, WAR.PersonNum -1 do 
						local df = WAR.Person[j]["人物编号"] 
						local offset1 = math.abs(WAR.Person[p]["坐标X"] - WAR.Person[j]["坐标X"]) 
						local offset2 = math.abs(WAR.Person[p]["坐标Y"] - WAR.Person[j]["坐标Y"])	
						if WAR.Person[j]["我方"] ~= WAR.Person[p]["我方"] and WAR.Person[j]["死亡"] == false and offset1 <= 8 and offset2 <= 8 then
							local jx = math.modf(JY.Person[df]["内力"]/20)
							ztd(j,"生命点数",-math.modf(jx*WAR.PD['断土狂雷'][id]))
							ztd(j,"体力点数",-10)
						end
					end	
					WAR.PD["断土狂雷"][id] = nil
				end
				--十龙十象
				if WAR.SLSX[id] ~= nil then
					WAR.SLSX[id] = WAR.SLSX[id] - 1
					if WAR.SLSX[id] < 1 then
						WAR.SLSX[id] = nil
					end
				end
				if WAR.PD["格挡状态"][id]~= nil then
				   	WAR.PD["格挡状态"][id]= WAR.PD["格挡状态"][id] - 1
				    if WAR.PD["格挡状态"][id] <= 0 then
					 	WAR.PD["格挡状态"][id] = nil
					end
				end 

				--罗汉血，解除后，敌人状态恢复
				if WAR.PD["罗汉血"][id] ~= nil and WAR.PD["罗汉血"][id] > 0 then
					ztd(WAR.CurID,'生命点数',-999)
					WAR.PD["罗汉血"][id] = WAR.PD["罗汉血"][id] + 1
					if WAR.PD["罗汉血"][id] >= 9 then
						WAR.PD["恐惧状态"][id] = 1
						WAR.PD["罗汉血"][id] = nil
					end
				end

				--荒龙爆，解除后，敌人状态恢复
				if WAR.PD["荒龙爆"][id] ~= nil then
					local hl = WAR.PD["荒龙爆"][id] or 0
					local ss = JY.Person[id]["受伤程度"]
					if JY.Person[id]["受伤程度"] > 0 then
					    ztd(WAR.CurID,'生命点数', -math.modf(ss*hl))
					    ztd(WAR.CurID,'体力点数', -hl)
					end
					WAR.PD["荒龙爆"][id] = WAR.PD["荒龙爆"][id] - 5
					if WAR.PD["荒龙爆"][id] <= 0 then
						WAR.PD["荒龙爆"][id] = nil
					end
				end 
				if WAR.PD["参合状态"][id]~= nil and WAR.NGJL > 0 then
					WAR.PD["参合状态"][id]= WAR.PD["参合状态"][id] - 1
					if WAR.PD["参合状态"][id] <= 0 then
						WAR.PD["参合状态"][id] = nil
					end   
				end	
				if WAR.PD["刺猬状态"][id]~= nil then
				   	WAR.PD["刺猬状态"][id]= WAR.PD["刺猬状态"][id] - 1
				    if WAR.PD["刺猬状态"][id] <= 0 then
					 	WAR.PD["刺猬状态"][id] = nil
					end   
				end	
				
				--集中状态
				if WAR.Focus[id] ~= nil then
					WAR.Focus[id] = WAR.Focus[id] - 1	--集中，行动一次减1
					if WAR.Focus[id] <= 0 then
					    WAR.Focus[id] = nil
					end
		        end
		        
		        --般若集中，行动后解除
				if WAR.PD["般若集中"][id] ~= nil then
					WAR.PD["般若集中"][id] = WAR.PD["般若集中"][id] - 1
					if WAR.PD["般若集中"][id] <= 0 then
						WAR.PD["般若集中"][id] = nil
					end
				end
				
				--般若休息，行动后解除
				if WAR.PD["般若休息"][id] ~= nil then
					WAR.PD["般若休息"][id] = WAR.PD["般若休息"][id] - 1
					if WAR.PD["般若休息"][id] <= 0 then
						WAR.PD["般若休息"][id] = nil
					end
				end 
				
				--般若等待，行动后解除
				if WAR.PD["般若等待"][id] ~= nil then
					WAR.PD["般若等待"][id] = WAR.PD["般若等待"][id] - 1
					if WAR.PD["般若等待"][id] <= 0 then
						WAR.PD["般若等待"][id] = nil
					end
				end
				
				--般若防御，行动后解除
				if WAR.PD["般若防御"][id] ~= nil then
					WAR.PD["般若防御"][id] = WAR.PD["般若防御"][id] - 1
					if WAR.PD["般若防御"][id] <= 0 then
						WAR.PD["般若防御"][id] = nil
					end
				end
				
				--般若蓄力，行动后解除
				if WAR.PD["般若蓄力"][id] ~= nil then
					WAR.PD["般若蓄力"][id] = WAR.PD["般若蓄力"][id] - 1
					if WAR.PD["般若蓄力"][id] <= 0 then
						WAR.PD["般若蓄力"][id] = nil
					end
				end
				
				--天绝剑气
				if WAR.PD["天绝剑气"][id] ~= nil then
					WAR.PD["天绝剑气"][id] = WAR.PD["天绝剑气"][id] - 1
					if WAR.PD["天绝剑气"][id] <= 0 then
						WAR.PD["天绝剑气"][id] = nil
					end
				end
				
				--南凤朱雀
				if WAR.PD["南凤朱雀"][id] ~= nil then
					WAR.PD["南凤朱雀"][id] = WAR.PD["南凤朱雀"][id] - 1
					if WAR.PD["南凤朱雀"][id] <= 0 then
						WAR.PD["南凤朱雀"][id] = nil
					end
				end
				
				--凝血化毒
				if WAR.PD["凝毒化血"][id] ~= nil then
					WAR.PD["凝毒化血"][id] = WAR.PD["凝毒化血"][id] - 1
					if WAR.PD["凝毒化血"][id] < 1 then
						War_ActupMenu()
						WAR.PD["凝毒化血"][id] = nil
					end
				end
				
				--混乱状态，解除后，敌人状态恢复
				if WAR.PD["混乱状态"][id] ~= nil then
					WAR.PD["混乱状态"][id] = limitX(WAR.PD["混乱状态"][id],0,3)
					WAR.PD["混乱状态"][id] = WAR.PD["混乱状态"][id] - 1
					if WAR.PD["混乱状态"][id] < 1 then
						WAR.PD["混乱状态"][id] = nil
					end
				end
				--花涧如雾
				if WAR.PD["花涧如雾"][id] ~= nil then
					WAR.PD["花涧如雾"][id] = WAR.PD["花涧如雾"][id] - 1
					if WAR.PD["花涧如雾"][id] < 1 then
						WAR.PD["花涧如雾"][id] = nil
					end
				end
				--九剑破尽
				if WAR.PD["九剑破尽"][id] ~= nil then
					WAR.PD["九剑破尽"][id] = WAR.PD["九剑破尽"][id] - 9
					if WAR.PD["九剑破尽"][id] < 1 then
						WAR.PD["九剑破尽"][id] = nil
					end
				end
				--八荒龙灭，解除后，敌人状态恢复
				if WAR.PD["荒天龙灭"][id] ~= nil then
					WAR.PD["荒天龙灭"][id] = nil
				end
				--周公剑意
				if WAR.PD["寒冰魄"][id] ~= nil then
					WAR.PD["寒冰魄"][id] = nil
				end
				if WAR.PD["食心蛊"][id] ~= nil then
					WAR.PD["食心蛊"][id] = nil
				end
				if WAR.PD["烈火核"][id] ~= nil then
					WAR.PD["烈火核"][id] = nil
				end
				if WAR.PD["缚身蛇"][id] ~= nil then
					WAR.PD["缚身蛇"][id] = nil
				end
                --摄魂
			    if WAR.PD['九阴摄魂'][id] ~= nil then
				    WAR.PD['九阴摄魂'][id] = nil
			    end	
			    if WAR.PD['唯识剑意1'][id] ~= nil then
				    WAR.PD['唯识剑意1'][id] = nil
			    end	
			    if WAR.PD['虚邪散魂2'][id] ~= nil then
				    local a = math.modf((psx(id,'生命')+psx(id,'内力'))*0.15)
				    ztd(p,'生命点数',-a)
				    ztd(p,'内力点数',-a)
				    WAR.PD['虚邪散魂2'][id] = nil
			    end				
				--玉女先天
				if WAR.QX1[id] ~= nil then
					WAR.QX1[id] = nil
				end
				
				if match_ID(id,456) then
					if WAR.PD["颠倒的世界"][id] ~= nil then
				        WAR.PD["颠倒的世界"][id] = nil
					end
					for i = 0, WAR.PersonNum - 1 do
						if DWPD(WAR.CurID,i) and dead(i) == false then
							if WAR.PD["颠倒的世界"][WAR.Person[i]["人物编号"]] ~= nil then
								WAR.PD["颠倒的世界"][WAR.Person[i]["人物编号"]] = nil
							end
						end
					end
				end	
	            --疯魔，解除后，敌人状态恢复
				if WAR.PD["疯魔"][id] ~= nil then
					WAR.PD["疯魔"][id] = limitX(WAR.PD["疯魔"][id],0,50)
					WAR.PD["疯魔"][id] = WAR.PD["疯魔"][id] - math.random(3,8)
					if WAR.PD["疯魔"][id] <= 0 then
						WAR.PD["疯魔"][id] = nil
					end
				end
				if WAR.PD['七剑合一'][id] ~= nil then
					WAR.PD['七剑合一'][id] = nil 
				end	
				if MPTX(id,24) then
					local dj = MPDJ(id)
					if match_ID(id,517) then
						dj = 5
					end
					if match_ID(id,526) or match_ID(id,750) then
						dj = 4
					end		
					local jl = math.modf(dj*15)
					if Curr_QG(id,304) then
						jl = jl +5
					end	
					if JLSD(10,jl-10,id) then
						local juli = 10-math.modf(dj*2)
						local pd = true
						for dr = 0, WAR.PersonNum-1 do
							if RealJL(p,dr,juli) and WAR.Person[dr]['我方'] ~= WAR.Person[p]['我方'] and WAR.Person[dr]['死亡'] == false then
								pd = false
							end
						end
						if pd == true then
							WAR.PD['无明夜'][id] = limitX(math.modf(psx(id,'轻功')*0.08),0,50)
						end
					end
				end	
				if WAR.PD['潜影突袭'][id] ~= nil then
					WAR.PD['潜影突袭'][id] = nil
				end	
				if WAR.PD['极阴无相5'][id] ~= nil then
					reseteffect(WAR.PD['极阴无相5'],id)
				end		
	            if WAR.PD['阳神降世'][id] ~= nil then
	      	        WAR.PD['阳神降世'][id] = nil 
	            end
	            if WAR.PD['阴圣再临'][id] ~= nil then
	      	        WAR.PD['阴圣再临'][id] = nil 
	            end

				--鲸龟
				if WAR.PD['鲸龟沉眠'][id] == 1 then
					WAR.PD['鲸龟沉眠'][id] = 2
				end
				--临时天赋复原
				if WAR.LSTF[id] ~= nil then 
					for k,v in pairs(WAR.LSTF[id]) do 
						WAR.LSTF[id][k] = WAR.LSTF[id][k] - 1
						if WAR.LSTF[id][k] <= 0 then
							WAR.LSTF[id][k] = nil
						end
					end
				end	
				--暴走状态
				if WAR.PD["暴走状态2"][id]~=nil and WAR.PD["暴走状态2"][id] > 0 then
					WAR.PD["暴走状态2"][id] = WAR.PD["暴走状态2"][id] - 1
					if WAR.PD["暴走状态2"][id] == 0 then
						CurIDTXDH(WAR.CurID, 124,1,"暴走状态终止",C_GOLD);
					end
				end
				--行动后漏出破绽
				WAR.Weakspot[id] = 0
				--双剑合壁无破绽
				if WGZH(id,39,42) then
				    WAR.Weakspot[id] = nil
				end
				--金刚狮子吼无破绽
				if PersonKF(id,91) then
					WAR.Weakspot[id] = nil
				end
				--[[--辟邪冷却时间恢复
				if WAR.BXLQ[id] then
					local KH = 0
					for i = 1, 6 do
						WAR.BXLQ[id][i] = WAR.BXLQ[id][i] - 1
						if WAR.BXLQ[id][i] < 0 then
							WAR.BXLQ[id][i] = 0
						end
					end
				end
				--六脉冷却时间恢复
				if WAR.LMLQ[id]  then
					local KH = 0
					for i = 1, 6 do
						WAR.LMLQ[id][i] = WAR.LMLQ[id][i] - 1
						if WAR.LMLQ[id][i] < 0 then
							WAR.LMLQ[id][i] = 0
						end
					end
				end			
				--九阳冷却时间恢复
				if WAR.JYLQ[id]  then
					for i = 1, 3 do
						WAR.JYLQ[id][i] = WAR.JYLQ[id][i] - 1
						if WAR.JYLQ[id][i] < 0 then
							WAR.JYLQ[id][i] = 0
						end
					end
				end		--]]
		        --周伯通，每行动一次，攻击时伤害一+10%
				if match_ID(id, 64) or match_ID(id, 9855) or match_ID(id, 565) or match_ID(id, 9810) then
					WAR.ZBT = WAR.ZBT + 1
				end
				--全真七子七星聚会，每行动一次，攻击时伤害一+10%
				if id==68 or id==123 or id==124 or id==125 or id==126 or id==127 or id==128 then
					WAR.QXJH = WAR.QXJH + 1
				end
				--武当七侠真武七截阵，每行动一次，攻击时伤害一+10%
		        if id==532 or id==533 or id==534 or id==535 or id==536 or id==537 or id==538 then
					WAR.ZWQJZ = WAR.ZWQJZ + 1
		        end
				
				--花铁杆，每行动一次，集气速度加一
				if id==0 and JY.Base["畅想"]==52 then
					WAR.HTG = WAR.HTG + 1
					if WAR.HTG>81 then
						WAR.HTG=81
					end
				end
				--不归三境第一境，每行动一次，集气速度加二
				if match_ID(id,9739) then
					WAR.BGSJ = WAR.BGSJ + 2
					if WAR.BGSJ>JY.Base['天书数量']+6 then
						WAR.BGSJ=JY.Base['天书数量']+6
					end
		        end
				if match_ID(id,9984) then
					if WAR.PD["诸法无我"][id] == nil then
	                   WAR.PD["诸法无我"][id] = 1
					else
	                   WAR.PD["诸法无我"][id] = WAR.PD["诸法无我"][id] +1
					end
					if WAR.PD["诸法无我"][id] > 6 then
						WAR.PD["诸法无我"][id] = 6
					end
				end

				
				--王重阳北斗七闪状态减少
				if match_ID(id, 129) and WAR.BDQS > 0 then
					WAR.BDQS = WAR.BDQS - 1
					if WAR.BDQS == 0 then
						CurIDTXDH(WAR.CurID, 126,1,"北斗七闪・收招",C_GOLD);
					end
				end
				--大理转龙
				if match_ID(id, 65) or  MPTX(id,15) then
					if WAR.PD['转龙呼吸'][id] == nil then
						WAR.PD['转龙呼吸'][id] = 1
					else
						if match_ID(id,65) and math.random(10) > 5 then
						else
						    WAR.PD['转龙呼吸'][id] = (WAR.PD['转龙呼吸'][id] or 0) - 1
						end
						if WAR.PD['转龙呼吸'][id] < 1 then
							WAR.PD['转龙呼吸'][id] = nil
							local s = WAR.CurID
							WAR.CurID = p
							CurIDTXDH(WAR.CurID, 25, 1, "六脉转龙・回天")
							WAR.CurID = s
						end
					end
				end
				--梯云纵横高阶特效登云
				if QGQH(id,149,2) and WAR.PD['登云1'][id] ~= nil then
					Cat('清除所有异常',WAR.CurID)
					local s = WAR.CurID
					WAR.CurID = p
					CurIDTXDH(WAR.CurID, 36, 1, "梯步登云・仙身道体")
					WAR.CurID = s
				end	
				--太玄组合
				if NGQH(id,102) and JLSD(0,50,id) then
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 238,1,"太玄・扶摇谪仙",C_ORANGE);
					Cat('清除中级异常',WAR.CurID)
				end
			    --沧溟刀法
				if PersonKF(id,153) and WAR.CM > 0 then --煞气回复
					local cc=math.modf(JY.Person[id]["实战"]/20)
	                WAR.Person[p].Time = WAR.Person[p].Time + WAR.CM * cc
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 116,1,"煞气恢复集气",C_BLUE);
				end	
				--周公剑意行动后
				if PersonKF(id,271) and PersonKF(id,356) and BNJQ(id) then
					if WAR.PD['周公剑意'][id] == 7 then
						WAR.PD['周公剑意'][id] = 1
					end
				end
				--暴怒恢复
				if WAR.LQZ[id] == 100 then
					--王重阳北斗七闪状态行动后暴怒不减 elseif MPPD(id) == 6 and WAR.XUEMO[id] ~= nil then  --密宗
					if match_ID(id, 129) and WAR.BDQS > 0 then
					elseif WAR.PD["暴走状态2"][id] ~= nil and WAR.PD["暴走状态2"][id] > 0 then
					elseif MPTX(id,6) and WAR.PD['血魔'][id] ~= nil then
					elseif match_ID(id, 112) and WAR.ZHRM[id] == nil and WAR.XYS > 0 then
					elseif WAR.PD['易水四寒2'][id] == 5  then
					elseif NGQH(id,203) and WAR.PD['复活・长生'][id] ~= nil and WAR.PD['复活・长生'][id] >= 5 then
					elseif match_ID(id,639) or match_ID(id,9908) then
						if math.random(100) > 25 then
						else
							WAR.LQZ[id] = 50
						end
					elseif MPTX(id,15) and WAR.PD['转龙呼吸'][id] ~= nil and WAR.PD['转龙呼吸'][id] > 0 then
						WAR.LQZ[id] = math.random(60,90)
					else
						WAR.LQZ[id] = 0	
						if WAR.PD['入魔'][id] ~= nil and WAR.PD['入魔'][id] == 1 then
							WAR.PD['入魔'][id] = nil
						end		  
					end
				end	
				----------暗器特效恢复
				if WAR.BPYZ > 0 then
					WAR.BPYZ = 0
				end
				if WAR.BPYZ1 > 0 then
					WAR.BPYZ1 = 0
				end
				if WAR.SSFZ > 0 then
					WAR.SSFZ = 0
				end
				if WAR.SSFZ1 > 0 then
					WAR.SSFZ1 = 0
				end
				if WAR.PLLH > 0 then
					WAR.PLLH = 0
				end
				if WAR.PLLHD > 0 then
					WAR.PLLHD = 0
				end
				if WAR.TGZ > 0 then 
					WAR.TGZ = 0
				end 
				if WAR.TGZ1 > 0 then
					WAR.TGZ1 = 0 
				end
				if WAR.HXSZ > 0 then 
					WAR.HXSZ = 0
				end 
				if WAR.HXSZ1 > 0 then
					WAR.HXSZ1 = 0 
				end		
				--三指诛仙
				if WAR.SZZX > 0 then
					WAR.SZZX = 0
				end
				--金蛇牙突
				if match_ID(id,54) and WAR.LMC == 1 then 
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 123,1,"金蛇戏画・牙突",M_SeaGreen);
					local tmpanqi = JY.Person[id]["暗器技巧"]
					if WAR.JSBD[id]~=nil then
						if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]["我方"] == false or isteam(pid) == false then
							War_ExecuteMenu_Sub(WAR.JSBD[id][1], WAR.JSBD[id][2], 4, 30)
						else
							WAR.JSBD[id] = nil
							War_ExecuteMenu(4, 30)
						end 
						WAR.JSBD[id] = nil
					end
					local x1=nil
					local y1=nil
					if WAR.YTJS[id]~=nil then
						x1=WAR.YTJS[id][1]
						y1=WAR.YTJS[id][2]
					end
					if x1==nil or y1==nil then
						x1=WAR.Person[WAR.CurID]["坐标X"]
						y1=WAR.Person[WAR.CurID]["坐标Y"]
					end
					for i = 1, 30 do
						DrawStrBox(-1, 24, "散魄毒牙", OliveDrab, 10 + i)
						ShowScreen()
						lib.Delay(10)
					end
					CleanWarMap(4, 0)
					for i = 0, WAR.PersonNum - 1 do
						local bid = WAR.Person[i]["人物编号"]
						if WAR.Person[i]["人物编号"] ~= WAR.Person[WAR.CurID]["人物编号"] and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
							WAR.Person[i]["死亡"] == false and RealJL2(x1,y1, i, 5) then
							SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)
							WAR.PD['金蛇幻毒'][bid] = (WAR.PD['金蛇幻毒'][bid] or 0) + 1
							ztd(i,WAR.BFXS,math.modf(JY.Person[id]["实战"] / 10 + tmpanqi/20))
							ztd(i,"中毒程度",math.modf(JY.Person[id]["实战"] / 10 + tmpanqi/20))
							ztd(i,'生命点数',-(math.modf(JY.Person[bid]["中毒程度"])+math.modf(JY.Person[id]["实战"] / 10) + math.modf(tmpanqi/10)))
						end
					end		
					War_ShowFight(id, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 30)
					JY.Person[id]["生命"] = JY.Person[id]["生命"] + math.modf(tmpanqi / 5)
					WAR.LMC = 0
					AddPersonAttrib(id,"暗器技巧",20)	
				end
				------------------------------------------------------------------------------------------------------
				------------------------------------------行动后恢复怒气----------------------------------------------	
				------------------------------------------------------------------------------------------------------
				--九阴飞絮劲
				if WAR.FXHJ2 == 1 then
					nuqi(id,15)
					WAR.FXHJ2 = 0
				end	
				--北冥神功给自己加怒气
				if WAR.BMSGXL > 0 and id == 0 then
					nuqi(id,WAR.BMSGXL)
					WAR.BMSGXL = 0
				end
				--刀主大招，行动后恢复怒气
				if actor(id,4) and WAR.YZHYZ > 0 then
					nuqi(id,WAR.YZHYZ)
					WAR.YZHYZ = 0
				end
				--蛤蟆混元行动后怒气爆发
				if NGQHB(id,95) then
					local m = 10
					if JLSD(0,10,id) and (Given_NG(id,95) or Given_NG(id,180)) then
						m = 100
					end
					nuqi(id,m)
				end
				--天魔功，行动后恢复怒气
				if Curr_NG(id,160) then
					nuqi(id,10)
				end
				--擒龙降龙
				if PersonKF(id,26) and (Curr_NG(id,204) or match_ID(id,50)) then 
					local m = 10
					if JLSD(0,15,id) then
						m = 100
					end
					nuqi(id,m)       
					if match_ID(id,50) then
						zhanyi(id,m)  
					end
				end
				------------------------------------------------------------------------------------------------------
				------------------------------------------行动后恢复招式----------------------------------------------	
				------------------------------------------------------------------------------------------------------
				--丐世无双	
			    if WAR.GSWS2[1] ~= nil then 	
				    if WAR.GSWS3 < 1 then
						local n= 0
						for j = 0 ,WAR.PersonNum-1 do
							if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
								n = n + 1
							end
						end
						if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
							for i = 1, CC.Kungfunum do
								if JY.Person[id]["武功" .. i] == 26 then
									DIYdisplay("丐世无双・"..JY.Wugong[26]["名称"])
									if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]["我方"] == false or isteam(pid) == false then
										War_Fight_Sub(WAR.CurID, i, WAR.GSWS2[1], WAR.GSWS2[2])
									else
										War_Fight_Sub(WAR.CurID, i)
									end	
								end					
							end
						end
						WAR.GSWS3 = 1
						WAR.GSWS2 = {}
					else
						WAR.GSWS3 = 0
					end	
			    end	
				
				--丐世无双
			    if WAR.GSWS1[1] ~= nil then 		
					if WAR.GSWS3 < 1 then
						local n= 0
						for j = 0 ,WAR.PersonNum-1 do
							if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
								n = n + 1
							end
						end
						if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
							for i = 1, CC.Kungfunum do
								if JY.Person[id]["武功" .. i] == 80 then
									DIYdisplay("丐世无双・"..JY.Wugong[80]["名称"])
									if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]["我方"] == false or isteam(pid) == false then
										War_Fight_Sub(WAR.CurID, i, WAR.GSWS1[1], WAR.GSWS1[2])
									else
										War_Fight_Sub(WAR.CurID, i)
									end	
								end					
							end
						end	
						WAR.GSWS3 = 1
						WAR.GSWS1 = {}
					else
						WAR.GSWS3 = 0
					end	
				end
				
				--日月葵花	
			    if WAR.HLKH2[1] ~= nil then 	
				    if WAR.HLKH3 < 1 then
						local n = 0
						for j = 0 ,WAR.PersonNum-1 do
							if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
								n = n + 1
							end
						end
						if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
							for i = 1, CC.Kungfunum do
								if JY.Person[id]["武功" .. i] == 313 then
									DIYdisplay("葵影瞬杀・"..JY.Wugong[313]["名称"])
									if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]["我方"] == false or isteam(pid) == false then
										War_Fight_Sub(WAR.CurID, i, WAR.HLKH2[1], WAR.HLKH2[2])
									else
										War_Fight_Sub(WAR.CurID, i)
									end	
								end					
							end
						end
						WAR.HLKH3 = 1
						WAR.HLKH2 = {}
					else
						WAR.HLKH3 = 0
					end	
			    end	
				
				--日月葵花
			    if WAR.HLKH1[1] ~= nil then 		
					if WAR.HLKH3 < 1 then
						local n = 0
						for j = 0 ,WAR.PersonNum-1 do
							if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
								n = n + 1
							end
						end
						if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
							for i = 1, CC.Kungfunum do
								if JY.Person[id]["武功" .. i] == 226 then
									DIYdisplay("葵影瞬杀・"..JY.Wugong[226]["名称"])
									if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]["我方"] == false or isteam(pid) == false then
										War_Fight_Sub(WAR.CurID, i, WAR.HLKH1[1], WAR.HLKH1[2])
									else
										War_Fight_Sub(WAR.CurID, i)
									end	
								end					
							end
						end	
						WAR.HLKH3 = 1
						WAR.HLKH1 = {}
					else
						WAR.HLKH3 = 0
					end	
				end
				
				--天机刀剑
			    if WAR.TJDJ2[1] ~= nil then 	
				    if WAR.TJDJ3 < 1 then
						local n= 0
						for j = 0 ,WAR.PersonNum-1 do
							if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
								n = n + 1
							end
						end
						if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
							for i = 1, CC.Kungfunum do
								if JY.Person[id]["武功" .. i] == 58 then
									DIYdisplay("谐之道・"..JY.Wugong[58]["名称"])
									if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]["我方"] == false or isteam(pid) == false then
										War_Fight_Sub(WAR.CurID, i, WAR.TJDJ2[1], WAR.TJDJ2[2])
									else
										War_Fight_Sub(WAR.CurID, i)
									end	
								end					
							end
						end
						WAR.TJDJ3 = 1
						WAR.TJDJ2 = {}
					else
						WAR.TJDJ3 = 0
					end	
			    end	
				
				--天机刀剑
			    if WAR.TJDJ1[1] ~= nil then 		
					if WAR.TJDJ3 < 1 then
						local n= 0
						for j = 0 ,WAR.PersonNum-1 do
							if WAR.Person[j]["死亡"]== false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(WAR.Person[j]["人物编号"],"生命") > 0 then
								n = n + 1
							end
						end
						if n > 0 and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['生命'] > 0 then	
							for i = 1, CC.Kungfunum do
								if JY.Person[id]["武功" .. i] == 192 then
									DIYdisplay("谐之道・"..JY.Wugong[192]["名称"])
									if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]["我方"] == false or isteam(pid) == false then
										War_Fight_Sub(WAR.CurID, i, WAR.TJDJ1[1], WAR.TJDJ1[2])
									else
										War_Fight_Sub(WAR.CurID, i)
									end	
								end					
							end
						end	
						WAR.TJDJ3 = 1
						WAR.TJDJ1 = {}
					else
						WAR.TJDJ3 = 0
					end	
				end
	            ---------------------------------------阵法-----------------------------------------	
				--杀破狼
				if WAR.ZDDH == 430	then
					if id == 524 then
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 66, 1,'杀破狼・七杀')	
						if WAR.PD['以静制动1'][id] == nil then
							WAR.PD['以静制动1'][id] = 7
						end
						for j = 0, WAR.PersonNum -1 do 
							local wf = WAR.Person[j]["人物编号"]
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then 
						        --WAR.CSHF[wf] = 10
								WAR.QGZT[wf] = 1
								zhanyi(wf,50)
						    end
					    end
						for j = 0, WAR.PersonNum -1 do 
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
						        --WAR.PD['封印'][WAR.Person[j]["人物编号"]] = 10 
								WAR.PD['力竭'][WAR.Person[j]["人物编号"]] = 1 
								if nokillspeed(j) == false then
									--ztd(j,"集气位置",-100)
									WAR.Person[j].Time = WAR.Person[j].Time - 100
								end
						    end
					    end	 							
	                end	
					if id == 759 then
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 67, 1,'杀破狼・破军')
						WAR.PD['坚甲状态'][id] = 10
						for j = 0, WAR.PersonNum -1 do 
							local wf = WAR.Person[j]["人物编号"]
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then 
						        --WAR.WTL_PJTL[wf] = 10
								WAR.L_HQNZL[wf] = 5
								nuqi(wf,50)
						    end
					    end
						for j = 0, WAR.PersonNum -1 do
							local df = WAR.Person[j]["人物编号"] 
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
								WAR.PD['龙啸九天'][df] = 5
								if nokillspeed(j) == false then
									--ztd(j,"集气位置",-100)
									WAR.Person[j].Time = WAR.Person[j].Time - 100
								end   
						    end
					    end	 
					end
					if id == 760 then
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 67, 1,'杀破狼・贪狼')
						WAR.PD['野球拳'][id] = 1
						for j = 0, WAR.PersonNum -1 do
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then 
								WAR.PD['太玄组合防御3'][WAR.Person[j]["人物编号"]] = 10
								--ztd(j,"集气位置",200)
								WAR.Person[j].Time = WAR.Person[j].Time + 200
								if WAR.Person[j].Time > 980 then
									WAR.Person[j].Time = 980
								end
						    end
					    end	
						for j = 0, WAR.PersonNum -1 do 
							local df = WAR.Person[j]["人物编号"]
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
						        WAR.PD['十方无敌'][df] = 5
								if nokillspeed(j) == false then
									--ztd(j,"集气位置",-100)
									WAR.Person[j].Time = WAR.Person[j].Time - 100
								end
						    end
					    end	 
					end
				end 
				--杀破狼变阵	
				if WAR.ZDDH == 439	then
					if id == 524 then
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 66, 1,'杀破狼・五方')	
						if WAR.PD['以静制动1'][id] == nil then
							WAR.PD['以静制动1'][id] = 5
						end
						for j = 0, WAR.PersonNum -1 do 
							local wf = WAR.Person[j]["人物编号"]
					        if WAR.Person[j]["死亡"] == false then
								if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
									--WAR.CSHF[wf] = 10
									WAR.QGZT[wf] = 1
									zhanyi(wf,50)
								else
								    WAR.PD['力竭'][WAR.Person[j]["人物编号"]] = 1
								end 
						    end
					    end
	                end	
					if id == 514 then
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 67, 1,'杀破狼・破军')
						if WAR.PD['战神状态'][id] == nil then
							WAR.PD['战神状态'][id] = 5
						end
						for j = 0, WAR.PersonNum -1 do 
							local wf = WAR.Person[j]["人物编号"]
					        if WAR.Person[j]["死亡"] == false then
								if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
									WAR.L_HQNZL[wf] = 5
									nuqi(wf,50)
								else
								    WAR.PD['真利刃寒锋'][WAR.Person[j]["人物编号"]] = 5
								end 
						    end
					    end
					end
					if id == 760 then
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 67, 1,'杀破狼・贪狼')
						WAR.PD['野球拳'][id] = 1
						for j = 0, WAR.PersonNum -1 do 
							local df = WAR.Person[j]["人物编号"]
					        if WAR.Person[j]["死亡"] == false then
								if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
									Cat('清除所有异常',j)
									WAR.Person[j].Time = WAR.Person[j].Time + 200
									if WAR.Person[j].Time > 980 then
										WAR.Person[j].Time = 980
									end
								else
									WAR.PD['龙啸九天'][WAR.Person[j]["人物编号"]] = 5
								end 
						    end
					    end
					end
				end
				--厨神阵
				if WAR.ZDDH == 439	then
					if id == 760 then 
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 85, 1,'五味诀・酸')	
						for j = 0, WAR.PersonNum -1 do 
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
                                WAR.PD['灵蛇拳'][WAR.Person[j]["人物编号"]] = 20 
						    end
					    end
					end 		
					if id == 771 then 
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 86, 1,'五味诀・甜')	 
						for j = 0, WAR.PersonNum -1 do
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then 
								Cat('清除所有异常',j)
								WAR.Person[j].Time = WAR.Person[j].Time + 200
								if WAR.Person[j].Time > 980 then
									WAR.Person[j].Time = 980
								end
                                ztd(j,"生命点数",1000)
								ztd(j,"内力点数",2000)
								ztd(j,"体力点数",10)
						    end
					    end
					end 
					if id == 772 then 
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 87, 1,'五味诀・苦')	 
						for j = 0, WAR.PersonNum -1 do 
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
                                WAR.PD['气阻中门'][WAR.Person[j]["人物编号"]] = 10 
						    end
					    end
					end 	
					if id == 773 then 
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 88, 1,'五味诀・辣')	 
						for j = 0, WAR.PersonNum -1 do 
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
                                WAR.PD['禁疗'][WAR.Person[j]["人物编号"]] = 20 
						    end
					    end
					end 	
					if id == 774 then 
						WarDrawMap(0)
	                    CurIDTXDH(WAR.CurID, 89, 1,'五味诀・咸')	 
						for j = 0, WAR.PersonNum -1 do 
					        if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
                                WAR.PD['霸王破甲'][WAR.Person[j]["人物编号"]] = 20  
						    end
					    end
					end 	
				end
				-------------------行动结束后再动-----------------
				if JY.Person[id]['生命'] > 0 then
					--难知如阴
					local pd  = 0
					if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]['我方'] == false or (isteam(WAR.Person[WAR.CurID]['人物编号']) == false and WAR.Person[WAR.CurID]['我方'] == true) then
						pd = 1
					end	
					if WAR.FLHS5 == 2 then
						local z = WAR.CurID
						for j = 0, WAR.PersonNum - 1 do
							if WAR.Person[j]["人物编号"] == 0 and JY.Person[id]['生命'] > 0 then					
								WAR.CurID = j
								WAR.FLHS5 = 0
							end
						end
						if WAR.FLHS5 == 0 then
							WAR.Person[WAR.CurID]["移动步数"] = 6
							local x, y = nil, nil
							while 1 do
								if JY.Restart == 1 then
									break
								end
								if pd == 1 then
									--AutoMove()
									War_AutoEscape()
								else
									War_MoveMenu()
								end	
								break	
							end
						end
						WAR.FLHS5 = 0
						WAR.CurID = z
					end
	                --圣火神功 攻击后可移动
	                if PersonKF(id,93) and (0 < WAR.Person[p]["移动步数"] or 0 < WAR.ZYYD) then
						if 0 < WAR.ZYYD then
							WAR.Person[p]["移动步数"] = WAR.ZYYD
						end
						while 1 do
							if JY.Restart == 1 then
								break
							end
							if pd == 1 then
								--AutoMove()
								War_AutoEscape()
							else
								War_MoveMenu()
							end
							break		
						end
					end
					--云龙三折
					if QGQH(id,292,1) and WAR.YDBS > 0 then
						local jl = limitX(math.modf(WAR.YDBS*10),0,50)
						local s = WAR.CurID
						local yl3 = 0
						--[[local nx,ny = WAR.PD['云龙二折'][1],WAR.PD['云龙二折'][2]--]]
						WAR.CurID = p
						if QGQH(id,292,2)  then
							jl = jl + 20
						end	 
						if JLSD(10,jl,id) then
							WAR.Person[p]["移动步数"] = 5
							CurIDTXDH(WAR.CurID,53,1,'云龙一折')
							WAR.PD['时序闪避'][id] = 15
							local jl1 = limitX(math.modf(psx(id,'轻功')*0.08,0,70))
							if JLSD(10,jl1,id) then
								Cat('云龙挪移',WAR.CurID,7,1)
							    if JLSD(10,math.modf(WAR.SPIRIT[id]*0.6),id) then --math.modf(WAR.SPIRIT[id]*0.6)
							    	yl3 = 1
							    end	
							end
							WAR.Person[p]["移动步数"] = 7
							while 1 do
								if JY.Restart == 1 then
									break
								end
							 	if pd == 1 then
									AutoMove()
								else
							    	War_MoveMenu()
								end
								break
							end
							if yl3 == 1 and WAR.PD['云龙三折'][id] == nil then
								--CurIDTXDH(WAR.CurID,387,1,'云龙三折')
								WAR.PD['云龙三折'][id] = 1
								yl3 = 0
							end	
							WAR.CurID = s
						end	
					end	
					--桃花岛、青城、阿凡提、司空摘星
					if (MPTX(id,10,2) and PersonKF(id,237)) or MPTX(id,28,2) or match_ID(id,588) or match_ID(id,606) or match_ID(id,579) then
						if (MPTX(id,10,2) and PersonKF(id,237)) or match_ID(id,588) then
							WAR.Person[p]["移动步数"] = 6
						else
						    WAR.Person[p]["移动步数"] = 10
						end
						while 1 do
							if JY.Restart == 1 then
								break
							end
							if pd == 1 then
								AutoMove()
							else
							    War_MoveMenu()
							end
							War_RestMenu()
							break
						end 
					end
					--喵太极 逃离受想
					if match_ID(id,92) then
						WAR.Person[p]["移动步数"] = 8
						while 1 do
							if JY.Restart == 1 then
								break
							end
							if pd == 1 then
								--AutoMove()
								War_AutoEscape()
							else
							    War_MoveMenu()
							end
							War_RestMenu()
							break
						end 
					end
					--雪羽宗、踏沙、梯云高阶效、夜雨楼
					if MPTX(id,20) or match_ID(id,9802) or (QGQH(id,149,2) and WAR.PD['登云1'][id] ~= nil) or (MPTX(id,24,3) and JLSD(10,MPDJ(id)*8,id)) then
						if MPTX(id,24,3) and JLSD(10,MPDJ(id)*8,id) then
							WAR.Person[p]["移动步数"] = 9
						elseif QGQH(id,149,2) and WAR.PD['登云1'][id] ~= nil then
						    WAR.Person[p]["移动步数"] = 7
						else
						    WAR.Person[p]["移动步数"] = 5
						end
						while 1 do
							if JY.Restart == 1 then
								break
							end
							if pd == 1 then
								AutoMove()
							else
							    War_MoveMenu()
							end
							break
						end 
					end
					--苍狼疾行
					if id == 0 and JY.Base["标准"] > 0 and JY.Base["天书数量"] >= 4 then
						WAR.Person[p]["移动步数"] = 6
						while 1 do
							if JY.Restart == 1 then
								break
							end
							if pd == 1 then
								War_AutoEscape()
							else
							    War_MoveMenu()
							end
							War_RestMenu()
							break
						end 
					end
					--幻光步
					if (Curr_NG(id,93) and PersonKF(id,97)) and inteam(id) and WAR.HGB[100+id] == nil then 
						hgb()
					end
					--唐门模式图穷匕见
					if MPTX(id,9) and WAR.TMMS[id] == 2 then 
					    if WAR.ACSJ[100+id] ~= nil and WAR.ACSJ[200+id] ~= nil and WAR.ACSJ[300+id] ~= nil then 
					        CurIDTXDH(WAR.CurID, 45, 1, "图穷匕见")
					        CleanWarMap(4,0)
					        local x1 = WAR.ACSJ[100 + id][1];
					        local y1 = WAR.ACSJ[100 + id][2];
					        for ex = x1 - 5, x1 + 5 do
						        for ey = y1 - 5, y1 + 5 do
							        SetWarMap(ex, ey, 4, 1)
							        if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								        local ep = GetWarMap(ex, ey, 2)
								        if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
											ztd(ep,'生命点数',-400)
							                if WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] == nil then 
							                    WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] = 1
								            else 
								                WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] = WAR.ACSJ[500 +WAR.Person[ep]["人物编号"]] + 1
								            end
									        SetWarMap(ex, ey, 4, 4)
								        end
							        end
						        end
					        end
					        --War_ShowFight(id,0,0,0,x1,y1,135);
					        local x1 = WAR.ACSJ[200 + id][1];
					        local y1 = WAR.ACSJ[200 + id][2];
					        for ex = x1 - 5, x1 + 5 do
						        for ey = y1 - 5, y1 + 5 do
							        SetWarMap(ex, ey, 4, 1)
							        if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								        local ep = GetWarMap(ex, ey, 2)
								        if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
						                    ztd(ep,'生命点数',-400)
							                if WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] == nil then 
							                    WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] = 1
								            else 
								                WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] = WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] + 1
								            end
									        SetWarMap(ex, ey, 4, 4)
								        end
							        end
						        end
					        end
					        --War_ShowFight(id,0,0,0,x1,y1,135);
					        local x1 = WAR.ACSJ[300 + id][1];
					        local y1 = WAR.ACSJ[300 + id][2];
					        for ex = x1 - 5, x1 + 5 do
						        for ey = y1 - 5, y1 + 5 do
							        SetWarMap(ex, ey, 4, 1)
							        if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								        local ep = GetWarMap(ex, ey, 2)
								        if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
						                    ztd(ep,'生命点数',-400)
							                if WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] == nil then 
							                    WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] = 1
								            else 
								                WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] = WAR.ACSJ[500 + WAR.Person[ep]["人物编号"]] + 1
								            end
									        SetWarMap(ex, ey, 4, 4)
								        end
							        end
						        end
					        end
					        for j = 0,WAR.PersonNum-1 do 
					            if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false and WAR.ACSJ[500 + WAR.Person[j]["人物编号"]] ~= nil then 
									ztd(j,'生命点数',-WAR.ACSJ[500 + WAR.Person[j]["人物编号"]]*70)
						            WAR.ACSJ[500 + WAR.Person[j]["人物编号"]] = nil 
					            end 
					        end   
					        War_ShowFight(id,0,0,0,x1,y1,135);
					        WAR.ACSJ[100 + id] = nil
					        WAR.ACSJ[200 + id] = nil
					        WAR.ACSJ[300 + id] = nil
					    end
					end			
				end			
				
				--------------------NPC助战主角团队--------------------------
				
				--天龙后乔峰助战阿朱
				if WAR.ZDDH >= 0 and WAR.EVENT1 == 0 and instruct_18(147) then
		            for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["人物编号"] == 104 and WAR.Person[i]["我方"] == true and JY.Person[WAR.Person[i]["人物编号"]]["生命"] <= 0 then
							for r = 31, 42 do
								local x, y = WE_xy(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] - 1)
								NewWARPersonZJ(50, true, x, y, false, 2);
								WAR.Person[WAR.PersonNum - 1].Time = 1000
								WAR.EVENT1 = 1
								local s = nil
								s = WAR.CurID
								WAR.CurID = WAR.PersonNum - 1
								WAR.LQZ[50] = 100
								WAR.SPIRIT[50] = 200
								say("阿朱小心，这等局面，便由我来应付！", 50, 0)
								say("大哥，千万小心", 104, 0) 		 
								WAR.CurID = s
								break;
							end
		                end
			        end
		        end	
				
				--龙门客栈罗小鱼出战
				if WAR.ZDDH == 166 and WAR.EVENT1 == 0 and JY.Person[0]['品德'] >= 70 then
					for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["人物编号"] == 0 and WAR.Person[i]["我方"] == true and JY.Person[WAR.Person[i]["人物编号"]]["生命"] <= 0 then
							for r = 31, 42 do
								local x, y = WE_xy(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] - 1)
								NewWARPersonZJ(743, true, x, y, false, 2);
								WAR.Person[WAR.PersonNum - 1].Time = 1000
								WAR.EVENT1 = 1
								local s = nil
								s = WAR.CurID
								WAR.CurID = WAR.PersonNum - 1
								WAR.LQZ[743] = 100
								say("飞飞，最近我出了新菜品，要不要去试试？", 743, 0)
								say("走！", 455, 0) 	
								say("你先去中华阁，我随后就到。", 743, 0)	
								say("好的！", 455, 0) 
								say("？？？？？？怎么回事", 0, 1) 
								say("骚年，你年纪轻轻行走江湖也不容易，助你一把。", 743, 0)
								WAR.CurID = s
								break;
							end 
		                end
			        end
		        end	
				--50时序张三丰参战百损
				if WAR.ZDDH == 415 and WAR.TJPL == 0 then
					for i = 0, WAR.PersonNum - 1 do						
						if WAR.Person[i]["人物编号"] == 0 and WAR.Person[i]["我方"] == true and  WAR.SXTJ > 50 then
			                NewWARPersonZJ(5, true, 34, 46, false, 1)
			                WAR.Person[WAR.PersonNum - 1].Time = 1000
			                WAR.TJPL = 1
			                local s = nil
			                s = WAR.CurID
			                WAR.CurID = WAR.PersonNum - 1
			                say("孩子们且让开，百损由我来对付。", 5, 0)
			                say("张三丰，你终于上来了！", 523 , 0)			                
			                WAR.CurID = s
						end
					end		
				end		
				--30时序后黄药师参战
				if WAR.ZDDH == 52 and WAR.TJPL == 0 then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["人物编号"] == 0 and WAR.Person[i]["我方"] == true 
						and (JY.Person[WAR.Person[i]["人物编号"]]["生命"] <= 0 or WAR.SXTJ > 30) then
			        NewWARPersonZJ(57, true, 34, 46, false, 1)
			        WAR.Person[WAR.PersonNum - 1].Time = 1000
			        WAR.TJPL = 1
			        local s = nil
			        s = WAR.CurID
			        WAR.CurID = WAR.PersonNum - 1
			        say("<难道我要命丧于此？>", 0, 1)
			        say("啊哈哈哈，今日你们都要死！", 161, 0)
			        say("你们马上捂上耳朵!", 57 , 0)
			        say("师父！？", 63 , 0)
			        if JY.Person[0]['生命'] > 0 then
				        JY.Person[63]['论剑奖励'] = 1
			        end	
			        WAR.CurID = s
						end
					end		
				end		
		
				--小拾助战玩家
				if WAR.ZDDH == 456 and WAR.XSBC == 1 then
			        NewWARPersonZJ(748, true, 34, 46, false, 1)
					WAR.XSBC = 2
			        WAR.Person[WAR.PersonNum - 1].Time = 1000
			        WAR.TJPL = 1
			        local s = nil
			        s = WAR.CurID
			        WAR.CurID = WAR.PersonNum - 1
			        say("哈哈哈，东方亦，没想到你也有今日！", 748, 0)
					say("这位兄弟，你是！？", 0, 1)
					say("小村传人莫慌，我来相助与你，誓杀东方亦",748 , 0)
			        say("可恶！咳啊啊啊啊！", 457 , 0)
					if id == 748 then
						WAR.SZSD = 457
					end
			        WAR.CurID = s
				end
				if WAR.ZDDH == 437 and JY.Person[457]['品德'] == 100 and 50 < WAR.SXTJ then
					say("呜……", 457, 0)
					say('东方兄弟，你没事吧？',0,1)
					say("走，走开……呜，呜啊啊啊啊啊啊！！！", 457, 0)
					WAR.PD['点点暴走'][531] = 1
					JY.Person[457]['品德'] = 99
					say("该死的果然失控了！", 526, 0)
					NewWARPersonZJ(526, true, 16, 26, false, 1)
					WAR.Person[WAR.PersonNum - 1].Time = 1000
	                local s = nil
	                s = WAR.CurID
	                WAR.CurID = WAR.PersonNum - 1
					say("我先来帮你吧，现在东方他神志不清，小心点！", 526, 0)
					say("哈，渣渣是谁？", 525, 0)
					WAR.CurID = s
				end
				---------------------NPC助战敌方团队-------------------------
				
				--神雕正20时序鸠摩智支援金轮
				if WAR.ZDDH == 275 and JY.Person[429]["用毒能力"] == 0 and WAR.SXTJ > 20 then
					NewWARPersonZJ(103, false, 48, 47, false, 0)
	                JY.Person[429]["用毒能力"] = 1
					WAR.Person[WAR.PersonNum - 1].Time = 1000
	                local s = nil
		            s = WAR.CurID
		            WAR.CurID = WAR.PersonNum - 1
					say("法王，我来助你！！！！！！！！", 103, 0)
					say("明王！你怎么会？？？", 62, 0)
					say("法王的夙愿是将杨过打败，小僧为你挡住其他人。", 103, 0)
					say("多谢明王一番美意！！！", 62, 0)
					say("杨过，让你看看老衲龙象般若功的厉害！！！！！", 62, 0)
					say("杨大哥、龙姑娘此人是大轮明王，火焰刀绝技出神入化，千万小心。", 0, 1)
					say("龙儿、"..JY.Person[0]["外号"].."你们也要小心！", 58, 0)
					say("过儿小心！", 59, 0)
					WAR.CurID = s
				end		
				
				--笑傲邪令狐冲、任盈盈15时序支援
				if WAR.ZDDH == 424 and JY.Person[429]["用毒能力"] == 0 and WAR.SXTJ > 15 then
					say("令狐冲、任盈盈，没想到你们也来送死", 0, 1)
					say("你们来这做什么？本教主足以应付这小贼。", 26, 0)
	                NewWARPersonZJ(611, false, 30, 30, false, 0)
					NewWARPersonZJ(670, false, 30, 26, false, 0)
	                JY.Person[429]["用毒能力"] = 1
					WAR.Person[WAR.PersonNum - 1].Time = 1000
	                local s = nil
		            s = WAR.CurID
		            WAR.CurID = WAR.PersonNum - 1
					say("爹，女儿和冲哥来祝你一臂之力。。", 73, 0)
		            say("任教。。岳父，盈盈是不放心你，特地赶回来的", 35, 0,"???") 
					say("....................", 26, 0)	
					say("既然如此，我就送你们一起死吧！", 0, 1) 	
		            WAR.CurID = s
				end	
				--昆仑仙境15时序点点支援
				if WAR.ZDDH == 291 and JY.Person[429]["用毒能力"] == 0 and WAR.SXTJ > 15 then
	                NewWARPersonZJ(586, false, 33, 28, false, 0)
	                JY.Person[429]["用毒能力"] = 1
					WAR.Person[WAR.PersonNum - 1].Time = 1005
	                local s = nil
		            s = WAR.CurID
		            WAR.CurID = WAR.PersonNum - 1
					say("昆仑仙域，岂容外人亵渎！", 586, 0)
		            say("仙人小心，我来助你一臂之力！", 586, 0) 
		            WAR.CurID = s
				end
				--天台慕容博15时序支援
				if WAR.ZDDH == 458 and JY.Person[429]["用毒能力"] == 0 and WAR.SXTJ > 15 then
	                NewWARPersonZJ(113, false, 25, 18, false, 0)
	                JY.Person[429]["用毒能力"] = 1
					WAR.Person[WAR.PersonNum - 1].Time = 1000
	                local s = nil
		            s = WAR.CurID
		            WAR.CurID = WAR.PersonNum - 1
					say("云梦涧大当家乃女中豪杰，老夫特来相助鳌少保。", 113, 1)
					say("能得到燕龙渊先生的帮助，何愁此事不成？哈哈哈哈！！", 603, 0)
		            WAR.CurID = s
				end		
				--杨冰羽中华阁20时序支援
				if WAR.ZDDH == 461 and JY.Person[429]["用毒能力"] == 0 and WAR.SXTJ > 20 then
	                NewWARPersonZJ(514, false, 25, 18, false, 0)
	                JY.Person[429]["用毒能力"] = 1
					WAR.Person[WAR.PersonNum - 1].Time = 1000
	                local s = nil
		            s = WAR.CurID
		            WAR.CurID = WAR.PersonNum - 1
					say("本宗主也来凑个热闹，哈哈哈哈！！！！", 514, 1)
					say("我以为是谁呢，没想到是宗主！", 524, 1)
					say("我们三贱客终于可以以多欺少了！！哈哈哈哈！", 760, 1)
					say("...雪羽宗主？搞事是吧？还以多欺少？", 0, 1)
					say("骚年，打赢的话我额外在送你一个好天赋！", 514, 0)
					say("好，来呀！", 0, 1)
		            WAR.CurID = s
				end		
				----------------------------战役中我方变强--------------------------------------
				--百花谷对战老顽童
				if WAR.ZDDH == 274 and 20 < WAR.SXTJ and WAR.YGAR == 0 then
					say("老顽童这是我自创的黯然销魂掌，你小心了！", 58, 0)
					say("嘿嘿，杨过你终于肯使出真功夫了？", 64, 0)    	
					instruct_35(58,1,25,999)                 --杨过第二格黯然销魂掌10级
					AddPersonAttrib(58, "拳掌功夫", 200)     --杨过拳系+200
					AddPersonAttrib(58, "攻击力", 300)       --杨过攻击力+300
					AddPersonAttrib(58, "轻功", 300)         --杨过轻功+300
					JY.Person[58]["天赋外功2"] = 25
					WAR.LQZ[58] = 100 
					WAR.Person[WAR.PersonNum - 1].Time = 1000
					WAR.YGAR = 1
				end
				--无酒不欢：无论是否触发了圣火再移动，这个变量都应该在这一步清除，否则会影响到下一个人的圣火判定
				--触发周伯通左右补偿不清除
				if WAR.ZHB == 0 then
					WAR.ZYYD = 0
				end
		        --雪山上杀血刀老祖后，恢复我方人物 
		        if WAR.ZDDH == 7 then
					for x = 0, WAR.PersonNum - 1 do
						if WAR.Person[x]["人物编号"] == 97 and JY.Person[97]["生命"] <= 0 then
							for xx = 0, WAR.PersonNum - 1 do
								if WAR.Person[xx]["人物编号"] ~= 97 then
									WAR.Person[xx]["我方"] = true
								end
							end
						end
					end
		        end
				----------------------------行动后回气结算--------------------------------------
				--行动后回气结算
				local hqlimitX = 600
				if NGQHB(id,199) or QGQH(id,145,1) then
					hqlimitX = 700
				end
				if QGQH(id,223,1) then
					hqlimitX = 800
				end
				if match_ID(id,457) and WAR.PD['虚邪不染尘'][id] ~= nil then
					hqlimitX = 1000
				end
				if WAR.PD['气阻中门'][id] ~= nil and 500 < WAR.Person[p].Time then
					hqlimitX = hqlimitX - 500
				end
				if WAR.PD['辰宿列张'][id] == 1 then
					hqlimitX = hqlimitX - 400
				end
				--青城天罗步
				if MPTX(id,28,2) then
					if hqlimitX <= 100 then
						hqlimitX = 180
					end
				end
				if hqlimitX < -500 then
					hqlimitX = -500
				end
				if WAR.Person[p].Time > hqlimitX then
					WAR.Person[p].Time = hqlimitX
				end
				--太极纯阳
				if NGQH(id,171) then
					WAR.PD['强制减伤'][id] = math.modf((1000+WAR.Person[p].Time)/2)
		        end	
				----------------------------行动后再行动--------------------------------------
				--逍遥御风
				if WAR.XYYF_10 == 1 then
					WAR.XYYF_10 = 0
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["人物编号"] == 0 and 0 < JY.Person[WAR.Person[j]["人物编号"]]["生命"] and WAR.XYYF[WAR.Person[j]["人物编号"]] and 
						WAR.XYYF[WAR.Person[j]["人物编号"]] == 11 then
							WAR.Person[j].Time = 1005
							--封穴清0
							if JY.Person[WAR.Person[j]["人物编号"]]["封穴程度"] > 0 then
								JY.Person[WAR.Person[j]["人物编号"]]["封穴程度"] = 0
							end
							local s = WAR.CurID
							WAR.CurID = j
							Cls()
							CurIDTXDH(WAR.CurID, 105,1,"乘天地之正 御六气之辩",C_GOLD)
							WAR.CurID = s
						end
					end
				end
	            --西门吹雪 
				local ljxd = 0
	            if JXPD(id,500,1) and JY.Person[0]["资质"] > 30 and WAR.LJXD < 1 and JLSD(10,50,id) then
					WAR.LJXD = WAR.LJXD + 1
					ljxd = 1
					WarDrawMap(0); --不加这条则动画位置无法正常显示
					CurIDTXDH(WAR.CurID, 132,1,"剑道巅峰・五方行尽",C_ORANGE);
					--ShowScreen()
					--lib.Delay(400)
				  --立刻行动 (周而复始) 多次行动
	                for j = 0, WAR.PersonNum - 1 do
						WAR.Person[j].Time = WAR.Person[j].Time - 50
						if 950 < WAR.Person[j].Time then
							WAR.Person[j].Time = 950
						end
				    end
					WAR.Person[WAR.CurID].Time = 1005
		        end
			    if ljxd == 0 then
	                WAR.LJXD = 0
	            end
				
				--无酒不欢：袁承志，碧血长风，杀人后再动
				if match_ID(id, 54) and WAR.BXCF == 1 and War_isEnd() == 0 then	
					for k = 1,20 do
						local i = 12+k
						if i > 24 then 
							i = 24 	
						end
						Cat('实时特效动画')
						Cls()
						Cat('实时特效动画2')
						NewDrawString(-1, -1, "碧血长风", C_RED, 25 + i)
						ShowScreen();
						lib.Delay(CC.BattleDelay)
					end
					for j = 0, WAR.PersonNum - 1 do
						WAR.Person[j].Time = WAR.Person[j].Time - 50
						if 990 < WAR.Person[j].Time then
							WAR.Person[j].Time = 990
						end
					end
					WAR.Person[WAR.CurID].Time = 1005
					WAR.BXCF = 0
				end
				--点点专属
				if match_ID(id, 457) and WAR.DDLZ == 1 and War_isEnd() == 0 then	
					for k = 1,20 do
						local i = 12+k
						if i > 24 then 
							i = 24 	
						end
						Cat('实时特效动画')
						Cls()
						Cat('实时特效动画2')
						NewDrawString(-1, -1, "虚邪・残花连斩", C_RED, 25 + i)
						ShowScreen();
						lib.Delay(CC.BattleDelay)
					end
					for j = 0, WAR.PersonNum - 1 do
						WAR.Person[j].Time = WAR.Person[j].Time - 50
						if 990 < WAR.Person[j].Time then
							WAR.Person[j].Time = 990
						end
					end
					WAR.Person[WAR.CurID].Time = 1005
					WAR.DDLZ = 0
				end
				--黯然无中生有
				if WAR.PD['黯然・无中生有'][id] ~= nil and War_isEnd() == 0 then
					if WAR.PD['黯然・无中生有'][id] == 1 then
						for k = 1,20 do
							local i = 12+k
							if i > 24 then 
								i = 24 	
							end
							Cat('实时特效动画')
							Cls()
							Cat('实时特效动画2')
							NewDrawString(-1, -1, "无中生有", LimeGreen, 25 + i)
							ShowScreen();
							lib.Delay(CC.BattleDelay)
						end
						for j = 0, WAR.PersonNum - 1 do
							WAR.Person[j].Time = WAR.Person[j].Time - 50
							if 990 < WAR.Person[j].Time then
								WAR.Person[j].Time = 990
							end
						end
						WAR.Person[WAR.CurID].Time = 1005	
						WAR.PD['黯然・无中生有'][id] = 2
					else
						WAR.PD['黯然・无中生有'][id] = nil 
					end		
				end
	      --套装效果再次行动
				if WAR.PD['再次行动'][id] ~= nil and WAR.PD['再次行动'][id] > 0 and War_isEnd() == 0 then
					if --[[JLSD(0, WAR.PD['再次行动'][id], id)--]]math.random(100) <= WAR.PD['再次行动'][id] then
						for k = 1,20 do
							local i = 12+k
							if i > 24 then 
							i = 24 	
							end
							Cat('实时特效动画')
							Cls()
							Cat('实时特效动画2')
							NewDrawString(-1, -1, "再次行动", C_ORANGE, 25 + i)
							ShowScreen();
							lib.Delay(CC.BattleDelay)
						end				
						for j = 0, WAR.PersonNum - 1 do
							WAR.Person[j].Time = WAR.Person[j].Time - 50
							if 990 < WAR.Person[j].Time then
							WAR.Person[j].Time = 990
							end
						end
					WAR.Person[WAR.CurID].Time = 1005					
					end
					WAR.PD['再次行动'][id] = nil
				end
				--李白十步杀一人，杀人后再动
				if match_ID(id, 636) and id == 0 and WAR.SBSYR == 1 and War_isEnd() == 0 then	
					for k = 1,20 do
						local i = 12+k
						if i > 24 then 
							i = 24 	
						end
						Cat('实时特效动画')
						Cls()
						Cat('实时特效动画2')
						NewDrawString(-1, -1, "十步杀一人", C_RED, 25 + i)
						ShowScreen();
						lib.Delay(CC.BattleDelay)
					end
					for j = 0, WAR.PersonNum - 1 do
						WAR.Person[j].Time = WAR.Person[j].Time - 50
						if 990 < WAR.Person[j].Time then
							WAR.Person[j].Time = 990
						end
					end
					WAR.Person[WAR.CurID].Time = 1005
					WAR.SBSYR = 0
				end
		        --资质越高发动几率越高
		        local pz = math.modf(JY.Person[0]["资质"] / 10)
		        --主角医生大招，直接再次行动
		        if (actor(id,8) or match_ID(id, 9763)) and (JXPD(id,8,1) or JXPD(id,9763,1) or JY.Person[id]["实战"] >= 500) then
	                if WAR.HTSS == 1 then 
	                    WAR.HTSS = 0
	                else
	                    if JY.Person[0]["体力"] > 50 then
	                        if WAR.HTSS == 0 and JLSD(25, 55 + pz, 0) and 0 < JY.Person[0]["武功9"] then
	                            CurIDTXDH(WAR.CurID, 91, 1)
	                            for k = 1,20 do
	                                local i = 12+k
	                                if i > 24 then 
	                                    i = 24 	
	                                end
	                                Cat('实时特效动画')
	                                Cls()
	                                Cat('实时特效动画2')
	                                NewDrawString(-1, -1,  ZJTF[8] .. TFSSJ[8], C_GOLD, 25 + i)
	                                ShowScreen();
	                                lib.Delay(CC.BattleDelay)
	                            end
	                            for j = 0, WAR.PersonNum - 1 do
	                                WAR.Person[j].Time = WAR.Person[j].Time - 50
	                                if 990 < WAR.Person[j].Time then
	                                    WAR.Person[j].Time = 990
	                                end
	                            end
	                            WAR.Person[WAR.CurID].Time = 1005
	                            JY.Person[0]["体力"] = JY.Person[0]["体力"] - 10
	                            --有低概率再次发动
	                            if id == 0 and math.random(1,10) > 9 then
	                                WAR.HTSS = 0        
	                            else
	                                WAR.HTSS = 1
	                            end
	                        end
	                    end
	                end
				end	
				--重置异常状态
				reseteffect(WAR.PD['醉八仙'], id)
				if (WAR.PD['醉八仙'][id] or 0) < 1 then
					WAR.PD['微醺'][id] = nil
				end
				--战意重置 战意爆发
				if ZYBF(id) then
					if WAR.PD['斗战胜佛'][id] ~= nil and JLSD(10,35,id) then 
						WAR.PD['斗战胜佛'][id] = nil
						CurIDTXDH(WAR.CurID,88,1,'斗战胜佛')
					else	
						local a = math.random(100,150)
						zhanyi(id,-a)
						if WAR.PD['斗战胜佛'][id] ~= nil then
							WAR.PD['斗战胜佛'][id] = nil
						end	
					end	
				end
				if WAR.PD['三笑逍遥散'][id] ~= nil then
					WAR.PD['三笑逍遥散'][id] = WAR.PD['三笑逍遥散'][id] - 1
					if WAR.PD['三笑逍遥散'][id] == 0 then
						WAR.PD['三笑逍遥散'][id] = nil
						if JY.Person[id]["畅想分阶"] > 1 then
							JY.Person[id]["生命"] = 0
						else
							JY.Person[id]["生命"] = math.modf(JY.Person[id]["生命"]/30)
						end	
					end
				end
				if WAR.PD["分身瞬动"][id] ~= nil then 
					WAR.PD["分身瞬动"][id] = nil
				end	
				-----------------------------------------战斗限定时序---------------------------------
			    ---胡苗战
				if WAR.ZDDH == 373 and 100 < WAR.SXTJ then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
					end
					say("胡兄，今日就到此为止罢！", 3,0)
					Cls()
					say("那明日再战",633,0)
					Cls()
		        end
				--胡苗战5
				if WAR.ZDDH == 373 and CC.TX['胡苗战5'] == 1 and 100 == WAR.SXTJ then
					say('苗兄，你这招闭门铁扇刀，还是使得太快了些，劲力不长。',633,0)
					Cls()
					say('多承指教，我只道已经够慢了',3,0)
					Cls()
					break
				end
		        --成昆密道 100时序就跑
		        if WAR.ZDDH == 237 and 100 < WAR.SXTJ then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
					end
					say("１Ｌ＜嗯，没功夫跟这"..JY.Person[0]["外号2"].."纠缠了＞Ｗ哈哈哈，"..JY.Person[0]["外号2"].."，算你走运！老夫还有要事待办，这次就放你一马！", 18,0)
		        end
		        --成昆密道 小于100时序战胜
		        if WAR.ZDDH == 237 and 100 > WAR.SXTJ and War_isEnd() then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == true then
							instruct_2(14,1)
		               end
				    end
				end	
				--乌鞘岭破阵
				if WAR.ZDDH == 456 and (JY.Person[457]["生命"] < 1 or 60 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
						   WAR.Person[i]["死亡"] = true
						end
					end
					say("唉，要不是只用了一成功力，你也不会侥幸得胜！",457,0)
					Cls()
					say("恭喜大侠天（关之）下再无敌手！",765,0)
					Cls()
				end
				--乌鞘岭破阵
				if WAR.ZDDH == 456 and JY.Person[748]["生命"] < 1 then
					say("阎王好见，小鬼难缠，看我夺魂钩命锁！",748,0)
					if math.random(10) > 3 then
						for i = 0, WAR.PersonNum - 1 do
							if WAR.Person[i]["我方"] == true then
								WAR.Person[i]["死亡"] = true
							end
						end
						say("不好意思兄弟，一不小心勾到了你，我先溜了！",748,0)
					else
					    for i = 0, WAR.PersonNum - 1 do
							if WAR.Person[i]["我方"] == false then
								WAR.Person[i]["死亡"] = true
							end
						end
						say("哈哈，东方亦看钩，快随我去阴间吧！",748,0)
						Cls()
						say("可恶，咳啊啊啊啊！",457,0)
					end
				end
				--刀宗喵姐退场
				--[[if WAR.ZDDH == 408 and WAR.SXTJ > 60 then
					for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 709 then
							WAR.Person[i]["死亡"] = true
						end
	                end
					TalkEx("今日就这样，本喵午睡时间到了，告辞！", 92, 0)  --对话
				end]]
				--大金刚掌战胜天虹半血即可
				if WAR.ZDDH == 353 and JY.Person[657]["生命"] < JY.Person[657]["生命最大值"]/2 then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
						   WAR.Person[i]["死亡"] = true
						end
					end
				end
				--倚正灭绝
				if WAR.ZDDH == 150 and WAR.SXTJ > 100 then
					say('师太，百招已过，你仍未拿下'..JY.Person[0]["外号2"].."少侠，该收手了！",9,0)
					Cls()  --清
					say(JY.Person[0]["外号2"].."小贼，今日算你运气好！", 6, 0)  --对话
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
						   WAR.Person[i]["死亡"] = true
						end
					end
				end
				--社正明霞岛
				if WAR.ZDDH == 171 and ((JY.Person[60]["生命"] < JY.Person[60]["生命最大值"]/2) or WAR.SXTJ > 150) then
					say('该死，克儿的伤不能再拖了！',60,0)
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
						   WAR.Person[i]["死亡"] = true
						end
					end
				end
		        --张三丰 太极神功50时序
		        if WAR.ZDDH == 22 and ((JY.Person[5]["生命"] < JY.Person[5]["生命最大值"]/2) or 50 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
					end
					if JY.Person[0]["性别"] == 0 then
						TalkEx("小兄弟年纪轻轻，武功就已到如此境界，实属难得。今日就到此为止", 5, 0)  --对话
					else
					    TalkEx("小姑娘年纪轻轻，武功就已到如此境界，实属难得。今日就到此为止", 5, 0)  --对话
					end
				end
				--斗酒僧 九阳神功100时序
				if WAR.ZDDH == 287 and CC.TX['少林掌院选择'] ~= 5 then	
					if JY.Person[638]["生命"] < JY.Person[638]["生命最大值"] / 2 then
						for i = 0, WAR.PersonNum - 1 do
							if WAR.Person[i]["我方"] == false then
								WAR.Person[i]["死亡"] = true
							end
						end
						if psx(0,'品德') > 99 or (JY.Base['标准'] == 7 and psx(0,'品德') >= 70) then
							SetTF(0,9999,1)
						end	
						if JY.Person[0]["性别"] == 0 then
							TalkEx("小施主武功不差，但学武莫忘本心。一切法如露如电，应做如是观...", 638, 0)  --对话
						else
							TalkEx("小施主武功不差，但学武莫忘本心。一切法如露如电，应做如是观...", 638, 0)  --对话
						end
					elseif 100 < WAR.SXTJ then
						for i = 0, WAR.PersonNum - 1 do
							if WAR.Person[i]["我方"] == false then
								WAR.Person[i]["死亡"] = true
							end
						end
						if JY.Person[0]["性别"] == 0 then
							TalkEx("小施主武功不差，但学武莫忘本心。一切法如露如电，应做如是观...", 638, 0)  --对话
						else
							TalkEx("小施主武功不差，但学武莫忘本心。一切法如露如电，应做如是观...", 638, 0)  --对话
						end
					end	
				end	
				if WAR.ZDDH == 436 then
					if JY.Person[637]["生命"] < math.modf(JY.Person[637]["生命最大值"] *0.5) then							
						for i = 0, WAR.PersonNum - 1 do
							if WAR.Person[i]["我方"] == false then
								WAR.Person[i]["死亡"] = true
							end
						end
						if psx(0,'实战') > 200 or psx(0,'武学常识') > 50 then
							SetTF(0,9929,1)
							--SetTF(0,9723,1)
						end	
						if JY.Person[0]["性别"] == 0 then
							TalkEx("呵呵，小友悟性不差，然九阴所包虽繁，却需切记「大道至简」啊...", 637, 0)  --对话
						else
							TalkEx("呵呵，小友悟性不差，然九阴所包虽繁，却需切记「大道至简」啊...", 637, 0)  --对话
						end
					elseif 100 < WAR.SXTJ then
						for i = 0, WAR.PersonNum - 1 do
							if WAR.Person[i]["我方"] == false then
								WAR.Person[i]["死亡"] = true
							end
						end
						if JY.Person[0]["性别"] == 0 then
							TalkEx("呵呵，小友悟性不差，然九阴所包虽繁，却需切记「大道至简」啊...", 637, 0)  --对话
						else
							TalkEx("呵呵，小友悟性不差，然九阴所包虽繁，却需切记「大道至简」啊...", 637, 0)  --对话
						end
					end
				end
		        --一苇战 达摩60时序即获胜
		        if WAR.ZDDH == 309 and  60 < WAR.SXTJ then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                if JY.Person[0]["性别"] == 0 then
	                    TalkEx("小兄弟年纪轻轻，武功就已到如此境界，实属难得。今日就到此为止", 577, 0)  --对话
	                else
	                    TalkEx("小姑娘年纪轻轻，武功就已到如此境界，实属难得。今日就到此为止", 577, 0)  --对话
	                end			
	            end
				--华山独孤
				if WAR.ZDDH == 384 and (JY.Person[592]["生命"] < JY.Person[592]["生命最大值"] / 2 or 30 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                TalkEx("多谢前辈承让！", 0, 0)  --对话
	            end
				
				--扬州逍遥子
				if WAR.ZDDH == 385 and (JY.Person[634]["生命"] < JY.Person[634]["生命最大值"] / 2 or 30 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                TalkEx("多谢前辈承让！", 0, 0)  --对话
	            end
				
				--百花谷空明拳
				if WAR.ZDDH == 381 and (JY.Person[64]["生命"] < JY.Person[64]["生命最大值"] / 2 or 80 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                TalkEx("小娃娃挺厉害的。", 64, 0)  --对话
	            end	
				
				--百花谷空明拳
				if WAR.ZDDH == 274 and (JY.Person[64]["生命"] < JY.Person[64]["生命最大值"] / 2 or 100 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                TalkEx("杨过，你的黯然销魂掌我看清楚了。", 64, 0)  --对话	
	            end	
				
				--天龙寺拿剑谱
				if WAR.ZDDH == 345 and (JY.Person[499]["生命"] < JY.Person[499]["生命最大值"] / 2 or 100 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                TalkEx("长江后浪推前浪，好得很。", 499, 0)  --对话			
	            end	
				
				--华山谢无悠
				if WAR.ZDDH == 245 and (JY.Person[596]["生命"] < JY.Person[596]["生命最大值"] / 2 or 50 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                TalkEx("你挺厉害的，居然能挡得住我的剑术。", 596, 0)  --对话			
	            end	
				
				--华山谢云流
				if WAR.ZDDH == 305 and (JY.Person[501]["生命"] < JY.Person[501]["生命最大值"] / 2 or 75 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
	                TalkEx("不错不错，小村传人果然不简单。", 501, 0)  --对话			
	            end	
				
				--战梁萧
				if WAR.ZDDH == 338 and (JY.Person[635]["生命"] < JY.Person[635]["生命最大值"] / 2 or 80 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum -1 do 
						if WAR.Person[i]["我方"] == false  then
							WAR.Person[i]["死亡"] = true
						end 
					end 
					TalkEx("我们就点到为止吧。", 635, 0)  --对话
				end 					
				
	            --车神战役
				if WAR.ZDDH == 427 and (JY.Person[524]["生命"] < JY.Person[524]["生命最大值"] / 3 or 100 < WAR.SXTJ) then
					for i = 0, WAR.PersonNum -1 do 
						if WAR.Person[i]["我方"] == false  then
							WAR.Person[i]["死亡"] = true
						end 
					end 
					TalkEx("果然是后生可畏。", 524, 0)  --对话
				end 						
				
				--天邪聚贤庄
				if WAR.ZDDH == 248 and 100 < WAR.SXTJ then
					JY.Person[112]["主运内功"] = 160
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
	                end
					if JY.Person[0]["性别"] == 0 then
	                    TalkEx("Ｌ＜可恶，这小鬼怎的武功如此高强...此地不宜久留！＞", 112, 0)  --对话
	                else
	                    TalkEx("Ｌ＜可恶，这小女娃怎的武功如此高强...此地不宜久留！＞", 112, 0)  --对话
	                end
				end	
		
				--倚邪三渡战
				if WAR.ZDDH == 253 and 50 < WAR.SXTJ and JY.Person[631]["左右互搏"] < 1 and WAR.ZZRZY == 0 then
					TalkEx("Ｌ＜这三人心意相通，如攻其一人，则其余两人立即回护，这样如何能够破阵？＞", 631, 0)  --对话
					TalkEx("Ｌ＜……若能分心二用，同时攻击两方，且他们如何应对＞", 631, 0)  --对话
					TalkEx("Ｌ＜我悟了！＞", 631, 0)  --对话
					QZXS('周芷若领悟左右互搏！')
					if JY.Base["畅想"] == 631 then
					    JY.Person[0]["左右互搏"] = 1
				    else
					    JY.Person[631]["左右互搏"] = 1
				    end
					WAR.ZZRZY = 1
				end	
				--丁不四
				if WAR.ZDDH == 166 and 40 < WAR.SXTJ then 
					for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 163 then
							WAR.Person[i]["死亡"] = true
							QZXS("丁不四脸色一变，匆匆离去")
						end
					end
				end	
				--蝴蝶谷200时序金花逃跑
		        if WAR.ZDDH == 156 and 200 < WAR.SXTJ then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false then
							WAR.Person[i]["死亡"] = true
						end
					end
					say("１Ｌ＜可恶，小村传人居然插手...此地不宜久留！＞", 15,0)
		        end
				if WAR.ZDDH == 432 and 30 < WAR.SXTJ then
					for i = 0, WAR.PersonNum - 1 do 
						if WAR.Person[i]["我方"] == false then 
							WAR.Person[i]["死亡"] = true
						end
					end
					TalkEx("好好好，小村传人果然名不虚传。",456, 0)
				end
				--丁当狙击
				if WAR.ZDDH == 405 and 60 < WAR.SXTJ then
					for i = 0, WAR.PersonNum - 1 do 
						if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 521 then 
							WAR.Person[i]["死亡"] = true
						end
					end
					TalkEx("怎么不打了？居然还用刀背对着我。", 0, 1)
					TalkEx("刀背所向，皆是弱者。", 521, 0,"???")
					TalkEx("什么？弱者？我们在来过。", 0, 1)
					TalkEx("再练练吧。", 521, 0,"???")
				end 	
				
				--埋剑崖
				if WAR.ZDDH == 420 and 40 < WAR.SXTJ then	
					for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 592 then
							WAR.Person[i]["死亡"] = true
						end
	                end
					TalkEx("想不到你们三人如此厉害，我心愿已了！", 592, 0)  --对话
				end	
				
				--不老长春谷
				if WAR.ZDDH == 303 and match_ID(pid,634) then 
					TalkEx("好好好。", 634, 0)  --对话
					WAR.Person[WAR.CurID]["死亡"] = true
				end		
				
				--独孤试剑
				if WAR.ZDDH == 425 and 50 < WAR.SXTJ then 
					for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 592 then
							WAR.Person[i]["死亡"] = true
						end
	                end
					TalkEx("好，到此为止吧。", 592, 0)  --对话
				end	
				
				--中华阁独孤
				if WAR.ZDDH == 467 and 100 < WAR.SXTJ then
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 592 then 
							WAR.Person[i]["死亡"] = true
						end 
					end 
					TalkEx("小村传人果然名不虚传！", 592, 0)  --对话
				end 			
				
				--升厨子
				if WAR.ZDDH == 457 and 65 < WAR.SXTJ then 
					for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 759 then
							WAR.Person[i]["死亡"] = true
						end
	                end
					TalkEx("很好，实力不俗。", 759, 0)  --对话
				end	
				
				--让我三招
				if WAR.ZDDH == 402 and WAR.RWSZ == 3 then 
					for i = 0, WAR.PersonNum - 1 do
		                if WAR.Person[i]["我方"] == false and WAR.Person[i]["人物编号"] == 457 then
							WAR.Person[i]["死亡"] = true
						end
	                end
					TalkEx("你合格了，小村传人，本庄主就勉为其难收你做小弟吧！", 457, 0)  --对话
				end	
				
				--飞飞
				if WAR.ZDDH == 166 and WAR.Person[WAR.CurID]['我方'] == false and match_ID(pid,455) then 
					TalkEx("小女子先告辞了，有缘再见！", 455, 0)  --对话
					WAR.Person[WAR.CurID]["死亡"] = true
				end
				
				if WAR.ZDDH == 459 and WAR.Person[WAR.CurID]['我方'] == false and match_ID(pid,517) then
					say('呵，不错，胆气和实力都不错。',517,0)
					WAR.Person[WAR.CurID]["死亡"] = true
				end
				
				--旧版华山论剑，敌我随机变换
				if WAR.ZDDH == 238 then
					local life = 0  ---激活敌人
					WAR.NO1 = 114; --- 1号 战斗角色等于扫地
					for i = 0, WAR.PersonNum - 1 do   --执行指令
						if WAR.Person[i]["死亡"] == false and 0 < JY.Person[WAR.Person[i]["人物编号"]]["生命"] then   --如果没有死人和人物生命大于0 这样
							life = life + 1 -- 敌人+1
							if WAR.NO1 >= WAR.Person[i]["人物编号"] then  --如果编号大于等于1号人物
								WAR.NO1 = WAR.Person[i]["人物编号"] --敌人等于1号
							end
						end
					end
		          
					if 1 < life then  --如果激活人数大于1
						local m, n = 0, 0 --编号 设定 一个M方,一个N方
						while true do			--防止全部随机到已方
							if m >= 1 and n >= 1 then  --如果M方大于等于1，N方大于等于1
								break;  --终止循环
							else  -- 也可能是
								m = 0;  --M方为0 
								n = 0;  --N方为0
							end
							
							for i = 0, WAR.PersonNum - 1 do  --执行指令
								if WAR.Person[i]["死亡"] == false and 0 < JY.Person[WAR.Person[i]["人物编号"]]["生命"] then   --如果没有人死亡和人物生命大于0 
									if WAR.Person[i]["人物编号"] == 0 then  --如果人物编号等于0
										WAR.Person[i]["我方"] = true   --则为我方
										m = m + 1    --M方人数+1
									elseif math.random(2) == 1 then   --也可能 随机1~2为1时
										WAR.Person[i]["我方"] = true  --成为我方
										m = m + 1  --M方人数+1
									else
										WAR.Person[i]["我方"] = false  --也可能不是我方
										n = n + 1  --则N方人数+1
									end
								end
							end
						end
					end
					
					
					
		        end
				
		    end
	       -- warStatus = War_isEnd()   --战斗是否结束？   0继续，1赢，2输
			--if 0 < warStatus then
			--	break;
			--end
		end
	    
		--warStatus = War_isEnd()   --战斗是否结束？   0继续，1赢，2输
		--if 0 < warStatus then
		--	break;
        --end
    ::label0::    
		CleanMemory()
    --end
		warStatus = War_isEnd()
	  if 0 < warStatus then
	   	break;
	  end
	
    WarPersonSort(1)
    WAR.Delay = GetJiqi()
    startt = lib.GetTime()
    collectgarbage("step", 0)
  end
  local r = nil
  WAR.ShowHead = 0
 
	--战斗结束后的奖励
	if WAR.ZDDH == 238 then
		PlayMIDI(111)
		PlayWavAtk(41)
		DrawStrBoxWaitKey("论剑结束", C_WHITE, CC.DefaultFont)
		DrawStrBoxWaitKey("武功天下第一者：" .. JY.Person[WAR.NO1]["姓名"], C_RED, CC.DefaultFont)
		if WAR.NO1 == 0 then
		  r = true
		else
		  r = false
		end
	--战斗胜利
	elseif warStatus == 1 then
		local bx,by = CC.ScreenW/1360,CC.ScreenH/768
		PlayMIDI(111)
		PlayWavAtk(41)
		lib.LoadPNG(91, 1*2 , 295+bx*212, 295+by*33.5, 1)
		ShowScreen();
		WaitKey();

		if WAR.ZDDH == 76 then
			DrawStrBoxWaitKey("特殊奖励：千年灵芝一枚", C_GOLD, CC.DefaultFont)
			instruct_32(14, 1)
		elseif WAR.ZDDH == 15 or WAR.ZDDH == 80 then
			DrawStrBoxWaitKey("特殊奖励：主角五系兵器值提升三十点", C_RED, CC.DefaultFont,nil,C_GOLD)
			AddPersonAttrib(0, "拳掌功夫", 30)
			AddPersonAttrib(0, "指法技巧", 30)
			AddPersonAttrib(0, "御剑能力", 30)
			AddPersonAttrib(0, "耍刀技巧", 30)
			AddPersonAttrib(0, "特殊兵器", 30)
		elseif WAR.ZDDH == 292 then
			local hqjl = JYMsgBox("特殊奖励", "你完成了奖励战**请选择一项兵器值进行提高", {"拳法","指法","剑法","刀法","奇门"}, 5, 69)
			if hqjl == 1 then
				AddPersonAttrib(0, "拳掌功夫", 30)
				DrawStrBoxWaitKey("你的拳掌功夫提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 2 then
				AddPersonAttrib(0, "指法技巧", 30)
				DrawStrBoxWaitKey("你的指法技巧提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 3 then
				AddPersonAttrib(0, "御剑能力", 30)
				DrawStrBoxWaitKey("你的御剑能力提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 4 then
				AddPersonAttrib(0, "耍刀技巧", 30)
				DrawStrBoxWaitKey("你的耍刀技巧提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 5 then
				AddPersonAttrib(0, "特殊兵器", 30)
				DrawStrBoxWaitKey("你的特殊兵器提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			end
			DrawStrBoxWaitKey("特殊奖励：千年灵芝一枚", C_GOLD, CC.DefaultFont)
			instruct_32(14, 1)
		elseif WAR.ZDDH == 172 then
			DrawStrBoxWaitKey("特殊奖励：获得蛤蟆功秘籍一本", C_GOLD, CC.DefaultFont)
			instruct_32(73, 1)
		elseif WAR.ZDDH == 173 then
			DrawStrBoxWaitKey("特殊奖励：获得天山雪莲两枚", C_GOLD, CC.DefaultFont)
			instruct_32(17, 2)
		elseif WAR.ZDDH == 188 then
			local hqjl = JYMsgBox("特殊奖励", "你完成了奖励战**请选择一项兵器值进行提高", {"拳法","指法","剑法","刀法","奇门"}, 5, 69)
			if hqjl == 1 then
				AddPersonAttrib(0, "拳掌功夫", 30)
				DrawStrBoxWaitKey("你的拳掌功夫提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 2 then
				AddPersonAttrib(0, "指法技巧", 30)
				DrawStrBoxWaitKey("你的指法技巧提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 3 then
				AddPersonAttrib(0, "御剑能力", 30)
				DrawStrBoxWaitKey("你的御剑能力提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 4 then
				AddPersonAttrib(0, "耍刀技巧", 30)
				DrawStrBoxWaitKey("你的耍刀技巧提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 5 then
				AddPersonAttrib(0, "特殊兵器", 30)
				DrawStrBoxWaitKey("你的特殊兵器提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			end
			SetTF(0,9989,1)
		elseif WAR.ZDDH == 292 then
			local hqjl = JYMsgBox("特殊奖励", "你完成了奖励战**请选择一项兵器值进行提高", {"拳法","指法","剑法","刀法","奇门"}, 5, 6)
			if hqjl == 1 then
				AddPersonAttrib(0, "拳掌功夫", 30)
				DrawStrBoxWaitKey("你的拳掌功夫提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 2 then
				AddPersonAttrib(0, "指法技巧", 30)
				DrawStrBoxWaitKey("你的指法技巧提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 3 then
				AddPersonAttrib(0, "御剑能力", 30)
				DrawStrBoxWaitKey("你的御剑能力提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 4 then
				AddPersonAttrib(0, "耍刀技巧", 30)
				DrawStrBoxWaitKey("你的耍刀技巧提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			elseif hqjl == 5 then
				AddPersonAttrib(0, "特殊兵器", 30)
				DrawStrBoxWaitKey("你的特殊兵器提高了三十点",C_GOLD,CC.DefaultFont,nil,LimeGreen)
				Cls()  --清屏
			end
		elseif WAR.ZDDH == 211 then
			DrawStrBoxWaitKey("特殊奖励：主角防御力和轻功各提升三十点", C_GOLD, CC.DefaultFont)
			AddPersonAttrib(0, "防御力", 30)
            AddPersonAttrib(0, "轻功", 30)
			instruct_32(88, 1)
            
		elseif WAR.ZDDH == 86 then
            instruct_2(66, 1)
            
        elseif WAR.ZDDH == 4 then
            AddPersonAttrib(0,'实战',30)
            QZXS(string.format("%s 实战增加%s点",JY.Person[0]["姓名"],30));

		elseif WAR.ZDDH == 77 then
            AddPersonAttrib(0,'实战',20)
            QZXS(string.format("%s 实战增加%s点",JY.Person[0]["姓名"],20));

		elseif WAR.ZDDH > 42 and  WAR.ZDDH < 47 then
            AddPersonAttrib(0,'实战',10)
            QZXS(string.format("%s 实战增加%s点",JY.Person[0]["姓名"],10));

		elseif WAR.ZDDH == 161 then
            AddPersonAttrib(0,'实战',30)
            QZXS(string.format("%s 实战增加%s点",JY.Person[0]["姓名"],30));

        --抢飞狐
		elseif WAR.ZDDH == 470 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)
		--抢雪山
		elseif WAR.ZDDH == 471 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢连城
		elseif WAR.ZDDH == 472 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢天龙
		elseif WAR.ZDDH == 473 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢射雕
		elseif WAR.ZDDH == 474 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢白鹿
		elseif WAR.ZDDH == 475 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)
		--抢鹿鼎
		elseif WAR.ZDDH == 476 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢笑傲
		elseif WAR.ZDDH == 477 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢书剑
		elseif WAR.ZDDH == 478 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢神雕
		elseif WAR.ZDDH == 479 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢侠客
		elseif WAR.ZDDH == 480 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢倚天
		elseif WAR.ZDDH == 481 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢碧血
		elseif WAR.ZDDH == 482 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)	
		--抢鸳鸯
		elseif WAR.ZDDH == 483 then
			DrawStrBoxWaitKey("特殊奖励：获得十朵天山雪莲", C_GOLD, CC.DefaultFont)
			instruct_32(17,10)		
		--战胜海大富
		elseif WAR.ZDDH == 259 then
			DrawStrBoxWaitKey("特殊奖励：获得化骨绵掌秘籍一本", C_GOLD, CC.DefaultFont)
			instruct_32(275,1)
		--标记修改
		elseif WAR.ZDDH == 100 then
		    DrawStrBoxWaitKey("特殊奖励：获得火焰刀法秘籍一本", C_GOLD, CC.DefaultFont)
		    instruct_32(135, 1)
		--封玉楼五厨神
		elseif WAR.ZDDH == 460 then
		    DrawStrBoxWaitKey("特殊奖励：获得霹雳套", C_GOLD, CC.DefaultFont)
		    instruct_32(541, 1)
			instruct_32(542, 1)
			instruct_32(543, 1)
		--扬州逍遥子点拨
		elseif WAR.ZDDH == 385 then
			instruct_32(343, 1)
			instruct_32(344, 1)
			instruct_32(345, 1)
			instruct_32(348, 1)
			AddPersonAttrib(0, "武学常识", 100)
		--埋剑崖奖励
		elseif WAR.ZDDH == 420 then
		    if JY.Base["标准"] == 3 then
				DrawStrBoxWaitKey("特殊奖励：剑主学会料敌先机", C_GOLD, CC.DefaultFont)
				JY.Person[638]["论剑奖励"] = 1
			end
			instruct_32(348, 1)
			AddPersonAttrib(0, "武学常识", 100)
		--中华阁独孤	
		elseif WAR.ZDDH == 467 then
		    if JY.Base["标准"] > 0 then
				DrawStrBoxWaitKey("特殊奖励：主角学会料敌先机", C_GOLD, CC.DefaultFont)
				JY.Person[638]["论剑奖励"] = 1
			end
		--新论剑奖励 根据敌人不同奖励不同
		elseif WAR.ZDDH == 266 then
			--老周
			if GetS(85, 40, 38, 4) == 64 then
				local str = "特殊奖励：你的体内消耗永久降低了50% "
				JY.Person[64]["论剑奖励"] = 1
				if JY.Person[0]["左右互搏"] == 1 and JY.Person[0]["资质"] < 31 then
					JY.Person[0]["左右互搏"] = 2
					str = "特殊奖励：你的体内消耗永久降低了50%，并学会「左右互搏真谛」"
				end	
				DrawStrBoxWaitKey(str, LimeGreen, 36,nil, C_GOLD)
			--老王
			elseif GetS(85, 40, 38, 4) == 129 then
				DrawStrBoxWaitKey("特殊奖励：你的伤害量永久提高了20% ", LimeGreen, 36,nil, C_GOLD)
				JY.Person[129]["论剑奖励"] = 1
			--林朝英
			elseif GetS(85, 40, 38, 4) == 605 then
				DrawStrBoxWaitKey("特殊奖励：你的连击率永久提高了50%，前三次攻击免疫断连击 ", LimeGreen, 36,nil, C_GOLD)
				JY.Person[605]["论剑奖励"] = 1
			--阿青
			elseif GetS(85, 40, 38, 4) == 718 then
				DrawStrBoxWaitKey("特殊奖励：气攻、气防增加1000点 ", LimeGreen, 36,nil, C_GOLD)
				JY.Person[604]["论剑奖励"] = 1
			--风清扬
			elseif GetS(85, 40, 38, 4) == 140 then
				if TrueYJ(0) > 750 and PersonKF(0,377)then
					DrawStrBoxWaitKey("特殊奖励：气攻增加1000点；学会「五岳神剑之精髓」", LimeGreen, 36,nil, C_GOLD)
					JY.Person[592]["论剑奖励"] = 2
				else
					DrawStrBoxWaitKey("特殊奖励：你的气攻永久提高了1000点", LimeGreen, 36,nil, C_GOLD)
					JY.Person[592]["论剑奖励"] = 1
				end	
			--东方不败
			elseif GetS(85, 40, 38, 4) == 27 then
				DrawStrBoxWaitKey("特殊奖励：你的集气破上限", LimeGreen, 36,nil, C_GOLD)
				JY.Person[27]["论剑奖励"] = 1
			--扫地
			elseif GetS(85, 40, 38, 4) == 114 then
				DrawStrBoxWaitKey("特殊奖励：你的武学常识提高了100点，减伤30%", LimeGreen, 36,nil, C_GOLD)
				JY.Person[114]["论剑奖励"] = 1
				AddPersonAttrib(0, "武学常识", 100)
			--三丰
			elseif GetS(85, 40, 38, 4) == 5 then
				DrawStrBoxWaitKey("特殊奖励：你的能力提升，生命增加20%底力", LimeGreen, 36,nil, C_GOLD)
				JY.Person[5]["论剑奖励"] = 1
				AddPersonAttrib(0, "攻击力", 30)
				AddPersonAttrib(0, "防御力", 30)
				AddPersonAttrib(0, "轻功", 30)
				AddPersonAttrib(0, "拳掌功夫", 30)
				AddPersonAttrib(0, "指法技巧", 30)
				AddPersonAttrib(0, "御剑能力", 30)
				AddPersonAttrib(0, "耍刀技巧", 30)
				AddPersonAttrib(0, "特殊兵器", 30)
			--阿凡提
			elseif GetS(85, 40, 38, 4) == 606 then
				DrawStrBoxWaitKey("特殊奖励：你获得了绝对先手的能力", LimeGreen, 36,nil, C_GOLD)
				JY.Person[606]["论剑奖励"] = 1
			end
		end

		r = true
		--赵半山 李寻欢战斗胜利获得暗器
		if (JY.Base["畅想"] == 153 or JY.Base["畅想"] == 498) and WAR.ZDDH ~= 226 and WAR.ZDDH ~= 354 then
			local anqi = math.random(28,35)
			local num = math.random(5)
			instruct_2(anqi,num)
		end
		r = true
		--长生先天胜利后获得资质
		if math.random(100) > 50 then
			for j = 0, WAR.PersonNum-1 do 
				if WAR.Person[j]['死亡'] == false then
					if NGQH(WAR.Person[j]['人物编号'],203) and JY.Person[WAR.Person[j]['人物编号']]["资质"] < 100 and JY.Person[WAR.Person[j]['人物编号']]["资质"] > 79 then
						AddPersonAttrib(WAR.Person[j]['人物编号'],'资质',math.random(1,3))
					end
				end
			end	
		end
		r = true
		--战斗胜利获得银两
		if (JY.Base["标准"] > 0 or JY.Base["畅想"] > 0) and WAR.ZDDH > 0 then
			local num = math.random(50,100)
			local m=0
			local pd = true
			if (WAR.ZDDH == 373 and JY.Person[3]['品德'] == 100) or WAR.ZDDH == 226 or  WAR.ZDDH == 354 or WAR.ZDDH == 166 then
				pd = false
			end
			if pd == true then	
				for i = 0,WAR.PersonNum-1 do
					local id = WAR.Person[i]['人物编号']
					if WAR.Person[i]['我方'] ==false then
						if JY.Person[id]["畅想分阶"] >=4 then
							m=m+math.random(50,100)
						--num1=num1+math.random(1,2)
						--cs_n=cs_n+1
						elseif JY.Person[id]["畅想分阶"]==3 then
							m=m+math.random(600,800)
						--num1=num1+math.random(1,3)
						--cs_n=cs_n+1
						elseif JY.Person[id]["畅想分阶"]==2 then
							m=m+math.random(800,1000)
							--num1=num1+math.random(2,4)
							-- cs_n=cs_n+1
							-- cs_m=cs_m+1
							if JY.Person[id]["武器"]~=-1 then
							--JY.Person[id]["武器"] = math.random(36,57)
								instruct_2(JY.Person[id]["武器"],1)
								--JY.Person[id]["武器"]=-1
							end
							if JY.Person[id]["防具"]~=-1 then
								instruct_2(JY.Person[id]["防具"],1)
								--JY.Person[id]["防具"]=-1
							end
							if JY.Person[id]["坐骑"]~=-1 then
								instruct_2(JY.Person[id]["坐骑"],1)
								--JY.Person[id]["坐骑"]=-1
							end
						elseif JY.Person[id]["畅想分阶"]==1 then
							m=m+math.random(1200,1600)
						--num1=num1+math.random(3,9)
						-- cs_n=cs_n+1
						-- cs_m=cs_m+5
						if JY.Person[id]["武器"]~=-1 then
							--JY.Person[id]["武器"] = math.random(36,57)
							instruct_2(JY.Person[id]["武器"],1)
							--JY.Person[id]["武器"]=-1
						end
						
						if JY.Person[id]["防具"]~=-1 then
							instruct_2(JY.Person[id]["防具"],1)
							--JY.Person[id]["防具"]=-1
						end
						
						if JY.Person[id]["坐骑"]~=-1 then
							instruct_2(JY.Person[id]["坐骑"],1)
							--JY.Person[id]["坐骑"]=-1
						end
						
						elseif JY.Person[id]["畅想分阶"]==0 then
							m=m+math.random(2000,2500)
						-- cs_n=cs_n+1
						-- cs_m=cs_m+10
						--num1=num1+math.random(8,12)
						
							if JY.Person[id]["武器"]~=-1 then
								--JY.Person[id]["武器"] = math.random(36,57)
								instruct_2(JY.Person[id]["武器"],1)
								--JY.Person[id]["武器"]=-1
							end
							
							if JY.Person[id]["防具"]~=-1 then
								instruct_2(JY.Person[id]["防具"],1)
								--JY.Person[id]["防具"]=-1
							end
						
							if JY.Person[id]["坐骑"]~=-1 then
								instruct_2(JY.Person[id]["坐骑"],1)
								--JY.Person[id]["坐骑"]=-1
							end
						end
					end
				end 
			end  
			if JY.Base["单通"] == 0 then
				num=num*3
				--num1=num1*3
			end
			--instruct_2(174,num+m)
			-- local yl = num+m
			-- Cls()
			 -- name = "得到物品"..JY.Thing[thingid]["名称"]
			-- lib.LoadPNG(91,121*2,CC.ScreenW/1360*355,CC.ScreenH/768*373,1)
			-- tjm(CC.ScreenW/1360*425,CC.ScreenH/768*386,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
			-- ShowScreen()
			-- WaitKey()
			-- Cls()
			--instruct_2(550,num1+1)
			--instruct_2(209,num)			
		end
		r = true
		
		--战斗后获得物品（中华阁、云灏）
		if WAR.ZDDH > 0 and WAR.ZDDH ~= 226 and WAR.ZDDH ~= 354 then
			for i = 0, WAR.PersonNum -1 do
                local id = WAR.Person[i]['人物编号']
                if WAR.Person[i]['我方'] then
                    if MPTX(id,22) or match_ID(id,748) then
			            local num = math.random(30,60)
						local m = 8
			            instruct_2(174,num * m)
					end
					if match_ID(id,9965) then
                        local a = math.random(22,25)
                        local b = math.random(0,13)
                        instruct_2(a,1)
                        instruct_2(b,1)
                        break
                    end
				end 
			end 				
		end
		r = true

		--嫖主觉醒
		if WAR.JXCSPD == 1 and WAR.ZDDH == 226 then 
			say('原来你是我的执念...',0,1)
			JY.Person[0]['六如觉醒'] = 3
		end
	--战斗失败
	elseif warStatus == 2 then
		--DrawStrBoxWaitKey("战斗失败", C_WHITE, CC.DefaultFont)
		local bx,by = CC.ScreenW/1360,CC.ScreenH/768
		lib.LoadPNG(91, 2 * 2 , 295+bx*212, 295+by*33.5, 1)
		ShowScreen();
		WaitKey();
		r = false
	end
  
	War_EndPersonData(isexp, warStatus)
	lib.ShowSlow(20, 1)
	if (JY.Scene[JY.SubScene]["进门音乐"] or -1) > 0 then
		PlayMIDI(JY.Scene[JY.SubScene]["进门音乐"])
	else
		PlayMIDI(0)
	end
	CleanMemory()
	--lib.PicInit()
  
	--战斗结束，重新加载场景贴图
	--lib.PicLoadFile(CC.SMAPPicFile[1], CC.SMAPPicFile[2], 0)	--子场景贴图，内存区域0
	--lib.LoadPNGPath('./data/smap',0,-1,100)
	--lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,100))	--人物头像，内存区域1
	--lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI		
	--lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	--半身像，内存区域100
	--lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))
	--lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)	--物品贴图，内存区域2
	--lib.LoadPNGPath('./data/thing',0,-1,100)
	--lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92)
	--lib.LoadPNGPath('./data/bj',0,-1,100)
	JY.Status = GAME_SMAP
	return r
end

--山洞妹妹，布阵
function buzhen()
	if not inteam(580) then
		return 
	end
	if WAR.ZDDH == 226 then
		return 
	end
	local line = "要布置阵型吗？";
	local tiles = 2;
	if (WAR.ZDDH == 133 or WAR.ZDDH == 134) and WAR.MCRS == 1 then
		if JY.Person[0]["性别"] == 0 then
			line = "哥哥你真勇敢，一个人挑战十五大高手，请千万小心。"
		else
			line = "姐姐你真勇敢，一个人挑战十五大高手，请千万小心。"
		end
		tiles = 4
	end
	say(line, 580,0,JY.Person[580]["姓名"])
	if not DrawStrBoxYesNo(-1, -1, "要布置阵型吗？", C_WHITE, CC.DefaultFont) then
		return 
	end
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["我方"] then
			WAR.CurID = i
            WAR.ShowHead = 1
            WarDrawMap(0)
            --布阵统一为2格
            WAR.Person[WAR.CurID]["移动步数"] = tiles
			War_CalMoveStep(WAR.CurID, tiles, 0)
			local x, y = nil, nil
			while true do
				if JY.Restart == 1 then
					break
				end
				x, y = War_SelectMove()
                if x ~= nil then

                    WAR.ShowHead = 0
					War_MovePerson(x, y)
					break;
				end
			end
		end
	end
end

--无酒不欢：战前运功
function Pre_Yungong()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	if WAR.ZDDH == 226 then
		return 
	end
	if NGnum(0) == 0 then
		return 
	end
	local id, x1, y1;
	for j = 0, WAR.PersonNum - 1 do
		if WAR.Person[j]["人物编号"] == 0 then
			id, x1, y1 = j, WAR.Person[j]["坐标X"], WAR.Person[j]["坐标Y"]
			break
		end
	end
	if x1 == nil then
		return 
	end
	local s = WAR.CurID
	local pid = WAR.Person[id]['人物编号']
	local r = JYMsgBox("战前运功", "战前强行运功是有额外代价的*要继续吗？", {"否","是"}, 2, JY.Person[pid]["半身像"])
	if r == 2 then
		local menu={};
		for i=1,JY.Base["武功数量"] do
			menu[i]={JY.Wugong[JY.Person[0]["武功" .. i]]["名称"],nil,0};
			if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 6 then
				menu[i][3]=1;
			end
			--[[--天罡不能运三大
			if (jqid == 0 and JY.Base["标准"] == 6 )  and (JY.Person[0]["武功" .. i] == 106 or JY.Person[0]["武功" .. i] == 107 or JY.Person[0]["武功" .. i] == 108) then
				menu[i][3]=0;	
			end--]]
		end
		local main_neigong =  Cat('菜单',menu,#menu,bx*25,CC.ScreenH-by*60,C_WHITE,CC.FontSmall,1)
		if main_neigong ~= nil and main_neigong > 0 then
			WAR.CurID = id
			CleanWarMap(4, 0)
			SetWarMap(x1, y1, 4, 1)
			War_ShowFight(0, 0, 0, 0, 0, 0, 9)	
			--AddPersonAttrib(0, "内力", -500);
			AddPersonAttrib(0, "体力", -10);
			AddPersonAttrib(0, "生命", 500);
			AddPersonAttrib(0, "生命最大值", 500);			
			JY.Person[0]["主运内功"] = JY.Person[0]["武功" .. main_neigong]
			Hp_Max(pid)
			WAR.CurID = s
		end
	end
end

--无酒不欢：在自身位置播放动画的函数
function CurIDTXDH(id, eft, order, str, strColor, endFrame)
	--增加文字颜色控制	
	if JY.Status == GAME_WMAP then
		addbuff(WAR.Person[id]['人物编号'],WAR.PD['动画判定'],1)
		if (WAR.PD['动画判定'][WAR.Person[id]['人物编号']] or 0) > 3 then
			do return end
		end
	end			
	if strColor == nil then
		strColor = C_GOLD
	end
	--增加强制结束帧
	if endFrame == nil then
		endFrame = CC.Effect[eft]
	end
	local x0, y0 = WAR.Person[id]["坐标X"], WAR.Person[id]["坐标Y"]
	local hb = GetS(JY.SubScene, x0, y0, 4)
	local starteft = 0
	
	for i = 0, eft - 1 do
		starteft = starteft + CC.Effect[i]
	end
	if eft == 189 or eft == 190 then
		starteft = 2890
		endFrame = CC.Effect[189] + CC.Effect[190]
	end
	--local ssid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	for ii = 1, endFrame, order do --
		lib.GetKey()
		Cat('实时特效动画')
    WarDrawMap(6, 0, 0, (starteft + ii) * 2, nil, 3)
    Cat('实时特效动画2')
		if str ~= nil then
			DrawString(-1, CC.ScreenH / 2 - hb, str, strColor, CC.DefaultFont)
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		--lib.LoadSur(ssid, 0, 0)
	end
	--lib.FreeSur(ssid)
	Cls()
end

function NuoyiTXDH(id, eft, order, str, strColor, endFrame)
	--增加文字颜色控制			
	if strColor == nil then
		strColor = C_GOLD
	end
	--增加强制结束帧
	if endFrame == nil then
		endFrame = CC.Effect[eft]
	end
	local x0, y0 = WAR.Person[id]["坐标X"], WAR.Person[id]["坐标Y"]
	local hb = GetS(JY.SubScene, x0, y0, 4)
	local starteft = 0
	
	for i = 0, eft - 1 do
		starteft = starteft + CC.Effect[i]
	end
	if eft == 189 or eft == 190 then
		starteft = 2890
		endFrame = CC.Effect[189] + CC.Effect[190]
	end
	--local ssid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	for ii = 1, endFrame, order do --
		lib.GetKey()
		Cat('实时特效动画')
    WarDrawMap(6, 0, 0, (starteft + ii) * 2, nil, 3)
    Cat('实时特效动画2')
		if str ~= nil then
			DrawString(-1, CC.ScreenH / 2 - hb, str, strColor, CC.DefaultFont)
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		--lib.LoadSur(ssid, 0, 0)
	end
	--lib.FreeSur(ssid)
	Cls()
end

function WE_xy(x, y, id)
  if id ~= nil then
    War_CalMoveStep(id, 128, 0)
  else
    CleanWarMap(3, 0)
  end
  if GetWarMap(x, y, 3) ~= 255 and War_CanMoveXY(x, y, 0) then
    return x, y
  else
    for s = 1, 128 do
      for i = 1, s do
        local j = s - i
        if x + i < 63 and y + j < 63 and GetWarMap(x + i, y + j, 3) ~= 255 and War_CanMoveXY(x + i, y + j, 0) then
          return x + i, y + j
        end
        if x + j < 63 and y - i > 0 and GetWarMap(x + j, y - i, 3) ~= 255 and War_CanMoveXY(x + j, y - i, 0) then
          return x + j, y - i
        end
        if x - i > 0 and y - j > 0 and GetWarMap(x - i, y - j, 3) ~= 255 and War_CanMoveXY(x - i, y - j, 0) then
          return x - i, y - j
        end
        if x - j > 0 and y + i < 63 and GetWarMap(x - j, y + i, 3) ~= 255 and War_CanMoveXY(x - j, y + i, 0) then
          return x - j, y + i
        end
      end
    end
  end
  for s = 1, 128 do
    for i = 1, s do
      local j = s - i
      if x + i < 63 and y + j < 63 and War_CanMoveXY(x + i, y + j, 0) then
        return x + i, y + j
      end
      if x + j < 63 and y - i > 0 and War_CanMoveXY(x + j, y - i, 0) then
        return x + j, y - i
      end
      if x - i > 0 and y - j > 0 and War_CanMoveXY(x - i, y - j, 0) then
        return x - i, y - j
      end
      if x - j > 0 and y + i < 63 and War_CanMoveXY(x - j, y + i, 0) then
        return x - j, y + i
      end
    end
  end
  return x, y
end

--计算暗器伤害
function War_AnqiHurt(i, emeny, thingid)
	local pid = WAR.Person[i]['人物编号']
	local enemyid = WAR.Person[emeny]['人物编号']
	local num = nil
	local dam = nil
	local dam1 = nil
	local kd = JY.Person[enemyid]["抗毒能力"] + JY.Person[enemyid]["内力"] / 50
	local anwu = JY.Person[pid]["门派技能2"]
	local ex,ey = WAR.Person[emeny]['坐标X'],WAR.Person[emeny]['坐标Y']
    
	if JY.Person[enemyid]["受伤程度"] == 0 then
		num = JY.Thing[thingid]["加生命"] / 2 - Rnd(3)
	elseif JY.Person[enemyid]["受伤程度"] <= 33 then
		num = math.modf(JY.Thing[thingid]["加生命"] *2 / 3) - Rnd(3)
	elseif JY.Person[enemyid]["受伤程度"] <= 66 then
		num = JY.Thing[thingid]["加生命"] - Rnd(3)
	else
		num = math.modf(JY.Thing[thingid]["加生命"] *4 / 3) - Rnd(3)
    end

    num = math.modf(num - JY.Person[pid]["暗器技巧"] / 9 + JY.Person[enemyid]["暗器技巧"] / 4)
	
	num = math.abs(num)
	
    dam = num * WAR.AQBS
	
	dam = dam * (0.4+(JY.Person[enemyid]["畅想分阶"]*0.1))
	--唐门长老
	if MPTX(pid,9,3) then
		for j = 1,#CC.HD do 
			local hname = CC.HD[j].name
			if WAR.PD[hname] ~= nil then 
				if WAR.PD[hname][enemyid] ~= nil and WAR.PD[hname][enemyid] > 0 then 
					local js = math.modf((WAR.PD[hname][enemyid] or 0)/3)
					if js < 1 then js = 1 end
					WAR.PD[hname][enemyid] = (WAR.PD[hname][enemyid] or 0) - js
					if WAR.PD[hname][enemyid] < 1 then
						WAR.PD[hname][enemyid] = nil
						Cat('护盾停止',emeny)
					end
				end
			end
		end
	end
    --冰魄银针
	if AnqiWG(pid,458) and WAR.BPYZ > 0 then --(anwu == 458 or JXPD(pid,161,1))
		dam = dam + JY.Person[enemyid]["冰封程度"]*2
		if WAR.BPYZ == 1 then
			WAR.BFXS[enemyid] = 1
			AddPersonAttrib(enemyid,"冰封程度",math.modf((JY.Person[pid]["暗器技巧"]+JY.Person[pid]["用毒能力"])/20))
			WAR.PD['冰冻状态'][enemyid] = limitX((WAR.PD['冰冻状态'][enemyid] or 0) + (WAR.LQZ[pid] or 0),0,50)
			WAR.Person[emeny]["体力点数"] = (WAR.Person[emeny]["体力点数"] or 0) + AddPersonAttrib(enemyid,"体力",-math.modf((WAR.LQZ[enemyid] or 0)/5))
			dam = dam + math.modf((dam)*(WAR.PD['冰冻状态'][enemyid] or 0)*0.1)
		end
		if WAR.BPYZ == 2 then
			local a  = (WAR.LQZ[pid] or 0) + (WAR.LQZ[enemyid] or 0)
			if a > 300 then a = 300 end
			dam = dam + a
			WAR.PD['西域奇毒'][enemyid] = limitX((WAR.PD['西域奇毒'][enemyid] or 0) + 15,0,30)
			WAR.PD['混乱状态'][enemyid] = limitX((WAR.PD['混乱状态'][enemyid] or 0) + 1,0,3)
		end
		if WAR.BPYZ == 3 then
			WAR.Person[emeny]["中毒点数"] = (WAR.Person[emeny]["中毒点数"] or 0) + AddPersonAttrib(enemyid,"中毒程度",math.random(20,40))
			WAR.PD['基础蛊毒'][enemyid] = 1
			addbuff(enemyid,WAR.PD['集气速度'],-10)
			dam = dam + math.modf(JY.Person[enemyid]["中毒程度"]*2)
		end
		if WAR.BPYZ == 4 then
			dam = dam + math.modf((WAR.SPIRIT[enemyid] or 0)*3)
			WAR.PD['冰魄毒'][enemyid] = 20
			WAR.PD['利刃寒锋'][enemyid] = limitX((WAR.PD['利刃寒锋'][enemyid] or 0) + 10,0,40)
		end	
		if WAR.BPYZ1 > 0 then	
			if WAR.BPYZ1 == 2 then
				dam = dam * 1.5
				WAR.Person[emeny].TimeAdd = (WAR.Person[emeny].TimeAdd or 0) - 200
			else
				dam = dam * 1.2
			end
		end	
	end	
	
	--生死符
	if AnqiWG(pid,459) and WAR.SSFZ > 0 then
		dam = dam + JY.Person[enemyid]["冰封程度"]
		dam = dam + JY.Person[enemyid]["灼烧程度"]
		if WAR.SSFZ == 1 then
			AddPersonAttrib(enemyid,"冰封程度", math.modf(JY.Person[pid]["暗器技巧"]/10))
			AddPersonAttrib(enemyid,"灼烧程度", math.modf(JY.Person[pid]["暗器技巧"]/10))
			WAR.BFXS[enemyid] = 1
			WAR.ZSXS[enemyid] = 1
		end
		if WAR.SSFZ == 2 then
			AddPersonAttrib(enemyid,"生命", -math.modf(JY.Person[pid]["暗器技巧"]*1.2))
			AddPersonAttrib(enemyid,"内力", -math.modf(JY.Person[pid]["暗器技巧"]*2))
			AddPersonAttrib(enemyid,"体力", -50)
		end
		if WAR.SSFZ == 3 then
			WAR.PD['举火燎原'][enemyid] = 10
			WAR.PD['利刃寒锋'][enemyid] = 10
		end		
		if WAR.SSFZ1 > 0 then	
			if WAR.SSFZ1 == 2 then
				dam = dam * 1.5
			else
				dam = dam * 1.2
			end
		end	
	end	
	
	--霹雳雷火弹
	if AnqiWG(pid,450) and WAR.PLLH > 0 then
		AddPersonAttrib(enemyid,"灼烧程度", math.modf(JY.Person[pid]["暗器技巧"]/10))
		WAR.ZSXS[enemyid] = 1
		if WAR.PLLH == 1 then
			WAR.PD['烈火核'][enemyid] = 15
		end
		if WAR.PLLH == 2 then
			dam = dam + JY.Person[enemyid]["灼烧程度"]
			WAR.Person[emeny]["生命点数"] = (WAR.Person[emeny]["生命点数"] or 0) + AddPersonAttrib(enemyid,"生命",-700)
		end
		if WAR.PLLH == 3 then
			WAR.PD['恐惧状态'][enemyid] = 1
			WAR.PD['九阳反震'][enemyid] = 2
		end		
		if WAR.PLLHD > 0 then	
			if WAR.PLLHD == 2 then
				dam = dam * 1.5
			else
				dam = dam * 1.2
			end
		end	
	end	

    --透骨针
	if AnqiWG(pid,460) and WAR.TGZ > 0 then
		dam = dam + JY.Person[enemyid]["流血程度"]
		AddPersonAttrib(enemyid,"冰封程度",35)
		WAR.Person[emeny]["生命点数"] = (WAR.Person[emeny]["生命点数"] or 0) + AddPersonAttrib(enemyid,"生命",-200)	
		if WAR.TGZ == 1 then
			WAR.PD['灵蛇拳'][enemyid] = 10
			WAR.PD['透骨针1'][enemyid] = limitX((WAR.PD['透骨针1'][enemyid] or 0) + 15,0,45)
		end	
		if WAR.TGZ == 2 then
			WAR.PD['透骨针2'][enemyid] = limitX((WAR.PD['透骨针2'][enemyid] or 0) + 10,0,30)
		end 
		if WAR.TGZ == 3 then
			WAR.PD['透骨针3'][enemyid] = limitX((WAR.PD['透骨针3'][enemyid] or 0) + 15,0,45)
		end 
		if WAR.TGZ1 > 0 then	
			if WAR.TGZ1 == 2 then
				dam = dam * 1.5
			else
				dam = dam * 1.2
			end
		end	
	end 			
	--黑血神针
	if AnqiWG(pid,469) then
		WAR.PD['黑血毒'][enemyid] = limitX((WAR.PD['黑血毒'][enemyid] or 0) + 1,0,10)
		AddPersonAttrib(enemyid,"流血程度",10)
		local sm = (JY.Person[enemyid]["生命"]/JY.Person[enemyid]["生命最大值"])*50
		local hx = (WAR.PD['黑血毒'][enemyid] or 0) * 150
		dam = dam*0.8 + hx + sm * 15
		WAR.HXSZ = math.random(1,2)
		if MPTX(pid,12) then
			if WAR.PD['神教逆杀'][enemyid] == nil then
				WAR.PD['神教逆杀'][enemyid] = 5
			end
		end
		if WAR.HXSZ == 1 then
			WAR.Person[emeny]["生命点数"] = (WAR.Person[emeny]["生命点数"] or 0) + AddPersonAttrib(enemyid,"生命",-JY.Person[enemyid]["生命最大值"]*0.07)
			if JLSD(0,sm+5,pid) then
				WAR.PD['败血破命'][enemyid] = 1
			end
		end	
		if WAR.HXSZ == 2 then
			WAR.PD['脆弱状态'][enemyid] = (WAR.PD['脆弱状态'][enemyid] or 0) + 1
			if WAR.PD['脆弱状态'][enemyid] ~= nil and WAR.PD['脆弱状态'][enemyid] > 2 then
				WAR.PD['封气绝脉'][enemyid] = 1
			end
		end 
		if WAR.HXSZ1 > 0 then
			WAR.PD['回气'][pid] = (WAR.PD['回气'][pid] or 0) + 300
			if match_ID(pid,27) or match_ID(pid,777) then
				ztd(i,'集气位置',100)
			end
		end
	end
	--三蜈五蟆烟
	if AnqiWG(pid,489) then
		dam = dam + math.modf(JY.Person[pid]["用毒能力"]/1.5)
		local zt = {'冰封程度','中毒程度','灼烧程度','流血程度','封穴程度','受伤程度'}
		--local zt = {'内伤点数','中毒点数',WAR.BFXS,WAR.ZSXS,WAR.FXXS,WAR.LXXS}
	    local a = math.random(1,6)
		local gm = 0
		for j = 1,#WAR.Debuf15 do
			if j == math.random(#WAR.Debuf15) then
				local dbf = WAR.Debuf15[j][1]
				if WAR.PD[dbf][enemyid] == nil then
					WAR.PD[dbf][enemyid] = 1
				end
			end
		end
		AddPersonAttrib(enemyid,zt[a],25)
		--ztd(emeny,zt[a],150)
		if JY.Person[enemyid]["中毒程度"] >= 50 and JLSD(10,40,pid) then
			WAR.PD['头晕目眩'][enemyid] = 1
		end
		if JY.Person[enemyid]["流血程度"] >= 50 and JLSD(10,40,pid) then
			WAR.PD['集气速度'][enemyid] = (WAR.PD['集气速度'][enemyid] or 0) - 10
		end
		if JY.Person[enemyid]["受伤程度"] >= 50 and JLSD(10,40,pid) then
			WAR.PD['重度内伤'][enemyid] = (WAR.PD['重度内伤'][enemyid] or 0) + 10
		end
		if JY.Person[enemyid]["冰封程度"] >= 50 and JLSD(10,40,pid) then
			WAR.PD['冰冻状态'][enemyid] = (WAR.PD['冰冻状态'][enemyid] or 0) + 10
		end
		if JY.Person[enemyid]["灼烧程度"] >= 50 and JLSD(10,40,pid) then
			WAR.PD['混乱状态'][enemyid] = (WAR.PD['混乱状态'][enemyid] or 0) + 1
		end
		if JY.Person[enemyid]["封穴程度"] >= 30 and JLSD(10,40,pid) then
			WAR.PD['虚弱状态'][enemyid] = (WAR.PD['虚弱状态'][enemyid] or 0) + 10
		end
	end
	--金蛇锥
	if AnqiWG(pid,490) then
		local a = (math.random(5,10)/100)
		WAR.Person[emeny]["中毒点数"] = (WAR.Person[emeny]["中毒点数"] or 0) + AddPersonAttrib(enemyid,"中毒程度",math.random(20,30))
		AddPersonAttrib(enemyid,"流血程度",15)
		if JY.Person[enemyid]["中毒程度"] >= 100 then
			WAR.PD['毒击'][enemyid] = (WAR.PD['毒击'][enemyid] or 0) + 15
		end
		--
		if JY.Person[enemyid]["流血程度"] >= 100 then
			WAR.PD['创伤'][enemyid] = (WAR.PD['创伤'][enemyid] or 0) + 10
		end	
		dam = dam + math.modf(JY.Person[pid]["内力"]*a) + JY.Person[enemyid]["中毒程度"]
		dam1 = dam
		WAR.PD['金蛇幻毒'][enemyid] = (WAR.PD['金蛇幻毒'][enemyid] or 0) + math.random(3)
	end
	--细雨花
	if AnqiWG(pid,486) then
		dam = dam + WAR.SXTJ
		--ztd(i,'中毒点数',15)
		WAR.Person[emeny]["中毒点数"] = (WAR.Person[emeny]["中毒点数"] or 0) + AddPersonAttrib(enemyid,"中毒程度",15)
		if JLSD(10,30,pid) then
			WAR.PD['夜雨绵延'][enemyid] = limitX((WAR.PD['夜雨绵延'][enemyid] or 0) +1,0,999)
		end	
	end
	local qgcj = math.modf(psx(pid,'轻功')-psx(enemyid,'轻功'))
	if qgcj < 0 then qgcj = 0 end
	if AnqiWG(pid,486) and JLSD(10,30+qgcj,pid) then 
	else
	    Cat('挪移闪避',0)
		Cat('区域免疫',0)
	end	

    --闪避不受伤害
    if WAR.Miss[enemyid] == 1 then 
		if dam1 ~= nil and math.random(10) > 5 then
			dam1 = math.modf(dam1*0.3)
		else
		    return 0
		end
	end
    
	
	if WAR.QYBY[enemyid] ~= nil or WAR.JBMY[enemyid] ~= nil or WAR.MHBF[enemyid] ~= nil or WAR.YSHJ[enemyid] ~= nil
	    or WAR.PD['怒涛剑气'][enemyid] ~= nil or (WAR.PD['天魔金身'][enemyid] ~= nil and WAR.PD['天魔金身'][enemyid] > 50) 
		or WAR.PD['阴阳二气'][enemyid] ~= nil or WAR.PD['九阳护盾'][enemyid] ~= nil or WAR.PD['长生真气'][enemyid] ~= nil
		or WAR.PD['先天太极'] or WAR.PD["先天护盾"][enemyid] ~= nil or WAR.PD['倾国倾城'] ~= nil or WAR.PD['神足乾坤'] ~= nil then
		dam = math.modf(dam*0.5)
	end	
	--独孤九剑反击
	if WAR.HFXZ[pid] ~= nil then
        dam = 200 + math.modf((TrueYJ(pid) / 3) + JY.Person[pid]["内力"] / 50) 
    end	
	
	--古墓反击
	if WAR.YFZ[pid] ~= nil then
        dam = 200 + math.modf(JY.Person[pid]["暗器技巧"]*2/ math.random(2,4)) 
    end	
	
	--车神
	if WAR.CSFJ[pid] ~= nil then
        dam = 200 + math.modf((TrueYJ(pid) / 3) + (TrueQZ(pid) / 3) / 50) 
    end	
	
	--唐门反击
	if WAR.TMFJ[pid] ~= nil then
        dam = 200 + math.modf(JY.Person[pid]["暗器技巧"] * 2 / math.random(3)) 
    end		
	
	--真龙反击
	if WAR.CLFJ[pid] ~= nil then
		dam = math.modf((Atk(i) + Def(i) + Qg(i))/4) 
    end	
	
	--九命猫
	if WAR.LMWZ[pid] ~= nil then
		dam = 100 + math.modf((JY.Person[pid]["暗器技巧"]+JY.Person[pid]["特殊兵器"])*math.random(1,9)) 
    end	
	
	--葵花反击
	if WAR.KHFJ[pid] ~= nil then
		dam = 200 + math.modf((JY.Person[pid]["暗器技巧"]+JY.Person[pid]["特殊兵器"])/math.random(1,3))
    end
	
	--护龙山庄反击
	if WAR.HLFJ[pid] ~= nil then
		dam = 200 + math.modf((JY.Person[pid]["暗器技巧"]+JY.Person[pid]["特殊兵器"])/math.random(2,4))
	end 	
	
	--兽王庄反击
	if WAR.SWFJ[pid] ~= nil then
		dam = 200 + math.modf((JY.Person[pid]["暗器技巧"]+JY.Person[pid]["耍刀技巧"]+JY.Person[pid]["拳掌功夫"])/math.random(2,4))
	end 	
	
	--五毒反击
	if WAR.WDFJ[pid] ~= nil then
		dam = 200 + math.modf((JY.Person[pid]["暗器技巧"]+JY.Person[pid]["特殊兵器"])/math.random(2,5))
	end 	
	
	if WAR.PD['潜影突袭'][pid] ~= nil then
		dam = dam * 2
	end	
	
	dam = math.modf(dam)	--标记修改
	
	
	--先天罡气
	if WAR.PD["先天护盾"][enemyid] ~=nil and WAR.PD["先天护盾"][enemyid] > 0 and dam > 0 then
      if dam < WAR.PD["先天护盾"][enemyid] then	 
          WAR.PD["先天护盾"][enemyid] = WAR.PD["先天护盾"][enemyid] - dam
          dam = 0
      else
          dam = dam - WAR.PD["先天护盾"][enemyid]
          WAR.PD["先天护盾"][enemyid] = nil
          Cat('护盾停止',emeny)
		end
	end
	--奇门护盾
	if WAR.PD['奇门五转'][enemyid] ~= nil and WAR.PD['奇门五转'][enemyid] > 0 and dam > 0 then
		local qm = 3000 - (WAR.PD['奇门五转'][enemyid] or 0)
		dam = math.modf(dam * (qm / 3000))
	end
	--金刚护盾
	if WAR.PD["金刚护盾"][enemyid] ~=nil and WAR.PD["金刚护盾"][enemyid] > 0 and dam > 0  then
		if dam < WAR.PD["金刚护盾"][enemyid] then
			WAR.PD["金刚护盾"][enemyid] = WAR.PD["金刚护盾"][enemyid] - dam
			addbuff(enemyid,WAR.PD['金刚手'],dam)
			dam = 0
		else
		    dam = dam - WAR.PD["金刚护盾"][enemyid]
			addbuff(enemyid,WAR.PD['金刚手'],WAR.PD['金刚护盾'][enemyid])
			WAR.PD["金刚护盾"][enemyid] = nil
			Cat('护盾停止',emeny)
		end	 	
	end
	
	--神足护盾	标记修改
	if WAR.PD["神足护盾"][enemyid] ~= nil and WAR.PD["神足护盾"][enemyid] > 0 and dam > 0  then
        if dam < WAR.PD["神足护盾"][enemyid] then	 
            WAR.PD["神足护盾"][enemyid] = WAR.PD["神足护盾"][enemyid] - dam
            dam = 0
        else
            dam = dam - WAR.PD["神足护盾"][enemyid]
            WAR.PD["神足护盾"][enemyid] = nil
			Cat('护盾停止',emeny)
        end
    end

    --吸星真气
    if WAR.PD['吸星真气'][enemyid] ~= nil and dam > 0  then 
		if JY.Person[enemyid]["内力"] > JY.Person[enemyid]["内力"] / 2 then
			dam = dam - JY.Person[enemyid]["内力"]
			AddPersonAttrib(enemyid,"内力",-math.modf(dam/4))
			if dam < 0 then
				dam = 0
			end
			if JY.Person[enemyid]["内力"] < 2000 then
				JY.Person[enemyid]["内力"] = 2000
			end
        else
            dam = dam - WAR.PD["吸星真气"][enemyid]  
			WAR.PD["吸星真气"][enemyid] = WAR.PD["吸星真气"][enemyid] - dam
			AddPersonAttrib(enemyid,"内力",math.modf(dam/2))
			if WAR.PD["吸星真气"][enemyid] < 0 then
				WAR.PD["吸星真气"][enemyid] = nil
				Cat('护盾停止',emeny)
			end
        end
    end
	if dam1 ~= nil and dam1 > (dam or 0) then
		dam = dam1
		dam1 = nil
	end
	if dam == nil or dam == 0 then
        return 0
    end
	if WAR.PD['华佗'][enemyid] == 1 and dam > JY.Person[enemyid]["生命"] then
		if WAR.PD["神足护盾"][enemyid] == nil then
			WAR.PD["神足护盾"][enemyid] = 500
		end
		WAR.PD['华佗'][enemyid] = nil
		return 0
	end
    --霸体不受伤害
    if WAR.BTZT[enemyid] ~= nil then
        return 0
    end
    --文泰来不受伤害
    if WAR.WTL_PJTL[enemyid] ~= nil then
        return 0
	end
	if WAR.PD['九命猫'][enemyid] ~= nil then
		return 0
	end
	if WAR.PD["亦复如是"][enemyid] == 1 then
		return 0
    end
    if WAR.PD['六阳正气'][enemyid] ~= nil then 
        kd = kd + WAR.PD['六阳正气'][enemyid]
    end
	if WAR.PD['易水寒冰'][enemyid] ~= nil then
		return 0
	end

    if myns(emeny) == false then
	    WAR.Person[emeny]["内伤点数"] = AddPersonAttrib(enemyid, "受伤程度", math.modf(-num / 6))
    end
	
	
	local r = 0

	if GetWarMap(ex,ey,2) > 0 or GetWarMap(ex,ey,5) > 0 then
		r = AddPersonAttrib(enemyid, "生命", -math.modf(dam))
	end	
	
	
	
	--fuhuo(emeny,1)
	fuhuo1(emeny)
	if JY.Person[enemyid]["生命"] <= 0 then
		JY.Person[enemyid]["生命"] = 0
		WAR.Person[WAR.CurID]["经验"] = WAR.Person[WAR.CurID]["经验"] + JY.Person[enemyid]["等级"] * 5
		WAR.Person[emeny]["反击武功"] = -1		--如果被打死则不会触发反击
		if WAR.SZSD == enemyid then						--取消死战标记
			WAR.SZSD = -1
		end
		--判断是否可以加实战
		if JY.Person[enemyid]["生命"] <= 0 and inteam(pid) and WAR.SZJPYX[enemyid] == nil and JY.Person[pid]["实战"] < 1000 and JY.Person[pid]["门派技能2"] > 0 then --一剑 500改为1000
			--崆峒派战斗、高升客栈杀欧阳克、家里练功房、全真教练功、青城派练功、少林练功   不加实战
			local wxzd = {17, 67, 226, 220, 224, 219, 79}
			local wx = 0
			for i = 1, 7 do
				if WAR.ZDDH == wxzd[i] then
					wx = 1
				end
			end
			
			--丐帮门口
			if WAR.ZDDH == 82 and GetS(10, 0, 18, 0) == 1 then
				wx = 1
			end
			--木人巷
			if WAR.ZDDH == 214 and GetS(10, 0, 19, 0) == 1 then
				wx = 1
			end
			
			--如果可加实战
			if wx == 0 and isteam(pid) then
				local szexp = 1
				if enemyid < 191 and 0 < enemyid then
					szexp = WARSZJY[enemyid]
					szexp = szexp - 2
					if szexp < 0 then 
						szexp = 1 
					end 
				end
				AddPersonAttrib(pid,'实战',szexp)
				WAR.SZJPYX[enemyid] = 1
			end
		elseif CC.PTF[pid][9919] ~= nil and (JY.Person[pid]["实战"] or 0) ~= nil and JY.Person[pid]["实战"] < 9999 then --一剑 万恶罪魁实战上限9999，打架加实战
		CC.PersonAttribMax["实战"] = 9999
			--崆峒派战斗、高升客栈杀欧阳克、家里练功房、全真教练功、青城派练功、少林练功   不加实战
		local wxzd = {17, 67, 226, 220, 224, 219, 79}
		local wx = 0
		for i = 1, 7 do
			if WAR.ZDDH == wxzd[i] then
				wx = 1
			end
		end
		--丐帮门口
		if WAR.ZDDH == 82 and GetS(10, 0, 18, 0) == 1 then
			wx = 1
		end
		--木人巷
		if WAR.ZDDH == 214 and GetS(10, 0, 19, 0) == 1 then
			wx = 1
		end
		--如果可加实战
		if wx == 0 and isteam(pid) then
			local szexp = 1
			--if eid < 191 and 0 < eid then
				--szexp = WARSZJY[eid]
				--szexp = szexp - 2
				if szexp < 0 then 
					szexp = 1 
				end 
			--end
			if JY.Person[pid]["实战"] > 1000 then		
			AddPersonAttrib(pid,'实战',szexp*10)
			else
			AddPersonAttrib(pid,'实战',szexp)
			WAR.SZJPYX[eid] = 1
		end
	end
	end	
		
		--平一指杀人
		if (match_ID(pid, 28) or match_ID(pid, 9889)) and JY.Person[pid]["门派技能2"] > 0 then
			WAR.PYZ = WAR.PYZ + 1
			if 10 < WAR.PYZ then
				WAR.PYZ = 10
			end
		end
		
		--阿紫杀人
		if (match_ID(pid, 47) or match_ID(pid, 9886)) and JY.Person[pid]["门派技能2"] > 0 then
			WAR.MZSH = WAR.MZSH + 1
		end
		--血战沙场
		if WGZH(pid,198,200) and JY.Person[pid]["门派技能2"] > 0 then
			WAR.XZSC = WAR.XZSC + 1
		end
		--李白杀人
		if match_ID(pid, 636) and JY.Person[pid]["门派技能2"] > 0 then
			WAR.SBSYR = 1
		end
		   
		--无酒不欢：袁承志碧血长风
		--限主角
		if match_ID(pid, 54) and JY.Person[pid]["门派技能2"] > 0 then
			WAR.BXCF = 1
		end

		--实力升级
		if inteam(pid) and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[emeny]['我方'] and JY.Person[pid]["门派技能2"] > 0 and JY.Person[enemyid]["生命"] <= 0 then 
			local nd = JY.Base["难度"]
			local zm = limitX(JY.Base["周目"],1,125)
	 	 	local xs = 0
	 	 	local wc = 0
			local eid = enemyid
			--npc随周目增加自身强度
			if nd > 1 then 
				local fd = nd + ((nd-1)*0.33)
				xs = math.modf(zm*fd)
				wc = math.modf(zm*fd)
			end
			local can_nei = {}
			local neilist = {}
			for nei = 0, JY.WugongNum -1 do
				if JY.Wugong[nei]['武功类型'] == 6 and nei ~= 43 and nei ~= 166 and nei ~= 169 and nei ~= 172 and nei ~= 212 and nei ~= 213 and nei ~= 214 and nei ~= 218
				and nei ~= 235 and nei ~= 281 and nei ~= 282 and nei ~= 301 and nei ~= 354 and nei ~= 359 and nei ~= 365 and nei ~= 366 and nei ~= 373 and nei ~= 378 and nei ~= 379 
				and nei ~= 381 then
					neilist[#neilist+1] = nei
				end
			end
			while JY.Person[pid]["畅想分阶"] > JY.Person[eid]["畅想分阶"] do
				JY.Person[pid]["畅想分阶"] = JY.Person[pid]["畅想分阶"] - 1	
				if pid == 0 and JY.Person[456]["论剑奖励"] ~= 1 then 
					for p = 0, JY.PersonNum-1 do
						if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 and p ~= 739 and p ~= 740 and JY.Person[p]['畅想分阶'] <= JY.Person[0]['畅想分阶'] then
							if nd >= 3 and zm == 500 and JY.Person[p]["畅想分阶"] <= 3 then
								xs = xs + nd * math.modf(zm*2)
								wc = wc + nd * math.modf(zm*2)
							end
							xs = math.modf(xs/7*2)
							wc = math.modf(wc/7*2)
							JY.Person[p]["拳掌功夫"] = JY.Person[p]["拳掌功夫"] + xs
							JY.Person[p]["指法技巧"] = JY.Person[p]["指法技巧"] + xs
							JY.Person[p]["御剑能力"] = JY.Person[p]["御剑能力"] + xs
							JY.Person[p]["耍刀技巧"] = JY.Person[p]["耍刀技巧"] + xs
							JY.Person[p]["特殊兵器"] = JY.Person[p]["特殊兵器"] + xs
							JY.Person[p]["武学常识"] = JY.Person[p]["武学常识"] + wc
							JY.Person[p]['实战'] = JY.Person[p]['实战'] + 50
							AddPersonAttrib(p,'生命',math.huge)
							local tt = math.modf(JY.Base['周目']*(7-JY.Person[pid]["畅想分阶"]))
							JY.Person[p]["攻击力"] = JY.Person[p]["攻击力"] + tt
							JY.Person[p]["防御力"] = JY.Person[p]["防御力"] + tt
							JY.Person[p]["轻功"] = JY.Person[p]["轻功"] + tt
						end
					end
					--CC.TX['敌人渐进增强'] = math.modf(CC.TX['敌人渐进增强']*(1+(zm/550)))			
				end
				if pid == 0 then
					--say('内功加强开始',0,1)	
					for p = 0, JY.PersonNum-1 do
						if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 and p ~= 739 and p ~= 740 then
							for k = 1 , #neilist do
								local pd = false
								for j = 1,JY.Base['武功数量'] do
									if neilist[k] == JY.Person[p]['武功'..j] then
										pd = true
									end
								end
								if pd == false then
									can_nei[#can_nei+1] = neilist[k]
								end
							end
							if can_nei ~= nil and #can_nei > 0 then
								local wg = can_nei[math.random(#can_nei)]
								can_nei = {}
								for l = 1, JY.Base['武功数量'] do
									if JY.Person[p]['武功'..l] == 0 then
										JY.Person[p]['武功'..l] = wg
										JY.Person[p]['武功等级'..l] = 999
										break
									end
								end	
							end					
						end
					end
				end
				if JY.Person[pid]["畅想分阶"] == 6 then
					--CC.TX["弟子"] = 1
					AddPersonAttrib(pid, "攻击力",10)
					AddPersonAttrib(pid, "防御力",10)
					AddPersonAttrib(pid, "轻功",10)
					--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)
				end
				if JY.Person[pid]["畅想分阶"] == 5 then
					--CC.TX["三流"] = 1
					AddPersonAttrib(pid, "拳掌功夫",10)
					AddPersonAttrib(pid, "指法技巧",10)
					AddPersonAttrib(pid, "御剑能力",10)
					AddPersonAttrib(pid, "耍刀技巧",10)
					AddPersonAttrib(pid, "特殊兵器",10)
					--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
				end
				if JY.Person[pid]["畅想分阶"] == 4 then
					--CC.TX["二流"] = 1
					AddPersonAttrib(pid, "攻击力", 20)
					AddPersonAttrib(pid, "防御力", 20)
					AddPersonAttrib(pid, "轻功", 20)
					--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
				end
				if JY.Person[pid]["畅想分阶"] == 3 then
					--CC.TX["一流"] = 1
					AddPersonAttrib(pid, "拳掌功夫", 20)
					AddPersonAttrib(pid, "指法技巧", 20)
					AddPersonAttrib(pid, "御剑能力", 20)
					AddPersonAttrib(pid, "耍刀技巧", 20)
					AddPersonAttrib(pid, "特殊兵器", 20)
					--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
				end
				if JY.Person[pid]["畅想分阶"] == 2 then
					--CC.TX["豪侠"] = 1
					AddPersonAttrib(pid, "攻击力",30)
					AddPersonAttrib(pid, "防御力", 30)
					AddPersonAttrib(pid, "轻功", 30)
					if pid ~= 0 and inteam(pid)  then
						SetJX(pid,1)
					end	
					--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
				end
				if JY.Person[pid]["畅想分阶"] == 1 then
					--CC.TX["宗师"] = 1
					AddPersonAttrib(pid, "拳掌功夫",30)
					AddPersonAttrib(pid, "指法技巧",30)
					AddPersonAttrib(pid, "御剑能力",30)
					AddPersonAttrib(pid, "耍刀技巧",30)
					AddPersonAttrib(pid, "特殊兵器",30)
					if pid ~= 0 and inteam(pid)  then
					 	SetJX(pid,1)
					end
					--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
				end
				if JY.Person[pid]["畅想分阶"] == 0 then
					--CC.TX["传说"] = 1
					AddPersonAttrib(pid, "武学常识",100)
					if pid ~= 0 and inteam(pid)  then
					 	SetJX(pid,1)
					end
					--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
				end
			end					   
		end
	end
   --夜雨楼杀人
	if JY.Person[525]['论剑奖励'] > 0 and pid == 0 and JY.Person[enemyid]["生命"] <= 0 and inteam(enemyid) == false then
		if MPPD(pid) == 24 then
			if JY.Person[525]['论剑奖励'] == 1 and JY.Person[enemyid]['畅想分阶'] <= 5 then
				CC.TX['夜雨暗杀1']= CC.TX['夜雨暗杀1']+1
			end
			if JY.Person[525]['论剑奖励'] == 2 and JY.Person[enemyid]['畅想分阶'] <= 2 then
				CC.TX['夜雨暗杀2']= CC.TX['夜雨暗杀2']+1
			end	
			if JY.Person[525]['论剑奖励'] > 2  then
				if enemyid == JY.Person[525]['论剑奖励']	then
					CC.TX['夜雨暗杀3'] = enemyid
				elseif JY.Person[enemyid]['姓名'] == JY.Person[JY.Person[525]['论剑奖励']]['姓名'] then
					CC.TX['夜雨暗杀3'] = enemyid
				end	
			end		
		else
			if JY.Person[525]['论剑奖励'] == 1 and JY.Person[enemyid]['畅想分阶'] <= 5 then
				CC.TX['夜雨暗杀1']= CC.TX['夜雨暗杀1']+1
			end
			if JY.Person[525]['论剑奖励'] == 2 and JY.Person[enemyid]['畅想分阶'] <= 2 then
				CC.TX['夜雨暗杀2']= CC.TX['夜雨暗杀2']+1
			end	
			if JY.Person[525]['论剑奖励'] > 2  then
				if enemyid == JY.Person[525]['论剑奖励']	then
					CC.TX['夜雨暗杀3'] = enemyid
				elseif JY.Person[enemyid]['姓名'] == JY.Person[JY.Person[525]['论剑奖励']]['姓名'] then
					CC.TX['夜雨暗杀3'] = enemyid
				end	
			end
		end
	end
	
	if JY.Thing[thingid]["加中毒解毒"] > 0 and myzd(emeny) == false then
		local num = math.modf(JY.Thing[thingid]["加中毒解毒"] + JY.Person[pid]["暗器技巧"] / 4)
		num = num - kd
		num = limitX(num, 0, CC.PersonAttribMax["用毒能力"])
		WAR.Person[emeny]["中毒点数"] = AddPersonAttrib(enemyid, "中毒程度", num)
	end
    
	--沉睡状态的敌人会醒来
	if WAR.PD["沉睡状态"][enemyid] ~= nil then
	    WAR.PD["沉睡状态"][enemyid] = nil
    end
    WAR.TXXS[enemyid] = 1
    --Cat('数值显示')
	return r
end

--计算从(x,y)开始攻击最多能够击中几个敌人
function War_AutoCalMaxEnemy(x, y, wugongid, level)
  local wugongtype = JY.Wugong[wugongid]["攻击范围"]
  local movescope = JY.Wugong[wugongid]["移动范围" .. level]
  local fightscope = JY.Wugong[wugongid]["杀伤范围" .. level]
  local maxnum = 0
  local xmax, ymax = nil, nil
  	if wugongtype == 0 or wugongtype == 3 then
    	local movestep = War_CalMoveStep(WAR.CurID, movescope, 1)	--计算武功移动步数
    	for i = 1, movescope do
      		local step_num = movestep[i].num
      		if step_num == 0 then
        		break;
      		end
      		for j = 1, step_num do
        		local xx = movestep[i].x[j]
        		local yy = movestep[i].y[j]
        		local enemynum = 0
        		for n = 0, WAR.PersonNum - 1 do
          			if n ~= WAR.CurID and WAR.Person[n]["死亡"] == false and WAR.Person[n]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
            			local x = math.abs(WAR.Person[n]["坐标X"] - xx)
            			local y = math.abs(WAR.Person[n]["坐标Y"] - yy)
          			end
          			if x <= fightscope and y <= fightscope then
            			enemynum = enemynum + 1
          			end
        		end
       			if maxnum < enemynum then
          			maxnum = enemynum
          			xmax = xx
          			ymax = yy
        		end
    		end
    	end
  	elseif wugongtype == 1 then
    	for direct = 0, 3 do
      	local enemynum = 0
      		for i = 1, movescope do
        		local xnew = x + CC.DirectX[direct + 1] * i
        		local ynew = y + CC.DirectY[direct + 1] * i
        			if xnew >= 0 and xnew < CC.WarWidth and ynew >= 0 and ynew < CC.WarHeight then
          				local id = GetWarMap(xnew, ynew, 2)
        			end
        			if id >= 0 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[id]["我方"] then
          				enemynum = enemynum + 1
        			end
      			end
      		if maxnum < enemynum then
       			maxnum = enemynum
        		xmax = x + CC.DirectX[direct + 1]
        		ymax = y + CC.DirectY[direct + 1]
      		end
    	end
  	elseif wugongtype == 2 then
    	local enemynum = 0
    	for direct = 0, 3 do
      		for i = 1, movescope do
        		local xnew = x + CC.DirectX[direct + 1] * i
        		local ynew = y + CC.DirectY[direct + 1] * i
        		if xnew >= 0 and xnew < CC.WarWidth and ynew >= 0 and ynew < CC.WarHeight then
          			local id = GetWarMap(xnew, ynew, 2)
        		end
        		if id >= 0 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[id]["我方"] then
          			enemynum = enemynum + 1
        		end
      		end
    	end
  	end
  	if enemynum > 0 then
    	maxnum = enemynum
    	xmax = x
    	ymax = y
  	end
  	return maxnum, xmax, ymax
end


--得到可以走到攻击到敌人的最近位置。
--scope可以攻击的范围
--返回 x,y。如果无法走到攻击位置，返回空
function War_AutoCalMaxEnemyMap(wugongid, level)
  local wugongtype = JY.Wugong[wugongid]["攻击范围"]
  local movescope = JY.Wugong[wugongid]["移动范围" .. level]
  local fightscope = JY.Wugong[wugongid]["杀伤范围" .. level]
  local x0 = WAR.Person[WAR.CurID]["坐标X"]
  local y0 = WAR.Person[WAR.CurID]["坐标Y"]
  CleanWarMap(4, 0)
  if wugongtype == 0 or wugongtype == 3 then
    for n = 0, WAR.PersonNum - 1 do
      if n ~= WAR.CurID and WAR.Person[n]["死亡"] == false and WAR.Person[n]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
        local xx = WAR.Person[n]["坐标X"]
        local yy = WAR.Person[n]["坐标Y"]
        local movestep = War_CalMoveStep(n, movescope, 1)
        for i = 1, movescope do
          local step_num = movestep[i].num
	        if step_num == 0 then
	          
	        else
	          for j = 1, step_num do
	            SetWarMap(movestep[i].x[j], movestep[i].y[j], 4, 1)
	          end
	        end
	      end
      end
    end
  elseif wugongtype == 1 or wugongtype == 2 then
    for n = 0, WAR.PersonNum - 1 do
      if n ~= WAR.CurID and WAR.Person[n]["死亡"] == false and WAR.Person[n]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
        local xx = WAR.Person[n]["坐标X"]
        local yy = WAR.Person[n]["坐标Y"]
        for direct = 0, 3 do
          for i = 1, movescope do
            local xnew = xx + CC.DirectX[direct + 1] * i
            local ynew = yy + CC.DirectY[direct + 1] * i
            if xnew >= 0 and xnew < CC.WarWidth and ynew >= 0 and ynew < CC.WarHeight then
              local v = GetWarMap(xnew, ynew, 4)
              SetWarMap(xnew, ynew, 4, v + 1)
            end
          end
        end
      end
    end
  end
end

--自动医疗
function War_AutoDoctor()
  local x1 = WAR.Person[WAR.CurID]["坐标X"]
  local y1 = WAR.Person[WAR.CurID]["坐标Y"]
  War_ExecuteMenu_Sub(x1, y1, 3, -1)
end

--自动吃药
--flag=2 生命，3内力；4体力  6 解毒
function War_AutoEatDrug(flag)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local life = JY.Person[pid]["生命"]
	local maxlife = JY.Person[pid]["生命最大值"]
	local selectid = nil
	local minvalue = math.huge
	local shouldadd, maxattrib, str = nil, nil, nil
	if flag == 2 then
		maxattrib = JY.Person[pid]["生命最大值"]
		shouldadd = maxattrib - JY.Person[pid]["生命"]
		str = "加生命"
		
	elseif flag == 3 then
		maxattrib = JY.Person[pid]["内力最大值"]
		shouldadd = maxattrib - JY.Person[pid]["内力"]
		str = "加内力"
		
	elseif flag == 4 then
		maxattrib = CC.PersonAttribMax["体力"]
		shouldadd = maxattrib - JY.Person[pid]["体力"]
		str = "加体力"
		
	elseif flag == 6 then
		maxattrib = CC.PersonAttribMax["中毒程度"]
		shouldadd = JY.Person[pid]["中毒程度"]
		str = "加中毒解毒"
		
	else
		return 
	end
	local function Get_Add(thingid)
		if flag == 6 then
		  return -JY.Thing[thingid][str] / 2
		else
		  return JY.Thing[thingid][str]
		end
	end
  
	--在队
	if isteam(pid) and WAR.Person[WAR.CurID]["我方"] == true then
		local extra = 0
		for i = 1, CC.MyThingNum do
			local thingid = JY.Base["物品" .. i]
			if thingid >= 0 then
				local add = Get_Add(thingid)
				if JY.Thing[thingid]["类型"] == 3 and add > 0 then
					local v = shouldadd - add
					if v < 0 then
						extra = 1
					elseif v < minvalue then
						minvalue = v
						selectid = thingid
					end
				end
			end
		end
		if extra == 1 then
			minvalue = math.huge
			for i = 1, CC.MyThingNum do
				local thingid = JY.Base["物品" .. i]
				if thingid >= 0 then
					local add = Get_Add(thingid)
					if JY.Thing[thingid]["类型"] == 3 and add > 0 then
						local v = add - shouldadd
						if v >= 0 and v < minvalue then
							minvalue = v
							selectid = thingid
						end
					end
				end
			end
		end
		--使用物品
		if UseThingEffect(selectid, pid) == 1 then
			instruct_32(selectid, -1)
			
		end
	--不在队
	else
		local extra = 0
		for i = 1, 4 do
			local thingid = JY.Person[pid]["携带物品" .. i]
			local tids = JY.Person[pid]["携带物品数量" .. i]
			if thingid >= 0 and tids > 0 then
				local add = Get_Add(thingid)
				if JY.Thing[thingid]["类型"] == 3 and add > 0 then
					local v = shouldadd - add
					if v < 0 then		--可以加满生命, 用其他方法找合适药品
						extra = 1
					elseif v < minvalue then
						minvalue = v
						selectid = thingid
					end
				end
			end
		end
		if extra == 1 then
			minvalue = math.huge
			for i = 1, 4 do
				local thingid = JY.Person[pid]["携带物品" .. i]
				local tids = JY.Person[pid]["携带物品数量" .. i]
				if thingid >= 0 and tids > 0 then
					local add = Get_Add(thingid)
					if JY.Thing[thingid]["类型"] == 3 and add > 0 then
						local v = add - shouldadd
						if v >= 0 and v < minvalue then
							minvalue = v
							selectid = thingid
						end
					end
				end 
			end
		end
		--NPC使用物品
		if UseThingEffect(selectid, pid) == 1 then
			instruct_41(pid, selectid, -1)
		end
	end
	--lib.Delay(500)
end

--自动逃跑
function War_AutoEscape()
  local pid = WAR.Person[WAR.CurID]["人物编号"]
  if JY.Person[pid]["体力"] <= 5 then
    return 
  end
  local x, y = nil, nil
  War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)		 --计算移动步数
  Cat('实时特效动画')
  WarDrawMap(1)
  Cat('实时特效动画2')
  ShowScreen()
  lib.Delay(CC.BattleDelay)
  local array = {}
  local num = 0
  
  for i = 0, CC.WarWidth - 1 do
    for j = 0, CC.WarHeight - 1 do
      if GetWarMap(i, j, 3) < 128 then
        local minDest = math.huge
        for k = 0, WAR.PersonNum - 1 do
          if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[k]["我方"] and WAR.Person[k]["死亡"] == false then
            local dx = math.abs(i - WAR.Person[k]["坐标X"])
            local dy = math.abs(j - WAR.Person[k]["坐标Y"])
	          if dx + dy < minDest then		--计算当前距离敌人最近的位置
	            minDest = dx + dy
	          end
          end
        end
        num = num + 1
        array[num] = {}
        array[num].x = i
        array[num].y = j
        array[num].p = minDest
      end
    end
  end
  
  for i = 1, num - 1 do
    for j = i, num do
      if array[i].p < array[j].p then
        array[i], array[j] = array[j], array[i]
      end
    end
  end
  for i = 2, num do
    if array[i].p < array[1].p / 2 then
      num = i - 1
      break;
    end
  end
  for i = 1, num do
    array[i].p = array[i].p * 5 + GetMovePoint(array[i].x, array[i].y, 1)
  end
  for i = 1, num - 1 do
    for j = i, num do
      if array[i].p < array[j].p then
        array[i], array[j] = array[j], array[i]
      end
    end
  end
  x = array[1].x
  y = array[1].y

  War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
  War_MovePerson(x, y)	--移动到相应的位置
end

--木凭 顾怜影特殊AI（神游太虚优势AI），暂时不用
function War_AutoGLY()
  local x, y = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
  War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)		 --计算移动步数
  Cat('实时特效动画')
  WarDrawMap(1)
  Cat('实时特效动画2')
  ShowScreen()
  lib.Delay(CC.BattleDelay)
  local map_g = {}                              --存储地图上每个点的优先值，该值代表是否优先移动到该位置
  for i = 0, CC.WarWidth - 1 do
    map_g[i] = {}
  end
  local obstacle = {}                           --存储地图上所有障碍物的坐标
  for i = 0, CC.WarWidth - 1 do
    obstacle[i] = {}
  end
  local num = 0
  for i = 0, CC.WarWidth - 1 do
    for j = 0, CC.WarHeight - 1 do
      if GetWarMap(i, j, 3) < 128 then
        if War_CanMoveXY(i, j, 0) then
          obstacle[i][j] = 1
        else
          obstacle[i][j] = 0
        end
      end
    end
  end
  local maxG = 0
  for i = 0, CC.WarWidth - 1 do
    for j = 0, CC.WarHeight - 1 do
      if GetWarMap(i, j, 3) < 128 then
        if obstacle[i][j] > 0 then
          local minLenX = math.huge
          for k = 0, num - 1 do
            if obstacle[k][j] == 0 then
              minLenX = math.abs(k - i)
            end
          end
          local minLenY = math.huge
          for k = 0, num - 1 do
            if obstacle[i][k] == 0 then
              minLenY = math.abs(k - j)
            end
          end
          map_g[i][j] = math.abs(minLenX - minLenY)
          if maxG < map_g[i][j] then
            maxG = map_g[i][j]
            x = i
            y = j
          end
        end
      end
    end
  end

  --[====[
  local loc_1 = {}
  loc_1.x = 0
  loc_1.y = (CC.WarHeight - 1) / 2
  local loc_2 = {}
  loc_2.x = (CC.WarWidth - 1) / 2
  loc_2.y = 0
  local loc_3 = {}
  loc_3.x = CC.WarWidth - 1
  loc_3.y = (CC.WarHeight - 1) / 2
  local loc_4 = {}
  loc_4.x = (CC.WarWidth - 1) / 2
  loc_4.y = CC.WarHeight - 1
  local loc_point = { loc_1, loc_2, loc_3, loc_4 }
  for i = 0, 3 do
    local minDest = math.huge
    local minIndex = 0
    local dx = math.abs(loc_point[i].x - WAR.Person[WAR.CurID]["坐标X"])
    local dy = math.abs(loc_point[i].y - WAR.Person[WAR.CurID]["坐标Y"])
    if dx + dy < minDest then		--计算当前距离敌人最近的位置
      minDest = dx + dy
      minIndex = i
    end
  end
  x = loc_point[minIndex].x
  y = loc_point[minIndex].y
  ]====]

  War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
  War_MovePerson(x, y)	--移动到相应的位置
end

--自动执行战斗，此时的位置一定可以打到敌人
function War_AutoExecuteFight(wugongnum)
  local pid = WAR.Person[WAR.CurID]["人物编号"]
  local x0 = WAR.Person[WAR.CurID]["坐标X"]
  local y0 = WAR.Person[WAR.CurID]["坐标Y"]
  local wugongid = JY.Person[pid]["武功" .. wugongnum]
  local level = math.modf(JY.Person[pid]["武功等级" .. wugongnum] / 100) + 1
  local maxnum, x, y = War_AutoCalMaxEnemy(x0, y0, wugongid, level)
  if x ~= nil then
    War_Fight_Sub(WAR.CurID, wugongnum, x, y)
    WAR.Person[WAR.CurID].Action = {"atk", x - WAR.Person[WAR.CurID]["坐标X"], y - WAR.Person[WAR.CurID]["坐标Y"]}
  end
end

--自动战斗
function War_AutoMenu()
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	WAR.AutoFight = 1
	WAR.ShowHead = 0
	Cls()
	if JY.Person[pid]["禁用自动"] == 1 then
		return 0
	else
		War_Auto()
		return 1
	end
end

--计算可移动步数
--id 战斗人id，
--stepmax 最大步数，
--flag=0  移动，物品不能绕过，1 武功，用毒医疗等，不考虑挡路。
--flag=2  无视建筑
function War_CalMoveStep(id, stepmax, flag)
  CleanWarMap(3, 255)
  local x = WAR.Person[id]["坐标X"]
  local y = WAR.Person[id]["坐标Y"]
  local steparray = {}
  for i = 0, stepmax do
    steparray[i] = {}
    steparray[i].bushu = {}
    steparray[i].x = {}
    steparray[i].y = {}
  end
  SetWarMap(x, y, 3, 0)
  steparray[0].num = 1
  steparray[0].bushu[1] = stepmax
  steparray[0].x[1] = x
  steparray[0].y[1] = y
  War_FindNextStep(steparray, 0, flag, id)
  return steparray
end

--判断x,y是否为可移动位置
function War_CanMoveXY(x, y, flag)
	if flag == 2 then
		return true
	end
	if GetWarMap(x, y, 1) > 0 then
		if WAR.CurID ~= nil and WAR.CurID > -1 then     
		    local pid = WAR.Person[WAR.CurID]["人物编号"]
		    if freefight(pid) and WAR.WSZA[pid] ~= nil then  --逍遥派无视障碍物
			    return true
		    end
	    end
		return false
	end
	if flag == 1 then 
		if CC.WarWater[GetWarMap(x, y, 0)] ~= nil then
			return false
		end
		if GetWarMap(x, y, 2) >= 0 then
		   return true
		end	
	end
	if flag == 0 then
		if CC.WarWater[GetWarMap(x, y, 0)] ~= nil then
			return false
		end
		if WAR.Stop[x] ~= nil and WAR.Stop[x][y] == 1 then 
			return false
		end
		if GetWarMap(x, y, 2) >= 0 then
			return false
		end
	end
	return true
end

--解毒菜单
function War_DecPoisonMenu()
	WAR.ShowHead = 0
	local r = War_ExecuteMenu(2)
	WAR.ShowHead = 1
	Cls()
	return r
end

--判断攻击后面对的方向
function War_Direct(x1, y1, x2, y2)
	local x = x2 - x1
	local y = y2 - y1
	if x == 0 and y == 0 then
		return WAR.Person[WAR.CurID]["人方向"]
	end
	if math.abs(x) < math.abs(y) then
		if y > 0 then
			return 3
		else
			return 0
		end
	else 
		if x > 0 then
			return 1
		else
			return 2
		end
	end
end

--医疗菜单
function War_DoctorMenu()
	WAR.ShowHead = 0
	local r = War_ExecuteMenu(3)
	WAR.ShowHead = 1
	Cls()
	return r
end

---执行医疗，解毒用毒
---flag=1 用毒， 2 解毒，3 医疗 4 暗器
---thingid 暗器物品id
function War_ExecuteMenu(flag, thingid)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local step = nil
	local sts =  nil
	if flag == 1 then
		step = math.modf(JY.Person[pid]["用毒能力"] / 40)
	elseif flag == 2 then
		step = math.modf(JY.Person[pid]["用毒能力"] / 40)
	elseif flag == 3 then
		step = math.modf(JY.Person[pid]["医疗能力"] / 40)
	elseif flag == 4 then
		step = math.modf(JY.Person[pid]["暗器技巧"] / 15) + 1
	end
	War_CalMoveStep(WAR.CurID, step, 1)
	--增加部分人物的7*7显示
	if actor(pid,8) and flag == 3 then
		sts = 1
	elseif actor(pid,9) and flag == 1 then 
		sts = 1
	elseif match_ID(pid,83) and flag == 4 then 
		sts = 1
	end
	local x1, y1 = War_SelectMove(sts)
	if x1 == nil then
		lib.GetKey()
		Cls()
		return 0
	else
		if WAR.LMC == 1 then	
			WAR.YTJS[pid]={x1, y1}	
		end
		if WAR.DFAQ == 1 then	
			WAR.KHJS[pid]={x1, y1}
		end
		return War_ExecuteMenu_Sub(x1, y1, flag, thingid)
	end
end

--选择武功的函数，手动和AI都经过这里
function War_FightSelectType(movefanwei, atkfanwei, x, y,wugong)
	local x0 = WAR.Person[WAR.CurID]["坐标X"]
	local y0 = WAR.Person[WAR.CurID]["坐标Y"]
	if x == nil and y == nil then
		x, y = War_KfMove(movefanwei, atkfanwei,wugong)
		if x == nil then
			lib.GetKey()
			Cls()
			return 
		end
	--无酒不欢：AI也显示选择范围
	else
		Cat('实时特效动画')
		WarDrawAtt(x, y, atkfanwei, 4)
		WarDrawMap(1, x, y)
		Cat('实时特效动画2')
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		Delay(5,x,y)
		--张无忌逆转乾坤
		if CC.TX["逆转乾坤"] == 1 then
			local z = WAR.CurID
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["人物编号"] == 0 and 0 < JY.Person[0]["生命"] then
					WAR.CurID = j
					break
				end
			end
			Cls()
			CurIDTXDH(WAR.CurID, 114,1,"逆转乾坤",C_ORANGE);
			WAR.CurID = z
			local ori_x, ori_y = x, y
			local min_x, min_y,max_x, max_y = x-2, y-2, x+2, y+2
			Cls()
			CleanWarMap(3, 255)
			local ssx = 0
			for i = min_x+1, max_x-1 do
				for j = min_y+1, max_y-1 do
					SetWarMap(i, j, 3, 0)
				end
			end
			SetWarMap(min_x, y, 3, 0)
			SetWarMap(max_x, y, 3, 0)
			SetWarMap(x, min_y, 3, 0)
			SetWarMap(x, max_y, 3, 0)
			Cat('实时特效动画')
			WarDrawMap(1, x, y)
			Cat('实时特效动画2')
			ShowScreen()
			lib.Delay(CC.BattleDelay)
			while true do
				if JY.Restart == 1 then
					break
				end
				local key, ktype, mx, my = lib.GetKey()
				if key == VK_UP then
					if (y > min_y + 1 and x > min_x and x < max_x) or (x == ori_x and y > min_y) then
						y = y - 1
					end
				elseif key == VK_DOWN then
					if (y < max_y - 1 and x > min_x and x < max_x) or (x == ori_x and y < max_y) then
						y = y + 1
					end
				elseif key == VK_LEFT then
					if (x > min_x + 1 and y > min_y and y < max_y) or (y == ori_y and x > min_x) then
						x = x - 1
					end
				elseif key == VK_RIGHT then
					if (x < max_x - 1 and y > min_y and y < max_y) or (y == ori_y and x < max_x) then
						x = x + 1
					end
				elseif key == VK_ESCAPE then
					x, y = ori_x, ori_y
					WAR.NZQK = 1
					Cat('实时特效动画')
					CleanWarMap(7, 0)
					WarDrawAtt(x, y, atkfanwei, 4)
					WarDrawMap(1, x, y)
					Cat('实时特效动画2')
					ShowScreen()
					lib.Delay(CC.BattleDelay)
					break
				elseif (key == VK_SPACE or key == VK_RETURN) then
					--内力大于等于300才能使用
					if JY.Person[0]["内力"] >= 300 then
						JY.Person[0]["内力"] = JY.Person[0]["内力"] - 300
						WAR.NZQK = 2
						break
					else
						x, y = ori_x, ori_y
						WAR.NZQK = 1
						CleanWarMap(7, 0)
						WarDrawAtt(x, y, atkfanwei, 4)
						WarDrawMap(1, x, y)
						ShowScreen()
						break
					end
				end
				Cat('实时特效动画')
				CleanWarMap(7, 0)
				WarDrawAtt(x, y, atkfanwei, 4)
				WarDrawMap(1, x, y)
				Cat('实时特效动画2')
				ShowScreen()
				lib.Delay(CC.BattleDelay)
			end
			CC.TX["逆转乾坤"] = 0
		end
		--主角，迷踪步躲避攻击
		if CC.TX["迷踪步"] == 1 and JY.Base['标准'] > 0 then
			local z = WAR.CurID
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["人物编号"] == 0 and 0 < JY.Person[0]["生命"] then
					WAR.CurID = j
					break
				end
			end
			Cls()
			CurIDTXDH(WAR.CurID, 129,1,"迷踪步",Violet);
			WAR.Person[WAR.CurID]["移动步数"] = 6
			War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
			local x, y = nil, nil
			while 1 do
				if JY.Restart == 1 then
					break
				end
				x, y = War_SelectMove()
				if x ~= nil then
					WAR.ShowHead = 0					
					War_MovePerson(x, y)
					break;
				end
			end
			WAR.CurID = z
			CC.TX["迷踪步"] = 0
		end
		--李寻欢 蜻蜓三抄水躲避攻击
		if JY.Person[498]["品德"] == 30 then
			local z = WAR.CurID
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["人物编号"] == 0 and 0 < JY.Person[0]["生命"] then
					WAR.CurID = j
					break
				end
			end
			Cls()
			CurIDTXDH(WAR.CurID, 129,1,"蜻蜓三抄水",Violet);
			WAR.Person[WAR.CurID]["移动步数"] = 6
			War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
			local x, y = nil, nil
			while 1 do
				if JY.Restart == 1 then
					break
				end
				if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]['我方'] == false or (inteam(WAR.Person[WAR.CurID]['人物编号']) == false and WAR.Person[WAR.CurID]['我方'] == true) then
					War_AutoEscape()
				else
					x, y = War_SelectMove()
					War_MoveMenu()
					if x ~= nil then
						WAR.ShowHead = 0
						War_MovePerson(x, y)
					end
				end
				break;
			end
			WAR.CurID = z
			JY.Person[498]["品德"] = 10
		end
		--兽王庄躲避攻击
		if JY.Person[765]["品德"] == 120 then
			local z = WAR.CurID
			for j = 0, WAR.PersonNum - 1 do
				if (WAR.Person[j]["人物编号"] == 765 or WAR.Person[j]["人物编号"] == 0) and 0 < JY.Person[WAR.Person[WAR.CurID]['人物编号']]["生命"] then
					WAR.CurID = j
					break
				end
			end
			Cls()
			CurIDTXDH(WAR.CurID,129,1,"惊鸿游龙",Violet);
			WAR.Person[WAR.CurID]["移动步数"] = 9
			War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
			local x, y = nil, nil
			while 1 do
				if JY.Restart == 1 then
					break
				end
				if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]['我方'] == false or (inteam(WAR.Person[WAR.CurID]['人物编号']) == false and WAR.Person[WAR.CurID]['我方'] == true) then
					War_AutoEscape()
					WAR.DZXYLV[WAR.Person[WAR.CurID]['人物编号']] = 4	
					local fjwg = 271
					if JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用'] > 0 then
						fjwg = JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用']
					end
					WAR.Person[WAR.CurID]["反击武功"] = fjwg
				else
					x, y = War_SelectMove()
					if x ~= nil then
						WAR.ShowHead = 0
						War_MovePerson(x, y)
						WAR.DZXYLV[WAR.Person[WAR.CurID]['人物编号']] = 4	
						local fjwg = 271
						if JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用'] > 0 then
							fjwg = JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用']
						end
						WAR.Person[WAR.CurID]["反击武功"] = fjwg
						--Cat('武功')
					end
				end
				break;
			end
			WAR.CurID = z
			JY.Person[765]["品德"] = 10
		end
		--江澜
		if JY.Person[775]["品德"] == 120 then
			local z = WAR.CurID
			for j = 0, WAR.PersonNum - 1 do
				if (WAR.Person[j]["人物编号"] == 775 or WAR.Person[j]["人物编号"] == 0) and 0 < JY.Person[WAR.Person[WAR.CurID]['人物编号']]["生命"] then
					WAR.CurID = j
					break
				end
			end
			Cls()
			CurIDTXDH(WAR.CurID,73,1,"捕风捉影",Violet);
			WAR.Person[WAR.CurID]["移动步数"] = 9
			War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
			local x, y = nil, nil
			while 1 do
				if JY.Restart == 1 then
					break
				end
				if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]['我方'] == false or (inteam(WAR.Person[WAR.CurID]['人物编号']) == false and WAR.Person[WAR.CurID]['我方'] == true) then
					War_AutoEscape()
					WAR.DZXYLV[WAR.Person[WAR.CurID]['人物编号']] = 4	
					local fjwg = 25
					if JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用'] > 0 then
						fjwg = JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用']
					end
					WAR.Person[WAR.CurID]["反击武功"] = fjwg
				else
					x, y = War_SelectMove()
					if x ~= nil then
						WAR.ShowHead = 0
						War_MovePerson(x, y)
						WAR.DZXYLV[WAR.Person[WAR.CurID]['人物编号']] = 4	
						local fjwg = 25
						if JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用'] > 0 then
							fjwg = JY.Person[WAR.Person[WAR.CurID]['人物编号']]['优先使用']
						end
						WAR.Person[WAR.CurID]["反击武功"] = fjwg
						--Cat('武功')
					end
				end
				break;
			end
			WAR.CurID = z
			JY.Person[775]["品德"] = 10
		end
		--与世无争
		if JY.Person[520]["品德"] == 120 then
			local z = WAR.CurID
			for j = 0, WAR.PersonNum - 1 do
				if (WAR.Person[j]["人物编号"] == 520 or WAR.Person[j]["人物编号"] == 0) and 0 < JY.Person[WAR.Person[WAR.CurID]['人物编号']]["生命"] then
					WAR.CurID = j
					break
				end
			end
			Cls()
			CurIDTXDH(WAR.CurID,113,1,"与世无争",Violet);
			WAR.Person[WAR.CurID]["移动步数"] = 12
			War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
			local x, y = nil, nil
			while 1 do
				if JY.Restart == 1 then
					break
				end
				if WAR.AutoFight == 1 or WAR.Person[WAR.CurID]['我方'] == false or (inteam(WAR.Person[WAR.CurID]['人物编号']) == false and WAR.Person[WAR.CurID]['我方'] == true) then
					War_AutoEscape()
				else
					x, y = War_SelectMove()
					if x ~= nil then
						WAR.ShowHead = 0
						War_MovePerson(x, y)
					end
				end
				break;
			end
			WAR.CurID = z
			JY.Person[520]["品德"] = 10
		end
		
		--小昭影步
		if JY.Person[66]["品德"] == 90 then
			JY.Person[66]["品德"] = 50
			if WAR.XZ_YB[1] ~= nil then
				local z = WAR.CurID
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["人物编号"] == 0 and 0 < JY.Person[0]["生命"] then
						WAR.CurID = j
						break
					end
				end
				Cls()
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 122,1, "接引离斯毒火海", C_RED)
				lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
				lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
                lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
				WarDrawMap(0)
				WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = WAR.XZ_YB[1], WAR.XZ_YB[2]
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 122,1, "幻光游世常自在", C_RED)
				lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
				lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
                SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
				WarDrawMap(0)
				WAR.XZ_YB[1]=nil
				WAR.XZ_YB[2]=nil
				WAR.CurID = z
			end
		end
		CleanWarMap(7,0)
		--lib.Delay(200)
	end
	if not War_Direct(x0, y0, x, y) then
		WAR.Person[WAR.CurID]["人方向"] = WAR.Person[WAR.CurID]["人方向"]
	else
		WAR.Person[WAR.CurID]["人方向"] = War_Direct(x0, y0, x, y)
	end
	SetWarMap(x, y, 4, 1)
	return x, y
end

--设置下一步可移动的坐标
function War_FindNextStep(steparray, step, flag, id)
	local num = 0
	local step1 = step + 1
  
	--ZOC判定
	local fujinnum = function(tx, ty)
		if flag ~= 0 or id == nil then
			return 0
		end
		local tnum = 0
		local wofang = WAR.Person[id]["我方"]
		local tv = nil
		tv = GetWarMap(tx + 1, ty, 2)
		if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
			tnum = 9999
		end
		tv = GetWarMap(tx - 1, ty, 2)
		if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
			tnum = 999
		end
		tv = GetWarMap(tx, ty + 1, 2)
		if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
			tnum = 999
		end
		tv = GetWarMap(tx, ty - 1, 2)
		if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
			tnum = 999
		end
		return tnum
	end
  
    for i = 1, steparray[step].num do
        if steparray[step].bushu[i] > 0 then
            steparray[step].bushu[i] = steparray[step].bushu[i] - 1
            local x = steparray[step].x[i]
            local y = steparray[step].y[i]
            if x + 1 < CC.WarWidth - 1 then
                local v = GetWarMap(x + 1, y, 3)
                if v == 255 and War_CanMoveXY(x + 1, y, flag) == true then
                    num = num + 1
                    steparray[step1].x[num] = x + 1
                    steparray[step1].y[num] = y
                    SetWarMap(x + 1, y, 3, step1)
                    steparray[step1].bushu[num] = steparray[step].bushu[i] - fujinnum(x + 1, y)
                end
            end
        
            if x - 1 > 0 then
                local v = GetWarMap(x - 1, y, 3)
                if v == 255 and War_CanMoveXY(x - 1, y, flag) == true then
                    num = num + 1
                    steparray[step1].x[num] = x - 1
                    steparray[step1].y[num] = y
                    SetWarMap(x - 1, y, 3, step1)
                    steparray[step1].bushu[num] = steparray[step].bushu[i] - fujinnum(x - 1, y)
                end
            end
        
            if y + 1 < CC.WarHeight - 1 then
                local v = GetWarMap(x, y + 1, 3)
                if v == 255 and War_CanMoveXY(x, y + 1, flag) == true then
                    num = num + 1
                    steparray[step1].x[num] = x
                    steparray[step1].y[num] = y + 1
                    SetWarMap(x, y + 1, 3, step1)
                    steparray[step1].bushu[num] = steparray[step].bushu[i] - fujinnum(x, y + 1)
                end
            end
        
            if y - 1 > 0 then
                local v = GetWarMap(x, y - 1, 3)
                if v == 255 and War_CanMoveXY(x, y - 1, flag) == true then
                    num = num + 1
                    steparray[step1].x[num] = x
                    steparray[step1].y[num] = y - 1
                    SetWarMap(x, y - 1, 3, step1)
                    steparray[step1].bushu[num] = steparray[step].bushu[i] - fujinnum(x, y - 1)
                end
            end
        end
    end
    if num == 0 then
        return 
    end
  steparray[step1].num = num
  War_FindNextStep(steparray, step1, flag, id)
end

--判断是否能打到敌人
function War_GetCanFightEnemyXY()
	local num, x, y = nil, nil, nil
	num, x, y = War_realjl(WAR.CurID)
	if num == -1 then
		return 
	end
	return x, y
end

--移动
function War_MoveMenu()
	if WAR.Person[WAR.CurID]["人物编号"] ~= -1 then
		WAR.ShowHead = 0
		if WAR.Person[WAR.CurID]["移动步数"] <= 0 then
		  return 0
		end
		War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
		local r = nil
		local x, y = War_SelectMove()
		if x ~= nil then
		  War_MovePerson(x, y, 1)
		  r = 1
		else
		  r = 0
		  WAR.ShowHead = 1
		  Cls()
		end
		lib.GetKey()
		return r
	else
		local ydd = {}
		local n = 1
		for i = 0, WAR.PersonNum - 1 do
		  if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
			ydd[n] = i
			n = n + 1
		  end
		end
		local dx = ydd[math.random(n - 1)]
		local DX = WAR.Person[dx]["坐标X"]
		local DY = WAR.Person[dx]["坐标Y"]
		local YDX = {DX + 1, DX - 1, DX}
		local YDY = {DY + 1, DY - 1, DY}
		local ZX = YDX[math.random(3)]
		local ZY = YDY[math.random(3)]
		if not SceneCanPass(ZX, ZY) or GetWarMap(ZX, ZY, 2) < 0 then
		  SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
		  SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
		  SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
		  WAR.Person[WAR.CurID]["坐标X"] = ZX
		  WAR.Person[WAR.CurID]["坐标Y"] = ZY
		  SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
		  SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
		  SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
		end
	end
    local movenum = 0
	local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"]-piaoyi[1])
	local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"]-piaoyi[2])
	if (offset1 or 0) > 0 or (offset2 or 0) > 0 then
		movenum = offset1 + offset2
	end	
	--记录移动步数
	WAR.YDBS = movenum
	WAR.LBPM = movenum    --碧海玉箫
	return 1
end

--人物移动
function War_MovePerson(x, y, flag)
	local id = WAR.Person[WAR.CurID]['人物编号']
 	local x1 = x
 	local y1 = y
	WAR.TJZS[WAR.Person[WAR.CurID]["人物编号"]] = {WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"]}
    WAR.PD['金雁功闪避'][WAR.Person[WAR.CurID]["人物编号"]] = {WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"],1}
	if not flag then
        flag = 0
    end
    local movenum = GetWarMap(x, y, 3)
    local movetable = {}
    for i = movenum, 1, -1 do
        movetable[i] = {}
        movetable[i].x = x
        movetable[i].y = y
        if GetWarMap(x - 1, y, 3) == i - 1 then
            x = x - 1
            movetable[i].direct = 1
        elseif GetWarMap(x + 1, y, 3) == i - 1 then
            x = x + 1
            movetable[i].direct = 2
        elseif GetWarMap(x, y - 1, 3) == i - 1 then
            y = y - 1
            movetable[i].direct = 3
        elseif GetWarMap(x, y + 1, 3) == i - 1 then
            y = y + 1
            movetable[i].direct = 0
        end
		for j = 0,WAR.PersonNum-1 do 
		    if Jianxuefusheng(WAR.Person[j]["人物编号"]) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
			    local df = WAR.Person[j]["人物编号"] 
			    local offset1 = math.abs(movetable[i].x - WAR.Person[j]["坐标X"]) 
			    local offset2 = math.abs(movetable[i].y - WAR.Person[j]["坐标Y"])
			    local offset = offset1+offset2	
			    if offset1 <= 10 and offset2 <= 10 and offset <= 40 then
				    WAR.JXFS = WAR.JXFS + 1
				    WAR.WZJS[WAR.Person[WAR.CurID]["人物编号"]] = 1
			    end
		    end
	    end
    end
	--减少移动步数
	movetable.num = movenum
	movetable.now = 0
	WAR.Person[WAR.CurID].Move = movetable
	if WAR.Person[WAR.CurID]["移动步数"] < movenum then
		movenum = WAR.Person[WAR.CurID]["移动步数"]
		WAR.Person[WAR.CurID]["移动步数"] = 0
	else
		WAR.Person[WAR.CurID]["移动步数"] = WAR.Person[WAR.CurID]["移动步数"] - movenum
	end
	--记录移动步数
	WAR.YDBS = movenum
	WAR.LBPM = movenum    --碧海玉箫
	--移动人物
	--标主的特殊显示
	if WAR.PD['遮影'][id] ~= nil then
		WAR.PD['影随'][id] = WAR.PD['遮影'][id]
		local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
		if WAR.Stop[WAR.Person[WAR.CurID]["坐标X"]] ~= nil and WAR.Stop[WAR.Person[WAR.CurID]["坐标X"]][WAR.Person[WAR.CurID]["坐标Y"]] ~= nil then
			WAR.Stop[WAR.Person[WAR.CurID]["坐标X"]][WAR.Person[WAR.CurID]["坐标Y"]] = nil
		end
		PlayWavE(5)
		WAR.Person[WAR.CurID]["人方向"] = War_Direct(x0, y0, x1, y1)
		WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
		WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = x1, y1
		if match_ID(id,517) or match_ID(id,526) or JXPD(id,525,1) then
		else
			Cat('遮影DH2',WAR.CurID)
		end	
  --木凭 注释
	elseif match_ID(id, 9976) --[[ or match_ID(id,763)]] then 
		Cat('神游太虚',x1,y1)	
		--[[
	elseif  movenum > 2 and JY.Person[id]["主运轻功"] > 0 then
		local a = 0
		local gender = 0
		if JY.Person[0]["性别"] > 0 then
			gender = 1
		end
		for i = 1, movenum do
			local t1 = lib.GetTime()
			if a == 6 then
				a = 0
			end
			if i == 1 then
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
				SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
			end
			if i > 3 then
				SetWarMap(movetable[i-3].x, movetable[i-3].y, 2, -1)
				SetWarMap(movetable[i-3].x, movetable[i-3].y, 5, -1)
			end
			if i == movenum then
				SetWarMap(movetable[i-2].x, movetable[i-2].y, 2, -1)
				SetWarMap(movetable[i-2].x, movetable[i-2].y, 5, -1)
				SetWarMap(movetable[i-1].x, movetable[i-1].y, 2, -1)
				SetWarMap(movetable[i-1].x, movetable[i-1].y, 5, -1)
			end
			WAR.Person[WAR.CurID]["坐标X"] = movetable[i].x
			WAR.Person[WAR.CurID]["坐标Y"] = movetable[i].y
			WAR.Person[WAR.CurID]["人方向"] = movetable[i].direct
			if i < movenum then
				WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic2(WAR.CurID, gender) + (a)*2
			else
				WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
			end
			--WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])	
			]]
			--SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
--[[

			WarDrawMap(0)
			ShowScreen()
			a = a + 1
			lib.Delay(CC.BattleDelay)
		end
		]]
	else
		for i = 1, movenum do
			local t1 = lib.GetTime()
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
            SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
			WAR.Person[WAR.CurID]["坐标X"] = movetable[i].x
			WAR.Person[WAR.CurID]["坐标Y"] = movetable[i].y
			WAR.Person[WAR.CurID]["人方向"] = movetable[i].direct
			WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
            SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
			Cat('实时特效动画')
            WarDrawMap(0)
            Cat('实时特效动画2')
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
	--主运轻功的话遇到ZOC移动不清0，反之清0
	if JY.Person[WAR.Person[WAR.CurID]["人物编号"]]["主运轻功"] == 0 then
		local fujinnum = function(tx, ty)
			local tnum = 0
			local wofang = WAR.Person[WAR.CurID]["我方"]
			local tv = nil
			tv = GetWarMap(tx + 1, ty, 2)
			if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
				tnum = 999
			end
			tv = GetWarMap(tx - 1, ty, 2)
			if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
				tnum = 999
			end
			tv = GetWarMap(tx, ty + 1, 2)
			if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
				tnum = 999
			end
			tv = GetWarMap(tx, ty - 1, 2)
			if tv ~= -1 and WAR.Person[tv]["我方"] ~= wofang then
				tnum = 999
			end
			return tnum
		end
		if fujinnum(WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"]) ~= 0 then
			WAR.Person[WAR.CurID]["移动步数"] = 0
		end
	end
	
	for j = 0,WAR.PersonNum -1 do  ----
	    if match_ID(WAR.Person[j]["人物编号"],525) and (JXPD(WAR.Person[j]["人物编号"], 525, 1) or WAR.Person[j]["人物编号"] == 525) 
			and JLSD(0,(WAR.SPIRIT[WAR.Person[j]["人物编号"]] or 0)+15,WAR.Person[j]["人物编号"]) and DWPD(WAR.CurID,j) and dead(j) == false then 
			local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[j]["坐标X"]) 
            local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[j]["坐标Y"])
			if offset1 <= 8 or offset2 <= 8 then
				local p = WAR.CurID
				WAR.CurID = j
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 7,1,'燎原心法・闪寸心')
				if WAR.AutoFight == 1 or WAR.Person[j]['我方'] == false then 
					War_AutoFight()
				else 
					Cat('武功')
				end
				WAR.CurID = p
			end
		end
	end
	--背嵬军
	for j = 0, WAR.PersonNum -1 do
		local df = WAR.Person[j]["人物编号"]
		if MPTX(df,23,4) and PersonKF(df,199) then
			local yj = TrueTS(df)/15*(movenum+1)
		    if dead(j) == false and DWPD(j,WAR.CurID) then
				local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[j]["坐标X"]) 
				local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[j]["坐标Y"])
				if offset1 <= 8 or offset2 <= 8 then
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID,49	,1,'纵马横扫',LightSkyBlue)
					WAR.Person[j]["Life_Before_Hit"] = JY.Person[id]["生命"]
					WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(id, "生命", -math.modf(yj))
					WAR.TXXS[id] = 1
					--ztd(j,'生命点数',-math.modf(yj))
				end
			end
		end
	end
	--怒涛武穆移动
	if NGQHB(id,252) then
		WAR.PD['回气'][id] = (WAR.PD['回气'][id] or 0) + movenum*60
		if movenum >= 9 then
			WarDrawMap(0); --不加这条则动画位置无法正常显示
			CurIDTXDH(WAR.CurID,119,1,"马不停蹄",C_ORANGE);
			if WAR.PD['再次行动'][id] == nil then
				WAR.PD['再次行动'][id] = movenum*2
			end
		end
	end
	--周公剑意
	for j = 0,WAR.PersonNum -1 do
		local df = WAR.Person[j]["人物编号"]
	    if WAR.PD['御雷阵'][df] ~= nil then
			local yj = math.modf(TrueYJ(df)/100)
			if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then
				local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[j]["坐标X"]) 
				local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[j]["坐标Y"])
				if offset1 <= yj or offset2 <= yj then
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID,131,1,'御雷霹雳',LightSkyBlue)
					local xl = yj*100
					WAR.Person[j]["Life_Before_Hit"] = JY.Person[id]["生命"]
					WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(id, "生命", -math.modf(xl))
					WAR.PD['感电状态'][id] = limitX((WAR.PD['感电状态'][id] or 0) + 1,0,5)
					WAR.TXXS[id] = 1
				end
			end
		end
	end
	--老张拉人
	for j = 0,WAR.PersonNum -1 do
	    if match_ID(WAR.Person[j]["人物编号"],5) and 
		(WAR.Person[j]["人物编号"] == 5 or WAR.Person[j]["人物编号"] == 0) and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] 
	        and WAR.Person[j]["死亡"] == false then
			local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[j]["坐标X"]) 
            local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[j]["坐标Y"])  
			local offset3 = math.abs(WAR.TJZS[WAR.Person[WAR.CurID]["人物编号"]][1] - WAR.Person[j]["坐标X"]) 
			local offset4 = math.abs(WAR.TJZS[WAR.Person[WAR.CurID]["人物编号"]][2] - WAR.Person[j]["坐标Y"]) 
			local offset6 = offset3 + offset4
			local offset5 = offset1 + offset2
			if offset1 > 8 or offset2 > 8 then
			   if offset5 > offset6 then 
	                WarDrawMap(0)
	                CurIDTXDH(WAR.CurID, 159, 1)
	                lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	                lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
					lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	                WarDrawMap(0)
	                CurIDTXDH(WAR.CurID, 159, 1)
	                WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = WAR.TJZS[WAR.Person[WAR.CurID]["人物编号"]][1], WAR.TJZS[WAR.Person[WAR.CurID]["人物编号"]][2]
	                WarDrawMap(0)
	                CurIDTXDH(WAR.CurID, 159, 1)
	                lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	                lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
					lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	                WarDrawMap(0)
	                CurIDTXDH(WAR.CurID, 159, 1)
	                WAR.TJZS[2000 + WAR.Person[WAR.CurID]["人物编号"]] = 1 
		            WAR.TJZS[WAR.Person[WAR.CurID]["人物编号"]] = nil
		        end
	        end
	    end
	end
end

---用毒菜单
function War_PoisonMenu()
	WAR.ShowHead = 0
	local r = War_ExecuteMenu(1)
	WAR.ShowHead = 1
	Cls()
	return r
end

--战斗查看状态
function War_StatusMenu()
	WAR.ShowHead = 0
	Menu_Status()
	WAR.ShowHead = 1
	Cls()	
end

--战斗物品菜单
function War_ThingMenu()
	WAR.ShowHead = 0
	local thing = {}
	local thingnum = {}
	for i = 0, CC.MyThingNum - 1 do
		thing[i] = -1
		thingnum[i] = 0
	end
	local num = 0
	for i = 0, CC.MyThingNum - 1 do
		local id = JY.Base["物品" .. i + 1]
		if id >= 0 and (JY.Thing[id]["类型"] == 1 or JY.Thing[id]["类型"] == 3 or JY.Thing[id]["类型"] == 4) then
			thing[num] = id
			thingnum[num] = JY.Base["物品数量" .. i + 1]
			num = num + 1
		end
	end
	local r = SelectThing(thing, thingnum)
	Cls()
	local rr = 0
	if r >= 0 and UseThing(r) == 1 then
		if JY.Status == GAME_WMAP and JY.Person[WAR.Person[WAR.CurID]['人物编号']]['门派技能2'] == 486 and JY.Thing[r]['类型'] == 4 then
			if JLSD(0,math.modf((WAR.SPIRIT[WAR.Person[WAR.CurID]['人物编号']] or 0)*0.5),WAR.Person[WAR.CurID]['人物编号']) or ZYJQ(WAR.Person[WAR.CurID]['人物编号']) then
				UseThing(r)
				UseThing(r)
			end
		end
		rr = 1
	end
	WAR.ShowHead = 1
	Cls()
	return rr
end


--自动战斗判断是否能医疗
function War_ThinkDoctor()
  local pid = WAR.Person[WAR.CurID]["人物编号"]
  if JY.Person[pid]["体力"] < 50 or JY.Person[pid]["医疗能力"] < 20 then
    return -1
  end
  if JY.Person[pid]["医疗能力"] + 20 < JY.Person[pid]["受伤程度"] then
    return -1
  end
  local rate = -1
  local v = JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"]
  if JY.Person[pid]["医疗能力"] < v / 4 then
    rate = 30
  elseif JY.Person[pid]["医疗能力"] < v / 3 then
      rate = 50
  elseif JY.Person[pid]["医疗能力"] < v / 2 then
      rate = 70
  else
    rate = 90
  end
  if Rnd(100) < rate then
    return 5
  end
  return -1
end

--能否吃药增加参数
--flag=2 生命，3内力；4体力  6 解毒
function War_ThinkDrug(flag)
  local pid = WAR.Person[WAR.CurID]["人物编号"]
  local str = nil
  local r = -1
  if flag == 2 then
    str = "加生命"
  elseif flag == 3 then
    str = "加内力"
  elseif flag == 4 then
    str = "加体力"
  elseif flag == 6 then
    str = "加中毒解毒"
  else
    return r
  end
  local function Get_Add(thingid)
    if flag == 6 then
      return -JY.Thing[thingid][str]
    else
      return JY.Thing[thingid][str]
    end
  end
  
  --身上是否有药品
  if isteam(pid) and WAR.Person[WAR.CurID]["我方"] == true then
    for i = 1, CC.MyThingNum do
      local thingid = JY.Base["物品" .. i]
      if thingid >= 0 and JY.Thing[thingid]["类型"] == 3 and Get_Add(thingid) > 0 then
        r = flag
        break;
      end
    end
  else
    for i = 1, 4 do
      local thingid = JY.Person[pid]["携带物品" .. i]
      if thingid >= 0 and JY.Thing[thingid]["类型"] == 3 and Get_Add(thingid) > 0 then
        r = flag
        break;
      end
    end
  end
  return r
end

--使用暗器
function War_UseAnqi(id)

	return War_ExecuteMenu(4, id)
end

--初始化战斗数据
function WarLoad(warid)
	WarSetGlobal()
	local data = Byte.create(CC.WarDataSize)
	Byte.loadfile(data, CC.WarFile, warid * CC.WarDataSize, CC.WarDataSize)
	LoadData(WAR.Data, CC.WarData_S, data)
	WAR.ZDDH = warid
end

--加载战斗地图
function WarLoadMap(mapid)
	lib.Debug(string.format("load war map %d", mapid))
	lib.LoadWarMap(CC.WarMapFile[1], CC.WarMapFile[2], mapid, 12, CC.WarWidth, CC.WarHeight)
end


function GetWarMap(x, y, level)
	if (x > 63) or (x < 0) or (y > 63) or (y < 0) then
		return 
	end
	return lib.GetWarMap(x, y, level)
end

function SetWarMap(x, y, level, v)
	if (x > 63) or (x < 0) or (y > 63) or (y < 0) then
		return 
	end
	return lib.SetWarMap(x, y, level, v)
end

function CleanWarMap(level, v)
	lib.CleanWarMap(level, v)
end

--设置人物贴图
function WarSetPerson()
	CleanWarMap(2, -1)
	CleanWarMap(5, -1)
  CleanWarMap(10, -1)
  WAR.TF = {}
  WAR.TF1 = {}
	for i = 0, WAR.PersonNum - 1 do
    savetf(i)
    
		if WAR.Person[i]["死亡"] == false then
			SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2, i)
			SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 5, WAR.Person[i]["贴图"])
      SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 10, JY.Person[WAR.Person[i]["人物编号"]]['头像代号'])
			--夜雨楼如影随形特效
			local id = WAR.Person[i]["人物编号"]
			if WAR.PD['遮影'][id] ~= nil then 
				SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2, -1)
				SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 5, -1)
				SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 10, -1)
			end
		end
	end

end

--显示武功动画，人物受伤动画，音效等
function War_ShowFight(pid, wugong, wugongtype, level, x, y, eft, ZHEN_ID)

	Cat('遮影DH2',WAR.CurID)

	--攻击时不显示血条
	WAR.ShowHP = 0
	
	--没有合击
	if not ZHEN_ID then
		ZHEN_ID = -1
	end
	
	--内功
	if wugongtype == 6 then
		wugongtype = WAR.NGXS
	end
	--[[if wugong == 93 then
		wugongtype = 5
	end	]]
	--无酒不欢：设置一下新的动画顺序
	if wugongtype == 2 then
		wugongtype = 1
	elseif wugongtype > 2 and wugongtype < 6 then
		wugongtype = wugongtype - 1
	end
  
	local x0 = WAR.Person[WAR.CurID]["坐标X"]
	local y0 = WAR.Person[WAR.CurID]["坐标Y"]
	
	local starteft = 0
	
	if pid > -1 then
        Cat('神游太虚2',1)
        --木凭 顾影自怜
        Cat('顾影自怜',1)
        local using_anqi = 0
        local anqi_name
        local anwu = 0
		if JY.Person[pid]["门派技能2"]  > 0 then
			anwu = JY.Person[pid]["门派技能2"] 
		end	
		--暗器动画
		if wugongtype == -1 then
			using_anqi = 1
			anqi_name = JY.Thing[eft]["名称"]
			--何铁手含沙射影
			if match_ID(pid, 83) then
				anqi_name = "含沙射影・"..anqi_name
			end
			eft = JY.Thing[eft]["暗器动画编号"]
			--李寻欢小李飞刀 例不虚发
			if  WAR.XLFD[pid] ~= nil then
				anqi_name = "小李飞刀・例不虚发"
			end	
			if WAR.KHSZ == 1 then
				anqi_name = "葵花神针"
			end 	
			if WAR.YYLZ == 1 then
				anqi_name = "血花雨・不染尘世"
			end 
			if anwu > 0 then  --金蛇锥
				if anwu == 490 then
					eft = 195
					anqi_name = "金蛇追命"
				end
				if anwu == 486 then
					eft = 54
					anqi_name = "细雨血花"
				end
				if anwu == 458 then  --冰魄银针
					eft = 54
					if WAR.BPYZ > 0 then
						if WAR.BPYZ1 > 0 then
							if WAR.BPYZ1 == 2 then
								anqi_name = "冰魄寒心・杀尽天下负心人"
							else
								anqi_name = "冰魄寒心・杀尽负心人"
							end	
						else
							local BPXS = {"爱火已成霜","寒心复盈怨","虚情妄毒誓","意冷恨相逢"}
							anqi_name = "冰魄寒心・"..BPXS[WAR.BPYZ]
						end	
					end	
				end	
				if anwu == 459 then  --生死符
					eft = 78
					if WAR.SSFZ > 0 then
						if WAR.SSFZ1 > 0 then
							if WAR.SSFZ1 == 2 then
								anqi_name = "生死符・寒气"
							else
							    anqi_name = "生死符・热劲"	
							end
						else
						    local SSXS = {"乱","寒气入体","热劲破体"}
							anqi_name = "生死符・"..SSXS[WAR.SSFZ]	
						end 	
					end
				end
				if anwu == 450 then  --霹雳雷火弹
					eft = 58
					if WAR.PLLH > 0 then
						if WAR.PLLHD > 0 then
							if WAR.PLLHD == 2 then
								anqi_name = "霹雳雷火弹・爆"
							else
							    anqi_name = "霹雳雷火弹・破"	
							end
						else
						    local PLLH = {"星罗棋布","群星璀璨","月朗星稀"}
							anqi_name = "霹雳雷火弹・"..PLLH[WAR.PLLH]	
						end 	
					end
				end
				if anwu == 460 then --透骨针
					eft = 121
					if WAR.TGZ > 0 then
						if WAR.TGZ1 > 0 then
							if WAR.TGZ1 == 2 then 
								anqi_name = "透骨针・赤毒"
							else
							    anqi_name = "透骨针・毒血"		
							end
						else
							local TGZ = {"落英","碧海","翠竹"}	
							anqi_name = "透骨针・"..TGZ[WAR.TGZ]
						end
					end
				end
				if anwu == 469 then --黑血神针
					eft = 98
					if WAR.HXSZ > 0 then
						if WAR.HXSZ1 > 0 then
							anqi_name = "黑血神针・急如骤雨"
						else
							local HXSZ = {"破命","断筋"}	
							anqi_name = "黑血神针・"..HXSZ[WAR.HXSZ]
						end
					end
				end
			--独孤九剑暗器特效
			elseif (match_ID(pid, 592) or (PersonKF(pid,47) and PersonKF(pid,184))) and WAR.HFXZ[pid] ~= nil then
				eft = 426
			else
				eft = 125
			end	
	    end	

        --扫地老僧  随机动画
        if match_ID(pid, 114) or match_ID(pid,457) or (match_ID(pid,9946) and yongnei(wugong)) then
            eft = math.random(1,350)
        end
		--擒龙降龙
		if WAR.QLXLJL == 1 then
			eft = 383
		end
        --萧秋水 动画
        if match_ID(pid, 652) and yongjian(wugong) then
            eft = 75
        end
		--唯识心剑
        if wugong == 370 and (PersonKF(pid,369) or match_ID(pid,747)) then
            eft = 121
        end
        --陆渐 动画
        if match_ID(pid, 497) then
            eft = math.random(1,100)
        end
        if match_ID(pid,721) and (WAR.PD['玉露酒'][pid] ~= nil or WAR.PD['梨花酒'][pid] ~= nil or WAR.PD['即墨老酒'][pid] ~= nil or WAR.PD['五宝花蜜酒'][pid] ~= nil )then
            eft = 168
        end
        --奔雷手 动画
        if WAR.LDJT == 1 then
      	    eft = 9
        end	
		if wugong == 313 then
			eft = 126
		end	
        if wugong == 73  then
            eft = 61
        end	
        --双剑合壁动画
        if (wugong == 39 or wugong == 42 or wugong == 139) and WGZH(pid,39,42) then 
            eft = 83
        end	
        --黯然极意动画
        if wugong == 25 then
            eft = 430
        end
        --竹风雨滴
			if match_ID(pid,520) and ((WAR.LQZ[pid] or 0) >= 90 or (WAR.SPIRIT[pid] or 0) >= 150) then
			eft = 184
        end
		
		--大伏魔九阴
		if wugong == 342 and (Curr_NG(pid,107) or match_ID(pid,637)) then
			eft = 7
		end 

        --霍都  龙象动画
        if match_ID(pid, 84) and wugong == 103 then
            eft = 73
        end

        --金蛇奥义动画
        if wugong == 40 and WAR.JSAY == 1 then
            eft = 44
        end
		--青蟒剑动画
        if wugong == 40 and WAR.QMJ == 1 then
            eft = 144
        end
		--万佛朝宗动画
      if WAR.PD["万佛朝宗"][pid] == 1 or WAR.PD["如来神掌"][pid] == 1 or WAR.PD["如来神掌"][pid] == 2 then
		    eft = 169
			end
			if wugong == 335 and WAR.TDJW > 0 then
				eft = 185
			end	
        if WAR.WDKTJ == 1 then 
            eft = 170
        end
        if  WAR.AJFHNP == 1 then
            eft = 61
        end
        --七弦无形剑奥义动画
        if  WAR.QXWXJ == 1 then
            eft = 125
        end	
        --
        if WAR.YQFSQ == 1 then
            eft = 126
        end	
        --追魂夺命的动画
        if wugong == 192 then
        eft = 162
        end	
        --玄铁剑法的动画
        if wugong == 45 and BNJQ(pid) then
			eft = 164
        end
        --进阶万花
        if (wugong == 30 and PersonKF(pid,175)) or (wugong == 377 and WAR.WYSJ == 1) then
            eft = 138
        end
        --进阶泰山
        if (wugong == 31 and PersonKF(pid,175)) or (wugong == 377 and WAR.WYSJ == 2) then
            eft = 139
        end
        --进阶云雾
        if (wugong == 32 and PersonKF(pid,175)) or (wugong == 377 and WAR.WYSJ == 3) then
            eft = 139
        end
        --进阶万岳
        if (wugong == 33 and PersonKF(pid,175)) or (wugong == 377 and WAR.WYSJ == 4) then
            eft = 140
        end
        --进阶太岳
        if (wugong == 34 and PersonKF(pid,175)) or (wugong == 377 and WAR.WYSJ == 5) then
            eft = 141
        end
        --阳春白雪曲
        if wugong == 185  then
            eft = 129
        end	
        if wugong == 340 and WAR.DJTS > 0 then
        	eft = 188
        end	
        --无酒不欢的特效动画
        if pid == 0 and JY.Base["特殊"] == 1 then
            if JY.Person[0]["性别"] == 0 then
                eft = 65
            else
                eft = 8
            end
        end

        --杨康的杨家枪法
        if match_ID(pid,650) and wugong == 68 then
            eft = 150
        end
        
        --无招胜有招动画
        if WAR.FQY == 1 then
            eft = 83
        end
		
		
        
        if WAR.WZ[pid] ~= nil then
            WAR.Person[WAR.CurID]['特效文字0'] = WAR.WZ[pid][1]
            WAR.Person[WAR.CurID]['特效文字1'] = WAR.WZ[pid][2]
            WAR.Person[WAR.CurID]['特效文字2'] = WAR.WZ[pid][3]
            WAR.Person[WAR.CurID]['特效文字3'] = WAR.WZ[pid][4]
            WAR.Person[WAR.CurID]['特效文字4'] = WAR.WZ[pid][5]
            WAR.Person[WAR.CurID]['特效动画'] = WAR.WZ[pid][6]
        end

        WAR.WZ[pid] = nil
        
        --剑魔BOSS
        if match_ID(pid , 592) then
            if WAR.PD['独孤剑势'][pid] ~= nil then
                if WAR.PD['独孤剑势'][pid] <= 3 then
                    WAR.Person[WAR.CurID]['特效动画'] = 24
                    if WAR.Person[WAR.CurID]['特效文字3'] == nil then 
                        WAR.Person[WAR.CurID]['特效文字3'] = '利剑'
                    else 
                        WAR.Person[WAR.CurID]['特效文字3'] = WAR.Person[WAR.CurID]['特效文字3']..'・利剑'
                    end
                    eft = 24
                elseif WAR.PD['独孤剑势'][pid] <= 5 then
                    WAR.Person[WAR.CurID]['特效动画'] = 48
                    if WAR.Person[WAR.CurID]['特效文字3'] == nil then 
                        WAR.Person[WAR.CurID]['特效文字3'] = '软剑'
                    else 
                        WAR.Person[WAR.CurID]['特效文字3'] = WAR.Person[WAR.CurID]['特效文字3']..'・软剑'
                    end
                    eft = 48
                elseif WAR.PD['独孤剑势'][pid] <= 7 then
                    WAR.Person[WAR.CurID]['特效动画'] = 10
                    if WAR.Person[WAR.CurID]['特效文字3'] == nil then 
                        WAR.Person[WAR.CurID]['特效文字3'] = '重剑'
                    else 
                        WAR.Person[WAR.CurID]['特效文字3'] = WAR.Person[WAR.CurID]['特效文字3']..'・重剑'
                    end
                    eft = 10
                elseif WAR.PD['独孤剑势'][pid] <= 9 then
                    WAR.Person[WAR.CurID]['特效动画'] = 46
                    if WAR.Person[WAR.CurID]['特效文字3'] == nil then 
                        WAR.Person[WAR.CurID]['特效文字3'] = '木剑'
                    else 
                        WAR.Person[WAR.CurID]['特效文字3'] = WAR.Person[WAR.CurID]['特效文字3']..'・木剑'
                    end
                    eft = 46		
                else
                    if WAR.Person[WAR.CurID]['特效文字3'] == nil then 
                        WAR.Person[WAR.CurID]['特效文字3'] = '无剑'
                    else 
                        WAR.Person[WAR.CurID]['特效文字3'] = WAR.Person[WAR.CurID]['特效文字3']..'・无剑'
                    end
                    eft = 84
                end
            end
        end

        ------------------------------------------------------
        -- 大武功特效	
        local ex, ey = -1, -1;
		--指定XY，那么只显示在一个点显示动画	
        if eft == 173 then
            ex, ey = x, y;
        end			
        if eft == 172 then
            ex, ey = x, y;
        end			
        if eft == 170 then
            ex, ey = x, y;
        end
        if eft == 168 then
            ex, ey = x, y;
        end
        if eft == 169 then
            ex, ey = x, y;
        end	
        ----------------------------------------------------- 
        --六脉神剑的类型设置为拳法
        if wugong == 49 then
            wugongtype = 1
        end

        --合击动画
        local ZHEN_pid, ZHEN_type, ZHEN_startframe, ZHEN_fightframe = nil, nil, nil, nil
        if ZHEN_ID >= 0 then
            ZHEN_pid = WAR.Person[ZHEN_ID]["人物编号"]
            ZHEN_type = wugongtype
            ZHEN_startframe = 0
            ZHEN_fightframe = 0
        end
    
        local fightdelay, fightframe, sounddelay = nil, nil, nil
        if wugongtype >= 0 then
            fightdelay = JY.Person[pid]["出招动画延迟" .. wugongtype + 1]
            fightframe = JY.Person[pid]["出招动画帧数" .. wugongtype + 1]
            sounddelay = JY.Person[pid]["武功音效延迟" .. wugongtype + 1]
        else
            fightdelay = 0
            fightframe = -1
            sounddelay = -1
        end
  
        if fightdelay == 0 or fightframe == 0 then
            for i = 1, 5 do
                if JY.Person[pid]["出招动画帧数" .. i] ~= 0 then
                    fightdelay = JY.Person[pid]["出招动画延迟" .. i]
                    fightframe = JY.Person[pid]["出招动画帧数" .. i]
                    sounddelay = JY.Person[pid]["武功音效延迟" .. i]
                    wugongtype = i - 1
                end
            end
        end

        if ZHEN_ID >= 0 then
            if JY.Person[ZHEN_pid]["出招动画帧数" .. ZHEN_type + 1] == 0 then
                for i = 1, 5 do
                    if JY.Person[ZHEN_pid]["出招动画帧数" .. i] ~= 0 then
                        ZHEN_type = i - 1
                        ZHEN_fightframe = JY.Person[ZHEN_pid]["出招动画帧数" .. i]
                    end
                end
            else
                ZHEN_fightframe = JY.Person[ZHEN_pid]["出招动画帧数" .. ZHEN_type + 1]
            end
        end
				if eft == nil or eft < 0 then
					eft = math.random(100)
				end
        local framenum = fightdelay + CC.Effect[eft]
        
        local oldframe = framenum
        if framenum < fightdelay + 20 then 
        framenum = fightdelay + 20
        end
	
        local startframe = 0
        if wugongtype >= 0 then
            for i = 0, wugongtype - 1 do
                startframe = startframe + 4 * JY.Person[pid]["出招动画帧数" .. i + 1]
            end
        end
        if ZHEN_ID >= 0 and ZHEN_type >= 0 then
            for i = 0, ZHEN_type - 1 do
                ZHEN_startframe = ZHEN_startframe + 4 * JY.Person[ZHEN_pid]["出招动画帧数" .. i + 1]
            end
        end
  
        --local starteft = 0
        for i = 0, eft - 1 do
            starteft = starteft + CC.Effect[i]
        end

        WAR.Person[WAR.CurID]["贴图类型"] = 0
        WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
        if ZHEN_ID >= 0 then
            WAR.Person[ZHEN_ID]["贴图类型"] = 0
            WAR.Person[ZHEN_ID]["贴图"] = WarCalPersonPic(ZHEN_ID)
        end
  
        local oldpic = WAR.Person[WAR.CurID]["贴图"] / 2		--当前贴图的位置
        local oldpic_type = 0
        local oldeft = -1
        local kfname = JY.Wugong[wugong]["名称"]
        local showsize = CC.FontBig
        local showx = CC.ScreenW / 2 - showsize * string.len(kfname) / 4
        local hb = GetS(JY.SubScene, x0, y0, 4)
    
        --显示武功，放到特效文字4
        if wugong ~= 0 then
			if MPTX(pid,9) and WAR.TMMS[pid] == 1 and WAR.ACT == 1 then 
                if WAR.DPJ[pid] <= 3 then
	                kfname = "夺魄箭"
	            elseif WAR.DPJ[pid] == 4 then 
	                kfname = "追命箭"
	            end  
	        end
            if MPTX(pid,9) and WAR.TMMS[pid] == 2 then 
	            kfname = "蚀肌弹" 
	        end
            if WAR.LHQ_BNZ == 1 then
                kfname = "般若掌"
            end
            if WAR.JGZ_DMZ == 1 then
                kfname = "达摩掌"
            end
            if WAR.WD_CLSZ == 1 then
                kfname = "赤练神掌"
            end
            if WAR.PD['傲寒六诀'][pid] ~=nil and WAR.PD['傲寒六诀'][pid] == 1 then
                kfname = "傲寒六诀"
                WAR.PD['傲寒六诀'][pid] = nil
            end	
            if (wugong == 22 or wugong == 189) and JinGangBR(pid) then
                kfname = "金刚般若掌"
            end	
            if wugong == 93 then
                kfname = "圣火令神功"
            end	
        end
        
        --王重阳一气化三清文字
        if WAR.YQFSQ == 1 then
            kfname = "中神通・一气化三清"
        end	
        if WAR.PD["如来神掌"][pid] == 1 then
            kfname = "如来神掌"
            WAR.PD["如来神掌"][pid] =nil
        end	
        if WAR.PD["如来神掌"][pid] == 2 then
            kfname = "如来神掌●灭"
            WAR.PD["如来神掌"][pid] =nil
        end	
		--朝廷岳枪
		if WAR.YQHS == 1 then
			kfname = "横扫千军"
	    end
		--般若掌法的反击文字
	    if WAR.hit_DGQB == 1 then
		    kfname = "佛光普照"
	    end
        --金蛇奥义
        if WAR.JSAY == 1 then
            kfname = "奥义・金蛇狂舞"
        end
		--青蟒剑
        if WAR.QMJ == 1 then
            kfname = "青蟒剑"
        end
		--陈正德
        if WAR.CZD == 1 then
            kfname = "无情三绝斩"
        end
        --莫大七弦无形剑 奥义
        if WAR.QXWXJ == 1 then
            kfname = "绝技・七弦无形剑・无形剑气"
        end	
        --周威信呼延十八鞭显示倍数
        if wugong == 206 and match_ID(pid, 612) and WAR.ZWX > 0 then
            kfname = kfname.." X "..WAR.ZWX
        end 
        --卓天雄呼延十八鞭显示倍数
        if wugong == 206 and match_ID(pid, 613) and WAR.ZWX > 0 then
            kfname = kfname.." X "..WAR.ZWX
        end 	
        --卓天雄震天铁掌显示倍数
        if wugong == 205 and match_ID(pid,613) and WAR.ZWX > 0 then
            kfname = kfname.." X "..WAR.ZWX
        end 	
		--葵花点穴手 点穴大师
        if Curr_NG(pid,105) and PersonKF(pid,105) and wugong == 226 and WAR.KHZF > 0 then
			kfname = kfname.." X "..WAR.KHZF
        end	
        --何铁手五毒显示倍数
        if wugong == 3 and (match_ID(pid,83) or match_ID(pid,9814) or Curr_NG(pid,220)) and WAR.HTS > 0 then
            kfname = kfname.." X "..WAR.HTS
        end 
        --・云罗天网
        if WAR.YLTW > 0 then
            kfname = "【云罗天网】・"..kfname
        end
		if WAR.SSYB == 1 then
			kfname = "【间不容发・殊死一搏】・"..kfname
        end
        --井月八法
        if WAR.KZJYBF > 0 then
            local bf = {"一","二","三","四","五","六","七","八"}
			local DFWZ = {"不攻", "击奇", "战定", "用谋", "速战", "棋弈", "兵诈", "方圆"}
			kfname = "【井月八法】・"..bf[WAR.KZJYBF].." 式・"..DFWZ[WAR.KZJYBF]
        end	
		--周公剑意
		if WAR.PD["周公剑意"][pid] == 7 and BNJQ(pid) then
            kfname = "【周公剑奥义・霞光千道】"..kfname
        end	
        if WAR.JTYJ1 == 1 then
            kfname = "『惊天一剑』・"..kfname
        end 
		--大九天手
        if wugong == 340 and WAR.DJTS > 0 then
      	    local jt = {"钧天","苍天","变天","玄天","幽天","颢天","朱天","炎天","阳天"}
						kfname = "大九天手・"..jt[WAR.DJTS]
        end 
	    --全真七星剑法
		if wugong == 39 and WAR.QZ_QXJF > 0 then
			local qx = {"天枢贪狼","天璇巨门","天玑禄存","天权文曲","玉衡廉贞","开阳武曲","瑶光破军"}
			kfname = "七星七王剑・"..qx[WAR.QZ_QXJF]
		end
		if (wugong == 39 or wugong == 42 or wugong == 139) and WGZH(pid,39,42) then
	        kfname = "【双剑合璧】・"..kfname
	    end 	  
	    if WAR.BXXHSJ == 1 then
	        kfname = "【雪花神剑】・"..kfname
	    end
		if WAR.JSLZ > 0 then
			if PersonKF(pid,4) and PersonKF(pid,11) then
				kfname = "九重冥阴・狱龙毒爪"
			else
				kfname = "九死龙爪手"
			end
		end	
		if WAR.SYWGZ > 0 and WAR.JSLZ < 1 then
			if WAR.SYWGZ == 2 then
				kfname = "幽毒淬命・"..kfname
			else
				kfname = "淬毒手・"..kfname
			end
		end	
		if wugong == 25 and WAR.ARJX > 0 then
			local str = ''
			if WAR.ARJX == 1 then
		    	str = "天地妒・未信与"
			elseif WAR.ARJX == 2 then
		        str = "相思无用・惟别而已"
			elseif WAR.ARJX == 3 then
		        str = "别期若有定・千般煎熬又何如"
		    elseif WAR.ARJX == 4 then
		        str = "莫道黯然销魂・何处柳暗花明"
		    elseif WAR.ARJX == 5 then
		        str = "黯然销魂者・唯别而已矣"
		    end
		        kfname = kfname..'・'..str  
		end    	
	    --内功显示随机到的系
        if WAR.NGXS > 0 and wugong ~= 93 then
				if actor(pid,6) and JXPD(pid,0,2) then
					WAR.NGXS = 6
				else
				    WAR.NGXS = math.random(1,5)
				end
	            local display = {"拳罡","指力","剑气","刀风","奇术","化气成兵"}
				kfname = kfname.."・"..display[WAR.NGXS]
	        end	
			if NGQH(pid,102) then
				kfname = "太玄・万般皆通・"..kfname
			end
			if wugong == 377 and WAR.WYSJ > 0 then
				if WAR.WYSJ == 1 then
					kfname = "五岳神剑・北・静心守剑"
				elseif WAR.WYSJ == 2 then
					kfname = "五岳神剑・东・七星落长空"
				elseif WAR.WYSJ == 3 then
					kfname = "五岳神剑・南・衡山五神剑"	
				elseif WAR.WYSJ == 4 then
					kfname = "五岳神剑・中・天外玉龙"	
				elseif WAR.WYSJ == 5 then
					kfname = "五岳神剑・西・夺命三仙剑"	
				end
			end	
			
	    ---------------对招---------------
        if ZHEN_ID >= 0 then
			if WAR.DUIZHAO == 10 and (match_ID(WAR.Person[ZHEN_ID]["人物编号"],27) or match_ID(WAR.Person[ZHEN_ID]["人物编号"],777)) then
				kfname = "真解・葵花刺目"
			elseif WAR.DUIZHAO == 20 and match_ID(WAR.Person[ZHEN_ID]["人物编号"],50) then
				kfname = "擒龙・九龙护体"	
			elseif WAR.DUIZHAO == 30 and match_ID(WAR.Person[ZHEN_ID]["人物编号"],5) then
				kfname = "太极・以静制动"	
			elseif WAR.DUIZHAO == 40 and match_ID(WAR.Person[ZHEN_ID]["人物编号"],114) then
			    kfname = "化气・无形气墙"		
			elseif WAR.DUIZHAO == 50 and (psx(WAR.Person[ZHEN_ID]["人物编号"],"门派技能3") == 2 or psx(0,"门派技能3") == 2) then--and MuRongDZ(WAR.Person[ZHEN_ID]["人物编号"]) and 
			    kfname = "以彼之道・还施彼身"		
			elseif WAR.DUIZHAO == 60 and match_ID(WAR.Person[ZHEN_ID]["人物编号"],520) then
			    kfname = "奥义・无天剑境"		
			end 	
            --kfname = "双人合击・"..kfname
        end
        
        --特效文字4和武功名称显示
        if wugong > 0 or WAR.hit_DGQB == 1 then				--使用武功时才显示，独孤求败反击也显示
            if WAR.Person[WAR.CurID]["特效文字4"] ~= nil then
                for k=0, 30, 4 do
                    local i = k 
                    if i > 20 then 
                        i = 20 
                    end	
                    Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
                    local n, strs = Split(WAR.Person[WAR.CurID]["特效文字4"], "・");
                    local len = string.len(WAR.Person[WAR.CurID]["特效文字4"]);
                    local color = RGB(255,40,10);
                    local off = 0;
                    for j=1, n do
                        if strs[j] == "连击" or strs[j] == "天赋外功.炉火纯青" 
                        or strs[j] == "碧箫声里双鸣凤" or strs[j] == "英雄无双风流婿" or strs[j] == "刀光掩映孔雀屏" 
                        or strs[j] == "太极之形.圆转不断" then
                            color = M_LightBlue;
                        elseif strs[j] == "左右互搏" or strs[j] == "左右互搏・真谛" then
                            color = M_DarkOrange
                        else
                            color = RGB(255,40,10);
                        end
                        if j > 1 then
                            strs[j] = strs[j];
                            off = off + 42
                        end		
                        DrawStrBox(-1, 10 + off, strs[j], color, 10+i) 
                    end
                    ShowScreen()
                    lib.Delay(CC.BattleDelay)
                end
            end
			--连锁显示
			if math.max(WAR.URCHAIN, WAR.MYCHAIN) > 1 and WAR.ACT == 1 then
			    for i = 15, 30 do					
				    NewDrawString(-1, 100, "连锁"..math.max(WAR.URCHAIN, WAR.MYCHAIN).."段", M_DarkOrange, 15 + i)
				    ShowScreen();
				    if i == 30 then
					    Cls();							
					    NewDrawString(-1, 100, "连锁"..math.max(WAR.URCHAIN, WAR.MYCHAIN).."段", C_GOLD, 15 + i)
					    ShowScreen();
					    lib.Delay(500);
				    else
					    lib.Delay(2);
				    end						
			    end		
		    end
            --武功显示
            for n = 5, 20 do
                local i = n 
                if i > 10 then 
                    i = 10
                end
                Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
                KungfuString(kfname, CC.ScreenW / 2 -#kfname/2, CC.ScreenH / 3 - 20 - hb  , C_GOLD, CC.FontBig+i, CC.FontName, 0)
                ShowScreen()
                lib.Delay(CC.BattleDelay)  
            end
        end
	
           
        --显示攻击动画
        for i = 0, framenum - 1 do
            if JY.Restart == 1 then
                break
            end
            local tstart = lib.GetTime()
            local mytype = nil
            if fightframe > 0 then
                WAR.Person[WAR.CurID]["贴图类型"] = 1
                mytype = 101+JY.Person[pid]['头像代号']
                if i < fightframe then
                    WAR.Person[WAR.CurID]["贴图"] = (startframe + WAR.Person[WAR.CurID]["人方向"] * fightframe + i) * 2
                end
            else
                WAR.Person[WAR.CurID]["贴图类型"] = 0
                WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
                mytype = 0
            end
        
            if ZHEN_ID >= 0 then
                if ZHEN_fightframe > 0 then
                    WAR.Person[ZHEN_ID]["贴图类型"] = 1
                    
                    if i < ZHEN_fightframe and i < oldframe - 1 then
                        WAR.Person[ZHEN_ID]["贴图"] = (ZHEN_startframe + WAR.Person[ZHEN_ID]["人方向"] * ZHEN_fightframe + i) * 2
                    else
                        WAR.Person[ZHEN_ID]["贴图"] = WarCalPersonPic(ZHEN_ID)
                    end
                else
                    WAR.Person[ZHEN_ID]["贴图类型"] = 0
                    WAR.Person[ZHEN_ID]["贴图"] = WarCalPersonPic(ZHEN_ID)
                end
                SetWarMap(WAR.Person[ZHEN_ID]["坐标X"], WAR.Person[ZHEN_ID]["坐标Y"], 5, WAR.Person[ZHEN_ID]["贴图"])
            end
        
            if i == sounddelay then
                PlayWavAtk(JY.Wugong[wugong]["出招音效"])		--
            end
            
            if i == fightdelay then
                PlayWavE(eft)
            end
        
            --六脉神剑的音效
            if i == 1 and WAR.LMSJwav == 1 then
                PlayWavAtk(31)
                WAR.LMSJwav = 0
            end
			
            if i == 1 and WAR.JNTM == 1 then
                PlayWavAtk(33)
                WAR.JNTM = 0
            end
        
            local pic = WAR.Person[WAR.CurID]["贴图"] / 2
            
            lib.SetClip(0, 0, 0, 0)
            
            oldpic = pic
            oldpic_type = mytype
        
            --无酒不欢：攻击特效文字显示 8-3
        
            if i < fightdelay then
                WarDrawMap(4, pic * 2, mytype, -1)
                
                --袁承志暴击倍数显示
                --仅限我方
                if match_ID(pid, 54) and isteam(pid) and using_anqi == 0 and WAR.BJ == 1 then
                    local cri_factor = 1.5 + 0.1 * JY.Base["天书数量"]
                    KungfuString("暴击×"..cri_factor, CC.ScreenW -230 +i*2, CC.ScreenH / 3 - 50 - hb -i*2, C_RED, CC.FontBig+i*2, CC.FontName, 0)
                end
                
                if i == 1 and WAR.Person[WAR.CurID]["特效动画"] ~= -1 then
                    local theeft = WAR.Person[WAR.CurID]["特效动画"]
                    local sf = 0
                    for ii = 0, theeft - 1 do
                        sf = sf + CC.Effect[ii]
                    end
                    
                    for ii = 1, CC.Effect[theeft] do
                        lib.GetKey()
                        
                        Cat('实时特效动画')	
                        WarDrawMap(6, pic * 2, mytype,  (sf+ii)*2, nil, 3, nil, nil)
                        Cat('实时特效动画2')
                        --lib.PicLoadCache(3, (sf+ii) * 2, CC.ScreenW/2 , CC.ScreenH/2  - hb, 2, 192, nil, 0, 0)	
                        if WAR.Person[WAR.CurID]["特效文字0"] ~= nil then
                            KungfuString(WAR.Person[WAR.CurID]["特效文字0"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_ORANGE, CC.FontSmall5, CC.FontName, 4)
                        end
                        if WAR.Person[WAR.CurID]["特效文字1"] ~= nil then
                            KungfuString(WAR.Person[WAR.CurID]["特效文字1"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_RED, CC.FontSmall5, CC.FontName, 3)
                        end
                        if WAR.Person[WAR.CurID]["特效文字2"] ~= nil then
                            KungfuString(WAR.Person[WAR.CurID]["特效文字2"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_GOLD, CC.FontSmall5, CC.FontName, 2)
                        end
                        if WAR.Person[WAR.CurID]["特效文字3"] ~= nil then
                            KungfuString(WAR.Person[WAR.CurID]["特效文字3"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_WHITE, CC.FontSmall5, CC.FontName, 1)
                        end
                        --Cat('实时特效动画2')
                        ShowScreen()
                        lib.Delay(CC.BattleDelay)
                    
                    end
                    WAR.Person[WAR.CurID]["特效动画"] = -1
                else
                    if WAR.Person[WAR.CurID]["特效文字0"] ~= nil or WAR.Person[WAR.CurID]["特效文字1"] ~= nil or WAR.Person[WAR.CurID]["特效文字2"] ~= nil or WAR.Person[WAR.CurID]["特效文字3"] ~= nil then
                        Cat('实时特效动画')	
                        WarDrawMap(4, pic * 2, mytype, -1)
                        Cat('实时特效动画2')
                        KungfuString(WAR.Person[WAR.CurID]["特效文字0"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_ORANGE, CC.FontSmall5, CC.FontName, 4)
                        KungfuString(WAR.Person[WAR.CurID]["特效文字1"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_RED, CC.FontSmall5, CC.FontName, 3)
                        KungfuString(WAR.Person[WAR.CurID]["特效文字2"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_GOLD, CC.FontSmall5, CC.FontName, 2)
                        KungfuString(WAR.Person[WAR.CurID]["特效文字3"], CC.ScreenW / 2, CC.ScreenH /768*265 - hb, C_WHITE, CC.FontSmall5, CC.FontName, 1)
                    else 
                        Cat('实时特效动画')	
                        WarDrawMap(4, pic * 2, mytype, -1)
                        Cat('实时特效动画2')
                    end
                end
            else
                
                for k = 0,WAR.PersonNum-1 do
                    local sx,sy = WAR.Person[k]['坐标X'],WAR.Person[k]['坐标Y']
                    if WAR.Person[k]['死亡'] == false then
                        if WAR.Person[k]['闪避'] == true then

                            if GetWarMap(sx,sy,4) <= 10 then 
                                SetWarMap(sx,sy,4,11)
                            else 
                                SetWarMap(sx,sy,4,GetWarMap(sx,sy,4)+1) 
                            end
                        end
                    end		
                end
                
                --人物动作计算
                if i <= oldframe-1 then
                starteft = starteft + 1
                else   
                starteft = -1
                end  
            
                Cat('实时特效动画')
				
				WarDrawMap(4, pic * 2, mytype, (starteft) * 2, nil, 3, ex, ey)
                
                Cat('实时特效动画2')
                oldeft = starteft
            
                if WAR.MissPd == 0 then
                    if oldframe < framenum then 
                        if i == oldframe-1 then
                            break
                        end 
                    else 
                        if i == framenum-1 then
                            break
                        end
                    end
                end
            end
            ShowScreen()
            lib.Delay(CC.BattleDelay);
            lib.GetKey();
        end
        WAR.Person[WAR.CurID]['特效文字0'] = nil;
        WAR.Person[WAR.CurID]['特效文字1'] = nil;
        WAR.Person[WAR.CurID]['特效文字2'] = nil;
        WAR.Person[WAR.CurID]['特效文字3'] = nil;
        WAR.Person[WAR.CurID]['特效文字4'] = nil;
        WAR.Person[WAR.CurID]['特效动画'] = -1;
        
      --lib.SetClip(0, 0, 0, 0)
        WAR.Person[WAR.CurID]["贴图类型"] = 0
        WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
        WAR.MissPd = 0
        WarSetPerson()
        Cat('实时特效动画')
        WarDrawMap(0)
        Cat('实时特效动画2')
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local yc = math.ceil(200/CC.BattleDelay)
        for j = 1,yc do
            Cat('实时特效动画')
            WarDrawMap(2)
            Cat('实时特效动画2')
            ShowScreen()
            lib.Delay(CC.BattleDelay)
        end
    end
end


---执行医疗，解毒用毒暗器的子函数，自动医疗也可调用
function War_ExecuteMenu_Sub(x1, y1, flag, thingid)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local x0 = WAR.Person[WAR.CurID]["坐标X"]
	local y0 = WAR.Person[WAR.CurID]["坐标Y"]
	CleanWarMap(4, 0)
	WAR.ShowHP = 0
	WAR.Person[WAR.CurID]["人方向"] = War_Direct(x0, y0, x1, y1)
	SetWarMap(x1, y1, 4, 1)
	local emeny = GetWarMap(x1, y1, 2)
	if emeny >= 0 then
		if flag == 1 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] then
			Cat('神游太虚2')
      --木凭 顾影自怜
			Cat('顾影自怜')
			if myzd(emeny) == false then
                WAR.Person[emeny]["中毒点数"] = War_PoisonHurt(pid, emeny)
                WAR.TXXS[WAR.Person[emeny]["人物编号"]] = 1
			end
			SetWarMap(x1, y1, 4, 5)
		elseif flag == 2 and WAR.Person[WAR.CurID]["我方"] == WAR.Person[emeny]["我方"] then
			WAR.Person[emeny]["解毒点数"] = ExecDecPoison(pid, WAR.Person[emeny]["人物编号"])
            SetWarMap(x1, y1, 4, 6)
            WAR.TXXS[WAR.Person[emeny]["人物编号"]] = 1
		elseif flag == 3 then
			--医生单独判定
			if WAR.Person[WAR.CurID]["人物编号"] == 0 and JY.Base["标准"] == 8 then
			  
			elseif WAR.Person[WAR.CurID]["我方"] == WAR.Person[emeny]["我方"] then
			    WAR.Person[emeny]["生命点数"] = ExecDoctor(pid, WAR.Person[emeny]["人物编号"])
				SetWarMap(x1, y1, 4, 4)
				WAR.TXXS[WAR.Person[emeny]["人物编号"]] = 1
			end
		--暗器
		elseif flag == 4 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[emeny]["我方"] then
			Cat('神游太虚2')
      --木凭 顾影自怜
			Cat('顾影自怜')
			--葵花尊者反击暗器
			if ((WAR.Person[emeny]["人物编号"] == 27) or (WAR.Person[emeny]["人物编号"] == 92) or (WAR.Person[emeny]["人物编号"] == 777) or (WAR.Person[emeny]["人物编号"] == 776)) 
				and match_ID(WAR.Person[WAR.CurID]["人物编号"],498) == false and WAR.CLFJ[pid] == nil then
				CleanWarMap(4, 0)
				local orid = WAR.CurID
				WAR.CurID = emeny
				
				WAR.Person[WAR.CurID]["人方向"] = War_Direct(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], x0, y0)
				
				Cls()
				local KHZZ = {"无知的"..JY.Person[0]["外号2"],"竟然想班门弄斧","吃我的葵花神针"}
				for n = 1, #KHZZ + 25 do
					local i = n 
					if i > #KHZZ then 
						i = #KHZZ
					end
					lib.GetKey()
					Cat('实时特效动画')
                    Cls()
                    Cat('实时特效动画2')
					DrawString(-1, -1, KHZZ[i], C_GOLD, CC.Fontsmall)
					ShowScreen()
					lib.Delay(CC.BattleDelay)
				end
				SetWarMap(x0, y0, 4, 1)
				WAR.Person[orid]["生命点数"] = (WAR.Person[orid]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[orid]["人物编号"], "生命", -400)
				WAR.PD['扫荡群魔'][orid] = (WAR.PD['扫荡群魔'][orid] or 0) + math.random(5,10)
				if myzd(orid) == false then
					WAR.Person[orid]["中毒点数"] = (WAR.Person[orid]["中毒点数"] or 0) + AddPersonAttrib(WAR.Person[orid]["人物编号"], "中毒程度", 150)
				end
				WAR.TXXS[WAR.Person[orid]["人物编号"]] = 1
				WAR.KHSZ = 1
				War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, -1, 0, x0, y0, 35)
				WAR.KHSZ = 0
				WAR.CurID = orid
				return 1
			end	
			if WAR.Person[emeny]["人物编号"] == 517 and match_ID(WAR.Person[WAR.CurID]["人物编号"],498) == false and WAR.CLFJ[pid] == nil then
				CleanWarMap(4, 0)
				local orid = WAR.CurID
				WAR.CurID = emeny
				WAR.Person[WAR.CurID]["人方向"] = War_Direct(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], x0, y0)
				Cls()
				local YYLL = {"无知者无畏啊……","愿黄泉路上的细雨，能让你悔恨你的愚蠢"}
				for n = 1, #YYLL + 25 do
					local i = n 
					if i > #YYLL then 
						i = #YYLL
					end
					lib.GetKey()
					Cat('实时特效动画')
					Cls()
					Cat('实时特效动画2')
					DrawString(-1, -1, YYLL[i], C_GOLD, CC.Fontsmall)
					ShowScreen()
					lib.Delay(CC.BattleDelay)
				end
				SetWarMap(x0, y0, 4, 1)
				WAR.Person[orid]["生命点数"] = (WAR.Person[orid]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[orid]["人物编号"], "生命", -800)
				WAR.PD['西域奇毒'][orid] = (WAR.PD['西域奇毒'][orid] or 0) + math.random(5,10)
				if myzd(orid) == false then
					WAR.Person[orid]["中毒点数"] = (WAR.Person[orid]["中毒点数"] or 0) + AddPersonAttrib(WAR.Person[orid]["人物编号"], "中毒程度", 150)
				end
				WAR.PD['夜雨绵延'][orid] = limitX((WAR.PD['夜雨绵延'][orid] or 0) +10,0,999)
				WAR.TXXS[WAR.Person[orid]["人物编号"]] = 1
				WAR.YYLZ = 1
				War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, -1, 0, x0, y0, 35)
				WAR.YYLZ = 0
				WAR.CurID = orid
				return 1
			end	
			--亦复如是
			if match_ID(WAR.Person[emeny]["人物编号"],577) and match_ID(WAR.Person[WAR.CurID]["人物编号"],498) == false and WAR.CLFJ[pid] == nil then
				local orid = WAR.CurID
				WAR.CurID = emeny
				Cls()
				WAR.Person[orid]["生命点数"] = (WAR.Person[orid]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[orid]["人物编号"], "生命", -1000)
				WAR.TXXS[WAR.Person[orid]["人物编号"]] = 1
				War_ShowFight(WAR.Person[WAR.CurID]["人物编号"], 0, -1, 0, x0, y0, 35)
				WAR.CurID = orid
				return 1
			end		

			--独孤求败免疫暗器
			if match_ID(WAR.Person[emeny]["人物编号"],592) and match_ID(WAR.Person[WAR.CurID]["人物编号"],498) == false and WAR.CLFJ[pid] == nil then
				local orid = WAR.CurID
				WAR.CurID = emeny
				Cls()
				CurIDTXDH(WAR.CurID, 137,1, "料敌先机・破箭式", C_GOLD)
				WAR.CurID = orid
				return 1
			end	
			--免疫暗器
			if match_ID(WAR.Person[emeny]["人物编号"],641) and  match_ID(WAR.Person[WAR.CurID]["人物编号"],498) == false  and WAR.CLFJ[pid] == nil then
				local orid = WAR.CurID
				WAR.CurID = emeny
				Cls()
				WAR.CurID = orid
				return 1
			end	
			--竹风雨滴
			if match_ID(WAR.Person[emeny]["人物编号"],520) and  match_ID(WAR.Person[WAR.CurID]["人物编号"],498) == false and WAR.CLFJ[pid] == nil then
				local orid = WAR.CurID
				WAR.CurID = emeny
				Cls()
				CurIDTXDH(WAR.CurID, 93,1, "剑气护体", C_GOLD)
				WAR.CurID = orid
				return 1
			end	
			--标主
			if WAR.Person[emeny]["人物编号"] == 0 and JXPD(WAR.Person[emeny]["人物编号"],5,1) and  match_ID(WAR.Person[WAR.CurID]["人物编号"],498) == false and WAR.CLFJ[pid] == nil then
				local orid = WAR.CurID
				WAR.CurID = emeny
				Cls()
				CurIDTXDH(WAR.CurID, 93,1, "灵犀一指", C_GOLD)
				WAR.CurID = orid
				return 1
			end
			--暗器随机伤害倍数
			WAR.AQBS = math.random(3)

			if match_ID(pid, 83) then  --何铁手3-5倍
				WAR.AQBS = math.random(3,5)
			end
			
			if match_ID(pid, 92) then --喵太极3-8倍
				WAR.AQBS = math.random(3,8)
			end

			--袁承志用金蛇锥必定三倍
			if (match_ID(pid, 54) and thingid == 30) or match_ID(pid, 498) then
				WAR.AQBS = 3
			end
			--夏雪宜用金蛇锥三~五倍
			if match_ID(pid, 639) and thingid == 30 then
				WAR.AQBS = math.random(3,5)
			end				
			--李寻欢暗器攻击倍数
			if  WAR.XLFD[pid] ~= nil  then
				if JXPD(pid,498,1) and JLSD(35, 55, pid) then
					WAR.AQBS = math.random(5,10)
				else	
					WAR.AQBS = math.random(3,5)
				end	
			end
			if MPTX(pid,9,3) then
				WAR.AQBS = WAR.AQBS + math.random(2,4)
			end
			if AnqiWG(pid) and WAR.AQBS > 0 then
				WAR.AQBS = WAR.AQBS + math.random(2,3)
				AddPersonAttrib(pid,"暗器技巧",math.modf(WAR.AQBS*4))
			end	
			
			if AnqiWG(pid,458) 
			and WAR.YFZ[pid] == nil and WAR.HFXZ[pid] == nil and WAR.TMFJ[pid] == nil and WAR.CLFJ[pid] == nil and WAR.CSFJ[pid] == nil 
			and WAR.KHFJ[pid] == nil and WAR.LMWZ[pid] == nil and WAR.HLFJ[pid] == nil and WAR.WDFJ[pid] == nil and WAR.SWFJ[pid] == nil 
			and flag == 4 then
				WAR.BPYZ = math.random(1,4)
				if BNJQ(pid) then
					if (WAR.SPIRIT[pid] or 0) >= 120 or JXPD(pid,161,1) then
						WAR.BPYZ1 = 2
					else
						WAR.BPYZ1 = 1
					end
				end	
			end	
			
			if AnqiWG(pid,459)
			and WAR.YFZ[pid] == nil and WAR.HFXZ[pid] == nil and WAR.TMFJ[pid] == nil and WAR.CLFJ[pid] == nil and WAR.CSFJ[pid] == nil 
			and WAR.KHFJ[pid] == nil and WAR.LMWZ[pid] == nil and WAR.HLFJ[pid] == nil and WAR.WDFJ[pid] == nil and WAR.SWFJ[pid] == nil
			and flag == 4 then
				WAR.SSFZ = math.random(1,3)
				if BNJQ(pid) then
					if (WAR.SPIRIT[pid] or 0) >= 120 or match_ID(pid,117) or match_ID(pid,634) then
						WAR.SSZF1 = 2
					else
						WAR.SSFZ1 = 1
					end
				end	
			end	
			
			if AnqiWG(pid,450) 
			and WAR.YFZ[pid] == nil and WAR.HFXZ[pid] == nil and WAR.TMFJ[pid] == nil and WAR.CLFJ[pid] == nil and WAR.CSFJ[pid] == nil 
			and WAR.KHFJ[pid] == nil and WAR.LMWZ[pid] == nil and WAR.HLFJ[pid] == nil and WAR.WDFJ[pid] == nil and WAR.SWFJ[pid] == nil
			and flag == 4 then
				WAR.PLLH = math.random(1,3)
				if BNJQ(pid) then
					if (WAR.SPIRIT[pid] or 0) >= 120 or match_ID(pid,626) then
						WAR.PLLHD = 2
					else
						WAR.PLLHD = 1
					end
				end	
			end	
			
			if AnqiWG(pid,460) 
			and WAR.YFZ[pid] == nil and WAR.HFXZ[pid] == nil and WAR.TMFJ[pid] == nil and WAR.CLFJ[pid] == nil and WAR.CSFJ[pid] == nil 
			and WAR.KHFJ[pid] == nil and WAR.LMWZ[pid] == nil and WAR.HLFJ[pid] == nil and WAR.WDFJ[pid] == nil and WAR.SWFJ[pid] == nil
			and flag == 4 then
				WAR.TGZ = math.random(1,3)
				if BNJQ(pid) then
					if (WAR.SPIRIT[pid] or 0) >= 120 or match_ID(pid,57) then
						WAR.TGZ1 = 2
					else
						WAR.TGZ1 = 1
					end
				end	
			end	
			if AnqiWG(pid,469) 
			and WAR.YFZ[pid] == nil and WAR.HFXZ[pid] == nil and WAR.TMFJ[pid] == nil and WAR.CLFJ[pid] == nil and WAR.CSFJ[pid] == nil 
			and WAR.KHFJ[pid] == nil and WAR.LMWZ[pid] == nil and WAR.HLFJ[pid] == nil and WAR.WDFJ[pid] == nil and WAR.SWFJ[pid] == nil
			and flag == 4 then
				WAR.HXSZ = math.random(1,2)
				if BNJQ(pid) or ZYJQ(pid) or match_ID(pid,27) or match_ID(pid,777) then
					WAR.HXSZ1 = 1
				end	
			end
			
			--何铁手使用暗器为7*7方阵
			if (JY.Person[pid]["门派技能2"] == 458 or JXPD(pid,161,1)) and WAR.BPYZ1 > 0 and flag == 4 then
				CleanWarMap(4, 0)
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
						local id = GetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2)
						WAR.Person[id]["生命点数"] = War_AnqiHurt(WAR.CurID, id, thingid)
						SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 4)
					end
				end
			elseif AnqiWG(pid,450) and WAR.PLLHD > 0 and flag == 4 then
			    CleanWarMap(4, 0)
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 1)
						local id = GetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2)
						WAR.Person[id]["生命点数"] = War_AnqiHurt(WAR.CurID, id, thingid)
						SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 4, 4)
					end
				end
			elseif (match_ID(pid, 83) or match_ID(pid, 27) or match_ID(pid, 777) or match_ID(pid, 456)) and flag == 4 then
				--暗器随机伤害倍数
				for ex = x1 - 6, x1 + 6 do
					for ey = y1 - 6, y1 + 6 do
						SetWarMap(ex, ey, 4, 1)
						if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
							local ep = GetWarMap(ex, ey, 2)
							if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
								WAR.Person[ep]["生命点数"] = War_AnqiHurt(WAR.CurID, ep, thingid)
								SetWarMap(ex, ey, 4, 4)
							end
						end
					end
				end
			elseif match_ID(pid,498) and  JY.Base["天书数量"] > 5 and flag == 4 then
				for ex = x1 - 5, x1 + 5 do
					for ey = y1 - 5, y1 + 5 do
						SetWarMap(ex, ey, 4, 1)
						if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
							local ep = GetWarMap(ex, ey, 2)
							if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
								WAR.Person[ep]["生命点数"] = War_AnqiHurt(WAR.CurID, ep, thingid)
								SetWarMap(ex, ey, 4, 4)
							end
						end
					end
				end
			elseif AnqiWG(pid) and flag == 4 then
				for ex = x1 - 4, x1 + 4 do
					for ey = y1 - 4, y1 + 4 do
						SetWarMap(ex, ey, 4, 1)
						if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
							local ep = GetWarMap(ex, ey, 2)
							if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
								WAR.Person[ep]["生命点数"] = War_AnqiHurt(WAR.CurID, ep, thingid)
								SetWarMap(ex, ey, 4, 4)
							end
						end
					end
				end	
			else
				WAR.Person[emeny]["生命点数"] = War_AnqiHurt(WAR.CurID, emeny, thingid)
				SetWarMap(x1, y1, 4, 2)
			end
		end
	end
			
	--主角医生方阵医疗
	if flag == 3 and actor(pid,8) then
		for ex = x1 - 3, x1 + 3 do
			for ey = y1 - 3, y1 + 3 do
				SetWarMap(ex, ey, 4, 1)
				if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
					local ep = GetWarMap(ex, ey, 2)
					if WAR.Person[WAR.CurID]["我方"] == WAR.Person[ep]["我方"] then
						WAR.Person[ep]["生命点数"] = ExecDoctor(pid, WAR.Person[ep]["人物编号"])
						SetWarMap(ex, ey, 4, 4)
						WAR.Effect = 4
					end
				end        
			end
		end
	end
	--张三	
	if (match_ID(pid,41) or match_ID(pid,9825)) and WAR.ZSSS == 1 then
		for ex = x1 - 6, x1 + 6 do
			for ey = y1 - 6, y1 + 6 do
				SetWarMap(ex, ey, 4, 1)
				if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
					local ep = GetWarMap(ex, ey, 2)
					if dead(ep) == false and WAR.Person[WAR.CurID]["我方"] == WAR.Person[ep]["我方"] then
						WAR.Person[ep]["Life_Before_Hit"] = JY.Person[WAR.Person[ep]["人物编号"]]["生命"]
						if isteam(pid) then
							WAR.Person[ep]["生命点数"] = ExecDoctor(pid, WAR.Person[ep]["人物编号"])
						else
							WAR.Person[ep]["生命点数"] = (WAR.Person[ep]["生命点数"] or 0) + AddPersonAttrib(WAR.Person[ep]["人物编号"], "生命", 500)
						end
						SetWarMap(ex, ey, 4, 4)
						WAR.Effect = 4
					end
				end        
			end
		end
		--Cat('数值显示')
	end
	--李四	标记修改 幽冥血河2
	if (match_ID(pid,42) or match_ID(pid,9824)) and WAR.LSFE == 1 then
		for ex = x1 - 6, x1 + 6 do
			for ey = y1 - 6, y1 + 6 do
				SetWarMap(ex, ey, 4, 1)
				if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
					local ep = GetWarMap(ex, ey, 2)
					if dead(ep) == false and (WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"]) and RealJL(WAR.CurID,ep,5) then
						if myzd(ep) == false then
							if isteam(pid) then
								WAR.Person[ep]["中毒点数"] = War_PoisonHurt(pid,ep)
							else
								WAR.Person[ep]["中毒点数"] = (WAR.Person[ep]["中毒点数"] or 0) + AddPersonAttrib(WAR.Person[ep]["人物编号"], "中毒程度", 150)
							end
						end
						SetWarMap(ex, ey, 4, 5)
						WAR.Effect = 5
						WAR.TXXS[WAR.Person[ep]["人物编号"]] = 1
					end
				end        
			end
		end
		--Cat('数值显示')
	end

	--主角毒王方阵上毒，可以给自己上毒
	if flag == 1 and actor(pid,9) then
		for ex = x1 - 3, x1 + 3 do
			for ey = y1 - 3, y1 + 3 do
				SetWarMap(ex, ey, 4, 1)
				if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
					local ep = GetWarMap(ex, ey, 2)
					if (WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"]) or ep == WAR.CurID then
						if myzd(ep) == false then
							WAR.Person[ep]["中毒点数"] = War_PoisonHurt(pid,ep)
						end
						SetWarMap(ex, ey, 4, 5)
						WAR.Effect = 5
					end
				end        
			end
		end
	end

	if flag == 1 then
		War_ShowFight(pid, 0, 0, 0, x1, y1, 30)
	elseif flag == 2 then
		War_ShowFight(pid, 0, 0, 0, x1, y1, 36)
	elseif flag == 3 then
		War_ShowFight(pid, 0, 0, 0, x1, y1, 0)
	elseif flag == 4 and (emeny >= 0 or match_ID(pid, 83)) then
		War_ShowFight(pid, 0, -1, 0, x1, y1, thingid)
	end
	
	Cat('数值显示')
	DrawTimeBar2()
	if flag == 4 then
		if emeny >= 0 or match_ID(pid, 83) then
			if inteam(pid) then
				instruct_32(thingid, -1)
			end	
			--张家辉的隐身戒指
			if JY.Person[pid]["防具"] == 304 then
				local cd = 40
				if JY.Thing[304]["装备等级"] >=5 then
					cd = 20
				elseif JY.Thing[304]["装备等级"] >=3 then
					cd = 30
				end
				WAR.YSJZ = cd
			end
			return 1
		else
			return 0
		end
	else
		WAR.Person[WAR.CurID]["经验"] = WAR.Person[WAR.CurID]["经验"] + 1
		if WAR.ZSSS==1 or WAR.LSFE==1 then
		else
		AddPersonAttrib(pid, "体力", -2)
		end
	end
  
	if isteam(pid) then
		if WAR.ZSSS==1 or WAR.LSFE==1 then
		else
		AddPersonAttrib(pid, "体力", -4)
		end
	end
	return 1
end

--绘画动态集气条
--[[function DrawTimeBar3()
	local x1,x2,y = CC.ScreenW * 1 / 2 - 34, CC.ScreenW * 19 / 20 - 2, CC.ScreenH/10 + 29
	local draw = false
	local drawframe = false
    for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["死亡"] == false then
			if WAR.Person[i].TimeAdd < 0 then
				drawframe = true
				break
			end
		end
	end
	if drawframe == true then
		DrawBox_1(x1 - 3, y, x2 + 3, y + 3, C_ORANGE)
		DrawBox_1(x1 - (x2 - x1) / 2, y, x1 - 3, y + 3, C_RED)
		DrawString(x2 + 10, y - 20, "时序", C_WHITE, CC.FontSMALL)
		lib.FillColor(x1+1, y+1, x1+90, y+3,C_ORANGE)
		lib.FillColor(x1-94, y+1, x1-6, y+3,C_RED)
	end
	local surid = lib.SaveSur(x1 - (10 + (x2 - x1) / 2), 0, x2 + 10 + 20 + 30, y * 2 + 18 + 25)
	while true do
	draw = false
	for i = 0, WAR.PersonNum - 1 do
	  	local pid = WAR.Person[i]["人物编号"];
	    if WAR.Person[i]["死亡"] == false then
	    	if WAR.Person[i].TimeAdd < 0 then
		        draw = true
		        WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 20
		        if WAR.Person[i].TimeAdd > 0 then
		      	    WAR.Person[i].TimeAdd = 0;
		        end
		        if WAR.Person[i].Time > -500 then
		            WAR.Person[i].Time = WAR.Person[i].Time - 20
				end
			elseif WAR.Person[i].TimeAdd > 0 then
			  	draw = true
			  	WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 20
			  	WAR.Person[i].Time = WAR.Person[i].Time + 20
			  	if WAR.Person[i].Time > 995 then
			  		WAR.Person[i].Time = 995;
				end
			end
		end
	end
	if draw then
	    lib.LoadSur(surid, x1 - (10 + (x2 - x1) / 2), 0)
		DrawTimeBar_sub(x1, x2, y, 1)
		ShowScreen()
		lib.Delay(8)
	else
		break;
	end
	end
	lib.Delay(100)
	lib.FreeSur(surid)
end	]]

--无酒不欢：挨打后，绘画动态集气条的判定
function DrawTimeBar2()
	local x1,x2,y = CC.ScreenW * 1 / 2 - 34, CC.ScreenW * 19 / 20 - 2, CC.ScreenH/10 + 29
	local draw = false
	local heal_amount;
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	--这三个是固定的，只需要加载一次就可以了
	--无酒不欢：这里也要判定是否有需要draw，如无需要则不加载
	local drawframe = false
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["死亡"] == false then
			if WAR.Person[i].TimeAdd ~= 0 then
				drawframe =  true
				break
			end
		end
	end
	if drawframe == true then
		DrawString(x2 + 10-410, y - 60-25, "时序", C_WHITE, CC.DefaultFont*0.8)	
    --    lib.LoadPicture("./data/xt/23.png",0,0,1)	
		lib.LoadPNG(91, 23 * 2 , 310, 55, 1)
	end
	
	--local surid = lib.SaveSur(x1 - (10 + (x2 - x1) / 2), 0, x2 + 10 + 20 + 30, y * 2 + 18 + 25)
	local pd = false 
	while true do
		if JY.Restart == 1 then
			break
		end
		lib.GetKey()
		draw = false

		for i = 0, WAR.PersonNum - 1 do
			lib.GetKey()
			local pid = WAR.Person[i]["人物编号"];
			--首先判定人物是否活着
            if WAR.Person[i]["死亡"] == false then
                if match_ID(pid, 114) and WAR.Person[i].TimeAdd < 0 then 
                    WAR.Person[i].TimeAdd = 0
                end
                --逍遥御风累积9点，未行动前不会被杀气
                if WAR.XYYF[pid] ~= nil and WAR.XYYF[pid] == 11 and WAR.Person[i].TimeAdd < 0 then
                    WAR.Person[i].TimeAdd = 0
                end
				--龟息功
                if Curr_NG(pid, 227) and WAR.Defup[pid] ~= nil and WAR.Defup[pid] > 0 then 
                    if WAR.Person[i].TimeAdd < 0 then 
                        WAR.Person[i].TimeAdd = 0
                    end
                end
				--这里TimeAdd小于0代表集气位置要减少，数值为减少总量
				if WAR.Person[i].TimeAdd < 0 then
					draw = true
					--减量以20为单位循环增加，增加到超过0时，判定将不再成立，既停止减少集气位置
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + 20
					if WAR.Person[i].TimeAdd > 0 then
						WAR.Person[i].TimeAdd = 0;
					end					
					--如果人物的集气位置没有达到-500，则减少20，向-500靠近
					if WAR.Person[i].Time > -500 then
						--如果主运金刚狮子吼，则不会低于300
						--李寻欢
						if Curr_NG(pid,91) or match_ID(pid,498) then
							if WAR.Person[i].Time > 300 then
								WAR.Person[i].Time = WAR.Person[i].Time - 20
								if WAR.Person[i].Time <= 300 then
									WAR.Person[i].Time = 300
									WAR.Person[i].TimeAdd = 0
								end
							end
						--被动金刚狮子吼，不低于0
						elseif PersonKF(pid,91) or match_ID(pid,581) then
							if WAR.Person[i].Time > 0 then
								WAR.Person[i].Time = WAR.Person[i].Time - 20
								if WAR.Person[i].Time <= 0 then
									WAR.Person[i].Time = 0
									WAR.Person[i].TimeAdd = 0
								end
							end
						--双剑合壁杀气不会低于-200  
						elseif WGZH(pid,39,42) then
							if WAR.Person[i].Time > -200 then
								WAR.Person[i].Time = WAR.Person[i].Time - 20
								if WAR.Person[i].Time <= -200 then
									WAR.Person[i].Time = -200
									WAR.Person[i].TimeAdd = 0
								end
							end
						--青城天罗步
						elseif MPTX(pid,28,2) then
							if WAR.Person[i].Time > 100 then
								WAR.Person[i].Time = WAR.Person[i].Time - 20
								if WAR.Person[i].Time <= 100 then
									WAR.Person[i].Time = 180
									WAR.Person[i].TimeAdd = 0
								end
							end
						else
							WAR.Person[i].Time = WAR.Person[i].Time - 20
						end
					--如果人物的集气位置已经达到-500，则集气位置不再减少，而是转换为内伤
					else
						for k = 0,-WAR.Person[i].TimeAdd,20 do
							if JY.Person[pid]["受伤程度"] < 100 then
								AddPersonAttrib(pid, "受伤程度", math.random(5,15))
							else 
								WAR.Person[i].TimeAdd = 0
								break
							end
						end	
						WAR.Person[i].TimeAdd = 0
					end
					if match_ID(pid,456) then
						if WAR.Person[i].Time <= 0 then
							if WAR.PD["遮蔽"][pid] == nil then
								WAR.PD["遮蔽"][pid] = 1
								heal_amount = JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"]
								heal_amount = math.modf(heal_amount*0.3)
								WAR.Person[WAR.CurID]["生命点数"] = AddPersonAttrib(pid, "生命", heal_amount)
								Cls()
								War_Show_Count(WAR.CurID, "蔽日遮天")
							end
						end
					end
					--先天神照
					if WAR.Person[i].Time <= -200 and PersonKF(pid,100) then	--练了先天功后，当集气被杀到-200，内伤直接清0
						--WAR.Person[i].TimeAdd = -300
						WAR.Person[i].TimeAdd = 0
						JY.Person[pid]["受伤程度"] = 0;
						heal_amount = JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"]
						if WAR.PD['先天护盾'][pid] ~= nil and WAR.PD['先天护盾'][pid] > 0 then
							heal_amount = heal_amount + (WAR.PD['先天护盾'][pid] or 0)
						end
						if Curr_NG(pid, 100) then
							heal_amount = math.modf(heal_amount * 0.3)
						else
						    heal_amount = math.modf(heal_amount * 0.15)
						end
						if MPTX(pid,16) then
							heal_amount = heal_amount*1.5
						end
						WAR.Person[WAR.CurID]["生命点数"] = AddPersonAttrib(pid, "生命", heal_amount)
						WAR.Person[WAR.CurID]["内力点数"] = AddPersonAttrib(pid, "内力", heal_amount)
						Cls()
						War_Show_Count(WAR.CurID, "先天功恢复生命、内力")
					end	
					if NGQH(pid,171) or match_ID(pid,5) then
					    if WAR.Person[i].Time < 0 then
							local jq = math.modf((0 - WAR.Person[i].Time)/4)
							if JLSD(0,jq+5,pid) then
								heal_amount = JY.Person[pid]["生命最大值"]
								heal_amount = math.modf(heal_amount*0.05)
								if WAR.PD["以静制动1"][pid] == nil then
									WAR.PD["以静制动1"][pid] = 3
									War_Show_Count(WAR.CurID, "以静制动")
								end
							end
						end
					end			
					--易水寒
					if NGQH(pid,43) then
						--WAR.Person[i].TimeAdd = -300
						WAR.Person[i].TimeAdd = 0
						JY.Person[pid]["受伤程度"] = 0;
						heal_amount = JY.Person[pid]["内力最大值"] - JY.Person[pid]["内力"]
						if WAR.PD['易水寒冰'][pid] ~= nil and WAR.PD['易水寒冰'][pid] > 0 then
							heal_amount = heal_amount + (WAR.PD['易水寒冰'][pid] or 0)
						end
						WAR.Person[WAR.CurID]["生命点数"] = AddPersonAttrib(pid, "生命", heal_amount)
						--WAR.Person[WAR.CurID]["内力点数"] = AddPersonAttrib(pid, "内力", heal_amount)
						Cls()
						War_Show_Count(WAR.CurID, "易水寒诀恢复生命")
					end			
				--大于0代表集气位置要增加，
				elseif WAR.Person[i].TimeAdd > 0 then
					draw = true
					--增量以20为单位循环减少，减少到低于0时，判定将不再成立，既停止增加集气位置
					WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd - 20
					--人物的集气位置以20为单位增加，如果集气位置超过995，则强制定为995
					WAR.Person[i].Time = WAR.Person[i].Time + 20
					if WAR.Person[i].Time > 995 then
						WAR.Person[i].Time = 995;
						WAR.Person[i].TimeAdd = 0
					end
				end
			end
		end
		
        if draw then	
            Cls()	 
			Cat('实时特效动画')
            DrawTimeBar_sub()
            Cat('实时特效动画2')
			ShowScreen()
			lib.Delay(CC.BattleDelay)
			pd = true
		else 
			break
		end

	end
	if pd == true then
		local n = math.ceil(400/CC.BattleDelay)
        for i = 1,n do 
            Cls()
			Cat('实时特效动画')
            DrawTimeBar_sub()
            Cat('实时特效动画2')
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
end

--绘制集气条
function DrawTimeBar()
	--local x1,x2,y = CC.ScreenW * 1 / 2 - 34, CC.ScreenW * 19 / 20 - 2, CC.ScreenH/10 + 29
	local xunhuan = true
    
	--local xh = 0
    local jqwz = 0
	local atid = -1
	if WAR.ATK['人物'] ~= nil then
		atid = WAR.ATK['人物']
		WAR.ATK['人物'] = nil
		goto label1
	end
    WAR.ZYHB = 0
    
	if #WAR.ATK['人物table'] > 0 then
		atid = WAR.ATK['人物table'][#WAR.ATK['人物table']]
		local id = WAR.Person[atid]['人物编号']
		table.remove(WAR.ATK['人物table'],#WAR.ATK['人物table'])
		WAR.ATK['人物pd'][id] = nil
		if #WAR.ATK['人物table'] == 0 then 
			WAR.ATK['人物table'] = {}
		end
		goto label1
	end
    
	while xunhuan do
    if JY.Restart == 1 then
			break
		end
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["死亡"] == false then
				local jqid = WAR.Person[i]["人物编号"]
				local jq = WAR.Person[i].TimeAdd	--人物集气速度
				local jqxs = 1
				if WAR.PD["秘孔战术"][jqid] ~= nil then
					if JXPD(jqid,456,1) and math.random(10) < 4 then
					else
					    WAR.PD["秘孔战术"][jqid] = WAR.PD["秘孔战术"][jqid] - 1
					end
					if JY.Person[jqid]["生命"] > 1 then
					    JY.Person[jqid]["生命"] = 1
					end
					if WAR.PD["秘孔战术"][jqid] < 1 then
						WAR.PD["秘孔战术"][jqid] = nil
						JY.Person[jqid]["生命"] = 0
						WAR.Person[i]["死亡"] = true
						if WAR.PD['死葬者'][jqid] ~= nil then
							WAR.PD['死葬发动'][WAR.PD['死葬者'][jqid]] = nil
							WAR.PD['死葬者'][jqid] = nil
						end	
						lib.SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 5, -1)	
						WarSetPerson()
                        break
					end
				end
				if WAR.PD["无我之境"][jqid] ~= nil and WAR.PD["无我之境"][jqid] > 0 then
					WAR.PD["无我之境"][jqid] = WAR.PD["无我之境"][jqid] + 1
					if WAR.PD["无我之境"][jqid] > 51 then
						WAR.PD["无我之境"][jqid] = 51
						if WAR.PD["无我之境"][jqid] == 51 then
							say("哈哈！今日吾已尽兴，此生得遇敌手，足矣！", 592, 1);
						end
						JY.Person[jqid]["生命"] = 0
						WAR.Person[i]["死亡"] = true
						WarSetPerson()
                        break
					end
				end
				--日月神教・三尸脑神丹
				if WAR.PD["三尸脑神丹"][jqid] ~= nil then
					AddPersonAttrib(jqid, "生命",-10)
					if (WAR.LQZ[jqid] or 0) < 100 then
						WAR.LQZ[jqid] = 100
					end
					WAR.PD["三尸脑神丹"][jqid] = WAR.PD["三尸脑神丹"][jqid] - 1
                    if WAR.PD["三尸脑神丹"][jqid] <= 0 then
                        WAR.PD["三尸脑神丹"][jqid] = nil
						JY.Person[jqid]["生命"] = 0
						WAR.Person[i]["死亡"] = true
						WarSetPerson()
                        break
					end
				end
				--曼珠沙华，每时序掉1%血
                if WAR.JYZT[jqid] ~=nil then
					JY.Person[jqid]["生命"]	 = JY.Person[jqid]["生命"] - JY.Person[jqid]["生命最大值"]*1/100
                    --[[AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.01))--]]
                    if JY.Person[jqid]["生命"] < 1 then
						if match_ID(jqid,456) then
							JY.Person[jqid]["生命"] = 1
						else
						    JY.Person[jqid]["生命"] = 0
                            WAR.Person[i]["死亡"] = true
                            WarSetPerson()
                            break
						end
                    end
                end
				--怒涛玄铁
				if WAR.PD['玄铁剑创'][jqid] ~= nil and WAR.PD['玄铁剑创'][jqid] > 0 then
					local sm = JY.Person[jqid]["生命最大值"] - (WAR.PD['玄铁剑创'][jqid] or 0) * 10
					local nl = JY.Person[jqid]["内力最大值"] - (WAR.PD['玄铁剑创'][jqid] or 0) * 10
					if sm < 1 then
						sm = 1
					end
					if nl < 1 then
						nl = 1
					end
					if JY.Person[jqid]["生命"] > sm then
						JY.Person[jqid]["生命"] = sm
					end
					if JY.Person[jqid]["内力"] > nl then
						JY.Person[jqid]["内力"] = nl
					end
				end	
				--点桑专属
				if match_ID(jqid,457) and WAR.DSZS[i] ~= nil then
					for j,v in pairs(WAR.DSZS[i]) do 
						if WAR.DSZS[i][j] ~= nil and WAR.DSZS[i][j] > 0 then 
							WAR.DSZS[i][j] = WAR.DSZS[i][j] - 1
							local df = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["死亡"] == false then 
								AddPersonAttrib(df, "生命", -math.modf(TrueYJ(jqid)*0.08))
								AddPersonAttrib(jqid, "生命", math.modf(TrueYJ(jqid)*0.02))
							end
							if WAR.DSZS[i][j] <= 0 then 
								WAR.DSZS[i][j] = nil
							end
						end
					end
				end
				--令狐冲剑界
				if (JXPD(jqid,35,1) and PersonKF(jqid,88)) or JXPD(jqid,457,1) then
					for j = 0, WAR.PersonNum-1 do 
						local df = WAR.Person[j]["人物编号"] 
						local offset1 = math.abs(WAR.Person[i]["坐标X"] - WAR.Person[j]["坐标X"]) 
						local offset2 = math.abs(WAR.Person[i]["坐标Y"] - WAR.Person[j]["坐标Y"])
						local offset=offset1+offset2
						local mpdj=math.modf(TrueYJ(jqid)/30)
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false and (offset1<=mpdj and offset2<=mpdj) then
							local xn=10+mpdj
							if offset<=10 then
								xn=xn+math.modf(offset*2)
							end
							local xx=math.modf(xn/2)
							if math.random(30)<4+mpdj then
								xx=xx*3
							end			 
							if math.random(10)<4+mpdj then
								AddPersonAttrib(df,"流血程度",math.random(5))
							end
							if JY.Person[df]["流血程度"] > 0 then 
								AddPersonAttrib(df, "生命", -xx)
							end
						end
					end	
				end
				--南子九阳阵法
				if match_ID(jqid,525) then
					AddPersonAttrib(jqid,'灼烧程度',2)
				end	
				if WAR.PD['九阳护盾'][jqid] ~= nil and WAR.PD['九阳护盾'][jqid] > 0 
				and match_ID(jqid,525) and JY.Person[jqid]["灼烧程度"] ~= nil and JY.Person[jqid]["灼烧程度"] > 0 then
					for j = 0, WAR.PersonNum-1 do 
						local df = WAR.Person[j]["人物编号"] 
						local offset1 = math.abs(WAR.Person[i]["坐标X"] - WAR.Person[j]["坐标X"]) 
						local offset2 = math.abs(WAR.Person[i]["坐标Y"] - WAR.Person[j]["坐标Y"])
						local offset=offset1+offset2
						local zsfw = math.modf(JY.Person[jqid]["灼烧程度"] / 10)
						local zssn = math.modf(JY.Person[jqid]["灼烧程度"] / 8)
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false 
						and (offset1 <= zsfw and offset2 <= zsfw) then
						    AddPersonAttrib(jqid, "内力",zsfw * 9)
							AddPersonAttrib(df,"灼烧程度",math.random(9))
							if JY.Person[df]["灼烧程度"] > 0 then 
								AddPersonAttrib(df, "内力", -zssn)
							end
							if JY.Person[df]["灼烧程度"] > 50 then
								WAR.PD['无明业火'][df] = limitX((WAR.PD["无明业火"][df] or 0) + 1,0,20)
							end
							if JY.Person[df]["冰封程度"] > 50 then
								WAR.PD['冰冻状态'][df] = limitX((WAR.PD["冰冻状态"][df] or 0) + 1,0,50)
							end
						end
					end	
				end
				--蛤蟆逆运
		        if NGQH(jqid,95) then
					WAR.HMJT[jqid] = (WAR.HMJT[jqid] or 0) + 30
			   	    if WAR.HMJT[jqid] >= 3000 and WAR.HMJT[jqid] ~= nil then
          	            for j = 0, WAR.PersonNum - 1 do
                            if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"]  then
                                if nokillspeed(j) == false then
					                ztd(j,'集气位置',-math.modf(WAR.HMJT[jqid]/5))
				                end	
								ztd(j,'生命点数',-math.modf(WAR.HMJT[jqid]/8))
                            end
                        end
						ztd(i,'生命点数',math.modf(WAR.HMJT[jqid]/8))
						WAR.HMJT[jqid] = 300
                        local tmppid = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 189, 1, "蛤蟆气泡弹", LightSkyBlue)	
						WAR.CurID = tmppid
                    end
                end
				--令狐冲、任我行吸星结界1
				--日月3级
				if (MPTX(jqid,12,3) and Curr_NG(jqid,88)) or JXPD(jqid,35,1) or match_ID(jqid,26) or match_ID(jqid,457) then
					for j = 0, WAR.PersonNum-1 do 
				    local df = WAR.Person[j]["人物编号"] 
				    local offset1 = math.abs(WAR.Person[i]["坐标X"] - WAR.Person[j]["坐标X"]) 
				    local offset2 = math.abs(WAR.Person[i]["坐标Y"] - WAR.Person[j]["坐标Y"])
				    local offset = offset1 + offset2
				    local mpdj = MPDJ(jqid)		
					    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false and (offset1 <= mpdj and offset2 <= mpdj) then
							local xn = 10
							xn = xn + math.modf(offset * mpdj)
							if offset<=10 then
								offset=11-offset
								xn=xn+math.modf(offset*2)
							end
							local xx = math.modf(xn/2*mpdj)
							if JY.Person[df]["流血程度"] > 0 then 
								AddPersonAttrib(df, "生命", -xx)
								AddPersonAttrib(jqid, "生命", xx)
							end
							AddPersonAttrib(df, "内力", -xn)
							AddPersonAttrib(jqid, "内力", xn)	
							WAR.XXQF[df] = (WAR.XXQF[df] or 0) + xx
							WAR.XXQG[jqid] = (WAR.XXQG[jqid] or 0) + xx
						end
					end		    		
				end	
				--天罗地网
				if Curr_QG(jqid,148) and (match_ID(jqid,59) or match_ID(jqid,605) or match_ID(jqid,455)) then
					local x1 = WAR.Person[i]["坐标X"];
					local y1 = WAR.Person[i]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								local epid = WAR.Person[ep]["人物编号"]
								if WAR.Person[i]["我方"] ~= WAR.Person[ep]["我方"] then 
									WAR.PD["龙女天罗"][epid] = 1  
								end
							end
						end
					end
				end

				--天魔气场
				if NGQH(jqid,160) then
					local x1 = WAR.Person[i]["坐标X"];
					local y1 = WAR.Person[i]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								local epid = WAR.Person[ep]["人物编号"]
								if WAR.Person[i]["我方"] ~= WAR.Person[ep]["我方"] then 
									WAR.PD["虚弱状态"][epid] = 10  
									if WAR.PD['迟缓状态'][epid] == nil or WAR.PD['迟缓状态'][epid] < 30 then
										WAR.PD['迟缓状态'][epid] = 30
									end
									if NQBF(epid) then
										if WAR.PD['灵蛇拳'][epid] == nil or WAR.PD['灵蛇拳'][epid] < 15 then
											WAR.PD['灵蛇拳'][epid] = 15
										end
									end	
								end
							end
						end
					end
				end
				
				--周天星辰
				if NGQH(jqid,190) then
					WAR.PD['举火燎原'][jqid] = nil
					WAR.PD['无明业火'][jqid] = nil 
					local x1 = WAR.Person[i]["坐标X"];
					local y1 = WAR.Person[i]["坐标Y"];
					for ex = x1 - 10, x1 + 10 do
						for ey = y1 - 10, y1 + 10 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								local epid = WAR.Person[ep]["人物编号"]
								if JY.Person[epid]["流血程度"] > 0 then
									AddPersonAttrib(epid,"生命",-5)
									AddPersonAttrib(jqid,"生命",5)
								end
							end
						end
					end
					for j = 0, WAR.PersonNum-1 do
						local jid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and inteam(jid) then
							AddPersonAttrib(jid,"冰封程度",-3)
							AddPersonAttrib(jid,"灼烧程度",-3)
							WAR.PD['举火燎原'][jid] = nil
							WAR.PD["利刃寒锋"][jid] = (WAR.PD["利刃寒锋"][jid] or 0) - 3
							if WAR.PD["利刃寒锋"][jid] < 1 then
								WAR.PD["利刃寒锋"][jid] = nil
							end	
							WAR.PD["冰冻状态"][jid] = (WAR.PD["冰冻状态"][jid] or 0) - 3
							if WAR.PD["冰冻状态"][jid] < 1 then
								WAR.PD["冰冻状态"][jid] = nil
							end
						end
					end	
				end
				
				--金刚领域
				if WAR.PD["金刚萨"][jqid] ~= nil then
					local x1 = WAR.Person[i]["坐标X"];
					local y1 = WAR.Person[i]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								local epid = WAR.Person[ep]["人物编号"]
								if WAR.Person[i]["我方"] ~= WAR.Person[ep]["我方"] then 
									if WAR.LQZ[epid] ~= nil and WAR.LQZ[epid] >= 0 then
										nuqi(epid,-5)
									end
								end
							end
						end
					end
					Cat('清除低级异常',i)
					WAR.PD["金刚萨"][jqid] = WAR.PD["金刚萨"][jqid] - 1
                    if WAR.PD["金刚萨"][jqid] <= 0 then
                        WAR.PD["金刚萨"][jqid] = nil
                    end
				end
				--残日狱衣领域
				if WAR.PD['残日狱衣'][jqid] ~= nil and (match_ID(jqid,103) or match_ID(jqid,745) or match_ID(jqid,771)) and JLSD(10,30,jqid) then
					for j = 0, WAR.PersonNum - 1 do 
						if dead(j) == false and DWPD(i,j) and RealJL(i,j,15) then
							local crid = WAR.Person[j]['人物编号']
							if RealJL(i,j,5) then
								AddPersonAttrib(crid,'灼烧程度',15)
							elseif RealJL(i,j,10) then
								AddPersonAttrib(crid,'灼烧程度',10)
							else
								AddPersonAttrib(crid,'灼烧程度',5)
							end
						end
					end
				end		
				--打狗奥义					
				if WAR.PD['缠字决'][jqid] == 1 then 
					for j = 0, WAR.PersonNum - 1 do
						local df = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							if WAR.Person[i].Time < WAR.Person[j].Time then
								WAR.Person[i].Time = WAR.Person[j].Time + 10
								if WAR.Person[i].Time > 1000 then
									WAR.Person[i].Time = 1000
								end
			                end
						end
					end
				end
				--竹风雨滴集气领域
				if match_ID(jqid,520) then
					local a = 1
					local lx = 10
					for j = 0, WAR.PersonNum - 1 do
						local df = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							if WAR.Person[i].Time < WAR.Person[j].Time then
								WAR.Person[i].Time = WAR.Person[j].Time
								WAR.Person[j].Time = WAR.Person[i].Time - 200
								if WAR.Person[i].Time > 1000 then
									WAR.Person[i].Time = 1000
								end
							else
							    WAR.PD['战神状态'][jqid] = 1
			                end	
							lx = math.abs(WAR.Person[j].Time)/10
							local sm = a*(1-JY.Person[df]["生命"]/JY.Person[df]["生命最大值"])*lx + 10
							AddPersonAttrib(WAR.Person[i]["人物编号"], "生命", sm)
							AddPersonAttrib(WAR.Person[j]["人物编号"], "生命", -sm)
							if JY.Person[WAR.Person[j]["人物编号"]]["生命"] <= 0 then
								JY.Person[WAR.Person[j]["人物编号"]]["生命"] = 0
							end
							if RealJL(i,j,20) then
								local yc = JY.Person[df]["流血程度"] + JY.Person[df]["受伤程度"] + JY.Person[df]["封穴程度"] + JY.Person[df]["冰封程度"] + JY.Person[df]["中毒程度"] + JY.Person[df]["灼烧程度"]
								AddPersonAttrib(df,"生命",-math.modf(yc/3))
								AddPersonAttrib(jqid,"内力",math.modf(yc/3))
								if RealJL(i,j,15) then
									AddPersonAttrib(jqid,'生命',-math.modf(yc/5))
									AddPersonAttrib(jqid,"体力",math.modf(yc/100))
								end
								if JY.Person[df]["生命"] <= 0 then
									JY.Person[df]["生命"] = 0
									WAR.Person[j]['死亡'] = true 
								end  
							end	 	
						end
					end	
					WAR.ZHHF[jqid] = 1
				end
				--施施
				if match_ID(jqid,754) then
					local a = 0
					for j = 0, WAR.PersonNum - 1 do
						local df = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							a = a * 2 + 1
							local sm = a * (1 - JY.Person[df]["内力"] / JY.Person[df]["内力最大值"]) * jq
							AddPersonAttrib(WAR.Person[i]["人物编号"], "内力", sm)
							AddPersonAttrib(WAR.Person[j]["人物编号"], "内力", -sm)
							if JY.Person[WAR.Person[j]["人物编号"]]["内力"] <= 0 then
								JY.Person[WAR.Person[j]["人物编号"]]["内力"] = 0
							end
						end
					end	
				end
				--点点特殊战境界斩杀
				if jqid == 457 and WAR.ZDDH == 402 and WAR.RWSZ == 2 then
					for j = 0, WAR.PersonNum - 1 do
						local df = WAR.Person[j]["人物编号"] 
					    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							if JY.Person[df]["畅想分阶"] > 3 then
								JY.Person[df]["生命"] = 0
								WAR.Person[j]["死亡"] = true
								say("哇，这么弱也想收我，回去再练练吧！", 457, 1);
								WarSetPerson()
								break
							end
						end
					end
				end
				--任我行最终战殊死一搏
				if jqid == 26 and WAR.ZDDH == 424 then
					for j = 0, WAR.PersonNum-1 do
					local df = WAR.Person[j]["人物编号"] 
					    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							if WAR.PD['集气倒退'][jqid] ~=nil then
								WAR.PD['集气倒退'][df] = WAR.PD['集气倒退'][jqid]
							end
							if WAR.PD['伏魔逆气'][jqid] ~=nil then
								WAR.PD['伏魔逆气'][df] = WAR.PD['伏魔逆气'][jqid]
							end
							if WAR.PD['灵蛇拳'][jqid] ~=nil then
								WAR.PD['灵蛇拳'][df] = WAR.PD['灵蛇拳'][jqid]
							end
							if WAR.PD['利刃寒锋'][jqid] ~=nil then
								WAR.PD['利刃寒锋'][df] = WAR.PD['利刃寒锋'][jqid]
							end
							if WAR.PD['走火入魔'][jqid] ~=nil then
								WAR.PD['走火入魔'][df] = WAR.PD['走火入魔'][jqid]
							end
							if WAR.PD['无招胜有招'][jqid] ~=nil then
								WAR.PD['无招胜有招'][df] = WAR.PD['无招胜有招'][jqid]
							end
						end
					end
				end
				--观止平衡光环
				if match_ID(jqid,456) then
					AddPersonAttrib(jqid,"生命",-JY.Person[jqid]["生命最大值"]*0.12)
				end
				if JXPD(jqid,456,1) then
					JY.Person[jqid]["生命"] = JY.Person[jqid]["生命"] - JY.Person[jqid]["生命最大值"]*0.1
					if JY.Person[jqid]["生命"] < 1 then
						JY.Person[jqid]["生命"] = 0
					end
					local pd = false
					if math.random(10) < 4 then
						pd = true
					end	
					for j = 0, WAR.PersonNum-1 do
						local df = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							local ss = JY.Person[jqid]["生命最大值"]
							local ss1 = JY.Person[df]["生命最大值"]
							local nl = JY.Person[jqid]["内力最大值"]
							local nl1 = JY.Person[df]["内力最大值"]
							local dqsm = JY.Person[jqid]["生命"]
							local dqsm1 = JY.Person[df]["生命"]
							local dqnl = JY.Person[jqid]["内力"] 
							local dqnl1 = JY.Person[df]["内力"] 
							local dqtl = JY.Person[jqid]["体力"] 
							local dqtl1 = JY.Person[df]["体力"] 
							local smbl =  dqsm/ss
							local smbl1 = dqsm1/ss1
							local nlbl = dqnl/nl
							local nlbl1 = dqnl1/nl1
							local jmm = 10 - (WAR.PD['九命猫'][jqid] or 0)
							if jmm < 1 then
								jmm = 0
							end
							if smbl < smbl1 and dqsm > 0 then
								AddPersonAttrib(jqid,"生命", dqsm * 0.01 * jmm)
								AddPersonAttrib(WAR.Person[j]["人物编号"],"生命",-dqsm1 * 0.01 * jmm)
							end
							if nlbl < nlbl1 then
								AddPersonAttrib(jqid,"内力", dqnl * 0.01 * jmm)
								AddPersonAttrib(WAR.Person[j]["人物编号"],"内力",-dqnl1 * 0.01 * jmm)
							end
							if dqtl < dqtl1 then
								AddPersonAttrib(jqid,"体力", jmm)
								AddPersonAttrib(WAR.Person[j]["人物编号"],"体力",-jmm)
							end
							if smbl < 0.7 and smbl > 0.1 and smbl1 > smbl and dqsm > 0 and JXPD(jqid,456,1) then
								if WAR.JSX_Counter == 9 then
								    WarDrawMap(0)
						            CurIDTXDH(WAR.CurID, 242, 1, "吞天蔽日", PinkRed)
								    JY.Person[df]["生命"] = math.modf(smbl * JY.Person[df]["生命最大值"])
								end
							end
							if pd == true then
								WAR.PD['光明圣火'][df] = (WAR.PD['光明圣火'][df] or 0) + 1
								WAR.PD['阳气侵蚀'][df] = (WAR.PD['阳气侵蚀'][df] or 0) + 1
								WAR.PD['神经蛇毒'][df] = (WAR.PD['神经蛇毒'][df] or 0) + 1
								addbuff(df,WAR.PD['禁疗'],1,10)
								AddPersonAttrib(df,"流血程度",3)
								AddPersonAttrib(df,"冰封程度",3)
								AddPersonAttrib(df,"受伤程度",3)
								AddPersonAttrib(df,"灼烧程度",3)
								AddPersonAttrib(df,"中毒程度",3)
								AddPersonAttrib(df,"封穴程度",1)
								AddPersonAttrib(df,"体力",-2)
							end	
						end
					end
				end
				--东方葵花超速领域
				if (JXPD(jqid,27,1) or match_ID(jqid,777)) and PersonKF(jqid,105) and WAR.JQSDXS[jqid] ~= nil and WAR.JQSDXS[jqid] > 0 and math.random(10) <= 5 then
					local sm = math.modf((WAR.JQSDXS[jqid] or 0)/4)
					local nl = math.modf((WAR.JQSDXS[jqid] or 0)/5)
		            for zd = 0,WAR.PersonNum-1 do 
				        local zdid = WAR.Person[zd]["人物编号"]
		                if WAR.Person[zd]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[zd]["死亡"] == false then
					        AddPersonAttrib(zdid, "生命", -sm)
					        AddPersonAttrib(jqid, "生命", sm)
					        AddPersonAttrib(zdid, "内力", -nl)
					        AddPersonAttrib(jqid, "内力", nl)
				        end
					end
				end
				--妖风祸世领域
				if WAR.YFHS == 1 and YaoFengHuoShi(jqid) and math.random(10) <= 3 then	
					for j = 0, WAR.PersonNum - 1 do
						local jid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							addbuff(jid,WAR.PD['禁疗'],math.random(3),10)
							addbuff(jid,WAR.PD['意恍惚'],math.random(3),20)
							addbuff(jid,WAR.PD['回魂仙梦'],math.random(3),10)
							addbuff(jid,WAR.PD['神经蛇毒'],math.random(3),10)
						end
					end
				end
				--黄天无极领域
				if PersonKF(jqid,78) and Curr_QG(jqid,148) and PersonKF(jqid,55) and (WAR.PD['氤氤氲氲'][jqid] or 0) >= 100 then
					local ps = math.modf((WAR.PD['氤氤氲氲'][jqid] or 0)/30)
					local pd = ps*20
					AddPersonAttrib(jqid,'生命',pd)
					AddPersonAttrib(jqid,'体力',ps)
					for j = 0, WAR.PersonNum-1 do
						local df = WAR.Person[j]["人物编号"]
					    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							AddPersonAttrib(df,"生命",-pd)
							AddPersonAttrib(df,"体力",-ps)
						end
					end
				end
				--东方不败・花天狂骨
				if PersonKF(jqid,316) and (JXPD(jqid,27,2) or match_ID(jqid,777)) and WAR.PD['花天'][jqid] ~= nil then
					if WAR.PD['花天'][jqid] > 0 and WAR.PD['花天'][jqid] < 10 then
					    AddPersonAttrib(jqid, "体力", math.random(2))
					    WAR.PD['集气速度'][jqid] = limitX((WAR.PD['集气速度'][jqid] or 0) + math.random(2),0,20)
					    for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
						    if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
							    WAR.PD['初芽'][jid] = (WAR.PD['初芽'][jid] or 0) + math.random(2)
						    end
					    end
					elseif WAR.PD['花天'][jqid] > 9 and WAR.PD['花天'][jqid] < 15 then
					    AddPersonAttrib(jqid,'内力',math.modf(JY.Person[jqid]["生命最大值"]*0.01* math.random(2)))
					    for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
						    if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
							    WAR.PD['含苞'][jid] = (WAR.PD['含苞'][jid] or 0) + math.random(2)
						    end
					    end
					elseif WAR.PD['花天'][jqid] > 14 and WAR.PD['花天'][jqid] < 21 then
					    AddPersonAttrib(jqid,'内力',math.modf(JY.Person[jqid]["内力最大值"]*0.01* math.random(2)))
					    for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
						    if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
							    WAR.PD['绽放'][jid] = (WAR.PD['绽放'][jid] or 0) + math.random(2)
						    end
					    end
					elseif WAR.PD['花天'][jqid] > 20 and WAR.PD['花天'][jqid] < 30 then
					    for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
						    if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
							    WAR.PD['凋零'][jid] = (WAR.PD['凋零'][jid] or 0) + math.random(2)
						    end
					    end
					end
				end	
				if PersonKF(jqid,316) and (JXPD(jqid,27,2) or match_ID(jqid,777)) and (WAR.PD['花天'][jqid] or 0) == 30 then
					local ss = JY.Person[jqid]["生命最大值"]
                    local zd = JY.Person[jqid]["内力最大值"]
                    local bf = JY.Person[jqid]["生命"]
                    local zs = JY.Person[jqid]["内力"]
                    local dl = math.modf((ss - bf + zd - zs) / 120)
					WAR.PD['花天'][jqid] = nil
					zhanyi(jqid,200)
					WAR.PD['西瓜刀・天人'][jqid] = 10
					WAR.PD['神兵'][jqid] = 10
					WAR.PD['血淬'][jqid] = (WAR.PD['血淬'][jqid]) or 0 + dl
					local tmppid = WAR.CurID
					WAR.CurID = i
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 6, 1, "葵花奥义・花天狂骨", LightSkyBlue)
					WAR.CurID = tmppid
				end
				
				--无酒不欢：每10点内伤-1集气，每10点中毒-1集气，玩家与NPC一样
				local ns_factor = math.modf(JY.Person[jqid]["受伤程度"] / 10)
				local zd_factor = math.modf(JY.Person[jqid]["中毒程度"] / 10)
				
				if PersonKF(jqid, 238) then 
					ns_factor = 0
				end

				if PersonKF(jqid, 150) and MPTX(jqid,8) then 
					ns_factor = -ns_factor
				end

				--毒王中毒反而增加集气
				if actor(jqid,9) then
					zd_factor = -(zd_factor*2)
				end
				if MPTX(jqid,1) then
					if actor(jqid,9) then
						if PersonKF(jqid,87) then
							zd_factor = math.modf(zd_factor * 2.5)
						else
							zd_factor = zd_factor * 2
						end
					else
						if PersonKF(jqid,87) then
							zd_factor = -math.modf(zd_factor * 2)
						else
							zd_factor = -(zd_factor * 1.5)
						end	
					end	
				end
				if MPTX(jqid,8) and (not (actor(jqid,9))) then
					zd_factor = 0
				end	
				--冰封也减少集气
				local bf_factor = 0;
				if MPTX(jqid,20) and JY.Person[jqid]["冰封程度"] > 0 then
					local bf = math.modf(JY.Person[jqid]["冰封程度"] / 10)
					bf_factor = -bf
				elseif JY.Person[jqid]["冰封程度"] > 0 then
					bf_factor = 2
				elseif JY.Person[jqid]["冰封程度"] >= 25 then
					bf_factor = 4
				elseif JY.Person[jqid]["冰封程度"] >= 50 then
					bf_factor = 8
				elseif JY.Person[jqid]["冰封程度"] >= 75 then
					bf_factor = 16
				elseif JY.Person[jqid]["冰封程度"] > 100 then
					bf_factor = 24
				end
				--何太冲的铁琴减少集气，一层减少1%
				local HTC_tq = 0
				if WAR.PD["琴音状态"][jqid] ~= nil and (not QGQH(jqid,186,1)) then
					HTC_tq = jq * 0.015 * WAR.PD["琴音状态"][jqid]
				end
				local ZQTL_tq = 0
				if WAR.PD["冰冻状态"][jqid] ~= nil then
					if NGQH(jqid,190) or QGQH(jqid,186,1) or Curr_NG(jqid,367) then
						ZQTL_tq = 0
					else
						ZQTL_tq = math.modf((WAR.PD["冰冻状态"][jqid] or 0)/1.5)
						WAR.PD["冰冻状态"][jqid] = limitX(WAR.PD["冰冻状态"][jqid],0,40)
						if math.random(10) > 5 then
							WAR.PD["冰冻状态"][jqid] = WAR.PD["冰冻状态"][jqid] - 1
						else
						    WAR.PD["冰冻状态"][jqid] = WAR.PD["冰冻状态"][jqid] - 2
						end	
						if WAR.PD['冰冻扣血'][jqid] ~= nil then
							AddPersonAttrib(jqid,"生命",-((WAR.PD["冰冻状态"][jqid] or 0)*0.15))
							if WAR.PD['南子脏焰'][jqid] ~= nil then
								AddPersonAttrib(jqid,"生命",-((WAR.PD["冰冻状态"][jqid] or 0)*0.15))
							end	
						end	
						if (WAR.PD['易水四寒'][jqid] == 1 or WAR.PD['易水四寒'][jqid] == 5) and WAR.LQZ[jqid] ~= nil then
							nuqi(jqid,-(WAR.PD["冰冻状态"][jqid] or 0))
						end	
						if (WAR.PD['易水四寒'][jqid] == 2 or WAR.PD['易水四寒'][jqid] == 5) and WAR.SPIRIT[jqid] ~= nil then
							zhanyi(jqid,-(WAR.PD["冰冻状态"][jqid] or 0))
						end
						if (WAR.PD['阴阳双极'][jqid] or -1) >= 31 then
							if JLSD(10,25,jqid) then
								WAR.PD["冰冻状态"][jqid] = (WAR.PD["冰冻状态"][jqid] or 0) - 7
							end
						end
						if WAR.PD["冰冻状态"][jqid] < 1 then
							WAR.PD["冰冻状态"][jqid] = nil 
							WAR.PD['冰冻扣血'][jqid] = nil
						end	
					end	
				end
				local chzt_jq = 0
				--迟缓减少集气，一层减少1%
				if WAR.PD["迟缓状态"][jqid] ~= nil then
					if QGQH(jqid,186,1) or NGQH(jqid,204) or TFQG(jqid,304) then
						chzt_jq = 0
					else	
						chzt_jq = jq * 0.01 * WAR.PD["迟缓状态"][jqid]
					end
					WAR.PD["迟缓状态"][jqid] = limitX(WAR.PD["迟缓状态"][jqid],0,40)
					if Curr_QG(jqid,316) then
						WAR.PD["迟缓状态"][jqid] = WAR.PD["迟缓状态"][jqid] - 2
					else
					    WAR.PD["迟缓状态"][jqid] = WAR.PD["迟缓状态"][jqid] - 1
					end	
					if (WAR.PD['阴阳双极'][jqid] or -1) >= 31 then
						if JLSD(10,25,jqid) then
							WAR.PD["迟缓状态"][jqid] = WAR.PD["迟缓状态"][jqid] - 7
						end
					end
					if WAR.PD["迟缓状态"][jqid] < 1 then
						WAR.PD["迟缓状态"][jqid] = nil
					end	
				end
				local hsv_jq = 0
				--黄衫女 疾风增另集气 一层增加1.25%
				if WAR.JFJQ[jqid] ~= nil then
					hsv_jq = jq * (-0.125) * WAR.JFJQ[jqid]
				end					
				--李秋水集气不受状态影响
				if WAR.PD['重度内伤'][jqid] ~= nil then
					ns_factor = ns_factor * 2
				end	
				--一苇渡江
				if PersonKF(jqid,186) then
					ns_factor = 0 
					if (not MPTX(jqid,1)) then
						zd_factor = 0
					end	
					bf_factor = 0
				end
				if QGQH(jqid,150,1) and ns_factor > 0 then
					if match_ID(jqid,60) then
						ns_factor = - (math.modf(ns_factor*2))
					else
						ns_factor = - ns_factor
					end
				end	
				
				if (match_ID(jqid,457) and WAR.PD['虚邪剑来'][jqid] == 1) or match_ID(jqid,9774) then
					jq = jq 
				elseif match_ID(jqid, 118) or match_ID(jqid, 579) or (match_ID(jqid, 629) and BNJQ(jqid)) then
					jq = jq - zd_factor
				elseif NGQHB(jqid,99) then
					jq = jq - HTC_tq - chzt_jq - ZQTL_tq - hsv_jq
				else
					jq = jq - ns_factor - zd_factor - bf_factor - HTC_tq - chzt_jq - ZQTL_tq - hsv_jq
				end
				--防止集气小于0
				if jq < 0 then
					jq = 0
				end
				--扶摇九天
				if PersonKF(jqid, 239) then 
					local a = WAR.PD['扶摇九天'][jqid] or 0
					jq = jq + a
				end
				--九死龙爪
				if PersonKF(jqid,20) and PersonKF(jqid,4) and MPTX(jqid,1,3) then
					jq = jq + 10
				end	
				--翻江虎身手不凡
				if WGZH(jqid,59,232) then
					local jgfmq = 0
					for j = 0, WAR.PersonNum - 1 do
						if WGZH(WAR.Person[j]["人物编号"],59,232) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[i]["我方"] then
						jgfmq = jgfmq + 1
						end
					end
					if jgfmq >= 1 and math.random(10) < (3 + jgfmq) then
						jq = jq + 10;	
					end
				end
				--龙行
				for j = 0,  WAR.PersonNum-1 do
					local df = WAR.Person[j]["人物编号"]
					if QGQH(df,280,2) and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
						local zy = (WAR.SPIRIT[jqid] or 0) / 5
						jq = jq - zy
					end
				end
				--蛇行狸翻跳气、进阶效果
				if Curr_QG(jqid,224) then
					local qg = math.modf(Qg(i) * 0.04 + 1)		
					if qg < 11 then
						qg = 11
					end			
					local tq = math.random(20,100)
					local jl = math.random(10,qg)
					if Curr_NG(jqid,107) then
						jl = jl + 10
					end
					if match_ID(jqid,637) then
						jl = math.modf(jl*1.1)
						tq = math.modf(tq*1.1)
					end
					if QGQH(jqid,224,1) then
						tq = tq + 20
					end					
					if JLSD(0,jl,jqid) then
						if QGQH(jqid,224,1) then
							WAR.Person[i].Time = WAR.Person[i].Time + math.modf(tq/1.2)
						end
						for j = 0,  WAR.PersonNum-1 do
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"]  and WAR.Person[j]["死亡"] == false then
								local jid = WAR.Person[j]["人物编号"]
								if QGQH(jqid,224,1) and JLSD(10,50,jqid) then
									WAR.PD['迟缓状态'][jid] = (WAR.PD['迟缓状态'][jid] or 0) + math.random(3)
								end
								if TFQG(jqid,224) and JLSD(10,35,jqid) then
									WAR.PD['蛇行狸翻'][jid] = (WAR.PD['蛇行狸翻'][jid] or 0) + math.random(3)
								end
							end	
						end
					end
				end
				--玉女先天
				if NGQH(jqid,154) then
					local nq = WAR.LQZ[jqid] or 0
					for j = 0, WAR.PersonNum - 1 do
						local df = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							if WAR.LQZ[df] ~= nil and WAR.LQZ[df] > 0 then
								if nq < WAR.LQZ[df] then
									local jq = WAR.LQZ[df] - nq
									if jq > 60 then
										jq = 60
									end
									WAR.Person[i].Time = WAR.Person[i].Time + jq
									if WAR.Person[i].Time > 1000 then
										WAR.Person[i].Time = 1000
									end
								end
							end
						end
					end
				end
				--仓惶状态
				if WAR.PD['蛇行狸翻'][jqid] ~= nil then
					local jl = math.random(10,50)						
					local tq = math.random(20,100)						
					if QGQH(jqid,186,2) then
						AddPersonAttrib(jqid,"封穴程度",WAR.PD['蛇行狸翻'][jqid])
						WAR.PD['蛇行狸翻'][jqid] = nil
					else	
					    if JLSD(0,jl+15,jqid) then
							jq = jq - tq
						end
						if JLSD(0,jl,jqid) then
							--WAR.Person[i].Time = WAR.Person[i].Time + jq
							WAR.Person[i].Time = WAR.Person[i].Time - tq
						end
						WAR.PD['蛇行狸翻'][jqid] = limitX(WAR.PD["蛇行狸翻"][jqid],0,15)
						WAR.PD['蛇行狸翻'][jqid] = WAR.PD['蛇行狸翻'][jqid] - 1
						if WAR.PD['蛇行狸翻'][jqid] < 1 then
							WAR.PD['蛇行狸翻'][jqid] = nil
						end	
					end	
				end
				--易水寒
				if NGQH(jqid,43) then
					local a = math.random(15, 30)
					if BNJQ(jqid) then 
						a = a * 3
					end
					WAR.Person[i].Time = WAR.Person[i].Time + a
				end 	
				--修炼逆运跳气
				if PersonKF(jqid, 104) then 
					local a = math.random(10, 30);
					if BNJQ(jqid) then 
						a = a * 2
					end
					if JLSD(0,20,jqid) then
						jq = jq + a
					end
					--逆运组合
					if NGQH(jqid,104) and JLSD(10,30,jqid) then
						if WAR.L_NYZH[jqid] ~= nil then
							WAR.Person[i].Time = WAR.Person[i].Time + a
						else
						    jq = jq + a;
						end
					end
					--九阴逆运为跳气
					if NGQHB(jqid,104) and JLSD(0,20,jqid) then
						WAR.Person[i].Time = WAR.Person[i].Time + a
					end
				end
				--白驼逆运
				if MPTX(jqid,8,3) and Curr_NG(jqid,104) then
					local fx = (JY.Person[jqid]["封穴程度"] or 0) + 5
					if JLSD(0,fx,jqid) then
						WAR.Person[i].Time = WAR.Person[i].Time + fx
					end
				end
				--达摩九阳
		        if WAR.PD["苦难达摩"][jqid] ~= nil and WAR.PD["苦难达摩"][jqid] > 0 then
			        local kn =  math.modf((WAR.PD["苦难达摩"][jqid] or 0) / 40)
					if JLSD(10,30 + kn,jqid) then
				        WAR.Person[i].Time = WAR.Person[i].Time + 30
					end
		        end
				--丁当会跳气
				if match_ID(jqid, 581) and JLSD(0,30,jqid) then
					local a = math.random(10, 30);
					if BNJQ(jqid) then 
						a = a * 3
					end
					WAR.Person[i].Time = WAR.Person[i].Time + a
				end		
				--四海龙王跳气
				if WAR.PD['四海龙王'][jqid] ~= nil and JLSD(0,30,jqid) then
					local a = math.modf(JY.Person[jqid]["轻功"] / 40);
					if BNJQ(jqid) then 
						a = a * 2
					end
					WAR.Person[i].Time = WAR.Person[i].Time + a
				end	
				--四海龙王
				if WAR.PD['四海龙王'][jqid] ~= nil and JLSD(0,30,jqid) then
					jq = jq + math.abs(WAR.Person[i].Time/18)
					AddPersonAttrib(jqid,"生命",(20+JY.Person[jqid]["受伤程度"]))
				end
				--欧阳锋会跳气
				if (match_ID(jqid, 60) or match_ID(jqid, 9858)) and JLSD(0,30,jqid) then
					WAR.Person[i].Time = WAR.Person[i].Time + math.random(30, 60);
				end
				--般若集中跳气
				if WAR.PD["般若集中"][jqid] ~= nil then
					local br = math.modf(JY.Person[jqid]["轻功"]/20);
					WAR.Person[i].Time = WAR.Person[i].Time + math.random(1,br);
				end 
				--波斯三使会跳气
				if (match_ID(jqid, 173) or match_ID(jqid, 174) or match_ID(jqid, 175)) and JLSD(0,33,jqid) then
					WAR.Person[i].Time = WAR.Person[i].Time + 33;
				end
				--星宿摘星步
				if QGQH(jqid,296,1) then
					local jl = 0
					local tqfd = 0
					local fdfw = 0
					jl = jl + math.modf(psx(jqid,"用毒能力")*math.random(3,7)*0.01)
					tqfd = tqfd + math.modf(psx(jqid,"中毒程度")*0.05) + 10
					fdfw = limitX(fdfw + math.modf((psx(jqid,"用毒能力")+psx(jqid,"中毒程度"))*0.02),0,8)
					if JLSD(0,jl,jqid) then
						WAR.Person[i].Time = WAR.Person[i].Time + tqfd
						if math.random(100) > 75 then
							for j = 0,WAR.PersonNum-1 do
								if WAR.Person[j]["死亡"] == false and DWPD(i,j) and RealJL(i,j,fdfw) then
									local jid = WAR.Person[j]['人物编号']
									WAR.PD['西域奇毒'][jid] = (WAR.PD['西域奇毒'][jid] or 0) + (tqfd-10)
								end	
							end
						end	
					end
				end	
				--夜雨楼赤级跳气
				if MPTX(jqid,24,2) then
					local qin = 0
					for j = 1,JY.Base['武功数量'] do
						if yongqin(JY.Person[jqid]['武功'..j]) then
							qin = qin +1 
						end
					end
					if qin > 0 and JLSD(0,qin*10,jqid) then
						WAR.Person[i].Time = WAR.Person[i].Time + math.modf(qin*50)
					end	
				end
				--易筋经组合
				if NGQH(jqid,108) then
					if (WAR.PD['业障缠身'][jqid] or 0) < 30 then
						WAR.PD['业障缠身'][jqid] = (WAR.PD['业障缠身'][jqid] or 0) + 1
					end	
					WAR.Person[i].Time = WAR.Person[i].Time + (WAR.PD['业障缠身'][jqid] or 0)
					if WAR.PD['业障缠身'][jqid] == 30 then
						WAR.PD['业障缠身'][jqid] = nil
						for j = 0, WAR.PersonNum -1 do
							local jid = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
								WAR.PD['业障缠身'][jid] = 31
							end
						end
						local tmppid = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 78, 1, "易筋神髓・未来无生", LightSkyBlue)
						WAR.CurID = tmppid
					end
				end
				
				if Curr_NG(jqid,190) == false and WAR.PD['三垣'][jqid] ~= nil then
					if MPTX(jqid,12) and Curr_NG(jqid,88) then
					else	
						WAR.PD['三垣'][jqid] = nil
					end	
				end	
				if Curr_NG(jqid,190) == false and MPTX(jqid,12) and Curr_NG(jqid,88) == false and WAR.PD['三垣'][jqid] ~= nil then	
					WAR.PD['三垣'][jqid] = nil
				end	
				--八雷神
				if WAR.PD['八雷神'][jqid] ~= nil and BNJQ(jqid) and JLSD(10,30,jqid) then
					for lj = 0, WAR.PersonNum-1 do
						if DWPD(i,lj) and WAR.Person[lj]["死亡"] == false then
							ztd(lj,"生命点数",-(math.random(100,250)+psx(WAR.Person[lj]["人物编号"],"受伤程度")))
							WAR.Person[lj].Time = WAR.Person[lj].Time - math.random(50,150)
						end
					end	
				end
				--冰魄毒效果
				if WAR.PD['冰魄毒'][jqid] ~= nil then
					if WAR.PD['利刃寒锋'][jqid] == nil then
						jq = jq - math.modf(WAR.Person[i].Time/20)
						if jq < 5 then jq = 5 end
					end
					if jq < 50 then
						AddPersonAttrib(jqid,"生命",-(20+JY.Person[jqid]["冰封程度"]))
					end
					WAR.PD["冰魄毒"][jqid] = limitX(WAR.PD["冰魄毒"][jqid],0,20)
					WAR.PD['冰魄毒'][jqid] = WAR.PD['冰魄毒'][jqid] - 1
					if WAR.PD['冰魄毒'][jqid] < 1 then
						WAR.PD['冰魄毒'][jqid] = nil
					end
				end	
					
				
				--白驼逆运
				if MPTX(jqid,8,3) and Curr_NG(jqid,104) then
					local fx = JY.Person[jqid]["封穴程度"] or 0
					jq = jq + fx
				end

				if WAR.PD['阳神降世'][jqid] ~= nil then
					jq = math.modf(jq + 20)
				end	
					
				if WAR.PD["逆转经脉"][jqid] ~= nil then
					local fx = (JY.Person[jqid]["封穴程度"] or 0) + 5
					if JLSD(0,fx,jqid) then
						jq = jq - fx
						AddPersonAttrib(jqid,"封穴程度",math.modf(jq/20))
					end
				end
				--长生组合
				if NGQH(jqid,203) then
					jq = jq + 5
				end
				--极限挑战周目提升
				if (isteam(jqid) == false) and WAR.Person[i].Time <= 0 then
					if JY.Person[456]["论剑奖励"] > 0 then
						local zm = math.modf(JY.Base["周目"]/6)
						if JY.Person[jqid]['畅想分阶'] < 3 then
							WAR.Person[i].Time = WAR.Person[i].Time + zm
						else
							jq = jq + zm
						end
					end
				end
				--套装效果坐骑
				if PDTZ(jqid,JY.Person[jqid]["武器"]) then
					local n = JY.Person[jqid]["武器"]
					local m = Setmeal[n][6]
					if m == 1 or m == 6 or m == 7 then
						jq = jq + 6
					elseif m == 2 then
					    jq = jq + 6
					elseif m == 3 or m == 5 then
					    jq = jq + 8
					elseif m == 4 then
						jqxs = jqxs+0.15
					end
				end
				--周芷若，每个外功提升集气
				if match_ID(jqid, 631) or match_ID(jqid,9798) then
					local zzr = 0
					for wg = 1, JY.Base["武功数量"] do
						if JY.Wugong[JY.Person[jqid]["武功"..wg]]["武功类型"] <= 5 and JY.Wugong[JY.Person[jqid]["武功"..wg]]["武功类型"] >= 1 and JY.Person[jqid]["武功等级"..wg] == 999 then
							zzr = zzr + 1
						end
					end
					jq = jq + zzr*5
				end
				----------------------------百分比集气增加---------------------------
				--乔峰强化
				if match_ID(jqid, 50) then
					local bonus_perctge = 0
					bonus_perctge = 2.5-JY.Person[jqid]["生命"]/JY.Person[jqid]["生命最大值"]
					jqxs = jqxs+bonus_perctge-1
				end
				--葵花紫霞
				if NGQH(jqid,105) or match_ID(jqid,27) or match_ID(jqid,777) then 
					local wj = 8-JY.Person[jqid]['畅想分阶']
					jqxs = jqxs+0.1*wj
				end
				--易水寒
				if NGQH(jqid,43) then
					jqxs = jqxs+0.2
				end 	
				--太极拳
				if WAR.TJQJ > 0 then
					jqxs = jqxs+0.5
				end
				--圣火三使，同时在场时，每人集气速度额外增加
				if WAR.ZDDH == 14 and (jqid == 173 or jqid == 174 or jqid == 175) then
					local shz = 0
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[i]["我方"] then
							shz = shz + 1
						end
					end
					if shz == 3 then
						jqxs = jqxs+1
					elseif shz > 1 then
					    jqxs = jqxs+0.5
					end
				end
				--主运葵花，集气速度+20%
				--萧半和觉醒
				if Curr_NG(jqid,105) or (JXPD(jqid,189,1) and PersonKF(jqid,105)) then
					jqxs = jqxs+0.2
				end
				--龟息功蓄力状态下集气速度加快
				if PersonKF(jqid, 227) and WAR.Actup[jqid] ~= nil and WAR.Actup[jqid] > 0 then 
					jqxs = jqxs+0.15
				end
				--丐帮
				if MPTX(jqid,2) then 
					local a = 0
					for j = 0, WAR.PersonNum - 1 do
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[i]["我方"] and MPTX(tmppid,2) and tmppid ~= jqid then
							a = a + 1
						end
					end
					jqxs = jqxs+(a-1)*0.02
					--丐帮擒龙功
					if MPTX(jqid,2,3) and Curr_NG(jqid,204) then
						jqxs = jqxs+0.2
					end	
				end
				--唐门模式
				if MPTX(jqid,9) then 
					if WAR.TMMS[jqid] == 1 and WAR.TMMS[200+jqid] ~= nil and WAR.TMMS[200+jqid] > 0 then 
						jqxs = jqxs+WAR.TMMS[200+jqid]/4
					end
				end
				--一刀流
				if MPTX(jqid,11) then 
					local mpdj = MPDJ(jqid)
					local a = math.modf(TrueYJ(jqid)/100*mpdj)
					jq = jq+a
					jqxs = jqxs+0.1
					if match_ID(jqid,741) or match_ID(jqid,742) then --噩梦
						jq = jq+a*1.5
						jqxs = jqxs+0.2
					end
			    end
				--中华阁
				if MPTX(jqid,22) then
					jqxs = jqxs+0.15
				end
				if WAR.PD['复活・长生'][jqid] ~= nil and WAR.PD['复活・长生'][jqid] >0 then
					jqxs = jqxs+WAR.PD['复活・长生'][jqid]
				end
				if WAR.PD["太玄组合攻击1"][jqid] ~= nil then
					jqxs = jqxs+0.2
				end
				if WAR.PD['降龙・飞龙在天'][jqid] == 1 then
					jqxs = jqxs+0.5
				end
				--畅想马钰、丘处机
				if jqid == 0 and (JY.Base["畅想"] == 68 or JY.Base["畅想"] == 123) then
					jqxs = jqxs+0.1
				end
				if QGQH(jqid,149,2) and WAR.PD['登云1'][jqid] ~= nil then --梯云高阶效果登云
					jqxs = jqxs+0.5
					AddPersonAttrib(jqid,"生命",jq)
					AddPersonAttrib(jqid,"内力",jq)
					WAR.PD['登云1'][jqid] = WAR.PD['登云1'][jqid] -1
					if WAR.PD['登云1'][jqid] < 1 then
						WAR.PD['登云1'][jqid] = nil
					end
				end	
				--大周吸星
				if WAR.PD['三垣'][jqid] ~= nil then
					if WAR.PD['三垣'][jqid] >= 0 and WAR.PD['三垣'][jqid] < 30 and math.random(10) > 5 then
						for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
								WAR.PD['灵蛇拳'][jid] = 10
							end
						end
					end	
					if WAR.PD['三垣'][jqid] == 30 then
						for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
								local a = JY.Person[jid]["内力"]/JY.Person[jid]["内力最大值"]
								local b = (math.random(6,10)*0.1)
								AddPersonAttrib(jid,"生命",-math.modf(JY.Person[jid]["生命"]*(1-a)*b))
								WAR.PD['灵蛇拳'][jid] = nil
							end
						end
						local tmppid = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "周天星辰・太微垣", LightSkyBlue)	
						WAR.CurID = tmppid
					end	
					if WAR.PD['三垣'][jqid] > 30 and WAR.PD['三垣'][jqid] < 61 then	
						jqxs = jqxs+0.2
					end	
					if WAR.PD['三垣'][jqid] == 61 then
						Cat('清除低级异常',i)
						AddPersonAttrib(jqid,"生命",300)
						AddPersonAttrib(jqid,"内力",1000)
						local tmppid = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "周天星辰・紫薇垣", LightSkyBlue)
						WAR.CurID = tmppid
					end	
					if WAR.PD['三垣'][jqid] > 61 and WAR.PD['三垣'][jqid] <= 90 and math.random(10) > 5 then
						for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
								WAR.PD['迟缓状态'][jid] = 30
							end
						end
					end	
					if WAR.PD['三垣'][jqid] == 91 then
						WAR.PD['三垣'][jqid] = 0
						for j = 0, WAR.PersonNum-1 do
							local jid = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
								WAR.Person[j].Time = -400
								WAR.PD['迟缓状态'][jid] = nil
							end
						end
						local tmppid = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "周天星辰・天市垣", LightSkyBlue)
						WAR.CurID = tmppid
					end	
					WAR.PD['三垣'][jqid] = WAR.PD['三垣'][jqid] + 1	
				end
				if WAR.PD['虚邪剑域'][jqid] ~= nil then
					local a = math.modf(WAR.PD['虚邪剑域'][jqid]*3/100)
					a = limitX(a,0,0.5)
					if match_ID(jqid,457) then
						jqxs = jqxs+a
					end
				end
				--集气乘法结算
				if jqxs > 0 then
					jq = math.modf(jq*jqxs)
				end
				if WAR.PD['虚邪剑域'][jqid] ~= nil then
					local a = math.modf(WAR.PD['虚邪剑域'][jqid]*3/100)
					a = limitX(a,0,0.5)
					if match_ID(jqid,457) then
					else
					    jq = math.modf(jq*(1-a))
					end
				end
				--魔帝BOSS，距离越近，速度越慢
				local tf26 = hastf(i,26,2)
				if tf26 ~= nil then 
					for j = 1,#tf26 do
						local p = tf26[j]
						local x,y = WAR.Person[p]['坐标X'],WAR.Person[p]['坐标Y']
						local x1,y1 = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
						local jl = limitX(11 - math.abs(x-x1) - math.abs(y-y1),0,10)
						jq = math.modf(jq*(1-jl/10))
					end
				end
				if WAR.PD['头晕目眩'][jqid] ~= nil then
					jq = jq*0.7
				end
				--一刀流・无影无相
				if WAR.WYWX[jqid] ~= nil then
					jq = jq*0.5
				end
				--集气上限
				local jqlimit = 80
				local max_jq = 0		--记录全场最高集气	
				if MPTX(jqid,20,2) or match_ID(jqid,579) then
					jqlimit = 90
				end
				if jqid == 0 and PersonKF(jqid, 153) and WAR.CM > 0 then
					jqlimit = limitX(jqlimit + (WAR.CM or 0) * 5,80,95)
				end	
				if match_ID(jqid,27) or match_ID(jqid,777) or (NGQH(jqid,203) and (WAR.PD['复活・长生'][jqid] or 0) >= 3) then
					jqlimit = 95
				end
				--葵花紫霞
				if NGQH(jqid,105) or JXPD(jqid,19,1) then
					jqlimit = 100
				end 
				--野生逮虾户
				if NGQHB(jqid,199) then 
					jqlimit = 100
				end
				--主角论剑打赢东方
				if jqid == 0 and JY.Person[27]["论剑奖励"] == 1 then 
				    jqlimit = 110
				end
				--集气破上限突破
				--灼烧影响集气
				if (JY.Person[jqid]['灼烧程度'] or 0) >= 40 and WAR.Person[i].TimeAdd > 0 and jq > 0  then
					if Curr_NG(jqid,314) or match_ID(jqid,525) then
						jq = math.random(math.floor(jq),math.floor(jq*1.2))
					else
						jq = math.random(math.floor(jq*0.6),math.floor(jq*1.2))
					end
				end
				if WAR.L_NYZH[jqid] == 2 and WAR.Person[i].TimeAdd > 0 and jq > 0 then
					jq = math.random(math.floor(jq * 1.5),math.floor(jq * 3))
					jqlimit = 100
				elseif WAR.L_NYZH[jqid] == 1 and WAR.Person[i].TimeAdd > 0 and jq > 0 then
				    jq = math.random(math.floor(jq * 1.2),math.floor(jq * 2.5))
				    jqlimit = 100
				elseif (MPTX(jqid,22,1)) and WAR.Person[i].TimeAdd > 0 and jq > 0 then   --中华阁1级
				    jq = math.random(math.floor(jq * 1.1),math.floor(jq * 1.5)) 
				    jqlimit = 100
				elseif (MPTX(jqid,26,1)) and WAR.Person[i].TimeAdd > 0 and jq > 0 then   --云梦涧1级
				    jq = math.random(math.floor(jq * 1.2),math.floor(jq * 1.6))	
				    jqlimit = 100
				else	
				end
				if max_jq < jq then
				    max_jq = jq
				end
				
				for j = 0, WAR.PersonNum - 1 do
					local df = WAR.Person[j]["人物编号"]
					--蒙哥全场集气减半
					if match_ID(WAR.Person[j]["人物编号"],627) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						jq = jq/2
					end
					--王霸之气全场集气减半
					if match_ID(WAR.Person[j]["人物编号"],9800) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						jq = jq/2
					end
					--降龙尊相
					if WAR.PD['降龙尊相'][df] ~= nil and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						jq = jq/3
					end
					--魔主光环
					if WAR.Person[j]['人物编号'] == 0 and JXPD(WAR.Person[j]['人物编号'],11,1) 
					and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						local jqxj = psx(WAR.Person[i]['人物编号'],'品德')*0.0083
						if jqxj == nil or jqxj < 0.4 then
							jqxj = 0.4
						end
						jq = jq*jqxj
					end
				end
				
				
				if WAR.PD["伤肺决"][jqid] ~= nil then
					jq = jq * 0.5
					if math.random(10) < 3 then
						jq = 5
					end
			    end
				if WAR.BLJC1[jqid] ~= nil then
					jq = 5
				end
				--竹风雨滴
				for j = 0, WAR.PersonNum - 1 do
					if match_ID(WAR.Person[j]["人物编号"],520) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] then
						jq = 5
					end
				end
				--集气下限
				jq = limitX(math.modf(jq),5)
				--剑典
				if match_ID(jqid,457) and WAR.PD['虚邪剑来'][jqid] == 1 then
					WAR.PD['虚邪剑域'][jqid] = (WAR.PD['虚邪剑域'][jqid] or 0) + 1
					for j = 0, WAR.PersonNum - 1 do
						local jid = WAR.Person[j]['人物编号']
						if DWPD(i,j) and dead(j) == false then
							if psxper(i,'内力',0.2,2) then
								WAR.PD['虚邪剑域'][jid] = 1
							else
								WAR.PD['虚邪剑域'][jid] = (WAR.PD['虚邪剑域'][jid] or 0) + 1
							end
						end
					end
				end	
				--谢无忧
				if match_ID(jqid,596) then
					jq = 90
				end
				if WAR.PD['血战到底'][jqid] ~= nil and WAR.PD['血战到底'][jqid] == 1 then
					local aa = 5 - JY.Person[jqid]['畅想分阶']
					if JY.Person[jqid]['畅想分阶'] < 2 then
						if jq < 100 then
							jq = 100
						end
					else
						if jq < 80 then
							jq = 80
						end
					end
					WAR.Person[i].Time = WAR.Person[i].Time + 10*aa
				end
				--主角论剑打赢东方
				if jqid == 0 and JY.Person[27]["论剑奖励"] == 1 then 
				    jq = limitX(jq,50,jqlimit)
				elseif JXPD(jqid,27,1) then
				    jq = limitX(jq,70,110)
				end
				--独孤求败
				if match_ID(jqid, 592) or match_ID(jqid, 520) or WAR.PD['雪羽战神'][jqid] == 1 then
					jq = limitX(jq,max_jq,110)
				end
				if match_ID(jqid,517) then
					jq = 120
				end
				if Cat('集气停止效果',i) == false then
					jq = limitX(jq,5,jqlimit)
					if BNJQ(jqid) then
						if QGQH(jqid,145,2) then --飞天神行暴怒3倍集气
							jq = jq * 3
						elseif Curr_QG(jqid,150) or NGQH(jqid,204) then	--运功瞬息千里、擒龙罗汉组合，暴怒2倍集气
							jq = jq * 2
						else
							jq = jq * 1.2				--暴怒1.5倍集气
						end
					end
					if ZYJQ(jqid) then
						if QGQH(jqid,280,1) then
							jq = jq * 1.2
						--擒龙罗汉
						elseif NGQH(jqid,204) then
						    jq = jq * 2
						end
					end
					--玉女先天
					if BNJQ(jqid) and WAR.QX1[jqid] ~= nil then
						jq = math.modf(jq*0.5)
					end
					jq = Cat('集气紊乱效果',i,jq)
					if WAR.PD['凝结时空'][jqid] == 1 then
						jq = 0
					end
					WAR.Person[i].Time = WAR.Person[i].Time + jq
					if WAR.Person[i].Time > 1005 then
						WAR.Person[i].Time = 1005
					end
					if WAR.Person[i].Time < -500 then
						WAR.Person[i].Time = -500
					end
				else
				    jq = 0
				end
        ---------以上为各种影响集气的效果---------------------------------
				--夜雨楼
				if (MPTX(jqid,24,3) and Curr_NG(jqid,367) and rwnlxz(jqid,0)) or match_ID(jqid,517)  then
					local num = 0
					for wg = 1,JY.Base['武功数量'] do
						if yongqin(JY.Person[jqid]['武功'..wg]) then
							num = num + 1
						end
					end
					if match_ID(jqid,517) then
						num = math.random(5,11)
					end
					if num >= 3 and WAR.Person[i].Time > -200  then
						if math.random(10) < num then
							Cat('立刻出手',i)
							local tmppid = WAR.CurID
							WAR.CurID = i
							WarDrawMap(0)
							CurIDTXDH(WAR.CurID, 66, 1, "夜雨身法・诡谲难查", LightSkyBlue)
							WAR.CurID = tmppid
							xunhuan = false
						end	
					end
				end	
				--夜雨不沾衣
				if WAR.PD['影随'][jqid] ~= nil and WAR.PD['影随'][jqid] == jqid and WAR.Person[i].Time > 980 then
						for zy = 0 , WAR.PersonNum-1 do
							local zyid = WAR.Person[zy]['人物编号']
							if WAR.PD['遮影'][zyid] ~= nil and WAR.PD['遮影'][zyid] == jqid then
								WAR.PD['影随'][jqid] = nil
								WAR.Person[i].Time = 850
								JY.Person[jqid]['生命'] = math.modf(JY.Person[jqid]['生命']*0.95)
								Cat('立刻出手',zy)
								WAR.CurID = zy
								WarDrawMap(0)
								CurIDTXDH(WAR.CurID, 120, 1, "夜雨不沾衣・附骨之影", M_DeepSkyBlue)
								xunhuan = false
								break
							end
						end
					end
				--点点战
				if WAR.ZDDH == 402 and WAR.RWSZ < 3 and match_ID(jqid,457) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and dead(j) == false and WAR.ZYHB == 0 then
						    if WAR.Person[j].Time > 980 then
							    WAR.Person[j].Time = 980
						    end  
						end		
					end
					Cat('立刻出手',i)
					WAR.RWSZ = WAR.RWSZ + 1
					WAR.CurID = i
         			WarDrawMap(0)
      				CurIDTXDH(WAR.CurID, 6, 1, "让我三招！", PinkRed)
          			xunhuan = false
				end
				--鲸龟再动
				if WAR.PD['鲸龟沉眠'][jqid] ~= nil and WAR.PD['鲸龟沉眠'][jqid] == 1 then
					if WAR.JSX_Counter == 9 then
						for j = 0, WAR.PersonNum - 1 do
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and dead(j) == false and WAR.ZYHB == 0 then
								if WAR.Person[i].Time < 1000 then
									WAR.Person[i].Time = 1000
								end
								if WAR.Person[j].Time > 980 then
									WAR.Person[j].Time = 980
								end
						    end  
						end
						Cat('立刻出手',i)
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 209, 1, "鲸跃天空", PinkRed)
						xunhuan = false
					end
				end
				
				--点点专属
				if match_ID(jqid,457) and WAR.PD['虚邪不染尘'][jqid] ~= nil and WAR.PD['虚邪不染尘'][jqid] == 10 then
					Cat('立刻出手',i)
					WAR.PD['虚邪不染尘'][jqid] = nil
					WAR.CurID = i
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 120, 1, "虚邪剑步・不染尘", PinkRed)
					xunhuan = false
				end
				--扶摇九天
				if PersonKF(jqid,239) then 
					WAR.PD['扶摇九天'][jqid] = (WAR.PD['扶摇九天'][jqid] or 0) + math.random(5,8)
					if Curr_QG(jqid,239) then 
						if WAR.PD['扶摇九天'][jqid] ~= nil and WAR.PD['扶摇九天'][jqid] >= 40 then 
							for j = 0, WAR.PersonNum - 1 do
								if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.ZYHB == 0 and dead(j) == false and WAR.Person[i].Time < WAR.Person[j].Time then
									if WAR.Person[i].Time < 1000 then
										WAR.Person[i].Time = 1000
									end
									if WAR.Person[j].Time > 980 then
										WAR.Person[j].Time = 980
									end
								end
							end
							Cat('立刻出手',i)
							WAR.CurID = i
							WarDrawMap(0)
							CurIDTXDH(WAR.CurID, 120, 1, "扶摇直上九万里", PinkRed)
							xunhuan = false
						end
					end
				end
				--黯影迷踪
				if QGQH(jqid,195,2) and WAR.PD['时序闪避'][jqid] ~= nil and WAR.Person[i].Time >= 750 and JLSD(10,25,jqid) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.ZYHB == 0 and dead(j) == false then
						    if WAR.Person[i].Time < 1000 then
						        WAR.Person[i].Time = 1000
							end
						    if WAR.Person[j].Time > 980 then
							    WAR.Person[j].Time = 980
						    end  
						end		
					end
					Cat('立刻出手',i)
					WAR.CurID = i
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 120, 1, "潜影黯暗乱尘嚣", PinkRed)
					xunhuan = false
				end	
				--云龙三折
				if QGQH(jqid,292,2) and WAR.PD['云龙三折'][jqid] == 1 then
					WAR.PD['云龙三折'][jqid] = 2
					for j = 0, WAR.PersonNum - 1 do
					    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
					        if WAR.Person[j].Time > 950 then
						        WAR.Person[j].Time = 950
					        end  
					    end		
				    end
					Cat('立刻出手',i)
					WAR.CurID = i
				    WarDrawMap(0)
				    CurIDTXDH(WAR.CurID, 387, 1, "昆仑秘要・云龙三折", M_DeepSkyBlue)
				    xunhuan = false
				end    
				--张三丰・收发自如
				if match_ID(jqid,5) or (MPTX(jqid,4,4) and Curr_NG(jqid,171) and match_ID(jqid,9820)) then
					if WAR.PD['太极蓄劲'][jqid] ~= nil and WAR.PD['太极蓄劲'][jqid] >= 15 and JLSD(0,20,jqid) and WAR.Person[i].Time <= 500 then 
						if WAR.PD['阴阳二气'][jqid] < 8 then
							WAR.PD['阴阳二气'][jqid] = 8
						end
						for j = 0, WAR.PersonNum - 1 do
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
						        if WAR.Person[i].Time < 1000 then
						            WAR.Person[i].Time = 1000
							    end
						        if WAR.Person[j].Time > 950 then
							        WAR.Person[j].Time = 950
						        end  
							end		
					    end
					    Cat('立刻出手',i)
					    WAR.CurID = i
					    WarDrawMap(0)
					    CurIDTXDH(WAR.CurID, 120, 1, "太极真意・动静自如", M_DeepSkyBlue)
					    xunhuan = false
					end
					WAR.PD['太极蓄劲'][jqid] = nil
				end	
				
				--黯然
				if PersonKF(jqid,25) and ((Curr_NG(jqid,252) and PersonKF(jqid,104) or match_ID(jqid,58))) and (WAR.PD['黯然值'][jqid] == 100 or WAR.PD['黯然值'][jqid] == 101 or (WAR.PD['黯然值'][jqid] == 102 and JLSD(0,5,jqid))) then 
					--if WAR.PD['黯然值'][jqid] == 101 then
					WAR.PD['黯然值'][jqid] = 102
					--end	
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.ZYHB == 0 and WAR.Person[i].Time < WAR.Person[j].Time then
							if WAR.Person[i].Time < 1000 then
							    WAR.Person[i].Time = 1000
							end
							if WAR.Person[j].Time > 980 then
								WAR.Person[j].Time = 980
							end  
						end
					end
					Cat('立刻出手',i)
					WAR.CurID = i
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 120, 1, "黯然・心丧欲死哀别离", M_DeepSkyBlue)
					xunhuan = false
				end	
				--中庸之道1调整为固定25时序行动一次
                if ZhongYongZD1(jqid) then 
                    local t = 25
                    if WAR.PD['中庸'][jqid] == nil or WAR.PD['中庸'][jqid] < t then 
                        WAR.PD['中庸'][jqid] = (WAR.PD['中庸'][jqid] or 0) + 1
                        if WAR.PD['中庸'][jqid] >= t then 
                            WAR.PD['中庸'][jqid] = 0
							if WAR.PD["昏迷状态"][jqid] ~= nil then
								WAR.PD["昏迷状态"][jqid] = nil
							end
							if WAR.PD["恐惧状态"][jqid] ~= nil then
								WAR.PD["恐惧状态"][jqid] = nil
							end
							if WAR.PD["麻痹状态"][jqid] ~= nil then
								WAR.PD["麻痹状态"][jqid] = nil
							end
							Cat('清除高级异常',i)
							Cat('立刻出手',i)
							if JY.Person[0]["中庸"] == 3 then
								for j = 0, WAR.PersonNum - 1 do
									local df = WAR.Person[j]["人物编号"] 
						            if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
									    WAR.PD["威慑"][df] = 10
						                if WAR.Person[i].Time < 1000 then
						                    WAR.Person[i].Time = 1000
							            end
						                if WAR.Person[j].Time > 980 then
							                WAR.Person[j].Time = 980
						                end
						            end
					            end
							end
							WAR.CurID = i
                            WarDrawMap(0)
                            CurIDTXDH(WAR.CurID, 6, 1, "中庸之道", PinkRed)
                            --atid = i
                            xunhuan = false
                        end
                    end
                end
				
                --八荒北冥
                if NGQH(jqid,101) then
					if WAR.Person[i].Time <= -250 or WAR.WWDZ[jqid] ~= nil then
						if WAR.WWDZ[jqid] ~= nil then
						    WAR.WWDZ[jqid] = nil
						end 	
						for j = 0, WAR.PersonNum - 1 do
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
						        if WAR.Person[j].Time > 980 then
							        WAR.Person[j].Time = 980
						        end 
						    end		
					    end
						Cat('立刻出手',i)
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "八荒六合", PinkRed)
						xunhuan = false	
					end
				end 	
				
				--唐门模式夺魄箭	
				if MPTX(jqid,9) and WAR.TMMS[jqid] == 1 and WAR.TMMS[100 + jqid] == 1 then
					for j = 0, WAR.PersonNum - 1 do
						WAR.Person[j].Time = WAR.Person[j].Time - 50
						if 990 < WAR.Person[j].Time then
							WAR.Person[j].Time = 990
						end
					end
					if math.random(10) > 4 then
						WAR.TMMS[100 + jqid] = nil
					end	
					Cat('立刻出手',i)
					WAR.CurID = i
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 6, 1, "追命无声", PinkRed)
					xunhuan = false	
				end 
				
				--喵太极・龙蛇起陆
				if match_ID(jqid,92) then
					local ns = 5
					if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] / 3 then
						ns = ns + 10
					end	
					if JLSD(0,ns,jqid) then
						for j = 0, WAR.PersonNum - 1 do
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
						        if WAR.Person[i].Time < 1000 then
						            WAR.Person[i].Time = 1000
							    end
						        if WAR.Person[j].Time > 980 then
							        WAR.Person[j].Time = 980
						        end  
						    end
					    end
						zhanyi(jqid,100)
						nuqi(jqid,50)
						Cat('清除高级异常',i)
						Cat('立刻出手',i)
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 378, 1, "龙蛇起陆", PinkRed)
						xunhuan = false
                    end
                end
				--独孤插队
                if (match_ID(jqid,592) and JLSD(10,60,jqid)) or (actor(jqid,3) and JY.Person[638]["论剑奖励"] == 1 and JLSD(60,90,jqid)) or (jqid == 0 and JY.Base["标准"] > 0 and JY.Person[638]["论剑奖励"] == 1 and JLSD(30,70,jqid)) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j].Time >= 850 and WAR.ZYHB == 0 and WAR.Person[i].Time < WAR.Person[j].Time then
						    if WAR.Person[i].Time < 1000 then
						        WAR.Person[i].Time = 1000
							end
						    if WAR.Person[j].Time > 980 then
							    WAR.Person[j].Time = 980
						    end
							Cat('清除所有异常',i)
						    Cat('立刻出手',i)
						    WAR.CurID = i
						    WarDrawMap(0)
						    CurIDTXDH(WAR.CurID, 6, 1, "独孤奥义", PinkRed)
							DIYdisplay("料敌先机")
						    lib.Delay(100)
						    DIYdisplay("后发先至")
						    xunhuan = false
						end		
					end
				end 	
				
				--竹风雨滴
                if match_ID(jqid,520) and JLSD(30,80,jqid) then
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j].Time >= 600 and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
						    if WAR.Person[i].Time < 1000 then
						        WAR.Person[i].Time = 1000
							end
						    if WAR.Person[j].Time > 980 then
							    WAR.Person[j].Time = 980
						    end  
							Cat('清除高级异常',i)
							Cat('立刻出手',i)
						    WAR.CurID = i 
						    WarDrawMap(0)
						    CurIDTXDH(WAR.CurID, 6, 1, "梅花步", PinkRed)
							DIYdisplay("梅花无影")
						    xunhuan = false
						end		
					end
				end 		
				
				--洛凡因
                if match_ID(jqid,760) then
					if WAR.Person[i].Time < 0 then
						for j = 0, WAR.PersonNum - 1 do
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
						        if WAR.Person[i].Time < 1000 then
						            WAR.Person[i].Time = 1000
							    end
						        if WAR.Person[j].Time > 980 then
							        WAR.Person[j].Time = 980
						        end 
						    end		
					    end
						Cat('立刻出手',i)
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "天机步", PinkRed)
						xunhuan = false	
					end
				end 	
				
				--瞬息千里高阶效果
				if QGQH(jqid,150,2) and WAR.PD['瞬息千里'][jqid] == 1 then
					local ns = math.modf(JY.Person[jqid]["受伤程度"] / 3)
					if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] * 0.2 then
						ns = ns + 5
					end	
					if JLSD(0,5+ns,jqid) then
						for j = 0, WAR.PersonNum - 1 do
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < 0 and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
						        if WAR.Person[j].Time > 980 then
							        WAR.Person[j].Time = 980
						        end  
						    end		
					    end
						Cat('立刻出手',i)
						WAR.PD['瞬息千里'][jqid] = nil
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "一瞬之息・缈影千里", PinkRed)
						--atid = i
						xunhuan = false
                    end
                end
				
				--朝廷武穆
				if WAR.YSJG > 2 and MPTX(jqid,23,3) and Curr_NG(jqid,199) then
					local ss = WAR.YSJG * 4
					if JLSD(0,ss,jqid) then
						for j = 0, WAR.PersonNum - 1 do
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 and dead(j) == false then
						        if WAR.Person[i].Time < 1000 then
						            WAR.Person[i].Time = 1000
							    end
								if WAR.Person[j].Time > 980 then
							        WAR.Person[j].Time = 980  
						        end		
					        end
						end
						if WAR.PD["昏迷状态"][jqid] ~= nil then
							WAR.PD["昏迷状态"][jqid] = nil
						end
						if WAR.PD["恐惧状态"][jqid] ~= nil then
							WAR.PD["恐惧状态"][jqid] = nil
						end
						Cat('立刻出手',i)
						WAR.YSJG = WAR.YSJG - 2	
						if WAR.YSJG < 1 then
							WAR.YSJG = 0
						end
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "转守为攻", PinkRed)
						xunhuan = false	
					end
				end
				--朝廷满江红
				if JY.Person[jqid]["生命"] <= JY.Person[jqid]["生命最大值"]*0.3 and MPTX(jqid,23,4) and WAR.PD['满江红'][jqid] ~= 1 then
		            ztd(i,'生命点数',psx(jqid,'生命最大值'))
		            ztd(i,'内力点数',psx(jqid,'内力最大值'))
		            ztd(i,'体力点数',100)
					for j = 0, WAR.PersonNum - 1 do
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.ZYHB == 0 and WAR.Person[i].Time < WAR.Person[j].Time and dead(j) == false then
						    if WAR.Person[i].Time < 1000 then
						        WAR.Person[i].Time = 1000
							end
						    if WAR.Person[j].Time > 980 then
							    WAR.Person[j].Time = 980
						    end  
						end		
					end
					Cat('清除所有异常',i)
					Cat('立刻出手',i)
		            WAR.PD['满江红'][jqid] = 1
					for j = 0, WAR.PersonNum - 1 do
						local jid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and dead(j) == false then
							WAR.PD["威慑"][jid] = 30
						end
					end
					WAR.CurID = i
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 378, 1, "朝天阙", PinkRed)
					xunhuan = false
	            end
				
				--七夕任盈盈意随音动
				if match_ID(jqid,611) then
					for j = 0, WAR.PersonNum - 1 do
						local jid = WAR.Person[j]["人物编号"]
						local qy = WAR.PD["琴音状态"][jid] or 0
						if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j].Time >= 950 and WAR.PD["琴音状态"][jid] ~= nil and math.random(40) < qy then
						    for j = 0, WAR.PersonNum - 1 do
						        if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 then
						            if WAR.Person[j].Time > 980 then
							            WAR.Person[j].Time = 980
						            end  
						        end		
					        end
						    Cat('立刻出手',i)
						    WAR.CurID = i
						    WarDrawMap(0)
						    CurIDTXDH(WAR.CurID, 6, 1, "意随音动", PinkRed)
						    xunhuan = false
						end		
					end
				end
				--易水寒诀
				if Curr_NG(jqid,43) and WAR.PD['易水寒诀'][jqid] ~=nil and WAR.PD['易水寒诀'][jqid] > 95 then
					if BNJQ(jqid) then
						for j = 0, WAR.PersonNum - 1 do
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i].Time < WAR.Person[j].Time and WAR.ZYHB == 0 then
								if WAR.Person[i].Time < 1000 then
									WAR.Person[i].Time = 1000
								end
						        if WAR.Person[j].Time > 980 then
							        WAR.Person[j].Time = 980
						        end  
						    end		
					    end
						Cat('立刻出手',i)
						WAR.PD['易水寒诀'][jqid] = 50
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 6, 1, "壮士一去兮", PinkRed)
						xunhuan = false
					end
				end
				----------------------------------时序生命内力体力回复-----------------------------------
				--九阳神功回内
				--学会九阳并且是阳内或者天罡
				if Curr_NG(jqid, 106) and rwnlxz(jqid,1) then
					AddPersonAttrib(jqid,'内力',6)
				end
				--九阴额外回血
				--阴内主运或者阴罡学会九阴后
				--if isteam(jqid) then
				if Curr_NG(jqid, 107) and rwnlxz(jqid,0) then
					AddPersonAttrib(jqid,'生命',5)
				end
		        --九宵中华
				if NGQH(jqid, 184) then
					AddPersonAttrib(jqid,'生命',19)
					AddPersonAttrib(jqid,'内力',39)
					AddPersonAttrib(jqid,'体力',3)
				end
		        --阴阳无极功
				if Curr_NG(jqid, 221) then
					AddPersonAttrib(jqid,'生命',2)
					AddPersonAttrib(jqid,'内力',5)
				end
                --太虚剑意回血
				if Curr_NG(jqid, 152) then
					AddPersonAttrib(jqid,'生命',2)
					AddPersonAttrib(jqid,'内力',5)
				end
				--鲸息功回复内力
				if Curr_NG(jqid, 180) then
					AddPersonAttrib(jqid,'生命',2)
					AddPersonAttrib(jqid,'内力',5)
					AddPersonAttrib(jqid,'中毒程度',-1)
				end
				--暗香疏影
				if TFQG(jqid,316) then
					if jq > 30 and JLSD(10,25,jqid) then
						AddPersonAttrib(jqid,'生命',jq-30)
						AddPersonAttrib(jqid,'内力',(jq-30)*3)
					end
				end	
				--四海龙王
				if WAR.PD['四海龙王'][jqid] ~= nil and JLSD(0,30,jqid) then
					AddPersonAttrib(jqid,'生命',jq)
					AddPersonAttrib(jqid,'内力',jq*5)
				end	
				--长生诀回血
				if Curr_NG(jqid, 203) then
					AddPersonAttrib(jqid,'生命',3)
				end	
				--浮游功
				if Curr_NG(jqid, 238) then 
					AddPersonAttrib(jqid,'生命',3)
					AddPersonAttrib(jqid,'内力',6)
				end
				--龟息功
				if PersonKF(jqid,227) then
					AddPersonAttrib(jqid,'生命',2)
				end
				--阳春三月
				if match_ID(jqid,9737) or match_ID(jqid,515) then
					AddPersonAttrib(jqid,'生命',5)
					AddPersonAttrib(jqid,'内力',10)
				end
				--先天功回血回内  --马钰回复加倍
				if PersonKF(jqid, 100) then
					if match_ID(jqid,123) then 
						AddPersonAttrib(jqid,'生命',20)
					else
						AddPersonAttrib(jqid,'生命',10)
					end
					if NGQH(jqid,100) then
						AddPersonAttrib(jqid,'生命',math.random(15,25))
						if psxper(i,'生命',0.8,1) then
							addbuff(jqid,WAR.PD['先天护盾'],math.random(15,25))
						end		
					end
				end
				--天南易阳
				if PersonKF(jqid,314) then
					AddPersonAttrib(jqid,'内力',math.random(10,15))
					if NGQH(jqid,314) then
						AddPersonAttrib(jqid,'内力',math.random(15,25))
						if psxper(i,'内力',0.8,1) then
							--addbuff(jqid,WAR.PD['龙气护盾'],math.random(15,25))
						end		
					end
				end	
				--忘情天书回血回内
				if Curr_NG(jqid, 177) then
					AddPersonAttrib(jqid,'内力',4)
					AddPersonAttrib(jqid,'生命',2)
				end
				--易筋经回内
				if Curr_NG(jqid,108) then
					AddPersonAttrib(jqid,'内力',6)
				end
				--黑级浮屠回内
				if match_ID(jqid,9930) then
					AddPersonAttrib(jqid,'内力',12)
				end
				--夜雨不沾衣恢复
				if WAR.PD['遮影'][jqid] ~= nil then
					if match_ID(jqid,517) then
						AddPersonAttrib(jqid,'生命',math.random(10,100))
					end
					if match_ID(jqid,526) then
						AddPersonAttrib(jqid,'内力',math.random(100,600))
					end
				end	
				--吃药
				if WAR.PD['天香续命'][jqid] ~= nil then 
					local sm = 2 
					if JY.Person[jqid]['实战'] >= 500 then 
						sm = 4
					end
					AddPersonAttrib(jqid,'生命',sm)
					WAR.PD['天香续命'][jqid] = WAR.PD['天香续命'][jqid] - 1
					if WAR.PD['天香续命'][jqid] < 1 then 
						WAR.PD['天香续命'][jqid] = nil
					end
				end  
				if WAR.PD['白云熊胆'][jqid] ~= nil then 
					AddPersonAttrib(jqid,'内力',8)
					WAR.PD['白云熊胆'][jqid] = WAR.PD['白云熊胆'][jqid] - 1
					if WAR.PD['白云熊胆'][jqid] < 1 then 
						WAR.PD['白云熊胆'][jqid] = nil
					end
				end
				--主角医生回血内，减内伤，减中毒
				if actor(jqid,8) then
					AddPersonAttrib(jqid,'生命',math.random(8))
					AddPersonAttrib(jqid,'内力',math.random(8))
					AddPersonAttrib(jqid,'中毒程度',-math.random(8))
					AddPersonAttrib(jqid,'受伤程度',-math.random(8))
				end
				--brolycjw：胡青牛指令，每个时序回复1%血
				if WAR.L_HQNZL[jqid] ~= nil and WAR.L_HQNZL[jqid] > 0 then
					AddPersonAttrib(jqid,'生命',math.modf(JY.Person[jqid]["生命最大值"]/50))
					if JY.Person[jqid]["受伤程度"] > 50 then
						AddPersonAttrib(jqid,'受伤程度',-10)
					else
						AddPersonAttrib(jqid,'受伤程度',-5)
					end
					WAR.L_HQNZL[jqid] = WAR.L_HQNZL[jqid] -1;
					if WAR.L_HQNZL[jqid] < 1 then
						WAR.L_HQNZL[jqid] = nil;
					end
				end	
				--大周天回复
				if WAR.ZTHF[jqid] ~=nil then
					AddPersonAttrib(jqid,'生命',2)
					AddPersonAttrib(jqid,'内力',4)
					AddPersonAttrib(jqid,'受伤程度',-100)
				end
				--长生诀
				if WAR.PD['长生诀'][jqid] ~= nil then 
					AddPersonAttrib(jqid,'生命',math.modf(JY.Person[jqid]["生命最大值"]/100))
					AddPersonAttrib(jqid,'内力',math.modf(JY.Person[jqid]["内力最大值"]/100))
					AddPersonAttrib(jqid,'体力',1)
					WAR.PD['长生诀'][jqid] = WAR.PD['长生诀'][jqid] - 1
					if WAR.PD['长生诀'][jqid] < 1 then 
						WAR.PD['长生诀'][jqid] = nil  
					end
				end
				--龟息蛤蟆诀
				if WAR.GXHM[jqid] ~= nil and WAR.GXHM[jqid] > 0 then
					AddPersonAttrib(jqid,'生命',80)
					AddPersonAttrib(jqid,'内力',120)
					AddPersonAttrib(jqid,'体力',2)
					WAR.GXHM[jqid] = WAR.GXHM[jqid] -1;
					if WAR.GXHM[jqid] <= 0 then
						WAR.GXHM[jqid] = nil 
					end 
				end 
				--长生回天回复 标记修改
				if WAR.CSHF[jqid] ~= nil  then
					AddPersonAttrib(jqid,'生命',math.modf(JY.Person[jqid]["生命最大值"]/80))
					AddPersonAttrib(jqid,'内力',math.modf(JY.Person[jqid]["内力最大值"]/80))
					AddPersonAttrib(jqid,'体力',1)
					AddPersonAttrib(jqid,'中毒程度',-1)
					AddPersonAttrib(jqid,'受伤程度',-1)
					AddPersonAttrib(jqid,'冰封程度',-1)	
					AddPersonAttrib(jqid,'灼烧程度',-1)	
					WAR.CSHF[jqid] = WAR.CSHF[jqid] -1;
					if WAR.CSHF[jqid] <= 0 then
						WAR.CSHF[jqid] = nil;
					end
				end
				--长春不老功 标记修改
				if Curr_NG(jqid,183) then	
					local HP1=math.modf(JY.Person[jqid]["生命"]/100)
					local MP1=math.modf(JY.Person[jqid]["内力"]/100)
					local HP2=math.modf(JY.Person[jqid]["生命"]/JY.Person[jqid]["生命最大值"]*100)
					local MP2=math.modf(JY.Person[jqid]["内力"]/JY.Person[jqid]["内力最大值"]*100)
					if HP2>MP2 then
					AddPersonAttrib(jqid,'内力',MP1)
					end
					if MP2>HP2 then	
					AddPersonAttrib(jqid,'生命',HP1)
					end	
					if MP2 == HP2 then	
					AddPersonAttrib(jqid,'生命',HP1)
					AddPersonAttrib(jqid,'内力',MP1)
					end	
				end	
				--长春不老功 标记修改
				if PersonKF(jqid,183) then	
					local HP=5 + JY.Base["天书数量"]
					local MP=5 + JY.Base["天书数量"]
					AddPersonAttrib(jqid,'内力',MP)
					AddPersonAttrib(jqid,'生命',HP)
				end
				--临济十二庄
				if PersonKF(jqid,247) or MPTX(jqid,16) then	
					AddPersonAttrib(jqid,'内力',10)
					AddPersonAttrib(jqid,'生命',5)
					WAR.PD['封穴恢复'][jqid] = 1
				end
				--纯阳混元
				if NGQHB(jqid,99) then
					AddPersonAttrib(jqid, "生命", 10)
					AddPersonAttrib(jqid, "内力", 20)
					AddPersonAttrib(jqid, "体力", 3)
					WAR.PD['封穴恢复'][jqid] = 3
					WAR.PD['内伤恢复'][jqid] = 3
					WAR.PD['冰封恢复'][jqid] = 3
					WAR.PD['灼烧恢复'][jqid] = 3
					WAR.PD['中毒恢复'][jqid] = 3
					WAR.PD['流血恢复'][jqid] = 3
				end	
				--竹风雨滴
				if WAR.ZHHF[jqid] ~= nil then
					JY.Person[jqid]["受伤程度"] = 0;
					JY.Person[jqid]["封穴程度"] = 0;
					JY.Person[jqid]["中毒程度"] = 0;
					JY.Person[jqid]["流血程度"] = 0;
					JY.Person[jqid]["冰封程度"] = 0;
					JY.Person[jqid]["灼烧程度"] = 0;
				end
				
				if WAR.PD['血战到底'][jqid] ~= nil and WAR.PD['血战到底'][jqid] == 1 then
					local fm = 0
					if JY.Person[jqid]['畅想分阶'] < 3 then
						fm = 10
						Cat('清除高级异常',i)	
						if JY.Person[jqid]['畅想分阶'] < 2 then
							fm = 30
							Cat('清除所有异常',i)	
						end
					end
					AddPersonAttrib(jqid,'流血程度',-fm)
					AddPersonAttrib(jqid,'封穴程度',-fm)
					AddPersonAttrib(jqid,'中毒程度',-fm)
					AddPersonAttrib(jqid,'受伤程度',-fm)
					AddPersonAttrib(jqid,'冰封程度',-fm)	
					AddPersonAttrib(jqid,'灼烧程度',-fm)
				end
				--太极纯阳
				if NGQH(jqid,171) then
					if WAR.PD['阴阳二气'][jqid] == nil then
					    WAR.CSHF[jqid] = 10
					end
					if JY.Person[jqid]["生命最大值"] * 0.5 > JY.Person[jqid]["生命"] then
						AddPersonAttrib(jqid, "受伤程度", -100)	
						AddPersonAttrib(jqid, "中毒程度", -100)	
					end	
			    end					
				--长春北冥
				if NGQH(jqid,183) then
					AddPersonAttrib(jqid, "冰封程度", -10)	
					AddPersonAttrib(jqid, "灼烧程度", -10)
				end
				--玉女先天
				if NGQH(jqid,154) then
					if WAR.LQZ[jqid] ~= nil and WAR.LQZ[jqid] < 100 then
						local nq = math.modf(100-(WAR.LQZ[jqid] or 0))
						if nq < 1 then
							nq = 1
						end
						AddPersonAttrib(jqid, "生命", nq)
						AddPersonAttrib(jqid, "内力", nq)   
					end
				end		
				--神足乾坤
				if NGQH(jqid,233) then 
					AddPersonAttrib(jqid,'生命',math.random(30,60))
					AddPersonAttrib(jqid,'生命',math.random(100,300))
				end 	
				--九阴太极
				if NGQH(jqid,107) then	
					if JY.Person[jqid]["受伤程度"] > 0 then 			
						AddPersonAttrib(jqid, "生命", JY.Person[jqid]["受伤程度"] * 5)
						AddPersonAttrib(jqid, "流血程度", -5)
					end
				end 
				--九阳怒涛
				if NGQH(jqid,106) then
					AddPersonAttrib(jqid, "冰封程度", -15)
					if JY.Person[jqid]["受伤程度"] > 0 then 
						AddPersonAttrib(jqid, "生命", 50)
						AddPersonAttrib(jqid, "内力", 80)
					end	
				end		
				--擒龙罗汉 战意
				if NGQH(jqid,204) and WAR.SPIRIT[jqid] ~= nil and WAR.SPIRIT[jqid] > 0 then
					local zy = math.modf((WAR.SPIRIT[jqid] or 0) *0.2)
					local tl = math.random(1,2)
					if WAR.SPIRIT[jqid] >= 100 and WAR.SPIRIT[jqid] ~= nil then
						zy = zy + 10
					end	 
					if JLSD(0,10+zy,jqid) then
						AddPersonAttrib(jqid, "生命",zy)
						AddPersonAttrib(jqid, "内力",zy*2)
						AddPersonAttrib(jqid, "体力",tl)
					end
				end
				--云梦涧
				if MPTX(jqid,26) then
					AddPersonAttrib(jqid, "生命", 5)
					AddPersonAttrib(jqid, "内力", 50)	
				end	
				--降魔附魔
				if WGZH(jqid,86,267) then
					local a = JY.Person[jqid]["耍刀技巧"] * 0.1
					local b = JY.Person[jqid]["特殊兵器"] * 0.25
					AddPersonAttrib(jqid, "生命", a)
					AddPersonAttrib(jqid, "内力", b)
				end
				--鲸息九阴
				if NGQH(jqid,180) then 
					AddPersonAttrib(jqid, "冰封程度", -8)
					AddPersonAttrib(jqid, "灼烧程度", -8)
					AddPersonAttrib(jqid, "流血程度", -8)
					AddPersonAttrib(jqid, "封穴程度", -8)
					AddPersonAttrib(jqid, "受伤程度", -8)
					AddPersonAttrib(jqid, "中毒程度", -8)
					AddPersonAttrib(jqid, "生命", 16)
					AddPersonAttrib(jqid, "内力", 30)   
					AddPersonAttrib(jqid, "内力", 2) 
				end 	
				--易水寒
				if NGQH(jqid,43) then
					local a = JY.Person[jqid]["灼烧程度"] * 0.3
					AddPersonAttrib(jqid, "冰封程度", -100)
					AddPersonAttrib(jqid, "灼烧程度", -a)
					AddPersonAttrib(jqid, "封穴程度", -10)
					AddPersonAttrib(jqid, "内力", 100)   
					AddPersonAttrib(jqid, "内力", 3) 
				end 	
				----------------------------------时序门派、人物类生命内力恢复-------------------------------------
				--少林派
				if MPTX(jqid,5,3) and Curr_NG(jqid,108) and BNJQ(jqid) and WAR.JSX_Counter == 9 then
					local a = math.modf(psx(jqid,'生命最大值')*MPDJ(jqid)*0.5*0.01)
					local b = math.modf(psx(jqid,'内力最大值')*MPDJ(jqid)*0.5*0.01)
					local c = math.modf(100*MPDJ(jqid)*0.5)
					AddPersonAttrib(jqid,'生命',a)
					AddPersonAttrib(jqid,'内力',b)
					AddPersonAttrib(jqid,'体力',c)	
				end
				--朝廷续战
				if WAR.PD['续战'][jqid] ~= nil then 
					local xzsm = math.modf((JY.Person[jqid]["生命最大值"] - JY.Person[jqid]["生命"]) / 25)
					local xznl = math.modf((JY.Person[jqid]["内力最大值"] - JY.Person[jqid]["内力"]) / 25)
					AddPersonAttrib(jqid,'生命', xzsm )
					AddPersonAttrib(jqid,'内力', xznl )
					if WAR.SSX_Counter == 3 then
                        AddPersonAttrib(jqid,'体力',1)
                    end
                    WAR.PD['续战'][jqid] = WAR.PD['续战'][jqid] - 1
                    if WAR.PD['续战'][jqid] < 1 then 
                       WAR.PD['续战'][jqid] = nil     
                    end
                end
				--中华阁
				if MPTX(jqid,22) then
					AddPersonAttrib(jqid, "生命", 10)
					AddPersonAttrib(jqid, "内力", 20)
				end 
				--雪羽宗易水寒时序增加冰封
				if Curr_NG(jqid,43) and MPTX(jqid,20) then
					AddPersonAttrib(jqid,'冰封程度',5)
				end
				--点点诡计
				if WAR.ZDDH == 456 then
					if match_ID(jqid,457) then
						--if WAR.JSX_Counter == 9 then
							--local s = WAR.CurID
							--WAR.CurID = i
							--WarDrawMap(0)
							--CurIDTXDH(WAR.CurID,14,1, "咳…呕咳…他妈的跟用刑一样…", PinkRed)
							--WAR.CurID = s
							--AddPersonAttrib(jqid,'生命',-math.modf(psx(jqid,'生命最大值')*0.09))
						--end
						if JY.Person[jqid]["生命"] < 3000 then
							if WAR.XSBC ~= 2 then
								WAR.XSBC = 1
							end
						end
					end	
					if match_ID(jqid,92) or match_ID(jqid,457) or match_ID(jqid,456) then
						WAR.PD["魅惑状态"][jqid] = nil
						WAR.PD["魔岭玫瑰"][jqid] = nil
						WAR.PD["度化状态"][jqid] = nil
					end
				end
				--唯识剑意
				if (PersonKF(jqid,369) and PersonKF(jqid,370)) or match_ID(jqid,747) then
					WAR.PD["唯识剑意1"][jqid] = nil
				end 		 			
				--东方不败
				if JXPD(jqid,27,2) or match_ID(jqid,777) then
					WAR.PD["初芽"][jqid] = nil
					WAR.PD["含苞"][jqid] = nil
					WAR.PD["绽放"][jqid] = nil
					WAR.PD["凋零"][jqid] = nil
				end
				--葵花尊者，恢复
				if match_ID(jqid,27) or match_ID(jqid,777) then
					AddPersonAttrib(jqid,'生命',5)
					AddPersonAttrib(jqid,'内力',10)
					AddPersonAttrib(jqid,'体力',1)
				end
				--喵太极
				if match_ID(jqid,92) then
					local HP1=math.modf(JY.Person[jqid]["生命"]/300)
					local MP1=math.modf(JY.Person[jqid]["内力"]/300)
					local HP2=math.modf(JY.Person[jqid]["生命"]/JY.Person[jqid]["生命最大值"]*500)
					local MP2=math.modf(JY.Person[jqid]["内力"]/JY.Person[jqid]["内力最大值"]*500)
					if HP2>MP2 then
						AddPersonAttrib(jqid,'内力',MP1)
					end
					if MP2>HP2 then	
						AddPersonAttrib(jqid,'生命',HP1)
					end
					AddPersonAttrib(jqid,'生命',8)
					AddPersonAttrib(jqid,'内力',88)
					AddPersonAttrib(jqid,'体力',5)
					WAR.PD["十方无敌"][jqid] = nil
					WAR.PD["走火入魔"][jqid] = nil
					WAR.PD["无招胜有招"][jqid] = nil
					WAR.PD["利刃寒锋"][jqid] = nil
					WAR.PD['九阴摄魂'][jqid] = nil
					--WAR.YHDF[jqid] = nil
				end
				--密宗
				if MPTX(jqid,6,2) and Curr_NG(jqid,163) then
					AddPersonAttrib(jqid, "流血程度", math.random(3,6))
				end
				--武当3级弟子主运太极功 太极蓄力
				if MPTX(jqid,4,3) and Curr_NG(jqid,171) then
					AddPersonAttrib(jqid, "生命", 5)
					AddPersonAttrib(jqid, "受伤程度", -1)
					if WAR.PD["太极蓄力"][jqid] ~= nil and WAR.PD["太极蓄力"][jqid] > 0 then 
						local tj = math.modf((WAR.PD["太极蓄力"][jqid] or 0) / 500)
						AddPersonAttrib(jqid, "生命",3*tj)
						AddPersonAttrib(jqid, "内力",5*tj)
						AddPersonAttrib(jqid, "受伤程度",-tj)
					end
				end	
				--全真基础恢复
				if MPTX(jqid,16,1) then
					local dj = MPDJ(jqid)
					if match_ID(jqid,129) then
						dj = 5
					end 
					if match_ID(jqid,64) then
						dj = 4
					end		
					local aa = dj * 4
					local bb = math.modf(JY.Person[jqid]["生命最大值"] * 0.005)	
					local cc = math.modf(JY.Person[jqid]["内力最大值"] * 0.005)	 
					AddPersonAttrib(jqid, "生命", aa)
					if JY.Person[jqid]["内力最大值"] * 0.7 > JY.Person[jqid]["内力"] and JLSD(0,50,jqid) then 
						AddPersonAttrib(jqid, "生命", cc)
						AddPersonAttrib(jqid, "内力", bb)	
					end
				end	
				--白驼山2级
                if (MPTX(jqid,8,2) and Curr_NG(jqid,95)) or match_ID(jqid,61) then
					if JY.Person[jqid]["中毒程度"] > 0 then
					    local aa = math.modf(JY.Person[jqid]["中毒程度"] / 10)
					    AddPersonAttrib(jqid, "生命", aa * MPDJ(jqid))
					    if PersonKF(jqid,104) then
					        AddPersonAttrib(jqid, "受伤程度", aa)
					    end
					end
				end
				--丐帮莲花功
				if MPTX(jqid,2,2) and PersonKF(jqid,215) then 
					AddPersonAttrib(jqid, "生命", 20)
					AddPersonAttrib(jqid, "内力", 30)
					AddPersonAttrib(jqid, "体力", 1)
					AddPersonAttrib(jqid, "受伤程度", -3)	
					AddPersonAttrib(jqid, "中毒程度", -3)
				end
				--六脉神剑
				if WAR.LMJF[jqid] ~= nil and WAR.LMJF[jqid] > 0 then
					local a = JY.Person[jqid]["封穴程度"] / 10
					AddPersonAttrib(jqid, "生命", -a)
					WAR.LMJF[jqid] = WAR.LMJF[jqid] - 1
					if WAR.LMJF[jqid] <= 0 then
						WAR.LMJF[jqid] = nil
					end
				end 	
				-----------------------时序清除异常--------------------
				--鲸龟
				if WAR.PD['鲸龟沉眠'][jqid] ~= nil and WAR.PD['鲸龟沉眠'][jqid] == 1 then
					WAR.PD['封穴恢复'][jqid] = 100
					WAR.PD['内伤恢复'][jqid] = 100
					WAR.PD['冰封恢复'][jqid] = 100
					WAR.PD['灼烧恢复'][jqid] = 100
					WAR.PD['中毒恢复'][jqid] = 100
					WAR.PD['流血恢复'][jqid] = 100
					Cat('清除所有异常',i)
				end
                --逍遥派北冥
				if MPTX(jqid,7,2) and (Curr_NG(jqid,85) or (XiaoYaoYF(jqid) and PersonKF(jqid,85))) then	
					Cat('清除中级异常',i)
				end
				--一刀流2级
				if MPTX(jqid,11,2) and Curr_NG(jqid,152) then	
					Cat('清除中级异常',i)
				end	
				--全真大恢复术
				if MPTX(jqid,16,2) and PersonKF(jqid,100) and PersonKF(jqid,249) then 
					local a = MPDJ(jqid)
					local b = math.modf(JY.Person[jqid]["生命"] * 0.001)	
					local c = math.modf(JY.Person[jqid]["内力"] * 0.001)	
					local d = math.modf(JY.Person[jqid]["受伤程度"] * 0.1)	
					local e = math.modf(JY.Person[jqid]["中毒程度"] * 0.1)	
					local f = math.modf(JY.Person[jqid]["冰封程度"] * 0.1)	
					local g = math.modf(JY.Person[jqid]["灼烧程度"] * 0.1)	
					local h = math.modf(JY.Person[jqid]["流血程度"] * 0.1)	
					local i = math.modf(JY.Person[jqid]["封穴程度"] * 0.2)
					local j = math.modf(JY.Person[jqid]["体力"] * 0.05)		
					local z = d + e + f + g + h + i
					if WAR.Person[i].Time < 0 and JLSD(0,50,jqid) then
					    AddPersonAttrib(jqid, "生命", a * j)
					    AddPersonAttrib(jqid, "内力", a * z)
					    AddPersonAttrib(jqid, "体力", a * c)
					    Cat('清除中级异常',i)
					end
				end 	
				--花涧派2级
				if MPTX(jqid,21,2) then 
					AddPersonAttrib(jqid, "生命", 35)
					AddPersonAttrib(jqid, "内力", 60)
					AddPersonAttrib(jqid, "体力", 2)
					AddPersonAttrib(jqid, "受伤程度", -7)	
					AddPersonAttrib(jqid, "中毒程度", -7)
					Cat('清除所有异常',i)
				end
				--云梦涧4级
				if MPTX(jqid,26,4) then
					Cat('清除所有异常',i)
				end
				--青城
				if MPTX(jqid,28) then
					local a = JY.Person[jqid]["内力"]/100
					AddPersonAttrib(jqid, "生命", a)
				end 
				--青城
		        if MPTX(jqid,28,3) and Curr_NG(jqid,379) then
					WAR.PD["禁疗"][jqid] = nil
				end	
				--青城虎辟
				if WAR.PD['虎辟'][jqid] ~= nil then 
					WAR.PD['虎辟'][jqid] = WAR.PD['虎辟'][jqid] - 1
					if WAR.PD['虎辟'][jqid] < 1 then 
						WAR.PD['虎辟'][jqid] = nil   
					end
				end	
				--竹风雨滴
				if match_ID(jqid,520) then
					AddPersonAttrib(jqid, "生命", 25)
					AddPersonAttrib(jqid, "内力", 50)
					AddPersonAttrib(jqid, "体力", 5)
					Cat('清除所有异常',i)
					WAR.PD["十方无敌"][jqid] = nil
					WAR.PD["精神错乱"][jqid] = nil
					WAR.PD["凝结时空"][jqid] = nil
					WAR.PD["魅惑状态"][jqid] = nil
					WAR.PD["魔岭玫瑰"][jqid] = nil
					WAR.PD["度化状态"][jqid] = nil
					WAR.PD["天绝剑气"][jqid] = nil
					WAR.PD["万剑归宗"][jqid] = nil
					WAR.PD['九阴摄魂'][jqid] = nil
					WAR.PD['东方浩然'][jqid] = nil
					WAR.PD['虎啸神州'][jqid] = nil
					WAR.PD['剑气长江'][jqid] = nil
					WAR.PD['剑傲中华'][jqid] = nil
				end	
				--噩梦
				if match_ID(jqid,741) or match_ID(jqid,742) then
					Cat('清除所有异常',i)
				end
				--洛梵音
				if match_ID(jqid,760) then
					AddPersonAttrib(jqid, "生命", 75)	
					AddPersonAttrib(jqid, "内力", 10)
					AddPersonAttrib(jqid, "体力", 1)
					Cat('清除中级异常',i)
					WAR.PD["枪神诀1"][jqid] = nil
					WAR.PD["枪神诀2"][jqid] = nil
					WAR.PD["枪神诀3"][jqid] = nil
				end
				----------------------------------时序门派buff-------------------------------------
				--昆仑派指令
				if WAR.PD["昆仑门派指令1"][jqid] == 1 then
					AddPersonAttrib(jqid,"内力",-50)
					if JY.Person[jqid]["内力"] < 1000 then
						WAR.PD["昆仑门派指令1"][jqid] = nil
					end
				end	
				if WAR.PD["昆仑门派指令1"][jqid] == 1 then
				    local x1 = WAR.Person[i]["坐标X"];
					local y1 = WAR.Person[i]["坐标Y"];
					for ex = x1 - 8, x1 + 8 do
						for ey = y1 - 8, y1 + 8 do
							SetWarMap(ex, ey, 4, 1)
							if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
								local ep = GetWarMap(ex, ey, 2)
								local epid = WAR.Person[ep]["人物编号"]
								if WAR.Person[i]["我方"] ~= WAR.Person[ep]["我方"] then 
									if WAR.PD["两倍攻击"][epid] == nil then 
										WAR.PD["两倍攻击"][epid] = 1 
									end 
									if WAR.PD["两倍攻击"][epid] >= 1 then 
										WAR.PD["两倍攻击"][epid] = 1 
									end
									if JLSD(10,42,ep)then
										AddPersonAttrib(epid, "生命", -65)
										AddPersonAttrib(epid, "内力", -80)
									end	
									if WAR.PD['迟缓状态'][epid] == nil then 
										WAR.PD['迟缓状态'][epid] = 5 
									else 
										WAR.PD['迟缓状态'][epid] = WAR.PD['迟缓状态'][epid] + 5
									end 
									if WAR.PD['迟缓状态'][epid] ~= nil and WAR.PD['迟缓状态'][epid] > 50 then 
										WAR.PD['迟缓状态'][epid] = 50 
									end	
									if JY.Person[epid]["生命"] == 0 then
									    WAR.Person[ep]["死亡"] = true
									end   
								end
							end
						end
					end
				end
				
				if WAR.PD["昆仑门派指令2"][jqid] ~= nil then
					WAR.PD["昆仑门派指令2"][jqid] = WAR.PD["昆仑门派指令2"][jqid] - 1
					if WAR.PD["昆仑门派指令2"][jqid] < 1 then
						WAR.PD["昆仑门派指令2"][jqid] = nil
					end
				end

				--昆仑派剑阵
				if WAR.PD['顺逆两仪2'][jqid] ~= nil then
					AddPersonAttrib(jqid,'内力',-math.modf(JY.Person[jqid]["内力"]*0.07))
					if JY.Person[jqid]["内力"] < 1 then
						JY.Person[jqid]["内力"] = 1
					end
				end	
				if WAR.PD['顺逆两仪4'][jqid] ~= nil then
					local a = math.modf(psx(jqid,'生命')*(1.01-(psx(jqid,'内力')/psx(jqid,'内力最大值'))))
					a = limitX(a,25,math.modf(psx(jqid,'生命最大值')*0.025))
					WAR.LYWC = limitX(WAR.LYWC+math.modf(a*0.3),0,10000)
					AddPersonAttrib(jqid,'生命',-a)
				end
				--星宿派门派特效
				if WAR.PD["星宿奇毒"][jqid] ~= nil then
					AddPersonAttrib(jqid,'内力',-math.modf(JY.Person[jqid]["内力最大值"]*0.05))
					if JY.Person[jqid]["内力"] < 1 then
						JY.Person[jqid]["内力"] = 1
					end
					WAR.PD["星宿奇毒"][jqid] = WAR.PD["星宿奇毒"][jqid] - 1
					if WAR.PD["星宿奇毒"][jqid] < 1 then
						WAR.PD["星宿奇毒"][jqid] = nil
					end
				end	
				if WAR.PD["连环腐尸毒"][jqid] ~= nil then
					local a = math.modf(JY.Person[jqid]["中毒程度"]+JY.Person[jqid]["生命最大值"]*0.015)
					AddPersonAttrib(jqid, "生命",-a)
                    WAR.PD["连环腐尸毒"][jqid] = WAR.PD["连环腐尸毒"][jqid] - 1
                    if WAR.PD["连环腐尸毒"][jqid] <= 0 then
                        WAR.PD["连环腐尸毒"][jqid] = nil
                    end
				end
				--古墓派门派特效	
				--武当派门派特效
				--太极拳扩大内伤
				if WAR.YJZD1[jqid] ~= nil then
					if JY.Person[jqid]["受伤程度"] > 50 then
						WAR.YJZD1[jqid] = 10
					else
						WAR.YJZD1[jqid] = WAR.YJZD1[jqid] - 1
						if WAR.YJZD1[jqid] < 1 then
							WAR.YJZD1[jqid] = nil 
						end
					end
				end		
				--密宗门派特效
				--血魔・密宗暴怒
				if MPTX(jqid,6) then 
					if WAR.PD['血魔'][jqid] ~= nil then
						if JY.Person[jqid]["生命"] >= math.modf(JY.Person[jqid]["生命最大值"] * 0.5) then
							AddPersonAttrib(jqid, "生命", -5)
							if (WAR.LQZ[jqid] or 0) < 100 then
								WAR.LQZ[jqid] = 100
							end	
						elseif JY.Person[jqid]["生命"] < math.modf(JY.Person[jqid]["生命最大值"] * 0.5) then
							WAR.PD['血魔'][jqid] = nil
							WAR.LQZ[jqid] = 0
						end				
						if JY.Person[jqid]["生命"] < 0 then JY.Person[jqid]["生命"] = 1 end --武骧金星：避免血魔流血至死
					end
				end
				if MPTX(jqid,6,3) and Curr_NG(jqid,163) then
					AddPersonAttrib(jqid, "流血程度",3)
				end		
				--逍遥派门派特效
				if WAR.PD["逍遥无相"][jqid] ~= nil then
					local a = JY.Person[jqid]["受伤程度"] 
					AddPersonAttrib(jqid,'受伤程度',10) 
					AddPersonAttrib(jqid,'生命',-a) 
					WAR.PD["逍遥无相"][jqid] = WAR.PD["逍遥无相"][jqid] - 1
                    if WAR.PD["逍遥无相"][jqid] <= 0 then
                        WAR.PD["逍遥无相"][jqid] = nil
                    end
				end	
				
				if WAR.PD["逍遥八荒"][jqid] ~= nil then
					local a = JY.Person[jqid]["冰封程度"] 
					local b = JY.Person[jqid]["灼烧程度"] 
					local c = math.modf((a+b)/2)
					AddPersonAttrib(jqid,'冰封程度',10) 
					AddPersonAttrib(jqid,'灼烧程度',10) 
					AddPersonAttrib(jqid,'生命',-c) 
					WAR.PD["逍遥八荒"][jqid] = WAR.PD["逍遥八荒"][jqid] - 1
                    if WAR.PD["逍遥八荒"][jqid] <= 0 then
                        WAR.PD["逍遥八荒"][jqid] = nil
                    end
				end		
				
				if WAR.PD["逍遥长春"][jqid] ~= nil then
					local a = JY.Person[jqid]["流血程度"] 
					AddPersonAttrib(jqid,'流血程度',10) 
					AddPersonAttrib(jqid,'生命',-a) 
					WAR.PD["逍遥长春"][jqid] = WAR.PD["逍遥长春"][jqid] - 1
                    if WAR.PD["逍遥长春"][jqid] <= 0 then
                        WAR.PD["逍遥长春"][jqid] = nil
                    end
				end		
				
				if WAR.PD["逍遥北冥"][jqid] ~= nil then
					local a = JY.Person[jqid]["体力"]
					if a < 10 then
						a = a*50
					end 	
					AddPersonAttrib(jqid,'内力',-20) 
					AddPersonAttrib(jqid,'生命',-a) 
					WAR.PD["逍遥北冥"][jqid] = WAR.PD["逍遥北冥"][jqid] - 1
                    if WAR.PD["逍遥北冥"][jqid] <= 0 then
                        WAR.PD["逍遥北冥"][jqid] = nil
                    end
				end
				--日月吸星
				if WAR.PD["日月吸星"][jqid] ~= nil then
                    local a = JY.Person[jqid]["受伤程度"] 
					AddPersonAttrib(jqid,'受伤程度',5) 
					AddPersonAttrib(jqid,'生命',-a)
					AddPersonAttrib(jqid,'内力',-75) 	
					WAR.PD["日月吸星"][jqid] = WAR.PD["日月吸星"][jqid] - 1
                    if WAR.PD["日月吸星"][jqid] <= 0 then
                        WAR.PD["日月吸星"][jqid] = nil
                    end
				end	
				--中华阁门派特效
				if WAR.PD["山珍海味"][jqid] ~= nil then
					if JY.Person[jqid]["封穴程度"] ~= nil then
                        AddPersonAttrib(jqid,'生命',10) 
					end 
					if JY.Person[jqid]["受伤程度"] ~= nil then
                        AddPersonAttrib(jqid,'生命',10) 
					end 	
					if JY.Person[jqid]["中毒程度"] ~= nil then
                        AddPersonAttrib(jqid,'内力',40) 
					end 
					if JY.Person[jqid]["流血程度"] ~= nil then
                        AddPersonAttrib(jqid,'内力',40) 
					end 
					if JY.Person[jqid]["冰封程度"] ~= nil then
                        AddPersonAttrib(jqid,'体力',1) 
					end 
					if JY.Person[jqid]["灼烧程度"] ~= nil then
                        AddPersonAttrib(jqid,'体力',1) 
					end 
					WAR.PD["山珍海味"][jqid] = WAR.PD["山珍海味"][jqid] - 1
                    if WAR.PD["山珍海味"][jqid] <= 0 then
                        WAR.PD["山珍海味"][jqid] = nil
                    end
				end		
				--万剑归宗
				if WAR.PD["万剑归宗"][jqid] ~= nil then
					WAR.PD["万剑归宗"][jqid] = WAR.PD["万剑归宗"][jqid] - 1
					if WAR.PD["万剑归宗"][jqid] < 1 then
						WAR.PD["万剑归宗"][jqid] = nil
					end
				end
				--唯识剑意
				if WAR.PD["唯识剑意2"][jqid] ~= nil then
					WAR.PD["唯识剑意2"][jqid] = WAR.PD["唯识剑意2"][jqid] - 1
					if WAR.PD["唯识剑意2"][jqid] < 1 then
						WAR.PD["唯识剑意2"][jqid] = nil
					end
				end
				
				--大伏魔九阴
				if WAR.PD["九阴伏魔1"][jqid] ~= nil then
					AddPersonAttrib(jqid,'受伤程度',10)
					AddPersonAttrib(jqid,'中毒程度',10)
					AddPersonAttrib(jqid,'冰封程度',10)
					AddPersonAttrib(jqid,'流血程度',10)
					AddPersonAttrib(jqid,'封穴程度',5)
					AddPersonAttrib(jqid,'体力',-3)
					WAR.PD["九阴伏魔1"][jqid] = WAR.PD["九阴伏魔1"][jqid] - 1
					if WAR.PD["九阴伏魔1"][jqid] < 1 then
						WAR.PD["九阴伏魔1"][jqid] = nil
					end
				end				
				
				if WAR.PD["九阴伏魔2"][jqid] ~= nil then
				    for j = 0, WAR.PersonNum - 1 do 
				        local df = WAR.Person[j]["人物编号"] 	
					    if WAR.Person[j]["死亡"] == false and DWPD(i,j) and RealJL(i,j,9) then
                            local a = JY.Person[df]["灼烧程度"]							
							AddPersonAttrib(df,"生命",-a)
						end
					end	
					WAR.PD["九阴伏魔2"][jqid] = WAR.PD["九阴伏魔2"][jqid] - 1
                    if WAR.PD["九阴伏魔2"][jqid] <= 0 then
                        WAR.PD["九阴伏魔2"][jqid] = nil
                    end	
				end 	    		
				
				if WAR.PD["九阴伏魔3"][jqid] ~= nil then	 	
					local a = JY.Person[jqid]["内力"]*0.015
					local b = JY.Person[jqid]["生命"]*0.03
					AddPersonAttrib(jqid,'生命',-a)
					AddPersonAttrib(jqid,'内力',-b)	
					WAR.PD["九阴伏魔3"][jqid] = WAR.PD["九阴伏魔3"][jqid] - 1
					if WAR.PD["九阴伏魔3"][jqid] < 1 then
						WAR.PD["九阴伏魔3"][jqid] = nil
					end
				end 
				
				--山河破
				if WAR.PD["山河破"][jqid] ~= nil then
					local a = JY.Person[jqid]["受伤程度"] 
					local b = JY.Person[jqid]["中毒程度"] 
					local c = JY.Person[jqid]["冰封程度"] 
					local d = JY.Person[jqid]["灼烧程度"] 
					local e = JY.Person[jqid]["流血程度"] 
					local f = JY.Person[jqid]["封穴程度"] 
					local g = a + b + c + d + e + f
					AddPersonAttrib(jqid,'受伤程度',100)
					AddPersonAttrib(jqid,'中毒程度',100)
					AddPersonAttrib(jqid,'冰封程度',100)
					AddPersonAttrib(jqid,'灼烧程度',100)
					AddPersonAttrib(jqid,'流血程度',100)
					AddPersonAttrib(jqid,'封穴程度',50)
					AddPersonAttrib(jqid,'生命',-g)
					WAR.PD["山河破"][jqid] = WAR.PD["山河破"][jqid] - 1
					if WAR.PD["山河破"][jqid] < 1 then
						WAR.PD["山河破"][jqid] = nil
					end
				end				
				
				if WAR.PD["深入骨髓"][jqid] ~= nil then
					AddPersonAttrib(jqid,'封穴程度',3) 
					AddPersonAttrib(jqid,'流血程度',6) 
					AddPersonAttrib(jqid,'受伤程度',6) 
					AddPersonAttrib(jqid,'冰封程度',6) 
					AddPersonAttrib(jqid,'灼烧程度',6) 
					AddPersonAttrib(jqid,'生命',-30) 
					AddPersonAttrib(jqid,'内力',-45)
					AddPersonAttrib(jqid,'体力',-3)   
                    if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] * 0.4 then
						addbuff(jqid,WAR.PD['灵蛇拳'],5,15)
					end 	
					WAR.PD["深入骨髓"][jqid] = WAR.PD["深入骨髓"][jqid] - 1
                    if WAR.PD["深入骨髓"][jqid] <= 0 then
                        WAR.PD["深入骨髓"][jqid] = nil
                    end
				end							
				--桃花岛门派特效
				if WAR.PD["八门金锁1"][jqid] ~= nil then
					WAR.PD["八门金锁1"][jqid] = WAR.PD["八门金锁1"][jqid] - 1
                    if WAR.PD["八门金锁1"][jqid] <= 0 then
                        WAR.PD["八门金锁1"][jqid] = nil
                    end
				end			
				
				if WAR.PD["八门金锁2"][jqid] ~= nil then
					WAR.PD["八门金锁2"][jqid] = WAR.PD["八门金锁2"][jqid] - 1
                    if WAR.PD["八门金锁2"][jqid] <= 0 then
                        WAR.PD["八门金锁2"][jqid] = nil
                    end
				end		
				
				if WAR.PD["八门金锁3"][jqid] ~= nil then
					WAR.PD["八门金锁3"][jqid] = WAR.PD["八门金锁3"][jqid] - 1
                    if WAR.PD["八门金锁3"][jqid] <= 0 then
                        WAR.PD["八门金锁3"][jqid] = nil
                    end
				end		
				
				if WAR.PD["八门金锁4"][jqid] ~= nil then
					WAR.PD["八门金锁4"][jqid] = WAR.PD["八门金锁4"][jqid] - 1
                    if WAR.PD["八门金锁4"][jqid] <= 0 then
                        WAR.PD["八门金锁4"][jqid] = nil
                    end
				end		
				--大理门派特效
				if WAR.PD["一阳指劲"][jqid] ~= nil then
					AddPersonAttrib(jqid,'灼烧程度',5)
					if JY.Person[jqid]["灼烧程度"] > 20 then
						local a = JY.Person[jqid]["灼烧程度"]
						AddPersonAttrib(jqid,'内力',-a)
					end	
					WAR.PD["一阳指劲"][jqid] = WAR.PD["一阳指劲"][jqid] - 1
                    if WAR.PD["一阳指劲"][jqid] <= 0 then
                        WAR.PD["一阳指劲"][jqid] = nil
                    end
				end
				
                if WAR.PD["六脉剑指"][jqid] ~= nil then
					AddPersonAttrib(jqid,'受伤程度',5)
					if JY.Person[jqid]["受伤程度"] > 20 then
						local a = JY.Person[jqid]["受伤程度"]
						AddPersonAttrib(jqid,'生命',-a)
					end	
					WAR.PD["六脉剑指"][jqid] = WAR.PD["六脉剑指"][jqid] - 1
                    if WAR.PD["六脉剑指"][jqid] <= 0 then
                        WAR.PD["六脉剑指"][jqid] = nil
                    end
				end 				
				--峨眉门派特效
                if WAR.PD["峨眉临济"][jqid] ~= nil then
					local a = JY.Person[jqid]["流血程度"]
					AddPersonAttrib(jqid,'生命',-a) 	
					if math.modf(10) < 5 and WAR.PD['走火入魔'][jqid] == nil then
					    WAR.PD['走火入魔'][jqid] = math.random(3,8)
					end
					WAR.PD["峨眉临济"][jqid] = WAR.PD["峨眉临济"][jqid] - 1
                    if WAR.PD["峨眉临济"][jqid] <= 0 then
                        WAR.PD["峨眉临济"][jqid] = nil
                    end
				end						
				--崆峒门派特效
				if WAR.PD["阴阳双劲"][jqid] ~= nil then
					local a = JY.Person[jqid]["冰封程度"] 
					local b = JY.Person[jqid]["灼烧程度"]
					AddPersonAttrib(jqid,'内力',-a) 
					AddPersonAttrib(jqid,'生命',-b) 	
					WAR.PD["阴阳双劲"][jqid] = WAR.PD["阴阳双劲"][jqid] - 1
                    if WAR.PD["阴阳双劲"][jqid] <= 0 then
                        WAR.PD["阴阳双劲"][jqid] = nil
                    end
				end	
				if WAR.PD["七伤拳木"][jqid] ~= nil then
					local a = JY.Person[jqid]["受伤程度"]
					AddPersonAttrib(jqid,'受伤程度',5) 
					AddPersonAttrib(jqid,'生命',-a) 
					WAR.PD["七伤拳木"][jqid] = WAR.PD["七伤拳木"][jqid] - 1
                    if WAR.PD["七伤拳木"][jqid] <= 0 then
                        WAR.PD["七伤拳木"][jqid] = nil
                    end
				end
				if WAR.PD["七伤拳火"][jqid] ~= nil then
					local a = (WAR.LQZ[jqid] or 0)
					nuqi(jqid,3)
					if (WAR.LQZ[jqid] or 0) > 90 then
						nuqi(jqid,-5)
					end 		
					AddPersonAttrib(jqid,'生命',-a)
					WAR.PD["七伤拳火"][jqid] = WAR.PD["七伤拳火"][jqid] - 1
                    if WAR.PD["七伤拳火"][jqid] <= 0 then
                        WAR.PD["七伤拳火"][jqid] = nil
                    end
				end	
	            if WAR.PD["七伤拳阴"][jqid] ~= nil then	
					WAR.PD["七伤拳阴"][jqid] = WAR.PD["七伤拳阴"][jqid] - 1
                    if WAR.PD["七伤拳阴"][jqid] <= 0 then
                        WAR.PD["七伤拳阴"][jqid] = nil
                    end
				end
				if WAR.PD["七伤拳阳"][jqid] ~= nil then	
					WAR.PD["七伤拳阳"][jqid] = WAR.PD["七伤拳阳"][jqid] - 1
                    if WAR.PD["七伤拳阳"][jqid] <= 0 then
                        WAR.PD["七伤拳阳"][jqid] = nil
                    end
				end
				if WAR.PD["七伤拳土"][jqid] ~= nil then	
					WAR.PD["七伤拳土"][jqid] = WAR.PD["七伤拳土"][jqid] - 1
                    if WAR.PD["七伤拳土"][jqid] <= 0 then
                        WAR.PD["七伤拳土"][jqid] = nil
                    end
				end

                if WAR.PD["虎啸神州"][jqid] ~= nil then
					nuqi(jqid,-10)		
					zhanyi(jqid,-10)
					if (WAR.LQZ[jqid] or 0) > 70 then
						nuqi(jqid,-20)
					end 	
					if (WAR.SPIRIT[jqid] or 0) > 170 then 
						zhanyi(jqid,-20)
					end 	
					AddPersonAttrib(jqid,'体力',-2)
					WAR.PD["虎啸神州"][jqid] = WAR.PD["虎啸神州"][jqid] - 1
                    if WAR.PD["虎啸神州"][jqid] <= 0 then
                        WAR.PD["虎啸神州"][jqid] = nil
                    end
				end	
				
				--黯然美女
				if WAR.PD["黯然销魂"][jqid] ~= nil then
					local a = JY.Person[jqid]["受伤程度"]
					nuqi(jqid,-5)
					if (WAR.LQZ[jqid] or 0) > 50 then
						nuqi(jqid,-10)
					end 	
					AddPersonAttrib(jqid,'受伤程度',5)
					AddPersonAttrib(jqid,'生命',-a)
					AddPersonAttrib(jqid,'内力',-(a*5))
					WAR.PD["黯然销魂"][jqid] = WAR.PD["黯然销魂"][jqid] - 1
                    if WAR.PD["黯然销魂"][jqid] < 1 then
                        WAR.PD["黯然销魂"][jqid] = nil
                    end
				end
				--冰心状态
				if WAR.PD['冰心状态'][jqid] ~= nil then
					nuqi(jqid,-5)
					WAR.PD['冰心状态'][jqid] = limitX(WAR.PD['冰心状态'][jqid],0,20)
					WAR.PD['冰心状态'][jqid] = WAR.PD['冰心状态'][jqid] - 1
					if WAR.PD['冰心状态'][jqid] < 1 then
						WAR.PD['冰心状态'][jqid] = nil 
					end
				end
				--唐门门派特效
				if WAR.HXB1[100 + jqid] ~= nil and WAR.HXB1[100 + jqid] > 0 then 
				    AddPersonAttrib(jqid,"中毒程度" ,15)
				    AddPersonAttrib(jqid, "生命", -100)
				    WAR.HXB1[100 + jqid] = WAR.HXB1[100 + jqid] -1;
				    if WAR.HXB1[100 + jqid] <= 0 then 
					    WAR.HXB1[100 + jqid] = nil 
				    end	  
				end
				
				if WAR.HXB1[200 + jqid] ~= nil and WAR.HXB1[200 + jqid] > 0 then
				    AddPersonAttrib(jqid, "生命", -100)
				    AddPersonAttrib(jqid, "内力", -100)
				    WAR.HXB1[200 + jqid] = WAR.HXB1[200 + jqid] -1;
				    if WAR.HXB1[200 + jqid] <= 0 then 
					    WAR.HXB1[200 + jqid] = nil 
				    end	  
				end
				--夜雨楼特效
				--无明夜时序计数
				if WAR.PD['无明夜'][jqid] ~= nil then
					if Curr_QG(jqid,304) then
						AddPersonAttrib(jqid,'生命',math.random(10,100))
						AddPersonAttrib(jqid,'内力',math.random(100,500))
					end	
					WAR.PD['无明夜'][jqid] = WAR.PD['无明夜'][jqid] - 1	
					if WAR.PD['无明夜'][jqid] < 1 then
						WAR.PD['无明夜'][jqid] = nil
					end
				end
				if WAR.PD['夜雨涨秋池'][jqid] ~= nil then
					AddPersonAttrib(jqid,'生命',math.random(50,250))
					if math.random(10) > 8 then
						Cat('清除中级异常',i)
					end
					WAR.PD['夜雨涨秋池'][jqid] = WAR.PD['夜雨涨秋池'][jqid] - 1
					if WAR.PD['夜雨涨秋池'][jqid] < 1 then
						WAR.PD['夜雨涨秋池'][jqid] = nil
					end
				end	
				if WAR.PD['血袍艳花'][jqid] ~= nil then
					WAR.PD['血袍艳花'][jqid] = WAR.PD['血袍艳花'][jqid] - 1	
					if WAR.PD['血袍艳花'][jqid] < 1 then
						WAR.PD['血袍艳花'][jqid] = nil
					end
				end
				if WAR.PD['枯血泣魂'][jqid] ~= nil then
					WAR.PD['枯血泣魂'][jqid] = WAR.PD['枯血泣魂'][jqid] - 1	
					if WAR.PD['枯血泣魂'][jqid] < 1 then
						WAR.PD['枯血泣魂'][jqid] = nil
					end
				end
				if WAR.PD['极乐血海'][jqid] ~= nil then
					WAR.PD['极乐血海'][jqid] = WAR.PD['极乐血海'][jqid] - 1	
					if WAR.PD['极乐血海'][jqid] < 1 then
						WAR.PD['极乐血海'][jqid] = nil
					end
				end
				if WAR.PD['命无常'][jqid] ~= nil then
					WAR.PD['命无常'][jqid] = WAR.PD['命无常'][jqid] - 1	
					if WAR.PD['命无常'][jqid] < 1 then
						WAR.PD['命无常'][jqid] = nil
					end
				end
				if WAR.PD['极阴无相3'][jqid] ~= nil then
					WAR.PD['极阴无相2'][jqid] = (WAR.PD['极阴无相2'][jqid] or 0) + math.modf(WAR.PD['极阴无相3'][jqid]*0.05)
					AddPersonAttrib(jqid,'内力',-math.modf(psx(jqid,'内力')*0.03))
					if WAR.PD['极阴无相2'][jqid] ~= nil and WAR.PD['极阴无相2'][jqid] >= WAR.PD['极阴无相3'][jqid] then
						WAR.PD['极阴无相2'][jqid] = nil
						WAR.PD['极阴无相3'][jqid] = nil
					end	
				end	
				if WAR.PD['南子脏焰'][jqid] ~= nil then
					WAR.PD['南子脏焰'][jqid] = WAR.PD['南子脏焰'][jqid] - 1
					if WAR.PD['南子脏焰'][jqid] <= 0 then
						WAR.PD['南子脏焰'][jqid] = nil 
					end
				end
				--极阴无相
				if Curr_NG(jqid,367) then
					for bf = 0, WAR.PersonNum-1 do 
						if dead(bf) == false and DWPD(i,bf) then
							local bfid = WAR.Person[bf]['人物编号']
							AddPersonAttrib(bfid,'冰封程度',5)
							WAR.PD['极阴无相1'][bfid] = 1
							if psx(bfid,'冰封程度') > 50 then
								WAR.PD['冰冻状态'][bfid] = (WAR.PD['冰冻状态'][bfid] or 0) + 5
								WAR.PD['冰冻扣血'][bfid] = (WAR.PD['冰冻扣血'][bfid] or 0) + 3
							end	
						end
					end
				end
				if Curr_NG(jqid,367) and rwnlxz(jqid,0) then
					WAR.PD['极阴无相4'][jqid] = (WAR.PD['极阴无相4'][jqid] or 0) + 1
					if WAR.PD['极阴无相4'][jqid] >= 21 then
						WAR.PD['极阴无相4'][jqid] = 0
						Cat('清除高级异常',i)
						local o = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,116,1,'极阴无相・返元归初',M_Red)
						WAR.CurID = o
					end
				end
								
				--护龙山庄
				if WAR.PD["护龙特殊"][jqid] ~= nil then
					local a = JY.Person[jqid]["受伤程度"] 
					local b = JY.Person[jqid]["中毒程度"] 
					local c = JY.Person[jqid]["流血程度"] 
					local d = JY.Person[jqid]["封穴程度"] 
					local e = JY.Person[jqid]["冰封程度"] 
					local f = JY.Person[jqid]["灼烧程度"] 
					local g = a + b + c + d + e + f
					AddPersonAttrib(jqid,'生命',-g)
					WAR.PD["护龙特殊"][jqid] = WAR.PD["护龙特殊"][jqid] - 1
                    if WAR.PD["护龙特殊"][jqid] <= 0 then
                        WAR.PD["护龙特殊"][jqid] = nil
                    end
				end	
				
				--护龙山庄
				if WAR.PD["护龙军师"][jqid] ~= nil then
					AddPersonAttrib(jqid,'受伤程度',100) 
					AddPersonAttrib(jqid,'中毒程度',100) 
					AddPersonAttrib(jqid,'流血程度',100) 
					AddPersonAttrib(jqid,'冰封程度',100) 
					AddPersonAttrib(jqid,'灼烧程度',100) 
					AddPersonAttrib(jqid,'封穴程度',10) 
					WAR.PD["护龙军师"][jqid] = WAR.PD["护龙军师"][jqid] - 1
                    if WAR.PD["护龙军师"][jqid] <= 0 then
                        WAR.PD["护龙军师"][jqid] = nil
                    end
				end	
				--护龙山庄
				if WAR.PD["护龙空手"][jqid] ~= nil then
					WAR.PD["护龙空手"][jqid] = WAR.PD["护龙空手"][jqid] - 1
					if WAR.PD["护龙空手"][jqid] < 1 then
						WAR.PD["护龙空手"][jqid] = nil
					end
				end
				--青牛
				if WAR.PD["青牛"][jqid] ~= nil then
					local a = math.modf(JY.Person[jqid]["生命最大值"]*0.015)
					local b = math.modf(JY.Person[jqid]["内力最大值"]*0.015)
					AddPersonAttrib(jqid,'受伤程度',-100) 
					AddPersonAttrib(jqid,'中毒程度',-100) 
					AddPersonAttrib(jqid,'流血程度',-100) 
					AddPersonAttrib(jqid,'冰封程度',-100) 
					AddPersonAttrib(jqid,'灼烧程度',-100) 
					AddPersonAttrib(jqid,'封穴程度',-100)
					AddPersonAttrib(jqid,'生命',a)
					AddPersonAttrib(jqid,'内力',b) 	
					WAR.PD["青牛"][jqid] = WAR.PD["青牛"][jqid] - 1
					if WAR.PD["青牛"][jqid] < 1 then
						WAR.PD["青牛"][jqid] = nil
					end
				end
				--护龙军师大阵
				if WAR.PD["烈火阵"][jqid] ~= nil then
					AddPersonAttrib(jqid,'生命',-40)
				end
				--护龙军师大阵
				if WAR.PD["驱水阵"][jqid] ~= nil then
					local a = math.random(2,10)
					AddPersonAttrib(jqid,'生命',80)  
					AddPersonAttrib(jqid,'内力',50) 
					AddPersonAttrib(jqid,'体力',3) 
					if math.random(10) > 6 then
						AddPersonAttrib(jqid,'受伤程度',-a) 
						AddPersonAttrib(jqid,'中毒程度',-a) 
						AddPersonAttrib(jqid,'流血程度',-a) 
						AddPersonAttrib(jqid,'冰封程度',-a) 
						AddPersonAttrib(jqid,'灼烧程度',-a) 
						AddPersonAttrib(jqid,'封穴程度',-a) 
					end
				end
				--护龙军师大阵
				if WAR.PD["黄金阵"][jqid] ~= nil then
					if math.random(10) > 7 then
						WAR.PD["神兵"][jqid] = (WAR.PD["神兵"][jqid] or 0) + 1
					end
					if WAR.SSX_Counter == 3 then
						WAR.PD["血淬"][jqid] = (WAR.PD["血淬"][jqid] or 0) + 15
					end
				end
				--云梦涧
				if WAR.PD["云梦涧1"][jqid] ~= nil then
					local a = JY.Person[jqid]["冰封程度"]
					local b = JY.Person[jqid]["受伤程度"]
					local c = a + b
					AddPersonAttrib(jqid,'生命',-c)
					WAR.PD["云梦涧1"][jqid] = WAR.PD["云梦涧1"][jqid] - 1
                    if WAR.PD["云梦涧1"][jqid] <= 0 then
                        WAR.PD["云梦涧1"][jqid] = nil
                    end
				end	
				--云梦涧
				if WAR.PD["云梦涧2"][jqid] ~= nil then
				    local a = (WAR.LQZ[jqid] or 0)
					nuqi(jqid,-5)
					AddPersonAttrib(jqid,'生命',-a)
					WAR.PD["云梦涧2"][jqid] = WAR.PD["云梦涧2"][jqid] - 1
					if WAR.PD["云梦涧2"][jqid] <= 0 then
                        WAR.PD["云梦涧2"][jqid] = nil
                    end
				end
				--云梦涧
				if WAR.PD["云梦涧4"][jqid] ~= nil then
				    if JY.Person[jqid]["生命"] >= 1000 then
						AddPersonAttrib(jqid,'生命',-300)  
					else
					    AddPersonAttrib(jqid,'内力',-100)  
					end	
					WAR.PD["云梦涧4"][jqid] = WAR.PD["云梦涧4"][jqid] - 1
					if WAR.PD["云梦涧4"][jqid] <= 0 then
                        WAR.PD["云梦涧4"][jqid] = nil
                    end
				end	
                --五毒教
				if WAR.PD["五毒教1"][jqid] ~= nil then
					local a = JY.Person[jqid]["中毒程度"] * 5
					AddPersonAttrib(jqid,'中毒程度',5)	
					AddPersonAttrib(jqid,'生命',-a)	
					WAR.PD["五毒教1"][jqid] = WAR.PD["五毒教1"][jqid] - 1
					if WAR.PD["五毒教1"][jqid] <= 0 then
                        WAR.PD["五毒教1"][jqid] = nil
                    end
				end
				--兽王庄
				if WAR.PD["兽王蛇毒"][jqid] ~= nil then
					local a = JY.Person[jqid]["中毒程度"]
					AddPersonAttrib(jqid,'中毒程度',100)	
					AddPersonAttrib(jqid,'生命',-a)	
					WAR.PD["兽王蛇毒"][jqid] = WAR.PD["兽王蛇毒"][jqid] - 1
					if WAR.PD["兽王蛇毒"][jqid] <= 0 then
                        WAR.PD["兽王蛇毒"][jqid] = nil
                    end
				end
				--兽王庄
				if WAR.PD["兽王创伤"][jqid] ~= nil then
					AddPersonAttrib(jqid,'内力',-200)	
					AddPersonAttrib(jqid,'体力',-3)	
					WAR.PD["兽王创伤"][jqid] = WAR.PD["兽王创伤"][jqid] - 1
					if WAR.PD["兽王创伤"][jqid] <= 0 then
                        WAR.PD["兽王创伤"][jqid] = nil
                    end
				end
				--兽王庄
				if WAR.PD["兽王负面"][jqid] ~= nil then
					AddPersonAttrib(jqid,'受伤程度',100)	
					AddPersonAttrib(jqid,'流血程度',100)	
					AddPersonAttrib(jqid,'封穴程度',1)
					WAR.PD["兽王负面"][jqid] = WAR.PD["兽王负面"][jqid] - 1
					if WAR.PD["兽王负面"][jqid] <= 0 then
                        WAR.PD["兽王负面"][jqid] = nil
                    end
				end
				--兽王庄
				if WAR.PD["兽王恢复"][jqid] ~= nil then
					AddPersonAttrib(jqid,'生命',100)	
					AddPersonAttrib(jqid,'内力',200)	
					AddPersonAttrib(jqid,'体力',3)
					WAR.PD["兽王恢复"][jqid] = WAR.PD["兽王恢复"][jqid] - 1
					if WAR.PD["兽王恢复"][jqid] <= 0 then
                        WAR.PD["兽王恢复"][jqid] = nil
                    end
				end
				----------------------------------时序通用生命、内力损失-----------------------------------
				--先天神照
				if WAR.PD['先天真气3'][jqid] ~= nil then
					local a = JY.Person[jqid]["受伤程度"] 
					local b = JY.Person[jqid]["中毒程度"]
					local c = JY.Person[jqid]["流血程度"]
					local d = JY.Person[jqid]["封穴程度"]
					local e = JY.Person[jqid]["灼烧程度"]
					local f = JY.Person[jqid]["冰封程度"]
					local g = 600 - (a + b + c + d)
					if g > 400 then
						g = 400
					end
					if g < 30 then
						g = 30
					end
					AddPersonAttrib(jqid,'生命',g) 
					WAR.PD['先天真气3'][jqid] = limitX(WAR.PD['先天真气3'][jqid],0,10)
					WAR.PD['先天真气3'][jqid] = WAR.PD['先天真气3'][jqid] - 1
					if WAR.PD['先天真气3'][jqid] < 1 then
						WAR.PD['先天真气3'][jqid] = 1 
					end 
				end		
				--先天神照
				if WAR.PD['先天真气2'][jqid] ~= nil then
					WAR.PD['先天真气2'][jqid] = limitX(WAR.PD['先天真气2'][jqid],0,10)
					AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命"]*0.02)) 
					AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.02)) 
					WAR.PD['先天真气2'][jqid] = WAR.PD['先天真气2'][jqid] - 1
					if WAR.PD['先天真气2'][jqid] < 1 then
						WAR.PD['先天真气2'][jqid] = 1 
					end 
				end
				--葵花辟邪
				if PersonKF(jqid,48) and (Curr_NG(jqid,105) or JXPD(jqid,19,1)) and WAR.BXJQ[jqid] ~= nil then
					for j = 0, WAR.PersonNum -1 do 
					    local df = WAR.Person[j]["人物编号"] 
					    local offset1 = math.abs(WAR.Person[i]["坐标X"] - WAR.Person[j]["坐标X"]) 
					    local offset2 = math.abs(WAR.Person[i]["坐标Y"] - WAR.Person[j]["坐标Y"])
					    local offset = math.modf(JY.Person[jqid]["御剑能力"] * 0.008)	
						local yj = math.modf(JY.Person[jqid]["御剑能力"] * 0.05)
						local yj1 = math.modf(JY.Person[jqid]["御剑能力"] * 0.1)
					    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false and (offset1 <= offset and offset2 <= offset) then
					        AddPersonAttrib(df, "生命", -yj)
							AddPersonAttrib(df, "内力", -yj1)
					    end
					end	
			    end
				--岳家枪诀
				if WAR.PD["岳家枪诀"][jqid] ~= nil then
					WAR.PD["岳家枪诀"][jqid] = WAR.PD["岳家枪诀"][jqid] - 1
					if WAR.PD["岳家枪诀"][jqid] < 1 then
						WAR.PD["岳家枪诀"][jqid] = nil
					end
				end
				--龙啸九天
				if WAR.PD["龙啸九天"][jqid] ~= nil then
					local a = JY.Person[jqid]["生命"]*0.06
					AddPersonAttrib(jqid, "生命", -a)
                    WAR.PD["龙啸九天"][jqid] = WAR.PD["龙啸九天"][jqid] - 1
                    if WAR.PD["龙啸九天"][jqid] <= 0 then
                        WAR.PD["龙啸九天"][jqid] = nil
                    end
				end	
				--百里青霜
				if WAR.PD["青霜辟邪"][jqid] ~= nil then
					WAR.PD["青霜辟邪"][jqid] = WAR.PD["青霜辟邪"][jqid] - 1
					if WAR.PD["青霜辟邪"][jqid] < 1 then
						WAR.PD["青霜辟邪"][jqid] = nil
					end
				end
				--光明圣火
				if WAR.PD["光明圣火"][jqid] ~= nil and WAR.PD["光明圣火"][jqid] > 0 then
					local sh = math.modf((WAR.PD["光明圣火"][jqid] or 0)/2)
				    AddPersonAttrib(jqid,'受伤程度',5) 
					AddPersonAttrib(jqid,'灼烧程度',10) 
					AddPersonAttrib(jqid,'生命',-sh)
					if WAR.PD["光明圣火"][jqid] >= 300 then
						if WAR.JSX_Counter == 9 then
							local s = WAR.CurID
							WAR.CurID = i
							WarDrawMap(0)
							CurIDTXDH(WAR.CurID, 112, 1, "不灭圣火・焚烧万物", PinkRed)
							WAR.CurID = s
							local zb = (JY.Person[jqid]["内力最大值"] - JY.Person[jqid]["内力"]) * 0.2 + (WAR.PD["光明圣火"][jqid] or 0)
							local zs = JY.Person[jqid]["灼烧程度"] / 50 + 1
							local gm = math.modf(zb * zs * (WAR.PD["明教指令4"][jqid] or 0 + 1))
							AddPersonAttrib(jqid,'生命',-gm)
							if JY.Person[jqid]["生命"] > 9500 and (isteam(jqid) == false) then
								JY.Person[jqid]["生命"] = 0
							end
						end
					end
					local sx = math.modf((WAR.PD["光明圣火"][jqid] or 0)/20 + 1)
					WAR.PD["光明圣火"][jqid] = WAR.PD["光明圣火"][jqid] - sx
					if WAR.PD["光明圣火"][jqid] <= 0 then
						WAR.PD["光明圣火"][jqid] = nil;
					end
				end
				--神足乾坤
				if WAR.PD["神足真气"][jqid] ~= nil then
					local a = JY.Person[jqid]["内力"] * 0.01
					local b = JY.Person[jqid]["受伤程度"]
					AddPersonAttrib(jqid,'生命',-a)
					AddPersonAttrib(jqid,'内力',-a)
					AddPersonAttrib(jqid, "受伤程度", 15)
					WAR.PD["神足真气"][jqid] = WAR.PD["神足真气"][jqid] - 1
					if WAR.PD["神足真气"][jqid] < 1 then
						WAR.PD["神足真气"][jqid] = nil
					end
				end
			
				--天南冰火
				if WAR.PD["天南易阳"][jqid] ~= nil and WAR.PD["天南易阳"][jqid] > 0 then
					WAR.PD["天南易阳"][jqid] = limitX(WAR.PD["天南易阳"][jqid],0,30)
					local zs = JY.Person[jqid]["灼烧程度"]
					AddPersonAttrib(jqid,'生命',-(30 + zs))
					if JY.Person[jqid]["灼烧程度"] > 50 and math.random(100) < 30 and WAR.PD["阳气侵蚀"][jqid] == nil then
						WAR.PD["阳气侵蚀"][jqid] = math.random(5,8)
					end
					WAR.PD["天南易阳"][jqid] = WAR.PD["天南易阳"][jqid] - 1
					if WAR.PD["天南易阳"][jqid] <= 0 then
						WAR.PD["天南易阳"][jqid] = nil 
					end 
				end 	
				--疯魔
				if WAR.PD["疯魔"][jqid] ~= nil and WAR.PD["疯魔"][jqid] > 0 then
					local fm = math.modf(WAR.PD["疯魔"][jqid] or 0)
					AddPersonAttrib(jqid,'生命',-fm)
				end
				--无明业火状态，耗损使用的内力一半的生命，30时序
				if WAR.PD["无明业火"][jqid] ~= nil then
					WAR.PD["无明业火"][jqid] = limitX(WAR.PD["无明业火"][jqid],0,30)
					WAR.PD["无明业火"][jqid] = WAR.PD["无明业火"][jqid] - 1
					if WAR.PD["天南易阳"][jqid] ~= nil then
						local zs = JY.Person[jqid]["灼烧程度"]
						AddPersonAttrib(jqid,'生命',-zs)
						WAR.PD['举火燎原'][jqid] = (WAR.PD['举火燎原'][jqid] or 0) + math.random(3,5)
					end
					if WAR.PD["无明业火"][jqid] < 1 then
						WAR.PD["无明业火"][jqid] = nil
					end
				end
				--倚天屠龙
				if WAR.PD["倚天屠龙"][jqid] ~= nil then
					local a = JY.Person[jqid]["内力最大值"] - JY.Person[jqid]["内力"]
					AddPersonAttrib(jqid,'生命',-(a*0.08))
					WAR.PD["倚天屠龙"][jqid] = WAR.PD["倚天屠龙"][jqid] - 1
					if WAR.PD["倚天屠龙"][jqid] < 1 then
						WAR.PD["倚天屠龙"][jqid] = nil
					end
				end
				--白蟒鞭法
				if WAR.PD["白蟒鞭法"][jqid] ~= nil then
					AddPersonAttrib(jqid,'生命',-75)
					AddPersonAttrib(jqid,'内力',-120)
					WAR.PD["白蟒鞭法"][jqid] = WAR.PD["白蟒鞭法"][jqid] - 1
					if WAR.PD["白蟒鞭法"][jqid] < 1 then
						WAR.PD["白蟒鞭法"][jqid] = nil
					end
				end
				--降龙六阳
				if WAR.PD["刚柔混劲"][jqid] ~= nil then
					AddPersonAttrib(jqid,'体力',-1)
					AddPersonAttrib(jqid,'内力',-20)
					if (JY.Person[jqid]["灼烧程度"] > 0 or JY.Person[jqid]["冰封程度"] > 0) and WAR.PD["灵蛇拳"][jqid] == nil and math.random(10) < 3 then
						WAR.PD["灵蛇拳"][jqid] = 10
					end
					WAR.PD["刚柔混劲"][jqid] = WAR.PD["刚柔混劲"][jqid] - 1
                    if WAR.PD["刚柔混劲"][jqid] < 1 then
                        WAR.PD["刚柔混劲"][jqid] = nil
                    end
				end
                --引燃：每时序损失2%当前血量
				if WAR.PD['举火燎原'][jqid] ~= nil then
					if match_ID(jqid,525) then
						AddPersonAttrib(jqid,'生命',math.modf(JY.Person[jqid]["生命"]*0.02))
					else
					    AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命"]*0.02))
						if WAR.PD["南子脏焰"][jqid] ~= nil then
							AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命"]*0.02))
						end	
					end
					if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] / 2 and JY.Person[jqid]["灼烧程度"] > 30 then
						if match_ID(jqid,525) then
						else
							WAR.PD['火毒攻心'][jqid] = 1
						end	
					end
					WAR.PD['举火燎原'][jqid] = limitX(WAR.PD['举火燎原'][jqid],0,30)
					WAR.PD['举火燎原'][jqid] = WAR.PD['举火燎原'][jqid] - 1
					if WAR.PD['霜炎九重1'][jqid] ~= nil then
						WAR.PD['举火燎原'][jqid] = WAR.PD['举火燎原'][jqid] - 2
					elseif WAR.PD['霜炎九重2'][jqid] ~= nil then
						WAR.PD['举火燎原'][jqid] = WAR.PD['举火燎原'][jqid] + 0.5
					end	
					if WAR.PD['举火燎原'][jqid] < 1 then
						WAR.PD['举火燎原'][jqid] = nil
					end
				end
				--七伤拳・肝
				if WAR.PD["摧肝肠"][jqid] ~= nil and WAR.PD["摧肝肠"][jqid] > 0 then
					local cg = WAR.PD["摧肝肠"][jqid] or 0
					AddPersonAttrib(jqid,'生命',-7*cg)
					if WAR.PD["创伤"][jqid] ~= nil then
						AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.007))
					end	
				end
				
                --创伤：每时序损失1%最大值血量
                if WAR.PD['创伤'][jqid] ~= nil then
					WAR.PD['创伤'][jqid] = limitX(WAR.PD['创伤'][jqid],0,30)
                    AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.01))
                    if WAR.PD["出血蛇毒"][jqid] ~= nil then
						AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.01))
					end	
					if WAR.PD["南子脏焰"][jqid] ~= nil then
						AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.01))
					end	
					WAR.PD['创伤'][jqid] = WAR.PD['创伤'][jqid] - 1
	                if WAR.PD['创伤'][jqid] < 1 then
	                    WAR.PD['创伤'][jqid] = nil
	                end
				end	
				
                --忘情天书
				if WAR.PD['忘情我无'][jqid] ~= nil then
					AddPersonAttrib(jqid,'生命',-100)	
					if JY.Person[jqid]["生命"] < 1 then
                        JY.Person[jqid]["生命"] = 1
                    end
					WAR.PD['忘情我无'][jqid] = WAR.PD['忘情我无'][jqid] - 1
                    if WAR.PD['忘情我无'][jqid] < 1 then
                        WAR.PD['忘情我无'][jqid] = nil
						if math.random(10) < 2 and WAR.PD["无招胜有招"][jqid] == nil then
							WAR.PD["无招胜有招"][jqid] = 5
						end
                    end
				end
				
				--西域奇毒：每时序损失1%最大值血量
                if WAR.PD['西域奇毒'][jqid] ~= nil then
					WAR.PD['西域奇毒'][jqid] = limitX(WAR.PD['西域奇毒'][jqid],0,30)
                    AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.01))
                    if WAR.PD["南子脏焰"][jqid] ~= nil then
						AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["生命最大值"]*0.01))
					end	
                    if WAR.PD['出血蛇毒'][jqid] ~= nil and JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] * 0.1 then
						if match_ID(jqid,456) then
						else
						    JY.Person[jqid]["生命"] = 0
							WAR.Person[i]["死亡"] = true
							WarSetPerson()
							break
						end
                    end	
					WAR.PD['西域奇毒'][jqid] = WAR.PD['西域奇毒'][jqid] - 1
                    if WAR.PD['西域奇毒'][jqid] < 1 then
                        WAR.PD['西域奇毒'][jqid] = nil
                    end
				end	
				--蓝烟清：王难姑指令，按时序中毒
				if WAR.PD['毒击'][jqid] ~= nil and WAR.PD['毒击'][jqid] > 0 then
					WAR.PD['毒击'][jqid] = limitX(WAR.PD['毒击'][jqid],0,30)
					AddPersonAttrib(jqid,'中毒程度',8)
					AddPersonAttrib(jqid,"生命",-math.modf(JY.Person[jqid]["中毒程度"]*0.5))
					WAR.PD['毒击'][jqid] = WAR.PD['毒击'][jqid] -1;
					if WAR.PD['毒击'][jqid] < 1 then
						WAR.PD['毒击'][jqid] = nil;
					end
				end
				
				--气阻中门
				if WAR.PD['气阻中门'][jqid] ~= nil then
					WAR.PD['气阻中门'][jqid] = limitX(WAR.PD['气阻中门'][jqid],0,15)
					local qz = (WAR.PD['气阻中门'][jqid] or 0) * 5
					local sm = math.modf(JY.Person[jqid]["生命"]*0.01)
					AddPersonAttrib(jqid,'生命',-qz)
					AddPersonAttrib(jqid,'内力',-sm)
					WAR.PD['气阻中门'][jqid] = WAR.PD['气阻中门'][jqid] - 1
                    if WAR.PD['气阻中门'][jqid] < 1 then
                        WAR.PD['气阻中门'][jqid] = nil
                    end
				end
				
				--力竭
				if WAR.PD['力竭'][jqid] ~= nil then
					local lj = (100 - JY.Person[jqid]["体力"])
                    AddPersonAttrib(jqid,'生命',-lj)
					if JY.Person[jqid]["体力"] < 50 and math.random(10) < 3 then
						WAR.PD["麻痹状态"][jqid] = math.random(2,10)
					end
				end	
				
				--业力引爆
                if WAR.PD['业力引爆'][jqid] ~= nil then
                    if NGQH(jqid,160) then
						WAR.PD['业力引爆'][jqid] = nil
					else
						if JLSD(10,55,jqid) then
							AddPersonAttrib(jqid,'生命',-math.modf((180-JY.Person[jqid]["品德"]) / 2))
							if JY.Person[jqid]["生命"] < 1 then
								JY.Person[jqid]["生命"] = 1
							end
						end	
						WAR.PD['业力引爆'][jqid] = WAR.PD['业力引爆'][jqid] - 1
						if WAR.PD['业力引爆'][jqid] < 1 then
							WAR.PD['业力引爆'][jqid] = nil
						end
					end	
				end
				--散功：每时序损失3%当前内力
                if WAR.PD["散功状态"][jqid] ~= nil then
					WAR.PD["散功状态"][jqid] = limitX(WAR.PD["散功状态"][jqid],0,30)
                    AddPersonAttrib(jqid,'内力',-math.modf(JY.Person[jqid]["内力"]*0.03))
                    if JY.Person[jqid]["内力"] < 1 then
                        JY.Person[jqid]["内力"] = 1
                    end	
                    WAR.PD["散功状态"][jqid] = WAR.PD["散功状态"][jqid] - 1
                    if WAR.PD["散功状态"][jqid] < 1 then
                        WAR.PD["散功状态"][jqid] = nil
                    end
				end		
				--忘情天书
				if WAR.PD['忘情风流'][jqid] ~= nil then	
					WAR.PD['忘情风流'][jqid] = limitX(WAR.PD['忘情风流'][jqid],0,30)
					AddPersonAttrib(jqid,'内力',-math.modf(JY.Person[jqid]["内力最大值"]*0.02))
					AddPersonAttrib(jqid,'内力',-math.modf(JY.Person[jqid]["内力"]*0.05))
					if JY.Person[jqid]["内力"] < 1 then
                        JY.Person[jqid]["内力"] = 1
                    end	
					WAR.PD['忘情风流'][jqid] = WAR.PD['忘情风流'][jqid] - 1
                    if WAR.PD['忘情风流'][jqid] < 1 then
                        WAR.PD['忘情风流'][jqid] = nil
                    end
				end
				--透骨针效果
				if WAR.PD['透骨针1'][jqid] ~= nil then
					local a = JY.Person[jqid]["流血程度"]*2
					AddPersonAttrib(jqid, "流血程度", 20)
					AddPersonAttrib(jqid, "生命", -math.modf(a+JY.Person[jqid]["冰封程度"]))
					WAR.PD["透骨针1"][jqid] = WAR.PD["透骨针1"][jqid] - 1
                    if WAR.PD["透骨针1"][jqid] < 1 then
                        WAR.PD["透骨针1"][jqid] = nil
                    end
				end 	
				--透骨针效果
				if WAR.PD['透骨针2'][jqid] ~= nil then
					AddPersonAttrib(jqid, "体力", -2)
					WAR.PD['集气速度'][jqid] = limitX((WAR.PD['集气速度'][jqid] or 0) - 2,0,-40)
					WAR.PD['透骨针2'][jqid] = WAR.PD['透骨针2'][jqid] - 1
					if WAR.PD['透骨针2'][jqid] < 1 then
						WAR.PD['透骨针2'][jqid] = nil
					end
				end	
				--透骨针效果
				if WAR.PD['透骨针3'][jqid] ~= nil then
					local a = JY.Person[jqid]["中毒程度"]
					AddPersonAttrib(jqid, "中毒程度", 20)
					AddPersonAttrib(jqid, "内力", -math.modf(a+JY.Person[jqid]["冰封程度"]))
					WAR.PD["透骨针3"][jqid] = WAR.PD["透骨针3"][jqid] - 1
                    if WAR.PD["透骨针3"][jqid] < 1 then
                        WAR.PD["透骨针3"][jqid] = nil
                    end
				end
				--枪神诀
				if WAR.PD['枪神诀1'][jqid] ~= nil then 
					local a = JY.Person[jqid]["受伤程度"]
					local b = JY.Person[jqid]["灼烧程度"]
					local c = a + b
					local d = JY.Person[jqid]["冰封程度"] * 2
					AddPersonAttrib(jqid, "受伤程度", 100)
					AddPersonAttrib(jqid, "灼烧程度", 100)
					AddPersonAttrib(jqid, "冰封程度", 100)
					AddPersonAttrib(jqid, "生命", -c)
					AddPersonAttrib(jqid, "内力", -d)
					AddPersonAttrib(jqid, "体力", -1)
					WAR.PD["枪神诀1"][jqid] = WAR.PD["枪神诀1"][jqid] - 1
                    if WAR.PD["枪神诀1"][jqid] < 1 then
                        WAR.PD["枪神诀1"][jqid] = nil
                    end
				end
				
				--枪神诀
				if WAR.PD['枪神诀3'][jqid] ~= nil then 
					local a = JY.Person[jqid]["内力"]*0.08
					AddPersonAttrib(jqid, "生命", -a)
					WAR.PD['枪神诀3'][jqid] = limitX(WAR.PD['枪神诀3'][jqid],0,10)
					WAR.PD["枪神诀3"][jqid] = WAR.PD["枪神诀3"][jqid] - 1
                    if WAR.PD["枪神诀3"][jqid] < 1 then
                        WAR.PD["枪神诀3"][jqid] = nil
                    end
				end
				
				if WAR.PD['剑气长江'][jqid] ~= nil then
					AddPersonAttrib(jqid,'生命',-math.modf(JY.Person[jqid]["内力"]/50))	
					WAR.PD["剑气长江"][jqid] = WAR.PD["剑气长江"][jqid] - 1
					if WAR.PD['剑气长江'][jqid] < 1 then
						WAR.PD['剑气长江'][jqid] = nil
					end
				end
				
				if WAR.PD['剑傲中华'][jqid] ~= nil then
					AddPersonAttrib(jqid,'生命', -math.modf(JY.Person[jqid]["生命最大值"]*0.05))
					WAR.PD["剑傲中华"][jqid] = WAR.PD["剑傲中华"][jqid] - 1
					if WAR.PD['剑傲中华'][jqid] < 1 then
						WAR.PD['剑傲中华'][jqid] = nil
					end
				end
                ----------------------------------奇穴时序丢失生命、内力（敌）----------------------------
				--拳法奇穴
				if WAR.QFQXM[jqid] ~= nil and WAR.QFQXM[jqid] > 0 then
					local a = JY.Person[jqid]["受伤程度"]*2		
					AddPersonAttrib(jqid,'生命',-a)		
					WAR.QFQXM[jqid] = WAR.QFQXM[jqid] - 1
					if WAR.QFQXM[jqid] < 1 then
						WAR.QFQXM[jqid] = nil
					end
				end 		
				
				--拳法奇穴
				if WAR.QFQXN[jqid] ~= nil and WAR.QFQXN[jqid] > 0 then
					local a = JY.Person[jqid]["受伤程度"]*2	
					AddPersonAttrib(jqid,'内力',-a)		
					WAR.QFQXN[jqid] = WAR.QFQXN[jqid] - 1
					if WAR.QFQXN[jqid] < 1 then
						WAR.QFQXN[jqid] = nil
					end
				end 		
				
				--指法奇穴
				if WAR.ZFQXM[jqid] ~= nil and WAR.ZFQXM[jqid] > 0 then
					local a = JY.Person[jqid]["封穴程度"]*2
					AddPersonAttrib(jqid,'生命',-a)
					WAR.ZFQXM[jqid] = WAR.ZFQXM[jqid] - 1
					if WAR.ZFQXM[jqid] < 1 then
						WAR.ZFQXM[jqid] = nil
					end 	
				end 	
				
				--指法奇穴
				if WAR.ZFQXN[jqid] ~= nil and WAR.ZFQXN[jqid] > 0 then
					local a = JY.Person[jqid]["封穴程度"]*2
					AddPersonAttrib(jqid,'内力',-a)
					WAR.ZFQXN[jqid] = WAR.ZFQXN[jqid] - 1
					if WAR.ZFQXN[jqid] < 1 then
						WAR.ZFQXN[jqid] = nil
					end 	
				end 			
				
				--剑法奇穴
				if WAR.JXSMD[jqid] ~= nil and WAR.JXSMD[jqid] > 0 then
					local a = JY.Person[jqid]["冰封程度"]*2
					AddPersonAttrib(jqid,'生命',-a)
					WAR.JXSMD[jqid] = WAR.JXSMD[jqid] - 1
					if WAR.JXSMD[jqid] < 1 then
						WAR.JXSMD[jqid] = nil
					end 	
				end 	
				
				--剑法奇穴
				if WAR.JXNLD[jqid] ~= nil and WAR.JXNLD[jqid] > 0 then
					local a = JY.Person[jqid]["冰封程度"]*2
					AddPersonAttrib(jqid,'生命',-a)
					WAR.JXNLD[jqid] = WAR.JXNLD[jqid] - 1
					if WAR.JXNLD[jqid] < 1 then
						WAR.JXNLD[jqid] = nil
					end 	
				end 		
				
				----------------------------------奇穴时序丢失生命、内力（我）----------------------------
				--拳法奇穴
				if WAR.QFMQX[jqid] ~= nil and WAR.QFMQX[jqid] > 0 then
					local a = JY.Person[jqid]["拳掌功夫"]/10		
					AddPersonAttrib(jqid,'生命',a)		
					WAR.QFMQX[jqid] = WAR.QFMQX[jqid] - 1
					if WAR.QFMQX[jqid] < 1 then
						WAR.QFMQX[jqid] = nil
					end
				end 		
				
				--拳法奇穴
				if WAR.QFNQX[jqid] ~= nil and WAR.QFNQX[jqid] > 0 then
					local a = JY.Person[jqid]["拳掌功夫"]/10		
					AddPersonAttrib(jqid,'内力',a)		
					WAR.QFNQX[jqid] = WAR.QFNQX[jqid] - 1
					if WAR.QFNQX[jqid] < 1 then
						WAR.QFNQX[jqid] = nil
					end
				end 	
				
				--剑法奇穴
				if WAR.JXSMW[jqid] ~= nil and WAR.JXSMW[jqid] > 0 then
					local a = JY.Person[jqid]["攻击力"]/15
					AddPersonAttrib(jqid,'生命',a)
					WAR.JXSMW[jqid] = WAR.JXSMW[jqid] - 1
					if WAR.JXSMW[jqid] < 1 then
						WAR.JXSMW[jqid] = nil
					end 	
				end 				
				
				--剑法奇穴
				if WAR.JXNLW[jqid] ~= nil and WAR.JXNLW[jqid] > 0 then
					local a = JY.Person[jqid]["防御力"]/15
					AddPersonAttrib(jqid,'内力',a)
					WAR.JXNLW[jqid] = WAR.JXNLW[jqid] - 1
					if WAR.JXNLW[jqid] < 1 then
						WAR.JXNLW[jqid] = nil
					end 	
				end
        ----------------------------------时序流血回复-----------------------------------
				--每时序回复1点流血、不致死
				if JY.Person[jqid]["流血程度"] > 0 then
					local aa = math.random(2,4)
					if MPTX(jqid,6,2) and Curr_NG(jqid,163) then
						AddPersonAttrib(jqid,'生命', (math.random(aa)*math.modf(psx(jqid,'受伤程度')/40)))
						WAR.PD['凝血纹印'][jqid] = limitX((WAR.PD['凝血纹印'][jqid] or 0) + math.modf(JY.Person[jqid]["流血程度"]/10),0,1000)
						if WAR.PD['血淬'][jqid] == nil then
							WAR.PD['血淬'][jqid] = 20
						else
						    WAR.PD['血淬'][jqid] = (WAR.PD['血淬'][jqid]) or 0 + math.modf(psx(jqid,'流血程度')/10)
						end
					else
				        AddPersonAttrib(jqid,'生命', -(math.random(aa)*math.modf(psx(jqid,'受伤程度')/40)))
						if JY.Person[jqid]["生命"] < 1 then
							JY.Person[jqid]["生命"] = 1
						end
					end
					--血海飘香
					if MPTX(jqid,6,3) and Curr_NG(jqid,163) then
						if WAR.PD['凝血纹印'][jqid] ~=nil and WAR.PD['凝血纹印'][jqid] > 0 then
							local sm = JY.Person[jqid]["生命最大值"] * (WAR.PD['凝血纹印'][jqid] or 0)/8000
							AddPersonAttrib(jqid,'生命',math.modf(sm))
						end
						for j = 0, WAR.PersonNum-1 do 
							local df = WAR.Person[j]["人物编号"] 
							local offset1 = math.abs(WAR.Person[i]["坐标X"] - WAR.Person[j]["坐标X"]) 
							local offset2 = math.abs(WAR.Person[i]["坐标Y"] - WAR.Person[j]["坐标Y"])
							local offset= offset1 + offset2
							local lx = math.modf(JY.Person[jqid]["流血程度"]/8)
							local nx = math.modf((WAR.PD['凝血纹印'][jqid] or 0)/80)
							local fw = lx + nx
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false and (offset1 <= fw and offset2 <= fw) then
								AddPersonAttrib(df, "生命", -(JY.Person[df]["流血程度"] / 20 * (fw + 1)))
								AddPersonAttrib(jqid, "生命", (JY.Person[df]["流血程度"] / 20 * (fw + 1)))
								if JY.Person[df]["流血程度"] > 50 then 
									if WAR.WSX_Counter == 5 then
										WAR.PD['血海飘香'][df] = 1
									end
								end
							end
						end
					end
					--扫荡群魔
					if WAR.PD["扫荡群魔"][jqid] ~= nil then
						AddPersonAttrib(jqid,'生命', -math.modf(JY.Person[jqid]["生命最大值"]*0.01))
						AddPersonAttrib(jqid,'流血程度',(JY.Person[jqid]["受伤程度"])/3)
					end
					--出血蛇毒
					if WAR.PD["出血蛇毒"][jqid] ~= nil then
						AddPersonAttrib(jqid,'生命', -math.modf(JY.Person[jqid]["生命最大值"]*0.01))
						AddPersonAttrib(jqid,'中毒程度',(JY.Person[jqid]["流血程度"])/3)
					end
					--神教逆杀
					if WAR.PD['神教逆杀'][jqid] ~= nil then 
						if JY.Person[jqid]["流血程度"] < 100 then
							JY.Person[jqid]["流血程度"] = 100
						end
						AddPersonAttrib(jqid,"生命",-((math.random(20)+ math.modf(JY.Person[jqid]["受伤程度"]/3))*2))
					end
					--主运乾坤，罗汉额外恢复流血
					--忘情天书
					if Curr_NG(jqid, 97) or Curr_NG(jqid, 96) or Curr_NG(jqid, 177) then
						AddPersonAttrib(jqid,'流血程度',-1)
					end
					if JY.Person[jqid]["坐骑"] == 262 or PersonKF(jqid,204) then 
						AddPersonAttrib(jqid,'流血程度',-2)
					end
					--流血恢复
					if WAR.PD['流血恢复'][jqid]~=nil and WAR.PD['流血恢复'][jqid] > 0 then
						local n = WAR.PD['流血恢复'][jqid]
						AddPersonAttrib(jqid,'流血程度',-n)
					end
					--擒龙罗汉
					if NGQH(jqid,204) then
						AddPersonAttrib(jqid,"生命",((math.random(aa) + math.modf(JY.Person[jqid]["受伤程度"] / 5)) * aa))
					end
					--吃药
					if WAR.PD['即墨老酒'][jqid] ~= nil then
                        AddPersonAttrib(jqid,"流血程度",-1)
                        WAR.PD['即墨老酒'][jqid] = WAR.PD['即墨老酒'][jqid] - 1
                        if WAR.PD['即墨老酒'][jqid] < 1 then 
                            WAR.PD['即墨老酒'][jqid] = nil   
                        end
                    end
					--流血清除
					if MPTX(jqid,6,2) and Curr_NG(jqid,163) then
					    JY.Person[jqid]["流血程度"] = JY.Person[jqid]["流血程度"] + 1
					else
					    JY.Person[jqid]["流血程度"] = JY.Person[jqid]["流血程度"] - 1
					end
					if JY.Person[jqid]["流血程度"] == nil or JY.Person[jqid]["流血程度"] < 1 then
						JY.Person[jqid]["流血程度"] = 0
					end
				end
				----------------------------------时序冰封回复-----------------------------------
				--每时序回复1点冰封
				if  JY.Person[jqid]["冰封程度"] > 0 and MPTX(jqid,20) == false then
					--每时序-3生命
					if QFZH(jqid,13,196) == false and PersonKF(jqid,367) == false then
						local bf = math.modf(JY.Person[jqid]["冰封程度"]/10)
						if Curr_NG(jqid,106) then
							bf = math.modf(bf*0.5)
						end	
						AddPersonAttrib(jqid,'内力',-bf)
						if psxper(i,'内力',0.5,2) then
							AddPersonAttrib(jqid,'生命',-3)
						end	
						if psx(jqid,'内力') < 1 and math.random(10) > 5 then
							AddPersonAttrib(jqid,'体力',-3)
						end
					end
					--深度冰封每时序-15内
					if JY.Person[jqid]["冰封程度"] >= 50 and (not (MPTX(jqid,20))) then
						AddPersonAttrib(jqid,'内力',-10)
					end
					if WAR.PD['易水四寒'][jqid] ~= 1 or WAR.PD['易水四寒'][jqid] ~= 5 then
						AddPersonAttrib(jqid,'冰封程度',-1)
					end
					--主运纯阳，九阳额外恢复冰封
					if Curr_NG(jqid, 99) or Curr_NG(jqid, 106) then
						AddPersonAttrib(jqid,'冰封程度',-1)
					end				
					--冰封恢复
					if WAR.PD['冰封恢复'][jqid] ~=nil and WAR.PD['冰封恢复'][jqid] ~= 0 then
						local n = WAR.PD['冰封恢复'][jqid]
						AddPersonAttrib(jqid,'冰封程度',-n)
					end
					--阴阳无极功
					if Curr_NG(jqid, 221) then
						AddPersonAttrib(jqid,'冰封程度',-2)
					end				
					if (WAR.PD['阴阳双极'][jqid] or -1) >= 31 then
						if JLSD(10,25,jqid) then
							AddPersonAttrib(jqid,'冰封程度',-7)
						end
					end
					if WAR.PD['梨花酒'][jqid] ~= nil then 
						AddPersonAttrib(jqid,'冰封程度',-1)
						WAR.PD['梨花酒'][jqid] = WAR.PD['梨花酒'][jqid] - 1
						if WAR.PD['梨花酒'][jqid] < 1 then 
							WAR.PD['梨花酒'][jqid] = nil   
						end
					end
					AddPersonAttrib(jqid,'冰封程度',-1)
				end
				----------------------------------时序灼烧回复-----------------------------------
				if JY.Person[jqid]["灼烧程度"] > 0 and QFZH(jqid,13,196) == false and Curr_NG(jqid,314) == false then
					local zs = math.modf(JY.Person[jqid]["灼烧程度"] / 8)
					if Curr_NG(jqid,107) then
						zs = math.modf(zs*0.5)
					end	
					if match_ID(jqid,525) then
					else
						AddPersonAttrib(jqid,'生命',-zs)
					end	
					if JY.Person[jqid]["生命"] < 1 then
						JY.Person[jqid]["生命"] = 1
					end	
				end	
				--每时序回复1点灼烧
				if JY.Person[jqid]["灼烧程度"] > 0 then
					if PersonKF(jqid,13) and PersonKF(jqid,196) then
						WAR.PD['炼铁劲'][jqid] = (WAR.PD['炼铁劲'][jqid] or 0) + JY.Person[jqid]["灼烧程度"] * 7
					end	
					if match_ID(jqid,525) and psxper(i,'生命',0.5,2) then
						AddPersonAttrib(jqid,'生命',JY.Person[jqid]["灼烧程度"])
					end
					--主运九阴额外恢复灼烧
					if Curr_NG(jqid, 107) then
						if rwnlxz(jqid,0) then
							AddPersonAttrib(jqid,'灼烧程度',-2)
						else
							AddPersonAttrib(jqid,'灼烧程度',-1)
						end	
					end
					--枯荣额外恢复灼烧
					if match_ID(jqid, 102) then
						AddPersonAttrib(jqid,'灼烧程度',-1)
					end
					--灼烧恢复
					if WAR.PD['灼烧恢复'][jqid]~=nil and WAR.PD['灼烧恢复'][jqid] > 0 then
						local n = WAR.PD['灼烧恢复'][jqid]
						AddPersonAttrib(jqid,'灼烧程度',-n)
					end
					--阴阳双极
					if (WAR.PD['阴阳双极'][jqid] or -1) < 31 then
						if JLSD(10,25,jqid) then
							AddPersonAttrib(jqid,'灼烧程度',-7)
						end
					end
					--阴阳无极功
					if Curr_NG(jqid, 221) then
						AddPersonAttrib(jqid,'灼烧程度',-2)
					end					
					
					if WAR.PD['玉露酒'][jqid] ~= nil then 
						AddPersonAttrib(jqid,'灼烧程度',-1)
						WAR.PD['玉露酒'][jqid] = WAR.PD['玉露酒'][jqid] - 1
						if WAR.PD['玉露酒'][jqid] < 1 then 
							WAR.PD['玉露酒'][jqid] = nil
						end
					end
					AddPersonAttrib(jqid,'灼烧程度',-1)
				end
				----------------------------------时序内伤回复-----------------------------------
                --无酒不欢：时序回复内伤的设定
				if JY.Person[jqid]["受伤程度"] > 0 then
					--3时序回1内伤的判定
					--紫霞，逆运，九阴，金刚，九阳，化功，吸星，北冥，太玄，易筋经，玉女心经，瑜伽密乘，混元 葵花,太虚剑意，鲸息功，不老长春功 太极神功，天南易阳、阴阳无极功
					--萧半和，黄衫
					if Curr_NG(jqid, 89) or Curr_NG(jqid,105) or Curr_NG(jqid, 104) or Curr_NG(jqid, 107) or Curr_NG(jqid, 144) or Curr_NG(jqid, 106) 
					or Curr_NG(jqid, 87) or Curr_NG(jqid,88) or Curr_NG(jqid, 85) or Curr_NG(jqid, 102) or Curr_NG(jqid, 108) or Curr_NG(jqid, 154)
					or Curr_NG(jqid, 91) or Curr_NG(jqid,90) or Curr_NG(jqid, 152) or Curr_NG(jqid, 171) or Curr_NG(jqid, 180) or Curr_NG(jqid, 183)
					or Curr_NG(jqid, 184) or Curr_NG(jqid,238) or Curr_NG(jqid, 252) or Curr_NG(jqid, 314) or Curr_NG(jqid, 375) or Curr_NG(jqid, 221) then
					    if WAR.SSX_Counter == 3 then
							AddPersonAttrib(jqid,'受伤程度',-1)
						end
					end
					--初阶内功回复5时序回1内伤
					for i = 208,220 do
						if Curr_NG(jqid,i) then
							if WAR.WSX_Counter == 5 then
								AddPersonAttrib(jqid,'受伤程度',-1)
							end
						end
					end
					--5时序回1内伤的判定
					--圣火，葵花，八荒，先天，蛤蟆，龙象，小无，血河 忘情,寒冰真气，小周天功
					if Curr_NG(jqid, 93)  or Curr_NG(jqid, 101) or Curr_NG(jqid, 100) 
					or Curr_NG(jqid, 95) or Curr_NG(jqid, 103) or Curr_NG(jqid, 98) or Curr_NG(jqid, 163) or Curr_NG(jqid, 177) 
					or Curr_NG(jqid, 190) or Curr_NG(jqid,216) or Curr_NG(jqid,227) or Curr_NG(jqid,225) then
					    if WAR.WSX_Counter == 5 then
							AddPersonAttrib(jqid,'受伤程度',-1)
						end
					end
					--主运天赋内功，5时序额外回1内伤
					if JY.Person[jqid]["主运内功"] ~= 0 and JY.Person[jqid]["主运内功"] == JY.Person[jqid]["天赋内功"] then
						if WAR.WSX_Counter == 5 then
							AddPersonAttrib(jqid,'受伤程度',-1)
						end
					end
					--主运三神功内伤大于50时，额外回复  
					if JY.Person[jqid]["受伤程度"] > 50 and (Curr_NG(jqid, 106) or Curr_NG(jqid, 107) or Curr_NG(jqid, 108)) then
						if WAR.SSX_Counter == 3 then
							AddPersonAttrib(jqid,'受伤程度',-1)
						end
					end
					--内伤恢复
					if WAR.PD['内伤恢复'][jqid]~=nil and WAR.PD['内伤恢复'][jqid] ~= 0 then
						local n = WAR.PD['内伤恢复'][jqid]
						AddPersonAttrib(jqid,'受伤程度',-n)
					end
					--魔帝BOSS
					if match_ID(jqid,26) then
						AddPersonAttrib(jqid,'受伤程度',-3)
					end
					
					--黑级浮屠
					if match_ID(jqid,9930) then
						AddPersonAttrib(jqid,'受伤程度',-2)
					end
					if WAR.PD['小还丹'][jqid] ~= nil then 
						AddPersonAttrib(jqid,'受伤程度',-1)
						WAR.PD['小还丹'][jqid] = WAR.PD['小还丹'][jqid] - 1
						if WAR.PD['小还丹'][jqid] < 1 then 
							WAR.PD['小还丹'][jqid] = nil   
						end
					end
				end
				----------------------------------时序中毒回复-----------------------------------
				if JY.Person[jqid]['中毒程度'] > 0 then
					--纯阳，九阳，逆运，易筋经每时序回复1点中毒
					if Curr_NG(jqid, 99) or Curr_NG(jqid, 106) or Curr_NG(jqid, 104) or Curr_NG(jqid, 108) then	
						AddPersonAttrib(jqid,'中毒程度',-1)
					end
					if not inteam(jqid) then
						if WAR.LSX_Counter == 3 then
							AddPersonAttrib(jqid,'中毒程度',-1)	
						end
					end
					--中毒恢复
					if WAR.PD['中毒恢复'][jqid]~=nil and WAR.PD['中毒恢复'][jqid] > 0 then
						local n = WAR.PD['中毒恢复'][jqid]
						AddPersonAttrib(jqid,'中毒程度',-n)
					end
					--黑级浮屠
					if match_ID(jqid,9930) then	
						AddPersonAttrib(jqid,'中毒程度',-2)
					end
					--任盈盈，每时序回复5点中毒
					if match_ID(jqid,73) then	
						AddPersonAttrib(jqid,'中毒程度',-5)
					end
					if WAR.PD['黄连解毒'][jqid] ~= nil then 
						AddPersonAttrib(jqid,'中毒程度',-1)
						WAR.PD['黄连解毒'][jqid] = WAR.PD['黄连解毒'][jqid] - 1
						if WAR.PD['黄连解毒'][jqid] < 1 then 
							WAR.PD['黄连解毒'][jqid] = nil   
						end
					end
					if WAR.PD['牛黄血蝎'][jqid] ~= nil then 
						AddPersonAttrib(jqid,'中毒程度',-1)
						WAR.PD['牛黄血蝎'][jqid] = WAR.PD['牛黄血蝎'][jqid] - 1
						if WAR.PD['牛黄血蝎'][jqid] < 1 then 
							WAR.PD['牛黄血蝎'][jqid] = nil   
						end
					end
					--五毒教
					if MPTX(jqid,29) then
						AddPersonAttrib(jqid,'中毒程度',-35)
					end
				end
				----------------------------------时序体力回复-----------------------------------
				if JY.Person[jqid]["体力"] < 100 then
					if not inteam(jqid) then
						if WAR.LSX_Counter == 3 then
							AddPersonAttrib(jqid,'体力',1)
						end
					end
					--主运混元，3时序回1体力、萧半和
					if Curr_NG(jqid,90) or Curr_NG(jqid,375) or (jqid == 0 and JY.Base["畅想"] == 189) then
						if WAR.SSX_Counter == 3 then
							AddPersonAttrib(jqid,'体力',1)
						end
					--被动混元，6时序回1体力
					elseif PersonKF(jqid,90) or PersonKF(jqid,375) then
					    if WAR.LSX_Counter == 6 then
							AddPersonAttrib(jqid,'体力',1)
						end
					end
					--主运葵花
					if Curr_NG(jqid,105) then 
						if WAR.SSX_Counter == 5 then
							AddPersonAttrib(jqid,'体力',1)
						end
					end
					--主运九阴、逆运，6时序回1体力 
					if Curr_NG(jqid,107) or Curr_NG(jqid,104) then
						if WAR.LSX_Counter == 6 then
							AddPersonAttrib(jqid,'体力',1)
						end
					end
					--体力恢复
					if WAR.PD['体力恢复'][jqid] ~=nil and WAR.PD['体力恢复'][jqid] > 0 then
						local n = WAR.PD['体力恢复'][jqid]
						AddPersonAttrib(jqid,'体力',n)
					end
					--混元紫霞
					if NGQHB(jqid,90) then
					    AddPersonAttrib(jqid,'体力',1)
						if JY.Person[jqid]["体力"] >= 100 then 
							AddPersonAttrib(jqid,'生命',10)
						end
					end
				end
		    -------------------------------时序正面状态--------------------------------------------------
			    --吃药
				if WAR.PD['五宝花蜜酒'][jqid] ~= nil then 
					WAR.PD['五宝花蜜酒'][jqid] = WAR.PD['五宝花蜜酒'][jqid] - 1
					if WAR.PD['五宝花蜜酒'][jqid] < 1 then 
						WAR.PD['五宝花蜜酒'][jqid] = nil   
					end
				end
				--天南易阳
				if Curr_NG(jqid,314) then
					AddPersonAttrib(jqid,'灼烧程度',3)
				end
				--毒王时序增加中毒
				if actor(jqid,9) then
					AddPersonAttrib(jqid,'中毒程度',math.random(1,8))
				end
			    --灭绝的玉石俱焚，100时序
				if WAR.YSJF[jqid] ~= nil then
					WAR.YSJF[jqid] = WAR.YSJF[jqid] - 1
					if WAR.YSJF[jqid] < 1 then
						WAR.YSJF[jqid] = nil
					end
				end
				--李寻欢小李飞刀状态，
				if WAR.XLFD[jqid] ~= nil then
					WAR.XLFD[jqid] = WAR.XLFD[jqid] - 1
					if WAR.XLFD[jqid] < 1 then
						WAR.XLFD[jqid] = nil
					end
				end
				--霍青桐指令
				if WAR.HQT_ZL[jqid] ~= nil then
					WAR.HQT_ZL[jqid] = WAR.HQT_ZL[jqid] - 1
					if WAR.HQT_ZL[jqid] < 1 then
						WAR.HQT_ZL[jqid] = nil
					end
				end			
				--文泰来 否极泰来倒计时
				if match_ID(jqid,151) and WAR.WTL_1[jqid] == nil then
					WAR.WTL_1[jqid] = 50
				end	
				if WAR.WTL_1[jqid] ~= nil then
					WAR.WTL_1[jqid] = WAR.WTL_1[jqid] - 1
					if WAR.WTL_1[jqid] < 1 then
						WAR.WTL_1[jqid] = 0
					end
				end
				--文泰来 否极泰来状态计时 WTL_PJTL
				if WAR.WTL_PJTL[jqid] ~= nil then
					WAR.WTL_PJTL[jqid] = WAR.WTL_PJTL[jqid] - 1
					if WAR.WTL_PJTL[jqid] < 1 then
						WAR.WTL_PJTL[jqid] = nil
						WAR.WTL_1[jqid] = nil
					end
				end
				--轻云蔽月时序计数
				if WAR.QYBY[jqid] ~= nil then
					WAR.QYBY[jqid] = WAR.QYBY[jqid] - 1	
					if WAR.QYBY[jqid] < 1 then
						WAR.QYBY[jqid] = nil
					end
				end
				--易水寒诀
				if WAR.YSHJ[jqid] ~= nil then
					WAR.YSHJ[jqid] = WAR.YSHJ[jqid] - 1	
					if WAR.YSHJ[jqid] < 1 then
						WAR.YSHJ[jqid] = nil
					end
				end
				--剑步谜影
				if WAR.JBMY[jqid] ~= nil then
					WAR.JBMY[jqid] = WAR.JBMY[jqid] - 1	
					if WAR.JBMY[jqid] < 1 then
						WAR.JBMY[jqid] = nil
					end
				end	
				--梅花步法
				if WAR.MHBF[jqid] ~= nil then
					WAR.MHBF[jqid] = WAR.MHBF[jqid] - 1
					if WAR.MHBF[jqid] < 1 then
						WAR.MHBF[jqid] = nil
					end 
				end
				--护龙金刚
				if WAR.HLJG[jqid] ~= nil then
					WAR.HLJG[jqid] = WAR.HLJG[jqid] - 1	
					if WAR.HLJG[jqid] < 1 then
						WAR.HLJG[jqid] = nil
					end
				end
				--乘风蹈海
				if WAR.CFDH[jqid] ~= nil then
					WAR.CFDH[jqid] = WAR.CFDH[jqid] - 1	
					if WAR.CFDH[jqid] < 1 then
						WAR.CFDH[jqid] = nil
					end
				end
				--大周天功回复50时序
				if WAR.ZTHF[jqid] ~= nil then
					WAR.ZTHF[jqid] = WAR.ZTHF[jqid] - 1
					if WAR.ZTHF[jqid] < 1 then
						WAR.ZTHF[jqid] = nil
					end
				end				
				--陆渐三十二身相 一合相
				if WAR.SSESS[jqid] ~= nil then
					WAR.SSESS[jqid] = WAR.SSESS[jqid] - 1
					if WAR.SSESS[jqid] < 1 then
						WAR.SSESS[jqid] = nil
					end
				end	
				--陆渐 金刚法相
				if WAR.JGFX[jqid] ~= nil then
					WAR.JGFX[jqid] = WAR.JGFX[jqid] - 1
					if WAR.JGFX[jqid] < 1 then
						WAR.JGFX[jqid] = nil
					end
				end
				--惊天一剑状态
				if WAR.JTYJ[jqid] ~= nil then
					WAR.JTYJ[jqid] = WAR.JTYJ[jqid] - 1
					if WAR.JTYJ[jqid] < 1 then
						WAR.JTYJ[jqid] = nil
					end
				end
				--隐蔽状态
				if WAR.PD['时序闪避'][jqid] ~= nil then
					if Curr_NG(jqid,177) then
						AddPersonAttrib(jqid,'灼烧程度',-10)
						AddPersonAttrib(jqid,'冰封程度',-10)
						AddPersonAttrib(jqid,'封穴程度',-10)
						AddPersonAttrib(jqid,'流血程度',-10)
						AddPersonAttrib(jqid,'中毒程度',-10)
						AddPersonAttrib(jqid,'受伤程度',-10)
					end
					if QGQH(jqid,300,1) then --风无形
						AddPersonAttrib(jqid,'内力',50)
						AddPersonAttrib(jqid,'生命',100)
					end
					if QGQH(jqid,195,1) and JLSD(10,35,jqid) then
					else
						WAR.PD['时序闪避'][jqid] = WAR.PD['时序闪避'][jqid] - 1
					end	
					if WAR.PD['时序闪避'][jqid] < 1 then
						WAR.PD['时序闪避'][jqid] = nil
						if TFQG(jqid,195) and JLSD(10,45,jqid) then
							nuqi(jqid,30)
						end	
					end
				end	
				if WAR.PD['西瓜刀・残刀'][jqid] ~= nil then 
                    if WAR.PD['西瓜刀・残刀'][jqid][2] ~= nil and WAR.PD['西瓜刀・残刀'][jqid][2] > 0 then 
                        WAR.PD['西瓜刀・残刀'][jqid][2] = WAR.PD['西瓜刀・残刀'][jqid][2] - 1
                        if WAR.PD['西瓜刀・残刀'][jqid][2] < 1 then 
                            WAR.PD['西瓜刀・残刀'][jqid] = nil
                        end
                    end
                end
			    --神兵
				if WAR.PD['神兵'][jqid] ~= nil then
					WAR.PD['神兵'][jqid] = WAR.PD['神兵'][jqid] - 1
					if WAR.PD['神兵'][jqid] < 1 then
						WAR.PD['神兵'][jqid] = nil
					end
				end	
				if WAR.PD['战神状态'][jqid] ~= nil then
					WAR.PD['战神状态'][jqid] = WAR.PD['战神状态'][jqid] - 1
					if WAR.PD['战神状态'][jqid] < 1 then
						WAR.PD['战神状态'][jqid] = nil
					end
				end	
				--太玄乾坤
				if WAR.PD["太玄组合攻击2"][jqid] ~= nil then
					WAR.PD["太玄组合攻击2"][jqid] = WAR.PD["太玄组合攻击2"][jqid] - 1
					if WAR.PD["太玄组合攻击2"][jqid] < 1 then
						WAR.PD["太玄组合攻击2"][jqid] = nil
					end
				end
				--太玄乾坤
				if WAR.PD["太玄组合防御3"][jqid] ~= nil then
					WAR.PD["太玄组合防御3"][jqid] = WAR.PD["太玄组合防御3"][jqid] - 1
					if WAR.PD["太玄组合防御3"][jqid] < 1 then
						WAR.PD["太玄组合防御3"][jqid] = nil
					end
				end	
				--坚甲状态
				if WAR.PD['坚甲状态'][jqid] ~= nil then
					WAR.PD['坚甲状态'][jqid] = WAR.PD['坚甲状态'][jqid] -1
					if WAR.PD['坚甲状态'][jqid] < 1 then
						WAR.PD['坚甲状态'][jqid] = nil
					end
				end	
				--逍遥御风闪避
				if WAR.PD['逍遥御风闪避'][jqid] ~= nil then
					WAR.PD['逍遥御风闪避'][jqid] = WAR.PD['逍遥御风闪避'][jqid] - 1
					if WAR.PD['逍遥御风闪避'][jqid] < 1 then
						WAR.PD['逍遥御风闪避'][jqid] = nil
					end
				end
				--帝释天临
				if WAR.PD['帝释天临'][jqid] ~= nil then
					WAR.PD['帝释天临'][jqid] = WAR.PD['帝释天临'][jqid] - 1
					if WAR.PD['帝释天临'][jqid] < 1 then
						WAR.PD['帝释天临'][jqid] = nil
					end
				end
				--降龙尊相
				if WAR.PD['降龙尊相'][jqid] ~= nil then
					WAR.PD['降龙尊相'][jqid] = WAR.PD['降龙尊相'][jqid] - 1
					if WAR.PD['降龙尊相'][jqid] < 1 then
						WAR.PD['降龙尊相'][jqid] = nil
					end
				end
				--四海龙王
				if WAR.PD['四海龙王'][jqid] ~= nil then
					WAR.PD['四海龙王'][jqid] = WAR.PD['四海龙王'][jqid] - 1
					if WAR.PD['四海龙王'][jqid] < 1 then
						WAR.PD['四海龙王'][jqid] = nil
					end
				end
			-------------------------------时序负面状态--------------------------------------------------
			    if WAR.PD['虚邪夜玄'][jqid] ~= nil then
					WAR.PD['虚邪夜玄'][jqid] = WAR.PD['虚邪夜玄'][jqid] - 1
					if WAR.PD['虚邪夜玄'][jqid] < 1 then
						WAR.PD['虚邪夜玄'][jqid] = nil
					end
				end
				--虚邪乱魄2
				if WAR.PD['虚邪极日2'][jqid] ~= nil then
					AddPersonAttrib(jqid,'灼烧程度',100)
					if math.random(10) > 7 then
						WAR.PD['阳气侵蚀'][jqid] = (WAR.PD['阳气侵蚀'][jqid] or 0) + 10
					end	
					WAR.PD['虚邪极日2'][jqid] = WAR.PD['虚邪极日2'][jqid] - 1
					if WAR.PD['虚邪极日2'][jqid] < 1 then
						WAR.PD['虚邪极日2'][jqid] = nil
					end
				end
				if WAR.PD['虚邪蚀月2'][jqid] ~= nil then
					AddPersonAttrib(jqid,'冰封程度',100)
					if math.random(10) > 7 then
						WAR.PD['阴气污染'][jqid] = (WAR.PD['阴气污染'][jqid] or 0) + 10
					end	
					WAR.PD['虚邪蚀月2'][jqid] = WAR.PD['虚邪蚀月2'][jqid] - 1
					if WAR.PD['虚邪蚀月2'][jqid] < 1 then
						WAR.PD['虚邪蚀月2'][jqid] = nil
					end
				end
				if WAR.PD['点点暴走'][jqid] ~= nil then
					WAR.PD['点点暴走'][jqid] = WAR.PD['点点暴走'][jqid] + 1
					if WAR.PD['点点暴走'][jqid] > 0 and WAR.PD['点点暴走'][jqid] < 31 then
						WAR.Person[i]['我方'] = false
					else
						WAR.Person[i]['我方'] = true
					end
					if WAR.PD['点点暴走'][jqid] > 60 then
						WAR.PD['点点暴走'][jqid] = 1
					end
				end
				--机率下降
				if WAR.PD['机率下降'][jqid] ~= nil then
					WAR.PD['机率下降'][jqid] = WAR.PD['机率下降'][jqid] - 1
					if WAR.PD['机率下降'][jqid] < 1 then
						WAR.PD['机率下降'][jqid] = nil
					end
				end
				--辟邪剑法
			    if WAR.PD['辟邪断刃'][jqid] ~= nil then
					WAR.PD['辟邪断刃'][jqid] = WAR.PD['辟邪断刃'][jqid] - 1
					if WAR.PD['辟邪断刃'][jqid] == 0 then
						WAR.PD['辟邪断刃'][jqid] = nil 
					end
				end	
				if WAR.PD['辟邪破甲'][jqid] ~= nil then
					WAR.PD['辟邪破甲'][jqid] = WAR.PD['辟邪破甲'][jqid] - 1
					if WAR.PD['辟邪破甲'][jqid] == 0 then
						WAR.PD['辟邪破甲'][jqid] = nil 
					end
				end
				if WAR.PD["扫荡群魔"][jqid] ~= nil then
					WAR.PD["扫荡群魔"][jqid] = WAR.PD["扫荡群魔"][jqid] -1
					if WAR.PD["扫荡群魔"][jqid] < 1 then
						WAR.PD["扫荡群魔"][jqid] = nil
					end
				end	
				--霸王破甲
				if WAR.PD['霸王破甲'][jqid] ~= nil then
					WAR.PD['霸王破甲'][jqid] = limitX(WAR.PD['霸王破甲'][jqid],0,30)
					WAR.PD['霸王破甲'][jqid] = WAR.PD['霸王破甲'][jqid] - 1
					if WAR.PD['霸王破甲'][jqid] < 1 then
						WAR.PD['霸王破甲'][jqid] = nil
					end
				end
				--白驼蛇蛊
				if WAR.PD['白驼蛇蛊'][jqid] ~= nil then
					WAR.PD['白驼蛇蛊'][jqid] = limitX(WAR.PD['白驼蛇蛊'][jqid],0,20)
					AddPersonAttrib(jqid,'封穴程度',(psx(jqid,"中毒程度")/30))
					if WAR.SSX_Counter == 3 then
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0); --不加这条则动画位置无法正常显示
						CurIDTXDH(WAR.CurID, 11,1,"灵蛇撕咬",LimeGreen);
						WAR.CurID = s
						AddPersonAttrib(jqid, "生命", -psx(jqid,"封穴程度"))
					end
					WAR.PD['白驼蛇蛊'][jqid] = WAR.PD['白驼蛇蛊'][jqid] - 1
					if WAR.PD['白驼蛇蛊'][jqid] < 1 then
						if psx(jqid,"封穴程度") < 50 then
							local fx = 1 - (50 - psx(jqid,"封穴程度"))/200
							JY.Person[jqid]["生命"] = math.modf(JY.Person[jqid]["生命"] * fx)
						end
						WAR.PD['白驼蛇蛊'][jqid] = nil
					end
				end
				--升龙天威
				if WAR.PD['升龙天威'][jqid] ~= nil then
					WAR.PD['升龙天威'][jqid] = WAR.PD['升龙天威'][jqid] - 1
					if WAR.PD['升龙天威'][jqid] < 1 then
						WAR.PD['升龙天威'][jqid] = nil
					end
				end	
				
				--被破军打中的敌人，内功停运10时序
			    if WAR.PD["破军"][jqid] ~= nil then
					WAR.PD["破军"][jqid] = limitX(WAR.PD["破军"][jqid],0,10)
				    WAR.PD["破军"][jqid] = WAR.PD["破军"][jqid] - 1
				    if WAR.PD["破军"][jqid] < 1 then
					    WAR.PD["破军"][jqid] = nil
				    end
			    end
				
 
                --魔岭玫瑰解除
				if WAR.PD["魔岭玫瑰"][jqid] ~= nil then
					WAR.PD["魔岭玫瑰"][jqid] = limitX(WAR.PD["魔岭玫瑰"][jqid],0,100)	
				    WAR.PD["魔岭玫瑰"][jqid] = WAR.PD["魔岭玫瑰"][jqid] - 1
				    if WAR.PD["魔岭玫瑰"][jqid] < 1 then
					    WAR.PD["魔岭玫瑰"][jqid] = nil
					    if isteam(jqid) or jqid == 0 then
                            WAR.Person[i]["我方"] = true
						else
							WAR.Person[i]["我方"] = false
                        end
					end
                end				
				
				--七伤拳・肺
				if WAR.PD["伤肺决"][jqid] ~= nil then
					WAR.PD["伤肺决"][jqid] = WAR.PD["伤肺决"][jqid] - 1
					if WAR.PD["伤肺决"][jqid] < 1 then
						WAR.PD["伤肺决"][jqid] = nil
					end
				end
				--七伤拳・意恍惚
				if WAR.PD["意恍惚"][jqid] ~= nil then
					WAR.PD["意恍惚"][jqid] = WAR.PD["意恍惚"][jqid] - 1
					if WAR.PD["意恍惚"][jqid] < 1 then
						WAR.PD["意恍惚"][jqid] = nil
					end
				end 
				--忘情龙象
				if WAR.PD["忘情云翳"][jqid] ~= nil then
					WAR.PD["忘情云翳"][jqid] = limitX(WAR.PD["忘情云翳"][jqid],0,30)
					AddPersonAttrib(jqid, "受伤程度", 10)
					AddPersonAttrib(jqid, "中毒程度", 10)
					AddPersonAttrib(jqid, "冰封程度", 10)
					AddPersonAttrib(jqid, "灼烧程度", 10)
					AddPersonAttrib(jqid, "流血程度", 10)
					AddPersonAttrib(jqid, "封穴程度", 5)
					if WAR.JSX_Counter == 9 then
						WAR.PD["中毒不解"][jqid] = math.random(3,10)
			            WAR.PD["伤重不治"][jqid] = math.random(3,10)
			            WAR.PD["焚炎不尽"][jqid] = math.random(3,10)
			            WAR.PD["玄冰不化"][jqid] = math.random(3,10)
			            WAR.PD["血流不止"][jqid] = math.random(3,10)
						addbuff(jqid,WAR.PD['逆转经脉'],2,2)
					end
					WAR.PD["忘情云翳"][jqid] = WAR.PD["忘情云翳"][jqid] - 1
                    if WAR.PD["忘情云翳"][jqid] < 1 then
                        WAR.PD["忘情云翳"][jqid] = nil
                    end
				end	 	
				--寒冰玄冥
				if JY.Person[jqid]["冰封程度"] > 0 then
				    if WAR.PD["玄冥透骨"][jqid] ~= nil or WAR.PD["玄冥透骨1"][jqid] ~= nil then
						AddPersonAttrib(jqid,'内力',-15)
						if psxper(i,'内力',0.1,2) then
							AddPersonAttrib(jqid,'体力',-3)
							AddPersonAttrib(jqid,'生命',-50)
						end
					end
				end
				if WAR.PD['玄冥透骨'][jqid] ~= nil then
					if WAR.SSX_Counter == 3 then
						WAR.PD['玄冥透骨'][jqid] = WAR.PD['玄冥透骨'][jqid] - 1
						if JLSD(10,80,jqid) then
							WAR.PD['冰冻状态'][jqid] = (WAR.PD['冰冻状态'][jqid] or 0) + math.random(5,15)
						end	
						if JLSD(10,80,jqid) then
							WAR.PD['冰魄毒'][jqid] = (WAR.PD['冰魄毒'][jqid] or 0) + math.random(5,10)
						end	
						if JLSD(10,80,jqid) then
							WAR.PD['寒毒入体'][jqid] = 1
						end	
						if JLSD(10,80,jqid) then
							WAR.PD['冰冻扣血'][jqid] = (WAR.PD['冰冻扣血'][jqid] or 0) + math.random(5,15)
						end	
					end
					if WAR.PD['玄冥透骨'][jqid] < 1 then
						WAR.PD['玄冥透骨'][jqid] = nil
					end
				end
				if WAR.PD['玄冥透骨1'][jqid] ~= nil then
					WAR.PD['玄冥透骨1'][jqid] = WAR.PD['玄冥透骨1'][jqid] - 1
					if JLSD(10,60,jqid) then
						WAR.PD['冰冻状态'][jqid] = (WAR.PD['冰冻状态'][jqid] or 0) + math.random(5,15)
					end	
					if JLSD(10,60,jqid) then
						WAR.PD['冰魄毒'][jqid] = (WAR.PD['冰魄毒'][jqid] or 0) + math.random(5,10)
					end	
					if JLSD(10,60,jqid) then
						WAR.PD['寒毒入体'][jqid] = 1
					end	
					if JLSD(10,60,jqid) then
						WAR.PD['冰冻扣血'][jqid] = (WAR.PD['冰冻扣血'][jqid] or 0) + math.random(5,15)
					end	
					if JLSD(10,60,jqid) then
						WAR.PD['阴气污染'][jqid] = (WAR.PD['阴气污染'][jqid] or 0) + math.random(5,15)
					end	
					if WAR.PD['玄冥透骨1'][jqid] < 1 then
						WAR.PD['玄冥透骨1'][jqid] = nil
					end	
				end
				--阴阳无极转换
				if WAR.PD['阴阳双极'][jqid] ~= nil then
					WAR.PD['阴阳双极'][jqid] = WAR.PD['阴阳双极'][jqid] + 1
					if WAR.PD['阴阳双极'][jqid] < 31 then
						AddPersonAttrib(jqid,'内力',math.modf(psx(jqid,'内力最大值')*0.03))
					else
						AddPersonAttrib(jqid,'生命',math.modf(psx(jqid,'生命最大值')*0.02))
					end		
					if WAR.PD['阴阳双极'][jqid] == 31 then
						AddPersonAttrib(jqid,'受伤程度',-psx(jqid,'受伤程度'))
						AddPersonAttrib(jqid,'中毒程度',-psx(jqid,'中毒程度'))
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,237,1,'阴动阳静・阴极')
						WAR.CurID = s
					end	
					if WAR.PD['阴阳双极'][jqid] >= 61 then
						AddPersonAttrib(jqid,'受伤程度',-psx(jqid,'受伤程度'))
						AddPersonAttrib(jqid,'中毒程度',-psx(jqid,'中毒程度'))
						AddPersonAttrib(jqid,'内力',math.modf(psx(jqid,'内力')*0.5))
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,237,1,'阴静阳动・阳极')
						WAR.CurID = s
						WAR.PD['阴阳双极'][jqid] = 0
					end	
				end
				--阳神
				if WAR.PD['阳神降世'][jqid] ~= nil then
					AddPersonAttrib(jqid,'受伤程度',-psx(jqid,'受伤程度'))
					AddPersonAttrib(jqid,'中毒程度',-psx(jqid,'中毒程度'))
					AddPersonAttrib(jqid,'内力',math.random(200,400))
					if psxper(i,'内力',1,3) then
						AddPersonAttrib(jqid,'生命',math.random(100,250))	
					end
				end
				--阴圣
				if WAR.PD['阴圣再临'][jqid] ~= nil then
					AddPersonAttrib(jqid,'受伤程度',-psx(jqid,'受伤程度'))
					AddPersonAttrib(jqid,'中毒程度',-psx(jqid,'中毒程度'))
					AddPersonAttrib(jqid,'生命',math.random(300,500))
				end		
				--阴气污染
				if WAR.PD['阴气污染'][jqid] ~= nil  then
					if Curr_NG(jqid,107) then
						WAR.PD['阴气污染'][jqid] = nil 
					else
						WAR.PD['阴气污染'][jqid] = limitX(WAR.PD['阴气污染'][jqid],0,30)
						WAR.PD['阴气污染'][jqid] = WAR.PD['阴气污染'][jqid] - 1
						if math.random(10) > 3 then
							AddPersonAttrib(jqid, "内力", -100)
							AddPersonAttrib(jqid,"冰封程度",10)
						end
						if psx(jqid,'内力') <= 0 then
							AddPersonAttrib(jqid, "生命", -150)
						end	
						if WAR.PD['阴气污染'][jqid] < 1 then
							WAR.PD['阴气污染'][jqid] = nil 
						end
					end	
				end	
				--阳气侵蚀
				if WAR.PD['阳气侵蚀'][jqid] ~= nil then
					if Curr_NG(jqid,106) then
						WAR.PD['阳气侵蚀'][jqid] = nil 
					else
						WAR.PD['阳气侵蚀'][jqid] = limitX(WAR.PD['阳气侵蚀'][jqid],0,30)
						WAR.PD['阳气侵蚀'][jqid] = WAR.PD['阳气侵蚀'][jqid] - 1
						if math.random(10) > 3 then
							AddPersonAttrib(jqid, "内力", -100)
							AddPersonAttrib(jqid,"灼烧程度",10)
						end
						if psx(jqid,'内力') <= 0 then
							AddPersonAttrib(jqid, "生命", -150)
						end	
						if WAR.PD['阳气侵蚀'][jqid] < 1 then
							WAR.PD['阳气侵蚀'][jqid] = nil 
						end
					end	
				end	
				--东方不败花天
				if PersonKF(jqid,316) and (JXPD(jqid,27,2) or match_ID(jqid,777)) then
					if WAR.PD["花天"][jqid] == nil or WAR.PD["花天"][jqid] == 0 then
					WAR.PD["花天"][jqid] = 1
					end	
					if WAR.PD["花天"][jqid] ~= nil and WAR.PD["花天"][jqid] > 0 then
					WAR.PD['花天'][jqid] = WAR.PD['花天'][jqid] + 1
					    if WAR.PD['花天'][jqid] > 30 then
						    WAR.PD['花天'][jqid] = 30
						end
					end
				end
				if WAR.PD['初芽'][jqid] ~= nil then
					AddPersonAttrib(jqid, "体力", -1)
					WAR.PD['集气速度'][jqid] = limitX((WAR.PD['集气速度'][jqid] or 0) - math.random(2),0,-20)
					WAR.PD['初芽'][jqid] = WAR.PD['初芽'][jqid] - 1
					if WAR.PD['初芽'][jqid] < 1 then
						WAR.PD['初芽'][jqid] = nil
					end
				end	
				if WAR.PD['含苞'][jqid] ~= nil then
					WAR.PD['含苞'][jqid] = WAR.PD['含苞'][jqid] - 1
					if WAR.PD['含苞'][jqid] < 1 then
						WAR.PD['含苞'][jqid] = nil
					end
				end	
                if WAR.PD["绽放"][jqid] ~= nil then
                    AddPersonAttrib(jqid,'内力',-math.modf(JY.Person[jqid]["内力最大值"]*0.03))
                    if JY.Person[jqid]["内力"] < 1 then
                        JY.Person[jqid]["生命"] = 0
						WAR.Person[i]["死亡"] = true
						WarSetPerson()
                        break
                    end	
                    WAR.PD["绽放"][jqid] = WAR.PD["绽放"][jqid] - 1
                    if WAR.PD["绽放"][jqid] < 1 then
                        WAR.PD["绽放"][jqid] = nil
                    end
				end	
				if WAR.PD['凋零'][jqid] ~= nil then
					AddPersonAttrib(jqid,"受伤程度", math.random(10))
			        AddPersonAttrib(jqid,"中毒程度", math.random(10))
			        AddPersonAttrib(jqid,"冰封程度", math.random(10))
			        AddPersonAttrib(jqid,"灼烧程度", math.random(10))
			        AddPersonAttrib(jqid,"流血程度", math.random(10))
					AddPersonAttrib(jqid,"封穴程度", math.random(5))
					WAR.PD['凋零'][jqid] = WAR.PD['凋零'][jqid] - 1
					if WAR.PD['凋零'][jqid] < 1 then
						WAR.PD['凋零'][jqid] = nil
					end
				end	
				--周公剑意
				if WAR.PD['寒冰魄'][jqid] ~= nil then
					if JY.Person[jqid]["冰封程度"] >= 100 then
						if WAR.Person[i].Time > 300 then
							WAR.Person[i].Time = 300
						end
					end
					--五时序
					if WAR.WSX_Counter == 5 then
						local bf = (500-psx(jqid,'冰封程度'))*2
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,251, 1, "寒劲透体",M_LightBlue)
						AddPersonAttrib(jqid, "内力", -bf)
						WAR.CurID = s
					end
				end
				if WAR.PD['食心蛊'][jqid] ~= nil then
					if WAR.WSX_Counter == 5 then
						local zd = (300-psx(jqid,'中毒程度'))*2
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,123, 1, "心毒崩裂",M_DarkOrchid)
						AddPersonAttrib(jqid, "生命", -zd)
						WAR.CurID = s
					end
				end
				if WAR.PD['烈火核'][jqid] ~= nil then
					local zs = (300-psx(jqid,'灼烧程度'))/20
					if JY.Person[jqid]["灼烧程度"] >= 50 then
						for lhxd = 0, WAR.PersonNum-1 do
							if DWPD(i,lhxd) == false and RealJL(i,lhxd,9) and WAR.Person[lhxd]["死亡"] == false then
								local lhxdA = WAR.Person[lhxd]['人物编号']
								AddPersonAttrib(lhxdA, "生命", -math.modf(zs))
								WAR.PD['火毒攻心'][lhxdA] = 1
								WAR.PD['举火燎原'][lhxdA] = (WAR.PD['举火燎原'][lhxdA] or 0) + 2
							end
						end
					end
					--五时序
					if WAR.WSX_Counter == 5 then
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,52, 1, "火核爆裂", PinkRed)
						AddPersonAttrib(jqid, "体力", -math.modf(zs))
						WAR.CurID = s
					end
				end
				if WAR.PD['缚身蛇'][jqid] ~= nil then
					if JY.Person[jqid]["封穴程度"] >= 30 then
						if WAR.PD["邪魅苍生"][jqid] == nil then
							WAR.PD["邪魅苍生"][jqid] = 10
						end
					end
					--五时序
					if WAR.WSX_Counter == 5 then
						local fx = 100-psx(jqid,'封穴程度')
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,187, 1, "灵蛇缠绕", LightPurple)
						WAR.Person[i].Time = (WAR.Person[i].Time or 0) - fx
						if WAR.Person[i].Time < -500 then
							WAR.Person[i].Time = -500
						end
						WAR.CurID = s
					end
				end
				if WAR.PD['惊雷咒'][jqid] ~= nil then
					local yj = TrueYJ(jqid)
					--五时序
					if WAR.WSX_Counter == 5 then
						for j = 0, WAR.PersonNum - 1 do
							local jl = WAR.Person[j]['人物编号']
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
								if WAR.PD["感电状态"][jl] ~= nil then
									WarDrawMap(0)
									CurIDTXDH(WAR.CurID,131, 1, "雷霆霹雳", LightSkyBlue)
									AddPersonAttrib(jl, "生命", -yj)
								end
						    end		
					    end
					end
					WAR.PD["惊雷咒"][jqid] = WAR.PD["惊雷咒"][jqid] - 1
					if WAR.PD["惊雷咒"][jqid] < 1 then
						WAR.PD["惊雷咒"][jqid] = nil
					end
				end
				if WAR.PD['御雷阵'][jqid] ~= nil then
					WAR.PD["御雷阵"][jqid] = WAR.PD["御雷阵"][jqid] - 1
					if WAR.PD["御雷阵"][jqid] < 1 then
						WAR.PD["御雷阵"][jqid] = nil
					end
				end
				--朝廷威慑
				if WAR.PD["威慑"][jqid] ~= nil then
					WAR.PD["威慑"][jqid] = WAR.PD["威慑"][jqid] - 1
					if WAR.PD["威慑"][jqid] < 1 then
						WAR.PD["威慑"][jqid] = nil
					end
				end
				--封印
				if WAR.PD["封印"][jqid] ~= nil then
					WAR.PD['封印'][jqid] = limitX(WAR.PD['封印'][jqid],0,10)
					WAR.PD["封印"][jqid] = WAR.PD["封印"][jqid] - 1
					if WAR.PD["封印"][jqid] < 1 then
						WAR.PD["封印"][jqid] = nil
					end
				end
				--枪神诀
				if WAR.PD["枪神诀2"][jqid] ~= nil then
					WAR.PD['枪神诀2'][jqid] = limitX(WAR.PD['枪神诀2'][jqid],0,30)
					WAR.PD["枪神诀2"][jqid] = WAR.PD["枪神诀2"][jqid] - 1
					if WAR.PD["枪神诀2"][jqid] < 1 then
						WAR.PD["枪神诀2"][jqid] = nil
					end
				end
				--禁止恢复
				if WAR.PD['诛仙状态'][jqid] ~= nil then
					if JY.Person[jqid]["生命"] > math.modf(JY.Person[jqid]["生命最大值"]*0.5) then
						JY.Person[jqid]["生命"] = math.modf(JY.Person[jqid]["生命最大值"]*0.5) 
					end	
					WAR.PD['诛仙状态'][jqid] = WAR.PD['诛仙状态'][jqid] - 1
					if WAR.PD['诛仙状态'][jqid] < 1 then
						WAR.PD['诛仙状态'][jqid] = nil 
					end
				end
				
				if WAR.PD['禁疗'][jqid] ~= nil then 
					WAR.PD['禁疗'][jqid] = limitX(WAR.PD['禁疗'][jqid],0,10)
                    WAR.PD['禁疗'][jqid] = WAR.PD['禁疗'][jqid] - 1
                    if WAR.PD['禁疗'][jqid] < 1 then 
                        WAR.PD['禁疗'][jqid] = nil
                    end
                end
				--日月神教逆杀
                if WAR.PD['神教逆杀'][jqid] ~= nil and WAR.PD['神教逆杀'][jqid] > 0 then 
					WAR.PD['神教逆杀'][jqid] = limitX(WAR.PD['神教逆杀'][jqid],0,10)
					WAR.PD['神教逆杀'][jqid] = WAR.PD['神教逆杀'][jqid] - 1
					if WAR.PD['神教逆杀'][jqid] < 1 then
						WAR.PD['神教逆杀'][jqid] = nil
					end		
				end
				--虚弱状态 
				if WAR.PD["虚弱状态"][jqid] ~= nil then
					WAR.PD["虚弱状态"][jqid] = limitX(WAR.PD["虚弱状态"][jqid],0,20)
					WAR.PD["虚弱状态"][jqid] = WAR.PD["虚弱状态"][jqid] - 1
					if WAR.PD["虚弱状态"][jqid] < 1 then
						WAR.PD["虚弱状态"][jqid] = nil
					end
				end	
				--精神错乱
				if WAR.PD['精神错乱'][jqid] ~= nil then
					WAR.PD['精神错乱'][jqid] = limitX(WAR.PD['精神错乱'][jqid],0,10)
					WAR.PD['精神错乱'][jqid] = WAR.PD['精神错乱'][jqid] -1
					if WAR.PD['精神错乱'][jqid] < 1 then
						WAR.PD['精神错乱'][jqid] = nil
					end
				end
				if WAR.PD['神经蛇毒'][jqid] ~= nil then
					WAR.PD['神经蛇毒'][jqid] = WAR.PD['神经蛇毒'][jqid] -1
					if WAR.PD['神经蛇毒'][jqid] < 1 then
						WAR.PD['神经蛇毒'][jqid] = nil
					end
				end	
				if WAR.PD['出血蛇毒'][jqid] ~= nil then
					WAR.PD['出血蛇毒'][jqid] = WAR.PD['出血蛇毒'][jqid] -1
					if WAR.PD['出血蛇毒'][jqid] < 1 then
						WAR.PD['出血蛇毒'][jqid] = nil
					end
				end	
				if WAR.PD['中毒不解'][jqid] ~= nil then
					AddPersonAttrib(jqid,'中毒程度',5)
					WAR.PD['中毒不解'][jqid] = limitX(WAR.PD['中毒不解'][jqid] - 1,0,50)
					if WAR.PD['中毒不解'][jqid] < 1 then
						WAR.PD['中毒不解'][jqid] = nil
					end
				end	
				if WAR.PD['伤重不治'][jqid] ~= nil then
					AddPersonAttrib(jqid,'受伤程度',5)
					WAR.PD['伤重不治'][jqid] = limitX(WAR.PD['伤重不治'][jqid] - 1,0,50)
					if WAR.PD['伤重不治'][jqid] < 1 then
						WAR.PD['伤重不治'][jqid] = nil
					end
				end
				if WAR.PD['焚炎不尽'][jqid] ~= nil then
					AddPersonAttrib(jqid,'灼烧程度',5)
					WAR.PD['焚炎不尽'][jqid] = limitX(WAR.PD['焚炎不尽'][jqid] - 1,0,50)
					if WAR.PD['焚炎不尽'][jqid] < 1 then
						WAR.PD['焚炎不尽'][jqid] = nil
					end
				end
				if WAR.PD['玄冰不化'][jqid] ~= nil then
					AddPersonAttrib(jqid,'冰封程度',5)
					WAR.PD['玄冰不化'][jqid] = limitX(WAR.PD['玄冰不化'][jqid] - 1,0,50)
					if WAR.PD['玄冰不化'][jqid] < 1 then
						WAR.PD['玄冰不化'][jqid] = nil
					end
				end	
				if WAR.PD['血流不止'][jqid] ~= nil then
					AddPersonAttrib(jqid,'流血程度',5)
					WAR.PD['血流不止'][jqid] = limitX(WAR.PD['血流不止'][jqid] - 1,0,50)
					if WAR.PD['血流不止'][jqid] < 1 then
						WAR.PD['血流不止'][jqid] = nil
					end
				end	
				if WAR.PD['重度内伤'][jqid] ~= nil then
					WAR.PD['重度内伤'][jqid] = WAR.PD['重度内伤'][jqid] - 1
					if WAR.PD['重度内伤'][jqid] < 1 then
						WAR.PD['重度内伤'][jqid] = nil 
					end
				end
            -------------------------------时序特殊状态--------------------------------------------------
				--天魔易筋
				if WAR.PD["分身判定1"][jqid] ~= nil then --剑势剑影
					local x,y = WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"]
					local aa = WAR.PD["分身判定1"][jqid]
					for j = 0,WAR.PersonNum-1 do 
						if WAR.Person[j]["我方"] == WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == true then 
							local jid = WAR.Person[j]["人物编号"]
							if WAR.PD["分身判定"][jid] == jqid then
								xunhuan = false
								local s = WAR.CurID
								WAR.CurID = j
								WarDrawMap(0)
								CurIDTXDH(WAR.CurID,89, 1, "天魔万衍")
								JY.Person[jid]["生命"] = JY.Person[jqid]["生命最大值"]
								WAR.Person[i]["死亡"] = true
								WAR.PD["分身判定"][jid] = nil
								WAR.PD["分身判定1"][jqid] = nil
								WAR.Person[j]["死亡"] = false
								WAR.CurID = s
							end  
						end 
					end	
					if WAR.PD["分身瞬动"][jqid] == 1 then 
					   WAR.Person[i].Time = 1005
					end			
				end
				--逍遥游轻功
				if QGQH(jqid,2,2) then
					WAR.PD['逍遥醉步计时'][jqid] = (WAR.PD['逍遥醉步计时'][jqid] or 0) + 1
					local jiu = {}
					--local list = {}
					local hejiu 
					local str = ""
					local a1 = 0
 					local a2 = 0
					local a3 = 0
					for i = 22, 25 do
						if hasthing(i) then
							table.insert(jiu,i)--酒的类型
							--table.insert(list,JY.Base["物品数量"]..i) --酒的数量
						end
					end
					if jiu[1] ~= nil and WAR.PD['逍遥醉步计时'][jqid] == 15 then
						hejiu = jiu[math.random(#jiu)]
						UseThing_Type3(hejiu)
						local aa = math.random(3)
						if aa == 1  then
							WAR.PD['逍遥醉步'][jqid] = 1
							a1 = 10
							str = "逍遥醉步・命"	
						elseif aa == 2 then
							WAR.PD['逍遥醉步'][jqid] = 2
							a2 = 10
							str = "逍遥醉步・气"	
						elseif aa == 3 then
							WAR.PD['逍遥醉步'][jqid] = 3
							a3 = 10
							str = "逍遥醉步・速"	
						end
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 80, 1, str, LightSkyBlue)
						WAR.CurID = s
						WAR.PD['微醺'][jqid] = (WAR.PD['微醺'][jqid] or 0) + 1
						if MPTX(jqid,2) then
							WAR.PD['逍遥醉步计时'][jqid] = 5
						else
							WAR.PD['逍遥醉步计时'][jqid] = 0
						end	
					end
					if a1 > 0 then
						a1 = a1 - 1
						AddPersonAttrib(jqid,"生命",math.random(50,100))
						if a1 < 1 then
							WAR.PD['逍遥醉步'][jqid] = nil
						end	
					end
					if a2 > 0 then
						a2 = a2 - 1
						AddPersonAttrib(jqid,"内力",math.random(200,500))
						if a2 < 1 then
							WAR.PD['逍遥醉步'][jqid] = nil
						end
					end
					if a3 > 0 then
						a3 = a3 - 1
						WAR.PD['集气速度'][jqid] = 10
						if a3 < 1 then
							WAR.PD['逍遥醉步'][jqid] = nil
						end
					end
					if (WAR.PD['微醺'][jqid] or 0) > 7 and WAR.PD['醉八仙'][jqid] == nil then
						WAR.PD['醉八仙'][jqid] = 3
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						DIYdisplay("逍遥吾命")
						lib.Delay(50)
						DIYdisplay("一醉沧然")
						CurIDTXDH(WAR.CurID, 80, 1, "醉・八仙", LightSkyBlue)
						lib.Delay(50)
						WAR.CurID = s
					end	
				end	
				--摘星功
				if WAR.PD['绿火星毒'][jqid] ~= nil then
					if WAR.JSX_Counter == 9 then
						AddPersonAttrib(jqid,"生命",-psx(jqid,"中毒程度"))
						AddPersonAttrib(jqid,"中毒程度",math.random(10,30))
						WAR.PD['中毒不解'][jqid] = (WAR.PD['中毒不解'][jqid] or 0) + math.random(3,9)
						if JY.Person[jqid]["生命"] < 1 then
							for lhxd = 0, WAR.PersonNum-1 do
								if DWPD(i,lhxd) == false and RealJL(i,lhxd,6) and WAR.Person[lhxd]["死亡"] == false then
									local lhxdA = WAR.Person[lhxd]['人物编号']
									WAR.PD['火毒攻心'][lhxdA] = 1
									WAR.PD['寒毒入体'][lhxdA] = 1
									WAR.PD['毒击'][lhxdA] = (WAR.PD['毒击'][lhxdA] or 0) + 10
								end
							end
						end
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,106,1,"绿火毒爆")
						WAR.CurID = s						
					end
				end
				--花间游高阶
				if QGQH(jqid,286,2) then
				    if WAR.JSX_Counter == 9 then
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID,239,1,"不食五谷・吸风饮露")
						if math.random(3) > 1 then
							Cat('清除高级异常',i)
						else
						    Cat('清除所有异常',i)
						end
						WAR.CurID = s
					end
				end
				--追魂无影天赋轻功
				if TFQG(jqid,278) then
					Cat('清除中级异常',i)
				end 	
				--破剑八刀
                if match_ID(jqid,9963) then
                    if WAR.PD['破剑八刀'][jqid] ~= nil then
                        WAR.PD['破剑八刀'][jqid] = WAR.PD['破剑八刀'][jqid] - 1
                        if WAR.PD['破剑八刀'][jqid] < 1 then 
                            WAR.PD['破剑八刀'][jqid] = nil
                            Cat('护盾停止',i)
                        end
                    end
                    if WAR.PD['破剑八刀CD'][jqid] ~= nil then
                        WAR.PD['破剑八刀CD'][jqid] = WAR.PD['破剑八刀CD'][jqid] - 1
                        if WAR.PD['破剑八刀CD'][jqid] < 1 then 
                            WAR.PD['破剑八刀CD'][jqid] = nil
                        end
                    end
                    if WAR.PD['破剑八刀CD'][jqid] == nil and WAR.PD['破剑八刀'][jqid] == nil then 
                        WAR.PD['破剑八刀CD'][jqid] = 10
                        WAR.PD['破剑八刀'][jqid] = 10
                        if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
							WAR.Person[i]['护盾'] = 4
						end
                        WAR.CurID = i
                        WarDrawMap(0)
                        CurIDTXDH(WAR.CurID, 132, 1,'破剑八刀')
                    end
                end	
                --金蛇缠丝手
                if match_ID(jqid,9961) or match_ID(jqid,529) then
                    WAR.PD['金蛇缠丝手CD'][jqid] = (WAR.PD['金蛇缠丝手CD'][jqid] or 0) + 1
                    if WAR.PD['金蛇缠丝手CD'][jqid] == 10 then 
                        WAR.PD['金蛇缠丝手CD'][jqid] = 0
                        Cat('金蛇缠丝手',i)
                    end
                end
				---太极蓄力
				if (match_ID(jqid,5) and PersonKF(jqid,171)) or (MPTX(jqid,4,4) and Curr_NG(jqid,171)) then
					if WAR.PD["太极蓄力"][jqid] == nil or WAR.PD["太极蓄力"][jqid] == 0 then
					    WAR.PD["太极蓄力"][jqid] = 20
					end				
					if WAR.PD["太极蓄力"][jqid] ~= nil and WAR.PD["太极蓄力"][jqid] > 0 then
					    WAR.PD["太极蓄力"][jqid] = WAR.PD["太极蓄力"][jqid] + 20
						if WAR.PD["太极蓄力"][jqid] > 2000 then
							WAR.PD["太极蓄力"][jqid] = 2000
						end
					end
				end
				--般若防御
				if match_ID(jqid,577) or WAR.PD['般若防御'][jqid] ~= nil then
					local xl = math.modf(JY.Person[jqid]["防御力"] / 50)
					if WAR.PD["般若内爆"][jqid] == nil or WAR.PD["般若内爆"][jqid] == 0 then
					    WAR.PD["般若内爆"][jqid] = 20
					end				
					if WAR.PD["般若内爆"][jqid] ~= nil and WAR.PD["般若内爆"][jqid] > 0 then
					    WAR.PD["般若内爆"][jqid] = WAR.PD["般若内爆"][jqid] + xl
					    if WAR.PD["般若内爆"][jqid] > 1000 then
						    WAR.PD["般若内爆"][jqid] = 1000
					    end
					end
				end
				--易水寒诀
				if Curr_NG(jqid,43) and MPTX(jqid,20,2) then
					local j = 3
					if match_ID(jqid,514) then
						j = math.random(3)*3
					end
					if WAR.PD["易水寒诀"][jqid] == nil or WAR.PD["易水寒诀"][jqid] == 0 then
						WAR.PD["易水寒诀"][jqid] = j
					else
					    WAR.PD["易水寒诀"][jqid]= WAR.PD["易水寒诀"][jqid] + j + math.modf(math.random(2)*3)
					end
					if WAR.PD["易水寒诀"][jqid] > 100 then
						WAR.PD["易水寒诀"][jqid] = 100
					end
				end
				--易水四寒
				if PersonKF(jqid,21) and PersonKF(jqid,153) and Curr_NG(jqid,43) and WAR.PD['易水四寒2'][jqid] ~= nil  then
					for j = 0 ,WAR.PersonNum - 1 do
						if DWPD(i,j) and WAR.Person[j]['死亡'] == false and RealJL(i,j,7) then
							WAR.PD['易水四寒'][WAR.Person[j]['人物编号']] = WAR.PD['易水四寒2'][jqid]
							WAR.PD['易水四寒1'][WAR.Person[j]['人物编号']] = 0
						end
					end
					if WAR.JSX_Counter == 9 and WAR.PD['易水四寒2'][jqid] ~= 5 then
						WAR.PD['易水四寒2'][jqid] = math.random(4)
						for j = 0 ,WAR.PersonNum - 1 do
							if DWPD(i,j) and WAR.Person[j]['死亡'] == false and RealJL(i,j,7) then
								WAR.PD['易水四寒'][WAR.Person[j]['人物编号']] = WAR.PD['易水四寒2'][jqid]
								WAR.PD['易水四寒1'][WAR.Person[j]['人物编号']] = 0
							end
						end	
					end
				end	
				if WAR.PD['易水四寒'][jqid] ~= nil and WAR.PD['易水四寒1'][jqid] ~= nil then
					WAR.PD['易水四寒1'][jqid] = (WAR.PD['易水四寒1'][jqid] or 0) + 1
					if WAR.PD['易水四寒1'][jqid] == 10 then
						WAR.PD['易水四寒1'][jqid] = nil
						WAR.PD['易水四寒'][jqid] = nil
					end
				end	
				--黄天无极・氤氤氲氲
				if PersonKF(jqid,78) and Curr_QG(jqid,148) and PersonKF(jqid,55) then
					if WAR.PD["氤氤氲氲"][jqid] == nil or WAR.PD["氤氤氲氲"][jqid] == 0 then
						WAR.PD["氤氤氲氲"][jqid] = 1
					end	
					if WAR.PD["氤氤氲氲"][jqid] ~= nil and WAR.PD["氤氤氲氲"][jqid] > 0 then
					WAR.PD['氤氤氲氲'][jqid] = WAR.PD['氤氤氲氲'][jqid] + 2
					    if WAR.PD['氤氤氲氲'][jqid] > 120 then
						    WAR.PD['氤氤氲氲'][jqid] = 120
						end
					end
				end
                --先天护盾
				if WAR.PD["先天护盾CD"][jqid] ~= nil then
					WAR.PD["先天护盾CD"][jqid] = WAR.PD["先天护盾CD"][jqid] -1
					if WAR.PD["先天护盾CD"][jqid] < 1 then
						WAR.PD["先天护盾CD"][jqid] = nil
					end
				end	
				--天魔金身时序计数
				if WAR.PD['天魔金身'][jqid] ~= nil then
					if NGQH(jqid,160) then
						if WAR.PD['天魔金身'][jqid] > 50 then
							WAR.PD['天魔金身'][jqid] = WAR.PD['天魔金身'][jqid] - 1
						else
							WAR.PD['天魔金身'][jqid] = WAR.PD['天魔金身'][jqid] - 2
						end	
					else
						WAR.PD['天魔金身'][jqid] = WAR.PD['天魔金身'][jqid] - 1
					end	
					if WAR.PD['天魔金身'][jqid] <= 50 then	
						if JLSD(10,40,jqid) and NGQH(jqid,160) then
							WAR.PD['怒气负面效果1'][jqid] = nil
							WAR.PD['怒气负面效果2'][jqid] = nil
							if (WAR.LQZ[jqid] or 0) < 100 then
								WAR.LQZ[jqid] = 100
							end
							for kj = 0 , WAR.PersonNum-1 do
								if WAR.Person[kj]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[kj]["死亡"] == false then
									WAR.PD['恐惧状态'][WAR.Person[kj]["人物编号"]] = 1
								end
							end	
							WAR.PD['天魔金身'][jqid] = nil
							local s = WAR.CurID
							WAR.CurID = i
							WarDrawMap(0)
							CurIDTXDH(WAR.CurID, 6, 1, "天魔大法")
							WAR.CurID = s
						end
						if WAR.Person[i]['护盾'] == 13 then
							WAR.Person[i]['护盾'] = -1
						end
					end	
					if (WAR.PD['天魔金身'][jqid] or 0) < 1 then
						WAR.PD['天魔金身'][jqid] = nil
					end
				end
				--九阴太极
				if NGQH(jqid,107) then
					if WAR.JYHT2 < 30 then 
						WAR.JYHT2 = WAR.JYHT2 + 1
					end
					if WAR.JYHT2 == 30 then 
						if WAR.JYZQ[jqid] == nil then 
							WAR.JYZQ[jqid] = 1
						else 
						    WAR.JYZQ[jqid] = WAR.JYZQ[jqid] + 1 
						end
						if WAR.JYZQ[jqid] >= 9 then 
							WAR.JYZQ[jqid] = 9
						end
						WAR.JYHT2 = 0
					end
				end
				--先天真气
				if NGQH(jqid,100) then
					if WAR.XTZQ1 < 30 then
						WAR.XTZQ1 = WAR.XTZQ1 + 1
					end 
					if WAR.XTZQ1 == 30 then
						if WAR.XTZQ[jqid] == nil then
					        WAR.XTZQ[jqid] = 1 
						else
						    WAR.XTZQ[jqid] = WAR.XTZQ[jqid] + 1	
						end 	
					    if WAR.XTZQ[jqid] >= 7 then
						    WAR.XTZQ[jqid] = 7
					    end
					    WAR.XTZQ1 = 0
					end 	
				end 		
				--全真剑气
				if (PersonKF(jqid,100) or MPTX(jqid,16,2)) and PersonKF(jqid,39) then
				    if WAR.QZJQ1 < 30 then 
						WAR.QZJQ1 = WAR.QZJQ1 + 1
					end
					if WAR.QZJQ1 == 30 then 
						if WAR.QZJQ[jqid] == nil then 
							WAR.QZJQ[jqid] = 1 
						else
						    WAR.QZJQ[jqid] = WAR.QZJQ[jqid] + 1 
						end
						if WAR.QZJQ[jqid] >= 7 then 
							WAR.QZJQ[jqid] = 7
						end
						WAR.QZJQ1 = 0
					end
				end
				--五岳紫霞・
				if (PersonKF(jqid,89) and MPTX(jqid,14,2)) or JXPD(jqid,19,1) then
					if WAR.ZXQJ1 < 10 then
						WAR.ZXQJ1 = WAR.ZXQJ1 + 1
					end
					if WAR.ZXQJ1 == 10 then 
						if WAR.ZXQJ[jqid] == nil then
							WAR.ZXQJ[jqid] = 1
						else
						    WAR.ZXQJ[jqid] = WAR.ZXQJ[jqid] + 1 
						end
						if WAR.ZXQJ[jqid] > 10 then 
							WAR.ZXQJ[jqid] = 10
						end
						WAR.ZXQJ1 = 0
					end
				end
				--独孤九剑
                if (PersonKF(jqid,47) and PersonKF(jqid,184)) or match_ID(jqid,592) or (WAR.ZDDH == 424 and jqid == 670) then
				    if WAR.DGJY1 < 9 then 
		                WAR.DGJY1 = WAR.DGJY1 + 1
		            end
                    if WAR.DGJY1 == 9 then 
		                if WAR.DGJY[jqid] == nil then 
			                WAR.DGJY[jqid] = 1 
			            else 	 
                            WAR.DGJY[jqid] = WAR.DGJY[jqid] + 1 
			            end
                        if WAR.DGJY[jqid] >= 9 then 
                            WAR.DGJY[jqid] = 9
			            end
                        WAR.DGJY1 = 0
		            end  
		        end		
				--怒涛气劲
				if NGQH(jqid,252) then	
				    if WAR.NTJQ1 < 30 then 
		                WAR.NTJQ1 = WAR.NTJQ1 + 1
		            end
                    if WAR.NTJQ1 == 30 then 
		                if WAR.PD['怒涛剑气'][jqid] == nil then 
			                WAR.PD['怒涛剑气'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 8
							end	
			            else 	 
                            WAR.PD['怒涛剑气'][jqid] = WAR.PD['怒涛剑气'][jqid] + 1 
			            end
                        if WAR.PD['怒涛剑气'][jqid] >= 9 then 
                            WAR.PD['怒涛剑气'][jqid] = 9
			            end
                        WAR.NTJQ1 = 0
		            end  
		        end
				--九阳怒涛
                if NGQH(jqid,106) then    
					if WAR.JYHT1 < 30 then 
		                WAR.JYHT1 = WAR.JYHT1 + 1
		            end
                    if WAR.JYHT1 == 30 then 
		                if WAR.PD['九阳护盾'][jqid] == nil then 
			                WAR.PD['九阳护盾'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 6
							end	
			            else 	 
                            WAR.PD['九阳护盾'][jqid] = WAR.PD['九阳护盾'][jqid] + 1 
			            end
                        if WAR.PD['九阳护盾'][jqid] >= 9 then 
                            WAR.PD['九阳护盾'][jqid] = 9
			            end
                        WAR.JYHT1 = 0
		            end  
		        end
				--太极纯阳
				if NGQH(jqid,171) then
					if WAR.YYEQ1 < 25 then 
		                WAR.YYEQ1 = WAR.YYEQ1 + 1
		            end
                    if WAR.YYEQ1 == 25 then 
		                if WAR.PD['阴阳二气'][jqid] == nil then 
			                WAR.PD['阴阳二气'][jqid] = 1
							if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
								if match_ID(jqid,5) or jqid == 0 then
									WAR.Person[i]['护盾'] = 25
								else
								    WAR.Person[i]['护盾'] = 18
								end  
							end
			            else 	 
                            WAR.PD['阴阳二气'][jqid] = WAR.PD['阴阳二气'][jqid] + 1 
			            end
                        if WAR.PD['阴阳二气'][jqid] >= 9 then 
                            WAR.PD['阴阳二气'][jqid] = 9
			            end
                        WAR.YYEQ1 = 0
		            end  
		        end
				--神足乾坤
				if NGQH(jqid,233) then
					if WAR.SZQK1 < 25 then 
		                WAR.SZQK1 = WAR.SZQK1 + 1
		            end
                    if WAR.SZQK1 == 25 then 
		                if WAR.PD['神足乾坤'][jqid] == nil then 
			                WAR.PD['神足乾坤'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 31
							end	
			            else 	 
                            WAR.PD['神足乾坤'][jqid] = WAR.PD['神足乾坤'][jqid] + 1 
			            end
                        if WAR.PD['神足乾坤'][jqid] >= 9 then 
                            WAR.PD['神足乾坤'][jqid] = 9
			            end
                        WAR.SZQK1 = 0
		            end  
		        end
				--易水寒
				if NGQH(jqid,43) then
					if WAR.YSHB1 < 30 then 
		                WAR.YSHB1 = WAR.YSHB1 + 1
		            end
                    if WAR.YSHB1 == 30 then 
		                if WAR.PD['易水寒冰'][jqid] == nil then 
			                WAR.PD['易水寒冰'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 33
							end	
			            else 	 
                            WAR.PD['易水寒冰'][jqid] = WAR.PD['易水寒冰'][jqid] + 1 
			            end
                        if WAR.PD['易水寒冰'][jqid] >= 10 then 
                            WAR.PD['易水寒冰'][jqid] = 10
			            end
                        WAR.YSHB1 = 0
		            end  
		        end
				--先天太极
				if match_ID(jqid,520) then
					if WAR.XTTJ1 < 25 then 
		                WAR.XTTJ1 = WAR.XTTJ1 + 1
		            end
                    if WAR.XTTJ1 == 25 then 
		                if WAR.PD['先天太极'][jqid] == nil then 
			                WAR.PD['先天太极'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 22
							end	
			            else 	 
                            WAR.PD['先天太极'][jqid] = WAR.PD['先天太极'][jqid] + 1 
			            end
                        if WAR.PD['先天太极'][jqid] >= 8 then 
                            WAR.PD['先天太极'][jqid] = 8
			            end
                        WAR.XTTJ1 = 0
		            end  
		        end
				--倾国倾城
				if match_ID(jqid,754) or MPTX(jqid,26,3) then
					if WAR.QGQC1 < 18 then 
		                WAR.QGQC1 = WAR.XTTJ1 + 1
		            end
                    if WAR.QGQC1 == 18 then 
		                if WAR.PD['倾国倾城'][jqid] == nil then 
			                WAR.PD['倾国倾城'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 26
							end	
			            else 	 
                            WAR.PD['倾国倾城'][jqid] = WAR.PD['倾国倾城'][jqid] + 1 
			            end
                        if WAR.PD['倾国倾城'][jqid] >= 5 then 
                            WAR.PD['倾国倾城'][jqid] = 5
			            end
                        WAR.QGQC1 = 0
		            end  
		        end
				--葵花紫霞
				if NGQH(jqid,105) or JXPD(jqid,19,1) then	
					if WAR.KHHD1 < 30 then 
		                WAR.KHHD1 = WAR.KHHD1 + 1
		            end
                    if WAR.KHHD1 == 30 then 
		                if WAR.PD['葵花护盾'][jqid] == nil then 
			                WAR.PD['葵花护盾'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 7
							end	
			            else 	 
                            WAR.PD['葵花护盾'][jqid] = WAR.PD['葵花护盾'][jqid] + 1 	
			            end
                        if WAR.PD['葵花护盾'][jqid] > 6 then 
                            WAR.PD['葵花护盾'][jqid] = 6
			            end
                        WAR.KHHD1 = 0
		            end  
		        end
				--长生真气
				if NGQH(jqid,203) then    
					if WAR.QSZQ < 25 then 
		                WAR.QSZQ = WAR.QSZQ + 1
		            end
                    if WAR.QSZQ == 25 then 
		                if WAR.PD['长生真气'][jqid] == nil then 
			                WAR.PD['长生真气'][jqid] = 1
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 9
							end	
			            else 	 
                            WAR.PD['长生真气'][jqid] = WAR.PD['长生真气'][jqid] + 1 
			            end
                        if WAR.PD['长生真气'][jqid] >= 7 then 
                            WAR.PD['长生真气'][jqid] = 7
			            end
                        WAR.QSZQ = 0
		            end  
		        end
				--喵太极护盾
			    if match_ID(jqid,92) and WAR.JSX_Counter == 9 then
				    if WAR.PD['阴阳二气'][jqid] == nil then
                        WAR.PD['阴阳二气'][jqid] = 1
						if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
				            WAR.Person[i]['护盾'] = 18
			            end
					else
						WAR.PD['阴阳二气'][jqid] = WAR.PD['阴阳二气'][jqid] + 1
					end
					if WAR.PD['阴阳二气'][jqid] >= 9 then 
                        WAR.PD['阴阳二气'][jqid] = 9
			        end
                end
		------------------------------------------怒气时序增加----------------------------------------------
		        --防止怒气小于0
				if WAR.LQZ[jqid] ~= nil and WAR.LQZ[jqid] < 0 then 
					WAR.LQZ[jqid] = 0
				end
				--竹风雨滴・怒气爆发
				if match_ID(jqid,520) and JLSD(60,90,jqid) then
					nuqi(jqid,1)
				end	
				--无酒不欢：主运蛤蟆功 
				--胡一刀觉醒
				if Curr_NG(jqid, 95) or JXPD(jqid,633,1) or match_ID(jqid,9939) then
					nuqi(jqid,1)
				end
				--鲸息功时序增加怒气
				if Curr_NG(jqid, 180) then
					nuqi(jqid,2)
				end
				--白驼山2级    
				if (MPTX(jqid,8,2) and Curr_NG(jqid,95)) or match_ID(jqid,61) then
					nuqi(jqid,2)
					--小蛤蟆
					if match_ID(jqid,61) and Curr_QG(jqid,150) then
						nuqi(jqid,2)
					end
				end
				--忘情怒涛
				if NGQHB(jqid,177) then
					nuqi(jqid,10)
				end	
				--降魔附魔
				if WGZH(jqid,86,267) then
					nuqi(jqid,2)
				end	
				--中庸觉醒
				if jqid == 0 and JY.Base["天书数量"] > 1 and (JY.Base["畅想"] > 0 or JY.Base["标准"] > 0) and (JY.Person[0]["资质"] < 80 and JY.Person[0]["资质"] > 30) then
					nuqi(jqid,2)
					if JY.Person[0]["中庸"] == 3 then
						zhanyi(jqid,2)
					end
				end
				--喵太极・怒气爆发
				if match_ID(jqid,92) and math.random(10) < 5 then
					nuqi(jqid,3)
				end	
				--杨冰羽・怒气爆发
				if match_ID(jqid,514) then
					nuqi(jqid,3)
				end	
				--玉女先天
				if WAR.QX1[jqid] == 1 then 
					nuqi(jqid,5)
				end
				--血战到底
				if WAR.PD['血战到底'][jqid] ~= nil and WAR.PD['血战到底'][jqid] == 1 then
					if JY.Person[jqid]['畅想分阶'] < 3 then
						nuqi(jqid,50)
						if JY.Person[jqid]['畅想分阶'] < 2 then
							zhanyi(jqid,50)
						end
					end
				end
				--满江红
				if WAR.PD['满江红'][jqid] ~= nil and WAR.PD['满江红'][jqid] == 1 then
					nuqi(jqid,3)
					zhanyi(jqid,3)
				end
				--白驼山3级
				if MPTX(jqid,8,3) and Curr_NG(jqid,104) then
					nuqi(jqid,1)
				end
			    --文泰来，血量少于一半时，+2点时序怒气
				if match_ID(jqid, 151) then
					if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] *0.5 then
						nuqi(jqid,2)
					else
						nuqi(jqid,1)
					end		
				end
				--兽王庄
				if MPTX(jqid,27,2) then
					nuqi(jqid,1)
					if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] * 0.5 then
						nuqi(jqid,2)
					end
				end 	
				--------------------------------------战意时序增加--------------------------------------
				if WAR.SPIRIT[jqid] == nil then
					WAR.SPIRIT[jqid] = 1
				else
					local jl = 40
					if Curr_QG(jqid,280) then
						jl = jl + 15
					end	
					if JLSD(20,jl,jqid) then
						zhanyi(jqid,1)
						if (WAR.PD['三垣'][jqid] or 0) > 30 and (WAR.PD['三垣'][jqid] or 0) < 61 then
							zhanyi(jqid,1)
						end
						if (PersonKF(jqid,78) and Curr_QG(jqid,148) and PersonKF(jqid,148)) and WAR.PD["氤氤氲氲"][jqid]~= nil then  --氤氤氲氲
							local a = math.modf((WAR.PD['氤氤氲氲'][jqid] or 0)/100)
                            zhanyi(jqid,a)
						end	
						if MPTX(jqid,23,2) then  --朝廷百夫长
                            if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] *0.8 then
							    zhanyi(jqid,1)
								if JY.Person[jqid]["生命"] < JY.Person[jqid]["生命最大值"] *0.4 then
									zhanyi(jqid,2)
								end
							end
						end
						if WAR.PD['苍龙破'][jqid] ~= nil and JLSD(10,25+WAR.PD['苍龙破'][jqid],jqid) then
							zhanyi(jqid,WAR.PD['苍龙破'][jqid]) 
						end	
					end	
				end
				--独孤求败
				if match_ID(jqid,592) then
					if WAR.PD['无我之境'][jqid] ~= nil then
						if WAR.SPIRIT[jqid] == nil then 
							WAR.SPIRIT[jqid] = 200
						end
						zhanyi(jqid,200)
					end
				end
				--圣火狮子
				if NGQHB(jqid,93) then 
					if WAR.SPIRIT[jqid] == nil then 
					    WAR.SPIRIT[jqid] = 2
				    end
					zhanyi(jqid,2)
				end
			
				--竹风雨滴
				if match_ID(jqid,520) and JLSD(60,90,jqid) then 
					if WAR.SPIRIT[jqid] == nil then 
					    WAR.SPIRIT[jqid] = 2
				    end
					zhanyi(jqid,1)
				end
				--扫地战意爆发
				if match_ID(jqid,114) then
					if WAR.SPIRIT[jqid] == nil then 
					    WAR.SPIRIT[jqid] = 2
				    end
					zhanyi(jqid,2)
					if ZYJQ(jqid) then
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 219, 1, "众生度尽・方证菩提", Color_Hurt1)
						WAR.CurID = s
						for j = 0, WAR.PersonNum-1 do 
						local df = WAR.Person[j]["人物编号"] 
						local offset1 = math.abs(WAR.Person[i]["坐标X"] - WAR.Person[j]["坐标X"]) 
						local offset2 = math.abs(WAR.Person[i]["坐标Y"] - WAR.Person[j]["坐标Y"])
						local offset=offset1+offset2
						local mpdj = 10		
						local sm = math.modf(JY.Person[jqid]["生命"]*0.2)
						local nl = math.modf(JY.Person[jqid]["内力"]*0.15)
						local sh = sm + nl
						if sh > 4000 then
							sh = 4000
						end
						JY.Person[jqid]["生命"] = math.modf(JY.Person[jqid]["生命"]*0.8)
						JY.Person[jqid]["内力"] = math.modf(JY.Person[jqid]["内力"]*0.85)
						    if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false and (offset1<=mpdj and offset2<=mpdj) then
								ztd(j,'生命点数',-sh)
								zhanyi(j,-20)
								nuqi(j,-20)
							end
						end
						WAR.SPIRIT[jqid] = 100
					end
				end
				--少林派
				if MPTX(jqid,5,3) and Curr_NG(jqid,108) then
					zhanyi(jqid,1)
					if WAR.SPIRIT[jqid] > 100 then
						local a = limitX(math.modf(psx(jqid,'品德')*0.05),1,6)
						nuqi(jqid,a)
					end	
				end	
				--[[if WAR.SPIRIT[jqid] >= 200 then
					WAR.SPIRIT[jqid] = 200
					local s = WAR.CurID
					WAR.CurID = i
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 6, 1, "战意爆发")
					WAR.PD["战意爆发"][jqid] = 1					
					WAR.CurID = s
				end]]
				
				--------------------------------------特定时序效果--------------------------------------
				--张家辉的隐身戒指cd
				if WAR.YSJZ ~= 0 then
					WAR.YSJZ = WAR.YSJZ - 1
				end
				--竹风雨滴
				if match_ID(jqid,520) then
					if WAR.JTJQ[jqid] == nil then
						WAR.JTJQ[jqid] = 1
					else
						WAR.JTJQ[jqid] = WAR.JTJQ[jqid] + 1
					end
					if WAR.JTJQ[jqid] == 19 then
						WAR.JTJQ[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 410, 1, "无上剑境・九天剑斩", Color_Hurt1)
						WAR.CurID = s
						for j = 0, WAR.PersonNum-1 do
					        if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							    if JY.Person[WAR.Person[j]["人物编号"]]["畅想分阶"] > 1 then
								    JY.Person[WAR.Person[j]["人物编号"]]["生命"] = 0
						            WAR.Person[j]["死亡"] = true
									WarSetPerson()
									break
								else
								    JY.Person[WAR.Person[j]["人物编号"]]["畅想分阶"] = JY.Person[WAR.Person[j]["人物编号"]]["畅想分阶"] + 1
									JY.Person[WAR.Person[j]["人物编号"]]["生命"] = math.modf(JY.Person[WAR.Person[j]["人物编号"]]["生命"] * 0.5)
									JY.Person[WAR.Person[j]["人物编号"]]["内力"] = math.modf(JY.Person[WAR.Person[j]["人物编号"]]["内力"] * 0.5)
									JY.Person[WAR.Person[j]["人物编号"]]["体力"] = math.modf(JY.Person[WAR.Person[j]["人物编号"]]["体力"] * 0.5)
							    end
						    end
					    end
						if (WAR.PD["先天太极"][jqid] or 0) < 8 then
							WAR.PD["先天太极"][jqid] = 8
							if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] <= -1 then
								WAR.Person[i]["护盾"] = 22
							end	
						end
						JY.Person[jqid]["内力"] = JY.Person[jqid]["内力最大值"]
						JY.Person[jqid]["体力"] = 100
						AddPersonAttrib(jqid,"中毒程度",-JY.Person[jqid]["中毒程度"])
						AddPersonAttrib(jqid,"受伤程度",-JY.Person[jqid]["受伤程度"])
						AddPersonAttrib(jqid,"冰封程度",-JY.Person[jqid]["冰封程度"])
						AddPersonAttrib(jqid,"灼烧程度",-JY.Person[jqid]["灼烧程度"])
						AddPersonAttrib(jqid,"流血程度",-JY.Person[jqid]["流血程度"])
						AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
					end
				end
                --梅长苏 偷天换日
                 if match_ID(jqid,507)  then
                    if WAR.PD["偷天换日"][jqid] == nil then
                        WAR.PD["偷天换日"][jqid] = 1
                    else
                        WAR.PD["偷天换日"][jqid] = WAR.PD["偷天换日"][jqid] + 1
                    end	
                    if WAR.PD["偷天换日"][jqid] >= 100 and JY.Person[jqid]["冰封程度"] == 0 and JY.Person[jqid]["灼烧程度"] == 0 then
                       WAR.PD["偷天换日"][jqid] = nil	
                       WAR.ZSXS[jqid] = 1
                       AddPersonAttrib(jqid,'灼烧程度',50)
                       WAR.BFXS[jqid] = 1
                       AddPersonAttrib(jqid,'冰封程度',100)
                       local s = WAR.CurID
                       WAR.CurID = i
                       WarDrawMap(0)
                       CurIDTXDH(WAR.CurID, 104, 1, "火寒毒发・偷天换日", PinkRed)
                       WAR.CurID = s
                       JY.Person[jqid]["生命"] = JY.Person[jqid]["生命最大值"]
                       JY.Person[jqid]["内力"] = JY.Person[jqid]["内力最大值"]
                       JY.Person[jqid]["体力"] = 100
					   AddPersonAttrib(jqid,"中毒程度",-JY.Person[jqid]["中毒程度"])
					   AddPersonAttrib(jqid,"受伤程度",-JY.Person[jqid]["受伤程度"])
					   AddPersonAttrib(jqid,"冰封程度",-JY.Person[jqid]["冰封程度"])
					   AddPersonAttrib(jqid,"灼烧程度",-JY.Person[jqid]["灼烧程度"])
					   AddPersonAttrib(jqid,"流血程度",-JY.Person[jqid]["流血程度"])
                       AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
                    end
                end			   

				--天山童姥：转瞬红颜
				if match_ID(jqid, 117) or match_ID(jqid, 9868) then
					if WAR.ZSHY[jqid] == nil then
						WAR.ZSHY[jqid] = 1
					else
						WAR.ZSHY[jqid] = WAR.ZSHY[jqid] + 1
					end
					if WAR.ZSHY[jqid] == 99 then
						WAR.ZSHY[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 104, 1, "红颜弹指老・刹那芳华", PinkRed)
						WAR.CurID = s
						JY.Person[jqid]["生命"] = JY.Person[jqid]["生命最大值"]
						JY.Person[jqid]["内力"] = JY.Person[jqid]["内力最大值"]
						JY.Person[jqid]["体力"] = 100
						AddPersonAttrib(jqid,"中毒程度",-JY.Person[jqid]["中毒程度"])
						AddPersonAttrib(jqid,"受伤程度",-JY.Person[jqid]["受伤程度"])
						AddPersonAttrib(jqid,"冰封程度",-JY.Person[jqid]["冰封程度"])
						AddPersonAttrib(jqid,"灼烧程度",-JY.Person[jqid]["灼烧程度"])
						AddPersonAttrib(jqid,"流血程度",-JY.Person[jqid]["流血程度"])
						AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
					end
				end
				
				--云梦涧4级 				
				if MPTX(jqid,26,4) then
					if WAR.YMJ[jqid] == nil then
						WAR.YMJ[jqid] = 1
					else
						WAR.YMJ[jqid] = WAR.YMJ[jqid] + 1
					end
					if WAR.YMJ[jqid] == 65 then
						WAR.YMJ[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 39, 1, "质傲清霜色・香含秋露华", PinkRed)
						WAR.CurID = s
						JY.Person[jqid]["生命"] = JY.Person[jqid]["生命最大值"]
						JY.Person[jqid]["内力"] = JY.Person[jqid]["内力最大值"]
						JY.Person[jqid]["体力"] = 100
						AddPersonAttrib(jqid,"中毒程度",-JY.Person[jqid]["中毒程度"])
						AddPersonAttrib(jqid,"受伤程度",-JY.Person[jqid]["受伤程度"])
						AddPersonAttrib(jqid,"冰封程度",-JY.Person[jqid]["冰封程度"])
						AddPersonAttrib(jqid,"灼烧程度",-JY.Person[jqid]["灼烧程度"])
						AddPersonAttrib(jqid,"流血程度",-JY.Person[jqid]["流血程度"])
						AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
					end
				end
				
				--凝结时空
				if match_ID(jqid,520) then
					if WAR.NJSK[jqid] == nil then
						WAR.NJSK[jqid] = 1
					else
						WAR.NJSK[jqid] = WAR.NJSK[jqid] + 1
					end
					if WAR.NJSK[jqid] > 15 then
						WAR.NJSK[jqid] = 15
					end
					if WAR.NJSK[jqid] == 15 then
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 120, 1, "剑心地狱・凝结时空", PinkRed)
						WAR.CurID = s
						for j = 0 , WAR.PersonNum - 1 do
							local n = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
								WAR.PD['凝结时空'][n] = 1
							end
						end	
					end
				end				
				
				--凝结时空
				if match_ID(jqid,457) then
					if WAR.NJSK[jqid] == nil then
						WAR.NJSK[jqid] = 1
					else
						WAR.NJSK[jqid] = WAR.NJSK[jqid] + 1
					end
					if WAR.NJSK[jqid] > 30 then
						WAR.NJSK[jqid] = 30
					end
					if WAR.NJSK[jqid] == 30 then
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 120, 1, "剑心地狱・凝结时空", PinkRed)
						WAR.CurID = s
						for j = 0 , WAR.PersonNum - 1 do
							local n = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
								WAR.PD['凝结时空'][n] = 1
							end
						end	
					end
				end				
				
				--贝海石：老谋深算
				if match_ID(jqid, 85) or match_ID(jqid, 9867) then
					if WAR.LMSS[jqid] == nil then
						WAR.LMSS[jqid] = 1
					else
						WAR.LMSS[jqid] = WAR.LMSS[jqid] + 1
					end
					if WAR.LMSS[jqid] == 199 then
						WAR.LMSS[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 136, 1, "久病成良医", PinkRed)
						WAR.CurID = s
						JY.Person[jqid]["生命"] = JY.Person[jqid]["生命最大值"]
						JY.Person[jqid]["内力"] = JY.Person[jqid]["内力最大值"]
						JY.Person[jqid]["体力"] = 100
						AddPersonAttrib(jqid,"中毒程度",-JY.Person[jqid]["中毒程度"])
						AddPersonAttrib(jqid,"受伤程度",-JY.Person[jqid]["受伤程度"])
						AddPersonAttrib(jqid,"冰封程度",-JY.Person[jqid]["冰封程度"])
						AddPersonAttrib(jqid,"灼烧程度",-JY.Person[jqid]["灼烧程度"])
						AddPersonAttrib(jqid,"流血程度",-JY.Person[jqid]["流血程度"])
						AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
					end
				end
				--张三丰 纯阳道体・化气归命
				if match_ID(jqid,5) then
					if WAR.CYDT[jqid] == nil then
						WAR.CYDT[jqid] = 1
					else
						WAR.CYDT[jqid] = WAR.CYDT[jqid] + 1
					end
					if WAR.CYDT[jqid] == 18 then
						WAR.CYDT[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 135, 1, "纯阳道体・化气归命", PinkRed)
						WAR.CurID = s
						JY.Person[jqid]["生命"] = JY.Person[jqid]["生命"] + math.modf(JY.Person[jqid]["内力"] * 0.3)
						JY.Person[jqid]["内力"] = JY.Person[jqid]["内力"] - math.modf(JY.Person[jqid]["内力"] * 0.3)
						JY.Person[jqid]["体力"] = JY.Person[jqid]["体力"] + 10
						if JY.Person[jqid]["生命"] < JY.Person[jqid]["内力"] then
							JY.Person[jqid]["生命"] = JY.Person[jqid]["内力"]
							JY.Person[jqid]["内力"] = JY.Person[jqid]["生命"]
						end
						WAR.Person[i].Time = WAR.Person[i].Time + math.modf(JY.Person[jqid]["内力"] * 0.12)
					end
				end
				--张三丰 
				if match_ID(jqid,5) and PersonKF(jqid,99) then
					if JY.Person[jqid]["内力"] < 4000 then
						JY.Person[jqid]["内力"] = 4000
					end
				end
				--竹风雨滴
				if match_ID(jqid, 520) or match_ID(jqid, 92) or match_ID(jqid, 456) then
					if JY.Person[jqid]["内力"] < 1000 then
						JY.Person[jqid]["内力"] = 1000
					end
				end
				
				--观止颠倒的世界
				if JXPD(jqid,456,1) then
					if WAR.PD["颠倒的世界CD"][jqid] == nil then
                        WAR.PD["颠倒的世界CD"][jqid] = 1
                    else
                        WAR.PD["颠倒的世界CD"][jqid] = WAR.PD["颠倒的世界CD"][jqid] + 1
                    end	
                    if WAR.PD["颠倒的世界CD"][jqid] >= 18 then
                        WAR.PD["颠倒的世界CD"][jqid] = nil	
					    WAR.PD["颠倒的世界"][jqid] = 1
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 373, 1, "扭曲五感・错乱时空", PinkRed)
						WAR.CurID = s
						for j = 0, WAR.PersonNum-1 do
					        if WAR.Person[j]["死亡"] == false then
							    WAR.PD["颠倒的世界"][WAR.Person[j]["人物编号"]] = 1
						    end
					    end
					end
				end
				--观止偷天换命
				if match_ID(jqid,456) then
					if WAR.TDWJ[jqid] == nil then
						WAR.TDWJ[jqid] = 1
					else
						WAR.TDWJ[jqid] = WAR.TDWJ[jqid] + 1
					end
					if WAR.TDWJ[jqid] == 36 then
						WAR.TDWJ[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 99, 1, "九死无生・天地一合", PinkRed)
						WAR.CurID = s
						for j = 0, WAR.PersonNum-1 do
					        local df = WAR.Person[j]["人物编号"]
			                if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
							    JY.Person[df]["生命"] = math.modf(JY.Person[df]["生命"]/3)
								JY.Person[df]["内力"] = math.modf(JY.Person[df]["内力"]/3)
								if JY.Person[df]["生命"] < 1111 then
									JY.Person[df]["生命"] = 0
								end
								if JY.Person[df]["内力"] < 1111 then
									JY.Person[df]["内力"] = 0
								end
								AddPersonAttrib(df,"中毒程度",150)
								AddPersonAttrib(df,"受伤程度",100)
								AddPersonAttrib(df,"冰封程度",100)
								AddPersonAttrib(df,"灼烧程度",100)
								AddPersonAttrib(df,"流血程度",100)
								AddPersonAttrib(df,"封穴程度",50)
								WAR.TXXS[df] = 1
						    end
					    end
						if JXPD(jqid,456,1) then
							if WAR.PD['九命猫'][jqid] == nil then
								WAR.PD['九命猫'][jqid] = 2
							else
								WAR.PD['九命猫'][jqid] = (WAR.PD['九命猫'][jqid] or 0) + 1
							end
							if WAR.PD['九命猫'][jqid] ~=nil and WAR.PD['九命猫'][jqid] > 9 then
								WAR.PD['九命猫'][jqid] = 9
							end
						end
						JY.Person[jqid]["生命"] = JY.Person[jqid]["生命最大值"]
						JY.Person[jqid]["内力"] = JY.Person[jqid]["内力最大值"]
						JY.Person[jqid]["体力"] = 100
						AddPersonAttrib(jqid,"中毒程度",-JY.Person[jqid]["中毒程度"])
						AddPersonAttrib(jqid,"受伤程度",-JY.Person[jqid]["受伤程度"])
						AddPersonAttrib(jqid,"冰封程度",-JY.Person[jqid]["冰封程度"])
						AddPersonAttrib(jqid,"灼烧程度",-JY.Person[jqid]["灼烧程度"])
						AddPersonAttrib(jqid,"流血程度",-JY.Person[jqid]["流血程度"])
						AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
					end
				end
				--李莫愁：情为何物
				if match_ID(jqid,161) or match_ID(jqid,9827) then --and WAR.SXTJ > 10
					if WAR.QWHW[jqid] == nil then
						WAR.QWHW[jqid] = 1
					else
						WAR.QWHW[jqid] = WAR.QWHW[jqid] + 1
					end
					if WAR.QWHW[jqid] == 50 then
						WAR.QWHW[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 106, 1, "问世间情为何物", PinkRed)
						--WAR.CurID = s
						local XZ = {}
						for j = 0, WAR.PersonNum - 1 do
							local df = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
								table.insert(XZ,j)
								WAR.TXXS[df] = 1
							end
						end
						local ri = XZ[math.random(#XZ)]
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 106, 1, "直教人生死相许", PinkRed)
						War_ExecuteMenu_Sub(WAR.Person[ri]["坐标X"],  WAR.Person[ri]["坐标Y"], 4, 34)
						WarDrawMap(0)
						War_ExecuteMenu_Sub(WAR.Person[ri]["坐标X"],  WAR.Person[ri]["坐标Y"], 4, 34)
						WarDrawMap(0)
						War_ExecuteMenu_Sub(WAR.Person[ri]["坐标X"],  WAR.Person[ri]["坐标Y"], 4, 34)
						WAR.CurID = s
						--xunhuan = false
					end
				end
				
				--黄药师：碧海潮生曲
				if JXPD(jqid,57,1) then
					if WAR.BHCS[jqid] == nil then
						WAR.BHCS[jqid] = 1
					else
						WAR.BHCS[jqid] = WAR.BHCS[jqid] + 1
					end
					if WAR.BHCS[jqid] == 28 then
						WAR.BHCS[jqid] = nil
						local s = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0)
						CurIDTXDH(WAR.CurID, 174, 1, "遁术・二十八星宿挪移", PinkRed)
						WAR.CurID = s
						for j = 0 , WAR.PersonNum - 1 do
							local n = WAR.Person[j]["人物编号"]
							if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
								WAR.TXXS[n] = 1
								ztd(j,'生命点数',-500)
								ztd(j,'内力点数',-800)
								ztd(j,'体力点数',-8)
								WAR.PD['神经蛇毒'][n] = math.random(6,12)
								WAR.PD['护龙特殊'][n] = math.random(6,12)
								WAR.PD['气阻中门'][n] = math.random(6,12)
								WAR.PD['护龙军师'][n] = math.random(6,12)
							end
						end	
					end
				end
				
				--无酒不欢：集气读数获取位置
				WAR.JQSDXS[jqid] = limitX(math.modf(jq))
				if WAR.Person[i].Time >= 1000 then
					jqwz = WAR.Person[i].Time
					atid = i
                    xunhuan = false
				end
				--御气纵横
				if match_ID(jqid,9945) then 
                    if WAR.PD['御气纵横'][jqid] ~= nil then 
                        WAR.PD['御气纵横'][jqid] = WAR.PD['御气纵横'][jqid] - 1 
                        if WAR.PD['御气纵横'][jqid] < 1 then 
							WAR.PD['御气纵横'][jqid] = nil
							if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] <= -1 then
								WAR.Person[i]['护盾'] = 17
							end
						    WAR.CurID = i 
                            WarDrawMap(0)
                            CurIDTXDH(WAR.CurID, 129, 1,'御气纵横')
                            WAR.PD['时序出手'][#WAR.PD['时序出手']+1] = i
                            xunhuan = false
							if match_ID(jqid,456) then
                                WAR.PD['御气纵横'][jqid] = 9
								Cat('护盾停止',i)
							else
							    WAR.PD['御气纵横'][jqid] = 20
								Cat('护盾停止',i)
							end
						end
                    end
                end
		    ---------------------------------------------------------------------
		    ---------------------------时序恢复集气位置--------------------------
		    ---------------------------------------------------------------------	
				--擒龙罗汉
				if NGQH(jqid,204) then
					if WAR.Actup[jqid] == 1 then
				        if WAR.Person[i].Time < 500 then 
	                        WAR.Person[i].Time = 500
				        end
	                else
					    if WAR.Person[i].Time < 250 then 
							WAR.Person[i].Time = 250
						end
	                end  
				end
				--九阴太极
				if NGQH(jqid,107) and WAR.ZBT3 > 0 then
					local jqxl = JY.Person[jqid]["轻功"]/10*WAR.ZBT3
				    if WAR.Person[i].Time < jqxl then 
	                    WAR.Person[i].Time = jqxl
				    end
			    end	
				--卫栖吾
				if match_ID(jqid, 581) then 
                    if WAR.Person[i].Time < 0 then 
                        WAR.Person[i].Time = 0    
                    end
                end
				--朝廷百夫长
				if MPTX(jqid,23,2) then
				    local yxfz = math.modf((JY.Person[jqid]["生命最大值"] - JY.Person[jqid]["生命"]) / JY.Person[jqid]["生命最大值"] * 400)
				    if WAR.Person[i].Time < yxfz then 
	                    WAR.Person[i].Time = yxfz
				    end
			    end
				--混元真谛
				if match_ID(jqid,524) then
					local hyzd = (180 - JY.Person[jqid]["体力"]) * 4
					if WAR.Person[i].Time < hyzd then 
	                    WAR.Person[i].Time = hyzd
				    end
				end
				--气阻中门阻止回集气
				if WAR.PD['气阻中门'][jqid] ~= nil then
					if WAR.Person[i].Time > 500 then 
	                    WAR.Person[i].Time = 500
				    end
				end
				--临兵冲
                if jqid == 0 and JY.Base["标准"] > 0 and JY.Base["天书数量"] >= 2 
				    and (math.random(1000) < JY.Base["天书数量"] + 5 + math.modf(JY.Person[0]["资质"] / 20)) then 
		            local tmppid = WAR.CurID
					
		            WAR.CurID = i
			        WarDrawMap(0); --不加这条则动画位置无法正常显示
			        CurIDTXDH(WAR.CurID, 10, 1, "临兵冲强行冲击集气", PinkRed)
			        local a = math.modf(JY.Person[jqid]["资质"] / 20)
			        a = 5 + a
		            a = math.random(a) * 40
			        WAR.Person[i].Time = WAR.Person[i].Time + a
                    if WAR.Person[i].Time >= 1005 then
			            WAR.Person[i].Time = 1005
			        end
			        --CurIDTXDH(WAR.CurID, 40, 1, "集气冲击完成", PinkRed)
			        CurIDTXDH(WAR.CurID, 70, 1, "临兵冲强行冲击"..a.."点集气", C_GOLD)
                    if JY.Base["标准"] > 0 then
			            local b = math.random(a) * 1
						local c = math.random(a) * 7
                        AddPersonAttrib(jqid,"生命",b)
						AddPersonAttrib(jqid,"内力",c)
						nuqi(jqid,3)
						zhanyi(jqid,6)
			            CurIDTXDH(WAR.CurID, 125, 1, "精气奔流获得"..b.."点生命、"..c.."点内力", Violet)
                    end		
		            for j = 0, WAR.PersonNum - 1 do 
			            if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
				            if WAR.Person[j].Time >= 1000 then
				                WAR.Person[j].Time = 980
				            end 
			            end
			        end	
                    WAR.CurID=tmppid
					--[[DrawBox_1(x1 - 3, y, x2 + 3, y + 3, C_ORANGE)
					DrawBox_1(x1 - (x2 - x1) / 2, y, x1 - 3, y + 3, C_RED)
					DrawString(x2 + 10, y - 20, "时序", C_WHITE, CC.FontSMALL)
					lib.FillColor(x1+1, y+1, x1+90, y+3,C_ORANGE)
					lib.FillColor(x1-94, y+1, x1-6, y+3,C_RED)
					--lib.SetClip(x1 - (x2-x1)/2-100, 0, CC.ScreenW, CC.ScreenH/4 + 50)
					surid = lib.SaveSur( x1 - (x2-x1)/2-100, 0, CC.ScreenW, CC.ScreenH/4 + 50)	]]		
		        end

                --隼龙令
                if PersonKF(jqid,282) and math.random(100) < 16 then 
		            local tmppid = WAR.CurID
					
		            WAR.CurID = i
			        WarDrawMap(0); --不加这条则动画位置无法正常显示
			        --CurIDTXDH(WAR.CurID, 10, 1, "强行冲击集气", PinkRed
		            local a = math.random(8) * 40
			        WAR.Person[i].Time = WAR.Person[i].Time + a
                    if WAR.Person[i].Time >= 1005 then
			            WAR.Person[i].Time = 1005
			        end
			        --CurIDTXDH(WAR.CurID, 41, 1, "集气冲击完成", PinkRed)
			        CurIDTXDH(WAR.CurID, 71, 1, "隼龙诀强行冲击"..a.."点集气", C_GOLD)
                    if JY.Base["畅想"] > 0 then
			            local b = math.random(a) * 1
						local c = math.random(a) * 7
                        AddPersonAttrib(jqid,"生命",b)
						AddPersonAttrib(jqid,"内力",c)
						nuqi(jqid,3)
						zhanyi(jqid,6)
						--JY.Person[jqid]["生命"] = JY.Person[jqid]["生命"] + b
						--JY.Person[jqid]["内力"] = JY.Person[jqid]["内力"] + c;
			            CurIDTXDH(WAR.CurID, 126, 1, "精气奔流获得"..b.."点生命、"..c.."点内力", Violet)
						--CurIDTXDH(WAR.CurID, 112, 1, "内力奔流获得", Violet)
                    end		
		            for j = 0, WAR.PersonNum - 1 do 
			            if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
				            if WAR.Person[j].Time >= 1000 then
				                WAR.Person[j].Time = 980
				            end 
			            end
			        end	
                    WAR.CurID=tmppid			
		        end	

                --虾米临兵冲
                if match_ID(jqid,759) and JLSD(10,30,jqid) then 
		            local tmppid = WAR.CurID
		            WAR.CurID = i
			        WarDrawMap(0); --不加这条则动画位置无法正常显示
			        CurIDTXDH(WAR.CurID, 10, 1, "临兵冲强行冲击集气", PinkRed)
			        local a = 6
			        a = 5 + a
		            a = math.random(a) * 40
			        WAR.Person[i].Time = WAR.Person[i].Time + a
                    if WAR.Person[i].Time >= 1005 then
			            WAR.Person[i].Time = 1005
			        end
			        --CurIDTXDH(WAR.CurID, 40, 1, "集气冲击完成", PinkRed)
			        CurIDTXDH(WAR.CurID, 70, 1, "临兵冲强行冲击"..a.."点集气", C_GOLD)
                    if JY.Base["标准"] > 0 then
			            local b = math.random(a) * 1
						local c = math.random(a) * 7
                        AddPersonAttrib(jqid,"生命",b)
						AddPersonAttrib(jqid,"内力",c)
						nuqi(jqid,3)
						zhanyi(jqid,6)
			            CurIDTXDH(WAR.CurID, 125, 1, "精气奔流获得"..b.."点生命、"..c.."点内力", Violet)
                    end		
		            for j = 0, WAR.PersonNum - 1 do 
			            if WAR.Person[j]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[j]["死亡"] == false then
				            if WAR.Person[j].Time >= 1000 then
				                WAR.Person[j].Time = 980
				            end 
			            end
			        end	
                    WAR.CurID=tmppid
					--[[DrawBox_1(x1 - 3, y, x2 + 3, y + 3, C_ORANGE)
					DrawBox_1(x1 - (x2 - x1) / 2, y, x1 - 3, y + 3, C_RED)
					DrawString(x2 + 10, y - 20, "时序", C_WHITE, CC.FontSMALL)
					lib.FillColor(x1+1, y+1, x1+90, y+3,C_ORANGE)
					lib.FillColor(x1-94, y+1, x1-6, y+3,C_RED)
					--lib.SetClip(x1 - (x2-x1)/2-100, 0, CC.ScreenW, CC.ScreenH/4 + 50)
					surid = lib.SaveSur( x1 - (x2-x1)/2-100, 0, CC.ScreenW, CC.ScreenH/4 + 50)	]]		
		        end

                -----------------------------------奇穴时序效果---------------------------------------				

						
			end
			fuhuo(i)
			local s = WAR.CurID
			WAR.CurID = i
			WarDrawMap(0)
			War_Show_Count(WAR.CurID)
			WAR.CurID = s
		end
        
		if WAR.CD > 0 then 
			WAR.CD = WAR.CD - 1
		end
		
		Cat('天关阵')
		
        if #WAR.ATK['人物table'] > 0 then
            atid = WAR.ATK['人物table'][#WAR.ATK['人物table']]
            local id = WAR.Person[atid]['人物编号']
            table.remove(WAR.ATK['人物table'],#WAR.ATK['人物table'])
            WAR.ATK['人物pd'][id] = nil
            if #WAR.ATK['人物table'] == 0 then 
                WAR.ATK['人物table'] = {}
            end
        end  
		
		--local num = math.ceil(CC.BattleDelay/10)
		--xh = xh + 1
		--if xh == num then 
		Cat('实时特效动画')
		--	xh = 0
		--end
    WarDrawMap(0) 
        
		--DrawString(x2 + 10-410, y - 60-25, "时序", C_WHITE, CC.DefaultFont*0.8)
		--lib.LoadPicture("./data/xt/23.png",0,0,1)	
		--DrawTimeBar_sub(x1, x2, nil, 0)
    DrawTimeBar_sub()
    Cat('实时特效动画2',1)
		ShowScreen()
		lib.Delay(CC.BattleDelay) --黑魅灵蜜汁调整刷新速度
		--lib.Delay(10)
		WAR.SXTJ = WAR.SXTJ + 1
		--无酒不欢：三时序，五时序，六时序，九时序的计数器
		WAR.SSX_Counter = WAR.SSX_Counter + 1
		if WAR.SSX_Counter == 4 then
			WAR.SSX_Counter = 1
		end
		WAR.WSX_Counter = WAR.WSX_Counter + 1
		if WAR.WSX_Counter == 6 then
			WAR.WSX_Counter = 1
		end
		WAR.LSX_Counter = WAR.LSX_Counter + 1
		if WAR.LSX_Counter == 7 then
			WAR.LSX_Counter = 1
		end
		WAR.JSX_Counter = WAR.JSX_Counter + 1
		if WAR.JSX_Counter == 10 then
			WAR.JSX_Counter = 1
		end
		--lib.Delay(10) -- 无酒不欢：减缓集气条速度	
		local keypress = lib.GetKey()
		--木凭：F4直接认输
		if keypress == VK_F4  then 
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] then
					WAR.Person[i]["死亡"] = true
				end
			end
		end
		--集气过程中按空格或回车停止自动
		if (keypress == VK_SPACE or keypress == VK_RETURN) then
			if WAR.AutoFight == 1 then 
				WAR.AutoFight = 0
			end	
		end
		--集气过程中按Z查看属性
		if keypress == VK_Z  then 
			Ckstatus()
		end
    local ed = War_isEnd2() 
    if 0 < ed then
        xunhuan = false
        atid = 0
        WAR.ATK['中断'] = true
    end
		--lib.LoadSur(surid, x1 - ((x2 - x1) / 2)-100, 0)	--无酒不欢：修复杀到-500后集气条小头像刷新问题
	end
    
	::label1::
  
    --local warStatus = War_isEnd()   --战斗是否结束？   0继续，1赢，2输

	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["死亡"] == false then
			WAR.Person[i].TimeAdd = 0
		end
	end
  
    if #WAR.PD['时序出手'] > 0 then 
        for i = 1,#WAR.PD['时序出手'] do 
            local p = WAR.PD['时序出手'][i]
            local id = WAR.Person[p]['人物编号']
            if JY.Person[id]['生命'] > 0 and WAR.Person[p]['死亡'] == false then 
                WAR.CurID = p
                WarDrawMap(0)
                if WAR.AutoFight == 1 or WAR.Person[p]['我方'] == false or WAR.ZDDH == 354 then 
                    War_AutoFight()
                else 
                    Cat('武功')
                end
            end
        end
    end
    
    WAR.PD['时序出手'] = {}
    if atid == -1 then
        atid = 0
        WAR.ATK['中断'] = true
    end
	--WAR.ZYHBP = -1
	--lib.SetClip(0, 0, 0, 0)
	--lib.FreeSur(surid)
    return atid
end

--绘画整体集气条
function DrawTimeBar_sub(x1, x2, y, flag)

	--无酒不欢：绘画部分增加破绽区显示
	if not x2 then
		x2 = CC.ScreenW * 19 / 20 - 2  --X上方位置
	end
	if not y then
		y = CC.ScreenH/10 + 29
	end
	if not x1 then
		x1 = CC.ScreenW * 1 / 2 - 34  --X下方位置
--		lib.LoadPicture("./data/xt/23.png",0,0,1)
		lib.LoadPNG(91, 23 * 2 , 310, 55, 1)
	end
  
	for i = 0, WAR.PersonNum - 1 do
		if not WAR.Person[i]["死亡"] then
			--无酒不欢：修正集气条显示，不会飞过1000
			if WAR.Person[i].Time > 1001 then
				WAR.Person[i].Time = 1001
			end
			local id = WAR.Person[i]["人物编号"]
			local cx = x1 + math.modf(WAR.Person[i].Time*(x2 - x1)/1000)
			local headid = JY.Person[id]["半身像"]
			if headid == nil then
				headid = JY.Person[id]["半身像"]
			end
			local w, h = limitX(CC.ScreenW/25,12,35),limitX(CC.ScreenW/25,12,35)
			local jq_color = C_WHITE
			if JY.Person[id]["中毒程度"] > 99 then
				jq_color = RGB(56, 136, 36)
			elseif JY.Person[id]["中毒程度"] >= 50 then
				jq_color = RGB(120, 208, 88)
			end
			if (WAR.LQZ[id] or 0) >= 100 then
				jq_color = C_RED
			end
			if WAR.Person[i]["我方"] then
				drawname(cx, 1, id, CC.FontSmall)
				lib.LoadPNG(99, headid*2, cx - w / 2, y - h - 4, 1, 0)
				DrawString(cx-17-5, y-10-90-5, string.format("%d",(WAR.JQSDXS[id] or 0)), jq_color, CC.FontSMALL)	--集气速度
				if JY.Person[id]["灼烧程度"] ~= 0 then
					DrawString(cx, y-10-33, string.format("%d",JY.Person[id]["灼烧程度"]), C_ORANGE, CC.FontSMALL)	--灼烧数值
				end
				if JY.Person[id]["封穴程度"] ~= 0 then
					DrawString(cx-21, y-10-33, string.format("%d",JY.Person[id]["封穴程度"]), C_GOLD, CC.FontSMALL)	--封穴数值
				end
			else
				drawname(cx, y+h, id, CC.FontSmall)
				lib.LoadPNG(99, headid*2, cx - w / 2, y + 6-5, 1, 0)
				DrawString(cx-21, y+h-5, string.format("%d",(WAR.JQSDXS[id] or 0)), jq_color, CC.FontSMALL)	--集气速度
				if JY.Person[id]["灼烧程度"] ~= 0 then
					DrawString(cx, y+h-33, string.format("%d",JY.Person[id]["灼烧程度"]), C_ORANGE, CC.FontSMALL)	--灼烧数值
				end
				if JY.Person[id]["封穴程度"] ~= 0 then
					DrawString(cx-21, y+h-33, string.format("%d",JY.Person[id]["封穴程度"]), C_GOLD, CC.FontSMALL)	--封穴数值
				end
			end
		end
	end
	DrawString(x2 + 10-370, y-80-8 , WAR.SXTJ, C_GOLD, CC.DefaultFont*0.9)
    DrawString(x2 + 10-420, y - 60-25, "时序", C_WHITE, CC.DefaultFont*0.8)	
	DrawString(x2 + 10-370, y-40-8 , WAR.MYCHAIN, C_GOLD, CC.DefaultFont*0.9)
    DrawString(x2 + 10-420, y -20-25, "连锁", C_WHITE, CC.DefaultFont*0.8)	
end

--绘画集气条上的名字
function drawname(x, y, id, size)
	local name = JY.Person[id]["姓名"]
	local color = C_WHITE
	--名字颜色随冰封和内伤变化
	if JY.Person[id]["受伤程度"] > JY.Person[id]["冰封程度"] then
		if JY.Person[id]["受伤程度"] > 99 then
			color = RGB(232, 32, 44)
		elseif JY.Person[id]["受伤程度"] > 66 then
			color = RGB(244, 128, 32)
		elseif JY.Person[id]["受伤程度"] > 33 then
			color = RGB(236, 200, 40)
		end
	else
		if JY.Person[id]["冰封程度"] >= 50 then
			color = M_RoyalBlue
		elseif JY.Person[id]["冰封程度"] > 0 then
			color = LightSkyBlue
		end
	end
	x = x - math.modf(size / 2)
	local namelen = string.len(name) / 2
	local zi = {}
	for i = 1, namelen do
		zi[i] = string.sub(name, i * 2 - 1, i * 2)
		DrawString(x-5, y+12-5, zi[i], color, size)
		y = y + size
	end
end


function draw2(str,x, y, color,size,color2)

	x = x - size/2
	local namelen = string.len(str) / 2
	local zi = {}
	for i = 1, namelen do
		zi[i] = string.sub(str, i * 2 - 1, i * 2)
		if color2 ~= nil then
			if i == namelen then 
				color = color2
			end
		end
		DrawString(x, y+size*(i-1)/2, zi[i], color, size)
		y = y + size
	end
end


function draw3(str,x, y, color,size,color2,h)

	x = x - size/2
	local namelen = string.len(str) / 2
	local zi = {}
	h = h or size
	for i = 1, namelen do
		zi[i] = string.sub(str, i * 2 - 1, i * 2)
		if color2 ~= nil then
			if i == namelen then 
				color = color2
			end
		end
		DrawString(x, y, zi[i], color, size)
		y = y + h
	end
end

--判断两人之间的距离
function RealJL(id1, id2, len)
	if not len then
		len = 1
	end
	local x1, y1 = WAR.Person[id1]["坐标X"], WAR.Person[id1]["坐标Y"]
	local x2, y2 = WAR.Person[id2]["坐标X"], WAR.Person[id2]["坐标Y"]
	local s = math.abs(x1 - x2) + math.abs(y1 - y2)
	if len == nil then
		return s
	end
	if s <= len then
		return true
	else
		return false
	end
end

function DWJL(id1,id2)
	local x1, y1 = WAR.Person[id1]["坐标X"], WAR.Person[id1]["坐标Y"]
	local x2, y2 = WAR.Person[id2]["坐标X"], WAR.Person[id2]["坐标Y"]
	local s = math.abs(x1 - x2) + math.abs(y1 - y2)
	return s
end

function RealJL2(x1,y1, id2, len)
	if not len then
		len = 1
	end
	local x2, y2 = WAR.Person[id2]["坐标X"], WAR.Person[id2]["坐标Y"]
	local s = math.abs(x1 - x2) + math.abs(y1 - y2)
	if len == nil then
		return s
	end
	if s <= len then
		return true
	else
		return false
	end
end
--计算武功范围
function refw(wugong, level)
  --无酒不欢：参数说明
  --m1为移动范围斜向延伸：
	--0：延伸为直线距离-1，1：延伸至直线距离，2：延伸为0 3：移动范围固定为自身周围8格
  --m2为移动范围直线延伸；
	--数字即等于延伸距离
  --a1为攻击范围类型：
	--0：点攻，1：十字，2：菱形，3：面攻，5：十字，6：井字，7：田字，8：d字，9：e字，10：直线，11：正三角，12：倒三角，13：横线
  --a2为攻击范围长度距离：
	--0：点攻，大于0时，距离 = a2
  --a3为攻击范围宽度(偏移1格)距离：
	--0：点攻，大于0时，距离 = a3  
  --a4为攻击范围宽度(偏移2格)距离：
	--0：点攻，大于0时，距离 = a4
  --a5为攻击范围宽度(偏移3格)距离：
	--0：点攻，大于0时，距离 = a5
	local m1, m2, a1, a2, a3, a4, a5, a6  = nil, nil, nil, nil, nil, nil, nil ,nil
	if JY.Wugong[wugong]["攻击范围"] == -1 then
		return JY.Wugong[wugong]["加内力1"], JY.Wugong[wugong]["加内力2"], JY.Wugong[wugong]["未知1"], JY.Wugong[wugong]["未知2"], JY.Wugong[wugong]["未知3"], JY.Wugong[wugong]["未知4"], JY.Wugong[wugong]["未知5"]
	end
	--0：点
	--1：线
	--2：十字
	--3：面
	local fightscope = JY.Wugong[wugong]["攻击范围"]
	local kfkind = JY.Wugong[wugong]["武功类型"]
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	--王语嫣妙法无形
	local MiaofaWX = 0
  local mx = 0
	--六脉神剑算剑法的范围
	if wugong == 49 then
		kfkind = 3
	end
	if wugong == 66 then
		kfkind = 4
	end
	if wugong == 313 then
		fightscope = 1
		kfkind = 3
	end	
	if wugong == 67 and WAR.DJHB1[1] ~= nil then --胡刀改苗剑范围
		kfkind = 3
		fightscope = 1 
		MiaofaWX = MiaofaWX + 1
	end
	if wugong == 44 and WAR.DJHB2[1] ~= nil then --苗剑改胡刀范围
		kfkind = 4
		fightscope = 2
	end	
		
	--玄女剑法算奇门的范围
	if wugong == 161 then
		kfkind = 5
	end

	--逍遥神剑算刀法的范围
	if wugong == 168 then
		kfkind = 4
	end
	--阴风刀算剑法的范围
	if wugong == 174 then
		kfkind = 3
	end
	if wugong == 47 then
		kfkind = 2
	end	
	
	if wugong == 21 and match_ID(pid,523) then
		fightscope = 3
		MiaofaWX = MiaofaWX + 6
	end	
	if match_ID(pid,514) and wugong == 21 then
		MiaofaWX = MiaofaWX + 6
	end	

  --王语嫣妙法无形
  local tf76 = hastf(WAR.CurID,76,1)
  if tf76 ~= nil then
      for j = 1,#tf76 do
          MiaofaWX = MiaofaWX + 1
      end
  end

	if mx > 2 then
	    mx  = 2
	end	
	--天罗地网也增加攻击范围
	if Curr_QG(pid,148) and (JY.Person[pid]["武器"] == 335 or WGZH(pid,36,46))  == false then
	    mx = MiaofaWX + 1
		MiaofaWX = mx
	end
	--诸行无常
	if match_ID(pid, 9985)  then
		MiaofaWX = MiaofaWX + 1
	end	
	--方证用拳法范围+1
	if match_ID(pid, 149) and kfkind == 1 then
		MiaofaWX = MiaofaWX + 1
	end
	--萧半和混元功范围+1
	if match_ID(pid, 189) and wugong == 90 then
		MiaofaWX = MiaofaWX + 1
	end	
    --萧秋水 剑气飞纵 用武功范围+1
	if match_ID(pid, 652) and JY.Base["天书数量"] > 5then
		MiaofaWX = MiaofaWX + 1
	end
    --莫大剑法范围+1
	if match_ID(pid, 20) and kfkind == 3 then
		MiaofaWX = MiaofaWX + 1
	end	
	if wugong == 313 then
		if Curr_NG(pid,105) then
			MiaofaWX = MiaofaWX + 1
		end
		if match_ID(pid,27) or match_ID(pid,777) then
			MiaofaWX = MiaofaWX + 1
		end	
	end	
	--套装效果范围+2
	if PDTZ(pid,JY.Person[pid]["武器"]) then
		local n = JY.Person[pid]["武器"]
		if Setmeal[n][4] == 23 then
			local m = 2
			mx = MiaofaWX + m
			MiaofaWX = mx
		end
	end
	--双剑合壁范围增加范围
	if (wugong == 39 or wugong == 42 or wugong == 139)  and WGZH(pid,39,42) then 
	    MiaofaWX = MiaofaWX + 2
	end	
    --一刀流
	if MPTX(pid,11) and wugong == 151 then
		MiaofaWX = MiaofaWX + 6
		if match_ID(pid,741) or match_ID(pid,742) then
			MiaofaWX = MiaofaWX + 10
		end
	end 	
	--葵花点穴手
	if wugong == 226 and PersonKF(pid,105) then 
		MiaofaWX = MiaofaWX + 2
	end
	--纯阳神门
	if (wugong == 236 and PersonKF(pid,99)) or (kfkind == 3 and MPTX(pid,4,3) and PersonKF(pid,99) and PersonKF(pid,236)) then
		MiaofaWX = MiaofaWX + 4
	end
	--北斗空明
	if wugong == 39 and WGZH(pid,15,39) then 
		MiaofaWX = MiaofaWX + 4
	end 	
	--青城松风
	if wugong == 27 and MPTX(pid,28,3) then
		MiaofaWX = MiaofaWX + 4
	end 
	--大理六脉
	if wugong == 49 and (MPTX(pid,15) or match_ID(pid,499)) then 
		MiaofaWX = MiaofaWX + 4
	end 	
	--太玄青莲
	if wugong == 167 and (Curr_NG(pid,102) or match_ID(pid,636)) then
		MiaofaWX = MiaofaWX + 3
	end 	
	--天机宫
	if (wugong == 58 or wugong == 192) and MPTX(pid,30) then
		MiaofaWX = MiaofaWX + 2
	end 
	--花涧派
	if MPTX(pid,21) then
		local m = 2
		mx = MiaofaWX + m
		if mx > 4 then
			mx  = 4
		end	
		MiaofaWX = mx
	end	
	--竹风雨滴
	if match_ID(pid,520) then
		MiaofaWX = MiaofaWX + 8
	end 		
	--初生牛犊
	if match_ID(pid,9743) then
		MiaofaWX = MiaofaWX + 1
	end  	
	--苗人凤，剑法范围随御剑系数增加
	if match_ID(pid, 3) and kfkind == 3 then
		MiaofaWX = MiaofaWX + math.modf(TrueYJ(pid)/200)
	end
	--闪电貂和妙手空空范围不增加
	if wugong == 113 or wugong == 116 then
		MiaofaWX = 0
	end
	if WAR.PD['大小幽明'][pid] ~= nil then
		MiaofaWX = -3
	end	
	if yongte(wugong) and QIQX(pid,'虎狼势') > 0 then
		MiaofaWX = MiaofaWX + math.modf(QIQX(pid,'虎狼势'))
	end	
	--点
	if fightscope == 0 then
		if level > 10 then
			m1 = 1
			m2 = JY.Wugong[wugong]["移动范围" .. 10]
			a1 = 1
			a2 = 3 + MiaofaWX
			a3 = 3 + MiaofaWX
		else
			m1 = 0
			m2 = JY.Wugong[wugong]["移动范围" .. level]
			a1 = 1
			a2 = math.modf(level / 5) + MiaofaWX
			a3 = math.modf(level / 8) + MiaofaWX
		end
		if (wugong == 18 and Curr_NG(pid,251)) or (wugong == 18 and match_ID(pid,57)) then    --奇门弹指
		    m1 = 0
		    a1 = 2
		    a2 = 0
		    m2 = 20
		    a3 = 0
		end 	
		if WAR.TMMS[pid] == 1 or WAR.QJBMS[pid] == 1 or WAR.QJBMS[pid] == 2 then --唐门模式1
		    m1 = 0
		    a1 = 2
		    a2 = 0
		    m2 = 25
		    a3 = 0
		end	
		if match_ID(pid,514) and wugong == 21 then
			m1 = 1
			m2 = m2+MiaofaWX
			a2 = 3
			a3 = 3
		end	
	--线
	elseif fightscope == 1 then
		--拳指
		if kfkind == 1 or kfkind == 2 then
			a1 = 12
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] - 1 + MiaofaWX
			end

		--剑
		elseif kfkind == 3 then
			a1 = 10
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] + MiaofaWX
				a3 = a2 - 1
				a4 = a3 - 1
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] + MiaofaWX
			end
			if level > 7 then
				a3 = a2 - 1
			end
		--刀
		elseif kfkind == 4 then
			a1 = 11
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] - 1 + MiaofaWX
			end
		--奇
		elseif kfkind == 5 then
			m1 = 2
			if level > 10 then
				m2 = JY.Wugong[wugong]["移动范围" .. 10] - 1
				a1 = 7
				--田字斗转时不会增加范围
				if WAR.DZXY == 0 then
					a2 = 1 + math.modf(level / 3) + MiaofaWX
				else
					a2 = 1 + math.modf(level / 3)
				end
				a3 = a2
			else
				m2 = JY.Wugong[wugong]["移动范围" .. level] - 1
				a1 = 1
				a2 = 1 + math.modf(level / 3) + MiaofaWX
			end
		else
			a1 = 11
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] - 1 + MiaofaWX
			end
		end
	--十字
	elseif fightscope == 2 then
		m1 = 0
		m2 = 0
		--刀
		if kfkind == 4 then
			if level > 10 then
				a1 = 6
				a2 = JY.Wugong[wugong]["移动范围" .. 10] + MiaofaWX
			else
				a1 = 8
				a2 = JY.Wugong[wugong]["移动范围" .. level] + MiaofaWX
			end
		--到极的非刀
		elseif level > 10 then
			--拳指
			if kfkind == 1 or kfkind == 2 then
				a1 = 5
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
				a3 = a2 - 3
			--剑
			elseif kfkind == 3 then
				a1 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
				a3 = a2
			else
				a1 = 2
				a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2) + MiaofaWX
			end
		--不到极的非刀
		else
			  a1 = 1
			  a2 = JY.Wugong[wugong]["移动范围" .. level] + MiaofaWX
			  a3 = 0
		end
	--面
	elseif fightscope == 3 then
		m1 = 0
		a1 = 3
		if level > 10 then
			m2 = JY.Wugong[wugong]["移动范围" .. 10] + 1
			a2 = JY.Wugong[wugong]["杀伤范围" .. 10] + MiaofaWX
			a3 = a2
		else
			m2 = JY.Wugong[wugong]["移动范围" .. level]
			a2 = JY.Wugong[wugong]["杀伤范围" .. level] + MiaofaWX
		end
		if WAR.TMMS[pid] == 1 or WAR.QJBMS[pid] == 1 or WAR.QJBMS[pid] == 2 then --唐门模式1
			a2 = 0
			m2 = 25
		end
	end
    --悲天佛怜 
  if (match_ID(pid,9983) or JinGangBR(pid)) and wugong == 189 then
      a1 = 0
      m1 = 0
      m2 = 8
  end
	--擒龙手
	if wugong == 187 then
    a1 = 0
    m1 = 0
    m2 = 7
	end
	--太极神功范围随着蓄力变化
	--斗转时范围不变化
	if Curr_NG(pid,171) and (wugong == 16 or wugong == 46 ) and WAR.PD["太极蓄力"][pid] ~= nil and WAR.PD["太极蓄力"][pid] > 0  and WAR.DZXY == 0 then
		if WAR.PD["太极蓄力"][pid] > 600 then
			m1 = 0
			m2 = 4
			a1 = 3
			a2 = 4 + MiaofaWX
			a3 = a2
		elseif WAR.PD["太极蓄力"][pid] > 500 then
			m1 = 0
			m2 = 4
			a1 = 3
			a2 = 3 + MiaofaWX
			a3 = a2			
		elseif WAR.PD["太极蓄力"][pid] > 300 then
			a2 = a2 + 2
			a3 = a3 + 2
		else
			a2 = a2 + 1
			a3 = a3 + 1
		end
	end

	
	--青冥剑随御剑系数增加
	if (JY.Person[pid]["武器"] == 335 or WGZH(pid,36,46)) and kfkind == 3  then
        mx =  1
		a2 = a2 + mx
		a3 = a2
	end	
	
	--玉箫剑法，配合桃花绝技范围增加
	if wugong == 38 and level == 11 and WGZH(pid,12,18) then
		a2 = 8 + MiaofaWX
		a3 = a2 - 1
		a4 = a3 - 1
	end
	--落英神剑掌，配合桃花绝技可移动
	if wugong == 12 and level == 11 and WGZH(pid,12,18) then
		m1 = 0
		m2 = 6
	end
	if wugong == 47 then
		m1 = 0
		m2 = 6
	end
	--玄铁可移动 标记修改
	if wugong == 45 and (actor(pid,3) or match_ID(pid, 592) or match_ID(pid, 58) or match_ID(pid,530)) then
		m1 = 0
		m2 = 5
	end
	--武当派太极剑法可移动
	if MPTX(pid,4) and wugong == 46 then
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 1.5)
		m1 = 0
		m2 = 8
	end 
	--天机宫
	if wugong == 179 and MPTX(pid,4) then
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2)
		m1 = 0
		m2 = 8
	end 
	--九阴降龙
	if wugong == 26 and QFZH(pid,26,107) then
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2) + 2
		m1 = 0
		m2 = 9
	end 
	--狗头
	if wugong == 80 and match_ID(pid,764) then
		m1 = 0
		m2 = 8
	end	
	--九爪火焰刀
	if wugong == 11 and WGZH(pid,11,66) then 
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2) 
		m1 = 0
		m2 = 8
	end 
	--沧溟可移动
	if wugong == 153 then
	    local cc = math.modf(JY.Person[pid]["实战"]/200)
	    MiaofaWX = MiaofaWX + cc*2
		a2 = 8 + MiaofaWX
		a3 = a2 - 1
		a4 = a3 - 1
		m1 = 0
		m2 = 6+MiaofaWX
	end
	--火焰刀九爪
	if wugong == 66 and WGZH(pid,11,66) then
		local cc = math.modf(JY.Person[pid]["实战"]/200)
	    MiaofaWX = MiaofaWX + cc*2
		a2 = 6 + MiaofaWX
		a3 = a2 - 1
		a4 = a3 - 1
		m1 = 0
		m2 = 6+MiaofaWX
	end
	--妙笔一阳
	if wugong == 142 and (WGZH(pid,17,142) or match_ID(pid,747)) then
		m1 = 0
		m2 = 6
	end	
	--白蟒鞭法
	if wugong == 164 and (Curr_NG(pid,107) or match_ID(pid,637)) then
		m1 = 0
		m2 = 7
	end	
	--大伏魔九阴
	if wugong == 342 and (Curr_NG(pid,107) or match_ID(pid,637)) then
		m1 = 0
		m2 = 9
	end	
	--进阶万花，范围+1
	if wugong == 30 and WYJJ(pid) then
		a2 = a2 + 1
		a3 = a2
	end
	--辟邪剑法手动选择范围
	--[[if wugong == 48 and level == 11 and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		m1, m2, a1, a2, a3, a4 , a5, a6 = BiXieZhaoShi(pid,MiaofaWX)
	end

	--九阳神功手动选择招式 
	if wugong == 106 and level == 11  and isteam(pid)  and WAR.DZXY == 0 and WAR.AutoFight == 0 then
		m1, m2, a1, a2, a3, a4 , a5, a6 = JIUYANGZhaoShi(pid,MiaofaWX)
	end	
	--太玄神功手动选择系数
	if wugong == 102  and level == 11 and JXPD(pid, 38, 1) and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		a6 = TaiXuanZhaoShi()
	end
	if wugong == 49   and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		a6 = LIUMAIZS()
	end	]]
	if wugong == 377   and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		a6 = WUYUEZS()
	end	
	return m1, m2, a1, a2, a3, a4, a5 , a6

end

function refw1(wugong, level,id)
  --无酒不欢：参数说明
  --m1为移动范围斜向延伸：
	--0：延伸为直线距离-1，1：延伸至直线距离，2：延伸为0 3：移动范围固定为自身周围8格
  --m2为移动范围直线延伸；
	--数字即等于延伸距离
  --a1为攻击范围类型：
	--0：点攻，1：十字，2：菱形，3：面攻，5：十字，6：井字，7：田字，8：d字，9：e字，10：直线，11：正三角，12：倒三角，13：横线
  --a2为攻击范围长度距离：
	--0：点攻，大于0时，距离 = a2
  --a3为攻击范围宽度(偏移1格)距离：
	--0：点攻，大于0时，距离 = a3  
  --a4为攻击范围宽度(偏移2格)距离：
	--0：点攻，大于0时，距离 = a4
  --a5为攻击范围宽度(偏移3格)距离：
	--0：点攻，大于0时，距离 = a5
	local m1, m2, a1, a2, a3, a4, a5, a6  = nil, nil, nil, nil, nil, nil, nil ,nil
	if JY.Wugong[wugong]["攻击范围"] == -1 then
		return JY.Wugong[wugong]["加内力1"], JY.Wugong[wugong]["加内力2"], JY.Wugong[wugong]["未知1"], JY.Wugong[wugong]["未知2"], JY.Wugong[wugong]["未知3"], JY.Wugong[wugong]["未知4"], JY.Wugong[wugong]["未知5"]
	end
	--0：点
	--1：线
	--2：十字
	--3：面
	local fightscope = JY.Wugong[wugong]["攻击范围"]
	local kfkind = JY.Wugong[wugong]["武功类型"]
	local pid 
	if id == nil then 
		pid = WAR.Person[WAR.CurID]["人物编号"]
	else 
		pid = id
	end
	
	--六脉神剑算剑法的范围
	if wugong == 49 then
		kfkind = 3
	end
	if wugong == 66 then
		kfkind = 4
	end	
	if wugong == 313 then
		fightscope = 1
		kfkind = 3
	end	
		
	--玄女剑法算奇门的范围
	if wugong == 161 then
		kfkind = 5
	end

	--逍遥神剑算刀法的范围
	if wugong == 168 then
		kfkind = 4
	end
	--阴风刀算剑法的范围
	if wugong == 174 then
		kfkind = 3
	end
	if wugong == 47 then
		kfkind = 2
	end	
	--王语嫣妙法无形
	local MiaofaWX = 0
  local mx = 0

    --王语嫣妙法无形
    -- local tf76 = hastf(WAR.CurID,76,1)
    -- if tf76 ~= nil then
        -- for j = 1,#tf76 do
            -- MiaofaWX = MiaofaWX + 1
        -- end
    -- end

	if mx > 2 then
	    mx  = 2
	end	
	--天罗地网也增加攻击范围
	if Curr_QG(pid,148) and (JY.Person[pid]["武器"] == 335 or WGZH(pid,36,46)) == false then
	    mx = MiaofaWX + 1
		MiaofaWX = mx
	end
	--诸行无常
	if match_ID(pid, 9985)  then
		MiaofaWX = MiaofaWX + 1
	end	
	--方证用拳法范围+1
	if match_ID(pid, 149) and kfkind == 1 then
		MiaofaWX = MiaofaWX + 1
	end
	--萧半和混元功范围+1
	if match_ID(pid, 189) and wugong == 90 then
		MiaofaWX = MiaofaWX + 1
	end	
    --萧秋水 剑气飞纵 用武功范围+1
	if match_ID(pid, 652) and JY.Base["天书数量"] > 5 then
		MiaofaWX = MiaofaWX + 1
	end
    --莫大剑法范围+1
	if match_ID(pid, 20) and kfkind == 3 then
		MiaofaWX = MiaofaWX + 1
	end	
	if wugong == 313 then
		if Curr_NG(pid,105) then
			MiaofaWX = MiaofaWX + 1
		end
		if match_ID(pid,27) or match_ID(pid,777) then
			MiaofaWX = MiaofaWX + 1
		end	
	end	
	--套装效果范围+2
	if PDTZ(pid,JY.Person[pid]["武器"]) then
		local n = JY.Person[pid]["武器"]
		if Setmeal[n][4] == 23 then
			local m = 2
			mx = MiaofaWX + m
			MiaofaWX = mx
		end
	end
	if JY.Status == GAME_WMAP and wugong == 153 and WAR.YSCM2 == 1  then
		MiaofaWX = MiaofaWX + 2
	end	
	--双剑合壁范围增加范围
	if (wugong == 39 or wugong == 42 or wugong == 139) and WGZH(pid,39,42) then 
	    MiaofaWX = MiaofaWX + 2
	end	
    --一刀流
	if MPTX(pid,11) and wugong == 151 then
		MiaofaWX = MiaofaWX + 6
		if match_ID(pid,741) or match_ID(pid,742) then
			MiaofaWX = MiaofaWX + 10
		end
	end 		
	--葵花点穴手
	if wugong == 226 and PersonKF(pid,105) then 
		MiaofaWX = MiaofaWX + 2
	end

	--北斗空明
	if wugong == 39 and WGZH(pid,15,39) then 
		MiaofaWX = MiaofaWX + 4
	end 	
		
	--青城松风
	if wugong == 27 and MPTX(pid,28,3) then
		MiaofaWX = MiaofaWX + 4
	end 	
	
	--大理六脉
	if wugong == 49 and (MPTX(pid,15) or match_ID(pid,499)) then 
		MiaofaWX = MiaofaWX + 4
	end 	
	
	--太玄青莲
	if wugong == 167 and (Curr_NG(pid,102) or match_ID(pid,636)) then
		MiaofaWX = MiaofaWX + 3
	end 	
	
	--天机宫
	if (wugong == 58 or wugong == 192) and MPTX(pid,30) then
		MiaofaWX = MiaofaWX + 2
	end 	
	
	--纯阳神门
	if (wugong == 236 and PersonKF(pid,99)) or (kfkind == 3 and MPTX(pid,4,3) and PersonKF(pid,99) and PersonKF(pid,236)) then
		MiaofaWX = MiaofaWX + 4
	end 	
	--苗人凤，剑法范围随御剑系数增加
	if match_ID(pid, 3) and kfkind == 3 then
		MiaofaWX = MiaofaWX + math.modf(TrueYJ(pid)/200)
	end
	--闪电貂和妙手空空范围不增加
	if wugong == 113 or wugong == 116 then
		MiaofaWX = 0
	end
	
	if wugong == 315  then
		fightscope = 3
	end
	--闪电貂和妙手空空范围不增加
	-- if wugong == 281 or wugong == 282 then
		-- fightscope = 3
		-- a1 = 3
	-- end
	MiaofaWX = 0--属性面板只显示武功基础的攻击范围与攻击样貌，不显示加成。
	--点
	if fightscope == 0 then
		if level > 10 then
			m1 = 1
			m2 = JY.Wugong[wugong]["移动范围" .. 10]
			a1 = 1
			a2 = 3 + MiaofaWX
			a3 = 3 + MiaofaWX
		else
			m1 = 0
			m2 = JY.Wugong[wugong]["移动范围" .. level]
			a1 = 1
			a2 = math.modf(level / 5) + MiaofaWX
			a3 = math.modf(level / 8) + MiaofaWX
		end
		if (wugong == 18 and Curr_NG(pid,251)) or (wugong == 18 and match_ID(pid,57)) then    --奇门弹指
		    m1 = 0
		    a1 = 2
		    a2 = 0
		    m2 = JY.Wugong[wugong]["移动范围" .. 10] + MiaofaWX
		    a3 = 0
		end 	
		-- if WAR.TMMS[pid] == 1 or WAR.QJBMS[pid] == 1 or WAR.QJBMS[pid] == 2 then --唐门模式1
		    -- m1 = 0
		    -- a1 = 2
		    -- a2 = 0
		    -- m2 = 25
		    -- a3 = 0
		-- end	
	--线
	elseif fightscope == 1 then
		--拳指
		if kfkind == 1 or kfkind == 2 then
			a1 = 12
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] - 1 + MiaofaWX
			end
		--剑
		elseif kfkind == 3 then
			a1 = 10
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] + MiaofaWX
				a3 = a2 - 1
				a4 = a3 - 1
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] + MiaofaWX
			end
			if level > 7 then
				a3 = a2 - 1
			end
		--刀
		elseif kfkind == 4 then
			a1 = 11
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] - 1 + MiaofaWX
			end
		--奇
		elseif kfkind == 5 then
			m1 = 2
			if level > 10 then
				m2 = JY.Wugong[wugong]["移动范围" .. 10] - 1
				a1 = 7
				--田字斗转时不会增加范围
				if WAR.DZXY == 0 then
					a2 = 1 + math.modf(level / 3) + MiaofaWX
				else
					a2 = 1 + math.modf(level / 3)
				end
				a3 = a2
			else
				m2 = JY.Wugong[wugong]["移动范围" .. level] - 1
				a1 = 1
				a2 = 1 + math.modf(level / 3) + MiaofaWX
			end
		else
			a1 = 11
			if level > 10 then
				m1 = 3
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
			else
				m1 = 2
				m2 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. level] - 1 + MiaofaWX
			end
		end
	--十字
	elseif fightscope == 2 then
		m1 = 0
		m2 = 0
		--刀
		if kfkind == 4 then
			if level > 10 then
				a1 = 6
				a2 = JY.Wugong[wugong]["移动范围" .. 10] + MiaofaWX
			else
				a1 = 8
				a2 = JY.Wugong[wugong]["移动范围" .. level] + MiaofaWX
			end
		--到极的非刀
		elseif level > 10 then
			--拳指
			if kfkind == 1 or kfkind == 2 then
				a1 = 5
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
				a3 = a2 - 3
			--剑
			elseif kfkind == 3 then
				a1 = 1
				a2 = JY.Wugong[wugong]["移动范围" .. 10] - 1 + MiaofaWX
				a3 = a2
			else
				a1 = 2
				a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2) + MiaofaWX
			end
		--不到极的非刀
		else
			  a1 = 1
			  a2 = JY.Wugong[wugong]["移动范围" .. level] + MiaofaWX
			  a3 = 0
		end
	--面
	elseif fightscope == 3 then
		m1 = 0
		a1 = 3
		if level > 10 then
			m2 = JY.Wugong[wugong]["移动范围" .. 10] + 1
			a2 = JY.Wugong[wugong]["杀伤范围" .. 10] + MiaofaWX
			a3 = a2
		else
			m2 = JY.Wugong[wugong]["移动范围" .. level]
			a2 = JY.Wugong[wugong]["杀伤范围" .. level] + MiaofaWX
		end
		-- if (WAR.TMMS[pid] ~= nil and WAR.TMMS[pid] == 1) or WAR.QJBMS[pid] == 1 or WAR.QJBMS[pid] == 2 then --唐门模式1
			-- a2 = 0
			-- m2 = 25
		-- end
	end
    --悲天佛怜 
    if (match_ID(pid,9983) or JinGangBR(pid)) and wugong == 189 then
        a1 = 0
        m1 = 0
        m2 = 8
    end
	--擒龙手
	if wugong == 187 then
        a1 = 0
        m1 = 0
        m2 = 7
	end
	--太极神功范围随着蓄力变化
	--斗转时范围不变化
	if Curr_NG(pid,171) and (wugong == 16 or wugong == 46) and JY.Status == GAME_WMAP and WAR.PD["太极蓄力"][pid] ~= nil and WAR.PD["太极蓄力"][pid] > 0 and WAR.DZXY == 0 then
		if WAR.PD["太极蓄力"][pid] > 600 then
			m1 = 0
			m2 = 4
			a1 = 3
			a2 = 4 + MiaofaWX
			a3 = a2
		elseif WAR.PD["太极蓄力"][pid] > 500 then
			m1 = 0
			m2 = 4
			a1 = 3
			a2 = 3 + MiaofaWX
			a3 = a2			
		elseif WAR.PD["太极蓄力"][pid] > 300 then
			a2 = a2 + 2
			a3 = a3 + 2
		else
			a2 = a2 + 1
			a3 = a3 + 1
		end
	end

	
	--青冥剑\太柔随御剑系数增加
	if (JY.Person[pid]["武器"] == 335 or WGZH(pid,36,46)) and kfkind == 3  then
        mx =  1
		a2 = a2 + mx
		a3 = a2
	end	
	
	--玉箫剑法，配合桃花绝技范围增加
	if wugong == 38 and level == 11 and WGZH(pid,12,18) then
		a2 = 8 + MiaofaWX
		a3 = a2 - 1
		a4 = a3 - 1
	end
	--落英神剑掌，配合桃花绝技可移动
	if wugong == 12 and level == 11 and WGZH(pid,12,18) then
		m1 = 0
		m2 = 6
	end
	if wugong == 47 then
		m1 = 0
		m2 = 6
	end
	--玄铁可移动 标记修改
	if wugong == 45 and (actor(pid,3) or match_ID(pid, 592) or match_ID(pid, 58) or match_ID(pid,530)) then
		m1 = 0
		m2 = 5
	end
	--武当派太极剑法可移动
	if MPTX(pid,4) and wugong == 46 then
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 1.5)
		m1 = 0
		m2 = 8
	end 
	--天机宫
	if wugong == 179 and MPTX(pid,4) then
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2)
		m1 = 0
		m2 = 8
	end 
	--九阴降龙
	if wugong == 26 and QFZH(pid,26,107)  then
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2) + 2
		m1 = 0
		m2 = 9
	end 
	--狗头
	if wugong == 80 and match_ID(pid,764) then
		m1 = 0
		m2 = 8
	end	
	--九爪火焰刀
	--[[if wugong == 11 and WGZH(pid,11,66) then 
		a1 = 2
		a2 = 1 + math.modf(JY.Wugong[wugong]["移动范围" .. 10] / 2)
		m1 = 0
		m2 = 8
	end 
	--沧溟可移动
	if wugong == 153 then
	    local cc = math.modf(JY.Person[pid]["实战"]/200)
	    MiaofaWX = MiaofaWX + cc*2
		a2 = 8 + MiaofaWX
		a3 = a2 - 1
		a4 = a3 - 1
		m1 = 0
		m2 = 6+MiaofaWX
	end
	--火焰刀九爪
	if wugong == 66 and WGZH(pid,11,66) then
		local cc = math.modf(JY.Person[pid]["实战"]/200)
	    MiaofaWX = MiaofaWX + cc*2
		a2 = 6 + MiaofaWX
		a3 = a2 - 1
		a4 = a3 - 1
		m1 = 0
		m2 = 6+MiaofaWX
	end]]
	--妙笔一阳
	if wugong == 142 and (WGZH(pid,17,142) or match_ID(pid,747)) then
		m1 = 0
		m2 = 6
	end	
	--白蟒鞭法
	if wugong == 164 and (Curr_NG(pid,107) or match_ID(pid,637)) then
		m1 = 0
		m2 = 7
	end	
	--大伏魔九阴
	if wugong == 342 and (Curr_NG(pid,107) or match_ID(pid,637)) then
		m1 = 0
		m2 = 9
	end	
	--进阶万花，范围+1
	if wugong == 30 and WYJJ(pid) then
		a2 = a2 + 2
		a3 = a2
	end
	--辟邪剑法手动选择范围
	-- if wugong == 48 and level == 11 and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		-- m1, m2, a1, a2, a3, a4 , a5, a6 = BiXieZhaoShi(pid,MiaofaWX)
	-- end

	
	-- --九阳神功手动选择招式 
	-- if wugong == 106 and level == 11  and isteam(pid)  and WAR.DZXY == 0 and WAR.AutoFight == 0 then
		-- m1, m2, a1, a2, a3, a4 , a5, a6 = JIUYANGZhaoShi(pid,MiaofaWX)
	-- end	
	-- --太玄神功手动选择系数
	-- if wugong == 102  and level == 11 and JXPD(pid, 38, 1) and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		-- a6 = TaiXuanZhaoShi()
	-- end
	-- if wugong == 49   and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		-- a6 = LIUMAIZS()
	-- end	
	-- if wugong == 377   and isteam(pid) and WAR.AutoFight == 0 and WAR.DZXY == 0 then
		-- a6 = WUYUEZS()
	-- end	
	return m1, m2, a1, a2, a3, a4, a5 , a6

end

--用CC表判断人物是否为队友，不管在不在队
function isteam(p)
	if p == 0 then
		return true
	end
	if CC.PersonExit[p] ~= nil then
		return true
	end
	return false
end

--判断人物是否有某种武功
function PersonKF(p, kf)
	--主攻体存在默认存在武功
	--if JY.Person[p]["主运内功"] == kf then
	--	return true
    --end	
    
	--主攻体存在默认存在武功
	--if JY.Person[p]["主运轻功"] == kf then
	--	return true
    --end	
    
	--战场直接判定武功
	if JY.Status == GAME_WMAP then 
		if WAR.WG[p] ~= nil then 
			if WAR.WG[p][kf] ~= nil and WAR.WG[p][kf] >= 0 then
				return true
			end
		end
		if match_ID(p,577) and yongnei(kf) then
			if kf ~= 281 and kf ~= 282 and kf > 0 then
				return true
			end
		end	
		if MPTX(p,24,3) and JY.Person[p]['天赋轻功'] == kf then
			return true
		end
		if (match_ID(p,517) or (WAR.ZDDH == 456 and match_ID(p,457))) and yongqin(kf) then
			return true
		end
		if match_ID(p,517) then
			if kf == 367 then
				return true
			end
		end	
		if p == 0 then
			if kf == JY.Wugong[354]['灼烧系数'] or kf == JY.Wugong[354]['冰封系数'] then
				return true
			end
		end		  
		if p == 0 then
			if kf == JY.Wugong[381]['灼烧系数'] or kf == JY.Wugong[381]['冰封系数'] then
				return true
			end
		end		  
		if MPTX(p,14,6) then
			if kf == 89 or kf == 216 or kf == 259 or kf == 263 or kf == 264 then
				return true
			end
		end
		if match_ID(p,592) or match_ID(p,604) or match_ID(p,636) then
			if kf == 184 then
				return true
			end
		end	
		if match_ID(p,456) then
			if kf == 203 then
				return true
			end
		end	
	else
	--其他场景正常循环		
		for i = 1, JY.Base["武功数量"] do
			--if (match_ID(p, 19) or match_ID(p, 20) or match_ID(p, 21) or match_ID(p, 22) or match_ID(p, 23)) and kf==175 then
				--return true
			--else
			if JY.Person[p]["武功" .. i] <= 0 then
				return false;
			elseif JY.Person[p]["武功" .. i] == kf or JY.Wugong[354]['灼烧系数'] == kf or JY.Wugong[354]['冰封系数'] == kf then
				return true
			elseif JY.Person[p]["武功" .. i] == kf or JY.Wugong[381]['灼烧系数'] == kf or JY.Wugong[381]['冰封系数'] == kf then
				return true	
			end
		end
	end
end

--武功等级判定
function KfLv(p, kf)
	--战场直接判定武功等级
	if JY.Status == GAME_WMAP then 
		if WAR.WG[p] ~= nil then 
			if WAR.WG[p][kf] ~= nil then
				return WAR.WG[p][kf]
			end
		end
	else
	--其他场景正常循环	
		for i = 1, JY.Base["武功数量"] do
			if JY.Person[p]["武功" .. i] <= 0 then
				return 0;
			elseif JY.Person[p]["武功" .. i] == kf then
				return JY.Person[p]["武功等级" .. i]
			end
		end
	end	
	return 0
end

--判断人物是否有某种武功，并且等级为极
function PersonKFJ(p, kf)
	--战场直接判定武功等级
	if JY.Status == GAME_WMAP then 
		if WAR.WG[p] ~= nil then 
			if WAR.WG[p][kf] == 999 then
				return true
			end
		end
	else
        for i = 1, JY.Base["武功数量"] do
            if JY.Person[p]["武功" .. i] <= 0 then
                return false;
            elseif JY.Person[p]["武功" .. i] == kf and JY.Person[p]["武功等级" .. i] == 999 then
                return true
            end
        end
    end
	return false
end

--判断触发机率
function myrandom(p, id)
	--生命越低，几率越高，最多10
	p = p + limitX(math.modf((JY.Person[id]["生命最大值"] - JY.Person[id]["生命"]) / 180), 0, 25)
	
	--体力越高，几率越高，最多10
	p = p + math.modf(JY.Person[id]["体力"] / 10)
	
	--林朝英+10
	if match_ID(id, 605) or match_ID(id, 9804) then
		p = p + 10
	end
	
	--奇门五转+5
	if PersonKF(id, 317) then
		p = p + 5
	end

	--逆运走火+30
	if WAR.PD["走火状态"][id] == 1 or match_ID(id, 98) then
		p = p + 30
	end

	--每25点实战+1，上限10
	local jp = math.modf(JY.Person[id]["实战"] / 50)
	if jp > 10 then
		jp = 10
	end
	p = p + jp

	--每1000内力+1，最多10
	p = p + limitX(math.modf(JY.Person[id]["内力"] / 1000), 0, 10)
	
	--每120点攻击力+1，最多10
	p = p + limitX(math.modf(JY.Person[id]["攻击力"] / 120), 0, 10)
	
	--每120点防御力+1，最多10
	p = p + limitX(math.modf(JY.Person[id]["防御力"] / 120), 0, 10)
	
	--每120点轻功+1，最多10
	p = p + limitX(math.modf(JY.Person[id]["轻功"] / 120), 0, 10)
	
	--基础判定次数为一次
	local times = 1
	--如果是我方
	if isteam(id) then
		--我方天书增加几率
		p = p + JY.Base["天书数量"]
		--50%几率二次判定
		if math.random(2) == 2 then
			times = 2
		end
		--石破天必定二次判定
		if match_ID(id, 38) and times == 1  then
			times = 2
		end
		--单通 必定二次判定
		if id ==0 and times == 1 and JY.Base["单通"] > 0 then
	    times = 2
		end		
	--NPC默认为三次判定且几率+50
	else
		times = 3
		p = p + 50
	end
	if JY.Status == GAME_WMAP then
		if WAR.PD["神经蛇毒"][id] ~= nil then
			p = 0
		end
		if NGQH(id,104) and WAR.L_NYZH[id] ~= nil then
			p = p + 40;
		end
		if WAR.PD["走火入魔"][id] ~= nil then
			p = p - 60
		end
		if WAR.PD['机率下降'][id] ~= nil then
			p = p - 20
		end
	end	

	for i = 1, times do
		local bd = math.random(120)
		if bd <= p then
			return true
		end
	end
	return false
end

--自动选择敌人
function War_AutoSelectEnemy()
	local enemyid = War_AutoSelectEnemy_near()
	WAR.Person[WAR.CurID]["自动选择对手"] = enemyid
	return enemyid
end

--选择最近敌人
function War_AutoSelectEnemy_near()
	War_CalMoveStep(WAR.CurID, 100, 1)			--标记每个位置的步数
	local maxDest = math.huge
	local nearid = -1
	for i = 0, WAR.PersonNum - 1 do		--查找最近步数的敌人
		if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[i]["我方"] and WAR.Person[i]["死亡"] == false then
			local step = GetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 3)
			--遮影
			if GetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2) == i then
				if step < maxDest then
					nearid = i
					maxDest = step
				end
			end
		end
	end
	return nearid
end

--战斗中加入新人物
function NewWARPersonZJ(id, dw, x, y, life, fx)
	WAR.Person[WAR.PersonNum]["人物编号"] = id
	WAR.Person[WAR.PersonNum]["我方"] = dw
	WAR.Person[WAR.PersonNum]["坐标X"] = x
	WAR.Person[WAR.PersonNum]["坐标Y"] = y
	WAR.Person[WAR.PersonNum]["死亡"] = life
	WAR.Person[WAR.PersonNum]["人方向"] = fx
	WAR.Person[WAR.PersonNum]["贴图"] = WarCalPersonPic(WAR.PersonNum)
	--lib.PicLoadFile(string.format(CC.FightPicFile[1], JY.Person[id]["头像代号"]), string.format(CC.FightPicFile[2], JY.Person[id]["头像代号"]), 4 + WAR.PersonNum)
	SetWarMap(x, y, 2, WAR.PersonNum)
	SetWarMap(x, y, 5, WAR.Person[WAR.PersonNum]["贴图"])
	SetWarMap(x, y, 10, JY.Person[WAR.Person[WAR.PersonNum]["人物编号"]]['头像代号'])
  savetf(WAR.PersonNum)
	savewg(WAR.PersonNum)
	--战意
	zhanyi(id,200)
	--唐门模式
	if MPTX(id,9) then 
		WAR.TMMS[id] = 2
	end
	WAR.PersonNum = WAR.PersonNum + 1
end

--无酒不欢：判定合击用的函数
function between(num_1, num_2, num_3, flag)
    if not flag then
		flag = 0
    end
    if num_3 < num_2 then
		num_2, num_3 = num_3, num_2
    end
    if flag == 0 and num_2 < num_1 and num_1 < num_3 then
		return true
    elseif flag == 1 and num_2 <= num_1 and num_1 <= num_3 then
		return true
    else
		return false
    end
end
--无酒不欢：独孤求败反击的伤害判定
function First_strike_dam_DG(pid, eid)
	local dam;
	local QZ_dif = TrueQZ(pid) * 0.9 - TrueQZ(eid) * 0.2
	--[[local p_wc = JY.Person[pid]["武学常识"] / 2
	local e_wc = JY.Person[eid]["武学常识"] / 2--]]
	if QZ_dif < 0 then
		QZ_dif = 0
	end
	--[[if p_wc < e_wc then
		p_wc = e_wc
	end--]]
	dam = getnl(pid) / 100 + getnl(eid) / 100
	dam = math.modf(dam + QZ_dif)
	if dam > 5000 then
		dam = 5000
	end
	return dam
end

--伤害公式中的内力，当前内力和最大内力都参与计算
function getnl(id)
	return (JY.Person[id]["内力"] * 2 + JY.Person[id]["内力最大值"]) / 3
end

--无酒不欢：血量翻倍函数
function Health_in_Battle()
	for i = 0, WAR.PersonNum - 1 do
		local pid = WAR.Person[i]["人物编号"]

		--加一个变量避免重复翻倍
		--if JY.Person[pid]["血量翻倍"] > 1 and WAR.HP_Bonus_Count[pid] == nil then
			--JY.Person[pid]["生命最大值"] = JY.Person[pid]["生命最大值"] * JY.Person[pid]["血量翻倍"]
			--JY.Person[pid]["生命"] = JY.Person[pid]["生命"] * JY.Person[pid]["血量翻倍"]
			--WAR.HP_Bonus_Count[pid] = 1
		--end
        
		--无酒不欢：非我方自动运功
		if inteam(pid) == false or WAR.Person[i]["我方"] == false then
			if JY.Person[pid]["主运内功"] == 0 and JY.Person[pid]["畅想分阶"] > 5 then
				JY.Person[pid]["主运内功"] = 219 
			end
			if JY.Person[pid]["主运内功"] == 0 and JY.Person[pid]["畅想分阶"] <= 5 and JY.Person[pid]["畅想分阶"] > 2 then
				local clone_choice = CC.NG1[math.random(#CC.NG1)]
				JY.Person[pid]["主运内功"] = clone_choice
			end
			if JY.Person[pid]["主运内功"] == 0 and JY.Person[pid]["天赋内功"] == 0 and JY.Person[pid]["畅想分阶"] < 3 then
				local clone_choice = CC.NG2[math.random(#CC.NG2)]
				JY.Person[pid]["天赋内功"] = clone_choice
				JY.Person[pid]["主运内功"] = clone_choice
			end						
			if JY.Person[pid]["主运内功"] == 0 and JY.Person[pid]["天赋内功"] > 0 then
				JY.Person[pid]["主运内功"] = JY.Person[pid]["天赋内功"]
			end
			--非我方自动运内功
			if JY.Person[pid]["天赋轻功"] > 0 and JY.Person[pid]["主运轻功"] == 0 then
			    JY.Person[pid]["主运轻功"] = JY.Person[pid]["天赋轻功"]
			end
			if JY.Person[pid]["主运轻功"] == 0 and JY.Person[pid]["畅想分阶"] < 5 and JY.Person[pid]["畅想分阶"] > 2 then
				local clone_choice = CC.QG1[math.random(#CC.QG1)]
				JY.Person[pid]["主运轻功"] = clone_choice 
			end	
			if JY.Person[pid]["主运轻功"] == 0 and JY.Person[pid]["畅想分阶"] < 3 then
				local clone_choice = CC.QG2[math.random(#CC.QG2)]
				JY.Person[pid]["主运轻功"] = clone_choice 
			end	
		end
		if WAR.ZDDH == 348 and WAR.Person[i]["我方"] then
			if JY.Person[pid]["主运内功"] == 0 and JY.Person[pid]["天赋内功"] > 0 then
				JY.Person[pid]["主运内功"] = JY.Person[pid]["天赋内功"]
			end
			if JY.Person[pid]["主运轻功"] == 0 and JY.Person[pid]["天赋轻功"] > 0 then
			JY.Person[pid]["主运轻功"] = JY.Person[pid]["天赋轻功"]
			end
		end
	end
end

--无酒不欢：血量还原函数
function Health_in_Battle_Reset()
	--for i = 0, WAR.PersonNum - 1 do
	--	local pid = WAR.Person[i]["人物编号"]
	--	if JY.Person[pid]["血量翻倍"] > 1 and WAR.HP_Bonus_Count[pid] ~= nil then
	--		JY.Person[pid]["生命最大值"] = JY.Person[pid]["生命最大值"] / JY.Person[pid]["血量翻倍"]
	--		WAR.HP_Bonus_Count[pid] = nil
	--	end
	--end
end

--战斗中查看敌方简易信息
function MapWatch()
	local x = WAR.Person[WAR.CurID]["坐标X"];
	local y = WAR.Person[WAR.CurID]["坐标Y"];
	WAR.ShowHead = 0
	War_CalMoveStep(WAR.CurID,128,1);
	Cat('实时特效动画')
	WarDrawMap(1,x,y);
	Cat('实时特效动画2')
	ShowScreen();
	lib.Delay(CC.BattleDelay)
	x,y=War_SelectMove()
	if x == nil then
		return
	end
	WAR.ShowHead = 1
end


--战斗休息
function War_RestMenu()
	if WAR.CurID and WAR.CurID >= 0  then
		local pid = WAR.Person[WAR.CurID]["人物编号"]
		--走火不能休息
		if WAR.PD["走火状态"][pid] == 1 or match_ID(pid, 98) then
			return 1
	    end	
		local vv = math.modf(JY.Person[pid]["体力"] / 100 - JY.Person[pid]["受伤程度"] / 100 - JY.Person[pid]["中毒程度"] / 150) * 3
		if WAR.Person[WAR.CurID]["移动步数"] > 0 then
			vv = vv + 2
		end
		if isteam(pid) then
			vv = vv + math.random(1,2)
		else
			vv = vv + 5
		end
		vv = (vv) / 120
		local v = 3 + Rnd(3)
		WAR.Person[WAR.CurID]["体力点数"] = (WAR.Person[WAR.CurID]["体力点数"] or 0) + AddPersonAttrib(pid,"体力",v)
		WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-v*3)
		--ztd(WAR.CurID,"体力点数", v)
		--ztd(WAR.CurID,"中毒点数", -v*3)
        if JY.Person[pid]["内力"] < 100 then
            local hn = 3 + math.modf(JY.Person[pid]["内力最大值"] * (vv))
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",hn)
			--ztd(WAR.CurID,"内力点数", hn)
        else
			if not isteam(pid) then
				v = 5 + math.modf(JY.Person[pid]["生命最大值"]/ 3 * (vv))
			else
			    v = 3 + math.modf(JY.Person[pid]["生命最大值"] /4 * (vv))
			end
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",v)
			--ztd(WAR.CurID,"生命点数", v)
			v = 3 + math.modf(JY.Person[pid]["内力最大值"] * (vv))
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",v)
			--ztd(WAR.CurID,"内力点数", v)
		end
		--龙象神足
	    if NGQH(pid,103) and JY.Person[pid]["生命"] > 0 then
			local a = JY.Person[pid]["生命最大值"]
			local b = JY.Person[pid]["生命"]
			local c = math.modf((a - b) * 0.2)
			local d = math.modf(b * 0.2)
			local e = JY.Person[pid]["生命增长"]
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",c)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",d)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-e)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-e)
			--ztd(WAR.CurID,"生命点数", c)
			--ztd(WAR.CurID,"内力点数", d)
			--ztd(WAR.CurID,"内伤点数", -e)
			--ztd(WAR.CurID,"中毒点数", -e)
			CurIDTXDH(WAR.CurID, 395, 1, "龙象之力・调息")	
		end	
		--九阴太极
        if NGQH(pid,107) and JY.Person[pid]["生命"] > 0 then
			local a = JY.Person[pid]["内力最大值"]
			local b = JY.Person[pid]["内力"]
			local c = math.modf((a - b) * 0.2 + 100)
			local d = math.modf(b * 0.2 + 100)
			local e = (10  - JY.Person[pid]['畅想分阶'])*2
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",c)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",d)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-e)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-e)
			--ztd(WAR.CurID,"生命点数", c)
			--ztd(WAR.CurID,"内力点数", d)
			--ztd(WAR.CurID,"内伤点数", -e)
			--ztd(WAR.CurID,"中毒点数", -e)
			if math.random(10) > 7 then
				Cat('清除中级异常',WAR.CurID)
			end	
			CurIDTXDH(WAR.CurID, 401, 1, "天之道・损有余而补不足")	
		end	
		--九阳怒涛
		if NGQH(pid,106) and JY.Person[pid]["生命"] > 0 then
			local a = nil
			local b = nil
			local c = nil
			a = 999
			b = 999
			c = 9 + math.modf(JY.Person[pid]["受伤程度"]/9)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-c)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", b)
			--ztd(WAR.CurID,"内伤点数", -c)
			--ztd(WAR.CurID,"中毒点数", -c)
			CurIDTXDH(WAR.CurID, 143, 1, "九阳神功・抱一含元")	
		end	
		--葵花神功math.random(100，250)
		if Curr_NG(pid, 105) --[[or JXPD(pid,19,1)]] then
			local a = nil
			local b = nil
			local c = nil
			a = 999
			b = 999
			c = 9 + math.modf(JY.Person[pid]["受伤程度"]/9)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-c)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", b)
			--ztd(WAR.CurID,"内伤点数", -c)
			--ztd(WAR.CurID,"中毒点数", -c)
			CurIDTXDH(WAR.CurID, 128, 1, "天人化生・万物滋长")	
		end
		--圣火乾坤
		if NGQH(pid,93) and JY.Person[pid]["生命"] > 0 then
			local a = nil
			local b = nil
			local c = nil
			a = 200
			b = 600
			c = 5 + math.modf(JY.Person[pid]["灼烧程度"] / 10)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-c)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", b)
			--ztd(WAR.CurID,"内伤点数", -c)
			--ztd(WAR.CurID,"中毒点数", -c)
			CurIDTXDH(WAR.CurID,225, 1, "熊熊烈火")	
		end
		--鲸息九阴
		if NGQH(pid,180) and JY.Person[pid]["生命"] > 0 then
			local a = nil
			local b = nil
			local c = nil
			a = 999
			b = 999
			c = 9 + math.modf(JY.Person[pid]["受伤程度"]/8)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-c)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", b)
			--ztd(WAR.CurID,"内伤点数", -c)
			--ztd(WAR.CurID,"中毒点数", -c)
			CurIDTXDH(WAR.CurID, 228, 1, "天道之法・损强补弱")	
		end	
		--神照龟息
		if NGQH(pid,94) and JY.Person[pid]["生命"] > 0 then
			local a = nil
			local b = nil
			local c = nil
			a = 200
			b = 600
			c = 50
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"冰封程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"灼烧程度",-c)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", b)
			--ztd(WAR.CurID,"内伤点数", -c)
			--ztd(WAR.CurID,"中毒点数", -c)
			CurIDTXDH(WAR.CurID,89, 1, "法天自然・妙悟自在")	
		end
		--逍遥派长春
	    if MPTX(pid,7,3) and (Curr_NG(pid,183) or match_ID(pid,116) or match_ID(pid,117) or match_ID(pid,118) 
		or match_ID(pid,634) or XiaoYaoYF(pid)) and JY.Person[pid]["生命"] > 0 then
			local a = nil
			local b = nil
			local c = nil
			local mpdj = MPDJ(pid)
			a = JY.Person[pid]["内力"]
			b = math.modf((JY.Person[pid]["内力最大值"] - JY.Person[pid]["内力"])*mpdj/10)
			c = 5 + math.modf(JY.Person[pid]["内力"]/800)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["体力点数"] = (WAR.Person[WAR.CurID]["体力点数"] or 0) + AddPersonAttrib(pid,"体力",c)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-c)
			--ztd(WAR.CurID,"生命点数",a)
			--ztd(WAR.CurID,"内力点数",b)
			--ztd(WAR.CurID,"体力点数",c)
			--ztd(WAR.CurID,WAR.BFXS,-c)
			--ztd(WAR.CurID,WAR.ZSXS,-c)
			--ztd(WAR.CurID,WAR.LXXS,-c)
			--ztd(WAR.CurID,WAR.FXXS,-c)
			--ztd(WAR.CurID,"内伤点数",-c)
			--ztd(WAR.CurID,"中毒点数",-c)
			if match_ID(pid,116) then
				CurIDTXDH(WAR.CurID, 150, 1, "百川归海")
			elseif match_ID(pid,117) then
			    CurIDTXDH(WAR.CurID, 146, 1, "八荒归元")
			elseif match_ID(pid,118) then
			    CurIDTXDH(WAR.CurID, 132, 1, "无相幻化")
			else
			    CurIDTXDH(WAR.CurID,150, 1, "天长地久・不老长春")
			end
		end
		--花涧派2级
		if MPTX(pid,21,2) and JY.Person[pid]["生命"] > 0  then	
			local a = nil
			local b = nil
			local c = nil
			a = 1000 * 0.2
			b = a * 2
			c = 5 + math.modf(JY.Person[pid]["受伤程度"] / 10)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-c)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", b)
			--ztd(WAR.CurID,"内伤点数", -c)
			--ztd(WAR.CurID,"中毒点数", -c)
			CurIDTXDH(WAR.CurID, 254, 1, "金锁重门荒苑静・绮窗愁对秋空")	
		end 
		--云梦涧
		if MPTX(pid,26,2) and JY.Person[pid]["生命"] > 0  then	
			local a = nil
			local b = nil
			local c = nil
			a = 1000 * 0.2
			b = a * 2
			c = 5 + math.modf(JY.Person[pid]["受伤程度"] / 10)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",b)
			WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["中毒点数"] or 0) + AddPersonAttrib(pid,"中毒程度",-c)
			WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid,"受伤程度",-c)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", b)
			--ztd(WAR.CurID,"内伤点数", -c)
			--ztd(WAR.CurID,"中毒点数", -c)
			CurIDTXDH(WAR.CurID, 113, 1, "嫣然一笑")	
		end
		
		--崆峒3级
		if MPTX(pid,18,3) then 
			local a = TrueQZ(pid)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",a)
			--ztd(WAR.CurID,"生命点数", a)
			--ztd(WAR.CurID,"内力点数", a)
			CurIDTXDH(WAR.CurID, 19, 1, "豹隐龟藏")	
		end 		
		
		--青城派
		if MPTX(pid,28,3) and Curr_NG(pid,379) then
			local a = 3 + math.modf(JY.Person[pid]["内力"] / 8)
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",a)
			CurIDTXDH(WAR.CurID, 66, 1, "玄门罡气")	
		end 	
		
		War_Show_Count(WAR.CurID);		--显示当前控制人的点数
        --龟息功
        if PersonKF(pid, 227) then 
			Cls()
			CurIDTXDH(WAR.CurID, 85,1,"调息・防御", LimeGreen);
			if WAR.Defup[pid] == nil then
				War_DefupMenu()
			end	
        end
		if match_ID(pid, 721) then 
			Cls()
			CurIDTXDH(WAR.CurID, 85,1,"蓄力・防御", LimeGreen);
			if WAR.Actup[pid] == nil then
				War_ActupMenu()
			end	
			if WAR.Defup[pid] == nil then
				War_DefupMenu()
			end
        end
		--阿凡提休息带蓄力+防御
		if match_ID(pid, 606) then
			Cls()
			CurIDTXDH(WAR.CurID, 85,1,"运筹帷幄・决胜千里", LimeGreen);
			if WAR.Actup[pid] == nil then
				War_ActupMenu()
			end	
			if WAR.Defup[pid] == nil then
				War_DefupMenu()
			end
		end	
		--杨冰羽
		if match_ID(pid, 514) then
			Cls()
			CurIDTXDH(WAR.CurID, 85,1,"蓄势待发・不可收拾", LimeGreen);
			if WAR.Actup[pid] == nil then
				War_ActupMenu()
			end	
			if WAR.Defup[pid] == nil then
				War_DefupMenu()
			end
		end
        --神照龟息
		if NGQH(pid,94) then
			Cls()
			CurIDTXDH(WAR.CurID, 85,1,"蓄势待发・运筹帷幄", LimeGreen);
			if WAR.Actup[pid] == nil then
				War_ActupMenu()
			end	
			if WAR.Defup[pid] == nil then
				War_DefupMenu()
			end
		end	
		--擒龙罗汉
		if NGQH(pid,204)  then
			Cls()
			if JY.Person[pid]["生命最大值"] / 2 < JY.Person[pid]["生命"] then
				if WAR.Actup[pid] == nil then
					War_ActupMenu()
					CurIDTXDH(WAR.CurID, 85,1,"擒龙真气・青龙", LimeGreen);
				end
			else
				if WAR.Defup[pid] == nil then
					War_DefupMenu()
					CurIDTXDH(WAR.CurID, 85,1,"擒龙真气・玄武", LimeGreen);
				end
			end
		end	
		--八荒北冥
		if NGQH(pid,101) and math.random(100) > 75 then
			CurIDTXDH(WAR.CurID, 85,1,"八荒六合・防御", LimeGreen);
			if WAR.Defup[pid] == nil then
				War_DefupMenu()
			end
		end	
		--般若金刚
		if QFZH(pid,189,91) then
			WAR.PD["金刚护盾"][pid] = limitX((WAR.PD["金刚护盾"][pid] or 0) + 300,0,2500)
			WAR.PD['般若休息'][pid] = 2
			CurIDTXDH(WAR.CurID, 154, 1,"生死虚妄・诸法无体", Dark_Gold);
		    lib.Delay(CC.BattleDelay)
		end
		--胡刀
		if PersonKF(pid,67) and (Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350) or match_ID(pid,633) or JXPD(pid,1,1)) then
			WAR.PD['天生牙'][pid] = 1
			CurIDTXDH(WAR.CurID, 85,1,"胡刀三变・天生牙", M_DeepSkyBlue);
			lib.Delay(CC.BattleDelay)
		end
		--长生组合
		if (NGQH(pid,203) or ((match_ID(pid,505) or match_ID(pid,578)) and Curr_NG(pid,203))) and JY.Person[pid]["生命"] > 0  then
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",300)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",800)
			WAR.Person[WAR.CurID]["体力点数"] = (WAR.Person[WAR.CurID]["体力点数"] or 0) + AddPersonAttrib(pid,"体力",15)
			--ztd(WAR.CurID,'生命点数',300)
			--ztd(WAR.CurID,'内力点数',800)
			--ztd(WAR.CurID,'体力点数',15)
			WAR.PD['天香续命'][pid] = (WAR.PD['天香续命'][pid] or 0)+25
			WAR.PD['五宝花蜜酒'][pid] = (WAR.PD['五宝花蜜酒'][pid] or 0)+10
			if JLSD(10,35,pid) then
				if WAR.PD["回气"][pid] == nil then
					WAR.PD["回气"][pid] = 300
				end
			end
			if math.random(10) > 8 and JY.Person[pid]['生命'] < math.modf(psx(pid,'生命最大值')*0.15) then
				WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",psx(pid,'生命最大值'))
				--ztd(WAR.CurID,'生命点数',psx(pid,'生命最大值'))
			end
			CurIDTXDH(WAR.CurID, 104, 1, "长生・天人・复")
		end	
		return 1
	end
end

--无酒不欢：等待指令
function War_Wait()
	local id = WAR.Person[WAR.CurID]["人物编号"]
	if JY.Person[id]['生命'] <= 0 then
		return 1
	end	
	WAR.Wait[id] = 1
	Cls()
  	CurIDTXDH(WAR.CurID, 72, 1, "伺机待发", LightGreen, 15)
	--穆人清等待时蓄力
	if match_ID(id, 185) then
		WAR.Actup[id] = 2
	end
	--般若易筋经
	if QFZH(id,189,91) then
		local a = math.modf((JY.Person[id]["生命最大值"] - JY.Person[id]["生命"])*0.4)
		local b = math.modf((JY.Person[id]["内力最大值"] - JY.Person[id]["内力"])*0.4)
		ztd(WAR.CurID, "生命点数", a);
		ztd(WAR.CurID, "内力点数", b);
		WAR.PD['般若等待'][id] = 2
		CurIDTXDH(WAR.CurID, 133, 1,"十八种观・令诸法空", Dark_Gold);
		lib.Delay(CC.BattleDelay)
	end
  	return 1
end

--集中指令
function War_Focus()
	local id = WAR.Person[WAR.CurID]["人物编号"]
	if JY.Person[id]['生命'] <= 0 then
		return 20
	end	
	WAR.Focus[id] = 2
	Cls()
  	CurIDTXDH(WAR.CurID, 151, 1, "心念合一", C_GOLD)
	--三渡集中时蓄力
	if match_ID(id, 597) or match_ID(id, 598) or match_ID(id, 599) then
		WAR.Actup[id] = 2
	end
	if QFZH(id,189,144) then
		WAR.PD['般若集中'][id] = 1
		CurIDTXDH(WAR.CurID, 130, 1,"境智俱寂・心虑安然", Dark_Gold);
		lib.Delay(CC.BattleDelay)
	end
  	return 20
end

--无酒不欢：撤退
function War_Retreat()
	local id = WAR.Person[WAR.CurID]["人物编号"]
	local r = JYMsgBox(JY.Person[id]["姓名"], "确定要我撤退吗？", {"否","是"}, 2, JY.Person[id]["半身像"])
	if r == 2 then
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] then
			   WAR.Person[i]["死亡"] = true
			end		
		end 
		return 1;
	end
end

--无酒不欢：常态血条显示
function HP_Display_When_Idle()
    local x0 = WAR.Person[WAR.CurID]["坐标X"];
    local y0 = WAR.Person[WAR.CurID]["坐标Y"];
	for k = 0, WAR.PersonNum - 1 do
		local tmppid = WAR.Person[k]["人物编号"]
		if WAR.Person[k]["死亡"] == false then
			local dx = WAR.Person[k]["坐标X"] - x0
			local dy = WAR.Person[k]["坐标Y"] - y0

			local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
			local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
	 
			local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)
					ry = ry - hb - CC.YScale*7
					
			local pid = WAR.Person[k]["人物编号"]

			local Color = RGB(238,44, 44)
			--local Color1 = RGB(30, 144, 255)
			
			local HP_MAX = JY.Person[pid]["生命最大值"]
            local MP_MAX = JY.Person[pid]["内力最大值"]
			local PH_MAX = 100		
			local Current_HP = limitX(JY.Person[pid]["生命"],0,HP_MAX)
			local Current_MP = limitX(JY.Person[pid]["内力"],0,MP_MAX)
			local Current_PH = limitX(JY.Person[pid]["体力"],0,PH_MAX)	
			--友军NPC显示为绿色血条
			if WAR.Person[k]["我方"] == true then
				Color = RGB(0, 238, 0)
			end
			
			lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/9, rx+CC.XScale*1.4, ry-CC.YScale*30/17,C_GRAY22)	--背景
			if HP_MAX > 0 then
				lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/9, rx-CC.XScale*1.4+(Current_HP/HP_MAX)*(2.8*CC.XScale), ry-CC.YScale*30/17, Color)  --生命
			end
			DrawBox3(rx-CC.XScale*1.4, ry-CC.YScale*20/9, rx+CC.XScale*1.4, ry-CC.YScale*30/17, C_BLACK)

			lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/11+0.5, rx+CC.XScale*1.4, ry-CC.YScale*30/21,C_GRAY22)	--背景			
			if MP_MAX > 0 then
				lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/11+0.5, rx-CC.XScale*1.4+(Current_MP/MP_MAX)*(2.8*CC.XScale), ry-CC.YScale*30/21, C_BLUE)  --内力
			end
			DrawBox3(rx-CC.XScale*1.4, ry-CC.YScale*20/11+0.5, rx+CC.XScale*1.4, ry-CC.YScale*30/21, C_BLACK)			

			lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/13+1, rx+CC.XScale*1.4, ry-CC.YScale*60/54+1,C_GRAY22)	--背景			
			lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/13+1, rx-CC.XScale*1.4+(Current_PH/PH_MAX)*(2.8*CC.XScale), ry-CC.YScale*60/54+1, S_Yellow)  --内力
			DrawBox3(rx-CC.XScale*1.4, ry-CC.YScale*20/13+1, rx+CC.XScale*1.4, ry-CC.YScale*60/54+1, C_BLACK)
		end
	end
end

--无酒不欢：挨打掉血显示
function HP_Display_When_Hit(ssxx)
    local x0 = WAR.Person[WAR.CurID]["坐标X"];
    local y0 = WAR.Person[WAR.CurID]["坐标Y"];
	--掉血渐变显示			
	ssxx = ssxx - 4
	for k = 0, WAR.PersonNum - 1 do
		local tmppid = WAR.Person[k]["人物编号"]
		--血量有变化才显示
		if WAR.Person[k]["死亡"] == false and WAR.Person[k]["生命点数"] ~= nil and WAR.Person[k]["生命点数"] ~= 0 then
			local dx = WAR.Person[k]["坐标X"] - x0
			local dy = WAR.Person[k]["坐标Y"] - y0

			local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
			local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
	 
			local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)
					ry = ry - hb - CC.YScale*7
					
			local pid = WAR.Person[k]["人物编号"]

			local Color = RGB(238,44, 44)
			--local Color1 = RGB(30, 144, 255)
			--计算掉血
			local HP_MAX = JY.Person[pid]["生命最大值"]
			
			local HP_AfterHit = JY.Person[pid]["生命"]
			
			if HP_AfterHit < 0 then
				HP_AfterHit = 0
			end
				
			local HP_BeforeHit = WAR.Person[k]["Life_Before_Hit"] or 0

			local HP_Loss = HP_BeforeHit - HP_AfterHit
			
			local Gradual_HP_Loss;
			local Gradual_HP_Display;
			
			Gradual_HP_Loss = HP_Loss*(ssxx/11)
			Gradual_HP_Display = HP_BeforeHit - Gradual_HP_Loss			


			
			
			--友军NPC显示为绿色血条
			if WAR.Person[k]["我方"] == true then
				Color = RGB(0, 238, 0)
			end
			
			lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/9, rx+CC.XScale*1.4, ry-CC.YScale*15/9,grey21)	--背景
			
			lib.FillColor(rx-CC.XScale*1.4, ry-CC.YScale*20/9, rx-CC.XScale*1.4+(HP_AfterHit/HP_MAX)*(2.8*CC.XScale), ry-CC.YScale*15/9, Color)  --生命
			
			--掉血显示
			if HP_Loss > 0 then
				lib.FillColor(rx-CC.XScale*1.4+(HP_AfterHit/HP_MAX)*(2.8*CC.XScale), ry-CC.YScale*20/9, rx-CC.XScale*1.4+(Gradual_HP_Display/HP_MAX)*(2.8*CC.XScale), ry-CC.YScale*15/9, Color)  --失去生命
			end
		
			DrawBox3(rx-CC.XScale*1.4, ry-CC.YScale*20/9, rx+CC.XScale*1.4, ry-CC.YScale*15/9, C_BLACK)
		end
	end
end

--苍天泰坦：被战场显血函数调用
function DrawBox3(x1, y1, x2, y2, color)
	lib.DrawRect(x1, y1, x2, y1, color)
	lib.DrawRect(x1, y2, x2, y2, color)
	lib.DrawRect(x1, y1, x1, y2, color)
	lib.DrawRect(x2, y1, x2, y2, color)
	--无酒不欢：生命和内力的分隔线
	--lib.DrawRect(x1, y1+(y2-y1)/2+1, x2, y1+(y2-y1)/2+1, color)
end

--显示出招动画的选择出战人物界面
function WarSelectTeam_Enhance()
	if JY.Restart == 1 then
		do return end
	end
	local T_Num=GetTeamNum();
	--无酒不欢：高度以3为单位增加
	local h_factor = 3
	if T_Num > 12 then
		h_factor = 15
	elseif T_Num > 9 then
		h_factor = 12
	elseif T_Num > 6 then
		h_factor = 9
	elseif T_Num > 3 then
		h_factor = 6
	end
	local p={};
	local pic_w=CC.ScreenW/6--160;
	local pic_h=CC.ScreenW/6*3/4--128;
	local width=pic_w*3+CC.DefaultFont*5+4*8;
	local height=math.max((h_factor+2)*(CC.DefaultFont+4)+4*3,pic_h*math.modf((h_factor+1)/4))+CC.FontBig;
	local x=(CC.ScreenW-width)/2;
	local y=(CC.ScreenH-height-4*2)/2+CC.FontBig/2+8;
	local x0=x+4*4;
	local x1=x0+4;
	local y1=(CC.ScreenH-((T_Num+2)*(CC.DefaultFont+4)+4*3))/2;
	local x2=x0+4*3+CC.DefaultFont*5+pic_w/2
	local y2=y;
	local ts=(width-(CC.FontBig*4+16)*2)/3;
	local tx1=x+ts+4;
	local tx2=tx1+(CC.FontBig*4+16)+ts;
	local ty=y+pic_h+30+CC.DefaultFont;
	
	local pnum = {}
    if WAR.ZDDH == 354 then 
        local x = 20
        local y = 17
        for i = 1,#CC.HSLJ do
            local id = CC.HSLJ[i]
            WAR.Person[WAR.PersonNum]["人物编号"] = id
            WAR.Person[WAR.PersonNum]["我方"] = true
            WAR.Person[WAR.PersonNum]["坐标X"] = x
            WAR.Person[WAR.PersonNum]["坐标Y"] = y
            WAR.Person[WAR.PersonNum]["死亡"] = false
            WAR.Person[WAR.PersonNum]["人方向"] = 3
            WAR.PersonNum = WAR.PersonNum + 1
            x = x + 1
            if x == 34 then 
                x = 20
                y = y + 2
            end
        end
        return
	end
	
	if JY.Base["单通"] == -1 then
		--手动清除人物
		for i = 1, 6 do
			WAR.Data["手动选择参战人" .. i] = -1
		end
		for i = 1, 6 do
			if WAR.Data["自动选择参战人" .. i] >= 0 then 
				local mid = WAR.Data["自动选择参战人" .. i]
				if mid == JY.Base["畅想"] then
					mid = 0
				end
				if inteam(mid) then 
					WAR.Data["手动选择参战人" .. i] = mid
					WAR.Data["自动选择参战人" .. i] = -1
				else 
					WAR.MCRS = WAR.MCRS + 1
				end
			end
		end
	elseif JY.Base["单通"] > 0 then
		WAR.Data["自动选择参战人1"] = 0
		for i = 2, 6 do
			WAR.Data["自动选择参战人" .. i] = -1
		end
	end
	if WAR.ZDDH == 373 and psx(3,'品德') == 100 then
		for i = 1, 6 do
			WAR.Data["手动选择参战人" .. i] = -1
		end
		WAR.Data["自动选择参战人1"] = 0
		WAR.Data["自动选择参战人2"] = 633
	end
	if WAR.ZDDH == 437 and psx(457,'品德') == 100 then
		for i = 1, 6 do
			WAR.Data["手动选择参战人" .. i] = -1
		end
		WAR.Data["自动选择参战人1"] = 0
		WAR.Data["自动选择参战人2"] = 531
		--WAR.Data["自动选择参战人3"] = 523
	end
	if WAR.ZDDH == 437 and psx(517,'品德') == 100 then
		for i = 1, 6 do
			WAR.Data["手动选择参战人" .. i] = -1
		end
		WAR.Data["自动选择参战人1"] = 0
		WAR.Data["自动选择参战人2"] = 514
		WAR.Data["自动选择参战人3"] = 528
		WAR.Data["自动选择参战人4"] = 744
		WAR.Data["自动选择参战人5"] = 745
	end	
	if WAR.ZDDH == 439 and psx(517,'品德') == 0 then
		for i = 1, 6 do
			WAR.Data["手动选择参战人" .. i] = -1
		end
		WAR.Data["自动选择参战人1"] = 0
		WAR.Data["自动选择参战人2"] = 525
		WAR.Data["自动选择参战人3"] = 526
	end	
	if WAR.ZDDH == 439 and psx(517,'品德') == 100 then
		for i = 1, 6 do
			WAR.Data["手动选择参战人" .. i] = -1
		end
		WAR.Data["自动选择参战人1"] = 0
		WAR.Data["自动选择参战人2"] = 514
		WAR.Data["自动选择参战人3"] = 528
		WAR.Data["自动选择参战人4"] = 524
		WAR.Data["自动选择参战人5"] = 759
		WAR.Data["自动选择参战人6"] = 743
  end
	--剪裁的背景图
	--没有自动选择出战人时才显示
	--单挑陈达海战特殊判定
	if WAR.Data["自动选择参战人1"] == -1 and not (WAR.ZDDH == 92 and GetS(87,31,33,5) == 1) then
		Clipped_BgImg((CC.ScreenW - width) / 2,(CC.ScreenH - height) / 2,(CC.ScreenW + width) / 2,(CC.ScreenH + height) / 2,1000)
		Clipped_BgImg((CC.ScreenW - (CC.DefaultFont+4)*4) / 2,(CC.ScreenH - height) / 2-(CC.DefaultFont+4)/2,
		(CC.ScreenW + (CC.DefaultFont+4)*4) / 2,(CC.ScreenH - height) / 2+(CC.DefaultFont+4)/2,1000)
	end
	for i=1,T_Num do
		local pid = JY.Base["队伍"..i];
		if pid < 0 then
			break;
		end
		if JY.Base["单通"] > 0 then
			--冰糖恋：单挑陈达海
			if WAR.ZDDH == 92 and GetS(87,31,33,5) == 1 then
				WAR.Data["自动选择参战人1"] = 0;
				WAR.Data["我方X1"] = 33
				WAR.Data["我方Y1"] = 24
			end

			--畅想杨过绝情谷两战
			if (WAR.ZDDH == 272 or WAR.ZDDH == 273) and JY.Base["畅想"] == 58 then
				WAR.Data["自动选择参战人2"] = 59
			end
			
		end

		--战三渡，如果周芷若在队则周芷若必出战
		if WAR.ZDDH == 253 and inteam(631) then
			WAR.Data["手动选择参战人2"] = 631
		end
		--if JY.Base["单通"] > 0 then
			for i = 1, 6 do
				local id = WAR.Data["自动选择参战人" .. i]
				if id >= 0 then
					--畅想的情况，畅想主角会取代强制出战的队友
					if id == JY.Base["畅想"] then
						WAR.Person[WAR.PersonNum]["人物编号"] = 0
					else
						WAR.Person[WAR.PersonNum]["人物编号"] = id
					end
					WAR.Person[WAR.PersonNum]["我方"] = true
					WAR.Person[WAR.PersonNum]["坐标X"] = WAR.Data["我方X" .. i]
					WAR.Person[WAR.PersonNum]["坐标Y"] = WAR.Data["我方Y" .. i]
					WAR.Person[WAR.PersonNum]["死亡"] = false
					WAR.Person[WAR.PersonNum]["人方向"] = 2
					--无酒不欢：调整战斗初始面向
					--战海大富
					if WAR.ZDDH == 259 then
						WAR.Person[WAR.PersonNum]["人方向"] = 1
					end
					--双挑公孙止
					if WAR.ZDDH == 273 then
						WAR.Person[WAR.PersonNum]["人方向"] = 1
					end
					--杨过单金轮
					if WAR.ZDDH == 275 then
						WAR.Person[WAR.PersonNum]["人方向"] = 0
					end
					--战杨龙
					if WAR.ZDDH == 75 then
						WAR.Person[WAR.PersonNum]["人方向"] = 0
					end
					--蒙哥
					if WAR.ZDDH == 278 then
						WAR.Person[WAR.PersonNum]["人方向"] = 0
					end
					--周芷若夺掌门
					if WAR.ZDDH == 279 then
						WAR.Person[WAR.PersonNum]["人方向"] = 0
					end
					--单挑赵敏
					if WAR.ZDDH == 293 then
						WAR.Person[WAR.PersonNum]["人方向"] = 0
					end
					--玄冥二老
					if WAR.ZDDH == 295 then
						WAR.Person[WAR.PersonNum]["人方向"] = 0
					end
					--三挑岳不群
					if WAR.ZDDH == 298 then
						WAR.Person[WAR.PersonNum]["人方向"] = 1
					end
					--侠客邪
					if WAR.ZDDH == 170 then
						WAR.Person[WAR.PersonNum]["人方向"] = 0
					end
					WAR.PersonNum = WAR.PersonNum + 1
					WAR.MCRS = WAR.MCRS + 1
				end
			end
		--end
		
		if WAR.PersonNum > 0 and WAR.ZDDH ~= 235 then
			return 
		end

		--lib.PicLoadFile(string.format(CC.FightPicFile[1],JY.Person[pid]["头像代号"]),
		--string.format(CC.FightPicFile[2],JY.Person[pid]["头像代号"]), 4+i);
		local n=0;
		local m=0;
		for j=1,5 do
			if JY.Person[pid]['出招动画帧数'..j]>0 then
				if j>1 then
					m=j;
					break;
				end
				n=n+JY.Person[pid]['出招动画帧数'..j]
			end
		end
		p[i]= {id=pid, name=JY.Person[pid]["姓名"]; 
        zid = JY.Person[pid]["头像代号"]; 
		Pic=n*8+JY.Person[pid]['出招动画帧数'..m]*6, PicNum=JY.Person[pid]['出招动画帧数'..m], idx=0, 
		x=x2+((i+3)%4)*pic_w, y=y2+math.modf((i+3)/4)*pic_h, x=x2+((i+2)%3)*pic_w, y=y2+math.modf((i+2)/3)*pic_h, picked=0,
		};
		--无酒不欢：强制出战的队友
		for j = 1, 6 do
			if WAR.Data["手动选择参战人" .. j] == p[i].id then
				p[i].picked = 1
				WAR.MCRS = WAR.MCRS + 1
			end
		end
	end
	if JY.Base["单通"] > 0 then
		--战三渡
		if WAR.ZDDH == 253 then
			WAR.MCRS = WAR.MCRS + 3
		end
		
		--逍遥御风 天池怪侠 太白诗仙 古墓黄杉 金蛇郎君
		--限定1人
		if WAR.ZDDH == 281 or WAR.ZDDH == 283 or WAR.ZDDH == 284 or WAR.ZDDH == 285 or WAR.ZDDH == 286 then
			WAR.MCRS = WAR.MCRS + 5
		end
		
		--刀剑合璧
		--限定2人
		if WAR.ZDDH == 280 then
			WAR.MCRS = WAR.MCRS + 4
		end
	end
	p[T_Num+1]={name="开始战斗"};
	local leader=-1;
	if WAR.MCRS <6 then
		for i=1, #p do
			if p[i].picked ==0 and WAR.MCRS <6 then
				p[i].picked =2
				leader=i
				WAR.MCRS = WAR.MCRS +1
			end
		end
	end
	p[0]={name="全部选择"};

	if T_Num>6 then
		p[0]={name="自动选择"}
	end
	if WAR.MCRS>=6 or WAR.MCRS==T_Num then
		p[0]={name="全部取消"}
	end
	--无酒不欢：强制出战的预设leader
	for i=1,T_Num do
		if p[i].picked == 1 then
			leader = i
			break
		end
	end
	DrawBoxTitle(width,height,'出战准备',C_ORANGE);
	local select=1;
	local sid=lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH);
	local function redraw(zdrs)
		lib.LoadSur(sid,0,0);
		DrawBox(x0,y1,x0+CC.DefaultFont*5+4*2,y1+CC.DefaultFont*(T_Num+2)+4*(T_Num+3),C_WHITE);
		for i=0,T_Num+1 do
			local str=p[i].name;
			--选中时的名字显示
			--小于7人，名字前显示√表示已选择
			--大于等于7人，名字前显示×表示需要取消方可开始战斗
			if i > 0 and i < T_Num+1 and p[i].picked > 0 then
				if zdrs < 7 then
					str="√"..str;
				else
					str="×"..str
				end
			--未选中的只显示名字
			else
				str=" "..str;
			end
			if select==i then
				lib.Background(x1,y1+(CC.DefaultFont+4)*(i)+4,x1+CC.DefaultFont*5,y1+(CC.DefaultFont+4)*(i+1),128,C_ORANGE)
				DrawString(x1,y1+(CC.DefaultFont+4)*(i)+4,str,C_WHITE,CC.DefaultFont,C_ORANGE);
			elseif i>0 and i<=T_Num then
				DrawString(x1,y1+(CC.DefaultFont+4)*(i)+4,str,C_ORANGE,CC.DefaultFont);
			else
				DrawString(x1,y1+(CC.DefaultFont+4)*(i)+4,str,C_GOLD,CC.DefaultFont);
			end
		end
		for i=1,T_Num do
			local color;
			if p[i].picked > 0 then
				--DrawString(p[i].x-CC.DefaultFont,p[i].y-CC.DefaultFont/2,"出战",C_WHITE,CC.DefaultFont*2/3)
				color=C_WHITE;
				lib.PicLoadCache(p[i].zid+101,p[i].Pic+p[i].idx*2,p[i].x,p[i].y)
				p[i].idx=p[i].idx+1;
				if p[i].idx>=p[i].PicNum then
					p[i].idx=0;
				end
			else
				color=M_Gray;
				lib.PicLoadCache(p[i].zid+101,p[i].Pic,p[i].x,p[i].y)
				lib.PicLoadCache(p[i].zid+101,p[i].Pic,p[i].x,p[i].y,6,180)
			end
		end
	end
	
	--local zdrs=0
	while true do
		if JY.Restart == 1 then
			break
		end
		redraw(WAR.MCRS);
		ShowScreen();
		lib.Delay(65);
		local k=lib.GetKey();
		if k==VK_UP then
			select=select-1;
		elseif k==VK_DOWN then
			select=select+1;
		elseif k==VK_SPACE or k==VK_RETURN then
			if select==0 then
				if p[0].name=="全部选择" or p[0].name=="自动选择" then
					local zrs=T_Num
					if zrs>6 then
						zrs=6
					end
					for i=1,zrs do
						if p[i].picked == 0 then
							p[i].picked=2;
							WAR.MCRS=WAR.MCRS+1
						end
					end
					if leader<0 then
						leader=1;
					end
					p[0].name="全部取消";
				elseif p[0].name=="全部取消" then
					for i=1,T_Num do
						if p[i].picked == 2 then
							p[i].picked=0;
							WAR.MCRS=WAR.MCRS-1
						end
					end
					leader=-1;
					--无酒不欢：强制出战的预设leader
					for i=1,T_Num do
						if p[i].picked == 1 then
							leader = i
							break
						end
					end
					p[0].name="全部选择"

					if T_Num>6 then
						p[0].name="自动选择"
					end
				end
			elseif select==T_Num+1 then
				if leader<0 then
					select=1;
				elseif WAR.MCRS>6 then
					select=1
				else
					local px={}
					local wz=0
					for i=1,T_Num do
						if p[i].picked > 0 then
							wz=wz+1
							px[wz]=i
						end
					end

					for i=1,wz do
						if px[i]~=nil then
							WAR.Person[WAR.PersonNum]["人物编号"]=JY.Base["队伍" ..px[i]]
							WAR.Person[WAR.PersonNum]["我方"]=true
							WAR.Person[WAR.PersonNum]["坐标X"]=WAR.Data["我方X"..i]
							WAR.Person[WAR.PersonNum]["坐标Y"]=WAR.Data["我方Y"..i]
							WAR.Person[WAR.PersonNum]["死亡"]=false
							WAR.Person[WAR.PersonNum]["人方向"]=2
							--无酒不欢：调整战斗初始面向
							--战海大富
							if WAR.ZDDH == 259 then
								WAR.Person[WAR.PersonNum]["人方向"] = 1
							end
							--双挑公孙止
							if WAR.ZDDH == 273 then
								WAR.Person[WAR.PersonNum]["人方向"] = 1
							end
							--杨过单金轮
							if WAR.ZDDH == 275 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end
							--战杨龙
							if WAR.ZDDH == 75 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end
							--蒙哥
							if WAR.ZDDH == 278 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end
							--周芷若夺掌门
							if WAR.ZDDH == 279 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end
							--单挑赵敏
							if WAR.ZDDH == 293 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end
							--无聊单挑葵花
							if WAR.ZDDH == 355 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end							
							--玄冥二老
							if WAR.ZDDH == 295 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end
							--三挑岳不群
							if WAR.ZDDH == 298 then
								WAR.Person[WAR.PersonNum]["人方向"] = 1
							end
							--侠客邪
							if WAR.ZDDH == 170 then
								WAR.Person[WAR.PersonNum]["人方向"] = 0
							end
							WAR.PersonNum=WAR.PersonNum+1
						end
					end
					if JY.Base["单通"] == -1 then
						for i = 1, 6 do
							if WAR.Data["自动选择参战人" .. i] >= 0 then 
								WAR.Person[WAR.PersonNum]["人物编号"] = WAR.Data["自动选择参战人" .. i]
								WAR.Person[WAR.PersonNum]["我方"] = true
								WAR.Person[WAR.PersonNum]["坐标X"] = WAR.Data["我方X" .. i]
								WAR.Person[WAR.PersonNum]["坐标Y"] = WAR.Data["我方Y" .. i]
								WAR.Person[WAR.PersonNum]["死亡"] = false
								WAR.Person[WAR.PersonNum]["人方向"] = 2
								WAR.PersonNum=WAR.PersonNum+1
							end
						end
					end
					break;
				end
			else
				if p[select].picked == 2 then
					p[select].picked=0;
					WAR.MCRS=WAR.MCRS-1
					if leader==select then
						leader=-1;
						for i=1,T_Num do
							if p[i].picked > 0 then
								leader=i;
								break;
							end
						end
					end
					if leader==-1 then
						p[0].name="全部选择"

						if T_Num>6 then
							p[0].name="自动选择"
						end
					end
				elseif p[select].picked == 0 then
					p[select].picked=2;
					WAR.MCRS=WAR.MCRS+1
					if leader<0 then
						leader=select;
					end
					for i=1,T_Num do
						if p[i].picked == 0 then
							break;
						end
						if i==T_Num then
							p[0].name="全部取消";
						end
					end
				end
			end
		end
		if select<0 then
			select=T_Num+1;
		elseif select>T_Num+1 then
			select=0;
		end
	end
	lib.FreeSur(sid);
end

--葵花魅影
function kuihuameiying()
	local pid = WAR.Person[WAR.CurID]['人物编号']
	
	local x, y
	for i = 0, WAR.PersonNum - 1 do
		local id = WAR.Person[i]["人物编号"]
		if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.PD['遮影'][id] == nil then
			x, y = WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"]
			break
		end
	end
	if x == nil or y == nil then 
		return false
	end
	
	War_CalMoveStep(WAR.CurID, 100, 1)
	
	local function vacant(x,y)
		local r = true
		if GetWarMap(x, y, 3) == 255 then 
			r = false
		end
		if lib.GetWarMap(x, y, 2) > 0 or lib.GetWarMap(x, y, 5) > 0 then
			r = false
	    elseif CC.SceneWater[lib.GetWarMap(x, y, 0)] ~= nil then
	       	r = false
	    end
		if x < 1 or x > 63 then
			r = false
		end
		if y < 1 or y > 63 then
			r = false
		end
		return r
	end
	local telx, tely = 0, 0
	local can_tele = 0
	for i = -5, 5 do
		for j = -5, 5 do
			if vacant(x+i,y+j) then
				telx, tely = x+i, y+j
				can_tele = 1
				break
			end
		end
	end
	if can_tele == 1 then
		WarDrawMap(0)
		CurIDTXDH(WAR.CurID, 120, 1, "葵花魅影", C_GOLD)
		lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
		lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
		WarDrawMap(0)
		WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = telx, tely
		WarDrawMap(0)
		CurIDTXDH(WAR.CurID, 120, 1, "葵花魅影", C_GOLD)
		lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
		lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
        
		WarDrawMap(0)
		return true
	else
		return false
	end
end

--九阳招式
--[[function JIUYANGZhaoShi(id,MiaofaWX)
	WAR.JYZS = 0
	if not WAR.JYLQ[id] then
		WAR.JYLQ[id] = {0,0,0}
	end
	local zs={
   {name="他强由他强，清风拂山冈",Usable=true,m1=0,m2=6,a1=3,a2=3+MiaofaWX,a3=3+MiaofaWX},
   {name="他横任他横，明月照大江",Usable=true,m1=0,m2=6,a1=3,a2=3+MiaofaWX,a3=3+MiaofaWX},
   {name="狠来他自恶，一口真气足",Usable=true,m1=0,m2=6,a1=3,a2=3+MiaofaWX,a3=3+MiaofaWX},
	}
	local size = CC.DefaultFont
	--local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local m1, m2, a1, a2, a3, a4, a5,a6
	local choice = 1

	while true do
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
		Cls()
        Cat('实时特效动画2')
		for i = 1, #zs do
			lib.LoadPNG(91, 17 * 2 , 510, 118+i*50, 1)
			local color = C_WHITE
			if WAR.JYLQ[id][i] > 0 then
				zs[i].Usable=false
			end
			if zs[i].Usable==false then
				color = M_Gray
				if i == choice then
					DrawString(680, 122+i*50, "X", C_RED, size)
				end
			end
			if i == choice then
				color = C_GOLD
			end
			DrawString(520, 123+i*50, i, color, size*0.8)
			DrawString(551, 122+i*50, zs[i].name, color, size)
		end
		
		lib.LoadPNG(91, 16 * 2 , 480, 500, 1)
		DrawString(500, 570, "招式气攻："..CC.KFMove[106][choice][2], C_WHITE, size)
		if WAR.JYCD[choice] == 0  then
			DrawString(500, 620, "冷却时间：无", C_WHITE, size)
		else
			DrawString(500, 620, "冷却时间："..WAR.JYCD[choice].."回合", C_WHITE, size)
		end
		if  WAR.JYLQ[id][choice] > 0 then
			DrawString(500, 670, "冷却中，"..WAR.JYLQ[id][choice].."回合后可再次使用", C_WHITE, size)
		end
        if CC.KFMove[106][choice][3] ~= nil then
           DrawString(500, 520, CC.KFMove[106][choice][3], C_WHITE, size*0.8)
        end		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local keyPress, ktype, mx, my = lib.GetKey()
		
		if keyPress==VK_SPACE or keyPress==VK_RETURN then
			if zs[choice].Usable then
				WAR.JYZS = choice
				m1, m2, a1, a2, a3, a4, a5 = zs[choice].m1, zs[choice].m2, zs[choice].a1, zs[choice].a2, zs[choice].a3, zs[choice].a4, zs[choice].a5 , zs[choice].a6
				break
			end
		elseif keyPress == VK_ESCAPE or ktype == 4 then
             a6 = 0 
            break	
		elseif keyPress == VK_UP then
			choice = choice - 1
			if choice < 1 then
				choice = #zs
			end
			
		elseif keyPress == VK_DOWN then
			choice = choice + 1
			if choice > #zs then
				choice = 1
			end
	  
		elseif keyPress >= 49 and keyPress <= 57 then
			local input = keyPress - 48
			if input <= #zs and zs[input].Usable then
				choice = input	
				WAR.JYZS = choice
				m1, m2, a1, a2, a3, a4, a5 = zs[choice].m1, zs[choice].m2, zs[choice].a1, zs[choice].a2, zs[choice].a3, zs[choice].a4, zs[choice].a5 , zs[choice].a6
				break
			end
		end
	end
	
	return m1, m2, a1, a2, a3, a4, a5 ,a6
  	
end]]

--辟邪招式
--[[function BiXieZhaoShi(id,MiaofaWX)
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	local size = CC.FontSmall
	WAR.BXZS = 0
	if not WAR.BXLQ[id] then
		WAR.BXLQ[id] = {0,0,0,0,0,0}
	end
	
	local zs={
	{name="指打奸邪",Usable=true,m1=1,m2=1,a1=1,a2=3+MiaofaWX,a3=3+MiaofaWX},
	{name="飞燕穿柳",Usable=true,m1=3,m2=1,a1=10,a2=8+MiaofaWX,a3=7+MiaofaWX,a4=6+MiaofaWX},
	{name="花开见佛",Usable=true,m1=0,m2=0,a1=5,a2=6+MiaofaWX,a3=3+MiaofaWX},
	{name="锺馗抉目",Usable=true,m1=0,m2=5,a1=2,a2=4+MiaofaWX},
	{name="扫荡群魔",Usable=true,m1=3,m2=1,a1=11,a2=6+MiaofaWX},
	{name="紫气东来",Usable=true,m1=0,m2=6,a1=3,a2=3+MiaofaWX,a3=3+MiaofaWX},
	}
	--local size = CC.DefaultFont
	--local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local m1, m2, a1, a2, a3, a4, a5 ,a6
	local choice = 1
	if not PersonKF(id,105) then
		for i = 3, 6 do
			zs[i].Usable=false
		end
	end
	while true do
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
        Cls()
        Cat('实时特效动画2')
		for i = 1, #zs do
			--lib.LoadPNG(91, 17 * 2 , 510, 118+i*50, 1)
			lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
			lib.LoadPNG(91, 64 * 2 ,bx, by*427, 1)
			local color = C_WHITE
			if WAR.BXLQ[id][i] > 0 then
				zs[i].Usable=false
			end
			if zs[i].Usable==false then
				color = M_Gray
				if i == choice then
					--DrawString(680, 122+i*50, "X", C_RED, size)
				end
			end
			if i == choice then
				color = C_RED
			end
			local namelen = string.len(zs[i].name) / 2
			local stn = string.len(zs[i].name)/2
			local hsize = bx*100/stn
			
			draw3(zs[i].name,bx*25+(i-1)*bx*40,CC.ScreenH-by*60- ((stn-1)*hsize+size)/2, color, size,nil,hsize)			
		end
		
		lib.LoadPNG(91, 15 * 2 , 480, 500, 1)
		DrawString(bx*20, by*440, "招式气攻："..CC.KFMove[48][choice][2], C_WHITE, size)
		if Curr_NG(id,105) then
			WAR.BXCD[choice] = WAR.BXCD1[choice]
			end
		if WAR.BXCD[choice] == 0 or match_ID(id, 36) then
			DrawString(bx*20, by*460, "冷却时间：无", C_WHITE, size)
		else
			DrawString(bx*20, by*460, "冷却时间："..WAR.BXCD[choice].."回合", C_WHITE, size)
		end
		if choice > 2 and not PersonKF(id,105) then
			DrawString(bx*20,  by*550, "习得葵花神功后方可使用", C_WHITE, size)
		elseif WAR.BXLQ[id][choice] > 0 then

			DrawString(bx*20, by*550, "冷却中，"..WAR.BXLQ[id][choice].."回合后可再次使用", C_WHITE, size)
		end
		local zs1 =CC.KFMove[48]
		local zstx = nil
		local w = math.modf(bx*260/size)
		zstx = zs1[choice][4]
		tjm(bx*20,by*480,zstx,C_WHITE,size,w,size)
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local keyPress, ktype, mx, my = lib.GetKey()
		
		
		if inteam(id) == false then
			WAR.BXZS = math.random(1,6)
			m1, m2, a1, a2, a3, a4, a5 = zs[choice].m1, zs[choice].m2, zs[choice].a1, zs[choice].a2, zs[choice].a3, zs[choice].a4, zs[choice].a5 , zs[choice].a6
			break
		end
		if keyPress==VK_SPACE or keyPress==VK_RETURN then
			if zs[choice].Usable then
				WAR.BXZS = choice
				m1, m2, a1, a2, a3, a4, a5 = zs[choice].m1, zs[choice].m2, zs[choice].a1, zs[choice].a2, zs[choice].a3, zs[choice].a4, zs[choice].a5 , zs[choice].a6
				break
			end
		elseif keyPress == VK_ESCAPE or ktype == 4 then
		    a6 = 0
			break
		elseif keyPress == VK_UP or keyPress == VK_LEFT then
			choice = choice - 1
			if choice < 1 then
				choice = #zs
			end
		elseif keyPress == VK_DOWN or keyPress == VK_RIGHT then
			choice = choice + 1
			if choice > #zs then
				choice = 1
			end
		elseif keyPress >= 49 and keyPress <= 57 then
			local input = keyPress - 48
			--if input <= #zs and zs[input].Usable then
			if input <= #zs  then
				choice = input
				--WAR.BXZS = choice
				--m1, m2, a1, a2, a3, a4, a5 = zs[choice].m1, zs[choice].m2, zs[choice].a1, zs[choice].a2, zs[choice].a3, zs[choice].a4, zs[choice].a5 , zs[choice].a6
				break
			end
		else 	
			local mxx = false 
			for i = 1,#zs do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					choice = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				--return War_Fight_Sub(WAR.CurID, 48)			
			end
		end
	end	
	return m1, m2, a1, a2, a3, a4, a5 ,a6
end]]

--[[function TaiXuanZhaoShi()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 	
	WAR.TXZS = 0
	local size = CC.DefaultFont
	--local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)

	local choice = 1
	local size = CC.FontSmall
	while true do
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
        Cls()
		Cat('实时特效动画2')
		local zs = {}
		local zs =CC.KFMove[102]
		for i = 1, #zs do
			--lib.LoadPNG(91, 17 * 2 , 510, 118+i*50, 1)
			lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
			lib.LoadPNG(91, 64 * 2 ,bx, by*427, 1)
			local color = C_WHITE
			local color = C_WHITE
			if i == choice then
				color = C_RED
			end
			local namelen = string.len(zs[i][1]) / 2
			local stn = string.len(zs[i][1]) / 2
			local hsize = bx*100/stn			
			draw3(zs[i][1],bx*25+(i-1)*bx*40,CC.ScreenH-by*60- ((stn-1)*hsize+size)/2, color, size,nil,hsize)			
		end
		DrawString(bx*20, by*460, "招式气攻："..CC.KFMove[102][choice][2], C_WHITE, size)
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local keyPress, ktype, mx, my = lib.GetKey();
		if keyPress==VK_SPACE or keyPress==VK_RETURN then
			break
		elseif keyPress == VK_UP or keyPress == VK_LEFT then
			choice = choice - 1
			if choice < 1 then
				choice = #zs
			end
		elseif keyPress == VK_DOWN or keyPress == VK_RIGHT then
			choice = choice + 1
			if choice > #zs then
				choice = 1
			end
		elseif keyPress >= 49 and keyPress <= 57 then
			local input = keyPress - 48
			if input <= #zs then
				choice = input
				break
			end
		else 	
			local mxx = false 
			for i = 1,#zs do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					choice = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				--return War_Fight_Sub(WAR.CurID, 48)		
			end
		end	
	end
	WAR.TXZS = choice
	return
end]]

--[[function LIUMAIZS()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 	
	local size = CC.DefaultFont
	--local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local choice = 1
	local size = CC.FontSmall
	local Usable = true
	WAR.PD["六脉招式"][pid] = 0
	WAR.LMZS = 0
	if not WAR.LMLQ[pid] then
		WAR.LMLQ[pid] = {0,0,0,0,0,0}
	end
		
	while true do
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
        Cls()
		Cat('实时特效动画2')
		local zs = {}
		local tmp = 0
		for ii = 1,JY.Base["武功数量"] do
			tmp = JY.Person[pid]["武功"..ii] 
		end
		local wg = 49
		local zs =CC.KFMove[wg]
		for i = 1, #zs do
			lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
			lib.LoadPNG(91, 64 * 2 ,bx, by*427, 1)
			local color = C_WHITE
			if WAR.LMLQ[pid][i] > 0 then
				--Usable = false
				--color = M_Gray
			end

			if JY.Person[pid]["内力最大值"] < 6000 and i == 4 then
				--color = M_Gray
				--Usable = false
			end	
			if JY.Person[pid]["内力最大值"] < 7000 and i == 5 then
				--color = M_Gray
				--Usable = false
			end
			if JY.Person[pid]["内力最大值"] < 8000 and i == 6 then
				--color = M_Gray
				--Usable = false
			end	
			if i == choice then
				color = C_RED
			end						
			local namelen = string.len(zs[i][1]) / 2
			local stn = string.len(zs[i][1]) / 2
			local hsize = bx*100/stn
			draw3(zs[i][1],bx*25+(i-1)*bx*40,CC.ScreenH-by*60- ((stn-1)*hsize+size)/2, color, size,nil,hsize)			
		end

		DrawString(bx*20, by*440, "招式气攻："..CC.KFMove[49][choice][2], C_WHITE, size)

		if WAR.LMCD[choice] == 0  then
			DrawString(bx*20, by*460, "冷却时间：无", C_WHITE, size)
		else
			DrawString(bx*20, by*460, "冷却时间："..WAR.LMCD[choice].."回合", C_WHITE, size)
		end
		if choice == 4 and Usable == false then
			--WAR.LMLQ[pid][choice] = 0
			--DrawString(bx*20,  by*550, "内力最大值大于6000可使用", C_WHITE, size)
			--DrawString(bx*20,  by*550, "领悟后方可使用", C_WHITE, size)
		elseif WAR.LMLQ[pid][choice] > 0 then
			DrawString(bx*20, by*550, "冷却中，"..WAR.LMLQ[pid][choice].."回合后可再次使用", C_WHITE, size)
		end
		if choice == 5 and (JY.Person[pid]["内力最大值"] >= 7000) == false then
			--WAR.LMLQ[pid][choice] = 0
			--DrawString(bx*20,  by*550, "内力最大值大于7000可使用", C_WHITE, size)
			--DrawString(bx*20,  by*550, "领悟后方可使用", C_WHITE, size)
		elseif WAR.LMLQ[pid][choice] > 0 then
			DrawString(bx*20, by*550, "冷却中，"..WAR.LMLQ[pid][choice].."回合后可再次使用", C_WHITE, size)
		end
		if choice == 6 and (JY.Person[pid]["内力最大值"] >= 8000) == false then
			--DrawString(bx*20,  by*550, "内力最大值大于8000可使用", C_WHITE, size)
		elseif WAR.LMLQ[pid][choice] > 0 then
			DrawString(bx*20, by*550, "冷却中，"..WAR.LMLQ[pid][choice].."回合后可再次使用", C_WHITE, size)
		end	

		local zs1 =CC.KFMove[49]
		local zstx = nil
		local w = math.modf(bx*260/size)
		zstx = zs1[choice][4]
		tjm(bx*20,by*480,zstx,C_WHITE,size,w,size)
		ShowScreen()
		lib.Delay(CC.BattleDelay)

		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local keyPress, ktype, mx, my = lib.GetKey();
		if keyPress==VK_SPACE or keyPress==VK_RETURN then
			--if Usable == true then
				--WAR.PD["六脉招式"][pid] = choice
				--m1, m2, a1, a2, a3, a4, a5 = zs[choice].m1, zs[choice].m2, zs[choice].a1, zs[choice].a2, zs[choice].a3, zs[choice].a4, zs[choice].a5 , zs[choice].a6
				break
			--end
		elseif keyPress == VK_UP or keyPress == VK_LEFT then
			choice = choice - 1
			if choice < 1 then
				choice = #zs
			end
		elseif keyPress == VK_DOWN or keyPress == VK_RIGHT then
			choice = choice + 1
			if choice > #zs then
				choice = 1
			end
		elseif keyPress >= 49 and keyPress <= 57 then
			local input = keyPress - 48
			if input <= #zs then
				choice = input
				break
			end
		else 	
			local mxx = false 
			for i = 1,#zs do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					choice = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				--return War_Fight_Sub(WAR.CurID, 48)			
			end
		end	
	end
	--WAR.PD["六脉招式"][pid] = choice
	WAR.LMZS = choice
	return
end]]

function WUYUEZS()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 	
	local size = CC.DefaultFont
	--local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local choice = 1
	local size = CC.FontSmall
	local Usable = true
	--WAR.PD["六脉招式"][pid] = 0
	WAR.WYSJ = 0
	--[[if not WAR.LMLQ[pid] then
		WAR.LMLQ[pid] = {0,0,0,0,0,0}
	end]]
		
	while true do
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
        Cls()
		Cat('实时特效动画2')
		local zs = {}
		local tmp = 0
		for ii = 1,JY.Base["武功数量"] do
			tmp = JY.Person[pid]["武功"..ii] 
		end
		local wg = 377
		local zs =CC.KFMove[wg]
		for i = 1, #zs do
			lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
			lib.LoadPNG(91, 64 * 2 ,bx, by*380, 1)
			local color = C_WHITE
			--[[if WAR.LMLQ[pid][i] > 0 then
				--Usable = false
				--color = M_Gray
			end

			if JY.Person[pid]["内力最大值"] < 6000 and i == 4 then
				--color = M_Gray
				--Usable = false
			end	
			if JY.Person[pid]["内力最大值"] < 7000 and i == 5 then
				--color = M_Gray
				--Usable = false
			end
			if JY.Person[pid]["内力最大值"] < 8000 and i == 6 then
				--color = M_Gray
				--Usable = false
			end	]]
			if i == choice then
				color = C_RED
			end						
			local namelen = string.len(zs[i][1]) / 2
			local stn = string.len(zs[i][1]) / 2
			local hsize = bx*100/stn
			draw3(zs[i][1],bx*25+(i-1)*bx*40,CC.ScreenH-by*60- ((stn-1)*hsize+size)/2, color, size,nil,hsize)			
		end

		DrawString(bx*20, by*400, "招式气攻："..CC.KFMove[377][choice][2], C_WHITE, size)

		--if WAR.LMCD[choice] == 0  then
			DrawString(bx*20, by*420, "冷却时间：无", C_WHITE, size)
		--else
			--DrawString(bx*20, by*460, "冷却时间："..WAR.LMCD[choice].."回合", C_WHITE, size)
		--end
		--[[if choice == 4 and Usable == false then
			--WAR.LMLQ[pid][choice] = 0
			--DrawString(bx*20,  by*550, "内力最大值大于6000可使用", C_WHITE, size)
			--DrawString(bx*20,  by*550, "领悟后方可使用", C_WHITE, size)
		elseif WAR.LMLQ[pid][choice] > 0 then
			DrawString(bx*20, by*550, "冷却中，"..WAR.LMLQ[pid][choice].."回合后可再次使用", C_WHITE, size)
		end
		if choice == 5 and (JY.Person[pid]["内力最大值"] >= 7000) == false then
			--WAR.LMLQ[pid][choice] = 0
			--DrawString(bx*20,  by*550, "内力最大值大于7000可使用", C_WHITE, size)
			--DrawString(bx*20,  by*550, "领悟后方可使用", C_WHITE, size)
		elseif WAR.LMLQ[pid][choice] > 0 then
			DrawString(bx*20, by*550, "冷却中，"..WAR.LMLQ[pid][choice].."回合后可再次使用", C_WHITE, size)
		end
		if choice == 6 and (JY.Person[pid]["内力最大值"] >= 8000) == false then
			--DrawString(bx*20,  by*550, "内力最大值大于8000可使用", C_WHITE, size)
		elseif WAR.LMLQ[pid][choice] > 0 then
			DrawString(bx*20, by*550, "冷却中，"..WAR.LMLQ[pid][choice].."回合后可再次使用", C_WHITE, size)
		end]]		

		local zs1 = CC.KFMove[377]
		local zstx = nil
		local w = math.modf(bx*260/size)
		zstx = zs1[choice][4]
		tjm(bx*20,by*440,zstx,C_WHITE,size,w+4,size)
		ShowScreen()
		lib.Delay(CC.BattleDelay)

		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local keyPress, ktype, mx, my = lib.GetKey();
		if keyPress==VK_SPACE or keyPress==VK_RETURN then
			--if Usable == true then
				--WAR.PD["六脉招式"][pid] = choice
				--m1, m2, a1, a2, a3, a4, a5 = zs[choice].m1, zs[choice].m2, zs[choice].a1, zs[choice].a2, zs[choice].a3, zs[choice].a4, zs[choice].a5 , zs[choice].a6
				break
			--end
		elseif keyPress == VK_UP or keyPress == VK_LEFT then
			choice = choice - 1
			if choice < 1 then
				choice = #zs
			end
		elseif keyPress == VK_DOWN or keyPress == VK_RIGHT then
			choice = choice + 1
			if choice > #zs then
				choice = 1
			end
		elseif keyPress >= 49 and keyPress <= 57 then
			local input = keyPress - 48
			if input <= #zs then
				choice = input
				break
			end
		else 	
			local mxx = false 
			for i = 1,#zs do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					choice = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				--return War_Fight_Sub(WAR.CurID, 48)			
			end
		end	
	end
	--WAR.PD["六脉招式"][pid] = choice
	WAR.WYSJ = choice
	return
end

function DGFJ()
  local pd = 0	
	local pid = WAR.Person[WAR.CurID]
	if match_ID(pid,457) and WAR.PD['虚邪剑域'][pid] ~= nil and WAR.PD['虚邪剑域'][pid] >= 10 then
		do return end
	end	
	for i = 0,WAR.PersonNum - 1 do 
		local id = WAR.Person[i]['人物编号']
		if WAR.Person[i]['死亡'] == false and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[i]['我方']  then 
			local x,y = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
			local eft = GetWarMap(x,y,4)
			local yj = math.modf(TrueYJ(id)/30)
			local yj1 = math.modf(TrueYJ(id)/60)
			if ((match_ID(id, 9982) and JLSD(0,yj,id)) or WAR.PD['接化发'][id] == 2 or match_ID(id,592) or (WAR.ZDDH == 424 and id == 670))
			and JY.Person[id]['内力'] > 50	and JY.Person[id]['生命'] > 0 and JY.Person[id]['体力'] > 10 and fjpd(WAR.CurID) == false and eft > 0 then
				WAR.Person[i]['先手反击'] = 1
				WAR.Person[i]["移动步数"] = 0
				WAR.FW = {}
				for i = 0, CC.WarWidth - 1 do
					for j = 0, CC.WarHeight - 1 do
						local effect = GetWarMap(i, j, 4)
						if effect > 0 then 
							WAR.FW[#WAR.FW+1] = {i,j}
						end
					end
				end
				savewar()
				local pid = WAR.Person[WAR.CurID]['人物编号']
				local tx = {}
				local at = WAR.CurID
				tx.dh = WAR.Person[WAR.CurID]['特效动画']
				tx.wz1 = WAR.Person[WAR.CurID]['特效文字1']
				tx.wz2 = WAR.Person[WAR.CurID]['特效文字2']
				tx.wz3 = WAR.Person[WAR.CurID]['特效文字3']
				tx.wz4 = WAR.Person[WAR.CurID]['特效文字4']
				WAR.Person[WAR.CurID]['特效动画'] = -1
				WAR.Person[WAR.CurID]['特效文字1'] = nil
				WAR.Person[WAR.CurID]['特效文字2'] = nil
				WAR.Person[WAR.CurID]['特效文字3'] = nil
				WAR.Person[WAR.CurID]['特效文字4'] = nil
				WAR.CurID = i
				WarDrawMap(0)
				local str = "无我无剑"
				if WAR.PD['接化发'][id] == 2 then
					str = "发！！！"
					WAR.PD['接化发'][id] = nil
					if math.random(10) > 5 then
						WAR.PD['刺目'][id] = 2
					end
				end	
				CurIDTXDH(WAR.CurID, 84,1, str, C_GOLD)
				WarSet()
				if WAR.AutoFight == 1 or WAR.Person[i]['我方'] == false then 
					War_AutoFight()
				else 
					Cat('武功')
				end
				WAR.Person[i]['先手反击'] = -1
				WAR.CurID = at
				WarDrawMap(0)
				WAR.Person[WAR.CurID]['特效动画'] = tx.dh
				WAR.Person[WAR.CurID]['特效文字1'] = tx.wz1
				WAR.Person[WAR.CurID]['特效文字2'] = tx.wz2
				WAR.Person[WAR.CurID]['特效文字3'] = tx.wz3
				WAR.Person[WAR.CurID]['特效文字4'] = tx.wz4
				CleanWarMap(4,0)
				for i = 1,#WAR.FW do 
					SetWarMap(WAR.FW[i][1],WAR.FW[i][2],4,1)
				end
				WAR.FW = {}
				loadwar()
				if (match_ID(id,592) or JLSD(0,yj1,id)) and WAR.PD['真左右互搏'][pid] == nil then
					pd = 1
				end
			end
		end
	end
	--say(WAR.Person[WAR.CurID]['人物编号'],0)
	return pd
end

function savewar()
	local file = io.open(CONFIG.DataPath..'1', "w");
	assert(file);
	for i,v in pairs(WAR) do
		local t = type(WAR[i]); --判断对象类型
		if t == "number" then
			file:write(string.format("WAR.%s =", i))
			file:write(WAR[i])
			file:write("\n")
		end
	end
	file:close();
end

function loadwar()
	if existFile(CONFIG.DataPath..'1') then
		dofile(CONFIG.DataPath..'1')
		os.remove(CONFIG.DataPath..'1');
	end	
end
--免疫断连击
function MyDlj(i)
	local pid = WAR.Person[i]["人物编号"]
	if JY.Status == GAME_WMAP then
		if BNJQ(pid) and MPTX(pid,20) then
			return true
		end
		if BNJQ(pid) and WAR.PD['周公剑意'][pid] == 7 and WAR.ACT < 3 then
		    return true
		end
		if WAR.TWLJ == 1 and (WAR.ACT < 3 or (WAR.ACT == 3 and (JLSD(33,66,pid) or WAR.PD['风雷惊蛰1'][pid] ~= nil))) then
			return true
		end
		if WAR.Actup[pid] ~= nil and MPTX(pid,4) and NGQHB(pid,99) and WAR.ACT < 3 then 
		    return true
		end
		if MPTX(pid,23,4) and ZYJQ(pid) and WAR.ACT < 3 then  --朝廷怒发冲冠
		    return true
		end
		if JXPD(pid,35,2) and WAR.ACT < 3 then
			return true
		end
		if pid == 0 and JY.Person[605]["论剑奖励"] == 1 and WAR.ACT < 3 then
			return true
		end
		if WAR.PD['免疫断连'][pid] ~= nil then
		    return true
		end
		if match_ID(pid,592) and WAR.PD['无我之境'][pid] ~= nil and WAR.PD['无我之境'][pid] > 0 and WAR.ACT < 5 then
		    return true
		end
		if match_ID(pid,517) and WAR.ACT < 6 then
		    return true
		end
		if ZYHBPD(pid) == 2 then
			if NGQH(pid,102) then
				if WAR.ACT < 4 or WAR.PD['真左右互搏'][pid] == 1 or JLSD(10,60,pid) then
					return true
				end	
			else
				if WAR.PD['真左右互搏'][pid] == 1 then
					return true
				elseif WAR.ZYHB == 2 and JLSD(10,60,pid) then
					return true
				end
			end	
		end	
		if match_ID(pid,457) and WAR.PD['虚邪剑域'][pid] ~= nil and WAR.PD['虚邪剑域'][pid] >= 5 then
			return true
		end	
	end	
	return false
end

--是否触发反击，用于反击的一些判定
function fjpd(i)
	local id = WAR.Person[i]['人物编号']
	if WAR.Person[i]["反击武功"] ~= -1  then 
		return true
	end
	if WAR.Person[i]["先手反击"] ~= -1  then 
		return true
	end
	if WAR.Person[i]["反击"] ~= -1 then 
		return true
	end
	if WAR.XTCJ == 1 or WAR.TJFJ == 1 then
		return true
	end
	return false
end

--免疫反击判定
function MyFj(i)
	local id = WAR.Person[i]['人物编号']

	if NGQH(id,108) then
		return true
	end
	if MPTX(id,11) then
		return true
	end	
	if match_ID(id,92) then
		return true
	end
	if JY.Status == GAME_WMAP then
		if BNJQ(id) and DAOQX(id,'开天地') == 1 then
			return true
		end	
		if psx(id,"门派技能3") == 2 and WAR.DZXYLV[id] == 150 then
			return true
		end
		if match_ID(id,592) and ZYJQ(id) then
			return true
		end
		if match_ID(id,520) and (BNJQ(id) or ZYJQ(id)) then
			return true
		end
		if MPTX(id,20) and BNJQ(id) then
			return true
		end
		if PersonKF(id,335) and PersonKF(id,181) and PersonKF(id,203) and (WAR.TDJW == 5 or WAR.TDJW == 10) then
			return true
		end
		if WAR.BLJJ == 8 and PersonKF(id,341) and PersonKF(id,55) and Curr_NG(id,103) then
			return true
		end	
		if WAR.YJZD[id] == 1 and WAR.WDKTJ == 1 and tjqfj(id) then
			return true
		end	
		if WAR.PD['免疫反击'][id] == 1 then
			return true
		end
		if WAR.PD['血衣剑法5'][id] == 1 then
			return true
		end	
		if match_ID(id,457) and WAR.PD['虚邪剑域'][id] ~= nil and WAR.PD['虚邪剑域'][id] >= 20 then
			return true
		end	
		if WAR.PD['残火太刀'][id] ~= nil and WAR.CHTD == 2 then
			return true
		end	
	end	
	
	return false
end

function Fjkx(i)--攻击者降低被攻击者反弹的机率
	local id = WAR.Person[i]['人物编号']
	local aa = 0
	if Curr_NG(id,204) then 
		local cs = WAR.PD['长生真气'][id] or 0
		if math.random(10) > (10 - cs - WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end
	
	if NGQH(id,107) then
		local jy = WAR.JYZQ[id] or 0
		if  math.random(10) > (10 - jy - WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end
	end
	
	if NGQH(id,106) then	
		local jyhd = WAR.PD['九阳护盾'][id] or 0
		if math.random(10) > (6 - jyhd - WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end	
	
	if NGQH(id,105) and (match_ID(id,27) or match_ID(id,777)) then	
		local kh = WAR.PD['葵花护盾'][id] or 0
		if math.random(10) > (8 - kh - WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end		
	
    if NGQH(id,180) then 
		if  math.random(10) > 5 then
			aa = 2
		else
			aa = 1
		end
	end	
	
	if NGQH(id,233) then
		local jyhd = WAR.PD['神足乾坤'][id] or 0
		if math.random(10) > (6 - jyhd - WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end	
	
	if NGQH(id,43) then
		local jyhd = WAR.PD['易水寒冰'][id] or 0
		if math.random(10) > (jyhd + WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end	
	
	if JY.Status == GAME_WMAP and WAR.YYDL == 2  then
		if  math.random(10) > (6-WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end	
	
	if MPTX(id,15) and JY.Status == GAME_WMAP and WAR.MKZS == 1  then
		if math.random(10) > (3-WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end		
	
	if NGQHB(id,190) then
		if math.random(10) > (7-WAR.GBJY1) then
			aa = 2
		else
			aa = 1
		end	
	end	
	if Curr_NG(id,171) and JY.Status == GAME_WMAP and WAR.TJXL == 1 then
		if math.random(10) > (10 - math.modf(psx(id,'品德')*0.1)) then
			aa = 2
		else
			aa = 1
		end
	end	
	
	if match_ID(id,520) then
		local xt = WAR.PD['先天太极'][id] or 0
		if math.random(10) > (10 - xt) then
			aa = 2
		else
			aa = 1
		end
	end
	if ZYHBPD(id) == 2 and JY.Status == GAME_WMAP then
		if NGQH(id,102)  then
			if WAR.ACT < 4 or WAR.PD['真左右互搏'][id] == 1 or JLSD(10,55,id) then
					aa = 2
			else
					aa = 1
			end	
		else
			if WAR.ZYHB == 2 then
				if WAR.PD['真左右互搏'][id] == 1 or JLSD(10,55,id) then
					aa = 2
				else
					aa = 1
				end
			end	
		end	
	end	
	
	--套装效果免疫反击
	if PDTZ(id,JY.Person[id]["武器"]) and Setmeal[JY.Person[id]["武器"]][5] == 9 then
		if JLSD(0, 30, id) then
			aa = 2
		else
			aa = 1
		end	
	end

	if WAR.PD['罗汉果位'][id] ~= nil and WAR.PD['罗汉果位'][id] > 0 then
		if JLSD(0,WAR.PD['罗汉果位'][id]*20,id) then
			aa = 2
		else
			aa = 1
		end
	end		
	if WAR.PD['照见诸法'][id]	~= nil and WAR.PD['照见诸法'][id] > 14 then
		if JLSD(0,65,id) then
			aa = 2
		else
			aa = 1
		end
	end			
	if MyFj(i) == true then
		aa = 2
	end	
	return aa
end

function fjtx()
	local at = WAR.CurID
	for i = 0,WAR.PersonNum - 1 do 
		local id = WAR.Person[i]['人物编号']
		if WAR.Person[i]['死亡'] == false and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[i]['我方'] then 
			if fjpd(WAR.CurID) == false and WAR.Person[i]['反击'] == 1 and JY.Person[id]['生命'] > 0 and JY.Person[id]['体力'] > 10 then 
				WAR.Person[i]["移动步数"] = 0
				WAR.CurID = i
				WarDrawMap(0)
				if WAR.AutoFight == 1 or WAR.Person[i]['我方'] == false then 
					War_AutoFight()
				else 
					Cat('武功')
					--War_FightMenu()
				end		
				WAR.CurID = at
				WarDrawMap(0)
			end
			WAR.Person[i]['反击'] = -1
		end
	end	
end

function Bagua(pid)
	
	local str = {}
	local lb = {'临','兵','斗','者','列','阵','皆','在','前'}

	local jl = {30,25,25,25,25,20,20,15,15}
	if JY.Base["天书数量"] < 10 then 
		table.remove(lb,#lb)
	end
	if JY.Base["天书数量"] < 7 then 
		table.remove(lb,#lb)
	end
	if JY.Person[pid]['实战'] < 500 then 
		table.remove(lb,#lb)
	end
	if JY.Person[pid]['实战'] < 400 then 
		table.remove(lb,#lb)
	end
	if JY.Person[pid]['实战'] < 300 then 
		table.remove(lb,#lb)
	end
	if JY.Person[pid]['实战'] < 200 then 
		table.remove(lb,#lb)
	end
	for i = 1,#lb do
		WAR.PD[lb[i]][pid] = nil
		if JLSD(0,jl[i],pid) then
			str[#str+1] = i
			WAR.PD[lb[i]][pid] = 1
			if WAR.PD['前'][pid] == 1 then
				if (WAR.PD['极意攻击'][pid] or 0) < 5 then
					WAR.PD['极意攻击'][pid] = 5
				end 
			end	
		--if #lb > 2 then
      -- break
    -- end
		end
	end

	local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
	local a = 2546
	local c = 1
	local e = 1
	local zoom = CONFIG.Zoom/100
   if #str > 0 then
		local hb = GetS(JY.SubScene, WAR.Person[WAR.CurID]['坐标X'], WAR.Person[WAR.CurID]['坐标Y'], 4)*CONFIG.Zoom/100
		local x,y = CC.ScreenW/2,CC.ScreenH/2
		local x1,y1 = math.sin(40*2*math.pi/360)*220*zoom,math.sin(50*2*math.pi/360)*220*zoom
		local x2,y2 = math.sin(80*2*math.pi/360)*220*zoom,math.sin(10*2*math.pi/360)*220*zoom
		local x3,y3 = math.sin(60*2*math.pi/360)*220*zoom,math.sin(30*2*math.pi/360)*220*zoom
		local x4,y4 = math.sin(20*2*math.pi/360)*220*zoom,math.sin(70*2*math.pi/360)*220*zoom
		local bl = {{0,1/2},
				  {-x1/220/zoom,y1/2/220/zoom},
				  {-x2/220/zoom,y2/2/220/zoom},
				  {-x3/220/zoom,-y3/2/220/zoom},
				  {-x4/220/zoom,-y4/2/220/zoom},
				  {x4/220/zoom,-y4/2/220/zoom},
				  {x3/220/zoom,-y3/2/220/zoom},
				  {x2/220/zoom,y2/2/220/zoom},
				  {x1/220/zoom,y1/2/220/zoom},}

		local zb = {{x,y-220/2*zoom-zoom*18},
				  {x+x1,y-y1/2-zoom*18},
				  {x+x2,y-y2/2-zoom*18},
				  {x+x3,y+y3/2-zoom*18},
				  {x+x4,y+y4/2-zoom*18},
				  {x-x4,y+y4/2-zoom*18},
				  {x-x3,y+y3/2-zoom*18},
				  {x-x2,y-y2/2-zoom*18},
				  {x-x1,y-y1/2-zoom*18}}
		for i = 1,#str do 
		    lib.GetKey()
		    local n = str[i]
		    for j = 0,220*zoom,20*zoom do 
			    lib.GetKey()
				Cat('实时特效动画')
                Cls()
                Cat('实时特效动画2')
				SetWarMap(x0,y0,8,a*2) 
				e = e + 1 
				if e == 3 then 
				   e = 1 
				   a = a + 1
				end   
				if a > 2569 then
				   a = 2546
				end  
				for i = 1,#lb do 
					if WAR.PD[lb[i]][pid] == nil then
					   lib.PicLoadCache(3,(2536+i)*2,zb[i][1],zb[i][2]-hb,2,256,nil,CC.ScreenW/1360*50*zoom)
					else--if  
					   lib.PicLoadCache(3,(2536+i)*2,zb[i][1],zb[i][2]-hb,10,256,nil,CC.ScreenW/1360*50*zoom)
					end
				end
				if j <= 200*zoom then 
				   --lib.PicLoadCache(99,(158+n)*2,zb[n][1]+bl[n][1]*j,zb[n][2]+bl[n][2]*j,10,256,nil,CC.ScreenW/1360*50)
				   lib.PicLoadCache(3,(2536+n)*2,zb[n][1]+bl[n][1]*j,zb[n][2]+bl[n][2]*j-hb,10,256,nil,CC.ScreenW/1360*50*zoom)
				end   
				ShowScreen()
				lib.Delay(CC.BattleDelay)
			end
		end
   end
   CleanWarMap(8,-1)
end

Ct['实时特效动画2'] = function(flag)
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	for i = 0,WAR.PersonNum-1 do
		local id = WAR.Person[i]['人物编号']
		local xx,yy = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		   
		local x0 = WAR.Person[WAR.CurID]["坐标X"]
		local y0 = WAR.Person[WAR.CurID]["坐标Y"]
		local dx = WAR.Person[i]["坐标X"] - x0
		local dy = WAR.Person[i]["坐标Y"] - y0
		local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100
		ry = ry - hb
		
        if	WAR.Person[i]['死亡'] == false then
            --飞云回转刀
            if match_ID(id, 9964) then
                FeiYunHuiZhuanDao(i,x0,y0,flag)
            end
			--圣火阵法
            if JXPD(id,456,1) then
                ShengHuoZhenFa(i,x0,y0,flag)
            end
        end
    end
end

Ct['实时特效动画'] = function(s)
	--for i = 0,WAR.PersonNum-1 do
		--if WAR.Person[i]['护盾'] ~= nil and (WAR.Person[i]['护盾'] == 13 or WAR.Person[i]['护盾'] == 22) then
			CleanWarMap(8,-1)
		--else
			CleanWarMap(9,-1)
		--end
	--end
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	for i = 0,WAR.PersonNum-1 do
		local id = WAR.Person[i]['人物编号']
		local xx = WAR.Person[i]['坐标X']
		local yy = WAR.Person[i]['坐标Y']
		local x0 = WAR.Person[WAR.CurID]["坐标X"]
		local y0 = WAR.Person[WAR.CurID]["坐标Y"]
		local dx = WAR.Person[i]["坐标X"] - x0
		local dy = WAR.Person[i]["坐标Y"] - y0
		local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100
		ry = ry - hb
		if WAR.Person[i]['死亡'] == false then
			if WAR.Person[i]['护盾'] ~= nil and WAR.Person[i]['护盾'] > 0 then
				local hd = WAR.Person[i]['护盾']
				if CC.HD[hd] ~= nil then
					local aa = 30	
					if WAR.Person[i]['护盾'] == 7 then
						aa = 50
					end
					if WAR.Person[i]['护盾'] == 19 then
						aa = 60
					end
					local ys = math.ceil(aa/CC.BattleDelay)
					local t1 = CC.HD[hd].tt
					local t2 = CC.HD[hd].tt1
					xx = xx + CC.HD[hd].dx
					yy = yy + CC.HD[hd].dy
					if WAR.Person[i]['护盾延迟'] == nil then 
						WAR.Person[i]['护盾延迟'] = 1 
					else 
						if WAR.Person[i]['护盾延迟'] < ys then
							WAR.Person[i]['护盾延迟'] = WAR.Person[i]['护盾延迟'] + 1
						end
					end
					if WAR.Person[i]['护盾延迟'] == ys then 
						if WAR.Person[i]['护盾贴图'] == -1 or WAR.Person[i]['护盾贴图'] < t1 then 
							WAR.Person[i]['护盾贴图'] = t1 
						else 
							WAR.Person[i]['护盾贴图'] = WAR.Person[i]['护盾贴图'] + 1
						end	
						if WAR.Person[i]['护盾贴图'] > t2 then 
							WAR.Person[i]['护盾贴图'] = t1 
						end	
						if WAR.Person[i]['护盾'] == 13 or WAR.Person[i]['护盾'] == 17 or WAR.Person[i]['护盾'] == 18 or WAR.Person[i]['护盾'] == 22 or WAR.Person[i]['护盾'] == 25 or WAR.Person[i]['护盾'] == 27 or WAR.Person[i]['护盾'] == 28 or WAR.Person[i]['护盾'] == 29 or WAR.Person[i]['护盾'] == 30 then
							SetWarMap(xx,yy,8,WAR.Person[i]['护盾贴图']*2)
							--SetWarMap(xx,yy,9,WAR.Person[i]['贴图'])
						else
							SetWarMap(xx,yy,9,WAR.Person[i]['护盾贴图']*2)	
						end	
						WAR.Person[i]['护盾延迟'] = 0
					else	
						if WAR.Person[i]['护盾贴图'] == -1 or WAR.Person[i]['护盾贴图'] < t1 then 
							WAR.Person[i]['护盾贴图'] = t1 
						end
						if WAR.Person[i]['护盾'] == 13 or WAR.Person[i]['护盾'] == 17 or WAR.Person[i]['护盾'] == 18 or WAR.Person[i]['护盾'] == 22 or WAR.Person[i]['护盾'] == 25 or WAR.Person[i]['护盾'] == 27 or WAR.Person[i]['护盾'] == 28 or WAR.Person[i]['护盾'] == 29 or WAR.Person[i]['护盾'] == 30 then
							SetWarMap(xx,yy,8,WAR.Person[i]['护盾贴图']*2)
							--SetWarMap(xx,yy,9,WAR.Person[i]['贴图'])
						else
							SetWarMap(xx,yy,9,WAR.Person[i]['护盾贴图']*2)	
						end	
					end	
				end
			end	
      -- 木凭 顾怜影三花视觉特效，目前给花间。该特效……文字很难解释，看视频吧
      -- 此处代码写的有点烂
      if MPTX(id,21) then
        local t1 = 3093   --对应eft文件夹里的特效帧图，t1为帧图的第一帧
        local t2 = 3111   --对应eft文件夹里的特效帧图，t2为帧图的最后一帧
        --由于虽然用了同一个特效，但三朵花的帧图不同步，故需要使用3个不同的变量来保存(如果加入新的变量，需提前定义)
        --如果多个特效能保持帧同步，只需要使用1个变量即可
        if WAR.Person[i]['护盾贴图1'] == -1 then  --第一组特效，如果没有当前帧图（刚进战斗），需要找到第一帧
          WAR.Person[i]['护盾贴图1'] = t1
        end
        if WAR.Person[i]['护盾贴图2'] == -1 then  --第一组特效，如果没有当前帧图（刚进战斗），需要找到第一帧。又由于三朵花的帧图不同步，此时第一帧选择帧图组的三分之一位置
          WAR.Person[i]['护盾贴图2'] = t1 + (t2-t1)/3
        end
        if WAR.Person[i]['护盾贴图3'] == -1 then  --第一组特效，如果没有当前帧图（刚进战斗），需要找到第一帧。又由于三朵花的帧图不同步，此时第一帧选择帧图组的三分之二位置
          WAR.Person[i]['护盾贴图3'] = t1 + (t2-t1)*2/3
        end
        WAR.Person[i]['护盾贴图1'] = WAR.Person[i]['护盾贴图1'] + 0.5  --帧图顺序自增
        WAR.Person[i]['护盾贴图2'] = WAR.Person[i]['护盾贴图2'] + 0.5
        WAR.Person[i]['护盾贴图3'] = WAR.Person[i]['护盾贴图3'] + 0.5
        if WAR.Person[i]['护盾贴图1'] > t2 then  --帧图超过最后一帧，则改为显示第一帧
          WAR.Person[i]['护盾贴图1'] = t1
        end
        if WAR.Person[i]['护盾贴图2'] > t2 then 
          WAR.Person[i]['护盾贴图2'] = t1
        end
        if WAR.Person[i]['护盾贴图3'] > t2 then 
          WAR.Person[i]['护盾贴图3'] = t1
        end
        --SetWarMap(xx-2,yy-2,9,WAR.Person[i]['护盾贴图']*2)  --此处为调整偏移，由于该特效的特殊性，故将(-2,-2)作为人物位置
        if MPDJ(id) == 1 then
          if WAR.Person[i]['护盾贴图index'] < (t2-t1)*2 then
            if WAR.Person[i]['护盾贴图index'] == 0 then
              WAR.Person[i]['护盾贴图1'] = t1
            end
            SetWarMap(xx-3,yy-3,9,WAR.Person[i]['护盾贴图1']*2)  --以(-2,-2)为中心做偏移，(-3,-3)为(-2,-2)的偏移位置，偏移向量为(-1,-1)
          elseif WAR.Person[i]['护盾贴图index'] < (t2-t1)*4 then
            if WAR.Person[i]['护盾贴图index'] == (t2-t1)*2 then
              WAR.Person[i]['护盾贴图1'] = t1
            end
            SetWarMap(xx-1,yy-3,9,WAR.Person[i]['护盾贴图1']*2)  --以(-2,-2)为中心做偏移，(-1,-3)为(-2,-2)的偏移位置，偏移向量为(1,-1)
          else
            if WAR.Person[i]['护盾贴图index'] == (t2-t1)*4 then
              WAR.Person[i]['护盾贴图1'] = t1
            end
            SetWarMap(xx-2,yy-1,9,WAR.Person[i]['护盾贴图1']*2)  --以(-2,-2)为中心做偏移，(-2,-1)为(-2,-2)的偏移位置，偏移向量为(0,1)
          end
        elseif MPDJ(id) == 2 then
          if WAR.Person[i]['护盾贴图index'] < (t2-t1)*2 then
            if WAR.Person[i]['护盾贴图index'] == 0 then
              WAR.Person[i]['护盾贴图1'] = t1
              WAR.Person[i]['护盾贴图2'] = t1 + (t2-t1)/3
            end
            SetWarMap(xx-3,yy-3,9,WAR.Person[i]['护盾贴图1']*2)  --以(-2,-2)为中心做偏移，(-3,-3)为(-2,-2)的偏移位置，偏移向量为(-1,-1)
            SetWarMap(xx-1,yy-3,9,WAR.Person[i]['护盾贴图2']*2)  --以(-2,-2)为中心做偏移，(-1,-3)为(-2,-2)的偏移位置，偏移向量为(1,-1)
          elseif WAR.Person[i]['护盾贴图index'] < (t2-t1)*4 then
            if WAR.Person[i]['护盾贴图index'] == (t2-t1)*2 then
              WAR.Person[i]['护盾贴图1'] = t1
              WAR.Person[i]['护盾贴图2'] = t1 + (t2-t1)/3
            end
            SetWarMap(xx-1,yy-3,9,WAR.Person[i]['护盾贴图1']*2)  --以(-2,-2)为中心做偏移，(-1,-3)为(-2,-2)的偏移位置，偏移向量为(1,-1)
            SetWarMap(xx-2,yy-1,9,WAR.Person[i]['护盾贴图2']*2)  --以(-2,-2)为中心做偏移，(-2,-1)为(-2,-2)的偏移位置，偏移向量为(0,1)
          else
            if WAR.Person[i]['护盾贴图index'] == (t2-t1)*4 then
              WAR.Person[i]['护盾贴图1'] = t1
              WAR.Person[i]['护盾贴图2'] = t1 + (t2-t1)/3
            end
            SetWarMap(xx-3,yy-3,9,WAR.Person[i]['护盾贴图1']*2)  --以(-2,-2)为中心做偏移，(-3,-3)为(-2,-2)的偏移位置，偏移向量为(-1,-1)
            SetWarMap(xx-2,yy-1,9,WAR.Person[i]['护盾贴图2']*2)  --以(-2,-2)为中心做偏移，(-2,-1)为(-2,-2)的偏移位置，偏移向量为(0,1)
          end
        else
          SetWarMap(xx-3,yy-3,9,WAR.Person[i]['护盾贴图1']*2)  --以(-2,-2)为中心做偏移，(-3,-3)为(-2,-2)的偏移位置，偏移向量为(-1,-1)
          SetWarMap(xx-1,yy-3,9,WAR.Person[i]['护盾贴图2']*2)  --以(-2,-2)为中心做偏移，(-1,-3)为(-2,-2)的偏移位置，偏移向量为(1,-1)
          SetWarMap(xx-2,yy-1,9,WAR.Person[i]['护盾贴图3']*2)  --以(-2,-2)为中心做偏移，(-2,-1)为(-2,-2)的偏移位置，偏移向量为(0,1)
        end
        if WAR.Person[i]['护盾贴图index'] == (t2-t1)*6 then
          WAR.Person[i]['护盾贴图index'] = 0
        else
          WAR.Person[i]['护盾贴图index'] = WAR.Person[i]['护盾贴图index'] + 1
        end
      end
    end
	end
end

function Delay(tt,x,y)
	for i = 1, tt do
		Cat('实时特效动画')
		if x ~= nil and y ~= nil then 
		   WarDrawMap(1, x, y) 
		else 
		   WarDrawMap(0) 
        end
        Cat('实时特效动画2')
		ShowScreen()
		lib.Delay(CC.BattleDelay)
	end
end

Ct['菜单'] = function(me,num,x,y,color,size,lx,color2,h)
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	local menu = {}
	local size = CC.FontSmall
	local cot = 1
	local cot1 = 0
	for i = 1,#me do 
		if me[i][3] == 1 then 
			menu[#menu+1] = {me[i][1],i}
		end
	end
	if #menu == 0 then 
		return 0 
	end	
	if num == nil then 
		num = #menu 
	else 
		if num > #menu  then 
			num = #menu
		end
	end
	while true do
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
		Cls()
		Cat('实时特效动画2')
		for i = 1,num do 
			lib.PicLoadCache(92,1*2,x+(i-1)*bx*40,y,2,255)
			local cl = C_WHITE
			if i == cot then 
				cl = C_RED
			end
			if lx == nil then
				draw2(menu[i+cot1][1],x+(i-1)*bx*40,y - size*2 , cl, size,color2,h)	
			else 
				local stn = string.len(menu[i+cot1][1])/2
				local hsize = bx*100/stn
				draw3(menu[i+cot1][1],x+(i-1)*bx*40,y - ((stn-1)*hsize+size)/2, cl, size,color2,hsize)	
			end
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			return menu[cot+cot1][2]
		elseif X == VK_ESCAPE or ktype == 4 then
			return 0
		elseif X == VK_UP then	
			
		elseif X == VK_DOWN then
			
		elseif X == VK_LEFT then
			if cot > 1 then 
				cot = cot - 1 
			else 
				if cot1 > 0 then 
					cot1 = cot1 - 1
				else 
					cot = num
					cot1 = #menu - num
				end
			end
		elseif X == VK_RIGHT then
			if cot + cot1 < #menu then 
				if cot < num then 
					cot = cot + 1
				else 
					cot1 = cot1 + 1
				end
			else 
				cot = 1
				cot1 = 0
			end		
		elseif menu[1] ~= nil and string.sub(menu[1][1],1,4) == '蓄力' and X == VK_P then 
			return 1
		elseif menu[2] ~= nil and string.sub(menu[2][1],1,4) == '防御' and X == VK_D then 
			return 2
		elseif menu[3] ~= nil and string.sub(menu[3][1],1,4) == '等待' and X == VK_W then 
			return 3
		elseif menu[4] ~= nil and string.sub(menu[4][1],1,4) == '集中' and X == VK_J then 
			return 4
		elseif menu[5] ~= nil and string.sub(menu[5][1],1,4) == '休息' and X == VK_R then 
			return 5
		else 	
			local mxx = false 
			for i = 1,#menu do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					cot = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				return menu[cot+cot1][2]
			end
		end
		
	end
end


Ct['战斗菜单'] = function()
	
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	
	local warmenu = {
					{'移动Ｍ','移动',1},
					{'武功Ａ','武功',1},
					{'绝技Ｌ','绝技',1},
					{'运功Ｇ','运功',1},
					{'战术Ｓ','战术',1},
					{'物品Ｅ','物品',1},
					{'其他Ｈ','其他',1},
					{'撤退Ｃ','撤退',1},
					{'自动Ｔ','自动',1},
					{'门派Ｏ','门派',1},
				}
	if MPPD(pid) == 0 then
		warmenu[10][3] = 0
	else
		local mptype = MPPD(pid)
		local mpdj = MPDJ(pid)
		if mpdj < 2 or JY.Person[pid]["体力"] <= 50 then
			warmenu[10][3] = 0
		end
		--if mptype == 7 then
			--if JY.Base["天书数量"] < 7 or hasthing(66) == false then
				--warmenu[10][3] = 0
			--end
		--end
	end	
	-- if match_ID(pid, 514) then
		-- JY.Person[pid]["特色指令"] = 1
	-- end
	
	
	if JY.Person[pid]["特色指令"] == 1 then
		--如果是畅想
		if GRTS[pid] ~= nil then
		    if pid == 0 and JY.Base["畅想"] > 0 then
			    --'绝技'
			    warmenu[3][1] = GRTS[JY.Base["畅想"]]..'Ｌ'
		    else
			    --'绝技'
			    warmenu[3][1] = GRTS[pid]..'Ｌ'
		    end
		end	
	else
		--'绝技'
		warmenu[3][3] = 0
	end
  
	--虚竹
	if match_ID(pid, 49) then
		--如果没有中生死符的人物则不显示特色指令
		local t = 0
		for i = 0, WAR.PersonNum - 1 do
			local wid = WAR.Person[i]["人物编号"]
			if WAR.PD["生死符"][wid] == 1 and WAR.Person[i]["死亡"] == false then
				t = 1
			end
		end
		--'绝技'
		if t == 0 then
			warmenu[3][3] = 0
		end
		--体力小于20不显示特色指令
		--'绝技'
		if JY.Person[pid]["体力"] < 20 then
			warmenu[3][3] = 0
		end
	end
  
	--祖千秋
	if match_ID(pid, 88) then
		--如果周围没有队友不显示特色指令
		local yes = 0
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 5) and i ~= WAR.CurID then
				yes = 1
			end
		end
		--'绝技'
		if yes == 0 then
			warmenu[3][3] = 0
		end
		--体力小于20不显示特色指令
		--内力小于1000不显示
		--'绝技'
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end

	--人厨子
	if match_ID(pid, 89) then
		--如果周围没有队友不显示特色指令
		local px, py = WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]
		local mxy = {
					{WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] + 1}, 
					{WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] - 1}, 
					{WAR.Person[WAR.CurID]["坐标X"] + 1, WAR.Person[WAR.CurID]["坐标Y"]}, 
					{WAR.Person[WAR.CurID]["坐标X"] - 1, WAR.Person[WAR.CurID]["坐标Y"]}}

		local yes = 0
		for i = 1, 4 do
			if GetWarMap(mxy[i][1], mxy[i][2], 2) >= 0 then
			local mid = GetWarMap(mxy[i][1], mxy[i][2], 2)
			if inteam(WAR.Person[mid]["人物编号"]) then
				yes = 1
				end
			end  
		end
		--'绝技'
		if yes == 0 then
			warmenu[3][3] = 0
		end
		--'绝技'
		--体力小于25不显示特色指令
		if JY.Person[pid]["体力"] < 25 then
			warmenu[3][3] = 0
		end
	end

	--张无忌
	if match_ID(pid, 9) then
		--如果周围没有队友不显示特色指令
		local yes = 0
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] == true and WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 8) and i ~= WAR.CurID then
				yes = 1
			end
		end
		--'绝技'
		if yes == 0 then
			warmenu[3][3] = 0
		end
		--'绝技'
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 then
			warmenu[3][3] = 0
		end
	end
 
	--霍青桐指挥指令
	if match_ID(pid, 74) then
		--体力小于10不显示特色指令
		--'绝技'
		if JY.Person[pid]["体力"] < 10 or JY.Person[pid]["内力"] < 150 or  WAR.HQT_CD > 0 then
			warmenu[3][3] = 0
		end
	end
	
	--慕容复指令 幻梦
	if match_ID(pid, 51) then
		--体力小于20不显示特色指令
		--'绝技'
		if JY.Person[pid]["体力"] < 20 then
			warmenu[3][3] = 0
		end
	end

	--小昭指令 影步
	if match_ID(pid, 66) then
		--体力小于30，或内力小于2000不显示特色指令
		--'绝技'
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 2000 then
			warmenu[3][3] = 0
		end
	end
  
	--钟灵指令 灵貂
	if match_ID(pid, 90) then
		--体力小于10不显示特色指令
		if JY.Person[pid]["体力"] < 10 then
			--'绝技'
			warmenu[3][3] = 0
		end
	end
	
	--喵姐指令 变装
	if match_ID(pid, 92) then
		--体力小于20不显示特色指令
		if JY.Person[pid]["体力"] < 20 then
			--'绝技'
			warmenu[3][3] = 0
		end
	end
	--丘机处 止杀
	if match_ID(pid, 68) then
		--体力小于20不显示特色指令
		--'绝技'
		if JY.Person[pid]["体力"] < 20 or WAR.JSZT1[pid]> 0 then
			warmenu[3][3] = 0
		end
	end	
	--胡斐指令 飞狐
	if match_ID(pid, 1) then
		--体力小于20不显示特色指令
		--'绝技'
		if JY.Person[pid]["体力"] < 20 then
			warmenu[3][3] = 0
		end
	end
	
	--鸠摩智指令 幻化
	if match_ID(pid, 103) then
		--'绝技'
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end
	
	--达尔巴指令 死战
	if match_ID(pid, 160) then
		--'绝技'
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 or WAR.SZSD ~= -1 then
			warmenu[3][3] = 0
		end
	end
	
	--金轮 龙象
	if match_ID(pid, 62) then
		--'绝技'
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end
	
	--黄蓉 遁甲
	if match_ID(pid, 56) then
		--'绝技'
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end
	
	--韦小宝 口才
	if match_ID(pid, 601) or match_ID(pid, 601) then
		--'绝技'
		if JY.Person[pid]["体力"] < 30 then
			warmenu[3][3] = 0
		end
	end
	
	--苗人凤 破军
	if match_ID(pid, 3) then
		--'绝技'
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end
	
	--何太冲 铁琴
	if match_ID(pid, 7) then
		--'绝技'
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end
	
	--方证 金身
	--'绝技'
	if match_ID(pid, 149) then
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end
	--李寻欢 飞刀
	if match_ID(pid, 498) then
		--'绝技'
		if  JY.Person[pid]["内力"] < 1000 then
			warmenu[3][3] = 0
		end
	end	
	--萧秋水 天剑
	--'绝技'
	if match_ID(pid, 652) and JY.Base["天书数量"] < 7 then
			warmenu[3][3] = 0
		end
	
	--阎基 虚弱
	if match_ID(pid, 4) then	
		--'绝技'
		if JY.Person[pid]["体力"] < 20 then
			warmenu[3][3] = 0
		end
	end
	if match_ID(pid, 514) then
		warmenu[3][3] = 1
	end
	
	--if pid == 514 or (pid==0 and JY.Base["畅想"] == 514) then	
	if match_ID(pid, 514) then	
		if JY.Person[pid]["体力"] < 20 or WAR.YBY > 0 then
			warmenu[3][3] = 0
		end
	end
------------------------------------------------------
------------------------------------------------------
	--出左右时，移动，解毒，医疗，物品，特色，自动不可见
	if WAR.ZYHB == 2 then
		for i = 1,#warmenu do
			if i == 2 or i == 4 or i == 5  then
				warmenu[i][3] = 1
			else 	
				warmenu[i][3] = 0
			end
		end
	end

	--体力小于5或者已经移动过时，移动不可见
	if JY.Person[pid]["体力"] <= 5 or WAR.Person[WAR.CurID]["移动步数"] <= 0 or WAR.PD["封印"][pid] ~= nil then
		warmenu[1][3] = 0
	end
  
	--判断最小内力，是否可显示攻击
	local minv = War_GetMinNeiLi(pid)
	if JY.Person[pid]["内力"] < minv or JY.Person[pid]["体力"] < 10 then
		warmenu[2][3] = 0
	end
	
	--特效禁止攻击
	if WAR.PD["恐惧状态"][pid] ~= nil or (WAR.PD["放下屠刀"][pid] ~= nil and math.random(10) < 5) or WAR.PD["封印"][pid] ~= nil 
	or WAR.PD['黯然・呆若木鸡'] == 2 or WAR.PD["受想行识"][pid]~= nil then
		warmenu[2][3] = 0
	end
	local menu = {}
	for i = 1,#warmenu do
		if warmenu[i][3] == 1 then 
			menu[#menu+1] = {warmenu[i][2],i,warmenu[i][1]}
		end
	end	
	local size = CC.FontSmall
	local cot = 1
	while true do 
		if JY.Restart == 1 then
			break
		end	
		Cat('实时特效动画')
        Cls()
        Cat('实时特效动画2')
		DrawTimeBar_sub()
		for i = 1,#menu do 
			lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
			local cl = C_WHITE
			if i == cot then 
				cl = C_RED
			end
			draw2(menu[i][3],bx*25+(i-1)*bx*40,CC.ScreenH-by*60 - size*2, cl, size,LimeGreen)	
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			local r
			if menu[cot][2] ~= nil then
				r = Cat(menu[cot][1])
				if r == 1 then 
					if menu[cot][2] == 1 then 
						return 1
					else 
						break
					end
				end
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			return 0
		elseif X == VK_UP then	
			
		elseif X == VK_DOWN then
			
		elseif X == VK_LEFT then
			cot = cot - 1 
			if cot < 1 then
				cot = #menu
			end
		elseif X == VK_RIGHT then
			cot = cot + 1 
			if cot > #menu then 
				cot = 1
			end
			--移动
		elseif X == VK_M then
			if warmenu[1][3] == 1 then
				local r = Cat(warmenu[1][2])
				if r == 1 then 
					return 1 
				end
			end	
			--武功
		elseif X == VK_A then
			if warmenu[2][3] == 1 then
				local r = Cat(warmenu[2][2])
				if r == 1 then 
					break
				end
			end	
			--绝技
		elseif X == VK_L then
			if warmenu[3][3] == 1 then
				local r = Cat(warmenu[3][2])
				if r == 1 then 
					break
				end
			end	
			--运功
		elseif X == VK_G then
			if warmenu[4][3] == 1 then
				local r = Cat(warmenu[4][2])
				if r == 1 then 
					break
				end
			end	
			--战术
		elseif X == VK_S then
			if warmenu[5][3] == 1 then
				local r = Cat(warmenu[5][2])
				if r == 1 then 
					break
				end
			end	
			--物品
		elseif X == VK_E then
			if warmenu[6][3] == 1 then
				local r = Cat(warmenu[6][2])
				if r == 1 then 
					if match_ID(pid,517) or match_ID(pid,525) then
					else
						Cat('遮影DH2',WAR.CurID)
					end
					break
				end
			end	
			--其他
		elseif X == VK_H then
			if warmenu[7][3] == 1 then
				local r = Cat(warmenu[7][2])
				if r == 1 then 
					break
				end
			end	
			--撤退
		elseif X == VK_C then
			if warmenu[8][3] == 1 then
				local r = Cat(warmenu[8][2])
				if r == 1 then 
					break
				end
			end	
			--自动
		elseif X == VK_T then
			if warmenu[9][3] == 1 then
				local r = Cat(warmenu[9][2])
				if r == 1 then 
					break
				end
			end
			--门派
		elseif X == VK_O then
			if warmenu[10][3] == 1 then
				local r = Cat(warmenu[10][2])
				if r == 1 then 
					break
				end
			end
		elseif X >= 49 and X <= 57 and warmenu[2][3] == 1 then
			local r = War_FightMenu(nil, nil, X-48);
			if r == 1 then 
				break
			end
		elseif X == VK_P and warmenu[5][3] == 1 then
			--local 
			if match_ID(pid,517) or match_ID(pid,525) or JXPD(pid,525,1)  then
			else
				Cat('遮影DH2',WAR.CurID)
			end
			War_ActupMenu()
			break
		elseif X == VK_D and warmenu[5][3] == 1 then
			if match_ID(pid,517) or match_ID(pid,525) or JXPD(pid,525,1)  then
			else
				Cat('遮影DH2',WAR.CurID)
			end
			War_DefupMenu()
			break
		elseif X == VK_W and warmenu[5][3] == 1 then
			if match_ID(pid,517) or match_ID(pid,525) or JXPD(pid,525,1)  then
			else
				Cat('遮影DH2',WAR.CurID)
			end
			War_Wait()
			break
		elseif X == VK_J and warmenu[5][3] == 1 then
			if match_ID(pid,517) or match_ID(pid,525) or JXPD(pid,525,1)  then
			else
				Cat('遮影DH2',WAR.CurID)
			end
			War_Focus()
			break
		elseif X == VK_R and warmenu[5][3] == 1 then
			if match_ID(pid,517) or match_ID(pid,525) or JXPD(pid,525,1)  then
			else
				Cat('遮影DH2',WAR.CurID)
			end
			War_RestMenu()
			break
		elseif X == VK_V and warmenu[7][3] == 1 then 
			local r = War_PoisonMenu()
			--解毒
				if r == 1 then 
					break
				end
		elseif X == VK_Q and warmenu[7][3] == 1 then 
			local r = War_DecPoisonMenu()
			--医疗
				if r == 1 then 
					break
				end
		elseif X == VK_F and warmenu[7][3] == 1 then 
			local r = War_DoctorMenu()
				if r == 1 then 
					break
				end
		elseif X == VK_Z and warmenu[7][3] == 1 then 
			Ckstatus()
		else 	
			local mxx = false 
			for i = 1,#menu do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					cot = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				local r
				if menu[cot][2] ~= nil then
					r = Cat(menu[cot][1])
					if r == 1 then 
						if menu[cot][2] == 1 then 
							return 1
						else 
							break
						end
					end
				end
			end
		end
		
	end
end

Ct['移动'] = function()
	if WAR.Person[WAR.CurID]["人物编号"] ~= -1 then
		WAR.ShowHead = 0
		if WAR.Person[WAR.CurID]["移动步数"] <= 0 then
		  return 0
		end
		War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
		local r = nil
		local x, y = War_SelectMove()
		if x ~= nil then
			War_MovePerson(x, y, 1)
			r = 1
		else
			r = 0
			WAR.ShowHead = 1
			Cls()
		end
		lib.GetKey()
		return r
	else
		local ydd = {}
		local n = 1
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
				ydd[n] = i
				n = n + 1
			end
		end
		local dx = ydd[math.random(n - 1)]
		local DX = WAR.Person[dx]["坐标X"]
		local DY = WAR.Person[dx]["坐标Y"]
		local YDX = {DX + 1, DX - 1, DX}
		local YDY = {DY + 1, DY - 1, DY}
		local ZX = YDX[math.random(3)]
		local ZY = YDY[math.random(3)]
		if not SceneCanPass(ZX, ZY) or GetWarMap(ZX, ZY, 2) < 0 then
		SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
		SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
		WAR.Person[WAR.CurID]["坐标X"] = ZX
		WAR.Person[WAR.CurID]["坐标Y"] = ZY
		SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
		SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
		end
	end
	return 1
end

Ct['武功'] = function()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	
	local numwugong = 0
	local kfmenu = {}
	local zs = {}

	for i = 1, JY.Base["武功数量"] do
		local tmp = JY.Person[pid]["武功" .. i] 
		if tmp > 0 then
			kfmenu[i] = {tmp, i, 1}  -- 如果是1则显示按排序i显示
	
			--内功无法攻击
			--游坦之可以	标记修改
			if (match_ID(pid, 9985) == false) and yongnei(tmp) then
				kfmenu[i][3] = 0
			end
			if secondary_wugong(tmp) then
				kfmenu[i][3] = 0
			end	
			
			--轻功无法攻击
			if JY.Wugong[tmp]["武功类型"] == 7  or (tmp == 85 or tmp == 87 or tmp == 88 or tmp == 144 or tmp == 175  or tmp == 182  or tmp == 199)then
				kfmenu[i][3] = 0
			end
			
			--斗转星移不显示
			if tmp == 43 then
				kfmenu[i][3] = 0
			end

			--如果主角是天罡，内功可攻击，畅想第一格内功可攻击
			if ((pid == 0 and JY.Base["标准"] == 6) or (pid == 0 and JY.Base["畅想"] > 0 and i == 1)) and JY.Wugong[tmp]["武功类型"] == 6 then
				kfmenu[i][3] = 1
			end
			--林平之 东方 萧半和 显示葵花神功
			if tmp == 105 and (match_ID(pid, 36) or match_ID(pid, 27) or match_ID(pid, 189) or match_ID(pid, 777))  then
				kfmenu[i][3] = 1
			end
		   
			--石破天 显示太玄神功
			if tmp == 102 and JXPD(pid, 38, 1) then
				kfmenu[i][3] = 1
			end
		  
			--张无忌 显示九阳神功
			if tmp == 106 and match_ID(pid, 9) then
				kfmenu[i][3] = 1
			end
			--斗酒僧 显示九阳神功
			if tmp == 106 and (match_ID(pid, 638) or match_ID(pid,9999)) then
				kfmenu[i][3] = 1
			end			
		  
			--狄云 显示神经照
			if tmp == 94 and match_ID(pid, 37) then
				kfmenu[i][3] = 1
			end
		  
			--[[--慕容复 显示斗转星移
			if tmp == 43 and (match_ID(pid, 51) or match_ID(pid, 679)) then
				kfmenu[i][3] = 1
			end--]]
		  
			--欧阳锋 显示逆运
			if tmp == 104 and match_ID(pid, 60) then
				kfmenu[i][3] = 1
			end

			--小昭 显示圣火
			if tmp == 93 and match_ID(pid, 66) then
				kfmenu[i][3] = 1
			end
		  
			--内力少不显示
			if JY.Person[pid]["内力"] < JY.Wugong[tmp]["消耗内力点数"] then
				kfmenu[i][3] = 0
			end

			--体力低于10不显示
			if JY.Person[pid]["体力"] < 10 then
				kfmenu[i][3] = 0
			end			  
			numwugong = numwugong + 1		  
		end
	end
	
	
	local menu = {}
	local tmp = 0
	for ai = 1, JY.Base["武功数量"] do
		tmp = JY.Person[pid]["武功"..ai]
	end
	for i = 1,#kfmenu do --查找kfmenu表
		if kfmenu[i][3] == 1 then  --如果表中第三项等于1则
			menu[#menu+1] = {kfmenu[i][1],i} -- menu表添加1个等于kfneu表中1项
		end
	end	
	
	if #menu == 0 then
		return 0
	end
	local num = 15
	if num > #menu then 
		num = #menu 
	end	

	local size = CC.FontSmall--*0.95
	local cot = 1
	local cot1 = 0
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
		Cls()
		Cat('实时特效动画2')
		for i = 1,num do 
			lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
			local cl = C_WHITE
			if i == cot then 
				cl = C_RED
			end
			local stn = string.len(JY.Wugong[menu[i+cot1][1]]['名称'])/2
			local hsize = bx*100/stn
			draw3(JY.Wugong[menu[i+cot1][1]]['名称'],bx*25+(i-1)*bx*40,CC.ScreenH-by*60- ((stn-1)*hsize+size)/2, cl, size,nil,hsize)
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
--[[			if CC.KFMove[tmp] ~= nil then
				return Cat("武功招式")
			else
				return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
			end	--]]
			return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
			--return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
			--return Cat("武功招式")
		elseif X == VK_ESCAPE or ktype == 4 then
			return 0
		elseif X == VK_UP then	
			
		elseif X == VK_DOWN then
			
		elseif X == VK_LEFT then
			if cot > 1 then 
				cot = cot - 1 
			else 
				if cot1 > 0 then 
					cot1 = cot1 - 1
				else 
					cot = num
					cot1 = #menu - num
				end
			end
		elseif X == VK_RIGHT then
			if cot + cot1 < #menu then 
				if cot < num then 
					cot = cot + 1
				else 
					cot1 = cot1 + 1
				end
			else 
				cot = 1
				cot1 = 0
			end	
		elseif X >= 49 and X <= 57 then
			local r = War_FightMenu(nil, nil, X-48);
			if r == 1 then 
				return 1
			end
		else 	
			local mxx = false 
			for i = 1,#menu do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					cot = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				--return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
--[[				if CC.KFMove[tmp] ~= nil then
					return Cat("武功招式")
				else
					return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
				end--]]
				return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])	
			end
		end
		
	end
end

Ct['武功招式'] = function()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 	
	WAR.WGZS = 0
	local size = CC.DefaultFont
	local id = WAR.Person[WAR.CurID]["人物编号"]
	--local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local choice = 1
	local size = CC.FontSmall
	while true do
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
    Cls()
		Cat('实时特效动画2')
		local zs = {}
		local zs =CC.KFMove[102]
		local wg = 0
		for a = 1,JY.Base["武功数量"] do
			wg = JY.Person[id]["武功"..a]
		end
		if CC.KFMove[wg] ~= nil then
			local zs =CC.KFMove[wg]
			for i = 1, #zs do
				--lib.LoadPNG(91, 17 * 2 , 510, 118+i*50, 1)
				lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
				lib.LoadPNG(91, 64 * 2 ,bx, by*427, 1)
				local color = C_WHITE
				local color = C_WHITE
				if i == choice then
					color = C_RED
				end
				local namelen = string.len(zs[i][1]) / 2
				local stn = string.len(zs[i][1]) / 2
				local hsize = bx*100/stn			
				draw3(zs[i][1],bx*25+(i-1)*bx*40,CC.ScreenH-by*60- ((stn-1)*hsize+size)/2, color, size,nil,hsize)			
			end
			DrawString(bx*20, by*460, "招式气攻："..CC.KFMove[wg][choice][2], C_WHITE, size)
			ShowScreen()
        	if CC.KFMove[wg][choice][3] ~= nil then
				DrawString(bx*20, by*400, CC.KFMove[wg][choice][3], C_WHITE, size*0.8)
			end			
			lib.Delay(CC.BattleDelay)
			local keyPress, ktype, mx, my = lib.GetKey();
			if keyPress==VK_SPACE or keyPress==VK_RETURN then
				break
			elseif keyPress == VK_UP or keyPress == VK_LEFT then
				choice = choice - 1
				if choice < 1 then
					choice = #zs
				end
			elseif keyPress == VK_DOWN or keyPress == VK_RIGHT then
				choice = choice + 1
				if choice > #zs then
					choice = 1
				end
			elseif keyPress >= 49 and keyPress <= 57 then
				local input = keyPress - 48
				if input <= #zs then
					choice = input
					break
				end
			else 	
				local mxx = false 
				for i = 1,#zs do 
					if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
						my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
						choice = i 
						mxx = true
						break
					end
				end
				if ktype == 3 and mxx == true then
					--return War_Fight_Sub(WAR.CurID, 48)			
				end
			end	
		end
	end
	WAR.WGZS = choice
	return
end


Ct['绝技'] = function()
	return War_TgrtsMenu()
end

Ct['运功'] = function()
	return War_YunGongMenu()
end

Ct['战术'] = function()
	return War_TacticsMenu()
end

Ct['其他'] = function()
	return War_OtherMenu()
end

Ct['物品'] = function()
	return War_ThingMenu()
end

Ct['撤退'] = function()
	return War_Retreat()
end

Ct['自动'] = function()
	return War_AutoMenu()
end
--门派
Ct['门派'] = function()
	return War_MPMenu()
end

function Ckstatus()
--function MapWatch()
 --WAR.ShowHead = 0
	local x = WAR.Person[WAR.CurID]["坐标X"];
	local y = WAR.Person[WAR.CurID]["坐标Y"];
	local page = 1

	War_CalMoveStep(WAR.CurID,255,1)
	Cat('实时特效动画')
    WarDrawMap(1,x,y);	
    Cat('实时特效动画2')
	ShowScreen()
	lib.Delay(CC.BattleDelay)
	x,y = War_SelectMove()
	if x == nil then
		return
	end
	local i
	local id = -1
	for i = 0,WAR.PersonNum-1 do
		if WAR.Person[i]["坐标X"] == x and WAR.Person[i]["坐标Y"] == y and WAR.Person[i]["死亡"] == false then
			id =  i-- WAR.Person[i]["人物编号"]
			break;
		end
	end

	if id >= 0 and WAR.Person[id]["我方"] == true then
		--Cat('显示状态',id,page)
		--ShowPersonStatus(id)
		--PersonStatus(WAR.Person[id]["人物编号"])
		PersonStatus(id)
	--	say("我方",0,1)
	elseif id >= 0 and WAR.Person[id]["我方"] == false then
		--PersonStatusA(WAR.Person[id]["人物编号"])
		PersonStatus(id)
		--PersonStatusA(id)
	--	say("敌方",0,1)
	else
		do return end
	end

--end
end

--护盾停止
Ct['护盾停止'] = function(i)
	WAR.Person[i]['护盾'] = -1
	WAR.Person[i]['护盾贴图'] = -1
	WAR.Person[i]['护盾贴图1'] = -1
	WAR.Person[i]['护盾贴图2'] = -1
	WAR.Person[i]['护盾贴图3'] = -1
	WAR.Person[i]['护盾贴图index'] = 0
    WAR.Person[i]['护盾延迟'] = nil
    --自动循环判定是否存在其他护盾，防止一个护盾被破其他护盾还存在
    if WAR.Person[i]['护盾'] == nil or WAR.Person[i]['护盾'] == -1 then
        local id = WAR.Person[i]['人物编号']
        for j = 1,#CC.HD do 
            local hname = CC.HD[j].name
            if WAR.PD[hname] ~= nil then 
                if WAR.PD[hname][id] ~= nil then 
                    WAR.Person[i]['护盾'] = j
                    break
                end
            end
        end
    end
end

Ct['神游太虚'] = function(x,y)
	local id = WAR.Person[WAR.CurID]['人物编号']
	local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
	PlayWavE(5)
	CurIDTXDH(WAR.CurID, 129,1,'神游太虚')
	lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
    lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	--WarDrawMap(0)
	--CurIDTXDH(WAR.CurID, 129,1)
	WAR.Person[WAR.CurID]["人方向"] = War_Direct(x0, y0, x, y)
	WAR.Person[WAR.CurID]["贴图"] = WarCalPersonPic(WAR.CurID)
	WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = x, y
	WarDrawMap(0)
	--CurIDTXDH(WAR.CurID, 129,1)
	lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	lib.SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	--WarDrawMap(0)
	CurIDTXDH(WAR.CurID, 129,1,'神游太虚')
end

Ct['神游太虚2'] = function(flag)
	if flag == nil then
		local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
		WAR.PD['神游太虚'] = {}
		for j = 0,WAR.PersonNum - 1 do 
			local mid = WAR.Person[j]['人物编号']
			local zbx,zby = WAR.Person[j]['坐标X'],WAR.Person[j]['坐标Y']
			local mx = WAR.Person[j]['人方向']
			local zm = false
			--为啥这么麻烦？我想看看中间的概率
			local a = math.random(10)
			if mx == 0 then 
				if y0 < zby then
					if math.abs(x0-zbx) - math.abs(y0-zby) >= 1 then
						if (a < 8 and a > 4) or BNJQ(mid) then 
							zm = true
						end
					else
						zm = true
					end
				end
			elseif mx == 1 then 
				if x0 > zbx then 
					if math.abs(y0-zby) - math.abs(x0-zbx) >= 1 then 
						if (a < 8 and a > 4) or BNJQ(mid) then
							zm = true
						end
					else
						zm = true
					end
				end
			elseif mx == 2 then 
				if x0 < zbx then 
					if math.abs(y0-zby) - math.abs(x0-zbx) >= 1 then 
						if (a < 8 and a > 4) or BNJQ(mid) then
							zm = true
						end
					else
						zm = true
					end
				end
			elseif mx == 3 then 
				if y0 > zby then 
					if math.abs(x0-zbx) - math.abs(y0-zby) >= 1 then 
						if (a < 8 and a > 4) or BNJQ(mid) then
							zm = true
						end
					else
						zm = true
					end
				end
			end
			--夜雨楼如影随形特效
			if WAR.Person[j]['死亡'] == false and j ~= WAR.CurID then
				if WAR.PD['遮影'][mid] ~= nil then 
					WAR.PD['神游太虚'][mid] = {}
					WAR.PD['神游太虚'][mid].hp = JY.Person[mid]['生命']
					WAR.PD['神游太虚'][mid].nl = JY.Person[mid]['内力']
					WAR.PD['神游太虚'][mid].tl = JY.Person[mid]['体力']
					WAR.PD['神游太虚'][mid].zd = JY.Person[mid]['中毒程度']
					WAR.PD['神游太虚'][mid].ns = JY.Person[mid]['受伤程度']
					WAR.PD['神游太虚'][mid].bs = JY.Person[mid]['冰封程度']
					WAR.PD['神游太虚'][mid].zs = JY.Person[mid]['灼烧程度']
					WAR.PD['神游太虚'][mid]['生命点数'] = WAR.Person[j]['生命点数']
					WAR.PD['神游太虚'][mid]['内力点数'] = WAR.Person[j]['内力点数']
					WAR.PD['神游太虚'][mid]['体力点数'] = WAR.Person[j]['体力点数']
					WAR.PD['神游太虚'][mid]['中毒点数'] = WAR.Person[j]["中毒点数"];
					WAR.PD['神游太虚'][mid]['内伤点数'] = WAR.Person[j]["内伤点数"];
					for k,v in pairs(WAR) do 
						if k ~= 'Person' and k ~= 'Data' then
							local t = type(WAR[k])
							if t == 'table' then
								WAR.PD['神游太虚'][mid][k] = WAR[k][mid]
							end
						end
					end
					WAR.Person[j]['神游太虚'] = 2
				else
					if zm == true and match_ID(mid,9976) then 
						WAR.PD['神游太虚'][mid] = {}
						WAR.PD['神游太虚'][mid].hp = JY.Person[mid]['生命']
						WAR.PD['神游太虚'][mid].nl = JY.Person[mid]['内力']
						WAR.PD['神游太虚'][mid].tl = JY.Person[mid]['体力']
						WAR.PD['神游太虚'][mid].zd = JY.Person[mid]['中毒程度']
						WAR.PD['神游太虚'][mid].ns = JY.Person[mid]['受伤程度']
						WAR.PD['神游太虚'][mid].bs = JY.Person[mid]['冰封程度']
						WAR.PD['神游太虚'][mid].zs = JY.Person[mid]['灼烧程度']
						WAR.PD['神游太虚'][mid]['生命点数'] = WAR.Person[j]['生命点数']
						WAR.PD['神游太虚'][mid]['内力点数'] = WAR.Person[j]['内力点数']
						WAR.PD['神游太虚'][mid]['体力点数'] = WAR.Person[j]['体力点数']
						WAR.PD['神游太虚'][mid]['中毒点数'] = WAR.Person[j]["中毒点数"];
						WAR.PD['神游太虚'][mid]['内伤点数'] = WAR.Person[j]["内伤点数"];
						for k,v in pairs(WAR) do 
							if k ~= 'Person' and k ~= 'Data' then
								local t = type(WAR[k])
								if t == 'table' then
									WAR.PD['神游太虚'][mid][k] = WAR[k][mid]
								end
							end
						end
						WAR.Person[j]['神游太虚'] = 1
					end
				end
			end
		end
	else 
		for j = 0,WAR.PersonNum - 1 do 
			local mid = WAR.Person[j]['人物编号']
			local zbx,zby = WAR.Person[j]['坐标X'],WAR.Person[j]['坐标Y']
      --木凭 注释神游太虚
			if WAR.Person[j]['死亡'] == false and (match_ID(mid,9976) --[[ or match_ID(mid,763)]]) and WAR.Person[j]['神游太虚'] == 1 and (GetWarMap(zbx,zby,4) > 1 or WAR.TXXS[mid] ~= nil) then
				if WAR.PD['神游太虚'][mid] ~= nil then
					WAR.Person[j]["特效动画"] = -1
					WAR.Person[j]["特效文字0"] = nil
					WAR.Person[j]["特效文字1"] = nil
					WAR.Person[j]["特效文字2"] = nil
					WAR.Person[j]["特效文字3"] = nil
					WAR.Person[j]["特效文字4"] = nil
					JY.Person[mid]['生命'] = WAR.PD['神游太虚'][mid].hp
					JY.Person[mid]['内力'] = WAR.PD['神游太虚'][mid].nl
					JY.Person[mid]['体力'] = WAR.PD['神游太虚'][mid].tl
					JY.Person[mid]['中毒程度'] = WAR.PD['神游太虚'][mid].zd 
					JY.Person[mid]['受伤程度'] = WAR.PD['神游太虚'][mid].ns 
					JY.Person[mid]['冰封程度'] = WAR.PD['神游太虚'][mid].bs 
					JY.Person[mid]['灼烧程度'] = WAR.PD['神游太虚'][mid].zs 
					WAR.Person[j]['生命点数'] = WAR.PD['神游太虚'][mid]['生命点数']
					WAR.Person[j]['内力点数'] = WAR.PD['神游太虚'][mid]['内力点数']
					WAR.Person[j]['体力点数'] = WAR.PD['神游太虚'][mid]['体力点数']
					WAR.Person[j]['中毒点数'] = WAR.PD['神游太虚'][mid]['中毒点数']
					WAR.Person[j]['内伤点数'] = WAR.PD['神游太虚'][mid]['内伤点数']
					for k,v in pairs(WAR) do
						if k ~= 'Person' and k ~= 'Data' then
							local t = type(WAR[k])
							if t == 'table' then
								WAR[k][mid] = WAR.PD['神游太虚'][mid][k]
							end
						end
					end
					if WAR.Person[j]['神游太虚'] == 1 then
						WAR.Person[j]["特效文字3"] = "神游太虚"
						WAR.Person[j]["特效动画"] = 129
					end
					if WAR.Person[j].TimeAdd ~= nil and WAR.Person[j].TimeAdd < 0 then 
						WAR.Person[j].TimeAdd = 0
					end
					WAR.Person[j]['神游太虚'] = nil
					SetWarMap(zbx,zby,4,0)
					WAR.TXXS[mid] = nil
				end
			end
		end
		WAR.PD['神游太虚'] = {}
	end
end

--木凭 顾影自怜：被攻击集气位置+300，并减少对方10体力，免疫集气减少，免疫(资质/14)格内伤害
Ct['顾影自怜'] = function(flag)
	if flag == nil then
		for j = 0,WAR.PersonNum - 1 do 
			local mid = WAR.Person[j]['人物编号']
      WAR.PD['顾影自怜'] = {}
      WAR.PD['顾影自怜'][mid] = {}
      WAR.PD['顾影自怜'][mid].hp = JY.Person[mid]['生命']
      WAR.PD['顾影自怜'][mid].nl = JY.Person[mid]['内力']
      WAR.PD['顾影自怜'][mid].tl = JY.Person[mid]['体力']
      WAR.PD['顾影自怜'][mid].zd = JY.Person[mid]['中毒程度']
      WAR.PD['顾影自怜'][mid].ns = JY.Person[mid]['受伤程度']
      WAR.PD['顾影自怜'][mid].bs = JY.Person[mid]['冰封程度']
      WAR.PD['顾影自怜'][mid].zs = JY.Person[mid]['灼烧程度']
      WAR.PD['顾影自怜'][mid]['生命点数'] = WAR.Person[j]['生命点数']
      WAR.PD['顾影自怜'][mid]['内力点数'] = WAR.Person[j]['内力点数']
      WAR.PD['顾影自怜'][mid]['体力点数'] = WAR.Person[j]['体力点数']
      WAR.PD['顾影自怜'][mid]['中毒点数'] = WAR.Person[j]["中毒点数"]
      WAR.PD['顾影自怜'][mid]['内伤点数'] = WAR.Person[j]["内伤点数"]
      for k,v in pairs(WAR) do 
        if k ~= 'Person' and k ~= 'Data' then
          local t = type(WAR[k])
          if t == 'table' then
            WAR.PD['顾影自怜'][mid][k] = WAR[k][mid]
          end
        end
      end
    end
  else
		for j = 0,WAR.PersonNum - 1 do 
			local mid = WAR.Person[j]['人物编号']
      if j ~= WAR.CurID and match_ID(mid, 763) and WAR.PD['顾影自怜'][mid] ~= nil and (inteam(mid) == false or JXPD(mid,763,2)) then
        Set_Eff_Text(j, "特效文字1", "顾影自怜")
        if RealJL(j, WAR.CurID,JY.Person[mid]['资质']/14) then	
					JY.Person[mid]['生命'] = WAR.PD['顾影自怜'][mid].hp
          JY.Person[mid]['内力'] = WAR.PD['顾影自怜'][mid].nl
          JY.Person[mid]['体力'] = WAR.PD['顾影自怜'][mid].tl
          JY.Person[mid]['中毒程度'] = WAR.PD['顾影自怜'][mid].zd
          JY.Person[mid]['受伤程度'] = WAR.PD['顾影自怜'][mid].ns
          JY.Person[mid]['冰封程度'] = WAR.PD['顾影自怜'][mid].bs
          JY.Person[mid]['灼烧程度'] = WAR.PD['顾影自怜'][mid].zs
          WAR.Person[j]['生命点数'] = WAR.PD['顾影自怜'][mid]['生命点数']
          WAR.Person[j]['内力点数'] = WAR.PD['顾影自怜'][mid]['内力点数']
          WAR.Person[j]['体力点数'] = WAR.PD['顾影自怜'][mid]['体力点数']
          WAR.Person[j]['中毒点数'] = WAR.PD['顾影自怜'][mid]['中毒点数']
          WAR.Person[j]['内伤点数'] = WAR.PD['顾影自怜'][mid]['内伤点数']
          for k,v in pairs(WAR) do
            if k ~= 'Person' and k ~= 'Data' then
              local t = type(WAR[k])
              if t == 'table' then
                WAR[k][mid] = WAR.PD['顾影自怜'][mid][k]
              end
            end
          end
        end
      end
    end
		WAR.PD['顾影自怜'] = {}
  end
end

Ct['背刺侧攻'] = function(flag)
	if flag == nil then
		local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
		--WAR.PD['神游太虚'] = {}
		local zm = 0--侧攻1背刺2
		for j = 0,WAR.PersonNum - 1 do 
			local mid = WAR.Person[j]['人物编号']
			local zbx,zby = WAR.Person[j]['坐标X'],WAR.Person[j]['坐标Y']
			local mx = WAR.Person[j]['人方向']
			
			
			--为啥这么麻烦？我想看看中间的概率
			--local a = math.random(10)
			if mx == 0 then 
				if y0 > zby and (GetWarMap(zbx,zby,4) > 1 or WAR.TXXS[mid] ~= nil) then
					if math.abs(x0-zbx) - math.abs(y0-zby) >= 1 then
						zm = 1
					else
						zm = 2
					end
				end
			elseif mx == 1 and (GetWarMap(zbx,zby,4) > 1 or WAR.TXXS[mid] ~= nil) then 
				if x0 < zbx then 
					if math.abs(y0-zby) - math.abs(x0-zbx) >= 1 then 
						zm = 1
					else
						zm = 2
					end
				end
			elseif mx == 2 and (GetWarMap(zbx,zby,4) > 1 or WAR.TXXS[mid] ~= nil) then 
				if x0 > zbx then 
					if math.abs(y0-zby) - math.abs(x0-zbx) >= 1 then 
						zm = 1
					else
						zm = 2
					end
				end
			elseif mx == 3 and (GetWarMap(zbx,zby,4) > 1 or WAR.TXXS[mid] ~= nil) then 
				if y0 < zby then 
					if math.abs(x0-zbx) - math.abs(y0-zby) >= 1 then 
						zm = 1
					else
						zm = 2
					end
				end
			end
		end
		return zm
	end
end	

--战场攻击力
function Atk(i)
	local id = WAR.Person[i]['人物编号']
	local gj = 0
	local xs = 0
	gj = gj + JY.Person[id]['攻击力']
    gj = gj + limitX((JY.Person[id]['内力'] - JY.Person[id]['资质']*10)/50,0)
	--NPC的装备不带等级
	if isteam(id) then
		local jc = 1
		if MPTX(id,2) or (PersonKF(id,203) and PersonKF(id,248) and PersonKF(id,99)) then
			jc = 2
		end	
		if JY.Person[id]["武器"] >= 0 then
			gj = gj + JY.Thing[JY.Person[id]["武器"]]["加攻击力"]*10+JY.Thing[JY.Person[id]["武器"]]["加攻击力"]*(JY.Thing[JY.Person[id]["武器"]]["装备等级"]-1)*jc
		end
		if JY.Person[id]["防具"] >= 0 then
			gj = gj + JY.Thing[JY.Person[id]["防具"]]["加攻击力"]*10+JY.Thing[JY.Person[id]["防具"]]["加攻击力"]*(JY.Thing[JY.Person[id]["防具"]]["装备等级"]-1)*jc
		end
		if JY.Person[id]["坐骑"] >= 0 then
			gj = gj + JY.Thing[JY.Person[id]["坐骑"]]["加攻击力"]*10+JY.Thing[JY.Person[id]["坐骑"]]["加攻击力"]*(JY.Thing[JY.Person[id]["坐骑"]]["装备等级"]-1)*jc
		end		
	else
		local jc = 2
		if MPTX(id,2) or (PersonKF(id,203) and PersonKF(id,248) and PersonKF(id,99)) then
			jc = 3
		end
		if JY.Person[id]["武器"] >= 0 then
			gj = gj + JY.Thing[JY.Person[id]["武器"]]["加攻击力"]*20+JY.Thing[JY.Person[id]["武器"]]["加攻击力"]*(JY.Thing[JY.Person[id]["武器"]]["装备等级"]+1)*jc
		end
		if JY.Person[id]["防具"] >= 0 then
			gj = gj + JY.Thing[JY.Person[id]["防具"]]["加攻击力"]*20+JY.Thing[JY.Person[id]["防具"]]["加攻击力"]*(JY.Thing[JY.Person[id]["防具"]]["装备等级"]+1)*jc
		end
		if JY.Person[id]["坐骑"] >= 0 then
			gj = gj + JY.Thing[JY.Person[id]["坐骑"]]["加攻击力"]*20+JY.Thing[JY.Person[id]["坐骑"]]["加攻击力"]*(JY.Thing[JY.Person[id]["坐骑"]]["装备等级"]+1)*jc
		end	
	end
	--[[if JY.Status ~= GAME_WMAP then
		if gj ~= nil and gj > 0 then
			return gj
		else
			return 1
		end
		return 1
	end	--]]
	if JY.Status == GAME_WMAP then
		--for wid = 0, WAR.PersonNum - 1 do
		if gj ~= nil then
			--妖风祸世
			if YaoFengHuoShi(id) then
				local a = 0
				for j = 0, WAR.PersonNum-1 do
					if WAR.Person[j]["死亡"] == false then
						local jid = WAR.Person[j]["人物编号"]
						if psx(jid,"攻击力") > a then
							a = psx(jid,'攻击力')
						end
					end
				end
				if a > gj then
					gj = a
				end
			end	
			--林殊
			if match_ID(id, 508) then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == false then
						gj = gj + 100
					end
				end		
			end
			--队友攻击力加成
			for i,v in pairs(CC.AddAtk) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["人物编号"], v[2]) and WAR.Person[wid]["死亡"] == false then
							gj = gj + v[3]
						end
					end
				end
			end
			--五岳剑派
			if PersonKF(id,263) then
				gj = gj + 50
			end
			--武穆遗书 标记修改
			if Curr_NG(id, 199) then	
				local sz=0
				sz = math.modf(JY.Person[id]["实战"]/2)
				if not inteam(id) then
					sz = 1000
				end
				gj = gj + sz
			end
			--血淬
			if WAR.PD['血淬'][id] ~= nil and WAR.PD['血淬'][id] > 0 then
		        gj = gj + WAR.PD['血淬'][id]
			end
			if WAR.PD['白驼蛇蛊'][id] ~= nil and WAR.PD['白驼蛇蛊'][id] > 0 then 
				local zd = 300 - JY.Person[id]["中毒程度"]
				local ns = 150 - JY.Person[id]["受伤程度"]
				local zs = 150 - JY.Person[id]["灼烧程度"]
				local bf = 150 - JY.Person[id]["冰封程度"]
				local lx = 150 - JY.Person[id]["流血程度"]
				local fx = 100 - JY.Person[id]["封穴程度"]
				local gj1 = zd + ns + bf + lx + fx
				gj = gj - gj1	
			end
			--八荒降龙
			if WAR.PD['升龙天威'][id] ~= nil then
				gj = gj - 800
			end
			--易水四寒
			if (WAR.PD['易水四寒'][id] == 2 or WAR.PD['易水四寒'][id] == 5) then
				gj = gj - psx(id,'冰封程度')
			end
			--玄铁剑创
			if WAR.PD['玄铁剑创'][id] ~= nil and WAR.PD['玄铁剑创'][id] > 0 then
				gj = gj - 5 * (WAR.PD['玄铁剑创'][id] or 0)
			end
			if gj < 1 then gj = 1 end
			--霍青桐
			if match_ID(id, 74) then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == true then
						xs = xs + 0.1
					end
				end
			end
			--易筋经
			if PersonKF(id,108) or Curr_NG(id,263) then 
				xs = xs + 0.1
			end
			--黑级
			if match_ID(id, 9930) then 
				xs = xs + 0.3
			end
			--杀破狼
			if match_ID(id, 112) and WAR.XYS > 0 then	--萧远山杀破狼基础轻功*1.5
				xs = xs + 0.5
			end
			--天人合一
			if  WAR.PD['西瓜刀・天人'][id] ~= nil then 
				xs = xs + 0.2
			end
			--战神状态
			if  WAR.PD['战神状态'][id] ~= nil  then
				xs = xs + 0.5
			end
			--黯然
			if  PersonKF(id,25) and ((Curr_NG(id,252) and PersonKF(id,104)) or match_ID(id,58))  then
				if WAR.NYAR > 0 then
					xs = xs + WAR.NYAR
				end	
			end
			--易水四寒
			if (WAR.PD['易水四寒2'][id] == 5 or WAR.PD['雪羽战神'][id] == 1) then
				xs = xs + 2.5
			end
			if xs > 1 then gj = gj*(1+xs) end
			if WAR.PD['命无常'][id] ~= nil then
				gj = math.modf(gj*0.01)
			end
			--东方不败
			if WAR.PD['含苞'][id] ~= nil then
				gj =  math.modf(gj*0.2)
			end
			if WAR.PD['金刚指断肢'][id] ~= nil and WAR.PD['金刚指断肢'][id] > 0 then
				WAR.PD['金刚指断肢'][id] = limitX(WAR.PD['金刚指断肢'][id],1,4)
				local jg = WAR.PD['金刚指断肢'][id]
				local s = {0.75,0.5,0.25,0}
				gj = math.modf(gj*s[jg])
			end		
			if WAR.PD['玄冥玄毒'][id] ~= nil then
				local a = WAR.PD['玄冥玄毒'][id] * 0.02
				gj = limitX(math.modf(gj*(1-a)),0,gj)
			end	
			--桃花八门
			if WAR.PD["八门金锁1"][id] ~= nil then 
				gj = 1
			end
			--辟邪剑法
			if WAR.PD['辟邪断刃'][id] ~= nil then
			   gj = 1
			end
			--白首太玄
			if match_ID(id, 9927) and  JY.Person[id]['资质'] <= 50 then 
				if gj < 1500 then
					gj = 1500
				end
			end
			if inteam(id) and (match_ID(id, 9927) == false and JY.Person[id]['资质'] >50) then
				local limit = 2000
				gj = limitX(math.modf(gj),1,limit)
			else
				gj = limitX(math.modf(gj),1,2000 + JY.Base["周目"]*JY.Base["难度"]*5)
			end	
		else
			gj = 1
		end	
	end	
	return gj
end

--战场防御力
function Def(i)
	local id = WAR.Person[i]['人物编号']
	local fy = 0 
	local xs = 0
	fy = fy + JY.Person[id]['防御力']
    fy = fy + limitX((JY.Person[id]['内力'] - JY.Person[id]['资质']*10)/50,0)
	--套装
	if isteam(id) then
	    local n = 1
	    if MPTX(id,2) or (PersonKF(id,203) and PersonKF(id,248) and PersonKF(id,99)) then
		    n = 2
	    end
	    if JY.Person[id]["武器"] >= 0 then	
		    fy = fy + JY.Thing[JY.Person[id]["武器"]]["加防御力"]*10+JY.Thing[JY.Person[id]["武器"]]["加防御力"]*(JY.Thing[JY.Person[id]["武器"]]["装备等级"]-1)*n
	    end
	    if JY.Person[id]["防具"] >= 0 then
		    fy = fy + JY.Thing[JY.Person[id]["防具"]]["加防御力"]*10+JY.Thing[JY.Person[id]["防具"]]["加防御力"]*(JY.Thing[JY.Person[id]["防具"]]["装备等级"]-1)*n
	    end
	    if JY.Person[id]["坐骑"] >= 0 then
		    fy = fy + JY.Thing[JY.Person[id]["坐骑"]]["加防御力"]*10+JY.Thing[JY.Person[id]["坐骑"]]["加防御力"]*(JY.Thing[JY.Person[id]["坐骑"]]["装备等级"]-1)*n
	    end		
    else
	    local n = 2
	    if MPTX(id,2) or (PersonKF(id,203) and PersonKF(id,248) and PersonKF(id,99)) then
		    n= 3
	    end
	    if JY.Person[id]["武器"] >= 0 then
		    fy = fy + JY.Thing[JY.Person[id]["武器"]]["加防御力"]*20+JY.Thing[JY.Person[id]["武器"]]["加防御力"]*(JY.Thing[JY.Person[id]["武器"]]["装备等级"]+1)*n
	    end
	    if JY.Person[id]["防具"] >= 0 then
		    fy = fy + JY.Thing[JY.Person[id]["防具"]]["加防御力"]*20+JY.Thing[JY.Person[id]["防具"]]["加防御力"]*(JY.Thing[JY.Person[id]["防具"]]["装备等级"]+1)*n
	    end
	    if JY.Person[id]["坐骑"] >= 0 then
		    fy = fy + JY.Thing[JY.Person[id]["坐骑"]]["加防御力"]*20+JY.Thing[JY.Person[id]["坐骑"]]["加防御力"]*(JY.Thing[JY.Person[id]["坐骑"]]["装备等级"]+1)*n
	    end		
    end
	if JY.Status == GAME_WMAP then
		if fy ~= nil then
			--妖风祸世
			if YaoFengHuoShi(id) then
				local a = 0
				for j = 0, WAR.PersonNum-1 do
					if WAR.Person[j]["死亡"] == false then
						local jid = WAR.Person[j]["人物编号"]
						if psx(jid,"防御力") > a then
							a = psx(jid,'防御力')
						end
					end
			    end
				if a > fy then
					fy = a
				end
			end
			--林殊
			if match_ID(id, 508) then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == false then
						fy = fy + 100
					end
				end	
			end	
			--龟息周天增加防御	
			if WAR.GXZT[id]~= nil and NGQHB(id,190) then    
				fy = fy + WAR.GXZT[id]	
			end
			--阿青
			if match_ID(id, 604) or match_ID(id, 9805) then
				fy = fy + TrueYJ(id)
			end
			--武穆遗书 标记修改
			if Curr_NG(id, 199) then
				local sz=0
				sz=math.modf(JY.Person[id]["实战"]/2)
				if not inteam(id) then
					sz = 1000
				end
				fy = fy + sz
			end
			--朝廷攻防轻
			if MPTX(id,23) then
				local sz = math.modf(JY.Person[id]["实战"] / 3)
				fy = fy + sz
			end
			--太极蓄力增加防御
			if Curr_NG(id,171) and WAR.PD["太极蓄力"][id] ~= nil then
				fy = fy + WAR.PD["太极蓄力"][id]
			end
			--五岳剑诀
			if PersonKF(id,264) then
				fy = fy + 50
			end
			--队友防御力加成
			for i,v in pairs(CC.AddDef) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["人物编号"], v[2]) and WAR.Person[wid]["死亡"] == false then
							fy = fy + v[3]
						end
					end 
			    end
		    end
			--血淬
			if WAR.PD['血淬'][id] ~= nil and WAR.PD['血淬'][id] > 0 then
		        fy = fy + WAR.PD['血淬'][id]
			end
			if DAOQX(id,'千铸仞') >= 1 then
				fy = fy + math.modf(TrueSD(id)*DAOQX(id,'千铸仞')*0.1)
			end
			if WAR.PD['升龙天威'][id] ~= nil then
				fy = fy - 800
			end
			if WAR.PD['易水四寒'][id] == 3 or WAR.PD['易水四寒'][id] == 5 then
				fy = fy - psx(id,'冰封程度')
			end
			--玄铁剑创
			if WAR.PD['玄铁剑创'][id] ~= nil and WAR.PD['玄铁剑创'][id] > 0 then
				fy = fy - 5 * (WAR.PD['玄铁剑创'][id] or 0)
			end
			if fy < 1 then fy = 1 end
			--林殊
			if match_ID(id, 74) then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == true then
						xs = xs + 0.1
					end		
				end
			end
			--易筋经
			if PersonKF(id,108) or Curr_NG(id,264) then 
				xs = xs + 0.1
			end
			if match_ID(id, 9930) then
				xs = xs + 0.3
			end
			if match_ID(id, 112) and WAR.XYS > 0  then	--萧远山杀破狼基础轻功*1.5
				xs = xs + 0.5
			end
			if WAR.PD['西瓜刀・天人'][id] ~= nil  then 
				xs = xs + 0.2
			end
			if WAR.PD['战神状态'][id] ~= nil  then
				xs = xs + 0.5
			end
			--金刚不坏加防御
			if NGQH(id,144) then
				local jg = 0
				for j = 1, JY.Base['武功数量'] do
					local wg = JY.Person[id]["武功"..j]
					if JY.Wugong[wg]["武功类型"] == 0 then
						jg = jg + 1
					end  
			    end
				if jg > 0 then
					xs = xs + jg*5/100
				end
		    end
			if xs > 1 then fy = fy*(1+xs) end
			if WAR.PD['命无常'][id] ~= nil then
				fy = math.modf(fy*0.01)
			end
			if WAR.PD['金刚指断肢'][id] ~= nil and WAR.PD['金刚指断肢'][id] > 0 then
				WAR.PD['金刚指断肢'][id] = limitX(WAR.PD['金刚指断肢'][id],1,4)
				local jg = WAR.PD['金刚指断肢'][id]
				local s = {0.75,0.5,0.25,0}
				fy = math.modf(fy*s[jg])
			end	
			if WAR.PD['玄冥玄毒'][id] ~= nil then
				local a = WAR.PD['玄冥玄毒'][id] * 0.02
				fy = limitX(math.modf(fy*(1-a)),0,fy)
			end	
			if WAR.PD['易水四寒2'][id] == 5 then
				if fy > 1 then
					fy = 1
				end  
			end
			--白首太玄
			if match_ID(id, 9927) and  JY.Person[id]['资质'] <= 50 then 
				if fy < 1500 then
					fy = 1500
				end
			end
			if inteam(id) and (match_ID(id, 9927) == false and JY.Person[id]['资质'] >50) then
				local limit = 2000
				fy = limitX(math.modf(fy),1,limit)
			else
			    fy = limitX(math.modf(fy),1,2000 + JY.Base["周目"]*JY.Base["难度"]*5)
			end	
		else
		    fy = 1
		end
	end
	return fy
end

--战场轻功
function Qg(i)
	local id = WAR.Person[i]['人物编号']
	local qg = 0 
	local xs = 0
	qg = qg + JY.Person[id]['轻功']
	qg = qg + limitX((JY.Person[id]['内力'] + JY.Person[id]['资质']*10)/50,0)
	--套装
	if isteam(id) then
		local fb = 1
		if MPTX(id,2) or match_ID(id,9911) or (PersonKF(id,203) and PersonKF(id,248) and PersonKF(id,99)) then
			fb = 2
		end
		if match_ID(id,546) then
			fb = 3
		end	
		if JY.Person[id]["武器"] >= 0 then	
			qg = qg + (JY.Thing[JY.Person[id]["武器"]]["加轻功"]*10*fb + JY.Thing[JY.Person[id]["武器"]]["加轻功"]*(JY.Thing[JY.Person[id]["武器"]]["装备等级"]-1))*fb
		end
		if JY.Person[id]["防具"] >= 0 then
			qg = qg + (JY.Thing[JY.Person[id]["防具"]]["加轻功"]*10*fb + JY.Thing[JY.Person[id]["防具"]]["加轻功"]*(JY.Thing[JY.Person[id]["防具"]]["装备等级"]-1))*fb
		end
		if JY.Person[id]["坐骑"] >= 0 then
			qg = qg + (JY.Thing[JY.Person[id]["坐骑"]]["加轻功"]*10*fb + JY.Thing[JY.Person[id]["坐骑"]]["加轻功"]*(JY.Thing[JY.Person[id]["坐骑"]]["装备等级"]-1))*fb
		end	
	else
		local fb = 2
		if MPTX(id,2) or match_ID(id,9911) or (PersonKF(id,203) and PersonKF(id,248) and PersonKF(id,99)) then
			fb = 3
		end
		if JY.Person[id]["武器"] >= 0 then
			qg = qg + (JY.Thing[JY.Person[id]["武器"]]["加轻功"]*20*fb + JY.Thing[JY.Person[id]["武器"]]["加轻功"]*(JY.Thing[JY.Person[id]["武器"]]["装备等级"]+1))*fb
		end
		if JY.Person[id]["防具"] >= 0 then
			qg = qg + (JY.Thing[JY.Person[id]["防具"]]["加轻功"]*20*fb + JY.Thing[JY.Person[id]["防具"]]["加轻功"]*(JY.Thing[JY.Person[id]["防具"]]["装备等级"]+1))*fb
		end
		if JY.Person[id]["坐骑"] >= 0 then
			qg = qg + (JY.Thing[JY.Person[id]["坐骑"]]["加轻功"]*20*fb+ JY.Thing[JY.Person[id]["坐骑"]]["加轻功"]*(JY.Thing[JY.Person[id]["坐骑"]]["装备等级"]+1))*fb
		end
	end
	if JY.Status == GAME_WMAP then
		if qg ~= nil then
			if YaoFengHuoShi(id) then
				local a = 0
				for j = 0, WAR.PersonNum-1 do
					if WAR.Person[j]["死亡"] == false then
						local jid = WAR.Person[j]["人物编号"]
						if psx(jid,"轻功") > a then
							a = psx(jid,'轻功')
						end
					end
				end
				if a > qg then
					qg = a
				end
			end
			--队友轻功加成
			for i,v in pairs(CC.AddSpd) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["人物编号"], v[2]) and WAR.Person[wid]["死亡"] == false then
							qg = qg + v[3]
						end 
					end
				end
			end
			--主运轻功效果
			if JY.Person[id]["主运轻功"] > 0 and JY.Person[id]["畅想分阶"] < 2 then
				qg = qg + 100
			elseif JY.Person[id]["主运轻功"] > 0 and JY.Person[id]["畅想分阶"] < 4 then
				qg = qg + 50
			end
			--朝廷攻防轻
			if MPTX(id,23) then
				local sz = math.modf(JY.Person[id]["实战"] / 3)
				qg = qg + sz
			end
			--古墓心法
			if PersonKF(id,211) then
				qg = qg + 150
			end
			--雪羽宗
			if MPTX(id,20) then
				if WAR.SXTJ <= 50 then
					qg = qg + 800
				else 
				    qg = qg + 300
				end 
			end
			--一苇渡江增加轻功
			if WAR.YWDJ[id] ~=nil and Curr_QG(id, 186) then
				qg = qg + WAR.YWDJ[id]
			end
			if PersonKF(id,259) then
				qg = qg + 50
			end
			if WAR.PD['升龙天威'][id] ~= nil then
				qg = qg - 800
			end
			if WAR.PD['易水四寒'][id] == 4 or WAR.PD['易水四寒'][id] == 5 then
				qg = qg - psx(id,'冰封程度')
			end
			--玄铁剑创
			if WAR.PD['玄铁剑创'][id] ~= nil and WAR.PD['玄铁剑创'][id] > 0 then
				qg = qg - 5 * (WAR.PD['玄铁剑创'][id] or 0)
			end
			if qg < 1 then qg = 1 end
			if PersonKF(id,108) or Curr_NG(id,259) then 
				xs = xs + 0.1
	        end
		    if match_ID(id, 9930) then 
	            xs = xs + 0.3
	        end
			if match_ID(id, 112) and WAR.XYS > 0 then	--萧远山杀破狼基础轻功*1.5
				xs = xs + 0.5
			end
			if WAR.PD['西瓜刀・天人'][id] ~= nil then 
				xs = xs + 0.2
			end
			if WAR.PD['战神状态'][id] ~= nil then 
				xs = xs + 0.5
			end
			if xs > 1 then qg = qg*(1+xs) end
			if WAR.PD['霸王破甲'][id] ~= nil then 
				qg = math.modf(qg * 0.6)
			end
			if WAR.PD['命无常'][id] ~= nil then
				qg = math.modf(qg*0.01)
			end
			if WAR.PD['金刚指断肢'][id] ~= nil and WAR.PD['金刚指断肢'][id] > 0 then
				WAR.PD['金刚指断肢'][id] = limitX(WAR.PD['金刚指断肢'][id],1,4)
				local jg = WAR.PD['金刚指断肢'][id]
				local s = {0.75,0.5,0.25,0}
				qg = math.modf(qg*s[jg])
			end	
			if WAR.PD['玄冥玄毒'][id] ~= nil then
				local a = WAR.PD['玄冥玄毒'][id] * 0.02
				qg = limitX(math.modf(qg*(1-a)),0,qg)
			end
			--白首太玄
			if match_ID(id, 9927) and  JY.Person[id]['资质'] <= 50 then 
				if qg < 1500 then
					qg = 1500
				end	
			end
			if inteam(id) and (match_ID(id, 9927) == false and JY.Person[id]['资质'] >50) then
				local limit = 2000
				qg = limitX(math.modf(qg),1,limit)
			else
				qg = limitX(math.modf(qg),1,2000 + JY.Base["周目"]*JY.Base["难度"]*5)
			end	
		else
			qg = 1
		end
	end
	return qg
end


function ZDGH(i,id) --战斗光环，在场效果
    for j = 0, WAR.PersonNum - 1 do
		local zid = WAR.Person[j]["人物编号"]
		if WAR.Person[j]["死亡"] == false and WAR.Person[i]["我方"]  == WAR.Person[j]["我方"] and match_ID(zid, id) then
			return true
		end
	end
    return false
end



Ct['灵鳌步'] = function(i,bs,lx,auto)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end	
    local at = WAR.CurID
	--auto 自动
	if WAR.Person[i]['我方'] == false or WAR.AutoFight == 1 or auto == '自动' or WAR.ZDDH == 354 then 
		--say('1')
		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		--记录所有可以移动的坐标
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		--随机选择一个可以移动的坐标，记录当前坐标地图层2的数值，设定当前坐标
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
		end
	else 
		WAR.CurID = i
		War_CalMoveStep(i, bs, lx)
		while true do
			--WAR.Person[WAR.CurID]["移动步数"] = 2
			--War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
			nx, ny = War_SelectMove() --显示+选择步数
			if nx ~= nil then
				if GetWarMap(nx, ny, 3) ~= 255 and GetWarMap(nx, ny, 2) < 0 then 
				   break
				end
			elseif nx == nil then 
				break
			end
		end
	end
    
	if nx ~= nil and ny ~= nil then 
	    PlayWavE(5)
        WAR.CurID = i
		local id = WAR.Person[WAR.CurID]["人物编号"]
	    WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID, 89,1, "灵鳌步")
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    NuoyiTXDH(WAR.CurID, 89,1, "灵鳌步")
		if QGQH(id,237,2) and id ~= 739 and isteam(id) and WAR.PD["分身判定"][id] == nil and JLSD(10,40,id) then
			local str = ""
			local x, y = WE_xy(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] - 1)
			local mid = 739	
			JY.Person[mid]["姓名"] = "金鳌分身"
			JY.Person[mid]["暂时无用"] = JY.Base["畅想"]			
			JY.Person[mid]["头像代号"] = JY.Person[id]["头像代号"]
			JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
			JY.Person[mid]["天赋内功"]=JY.Person[id]["天赋内功"]
			JY.Person[mid]["天赋外功1"]=JY.Person[id]["天赋外功1"]
			JY.Person[mid]["天赋外功2"]=JY.Person[id]["天赋外功2"]	
			JY.Person[mid]["天赋轻功"]=JY.Person[id]["天赋轻功"]			
			JY.Person[mid]["指法技巧"]=JY.Person[id]["指法技巧"]
			JY.Person[mid]["御剑能力"]=JY.Person[id]["御剑能力"]	
			JY.Person[mid]["耍刀技巧"]=JY.Person[id]["耍刀技巧"]
			JY.Person[mid]["特殊兵器"]=JY.Person[id]["特殊兵器"]
			JY.Person[mid]["武学常识"]=JY.Person[id]["武学常识"]
			JY.Person[mid]["攻击带毒"]=JY.Person[id]["攻击带毒"]
			JY.Person[mid]["左右互搏"]=JY.Person[id]["左右互搏"]
			JY.Person[mid]["中庸"]=JY.Person[id]["中庸"]
			JY.Person[mid]["攻击力"]=JY.Person[id]["攻击力"]
			JY.Person[mid]["防御力"]=JY.Person[id]["防御力"]
			JY.Person[mid]["轻功"]=JY.Person[id]["轻功"]
			JY.Person[mid]["医疗能力"]=JY.Person[id]["医疗能力"]
			JY.Person[mid]["用毒能力"]=JY.Person[id]["用毒能力"]
			--JY.Person[mid]["解毒能力"]=JY.Person[id]["解毒能力"]
			JY.Person[mid]["暗器技巧"]=JY.Person[id]["暗器技巧"]
			JY.Person[mid]["抗毒能力"]=JY.Person[id]["抗毒能力"]
			JY.Person[mid]["个人觉醒"]= JY.Person[id]["个人觉醒"]
			JY.Person[mid]["六如觉醒"]= JY.Person[id]["六如觉醒"]
			JY.Person[mid]["畅想分阶"]= JY.Person[id]["畅想分阶"]
			--JY.Person[mid]["主运轻功"]=JY.Person[id]["主运轻功"]
			--JY.Person[mid]["主运内功"]=JY.Person[id]["主运内功"]
			JY.Person[mid]["冰封程度"] = 0
			JY.Person[mid]["灼烧程度"] = 0
			JY.Person[mid]["中毒程度"] = 0
			JY.Person[mid]["受伤程度"] = 0
			JY.Person[mid]["实战"] = JY.Person[id]["实战"]
			JY.Person[mid]["等级"] = JY.Person[id]["等级"]
			--JY.Person[mid]["门派技能1"] = JY.Person[id]["门派技能1"]
			for o = 1,JY.Base["武功数量"] do
				JY.Person[mid]["武功"..o] = 0
				JY.Person[mid]["武功等级"..o] = 0
			end
			for i=1,5 do
				JY.Person[mid]["出招动画帧数" .. i]=JY.Person[id]["出招动画帧数" .. i]
				JY.Person[mid]["出招动画延迟" .. i]=JY.Person[id]["出招动画延迟" .. i]
				JY.Person[mid]["武功音效延迟" .. i]=JY.Person[id]["武功音效延迟" .. i]
			end	
			JY.Person[mid]["武器"]=JY.Person[id]["武器"]
			JY.Person[mid]["防具"]=JY.Person[id]["防具"]
			JY.Person[mid]["坐骑"]=JY.Person[id]["坐骑"]
			JY.Person[mid]["生命最大值"] = 1
			JY.Person[mid]["生命"] = JY.Person[id]["生命最大值"]
			JY.Person[mid]["内力最大值"] = math.modf(JY.Person[id]["内力最大值"]*1)
			JY.Person[mid]["内力"] =JY.Person[id]["内力最大值"]
			JY.Person[mid]["体力"] = 100
			JY.Person[mid]["生命增长"] =JY.Person[id]["生命增长"]
			JY.Person[mid]["内力性质"] =JY.Person[id]["内力性质"]
			JY.Person[mid]["性别"] =JY.Person[id]["性别"]
			JY.Person[mid]["资质"] =JY.Person[id]["资质"]
			--[[for k,v in pairs(CC.PTF[id]) do
				SetTF(mid,k,1)
			end]]

			NewWARPersonZJ(mid, true, x, y, false, 1);
			WAR.JQSDXS[mid] = (WAR.JQSDXS[id] or 0)
			WAR.SPIRIT[mid] = (WAR.SPIRIT[id] or 50)
			WAR.BTZT[mid] = 1
			WAR.PD['伤害储存1'][mid] = 1
			WAR.PD["分身判定"][id] = 5 --判断自己是不是发动过分身
			--WAR.JSJY[100+mid] = 20--判断分身可以存在多久
			--[[WAR.PD["分身判定1"][mid] = id --用来做死后复活
			WAR.PD["分身瞬动"][mid] = 1 --让分身第一回合瞬动
			WAR.PD["分身上限"][id] = 1]]
			for i = 40, 80 do
				NewDrawString(-1, -1, "金鳌天生 幻潮化影",M_DeepSkyBlue, i)
				ShowScreen()
				if i == 80 then
					Cls()
					NewDrawString(-1, -1, "金鳌天生 幻潮化影", M_DeepSkyBlue, i)
					ShowScreen()
					lib.Delay(400)
				else
					lib.Delay(1)
				end
			end
		end
		--灵鳌步
		if TFQG(id,237) and Curr_QG(id,237) then
			NuoyiTXDH(WAR.CurID, 129,1, "踏浪狂歌")
			for linao = 0, WAR.PersonNum-1 do 
				if WAR.Person[linao]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[linao]["死亡"] == false then
					local laid = WAR.Person[linao]["人物编号"]
					WAR.TXXS[laid] = 1
					WAR.Person[linao]["内力点数"] = (WAR.Person[linao]["内力点数"] or 0) + AddPersonAttrib(laid,"内力",-500)
				end
			end
		end			
		if match_ID(id,635) then
			WAR.Person[WAR.CurID]["反击"] = 1	
		end	
		if QGQH(id,237,1) and GetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"],4) > 0 then
			WAR.PD['格挡状态'][id] = 1
		end	
  end
  WAR.CurID = at
end 


Ct['套装效果.挪移'] = function(i,bs,lx,auto)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end	
    local at = WAR.CurID
	--auto 自动
	if WAR.Person[i]['我方'] == false or WAR.AutoFight == 1 or auto == '自动' or WAR.ZDDH == 354 then 
		--say('1')
		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		--记录所有可以移动的坐标
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		--随机选择一个可以移动的坐标，记录当前坐标地图层2的数值，设定当前坐标
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
		end
	else 
		WAR.CurID = i
		War_CalMoveStep(i, bs, lx)
		while true do
			--WAR.Person[WAR.CurID]["移动步数"] = 2
			--War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
			nx, ny = War_SelectMove() --显示+选择步数
			if nx ~= nil then
				if GetWarMap(nx, ny, 3) ~= 255 and GetWarMap(nx, ny, 2) < 0 then 
				   break
				end
			elseif nx == nil then 
				break
			end
		end
	end
    
	if nx ~= nil and ny ~= nil then 
	    PlayWavE(5)
        WAR.CurID = i
	    WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID, 89,1, "套装效果.挪移")
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    NuoyiTXDH(WAR.CurID, 89,1, "套装效果.挪移")	
    end
    WAR.CurID = at
end  

Ct['挪移'] = function(i,bs,lx,auto,str,dh)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end
	if dh == nil then
		dh = 158
	end
	if str == nil then
		str = "真・葵花挪移"
	end		
    local at = WAR.CurID
	--auto 自动
	if WAR.Person[i]['我方'] == false or WAR.AutoFight == 1 or auto == '自动' or (WAR.Person[i]['我方'] == true and inteam(id) == false) or WAR.ZDDH == 354 then 
		--say('1')
		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		--记录所有可以移动的坐标
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		--随机选择一个可以移动的坐标，记录当前坐标地图层2的数值，设定当前坐标
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
			--WAR.NyPd[#WAR.NyPd+1] = {nx,ny,GetWarMap(nx,ny,2)}
			--SetWarMap(nx,ny,2,i)
		end
	else 
		WAR.CurID = i
		War_CalMoveStep(i, bs, lx)
		while true do
			nx, ny = War_SelectMove() --显示+选择步数
			if nx ~= nil then
				if GetWarMap(nx, ny, 3) ~= 255 and GetWarMap(nx, ny, 2) < 0 then 
					--WAR.NyPd[#WAR.NyPd+1] = {nx,ny,GetWarMap(nx,ny,2)}
					--SetWarMap(nx,ny,2,i)
				   break
				end
			elseif nx == nil then 
				break
			end
		end	
	end
    
  if nx ~= nil and ny ~= nil then 	
		PlayWavE(5)
      	WAR.CurID = i
	    WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID, dh,1, str)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
      SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    --CurIDTXDH(WAR.CurID, 89,1, "真・葵花挪移")
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    --WarDrawMap(0)
	    --CurIDTXDH(WAR.CurID, 89,1, "真・葵花挪移")
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
      SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    --WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID, dh,1, str)
		if Curr_QG(id,316) and (match_ID(id,27) or match_ID(id,777)) and JLSD(10,35,id) then
			zhanyi(id,200)
		end	
		if (match_ID(id,27) or match_ID(id,777)) and PersonKF(id,105) then
			addbuff(id,WAR.PD['葵花护盾'],1)
		end
  end
    WAR.CurID = at
	--return nx,ny
end 

Ct['金雁功挪移'] = function(i,bs,lx,auto)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end	
    local at = WAR.CurID
	--auto 自动
	if WAR.Person[i]['我方'] == false or WAR.AutoFight == 1 or auto == '自动' or WAR.ZDDH == 354 then 
		--say('1')
		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		--记录所有可以移动的坐标
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		--随机选择一个可以移动的坐标，记录当前坐标地图层2的数值，设定当前坐标
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
			--WAR.NyPd[#WAR.NyPd+1] = {nx,ny,GetWarMap(nx,ny,2)}
			--SetWarMap(nx,ny,2,i)
		end
	else 
		if WAR.PD['金雁功闪避'][id] ~= nil  then
			WAR.PD['金雁功闪避1'][id] = {WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"]}
			nx = WAR.PD['金雁功闪避'][id][1]
			ny = WAR.PD['金雁功闪避'][id][2]
			WAR.PD['金雁功闪避'][id] = nil
		elseif WAR.PD['金雁功闪避1'][id] ~= nil then
			WAR.PD['金雁功闪避'][id] = {WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"]}
			nx = WAR.PD['金雁功闪避1'][id][1]
			ny = WAR.PD['金雁功闪避1'][id][2]
			WAR.PD['金雁功闪避1'][id] = nil
		else
		end	
	end
    
    if nx ~= nil and ny ~= nil then 
		
		PlayWavE(5)
        WAR.CurID = i
	    WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID, 154,1, "金雁横空・迅影鎏光")
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    --WarDrawMap(0)
	   NuoyiTXDH(WAR.CurID, 154,1, "金雁横空・迅影鎏光")
		local pid = WAR.Person[WAR.CurID]["人物编号"]
		if JLSD(0,35,pid) and JY.Person[pid]["内力"] > 500 and JY.Person[pid]["体力"] > 10 then
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",-500)
			WAR.Person[WAR.CurID]["体力点数"] = (WAR.Person[WAR.CurID]["体力点数"] or 0) + AddPersonAttrib(pid,"体力",-10)
			Cat('清除高级异常',WAR.CurID)
			NuoyiTXDH(WAR.CurID, 129,1, "金雁横空・动极返静")
		elseif JLSD(10,45,pid) then	
			WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",300)
			WAR.Person[WAR.CurID]["内力点数"] = (WAR.Person[WAR.CurID]["内力点数"] or 0) + AddPersonAttrib(pid,"内力",500)
			WAR.Person[WAR.CurID]["体力点数"] = (WAR.Person[WAR.CurID]["体力点数"] or 0) + AddPersonAttrib(pid,"体力",10)
			NuoyiTXDH(WAR.CurID, 129,1, "金雁横空・动极返静")
		end	
    end
    

    WAR.CurID = at

	--return nx,ny
end

Ct['云龙挪移'] = function(i,bs,lx,auto)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end	
    local at = WAR.CurID
	--auto 自动
	if WAR.Person[i]['我方'] == false or WAR.AutoFight == 1 or auto == '自动' or WAR.ZDDH == 354 then 
		--say('1')
		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		--记录所有可以移动的坐标
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		--随机选择一个可以移动的坐标，记录当前坐标地图层2的数值，设定当前坐标
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
			--WAR.NyPd[#WAR.NyPd+1] = {nx,ny,GetWarMap(nx,ny,2)}
			--SetWarMap(nx,ny,2,i)
		end
	else 
		WAR.CurID = i
		War_CalMoveStep(i, bs, lx)
		while true do
			nx, ny = War_SelectMove() --显示+选择步数
			if nx ~= nil then
				if GetWarMap(nx, ny, 3) ~= 255 and GetWarMap(nx, ny, 2) < 0 then 
					--WAR.NyPd[#WAR.NyPd+1] = {nx,ny,GetWarMap(nx,ny,2)}
					--SetWarMap(nx,ny,2,i)
				   break
				end
			elseif nx == nil then 
				break
			end
		end
	end
    
    if nx ~= nil and ny ~= nil then 
		
		PlayWavE(5)
        WAR.CurID = i
	    WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID,113,1,'云龙二折')
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    NuoyiTXDH(WAR.CurID,113,1,'云龙二折')
    end
    WAR.CurID = at
end


Ct['梅花步'] = function(i,bs,lx,auto)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end	
    local at = WAR.CurID

		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
		end

    
    if nx ~= nil and ny ~= nil then 
	    PlayWavE(5)
        WAR.CurID = i
	    WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID, 374,2, "速水无痕 纵走梅花")
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    NuoyiTXDH(WAR.CurID, 374,2, "速水无痕 纵走梅花")
		if match_ID(id,520) then
			WAR.Person[WAR.CurID]["反击"] = 1
			if WAR.PD['先天太极'][id] == nil then
				WAR.PD['先天太极'][id] = 1
			end
		end
    end
    WAR.CurID = at
	--return nx,ny
end

Ct['天机闪'] = function(i,bs,lx,auto)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end	
    local at = WAR.CurID

		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
		end

    
    if nx ~= nil and ny ~= nil then 
	    PlayWavE(5)
        WAR.CurID = i
	    WarDrawMap(0)
	   NuoyiTXDH(WAR.CurID, 71,2, "天机身法")
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    NuoyiTXDH(WAR.CurID, 71,2, "天机身法")
    end
    WAR.CurID = at
	--return nx,ny
end

Ct['奇门五转'] = function(i,bs,lx,auto)
	local nx,ny = nil,nil
	local id = WAR.Person[i]['人物编号']
	if lx == nil then 
		lx = 0
	end	
    local at = WAR.CurID

		local menu = {}
		local menu2 = {}
		War_CalMoveStep(i, bs, lx)
		local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
			for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
				if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
				   menu[#menu+1] = {ix,iy}
				end
			end 
		end
		if #menu > 0 then 
		   local a = math.random(#menu)
			nx = menu[a][1]
			ny = menu[a][2]
		end

    if nx ~= nil and ny ~= nil then 
	    PlayWavE(5)
        WAR.CurID = i
	    WarDrawMap(0)
	    NuoyiTXDH(WAR.CurID, 95,2, "奇门五转・中土")
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
	    WarDrawMap(0)
	    WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
	    SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
	    NuoyiTXDH(WAR.CurID, 95,2, "奇门五转・中土")
    end
    WAR.CurID = at

	--return nx,ny
end 

Ct['自动攻击'] = function(kfid)
    local x,y = nil,nil
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local kungfuid = JY.Person[pid]["武功" .. kfid]
	local kungfulv = JY.Person[pid]["武功等级" .. kfid]
	if kungfulv == 999 then
		kungfulv = 11
	else
		kungfulv = math.modf(kungfulv / 100) + 1
	end
	local m1, m2, a1, a2, a3, a4, a5 = refw(kungfuid, kungfulv)
	local mfw = {m1, m2}
	local atkfw = {a1, a2, a3, a4, a5}
	if kungfulv == 11 then
		kungfulv = 10
	end
	--AI也用新的威力判定
	local kungfuatk = get_skill_power(pid, kungfuid, kungfulv)
	local atkarray = {}
	local num = 0
	CleanWarMap(4, -1)
	local movearray = War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)

	for i = 0, WAR.Person[WAR.CurID]["移动步数"] do
		local step_num = movearray[i].num
		if step_num ~= nil then
			for j = 1, step_num do
				local xx = movearray[i].x[j]
				local yy = movearray[i].y[j]
				num = num + 1
				atkarray[num] = {}
				atkarray[num].x, atkarray[num].y = xx, yy
				atkarray[num].p, atkarray[num].ax, atkarray[num].ay = GetAtkNum(xx, yy, mfw, atkfw, kungfuatk)
			end
		end
	end
	for i = 1, num - 1 do
		for j = i + 1, num do
			if atkarray[i].p < atkarray[j].p then
				atkarray[i], atkarray[j] = atkarray[j], atkarray[i]
			end
		end
	end
	if atkarray[1].p > 0 then
		for i = 2, num do
			if atkarray[i].p == 0 or atkarray[i].p < atkarray[1].p / 2 then
				num = i - 1
				break;
			end
        end
        --[[
		for i = 1, num do
			if WAR.Person[WAR.CurID]["我方"] == true then
				--flag: approach enemies.
				atkarray[i].p = atkarray[i].p + GetMovePoint(atkarray[i].x, atkarray[i].y)
			else
				--flag: aviod enemies. avoiding as many enemies as possible while retaining targeting the spot with higher threat
				atkarray[i].p = atkarray[i].p + GetMovePoint(atkarray[i].x, atkarray[i].y, 1)
			end
        end
        ]]
		for i = 1, num - 1 do
			for j = i + 1, num do
				if atkarray[i].p < atkarray[j].p then
					atkarray[i], atkarray[j] = atkarray[j], atkarray[i]
				elseif atkarray[i].p == atkarray[j].p and math.random(2) > 1 then
					atkarray[i], atkarray[j] = atkarray[j], atkarray[i]
				end
			end
		end
		for i = 2, num do
			if atkarray[i].p < atkarray[1].p *4/5 then
				num = i - 1
				break;
			end
		end
		
		local select = 1
		
		War_CalMoveStep(WAR.CurID, WAR.Person[WAR.CurID]["移动步数"], 0)
		War_MovePerson(atkarray[select].x, atkarray[select].y)
		War_Fight_Sub(WAR.CurID, kfid, atkarray[select].ax, atkarray[select].ay)
    end    
    --return x,y
end

function Atid(i)
    if WAR.Atid == i then 
        WAR.Person[i].Time = 1000
        WAR.Atid = -1
        return true
    end
    if WAR.Person[i].Time > 1000 then
        return true   
    end
    return false
end

Ct['随机移动'] = function()
    local id = WAR.Person[WAR.CurID]['人物编号']
	local lx = 0 
	local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
	local bs = WAR.Person[WAR.CurID]['移动步数']
	local xx,yy = nil
	local menu = {}
    if bs <= 0 then
        return    
    end
    War_CalMoveStep(WAR.CurID, bs, lx)
	
	for ix = limitX(x0-bs,0),limitX(x0+bs,x0,62) do 
		for iy = limitX(y0-bs,0), limitX(y0+bs,y0,62) do 
			if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 then 
			   menu[#menu+1] = {ix,iy}
			end
		end
	end
	
	if #menu > 0 then 
	   local a = math.random(#menu)
	    xx = menu[a][1]
		yy = menu[a][2]
	    War_MovePerson(xx,yy)
	    WAR.Person[WAR.CurID]['移动步数'] = 0
	end
end

Ct['随机移动1'] = function()
    local id = WAR.Person[WAR.CurID]['人物编号']
	local lx = 0 
	local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
	local bs = 1
	local xx,yy = nil
	local menu = {}
    War_CalMoveStep(WAR.CurID, bs, lx)	
	for ix = limitX(x0-bs,0),limitX(x0+bs,x0,62) do 
		for iy = limitX(y0-bs,0), limitX(y0+bs,y0,62) do 
			if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 then 
			   menu[#menu+1] = {ix,iy}
			end
		end
	end
	
	if #menu > 0 then 
	   local a = math.random(#menu)
	    xx = menu[a][1]
		yy = menu[a][2]
	    War_MovePerson(xx,yy)
		War_MovePerson(x0,y0)
	end
end

Ct['破绽'] = function(enemyid)
    local pid = WAR.Person[WAR.CurID]['人物编号']
    local eid = WAR.Person[enemyid]['人物编号']
    --龟息功
    if Curr_NG(eid,227) and WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0 then
        return false
    end
	--双剑合璧
	if WGZH(eid,39,42) then
		return false
	end
	if MPTX(eid,23,3) and Curr_NG(eid,199) then
		local sz = math.modf(JY.Person[eid]["实战"]/90)
		if math.modf(10) < sz then
			return false
		end
	end
	if MPTX(pid,23,3) and Curr_NG(pid,199) then
		local sz = math.modf(JY.Person[pid]["实战"]/90)
		if math.modf(10) < sz then
			return true
		end
	end
	if WGZH(pid,156,188) then
		return true
	end
	if ZYHBPD(pid) == 2 and (WAR.ZYHB == 2 or WAR.PD['真左右互搏'][pid] == 1) then
		return true
	end
    if JY.Status == GAME_WMAP and match_ID(pid,9965) then 
        if WAR.LQZ[pid] == nil or (WAR.LQZ[pid] or 0) < 100 then
            return false
        elseif BNJQ(pid) then 
            return true
        end
    end
    if match_ID(eid,9965) then 
        if WAR.LQZ[eid] == nil or (WAR.LQZ[eid] or 0) < 100 then
            return false
        elseif BNJQ(eid) then 
            return true
        end
    end
	if WAR.PD["无招胜有招"][eid] ~= nil then
		return true
	end
	if match_ID(pid,9987) and BNJQ(pid) then 
        return true
    end
    
	if MPTX(pid,20,2) and BNJQ(pid) and JY.Status == GAME_WMAP then
		return true
	end	
	
    if JXPD(eid,635,1) and WAR.Weakspot[eid] ~= nil and WAR.Weakspot[eid] < 6 and (JY.Person[pid]["实战"] >=500 or isteam(pid) == false) then 
        return true
    end
		
    if WAR.Person[enemyid].Time >= -200 and WAR.Person[enemyid].Time <= 200 then 
        return true
    end
	
    if match_ID(eid,9987) or NGQHB(eid,196) then 
        return false   
    end
	
    if match_ID(eid,92) then
		return false   
    end
	
    if WAR.SJHB_G == 1 then
        return true
    end
    
    if Curr_NG(pid, 93) and JLSD(20,80,pid) then
        return true
    end
	
    if WAR.PD["皆"][pid] == 1 then 
        return true    
    end
	if WAR.XWXZX == 9 then
		return true
	end

	if WAR.BLJJ == 5 then
		return true
	end	
	
	if (Curr_NG(pid,105) and PersonKF(pid,226) and PersonKF(pid,201) and (PersonKF(pid,126) or PersonKF(pid,127))) or match_ID(pid,92) then
		return true
	end	
	
	if WAR.PD['战神状态'][pid] ~= nil then
		return true
	end	
	
	if WAR.PD['无常索命诀4'][pid] == 1 then
		return true
	end	
	if WAR.PD['南子燎原枪'][pid] == 1 then
		return true
	end	
    return false
end


--流血抗性
function lxkx(eid,lxsz)
	if JY.Status == GAME_WMAP then
		if WAR.CurID ~= nil then
			if WAR.PD['血衣剑法1'][WAR.Person[WAR.CurID]['人物编号']] == 1 then
				return lxsz
			end
		end
	end	
	lxsz = lxsz or 0
	-- local eid = WAR.Person[i]['人物编号']
	local lxsz1 = lxsz
	lxsz = 100
	--套装效果抗封穴
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 6 then
			lxsz = lxsz - 10
		end
	end
	if JY.Status == GAME_WMAP and NGQH(eid,160) and WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] < 50 then
		lxsz = math.modf(lxsz*0.7)
	end
	if JY.Status == GAME_WMAP and NGQH(eid,171) and WAR.TJSG[eid] ~= nil and WAR.TJSG[eid] > 0 then	
		local tjkx = (9000 - (WAR.TJSG[eid] or 0)) / 9000
		lxsz = math.modf(lxsz * tjkx)
	end
	if JY.Person[eid]['畅想分阶'] < 3 then
		local fjkx = ((3-JY.Person[eid]['畅想分阶'])*5*0.01)
		lxsz = math.modf(lxsz*(1-fjkx))
	end	
	if actor(eid,7) then
		local a = 1 - (JY.Person[eid]['品德']*0.005)
		lxsz = math.modf(lxsz*a)
	end	
	if NGQH(eid,105) then --九阳
		lxsz = math.modf(lxsz*0.9)
	end	
	if Curr_NG(eid,247) then--临济
		lxsz = math.modf(lxsz*0.6)
	end
	if Curr_NG(eid,163) then--血河
		lxsz = math.modf(lxsz*0.5)
	end
	if Curr_NG(eid,214) then--血刀心法
		lxsz = math.modf(lxsz*0.6)
	end
	if Curr_NG(eid,227) then--龟息功
		lxsz = math.modf(lxsz*0.85)
	end
	if Curr_NG(eid,180) then--鲸息功
		lxsz = math.modf(lxsz*0.6)
	end
	if Curr_NG(eid,212) then--华山心法
		lxsz= math.modf(lxsz*0.9)
	end
	if Curr_NG(eid,89) then--紫霞神功
		lxsz = math.modf(lxsz * 0.5)
	end	
	if JY.Status == GAME_WMAP and WAR.PD['风雷惊蛰4'][eid] ~= nil then
		lxsz = limitX(math.modf(lxsz)*2,0,100)
	end	
	lxsz1 = math.modf(lxsz1 * lxsz * 0.01)
	lxsz = lxsz1
	lxsz = limitX(lxsz,0)
	return lxsz
end

--中毒抗性
function zdkx(eid,zdsz)
    zdsz = zdsz or 0
    --local eid = WAR.Person[i]['人物编号']
	if actor(eid,9) or  MPTX(eid,1) or MPTX(eid,8) then
		return zdsz
	end	
	if JY.Status == GAME_WMAP then
		if WAR.CurID ~= nil then
			if match_ID(WAR.Person[WAR.CurID]['人物编号'], 631) and yongzhi(11) then
				return zdsz
			end
		end
	end
	local zdsz1 = zdsz
	zdsz = 100
	--套装效果抗中毒
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 2 then
			zdsz = zdsz - 10
		end
	end
	if JY.Person[eid]['畅想分阶'] < 3 then
		local fjkx = ((3-JY.Person[eid]['畅想分阶'])*5*0.01)
		zdsz = math.modf(zdsz*(1-fjkx))
	end
	if actor(eid,7) then
		local a = 1 - (JY.Person[eid]['品德']*0.005)
		zdsz = math.modf(zdsz*a)
	end	
	if JY.Person[eid]['抗毒能力'] > 0 then
		local kd = JY.Person[eid]["抗毒能力"] + JY.Person[eid]["内力"] / 50
		local a = 1 - (kd*0.001)
		zdsz = math.modf(zdsz*a)
	end
	if Curr_NG(eid,106) then
		zdsz = math.modf(zdsz*0.6)
	end
	if Curr_NG(eid,353) then
		zdsz = math.modf(zdsz*0.9)
	end
	if Curr_NG(eid,264) then
		zdsz = math.modf(zdsz*0.6)
	end
	if Curr_NG(eid,99) then
		zdsz = math.modf(zdsz*0.8)
	end	
	if JY.Status == GAME_WMAP and NGQH(eid,105) then
		zdsz = math.modf(zdsz*0.9)
	end
	if JY.Status == GAME_WMAP and NGQH(eid,160) and WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] < 50 then
		zdsz = math.modf(zdsz*0.7)
	end
	if JY.Status == GAME_WMAP and NGQH(eid,171) and WAR.TJSG[eid] ~= nil and WAR.TJSG[eid] > 0 then	
		local tjkx = (9000 - (WAR.TJSG[eid] or 0)) / 9000
		zdsz = math.modf(zdsz * tjkx)
	end
	
	zdsz1 = math.modf(zdsz1 * zdsz * 0.01)
	zdsz = zdsz1
	zdsz = limitX(zdsz,0)
	return zdsz
end

--封穴抗性
function fxkx(eid,fxsz)
    fxsz = fxsz or 0
	local fxsz1 = fxsz
	if JY.Status == GAME_WMAP and WAR.PD['逆转经脉'][eid] ~= nil then
		return fxsz
	end	
	if JY.Status == GAME_WMAP and WAR.PD['点穴大师3'][eid] ~= nil then
		return fxsz
	end	
	if JY.Status == GAME_WMAP and MPTX(eid,8,3) and Curr_NG(eid,104) then
		return fxsz
	end
	fxsz = 100	
	if JY.Status == GAME_WMAP and PersonKF(eid,104) and (not (MPTX(eid,8,3) and Curr_NG(eid, 104))) then
		fxsz = fxsz - 10
	end
	if Curr_NG(eid,249) then 
		fxsz = fxsz - 10
	end
	if match_ID(eid,92) then
		fxsz = fxsz - 50
	end
	--装备金丝背心，1级封穴-5，6级封穴-10
	if JY.Person[eid]["防具"] == 60 then
		fxsz = fxsz - 5 - 1*(JY.Thing[60]["装备等级"]-1)
	end
	--套装效果抗封穴
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 1 then
			fxsz = fxsz - 10
		end
	end
	--点穴大师
	if PersonKF(eid, 226) then
		fxsz = fxsz - 10
		if PersonKF(eid,126) and PersonKF(eid,226) then
			fxsz = fxsz - 10
		end
	end
	if JY.Person[eid]['畅想分阶'] < 3 then
		local fjkx = ((3-JY.Person[eid]['畅想分阶'])*5*0.01)
		fxsz = math.modf(fxsz*(1-fjkx))
	end	
	--公孙止受封穴减半
	if match_ID(eid, 616) then
		fxsz = math.modf(fxsz *0.5)
	end
	--圣火受封穴减半
	if Curr_NG(eid, 93) then
		fxsz = math.modf(fxsz *0.5)
	end
	
	--乾坤受封穴减半
	if Curr_NG(eid, 97) then
		fxsz = math.modf(fxsz *0.5)
	end
	
	if Curr_NG(eid, 190) then
		fxsz = math.modf(fxsz *0.5)
	end
	
	--一苇渡江
	if Curr_QG(eid,186) then
		fxsz = math.modf(fxsz *0.5)
	end
	if JY.Status == GAME_WMAP and NGQH(eid,171) and WAR.TJSG[eid] ~= nil and WAR.TJSG[eid] > 0 then	
		local tjkx = (9000 - (WAR.TJSG[eid] or 0)) / 9000
		fxsz = math.modf(fxsz * tjkx)
	end
	if JY.Status == GAME_WMAP and NGQH(eid,105) then
		fxsz = math.modf(fxsz*0.9)
	end	
	if JY.Status == GAME_WMAP and NGQH(eid,160) and WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] < 50 then
		fxsz = math.modf(fxsz*0.7)
	end	
	if JY.Status == GAME_WMAP and match_ID(eid,65) and WAR.PD['复活・一灯'][eid] == 1 then
		fxsz = math.modf(fxsz*0.1)
	end
	if actor(eid,7) then
		local a = 1 - (JY.Person[eid]['品德']*0.005)
		fxsz = math.modf(fxsz*a)
	end
	
	
	if fxsz <= 0 then
		return 0
	end	
	--fxsz = (100-fxsz)
	fxsz1 = math.modf(fxsz1 * fxsz * 0.01)
	fxsz = fxsz1
	fxsz = limitX(fxsz,0)
	return fxsz
end

--内伤抗性
function nskx(eid,nssz)
    nssz = nssz or 0
    --local eid = WAR.Person[i]['人物编号']
	local nssz1 = nssz
	nssz = 100
	--装备乌蚕衣，1级内伤-5，6级内伤-10
    if JY.Person[eid]["防具"] == 59 then
		nssz = nssz - 5 - 1*(JY.Thing[59]["装备等级"]-1)
    end
	--套装效果抗
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 3 then
			nssz = nssz - 10
		end
	end
	if JY.Status == GAME_WMAP and NGQH(eid,171) and WAR.TJSG[eid] ~= nil and WAR.TJSG[eid] > 0 then	
		local tjkx = (9000 - (WAR.TJSG[eid] or 0)) / 9000
		nssz = math.modf(nssz * tjkx)
	end
	if JY.Status == GAME_WMAP and NGQH(eid,160) and WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] < 50 then
		nssz = math.modf(nssz * 0.7)
	end
	if JY.Person[eid]['畅想分阶'] < 3 then
		local fjkx = ((3-JY.Person[eid]['畅想分阶'])*5*0.01)
		nssz = math.modf(nssz*(1-fjkx))
	end
	if actor(eid,7) then
		local a = 1 - (JY.Person[eid]['品德']*0.005)
		nssz = math.modf(nssz*a)
	end
	--主运先天，逆运，蛤蟆，内伤-30%
	if Curr_NG(eid, 100) or Curr_NG(eid, 104) or Curr_NG(eid, 95) then
		nssz = math.modf(nssz * 0.7)
    end
	if NGQH(eid,105) then
		nssz = math.modf(nssz * 0.9)
	end	
	--混元紫霞-30%
    if NGQHB(eid,90) then	
	    nssz = math.modf(nssz * 0.7)
    end
	--主运乾坤，罗汉，内伤-60%
	if Curr_NG(eid, 97) or Curr_NG(eid, 96) then
		nssz = math.modf(nssz * 0.4)
    end
    
	if Curr_NG(eid, 249) then 
        nssz = math.modf(nssz * 0.4)
    end
	if Curr_NG(eid,255) then
		nssz = math.modf(nssz * 0.9)
	end
	if 	Curr_NG(eid,259) then
		nssz = math.modf(nssz * 0.6)
	end	
	if JY.Status == GAME_WMAP and match_ID(eid,129) and WAR.PD['复活・王重阳'][eid] == 1 then
		nssz = math.modf(nssz * 0.1)
	end
	if JY.Status == GAME_WMAP and  WAR.PD['风雷惊蛰4'][eid] ~= nil then
		nssz = limitX(math.modf(nssz)*2,0,100)
	end
	nssz1 = math.modf(nssz1 * nssz * 0.01)
	nssz = nssz1
	nssz = limitX(nssz,0)
	return nssz
end

--冰封抗性
function bfkx(eid,bfsz)
    bfsz = bfsz or 0
    --local eid = WAR.Person[i]['人物编号']
	if (JY.Status == GAME_WMAP and WAR.XMSZ1 > 0) or MPTX(eid,20) then
		return bfsz
	end	
	local bfsz1 = bfsz
	bfsz = 100
	--套装效果抗
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 4 then
			bfsz = bfsz - 15
		end
	end
	if JY.Status == GAME_WMAP and NGQH(eid,171) and WAR.TJSG[eid] ~= nil and WAR.TJSG[eid] > 0 then	
		local tjkx = (9000 - (WAR.TJSG[eid] or 0)) / 9000
		bfsz = math.modf(bfsz * tjkx)
	end
	if JY.Status == GAME_WMAP and WAR.PD['雪羽冰封'][eid] ~= nil then
		bfsz = math.modf(bfsz*1.3)
	end
	if JY.Status == GAME_WMAP and NGQH(eid,160) and WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] < 50 then
		bfsz = math.modf(bfsz*0.7)
	end
	if actor(eid,7) then
		local a = 1 - (JY.Person[eid]['品德']*0.005)
		bfsz = math.modf(bfsz*a)
	end
	if JY.Person[eid]['畅想分阶'] < 3 then
		local fjkx = ((3-JY.Person[eid]['畅想分阶'])*5*0.01)
		bfsz = math.modf(bfsz*(1-fjkx))
	end
	if NGQH(eid,105) then
		bfsz = math.modf(bfsz*0.9)
	end	
	if Curr_NG(eid,213) then
		bfsz = math.modf(bfsz*0.9)
	end
	if Curr_NG(eid,216) then
		bfsz = math.modf(bfsz*0.6)
	end
	if Curr_NG(eid,241) then
		bfsz = math.modf(bfsz*0.85)
	end	
	if Curr_NG(eid,242) then
		bfsz = math.modf(bfsz*0.85)
	end	
	if Curr_NG(eid,243) then
		bfsz = math.modf(bfsz*0.85)
	end	
	if Curr_NG(eid,221) then--阴阳无极
		bfsz = math.modf(bfsz*0.65)
	end	
	
	--装备皮衣，1级冰封-50%，6级免疫冰封
	if JY.Person[eid]["防具"] == 63 then
		local kh = 0.5 + 0.1 * (JY.Thing[63]["装备等级"]-1)
		bfsz = math.modf(bfsz *(1-kh))
	end
	
	if Curr_NG(eid, 99) then
		bfsz = math.modf(bfsz *0.5)
	end  	

	bfsz1 = math.modf(bfsz1*bfsz*0.01)
	
	bfsz = bfsz1
	
	if JY.Status == GAME_WMAP then
		if WAR.PD['极阴无相1'][eid] ~= nil then
			bfsz = math.modf(bfsz*2)
		end
	end	

	bfsz = limitX(bfsz,0)
	return bfsz
end

--灼烧抗性
function zskx(eid,zssz)
    zssz = zssz or 0
   -- local eid = WAR.Person[i]['人物编号']
    if match_ID(eid,525) then
		return zssz
	end	
	local zssz1 = zssz
	zssz = 100
	--套装效果抗
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 5 then
			zssz = zssz - 10
		end
	end
	if JY.Status == GAME_WMAP and NGQH(eid,171) and WAR.TJSG[eid] ~= nil and WAR.TJSG[eid] > 0 then	
		local tjkx = (9000 - (WAR.TJSG[eid] or 0)) / 9000
		zssz = math.modf(zssz * tjkx)
	end
	if JY.Person[eid]['畅想分阶'] < 3 then
		local fjkx = ((3-JY.Person[eid]['畅想分阶'])*5*0.01)
		zssz = math.modf(zssz*(1-fjkx))
	end
	if NGQH(eid,105) then
		zssz = math.modf(zssz*0.9)
	end	
	if JY.Status == GAME_WMAP and NGQH(eid,160) and WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] < 50 then
		zssz = math.modf(zssz*0.7)
	end
	
	if Curr_NG(eid,355) then
		zssz = math.modf(zssz*0.9)
	end
	if Curr_NG(eid,263) then
		zssz = math.modf(zssz*0.6)
	end	
	if Curr_NG(eid,93) then	
		if MPTX(eid,13) then
			zssz = math.modf(zssz*0.6)
		else
			zssz = math.modf(zssz*0.7)
		end
	elseif PersonKF(eid,93) then
		if MPTX(eid,13) then
			zssz = math.modf(zssz*0.75)
		else
			zssz = math.modf(zssz*0.85)
		end
	end	
	if Curr_NG(eid,221) then--阴阳无极
		zssz = math.modf(zssz*0.65)
	end	
	if actor(eid,7) then
		local a = 1 - (JY.Person[eid]['品德']*0.005)
		zssz = math.modf(zssz*a)
	end
	--装备佛心甲，1级灼烧-50%，6级免疫灼烧
    if JY.Person[eid]["防具"] == 62 then
        local kz = 0.5 + 0.1 * (JY.Thing[62]["装备等级"]-1)
        zssz = math.modf(zssz *(1-kz))
    end

    --玉女主运，灼烧-50%
    if Curr_NG(eid, 154) then
        zssz = math.modf(zssz / 2)
    end    
	
	
	zssz1 = math.modf(zssz1*zssz*0.01)
	zssz = zssz1
	
    zssz = limitX(zssz,0)
	return zssz
end

--免疫内伤
function myns(eid)
	--local eid = WAR.Person[i]['人物编号']
	if JY.Status == GAME_WMAP and WAR.PD['伤重不治'][eid] ~= nil then
		return false
	end	
	if JY.Status == GAME_WMAP and WAR.CQSX == 1 then 
		return true 
	end
	--套装效果免疫内伤
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 7 then
			return true 
		end
	end
	--长生诀免疫内伤
    if Curr_NG(eid,203) then
        return true 
    end	
	if JY.Status == GAME_WMAP and match_ID(eid,129) and WAR.PD['复活・王重阳'][eid] == 1 then
		return true
	end
    --天佛降世
	if match_ID(eid,9986) and JY.Status == GAME_WMAP and WAR.FUHUOZT[eid] ~=nil then
		return true 
    end	
	--太玄之轻免疫内伤
	if JY.Status == GAME_WMAP and WAR.TXZQ[eid] ~= nil and WAR.TXZQ[eid] == 1 then
		return true 
	end	
	--if WAR.TKJQ1[eid] and (eid == 0 and JY.Person[64][''])
	if JY.Status == GAME_WMAP and WAR.PD['免疫内伤'][eid] ~= nil then
		return true
	end	
	return false
end

--免疫流血
function mylx(eid)
	--local eid = WAR.Person[i]['人物编号']
	if JY.Status == GAME_WMAP and WAR.PD['神教逆杀'][eid] ~= nil then
		return false
	end	
	if JY.Status == GAME_WMAP and WAR.PD['血流不止'][eid] ~= nil then
		return false
	end	
	if JY.Status == GAME_WMAP then
		if WAR.CurID ~= nil then
			if WAR.PD['血衣剑法1'][WAR.Person[WAR.CurID]['人物编号']] == 1 then
				return false
			end
		end
	end
	if JY.Status == GAME_WMAP and WAR.CQSX == 1 then 
		return true 
	end
		
	--五宝花蜜酒免疫中毒
	if JY.Status == GAME_WMAP and WAR.PD['五宝花蜜酒'][eid] ~= nil  then
		return true 
	end      
	--套装效果免疫流血
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 11 then
			return true 
		end
	end
		
	if JY.Status == GAME_WMAP and WAR.PD['免疫流血'][eid] ~= nil then
		return true
	end	
	
	return false
end

--免疫中毒
function myzd(eid)
	--local eid = WAR.Person[i]['人物编号']
	if actor(eid,9) or MPTX(eid,1) or MPTX(eid,8) then
		return false
	end
	if JY.Status == GAME_WMAP then
		if WAR.PD['中毒不解'][eid] ~= nil or WAR.PD['夜雨绵延'][eid] ~= nil then
			return false
		end
	end
	if JY.Status == GAME_WMAP then
		if WAR.CurID ~= nil then
			if match_ID(WAR.Person[WAR.CurID]['人物编号'], 631) and yongzhi(11) then
				return false
			end
		end
	end
	--陆无双免疫中毒
	if JXPD(eid, 580,1) then
		return true 
	end	
	--主运九阳
	if Curr_NG(eid,106) then
		return true
	end
	--易筋经免疫中毒
	if PersonKF(eid, 108) then
		return true 
	end
	--套装效果免疫中毒
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 12 then
			return true 
		end
	end
	--太玄之轻免疫中毒
	if JY.Status == GAME_WMAP and WAR.TXZQ[eid] ~= nil and WAR.TXZQ[eid] == 1 then
		return true 
	end
  	--五宝花蜜酒免疫中毒
	if JY.Status == GAME_WMAP and WAR.PD['五宝花蜜酒'][eid] ~= nil  then
		return true 
	end
	if JY.Status == GAME_WMAP and WAR.PD['免疫中毒'][eid] ~= nil then
		return true
	end
	return false
end

--免疫封穴
function myfx(eid)
	--local eid = WAR.Person[i]['人物编号']
	if JY.Status == GAME_WMAP and ((WAR.PD["点穴大师3"][eid] == 1 and math.random(10) > 6) or WAR.PD["点穴大师3"][eid] == 2) then
		return false
	end	
	if JY.Status == GAME_WMAP and MPTX(eid,8,3) and Curr_NG(eid,104) then
		return false
	end	
	if JY.Status == GAME_WMAP and WAR.PD['逆转经脉'][eid] ~= nil then
		return false
	end	
	if JY.Status == GAME_WMAP and WAR.CQSX == 1 then 
	    return true 
	end
	--套装效果免疫封穴
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 13 then
			return true 
		end
		
	end
	--逍遥御风累积9点，未行动前不会被封穴
	if JY.Status == GAME_WMAP and WAR.XYYF[eid] ~= nil and WAR.XYYF[eid] == 11 then
	    return true 
	end
	--白驼山机率免疫封穴
	if JY.Status == GAME_WMAP and MPTX(eid,8) and JLSD(10,40,eid) and (not (MPTX(eid,8,3) and Curr_NG(eid, 104))) then
		return true
	end
	--逆运免疫封穴
	if JY.Status == GAME_WMAP and Curr_NG(eid, 104) and (not (MPTX(eid,8,3))) then
	    return true 
	end
	--入魔
	if JY.Status == GAME_WMAP and WAR.PD['入魔'][eid] ~= nil and WAR.PD['入魔'][eid] == 1 then
		return true 
    end		
	--大周天功回复
	if JY.Status == GAME_WMAP and WAR.ZTHF[eid] ~= nil then
		return true 
	end	
	--阿九暴怒免封穴
	if JY.Status == GAME_WMAP and match_ID(eid, 629) and BNJQ(eid) then
	    return true 
	end	
    --黄裳免疫封穴
	if match_ID(eid,637) or match_ID(eid,92) then
	    return true 
	end	 	
	--主运瞬息千里，暴怒状态不会被封穴
	if JY.Status == GAME_WMAP and Curr_QG(eid,150) and BNJQ(eid) then
		return true 
	end
	if NGQH(eid,144) then
		return true
	end	
	if NGQH(eid,108) then
		return true
	end	
	if JY.Status == GAME_WMAP and match_ID(eid,65) and WAR.PD['复活・一灯'][eid] == 1 then
		return true
	end	
	if JY.Status == GAME_WMAP and WAR.PD['免疫封穴'][eid] ~= nil then
		return true
	end
	return false
end

--免疫冰封
function mybf(eid)
	--local eid = WAR.Person[i]['人物编号']
	if MPTX(eid,20) then
		return false
	end
	if Curr_NG(eid,367) then
		return true
	end	
	if JY.Status == GAME_WMAP then
		if WAR.PD['玄冰不化'][eid] ~= nil or (WAR.PD['雪羽冰封'][eid] ~= nil and math.random(10) < 4) then
			return false
		end
	end	
	if JY.Status == GAME_WMAP and  WAR.XMSZ1 == 11 then
		return false
	end
	if JY.Status == GAME_WMAP and WAR.CQSX == 1 then 
		return true 
	end
    if match_ID(eid, 9965) then
		return true 
	end
	--九阳组合
	if NGQH(eid,106) then
		return true 
	end
	
	if NGQH(eid,190) then
		return true
	end	
	
	--冰火阴阳决
	if Curr_NG(eid,250) then 
		return true 
	end
	
    --神足瑜伽
	if NGQH(eid,233) then
		return true
	end 		
	
	--套装效果免疫冰封
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 14 then
			return true 
		end
		
	end
	--胡一刀免疫冰封
	if match_ID(eid,633) then
		return true 
	end	
	
	--寇仲免疫冰封
	if match_ID(eid,578) or  match_ID(eid,9978) then
		return true 
	end			
	
	--白秀
	if match_ID(eid,582) then 
		return true 
	end	
	
	--白万剑
	if match_ID(eid,43) or match_ID(eid,9823) then 
		return true 
	end	
	
	--五宝花蜜酒免疫冰封
	if JY.Status == GAME_WMAP and WAR.PD['五宝花蜜酒'][eid] ~= nil  then
		return true 
	end 
	if PersonKF(eid,13) and PersonKF(eid,196) then
		return true
	end

	if JY.Status == GAME_WMAP and WAR.PD['免疫冰封'][eid] ~= nil then
		return true
	end	
	
	return false
end

--免疫灼烧
function myzs(eid)
	--local eid = WAR.Person[i]['人物编号']
	if JY.Status == GAME_WMAP and WAR.PD['焚炎不尽'][eid] ~= nil then
		return false
	end	
    if match_ID(eid, 9965) then
		return true 
	end
	if JY.Status == GAME_WMAP and  WAR.CQSX == 1 then 
		return true 
	end
	--冰火阴阳决
	if Curr_NG(eid,250) then 
		return true 
	end

    --玉女先天
	if NGQH(eid,154) then
		return true 
	end	
	
	if NGQH(eid,190) then
		return true
	end	
	--主运易水寒
	if Curr_NG(eid,43) then
		return true 
	end

	if NGQH(eid,93) then
		return true
	end
	
	if match_ID(eid,505) or match_ID(eid,9977) then
		return true
	end
	
	--套装效果免疫灼烧
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][5] == 15 then
			return true 
		end
		
	end
	--五宝花蜜酒免疫
	if JY.Status == GAME_WMAP and WAR.PD['五宝花蜜酒'][eid] ~= nil  then
		return true 
	end 
	
	if JY.Status == GAME_WMAP and WAR.PD['免疫灼烧'][eid] ~= nil then
		return true
	end	
	
	return false
end

--免疫混乱
function myhl(i)
	local eid = WAR.Person[i]['人物编号']
    --套装效果免疫混乱
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][6] == 1 then
			return true
		end
	end
	--夜雨不沾衣
	if Curr_QG(eid,304) then
		return true
	end	
	--花间游高阶
	if QGQH(eid,286,2) then
		return true
	end
	return false
end

--免疫昏迷
function myhm(i)
	local eid = WAR.Person[i]['人物编号']
	--套装效果免疫昏迷
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][6] == 5 then
			return true
		end
	end
	if Curr_NG(eid,367) and rwnlxz(eid,0) and psxper(i,'内力',0.4,1) then
		return true
	end
	if NGQH(eid,108) and rwnlxz(eid,2) and psxper(i,'内力',0.4,1) then
		return true
	end
	--花间游高阶
	if QGQH(eid,286,2) then
		return true
	end
	if WAR.PD['阳神降世'][eid] ~= nil or WAR.PD['阴圣再临'][eid] ~= nil then
		return true
	end	
	if WAR.PD['血战到底'][eid] ~= nil and WAR.PD['血战到底'][eid] == 1 then
		return true
	end	
	return false
end

--免疫锁足
function mysz(i)
    local eid = WAR.Person[i]['人物编号']
    --万里独行
    if match_ID(eid, 9962) or match_ID(eid, 29) then 
        return true
    end
	--套装效果免疫锁足
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][6] == 7 then
			return true
		end
	end
	--金关
	if PersonKF(eid,249) then 
		return true
	end
	--夜雨不沾衣
	if Curr_QG(eid,304) then
		return true
	end	
	--花间游高阶
	if QGQH(eid,286,2) then
		return true
	end
	return false
end

--立刻出手判定
Ct['立刻出手'] = function(i)
	local id = WAR.Person[i]['人物编号']
	local pd = true
	local num = 0
	for j = 0 , WAR.PersonNum-1 do
		if match_ID(WAR.Person[j]['人物编号'],517) and WAR.Person[j]['死亡'] == false and DWPD(i,j) then
			pd = false
		end
	end
	if pd == false then
		WAR.Person[i].Time = -200
		WAR.PD['脆弱状态'][id] = 3
		WAR.PD['麻痹状态'][id] = 10
		WAR.PD['虚弱状态'][id] = 10
		WAR.PD['回魂仙梦'][id] = math.random(10,15)
		do return end
	end	
	if WAR.ATK['人物pd'][id] == nil and pd == true and WAR.PD['插队判定'][id] == nil then 
		WAR.PD['插队判定'][id] = 1
		if match_ID(id,517) or match_ID(id,592) or (WAR.ZDDH == 402 and WAR.RWSZ < 3 and match_ID(id,457)) or match_ID(id,9774) then
			num = 7
		end
		if match_ID(id,520) then
			num = 5
		end
		if (math.random(10) >= (8 - num)) or (WAR.PD['易水四寒2'][id] == 5) or (WAR.PD['鲸龟沉眠'][id] ~= nil and WAR.PD['鲸龟沉眠'][id] == 1) then	
			WAR.ATK['人物table'][#WAR.ATK['人物table']+1] = i
			WAR.ATK['人物pd'][id] = #WAR.ATK['人物table']
		else
			if WAR.Person[i].TimeAdd == nil then
				WAR.Person[i].TimeAdd = math.random(600,800)
				DrawTimeBar2()
			else
				WAR.Person[i].TimeAdd = WAR.Person[i].TimeAdd + math.random(600,800)
				DrawTimeBar2()
			end
		end			
	end
end

--人物移动步数判定
Ct['人物移动步数'] = function()
	local function getnewmove(x, y)
		if x > 1500 then
			x = 1500
		end
		local mob = x/2 + y*5
		if mob > 1200 then
			return 8
			elseif mob > 950 then
			return 6
			elseif mob > 700 then
			return 5
			elseif mob > 500 then
			return 4
		elseif mob > 300 then
			return 3
		elseif mob > 150 then
			return 2
		else
			return 1
		end
	end
    local p = WAR.CurID
    local id = WAR.Person[p]['人物编号']
    --左右触发之后，不可移动
    if WAR.ZYHB == 2 then
		WAR.Person[p]["移动步数"] = 0
	elseif WAR.QJBMS[id] ~= nil then 
        WAR.Person[p]["移动步数"] = 0		
	--特效：不可移动
	elseif WAR.PD["锁足状态"][id] ~= nil and WAR.PD["锁足状态"][id] == 1 and mysz(p) == false then
    	WAR.Person[p]["移动步数"] = 0
	elseif WAR.PD["七伤拳土"][id] ~= nil and WAR.PD["七伤拳土"][id] == 1 and mysz(p) == false then
    	WAR.Person[p]["移动步数"] = 0	
	elseif WAR.PD["枪神诀2"][id] ~= nil and WAR.PD["枪神诀2"][id] == 1 and mysz(p) == false then
    	WAR.Person[p]["移动步数"] = 0	
	elseif WAR.PD["封印"][id] ~= nil and WAR.PD["封印"][id] > 0 and mysz(p) == false then
    	WAR.Person[p]["移动步数"] = 0
	else
        --计算移动步数
		local nsjyd = math.modf(JY.Person[id]["受伤程度"] / 30)
		local zdjyd = math.modf(JY.Person[id]["中毒程度"] / 50)
		if MPTX(id,8) and Curr_QG(id,150) then
			nsjyd = -nsjyd
		end
		--毒王
		if actor(id,9) then
			zdjyd = -zdjyd
		end	
		--白驼、星宿
		if MPTX(id,1) or MPTX(id,8) then
			if actor(id,9) then
			else
			    zdjyd = 0
			end
		end	
		WAR.Person[p]["移动步数"] = math.modf(getnewmove(Qg(p), JY.Person[id]["体力"]) - nsjyd - zdjyd)

		if JY.Person[id]["主运轻功"] > 0 then --轻功的移动步数增加公式
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 1
			if JY.Person[id]["轻功"] > 400 then
				local ydb = math.modf((JY.Person[id]["轻功"] - 400) / 300)
				if Curr_QG(id,300) then	
					ydb = ydb + 1
				end	
				WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + ydb
			end
		end		
		--踏雪无痕
		if Curr_QG(id,277) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 2
		end
		--追魂无影
		if Curr_QG(id,278) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 3
		end 
		--金雁功进阶移动+2
		if QGQH(id,223,1) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 2
		end
		--飞天神行
		if WAR.PD["飞天步"][id] ~= nil then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 1
		end	
		--令狐冲，灭绝，血刀老祖，阿凡提，神雕移动+3格
		if match_ID(id, 35) or match_ID(id, 6) or match_ID(id, 97) or match_ID(id, 606) or match_ID(id, 9802) or match_ID(id,530) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 3
		end
		--铁腿水上飘，移动+5
		if match_ID(id, 67) or match_ID(id, 9852) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 5
        end
		--桃花岛灵鳌步
		if (MPTX(id,10,2) or match_ID(id,588) or match_ID(id,57)) and PersonKF(id,237) then 
			local mpdj = MPDJ(id)
			local aa = math.modf(JY.Person[id]["轻功"]/250)
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + mpdj * aa		
		end
		--胡一刀
		if match_ID(id,633) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 1
		end
		if WAR.PD["太玄组合防御4"][id] ~= nil then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 2
			WAR.PD["太玄组合防御4"][id] = nil
		end	
		--白展堂、全真教
		if match_ID(id, 511) or MPTX(id,16) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 2
        end
		--雪羽宗
		if MPTX(id,20) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 2
		end
		--昆仑派阵法
		if WAR.PD['风雷惊蛰1'][id] ~= nil then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + WAR.PD['风雷惊蛰1'][id]
		end
		--套装效果坐骑
		if PDTZ(id,JY.Person[id]["武器"]) then
			local n = JY.Person[id]["武器"]
			local m = Setmeal[n][6]
			if  m == 2  then
				WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 2
			end	
		end
		--f里行天x，增加2格移动距离
		if match_ID(id, 9962) or match_ID(id, 29) then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 2
		end
		
		--主角学会迷踪步后，移动+1
		if id == 0 and JY.Person[615]["论剑奖励"] == 1 and JY.Base['标准'] > 0 then
			WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] + 1
		end
		
		--踏雪无痕
		if (Curr_QG(WAR.Person[p]['人物编号'],277) == false and WAR.PD["神足护盾"][id] == nil) and mysz(p) == false then
			--天罗地网，柔网势，敌人移动减一格
			if WAR.TLDW[WAR.Person[p]["人物编号"]] ~= nil and WAR.TLDW[WAR.Person[p]["人物编号"]] == 1 then
				WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - 1
				WAR.TLDW[WAR.Person[p]["人物编号"]] = nil
			end
			--张家辉的麻痹戒指，减少敌人移动
			if WAR.PD["麻痹状态"][id] ~= nil then
				WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - WAR.PD["麻痹状态"][id]
			end
			if WAR.PD['风雷惊蛰2'][id] ~= nil then
				WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - WAR.PD['风雷惊蛰2'][id]
			end
			if WAR.PD["洞火"][id] ~= nil then
				WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - 3
			end
			--
			if WAR.PD['头晕目眩'][id] ~= nil then
				WAR.Person[p]["移动步数"] = math.modf(WAR.Person[p]["移动步数"]/2)
			end
			--雪羽宗
			for j = 0 , WAR.PersonNum -1 do 
				if WAR.Person[j]["死亡"] == false and DWPD(p,j) then
					if MPTX(WAR.Person[j]["人物编号"],20) and RealJL(p,j,9) then
						WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - 3
						break
					end
				end
			end	
			--天赋66小昭，限制移动
			local tf66 = hastf(p,66,2)
			if tf66 ~= nil then
				for j = 1,#tf66 do 
					WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - 1
				end
			end
			--天赋57黄药师，限制移动
			local tf57 = hastf(p,57,2)
			if tf57 ~= nil then
				for j = 1,#tf57 do
					WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - 2
				end
			end
			--天赋498，限制移动
			local tf498 = hastf(p,498,2)
			if tf498 ~= nil then
				for j = 1,#tf498 do 
					WAR.Person[p]["移动步数"] = WAR.Person[p]["移动步数"] - 1
				end
			end
		end
	end
	--张三丰，移动至少8格
	if match_ID(id, 5) and WAR.Person[p]["移动步数"] < 8 then
		WAR.Person[p]["移动步数"] = 8
	end	
	--朝廷金戈
	if MPTX(id,23,2) and WAR.Person[p]["移动步数"] < 8 then
		WAR.Person[p]["移动步数"] = 8
	end	
	--李寻欢学会蜻蜓三大抄水后，移动+2
	if match_ID(id, 498) and WAR.Person[p]["移动步数"] < 8 then
		WAR.Person[p]["移动步数"] = 8
	end	
	--喵姐，移动至少9格
	if match_ID(id, 92) and WAR.Person[p]["移动步数"] < 9 then
		WAR.Person[p]["移动步数"] = 9
	end	
	--独孤求败，移动锁定9格
	if match_ID(id, 592) then
		WAR.Person[p]["移动步数"] = 9
	end
	--金刚伏魔圈，移动变1格
	if match_ID(id,597) or match_ID(id,598) or match_ID(id,599) then
		WAR.Person[p]["移动步数"] = 1
	end
	--最大移动步数9
	if WAR.Person[p]["移动步数"] > 9 then
		if Curr_QG(id,300) then
			if WAR.Person[p]["移动步数"] > 12 and QGQH(id,300,2) then
				WAR.Person[p]["移动步数"] = 12
			elseif 	WAR.Person[p]["移动步数"] > 11 and QGQH(id,300,1) then
				WAR.Person[p]["移动步数"] = 11
			elseif WAR.Person[p]["移动步数"] > 10 then
				WAR.Person[p]["移动步数"] = 10
			end
		else
			WAR.Person[p]["移动步数"] = 9
		end	
	end
	if WAR.Person[p]["移动步数"] < 12 then
		if MPTX(id,23,4) and PersonKF(id,200) then --朝廷骑马
			WAR.Person[p]["移动步数"] = 12
		end
	end
	if WAR.Person[p]["移动步数"] < 0 then
        WAR.Person[p]["移动步数"] = 0
	end	
end

--天关阵法
Ct['天关阵'] = function()
	if WAR.ZDDH == 348 then
		if WAR.CD == 0 then 
			WAR.PD['天关阵4'] = {}
			local menu = {}
			local str = {[5] = '林',[27] = '风',[50] = '火',[114] = '山'}
			for i = 0,WAR.PersonNum-1 do 
				local id = WAR.Person[i]['人物编号']
				if WAR.Person[i]['死亡'] == false and WAR.Person[i]['我方'] == false then 
					if id == 5 or id == 27 or id == 50 or id == 114 then 
						menu[#menu+1] = {id,i}
					end
				end
			end
			if #menu > 1 then 
				local m = math.random(#menu)
				local id = menu[m][1]
				for i = 1,#menu do 
					if i ~= m then
						WAR.PD['天关阵4'][menu[i][1]] = id
					end
				end
                WAR.CurID = menu[m][2]
                WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 19,1,'风林火山・'..str[id],LimeGreen);
			end
			WAR.CD = WAR.TGCD[WAR.ZDDH]
		end
	end
end

--清除所有异常
Ct['清除所有异常'] = function(i)
	local pid = WAR.Person[i]['人物编号']
	if WAR.PD['枯血泣魂'][pid] ~= nil then
		do return end
	end	
	for j = 1,#WAR.Debuf do
		local yc = WAR.Debuf[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf1 do
		local yc =  WAR.Debuf1[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 1
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end		
	for j = 1,#WAR.Debuf2 do
		local yc = WAR.Debuf2[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 5
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf3 do
		local yc = WAR.Debuf3[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 1
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf4 do
		local yc = WAR.Debuf4[j][1]
		WAR.PD[yc][pid] = nil
	end
	for j = 1,#WAR.Debuf5 do
		local yc = WAR.Debuf5[j][1]
		WAR.PD[yc][pid] = nil
	end
	for j = 1,#WAR.Debuf6 do
		local yc = WAR.Debuf6[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
	for j = 1,#WAR.Debuf7 do
		local yc = WAR.Debuf7[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 1
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
	for j = 1,#WAR.Debuf8 do
		local yc = WAR.Debuf8[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf9 do
		local yc = WAR.Debuf9[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 5
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf10 do
		local yc = WAR.Debuf10[j][1]
		WAR.PD[yc][pid] = nil
	end
	for j = 1,#WAR.Debuf11 do
		local yc = WAR.Debuf11[j][1]
		WAR.PD[yc][pid] = nil
	end
end
Ct['清除高级异常'] = function(i)
	local pid = WAR.Person[i]['人物编号']
	if WAR.PD['枯血泣魂'][pid] ~= nil then
		do return end
	end	
	for j = 1,#WAR.Debuf2 do
		local yc = WAR.Debuf2[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf3 do
		local yc = WAR.Debuf3[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 1
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf4 do
		local yc = WAR.Debuf4[j][1]
		WAR.PD[yc][pid] = nil
	end
	for j = 1,#WAR.Debuf5 do
		local yc = WAR.Debuf5[j][1]
		WAR.PD[yc][pid] = nil
	end
	for j = 1,#WAR.Debuf8 do
		local yc = WAR.Debuf8[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf9 do
		local yc = WAR.Debuf9[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf10 do
		local yc = WAR.Debuf10[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
	for j = 1,#WAR.Debuf11 do
		local yc = WAR.Debuf11[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 1
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
end
Ct['清除中级异常'] = function(i)
	local pid = WAR.Person[i]['人物编号']	
	if WAR.PD['枯血泣魂'][pid] ~= nil then
		do return end
	end	
	for j = 1,#WAR.Debuf4 do
		local yc = WAR.Debuf4[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
	for j = 1,#WAR.Debuf5 do
		local yc = WAR.Debuf5[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 3
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
	for j = 1,#WAR.Debuf9 do
		local yc = WAR.Debuf9[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 2
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end	
	for j = 1,#WAR.Debuf10 do
		local yc = WAR.Debuf10[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 2
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
	for j = 1,#WAR.Debuf11 do
		local yc = WAR.Debuf11[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 1
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
end
Ct['清除低级异常'] = function(i)
	local pid = WAR.Person[i]['人物编号']	
	if WAR.PD['枯血泣魂'][pid] ~= nil then
		do return end
	end	
	for j = 1,#WAR.Debuf4 do
		local yc = WAR.Debuf4[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 2
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
	for j = 1,#WAR.Debuf5 do
		local yc = WAR.Debuf5[j][1]
		WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) - 2
		if WAR.PD[yc][pid] < 1 then
		    WAR.PD[yc][pid] = nil
		end
	end
end


--复活特效
function fuhuo(enemyid)
	local eid = WAR.Person[enemyid]['人物编号']
	--local now = WAR.Person[enemyid].Time
	--王重阳，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 129) and WAR.PD['复活・王重阳'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.LQZ[eid] = 100
		--畅想主角的七闪数量随天书增加，NPC固定为7
		if eid == 0 then
			WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
		else
			WAR.BDQS = 7
		end
		local modifier = 0.777
		WAR.Person[enemyid]["特效动画"] = 115
		WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
		WAR.PD['复活・王重阳'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].Time = 1005
		WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	
	--鹤笔翁，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 647) and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		say("吕布也倒啦！", 647, 1);
		WAR.LQZ[eid] = 100
		local modifier = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + JY.Person[eid]["生命最大值"] * modifier
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].Time = 1005
		WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	
	--龙啸九天
	if JY.Person[eid]["生命"] <= 0 and NGQHB(eid,369) and WAR.PD['复活・龙啸九天'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 115
		WAR.Person[enemyid]["特效文字3"] = "龙啸九天 重生状态"
		local modifier = 1
		WAR.PD['复活・龙啸九天'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + JY.Person[eid]["生命最大值"] * modifier
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].Time = 1005
		WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	--长生诀重生
	if JY.Person[eid]["生命"] <= 0 and PersonKF(eid, 203) then--and WAR.PD['复活・长生'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil
		local pd = false
		local cspd = false
		if (Curr_NG(eid,203) and PersonKF(eid,101) and PersonKF(eid,99)) or NGQH(eid,203) then
			cspd = true
		end	
		if cspd == true and WAR.PD['复活・长生'][eid] == nil then
			pd = true
		elseif cspd == true and WAR.PD['复活・长生'][eid] ~= nil and WAR.PD['复活・长生'][eid] > 0 then
			local jl = math.modf(100-(WAR.PD['复活・长生'][eid]*20))
			if jl < 15 then jl = 15 end
			if JLSD(0,jl,eid) then
				pd = true
				if WAR.PD['复活・长生'][eid] >= 2 then
					WAR.DLJ = 1
				end	
			end
		elseif cspd == false and WAR.PD['复活・长生'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
			pd = true
		end	
		if pd == true then
			WAR.Person[enemyid]["特效动画"] = 89
			WAR.Person[enemyid]["特效文字3"] = "长生起死回生"
			if cspd == true then
				WAR.PD['复活・长生'][eid] = ( WAR.PD['复活・长生'][eid] or 0) + 1
				if WAR.PD['复活・长生'][eid] == 1 then
					WAR.PD['长生真气'][eid] = 7
					if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
						WAR.Person[enemyid]['护盾'] = 9
					end
				else
					WAR.PD['长生真气'][eid] = limitX((WAR.PD['长生真气'][eid] or 0) + 3,1,7)
					if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
						WAR.Person[enemyid]['护盾'] = 9
					end
				end	
				WAR.Person[enemyid]["特效文字3"] = "天数有尽・长生无垠・复活"
			end
			local modifier = 0.6+JY.Base["天书数量"]*0.01
			--狄云 寇仲
			if match_ID(eid, 37) or match_ID(eid,456) or match_ID(eid, 578) or match_ID(eid, 505) or (NGQH(eid,203) and (WAR.PD['复活・长生'][eid] or 0) < 2)then
				modifier = 1
			--主运长生
			elseif Curr_NG(eid, 203) then
				if cspd == true then
					local sz = 1 - ((WAR.PD['复活・长生'][eid] or 0)*0.2)
					if sz < 0.2 then sz = 0.2 end
					modifier = sz + JY.Base["天书数量"]*0.02
				else
					modifier = 1
				end	
			else
				modifier = 0.6+JY.Base["天书数量"]*0.02
			end
			JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*modifier)
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*modifier)
			--WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + AddPersonAttrib(eid,"生命",math.modf(JY.Person[eid]["生命最大值"]*modifier))
			WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
			WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
			AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
			AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
			WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
			WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
			AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
			AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
			nuqi(eid,50)
			if match_ID(eid, 129) then
				WAR.LQZ[eid] = 100
				--畅想主角的七闪数量随天书增加，NPC固定为7
				if eid == 0 then
					WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
				else
					WAR.BDQS = 7
				end
				
				WAR.Person[enemyid]["特效动画"] = 115
				WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
			end
			--ztd(enemyid,'集气位置',500)
			WAR.Person[enemyid].Time = WAR.Person[enemyid].Time + 500
			if WAR.Person[enemyid].Time > 999 then
				WAR.Person[enemyid].Time = 999
			end
			WAR.TXXS[eid] = 1
			WAR.FUHUOZT[eid] = 1
			--狄云 寇仲
			if match_ID(eid, 37) or match_ID(eid, 578) or match_ID(eid, 505) or NGQH(eid,203) then
				WAR.Person[enemyid].TimeAdd = 999
			end
			if NGQHB(eid,180) then
				WAR.PD['鲸龟沉眠'][eid] = 1
				Cat('清除所有异常',enemyid)
				WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
			end
		end	
	end
	
	
	--神照重生
	if JY.Person[eid]["生命"] <= 0 and (PersonKF(eid,94) or match_ID(eid,9756) or match_ID(eid,9755)) and WAR.PD['复活・神照'][eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 89
		WAR.Person[enemyid]["特效文字3"] = "神照功起死回生"
		local modifier = 0.35+JY.Base["天书数量"]*0.01
		--狄云
		if match_ID(eid,37) or match_ID(eid,9756)  then
			modifier = 1
		--主运神照
		elseif Curr_NG(eid, 94) or match_ID(eid,9755) then
			modifier = 0.7+JY.Base["天书数量"]*0.02
		end
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
        if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
        end
		--ztd(enemyid,'集气位置',500)
		WAR.Person[enemyid].Time = WAR.Person[enemyid].Time + 500
		if WAR.Person[enemyid].Time > 999 then
			WAR.Person[enemyid].Time = 999
		end
		WAR.TXXS[eid] = 1
		WAR.FUHUOZT[eid] = 1
		--狄云
		if match_ID(eid, 37) then
			WAR.Person[enemyid].Time = 999
		end
		--10%的几率二次复活
		if math.random(100) > 10 then		
            WAR.PD['复活・神照'][eid] = 1
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
    
 	--天佛降世
	if JY.Person[eid]["生命"] <= 0 and (match_ID(eid, 9986) or (NGQH(eid,108) and inteam(eid))) and WAR.PD['复活・天佛'][eid] == nil and WAR.FUHUOZT[eid] == nil and (match_ID(eid, 9986) or WAR.PD['复活无效'][eid] == nil) then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "天佛降世・起死回生"
		WAR.PD['复活・天佛'][eid] = 1
		local modifier = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + JY.Person[eid]["生命最大值"] * modifier
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
        end
		WAR.Person[enemyid].Time = 1005
		WAR.FUHUOZT[eid] = 1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end 
	
	--一灯，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 65) and WAR.PD['复活・一灯'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "先天一阳 起死回生"
		WAR.PD['复活・一灯'][eid] = 1
		local modifier = 0.7
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].Time = 1005
        WAR.FUHUOZT[eid] = 1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
    
	--萧秋水，天意复活 
	if JY.Person[eid]["生命"] <= 0 and (match_ID(eid, 652) or Curr_NG(eid,177)) and JY.Base["天书数量"] > 0 and WAR.PD['复活・天意'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "长歌正气 武穆移魂"
        WAR.PD['复活・天意'][eid] = 1
		local modifier = 0.8
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].Time = 1005
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
        end
		WAR.Person[enemyid].Time = 980
		WAR.FUHUOZT[eid]=1
		if NGQH(eid,177) then
			WAR.PD['战神状态'][eid] = 20
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
        
	--阿九 复活
	if JY.Person[eid]["生命"] <= 0 and JXPD(eid, 629,1) and WAR.PD['复活・阿九'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 154
		WAR.Person[enemyid]["特效文字3"] = "浴火重生"
		WAR.PD['复活・阿九'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*0.7)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*0.7)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"])* 0.5))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])* 0.5))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"] * 0.5))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*0.8))
		WAR.Person[enemyid].Time = 1005
        WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end	
    
	--戚长发，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 594) and WAR.QCF < 1 and WAR.PD['复活・戚长发'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "闭气离墙 起死回生"
		WAR.PD['复活・戚长发'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*0.8)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*0.8)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"])* 0.5))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])* 0.5))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"] * 0.5))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*0.8))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*0.5))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*0.5))
		WAR.Person[enemyid].Time = 1005
		WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	
	--葵花紫霞复活
	if JY.Person[eid]["生命"] <= 0 and NGQH(eid,105) and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 144
		WAR.Person[enemyid]["特效文字3"] = "葵花重生大法"
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*0.5))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*0.5))
		WAR.Person[enemyid].Time = 1005
		if WAR.PD['葵花护盾'][eid] == nil then 
			WAR.PD['葵花护盾'][eid] = 6
			if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
				WAR.Person[enemyid]['护盾'] = 7
			end
		end
		--WAR.KHCS = 1
		WAR.FUHUOZT[eid] = 1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end 	
  
	--薛慕华 复活一个人
	if JY.Person[eid]["生命"] <= 0 and WAR.XMH < 1 and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		for i = 0, WAR.PersonNum - 1 do
			if match_ID(WAR.Person[i]["人物编号"], 45) and WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[enemyid]["我方"] then
				WAR.Person[enemyid]["特效动画"] = 89
				WAR.Person[enemyid]["特效文字3"] = "阎王敌 重生"
				JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
				WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
				WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
				WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
				WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
				WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
				AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
				AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*0.5))
				AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*0.5))
				AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*0.5))
                if match_ID(eid, 129) then
                    WAR.LQZ[eid] = 100
                    --畅想主角的七闪数量随天书增加，NPC固定为7
                    if eid == 0 then
                        WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
                    else
                        WAR.BDQS = 7
                    end
                    WAR.Person[enemyid]["特效动画"] = 115
                    WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
                end
				WAR.XMH = 1
				WAR.FUHUOZT[eid] = 1
				if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
					WAR.PD['鲸龟沉眠'][eid] = 1
					Cat('清除所有异常',enemyid)
					WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
				end
				break
			end
		end
	end			
	
	--张家辉的复活戒指
	if JY.Person[eid]["生命"] <= 0 and JY.Person[eid]["防具"] == 303 and WAR.PD['复活无效'][eid] == nil then
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]))
        if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
            
        end
		WAR.Person[enemyid]["特效动画"] = 154
		WAR.Person[enemyid]["特效文字3"] = "复活戒指・重生"
		JY.Person[651]["品德"] = JY.Person[651]["品德"] - 1
		if JY.Person[651]["品德"] == 0 then
			JY.Person[eid]["防具"] = -1
			JY.Thing[303]["使用人"] = -1
			instruct_32(303,-1)
			WAR.FHJZ = 1
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	if JY.Person[eid]["生命"] <= 0 and ((PersonKF(eid,21) and PersonKF(eid,153) and Curr_NG(eid,43)) or match_ID(eid, 514)) and WAR.PD['易水四寒2'][eid] ~= 5 then
		WAR.ACT = 10
		WAR.DZY = 1
		WAR.DLJ = 1
		WAR.Person[enemyid]["特效动画"] = 209
		WAR.Person[enemyid]["特效文字3"] = "易水寒・此去无还"
		WAR.PD['易水四寒2'][eid] = 5
		JY.Person[eid]["生命"] = 100
		WAR.Person[enemyid]["生命点数"] = 100
		ztd(enemyid,'内力点数',psx(eid,'内力最大值'))
		ztd(enemyid,'体力点数',100)
		Cat('清除所有异常',enemyid)
		Cat('立刻出手',enemyid)
		WAR.Person[enemyid].Time = 1005
		nuqi(eid,100)
		zhanyi(eid,200)
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end  
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"    
        end
		if NGQH(eid,43) then
			if WAR.PD['易水寒冰'][eid] == nil then
				WAR.PD['易水寒冰'][eid] = 1
				if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
					WAR.Person[enemyid]['护盾'] = 33
				end
			end
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	--九命猫
	if JY.Person[eid]["生命"] <= 0 and WAR.PD['九命猫'][eid] ~= nil and WAR.PD['九命猫'][eid] > 0 then
		if WAR.Person[enemyid]["死亡"] == true then
			WAR.Person[enemyid]["死亡"] = false
		end
		WAR.Person[enemyid]["特效文字3"] = "不死狸猫"
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]))
		WAR.PD['九命猫'][eid] = WAR.PD['九命猫'][eid] - 1 
		if WAR.PD['九命猫'][eid] < 1 then
			WAR.PD['九命猫'][eid] = nil
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	--独孤
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid,592) and WAR.PD['无我之境'][eid] == nil then
		say("甚好！汝之境界，值得吾纵情一战！", 592, 1);
		WAR.ACT = 10
		WAR.DLJ = 1
		WAR.DZY = 1
		WAR.Person[enemyid]["特效动画"] = 226
		WAR.Person[enemyid]["特效文字3"] = "无我之境・纵情挥洒"
		WAR.PD['无我之境'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * 0.1)
		ztd(enemyid,'内力点数',psx(eid,'内力最大值'))
		ztd(enemyid,'体力点数',100)
		Cat('清除所有异常',enemyid)
		nuqi(eid,100)
		zhanyi(eid,200)
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	--NPC血战
	if JY.Person[eid]["生命"] < math.modf(JY.Person[eid]["生命最大值"]*0.3) and JY.Person[456]["论剑奖励"] > 0
	and JY.Person[eid]['畅想分阶'] < 3 and (not inteam(eid)) and WAR.PD['血战到底'][eid] == nil then
		WAR.DZY = 1
		WAR.DLJ = 1
		if JY.Person[eid]['畅想分阶'] < 2 or (JY.Person[456]["论剑奖励"] > 1 and JY.Person[eid]['畅想分阶'] < 3) then
			WAR.Person[enemyid]["特效动画"] = 7
			WAR.Person[enemyid]["特效文字3"] = "血战到底"
			WAR.ACT = 10
			Cat('清除中级异常',enemyid)
			JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*0.3)
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*0.4-JY.Person[eid]["生命"])
			WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]*0.3))
			if JY.Person[eid]['畅想分阶'] < 2 then
				WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",40)
				WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
				WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]))
				if JY.Person[456]["论剑奖励"] > 1 then
					AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
					AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]))
					AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]))
					AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]))
				end
				nuqi(eid,200)
				Cat('清除高级异常',enemyid)
			end
			if JY.Person[eid]['畅想分阶'] < 1 then
				zhanyi(eid,200)
				Cat('清除所有异常',enemyid)
			end
		end
		WAR.PD['血战到底'][eid] = 1
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end  
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"    
        end
	end
	--剑气留形
	if WAR.PD['剑气留形'][eid] == 1 and JY.Person[eid]["生命"] <= 0 then
	    if WAR.YINGSHA == 1 then
		    return 0
	    end
		local mid = 585
		local id = 0			
		JY.Person[mid]["姓名"] = "剑气化身"
		JY.Person[mid]["暂时无用"] = JY.Base["畅想"]			
		JY.Person[mid]["头像代号"] = JY.Person[id]["头像代号"]
		JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
		JY.Person[mid]["天赋内功"] = JY.Person[id]["天赋内功"]
		JY.Person[mid]["天赋外功1"] = JY.Person[id]["天赋外功1"]
		JY.Person[mid]["天赋外功2"] = JY.Person[id]["天赋外功2"]	
		JY.Person[mid]["天赋轻功"] = JY.Person[id]["天赋轻功"]			
		JY.Person[mid]["指法技巧"] = JY.Person[id]["指法技巧"]
		JY.Person[mid]["御剑能力"] = JY.Person[id]["御剑能力"]	
		JY.Person[mid]["耍刀技巧"] = JY.Person[id]["耍刀技巧"]
		JY.Person[mid]["特殊兵器"] = JY.Person[id]["特殊兵器"]
		JY.Person[mid]["武学常识"] = JY.Person[id]["武学常识"]
		JY.Person[mid]["攻击带毒"] = JY.Person[id]["攻击带毒"]
		JY.Person[mid]["左右互搏"] = JY.Person[id]["左右互搏"]
		JY.Person[mid]["门派技能3"] = JY.Person[id]["门派技能3"]
		JY.Person[mid]["中庸"] = JY.Person[id]["中庸"]
		JY.Person[mid]["攻击力"] = JY.Person[id]["攻击力"]
		JY.Person[mid]["防御力"] = JY.Person[id]["防御力"]
		JY.Person[mid]["轻功"] = JY.Person[id]["轻功"]
		JY.Person[mid]["医疗能力"] = JY.Person[id]["医疗能力"]
		JY.Person[mid]["用毒能力"] = JY.Person[id]["用毒能力"]
		JY.Person[mid]["暗器技巧"] = JY.Person[id]["暗器技巧"]
		JY.Person[mid]["抗毒能力"] = JY.Person[id]["抗毒能力"]
		JY.Person[mid]["个人觉醒"] = JY.Person[id]["个人觉醒"]
		JY.Person[mid]["六如觉醒"] = JY.Person[id]["六如觉醒"]
		JY.Person[mid]["畅想分阶"] = JY.Person[id]["畅想分阶"]				
		JY.Person[mid]["主运轻功"] = JY.Person[id]["主运轻功"]				
		JY.Person[mid]["主运内功"] = JY.Person[id]["主运内功"]				
		JY.Person[mid]["冰封程度"] = 0								
		JY.Person[mid]["灼烧程度"] = 0			
		JY.Person[mid]["中毒程度"] = 0			
		JY.Person[mid]["受伤程度"] = 0			
		JY.Person[mid]["实战"] = JY.Person[id]["实战"]				
		JY.Person[mid]["等级"] = JY.Person[id]["等级"]				
		JY.Person[mid]["门派技能1"] = JY.Person[id]["门派技能1"]				
		for o = 1,JY.Base["武功数量"] do				
			JY.Person[mid]["武功"..o] = JY.Person[id]["武功"..o]			
			JY.Person[mid]["武功等级"..o] = JY.Person[id]["武功等级"..o]			
		end			
		for i=1,5 do				
			JY.Person[mid]["出招动画帧数" .. i]=JY.Person[id]["出招动画帧数" .. i]			
			JY.Person[mid]["出招动画延迟" .. i]=JY.Person[id]["出招动画延迟" .. i]			
			JY.Person[mid]["武功音效延迟" .. i]=JY.Person[id]["武功音效延迟" .. i]		
		end	
		JY.Person[mid]["武器"] = JY.Person[id]["武器"]
		JY.Person[mid]["防具"] = JY.Person[id]["防具"]
		JY.Person[mid]["坐骑"] = JY.Person[id]["坐骑"]
		JY.Person[mid]["生命最大值"] = math.modf(JY.Person[id]["生命最大值"] * 1)
		JY.Person[mid]["生命"] = JY.Person[id]["生命最大值"]
		JY.Person[mid]["内力最大值"] = math.modf(JY.Person[id]["内力最大值"] * 1)
		JY.Person[mid]["内力"] = JY.Person[id]["内力最大值"]
		JY.Person[mid]["体力"] = 100
		JY.Person[mid]["生命增长"] = JY.Person[id]["生命增长"]
		JY.Person[mid]["内力性质"] = JY.Person[id]["内力性质"]
		JY.Person[mid]["性别"] = JY.Person[id]["性别"]
		JY.Person[mid]["资质"] = JY.Person[id]["资质"]
		--友军召唤
		if WAR.Person[enemyid]["我方"] == false then
			local x, y = WE_xy(WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"] - 1)
			NewWARPersonZJ(mid,false, x, y,false, 2);
		else
			local x, y = WE_xy(WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"] + 1)
			NewWARPersonZJ(mid,true, x, y,false, 2);
		end
		WAR.JQSDXS[mid] = (WAR.JQSDXS[id] or 100)
		WAR.SPIRIT[mid] = (WAR.SPIRIT[id] or 100)
		WAR.PD["分身瞬动"][mid] = 1 --让分身第一回合瞬动
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[enemyid]["我方"] then
				WAR.PD['凝结时空'][WAR.Person[i]["人物编号"]] = 1
				--if WAR.PD['秘孔战术'][WAR.Person[i]["人物编号"]] == nil then
					--WAR.PD['秘孔战术'][WAR.Person[i]["人物编号"]] = 25
				--end
			end
		end
		WAR.PD['剑气留形'][eid] = 2
		local s = nil
		s = enemyid
	    enemyid = WAR.PersonNum - 1
		say("什么！剑气留形？",0)  
		say("我们有缘再见！", 520, 0)
		enemyid = s
		WAR.YINGSHA = 1
		return 1 	
	end
	
	--易筋不死
	if ((WAR.PD['易筋组合判定'][eid] == 1 and Curr_NG(eid,108)) or NGQH(eid,108)) and JY.Person[eid]['生命'] < 1 and WAR.PD['易筋不死'][eid] == nil then
		if psxper(enemyid,'内力',0.2,1) then
			WAR.Person[enemyid]["特效文字3"] = "易筋真谛・跳脱轮回"
			JY.Person[eid]['生命'] = 1
			ztd(enemyid,'内力点数',-JY.Person[eid]["内力最大值"]*0.2)
		else
			WAR.Person[enemyid]["特效文字3"] = "易筋真谛・慈佛饲鹰"
			local a,b = math.modf(psx(eid,'生命最大值')*0.5),math.modf(psx(eid,'内力最大值')*0.5)
			for yj = 0, WAR.PersonNum -1 do
				if dead(yj) == false and DWPD(enemyid,yj) == false and yj ~= enemyid then
					ztd(yj,'生命点数',a)
					ztd(yj,'内力点数',b)
					ztd(yj,'体力点数',50)
					Cat('清除低级异常',yj)
				end	
			end
			WAR.PD['易筋不死'][eid] = 1
			JY.Person[eid]['生命'] = 0
		end			
	end		
	--真龙心法・不死真龙
	if ((PersonKF(eid,281) and inteam(eid) and JY.ZLXF == 1) or match_ID(eid,524) or match_ID(eid,776)) and JY.Person[eid]['生命'] < 10 then
		local sbjl = math.modf(((JY.Person[eid]["生命最大值"]-JY.Person[eid]["生命"])/JY.Person[eid]["生命最大值"])*35)
		if match_ID(eid,524) then
			sbjl = sbjl + math.modf(JY.Person[eid]["体力"]/3)
			WAR.PD['甩锅发动'][eid] = 1	
		end
		if JLSD(0,5+sbjl,eid) then
			WAR.Person[enemyid]["特效动画"] = 405
			WAR.Person[enemyid]["特效文字3"] = "不死真龙"
			JY.Person[eid]["生命"] = 10
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + 10
			Cat('清除所有异常',enemyid)
		end
	end
	--涅盘初
	if JY.Person[eid]["生命"] <= 0 and WAR.PD['涅盘初'][eid] == 1 and WAR.PD['复活无效'][eid] == nil then
		WAR.PD['涅盘初'][eid] = nil
		WAR.LQZ[eid] = 100
		local modifier = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * 0.5)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + JY.Person[eid]["生命最大值"] * modifier
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].Time = 1005
		WAR.FUHUOZT[eid]=1
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end  
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"    
        end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	if WAR.PD['轮回末'][eid] ~= nil then
		WAR.PD['轮回末'][eid] = nil 
		if JY.Person[eid]['生命'] > 1 then
			JY.Person[eid]['生命'] = 1
		end
	end
end

function fuhuo1(enemyid)
	local eid = WAR.Person[enemyid]['人物编号']
	local now = WAR.Person[enemyid].TimeAdd
	--王重阳，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 129) and WAR.PD['复活・王重阳'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.LQZ[eid] = 100
		--畅想主角的七闪数量随天书增加，NPC固定为7
		if eid == 0 then
			WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
		else
			WAR.BDQS = 7
		end
		local modifier = 0.777
		WAR.Person[enemyid]["特效动画"] = 115
		WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
		WAR.PD['复活・王重阳'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].TimeAdd = 1005
		--ztd(enemyid,'集气位置',1005-now)
		WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	
	--鹤笔翁，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 647) and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		say("吕布也倒啦！", 647, 1);
		WAR.LQZ[eid] = 100
		local modifier = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + JY.Person[eid]["生命最大值"] * modifier
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		--ztd(enemyid,'集气位置',1005-now)
		WAR.Person[enemyid].TimeAdd = 1005
		WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	
	--长生诀重生
	if JY.Person[eid]["生命"] <= 0 and PersonKF(eid, 203) then--and WAR.PD['复活・长生'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil
		local pd = false
		local cspd = false
		if (Curr_NG(eid,203) and PersonKF(eid,101) and PersonKF(eid,99)) or NGQH(eid,203) then
			cspd = true
		end	
		if cspd == true and WAR.PD['复活・长生'][eid] == nil then
			pd = true
		elseif cspd == true and WAR.PD['复活・长生'][eid] ~= nil and WAR.PD['复活・长生'][eid] > 0 then
			local jl = math.modf(100-(WAR.PD['复活・长生'][eid]*20))
			if jl < 15 then jl = 15 end
			if JLSD(0,jl,eid) then
				pd = true
				if WAR.PD['复活・长生'][eid] >= 2 then
					WAR.DLJ = 1
				end	
			end
		elseif cspd == false and WAR.PD['复活・长生'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
			pd = true
		end	
		if pd == true then
			WAR.Person[enemyid]["特效动画"] = 89
			WAR.Person[enemyid]["特效文字3"] = "长生起死回生"
			if cspd == true then
				WAR.PD['复活・长生'][eid] = ( WAR.PD['复活・长生'][eid] or 0) + 1
				if WAR.PD['复活・长生'][eid] == 1 then
					WAR.PD['长生真气'][eid] = 7
					if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
						WAR.Person[enemyid]['护盾'] = 9
					end
				else
					WAR.PD['长生真气'][eid] = limitX((WAR.PD['长生真气'][eid] or 0) + 3,1,7)
					if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
						WAR.Person[enemyid]['护盾'] = 9
					end
				end	
				WAR.Person[enemyid]["特效文字3"] = "天数有尽・长生无垠・复活"
			end
			local modifier = 0.6+JY.Base["天书数量"]*0.01
			--狄云 寇仲
			if match_ID(eid, 37) or match_ID(eid, 578) or match_ID(eid,456) or match_ID(eid, 505) or (NGQH(eid,203) and (WAR.PD['复活・长生'][eid] or 0) < 2)then
				modifier = 1
			--主运长生
			elseif Curr_NG(eid, 203) then
				if cspd == true then
					local sz = 1 - ((WAR.PD['复活・长生'][eid] or 0)*0.2)
					if sz < 0.2 then sz = 0.2 end
					modifier = sz + JY.Base["天书数量"]*0.02
				else
					modifier = 1
				end	
			else
				modifier = 0.6+JY.Base["天书数量"]*0.02
			end
			JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*modifier)
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*modifier)
			--WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + AddPersonAttrib(eid,"生命",math.modf(JY.Person[eid]["生命最大值"]*modifier))
			WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
			WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
			AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
			AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
			WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
			WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
			AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
			AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
			nuqi(eid,50)
			if match_ID(eid,129) then
				WAR.LQZ[eid] = 100
				--畅想主角的七闪数量随天书增加，NPC固定为7
				if eid == 0 then
					WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
				else
					WAR.BDQS = 7
				end
				
				WAR.Person[enemyid]["特效动画"] = 115
				WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
			end
			--ztd(enemyid,'集气位置',500)
			WAR.Person[enemyid].Time = WAR.Person[enemyid].Time + 500
			if WAR.Person[enemyid].Time > 999 then
				WAR.Person[enemyid].Time = 999
			end
			WAR.TXXS[eid] = 1
			WAR.FUHUOZT[eid] = 1
			--狄云 寇仲
			if match_ID(eid, 37) or match_ID(eid, 578) or match_ID(eid, 505) or NGQH(eid,203) then
				WAR.Person[enemyid].TimeAdd = 999
			end
			if NGQHB(eid,180) then
				WAR.PD['鲸龟沉眠'][eid] = 1
				Cat('清除所有异常',enemyid)
				WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
			end
		end	
	end	
	
	--神照重生
	if JY.Person[eid]["生命"] <= 0 and (PersonKF(eid, 94) or match_ID(eid, 9756) or match_ID(eid, 9755)) and WAR.PD['复活・神照'][eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 89
		WAR.Person[enemyid]["特效文字3"] = "神照功起死回生"
		local modifier = 0.35+JY.Base["天书数量"]*0.01
		--狄云
		if match_ID(eid, 37) or match_ID(eid, 9756)  then
			modifier = 1
		--主运神照
		elseif Curr_NG(eid, 94) or match_ID(eid, 9755) then
			modifier = 0.7+JY.Base["天书数量"]*0.02
		end
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
        if match_ID(eid,129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
        end
		--流血				
		--ztd(enemyid,'集气位置',500)
		WAR.Person[enemyid].Time = WAR.Person[enemyid].Time + 500
		if WAR.Person[enemyid].Time > 999 then
			WAR.Person[enemyid].Time = 999
		end
		WAR.TXXS[eid] = 1
		WAR.FUHUOZT[eid] = 1
        --WAR.PD['复活・神照'][eid] = 1
		--狄云	
		if match_ID(eid,37) and WAR.Person[enemyid].Time < 999 then
			WAR.Person[enemyid].TimeAdd = 999
		end
		--6%的几率二次复活
		if math.random(100) > 6 then		
            WAR.PD['复活・神照'][eid] = 1
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
    
 	--天佛降世
	if JY.Person[eid]["生命"] <= 0 and (match_ID(eid, 9986) or (NGQH(eid,108) and inteam(eid))) and WAR.PD['复活・天佛'][eid] == nil and WAR.FUHUOZT[eid] == nil and (match_ID(eid, 9986) or WAR.PD['复活无效'][eid] == nil) then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "天佛降世 起死回生"
		WAR.PD['复活・天佛'][eid] = 1
		local modifier = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + JY.Person[eid]["生命最大值"] * modifier
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
        end
        WAR.Person[enemyid].TimeAdd = 990
		--ztd(enemyid,'集气位置',1005-now)
		WAR.FUHUOZT[eid] = 1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end 
    
	--一灯，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 65) and WAR.PD['复活・一灯'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "先天一阳 起死回生"
		WAR.PD['复活・一灯'][eid] = 1
		local modifier = 0.7
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		--ztd(enemyid,'集气位置',1005-now)
		WAR.Person[enemyid].TimeAdd = 990
        WAR.FUHUOZT[eid] = 1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
    
	--萧秋水，天意复活 
	if JY.Person[eid]["生命"] <= 0 and (match_ID(eid, 652) or Curr_NG(eid,177)) and JY.Base["天书数量"] > 0 and WAR.PD['复活・天意'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "长歌正气 武穆移魂"
        WAR.PD['复活・天意'][eid] = 1
		local modifier = 0.8
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"] * modifier)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].TimeAdd = 1000
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
        end
		--ztd(enemyid,'集气位置',1005-now)
		WAR.FUHUOZT[eid]=1
		if NGQH(eid,177) then
			WAR.PD['战神状态'][eid] = 20
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
        
	--阿九 复活
	if JY.Person[eid]["生命"] <= 0 and JXPD(eid, 629,1) and WAR.PD['复活・阿九'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 154
		WAR.Person[enemyid]["特效文字3"] = "浴火重生"
		WAR.PD['复活・阿九'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*0.7)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*0.7)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"])* 0.5))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])* 0.5))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"] * 0.5))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*0.8))
		--ztd(enemyid,'集气位置',1005-now)
		WAR.Person[enemyid].TimeAdd = 1000
        WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end	
    
	--戚长发，复活
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid, 594) and WAR.QCF < 1 and WAR.PD['复活・戚长发'][eid] == nil and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 19
		WAR.Person[enemyid]["特效文字3"] = "闭气离墙 起死回生"
		WAR.PD['复活・戚长发'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*0.8)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*0.8)
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"])* 0.5))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])* 0.5))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"] * 0.5))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*0.8))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*0.5))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*0.5))
		--ztd(enemyid,'集气位置',1005-now)
		WAR.Person[enemyid].TimeAdd = 1000
		WAR.FUHUOZT[eid]=1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	
	--葵花紫霞复活
	if JY.Person[eid]["生命"] <= 0 and NGQH(eid,105) and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		WAR.Person[enemyid]["特效动画"] = 144
		WAR.Person[enemyid]["特效文字3"] = "葵花重生大法"
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*0.5))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*0.5))
		--ztd(enemyid,'集气位置',1005-now)
		WAR.Person[enemyid].TimeAdd = 1000
		if WAR.PD['葵花护盾'][eid] == nil then 
			WAR.PD['葵花护盾'][eid] = 6
			if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
				WAR.Person[enemyid]['护盾'] = 7
			end
		end
		--WAR.KHCS = 1
		WAR.FUHUOZT[eid] = 1
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end 	
  
	--薛慕华 复活一个人
	if JY.Person[eid]["生命"] <= 0 and WAR.XMH < 1 and WAR.FUHUOZT[eid] == nil and WAR.PD['复活无效'][eid] == nil then
		for i = 0, WAR.PersonNum - 1 do
			if match_ID(WAR.Person[i]["人物编号"], 45) and WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[enemyid]["我方"] then
				WAR.Person[enemyid]["特效动画"] = 89
				WAR.Person[enemyid]["特效文字3"] = "阎王敌 重生"
				JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
				WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
				WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
				WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
				WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
				WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"] * 0.5))
				AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
				AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*0.5))
				AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*0.5))
				AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*0.5))
                if match_ID(eid, 129) then
                    WAR.LQZ[eid] = 100
                    --畅想主角的七闪数量随天书增加，NPC固定为7
                    if eid == 0 then
                        WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
                    else
                        WAR.BDQS = 7
                    end
                    WAR.Person[enemyid]["特效动画"] = 115
                    WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
                end
				WAR.XMH = 1
				WAR.FUHUOZT[eid] = 1
				if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
					WAR.PD['鲸龟沉眠'][eid] = 1
					Cat('清除所有异常',enemyid)
					WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
				end
				break
			end
		end
	end			
	
	--张家辉的复活戒指
	if JY.Person[eid]["生命"] <= 0 and JY.Person[eid]["防具"] == 303 and WAR.PD['复活无效'][eid] == nil then
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]))
        if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"
        end
		WAR.Person[enemyid]["特效动画"] = 154
		WAR.Person[enemyid]["特效文字3"] = "复活戒指・重生"
		JY.Person[651]["品德"] = JY.Person[651]["品德"] - 1
		if JY.Person[651]["品德"] == 0 then
			JY.Person[eid]["防具"] = -1
			JY.Thing[303]["使用人"] = -1
			instruct_32(303,-1)
			WAR.FHJZ = 1
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	if JY.Person[eid]["生命"] <= 0 and ((PersonKF(eid,21) and PersonKF(eid,153) and Curr_NG(eid,43)) or match_ID(eid, 514)) and WAR.PD['易水四寒2'][eid] ~= 5 then
		WAR.ACT = 10
		WAR.DZY = 1
		WAR.DLJ = 1
		WAR.Person[enemyid]["特效动画"] = 209
		WAR.Person[enemyid]["特效文字3"] = "易水寒・此去无还"
		WAR.PD['易水四寒2'][eid] = 5
		JY.Person[eid]["生命"] = 100
		WAR.Person[enemyid]["生命点数"] = 100
		ztd(enemyid,'内力点数',psx(eid,'内力最大值'))
		ztd(enemyid,'体力点数',100)
		Cat('清除所有异常',enemyid)
		Cat('立刻出手',enemyid)
		WAR.Person[enemyid].Time = 1005
		nuqi(eid,100)
		zhanyi(eid,200)
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end  
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"    
        end
		if NGQH(eid,43) then
			if WAR.PD['易水寒冰'][eid] == nil then
				WAR.PD['易水寒冰'][eid] = 1
				if WAR.Person[enemyid]['护盾'] == nil  or WAR.Person[enemyid]['护盾'] <= -1 then
					WAR.Person[enemyid]['护盾'] = 33
				end
			end
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	--九命猫
	if JY.Person[eid]["生命"] <= 0 and WAR.PD['九命猫'][eid] ~= nil and WAR.PD['九命猫'][eid] > 0 then
		if WAR.Person[enemyid]["死亡"] == true then
			WAR.Person[enemyid]["死亡"] = false
		end
		WAR.Person[enemyid]["特效文字3"] = "不死狸猫"
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"])
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",100)
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]))
		AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]))
		WAR.PD['九命猫'][eid] = WAR.PD['九命猫'][eid] - 1 
		if WAR.PD['九命猫'][eid] < 1 then
			WAR.PD['九命猫'][eid] = nil
		end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	--独孤
	if JY.Person[eid]["生命"] <= 0 and match_ID(eid,592) and WAR.PD['无我之境'][eid] == nil then
		say("甚好！汝之境界，值得吾纵情一战！", 592, 1);
		WAR.ACT = 10
		WAR.DLJ = 1
		WAR.DZY = 1
		WAR.Person[enemyid]["特效动画"] = 226
		WAR.Person[enemyid]["特效文字3"] = "无我之境・纵情挥洒"
		WAR.PD['无我之境'][eid] = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * 0.1)
		ztd(enemyid,'内力点数',psx(eid,'内力最大值'))
		ztd(enemyid,'体力点数',100)
		Cat('清除所有异常',enemyid)
		nuqi(eid,100)
		zhanyi(eid,200)
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	--NPC血战
	if JY.Person[eid]["生命"] < math.modf(JY.Person[eid]["生命最大值"]*0.3) and JY.Person[456]["论剑奖励"] > 0
	and JY.Person[eid]['畅想分阶'] < 3 and (not inteam(eid)) and WAR.PD['血战到底'][eid] == nil then
		WAR.DZY = 1
		WAR.DLJ = 1
		if JY.Person[eid]['畅想分阶'] < 2 or (JY.Person[456]["论剑奖励"] > 1 and JY.Person[eid]['畅想分阶'] < 3) then
			WAR.Person[enemyid]["特效动画"] = 7
			WAR.Person[enemyid]["特效文字3"] = "血战到底"
			WAR.ACT = 10
			Cat('清除中级异常',enemyid)
			JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"]*0.3)
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + math.modf(JY.Person[eid]["生命最大值"]*0.4-JY.Person[eid]["生命"])
			WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf(JY.Person[eid]["内力最大值"]*0.3))
			if JY.Person[eid]['畅想分阶'] < 2 then
				WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",40)
				WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]))
				WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]))
				if JY.Person[456]["论剑奖励"] > 1 then
					AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]))
					AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]))
					AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]))
					AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]))
				end
				nuqi(eid,200)
				Cat('清除高级异常',enemyid)
			end
			if JY.Person[eid]['畅想分阶'] < 1 then
				zhanyi(eid,200)
				Cat('清除所有异常',enemyid)
			end
		end
		WAR.PD['血战到底'][eid] = 1
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end  
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"    
        end
	end
	--剑气留形
	if WAR.PD['剑气留形'][eid] == 1 and JY.Person[eid]["生命"] <= 0 then
	    if WAR.YINGSHA == 1 then
		    return 0
	    end
		local mid = 585
		local id = 0		
		JY.Person[mid]["姓名"] = "剑气化身"	
		JY.Person[mid]["暂时无用"] = JY.Base["畅想"]			
		JY.Person[mid]["头像代号"] = JY.Person[id]["头像代号"]
		JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
		JY.Person[mid]["天赋内功"] = JY.Person[id]["天赋内功"]
		JY.Person[mid]["天赋外功1"] = JY.Person[id]["天赋外功1"]
		JY.Person[mid]["天赋外功2"] = JY.Person[id]["天赋外功2"]	
		JY.Person[mid]["天赋轻功"] = JY.Person[id]["天赋轻功"]			
		JY.Person[mid]["指法技巧"] = JY.Person[id]["指法技巧"]
		JY.Person[mid]["御剑能力"] = JY.Person[id]["御剑能力"]	
		JY.Person[mid]["耍刀技巧"] = JY.Person[id]["耍刀技巧"]
		JY.Person[mid]["特殊兵器"] = JY.Person[id]["特殊兵器"]
		JY.Person[mid]["武学常识"] = JY.Person[id]["武学常识"]
		JY.Person[mid]["攻击带毒"] = JY.Person[id]["攻击带毒"]
		JY.Person[mid]["左右互搏"] = JY.Person[id]["左右互搏"]
		JY.Person[mid]["中庸"] = JY.Person[id]["中庸"]
		JY.Person[mid]["门派技能3"] = JY.Person[id]["门派技能3"]
		JY.Person[mid]["攻击力"] = JY.Person[id]["攻击力"]
		JY.Person[mid]["防御力"] = JY.Person[id]["防御力"]
		JY.Person[mid]["轻功"] = JY.Person[id]["轻功"]
		JY.Person[mid]["医疗能力"] = JY.Person[id]["医疗能力"]
		JY.Person[mid]["用毒能力"] = JY.Person[id]["用毒能力"]
		JY.Person[mid]["暗器技巧"] = JY.Person[id]["暗器技巧"]
		JY.Person[mid]["抗毒能力"] = JY.Person[id]["抗毒能力"]
		JY.Person[mid]["个人觉醒"] = JY.Person[id]["个人觉醒"]
		JY.Person[mid]["六如觉醒"] = JY.Person[id]["六如觉醒"]
		JY.Person[mid]["畅想分阶"] = JY.Person[id]["畅想分阶"]				
		JY.Person[mid]["主运轻功"] = JY.Person[id]["主运轻功"]				
		JY.Person[mid]["主运内功"] = JY.Person[id]["主运内功"]				
		JY.Person[mid]["冰封程度"] = 0								
		JY.Person[mid]["灼烧程度"] = 0			
		JY.Person[mid]["中毒程度"] = 0			
		JY.Person[mid]["受伤程度"] = 0			
		JY.Person[mid]["实战"] = JY.Person[id]["实战"]				
		JY.Person[mid]["等级"] = JY.Person[id]["等级"]				
		JY.Person[mid]["门派技能1"] = JY.Person[id]["门派技能1"]				
		for o = 1,JY.Base["武功数量"] do				
			JY.Person[mid]["武功"..o] = JY.Person[id]["武功"..o]			
			JY.Person[mid]["武功等级"..o] = JY.Person[id]["武功等级"..o]			
		end			
		for i=1,5 do				
			JY.Person[mid]["出招动画帧数" .. i]=JY.Person[id]["出招动画帧数" .. i]			
			JY.Person[mid]["出招动画延迟" .. i]=JY.Person[id]["出招动画延迟" .. i]			
			JY.Person[mid]["武功音效延迟" .. i]=JY.Person[id]["武功音效延迟" .. i]		
		end	
		JY.Person[mid]["武器"] = JY.Person[id]["武器"]
		JY.Person[mid]["防具"] = JY.Person[id]["防具"]
		JY.Person[mid]["坐骑"] = JY.Person[id]["坐骑"]
		JY.Person[mid]["生命最大值"] = math.modf(JY.Person[id]["生命最大值"] * 1)
		JY.Person[mid]["生命"] = JY.Person[id]["生命最大值"]
		JY.Person[mid]["内力最大值"] = math.modf(JY.Person[id]["内力最大值"] * 1)
		JY.Person[mid]["内力"] = JY.Person[id]["内力最大值"]
		JY.Person[mid]["体力"] = 100
		JY.Person[mid]["生命增长"] = JY.Person[id]["生命增长"]
		JY.Person[mid]["内力性质"] = JY.Person[id]["内力性质"]
		JY.Person[mid]["性别"] = JY.Person[id]["性别"]
		JY.Person[mid]["资质"] = JY.Person[id]["资质"]
		--友军召唤
		if WAR.Person[enemyid]["我方"] == false then
			local x, y = WE_xy(WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"] - 1)
			NewWARPersonZJ(mid,false, x, y,false, 2);
		else
			local x, y = WE_xy(WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"] + 1)
			NewWARPersonZJ(mid,true, x, y,false, 2);
		end
		WAR.JQSDXS[mid] = (WAR.JQSDXS[id] or 100)
		WAR.SPIRIT[mid] = (WAR.SPIRIT[id] or 100)
		--WAR.PD["分身判定"][eid] = mid --判断自己是不是发动过分身
		--WAR.PD["分身判定1"][mid] = id --用来做死后复活
		--WAR.PD["分身上限"][eid] = 1
		WAR.PD["分身瞬动"][mid] = 1 --让分身第一回合瞬动
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[enemyid]["我方"] then
				WAR.PD['凝结时空'][WAR.Person[i]["人物编号"]] = 1
				--if WAR.PD['秘孔战术'][WAR.Person[i]["人物编号"]] == nil then
					--WAR.PD['秘孔战术'][WAR.Person[i]["人物编号"]] = 25
				--end
			end
		end
		WAR.PD['剑气留形'][eid] = 2
		local s = nil
		s = enemyid
	    enemyid = WAR.PersonNum - 1
		say("什么！剑气留形？",0)  
		say("我们有缘再见！", 520, 0)
		enemyid = s
		WAR.YINGSHA = 1
		return 1 	
	end	
	--真龙心法・不死真龙
	if ((PersonKF(eid,281) and inteam(eid) and JY.ZLXF == 1) or match_ID(eid,524) or match_ID(eid,776)) and JY.Person[eid]['生命'] < 10 then
		local sbjl = math.modf(((JY.Person[eid]["生命最大值"]-JY.Person[eid]["生命"])/JY.Person[eid]["生命最大值"])*35)
		if match_ID(eid,524) then
			sbjl = sbjl + math.modf(JY.Person[eid]["体力"]/3)
			WAR.PD['甩锅发动'][eid] = 1	
		end
		if JLSD(0,5+sbjl,eid) then
			WAR.Person[enemyid]["特效动画"] = 405
			WAR.Person[enemyid]["特效文字3"] = "不死真龙"
			JY.Person[eid]["生命"] = 10
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + 10
			Cat('清除所有异常',enemyid)
		end
	end
	--易筋不死
	if ((WAR.PD['易筋组合判定'][eid] == 1 and Curr_NG(eid,108)) or NGQH(eid,108)) and JY.Person[eid]['生命'] < 1 and WAR.PD['易筋不死'][eid] == nil then
		if psxper(enemyid,'内力',0.2,1) then
			WAR.Person[enemyid]["特效文字3"] = "易筋真谛・跳脱轮回"
			JY.Person[eid]['生命'] = 1
			ztd(enemyid,'内力点数',-JY.Person[eid]["内力最大值"]*0.2)
		else
			WAR.Person[enemyid]["特效文字3"] = "易筋真谛・慈佛饲鹰"
			local a,b = math.modf(psx(eid,'生命最大值')*0.5),math.modf(psx(eid,'内力最大值')*0.5)
			for yj = 0, WAR.PersonNum -1 do
				if dead(yj) == false and DWPD(enemyid,yj) == false and yj ~= enemyid then
					ztd(yj,'生命点数',a)
					ztd(yj,'内力点数',b)
					ztd(yj,'体力点数',50)
					Cat('清除低级异常',yj)
				end	
			end
			WAR.PD['易筋不死'][eid] = 1
			JY.Person[eid]['生命'] = 0
		end			
	end		
	--涅盘初
	if JY.Person[eid]["生命"] <= 0 and WAR.PD['涅盘初'][eid] == 1 and WAR.PD['复活无效'][eid] == nil then
		WAR.PD['涅盘初'][eid] = nil
		WAR.LQZ[eid] = 100
		local modifier = 1
		JY.Person[eid]["生命"] = math.modf(JY.Person[eid]["生命最大值"] * 0.5)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + JY.Person[eid]["生命最大值"] * modifier
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",math.modf((JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])*modifier))
		WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",math.modf((100 - JY.Person[eid]["体力"])*modifier))
        AddPersonAttrib(eid,"封穴程度",-math.modf(JY.Person[eid]["封穴程度"]*modifier))
		AddPersonAttrib(eid,"流血程度",-math.modf(JY.Person[eid]["流血程度"]*modifier))
		WAR.Person[enemyid]["中毒点数"] = (WAR.Person[enemyid]["中毒点数"] or 0) + AddPersonAttrib(eid,"中毒程度",-math.modf(JY.Person[eid]["中毒程度"]*modifier))
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-math.modf(JY.Person[eid]["受伤程度"]*modifier))
		AddPersonAttrib(eid,"冰封程度",-math.modf(JY.Person[eid]["冰封程度"]*modifier))
		AddPersonAttrib(eid,"灼烧程度",-math.modf(JY.Person[eid]["灼烧程度"]*modifier))
		WAR.Person[enemyid].Time = 1005
		WAR.FUHUOZT[eid]=1
		if match_ID(eid, 129) then
            WAR.LQZ[eid] = 100
            --畅想主角的七闪数量随天书增加，NPC固定为7
            if eid == 0 then
                WAR.BDQS = math.modf(JY.Base["天书数量"]/2)
            else
                WAR.BDQS = 7
            end
            WAR.Person[enemyid]["特效动画"] = 115
            WAR.Person[enemyid]["特效文字3"] = "重阳再现 论剑形态"    
        end
		if NGQHB(eid,180) and WAR.PD['鲸龟沉眠'][eid] == nil then
			WAR.PD['鲸龟沉眠'][eid] = 1
			Cat('清除所有异常',enemyid)
			WAR.LQZ[eid] = (WAR.LQZ[eid] or 0) + 100
		end
	end
	if WAR.PD['轮回末'][eid] ~= nil then
		WAR.PD['轮回末'][eid] = nil 
		if JY.Person[eid]['生命'] > 1 then
			JY.Person[eid]['生命'] = 1
		end
	end	
end


function savetf(i)
  if WAR.Person[i]['死亡'] == false then 
      local id = WAR.Person[i]['人物编号']
      if JY.Base['畅想'] > 0 and id == 0 then
          id = JY.Base['畅想']
      end
      if CC.PTF[id] ~= nil then 
          for j,v in pairs(CC.PTF[id]) do 
              if v == 1 then
                  if WAR.Person[i]['我方'] then 
                      if WAR.TF[j] == nil then 
                          WAR.TF[j] = {}
                      end
                      WAR.TF[j][#WAR.TF[j]+1] = i
                  else 
                      if WAR.TF1[j] == nil then 
                          WAR.TF1[j] = {}
                      end
                      WAR.TF1[j][#WAR.TF1[j]+1] = i
                  end
              end
          end
      end
  end
end

function hastf(i,tf,lx)
	if lx == 1 then
        if WAR.Person[i]['我方'] then 
            if WAR.TF[tf] ~= nil then 
                return WAR.TF[tf]
            end
        else 
            if WAR.TF1[tf] ~= nil then 
                return WAR.TF1[tf]
            end    
        end
    end
    if lx == 2 then
        if WAR.Person[i]['我方'] then 
            if WAR.TF1[tf] ~= nil then 
                return WAR.TF1[tf]
            end
        else 
            if WAR.TF[tf] ~= nil then 
                return WAR.TF[tf]
            end    
        end
    end
    return nil
end

--记录武功存在
function savewg(i)
	local id = WAR.Person[i]['人物编号']
	WAR.WG[id] = {}
	for j = 1,JY.Base['武功数量'] do 
		local kf = JY.Person[id]['武功'..j]
		local lv = JY.Person[id]['武功等级'..j]
		if kf > 0 then
            WAR.WG[id][kf] = lv
		end
	end
	if inteam(id) == false or JXPD(id,id,1) or (id == 0 and JXPD(id,JY.Base['畅想'],1)) then
		if match_ID(id,46) or  (match_ID(id,50) or match_ID(id,69)) or match_ID(id,605) or match_ID(id,5) or match_ID(id,777)
			or match_ID(id,577) or match_ID(id,62) or match_ID(id,97) or match_ID(id,116) or  match_ID(id,117) or  match_ID(id,517) 
			or match_ID(id,118) or match_ID(id,60) or match_ID(id,57) or (match_ID(id,501) or match_ID(id,596)) or match_ID(id,456) 
			or match_ID(id,26) or match_ID(id,27) or match_ID(id,641) or match_ID(id,499) or match_ID(id,65) or match_ID(id,129) 
			or match_ID(id,64) or match_ID(id,626) or (match_ID(id,586) or match_ID(id,604)) or match_ID(id,568) or match_ID(id,748)  
			then
			for j = 0, JY.WugongNum	- 1 do
				if Curr_NG(id,j) and WAR.WG[id][j] == nil then
					WAR.WG[id][j] = 999
				end
			end
		end
	end							
	--如果武功等级不等于nil则存在武功
end

--圣火阵法
function ShengHuoZhenFa(i,x0,y0,flag)
    local id = WAR.Person[i]['人物编号']
    local x,y = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
    if WAR.PD['圣火阵法'][id] == nil then
        WAR.PD['圣火阵法'][id] = {}
        for j = 1,24 do
            WAR.PD['圣火阵法'][id][j] = {x,y,nil,1901,1905,1903,0}
        end 
    else 
        for j = 1,#WAR.PD['圣火阵法'][id] do
            local fd = WAR.PD['圣火阵法'][id][j]
            local dx = fd[1] - x0
            local dy = fd[2] - y0
            local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
            local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
            local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100
            ry = ry - hb
            local cl = nil 
            if WAR.Person[i]['我方'] then 
                cl = C_RED
            end
            lib.PicLoadCache(0,0,rx,ry,2,50)
            lib.PicLoadCache(3,fd[4]*2,rx,ry,18,200,cl)
            if flag == 1 then
                for k = -1,1 do 
                    for v = -1,1 do 
                        local zbx,zby = limitX(fd[1] + k,0,62),limitX(fd[2] + v,0,62)
                        local em = GetWarMap(zbx,zby,2)
                        if em >= 0 then 
                            if WAR.Person[em]['我方'] ~= WAR.Person[i]['我方'] and WAR.Person[em]['死亡'] == false then 
								local df = WAR.Person[em]['人物编号']
                                AddPersonAttrib(df,'生命',-100)
								WAR.PD["光明圣火"][df] = (WAR.PD["光明圣火"][df] or 0) + 1
                                --重合状态额外造成100点
                                if k == 0 and v == 0 then 
									JY.Person[df]['生命'] = JY.Person[df]['生命'] - 100
									WAR.PD["光明圣火"][df] = (WAR.PD["光明圣火"][df] or 0) + 1
                                end
                            end
                        end
                    end 
                end    
            end
            if fd[7] == 0 then
                --if flag == 1 then
                    local em = GetWarMap(fd[1],fd[2],2)
                    if em >= 0 and WAR.Person[em]['我方'] ~= WAR.Person[i]['我方'] and WAR.Person[em]['死亡'] == false and flag == 1 then
                    else    
                        if fd[1] - x <= -8 then
                            fd[1] = limitX(fd[1] + 1,0,62)
                        elseif fd[1] - x >= 8 then
                            fd[1] = limitX(fd[1] - 1,0,62)
                        else
                            fd[1] = limitX(fd[1] + math.random(-1,1),0,62)
                        end
                        if fd[2] - y <= -8 then
                            fd[2] = limitX(fd[2] + 1,0,62)
                        elseif fd[2] - y >= 8 then
                            fd[2] = limitX(fd[2] - 1,0,62)
                        else
                            fd[2] = limitX(fd[2] + math.random(-1,1),0,62)
                        end
                        if flag == 1 then
                        end
                    end
                --end
                fd[7] = 2
            end
            --计时
            fd[7] = fd[7] - 1
            --贴图刷新
            fd[4] = fd[4] + 1
            if fd[4] > fd[5] then
                fd[4] = fd[6]
            end
        end
    end
end

--飞云回转刀
function FeiYunHuiZhuanDao(i,x0,y0,flag)
    local id = WAR.Person[i]['人物编号']
    local x,y = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
    if WAR.PD['飞云回转刀'][id] == nil then
        WAR.PD['飞云回转刀'][id] = {}
        for j = 1,16 do
            WAR.PD['飞云回转刀'][id][j] = {x,y,nil,1426,1432,1426,0}
        end 
    else 
        for j = 1,#WAR.PD['飞云回转刀'][id] do
            local fd = WAR.PD['飞云回转刀'][id][j]
            
            local dx = fd[1] - x0
            local dy = fd[2] - y0
            local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
            local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
            local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100
            ry = ry - hb
            local cl = nil 
            if WAR.Person[i]['我方'] then 
                cl = C_RED
            end
            lib.PicLoadCache(0,0,rx,ry,2,50)
            lib.PicLoadCache(3,fd[4]*2,rx,ry,18,200,cl)
            if flag == 1 then
                for k = -1,1 do 
                    for v = -1,1 do 
                        local zbx,zby = limitX(fd[1] + k,0,62),limitX(fd[2] + v,0,62)
                        local em = GetWarMap(zbx,zby,2)
                        if em >= 0 then 
                            if WAR.Person[em]['我方'] ~= WAR.Person[i]['我方'] and WAR.Person[em]['死亡'] == false then 
                                AddPersonAttrib(WAR.Person[em]['人物编号'],'生命',-50)
								AddPersonAttrib(WAR.Person[em]['人物编号'],'流血程度',3)
                                --重合状态额外造成50点
                                if k == 0 and v == 0 then 
                                    AddPersonAttrib(WAR.Person[em]['人物编号'],'生命',-50)
									AddPersonAttrib(WAR.Person[em]['人物编号'],'流血程度',3)
                                end
                            end
                        end
                    end 
                end    
            end
            if fd[7] == 0 then
                --if flag == 1 then
                    local em = GetWarMap(fd[1],fd[2],2)
                    if em >= 0 and WAR.Person[em]['我方'] ~= WAR.Person[i]['我方'] and WAR.Person[em]['死亡'] == false and flag == 1 then
                    else    
                        if fd[1] - x <= -8 then
                            fd[1] = limitX(fd[1] + 1,0,62)
                        elseif fd[1] - x >= 8 then
                            fd[1] = limitX(fd[1] - 1,0,62)
                        else
                            fd[1] = limitX(fd[1] + math.random(-1,1),0,62)
                        end

                        if fd[2] - y <= -8 then
                            fd[2] = limitX(fd[2] + 1,0,62)
                        elseif fd[2] - y >= 8 then
                            fd[2] = limitX(fd[2] - 1,0,62)
                        else
                            fd[2] = limitX(fd[2] + math.random(-1,1),0,62)
                        end
                        if flag == 1 then

                        end
                    end
                --end
                fd[7] = 2
            end
            
            --计时
            fd[7] = fd[7] - 1
            --贴图刷新
            fd[4] = fd[4] + 1
            if fd[4] > fd[5] then
                fd[4] = fd[6]
            end

        end
    end
end

Ct['金蛇缠丝手'] = function(i)
    local id = WAR.Person[i]['人物编号']
    local menu = {}
    local menu2 = {}
    local bs = 3
    War_CalMoveStep(i,bs, 1)
    local xi,yi = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
    local nx,ny = -1,-1

    --记录所有可以移动的坐标
    for ix = limitX(xi-bs,0,xi),limitX(xi+bs,xi,62) do 
        for iy = limitX(yi-bs,0,yi), limitX(yi+bs,yi,62) do 
            if GetWarMap(ix, iy, 3) ~= 255 and GetWarMap(ix, iy, 2) < 0 and GetWarMap(ix, iy, 4) <= 0 then 
               menu[#menu+1] = {ix,iy}
            end
        end 
    end
    --随机选择一个可以移动的坐标，记录当前坐标地图层2的数值，设定当前坐标
    if #menu > 0 then 
       local a = math.random(#menu)
        nx = menu[a][1]
        ny = menu[a][2]
    else 
        return     
    end
    for j = 0,WAR.PersonNum-1 do
        if WAR.Person[j]['死亡'] == false and WAR.Person[j]['我方'] ~= WAR.Person[i]['我方'] then 
            local x,y = WAR.Person[j]['坐标X'],WAR.Person[j]['坐标Y']
            if math.abs(x-xi) + math.abs(y-yi) > 3 then
				if WAR.PD['遮影'][WAR.Person[j]['人物编号']] == nil then
                	menu2[#menu2+1] = j 
				end
            end
        end
    end
    if #menu2 > 0 then
        local p = menu2[math.random(#menu2)]
        WAR.CurID = i
        WarDrawMap(0)
		if match_ID(id,529) then
			CurIDTXDH(WAR.CurID, 107,2, "斗转・万象天引", C_RED)
		else
			CurIDTXDH(WAR.CurID, 29,2, "金蛇缠丝手", C_RED)
		end
        CleanWarMap(4, 0)
        SetWarMap(WAR.Person[p]["坐标X"], WAR.Person[p]["坐标Y"],4,1)
		if match_ID(id,529) then
			War_ShowFight(id, 0, 0, 0, WAR.Person[p]["坐标X"], WAR.Person[p]["坐标Y"], 107)
		else
			War_ShowFight(id, 0, 0, 0, WAR.Person[p]["坐标X"], WAR.Person[p]["坐标Y"], 82)
		end
        SetWarMap(WAR.Person[p]["坐标X"], WAR.Person[p]["坐标Y"],4,0)
        PlayWavE(5)
        WAR.CurID = p
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
        WarDrawMap(0)
        WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
        SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
		if match_ID(id,529) then
			CurIDTXDH(WAR.CurID, 107,1)
		else
			CurIDTXDH(WAR.CurID, 82,1)
		end
        WAR.PD["锁足状态"][WAR.Person[WAR.CurID]["人物编号"]] = 1
    end
end

Ct['剑魔再临'] = function(id,kf)
    --拥有剑魔再临天赋、使用玄铁
    if match_ID(id,9975) then
        if kf == 45 then
            return true
        end
    end
	--独孤求败必出
    if match_ID(id,592)  then
        return true
    end
	--神雕使用剑法必出
    if match_ID(id,530) and yongjian(kf) then
        return true
    end
    --杨过使用玄铁必出
    if match_ID(id,58) and CC.TX['杨过剑魔'] == 1 and kf == 45 then 
        return true
    end
    return false
end

Ct['九剑真传'] = function(id,kf)
    --拥有九剑真传天赋、令狐冲2次觉醒使用独孤九剑
    if (JXPD(id,35,2) or match_ID(id,670) or match_ID(id,9974)) and kf == 47 then 
        return true
    end
	--风清扬使用剑法必出
    if match_ID(id,140) and yongjian(kf) then
        return true
    end
	--独孤求败必出
    if match_ID(id,592) then
        return true
    end
    return false
end

Ct['防御方动画'] = function()
	--挨打特效文字显示
	local txsx = 0
	local txwz = 0
    local mz = false
    local pid = WAR.Person[WAR.CurID]['人物编号']
    local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
	--计算最大动画帧数
	for i = 0, WAR.PersonNum - 1 do
		if WAR.Person[i]["死亡"] == false then
			local theeft = WAR.Person[i]["特效动画"]
			if theeft ~= -1 then
				if txsx < CC.Effect[theeft] then 
					txsx = CC.Effect[theeft]
				end
			end
			if theeft == -1 and (WAR.Person[i]["特效文字0"] ~= nil or WAR.Person[i]["特效文字1"] ~= nil or WAR.Person[i]["特效文字2"] ~= nil or WAR.Person[i]["特效文字3"] ~= nil or WAR.Person[i]["特效文字4"] ~= nil) then	
				txwz = 1
			end
			mz = true
		end	 
	end
	local bj = {-6,6,-5,5,-4,4,-3,3}
	
	--显示特效文字
	--没有特效固定10次循环
	if txsx == 0 and (txwz == 1 or (WAR.BJ == 1 and CC.Bj == 1)) then 
		txsx = 10 
	end	


	local zt_count = 0
	for ii = 1, txsx do
		if JY.Restart == 1 then
			break
		end
		local yanshi = false
		local yanshi2 = false		--无动画时的延迟

		local _,ys = math.modf(ii/2)
		if ys == 0 then
			zt_count = zt_count + 1
		end
		
        for i = 0, WAR.PersonNum - 1 do
	        if WAR.Person[i]["死亡"] == false then
				local theeft = WAR.Person[i]["特效动画"]
				local ix,iy = WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"]  
				if theeft ~= -1 and ii < CC.Effect[theeft] then
					
					local starteft = ii
					for i = 0, WAR.Person[i]["特效动画"] - 1 do
						starteft = starteft + CC.Effect[i]
					end
					SetWarMap(ix,iy,11,(starteft+1)*2)
				else 
					SetWarMap(ix,iy,11,0)
				end  
	        end 
        end
		
		Cat('实时特效动画')
		

	    if (WAR.BJ == 1 and CC.Bj == 1) or WAR.PD["万佛朝宗"][pid] == 1 then

			if ii < 9 then
				WarDrawMap(7, 0, 0, nil, nil, 3,nil,nil,bj[ii])
			else
				WarDrawMap(7, 0, 0, nil, nil, 3)
			end
		else   
			WarDrawMap(7, 0, 0, nil, nil, 3)
		end
		Cat('实时特效动画2')
		
		for i = 0, WAR.PersonNum - 1 do
            lib.GetKey()
            local starteft = 0
			local id = WAR.Person[i]['人物编号']
			if WAR.Person[i]["死亡"] == false and JY.Person[id]['生命'] > 0 then
				local theeft = WAR.Person[i]["特效动画"]
				--郭襄的诸天化身步
				if theeft ~= -1 and ii < CC.Effect[theeft] then
					local dx = WAR.Person[i]["坐标X"] - x0
					local dy = WAR.Person[i]["坐标Y"] - y0
					local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
					local ry = CC.YScale * (dx + dy) + CC.ScreenH / 768*265
					local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)
					
					local py = 0

					ry = ry - hb
					starteft = ii
					for i = 0, WAR.Person[i]["特效动画"] - 1 do
						starteft = starteft + CC.Effect[i]
					end

					--无酒不欢：特效文字一起出，不再用依次显示的方式
					--if ii < TPXS[i] * TP and (TPXS[i] - 1) * TP < ii then	
						KungfuString(WAR.Person[i]["特效文字3"], rx, ry, C_WHITE, CC.FontSmall5, CC.FontName, 1)
						KungfuString(WAR.Person[i]["特效文字2"], rx, ry, C_GOLD, CC.FontSmall5, CC.FontName, 2)
						KungfuString(WAR.Person[i]["特效文字1"], rx, ry, C_RED, CC.FontSmall5, CC.FontName, 3)
						KungfuString(WAR.Person[i]["特效文字0"], rx, ry, C_ORANGE, CC.FontSmall5, CC.FontName, 4)
						yanshi = true
					--end
				else
					--蓝烟清： 修正无动画时不显示文字的BUG
					if theeft == -1 and (WAR.Person[i]["特效文字0"] ~= nil or WAR.Person[i]["特效文字1"] ~= nil or WAR.Person[i]["特效文字2"] ~= nil or WAR.Person[i]["特效文字3"] ~= nil or WAR.Person[i]["特效文字4"] ~= nil) then	
						local dx = WAR.Person[i]["坐标X"] - x0
						local dy = WAR.Person[i]["坐标Y"] - y0
						local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
						local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
						local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)

						ry = ry - hb
						
						KungfuString(WAR.Person[i]["特效文字3"], rx, ry, C_WHITE, CC.FontSmall5, CC.FontName, 1)
						KungfuString(WAR.Person[i]["特效文字2"], rx, ry, C_GOLD, CC.FontSmall5, CC.FontName, 2)
						KungfuString(WAR.Person[i]["特效文字1"], rx, ry, C_RED, CC.FontSmall5, CC.FontName, 3)
						KungfuString(WAR.Person[i]["特效文字0"], rx, ry, C_ORANGE, CC.FontSmall5, CC.FontName, 4)
						yanshi2 = true
					end
				end
			end
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
	end
  
	--清除特效文字
	for i = 0, WAR.PersonNum - 1 do
        local id = WAR.Person[i]["人物编号"]
		WAR.Person[i]["特效动画"] = -1
		WAR.Person[i]["特效文字0"] = nil
		WAR.Person[i]["特效文字1"] = nil
		WAR.Person[i]["特效文字2"] = nil
		WAR.Person[i]["特效文字3"] = nil
		WAR.Person[i]["特效文字4"] = nil
		WAR.Person[i]["闪避"] = false;
        WAR.Miss[id] = nil
		WAR.TXWZ['特效文字0'][i] = nil;
		WAR.TXWZ['特效文字1'][i] = nil;
		WAR.TXWZ['特效文字2'][i] = nil;
		WAR.TXWZ['特效文字3'][i] = nil;
		WAR.TXWZ['特效文字4'][i] = nil;
	end
	lib.SetClip(0, 0, 0, 0)
	Cat('实时特效动画')
    WarDrawMap(0)
    Cat('实时特效动画2')
	ShowScreen()
	lib.Delay(CC.BattleDelay)
	CleanWarMap(11,0)
end

Ct['数值显示'] = function()
    --计算攻击到的人
    local HitXY = {}
    local HitXYNum = 0
    local hnum = 15;		--HitXY的长度个数
    local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
    for i = 0, WAR.PersonNum - 1 do
        local x1 = WAR.Person[i]["坐标X"]
        local y1 = WAR.Person[i]["坐标Y"]
        local id = WAR.Person[i]['人物编号']

	    --被特效击中的也显示
        if WAR.Person[i]["死亡"] == false and WAR.TXXS[WAR.Person[i]["人物编号"]] == 1 then
            local dx = 0
            if GetWarMap(x1, y1, 4) > 1 then
                dx = 1
            end
            SetWarMap(x1, y1, 4, 1)
            --local n = WAR.Person[i]["点数"]
            local hp = WAR.Person[i]["生命点数"];
            local mp = WAR.Person[i]["内力点数"];
            local tl = WAR.Person[i]["体力点数"];
            local ed = WAR.Person[i]["中毒点数"];
            local dd = WAR.Person[i]["解毒点数"];
            local ns = WAR.Person[i]["内伤点数"];
            --造成任何状态或者伤害就会醒来
			if WAR.PD["沉睡状态"][WAR.Person[i]["人物编号"]] == 2 then
				WAR.PD["沉睡状态"][WAR.Person[i]["人物编号"]] = nil
			end
        
            HitXY[HitXYNum] = {x1, y1, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil, nil};		--x, y, 生命, 内力, 体力, 封穴, 流血, 中毒, 解毒, 内伤，冰封，灼烧
        
            if hp ~= nil and (dx == 1 or hp ~= 0)  then
            
                if hp == 0 then			--显示受到的生命
                    --if WAR.Miss[WAR.Person[i]["人物编号"]] ~= nil  then
					local eid = WAR.Person[i]["人物编号"]
					if JY.Person[eid]["生命"] > 0 then 
						if WAR.BTZT[eid] ~= nil then
							HitXY[HitXYNum][3] = "霸体"
						elseif WAR.PD['魔之甲'][eid] ~= nil then
							HitXY[HitXYNum][3] = "魔甲护体"
						elseif WAR.Miss[eid] ~= nil then
							HitXY[HitXYNum][3] = "MISS"	
						else
							local cfwz = {"就这？","用点力","没吃饭吗？"}
							HitXY[HitXYNum][3] = cfwz[math.random(3)]
						end	
					else
						HitXY[HitXYNum][3] = "已战死"
					end	
                    --end
                elseif hp > 0 then
					HitXY[HitXYNum][3] = "+"..hp;
                else
                    HitXY[HitXYNum][3] = hp;
                end
            end

        
            if mp ~= nil then			--显示内力变化
                if mp > 0 then
                    HitXY[HitXYNum][5] = "内力+"..mp;
                elseif mp ==  0 then
                    HitXY[HitXYNum][5] = nil;			--变化为0时不显示
                else
                    HitXY[HitXYNum][5] = "内力"..mp;
                end
            end
        
            if tl ~= nil then			--显示体力变化
                if tl > 0 then
                    HitXY[HitXYNum][6] = "体力+"..tl;
                elseif tl == 0 then
                    HitXY[HitXYNum][6] = nil;
                else
                    HitXY[HitXYNum][6] = "体力"..tl;
                end
            end
        
            if WAR.FXXS[WAR.Person[i]["人物编号"]] ~= nil and WAR.FXXS[WAR.Person[i]["人物编号"]] == 1 then			--显示是否封穴
                --if WAR.FXDS[WAR.Person[i]["人物编号"]] ~= nil and WAR.FXDS[WAR.Person[i]["人物编号"]] > 0 then
				if JY.Person[WAR.Person[i]["人物编号"]]["封穴程度"] > 0 then
					HitXY[HitXYNum][7] = "封穴 "..JY.Person[WAR.Person[i]["人物编号"]]["封穴程度"]
                end
                WAR.FXXS[WAR.Person[i]["人物编号"]] = 0
            end
            
            if WAR.LXXS[WAR.Person[i]["人物编号"]] ~=nil and WAR.LXXS[WAR.Person[i]["人物编号"]] == 1 then		--显示是否被流血
                if JY.Person[WAR.Person[i]["人物编号"]]["流血程度"] > 0 then
                    HitXY[HitXYNum][8] = "流血 "..JY.Person[WAR.Person[i]["人物编号"]]["流血程度"];
                end
                WAR.LXXS[WAR.Person[i]["人物编号"]] = 0
            end
                
            if ed ~= nil then				--显示中毒
                if ed == 0 then
                    HitXY[HitXYNum][9] = nil;
                else
                    HitXY[HitXYNum][9] = "中毒↑"..ed;
                end
            end
            
            if dd ~= nil then			--显示解毒
                if dd  == 0 then
                    HitXY[HitXYNum][4] = nil;
                else
                    HitXY[HitXYNum][4] = "中毒↓"..dd;
                end
            end
            
            if ns ~= nil then		--显示内伤
                if ns == 0 then
                    HitXY[HitXYNum][10] = nil;
                elseif ns > 0 then
                    HitXY[HitXYNum][10] = "内伤↑"..ns;
                else
                    HitXY[HitXYNum][10] = "内伤↓"..ns;
                end
            end
        
            if WAR.BFXS[WAR.Person[i]["人物编号"]] == 1 then		--显示是否被冰封
                if JY.Person[WAR.Person[i]["人物编号"]]["冰封程度"] > 0 then
                    HitXY[HitXYNum][11] = "冰封 "..JY.Person[WAR.Person[i]["人物编号"]]["冰封程度"];
                end
                WAR.BFXS[WAR.Person[i]["人物编号"]] = 0
            end
            
            if WAR.ZSXS[WAR.Person[i]["人物编号"]] == 1 then		--显示是否被灼烧
                if JY.Person[WAR.Person[i]["人物编号"]]["灼烧程度"] > 0 then
                    HitXY[HitXYNum][12] = "灼烧 "..JY.Person[WAR.Person[i]["人物编号"]]["灼烧程度"];
                end
                WAR.ZSXS[WAR.Person[i]["人物编号"]] = 0
            end
            --集气
			local n =math.modf(WAR.Person[i].TimeAdd)
			if n ~= 0 then
				if n > 0 then
					HitXY[HitXYNum][13] = "集气 +"..n;
				else
					HitXY[HitXYNum][13] = "集气 "..n;
				end
			end
            HitXYNum = HitXYNum + 1
        end
    
		--偷东西，斗转不可偷
		if WAR.TD > -1 then
			if WAR.TD == 118 then
				say("１想要从我慕容复手中偷东西？哼哼，下辈子吧！", 51,0)
			else
				instruct_2(WAR.TD, WAR.TDnum)
				Cls()
				if match_ID(WAR.Person[i]["人物编号"],69) and Curr_QG(WAR.Person[i]["人物编号"],2)then
					if JY.Thing[WAR.TD]["类型"] == 3 then
						UseThingEffect(WAR.TD,WAR.Person[i]["人物编号"],1)
					end
				end	
			end
			WAR.TD = -1
		end
    end
    
	--无酒不欢：挨打时的掉血和状态显示
	if HitXYNum > 0 then
		local clips = {}
		for i = 0, HitXYNum - 1 do
			local dx = HitXY[i][1] - x0
			local dy = HitXY[i][2] - y0
			local hb = GetS(JY.SubScene, HitXY[i][1], HitXY[i][2], 4)		--海拔
		  
			local ll = 4;
			for y=3, hnum do
				if HitXY[i][y] ~= nil then
					ll = string.len(HitXY[i][y]);
					break;
				end
			end
			local w = ll * CC.DefaultFont / 2 + 1
			clips[i] = {x1 = CC.XScale * (dx - dy) + CC.ScreenW / 2, y1 = CC.YScale * (dx + dy) + CC.ScreenH / 2 - hb, x2 = CC.XScale * (dx - dy) + CC.ScreenW / 2 + w, y2 = CC.YScale * (dx + dy) + CC.ScreenH / 2 + CC.DefaultFont + 1}
		end
		
		local clip = clips[0]
		for i = 1, HitXYNum - 1 do
			clip = MergeRect(clip, clips[i])
		end
		
		local area = (clip.x2 - clip.x1) * (clip.y2 - clip.y1)		--绘画的范围
		
		Cat('实时特效动画')
	    local xs = false
		--显示点数
		--无酒不欢：一次显示两种状态
		for y = 3, hnum-2, 2 do
			if JY.Restart == 1 then
				break
			end
			local flag = false;
			for i = 5, 15 do
				local tstart = lib.GetTime()
				local y_off = i * 2 + CC.DefaultFont + CC.RowPixel
				local pd = 0
                --WarDrawMap(0)
				for j = 0, HitXYNum - 1 do
					if HitXY[j][y] ~= nil or HitXY[j][y+1] ~= nil then	
                        if pd == 0 then
                            WarDrawMap(0)
                            pd = 1
                        end
						local c = y - 1;
						--无酒不欢：这里用字符串的首位判定是否为掉血
						if y == 3 and HitXY[j][y] ~= nil and string.sub(HitXY[j][y],1,1) == "-" then
							if CONFIG.HPDisplay == 1 then
								HP_Display_When_Hit(i) --无酒不欢：实时显血
							end
							DrawString(clips[j].x1 - string.len(HitXY[j][y])*CC.DefaultFont/4, clips[j].y1 - y_off, HitXY[j][y], Color_Hurt1, CC.DefaultFont)
						else
							--无酒不欢：双排显示暂时这样写了
							local spacing = 0
							if HitXY[j][y] ~= nil then
								DrawString(clips[j].x1 - string.len(HitXY[j][y])*CC.DefaultFont/4, clips[j].y1 - y_off, HitXY[j][y], WAR.L_EffectColor[c], CC.DefaultFont)
								spacing = CC.DefaultFont
							end
							if HitXY[j][y+1] ~= nil then
								DrawString(clips[j].x1 - string.len(HitXY[j][y+1])*CC.DefaultFont/4, clips[j].y1 + spacing - y_off, HitXY[j][y+1], WAR.L_EffectColor[c+1], CC.DefaultFont)
							end
						end
							
						flag = true;
					end
				end

				if flag then
                    Cat('实时特效动画')
                    Cat('实时特效动画2')
				    ShowScreen()
					lib.Delay(CC.BattleDelay)
				end
			end
		end
	end
	--清除点数
	--夜雨楼如影随形特效修改
	for id = 0, WAR.PersonNum - 1 do
		WAR.Person[id]["生命点数"] = nil;
		WAR.Person[id]["内力点数"] = nil;
		WAR.Person[id]["体力点数"] = nil;
		WAR.Person[id]["中毒点数"] = nil;
		WAR.Person[id]["解毒点数"] = nil;
		WAR.Person[id]["内伤点数"] = nil;
		WAR.Person[id]["Life_Before_Hit"] = 0;
		--WAR.Person[id]['Realhurt'] = nil
		local mid = WAR.Person[id]["人物编号"]
		WAR.Miss[mid] = nil
		WAR.BFXS[mid] = nil
		WAR.ZSXS[mid] = nil
		WAR.LXXS[mid] = nil
		WAR.FXXS[mid] = nil
	end
	--动画后恢复血条
	WAR.ShowHP = 1
end

--攻击方伤害计算
Ct['三围五系伤害计算'] = function(enemyid,wugong, level, ang, x, y)
    local pid = WAR.Person[WAR.CurID]["人物编号"]
    local eid = WAR.Person[enemyid]["人物编号"]
    --李沅芷
    local LYZ = 0
    --赵敏在场

    local swhurt = nil
    local wxhurt = nil
    --无酒不欢：这里引入伤害二，计算保底伤害
    
    local w = {g = 0,f = 0, q = 0, n = 0, wc = 0, xs = 0 ,wl = 0}

    local d = {g = 0,f = 0, q = 0, n = 0, wc = 0, xs = 0,wl = 0}

    local wnc = 0

   	local wsc = 0

    local dnc = 0

    local dsc = 0
    
    local wxs = 0 
    
    local dxs = 0
    --获取武功的真实威力
    local true_WL = get_skill_power(pid, wugong, level)
    --无酒不欢：系数减伤
    local defadd = 0
    local NPCgxf = 1;
    local NPCfxf = 1;
    local defadd_max = 0
    --无酒不欢：最终伤害计算，难度系数
    local difficulty_factor = 1;
    --我方攻击时
	w = {g = Atk(WAR.CurID),f = Def(WAR.CurID), q = Qg(WAR.CurID),wl = true_WL}
	if w.wl ~= nil and w.wl > 0 then
		local chwl = {200,150,120,80,50,20,10,0}
		w.wl = math.modf(w.wl/2+chwl[(JY.Person[pid]['畅想分阶']+1)])
		--if w.wl >= 500 then	
		--else
		--end
	else
		return 0,0,ang
	end
	local chtd = false
	--残火太刀--
	if WAR.PD['残火太刀'][pid] ~= nil and WAR.CHTD > 0 then
		chtd = true
	end	
	--------------------------武常计算---------------------------------------
    local wwc = JY.Person[pid]['武学常识'] or 1
    local dwc = JY.Person[eid]['武学常识'] or 1
	--大周天功 大宗师 
	if WAR.DZTG_DZS == 1 or match_ID(pid,574) or match_ID(pid,9786) then
		dwc = dwc/3*2
	end
	--除却四相
	if WAR.CQSX_WZSX ==1 then
		dwc = dwc/2
	end
	--一刀流
	if MPTX(pid,11) then
		dwc = 1
	end	
	--独孤求败限定武学常识最高
	if match_ID(pid,592) then
		if wwc < dwc then
			wwc = dwc + 1
		end
	elseif match_ID(eid,592) then
		if dwc < wwc then
			dwc = wwc + 1
		end
	end
  	local wcbs = limitX(wwc*(1/dwc),0.25,4)
	--[[ local mywuxue = 0
    local emenywuxue = 0
    for i = 0, WAR.PersonNum - 1 do
        local id = WAR.Person[i]["人物编号"]
        --武学常识共用
        if WAR.Person[i]["死亡"] == false and JY.Person[id]["武学常识"] > 10 then
            if WAR.Person[WAR.CurID]["我方"] == WAR.Person[i]["我方"] and mywuxue < JY.Person[id]["武学常识"] then
                mywuxue = JY.Person[id]["武学常识"]
            end
            if WAR.Person[enemyid]["我方"] == WAR.Person[i]["我方"] and emenywuxue < JY.Person[id]["武学常识"] then
                emenywuxue = JY.Person[id]["武学常识"]
            end
        end
        if emenywuxue < 10 then
            emenywuxue = 10
        end
    end

    wwc = mywuxue - emenywuxue
    dwc = -wwc

    --攻方武常差 1041
    if wwc < 0 then 	
        wwc = 1
    else 
        local wwc_max = 0
        wwc_max = math.modf(wwc)/100
        if wwc_max > 4 then
            wwc_max = 4
        end
        wwc = wwc_max + 1
    end

    --守方武常 1041
    if dwc < 0 then 		
        dwc = 1
    else 
        local dwc_max = 0
        dwc_max =  math.modf(dwc) / 100
        if dwc_max > 3 then
            dwc_max = 3
        end
        dwc = dwc_max + 1
    end]]

	
	--无酒不欢：攻方基础攻击
    local atk = Atk(WAR.CurID)--JY.Person[pid]["攻击力"]
    --无酒不欢：守方基础防御
    local def = Def(enemyid)--JY.Person[eid]["防御力"]
	local atkxs = 0
	local defxs = 0
	local atkzj = 0
	local defzj = 0
	local defjs1 = {}
	--奇穴---------------------
	if yongte(wugong) and QIQX(pid,'天地反') > 0 then
		local a = QIQX(pid,'天地反') * 5
		if JLSD(0,a,pid) then
			def = math.modf(Atk(enemyid)*(a+10)*0.01)
		end
	end
	if QIQX(eid,'天地反') > 0 then
		local a = QIQX(eid,'天地反') * 5
		if JLSD(0,a,eid) then
			atk = math.modf(Def(WAR.CurID)*(a+10)*0.01)
		end
	end
	----------------------门派攻击力加成-------------------------------------
	--少林一级弟子
	if MPTX(pid,5) and PersonKF(pid,208) then
		if wugong == 57 then
			atkzj = atkzj + math.modf(psx(pid,'品德')*5)
		end
		if wugong == 350 then
			atkzj = atkzj + math.modf((120-psx(eid,'品德'))*5)
		end
	end			
	--少林3级弟子罗汉降魔
	if MPTX(pid,5,3) and WAR.XMPM > 0 then
		atkzj = atkzj + WAR.XMPM
	end
	--血淬
	if MPTX(pid,6,2) and Curr_NG(pid,163) and WAR.PD['血淬'][pid] ~= nil and WAR.PD['血淬'][pid] > 0 then
		atkzj = atkzj + WAR.PD['血淬'][pid]
	end
	--逍遥派基础攻击
	if MPTX(pid,7) then
		atkzj = atkzj + 3000 + Xishu_sum(pid)
	end
	--白驼山基础攻击
	if MPTX(pid,8) then
		atkzj = atkzj + JY.Person[pid]["中毒程度"]*6
	end 
	if MPTX(pid,8,3) and Curr_NG(pid,104) then
		local zd = JY.Person[pid]["中毒程度"]
		local ns = JY.Person[pid]["受伤程度"]
		local zs = JY.Person[pid]["灼烧程度"]
		local bf = JY.Person[pid]["冰封程度"]
		local lx = JY.Person[pid]["流血程度"]
		local fx = JY.Person[pid]["封穴程度"]
		local sh = zd + ns + zs + bf + lx + fx
		atkzj = atkzj + sh
	end
	--一刀流
	if MPTX(pid,11) then
		atkzj = atkzj + TrueYJ(pid)/2
		if match_ID(pid,741) or match_ID(pid,742) then --噩梦
			atkzj = atkzj + TrueYJ(pid)/2
		end 
	end
	--朝廷攻防轻
	if MPTX(pid,23) then
		local sz = JY.Person[pid]["实战"]
		atkzj = atkzj + sz
	end
	--兽王庄
	if MPTX(pid,27) and (yongquan(wugong) or yongdao(wugong)) then
		atkzj = atkzj + 1000
	end 	
	--天机宫基础攻击
	if MPTX(pid,30) then
		atkzj = atkzj + 1500
	end 	
	--阿青
	if match_ID(pid, 604) or match_ID(pid, 9805) then
		atkzj = atkzj + TrueYJ(pid)
	end
	--圣火阴风
	if WAR.HSYFD == 1 and PersonKF(pid,174) and PersonKF(pid,93) then
		atkzj = atkzj + TrueSD(pid)
	end
	
	--南凤朱雀枪
	if WAR.NFZQ == 2 then
		atkzj = atkzj + Xishu_sum(pid)
		atkzj = atkzj + (JY.Person[pid]["攻击力"]) * 2
		atkxs = atkxs + 1	
	end
	--太玄青莲
	if WAR.TXQL == 1 then 
		atkzj = atkzj + TrueYJ(pid)
		atkzj = atkzj + (JY.Person[pid]["攻击力"]) * 1.5
		atkxs = atkxs + 0.5
	end
	--门派对攻击的加成
	if MPPD(pid) > 0  then 
		local mptype = MPPD(pid)
		atkxs = atkxs + CC.MPAttrib[mptype][1] - 1
	end
	if WAR.PD["金刚萨"][pid] ~= nil and wugong == 189 then
		atkxs = atkxs + 1
	end
	--擒龙降龙
	if WAR.QLXL == 2 then
		atkxs = atkxs + 1
	end
	if WAR.PD['野球拳'][pid] == 1 then 
		atkxs = atkxs + 0.4
	end
	--先天神照
	if WAR.PD['先天真气1'][pid] == 1 then
		atkxs = atkxs + 0.5
	end
	--九阴摧坚神爪
	if WAR.CJSZ == 1 then
		atkxs = atkxs + 0.4
	end
	--神兵
	if WAR.PD['神兵'][pid] ~= nil then
		atkxs = atkxs + 0.5
	end
	--初生牛犊
	if match_ID(pid, 9743) then
		atkxs = atkxs + 0.15
	end
	--唯识心剑 	
	if (PersonKF(pid,370) and PersonKF(pid,369)) or (PersonKF(pid,370) and match_ID(pid,747)) then
		atkxs = atkxs + 2
	end 	
	if WAR.PD['凝冰成铠'][pid] ~= nil then
		local h = (WAR.PD['凝冰成铠'][pid] or 0)/100
		atkxs = atkxs + h
	end 
	--氤氤氲氲
	if PersonKF(pid,78) and Curr_QG(pid,148) and PersonKF(pid,148) and WAR.PD["氤氤氲氲"][pid] ~= nil then
		local a = (WAR.PD['氤氤氲氲'][pid] or 0)/100
		atkxs = atkxs + a
	end
	--战意对攻击的加成
	if QGQH(pid,280,1) then
		atkxs = atkxs + 0.6 + ((WAR.SPIRIT[pid] or 0)/150) - 1
	else
		atkxs = atkxs + 0.5 + ((WAR.SPIRIT[pid] or 0)/200) - 1
	end
	-----------------------------------------------------------------
	-------------------------攻击力额外加成--------------------------
	-----------------------------------------------------------------
	local qgjc = Qg(WAR.CurID) - Qg(enemyid)
	if qgjc < -1000 then
		qgjc = -1000
	end
	if qgjc > 1000 then
		qgjc = 1000
	end
	atkxs = atkxs + qgjc/5000
	--残火太刀
	if chtd == true then
		atkxs = atkxs + 1
	end
	if atkxs > 3 then
		atkxs = 3
	end
	atk = math.modf(atk*atkxs)
	atk = atk + atkzj
	if atk < 1 then atk = 1 end
	-----------------------------------------------------------------
	-------------------------------防御力-----------------------------
	-----------------------------------------------------------------
	---------增益---------------
	--逍遥派基础防御
	if MPTX(eid,7) then
		defzj = defzj + 3000 + Xishu_sum(eid)
	end
	--花涧派基础防御
	if MPTX(eid,21) then
		defzj = defzj + 3000 + Sanwei_sum(eid)
	end
	--兽王庄
	if MPTX(eid,27) then 
		defzj = defzj + 1000
	end 	
	--天机宫基础防御
	if MPTX(eid,30) then 
		defzj = defzj + 1500
	end
	--金刚护盾
	if WAR.PD['金刚护盾'][eid] ~= nil and WAR.PD['金刚护盾'][eid] > 0 then
		defzj = defzj + math.modf((WAR.PD['金刚护盾'][eid] or 0)/2)
	end
	--血淬
	if MPTX(eid,6,2) and Curr_NG(eid,163) and WAR.PD['血淬'][eid] ~= nil and WAR.PD['血淬'][eid] > 0 then
		defzj = defzj + WAR.PD['血淬'][eid]
	end
	--铁掌组合
	if wugong == 13 and WAR.PD['炼铁劲'][pid] ~= nil and DWPD(WAR.CurID,enemyid) then
		local aa = 1- (math.random(3)/10)
		local fy = 0
		local n = 2
		if MPTX(eid,2) then
			n= 4
		end
		if JY.Person[eid]["武器"] >= 0 then
			fy = fy + JY.Thing[JY.Person[eid]["武器"]]["加防御力"]*10+JY.Thing[JY.Person[eid]["武器"]]["加防御力"]*(JY.Thing[JY.Person[eid]["武器"]]["装备等级"]-1)*n
		end
		if JY.Person[eid]["防具"] >= 0 then
			fy = fy + JY.Thing[JY.Person[eid]["防具"]]["加防御力"]*10+JY.Thing[JY.Person[eid]["防具"]]["加防御力"]*(JY.Thing[JY.Person[eid]["防具"]]["装备等级"]-1)*n
		end
		if JY.Person[eid]["坐骑"] >= 0 then
			fy = fy + JY.Thing[JY.Person[eid]["坐骑"]]["加防御力"]*10+JY.Thing[JY.Person[eid]["坐骑"]]["加防御力"]*(JY.Thing[JY.Person[eid]["坐骑"]]["装备等级"]-1)*n
		end		
		defzj = defzj - fy
		if WAR.PD['炼铁劲'][pid] >= 2000 and BNJQ(pid) then
			defzj = defzj - TrueQZ(pid)
			defjs1[#defjs1+1] = 0.7
			WAR.PD['炼铁劲'][pid] = nil 
		end
	end
	--长生诀
	if WAR.PD['长生蓄力'][pid] ~= nil and WAR.PD['长生蓄力'][pid] > 1000 then
		local aa = WAR.PD['长生蓄力'][pid] - 500
		defzj = defzj - aa
	end
	--奇穴---------------
	if yongte(wugong) and QIQX(pid,'凶亡破') > 0 and WAR.SXTJ <= 200 then
		local a = QIQX(pid,'凶亡破')
		local b = {500,700,1000}
		if JLSD(0,(a*10)+10,pid) then
			defzj = defzj - (b[a]-WAR.SXTJ)
		end
	end
	if WAR.PD["八门金锁2"][eid] ~= nil then
		if defzj < 8888 then
			defzj = 8888
		end
	end

	--战意对防御的加成
	if QGQH(eid,280,1) then
		defxs = defxs + 0.6 + (WAR.SPIRIT[eid] or 0)/100 - 1
	else
		defxs = defxs + 0.5 + (WAR.SPIRIT[eid] or 0)/150 - 1
	end		
	--门派对防御的加成
	if MPPD(eid) > 0 then 
		local mptype = MPPD(eid)
		defxs = defxs + CC.MPAttrib[mptype][2] - 1
	end
	--白驼逆运增加防御力
	if MPTX(eid,8) and Curr_NG(eid,104) then
		defxs = defxs + 0.5
	end
	--金刚铁布
	if NGQH(eid,144) then
		defxs = defxs + math.random(2,6)
	end
	--坚甲状态
	if WAR.PD['坚甲状态'][eid] ~= nil then
		defxs = defxs + 1
	end
	if WAR.PD['凝冰成铠'][eid] ~= nil then
		local h = (WAR.PD['凝冰成铠'][eid] or 0)/100
		defxs = defxs + h
	end
	--氤氤氲氲
	if PersonKF(eid,78) and Curr_QG(eid,148) and PersonKF(eid,148) and WAR.PD["氤氤氲氲"][eid]~= nil then
		local a = (WAR.PD['氤氤氲氲'][eid] or 0)/ 100
		defxs = defxs + a
	end
	
	--铁甲依然在标记修改
	if Tjyrz(eid) then   	
		defxs = defxs + 0.4
	end
	--铁布衫标记修改
	if PersonKF(eid,196) then   
		if Curr_NG(pid,196) then
			defxs = defxs + 0.2
		else
			defxs = defxs + 0.1
		end	
	end

	--小无相杂学
	if WAR.XWXZX == 6 and (WAR.LQZ[pid] or 0) > 0 then
		local a = WAR.LQZ[pid]
		if a > 100 then a = 100 end
		local b = (a*0.007)
		defjs1[#defjs1+1] = b
	end	
	--朝廷岳枪
	if WAR.CTWM4 == 1 and JLSD(11,44,pid) then 
		defjs1[#defjs1+1] = 0.9
	end
	--亮银枪
	if JY.Person[pid]["武器"] == 54 or (wugong == 200 and PersonKF(pid,199)) then
		defjs1[#defjs1+1] = 0.1
	end
	--冰火夫妻刀
	if WAR.FQDF == 1 then
		defjs1[#defjs1+1] = 0.2
	end
	--碧海落英
	if WAR.LYBF == 1 then
		defjs1[#defjs1+1] = 0.15
	end
	--尚方宝剑
	if WAR.SFBJ == 1 then
		defjs1[#defjs1+1] = 0.8
	end 	
	--奇门弹指破35%防
	if ((wugong == 18 and Curr_NG(pid,251)) or (wugong == 18 and match_ID(pid,57))) and JLSD(20,55,pid) then	
		defjs1[#defjs1+1] = 0.35
	end
	--萧玲概率破防
	if (match_ID(pid,574) or match_ID(pid,9785)) and JLSD(20,70,pid) then
		defjs1[#defjs1+1] = 0.3
	end
	--施施
	if match_ID(pid,754) then 
		defjs1[#defjs1+1] = 0.5
	end 	
	--天机宫
	if WAR.TJGJ == 1 then 
		defjs1[#defjs1+1] = 0.6
	end 	
	--初生牛犊破防30%防
	if match_ID(pid,9743) and JLSD(10,40,pid) then
		defjs1[#defjs1+1] = 0.3
	end 	
	--附魔降魔
	if WGZH(pid,86,267) then
		defjs1[#defjs1+1] = 0.5
	end 	
	--斗转 标记修改
	if WAR.DZXYLV[pid] ~= nil and WAR.DZXYLV[pid] > 10 and MuRongDZ(pid) then
		defjs1[#defjs1+1] = 0.3
	end
	--刀剑合璧概率破防
	if PersonKF(pid, 44) and PersonKF(pid, 67) and WAR.DJGZ == 1 then
		defjs1[#defjs1+1] = 0.3
	end
	if WAR.PD['降龙・亢龙有悔'][pid] == 1 then 
		defjs1[#defjs1+1] = 0.3
	end
		--九字真言 兵
	if WAR.PD["兵"][pid] ~= nil and WAR.PD["兵"][pid] == 1 then
		defjs1[#defjs1+1] = 0.3
	end
	if Curr_NG(pid, 107) then
		if WAR.PD['九阴破体'][pid] ~= nil and WAR.PD['九阴破体'][pid] == 1 then
			defjs1[#defjs1+1] = 0.3
		end	
	end
	--鲸息九阴
	if NGQH(pid,180) then 
		defjs1[#defjs1+1] = 0.4
	end
	--神照龟息
	if NGQH(pid,94) then 
		defjs1[#defjs1+1] = 0.25
	end 	
	--六脉神剑无视敌人30%防御
	if (wugong == 49 and PersonKF(pid,17)) or (match_ID(pid,53) and wugong == 49) or match_ID(pid,499) or match_ID(pid,774) then
		defjs1[#defjs1+1] = 0.3
	end
	--解风 指系无视敌人30%防御
	if match_ID(pid,458) and JY.Wugong[wugong]["武功类型"] == 2 then
		defjs1[#defjs1+1] = 0.3
	end
	--金刚般若 大金刚掌
	if WAR.PD["金刚般若"][pid] ~=nil and WAR.PD["金刚般若"][pid] == 1 then
		defjs1[#defjs1+1] = 0.3
	end
	--傲世神罡
	if match_ID(pid,9989) or match_ID(pid,50) or match_ID(pid,567) then
		defjs1[#defjs1+1] = 0.3
	end	
	--于万亭
	if match_ID(pid,571) and yongjian(wugong) then
		defjs1[#defjs1+1] = 0.3
	end	
	--六脉大招1
	if  WAR.DSP_LM1 == 1	then
		defjs1[#defjs1+1] = 0.3
	end	
	--鲸息功 陷空力
	if WAR.BHJTZ6 == 1 then
		defjs1[#defjs1+1] = 0.3
	end
	--朝廷金戈
	if MPTX(eid,23,1) then 
		defjs1[#defjs1+1] = 0.3
	end
	if WAR.YYDL1 == 7 or WAR.YYDL1 == 11 then
		defjs1[#defjs1+1] = 0.3
	end
	--陈家洛庖丁解牛
	if match_ID(pid,75) and WAR.PDJN == 1 then
		defjs1[#defjs1+1] = 0.3
	end
	--点穴大师1
	if wugong == 226 and PersonKF(pid,127) and psx(eid,"封穴程度") >= 50 then
		defjs1[#defjs1+1] = 0.3
	end
	--怒涛黯然
	if WAR.PD['黯然・行尸走肉'][pid] == 1 then
		defjs1[#defjs1+1] = 0.3
	end	
	--擒龙降龙
	if WAR.QLXL == 2 then
		defjs1[#defjs1+1] = 0.3
	end
	if ZYHBPD(pid) == 2 and (WAR.ZYHB == 2 or WAR.PD['真左右互搏'][pid] == 1) then
		defjs1[#defjs1+1] = 0.35
	end
	--天魔功无视敌方40%防御
	if Curr_NG(pid, 160) then
		defjs1[#defjs1+1] = 0.4
	elseif PersonKF(pid,160) then 
		defjs1[#defjs1+1] = 0.2
	end
	--怒涛玄铁
	if WAR.XTZJ == 1 then
		defjs1[#defjs1+1] = 0.4
	end
	--剑魔再临 天极剑渊
	if WAR.JMZL == 1 then
		defjs1[#defjs1+1] = 0.5
	end
	--先天神照无视敌人50%防御
	if WAR.PD['先天真气1'][pid] == 1 then
		defjs1[#defjs1+1] = 0.5
	end 	
	--辟邪剑法
	if WAR.PD['辟邪破甲'][pid] ~= nil then
		defjs1[#defjs1+1] = 0.5
	end
	--摧坚神爪
	if (wugong == 11 and Curr_NG(pid,107)) or match_ID(pid,637) then
		defjs1[#defjs1+1] = 0.5
	end 
	--少林3级弟子罗汉降魔
	if MPTX(pid,5,3) and WAR.XMPM >= 0 then
		defjs1[#defjs1+1] = 0.5
	end
	--一刀流2级
	if MPTX(pid,11,2) and wugong == 151 and Curr_NG(pid,152) then
		defjs1[#defjs1+1] = 0.5
	end
	if WAR.PD['挑字决'][pid] == 1 then 
		defjs1[#defjs1+1] = 0.6
	end
	--圣火阴风
	if WAR.HSYFD == 2 then
		defjs1[#defjs1+1] = 0.5
	end
	--太玄组合
	if WAR.PD["太玄组合攻击2"][pid] ~= nil or WAR.PD["太玄组合攻击5"][pid] ~= nil then
		WAR.PD['增加气攻'][pid] = (WAR.PD['增加气攻'][pid] or 0) + 500
		defjs1[#defjs1+1] = 0.5
	end
	--九阴摧坚神爪
	if WAR.CJSZ == 1 then
		defjs1[#defjs1+1] = 0.5
	end	
	if WAR.PD['霸王破甲'][eid] ~= nil then
		defjs1[#defjs1+1] = 0.5
	end 
	
	--萧秋水 无视敌方防御50% 惊天一剑
	if (JXPD(pid,652,1) or JY.Person[pid]["实战"] >=500 or isteam(pid) == false) and WAR.JTYJ[pid] ~= nil then
		defjs1[#defjs1+1] = 0.5
	end
	
	--狂风迅雷功组合
	if wugong == 341 and WAR.BLJJ == 1 then
		defjs1[#defjs1+1] = 0.5
	end
	if WAR.PD['破甲蛇毒'][eid] ~= nil then
		defjs1[#defjs1+1] = 0.5
	end
	if WAR.PD['易水四寒2'][pid] == 5 then
		defjs1[#defjs1+1] = 0.5
	end
	--白首太玄破防
	if match_ID(pid, 9927) and NGQH(pid,102) and JY.Person[pid]['资质'] > 50 then	--标记修改
		defjs1[#defjs1+1] = 0.6
	end
	--中华阁
	if MPTX(pid,22,2) then
		defjs1[#defjs1+1] = 0.6
	end	
	if WAR.PD["金刚萨"][pid] ~= nil and wugong == 189 and JLSD(0,50,pid) then
		defjs1[#defjs1+1] = 0.7
	end
	if WAR.TMYJ > 0 and NGQH(pid,160) then
		local aa = math.modf(JY.Person[eid]["品德"] - JY.Person[pid]["品德"])
		if aa > 30 or MPTX(eid,5) then
			defjs1[#defjs1+1] = (WAR.TMYJ+1)/10
		else
			defjs1[#defjs1+1] = WAR.TMYJ/10
		end	
	end
	--林殊 敌方每点灼烧值破防1%
	if match_ID(pid,508) then
		local pf = JY.Person[eid]["灼烧程度"]/100
		defjs1[#defjs1+1] = pf
	end
	--绣花针 破防
	if JY.Person[pid]["武器"] == 349 or match_ID(pid,27) or match_ID(pid,777) or (wugong == 313 and PersonKF(pid,105)) then
		local dj = 6
		if isteam(pid) == false then
			dj = 8
		end
		defjs1[#defjs1+1] = dj/15
	end
	--狱龙破
	if WAR.PD['狱龙破'][eid] ~= nil then
		defjs1[#defjs1+1] = WAR.PD['狱龙破'][eid]*3*0.01
	end	
	--排云掌 无防防御
	if match_ID(pid,584) and WAR.BJYPYZ > 0 and JLSD(20,70+WAR.BJYPYZ,pid) then
		defjs1[#defjs1+1] = WAR.BJYPYZ * 0.03
	end
	--指法主角，每个指法+10%
	if JY.Base["标准"] == 2 and pid == 0 then
		local lxyz = 0
		for i = 1, JY.Base["武功数量"] do
			if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 2 and JY.Person[0]["武功等级" .. i] == 999 then
				lxyz = lxyz + 0.1
			end
		end
		if lxyz > 0.7 then
			lxyz = 0.7
		end
		defjs1[#defjs1+1] = lxyz
	end
	--寒冰玄冥
	if WAR.XMSZ3 == 1 then
		local a = math.modf(psx(eid,"受伤程度")*0.003)
		local b = math.modf(psx(eid,"冰封程度")*0.003)
		defjs1[#defjs1+1] = a+b
	end
	--剑法无极
	if match_ID(pid,9934) and yongjian(wugong) then 
		local n = 0
		for j = 1, JY.Base["武功数量"] do
			if JY.Person[pid]['武功'..j] > 0 and JY.Person[pid]['武功等级'..j] >= 999 then 
				local kf = JY.Person[pid]['武功'..j]
				if JY.Wugong[kf]['武功类型'] == 3 then 
					n = n + 1
				end
			end
		end
		if isteam(pid) == false then 
			n = 4
		end
		defjs1[#defjs1+1] = 0.1+n*0.1
	end
	--套装效果破防
	if PDTZ(pid,JY.Person[pid]["武器"]) and wugong > 0 then	
		local n =  JY.Person[pid]["武器"]
		local jl=50	
		if JLSD(0,jl,pid) and Setmeal[n][4] == 25 then
			defjs1[#defjs1+1] = 0.3
		end
	end
	if WAR.PD['野球拳'][pid] == 1 then 
		defjs1[#defjs1+1] = 0.3
	end
	if WAR.PD['四智妙法'][pid] == 2 and WAR.BJ == 1 then
		defjs1[#defjs1+1] = 0.4
	end
	if inteam(eid) == false then	
		defxs = defxs + 0.1
	end	
	--金刚咒受伤增加20%
	if WAR.PD["金刚咒"][eid] ~= nil then
		defjs1[#defjs1+1] = 0.2
	end
	if WAR.PD['含苞'][eid] ~= nil then
		defjs1[#defjs1+1] = 0.5
	end	
	if WAR.PD['枯血泣魂'][eid] ~= nil then
		defjs1[#defjs1+1] = WAR.PD['枯血泣魂'][eid]*0.02
	end
	--奇穴---------------
	if yongdao(wugong) and DAOQX(pid,'断山岳') == 1 then
		defjs1[#defjs1+1] = 0.7
	end
	--施施
	if match_ID(eid,754) then
		if defzj < 2000 then
			defzj = 2000
		end
	end		

	--魔主
	for j = 0, WAR.PersonNum-1 do
		local mzid = WAR.Person[j]['人物编号']
		if mzid == 0 and  JXPD(mzid,11,1) and dead(j) == false then
			if DWPD(WAR.CurID,j) then
				defxs = 1 - psx(pid,'品德')*0.0083 + defxs
			else
				defjs1[#defjs1+1] = 1 - (120-psx(pid,'品德'))*0.0083
			end	
		end
	end
	def = def * defxs
	def = def + defzj
	if defjs1 ~= nil and #defjs1 > 0 then	
		local a = 0
		local d = #defjs1
		local c = limitX(d,1,7) 
		if c == 1 then
			local b = 1 - (defjs1[1] - a)
			if b < 0 then 
				b = 0 
				def = 0
			end
			def = math.modf(def*b)
		else
			for i = 1, c do
				local b = 1-(defjs1[i] - a)
				if b < 0 then 
					b = 0 
					def = 0
					break
				end
				def = math.modf(def*b)
			end
		end
		defjs1 = {}
	end	
	--------------强制改变防御力----------------
	if WAR.PD["八门金锁4"][eid] ~= nil then
		if def > 888 then
			def = 888
		end
	end
	if WAR.PD["七伤拳阳"][eid] ~= nil then
		if def > 777 then
			def = 777
		end
	end
	--噩梦
	if match_ID(pid,741) or match_ID(pid,742) then
		def = 0
	end
	--越女剑法
	if WGZH(pid,wugong,188) then
		def = 0
	end
	if WAR.PD['虚邪乱魄2'][eid] ~= nil then
		def = 0
	end
	if WAR.PD['潜影突袭'][pid] ~= nil then
		def = 0
	end	
	if chtd == true then
		def = 0
	end
	--金刚铁布
	if MPTX(eid,5,2) and NGQH(eid,144) then
		def = limitX(def,math.modf(Def(enemyid)*0.5),9999)
	end
	if def < 1 then def = 1 end
	local swlimit = 3000
	if chtd == true then
		swlimit = 6000
	end	
	local gjtz = (atk-def)/(atk+def)
	if gjtz < 0.1 then gjtz = 0.1 end
	swhurt = limitX(math.modf(w.wl*wcbs+Atk(WAR.CurID)*gjtz),0,swlimit)
	if swhurt < 0 then swhurt = 0 end--绝对避免swhurt出现负数
	if chtd == true and (atk-def) > 250 and JLSD(10,35,pid) then
		addbuff(eid,WAR.PD['举火燎原'],15,20)
		addbuff(eid,WAR.PD['无明业火'],10,20)
	end	
	--金刚铁布
	if NGQH(eid,144) then
		if DWPD(WAR.CurID,enemyid) and Atk(WAR.CurID) < def then
			WAR.PD['免疫杀气'][eid] = 1
		end	
	end
	-----------------------------------------------------------------------------------------------
	-------------------------------------系数增减伤害----------------------------------------------
	-----------------------------------------------------------------------------------------------
	local wgtype = JY.Wugong[wugong]['武功类型']
	if wgtype == 6 then
		--太玄可以手动选择系数
		if wugong == 102 and WAR.TXZS > 0 then
			WAR.NGXS = WAR.TXZS
		else
			WAR.NGXS = math.random(5)
		end
		if actor(pid,6) and JXPD(pid,0,2) then
			wxs = Xishu_sum(pid)/4
		else
			wgtype = WAR.NGXS
		end
	end
	--风清扬任何武功攻击算剑系
	if match_ID(pid, 140) or match_ID(pid, 9845) then
		wgtype = 3
	end
	--风清扬被任何武功攻击算剑系
	if match_ID(eid, 140) or match_ID(eid, 9845) then
		wgtype = 3
	end
	--独孤求败被任何武功攻击算剑系
	if match_ID(eid, 592) then
		wgtype = 3
	end
	--陆渐 被任何武功攻击算拳系
	if match_ID(eid, 497) then
		wgtype = 1
	end
	--陆渐 任何武功攻击算拳系
	if match_ID(pid, 497) then
		wgtype = 1				
	end
	--天池怪侠
	if match_ID(pid,9988) then
		wgtype = 1				
	end
	if wugong == 93 then
		wgtype = 5
	end
	if wgtype == 1 and wugong ~= 109 then
		wxs = TrueQZ(pid)
		dxs = TrueQZ(eid)
		--火焰刀追加
		if wugong == 66 then
			wxs = wxs + TrueSD(pid)
		end	 
		if dxs < TrueZF(eid) then
			dxs = TrueZF(eid)
		end
		--陆渐海之道，上善若水，敌方拳法系数按0算
		if WAR.HZD_1 == 1 then
			dxs = 0
		end
		--陆渐海之道，海纳百川，敌方拳法系数按0算
		if WAR.HZD_1 == 2 then
			wxs = 0
		end
		--拳法精通 标记修改
		if match_ID(pid,9960) then
			dxs = dxs*0.8
		end
		--神拳无敌
		if match_ID(pid,9955) then
			dxs = dxs*0.6
		end
		--双金刚
		if QFZH(pid,wugong,144) then
			local diwei = {7,6,5,4,3,2,1,1}
			wxs = math.modf(wxs*diwei[(psx(pid,'畅想分阶')+1)])+psx(pid,'武学常识')
		end	
		if QFZH(eid,22,144) then
			dxs = math.modf(dxs*((psx(eid,'畅想分阶')+1)*0.1))
		end	
		--怒涛
		if PersonKF(pid, 252) then
			dxs = dxs * 0.5
		end
	elseif wgtype == 2 or wugong == 109 then
		wxs = TrueZF(pid)
		dxs = TrueZF(eid)
		--无酒不欢：被指法攻击，取拳指较高者计算减伤
		if dxs < TrueQZ(eid) then
			dxs = TrueQZ(eid)
		end
		--六脉剑气追加
		if wugong == 49 then
			wxs = wxs + TrueYJ(pid)
		end
		--六脉剑气碧烟横，敌方指法系数按50%算
		if WAR.JQBYH == 1 then
			dxs = dxs / 2
		end
		--指法精通 标记修改
		if match_ID(pid,9959) then
			dxs = dxs*0.8
		end
		--千手神通
		if match_ID(pid,9954) then
			dxs = dxs*0.6
		end
		--双金刚
		if QFZH(pid,wugong,144) then
			local diwei = {7,6,5,4,3,2,1,1}
			wxs = math.modf(wxs*diwei[(psx(pid,'畅想分阶')+1)])+psx(pid,'武学常识')
		end	
		if QFZH(eid,135,144) then
			dxs = math.modf(dxs*((psx(eid,'畅想分阶')+1)*0.1))
		end	
		if wugong == 340 and WAR.DJTS == 3 then
			dxs = 0
		end	
	elseif wgtype == 3 then
		wxs = TrueYJ(pid)
		dxs = TrueYJ(eid)
		if WAR.PD["刀剑绝技"][pid] ~= nil then
			wxs = wxs + TrueSD(pid)
		end
		--独孤求败，敌方御剑系数按1/3计算
		if WAR.WWWJ == 1  then
			dxs = dxs / 3	
		end
		--剑法精通 标记修改
		if match_ID(pid,9956) then
			dxs = dxs*0.8
		end
		--剑术通神
		if match_ID(pid,9953) then
			dxs = dxs*0.6
		end
		--阿青天元剑气，敌方御剑系数按0算
		if WAR.TYJQ == 1  then
			dxs = 0
		end
		--仙猿神剑
		if match_ID(pid,9997) then
			dxs = dxs/2
		end
		if WAR.XMJDHS == 1	then  
			dxs = dxs/2
		end
		if WAR.JTYJ[pid] ~= nil  then
			dxs = dxs*0.7
		end
		--无酒不欢：NPC的真气效果为2倍
		--剑道化身.护体
		if match_ID(eid, 500) then
			Set_Eff_Text(enemyid, 2, "化三清",95)
			wxs = wxs / 2
		end
		--独孤求败、阿青
		if match_ID(eid, 592) or match_ID(eid, 604) or match_ID(eid, 636) then
			wxs = 0
		end
	elseif wgtype == 4 then
		wxs= TrueSD(pid)
		dxs = TrueSD(eid)
		if WAR.PD["刀剑绝技"][pid] ~= nil then
			wxs = wxs + TrueYJ(pid)
		end
		--刀法精通 标记修改
		if match_ID(pid,9957) then
			dxs = dxs*0.8
		end
		--傲世狂刀
		if match_ID(pid,9952) then
			dxs = dxs*0.6
		end
	elseif wgtype == 5 then
		wxs = TrueTS(pid)
		dxs = TrueTS(eid)
		--奇门精通 标记修改
		if match_ID(pid,9956) then
			dxs = dxs*0.8
		end
		--奇门无双
		if match_ID(pid,9951) or match_ID(pid,69) then
			dxs = dxs*0.6
		end
	end
	if NGQH(pid,247) and WAR.BJ == 1 then
		local a = math.modf(psx(pid,'品德')*(7-JY.Person[pid]['畅想分阶']))
		wxs = wxs + a
		if JLSD(10,45,pid) then
			WAR.PD['大小幽明'][eid] = 1
		end	
	end
	if WAR.PD['黯然・倒行逆施'][pid] == 1 then
		dxs=dxs*(-1)
	end
	if actor(eid,6) and JXPD(eid,0,2) then
		dxs = Xishu_sum(eid)/4
	end
	--临济十二桩组合
	if NGQH(eid,247) and WAR.BJ == 1 then
		local b = math.modf(psx(eid,'品德')*(7-JY.Person[eid]['畅想分阶']))
		dxs = dxs + b
	end
	--系数结算
	local wxc = limitX((wxs-dxs)*0.005,0.2,3)
	--天罡大招，系数不会劣势
	if wxs < dxs then-----------------攻击方系数系数不劣势---------------
		if WAR.JSTG == 1 or (Curr_NG(pid, 98) and Curr_NG(eid, 98) == false)  or (yongwu(wugong,360) and Curr_NG(pid,93)) or WAR.HZD_1 ~= 1 
		or WAR.PD['般若防御'][pid] ~= nil or match_ID(pid,114) or match_ID(pid,574) or match_ID(pid,9969) or match_ID(pid,9987) or match_ID(pid, 636) then
			wxc = math.random(2)
		    if WAR.JSTG == 1 then
				Set_Eff_Text(enemyid, "特效文字2","遇强则强")
			end
			if Curr_NG(pid, 98) and Curr_NG(eid, 98) == false then
				Set_Eff_Text(enemyid, "特效文字2","无我无相")
			end	
			if match_ID(pid, 636) then
				Set_Eff_Text(enemyid, "特效文字2","谪仙观气")
			end
		end	
	elseif dxs < wxs then
		if (Curr_NG(eid,98) and Curr_NG(pid, 98) == false) or WAR.TYJQ ~= 1 or WAR.HZD_2 ~= 1 or WAR.XMJDHS ~= 1 or WAR.WWWJ ~= 1 
			or WAR.PD['般若集中'][pid] ~= nil or match_ID(eid, 636) or match_ID(eid,114) or match_ID(eid, 498) or match_ID(eid,574) or match_ID(eid,9969) or match_ID(eid,9987) then
			wxc = math.random(6,10)*0.1
			if Curr_NG(eid,98) and Curr_NG(pid, 98) == false then
				Set_Eff_Text(enemyid, "特效文字2","无我无相") 
			end	
			if match_ID(eid, 636) then
				Set_Eff_Text(enemyid, "特效文字2","谪仙观气")
			end
			if match_ID(eid, 498) then
				Set_Eff_Text(enemyid, "特效文字2","惊才绝艳")
			end	
		end
	end	
	local xzc = math.modf((psx(pid,'实战')-psx(eid,'实战'))*0.1)
	if xzc < -10 then
		xzc = -10
	end	
	local sbpd = Qg(enemyid) - Qg(WAR.CurID)
	local zwx = (QIQX(eid,'子午行') or 0)*2
	local sbjl = limitX(math.modf(sbpd*0.025)+xzc,0,35)+zwx
	if sbpd >= 300 and JLSD(0,sbjl,eid) then
		WAR.PD['闪避'][eid] = 1
	end	
	--系数与伤害
	local zswxs = (wxs-dxs)/(wxs+dxs)
	if zswxs < 0.1 then zswxs = 0.1 end
	wxhurt = limitX(math.modf(w.wl*wxc*wcbs+wxs*zswxs),0,3000) --系数对应伤害结算	
	if wxhurt < 0 then wxhurt = 0 end --绝对避免wxhurt出现负数
	local gdpd = dxs-wxs
	local wxj = (QIQX(eid,'无瑕击') or 0)*3
	local gdjl = limitX(math.modf(gdpd*0.05)+x,0,50)+wxj
	if QFZH(eid,22,144) or QFZH(eid,135,144) then
		wxhurt = wxhurt - def
	end	
	if gdpd >= 300 and JLSD(0,gdjl,eid) then
		wxhurt = math.modf(wxhurt * 0.5)
		WAR.Person[enemyid]["特效动画"] = nil
		WAR.Person[enemyid]["特效动画"] = 196
		Set_Eff_Text(enemyid, "特效文字4", "招式格档")
	end
	swhurt = math.modf(swhurt)
	wxhurt = math.modf(wxhurt)
	if WAR.PD['风雷惊蛰3'][pid] ~= nil then
		swhurt = math.modf(swhurt*1.5) +150
		wxhurt = math.modf(wxhurt*1.5) +150
	end	
    return swhurt,wxhurt,ang
end

--防御方伤害计算
Ct['总伤害计算'] = function(enemyid, wugong,level,ang,hurt,swhurt,wxhurt,flag)
	local pid = WAR.Person[WAR.CurID]["人物编号"]
    local eid = WAR.Person[enemyid]["人物编号"]
    local true_WL = get_skill_power(pid, wugong, level)
    local hurt2 = 0
    local hurt3 = 0
    local dxs = 0
    local wxc = 0
    local wxs = 0
	local zxc = 0
    local def = Def(enemyid)
    local wgtype = JY.Wugong[wugong]["武功类型"];
    --无酒不欢：记录人物血量
    WAR.Person[enemyid]["Life_Before_Hit"] = JY.Person[eid]["生命"]
    WAR.Person[enemyid]["Neili_Before_Hit"] = JY.Person[eid]["内力"]
    --毒抗
    local kd = JY.Person[eid]["抗毒能力"] + JY.Person[eid]["内力"] / 50
    if WAR.PD['六阳正气'][eid] ~= nil then 
        kd = kd + WAR.PD['六阳正气'][eid]
    end
    --气防
    local dng = 0
    --内伤
    local nssz = 0
    --冰封
    local bfsz = 0
    --灼烧
    local zssz = 0
    --中毒
    local zdsz = 0
    --封穴
    local fxsz = 0
    --流血
    local lxsz = 0

    --内伤
    local nssz1 = 0
    --冰封
    local bfsz1 = 0
    --灼烧
    local zssz1 = 0
    --中毒
    local zdsz1 = 0
    --封穴
    local fxsz1 = 0
    --流血
    local lxsz1 = 0
    --local 
    local WGLX = JY.Wugong[wugong]["武功类型"]

   

    local wnc = 0 

    local dnc = 0
	--增加气防
	local dngzj = {}
	--增加气攻
	local angzj = {}
	--增伤
	local hurtzs = 0
	local hurtzs1 = {}
    local zshurt = 0
	--减伤
	local hurtjs = 0
	local hurtjs1 = {}
	local hurtjs2 = {}
    local jsm = 1
    --WAR.Person[enemyid]["特效动画"] = -1
    --WAR.Person[enemyid]["特效文字0"] = nil
    --WAR.Person[enemyid]["特效文字1"] = nil
    --WAR.Person[enemyid]["特效文字2"] = nil
    --WAR.Person[enemyid]["特效文字3"] = nil
    --WAR.Person[enemyid]["特效文字4"] = nil
    --无酒不欢：闪避统一结算
    if WAR.Miss[eid] == 1 then
        goto label0
    end
	if WAR.Miss[eid] == 1 then 
		hurt = 0
    end
    ------------------------------------------------------------------------------------
    -----------------------------------气防加成-----------------------------------------
    ------------------------------------------------------------------------------------
    --无酒不欢：计算内功护体，互为敌方才会触发
    --周伯通空明之武道、先天乾坤功使敌方不会护体
    if NGHTKX(pid) == false then
        local ht = {};
        local num = 0;	--当前学了多少个内功
        for i = 1, JY.Base["武功数量"] do
            local kfid = JY.Person[eid]["武功" .. i]
            local kflvl = JY.Person[eid]["武功等级" .. i]
            if kflvl == 999 then
                kflvl = 11
            else
                kflvl = math.modf(kflvl / 100) + 1
            end
            --先把内功都存入表格，吸功，金刚不坏，五岳剑诀不护体
            if yongnei(kfid) and kfid ~= 85 and kfid ~= 87 and kfid ~= 88 and kfid ~= 175 then --
                num = num + 1;
                ht[num] = {kfid,i,get_skill_power(eid, kfid, kflvl)};
            end
        end
        local dd = JY.Person[eid]['品德'] 
		if dd > 100 then dd = 100 end	
        --如果学有内功
        if num > 0 then	
            --按照威力从大到小排序，威力一样的话按照面板的先后顺序
            for i = 1, num - 1 do
                for j = i + 1, num do
                    if ht[i][3] < ht[j][3] or (ht[i][3] == ht[j][3] and ht[i][2] > ht[j][2])then
                        ht[i], ht[j] = ht[j], ht[i]
                    end
                end
            end
            --按顺序判定触发
            for i = 1, num do
                if NGQH(eid,108) and JLSD(30,dd,eid) then
					dng = get_skill_power(eid, 108, 11) 
					dngzj[#dngzj+1] = math.random(3)*0.1
					WAR.NGHT = 108
					Set_Eff_Text(enemyid, 2, "易筋真谛护体",87 + math.random(6))
					Cat('清除高级异常',enemyid)
					if WAR.SPIRIT[eid] ~= nil and WAR.SPIRIT[eid] > 120 then
						ztd(enemyid,"生命点数",math.modf(dng*0.5))
						ztd(enemyid,"内力点数",math.modf(dng*0.5))
						ztd(enemyid,"体力点数",math.modf(dng*0.03))
					end
					break;
					elseif myrandom(10, eid) then
                    if WAR.PD['夜雨绵延'][eid] ~= nil then
                    	Set_Eff_Text(enemyid,2,"夜雨绵延・经滞脉塞")
						WAR.PD['西域奇毒'][eid] = 25
						ztd(enemyid,'中毒点数',20)
						WAR.PD['夜雨绵延'][eid] = math.modf(WAR.PD['夜雨绵延'][eid]+5)
						break
                    else
	                    dng = ht[i][3];
	                    if WAR.PD['重度内伤'][eid] ~= nil then
						    dng = -math.modf(dng*2)
						end
	                    Set_Eff_Text(enemyid, 2, JY.Wugong[ht[i][1]]["名称"] .. "护体",87 + math.random(6))
	                    WAR.NGHT = ht[i][1];
	                    break;
	                end 
                end
            end
        end
        --运行天赋内功气防+100，有35%几率再+200
        if JY.Person[eid]["主运内功"] > 0 and JY.Person[eid]["主运内功"] == JY.Person[eid]["天赋内功"] then
            dng = dng + 100;
            if JLSD(30, 65, eid) then
                dng = dng + 200;
                Set_Eff_Text(enemyid, "特效文字3", "天赋内功护体")
            end
        end
		--乔峰、擒龙功
        if match_ID(eid,50) and WAR.NGHT == 0 and PersonKF(eid,204) then
            dng = dng + 1200
        end
        --九阳神功护体
        if  WAR.NGHT == 0 and PersonKF(eid, 106) then
            WAR.Person[enemyid]["特效动画"] = 87 + math.random(6)
            dng = dng + 1200
        end
        --蛤蟆功补偿护体
        if WAR.NGHT == 0 and (PersonKF(eid,95) or PersonKF(eid,180)) then
            dng = dng + 900;
            WAR.Person[enemyid]["特效动画"] = 87 + math.random(6)
			Set_Eff_Text(enemyid, "特效文字3", "护体补偿")
        end		
		--NPC内力补偿
		if WAR.NGHT == 0 then 
            if isteam(eid) == false then 
                Set_Eff_Text(enemyid, "特效文字2", "内力补偿")
                WAR.Person[enemyid]["特效动画"] =  87 + math.random(6)
			    dng = dng + math.modf(JY.Person[eid]["内力最大值"]*0.2)
            end
        end
		--如果学有五岳剑诀，且未发动真气护体，则有五岳剑法数量*5%几率触发以剑御气，敌方气攻减半
        if WAR.NGHT == 0 and ang > 0 then
			local chance = 0
			if WuyueJFSL(eid) > 0 then
				chance = WuyueJFSL(eid)*5
				if MPTX(eid,14) then
					chance = chance * 2
				end	
			end
			if MPTX(eid,14) and (Curr_NG(eid,89) or Curr_NG(eid,216) or Curr_NG(eid,259) or Curr_NG(eid,263) or Curr_NG(eid,264)) then
				chance = 100
			end	
			if (math.random(100) <= chance) or (WYJJ(eid)) then
				if WYJJ(eid) then
					angzj[#angzj+1] = -0.5
					WAR.ZQHT = 1
					WAR.Person[enemyid]["特效动画"] = 137
					Set_Eff_Text(enemyid, "特效文字1", "真・以剑御气")
				else	
					angzj[#angzj+1] = -0.3
					WAR.Person[enemyid]["特效动画"] = 137
					Set_Eff_Text(enemyid, "特效文字1", "以剑御气")
				end	
			end
        end
		--内力加成气防
        if isteam(eid) == false then
            dng = dng + (JY.Person[eid]["内力"] / 6)
	    else 
	        dng = dng + (JY.Person[eid]["内力"] / 10)
        end
    end
	--洗髓经
	if JY.Person[eid]['门派技能4'] >= 1 and JY.Person[eid]['门派技能4'] < 1000 and WAR.NGHT > 0 then
		local ll = math.modf(JY.Person[eid]['畅想分阶']*math.random(3,10))
		JY.Person[eid]['门派技能4'] = limitX(JY.Person[eid]['门派技能4'] + ll,1,1000)
	end	
    ----------------------------------------------------------------------------
	-----------------------------人物天赋气防加成---------------------------------
	-----------------------------------------------------------------------------
	--防御状态
    if WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0 then
        WAR.Person[enemyid]["特效动画"] = 90
        Set_Eff_Text(enemyid, "特效文字1", "防御状态")
        if PersonKF(eid, 101) then     --八荒气防+1200
            dng = dng + 1200
        else
            dng = dng + 600
        end
    end
	--蒙哥、岳云、上官剑南，气防+2000点
	if eid == 627 or eid == 567 or eid == 568 then
		dng = dng + 2000
	end
	--萧秋水 忘情天书护体
	if match_ID(eid, 652) then
		dng = dng + 800
		if not isteam(eid) then
			dng = dng + 1200
		end
		Set_Eff_Text(enemyid, 2, "忘情天书护体",86)
		WAR.ZQHT = 1
	end
	 --天罡每个内功+100气攻
	--浩然罡气
	if match_ID(eid,9946) then
		local hrgq = 0
		for i = 1,JY.Base["武功数量"] do
			if JY.Wugong[JY.Person[eid]["武功" .. i]]["武功类型"] == 6 then
				hrgq = hrgq + 1
			end
		end
		dng = dng + hrgq * 100
	end
	--九字真言 者
	if WAR.PD["者"][eid]~= nil and WAR.PD["者"][eid] == 1 then
		dng = dng + 800
	end
	--论剑打赢阿青的奖励，气防永久提高1000点
	if match_ID(eid,0) and JY.Person[604]["论剑奖励"] == 1 then
		dng = dng + 1000
	end
	--成昆
	if match_ID(eid, 18) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 600
			if not isteam(eid) then
				dng = dng + 600
			end
			Set_Eff_Text(enemyid, 2, "混元霹雳功护体",math.fmod(106, 10) + 85)
			WAR.ZQHT = 1
		end	
	end
	--洪七公
	if match_ID(eid, 69) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 600
			if not isteam(eid) then
				dng = dng + 600
			end
			
			WAR.Person[enemyid]["特效动画"] = 67
			Set_Eff_Text(enemyid, "特效文字2", "丐王真气")
			WAR.ZQHT = 1
		end	
	end
	--鸠摩智
	if match_ID(eid, 103) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 600
			if not isteam(eid) then
				dng = dng + 600
			end
			WAR.Person[enemyid]["特效动画"] = math.fmod(98, 10) + 85
			Set_Eff_Text(enemyid, "特效文字2", "明王真气")
			WAR.ZQHT = 1
		end
	end
	--黄药师
	if match_ID(eid, 57) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 600
			if not isteam(eid) then
				dng = dng + 600
			end
			WAR.Person[enemyid]["特效动画"] = 95
			Set_Eff_Text(enemyid, "特效文字2", "奇门奥义")
			WAR.ZQHT = 1
		end
	end
	--何太冲
	if match_ID(eid, 7) then
		dng = dng + 1200
		if not isteam(eid) then
			dng = dng + 1200
		end
		WAR.Person[enemyid]["特效动画"] = math.fmod(98, 10) + 85
		Set_Eff_Text(enemyid, "特效文字2", "太清罡气")
		WAR.ZQHT = 1
	end
	
	--谢烟客
	if match_ID(eid, 164) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 500
			if not isteam(eid) then
				dng = dng + 500
			end
			WAR.Person[enemyid]["特效动画"] = 23
			Set_Eff_Text(enemyid, "特效文字2", "摩天居士")
			WAR.ZQHT = 1
		end
	end
   
	--任我行
	if match_ID(eid, 26) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 600
			if not isteam(eid) then
				dng = dng + 600
			end
			WAR.Person[enemyid]["特效动画"] = 6
			Set_Eff_Text(enemyid, "特效文字2", "日月・同辉")
			WAR.ZQHT = 1
		end
	end
   
	--戚长发
	if match_ID(eid, 594) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 600
			if not isteam(eid) then
				dng = dng + 600
			end
			WAR.Person[enemyid]["特效动画"] = 93
			--Set_Eff_Text(enemyid, "特效文字2", "铁锁横江")
			WAR.ZQHT = 1
		end
	end
   
	--慕容博
	if match_ID(eid, 113) then
		local pd = false
		if isteam(eid) == false then 
			pd = true
		end
		
		local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(20,gl,eid) then 
			pd = true
		end
		
		if pd == true then 
			dng = dng + 600
			if not isteam(eid) then
				dng = dng + 600
			end
			WAR.Person[enemyid]["特效动画"] = 93
			Set_Eff_Text(enemyid, "特效文字2", "参合真气")
			WAR.ZQHT = 1
		end
	end
	--段延庆
    if match_ID(eid, 98) or match_ID(eid, 9876) then
        local pd = false
        if isteam(eid) == false then 
            pd = true
        end
        
        local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
        if JLSD(20,gl,eid) then 
            pd = true
        end
        
        if pd == true then 
            dng = dng + 666
            if not isteam(eid) then
                dng = dng + 666
            end
            WAR.Person[enemyid]["特效动画"] = 63
            Set_Eff_Text(enemyid, "特效文字2", "化子邋遢，观音长发")
            WAR.ZQHT = 1
        end
    end
    --阿紫曼珠沙华，每杀一个人+200气防
    if match_ID(eid, 47) or match_ID(eid, 9886) then
        dng = dng + 200 * WAR.MZSH
    end
	--老衲
    if match_ID(eid, 515) then
        dng = dng + 666
		WAR.Person[enemyid]["特效动画"] = 111
        Set_Eff_Text(enemyid, "特效文字2", "大威天龙")
    end
	--枯荣
    if match_ID(eid, 102) then
        local pd = false
        if isteam(eid) == false then 
            pd = true
        end
        local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
        if JLSD(20,gl,eid) then 
            pd = true
        end
        if pd == true then 
            dng = dng + 600
            if not isteam(eid) then
                dng = dng + 600
            end
            WAR.Person[enemyid]["特效动画"] = 93
            Set_Eff_Text(enemyid, "特效文字2", "枯荣真气")
            WAR.ZQHT = 1
        end
    end
	--朱子柳
    if match_ID(eid, 122) then
        local pd = false
        if isteam(eid) == false then 
            pd = true
        end
        
        local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
        if JLSD(20,gl,eid) then 
            pd = true
        end
        
        if pd == true then 
            dng = dng + 300
            if not isteam(eid) then
                dng = dng + 300
            end
            WAR.Person[enemyid]["特效动画"] = 83
            Set_Eff_Text(enemyid, "特效文字2", "何事秋风悲画扇")
            WAR.ZQHT = 1
        end
    end
   
    --何铁手
    if match_ID(eid, 83) then
        local pd = false
        if isteam(eid) == false then 
            pd = true
        end
        
        local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
        if JLSD(20,gl,eid) then 
            pd = true
        end
        
        if pd == true then 
            dng = dng + 500
            if not isteam(eid) then
                dng = dng + 500
            end
            WAR.Person[enemyid]["特效动画"] = 92
            Set_Eff_Text(enemyid, "特效文字2", "红袖拂风")
            WAR.ZQHT = 1
        end
    end 
    --左冷禅
    if match_ID(eid, 22) then
        local pd = false
        if isteam(eid) == false then 
            pd = true
        end
        
        local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
        if JLSD(20,gl,eid) then 
            pd = true
        end
        if pd == true then 
            dng = dng + 500
            if not isteam(eid) then
                dng = dng + 500
            end
            WAR.Person[enemyid]["特效动画"] = 1
            Set_Eff_Text(enemyid, "特效文字2", "寒冰真气")
            WAR.ZQHT = 1
        end
    end
    --殷天正
    if match_ID(eid, 12) then
        local pd = false
        if isteam(eid) == false then 
            pd = true
        end
        
        local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
        if JLSD(20,gl,eid) then 
            pd = true
        end
        if pd == true then 
            dng = dng + 500
            if not isteam(eid) then
                dng = dng + 500
            end
            WAR.Person[enemyid]["特效动画"] = 92
            Set_Eff_Text(enemyid, "特效文字2", "鹰王真气")
            WAR.ZQHT = 1
        end
    end
    --阿青
    if match_ID(eid, 604) then
        dng = dng + TrueYJ(eid) * 5
        if not isteam(eid) then
            dng = dng + TrueYJ(eid) * 9
        end
        WAR.Person[enemyid]["特效动画"] = 121
        Set_Eff_Text(enemyid, "特效文字2", "九宵仙息")
        WAR.ZQHT = 1
    end
	--梁萧气防
    if match_ID(eid, 637)  then
        dng = dng + 1200
    end
	--任飞燕
    if match_ID(eid,615) then
        dng = dng + JY.Person[eid]["轻功"] * 2
    end
    
    --圣火三使 受伤害减少、气防提高
    if WAR.ZDDH == 14 and (eid == 173 or eid == 174 or eid == 175) then
        local shz = 0
        for j = 0, WAR.PersonNum - 1 do
            if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
                shz = shz + 1
            end
        end
        if shz > 1 then
            dng = dng + 1000 * shz
        end
    end
    
    --全真七子，天罡北斗阵，受伤害减少和增加气防
    if (eid >= 123 and eid <= 128) or eid == 68 then
		local tgz = 0
        for j = 0, WAR.PersonNum - 1 do
            if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
                tgz = tgz + 1
            end
        end
        if tgz > 1 then
            dng = dng + 777 * tgz
        end
        Set_Eff_Text(enemyid, "特效文字2", "天罡北斗阵护体",93)
    end
		
	--武当七侠，真武七截阵，受伤害减少和增加气防
    if (eid >= 532 and eid <= 538)  then
		local zwz = 0
        for j = 0, WAR.PersonNum - 1 do
            if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
                zwz = zwz + 1
            end
        end
        if zwz > 1 then
            dng = dng + 150 * 2 ^ zwz
        end
        Set_Eff_Text(enemyid, "特效文字2", "真武七截阵护体",93)
    end
    --金刚伏魔圈，伤害一减少，气防提高
    if PersonKF(eid, 82) then
        local jgfmq = 0
        local effstr = "金刚伏魔圈"
        for j = 0, WAR.PersonNum - 1 do
            if PersonKF(WAR.Person[j]["人物编号"], 82) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
                jgfmq = jgfmq + 1
            end
        end
        --上限3人
        if jgfmq > 3 then
            jgfmq = 3
        end
        if jgfmq == 3 then
            effstr = "真."..effstr
        end
        if jgfmq > 1 then
            dng = dng + 2000 * (jgfmq - 1)
            Set_Eff_Text(enemyid, "特效文字3", effstr)
        end
    end
	--三渡
    if match_ID(eid,597) or match_ID(eid,598) or match_ID(eid,599)  then
		local dedjdn = 0
        local effstr = "无我相、无人相、无众生相、无寿者相"
        for j = 0, WAR.PersonNum - 1 do
                if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
                dedjdn = dedjdn + 1
            end
        end
        if dedjdn > 0 then
			Set_Eff_Text(enemyid, "特效文字1", effstr)
            dng = dng + 1000 * (dedjdn)	
        end
    end
	--江南四友
    if match_ID(eid,31) or match_ID(eid,32) or match_ID(eid,33) or match_ID(eid,34)  then
		local jnsy = 0
		local effstr = "人生于世，忧多乐少"
		for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
				jnsy = jnsy + 1
			end
		end
		if jnsy > 0 then
			dng = dng + 400 * (jnsy)
			if jnsy >1 then
				Set_Eff_Text(enemyid, "特效文字3", effstr.."X"..jnsy)
			else 
				Set_Eff_Text(enemyid, "特效文字3", effstr)
			end			
		end
	end
	--江南七怪
	if match_ID(eid,130) or match_ID(eid,131) or match_ID(eid,132) or match_ID(eid,133) or match_ID(eid,134) or match_ID(eid,135) or match_ID(eid,136) then
		local JLQX = 0
		local effstr = "要杀要剐,悉听尊便"
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
				JLQX = JLQX + 1
			end
		end
		if JLQX > 0 then
			dng = dng + 400 * (JLQX)
			if JLQX >1 then
				Set_Eff_Text(enemyid, "特效文字3", effstr.."X"..JLQX)
			else
				Set_Eff_Text(enemyid, "特效文字3", effstr)
			end
		end
	end
	--天佛降世
    if match_ID(eid,9986) and WAR.FUHUOZT[eid] ~= nil and WAR.BJ == 1 then
        dng = dng + 1200
    end
	--竹风雨滴
	if match_ID(eid,520) then
		dng = dng + math.modf(TrueYJ(pid) * 10)
	end
	--独孤求败
	if match_ID(eid,592) then
		dng = dng + math.modf(TrueYJ(pid) * 10)
	end
	--七宝琉璃无视敌方50%气防
	if WAR.QBLL == 1 then
		dngzj[#dngzj+1] = -0.5
    end	
	--扫地攻击无视敌方50%气防
	if match_ID(pid,114) then 
        dngzj[#dngzj+1] = -0.5
    end
	----------------------------------------------------------------------------
	-----------------------------轻功内功气防加成---------------------------------
	-----------------------------------------------------------------------------
	--北冥真气，无崖子必发动，学有北冥/虚竹觉醒后几率发动
    if ((PersonKF(eid, 85) or JXPD(eid, 49, 1)) and JLSD(20, 70, eid)) or match_ID(eid, 634) or match_ID(eid, 116) then
        dng = dng + 800
        Set_Eff_Text(enemyid, "特效文字2", "北冥真气",85)
        WAR.ZQHT = 1
    end
	--无酒不欢：小无相功增加气防
    if Curr_NG(eid, 98) then
        dngzj[#dngzj+1] = 0.2
    --被动
    elseif PersonKF(eid, 98) then
        dngzj[#dngzj+1] = 0.1
    end
	--纯阳无极增加男性气防
	if Curr_NG(eid, 99) and JY.Person[eid]['性别'] == 0 then
		dngzj[#dngzj+1] = 0.2
	end
	--八荒北冥
	if NGQH(eid,101) and WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0 then
		dngzj[#dngzj+1] = 1
	end
	--九阳真气
    if PersonKF(eid, 106) and rwnlxz(eid,1) then
        if  JLSD(30, 50 + JY.Base["天书数量"]*3,eid) then 
            dng = dng + 999
            if WAR.Person[enemyid]["特效动画"] == -1 then
                WAR.Person[enemyid]["特效动画"] =  87 + math.random(6)
            end
            Set_Eff_Text(enemyid, "特效文字1", "九阳真气")
            WAR.ZQHT = 1
        end
    end
	--九阳神功
    if WAR.PD['氤氲紫气'][eid] == 1 then
        dng = dng + 999
    end
    --九阴真气
    if PersonKF(eid,107) and rwnlxz(eid,0) then
        if JLSD(30, 50 + JY.Base["天书数量"]*3,eid) then
            dng = dng + 666
            if WAR.Person[enemyid]["特效动画"] == -1 then
                WAR.Person[enemyid]["特效动画"] =  87 + math.random(6)
            end
            Set_Eff_Text(enemyid, "特效文字1", "九阴真气")
            WAR.ZQHT = 1
        end
    end
	--森罗万象
    if PersonKF(eid,106) and PersonKF(eid,107) then
        if WAR.HXZYJ == 1 then
            WAR.PD['免疫杀气'][eid] = 1
        else
		    dng = dng + 1200
		end
    end
    --易筋真气
    if PersonKF(eid, 108) and rwnlxz(eid,2) then
        if JLSD(30, 50 + JY.Base["天书数量"]*3,eid) then
            dng = dng + 888
            if WAR.Person[enemyid]["特效动画"] == -1 then
                WAR.Person[enemyid]["特效动画"] =  87 + math.random(6)
            end
            Set_Eff_Text(enemyid, "特效文字1", "易筋真气")
            WAR.ZQHT = 1
        end
    end
	--易筋组合
	if NGQH(eid,108) then
		if dng < 0 then
			dng = math.random(1000,2000)
		end
		dngzj[#dngzj+1] = 1
		dng = dng + 2000
		if dng > 2000 then
			dng = dng + 1000
		else
			dngzj[#dngzj+1] = 0.5
		end
	end
	--太虚剑意 坐忘无我 韬光养晦
    if Curr_NG(eid, 152) then
        local TX = 0
        TX = ang
        if TX > 1500 then	 
            dng = dng + TX
			Set_Eff_Text(enemyid, "特效文字1", "韬光养晦・坐忘无我",137)	
        end
    end
	--鲸息功气防值蓄力增加气防值
    if PersonKF(eid,180) and WAR.PD["鲸息蓄力"][eid] ~= nil then
        dng = dng + math.modf(WAR.PD["鲸息蓄力"][eid])
    end
	--九霄减伤
	if PersonKF(eid,184) then
		local yj = TrueYJ(eid)
		dng = dng + yj
	end
	--阴阳无极功
	if PersonKF(eid,221) then
		local a = 0.25
		local b = 1000
		local c = 0.35
		if Curr_NG(eid,221) then
			if rwnlxz(eid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				dngzj[#dngzj+1] = c
			else
				dng = dng + b
				dngzj[#dngzj+1] = c
			end
		elseif JLSD(10,55,eid) then
			if rwnlxz(eid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				dngzj[#dngzj+1] = a
			else
				dng = dng + b
				dngzj[#dngzj+1] = a
			end
		end		
	end
	--阴阳无极组合
	if NGQH(eid,221) then
		if WAR.PD['阴阳双极'][eid] ~= nil and WAR.PD['阴阳双极'][eid] < 31 then --阳极状态
			dngzj[#dngzj+1] = math.random(3,7)*0.1
		end
	end
	--金雁功 标记修改
	if Curr_QG(eid,223) then
		local pd = false
        if isteam(eid) == false then 
            pd = true
		end
        local gl = 70+JY.Base["天书数量"]+math.modf(JY.Person[eid]["实战"]/50)
        if JLSD(20,gl,eid) then 
            pd = true
        end
		if pd == true then 
            dng = dng + 777
            WAR.Person[enemyid]["特效动画"] = 23
			Set_Eff_Text(enemyid, "特效文字2", "七星真气")
		end
	end
	--少林九阳功
	if Curr_NG(eid,243) then
		dng = dng + 400
		Set_Eff_Text(enemyid, "特效文字1", "少林九阳真气",90)
	end
	--奇门五转增加气防
	if PersonKF(eid, 317) then
		dngzj[#dngzj+1] = 0.05
	end
	--龙鹤风云桩
	if NGQH(eid,247) then
		if WAR.BJ == 1 then
			dngzj[#dngzj+1] = 0.8
			dng = dng + 1000
		end
	end	
	--主运内功提升气防
	if JY.Person[eid]["主运内功"] > 0  then
		for i = 1,JY.Base["武功数量"] do
			if JY.Person[eid]["武功"..i] == JY.Person[eid]["主运内功"] and JY.Person[eid]["武功等级"..i] == 999  then
				dngzj[#dngzj+1] = 0.1
				break
			end
		end	
	end
	----------------------------------------------------------------------------
	-----------------------------外功组合气防加成---------------------------------
	-----------------------------------------------------------------------------
	--斗转星移伤害和杀集气计算
    if WAR.DZXYLV[pid] ~= nil and WAR.DZXYLV[pid] > 10 and MuRongDZ(pid) then
        ang = ang + WAR.DZXYLV[pid] * 10
    end
	--全真七子，天罡北斗阵，增加伤害和气攻
	if (pid >= 123 and pid <= 128) or pid == 68 then
		ang = ang + 1200
	end
	--武当七侠，真武七截阵，增加伤害和气攻
	if (pid >= 532 and pid <= 538) then
		ang = ang + 1200
	end
	--松风剑阵
	if (pid >= 211 and pid <= 213) and WAR.ZDDH == 203 then
		ang = ang + 300
	end
	--黄蓉奇门遁甲，蓝色增加杀气
	if WAR.Person[WAR.CurID]["我方"] == true and GetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"],6) == 3 then
		ang = ang + 400
	end
	--北冥六阳
	if (wugong == 8 and PersonKF(pid,85)) or match_ID(pid,116) or match_ID(pid,117) or match_ID(pid,634) then
		if JLSD(10,60,pid) then
			ang = ang + TrueQZ(pid)
			dng = dng - TrueQZ(pid)
		end
	end
	--辟邪招式2	
	if WAR.BXZS == 2 then
		ang = ang + 800
	end
	--辟邪招式3	
	if WAR.BXZS == 3 then
		ang = ang + 1000
	end
	--全真剑气
	if (wugong == 39 and PersonKF(pid,100)) or (PersonKF(pid,39) and MPTX(pid,16,2)) or match_ID(pid,129) then 
		local a = (WAR.QZJQ[pid] or 0) + 1
		ang = ang + 200 * a
	end
	--太玄金乌
	if WAR.JWDF == 1 then 
		local a = JY.Person[pid]["内力"]
		ang = ang + a
	end 	
	--太玄金乌
	if WAR.JWDF == 5 then
		local a = TrueSD(pid)
		ang = ang + a
	end
	--彻地虎是条好汉
    if WGZH(eid,59,232) then
        local jgfmq = 0
        local effstr = "彻地虎是条好汉"
        for j = 0, WAR.PersonNum - 1 do
            if WGZH(WAR.Person[j]["人物编号"],59,232) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
                jgfmq = jgfmq + 1
            end
        end
        if jgfmq >= 1 and math.random(10) < (3 + jgfmq) then
            dng = dng + 1000
            Set_Eff_Text(enemyid, "特效文字3", effstr)
        end
    end
	--氤氤氲氲
	if PersonKF(eid,78) and Curr_QG(eid,148) and PersonKF(eid,148) and WAR.PD["氤氤氲氲"][eid]~= nil then
		local a = (WAR.PD['氤氤氲氲'][eid] or 0) * 0.01
		dngzj[#dngzj+1] = a
	end	
	----------------------------------------------------------------------------
	-----------------------------门派气攻气防加成---------------------------------
	-----------------------------------------------------------------------------
	--桃花岛1级主运碧海
	if MPTX(pid,10,1) and Curr_NG(pid,248) then
		ang = ang + 500
		angzj[#angzj+1] = 1
		dngzj[#dngzj+1] = -0.5
	end 
	--日月3级
	if MPTX(pid,12,3) and Curr_NG(pid,88) and JLSD(20,50,pid) then
		local aa = 10
		if WAR.XXQG[pid] ~= nil and WAR.XXQG[pid] > 0 then
			ang = ang + WAR.XXQG[pid] * 10
		end	
		if WAR.XXQF[eid] ~= nil and WAR.XXQF[eid] >= 0 then
			dng = dng - WAR.XXQF[eid] * 10
			if dng <= 0 then
				WAR.PD['必杀气'][pid] = 1
			end
		end
		Set_Eff_Text(enemyid,3,"群星捧月・星河倒泄")
	end
	if MPTX(eid,2) then  --丐帮
		if match_ID(eid,50) or match_ID(eid,69) then
			dj = 4
		end	
		jsm = jsm + 100
		local JLQX = 0
		local effstr = "丐帮・打狗阵"
		for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] and MPTX(WAR.Person[j]['人物编号'],2) then
				JLQX = JLQX + 1
			end
		end
		if JLQX > 1 then
			dng = dng + 400 * (JLQX)
		end
	end
	--少林2级金刚不坏
	if MPTX(eid,5,2) and JLSD(20,50,eid) then
		dng = dng + 500
		if Curr_NG(eid,144) then
			local ab = JY.Person[eid]["内力最大值"]
			dng = dng + math.modf(ab / 4)
			ang = ang - math.modf(ab / 4)
		else
			local ab = JY.Person[eid]["内力"]
			dng = dng + math.modf(ab / 4)
			ang = ang - math.modf(ab / 4)
		end 
	end 	
	if MPTX(eid,6) then  --密宗
		dng = dng + 2000
	end
	--逍遥派主运八荒的防御加成
	if MPTX(eid,7) and (Curr_NG(eid,101) or (XiaoYaoYF(eid) and PersonKF(eid,101))) then
		dng = dng + (Xishu_sum(eid)/2)
	end
	--三级弟子主运不老长春的防御加成
	if MPTX(eid,7,3) and (Curr_NG(eid,183) or (XiaoYaoYF(eid) and PersonKF(eid,183))) then
		dng = dng + Sanwei_sum(eid)
	end
	--白驼山2级
	if MPTX(eid,8,2) and Curr_NG(eid,95) then
		dng = dng + 1500 
		WAR.Defup[eid] = 1
	end
	--一刀流1级
	if JLSD(0,40,eid) then
		dng = dng + TrueYJ(eid)
	end
	--一刀流2级
	if MPTX(eid,11,2) then
		dng = dng + TrueYJ(eid)
	end
	--日月2级
	if (MPTX(eid,12,2) and Curr_NG(eid,88) and JLSD(20,50,eid)) or match_ID(eid,456) then	
		local aa = 10
		WAR.XXQG[eid] = (WAR.XXQG[eid] or 0) + math.modf(ang/10)
		if WAR.XXQG[eid] ~= nil and WAR.XXQG[eid] > 0 then
			ang = ang - WAR.XXQG[eid] * 10
		end	
		if WAR.XXQF[eid] ~= nil and WAR.XXQF[eid] >= 0 then
			dng = dng + WAR.XXQF[eid] * aa
		end  
		Set_Eff_Text(enemyid,"特效文字3","群星捧月・月汇星光")
	end
	--日月3级
	if MPTX(eid,12,3) and Curr_NG(eid,88) then
		if JLSD(0,30,eid) then	
			dng = dng + 800
		end 
	end
	--五岳紫霞・环绕
	if (MPTX(eid,14,2) and PersonKF(eid,89)) or JXPD(eid,19,1) then
		if WAR.ZXQJ[eid] ~= nil and WAR.ZXQJ[eid] > 0 then
			local zx = WAR.ZXQJ[eid] or 0
			dng = dng + zx * 100
			Set_Eff_Text(enemyid, "特效文字3", "紫霞・剑劲环绕")
		end	
	end
	--大理转龙
	if WAR.PD['转龙呼吸'][eid] ~= nil then
		dng = dng + TrueQZ(eid)*2
	end
	if MPTX(eid,16) then  --全真
		--全真七星北斗阵
		local shz = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
				shz = shz + 1
			end
		end
		if shz > 8 then
			shz = 8
		end
		if shz >= 2 then
			dng = dng + (shz)*100*MPDJ(eid)
		end
	end
	----------------------------------------------------------------------------
	-----------------------------奇穴气攻气防加成---------------------------------
	-----------------------------------------------------------------------------
	if yongte(wugong) and QIQX(pid,'凶亡破') > 0 and WAR.SXTJ <= 200 then
		local a = QIQX(pid,'凶亡破')
		local b = {500,700,1000}
		if JLSD(0,(a*10)+10,pid) then
			dng = dng - (b[a]-WAR.SXTJ)
		end
	end
	---------------------------------------------------------------------------
    -----------------------------攻击气攻结算-------------------------------------
    ---------------------------------------------------------------------------
	--昆仑两仪阵
	if psx(pid,"内力性质") == 1 and WAR.PD['顺逆两仪2'][pid] ~= nil and JLSD(0,math.modf(WAR.PD['顺逆两仪2'][pid]*15)+10,pid) then
		angzj[#angzj+1] = -0.9
	end
    --虚弱状态，杀气减半
    if WAR.PD["虚弱状态"][pid] ~= nil or (WAR.NGJL > 0 and WAR.PD['业障缠身'][pid] == 31) then
		angzj[#angzj+1] = -0.5
    end
    --七伤拳，意恍惚
	if WAR.PD["意恍惚"][pid] ~= nil then
		angzj[#angzj+1] = -0.3
	end
	--林朝英增加总气攻
    if match_ID(pid, 605) or match_ID(pid, 9804) then
		angzj[#angzj+1] = 0.1
    end
	--奇门五转增加总气攻
	if  PersonKF(pid, 317) then
		angzj[#angzj+1] = 0.05
	end
	if WAR.PD['风雷惊蛰3'][pid] ~= nil then
		ang = ang + 100
		angzj[#angzj+1] = 0.5
	end
	--罗汉伏魔提升伤害和杀气效果为：[(当前内力值/500)×(武功消耗内力/140)]%
	if PersonKF(pid,96) and (WAR.NGJL == 96 or Curr_NG(pid,108) or match_ID(pid,38) or (Curr_NG(pid,96) and WAR.NGJL > 0)) then
		local nlmod = JY.Person[pid]["内力"]/20000
		local wgmod = JY.Wugong[wugong]["消耗内力点数"]/2000
		local totalmod = 1 + nlmod + wgmod;
		--石破天效果提高1.1倍
		if match_ID(pid, 38)  or Curr_NG(pid, 108) then
			totalmod = totalmod * 1.1;
		end
		if MPTX(pid,5) then
			totalmod = totalmod * 1.2
		end
		if WAR.LHFM == 1 then
			totalmod = totalmod * 1.5
		end
		angzj[#angzj+1] = totalmod-1
	end
	--被刺目，伤害杀气降低15%，有15%几率miss
    if WAR.PD["盲目状态"][pid] == 2 then
		angzj[#angzj+1] = -0.15
    end
	--主运内功增加气攻
	if JY.Person[pid]["主运内功"] > 0  then
		for i = 1,JY.Base["武功数量"] do
			if JY.Person[pid]["武功"..i] == JY.Person[pid]["主运内功"] and JY.Person[pid]["武功等级"..i] == 999  then
				angzj[#angzj+1] = 0.05
				break
			end
		end	
	end
	--连击，伤害，气攻计算
    if WAR.ACT > 1 then
        local LJ_fac = 0.7	--通常为70%
		local lj = WAR.ACT * 0.05
        if match_ID(pid, 27) or match_ID(pid, 777) or match_ID(pid,5) or wugong == 49 or wugong == 62 or WAR.YNXJ == 1 or WAR.ZYHB == 2 or WAR.PD['真左右互搏'][pid] == 1 then
            LJ_fac = 1
		elseif WAR.BRLJ == 1 then
			LJ_fac = 0.9 + lj
        end
		--瑜伽密乘减少被连击的伤害，气攻
        --主运减少40%
        --被动减少20%
		if Curr_NG(eid, 91)  then
            LJ_fac = LJ_fac - 0.4
        elseif PersonKF(eid, 91) then
			LJ_fac = LJ_fac - 0.2
        end
		--金刚铁布降低
		if NGQH(eid,144) then
			LJ_fac = LJ_fac - 0.5
        end
	    --标记修改 金雁功 连击气攻+20%
		if Curr_QG(pid,223) then
			LJ_fac = LJ_fac + 0.2
		end
		--逍遥游降低连击气攻
		if Curr_QG(eid,2) then
			if QGQH(eid,2,1) then
		     	LJ_fac = LJ_fac * 0.5
			else
				LJ_fac = LJ_fac * 0.7
			end
		end	
		if LJ_fac < 0.1 then
			LJ_fac = 0.1
		end	
		angzj[#angzj+1] = LJ_fac-1
    end
	--九霄增伤
	if PersonKF(pid,184) then
		local yj = TrueYJ(pid)
		ang = ang + yj
	end
	--阴阳无极 阴阳磨
	if PersonKF(pid,221) then
		local a = 0.25
		local b = 1000
		local c = 0.35
		if Curr_NG(pid,221) then
			if rwnlxz(pid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				angzj[#angzj+1] = c
			else
				ang = ang + b
				angzj[#angzj+1] = c
			end
		elseif JLSD(10,55,pid) then
			if rwnlxz(pid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				angzj[#angzj+1] = a
			else
				ang = ang + b
				angzj[#angzj+1] = a
			end
		end		
	end
	--九阳乾坤
	if NGQHB(pid,106) or match_ID(pid, 9992) then
		local wgwl = get_skill_power(pid,wugong,11)
		ang = ang + wgwl
	end	
	--龙象神足
	if NGQH(pid,103) and WAR.LXBL > 0 then
		local lxl = math.modf(Atk(WAR.CurID)*WAR.LXBL/5)
		ang = ang + lxl
	end
	--九阴太极
	if WAR.FXHJ1 == 1 then
		ang = ang + 2000
	end
	--易筋组合
	if (NGQH(pid,108) or (match_ID(pid,114) and Curr_NG(pid,108))) then
		angzj[#angzj+1] = 0.5
	end
	--天魔易筋
	if NGQH(pid,160) then
		if yongdao(wugong) then
			local aa = math.modf(JY.Person[eid]["品德"] - JY.Person[pid]["品德"])
			if aa <= 10 then aa = 10 end
			if aa > 0 or MPTX(eid,5) then
				angzj[#angzj+1] = aa - 1
			end	
		end	
	end
	--太极纯阳
	if WAR.PD['太极奥义・厚积薄发'][pid] == 1 then
		ang = ang + 1500 + math.modf((WAR.LQZ[pid] or 0)*20)
	end
	--擒龙罗汉
	if NGQH(pid,204) then
		local a = JY.Person[pid]["实战"]
		ang = ang + a*8
	end
	--怒涛气劲
	if NGQH(pid,252) then
		local a = JY.Person[eid]["冰封程度"]
		local b = JY.Person[eid]["灼烧程度"]
		ang = ang + math.modf((a+b)*2)
		angzj[#angzj+1] = 1.5
	end
	--霹雳气诀
	if NGQH(pid,372) then
		if JLSD(20,50,pid) then
			ang = ang + 1200
			WAR.PD['头晕目眩'][eid] = 1
		end
		Set_Eff_Text(enemyid, "特效文字2","霹雳心法・秋江映月")
	end
	--玉女素心剑
	if wugong == 139 and ((PersonKF(pid,100) and PersonKF(pid,154)) or match_ID(pid,605)) then
		angzj[#angzj+1] = 1.5
	end
	--南山黄沙
	if wugong == 53 and WGZH(pid,53,78) then
		if JLSD(20,60,pid) then
			angzj[#angzj+1] = 1
		end
	end
	--龙象火焰刀
	if WAR.HYDNJ > 0 then
		local hdq = math.modf(TrueSD(pid)*WAR.HYDNJ/5)
		ang = ang + hdq
	end
	--百胜刀法
	if wugong == 141 and PersonKF(pid,146) then 
		local a = math.random(1,4)
		angzj[#angzj+1] = 0.4*a
	end
	--神兵
	if WAR.PD['神兵'][pid] ~= nil then
		angzj[#angzj+1] = 0.5
	end
	--丐帮
	if WAR.GBZY > 0 then
		angzj[#angzj+1] = 0.1*WAR.GBZY
	end
	--古墓
	if MPTX(pid,3) and DWPD(WAR.CurID,enemyid) then 
		angzj[#angzj+1] = 0.2
	end
	--武当弟子
	if (WAR.TJZX2[pid] or 0) > 0 then 
		angzj[#angzj+1] = WAR.ACT/10
	end	
	--少林2级弟子罗汉堂
	if MPTX(pid,5,2) and Curr_NG(pid,96) then 
		angzj[#angzj+1] = 0.2
	end
	--密宗龙象
	if WAR.LXFM == 1 then
		local nlmod = JY.Person[pid]["内力"]/2000 
		local wgmod = JY.Wugong[wugong]["消耗内力点数"]/200
		local totalmod = nlmod * wgmod;
		ang = math.modf(ang * totalmod)
		angzj[#angzj+1] = totalmod-1
	end
	--日月
	if MPTX(pid,12) and DWPD(WAR.CurID,enemyid) then 
		angzj[#angzj+1] = MPDJ(pid)/10
	end
	--明教2级
	if MPTX(pid,13,2) and Curr_NG(pid,93) then
		if JLSD(20,40 + MPDJ(pid)*5,pid) then
			angzj[#angzj+1] = MPDJ(pid)/5
			WAR.MCF = 1
			Set_Eff_Text(enemyid,2,"焚影圣诀・破绽贯通")    
		end
	end
	---------------------------------------------------------------------------
    -----------------------------防御气攻结算-------------------------------------
    ---------------------------------------------------------------------------
	--武当2弟子修炼梯云纵
    if (MPTX(eid,4,2) and PersonKF(eid,149)) or match_ID(eid,5) then
		angzj[#angzj+1] = -0.5
	end
	--梯云纵，50%几率减少50%所受气攻
    if Curr_QG(eid,149) then
		local jl = 60
		if TFQG(eid,149) then
			jl = jl + 10
		end	
		if QGQH(eid,149,2) and JLSD(10,jl,eid) and ang > 0  then
			angzj[#angzj+1] = -0.7
			local a = math.modf(Qg(WAR.CurID)/6)
			WAR.PD['登云'][eid] = (WAR.PD['登云'][eid] or 0) + a
			ang = ang - a
		elseif JLSD(10,jl,eid) and ang > 0 then
			angzj[#angzj+1] = -0.5
		end	
		if WAR.PD['登云'][eid] ~= nil then
			if TFQG(eid,149) and WAR.PD['登云'][eid] > 1200 then
				WAR.PD['登云1'][eid] = 20
				WAR.PD['登云'][eid] = nil
			elseif 	WAR.PD['登云'][eid] > 1500 then
				WAR.PD['登云1'][eid] = 20
				WAR.PD['登云'][eid] = nil
			end	
		end	
		WAR.Person[enemyid]["特效动画"] = 153
    end
	--李沅芷在场减少气攻
    if ZDGH(enemyid,569) then
		angzj[#angzj+1] = -0.2	
    end
    --冯衡
    if match_ID(eid, 588) then
		angzj[#angzj+1] = -0.1
    end
    --长生诀
    if Curr_NG(eid,203) then
		angzj[#angzj+1] = -0.3
    end
    -- 仪琳
    if match_ID(eid,583) then
		angzj[#angzj+1] = -0.15
    end
	--太奥杀气降低25%
    if WAR.TJAY == 3 then
		angzj[#angzj+1] = -0.25
    end
    --九阳神功
    if Curr_NG(eid,106) and rwnlxz(eid,0) and (JLSD(20,80,eid) or BNJQ(eid)) then
		angzj[#angzj+1] = -0.3
        WAR.PD['氤氲紫气'][eid] = 1
        Set_Eff_Text(enemyid, "特效文字0", "氤氲紫气",90)
    end
	--金轮十龙十象 杀气减半
	if match_ID(eid,9931) then
		ang = ang * 0.5
    end
    --主角刀系，每个刀法练到极，减少受到的5%杀气
    if actor(eid,4) then
        local askd = 0
        for i = 1, JY.Base["武功数量"] do
            if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 4 and JY.Person[0]["武功等级" .. i] == 999 then
                askd = askd + 1
            end
        end
        if askd > 7 then
            askd = 7
        end
		angzj[#angzj+1] = -0.05*askd
    end
    --霍都每个武功练到极，减少受到的7%杀气
    if match_ID(eid, 9981) or match_ID(eid, 84) or match_ID(eid, 650) then
        local LXBR = 0
        for i = 1, JY.Base["武功数量"] do
            if JY.Wugong[JY.Person[0]["武功" .. i]] and JY.Person[0]["武功等级" .. i] == 999 then
                LXBR = LXBR + 1
            end
        end
        if LXBR > 7 then
            LXBR = 7
        end
		angzj[#angzj+1] = -0.07*LXBR
    end
   --擒龙功
    if PersonKF(eid,204) then
		angzj[#angzj+1] = -0.25
	end
    --主运玉女
    if Curr_NG(pid, 154) and JY.Person[pid]['性别'] == 1 then
        angzj[#angzj+1] = 0.2
    end
    --玄女剑法
	if wugong==161 and JY.Person[pid]['性别'] == 1 then
		angzj[#angzj+1] = 0.2
    end	
	--不计算在原距离之中
    --魔帝BOSS距离越远，杀气越低
    if match_ID(eid,26) then
        local offset = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[enemyid]["坐标X"]) + math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[enemyid]["坐标Y"])
        if offset > 11 then
            offset = 11
        end
		angzj[#angzj+1] = 1-(100-(offset-1)*10)/100
    end
	--三才身
	if Sancai(eid) then
		if JLSD(10,43,eid) and (WAR.LQZ[eid] or 0) > 0 then
			if BNJQ(eid) then
				angzj[#angzj+1] = -0.9
			else
				angzj[#angzj+1] = -((WAR.LQZ[eid]*0.008)+0.1)
			end
			Set_Eff_Text(enemyid,2,"三才・地")
		end
	end
	--浩然罡气
	if match_ID(eid,9946) and JLSD(0,50,eid) then
		local qg = dng/5000
		if qg > 1 then qg = 1 end
		angzj[#angzj+1] = -qg
	end
	if WAR.PD["太玄组合防御3"][eid] ~= nil then
		angzj[#angzj+1] = -0.9
	end
	--周天星辰207
	if WAR.PD['三垣'][eid] ~= nil then
		if WAR.PD['三垣'][eid] >= 61 and WAR.PD['三垣'][eid] < 91 then
			angzj[#angzj+1] = -0.8
		end
	end
	--五岳剑派2级弟子
	if MPTX(eid,14,2) then
		angzj[#angzj+1] = -0.5
	end
	--阿九 降低999点气攻
    if WAR.FGPZ[eid] ~= nil and WAR.FGPZ[eid]== 1 then
        ang = ang - 999
    end
	----------------------------------------------------------------------------------------
	-------------------------------------暴击伤害增加---------------------------------------------
	----------------------------------------------------------------------------------------------
	if WAR.BJ == 1 then
		local bjsh = 1.5
		local ljbj = 0 --临济组合暴击记录
		--四大恶人
		if match_ID(pid, 44) or match_ID(pid, 98) or match_ID(pid, 99) or match_ID(pid, 100) or match_ID(pid, 9815) then
			bjsh = 2
		end
		--初生牛犊
		if match_ID(pid,9743) then
			bjsh = 2
		end
		--小无相杂学
		if WAR.XWXZX == 4 then
			bjsh = 2
		end
		--黯然大招
		if WAR.ARJX == 2 then
			bjsh = 3
		end
		--指法暴击
		if WAR.ZFBJ1 == 1 then
			bjsh = 2
		end
		if WAR.ZFBJ2 == 1 then
			bjsh = 3
		end
		if WAR.ZFBJ3 == 1 then
			bjsh = 4
		end
		if WAR.ZFBJ4 == 1 then
			bjsh = 5
		end
		--奇门剪刀
		if wugong == 75 and WGZH(pid,56,75) then
			bjsh = 3
			Set_Eff_Text(enemyid, "特效文字2", "奇门五行・碎骨")
		end
		--醉八仙
		if WAR.ZBX == 6 then
			bjsh = 4
		end
		--龙象之力
		if WAR.LXLL == 1 then
			bjsh = 5
		end
		--天罡斗气
		if PersonKF(pid,106) and PersonKF(pid,107) and PersonKF(pid,108) and actor(pid,6) and JXPD(pid,6,1) then
			Set_Eff_Text(enemyid, "特效文字2", "天罡斗气")
			bjsh = 5
		end
		--达摩九阳
		if WAR.PD["苦难达摩"][pid] ~= nil and WAR.PD["苦难达摩"][pid] > 0 then
			local kn =  (WAR.PD["苦难达摩"][pid] or 0) / 800
			bjsh = bjsh + kn
		end
		--井月八法
		if PersonKF(pid,181) then
			for i = 1, JY.Base["武功数量"] do
				local dfjc = 0
				local dfjc1 = 0
				if JY.Wugong[JY.Person[pid]['武功'.. i]]['武功类型'] == 4 and JY.Person[pid]['武功等级'.. i] == 999 then
					dfjc = dfjc + 1
				end
				dfjc1 = dfjc * 0.3
				if dfjc > 2 then
					bjsh = bjsh + dfjc1
					break
				end
			end
		end
		--金雁功
		if Curr_QG(pid,223) then
			bjsh = bjsh + 0.2
			if TFQG(pid,223) then
				bjsh = bjsh + (WAR.YDBS/10)
				if JLSD(10,25,pid) then
					WAR.PD['恐惧状态'][eid] = 1
				end
			end	
		end
		--寇仲
		if match_ID(pid, 578) then
			bjsh = bjsh + 0.2
		end
		--逆运
		if PersonKF(pid, 104) then
			bjsh = bjsh + 0.2
			if Curr_NG(pid,104) then
				bjsh = bjsh + 0.2
			end
		end
		--易水寒诀
		if Curr_NG(pid,43) and WAR.PD['易水寒诀'][pid] ~= nil and WAR.PD['易水寒诀'][pid] > 30 then
			bjsh = bjsh + 0.3
		end
		--九阴逆运
		if NGQHB(pid,104) then
			bjsh = bjsh + 0.4
		end
		--南山黄沙
		if wugong == 53 and WGZH(pid,53,78) then	
			bjsh = bjsh + 1
		end
		--六脉大招
		if WAR.DSP_LM3 == 1 then
			bjsh = bjsh + 1.2
		end
		--少林千手如来
		if MPTX(pid,5) and WAR.TFJS > 0 then
			bjsh = bjsh + 1.2
		end
		--袁承志
		if (match_ID(pid, 54) or match_ID(pid, 9816)) and isteam(pid) then 
			bjsh = bjsh + 0.2 * JY.Base["天书数量"]
		end
		--雪羽战神
		if WAR.PD['易水四寒2'][pid] == 5 or WAR.PD['雪羽战神'][pid] == 1 then
			bjsh = bjsh * 2
		end
		--密宗暴击加成
		if MPTX(pid,6) then
			if bjsh < 2 then
				bjsh = bjsh * math.random(1,3)
			end
			if Curr_NG(pid,103) then
				bjsh = bjsh + 1
			end
		end
		--极阴无相
		if Curr_NG(pid,367) then
			if bjsh < 5 then
				bjsh = 5
			end
		end
		ljbj = bjsh  --临济组合暴击记录
		----------------------降低暴击伤害-------------------------
		--罗汉血
		if WAR.PD["罗汉血"][pid] ~= nil then
			local a = 1 - (WAR.PD["罗汉血"][pid] or 0)/10
			bjsh = bjsh * a
		end
		--逆运
		if Curr_NG(eid,104) then
			bjsh = bjsh - 0.3
		end
		--九阴逆运
		if NGQHB(eid,104) then 
			bjsh = bjsh - 0.4
		end
		--逍遥游
		if Curr_QG(eid,2) then
			bjsh = bjsh * 0.7
		end
		--天佛降世
		if match_ID(eid,9986) and WAR.FUHUOZT[eid] ~= nil then
			bjsh = 1
			Set_Eff_Text(enemyid, "特效文字1", "天佛宝身")
		end
		--苗若兰
		if (match_ID(eid,545) or match_ID(eid,9771)) and JY.Person[pid]["性别"] == 0 then
			bjsh = 1
			Set_Eff_Text(enemyid, "特效文字2", "望雪颦愁")
		end
		--凉风有信
		if match_ID(eid,9770) and JY.Person[pid]["性别"] == 1 then
			bjsh = 1
			Set_Eff_Text(enemyid, "特效文字2", "凉风有信")
		end
		--仁者无敌
		if match_ID(eid,9933) and JY.Person[0]["品德"] >= 100 then
			bjsh = 1
			Set_Eff_Text(enemyid, "特效文字2", "仁者无敌")
		end
		--森罗万象
		if PersonKF(eid,106) and PersonKF(eid,107) then
			Set_Eff_Text(enemyid, "特效文字2", "森罗万象")
			bjsh = 1
		end
		--临济十二桩组合
		--龙鹤风云桩
		if NGQH(eid,247) then
			bjsh = 1
			Set_Eff_Text(enemyid, "特效文字2", "龙鹤风云")
			if (WAR.PD['龙风'][eid] or 0) < ang/2 then
				WAR.PD['龙风'][eid] = ang/2
			end
		end		
		--金刚铁布
		if NGQH(eid,144) then
			bjsh = 0.5
			ztd(enemyid,"生命点数",math.random(150,300)) 
			Set_Eff_Text(enemyid, "特效文字2", "琉璃不漏")
		end
		--黄裳
		if match_ID(eid, 637) then
			bjsh = 0.3
		end
		--天罡斗气
		if PersonKF(eid,106) and PersonKF(eid,107) and PersonKF(eid,108) and actor(eid,6) and JXPD(eid,6,1) then
			Set_Eff_Text(enemyid, "特效文字2", "天罡护体")
			bjsh = 0.1
		end
		--临济十二桩组合
		if WAR.PD['天地之心'][pid] == 1 then
			if ljbj > 0 and bjsh < ljbj then
				bjsh = ljbj
			end
			bjsh = bjsh + 2	
			if WAR.PD['龙风'][pid] ~= nil and (WAR.PD['鹤云'][eid] == nil or (WAR.PD['鹤云'][eid] ~= nil and WAR.PD['鹤云'][eid] < WAR.PD['龙风'][pid])) then
				WAR.PD['鹤云'][eid] = WAR.PD['龙风'][pid]
				WAR.PD['龙风1'][pid] = 1
			end
			if WAR.PD['四智妙法'][pid] == 1 then
				local a = psx(eid,'受伤程度') + psx(eid,'中毒程度') + psx(eid,'冰封程度') + psx(eid,'流血程度') + psx(eid,'封穴程度') + psx(eid,'灼烧程度')
				ztd(WAR.CurID,'生命点数',a)
				ztd(WAR.CurID,'内力点数',a*2)
				ztd(WAR.CurID,'体力点数',a*0.05)
			end
			if WAR.PD['四智妙法'][pid] == 2 then
				zhanyi(eid,-15)
			end
			if WAR.PD['四智妙法'][pid] == 4 then
				local a = math.modf(Xishu_sum(pid)*0.3)
				swhurt = swhurt + a
				wxhurt = wxhurt + a
			end	
		end
		--暴击上限限制
		if bjsh > 3 then
			if Curr_NG(pid,367) then
			else
				bjsh = 5
			end
		end
		--暴击下限限制
		if bjsh < 0.1 then
			bjsh = 0.1
		end	
		--暴击对应伤害结算
		swhurt = math.modf(swhurt*bjsh)
		wxhurt = math.modf(wxhurt*bjsh)		
	end
	----------------------------------------------------------------------------------------------
	-------------------------------------连击伤害递减---------------------------------------------
	----------------------------------------------------------------------------------------------
	--连击，伤害，气攻计算
	if WAR.ACT > 1 then
		local LJ_fac = 0.7	--通常为70%
		--东方不败不减少 张三丰
		--六脉神剑，夫妻刀法不减少
		--夭矫空碧不减少
		if match_ID(pid,27) or match_ID(pid,777) or match_ID(pid,5) or wugong == 49 or wugong == 62 or WAR.YNXJ == 1 or WAR.PD['真左右互搏'][pid] == 1 then
			LJ_fac = 1
		end
		--般若金刚
		if WAR.BRLJ == 1 then
			LJ_fac = 1*(1+(WAR.ACT*0.1))
		end
		--古墓派主运天罗连击增伤
		if WAR.YNXJ == 1 and MPTX(pid,3) and Curr_QG(pid,148) then
			LJ_fac = LJ_fac+0.5
		end	
		--标记修改 金雁功 连击伤害+20%
		if Curr_QG(pid,223) then
			LJ_fac = LJ_fac+0.2
			if TFQG(pid,223) then
				LJ_fac = LJ_fac+(WAR.YDBS/15)
				if JLSD(10,15,pid) then
					WAR.PD['昏迷状态'][eid] = 1
				end
			end	
		end
		--金刚狮子吼减少被连击的伤害，气攻
		--主运减少40%
		--被动减少20%
		if Curr_NG(eid, 91) then
			LJ_fac = LJ_fac - 0.4
		elseif PersonKF(eid, 91) then
			LJ_fac = LJ_fac - 0.2
		end
		--金刚铁布
		if NGQH(eid,144) then 
			LJ_fac = LJ_fac - 0.5
		end
		--逍遥游降低连击伤害
		if Curr_QG(eid,2) then 
			if QGQH(eid,2,1) then
				LJ_fac = LJ_fac - 0.7
			else
				LJ_fac = LJ_fac - 0.5
			end
		end	
		if LJ_fac < 0.1 then
			LJ_fac = 0.1
		end	
		swhurt = math.modf(swhurt*LJ_fac)
		wxhurt = math.modf(wxhurt*LJ_fac)
	end
	-----------------------------------------------------------------------
    ---------------------------人物天赋命中敌人后加成------------------------
	-----------------------------------------------------------------------
	--太极张三丰
	if match_ID(pid,5) then 
		if (WAR.TJZS[1000 + pid] or 0) > JY.Person[pid]["生命"] then 
			local a = math.modf(WAR.TJZS[1000 + pid]*0.25) 
			local b = math.modf(WAR.TJZS[1000 + pid]*0.5)
			local c = math.random(a,b)
			if c > 3000 then c = 3000 end
			ztd(WAR.CurID,"生命点数",c)
		end
		WAR.TJZS[1000 + pid] = nil 
	end
	--灭绝6的玉石俱焚状态
	if WAR.YSJF[pid] ~= nil then
		hurtzs1[#hurtzs1+1] = 0.5
	end
	--蓝凤凰，攻击时伤害一*110%
    if match_ID(pid,25) then
		hurtzs1[#hurtzs1+1] = 0.1
	end
	--东方不败：追加轻功的伤害
	if match_ID(pid,27) or match_ID(pid,777) then
		hurtzs1[#hurtzs1+1] = 0.5
		zshurt = zshurt + math.modf(Qg(WAR.CurID)/4)
		if PersonKF(pid,105) and ZYJQ(pid) and WAR.ACT < 3 then
			local sm = math.modf(JY.Person[eid]["生命"]/3)
			local nl = math.modf(JY.Person[eid]["内力"]/3)
			ztd(enemyid,"内力点数",-nl)
			ztd(enemyid,"生命点数",-sm)
			if WAR.PD["封印"][eid] == nil then
				WAR.PD["封印"][eid] = 5
			end
			Set_Eff_Text(enemyid,2,"真葵奥义・魔葵一笑",221)
		end
	end
	--brolycjw：龙岛主，攻击时伤害一*120%
    if match_ID(pid,39) then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--丁春秋摘星功
	if match_ID(pid,46) and psx(eid,"中毒程度") > 0 then
		if JY.Person[eid]["中毒程度"] > 0 then
			zshurt = zshurt + JY.Person[eid]["中毒程度"]
		end
		if Curr_QG(pid,296) then
			addbuff(pid,WAR.PD['绿火星毒'],9,20)
			addbuff(eid,WAR.PD['举火燎原'],math.modf(psx(eid,"中毒程度")/20),20)
			Set_Eff_Text(enemyid,3,"星毒燃原")
		end
	end
	--丘处机、马钰
	if match_ID(pid,68) or match_ID(pid,123) then
		hurtzs1[#hurtzs1+1] = 0.1
	end
	--宋青书 一个女的+5%伤害一 1041
    if match_ID(pid,82) then
		local s = 0
		local s1 = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and JY.Person[WAR.Person[j]["人物编号"]]["性别"] == 1 then
				s = s + 1
			end
		end
		hurtzs1[#hurtzs1+1] = s * 0.05
	end
	--火焰刀奥义103
	if WAR.HZGX == 1 then --火之高兴
		local h = TrueSD(pid)
		zshurt = zshurt + h
	end
	if WAR.PD['残火太刀'][pid] ~= nil and WAR.CHTD == 2 then
		zshurt = zshurt + 1000
		if psx(eid,'灼烧程度') > 0 then
			local jl = limitX(math.modf(psx(eid,'灼烧程度')*0.5),0,50)
			if JLSD(0,jl,pid) then
				ztd(enemyid,'生命点数',-psx(eid,'生命最大值'))
			end
		end
	end
	--陈达海青蟒剑
	if match_ID(pid,137) and wugong == 40 then
		hurtzs1[#hurtzs1+1] = -0.25
	end
	--文泰来，100%血无加成，1血50%加成 1041
    if match_ID(pid, 151) then
    	local HZDBJ = 0
		HZDBJ = (1-JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"])/2
		hurtzs1[#hurtzs1+1] = HZDBJ
    end
	--骆冰 一个男的+5%伤害一 1041
    if match_ID(pid,154) then
		local s = 0
		local s1 = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and JY.Person[WAR.Person[j]["人物编号"]]["性别"] == 0 then
				s = s + 1
			end
		end
		hurtzs1[#hurtzs1+1] = s*0.05
	end
	--尼摩星伤害永久提高1.5倍
    if match_ID(pid,159) then
		hurtzs1[#hurtzs1+1] = 0.5
	end
	--慕容博命中后
	if match_ID(pid,113) then
		WAR.PD['荒天龙灭'][eid] = 1
		Set_Eff_Text(enemyid, "特效文字3", "蛇化为龙・不变其文")
	end
	--达尔巴160，被死战锁定的目标，伤害一+50%
    if WAR.SZSD == eid then
		hurtzs1[#hurtzs1+1] = 0.5
    end
    --李莫愁对男性增伤10%
    if match_ID(pid,161) then
    	if JY.Person[eid]["性别"] == 0 then
			hurtzs1[#hurtzs1+1] = 0.1
		end
    end
	--谢烟客亦正亦邪		
	if match_ID(pid,164) and JY.Person[pid]["品德"] >= 60 then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--陈正德311鹰爪功追加内伤伤害
	if WAR.YZG == 1 then
		zshurt = zshurt + JY.Person[eid]["受伤程度"] * 3
	end
	--碧落九重剑・加重岩
	if ((match_ID(pid,457) and JY.Person[430]["品德"] == 0) or match_ID(pid,92) or (WAR.ZDDH == 456 and match_ID(pid,457))) 
	and yongjian(wugong) and (JLSD(0,30,pid) or BNJQ(pid)) then
		WAR.BLJC1[eid] = 10
		addbuff(eid,WAR.PD["生命恢复停止"],1,2)
		Set_Eff_Text(enemyid, "特效文字3", "加重岩")
	end
	--点点剑法
	if JXPD(pid,457,1) or (WAR.ZDDH == 456 and pid == 457) then
		ztd(enemyid,WAR.LXXS,100)
		ztd(enemyid,"生命点数",-math.modf(TrueYJ(pid)*0.1))
		zshurt = zshurt + JY.Person[eid]["流血程度"] * 5
		Set_Eff_Text(enemyid, "特效文字2","煞气・浊魂侵体")
	end
	--点点领悟
	if (JY.Person[531]["论剑奖励"] == 1 and match_ID(pid,457) and yongjian(wugong)) or (WAR.ZDDH == 456 and pid == 457) then
		local str = ""
		local a = math.random(1,7)
		if a == 1 or (WAR.PD['七剑合一'][pid] ~= nil and WAR.PD['七剑合一'][pid] == 1) then
			zshurt = zshurt + TrueYJ(pid)
			WAR.PD["精神错乱"][eid] = 10
			str = "・玉箫剑音"
		elseif a == 2 or a == 8 or (WAR.PD['七剑合一'][pid] ~= nil and WAR.PD['七剑合一'][pid] == 1) then
			hurtzs1[#hurtzs1+1] = 0.5
			WAR.PD['恐惧状态'][eid] = 1
			ztd(enemyid,'集气位置',-300)
			str = "・太极剑意"
		elseif a == 3 or (WAR.PD['七剑合一'][pid] ~= nil and WAR.PD['七剑合一'][pid] == 1) then
			if WAR.Person[enemyid]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				 local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 50)
				if d < 50 then
					d = 50
				end 
				ztd(enemyid,"内伤点数",20)
				ztd(enemyid,"生命点数",-d)
				ztd(enemyid,"内力点数",-1000)
			end 
			ztd(enemyid,WAR.FXXS,10)
			WAR.PD["刺目"][eid] = 2
			str = "・玄铁剑劲"
		elseif a == 4 or (WAR.PD['七剑合一'][pid] ~= nil and WAR.PD['七剑合一'][pid] == 1) then
			local b = math.modf(TrueYJ(pid)*0.3)
			if b > 1500 then b = 1500 end
			for j = 0, WAR.PersonNum - 1 do
				local id = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"生命点数",-b)
				end
			end
			str = "・越女剑舞"
		elseif a == 5 or (WAR.PD['七剑合一'][pid] ~= nil and WAR.PD['七剑合一'][pid] == 1) then
			for j = 0, WAR.PersonNum - 1 do
				local id = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,WAR.LXXS,100)
					WAR.PD["扫荡群魔"][id] = 20
					WAR.PD["血流不止"][id] = 20
				end
			end
			str = "・辟邪剑影"
		elseif a == 6 or (WAR.PD['七剑合一'][pid] ~= nil and WAR.PD['七剑合一'][pid] == 1) then
			ztd(WAR.CurID,'集气位置',300)
			WAR.PD["时序闪避"][pid] = 15
			str = "・狂风剑势"
		elseif a == 7 or (WAR.PD['七剑合一'][pid] ~= nil and WAR.PD['七剑合一'][pid] == 1) then
			if WAR.ATNum < 6 then
				WAR.ATNum = 6
			end
			WAR.PD['麻痹状态'][eid] = 10
			str = "・连城剑绝"
		 end
		Set_Eff_Text(enemyid, "特效文字2","点化万物"..str)
	end
	--点点虚邪剑典
	if match_ID(pid,457) and WAR.PD['虚邪剑来'][pid] == 1 and yongjian(wugong) then
		ztd(enemyid,'生命点数',-math.modf(TrueYJ(pid)*0.7))
		if WAR.PD['虚邪夜玄'][pid] ~= nil then
			local a = psx(eid,'受伤程度') + psx(eid,'封穴程度') + psx(eid,'中毒程度')
			local b = psx(eid,'流血程度') + psx(eid,'冰封程度') + psx(eid,'灼烧程度') 
			zshurt = zshurt + math.modf((a+b)*2)
		end
		if WAR.PD['虚邪极日1'][pid] ~= nil then
			local a = math.modf(psx(pid,'生命最大值'))
			if a > 8000 then a = 8000 end
			zshurt = zshurt + a
			WAR.PD['盲目状态'][eid] = 2
			WAR.PD['虚邪极日2'][eid] = 1
		end	
		if WAR.PD['虚邪蚀月1'][pid] ~= nil then
			zshurt = zshurt + math.modf(psx(eid,'生命最大值')*0.36)
			WAR.PD['锁足状态'][eid] = 1
			WAR.PD['虚邪蚀月2'][eid] = 1
		end	
		if WAR.PD['虚邪乱魄1'][pid] ~= nil then
			WAR.PD['虚邪乱魄2'][eid] = 10
		end
		if WAR.PD['虚邪断空'][eid] == 3 then
			WAR.PD['虚邪断时'][eid] = 5
			addbuff(eid,WAR.PD['禁疗'],5,10)
		end	
		if WAR.PD['虚邪散魂1'][pid] ~= nil then
			WAR.PD['虚邪散魂2'][eid] = 1
		end	
	end
	--白展堂
	if match_ID(pid,511) then 
		local fx = JY.Person[eid]["封穴程度"]
		local lx = JY.Person[eid]["流血程度"]
		zshurt = zshurt + fx * 2 + lx * 2 + 100
	end
	--竹风雨滴
	if match_ID(pid,520) then
		if DWPD(WAR.CurID,enemyid) then
			WAR.XWRJ[100 + eid] = 1
			zshurt = zshurt + JY.Person[eid]["生命"]
			if WAR.XWRJ[200 + eid] == nil then
				WAR.XWRJ[200 + eid] = 0
			end
		end
		if (WAR.XWRJ[100 + eid] == 1 or (WAR.XWRJ[200 + eid] or 0) >= 1) and WAR.ACT == 1 then 
			local a = 0 
			if WAR.XWGJ[eid] ~= nil and WAR.XWGJ[eid] > 0 then 
				a = WAR.XWGJ[eid]
			end	
			ztd(enemyid,'生命点数',-math.modf(100 * (1 + a * 0.1)))
			Set_Eff_Text(enemyid, "特效文字2", "剑气・噬体",58)
		end
		if JLSD(20,50,pid) then 
			WAR.PD['天绝剑气'][eid] = 15
			Set_Eff_Text(enemyid, "特效文字3","天绝剑气・实而不凝")
		end
		if WAR.XWQJ > 0 then
			hurtzs1[#hurtzs1+1] = WAR.XWQJ
			local t = WAR.XWQJ
			for j = 0, WAR.PersonNum - 1 do 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"内力点数",-t)
				end
			end
		end
		if WAR.MMJF > 0 then
			local m = WAR.MMJF
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"生命点数",-200*m)
				end
			end
		end
		if WAR.MMJF1 == 1 then
			local a = JY.Person[eid]["封穴程度"]
			ztd(enemyid,WAR.FXXS,50)
			zshurt = zshurt + a
		end
		if WAR.MMJF2 == 1 then
			local a = JY.Person[eid]["灼烧程度"]
			ztd(enemyid,WAR.ZSXS,100)
			zshurt = zshurt + a
			nuqi(pid,1)	
		end
		if WAR.MMJF4 == 1 then
			WAR.PD['时序闪避'][pid] = (WAR.PD['时序闪避'][pid] or 0) + 30	
		end
		if WAR.MMJF5 == 1 then
			local a = TrueYJ(pid)
			zshurt = zshurt + a 
			addbuff(eid,WAR.PD['灵蛇拳'],10,15)		
		end
		if WAR.MMJF6 == 1 then 
			local a = JY.Person[eid]["攻击力"]
			local b = JY.Person[eid]["防御力"]
			local c = JY.Person[eid]["轻功"]
			zshurt = zshurt + a + b + c
		end 
		if WAR.MMJF7 == 1 then
			local a = JY.Person[eid]["生命"]
			zshurt = zshurt + a 
			WAR.PD["昏迷状态"][eid] = 1
		end
		if WAR.MMJF8 == 1 then
			local a = JY.Person[eid]["内力"]
			zshurt = zshurt + a 
			WAR.PD['精神错乱'][eid] = 10
		end
		if WAR.MMJF9 == 1 then
			local a = JY.Person[pid]["攻击力"]
			zshurt = zshurt + a
			WAR.PD["恐惧状态"][eid] = 1
		end
		if WAR.MMJF10 == 1 then
			local a = TrueYJ(pid)
			ztd(enemyid,"生命点数",-a)
		end
		if WAR.WTJJ > 0 then
			local w = WAR.WTJJ
			for j = 0, WAR.PersonNum - 1 do 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"内力点数",-50*w)
				end
			end
		end
		if WAR.WTJJ1 == 1 then
			ztd(enemyid,WAR.BFXS,100)
			ztd(enemyid,WAR.ZSXS,100)
			ztd(enemyid,WAR.LXXS,100)
			ztd(enemyid,"内伤点数",100)
		end
		if WAR.WTJJ3 == 1 then
			WAR.PD["无招胜有招"][eid] = 15
		end
		if WAR.WTJJ4 == 1 then
			hurtzs1[#hurtzs1+1] = 1
			zshurt = zshurt + math.modf(1 * JY.Person[eid]["生命"] / 2)
			zshurt = zshurt + math.modf(1 * JY.Person[eid]["内力"] / 2)
			zshurt = zshurt + math.modf(1 * JY.Person[eid]["攻击力"] / 2)
		end
		if WAR.WTJJ5 == 1 then
			WAR.PD['玄武逆行'][eid] = 10
		end
		if WAR.WTJJ6 == 1 then
			zhanyi(eid,-20)
		end
		if WAR.WTJJ7 == 1 then
			nuqi(eid,-20)
		end
		if WAR.WTJJ8 == 1 then
			for j = 0, WAR.PersonNum - 1 do 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local p = WAR.Person[j]["人物编号"]
					WAR.PD['走火入魔'][p] = 15
				end
			end 
		end
		if WAR.WTJJ9 == 1 then
			for j = 0, WAR.PersonNum - 1 do 
				local p = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['玄武逆行'][p] = 10
				end
			end 
		end
		if WAR.WTJJ11 == 1 then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD["盲目状态"][WAR.Person[j]["人物编号"]] = 2
				end
			end	
		end
		if WAR.WTJJ12 == 1 then
			if WAR.ATNum < 4 then
				WAR.ATNum = 4
			end 
		end
		if WAR.WTJJ13 == 1 then
			zshurt = zshurt + math.modf(JY.Person[eid]["生命"] * 0.3)
		end
		if WAR.WTJJ14 == 1 then		
			zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"] * 0.1)
		end
		if WAR.TJFJ == 1 then
			local a = TrueYJ(pid)
			zshurt = zshurt + a
		end
	end
	--南子燎原枪个人特效
	if match_ID(pid,525) and WAR.PD['南子燎原枪'][pid] ~= nil then
		local a = math.modf((WAR.SPIRIT[pid] or 0)*0.1)
		if a < 1 then a = 1 end
		zshurt = zshurt + math.modf((psx(pid,'灼烧程度') + psx(eid,'灼烧程度'))*a)
		ztd(enemyid,WAR.ZSXS,math.random(5,15))
		if psx(eid,'灼烧程度') > 0 then
			ztd(enemyid,WAR.FXXS,math.modf(psx(eid,'灼烧程度')*0.2))
			if JLSD(10,45,pid) then
				WAR.PD['燎原枪2'][eid] = math.random(3)
			end
		end	
		if psx(eid,'封穴程度') ~= psx(eid,'灼烧程度') then
			if psx(eid,'封穴程度') < psx(eid,'灼烧程度') then
				ztd(enemyid,'内伤点数',math.modf(psx(eid,'灼烧程度')*0.5))
				if JLSD(0,30,pid) then
					addbuff(eid,WAR.PD['重度内伤'],10,10)
				end	
			else
				ztd(enemyid,'集气位置',psx(eid,'封穴程度'))
				addbuff(pid,WAR.PD['增加气攻'],500)
				if BNJQ(pid) then
					WAR.PD['必杀气'][pid] = 1
				end	
			end
			Set_Eff_Text(enemyid,3,'二十针')
		else
			ztd(enemyid,WAR.FXXS,5)
			ztd(enemyid,WAR.ZSXS,5)
		end
		if JLSD(10,45,pid) then
			zhanyi(eid,-10)
			if WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[eid] ~= nil and WAR.SPIRIT[pid] > WAR.SPIRIT[eid] then
				local sp = WAR.SPIRIT[pid] - WAR.SPIRIT[eid]
				if JLSD(0,sp,pid) then
					WAR.PD["恐惧状态"][eid] = 1	
					WAR.PD['虚弱状态'][eid] = 25
				end	
			end
			Set_Eff_Text(enemyid,1,'三十击・雨暴风狂')
		end
		if JLSD(10,45,pid) then
			zshurt = math.modf(WAR.ACT*(zshurt+(psx(pid,'内力')*0.25)))
			if ZYJQ(pid) then
				WAR.PD['脆弱状态'][eid] = 2
			end	
			Set_Eff_Text(enemyid,1,'三十击・迭浪千重')
		end
		if psx(eid,'灼烧程度') >= 50 and WAR.PD['燎原枪2'][eid] ~= nil and WAR.PD['燎原枪2'][eid] > 0 then
			local a = math.random(WAR.PD['燎原枪2'][eid])
			for cy = 1,a do
				hurtzs1[#hurtzs1+1] = 0.5
				ztd(enemyid,'生命点数',-math.modf(psx(eid,'灼烧程度')*5))
				ztd(enemyid,'集气位置',-math.modf(psx(eid,'灼烧程度')*0.2))
				addbuff(eid,WAR.PD['重度内伤'],5,10)
				ztd(WAR.CurID,'生命点数',100)
				ztd(WAR.CurID,'内力点数',250)
			end
			WAR.PD['燎原枪2'][eid] = WAR.PD['燎原枪2'][eid] - a
			local p = WAR.CurID
			WAR.CurID = enemyid
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID,55,1,'燎原枪焰・爆')
			WAR.CurID = p
		end	
		if Curr_NG(pid,367) and PersonKF(pid,367) then
			if psx(eid,'冰封程度') ~= psx(eid,'灼烧程度') then
				if psx(eid,'冰封程度') < psx(eid,'灼烧程度') then
					ztd(enemyid,WAR.BFXS,psx(eid,'灼烧程度') - psx(eid,'冰封程度'))
				else
					ztd(enemyid,WAR.ZSXS,psx(eid,'冰封程度') - psx(eid,'灼烧程度'))
				end
			else
				ztd(enemyid,WAR.BFXS,10)
				ztd(enemyid,WAR.ZSXS,10)
			end
			if WAR.PD['冰冻状态'][eid] ~= nil and WAR.PD['冰冻状态'][eid] > 0 then
				WAR.PD['举火燎原'][eid] = math.modf(WAR.PD['冰冻状态'][eid] * 0.5)
				Set_Eff_Text(enemyid,2,'燎原冷焰')
			elseif WAR.PD['举火燎原'][eid] ~= nil and WAR.PD['举火燎原'][eid] > 0 then
				WAR.PD['冰冻状态'][eid] = math.modf(WAR.PD['举火燎原'][eid])
				addbuff(eid,WAR.PD['冰冻扣血'],math.modf(WAR.PD['举火燎原'][eid]*0.5))
				Set_Eff_Text(enemyid,2,'燎原冷焰')
			end	
		end
	end
	--路人降龙
	if (wugong == 26 or (JXPD(pid,527,1) and yongquan(wugong))) and match_ID(pid,527) then
		if MPTX(pid,24) and Curr_NG(pid,367) then
			if WAR.PD['降龙逆光掌1'][pid] ~= nil and WAR.PD['降龙逆光掌1'][pid] > 0 then
				zshurt = zshurt + WAR.PD['降龙逆光掌1'][pid] 
				Set_Eff_Text(enemyid,1,'逆光掌')
			end
		end
		if WAR.LRXL == 2 then
			ztd(enemyid,"内伤点数",100)
			ztd(enemyid,WAR.LXXS,100)
		end 
		if WAR.LRXL == 3 then
			local a = JY.Person[eid]["受伤程度"] * 3
			local b = JY.Person[eid]["流血程度"] * 2
			local c = a + b 
			ztd(enemyid,"生命点数",-a)
		end
	end
	--降龙增加禁疗，昏迷，封印效果
	if wugong == 26 and (JY.Person[pid]["拳掌功夫"] >= 500 or match_ID(pid,50)) and JLSD(10,45,pid) then
		WAR.PD['禁疗'][eid] = 10
		WAR.PD["封印"][eid] = 10
		WAR.PD["昏迷状态"][eid] = 1	
	end 	
		
	--白绣
	if match_ID(pid,582) then
		local bxbf = JY.Person[eid]["冰封程度"]
		zshurt = zshurt + bxbf * 2
	end
	--步惊云排云掌584
	if WAR.BJYPYZ > 0 then
		hurtzs1[#hurtzs1+1] = 0.04*WAR.BJYPYZ
	end
    --何足道棋势伤害
    if match_ID(pid,586) and JY.Base["天书数量"] > 0  then
        local YQ = 0
        YQ = YQ +JY.Base["天书数量"] * 100
        zshurt = zshurt +YQ
    end
	--独孤求败
	if match_ID(pid,592) then
		if WAR.XTCJ == 1 then 
			local a = TrueYJ(pid)
			zshurt = zshurt + a
		end
		if WAR.PD['独孤剑势'][pid] ~= nil and WAR.PD['独孤剑势'][pid] > 0 then
			local dg = WAR.PD['独孤剑势'][pid]*0.1
			hurtzs1[#hurtzs1+1] = dg
		end
	end
	--独孤真破尽天下
	if match_ID(pid,592) and JXPD(pid,592,1) then
		local jl = math.modf((WAR.SPIRIT[pid] or 0)*0.5)
		if jl > 80 then 
			jl = 80
		end
		if JLSD(0,jl,pid) and WAR.PJTX1 == 0 then
			WAR.XTQKG = 1
			WAR.PJTX1 = 1
			for pj = 0, WAR.PersonNum-1 do
				local pjid = WAR.Person[pj]["人物编号"]
				if WAR.Person[pj]["死亡"] == false and pj ~= WAR.CurID then
					WAR.PD['破军'][pjid] = 3
					WAR.PD['神足护盾'][pjid] = nil
					WAR.PD['先天护盾'][pjid] = nil
					WAR.PD['九阳护盾'][pjid] = nil
					WAR.PD['阴阳二气'][pjid] = nil
					WAR.PD['先天太极'][pjid] = nil
					WAR.PD['倾国倾城'][pjid] = nil
					WAR.PD['怒涛剑气'][pjid] = nil
					WAR.PD['无形气墙'][pjid] = nil
					WAR.PD['奇门五转'][pjid] = nil
					WAR.PD['吸星真气'][pjid] = nil
					WAR.PD['葵花护盾'][pjid] = nil
					WAR.PD['长生真气'][pjid] = nil
					WAR.PD['神足乾坤'][pjid] = nil
					--WAR.PD['天魔金身'][pjid] = nil
					Cat('护盾停止',pj)
				end
			end
			local size = 60
			local x = CC.ScreenW/2;
			local y = CC.ScreenH/2;
			local offx = (#"【剑魔独孤・真・破尽天下】")*size/4
			local offy = size/2
			for k = 1,10 do
				Cat('实时特效动画')
				Cls()
				Cat('实时特效动画2')
				lib.Background(0,y-50,CC.ScreenW,y+50,98)
				DrawString(x-offx,y-offy,"【剑魔独孤・真・破尽天下】",C_GOLD,size);  
				ShowScreen();
				lib.Delay(CC.BattleDelay)
			end
		end	
	end
	--三渡金刚伏魔圈 1041
	if match_ID(pid,597) or match_ID(pid,598) or match_ID(pid,599) then
		local JLQX = 0
		local JLQX1 = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
				JLQX = JLQX + 1
			end
		end
		JLQX1 = JLQX * 800
		if JLQX1 > 0 then
			zshurt = zshurt + JLQX1
		end
	end
	--任飞燕
    if match_ID(pid,615) then
        zshurt = zshurt + math.modf(JY.Person[pid]["轻功"]/3)
    end
    --梁萧蓄力增加伤害
    if match_ID(pid,635) and WAR.LXXL > 0 then
        zshurt = zshurt + math.modf(WAR.LXXL/2)
    end
	--青莲剑歌636
	if WAR.QLJG  == 1 then
		local h = TrueYJ(pid)
		zshurt = zshurt + h
	end
	--鹿杖客
	if match_ID(eid,648) and JY.Person[pid]["性别"] > 0 then
		zshurt = zshurt + 666
		Set_Eff_Text(enemyid, "特效文字0", "峰吹起了从前",96)
	end
	--惊天一剑伤害 
	if match_ID(pid,652) and WAR.JTYJ[pid] ~= nil then
		zshurt = zshurt + 200
	end
	--噩梦暴怒技
	if (match_ID(pid,741) or match_ID(pid,742)) and BNJQ(pid) then
		if WAR.PD["封印"][eid] == nil then
			WAR.PD["封印"][eid] = 5
		end
		ztd(enemyid,"生命点数",-10000)
	end
	--万道森罗
	if match_ID(pid,747) and JLSD(20,50,pid) then
		WAR.PD["魔岭玫瑰"][eid] = 100
		Set_Eff_Text(enemyid, "特效文字1", "万道森罗・以念为刃・驾驭人心")
	end
	if WAR.WDSL == 1 then
		WAR.WS = 1 
		zshurt = zshurt + math.modf(JY.Person[pid]["内力"] * 0.03)
		ztd(enemyid,'生命点数', -math.modf(hurt))
	end
	if WAR.WDSL == 2 then
		WAR.WS = 1
		WAR.PD['封气绝脉'][eid] = 1
	end
	if WAR.WDSL == 3 then
		WAR.WS = 1
		WAR.PD['霸王破甲'][eid] = 18
	end
	if WAR.WDSL == 4 then
		WAR.WS = 1
		addbuff(eid,WAR.PD['力竭'],1,2)
	end
	if WAR.WDSL == 5 then
		WAR.WS = 1
		WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.modf(JY.Person[eid]["冰封程度"]/5)
		WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + math.modf(psx(eid,"冰封程度")*0.5)
	end
	if WAR.WDSL == 6 then
		WAR.WS = 1
		WAR.PD['举火燎原'][eid] = 20
		WAR.PD['无明业火'][eid] = 20
	end
	if WAR.WDSL == 7 then
		WAR.WS = 1
		WAR.PD['恐惧状态'][eid] = 1
	end
	if WAR.WDSL == 8 then
		WAR.WS = 1
		addbuff(eid,WAR.PD['禁疗'],5,10)
	end
	--施施
	if match_ID(pid,754) then
		if JY.Person[eid]["性别"] == 0 then 
			hurtzs1[#hurtzs1+1] = 0.3
		end
		zshurt = zshurt + dng/2
		zhanyi(eid,-10)
		nuqi(eid,-10) 
	end
	--南凤朱雀 
	if match_ID(pid,758) then
		if JLSD(20,50,pid) then
			WAR.PD['南凤朱雀'][eid] = limitX((WAR.PD['南凤朱雀'][eid] or 0) + 2,0,15) 
			Set_Eff_Text(enemyid, "特效文字3","南凤朱雀・火凤燎原")
		end
		if WAR.NFZQ > 0 then
			hurtzs1[#hurtzs1+1] = 2
			local a = JY.Person[eid]["灼烧程度"] * 7
			ztd(enemyid,WAR.ZSXS,100)
			ztd(enemyid,"生命点数",-a)	
			if WAR.NFZQ == 3 then 
				WAR.PD['无明业火'][eid] = 30
			end
			if WAR.NFZQ == 4 then
				local a = JY.Person[eid]["封穴程度"] * 4
				ztd(enemyid,WAR.FXXS,20)
				ztd(enemyid,"生命点数",-a)
			end
			if WAR.NFZQ == 5 then
				WAR.PD['封气绝脉'][eid] = 1	
				WAR.PD['举火燎原'][eid] = 20
				WAR.PD['创伤'][eid] = (WAR.PD['创伤'][eid] or 0) + 15
			end
			if WAR.NFZQ == 6 then
				local a = math.modf(TrueTS(pid) / 2)
				local b = math.modf(TrueTS(eid) / 2)
				zshurt = a + b 
				nuqi(pid,10)
				zhanyi(pid,10)
			end
			if WAR.NFZQ == 7 then
				local a = JY.Person[pid]["内力"] * 0.5
				ztd(enemyid,"生命点数",-a)
			end
		end
	end
	--枪神诀
	if match_ID(pid,760) and yongte(wugong) then
		if JLSD(20,50,pid) then
			WAR.PD['枪神诀2'][eid] = 30
			Set_Eff_Text(enemyid, "特效文字3","枪神诀・守神")
		end
		if JLSD(20,50,pid) then
			WAR.PD['枪神诀1'][eid] = 30
			Set_Eff_Text(enemyid, "特效文字2","枪神诀・追魂")
		end
		if JLSD(20,50,pid) then
			WAR.PD['枪神诀3'][eid] = 10
			Set_Eff_Text(enemyid, "特效文字1","枪神诀・夺命")
		end
	end
	--百里青霜
	if yongjian(wugong) and match_ID(pid,762) then
		local str = ""
		if JLSD(20,70,pid) then    
			str = "春雾迷蒙"
			local a = JY.Person[eid]["中毒程度"] * 4
			ztd(enemyid,"中毒点数",15)
			ztd(enemyid,"生命点数",-a)
		end	
		if JLSD(20,70,pid) then     
			str = "夏雨点点"
			local a = JY.Person[eid]["流血程度"] * 4
			ztd(enemyid,WAR.LXXS,15)
			ztd(enemyid,"生命点数",-a)
		end	
		if JLSD(20,70,pid) then     
			str = "秋风卷叶"
			local a = JY.Person[eid]["灼烧程度"] * 4
			ztd(enemyid,WAR.ZSXS,15)
			ztd(enemyid,"生命点数",-a)
		end	
		if JLSD(20,70,pid) then     
			str = "冬寒刺骨"
			local a = JY.Person[eid]["冰封程度"] * 4
			ztd(enemyid,WAR.BFXS,15)
			ztd(enemyid,"生命点数",-a)
		end	
		if JLSD(20,70,pid) then     
			str = "四季不休"
			local a = JY.Person[eid]["受伤程度"] * 4
			ztd(enemyid,"内伤点数",100)
			ztd(enemyid,"生命点数",-a)
		end	
		Set_Eff_Text(enemyid,"特效文字3", "四季剑法・"..str)
		if JLSD(20,55,pid) then  
			WAR.PD['青霜辟邪'][eid] = 25
			Set_Eff_Text(enemyid, "特效文字2", "青霜・剑气") 
		end
	end
    --擒龙降龙
	if WAR.XLSDL == 1 then
		ztd(enemyid,'生命点数',-math.modf(ang/3)) 
		ztd(enemyid,'集气位置',-250)
		WAR.PD["刚柔混劲"][eid] = 10	
		ztd(WAR.CurID,'内力点数',1250)  
		ztd(WAR.CurID,'体力点数',3)  
    end
	--一通万法
	if match_ID(pid,9738) and Atk(WAR.CurID) >= Def(enemyid) then
		hurtzs1[#hurtzs1+1] = 0.35
		if WAR.PD['雪羽战神'][pid] ~= nil then
			hurtzs1[#hurtzs1+1] = 0.35
		end	
	end
	if match_ID(pid,9741) and (wugong == 20 or wugong == 187) then
		zshurt = zshurt + 100
	end
	if match_ID(pid,9742) and wugong == 78 then
		zshurt = zshurt + 200
	end
	--初生牛犊
	if match_ID(pid,9743) then
		if JLSD(20,50,pid) then
			addbuff(eid,WAR.PD['创伤'],5)
		end
		if JLSD(20,50,pid) then
			WAR.BFX = 1
		end
	end
	--陈正德三分剑法
	if (match_ID(pid,311) or match_ID(pid,9753)) and wugong == 29 and WAR.ACT > 1 and WAR.ACT < 4 then
		hurtzs1[#hurtzs1+1] = -0.67
	end
	--剑荡十方
	if match_ID(pid,9772) and WAR.PD["剑荡十方"][pid] ~= nil then
		local jd = (WAR.PD["剑荡十方"][pid] or 0)/10
		if jd > 1 then
			jd = 1
		end
		hurtzs1[#hurtzs1+1] = jd
		if WAR.PD["剑荡十方"][pid] >= 10 then
			WAR.FQY = 1
			WAR.PD["剑荡十方"][pid] = nil
		end
	end
	--被杨逍击中的人，伤害增加1%，上限20%
	if match_ID(pid,9788) or match_ID(pid,11) then
		addbuff(eid,WAR.GMZS,1,50)
	end
	--萧玲	1041
	if match_ID(pid,574) or match_ID(pid,9783) then 
		local n = 0
		local n1 = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				n = n + 1
				if n > 6 then
					n = 6
					break
				end	
			end
		end
		hurtzs1[#hurtzs1+1] = n * 0.1
    end
	--殷离 强制上毒20 标记修改
	if match_ID(pid,646) or match_ID(pid,9790) then
		ztd(enemyid,"中毒点数",20)
	end
	--萧半和混元一气9795
	if WAR.HYYQ == 1 then  
		ztd(enemyid,"内伤点数",math.random(10,15))
		if WAR.PD["灵蛇拳"][eid] == nil then
			WAR.PD["灵蛇拳"][eid] = math.random(5,15)
		end
	end
	--元伤天怒红颜
    if match_ID(pid,656) or match_ID(pid,9796) then
		if JY.Person[eid]["性别"] ~= 1 then
			hurtzs1[#hurtzs1+1] = 0.2
		end
	end
	--元悲红粉骷髅
    if (match_ID(pid,655) or match_ID(pid,9797)) then
		if JY.Person[eid]["性别"] == 1 then
			hurtzs1[#hurtzs1+1] = 0.2
		end
	end
	--宝象增伤10%
    if match_ID(pid,595) or match_ID(pid,9809) then
		hurtzs1[#hurtzs1+1] = 0.1
	end
	--卓不凡，每行动一次，攻击时伤害一+1000%
    if match_ID(pid,565) or match_ID(pid,9810) then
        local ztb = WAR.ZBT * 0.01
        if ztb > 10 then
            ztb = 10
        end
        hurtzs1[#hurtzs1+1] = ztb
    end
	--归辛树，使用拳法攻击追加100点伤害，如未装备武器，则此加成翻倍
	if (match_ID(pid,186) or match_ID(pid,9811)) and JY.Wugong[wugong]["武功类型"] == 1 then
		zshurt = zshurt + 100
		if JY.Person[pid]["武器"] == -1 then
			zshurt = zshurt + 200
		end
	end
	--梅剑和，使用剑法攻击追加100点伤害，如装备武器，则此加成减半
    if (match_ID(pid,183) or match_ID(pid,9812)) and JY.Wugong[wugong]["武功类型"] == 3 then
        zshurt = zshurt + 100
        if JY.Person[pid]["武器"] == -1 then
            zshurt = zshurt + 200
        end
    end
	--唐文亮，七伤拳追加777点伤害9819
	if wugong == 23 and (match_ID(pid,8) or match_ID(pid,167) or match_ID(pid,168) or match_ID(pid,9819)) then
		zshurt = zshurt + 777
	end
	--白万剑
	if match_ID(pid, 43) or match_ID(pid,9823) then
		local bxbf = JY.Person[eid]["冰封程度"]
		zshurt = zshurt + bxbf
	end
	--程英，半血以下，攻击时伤害一*120%
    if (match_ID(pid, 63) or match_ID(pid, 9830)) and JY.Person[pid]["生命"] < math.modf(JY.Person[pid]["生命最大值"] / 2) then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--黑无常
    if match_ID(pid,155) or match_ID(pid,9835) then
		local hwc = math.random(25)*0.01
		hurtzs1[#hurtzs1+1] = hwc
	end
	--岳灵珊 每个剑法提高伤害一15% 1041
	if match_ID(pid,79) or match_ID(pid,9842) then
		local JF = 0
		local JF1 = 0
		for i = 1, JY.Base["武功数量"] do
			if JY.Wugong[JY.Person[pid]["武功" .. i]]["武功类型"] == 3 then
				JF = JF + 1
			end
		end
		if JF > 7 then 
			JF = 7
		end
		hurtzs1[#hurtzs1+1] = JF*0.15
	end
	--王重阳1 一气化三清，伤害增加30%倍	
    if (match_ID(pid,129) or match_ID(pid,9851)) and WAR.YQFSQ == 1 then
		hurtzs1[#hurtzs1+1] = 0.3
	end
	--周伯通，每行动一次，攻击时伤害一+10%，最大增加500%
    if match_ID(pid,64) or match_ID(pid,9855) then
        local ztb = WAR.ZBT * 0.1
        if ztb > 5 then
            ztb = 5
        end
        hurtzs1[#hurtzs1+1] = ztb
    end
	--被灵蛇拳击中9856
	if WAR.OYK == 1  then
		WAR.PD["灵蛇拳"][eid] = 15
	end
	--欧阳锋根据蛤蟆蓄力增加伤害
    if (match_ID(pid,60) or match_ID(pid,9857) or MPTX(pid,8)) and WAR.OYFXL > 0 then
        zshurt = zshurt + math.modf(WAR.OYFXL/2)
    end
	--郭靖的降龙十八掌，有余不尽9865
	if WAR.YYBJ > 9 then
		hurtzs1[#hurtzs1+1] = WAR.YYBJ/20
		ztd(enemyid,'生命点数',-math.modf(180*WAR.YYBJ))
	end
	--无崖子对男性攻击增伤20%
    if match_ID(pid,116) or match_ID(pid,9870) then
		if JY.Person[eid]["性别"] == 0 then
			hurtzs1[#hurtzs1+1] = 0.2
		end
	end
	--陈家洛对女性攻击伤害*80%
	if (match_ID(pid,75) or match_ID(pid,9896)) then
		if JY.Person[eid]["性别"] == 1 then
			hurtzs1[#hurtzs1+1] = -0.2
		end
	end
	--仁义无双增加伤害
	if (match_ID(pid,94) or match_ID(pid,9898)) and yongdao(wugong) then
		zshurt = zshurt + JY.Person[pid]["品德"]*2
	end
	--李沅芷 芙蓉金针
	if match_ID(pid,569) or match_ID(pid,9906) then
		local fr = math.modf(JY.Person[pid]["暗器技巧"]/2)
		zshurt = zshurt + fr
		ztd(enemyid,'生命点数',-fr)
	end
	--上官剑南血越少伤害越高
    if match_ID(pid,567) or match_ID(pid,9909) then
		if psxper(WAR.CurID,'生命',0.25,1) then
			hurtzs1[#hurtzs1+1] = 0.5
		end
		if psxper(WAR.CurID,'生命',0.5,1) then
			hurtzs1[#hurtzs1+1] = 0.25
		end
	end
	--佛山一霸
    if match_ID(pid,9916) then
		local ZS= math.modf(CC.Gold/10000)*0.2
		if ZS > 0.6 then
			ZS = 0.6
		end
		hurtzs1[#hurtzs1+1] = ZS
	end
	--汤沛 汤大侠 标记修改
	if match_ID(pid,9924) then
		local jl = 120-JY.Person[pid]["品德"]+5
		if jl > 100 then jl = 100 end
		if JLSD(0,jl,pid) then
			hurtzs1[#hurtzs1+1] = 0.3
		end
	end
	--金轮十龙十象
	if match_ID(pid,9931) then
		hurtzs1[#hurtzs1+1] = 0.5
        Set_Eff_Text(enemyid, "特效文字2", "龙象般若功.十龙十象",395)
    end
	--剑神天赋
	if match_ID(pid,9941) then
		local JF = 0
		local JF1 = 0
		for i = 1, JY.Base["武功数量"] do
			if JY.Wugong[JY.Person[pid]["武功" .. i]]["武功类型"] == 3 then
				JF = JF + 1
			end
		end
		if JF > 7 then 
			JF = 7
		end
		hurtzs1[#hurtzs1+1] = JF * 0.1
	end
	--浩然罡气 附加气攻/10的伤害9946
	if WAR.PD["浩然罡气"][pid] == 1 then
		if BNJQ(pid) then
			zshurt = zshurt + ang/10
		else
			zshurt = zshurt + ang/15
		end
	end
	--无妄无我 1041
    if match_ID(pid,9980) or match_ID(pid,650) then
		local WWWWG = JY.Base["天书数量"]
		local WWWWG1 = 0
		if WWWWG>15 then
			WWWWG=15
		end
		hurtzs1[#hurtzs1+1] = WWWWG*0.02
	end
	--九字真言
	if WAR.PD["列"][pid]~= nil and WAR.PD["列"][pid] == 1 then
        addbuff(eid,WAR.PD['麻痹状态'],3)
    end
	if WAR.PD["阵"][pid]~=nil and WAR.PD["阵"][pid]== 1 then
		ztd(enemyid,'内力点数',-200)
	end
	--诸法无我9984每行动一次，攻击时伤害一+10% 1041
	if WAR.PD["诸法无我"][pid] ~=nil and WAR.PD["诸法无我"][pid] > 0 then
		local jsww = 0
		jsww = WAR.PD["诸法无我"][pid] * 0.1
		hurtzs1[#hurtzs1+1] = jsww
	end
	--魔道天行
    if ZDGH(WAR.CurID,9991) then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--玄澄无量禅震追加内伤伤害9994
	if WAR.XC_WLCZ == 1 then
		local a = JY.Person[eid]["受伤程度"]
		zshurt = zshurt + JY.Person[eid]["受伤程度"] * 5
		ztd(enemyid,"生命点数",-a) 
		ztd(enemyid,"内伤点数",math.random(10,15)) 
	end
	--闪电惊鸿5% 1041
    if match_ID(pid,9996) then
		local JF = 0
		local JF1 = 0
		for i = 1,JY.Base["武功数量"] do
			if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 3 then
				JF = JF + 1
			end
		end
		if JF > 7 then 
			JF = 7
		end
		hurtzs1[#hurtzs1+1] = JF * 0.05
	end

	--山河破标主
	if WAR.SHPS == 1 then 	
		WAR.PD["山河破"][eid] = 15
	end
	--苍狼步
	if pid == 0 and JY.Base["标准"] > 0 and JY.Base["天书数量"] >= 4 then
        WAR.CLB = WAR.CLB + 1
		Set_Eff_Text(enemyid,"特效文字2", "苍狼疾行")
	end
	--拳系大招，攻击时伤害一*133.3%
	if WAR.LXZQ == 1 then
		hurtzs1[#hurtzs1+1] = 1/3
	end
	--天罡大招，伤害增加30%
	if WAR.JSTG == 1 then
		hurtzs1[#hurtzs1+1] = 1/3
	end
	--仁者善恶有报	
	if actor(pid,7) and JY.Person[pid]["品德"] >= 100 then
		local rz = JY.Person[pid]["品德"] / 100 - 1
		hurtzs1[#hurtzs1+1] = rz
		if WAR.SEYB == 1 and JY.Person[pid]["品德"] >= 120 then
			zshurt = zshurt + JY.Person[pid]["品德"] * 10
		end
	end
	--毒王根据中毒程度增伤
	if actor(pid,9) then	
		zshurt = zshurt + JY.Person[pid]["中毒程度"] * 6
		if JXPD(0,9,1) and JY.Person[eid]["中毒程度"] > 0 then
			local dw = JY.Person[eid]["中毒程度"] * 0.01
			hurtzs1[#hurtzs1+1] = dw
		end
	end
	--嫖主
	if actor(pid,10) and Curr_NG(pid,90) then 
		WAR.PD["灵蛇拳"][eid] = math.random(5,15)
	end
	if actor(pid,10) and JXPD(pid,10,1) then
		if JY.Person[eid]['性别'] == 0 then
			ztd(WAR.CurID,"生命点数",JY.Person[pid]['生命最大值']*0.05);	
		else
			ztd(WAR.CurID,"内力点数",JY.Person[pid]['内力最大值']*0.05);	
			ztd(WAR.CurID,"体力点数",5);
		end
	end
	--论剑打赢王重阳，增伤20%
    if pid == 0 and JY.Person[129]["论剑奖励"] == 1 then
        hurtzs1[#hurtzs1+1] = 0.2
		if WAR.PD['强制增伤'][eid] == nil then
			WAR.PD['强制增伤'][eid] = 1
		end
    end
	--不在队伍伤害提升
	if inteam(pid) == false then 
		local WGDJJLG = 0
		for i = 1, JY.Base["武功数量"] do
			if JY.Person[pid]["武功等级" .. i] == 999 then
				WGDJJLG = WGDJJLG + 1
			end
		end
		if WGDJJLG > 15 then 
			WGDJJLG = 15
		end
		local sz = {1,0.9,0.8,0.6,0.5,0.4,0.3,0.2}
		local jssz = sz[JY.Person[pid]['畅想分阶']+1]
		--zshurt = zshurt + 10*JY.Base["难度"]*WGDJJLG
		if JY.Base["难度"] == 4 then
			hurtzs1[#hurtzs1+1] = 0.3
		end
	end
	--极限挑战npc增伤害
	if JY.Person[456]["论剑奖励"] > 0 and inteam(pid) == false then
		local zm = math.modf(JY.Base["周目"]/2)
		zshurt = zshurt + JY.Base["周目"]
		ztd(enemyid,'生命点数',-zm)
	end
	--圣火三使 伤害提高
	if WAR.ZDDH == 14 and (pid == 173 or pid == 174 or pid == 175) then
		local shz = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
			shz = shz + 1
			end
		end
		if shz == 3 then
			hurtzs1[#hurtzs1+1] = 0.5
		end
	end
	--全真七子七星聚会，每行动一次，攻击时伤害一+10%
	if pid==68 or pid==123 or pid==124 or pid==125 or pid==126 or pid==127 or pid==128 then
		local s = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and (WAR.Person[j]["人物编号"] == 68 or WAR.Person[j]["人物编号"] == 123 or WAR.Person[j]["人物编号"] == 124 or WAR.Person[j]["人物编号"] ==125 or WAR.Person[j]["人物编号"] == 126 or WAR.Person[j]["人物编号"] == 127 or WAR.Person[j]["人物编号"] == 128) then
				s = s + 0.1
			end
		end
		local ztb = WAR.QXJH / 10
		if ztb > s then
			ztb = s
		end
		hurtzs1[#hurtzs1+1] = ztb
	end
	--武当七侠真武七截阵，每行动一次，攻击时伤害一+10%
	if pid==532 or pid==533 or pid==534 or pid==535 or pid==536 or pid==537 or pid==538 then
		local s = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and (WAR.Person[j]["人物编号"] == 532 or WAR.Person[j]["人物编号"] == 533 or WAR.Person[j]["人物编号"] == 534 or WAR.Person[j]["人物编号"] ==535 or WAR.Person[j]["人物编号"] == 536 or WAR.Person[j]["人物编号"] == 537 or WAR.Person[j]["人物编号"] == 538) then
				s = s + 0.1
			end
		end
		local ztb = WAR.ZWQJZ * 0.1
		if ztb > s then
			ztb = s
		end
		hurtzs1[#hurtzs1+1] = ztb
	end
	--打狗阵
    if (WAR.ZDDH == 344 or WAR.ZDDH == 84) and isteam(pid) == false then
		hurtzs1[#hurtzs1+1] = 0.3
	end
	--黄蓉奇门遁甲，红色增伤
	if WAR.Person[WAR.CurID]["我方"] == true and GetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"],6) == 2 then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	-----------------------------------------------------------------------
    ---------------------------内功命中敌人后加成---------------------------
	-----------------------------------------------------------------------
	--易水寒根据冰封程度增伤
	if Curr_NG(pid,43) then
		local h = JY.Person[eid]["冰封程度"]
		if JY.Person[eid]["冰封程度"] > 0 then
			zshurt = zshurt + h
		end
	end
	--罗汉伏魔提升伤害和杀气效果为：[(当前内力值/500)×(武功消耗内力/140)]%
	if PersonKF(pid,96) and (WAR.NGJL == 96 or Curr_NG(pid,108) or match_ID(pid,38) or (Curr_NG(pid,96) and WAR.NGJL > 0)) then
		local nlmod = JY.Person[pid]["内力"]/30000
		local wgmod = JY.Wugong[wugong]["消耗内力点数"]/1200
		local totalmod = nlmod + wgmod;
		--石破天效果提高1.1倍
		if match_ID(pid,38) or Curr_NG(pid,108) then
			totalmod = totalmod * 1.1;
		end
		if MPTX(pid,5) then
			totalmod = totalmod * 1.1;
		end
		if WAR.LHFM == 1 then
			zshurt = zshurt + math.modf((zshurt+100)*(WAR.SPIRIT[pid] or 0)*0.02)
			totalmod = totalmod * 1.5
		end	
		hurtzs1[#hurtzs1+1] = totalmod
	end
	--龙象\镇岳诀\血河神鉴增伤10%
	if Curr_NG(pid,103) or Curr_NG(pid,163) or (Curr_NG(pid,263) and JLSD(10,40,pid)) then
		hurtzs1[#hurtzs1+1] = 0.1
	end
	--九阳神功招式106
	if WAR.JYZS == 1 then
		addbuff(eid,WAR.PD["虚弱状态"],10,30)
	end
	if WAR.JYZS == 2 then
		addbuff(eid,WAR.PD["散功状态"],10,20)
	end
	if WAR.JYZS == 3 then
		WAR.CSHF[pid] = 20
	end
	--九阴增伤20%,阴内主运或者阴罡学会九阴后
	if Curr_NG(pid,107) and rwnlxz(pid,0) then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--九阴・九阴飞絮107
    if WAR.JYZJ_FXJ == 1 then
        zshurt = zshurt + 100
        if Curr_NG(pid,107) then 
            zshurt = zshurt + 100
        end
	end
	--金刚般若
	if (Curr_NG(pid,108) or match_ID(pid,149)) and JinGangBR(pid) and JLSD(20,40,pid) then
		addbuff(eid,WAR.PD['集气速度'],-math.random(5,8))
    end
	--玉女心经
	if Curr_NG(pid,154) and JY.Person[pid]['性别'] == 1 then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--神鲸歌180
	if WAR.JXG_SJG == 1 then
		WAR.PD["灵蛇拳"][eid] = math.random(5,15)
	end
	--九霄中华
	if NGQH(pid,184) then
		local yj = math.modf(TrueYJ(pid)/2)
		zshurt = zshurt + yj
		ztd(enemyid,"生命点数",-yj)
	end
	--神照龟息
	if NGQH(pid,94) then 
		hurtzs1[#hurtzs1+1] = 0.15
	end
	--武穆遗书199
	for i = 0, WAR.PersonNum - 1 do
		local sz=0
		local zid = WAR.Person[i]["人物编号"]
		if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] and PersonKF(zid, 199) then
			sz=math.modf(JY.Person[zid]["实战"]/25)/100
			hurtzs1[#hurtzs1+1] = sz
		end
	end
	--五毒真经，强制上毒20 根据敌方中毒追加伤害 标
	if PersonKF(pid,220) then
		ztd(enemyid,"中毒点数",20)
		if JY.Person[eid]["中毒程度"] > 0 then
			zshurt = zshurt + JY.Person[eid]["中毒程度"]
		end
	end
	--阴阳无极 阴阳磨
	if PersonKF(pid,221) then
		if Curr_NG(pid,221) then
			if rwnlxz(pid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				hurtzs1[#hurtzs1+1] = 0.3
				if JLSD(10,55,pid) then
					ztd(enemyid,'内力点数',-math.random(300,700))
					Set_Eff_Text(enemyid,1,'阴阳如磨')
				end
			else
				zshurt = zshurt + 500
				hurtzs1[#hurtzs1+1] = 0.3
				if JLSD(10,55,pid) then
					ztd(enemyid,'内力点数',-math.random(300,700))
					Set_Eff_Text(enemyid,1,'阴阳如磨')
				end
			end
		elseif JLSD(10,55,pid) then
			if rwnlxz(pid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				hurtzs1[#hurtzs1+1] = 0.2
			else
				zshurt = zshurt + 500
				hurtzs1[#hurtzs1+1] = 0.2
			end
		end		
	end
	--小周天功
	if PersonKF(pid,225) then
		if Curr_NG(pid,225) then
			hurtzs1[#hurtzs1+1] = 0.15
		else
			hurtzs1[#hurtzs1+1] = 0.05
		end
	end
	--神足经 标记修改
	if PersonKF(pid, 233) then
		local ZS = JY.Person[pid]["生命增长"]/50
		hurtzs1[#hurtzs1+1] = ZS
		if Curr_NG(pid,233) then
			local ZS = (WAR.YDBS*3 + 1)*JY.Person[pid]["生命增长"]
			zshurt = zshurt + ZS
		end
	end
	--武当九阳功增伤10%
	if PersonKF(pid,241) or MPTX(pid,4,2) then
		hurtzs1[#hurtzs1+1] = 0.1
	end
	--少林九阳功
	if Curr_NG(pid,243) or MPTX(pid,5,3) then
		zshurt = zshurt + dng/10
    end
	--真龙心法
	if (PersonKF(pid,281) and inteam(pid) and JY.ZLXF == 1) or match_ID(pid,524) or match_ID(pid,776) then
		WAR.WS = 1
		local lwjl = math.modf(((JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"]) / JY.Person[pid]["生命最大值"]) * 50)
		if JLSD(10,50 + lwjl,pid) then
			zshurt = zshurt + JY.Person[eid]["内力"]
			local sh = JY.Person[pid]["内力"]
			if WAR.SHJL[pid] ~= nil then
				sh = sh/4 + WAR.SHJL[pid]
			end	
			ztd(enemyid,'生命点数',-math.modf(sh))
			Set_Eff_Text(enemyid,"特效文字3", "【真龙破灭击】")
		end
	end
	--苍龙令攻击--一剑标记云梦苍龙
	--if PersonKF(pid,281) then
	if PersonKF(pid,282) then
		local a = math.random(1,3)
		local str = ""
		if a == 1 then
			str = "动如雷霆】"
			if WAR.ATNum < 6 then
				WAR.ATNum = WAR.ATNum + 1
			else
				if JLSD(10,35,pid) then
					WAR.ATNum = WAR.ATNum + 1
				end
			end	
		elseif a == 2 then
			str = "其疾如风】"
			WAR.PD['疾如风'][pid] = 1
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					WAR.Person[j].Time = WAR.Person[j].Time + 200
				end
				if WAR.Person[j].Time > 980 then
					WAR.Person[j].Time = 980
				end
			end
		elseif a == 3 then
			str = "侵略如火】"
			ztd(enemyid,'集气位置',-100)
			if (WAR.PD['极意攻击'][pid] or 0) < 7 then 
				WAR.PD['极意攻击'][pid] = 7
			end
		end
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx1 = (#"【苍龙心诀・")*size/4
		local offx2 = (#str)*size/4
		local offx = offx1 + offx2
		local offy = size/2
		for k = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.Background(0,y-50,CC.ScreenW,y+50,98)
			DrawString(x-offx,y-offy,"【苍龙心诀・"..str,C_GOLD,size);  
			ShowScreen();
			lib.Delay(CC.BattleDelay)
		end
	end
	--苍龙心法攻击--一剑标记云梦苍龙
	if (PersonKF(pid,282) and inteam(pid) and WAR.CLXF == 1) or match_ID(pid,754) then
	--if PersonKF(pid,282) or match_ID(pid,754) then
		local a = math.random(1,3)
		local str = ""
		if a == 1 then
			str = "动如雷霆】"
			if WAR.ATNum < 3 then
				WAR.ATNum = 3
			else
			if WAR.ATNum < 6 then
					WAR.ATNum = WAR.ATNum + 1
				else
					if JLSD(10,35,pid) then
						WAR.ATNum = WAR.ATNum + 1
					end
				end	
			end
		elseif a == 2 then
			str = "其疾如风】"
			WAR.PD['疾如风'][pid] = (WAR.PD['疾如风'][pid] or 0) + 1
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					WAR.Person[j].Time = WAR.Person[j].Time + 300
				end
				if WAR.Person[j].Time > 980 then
					WAR.Person[j].Time = 980
				end
			end
		elseif a == 3 then
			str = "侵略如火】"
			WAR.PD['必杀气'][pid] = 1
			WAR.PD['封气绝脉'][eid] = 1
			WAR.PD['残劲袭魄'][eid] = 1
			WAR.PD['败血破命'][eid] = 1
			WAR.PD['火毒攻心'][eid] = 1
			WAR.PD['寒毒入体'][eid] = 1
			WAR.PD['五蕴炽盛'][eid] = 1
		end
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx1 = (#"【苍龙心法・")*size/4
		local offx2 = (#str)*size/4
		local offx = offx1 + offx2
		local offy = size/2
		for k = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.Background(0,y-50,CC.ScreenW,y+50,98)
			DrawString(x-offx,y-offy,"【苍龙心法・"..str,C_GOLD,size);  
			ShowScreen();
			lib.Delay(CC.BattleDelay)
		end
	end
	--鲸息九阴
	if NGQH(pid,180) then
		local a = math.random(1,4)
		local str = ""
		if a == 1 then
			str = "泽】"
			if WAR.ATNum < 4 then
				WAR.ATNum = 4
			end
		elseif a == 2 then
			str = "火】"
			local a = JY.Person[pid]["内力"]
			zshurt = zshurt + a 
			ztd(enemyid,WAR.ZSXS,100)
			WAR.PD["阳气侵蚀"][eid] = 20
		elseif a == 3 then
			str = "水】"
			local a = JY.Person[eid]["内力"]
			zshurt = zshurt + a 
			ztd(enemyid,WAR.BFXS,100)
			WAR.PD["阴气污染"][eid] = 20
		elseif a == 4 then
		    str = "雷】"	
			WAR.PD['败血破命'][eid] = 1
			WAR.PD['业力引爆'][pid] = 30
			WAR.PD['逆转经脉'][eid] = 1
		end 
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx1 = (#"【周流八劲・")*size/4
		local offx2 = (#str)*size/4
		local offx = offx1 + offx2
		local offy = size/2
		for k = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.Background(0,y-50,CC.ScreenW,y+50,98)
			DrawString(x-offx,y-offy,"【周流八劲・"..str,M_DeepSkyBlue,size);  
			ShowScreen();
			lib.Delay(CC.BattleDelay)
		end
	end
	--隼龙令
	if PersonKF(pid,282) and JLSD(20,55,pid) then
		WAR.SLB = WAR.SLB + 5
		Set_Eff_Text(enemyid,"特效文字2", "隼龙诀・瞬步")
	end	
	--天南易阳诀
	if Curr_NG(pid,314) then
		local h = JY.Person[eid]["灼烧程度"] * 2
		if JY.Person[eid]["灼烧程度"] > 0 then
			zshurt = zshurt + h
		end
		if yongzhi(wugong) and JLSD(10,40,pid) then
			WAR.PD["阳气侵蚀"][eid] = limitX((WAR.PD['阳气侵蚀'][eid] or 0) + 10,0,30)
		end
	end
	--玄武真功
	if Curr_NG(pid,315) or match_ID(pid,520) then
		hurtzs1[#hurtzs1+1] = 0.5
		if JLSD(25,70,pid) then
			if yongquan(wugong) then
				zshurt = zshurt + TrueQZ(pid)
			elseif yongzhi(wugong) then
				zshurt = zshurt + TrueZF(pid)
			elseif yongjian(wugong) then
				zshurt = zshurt + TrueYJ(pid)
			elseif yongdao(wugong) then
				zshurt = zshurt + TrueSD(pid)
			elseif yongte(wugong) then
				zshurt = zshurt + TrueTS(pid)
			end
		end
	end
	--玄武真功
	if WAR.SFJZ == 1 then
		local a = (JY.Person[pid]["内力"] + JY.Person[pid]["内力最大值"])/4
		local b =  math.modf(Xishu_max(pid)/4)
		zshurt = zshurt + a
		ztd(enemyid,'生命点数', -b)
	end
	--中华傲诀
	if NGQH(pid,359) or match_ID(pid,750) then
		if WAR.ZHAJ == 1 then
			WAR.PD['东方浩然'][eid] = 30
		elseif WAR.ZHAJ == 2 then 
			WAR.PD['龙跨千山'][pid] = 1
		elseif WAR.ZHAJ == 3 then
			WAR.PD['虎啸神州'][eid] = 30
		elseif WAR.ZHAJ == 4 then
			WAR.PD['剑气长江'][eid] = 30
			for i = 0,WAR.PersonNum -1 do
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[enemyid]["我方"] then
					local e = WAR.Person[i]["人物编号"]
					local x1,y1 = WAR.Person[enemyid]["坐标X"],WAR.Person[enemyid]["坐标Y"]
					local x2,y2 = WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"]
					if math.abs(x1-x2) + math.abs(y1-y2) == 30 then
						local a = TrueQZ(pid)
						local b = TrueYJ(pid)
						local c = a + b
						ztd(i,'生命点数',-c)
					end		
				end
			end
		 elseif WAR.ZHAJ == 5 then
			local a = TrueQZ(pid)
			local b = TrueYJ(pid)
			local c = a + b
			ztd(enemyid,'生命点数',-c)
			WAR.PD["剑傲中华"][eid] = 30
			if JY.Person[eid]["生命"] <= 1000 then
				JY.Person[eid]["生命"] = 0
				WAR.Person[enemyid]["死亡"] = true		
			end
		end
	end
	--剑芒
	if PersonKF(pid,356) and yongjian(wugong) then
		zshurt = zshurt + math.modf(JY.Person[pid]["内力"]/10)
		if Curr_NG(pid,356) then
			zshurt = zshurt + math.modf(JY.Person[pid]["内力"]/10)
		end		
	end 
	--极阴无相功
	if Curr_NG(pid,367) and wgnlxz(wugong) == 0 then
		zshurt = zshurt + 500
		local str = ""
		local a = math.random(1,8)
		if a == 1 then
			WAR.PD['残劲袭魄'][eid] = 1
			str = "・乾"
		elseif a == 2 then	
			WAR.PD['败血破命'][eid] = 1
			str = "・坤"
		elseif a == 3 then	
			WAR.PD['火毒攻心'][eid] = 1
			str = "・震"	
		elseif a == 4 then	
			WAR.PD['寒毒入体'][eid] = 1
			str = "・巽"	
		elseif a == 5 then	
			WAR.PD['五蕴炽盛'][eid] = 1
			str = "・坎"	
		elseif a == 6 then	
			WAR.PD['封气绝脉'][eid] = 1
			str = "・离"	
		elseif a == 7 then	
			WAR.PD["盲目状态"][eid] = 2
			str = "・艮"	
		elseif a == 8 then	
			WAR.PD['参合状态'][eid] = math.random(3)
			str = "・兑"								
		end
		Set_Eff_Text(enemyid, "特效文字1","极阴无相・阴狠难防")	
	end
	if Curr_NG(pid,367) and rwnlxz(pid,0) then
		if psx(eid,'内力性质') ~= 1 then
			WAR.PD['极阴无相5'][eid] = 3
		end
	end
	-----------------------------------------------------------------------
    ---------------------------内功被动组合命中敌人后加成------------------------
	-----------------------------------------------------------------------
	--化功五毒
	if NGQHB(pid,87) then
		local a = JY.Person[eid]["中毒程度"]
		local b = JY.Person[pid]["中毒程度"]
		ztd(WAR.CurID,'生命点数',a)
		ztd(WAR.CurID,'内力点数',b)
		ztd(enemyid,'生命点数',-a)
		ztd(enemyid,'内力点数',-b)
		if WAR.BMXH == 3 then
			WAR.LHFSD = 1
			Set_Eff_Text(enemyid, "特效文字1", "化功秘录・万毒缠身")
		end
	end
	--纯阳混元，纯阳天内
	if (NGQHB(pid,99) and Given_NG(pid,99)) and JLSD(0,40,pid) then
        CurIDTXDH(WAR.CurID, 200,1,"气血转换", C_ORANGE)
        local nlDam = JY.Wugong[wugong]["消耗内力点数"]*math.random(2,9)
		ztd(WAR.CurID,"生命点数", nlDam)
    end
	--纯阳混元，混元天内体力
	if (NGQHB(pid,99) and (Given_NG(pid,90) or Given_NG(pid,375))) or match_ID(pid,524) or JXPD(pid,189,1) then
		local tl = (JY.Person[pid]['体力']-JY.Person[eid]['体力'])/100
		if tl > 0 then
		    hurtzs1[#hurtzs1+1] = tl
		end
	end
	--九阳乾坤
	if NGQHB(pid,106) or match_ID(pid, 9992) then
		local wgwl = get_skill_power(pid,wugong,11)/3
		zshurt = zshurt + wgwl
		if JLSD(10,50,pid) then
			zshurt = zshurt + JY.Person[eid]["灼烧程度"]*3
			WAR.PD["阳气侵蚀"][eid] = limitX((WAR.PD['阳气侵蚀'][eid] or 0)+9,0,20)
			Set_Eff_Text(enemyid, "特效文字0","至阳焚心")
		end	
	end
	--庄子天魔
	if NGQHB(pid,160) then 
		if BNJQ(pid) then
			addbuff(eid,WAR.PD['生命恢复停止'],5,5)
		end
	end
	--龟息周天,40%几率根据敌我防御力之和的10%附加伤害
	if NGQHB(pid,190) and JLSD(10,50,pid) then
		local a = JY.Person[pid]["防御力"]
		local b = JY.Person[eid]["攻击力"]
		local c = (a+b)*0.1
		zshurt = zshurt + c
		Set_Eff_Text(enemyid, "特效文字0","蓄势待发・以守为攻")
	end
	--枯禅冰火
	if NGQHB(pid,207) then
		local a = math.modf(JY.Person[pid]["内力最大值"]/20)
		zshurt = zshurt + a
		if JLSD(10,40,pid) then
			ztd(enemyid,WAR.FXXS,math.random(3,7))
			if WAR.PD['举火燎原'][eid] == nil then
				WAR.PD['举火燎原'][eid] = 10
			end
			Set_Eff_Text(enemyid, "特效文字2","枯禅真诀・气锁周天")
		end
	end
	--寒冰紫霞
	if NGQHB(pid,216) then
		local a = JY.Person[pid]["内力"]/20 
		local b = JY.Person[eid]["冰封程度"]
		ztd(enemyid,WAR.BFXS,8)
		zshurt = zshurt + a + b
		if JLSD(20,50,pid) then
			WAR.LiRen = 1
			Set_Eff_Text(enemyid, "特效文字1", "寒冰真气・霜冻长河")
		end
		if JLSD(20,50,pid) then
			addbuff(eid,WAR.PD['冰冻状态'],math.random(3,5))
			addbuff(eid,WAR.PD['冰冻扣血'],3)
			WAR.PD['集气速度'][eid] = (WAR.PD['集气速度'][eid] or 0) - math.random(3,5)
			Set_Eff_Text(enemyid, "特效文字3", "寒冰真气・如履薄冰")
		end
		if JLSD(20,50,pid) then	
			if WAR.PD['灵蛇拳'][eid] == nil then
				WAR.PD['灵蛇拳'][eid] = 10
			end
			Set_Eff_Text(enemyid, "特效文字2", "寒冰真气・冰散瓦解")
		end
	end 
	--怒涛武穆
	if NGQHB(pid,252) then
		zshurt = zshurt + math.abs(WAR.Person[enemyid].Time)
		if WAR.Person[enemyid].Time <= -100 then
			WAR.PD['麻痹状态'][eid] = 10
			if WAR.PD['感电状态'][eid] == nil then
				WAR.PD['感电状态'][eid] = 1
			end
			Set_Eff_Text(enemyid, "特效文字1", "兵势攻奇")
		end
	end
	-----------------------------------------------------------------------
    ---------------------------内功主运组合命中敌人后加成------------------------
	-----------------------------------------------------------------------
	--圣火乾坤
	if NGQH(pid,93) then
		zshurt = zshurt + (JY.Person[eid]["灼烧程度"]+JY.Person[pid]["灼烧程度"])*5
		if JLSD(20,50,pid) then
			if MPTX(pid,13,2) then
				WAR.PD["光明圣火"][eid] = (WAR.PD["光明圣火"][eid] or 0) + math.random(15,30)
			else
				WAR.PD["光明圣火"][eid] = (WAR.PD["光明圣火"][eid] or 0) + 10
			end
			Set_Eff_Text(enemyid, "特效文字1", "光明普遍皆清净・常乐寂灭无动诅")
		end
		if JLSD(20,50,pid) then
			if JY.Person[eid]["灼烧程度"] >= 20 then
				if MPTX(pid,13,3) then 
					ztd(enemyid,"生命点数",-500)
					addbuff(eid,WAR.PD["明教指令4"],1,10)
				else
					ztd(enemyid,"生命点数",-300)
				end
			end 	
			Set_Eff_Text(enemyid, "特效文字2", "彼受欢乐无烦恼・若言有苦无是处")	
		end
		if JLSD(20,50,pid) then
			if JY.Person[eid]["灼烧程度"] >= 40 then
				addbuff(eid,WAR.PD['灵蛇拳'],10,15)
			end 	
			Set_Eff_Text(enemyid, "特效文字3", "如有得住彼国者・究竟普会无忧愁")	
		end
	end
	--蛤蟆逆运
	if NGQH(pid,95) then
		hurtzs1[#hurtzs1+1] = 0.25
		zshurt = zshurt + math.modf((WAR.HMJT[pid] or 0)/10)
	    if (WAR.HMJT[pid] or 0) < 100 then 
			WAR.HMJT[pid] = 100
		end	
	end
	--罗汉狮吼
	if NGQH(pid,96) then
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["灼烧程度"]*3
			ztd(enemyid,WAR.ZSXS,100) 
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid, "特效文字3","罗汉狂狮・不染于物欲")
		end
		if JLSD(20,50,pid) then
			WAR.PD['伏魔逆气'][eid] = 10 
			Set_Eff_Text(enemyid, "特效文字2","罗汉狂狮・伏魔逆气")
		end
	end
	--纯阳太极
	if NGQH(pid,99) then
		hurtzs1[#hurtzs1+1] = 0.5
	end
	--先天神照
	if NGQH(pid,100) then
		zshurt = zshurt + math.modf(ang/10)
		if psxper(WAR.CurID,'生命',0.5,1) then
		    hurtzs1[#hurtzs1+1] = 0.5
		end
		local a = math.random(1,3)
		if a == 1 then
			WAR.PD['先天真气1'][pid] = 1
			ztd(WAR.CurID,'中毒点数',-100)
			Set_Eff_Text(enemyid, "特效文字2", "气走先天・贯通日月")
		elseif a == 2 then
			WAR.PD['先天真气2'][eid] = 10
			Set_Eff_Text(enemyid, "特效文字2", "气足开关・八脉俱通")
		elseif a == 3 then
			WAR.PD['先天真气3'][pid] = 10
			Set_Eff_Text(enemyid, "特效文字2", "凝神气穴・心息相依")
		end
	end 	
	--先天神照
	if WAR.XTZQ[pid] ~= nil and WAR.XTZQ[pid] > 0 then
		local xt = WAR.XTZQ[pid] or 0 
		zshurt = zshurt + 777
		ztd(enemyid,'内伤点数',7*xt)
		ztd(WAR.CurID,'生命点数',77*xt)
	end
	--八荒北冥
	if NGQH(pid,101) then
		local xnl = math.modf(JY.Person[pid]["内力"]/math.random(8,28))
		local a = math.modf(dng/8)
		ztd(enemyid,"生命点数", -math.modf(xnl/2+50))
		zshurt = zshurt + a
	end
	--太玄乾坤
	if NGQH(pid,102) then 
		if wgtype == 1 then
			WAR.PD['残劲袭魄'][eid] = 1
		elseif wgtype == 2 then
			WAR.PD['火毒攻心'][eid] = 1
		elseif wgtype == 3 then
			WAR.PD['败血破命'][eid] = 1
		elseif wgtype == 4 then
			WAR.PD['寒毒入体'][eid] = 1
		elseif wgtype == 5 then
			WAR.PD['五蕴炽盛'][eid] = 1
		else
			WAR.PD['封气绝脉'][eid] = 1
		end	
	end
	--太玄乾坤
	if NGQH(pid,102) then
		zshurt = zshurt + Xishu_max(pid)
		if inteam(pid) then
			zshurt = zshurt + Sanwei_sum(pid)
		else
			zshurt = zshurt + Sanwei_sum(pid)/2
		end
	end	
	if WAR.PD["太玄组合攻击1"][pid] ~= nil or WAR.PD["太玄组合攻击5"][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = math.modf(JY.Person[pid]["内力"]/200)
	end
	if WAR.PD["太玄组合攻击4"][pid] ~= nil or WAR.PD["太玄组合攻击5"][pid] ~= nil then
		zshurt = zshurt + JY.Person[pid]["实战"]*3
		if JLSD(10,60,pid) then
			if math.random(10) > 5 then
				WAR.PD['回魂仙梦'][eid] = 15
			else
				WAR.PD['利刃寒锋'][eid] = 15
			end
		end	
	end
	--龙象神足
	if NGQH(pid,103) and WAR.LXBL > 0 then
		local lxl = math.modf(Atk(WAR.CurID)*WAR.LXBL/math.random(10,30))
		zshurt = zshurt + lxl
	end
	--龙象神足
	if NGQH(pid,103) and WAR.LXJQ == 1 and DWPD(WAR.CurID,enemyid) then
		WAR.LXQJ[100 + eid] = 1	
		if WAR.LXQJ[200 + eid] == nil then
			WAR.LXQJ[200 + eid] = 0
		end
	end
	--龙象神足
	if NGQH(pid,103) and WAR.ACT == 1 then	
		for j = 0, WAR.PersonNum - 1 do
			local tmppid = WAR.Person[j]["人物编号"]
			if dead(j) == false and DWPD(WAR.CurID,j) then
				local a = 0
				if WAR.LWZN[tmppid] ~= nil and WAR.LWZN[tmppid] > 0 then 
					a = WAR.LWZN[tmppid]
					ztd(j,'生命点数',-math.modf(100*(1+a*0.1)))
					ztd(j,'内力点数',-math.modf(100*(1+a*0.1)))
					WAR.Person[j]["特效文字3"] = "龙王之怒・破灭"
					WAR.Person[j]["特效动画"] = 396
				end
			end
		end
	end
	--逆运蛤蟆
	if (NGQH(pid,104) or JLSD(10,40,pid)) and WAR.L_NYZH[pid] ~= nil then
		hurtzs1[#hurtzs1+1] = 0.5
	end
	--葵花紫霞
	if NGQH(pid,105) then
		zshurt = zshurt + math.modf(TrueYJ(pid)/2)
		if match_ID(pid,27) or match_ID(pid,92) or match_ID(pid,777) then
			zshurt = zshurt + math.modf(JY.Person[pid]["暗器技巧"]/2)
		end	
	end
	--九阳怒涛
	if NGQH(pid,106) then  
		local YNWG = {}
		local ynwg = 0
		for i = 0, JY.ThingNum - 1 do
			if JY.Thing[i]["需内力性质"] == 1 then
				ynwg = ynwg + 1
				YNWG[ynwg] = JY.Thing[i]["练出武功"]
			end
		end
		for i = 1, #YNWG do
			if wugong == YNWG[i] then 
				hurtzs1[#hurtzs1+1] = 0.4
			end
		end
	end
	--九阴太极
    if NGQH(pid,107) then
        local YNWG = {}
	    local ynwg = 0
		for i = 0, JY.ThingNum - 1 do
		    if JY.Thing[i]["需内力性质"] == 0 then
				ynwg = ynwg + 1
			    YNWG[ynwg] = JY.Thing[i]["练出武功"]
		    end
	    end
	    for i = 1, #YNWG do
            if wugong == YNWG[i] then 
	            hurtzs1[#hurtzs1+1] = 0.4
	        end  
        end	
	end
	--九阴摄魂
	if Curr_NG(pid,107) or match_ID(pid,637) then
		if WAR.JYSS == 1 then
			WAR.PD['九阴摄魂'][eid] = 1
		end
	end
	--九阴太极
	if NGQH(pid,107) and DWPD(WAR.CurID,enemyid) then
		zshurt = zshurt + math.modf(JY.Person[pid]["内力最大值"]/math.random(10,15))
		if WAR.JYZQ[pid] ~= nil and WAR.JYZQ[pid] > 0 then
			local aa = math.modf(JY.Person[eid]["生命最大值"]*0.05)
			ztd(enemyid,"生命点数",-aa)
		end
		if WAR.FXHJ1 == 1 then
			ztd(enemyid,'内力点数',-500)
			ztd(enemyid,'体力点数',-5)
		end
		if WAR.FXHJ2 == 1 then
			ztd(enemyid,WAR.FXXS,math.random(3,5))
		end
		if WAR.FXHJ3 == 1 then
			WAR.PD["昏迷状态"][eid] = 1
			ztd(enemyid,'生命点数',-500)
		end
		if WAR.FXHJ4 == 1 then
			WAR.PD["侵如火"][pid] = 1
			zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]/10)
		end
		if WAR.ZBT3 > 0 then
			local a = TrueQZ(pid)
			local b = WAR.ZBT3 or 0
			if b < 1 then
				b = 1
			end
			zshurt = zshurt + math.modf(a*b/6)
			ztd(enemyid,"内伤点数",math.random(20,35)*b)
		end
	end
	--易筋组合
	if (NGQH(pid,108) or (match_ID(pid,114) and Curr_NG(pid,108))) then
		zshurt = zshurt + math.modf(ang/3)
		if JLSD(10,40,pid) then
			zshurt = zshurt + math.modf(ang/3)
			if WAR.NGJL == 108 then
				zshurt = zshurt + 800
				WAR.PD['虚弱状态'][eid] = limitX((WAR.PD['虚弱状态'][eid] or 0) + 10,0,50)
				WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0) + 10,0,50)
			end	
			Set_Eff_Text(enemyid,2,"易筋神髓・锭光真谛")
		end	
	end
	--天魔易筋
	if NGQH(pid,160) then
		local aa = JY.Person[pid]["品德"]
		local zz = 1.5 - math.abs(JY.Person[pid]["资质"]-50)/40
		zshurt = zshurt + math.modf(((120-aa)/30)*JY.Person[pid]["内力"]*zz)
		if WAR.PD["伤害储存"][pid] ~= nil and WAR.PD["伤害储存"][pid] > 0 then
			ztd(enemyid,'生命点数',-WAR.PD["伤害储存"][pid])
			WAR.PD["伤害储存"][pid] = nil
		end	
		if JLSD(10,50,pid) then
			if MPTX(eid,5) and JY.Person[eid]["生命"] < 2000 and WAR.PD['度化状态'][eid] == nil then
				WAR.PD['度化状态'][eid] = 6
			end
		end	
		if yongzhi(wugong) then
			zshurt = zshurt + TrueZF(pid)
			hurtzs1[#hurtzs1+1] = 0.5
			if BNJQ(pid) then
				hurtzs1[#hurtzs1+1] = 1
			end
			if ZYJQ(pid) then
				hurtzs1[#hurtzs1+1] = 1
			end
			if WAR.PD['金刚护盾'][eid] ~= nil and (BNJQ(pid) or JLSD(10,50,pid)) then
				local bb = WAR.PD['金刚护盾'][eid]
				ztd(enemyid,'生命点数',-math.modf(bb*1.5))
				WAR.PD['金刚护盾'][eid] = nil
				Cat('护盾停止',enemyid)
			end	
			if BNJQ(pid) then
				WAR.PD['神足护盾'][eid] = nil
				WAR.PD['先天护盾'][eid] = nil
				WAR.PD['九阳护盾'][eid] = nil
				WAR.PD['阴阳二气'][eid] = nil
				WAR.PD['先天太极'][eid] = nil
				WAR.PD['倾国倾城'][eid] = nil
				WAR.PD['怒涛剑气'][eid] = nil
				WAR.PD['无形气墙'][eid] = nil
				WAR.PD['奇门五转'][eid] = nil
				WAR.PD['吸星真气'][eid] = nil
				WAR.PD['葵花护盾'][eid] = nil
				WAR.PD['长生真气'][eid] = nil
				WAR.PD['神足乾坤'][eid] = nil
				Cat('护盾停止',enemyid)
				--WAR.Person[enemyid]['护盾'] = -1
				Set_Eff_Text(enemyid,0,"七旋・锋指破盾")
			end	
		end
		if yongdao(wugong) then
			local aa = math.modf(JY.Person[eid]["品德"] - JY.Person[pid]["品德"])
			if aa <= 10 then aa = 10 end
			hurtzs1[#hurtzs1+1] = aa/20
			zshurt = zshurt + math.modf(TrueSD(pid)*aa/20)
			local bb = (WAR.LQZ[pid] or 0) + (WAR.SPIRIT[pid] or 0)
			ztd(enemyid,"生命点数",-bb)
			WAR.PD["创伤"][eid] = limitX((WAR.PD["创伤"][eid] or 0) + math.modf((bb/10)+3),0,50)
		end	
	end
	--太极纯阳
	if NGQH(pid,171) then
		if BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 1
		else
			hurtzs1[#hurtzs1+1] = 0.5
		end		
		zshurt = zshurt + math.modf(ang/2)
		if WAR.TJSG[pid] ~= nil and WAR.TJSG[pid] > 0 then
			local tj =  math.modf((WAR.TJSG[pid] or 0)/3)
			zshurt = zshurt + tj
		end
	end
	--太极纯阳
	if WAR.PD['太极奥义・厚积薄发'][pid] == 1 then
		WAR.PD['侵如火'][pid] = 1
		hurtzs1[#hurtzs1+1] = (WAR.LQZ[pid] or 0)/30
		ang = ang + 1500 + math.modf((WAR.LQZ[pid] or 0)*30)
		if WAR.TJJSJS[pid] ~= nil and WAR.TJJSJS[pid] > 0 then
			ztd(enemyid,"生命点数",-WAR.TJJSJS[pid])
			WAR.TJJSJS[pid] = nil
		end
	end
	--忘情天书
	if NGQH(pid,177) or match_ID(pid,652) then
		if JLSD(20,50,pid) then
			WAR.PD['忘情我无'][eid] = 30
			Set_Eff_Text(enemyid,3,"忘情天书・我无")
		end
		if JLSD(20,50,pid) then
			WAR.PD['忘情风流'][eid] = 30
			Set_Eff_Text(enemyid,2,"忘情天书・风流")
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["受伤程度"]
			local b = JY.Person[eid]["流血程度"]
			local c = JY.Person[eid]["冰封程度"]
			local d = JY.Person[eid]["灼烧程度"]
			local e = JY.Person[eid]["中毒程度"]
			local f = JY.Person[eid]["封穴程度"]
			local g = a + b + c + d + e + f
			WAR.PD['忘情云翳'][eid] = 30
			ztd(enemyid,"生命点数",-g)
			Set_Eff_Text(enemyid,2,"忘情天书・云翳")
		end
	end
	--长春北冥
	if NGQH(pid,183) then
		zshurt = zshurt + math.modf(dng/6)
		ztd(enemyid,'内力点数',-500)
		if JLSD(20,50,pid) then
			WAR.PD["恐惧状态"][eid] = 1	
			if WAR.PD["回魂仙梦"][eid] == nil then
				WAR.PD["回魂仙梦"][eid] = 10
			end
			Set_Eff_Text(enemyid,2,"不老长春・气破万千")
		end
	end
	--周天吸星
	if NGQH(pid,190) then
		local str = ""
		if (WAR.LQZ[pid] or 0) < 100 then
			if math.random(10) > 5 then
				WAR.PD['冰冻状态'][eid] = limitX((WAR.PD['冰冻状态'][eid] or 0) + 10,0,50)
				WAR.PD['必冰封'][pid] = 1	
				str = "太阴星力・寒冥碎命"
			else
				WAR.PD['必灼烧'][pid] = 1
				WAR.PD['火毒攻心'][eid] = 1
				str = "太阳星力・荥落焚魂"
			end	
		else
			WAR.PD['冰冻状态'][eid] = limitX((WAR.PD['冰冻状态'][eid] or 0) + 10,0,50)
			WAR.PD['寒毒入体'][eid] = 1
			if JLSD(10,35,pid) then
				WAR.JuHuo = 1
				WAR.PD['利刃寒锋'][eid] = limitX((WAR.PD['利刃寒锋'][eid] or 0)+15,0,50)
			end
			str = "太上阴阳・双星灭魄"
		end
		Set_Eff_Text(enemyid,3,str)
	end	
	if NGQH(pid,190) and (WAR.PD['三垣'][pid] or 0) > 60 and (WAR.PD['三垣'][pid] or 0) < 91 then
		ztd(enemyid,"内伤点数",15)
		WAR.PD['散功状态'][eid] = limitX((WAR.PD['散功状态'][eid] or 0) + 10,0,30)
	end
	if NGQH(pid,190) and (WAR.PD['三垣'][pid] or 0) > 30 and (WAR.PD['三垣'][pid] or 0) < 61 then
		local a = 0
		for j = 1, JY.Base['武功数量'] do 
			local wgid = JY.Person[pid]["武功"..j]
			if JY.Wugong[wgid]["武功类型"] == WGLX then
				a = a + JY.Wugong[wgid]["攻击力10"]
			end
		end
		zshurt = zshurt + math.modf(a*0.1)	
	end	
	--长生组合
	if NGQH(pid,203) or ((match_ID(pid,505) or match_ID(pid,578)) and Curr_NG(pid,203)) then
		zshurt = zshurt + math.modf(psx(pid,'生命')*math.random(5,8)*0.1)
		if WAR.PD['长生蓄力'][pid] ~= nil then
			zshurt = zshurt + WAR.PD['长生蓄力'][pid]
			if WAR.PD['长生蓄力'][pid] > 1500 and JLSD(0,50,pid) then
				local aa = WAR.PD['长生蓄力'][pid] - 1500
				ztd(enemyid,'生命点数',-aa)
			end
		end
		if (WAR.PD['复活・长生'][pid] or 0) > 0  then
			if JLSD(10,45,pid) then
				hurtzs1[#hurtzs1+1] = WAR.PD['复活・长生'][pid]+1
			else
				hurtzs1[#hurtzs1+1] = 1
			end
		end
	end
	--擒龙罗汉
	if NGQH(pid,204) then
		hurtzs1[#hurtzs1+1] = 0.5
		if WAR.SLCS1[pid] ~= nil and WAR.SLCS1[pid] > 0 then
			hurtzs1[#hurtzs1+1] = WAR.SLCS1[pid]
			WAR.SLCS1[pid] = nil
		end
	end
	--擒龙罗汉
	if NGQH(pid,204) then
		local a = Person_BJ(pid)*15
		zshurt = zshurt + a
	end
	--擒龙罗汉
	if WAR.KLYH == 1 then
		zshurt = zshurt + ang/3
	end
	--金关周天
	if NGQH(pid,249) and WAR.JGZT == 1 then
		local dwqz = TrueQZ(pid) + TrueQZ(eid)
		local jq = 1000-WAR.Person[enemyid].Time
		zshurt = zshurt + math.modf((jq+dwqz)/2)
	end
	--怒涛气劲
	if NGQH(pid,252) then
		local str = ""
		local n = math.random(1,5)
		if n == 1 then
			WAR.PD['昏迷状态'][eid] = 1
			str = "・波涛汹涌"
		elseif n == 2 then	
			WAR.PD['恐惧状态'][eid] = 1
			str = "・滔滔不绝"
		elseif n == 3 then
			WAR.PD['混乱状态'][eid] = 1
			str = "・波澜壮阔"
		elseif n == 4 then	
			WAR.PD['散功状态'][eid] = 10
			str = "・排山倒海"
		elseif n == 5 then		
			WAR.PD['麻痹状态'][eid] = math.random(1,10)
			str = "・惊涛拍岸"
		end 	
		Set_Eff_Text(enemyid, "特效文字2","怒涛海潮气劲"..str)
	end
	--怒涛气劲
	if NGQH(pid,252) and JLSD(20,50,pid) then
		local a = JY.Person[eid]["冰封程度"]
		local b = JY.Person[eid]["灼烧程度"]
		zshurt = zshurt + math.modf(ang/3)
		WAR.PD["忘情我无"][eid] = 10
		Set_Eff_Text(enemyid, "特效文字3","怒海波涛・暗流不尽")
	end	
	--怒涛气劲
	if WAR.PD['怒涛剑气'][pid] ~= nil and WAR.PD['怒涛剑气'][pid] > 0 then
		local nt = WAR.PD['怒涛剑气'][pid] or 0
		zshurt = zshurt + 999
		WAR.PD['利刃寒锋'][eid] = 10
		ztd(enemyid,WAR.LXXS,nt)
		ztd(enemyid,WAR.FXXS,nt)
		ztd(enemyid,"内伤点数",nt)
	end
	--天南冰火
	if NGQH(pid,314) then
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["内力"]/20
			local b = JY.Person[pid]["内力"]/20
			zshurt = zshurt + b 
			ztd(WAR.CurID,"内力点数",a)
			if JY.Person[pid]["内力"] >= 3000 then
				ztd(WAR.CurID,"内伤点数",-15)
				ztd(WAR.CurID,"中毒点数",-15)
			end	
			Set_Eff_Text(enemyid, "特效文字3", "天南易阳・导气归虚")
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.BFXS,15)
			ztd(enemyid,WAR.ZSXS,15)
			ztd(enemyid,WAR.FXXS,15)
			ztd(enemyid,WAR.LXXS,15)
			ztd(enemyid,"内伤点数",15)
			ztd(enemyid,"中毒点数",15)
			WAR.PD["天南易阳"][eid] = limitX((WAR.PD["天南易阳"][eid] or 0) + math.random(3,8), 0, 30)	
			Set_Eff_Text(enemyid, "特效文字2", "天南易阳・变化无穷")
		end	
	end
	--霹雳气诀
	if NGQH(pid,372) then
		local str = ""
		local aa = math.random(1,4)
		local a = JY.Person[pid]["内力最大值"]/2000
		if a < 1 then a = 1 end
		hurtzs1[#hurtzs1+1] = math.random(1,a)
		if aa == 1 then
			str = "・风卷残云"
			local a = JY.Person[eid]["冰封程度"] or 0
			local b = JY.Person[eid]["灼烧程度"] or 0
			local c = JY.Person[eid]["流血程度"] or 0
			local d = JY.Person[eid]["封穴程度"] or 0
			ztd(enemyid,"生命点数",-a)
			ztd(enemyid,"生命点数",-b)
			ztd(enemyid,"生命点数",-c)
			ztd(enemyid,"生命点数",-d)
		elseif aa == 2 then
			str = "・雷轰电掣"
			local a = math.abs((JY.Person[eid]["内力"]-JY.Person[pid]["内力"])/5)
			if a > 1000 then
				a = 1000
			end
			ztd(enemyid,"生命点数",-a)			
		elseif aa == 3 then
			str = "・雨意云情"
			if JY.Person[eid]["受伤程度"] > 0 and JY.Person[eid]["受伤程度"] ~= nil then
				local a = JY.Person[eid]["受伤程度"] * 3
				ztd(enemyid,"内力点数",-a)
			end
			if JY.Person[eid]["中毒程度"] > 0 and JY.Person[eid]["中毒程度"] ~= nil then
				local a = JY.Person[eid]["中毒程度"] * 3
				ztd(enemyid,"内力点数",-a)
			end
		elseif aa == 4 then
			str = "・电光火石"
			WAR.PD["无明业火"][eid] = 30
			WAR.PD['集气倒退'][eid] = 20
			WAR.PD['脆弱状态'][eid] = 3			
		end 		
		Set_Eff_Text(enemyid, "特效文字2","霹雳心法"..str)
	end	
	--神足乾坤
	if NGQH(pid,233) and JLSD(20,50,pid) then
		WAR.PD["神足真气"][eid] = 30
		Set_Eff_Text(enemyid, "特效文字2", "神足真气")
	end 	
	-----------------------------------------------------------------------
    ---------------------------外功组合命中敌人后加成------------------------
	-----------------------------------------------------------------------
	--罗汉拳1般若掌 伤害+50
	if WAR.LHQ_BNZ == 1 then		
		zshurt = zshurt + 50
	end
	--五毒神掌组合
	if wugong == 3 and (PersonKF(pid,220) or match_ID(pid,161)) then
		local a = JY.Person[eid]["中毒程度"]*3
		ztd(enemyid,"中毒点数",6)
		ztd(enemyid,"体力点数",-1)
		zshurt = zshurt + a
		if JLSD(20,50,pid) then
			if JY.Person[eid]["中毒程度"] >= 20 then
				local a = JY.Person[eid]["受伤程度"]*3 
				ztd(enemyid,"内伤点数",10)
				zshurt = zshurt + a
				WAR.PD["迟缓状态"][eid] = limitX((WAR.PD["迟缓状态"][eid] or 0) + 6, 0, 30)	
				Set_Eff_Text(enemyid, "特效文字3","五毒神掌・赤毒")	
			end
		end
		if JLSD(20,50,pid) then
			if JY.Person[eid]["中毒程度"] >= 40 then
				local a = JY.Person[eid]["冰封程度"]
				local b = JY.Person[eid]["灼烧程度"]
				ztd(enemyid,WAR.BFXS,12)
				ztd(enemyid,WAR.ZSXS,12)
				ztd(enemyid,"生命点数",-200)
				ztd(enemyid,"内力点数",-400)
				zshurt = zshurt + (a + b)*3
				if WAR.PD["混乱状态"][eid] == nil then
					WAR.PD["混乱状态"][eid] = 1
				end
				Set_Eff_Text(enemyid, "特效文字2","五毒神掌・翠毒")	 
			end
		end
		if JLSD(20,50,pid) then
			if JY.Person[eid]["中毒程度"] >= 60 then
				local a = JY.Person[eid]["流血程度"]
				ztd(enemyid,WAR.LXXS,15)
				zshurt = zshurt + a*3
				ztd(enemyid,"生命点数",-math.modf(JY.Person[eid]["生命最大值"]*0.02))
				addbuff(eid,WAR.PD['灵蛇拳'],math.random(2,6),15)
				Set_Eff_Text(enemyid, "特效文字1","五毒神掌・青毒")
			end
		end
	end
	--五毒神掌3赤练神掌 伤害+70
	if WAR.WD_CLSZ == 1 then		
		zshurt = zshurt + 70
		ztd(enemyid,"中毒点数",20)
	end
	--乾坤鹰爪
	if ((wugong == 4 and PersonKF(pid,97)) or match_ID(pid,12)) then
		zshurt = zshurt + JY.Person[eid]["封穴程度"]*5
		if JLSD(20,50,pid) then
			nuqi(eid,-20)
			WAR.PD['恐惧状态'][eid] = 1	
			Set_Eff_Text(enemyid, "特效文字3","鹰爪擒拿・爪擒打拿")
		end
		if JLSD(20,50,pid) then
			local a = psx(eid,"封穴程度")
			zshurt = zshurt + (a*10)
			ztd(enemyid,"生命点数",-a*5)
			ztd(enemyid,"内力点数",-a*3)	
			ztd(enemyid,WAR.ZSXS,12)
			ztd(enemyid,WAR.BFXS,12)
			Set_Eff_Text(enemyid, "特效文字1","鹰爪擒拿・分筋错骨")
		end	
	end
	--寒冰化骨・寒冰掌攻击
	if wugong == 5 and WGZH(pid,5,118) then
		local bf = JY.Person[eid]["冰封程度"] + JY.Person[pid]["冰封程度"]
		zshurt = zshurt + (bf*2)
		if JLSD(30,70,pid) then
			ztd(enemyid,WAR.BFXS,7)
			if JY.Person[eid]["冰封程度"] >= 40 then
				addbuff(eid,WAR.PD['利刃寒锋'],10,20)
			end
			Set_Eff_Text(enemyid, "特效文字3","寒冰化骨・青寒")
		end
	end
	--双寒冰组合
	if wugong == 5 and WAR.HZHQ > 0 then
		zshurt = zshurt + math.modf(psx(pid,"内力最大值")*0.03)
		if WAR.HZHQ == 1 then
			ztd(enemyid,WAR.FXXS,math.random(2,5))
		end
		if WAR.HZHQ == 2 then
			zshurt = zshurt + math.modf(psx(pid,"内力最大值")*0.03)
		end
		if WAR.HZHQ == 3 then
			if nokillspeed(enemyid) == false then
				ztd(enemyid,"集气位置",-psx(eid,"冰封程度"))
			end
		end	
	end
	--纯阳绵掌
	if (wugong == 7 and PersonKF(pid,99)) or (yongquan(wugong) and MPTX(pid,4,3) and PersonKF(pid,99)) or match_ID(pid,5) then
		local c = JY.Person[eid]["受伤程度"]*3
		zshurt = zshurt + c
		if JLSD(20,50,pid) then
			Set_Eff_Text(enemyid, "特效文字3", "内蓄刚劲・外现绵柔")
			ztd(enemyid,"内伤点数",11)	
			if JY.Person[eid]["受伤程度"] >= 20 then 
				ztd(enemyid,"生命点数",-200)
			end 	
		end
		if JLSD(20,50,pid) then	
			local a = JY.Person[pid]["内力"]/30
			local b = math.modf(TrueQZ(pid)/3)
			zshurt = zshurt + a + b
			if JY.Person[eid]["受伤程度"] >= 30 then 
				ztd(enemyid,WAR.LXXS,25)
			end 
			Set_Eff_Text(enemyid, "特效文字2", "刚而不犟・柔而步软")
		end
		if JLSD(20,50,pid) then	
			zshurt = zshurt + 300
			ztd(enemyid,WAR.ZSXS,25)
			ztd(enemyid,WAR.BFXS,25)
			if JY.Person[eid]["受伤程度"] >= 40 then  
				WAR.PD['昏迷状态'][eid] = 1
			end 
			Set_Eff_Text(enemyid, "特效文字1", "快而不乱・慢而不断")
		end
	end
	--北冥六阳
	if (wugong == 8 and PersonKF(pid,85)) or match_ID(pid,116) or match_ID(pid,117) or match_ID(pid,634) then
		zshurt = zshurt + math.modf(ang/6)
		local str = ""
		if JLSD(30,60,pid) then
			str = "落日熔金"
			local a = math.modf(JY.Person[pid]["内力"]/2)
			ztd(enemyid,"内力点数",-a)
			ztd(enemyid,"内伤点数",100)
		end
		if JLSD(10,60,pid) then
			str = "天山阴阳"
			if JY.Person[eid]["内力性质"] == 0 then
				ztd(enemyid,WAR.BFXS,50)
				WAR.PD['恐惧状态'][eid] = 1 
			elseif JY.Person[eid]["内力性质"] == 1 then
				ztd(enemyid,WAR.ZSXS,50)
				WAR.PD['举火燎原'][eid] = 10
			else
				WAR.PD['沉睡状态'][eid] = 1
				WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(3)
			end
		end
		if JLSD(10,60,pid) then
			str = "真・阳歌天钧"
			hurtzs1[#hurtzs1+1] = 1
			local a1 = math.modf(ang/50)
			ztd(enemyid,"内力点数",-a1)
			ztd(WAR.CurID,"内伤点数",-10)
		end
		if JLSD(10,60,pid) then
			str = "真・阳春白雪"
			WAR.PD['必杀气'][pid] = 1
			WAR.PD['恐惧状态'][eid] = 1
		end
		if JLSD(10,60,pid) then
			str = "真・阳关三叠"
			ztd(WAR.CurID,"生命点数",333)
			ztd(WAR.CurID,"体力点数",13)
		end
		if JLSD(35,60,pid) then
			str = "云霞出海曙 白日参辰现"
			local a1 = math.modf(TrueQZ(pid)/6)
			local a2 = math.modf(TrueQZ(eid)/6)
			local a4 = a1 + a2
			local a5 = JY.Person[eid]["灼烧程度"]*6
			local a6 = JY.Person[eid]["冰封程度"]*6
			zshurt = zshurt + a4 + a5 + a6
			hurtzs1[#hurtzs1+1] = 1 - JY.Person[eid]["内力"]/JY.Person[eid]["内力最大值"]
			if JY.Person[pid]["内力"] > JY.Person[eid]["内力"] then
				zshurt = zshurt + math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"])/2+a4)
			end
		end
		Set_Eff_Text(enemyid,3,"北冥六阳劲・"..str)	
	end
	--八荒六阳
	if (wugong == 8 and Curr_NG(pid,101)) or match_ID(pid,117) or match_ID(pid,634) then
		zshurt = zshurt + math.modf(TrueQZ(pid)/2)
		if JLSD(25,60,pid) then
			ztd(enemyid,"内伤点数",100)
			ztd(enemyid,WAR.LXXS,100)
			ztd(enemyid,WAR.FXXS,20)
			Set_Eff_Text(enemyid, "特效文字3","举重若轻・潇洒如意")
		end
		if JLSD(25,60,pid) then
			local a = JY.Person[eid]["受伤程度"]
			local b = JY.Person[eid]["封穴程度"]
			local c = JY.Person[eid]["流血程度"]
			local d = a + b + c
			ztd(enemyid,"生命点数",-d)
			Set_Eff_Text(enemyid, "特效文字2","安禅制龙・青阳岁除")
		end
	end	
	--灵蛇拳+蛤蟆功
	if wugong == 9 and Curr_NG(pid,95) and WAR.PD['灵蛇拳法'][pid] ~= nil  then
		local a = WAR.PD['灵蛇拳法'][pid]
		local str = {'烈火','玄冰','七死','冰魄','剧蛇','龙眠','蛇蛊','裂创'}
		ztd(enemyid,'中毒点数',10)
		zshurt = zshurt+ math.modf(TrueQZ(pid)/10+(psx(eid,'中毒程度')+1)*5)
		if a == 1 then
			WAR.PD['火毒攻心'][eid] = 1
			WAR.PD['阳气侵蚀'][eid] = (WAR.PD['阳气侵蚀'][eid] or 0) + 8
			if JLSD(10,45,pid) then
				WAR.PD['举火燎原'][eid] = (WAR.PD['举火燎原'][eid] or 0) + 8
			end
		elseif a == 2 then
			WAR.PD['寒毒入体'][eid] = 1
			WAR.PD['阴气污染'][eid] = (WAR.PD['阴气污染'][eid] or 0) + 8
			if JLSD(10,45,pid) then
				WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + 8
				WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + 8
			end	
		elseif a == 3 then
			ztd(enemyid,'内力点数',-math.modf(10*psx(eid,'中毒程度')))
			WAR.PD['毒击'][eid] = (WAR.PD['毒击'][eid] or 0) + 8
		elseif a == 4 then
			WAR.PD['冰魄毒'][eid] = limitX((WAR.PD['冰魄毒'][eid] or 0) + 8 ,0 ,30)
		elseif a == 5 then
			ztd(enemyid,'生命点数',100)
			WAR.PD['西域奇毒'][eid] = limitX((WAR.PD['西域奇毒'][eid] or 0) + 8,0,30)		
		elseif a == 6 then
			WAR.PD['龙眠毒'][eid] = (WAR.PD['龙眠毒'][eid] or 0) + 8
		elseif a == 7	then
			WAR.PD['白驼蛇蛊'][eid] = (WAR.PD['白驼蛇蛊'][eid] or 0) + 8
		elseif a == 8 then
			WAR.PD['出血蛇毒'][eid] = (WAR.PD['出血蛇毒'][eid] or 0) + 8
		end		
		Set_Eff_Text(enemyid,3,'八岐・'..str[a])	
		WAR.PD['灵蛇拳法'][pid] = nil
	end
	--九爪火焰刀
	if wugong == 11 and WGZH(pid,11,66) then
		zshurt = zshurt + 500
		if JLSD(20,60,pid) then
			local a = JY.Person[eid]["中毒程度"]
			local b = JY.Person[eid]["冰封程度"]
			local c = a + b
			WAR.PD['中毒不解'][eid] = 20
			WAR.PD["恐惧状态"][eid] = 1
			ztd(enemyid,WAR.BFXS,100)
			ztd(enemyid,"生命点数",-c)
			Set_Eff_Text(enemyid, "特效文字3","腐骨摧心・元阴无限")
		end
	end
	--九阴白骨爪九阴组合
	if (wugong == 11 and Curr_NG(pid,107)) or match_ID(pid,637) then
		local a = math.modf(TrueQZ(pid)/2)
		local b = math.modf(TrueZF(pid)/2)
		zshurt = zshurt + a + b
		if JLSD(25,60,pid) then
			WAR.PD['九阴摄魂'][eid] = 1
			Set_Eff_Text(WAR.CurID, "特效文字1","摧坚神爪・摧敌首脑")
		end
		if JLSD(25,60,pid) then
			WAR.JuHuo = 1	
			WAR.PD['恐惧状态'][eid] = 1		
			WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + 1
			Set_Eff_Text(enemyid, "特效文字2","摧坚神爪・无坚不破")
		end
		if JLSD(25,60,pid) then
			WAR.PD['昏迷状态'][eid] = 1	
			WAR.PD['混乱状态'][eid] = 1	
			Set_Eff_Text(enemyid, "特效文字0","摧坚神爪・如穿腐土")
		end
	end
	--落英神剑掌，配合桃花绝技，根据敌方内力耗损量追加伤害，上限+100%
    if (wugong == 12 and WGZH(pid,12,18)) or match_ID(pid,57) then
        local mp_percentage = (JY.Person[eid]["内力最大值"]-JY.Person[eid]["内力"])/JY.Person[eid]["内力最大值"]
        hurtzs1[#hurtzs1+1] = mp_percentage
    end
	--碧海落英12
	if WAR.LYBF > 0 then
		local a = 0
		for j = 0, WAR.PersonNum - 1 do
			local tmppid = WAR.Person[j]["人物编号"]
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				ztd(j,WAR.LXXS,math.random(20,30))
				a = math.modf(JY.Person[tmppid]["流血程度"]*2)
				ztd(j,"生命点数",-a)
			end
		end 	
		zshurt = zshurt + a 	
		if WAR.LYBF == 1 then
			WAR.PD['必杀气'][pid] = 1 
		end
		if WAR.LYBF == 2 then
			local a = math.modf(JY.Person[pid]["内力"] * 0.3)
			local b = math.modf(JY.Person[pid]["内力"] * 0.5)
			ang = ang + a
			zshurt = zshurt + b
		end
		if WAR.LYBF == 3 then
			WAR.KHBX = 2
			WAR.JuHuo = 1
			WAR.PD['恐惧状态'][eid] = 1
		end	
	end
	--铁掌，高机率造成内伤12~15点
	if wugong == 13 and JLSD(30,90,pid) then
		ztd(enemyid,"内伤点数",math.random(12,15))
	end
	--铁掌炼铁手
	if wugong == 13 and WAR.LTS > 0 then	
		local a = WAR.PD['炼铁劲'][pid] or 100
		zshurt = zshurt + math.modf(a*10)
		if BNJQ(pid) then
			zshurt = zshurt + math.modf(a*10) + TrueQZ(pid)
			ztd(enemyid,"生命点数",-a)
		end	
		if WAR.LTS == 1 then
			local gj = 0
			if JY.Person[pid]["武器"] >= 0 then
				gj = gj + JY.Thing[JY.Person[pid]["武器"]]["加攻击力"]*10+JY.Thing[JY.Person[pid]["武器"]]["加攻击力"]*(JY.Thing[JY.Person[pid]["武器"]]["装备等级"]-1)*2
			end
			if JY.Person[pid]["防具"] >= 0 then
				gj = gj + JY.Thing[JY.Person[pid]["防具"]]["加攻击力"]*10+JY.Thing[JY.Person[pid]["防具"]]["加攻击力"]*(JY.Thing[JY.Person[pid]["防具"]]["装备等级"]-1)*2
			end
			if JY.Person[pid]["坐骑"] >= 0 then
				gj = gj + JY.Thing[JY.Person[pid]["坐骑"]]["加攻击力"]*10+JY.Thing[JY.Person[pid]["坐骑"]]["加攻击力"]*(JY.Thing[JY.Person[pid]["坐骑"]]["装备等级"]-1)*2
			end	
			zshurt = zshurt + gj
		end
		if WAR.LTS == 2 then
			addbuff(eid,WAR.PD["生命恢复停止"],1,2)
			WAR.PD['火毒攻心'][eid] = 1
		end
		if WAR.LTS == 3 then
			WAR.BLX = 1
			ztd(enemyid,"内伤点数",math.random(12, 15))
			ztd(enemyid,"生命点数", -(JY.Person[eid]["受伤程度"] + JY.Person[eid]["流血程度"]))
		end
		if WAR.LTS == 4 then
			WAR.PD['举火燎原'][eid] = math.random(5,10)
			if JY.Person[eid]["灼烧程度"] > 25 then
				hurtzs1[#hurtzs1+1] = JY.Person[eid]["灼烧程度"]*0.04 - 1
			end
		end	
	end
	--空明北斗
	if wugong == 15 and WGZH(pid,15,39) then
		zshurt = zshurt + 666
		if JLSD(20,60,pid) then
			local a = JY.Person[eid]["攻击力"]
			local b = JY.Person[eid]["防御力"]
			ztd(enemyid,"生命点数",-a)
			ztd(enemyid,"内力点数",-b)
			Set_Eff_Text(enemyid, "特效文字3","兵强则灭・木强则折")
		end
		if JLSD(20,60,pid) then	
			WAR.KMBD = 1 
			Set_Eff_Text(enemyid, "特效文字3","坚强处下・柔弱处上")
		end
	end
	--金关空明拳
	if (wugong == 15 and PersonKF(pid,249)) or (PersonKF(pid,15) and match_ID(pid,64)) then 
		zshurt = zshurt + 666
		if JLSD(35,65,pid) then	
			ztd(enemyid,WAR.FXXS,math.random(5,20))
			Set_Eff_Text(enemyid, "特效文字2","奥义・空碗盛饭")		
		end
		if JLSD(25,50,pid) then
			local a1 = Xishu_sum(eid)
			local a2 = math.modf(Sanwei_sum(eid)*0.2)
			local a3 = math.modf(Sanwei_sum(pid)*0.3 + Sanwei_sum(eid)*0.2)
			zshurt = zshurt + a2 + a1
			ztd(enemyid,"生命点数",-a3)
			Set_Eff_Text(enemyid, "特效文字0","空朦洞松・风通容梦・冲穷中弄・童庸弓虫")
		end
		if JLSD(35,70,pid) then
			WAR.PD['昏迷状态'][eid] = 1	
			Set_Eff_Text(enemyid, "特效文字3","奥义・空屋住人")
		end
		if JLSD(35,70,pid) then
			WAR.JuHuo = 1
			WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(2)
			Set_Eff_Text(enemyid, "特效文字2","奥义・妙手空空")
		end
		if JLSD(35,70,pid) then
			hurtzs1[#hurtzs1+1] = math.modf((JY.Person[pid]["内力最大值"] + JY.Person[eid]["内力"])/5000)
			WAR.PD['恐惧状态'][eid] = 1
			Set_Eff_Text(enemyid, "特效文字2","奥义・深藏若虚")
		end
	end
	--纯阳太极拳
	if (wugong == 16 and PersonKF(pid,99)) or match_ID(pid,5) then
		ztd(enemyid,"生命点数",-JY.Person[eid]["受伤程度"])
		local str = ""
		if JLSD(10,50,pid) then
			str = "以柔克刚"
			if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] > 0 then
				if WAR.LQZ[eid] < 40 then
					WAR.LQZ[eid] = 0
				elseif WAR.LQZ[eid] < 100 then
					nuqi(eid,-20)
				elseif BNJQ(eid) then
					nuqi(eid,-60)	
				end
			end
		end
		if JLSD(10,50,pid) then
			str = "以刚制柔"
			if JY.Person[eid]["受伤程度"] < 50 then
				ztd(enemyid,"内伤点数",50)
			else
				ztd(enemyid,"内伤点数",300)
				addbuff(eid,WAR.PD['重度内伤'],5,10)
			end
		end
		if JLSD(10,55,pid) and (JY.Person[eid]["内力"] < JY.Person[pid]["内力"]) then
			str = "刚柔并济"
			local wl = math.modf(get_skill_power(pid, 16, 11)/3)
			if wl < 300 then
				wl = 300
			end
			ztd(enemyid,"内力点数",-math.random(200,wl))
		end
		Set_Eff_Text(enemyid,2,"太极纯阳拳经・"..str)	
	end
	--太极拳剑
	if (wugong == 16 and PersonKF(pid,46)) or match_ID(pid,5) then
		if JLSD(30,70,pid) then
			ztd(enemyid,"内伤点数",13)
			if JY.Person[eid]["受伤程度"] >= 40 then
				ztd(enemyid,"生命点数",-100)
			end	
			Set_Eff_Text(enemyid, "特效文字3","太极奥义・拳罡")
		end
		if WAR.TJQJ > 0 then
			local qjc = {'二','三','四','五','六','七','八'}	
			local a = math.random(2,8)
			local aa = psx(eid,'受伤程度') * a
			local b = psx(eid,'受伤程度')
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 32, 1 ,"太极阴阳"..qjc[a-1]..'层拳劲')
			zshurt = zshurt + aa
			ang = ang + aa
			ztd(enemyid,"生命点数",-aa)
			ztd(enemyid,"内伤点数",100)
			ztd(WAR.CurID,"生命点数",b)	
			WAR.PD["伤重不治"][eid] = (WAR.PD["伤重不治"][eid] or 0) + 10
			WAR.TJQJ = 0
		end
	end
	--太极拳反击
	if wugong == 16 then
		ztd(enemyid,"生命点数", -JY.Person[eid]["受伤程度"]*math.random(3,5))
		if WAR.YJZD[pid] == 1 and tjqfj(pid) then
			addbuff(eid,WAR.YJZD1,10)
			local a = (WAR.PD['太极蓄力'][pid] or 0) + (WAR.BG[pid] or 0) + (WAR.PD['借力打力'][pid] or 0) + (WAR.PD['伤害储存'][pid] or 0)
			if a < 500 then a = 500 end
			hurtzs1[#hurtzs1+1] = a/1000
			if WAR.WDKTJ == 1 then
				local a,b,c,d = (WAR.PD['太极蓄力'][pid] or 0),(WAR.PD['长生蓄力'][pid] or 0),(WAR.PD['蛤蟆蓄力'][pid] or 0),(WAR.PD['鲸息蓄力'][pid] or 0)
				local e = (WAR.BG[pid] or 0)
				local f = (WAR.PD['借力打力'][pid] or 0)
				zshurt = zshurt + math.modf(a+b+c+d+e+f)
			end
		else
			zshurt = zshurt + (WAR.PD['借力打力'][pid] or 0) + (WAR.PD['伤害储存'][pid] or 0) + TrueQZ(pid)
		end
		--开太极
		if WAR.WDKTJ == 1 then
			local s1 = 1-(JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"])
			local s2 = JY.Person[pid]["内力"]/JY.Person[pid]["内力最大值"]		
			local s3 = JY.Person[pid]["内力"]
			local s4 = s1+s2
			local s = math.modf(s3*s4) 
			zshurt = zshurt + s
		end
	end
	--闪电五连鞭16
	if WAR.SDWLB == 1 then
		if WAR.PD['伤害储存'][pid] ~= nil then
			zshurt = zshurt + WAR.PD['伤害储存'][pid]
			WAR.PD['伤害储存'][pid] = nil
		end
		if WAR.ACT < 6 and WAR.ACT > 0 then
			ztd(enemyid,"生命点数",-50)
		end
	end	
	--枯禅一阳指
    if (wugong == 17 and (PersonKF(pid,207) or match_ID(pid,65)) and JLSD(10,40,pid)) or match_ID(pid,499) then 
		hurtzs1[#hurtzs1+1] = 1
    	local a = math.modf(JY.Person[eid]["内力"] * 0.3)
		ztd(enemyid,'内力点数',-a)
	    Set_Eff_Text(enemyid, "特效文字3","声东击西・欲虚反实")		
    end
    --枯禅一阳指
    if (wugong == 17 and (PersonKF(pid,207) or match_ID(pid,65)) and JLSD(50,80,pid)) or match_ID(pid,499) then
		hurtzs1[#hurtzs1+1] = 1
	    local a = math.modf(JY.Person[eid]["内力"] / 4)
	    local b = math.modf(TrueZF(eid) / 2)
		ztd(WAR.CurID,"内力点数",b)
		ztd(WAR.CurID,"生命点数",a)
	    Set_Eff_Text(enemyid, "特效文字1","动若江河・静如山岳")		
    end
	--一阳六脉
	if (wugong == 17 and WGZH(pid,17,49)) or match_ID(pid,499) then
		local a = TrueYJ(pid)
		zshurt = zshurt + a
		if JLSD(10,50,pid) then
			local b = JY.Person[eid]["受伤程度"] * 6
			ztd(enemyid,"内伤点数",100)
			ztd(enemyid,"生命点数",-b)
			Set_Eff_Text(enemyid, "特效文字3","一阳剑气・少阳初生")
		end
		if JLSD(10,50,pid) then
			local a = math.modf(JY.Person[pid]["内力"] / 30 + 300)
			ztd(enemyid,WAR.BFXS,100)
			ztd(enemyid,WAR.ZSXS,100)
			ztd(enemyid,WAR.LXXS,100)
			ztd(enemyid,"内力点数",-a)
			Set_Eff_Text(enemyid, "特效文字2","一阳剑气・生生不息")
		end
	end
	--一阳妙笔
	if wugong == 17 and WGZH(pid,17,142) then	
		ztd(enemyid,"生命点数",-JY.Person[eid]["封穴程度"])
		if JLSD(20,60,pid) then	
			ztd(enemyid,WAR.FXXS,10)
			ztd(enemyid,'集气位置',-150)
			Set_Eff_Text(enemyid, "特效文字3","一阳玄指・绝技为先")
		end
		if JLSD(20,60,pid) then	
			local a = JY.Person[eid]["封穴程度"]*6
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid, "特效文字3","气法自然・混辨柔刚")
		end
	end
	--铁指一阳化骨
	if (wugong == 17 or wugong == 121) and WGZH(pid,118,121) and JLSD(20,60,pid) then	
		WAR.PD["无明业火"][eid] = 15
		WAR.PD['创伤'][eid] = 15
		WAR.PD['虚弱状态'][eid] = 15
		Set_Eff_Text(enemyid, "特效文字3","三分之气・变幻小巧")
	end
	--奇门弹指
	if wugong == 18 and (Curr_NG(pid,251) or match_ID(pid,57)) then
		local a = TrueZF(pid)
		local b = JY.Person[pid]["暗器技巧"]
		zshurt = zshurt + a + b
		AddPersonAttrib(pid,"暗器技巧",math.random(3,5))
		local str = ""
		if JLSD(20,55,pid) then
			str = "遁甲劲"
			ztd(enemyid,"内力点数",-b)
			ztd(enemyid,"内伤点数",30)
		end
		if JLSD(20,55,pid) then
			str = "桃花意"
			local a = JY.Person[eid]["受伤程度"] * 2 + 100
			local b =  math.modf(JY.Person[eid]["内力最大值"]*0.25)
			WAR.PD["增加气攻"][pid] = 500	
			ztd(enemyid,WAR.LXXS,math.random(30,50))
			ztd(enemyid,"生命点数",-a)
		end
		if JLSD(20,55,pid) then
			str = "破千钧"
			WAR.KMZWD = 1
			local a =math.modf( JY.Person[pid]["内力"]/3)
			zshurt = zshurt + a 
		end
		if JLSD(20,55,pid) then
			str = "斗百者"
			WAR.PD['恐惧状态'][eid] = 1
			local a = math.modf(JY.Person[eid]["内力最大值"]/3)
			zshurt = zshurt + a
		end
		if JLSD(20,55,pid) then
			str = "战十方"
			WAR.JuHuo = 1
			local a = math.modf(JY.Person[pid]["攻击力"]/3)
			zshurt = zshurt + a
		end
		Set_Eff_Text(enemyid,1,"弹指・"..str)	
	end
	--寒冰幻阴19
	if WAR.HYZF > 0 then
		local a = TrueZF(pid)
		zshurt = zshurt + a
		if WAR.HYZF == 1 then
			WAR.PD["恐惧状态"][eid] = 1	
			ztd(enemyid,WAR.BFXS,math.random(20,50))
		end
		if WAR.HYZF == 2 then	
			WAR.PD["迟缓状态"][eid] = limitX((WAR.PD["迟缓状态"][eid] or 0) + math.random(10),0,30)
			WAR.PD['利刃寒锋'][eid] = limitX((WAR.PD["利刃寒锋"][eid] or 0) + 5,0,20)
		end
		if WAR.HYZF == 3 then
			local d = math.modf(JY.Person[pid]["内力"] / 300)
			if d < 20 then
				d = 20
			end
			local dd = d * 10
			for i = 0, WAR.PersonNum - 1 do 
				if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
					if nokillspeed(i) == false then
						ztd(i,'集气位置',-dd)
					end
					ztd(i,'内伤点数',math.random(20,d))
				end
			end
		end
		if WAR.HYZF == 4 then	
			local a = JY.Person[eid]["冰封程度"]/200 * TrueZF(pid)
			ztd(enemyid,'生命点数',-a)
		end
	end
	--龙爪奥义20
	if WAR.PD['龙爪手'][pid] == 1 then 
		zshurt = zshurt + 999
	end
	--五毒玄冥
	if wugong == 21 and WAR.XMSZ > 0 then
		ztd(enemyid,"内伤点数",15) 
		local a = JY.Person[pid]["拳掌功夫"]
		local b = JY.Person[eid]["中毒程度"] + JY.Person[eid]["受伤程度"]
		local c = a + b
		zshurt = zshurt + c
		if (WAR.PD['玄冥玄毒'][eid] or 0) > 0 then
			zshurt = zshurt + WAR.PD['玄冥玄毒'][eid]*100
			if (WAR.PD['玄冥冥寒'][pid] or 0) <= (WAR.PD['玄冥玄毒'][eid] or 0) then
				local a = limitX((WAR.PD['玄冥玄毒'][eid] or 0),1,50)
				zshurt = zshurt + math.modf(psx(eid,'生命最大值')*a*0.01)
			end	
		end	
		if WAR.XMSZ == 1 then
			for j = 0, WAR.PersonNum - 1 do			  	  
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"中毒点数",100)
					ztd(j,"体力点数",-15)
				end
			end						
		end
		if WAR.XMSZ == 2 then
			ztd(enemyid,WAR.BFXS,50)
			for j = 0, WAR.PersonNum - 1 do 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-100)
					end
				end
			end
		end
		if WAR.XMSZ == 3 then 
			local a = JY.Person[eid]["冰封程度"]
			local b = JY.Person[eid]["中毒程度"]
			local c = (a + b) * 5
			ztd(enemyid,"内力点数",-c)
		end 	
		if WAR.XMSZ == 4 then 
			local a = JY.Person[eid]["灼烧程度"]
			local b = JY.Person[eid]["中毒程度"]
			local c = (a + b) * 3
			ztd(enemyid,"生命点数",-c)
		end  	
	end
	
	--寒冰玄冥21
	if WAR.XMSZ1 == 1 or WAR.XMSZ1 == 11 then
		zshurt = zshurt + math.modf(psx(eid,"冰封程度") * math.random(10,50))
		WAR.PD['冰冻状态'][eid] = limitX((WAR.PD['冰冻状态'][eid] or 0) + 10,0,50)
	end
	if WAR.XMSZ2 == 1 then
		zshurt = zshurt + math.modf((WAR.PD['冰冻状态'][eid] or 0) * math.random(10,50))
		WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + 10
	end
	if WAR.XMSZ4 == 1 then
		local a = math.modf((psx(pid,"内力")-psx(eid,"内力"))*0.01)
		if a >= 20 then a = 20 end
		if a <= 0 then a = 10 end
		Set_Eff_Text(enemyid,1,"玄冥透骨")
		if PersonKF(pid,43) then -- or match_ID()
			WAR.PD['玄冥透骨1'][eid] = limitX((WAR.PD['玄冥透骨1'][eid] or 0)+a,0,25)
		else
			WAR.PD['玄冥透骨'][eid] = limitX((WAR.PD['玄冥透骨'][eid] or 0)+a,0,20)
		end
		Set_Eff_Text(enemyid,1,"玄冥透骨")	
	end
	
    --七探蛇盘枪
	if wugong == 200 and WAR.QTSPQ > 0 then
		ztd(enemyid,"内伤点数",20) 
		local a = JY.Person[pid]["特殊兵器"] + JY.Person[eid]["受伤程度"]
		zshurt = zshurt + a	
		if WAR.QTSPQ == 1 then
			for j = 0, WAR.PersonNum - 1 do 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-300)
					end
				end
			end			
		end
		if WAR.QTSPQ == 2 then
			local a = JY.Person[eid]["流血程度"] * 7
			ztd(enemyid,"内力点数",-a)
		end
		if WAR.QTSPQ == 3 then
			WAR.PD['气阻中门'][eid] = 10
			ztd(enemyid,"体力点数",-7)
		end
		if WAR.QTSPQ == 4 then
			WAR.PD['气阻中门'][eid] = 10
			ztd(enemyid,"体力点数",-7)
		end
		if WAR.XMSZ == 5 then 
			WAR.PD["洞火"][eid] = 1
		end 
		if WAR.XMSZ == 6 then 
			WAR.PD["无明业火"][eid] = 20
		end 
		if WAR.XMSZ == 7 then 
			WAR.PD['创伤'][eid] = 20
		end 
	end	
	
	--魔刀
	if wugong == 371 and WAR.XMMD > 0 then
		ztd(enemyid,WAR.ZSXS,100) 
		local a = JY.Person[pid]["耍刀技巧"] + JY.Person[eid]["灼烧程度"]
		zshurt = zshurt + a	
		if WAR.XMMD == 1 then
			WAR.PD['禁疗'][eid] = 10
		end
		if WAR.XMMD == 2 then
			WAR.PD['罗汉血'][eid] = 10
		end
		if WAR.XMMD == 3 then
			WAR.PD['头晕目眩'][eid] = 1
		end
		if WAR.XMMD == 4 then
			WAR.PD['重度内伤'][eid] = 10
		end
	end 	
	
	--齐木思
	if WAR.YQQF == 1 then 
		local a = TrueQZ(pid)
		zshurt  = zshurt + a
	end 
	
	--齐木思
	if WAR.YQQF == 2 then
		WAR.PD["恐惧状态"][eid] = 1		
		WAR.PD['重度内伤'][eid] = 10
		WAR.PD['气阻中门'][eid] = 10
	end	
	
	--齐木思
	if wugong == 110 and match_ID(pid,776) then
		local a = TrueYJ(pid)
		local b = JY.Person[pid]["内力"] 
		zshurt = zshurt + a + b
		local str = ""
		if JLSD(20,55,pid) then
			str = "东岳"
			ztd(enemyid,'集气位置',-300)
		end
		if JLSD(20,55,pid) then
			str = "南岳"
			WAR.PD["锁足状态"][eid] = 1
		end
		if JLSD(20,55,pid) then
			str = "西岳"
			ztd(enemyid,'内力点数',-1500)
		end
		if JLSD(20,55,pid) then
			str = "北岳"
			ztd(enemyid,"体力点数",-15)
		end
		if JLSD(20,55,pid) then
			str = "中岳"
			WAR.PD['头晕目眩'][eid] = 1
		end
		Set_Eff_Text(enemyid,3,"神山剑诀・"..str)	
	end
	
	--齐木思
	if WAR.SSJF == 1 then 
	    WAR.PD["阳气侵蚀"][eid] = 15 
		WAR.PD['阴气污染'][eid] = 15
    end		
	
	--太玄青莲
	if WAR.TXQL == 2 then
		WAR.PD['头晕目眩'][eid] = 1
		WAR.PD["洞火"][eid] = 1
	end 
	
	--太玄青莲
	if WAR.TXQL == 3 then 
		WAR.PD['盲目状态'][eid] = 2
		WAR.PD["参合状态"][eid] = 3
	end 	
	
	--太玄青莲
	if WAR.TXQL == 4 then
		WAR.PD['放下屠刀'][eid] = 5
		WAR.PD['基础蛊毒'][eid] = 1
	end 	
	
	--大力金刚掌22达摩掌 伤害+100
	if WAR.JGZ_DMZ == 1 then		
		zshurt = zshurt + 100
	end
	--金刚须弥
	if wugong == 22 and WGZH(pid,22,24) and JLSD(20,60,pid) then
		local a = JY.Person[pid]["品德"]
		local b = JY.Person[pid]["内力"]
		zshurt = zshurt + math.modf(b/8)
		hurtzs1[#hurtzs1+1] = a * 0.02 
		if nokillspeed(enemyid) == false then
			ztd(enemyid,'集气位置',-300)
		end
		Set_Eff_Text(enemyid, "特效文字3","刚猛雄浑・威猛异常")
	end
	--双金刚组合22
	if QFZH(pid,wugong,144) then
		zshurt = zshurt + get_skill_power(pid,144,11)
		if WAR.Actup[pid] ~= nil and (WAR.PD['照见诸法'][pid] or 0) > 1 then
			hurtzs1[#hurtzs1+1] = 0.4*(WAR.PD['照见诸法'][pid] or 0)
		end
		if WAR.PD['恐惧状态'][eid] ~= nil and (WAR.LQZ[pid] or 0) >= 15 then
			zshurt = zshurt + math.modf((TrueQZ(pid) + TrueZF(pid))*0.5*(8-psx(pid,'畅想分阶'))*0.75)
		end	
	end		
	--阴阳七伤
	if wugong == 23 and (PersonKF(pid,221) or match_ID(pid,8) or match_ID(pid,167) or match_ID(pid,168)) then
		ztd(enemyid,"生命点数", -JY.Person[eid]["受伤程度"]*math.random(5,7))
		if JLSD(20,50,pid) then
			ztd(enemyid,'内伤点数',17)
			zshurt = zshurt + math.modf(JY.Person[eid]["受伤程度"] * 7)
		end
		if WAR.SGSF == 1 then 
			ztd(enemyid,'内力点数',-777)
		end
		if WAR.SGSF == 2 then 
			ztd(enemyid,'内伤点数',77)
		end
		if WAR.SGSF == 3 then 
			WAR.PD["灵蛇拳"][eid] = 15
		end
		if WAR.SGSF == 4 then 
			WAR.PD["刺目"][eid] = 2
		end
		if WAR.SGSF == 5 then 
			ztd(enemyid,WAR.BFXS,20)
			ztd(enemyid,WAR.ZSXS,20)
		end
		if WAR.SGSF == 6 then 
			ztd(enemyid,WAR.LXXS,10)
            WAR.PD["迟缓状态"][eid] = (WAR.PD["迟缓状态"][eid] or 0) + 10 	
		end
		if WAR.SGSF == 7 then 
            WAR.PD["恐惧状态"][eid] = 1
		end 
	end
	--七伤拳，机率造成内伤17点
	if WAR.YZQS == 1 then
		local ns = 17
		--谢逊额外造成+7
		if match_ID(pid, 13) then
			ns = ns + 7
		end
		ztd(enemyid,"内伤点数",ns)
		--当自己内力值低于5000时，会受到内伤
		if JY.Person[pid]["内力"] < 5000 then
			ztd(WAR.CurID,"内伤点数",17)
		end
	end
	--七伤拳，心23
	if WAR.QSAY == 1 or WAR.QSAY == 7 then
		zshurt = zshurt + 777
		ztd(enemyid,"生命点数",-77)
	end
	--七伤拳，肺
	if WAR.QSAY == 2 or WAR.QSAY == 7 then
		WAR.PD["伤肺决"][eid] = 17
	end
	--七伤拳・肝
	if WAR.QSAY == 3 or WAR.QSAY == 7 then
		addbuff(eid,WAR.PD["摧肝肠"],math.random(3,7))
	end
	--七伤拳，离
	if WAR.QSAY == 4 or WAR.QSAY == 7 then
		WAR.CQSX_WZSX = 1
		WAR.PD["锁足状态"][eid] = 1
	end
	--七伤拳，精
	if WAR.QSAY == 5 or WAR.QSAY == 7 then
		ztd(enemyid,"体力点数",-17)
	end
	--七伤拳，意恍惚
	if WAR.QSAY == 6 or WAR.QSAY == 7 then
		addbuff(eid,WAR.PD["意恍惚"],math.random(7,17))
	end
	--须弥山神掌
	if wugong == 24 then
		local jl = (1- JY.Person[eid]["生命"]/JY.Person[eid]["生命最大值"])*20
		if JY.Person[eid]["生命"]/JY.Person[eid]["生命最大值"] < 0.5 and JLSD(10,60,pid) then
			WAR.PD["如来神掌"][pid] = 1
			zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]*0.05)		   
		end
		if JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"]/5 and math.random(100) <= jl then
			ztd(enemyid,"生命点数",-JY.Person[eid]["生命"])
			WAR.PD["如来神掌"][pid] = 2
		end
	end
	--须弥金刚
	if wugong == 24 and WGZH(pid,22,24) and JLSD(20,60,pid) then
		local a = JY.Person[eid]["流血程度"]
		local b = JY.Person[pid]["内力"]
		ztd(enemyid,WAR.LXXS,15)
		ztd(WAR.CurID,"生命点数",(b * 0.025))
		ztd(WAR.CurID,"内力点数",350)
		ztd(WAR.CurID,"体力点数",3)
		hurtzs1[#hurtzs1+1] = a * 0.02
		Set_Eff_Text(enemyid, "特效文字3","凝神运气・掌藏须弥")
	end
	--易筋须弥山
	if (wugong == 24 and PersonKF(pid,108)) or match_ID(pid,577) then 
		local a = math.modf(JY.Person[pid]["内力"]/10)
		local aa = math.modf(JY.Person[pid]["内力最大值"]/33)
		local tz = JY.Person[pid]["生命增长"]*0.05
		hurtzs1[#hurtzs1+1] = tz
		zshurt = zshurt + a
		ztd(enemyid,"生命点数",-aa)
		if WAR.LQZ[eid] ~= nil then
			if WAR.LQZ[eid] < 20 then
				WAR.LQZ[eid] = 0
			elseif WAR.LQZ[eid] < 100 then
				nuqi(eid,-10)
			elseif WAR.LQZ[eid] >= 100 then
				nuqi(eid,-100)
				--WAR.LQZ[eid] = 100
			end
			Set_Eff_Text(enemyid, "特效文字2", "一切怨害・慈心相同")
		end
		if JLSD(10,40,pid) then
			WAR.CQSX_WZSX = 1
			WAR.PD["锁足状态"][eid] = 1
		end
	end
	--黯然美女
	if wugong == 25 and WGZH(pid,25,6) then
		if JLSD(20,60,pid) then
			WAR.PD["黯然销魂"][eid] = 10
			Set_Eff_Text(enemyid, "特效文字3","别赋・黯然销魂者")
		end
		if JLSD(20,60,pid) then
			local a = JY.Person[eid]["灼烧程度"]
			local b = JY.Person[eid]["冰封程度"]
			local c = a + b
			ztd(enemyid,WAR.BFXS,10)
			ztd(enemyid,WAR.ZSXS,10)
			hurtzs1[#hurtzs1+1] = c/200
			Set_Eff_Text(enemyid, "特效文字3","别赋・唯别而已矣")
		end
	end
	--黯然销魂掌 
	if wugong == 25 then
		local jl = (1-JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"])*30
		--逆运黯然
		if WAR.NYAR == 2 then
			WAR.BBF = 1
			WAR.BZS = 1
			WAR.PD['头晕目眩'][eid] = 1
			addbuff(eid,WAR.PD['冰冻状态'],20,40)
			if JLSD(10,55,pid) then
				addbuff(eid,WAR.PD['集气倒退'],10,20)	
			end	
		end
		if WAR.NYAR == 3 then
			addbuff(eid,WAR.PD['迟缓状态'],20,40)
			zshurt = zshurt + Qg(WAR.CurID) + Def(WAR.CurID)
		end
		if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"]*0.3 and math.random(100) <= jl then
			zshurt = zshurt + JY.Person[eid]["生命"]
		end
		--黯然大招25
		if WAR.ARJX == 1 then
			for j = 1,#WAR.Debuf10 do
				local yc = WAR.Debuf10[j][1]
				WAR.PD[yc][eid] = 10
			end
			for j = 1,#WAR.Debuf11 do
				local yc = WAR.Debuf11[j][1]
				WAR.PD[yc][eid] = 10
			end
		end
		if WAR.ARJX == 3 then
			for j = 0, WAR.PersonNum-1 do
				if DWPD(j,WAR.CurID) and WAR.Person[j]['死亡'] == false then
					ztd(j, "内力点数", -1000)
				end	
			end
			addbuff(eid,WAR.PD['重度内伤'],10,10)
		end	
		if WAR.ARJX == 5 then
			local n = 0
			for j = 0, WAR.PersonNum-1 do
				if j ~= WAR.CurID and WAR.Person[j]['死亡'] == false and WAR.LQZ[WAR.Person[j]['人物编号']] ~= nil then
					n = n + WAR.LQZ[WAR.Person[j]['人物编号']]
					WAR.LQZ[WAR.Person[j]['人物编号']] = 0
				end
			end
			zshurt = zshurt + n * 10	
		end
	end
	--怒涛黯然
	if wugong == 25 and Curr_NG(pid,252) then
		local a = math.modf((JY.Person[pid]["内力最大值"] * 0.01) + (JY.Person[pid]['内力']*0.1))
		local b = Atk(WAR.CurID) - Atk(enemyid)
		if b < 0 then b = 0 end
		zshurt = zshurt + a + b
		if WAR.PD['黯然・穷途末路'][pid] == 1 then
			local s1 = JY.Person[pid]["生命最大值"]
			local s = math.modf(s1*0.2) 
			zshurt = zshurt + s
		end
		if WAR.PD['黯然・倒行逆施'][pid] == 1 then
			if WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[eid] ~= nil and WAR.SPIRIT[pid] < WAR.SPIRIT[eid] then
				hurtzs1[#hurtzs1+1] = 0.5
			end
		end
		if WAR.PD['黯然・行尸走肉'][pid] == 1 then
			WAR.PD["恐惧状态"][eid] = 1
		end
		if WAR.PD['黯然・六神不安'][pid] == 1 then
			WAR.PD["灵蛇拳"][eid] = 10
			WAR.PD["混乱状态"][eid] = 1
		end	
		if WAR.PD['黯然・饮恨吞声'][pid] == 1 then
			zshurt = zshurt + math.modf(psx(pid,"内力")*0.33)
			WAR.PD["同归状态"][eid] = 1
			if BNJQ(eid) then
				WAR.LQZ[eid] = 0
			else
				nuqi(eid,15)
			end	
		end		
	end
	--降龙26
	if WAR.PD['降龙・见龙在田'][pid] == 1 then 
		zshurt = zshurt + 200
	end
	--擒龙降龙
	if (wugong == 26 and (Curr_NG(pid,204) or match_ID(pid,50))) or ((wugong == 80 and match_ID(pid,764)) and JLSD(20,65,pid)) then 
		hurtzs1[#hurtzs1+1] = 1
		zshurt = zshurt + math.modf(JY.Person[pid]["内力"]/6) + TrueQZ(pid)
		if JLSD(30,60,pid) then
			ztd(enemyid,"内伤点数",33)
			ztd(enemyid,"生命点数",-JY.Person[eid]["受伤程度"]*3)
			Set_Eff_Text(enemyid, "特效文字2", "擒龙傲世・降龙无双")
		end
		if WAR.QLXL == 1 then
			local a = math.modf(JY.Person[pid]["攻击力"])
			local b = math.modf(TrueQZ(pid))
			zshurt = zshurt + a + b
			addbuff(eid,WAR.PD['伤重不治'],8,20)
			addbuff(eid,WAR.PD['破军'],2,10)
			if match_ID(pid,50) and JLSD(20,50,pid) then
				WAR.PD["帝释天临"][pid] = limitX((WAR.PD["帝释天临"][pid] or 0) + 10,0,50)
			elseif JLSD(10,30,pid) then
				WAR.PD["帝释天临"][pid] = limitX((WAR.PD["帝释天临"][pid] or 0) + 10,0,30)
			end
		end
	end
	--擒龙降龙26
	if WAR.QLXL == 2 or (wugong == 26 and match_ID(pid,69) and JLSD(30,60,pid)) then
		hurtzs1[#hurtzs1+1] = 0.2
		addbuff(eid,WAR.PD['重度内伤'],10,10)
		WAR.PD["创伤"][eid] = (WAR.PD["创伤"][eid] or 0) + math.random(3,7)
		if match_ID(pid,69) then
			WAR.PD["降龙尊相"][pid] = limitX((WAR.PD["降龙尊相"][pid] or 0) + 10,0,30)
		elseif JLSD(10,30,pid) then
			WAR.PD["降龙尊相"][pid] = limitX((WAR.PD["降龙尊相"][pid] or 0) + 10,0,30)
		end
	end
	--擒龙降龙26
	if WAR.QLXL == 3 or (wugong == 26 and JXPD(eid,55,1) and JLSD(30,60,pid)) then
		local a = math.modf(JY.Person[pid]["轻功"])
		local b = math.modf(JY.Person[eid]["轻功"])
		local c = math.modf(JY.Person[pid]["轻功"]/3)
		local d = math.modf(JY.Person[pid]["轻功"]/5)
		zshurt = zshurt + a + b
		WAR.PD['集气速度'][pid] = limitX((WAR.PD['集气速度'][pid] or 0) + 5,0,50)
		WAR.PD['长生诀'][pid] = limitX((WAR.PD['长生诀'][pid] or 0) + 5,0,10)
		ztd(WAR.CurID,"生命点数",d)
		ztd(WAR.CurID,"内力点数",c)
		if JXPD(eid,55,1) then
			WAR.PD["四海龙王"][pid] = limitX((WAR.PD["四海龙王"][pid] or 0) + 10,0,30)
		elseif JLSD(10,30,pid) then
			WAR.PD["四海龙王"][pid] = limitX((WAR.PD["四海龙王"][pid] or 0) + 10,0,30)
		end
	end
	--降龙有余不尽
	if WAR.PD['降龙・有余不尽'][pid] == 1 then
		if WAR.YYBJ > 0 then
			local yybj = math.modf(ang/25*WAR.YYBJ)
			zshurt = zshurt + yybj
		end
		zshurt = zshurt + 500
	end
	--九阴降龙
	if wugong == 26 and QFZH(pid,26,107) then 
		if JLSD(30,60,pid) then
			local aa = JY.Person[eid]["受伤程度"] + JY.Person[eid]["冰封程度"] 
			ztd(enemyid,"内伤点数",15)
			hurtzs1[#hurtzs1+1] = 0.5
			zshurt = zshurt + math.modf(aa*10)
			WAR.PD["降龙虚劲"][eid] = (WAR.PD["降龙虚劲"][eid] or 0) + 1
			Set_Eff_Text(enemyid, "特效文字2", "降龙虚劲")
		end
		if JLSD(30,60,pid) then
			local sm = math.modf(JY.Person[eid]["受伤程度"] + JY.Person[eid]["封穴程度"])*6
			WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(1,5)
			WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0) + 6,0,30)
			WAR.PD['虚弱状态'][eid] = limitX((WAR.PD['虚弱状态'][eid] or 0) + 6,0,30)
			ztd(enemyid,WAR.FXXS,6)
			ztd(enemyid,"生命点数",-sm)
			WAR.PD['时序闪避'][pid] = (WAR.PD['时序闪避'][pid] or 0) + 6
			Set_Eff_Text(enemyid, "特效文字2", "六龙回旋")
		end
		if JLSD(20,50,pid) then
			ztd(WAR.CurID,'内力点数',-300)
			local a = JY.Person[eid]["受伤程度"]
			ztd(enemyid,"内伤点数",10)
			hurtzs1[#hurtzs1+1] = a*0.07
			Set_Eff_Text(enemyid, "特效文字2", "沧龙出海")
		end
		if JLSD(20,50,pid) then
			if WAR.ATNum < 3 then
				WAR.ATNum = 3
			end
			ztd(enemyid,"生命点数",-300)
			if WAR.PD["刚柔混劲"][eid] == nil then
				WAR.PD["刚柔混劲"][eid] = 10
			end
			Set_Eff_Text(enemyid, "特效文字2", "长江三叠浪")
		end
		if WAR.PD["降龙尊相"][pid] ~= nil then --降龙尊相
			addbuff(eid,WAR.PD['玄铁剑创'],5)
			ztd(enemyid,"体力点数",-5)
		end
		if WAR.BHXL == 1 then
			if JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"] and math.random(100) <= 40 then
				zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]*0.2)
			end
		end
		if WAR.BHXL == 2 then
			ztd(enemyid,"体力点数",-10)
			local a = math.modf((JY.Person[pid]["体力"] - JY.Person[eid]["体力"])/100)
			hurtzs1[#hurtzs1+1] = a + 1
			WAR.PD['噬魂'][eid] = 1
		end
		if WAR.BHXL == 3 then
			ztd(enemyid,WAR.FXXS,20)
			local a = math.modf(psx(eid,"封穴程度")*10)
			zshurt = zshurt + a
			ztd(WAR.CurID,"生命点数",(a * 0.25))
			ztd(WAR.CurID,"体力点数",5)
			WAR.PD['锁喉1'][pid] = 5
			WAR.PD['锁喉'][eid] = 10
			WAR.PD["忘情我无"][eid] = 10
			WAR.ZTHF[pid] = 5
		end
		if WAR.BHXL == 4 then
			ztd(enemyid,"内伤点数",20)
			local a = math.modf(psx(eid,"受伤程度")*10)
			zshurt = zshurt + a
			WAR.HLZB = 1
			WAR.PD["荒龙爆"][eid] = limitX((WAR.PD["荒龙爆"][eid] or 0) + 1,0,10)
		end
	end
	--进阶云雾，对于半血以下敌人伤害
    if wugong == 32 and WYJJ(pid) then
		if JY.Person[eid]["生命"]<JY.Person[eid]["生命最大值"] / 2 then
			hurtzs1[#hurtzs1+1] = 1
		end
    end
	--金乌映雪,使用雪山剑法或者金乌刀法攻击附加冰封+灼烧的伤害
	if WGZH(pid,35,61) and (wugong == 35 or wugong == 61) then 
		local a = math.modf(JY.Person[eid]["灼烧程度"] * 2)
		local b = math.modf(JY.Person[eid]["冰封程度"] * 2)
		zshurt = zshurt + a + b
	end
	--北斗空明
	if wugong == 39 and WGZH(pid,15,39) then	
		local a = math.modf(JY.Person[pid]["内力"]/5000)
		local b = math.modf(JY.Person[pid]["攻击力"]/3)
		hurtzs1[#hurtzs1+1] = a
		if JLSD(20,60,pid) then
			ztd(enemyid,"生命点数",-b)
			WAR.PD["无明业火"][eid] = 20
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"内力点数",-b)
				end
			end
			Set_Eff_Text(enemyid, "特效文字3","九天之上・运转七星")
		end
	end
	--全真剑法
	if wugong == 39 and WAR.QZJF > 0 then
		zshurt = zshurt + 777
		if WAR.QZJF == 1 then
			local a = math.modf(TrueYJ(pid)*0.33 + JY.Person[pid]["内力"]*0.17)
			zshurt = zshurt + a
			WAR.JuHuo = 1
		end
		if WAR.QZJF == 2 then
			local a = math.modf(TrueYJ(eid)*0.33 + JY.Person[eid]["内力"]*0.17)
			zshurt = zshurt + a
			WAR.PD['昏迷状态'][eid] = 1	
		end
		if WAR.QZJF == 3 then
			local a = math.modf(JY.Person[pid]["内力"] * 0.17+JY.Person[eid]["内力"]*0.17)
			zshurt = zshurt + a
			for j = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD["冰冻状态"][tmppid] = (WAR.PD["冰冻状态"][tmppid] or 0) + math.random(20,30)
					if WAR.PD["冰冻状态"][tmppid] ~= nil and WAR.PD["冰冻状态"][tmppid] > 30 then
						WAR.PD["利刃寒锋"][tmppid] = (WAR.PD["利刃寒锋"][tmppid] or 0) + 10
					end	
				end 
			end
		end
	end
	--全真剑气
	if wugong == 39 then 
		if PersonKF(pid,100) or MPTX(pid,16,2) then
			zshurt = zshurt + 777
		end
		if WAR.QZ_QXJF > 0 then
			zshurt = zshurt + math.modf(JY.Person[pid]["生命"]*0.77+JY.Person[eid]["生命"]*0.49)
			if WAR.QZ_QXJF == 7 then
				WAR.PD['霸王破甲'][eid] = (WAR.PD['霸王破甲'][eid] or 0) + 10
				WAR.PD['脆弱状态'][eid] = 2
			end
		end
	end
	--全真玉女左右互搏触发伤害翻倍
	if (wugong == 39 or wugong == 42 and wugong == 139) and (WAR.YNSX > 0 or WAR.QZJF > 0) and WAR.ZYHB > 0 then
		hurtzs1[#hurtzs1+1] = 1*WAR.ZYHB
	end
	--玉女素心剑法
	if (wugong == 42 or wugong == 139) and WAR.YNSX > 0 then
		ztd(enemyid,"生命点数",-JY.Person[eid]["冰封程度"]*WAR.YNSX)
		if WAR.YNSX == 1 then
			local a = Qg(WAR.CurID)
			zshurt = zshurt + a
			ztd(enemyid,"内伤点数",5)
		end
		if WAR.YNSX == 2 then
			local a = TrueYJ(pid)
			zshurt = zshurt + a
			WAR.KHBX = 2
			WAR.WS = 1
		end
		if WAR.YNSX == 3 then
			ztd(enemyid,WAR.BFXS,50)
			zshurt = zshurt + math.modf(psx(eid,"冰封程度")*math.random(5,10))
			WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.modf(JY.Person[eid]["冰封程度"]/5)
			WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + math.modf(psx(eid,"冰封程度")*0.5)
		end
		if WAR.YNSX == 4 then
			zshurt = zshurt + math.random(300,1500)
			if JY.Person[eid]["受伤程度"] >= 50 then 
				WAR.PD['昏迷状态'][eid] = 1
			end	
		end
		if WAR.YNSX == 5 then
			local a = math.modf((JY.Person[eid]["内力"] + JY.Person[pid]["攻击力"])/ 30)
			zshurt = zshurt + a * 10 
			WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0) + 15,0,50)
		end
		if WAR.YNSX == 6 then
			if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] >= 0 then
				hurtzs1[#hurtzs1+1] = WAR.LQZ[eid]/100
				if BNJQ(eid) then
					nuqi(eid,-20)
					WAR.PD['混乱状态'][eid] = 1
				end
			end
		end
	end		
	--玉女素心剑
	if wugong == 139 and ((PersonKF(pid,100) and PersonKF(pid,154)) or match_ID(pid,605)) then
		zshurt = zshurt + math.modf(TrueYJ(pid)*2)
		if WAR.ZYHB > 0 and (JLSD(10,45,pid) or ZYHBPD(pid) == 2) then
			zshurt = zshurt + math.modf(TrueYJ(pid)*2)
			WAR.TGJF = 1
		end	
	end
	--玄铁剑魔再临45
	if Cat('剑魔再临',pid,wugong) then
		local zs = math.modf(ang/9)*(psx(pid,"生命增长")-psx(eid,"生命增长"))
		if zs < 1 then
			zs = 1
		end
		zshurt = zshurt + zs
		local jl = 20
		if match_ID(pid,58) or match_ID(pid,530) or PersonKF(pid,252) then
			jl = jl + 20
		end
		if match_ID(pid,592) then
			jl = jl + 30
		end
		if JLSD(0,jl,pid) then
			local a = TrueYJ(pid)+JY.Person[eid]["受伤程度"]
			ztd(enemyid,"内伤点数",100)
			zshurt = zshurt + a
			WAR.KMZWD = 1
			Set_Eff_Text(enemyid, "特效文字3","大巧不工")
		end
		if JLSD(0,jl,pid) then
			local a = math.modf(ang * 0.3 + JY.Person[pid]["内力"] * 0.07)
			zshurt = zshurt + a
			ztd(enemyid,"生命点数",-math.modf(JY.Person[eid]["生命最大值"] * 0.02))
			local x1 = WAR.Person[WAR.CurID]["坐标X"];
			local y1 = WAR.Person[WAR.CurID]["坐标Y"];
			for ex = x1 - 9, x1 + 9 do
				for ey = y1 - 9, y1 + 9 do
					SetWarMap(ex, ey, 4, 1)
					if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
						local ep = GetWarMap(ex, ey, 2)
						if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
							WAR.PD["麻痹状态"][WAR.Person[ep]["人物编号"]] = math.random(10);
							SetWarMap(ex, ey, 4, 4)	
						end
					end
				end
			end	
			Set_Eff_Text(enemyid, "特效文字3","重剑无锋")
		end
	end
	--怒涛玄铁
	if WAR.XTZJ == 1 then
		addbuff(eid,WAR.PD['玄铁剑创'],12)
		addbuff(eid,WAR.PD['麻痹状态'],2)
		hurtzs1[#hurtzs1+1] = 1
		local a = math.modf(TrueYJ(pid) * 0.2)
		local b = math.modf(JY.Person[pid]["体力"] * 20)
		ztd(enemyid,WAR.FXXS,math.random(5,10))
		ztd(WAR.CurID,"生命点数",a)
		ztd(WAR.CurID,"内力点数",b)
	end	
	--怒涛玄铁
	if (wugong == 45 and (match_ID(pid,58) or match_ID(pid,530) or PersonKF(pid,252)) and JLSD(10,40,pid)) or (match_ID(pid, 592) and JLSD(20,70,pid)) then
		local qg = math.modf(ang/10)
		local x1 = WAR.Person[WAR.CurID]["坐标X"];
		local y1 = WAR.Person[WAR.CurID]["坐标Y"];
		for ex = x1 - 9, x1 + 9 do
			for ey = y1 - 9, y1 + 9 do
				SetWarMap(ex, ey, 4, 1)
				if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
					local ep = GetWarMap(ex, ey, 2)
					if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
						ztd(ep,"生命点数",-qg)
						ztd(ep,"内力点数",-qg)
						SetWarMap(ex, ey, 4, 4)	
					end
				end
			end
		end
	end
	--怒涛玄铁
	if (wugong == 45 and (match_ID(pid,58) or match_ID(pid,530) or PersonKF(pid,252)) and JLSD(10,40,pid)) or (match_ID(pid, 592) and JLSD(20,70,pid)) then
		WAR.BTZT[pid] = 1
		WAR.PD["混乱状态"][eid] = 1
		if WAR.ATNum < 4 then
			WAR.ATNum = math.random(4,5)
		end
		Set_Eff_Text(enemyid, "特效文字3","玄铁重剑・横削")
	end
	--怒涛玄铁
	if (wugong == 45 and (match_ID(pid,58) or match_ID(pid,530) or PersonKF(pid,252)) and JLSD(10,40,pid)) or (match_ID(pid, 592) and JLSD(20,70,pid)) then
		WAR.BFX = 1
		addbuff(eid,WAR.PD['气阻中门'],5)
		WAR.PD["封气绝脉"][eid] = 1
		Set_Eff_Text(enemyid, "特效文字1","玄铁重剑・逆挑")
	end
	--太极功太极剑
	if (wugong == 46 and PersonKF(pid,171)) or match_ID(pid,5) then	
		hurtzs1[#hurtzs1+1] = 0.3
		zshurt = zshurt + 150
		if JLSD(10,40,pid) then
			WAR.PD['恐惧状态'][eid] = 1
			local aa = math.modf(JY.Person[eid]["内力"]/15) 
			ztd(enemyid,"内力点数",-aa)
			Set_Eff_Text(enemyid,1,"意在剑先・连绵不绝")
		end
	end
	--太极拳剑
	if (wugong == 46 and PersonKF(pid,16)) or match_ID(pid,5) then
		if JLSD(20,50,pid) then
			JY.Person[pid]["受伤程度"] = math.floor(JY.Person[pid]["受伤程度"] / 3)
			ztd(WAR.CurID,"生命点数",300)
			Set_Eff_Text(WAR.CurID, "特效文字3","太极奥义・意气相融")
		end
		if JLSD(30,70,pid) then
			zshurt = zshurt + 150
			ztd(enemyid,WAR.LXXS,8)
			ztd(enemyid,WAR.FXXS,5)
			Set_Eff_Text(enemyid, "特效文字3","太极奥义・剑劲")
		end
	end
	--独孤九剑47
	if Cat('九剑真传',pid,wugong) then
		local a = JY.Person[pid]["实战"]*2
		zshurt = zshurt + a
		if WAR.DGJY[pid] ~= nil and WAR.DGJY[pid] > 0 then
			local dg = WAR.DGJY[pid] or 0
			local dg2 = (WAR.DGJY[pid] or 0) / 10
			zshurt = zshurt + 100 * dg
			hurtzs1[#hurtzs1+1] = dg
		end
		if WAR.PJS == 1 then
			addbuff(eid,WAR.PD['创伤'],9,20)
			addbuff(eid,WAR.PD['血流不止'],9,20)
			if JY.Person[eid]["流血程度"] > 0 then
				ztd(enemyid,'生命点数',-(math.random(2,5)*math.modf(JY.Person[eid]["受伤程度"])))
			else
				ztd(enemyid,'生命点数',-(math.random(1,3)*math.modf(JY.Person[eid]["受伤程度"])))
			end
		end
		if WAR.POISON == 1 then
			if match_ID(pid,592) then
				addbuff(eid,WAR.PD['九剑破尽'],29)
			else
				addbuff(eid,WAR.PD['九剑破尽'],9)
			end
		end
		if WAR.JJZC == 2 then
		    if nokillspeed(enemyid) == false then
			    ztd(enemyid,'集气位置',-200)
		    end	
	    end
		if WAR.JJZC == 3 then
			hurtzs1[#hurtzs1+1] = 0.2 
		end
	end
	--葵花辟邪
	if wugong == 48 and (Curr_NG(pid,105) or JXPD(pid,19,1)) then 
		local a = WAR.ACT*(WAR.JQSDXS[pid] or 1)*3
		zshurt = zshurt + a
		if JLSD(0,40,pid) then
			WAR.ATNum = WAR.ATNum + 1
			local str = ""
			local a = math.random(1,3)
			if a == 1 then
				zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]*0.015)
				WAR.PD['辟邪断刃'][eid] = 30
				str = "・飞燕穿柳"
			elseif a == 2 then
				ztd(enemyid,"内力点数",-math.modf(JY.Person[eid]["内力"] * 0.15))
				zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]*0.015)
				WAR.PD['辟邪破甲'][eid] = 30
				str = "・锺馗抉目"
			elseif a == 3 then
				if JY.Person[eid]["生命"] > math.modf(JY.Person[eid]["生命最大值"] * 0.5) then
					ztd(enemyid,"生命点数",-math.modf(JY.Person[eid]["生命最大值"] * 0.1))
					zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"] * 0.02)
				else
					WAR.PD['虚弱状态'][eid] = limitX((WAR.PD['虚弱状态'][eid] or 0) + 5,0,30)
					zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"] * 0.02)
				end
				str = "・群邪辟易"
			end	
			Set_Eff_Text(enemyid, "特效文字2","辟邪剑诀"..str,399)
		end
		if JLSD(0,40,pid) then 
			local str = ""
			local a = math.random(1,4)
			if a == 1 then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
						WAR.PD['神兵'][WAR.Person[j]["人物编号"]] = 30 
					end 
				end 
				str = "・紫气东来"	
			elseif a == 2 then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						WAR.PD['脆弱状态'][WAR.Person[j]["人物编号"]] = limitX(( WAR.PD['脆弱状态'][WAR.Person[j]["人物编号"]] or 0) + 1,0,5)
					end
				end	
				str = "・江上弄笛"	
			elseif a == 3 then
				if WAR.SHJL[pid] ~= nil then
					zshurt = zshurt + math.modf(WAR.SHJL[pid] * 0.3)
				end
				str = "・直捣黄龙"	
			elseif a == 4 then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false then
						local tmppid = WAR.Person[j]["人物编号"]
						if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
							ztd(j,"生命点数",math.random(50,150))
						end
					end
				end	
				str = "・扫荡群魔"			
			end
			Set_Eff_Text(enemyid, "特效文字1","辟邪剑诀"..str)
		end	
	end
	--辟邪招式48
	if WAR.BXZS == 2 then
		zshurt = zshurt + 100
	end
	if WAR.BXZS == 3 then
		WAR.PD["虚弱状态"][eid] = 20
		Set_Eff_Text(enemyid,3,"飞燕穿柳",80)
	end
	if WAR.BXZS == 5 then
		WAR.PD["扫荡群魔"][eid] = 30
		Set_Eff_Text(enemyid,3,"扫荡群魔",80)
	end
	--六脉一阳
	if (wugong == 49 and WGZH(pid,17,49)) or match_ID(pid,499) then
		local a = TrueZF(pid)
		local b = TrueYJ(pid)
		zshurt = zshurt + a + b
		if JLSD(10,50,pid) then
			for j = 0, WAR.PersonNum - 1 do 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if nokillspeed(j) == false then
						ztd(j,'集气位置',-100)
					end	
					ztd(j,'生命点数',-66)
				end
			end
			Set_Eff_Text(enemyid, "特效文字3","六脉指劲・急如电闪")
		end
		if JLSD(10,50,pid) then
			for j = 0, WAR.PersonNum - 1 do 
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,WAR.FXXS,math.random(6,11))
					WAR.PD["点穴大师2"][eid] = 1
				end
			end
			Set_Eff_Text(enemyid, "特效文字2","六脉指劲・迅猛绝伦")
		end
	end
	--六脉神剑49
	if WAR.LMJQ > 0 then	
		local a = math.modf(JY.Person[pid]["攻击力"]*0.1) 
		hurtzs1[#hurtzs1+1] = 5
		ztd(enemyid,'生命点数',-a)
		ztd(enemyid,WAR.FXXS,6)
		WAR.LMJF[eid] = 20
		if WAR.LMJQ == 1 then
			local a = math.modf(TrueZF(pid)*0.33)
			local b = JY.Person[eid]["受伤程度"]
			local c = a + b 
			ztd(enemyid,"内伤点数",25)
			zshurt = zshurt + (a * 2)
			WAR.PD['必冰封'][pid] = 1
			ztd(enemyid,'生命点数',-c)
		end 
		if WAR.LMJQ == 2 then
			local a = JY.Person[eid]["受伤程度"] * 2
			local b = a * 6
			zshurt = zshurt + (a * 2)
			ztd(enemyid,'内力点数',-b)
			WAR.PD['必灼烧'][pid] = 1
		end 
		if WAR.LMJQ == 3 then
			local a = JY.Person[pid]["内力"]
			local b = JY.Person[pid]["生命"]
			local c = math.modf((a + b) / 66)
			ang = ang + a
			zshurt = zshurt + c * 50
			ztd(enemyid,WAR.LXXS,c)
			ztd(enemyid,'生命点数',-c)
		end 
		if WAR.LMJQ == 4 then	
			local a = JY.Person[eid]["冰封程度"] * 6
			local b = JY.Person[eid]["灼烧程度"] * 6
			local c = a + b
			zshurt = zshurt + c
			ztd(enemyid,'生命点数',-(c / 5))
		end 
		if WAR.LMJQ == 5 then 
			local a = JY.Person[eid]["冰封程度"] * 5
			ztd(enemyid,'生命点数',-a)
			hurtzs1[#hurtzs1+1] = 1
			WAR.PD["恐惧状态"][eid] = 1		
			WAR.PD['利刃寒锋'][eid] = limitX((WAR.PD['利刃寒锋'][eid] or 0) + 10,0,50)
		end 
		if WAR.LMJQ == 6 then 
			local a = JY.Person[eid]["灼烧程度"] * 5
			ztd(enemyid,'生命点数',-a)
			hurtzs1[#hurtzs1+1] = 1
			WAR.PD['举火燎原'][eid] = 20		
			WAR.PD['沉睡状态'][eid] = 1
		end	
	end
	--六脉神剑大招
	if WAR.LMAY == 1 then
		local a = math.modf(JY.Person[pid]["内力最大值"]/6)
		local b = math.modf(JY.Person[pid]["内力"]/6)
		local c = math.modf(JY.Person[pid]["指法技巧"])
		local d = math.modf(JY.Person[eid]["指法技巧"]/2)
		local e = math.modf(JY.Person[eid]["内力"]/6)
		local f = math.abs(a-e)
		local g = math.abs(c-d)
		local sh = f + g
		zshurt = zshurt + b
		ztd(enemyid,'生命点数',-sh)
	end
	if WAR.DSP_LM4 == 1 then
        local lm4 =  math.random(3)
		if lm4 == 1 then
            WAR.PD["昏迷状态"][eid] = 1
        end
        if lm4 == 2 then
            WAR.PD["锁足状态"][eid] = 1
        end
        if lm4 == 3 then
            WAR.PD["虚弱状态"][eid] = 35
        end 
    end
	--万劫不复・万劫刀法攻击
	if wugong == 51 and WGZH(pid,51,56) then
		zshurt = zshurt + 500
		if JLSD(30,70,pid) then
			ztd(enemyid,"内伤点数",8)
			ztd(enemyid,"中毒点数",8)
			ztd(enemyid,WAR.BFXS,8)
			WAR.PD["无明业火"][eid] = (WAR.PD["无明业火"][eid] or 0) + math.random(15)
			Set_Eff_Text(enemyid, "特效文字3","万劫不复・沉沦")
		end
	end
	--南山黄沙
	if wugong == 53 and WGZH(pid,53,78) then
		if WAR.ACT == 1 then
			if WAR.ATNum < 2 then
				WAR.ATNum = 2
			end
		end
		if JLSD(20,60,pid) then
			zshurt = zshurt + math.modf(ang*0.25)
			Set_Eff_Text(enemyid, "特效文字3","南山樵子・燕子入巢")
		end
		if JLSD(20,60,pid) then
			local a = JY.Person[eid]["受伤程度"]/100
			ztd(enemyid,"内伤点数",5)
			hurtzs1[#hurtzs1+1] = a
			Set_Eff_Text(enemyid, "特效文字3","南山樵子・燕子离巢")
		end
	end	
	--混元狂风刀
	if (wugong == 55 and (PersonKF(pid,90) or PersonKF(pid,375) or match_ID(pid,29))) 
	or (wugong == 78 and (PersonKF(pid,90) or PersonKF(pid,375)) and PersonKF(pid,55)) then
		local a = math.modf(TrueSD(pid)/6)
		zshurt = zshurt + a
		ztd(enemyid,"内伤点数",10)
		ztd(enemyid,"生命点数",-75)
		ztd(enemyid,"内力点数",-100)
		ztd(enemyid,"体力点数",-1)
		if JLSD(30,60,pid) then
			WAR.PD['必杀气'][pid] = 1
			local s = 1000 + JY.Person[pid]["内力"] - JY.Person[eid]["内力"];
			if s < 0 then
				s = 0;
			end
			ang = ang + s
			ztd(enemyid,"内伤点数",20)
			if JY.Person[eid]["流血程度"] < 50 then
				JY.Person[eid]["流血程度"] = 50
			else
			    ztd(enemyid,WAR.LXXS,20)
			end
			Set_Eff_Text(enemyid,"特效文字0","狂风刀法・斩")	
		end
	end
	--狂风黄沙55你是风儿我是沙，攻击时伤害一*130%
    if WAR.NSFEWSS == 1 then
        hurtzs1[#hurtzs1+1] = 0.3
    end
	--黄天无极
    if PersonKF(pid,78) and Curr_QG(pid,148) and PersonKF(pid,148) and WAR.PD["氤氤氲氲"][pid]~= nil then
		local a = (WAR.PD['氤氤氲氲'][pid] or 0)/ 100
		hurtzs1[#hurtzs1+1] = a
	end
	--黄天无极・响蛇鸣
	if WAR.HTSFX == 1 then
		for j = 0, WAR.PersonNum - 1 do
		local tmppid = WAR.Person[j]["人物编号"]
		local a = math.modf(Qg(WAR.CurID)/3)
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				ztd(j,"生命点数",-a)
				WAR.XWSD[tmppid] = 1
			end
		end
	end
	--黄天无极・蝎尾针
	if WAR.HTSFX == 2 then
		local a = math.modf(JY.Person[eid]["防御力"])
		zshurt = zshurt + a
		WAR.PD['霸王破甲'][eid] = 18
	end
	--黄天无极・沙蜥噬
	if WAR.HTSFX == 3 then
		local a = math.modf(JY.Person[eid]["攻击力"])
		zshurt = zshurt + a
		addbuff(eid,WAR.PD['禁疗'],5,10)
	end
	--黄天无极・风掠境
	if WAR.HTZRL == 1 then
		local a = math.modf(JY.Person[eid]["轻功"]/5)
		ztd(enemyid,"生命点数",-a)
		ztd(enemyid,WAR.BFXS,20)
		WAR.PD['创伤'][eid] = 18
	end
	--黄天无极・沙弥漫
	if WAR.HTZRL == 2 then
		local a = math.modf(JY.Person[eid]["流血程度"]/10)
		ztd(enemyid,"体力点数",-a)
		ztd(enemyid,WAR.LXXS,20)
		addbuff(eid,WAR.PD['力竭'],1,3)
	end
	--黄天无极・水枯竭
	if WAR.HTZRL == 3 then
		local a = math.modf(JY.Person[eid]["灼烧程度"]*20)
		ztd(enemyid,"内力点数",-a)
		ztd(enemyid,WAR.ZSXS,20)
		WAR.PD['举火燎原'][eid] = 20
		WAR.PD['无明业火'][eid] = 20
	end
	--万劫不复・奇门刀法攻击
	if wugong == 56 and WGZH(pid,51,56) then
		zshurt = zshurt + JY.Person[eid]["耍刀技巧"]
		if JLSD(30,70,pid) then
			ztd(enemyid,WAR.ZSXS,8)
			ztd(enemyid,WAR.FXXS,4)
			ztd(enemyid,WAR.LXXS,8)
			WAR.PD['创伤'][eid] = (WAR.PD['创伤'][eid] or 0) + 10
			Set_Eff_Text(enemyid, "特效文字3","万劫不复・深渊")
		end	
	end
	--奇门剪刀
	if wugong == 56 and WGZH(pid,56,75) then
		zshurt = zshurt + JY.Person[pid]["耍刀技巧"]
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["耍刀技巧"]
			local b = JY.Person[pid]["耍刀技巧"]
			local c = a + b 
			ztd(enemyid,"生命点数",-c)
			WAR.PD['虚弱状态'][eid] = 20
			WAR.PD["伤重不治"][eid] = (WAR.PD["伤重不治"][eid] or 0) + 10
			Set_Eff_Text(enemyid, "特效文字3","奇门五行・虚弱")
		end
	end
	--慈悲大智
	if WGZH(pid,57,133) then 
		local a = JY.Person[pid]["内力"]/20
		zshurt = zshurt + a
		local jl = JY.Person[pid]["品德"]*0.3
		if JLSD(20,50 + jl,pid) then
			ztd(enemyid,WAR.FXXS,10)
			WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(3)
			Set_Eff_Text(enemyid, "特效文字3","龙树菩萨・慈悲")
		end
		if JLSD(20,50 + jl,pid) then
			ztd(enemyid,"内伤点数",15)
			WAR.PD["利刃寒锋"][eid] = 15
			Set_Eff_Text(enemyid, "特效文字3","龙树菩萨・大智")
		end
	end
	--紫霞修罗刀
	if wugong == 58 and (PersonKF(pid,160) or PersonKF(pid,89)) then 
		if WAR.LQZ[pid] ~= nil then
			WAR.PD['必杀气'][pid] = 1
			zshurt = zshurt + math.modf(WAR.LQZ[pid] or 0)*3
			ang = ang + math.modf((WAR.LQZ[pid] or 0)*100)
			if ang > 5000 then ang = 5000 end
		else
			ang = ang + 2500
		end
		if PersonKF(pid,160) then --天魔修罗刀
			local a = (JY.Person[pid]["生命"] + JY.Person[pid]["生命最大值"])/20
			zshurt = zshurt + a
		end
	end
	--天魔修罗刀
	if ((wugong == 58 and PersonKF(pid,160)) or (MPTX(eid,6,2) and (wugong == 58 or wugong == 63 or wugong == 66))) and hurt > 0 then
		if WAR.PD['鬼禅六断'][pid] ~= nil and WAR.PD['鬼禅六断'][pid] > 0 then
			zshurt = zshurt + (WAR.PD['鬼禅六断'][pid] or 0)
		end
	end
	--穿山虎铁臂神拳
	if WGZH(pid,59,232) then
		if WAR.PD['穿山虎铁臂神拳'][pid] == 1 then
			zshurt = zshurt + 100
		end
		WAR.PD['穿山虎铁臂神拳'][pid] = nil
	end
	--太玄金乌61
	if WAR.JWDF == 4 then
		local a = math.modf(JY.Person[pid]["内力"] * 1.5)
		zshurt = zshurt + a
		ztd(enemyid,WAR.LXXS,10)
	end
	--太玄金乌
	if WAR.JWDF == 5 then
		zshurt = zshurt + TrueSD(pid)
		local a = JY.Person[eid]["攻击力"]
		ztd(enemyid,"内力点数",-a)
		ztd(enemyid,"内伤点数",15)
		if JY.Person[eid]["受伤程度"] >= 100 then 
			JY.Person[eid]["受伤程度"] = 150
			WAR.PD["伤重不治"][eid] = (WAR.PD["伤重不治"][eid] or 0) + 10
			addbuff(eid,WAR.PD['重度内伤'],10,10)
		end
	end 
	--冰火夫妻刀
	if WAR.FQDF == 2 then 
		local a = math.modf(TrueSD(eid) / 2)
		ztd(WAR.CurID,"内力点数",a)
		ztd(WAR.CurID,"生命点数",a)
	end
	--冰火夫妻刀
	if WAR.FQDF == 3 then
		local a = math.modf(TrueSD(pid) / 3)
		ztd(WAR.CurID,"内力点数",-a)
		zshurt = zshurt + a * 3
	end
	--冰火夫妻刀
	if WAR.FQDF == 4 then
		zshurt = zshurt + 200
		ztd(enemyid,"内伤点数",5)
		if JY.Person[eid]["受伤程度"] >= 30 then
			WAR.PD['昏迷状态'][eid] = 1
		end	
	end
	--冰火夫妻刀
	if WAR.FQDF == 5 then 
		zshurt = zshurt + 200
		if JY.Person[eid]["流血程度"] >= 30 then
			WAR.PD['举火燎原'][eid] = math.random(3,10)
		end
	end
	--冰火夫妻刀
	if WAR.FQDF == 6 then 
		local a = JY.Person[eid]["攻击力"]
		local b = JY.Person[pid]["攻击力"] 
		local c = (a + b) / 6
		zshurt = zshurt + c
	end
	--纯阳玄虚
	if (wugong == 64 and PersonKF(pid,99)) or (yongdao(wugong) and MPTX(pid,4,3) and PersonKF(pid,99)) or match_ID(pid,5) then
		local a = JY.Person[pid]["轻功"]/3
		zshurt = zshurt + a
		if JLSD(20,50,pid) then
			ztd(enemyid,"生命点数",-JY.Person[eid]["受伤程度"]*2)
			WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + 10
			Set_Eff_Text(enemyid, "特效文字3","纯阳玄虚・镜花水月")
		end
	end
	--蓝烟清：燃木刀法，普通内功加力额外增加伤害
	if wugong == 65 and WAR.NGJL > 0 then
		zshurt  = zshurt + math.modf(JY.Wugong[WAR.NGJL]["攻击力10"]/12);
	end
	--火焰刀九爪
	if wugong == 66 and WGZH(pid,11,66) then	
		zshurt = zshurt + 500
		if JLSD(20,60,pid) then
			local a = JY.Person[eid]["受伤程度"]
			local b = JY.Person[eid]["灼烧程度"]
			local c = (a + b)*9
			for j = 0, WAR.PersonNum - 1 do
				local tmpid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"内伤点数",100)
					ztd(j,WAR.ZSXS,100)
				end
			end
			ztd(enemyid,"生命点数",-c)
			Set_Eff_Text(enemyid, "特效文字3","缥缈虚无・纯阳无极")
		end
	end
	--龙象火焰刀
	if wugong == 66 and ((Curr_NG(pid,103) or match_ID(pid,103)) or match_ID(pid,771)) then
		local a = math.modf((JY.Person[pid]["内力"] + JY.Person[pid]["内力最大值"])/40)
		local ss = JY.Person[eid]["受伤程度"] + JY.Person[eid]["封穴程度"]
		zshurt = zshurt + a + ss
		if WAR.HYDNJ > 0 then
			local hdq = math.modf(TrueSD(pid)*WAR.HYDNJ/5)
			zshurt = zshurt + hdq
		end
	end
	--龙象火焰刀
	if wugong == 66 and ((PersonKF(pid,103) or match_ID(pid,103)) or match_ID(pid,771)) then
		if WAR.HYDQJ == 1 and DWPD(WAR.CurID,enemyid) then
			WAR.HYDJ[100 + eid] = 1
			if WAR.HYDJ[200 + eid] == nil then
				WAR.HYDJ[200 + eid] = 0
			end
		end
		if (WAR.HYDJ[100 + eid] == 1 or WAR.HYDJ[200 + eid] == 1) and WAR.ACT == 1 then 
			local a = 0 
			if WAR.HYDQ[eid] ~= nil and WAR.HYDQ[eid] > 0 then 
				a = WAR.HYDQ[eid]
			end
			ztd(enemyid,"生命点数",-math.modf(100*(1+a*0.1)))
			Set_Eff_Text(enemyid, "特效文字2", "火焰刀气",58)
		end
	end
	--刀剑归真67，攻击时伤害一*140%
    if WAR.DJGZ == 1 then
        hurtzs1[#hurtzs1+1] = 0.4
    end
	--胡刀三刀
	if wugong == 67 and (Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350) or match_ID(pid,633) or JXPD(pid,1,1)) then
		zshurt = zshurt + math.modf(TrueSD(pid)*(WAR.SPIRIT[pid] or 0)*0.02)
		if WAR.PD['暴流破'][pid] ~= nil and JLSD(10,40,pid) then
			zshurt = zshurt + WAR.PD['暴流破'][pid]
			WAR.PD['暴流破'][pid] = nil
		end	
		if WAR.Defup[pid] ~= nil then
			WAR.PD['狱龙破'][eid] = limitX((WAR.PD['狱龙破'][eid] or 0)+math.random(3,6),0,24)
		end	
		if WAR.PD['天生牙'][pid] == 2 and psx(eid,'生命') <= 100 and math.random(100) > 85 then
			local a = math.modf(zshurt*0.5)
			for j = 0, WAR.PersonNum-1 do
				if DWPD(WAR.CurID,j) and WAR.Person[j]['死亡'] == false then
					ztd(j,'生命点数',math.modf(a*0.5))
					ztd(j,'内力点数',a)
				end
			end
			hurtzs1[#hurtzs1+1] = -0.95
			Set_Eff_Text(enemyid,3,'天生牙・仁慈之刀')
		end	
		if WAR.PD['苍龙破'][pid] ~= nil then
			if WAR.PD['狱龙破'][eid] ~= nil then
				local yc = {'受伤程度','流血程度','封穴程度','冰封程度','灼烧程度','中毒程度'}
				zshurt = zshurt + math.modf(psx(eid,yc[math.random(6)])*WAR.PD['狱龙破'][eid])
			end	
			if BNJQ(pid) then
				zshurt = zshurt + math.modf(WAR.PD['苍龙破'][pid]*WAR.LQZ[pid]*(WAR.PD['狱龙破'][eid] or 1))
				Set_Eff_Text(enemyid,1,'天生牙・苍龙破')
			end	
		end	
		if WAR.PD['狱龙破'][eid] ~= nil then
			zhanyi(eid,-math.random(3,5))
			if JLSD(10,65,pid) then
				nuqi(eid,-10)
				ztd(enemyid,WAR.LXXS,20)
			end	
			if NQBF(eid) then
				zhanyi(eid,-30)
				WAR.PD['五蕴炽盛'][eid] = 1
				WAR.PD['头晕目眩'][eid] = 1
				WAR.PD['神教逆杀'][eid] = 10
				Set_Eff_Text(enemyid,1,'丛云牙・狱龙破')
			end	
		end	
		if WAR.PD['铁碎牙'][pid] ~= nil then
			local tsyzs = {'血玉牙破','龙麟牙破','金刚枪破'}
			local aa = math.random(3,5)
			local bb = math.random(3)
			local a1 = math.modf(JY.Person[pid]["内力最大值"]*aa)
			local a2 = math.modf(JY.Person[pid]["内力"]*aa)
			local a3 = math.modf(JY.Person[eid]["内力最大值"]*bb)
			local a4 = math.modf(JY.Person[eid]["内力"]*bb)
			local a5 = ((a1+a2) - (a3+a4))
			if a5 < 1 then a5 = 1 end
			hurtzs1[#hurtzs1+1] = a5
			if WAR.PD['铁碎牙'][pid] > 0 and WAR.PD['铁碎牙'][pid] < 4 then
				Set_Eff_Text(enemyid,2,tsyzs[WAR.PD['铁碎牙'][pid]])
			end	
		end	
		if ZYJQ(pid) then
			local a1 = WAR.PD['苍龙破'][pid] or 0
			local a2 = WAR.PD['狱龙破'][eid] or 0
			local a3 = math.modf(Atk(WAR.CurID) * 0.1)
			local a4 = math.modf(Def(WAR.CurID) * 0.1)
			local a5 = math.modf(Qg(WAR.CurID) * 0.1)
			local a6 = math.modf((a3+a4+a5)*0.5)
			if TrueSD(pid) > TrueSD(eid) then
				hurtzs1[#hurtzs1+1] = (a1 + a2) * a6 * (TrueSD(pid) - TrueSD(eid))*0.07
			else
				hurtzs1[#hurtzs1+1] = (a1 + a2) * a6 *0.7
			end
			WAR.PD['创伤'][eid] = psx(eid,'流血程度')
			WAR.PD['苍龙破'][pid] = nil
			if WAR.PD['狱龙破'][eid] ~= nil and WAR.PD['狱龙破'][eid] >0 then
				WAR.PD['狱龙破'][eid] = limitX(math.modf(WAR.PD['狱龙破'][eid]*0.25),1,24)
			end	
			ztd(enemyid,'生命点数',-math.modf(hurt*0.1))
		end
	end
	--吸星持瑶琴
	if ((wugong == 73 and PersonKF(pid,88)) or match_ID(pid,747)) then 
		zshurt = zshurt + 200
	end
	--奇门剪刀
	if wugong == 75 and WGZH(pid,56,75) then
		local a = JY.Person[eid]["封穴程度"] * 4
		zshurt = zshurt + a 
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.FXXS,10)
			WAR.PD["恐惧状态"][eid] = 1
			Set_Eff_Text(enemyid, "特效文字3","疾风鳄嘴・粉碎")
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.LXXS,15)
			ztd(enemyid,"内伤点数",15)
			WAR.PD['同归状态'][eid] = 1
			nuqi(pid,6)
			Set_Eff_Text(enemyid, "特效文字3","疾风鳄尾・翻滚")
		end
	end 
	--垂钓组合
	if wugong == 76 and WGZH(pid,69,76) then
		zshurt = zshurt + 200
		if JLSD(30,70,pid) then
			WAR.PD["锁足状态"][eid] = 1  
			Set_Eff_Text(enemyid, "特效文字3","任凭风浪起・稳坐钓鱼船")
		end
		--垂钓组合
		if JLSD(30,70,pid) then
			local a = (JY.Person[eid]["中毒程度"] or 0)
			JY.Person[eid]["中毒程度"] = JY.Person[eid]["中毒程度"] + 7
			if JY.Person[eid]["中毒程度"] >= 35 then
				WAR.PD["恐惧状态"][eid] = 1
			end 	
			Set_Eff_Text(enemyid, "特效文字3","姜太公钓鱼・愿者上钩")
		end 	
	end
	--黄沙南山
	if wugong == 78 and WGZH(pid,53,78) then
		zshurt = zshurt + JY.Person[eid]["流血程度"]*3
		if WAR.ACT == 1 then
			if WAR.ATNum < 3 then
				WAR.ATNum = 3
			end
		end
		if JLSD(0,30,pid) then
			WAR.PD["盲目状态"][eid] = 2
			Set_Eff_Text(enemyid, "特效文字3","黄沙万里・风沙漫天")
		end
		if JLSD(20,60,pid) then	
			local a = JY.Person[eid]["流血程度"]*3
			ztd(enemyid,WAR.LXXS,7)
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid, "特效文字3","黄沙万里・飞沙扬砾")
		end
	end
	--擒龙打狗棒
	if wugong == 80 and (Curr_NG(pid,204) or match_ID(pid,50) or match_ID(pid,764)) then
		local jl = 30
		if match_ID(pid,50) then
			jl = 50
		end
		if WAR.PD['封字决'][pid] == 1 then 
			local a = JY.Person[eid]["体力"] 
			ztd(enemyid,"内伤点数",a)
			hurtzs1[#hurtzs1+1] = 0.5
			ang = ang + 2000
		end
		if WAR.PD['挑字决'][pid] == 1 then 
			ztd(enemyid,WAR.FXXS,math.random(5,10))
		end
		addbuff(eid,WAR.PD['疯魔'],math.random(2,6))
		ztd(enemyid,"生命点数",-300)
	end
	if WAR.PD['封字决'][pid] == 1 then 
        if WAR.PD["封印"][eid] == nil then
			WAR.PD["封印"][eid] = 5
		end
    end
    if WAR.PD['绊字决'][pid] == 1 then 
		addbuff(eid,WAR.PD['迟缓状态'],20)
    end
	--逆运蛇杖
	if wugong == 81 and (Curr_NG(pid,104) or (match_ID(pid,60) and PersonKF(pid,104)) or (match_ID(pid,746) and Curr_NG(pid,95))) then 
		local a = TrueTS(pid)
		local b = JY.Person[eid]["中毒程度"]*4
		zshurt = a + b 
		local str = ""
		if JY.Person[eid]["中毒程度"] >= 30  then
			ztd(enemyid,WAR.BFXS,15)
			ztd(enemyid,WAR.ZSXS,15)
			ztd(enemyid,"体力点数",-5)
			ztd(enemyid,"内力点数",-300)
			Set_Eff_Text(enemyid, "特效文字3", "双蛇剧毒・霜炎蚀骨")
			if psx(eid,"冰封程度") >= 50 and JLSD(20,psx(eid,"冰封程度"),pid) then
				WAR.PD['冰冻状态'][eid] = limitX((WAR.PD['冰冻状态'][eid] or 0) + 10,0,50)
				WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + 10
			end
			if psx(eid,"灼烧程度") >= 30 and JLSD(10,psx(eid,"灼烧程度"),pid) then
				WAR.PD['举火燎原'][eid] = 20
			end	
		end	
		if JLSD(20,50,pid) then
			ztd(enemyid,"中毒点数",15)
			ztd(enemyid,WAR.LXXS,12)
			addbuff(eid,WAR.PD['灵蛇拳'],5,15)
			WAR.PD['创伤'][eid] = (WAR.PD['创伤'][eid] or 0) + 10
			WAR.PD['西域奇毒'][eid] = (WAR.PD['西域奇毒'][eid] or 0) + 10
			if WAR.PD['出血蛇毒'][eid] == nil then	
				WAR.PD['出血蛇毒'][eid] = (WAR.PD['出血蛇毒'][eid] or 0) + 6 + math.modf(JY.Person[eid]["中毒程度"]*0.04)
			end	
			str = str .. "・赤尾青竹"
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,"中毒点数",15)
			WAR.PD['混乱状态'][eid] = 1
			WAR.PD['精神错乱'][eid] = math.random(5,10)
			nuqi(eid,-8)
			if WAR.PD['神经蛇毒'][eid] == nil then
				WAR.PD['神经蛇毒'][eid] = (WAR.PD['神经蛇毒'][eid] or 0) + 5
			end	
			str = str .."・眼镜王蛇"
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,"中毒点数",15)
			ztd(enemyid,WAR.FXXS,math.random(5,10))
			WAR.PD['封气绝脉'][eid] = 1
			WAR.PD['基础蛊毒'][eid] = 1
			if WAR.PD['破甲蛇毒'][eid] == nil then
				WAR.PD['破甲蛇毒'][eid] = 1
			end	
			str = str .. "・金银双环"
		end
		if str ~= "" then
			Set_Eff_Text(enemyid, "特效文字2", "万蛇天化"..str)
		end	
	end
	--龙象大力杵
	if (wugong == 83 and Curr_NG(pid,103)) or match_ID(pid,62) then	
		local a1 = math.modf(JY.Person[pid]["攻击力"] * 0.1)
		local a2 = math.modf(JY.Person[pid]["防御力"] * 0.1)
		local a3 = math.modf(JY.Person[eid]["攻击力"] * 0.05)
		local a4 = math.modf(JY.Person[eid]["防御力"] * 0.05)
		local a5 = math.modf(TrueTS(pid) * 1.5)
		local a7 = math.modf(1 + (WAR.LQZ[eid] or 0) /100)
		local a6 = (a1 - a3) + (a2 - a4)
		if a6 < 0 then a6 = 0 end
		hurtzs1[#hurtzs1+1] = a7
		zshurt = zshurt + math.modf((a5 + a6)*0.1)
		if JLSD(20,50,pid) then	
			WAR.PD['利刃寒锋'][eid] = 15
			WAR.JuHuo = 1
			Set_Eff_Text(enemyid, "特效文字1", "一大三千・神威世界")
		end
	end
	--琴棋书画之倚天屠龙功84，增伤20%
    if WAR.QQSH3 == 1 then
        hurtzs1[#hurtzs1+1] = 0.2
    end
	--纯阳天龙
	if (wugong == 84 and (PersonKF(pid,99) or match_ID(pid,5) or match_ID(pid,534))) or match_ID(pid,747) then
		hurtzs1[#hurtzs1+1] = 1
		if JLSD(20,50,pid) then
			ztd(enemyid,"内伤点数",10)
			if JY.Person[eid]["受伤程度"] >= 30 then
				WAR.PD['昏迷状态'][eid] = 1
				ztd(enemyid,WAR.LXXS,20)
			end
			Set_Eff_Text(enemyid, "特效文字3","武林至尊・宝刀屠龙")
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.ZSXS,10) 
			if JY.Person[eid]["灼烧程度"] >= 30 then
				WAR.PD["刺目"][eid] = 2
				ztd(enemyid,WAR.BFXS,20) 
			end
			Set_Eff_Text(enemyid, "特效文字2","号令天下・莫敢不从")
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.FXXS,5) 
			if JY.Person[eid]["封穴程度"] >= 20 then
				WAR.PD["锁足状态"][eid] = 1
				WAR.PD["迟缓状态"][eid] = (WAR.PD["迟缓状态"][eid] or 0) + math.random(2,5)
			end
			Set_Eff_Text(enemyid, "特效文字1","倚天不出・谁与争锋")
		end
	end
	--太极天龙
	if (wugong == 84 and (Curr_NG(pid,171) or match_ID(pid,5))) or match_ID(pid,747) then
		local a = JY.Person[pid]["内力最大值"] - JY.Person[pid]["内力"]
		zshurt = zshurt + a
		if JLSD(20,50,pid) then
			WAR.PD["无明业火"][eid] = 20
			Set_Eff_Text(enemyid, "特效文字3","尺蠖之屈・狡兔之脱")
		end
		if JLSD(20,50,pid) then
			WAR.PD['倚天屠龙'][eid] = 20 
			Set_Eff_Text(enemyid, "特效文字2","淋漓酣畅・雄浑刚健")
		end
	end
	--罗汉伏魔杖法
	if (wugong == 86 and PersonKF(pid,96)) or match_ID(pid, 577) then 
		local a = TrueTS(pid)
		zshurt = zshurt + a
		local b = JY.Person[pid]["内力"]/200
		if WAR.LQZ[pid] ~= nil and (WAR.LQZ[pid] or 0) > 0 then
			zshurt = zshurt + math.modf(b*(WAR.LQZ[pid] or 0)+500)
			ang = ang + b + math.modf((WAR.LQZ[pid] or 0)*80)
			if ang > 5000 then ang = 5000 end
		else
			ang = ang + (b*(WAR.LQZ[pid] or 0)+500)
		end
		if BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.5
			WAR.PD['必杀气'][pid] = 1
		end
	   Set_Eff_Text(enemyid, "特效文字1","伏魔杖法・罗汉护法")
	end
	--世尊降魔・伏魔86
	if WAR.SZXM == 1 then 
		if BNJQ(pid) then
			zshurt = zshurt + math.modf(ang*0.8)
		else
			zshurt = zshurt + math.modf(ang*0.5)
		end
	end
	--金关三花
	if (wugong == 115 and Curr_NG(pid,249)) or match_ID(pid,64) or match_ID(pid,129) then
		zshurt = zshurt + math.modf(ang*0.3)
		if JLSD(25,55,pid) then
			local a = (WAR.LQZ[pid] or 0)
			nuqi(pid,6)
			ztd(WAR.CurID,"生命点数",(a*3))
			Set_Eff_Text(enemyid, "特效文字3","精为玉花・气为金花・神为九花")
		end
		if JLSD(25,55,pid) then	
			local a = math.modf(TrueQZ(pid) / 3)
			local b = math.modf(JY.Person[pid]["内力"] / 30)
			local c = math.modf(JY.Person[eid]["受伤程度"] * 3)
			ztd(enemyid,WAR.LXXS,20)
			ztd(enemyid,"内伤点数",20)
			ztd(enemyid,"生命点数",-(c+100))
			zshurt = zshurt + a + b + c 
			Set_Eff_Text(enemyid, "特效文字2","气化神・神还虚・聚于顶")
		end
		if  JLSD(25,55,pid) then	
			ztd(enemyid,WAR.FXXS,10)
			local a = math.modf(psx(eid,"封穴程度")*10)
			zshurt = zshurt + a
			ztd(enemyid,"生命点数",-a)
			ztd(WAR.CurID,"内力点数",a)
			ztd(WAR.CurID,"生命点数",a)
			WAR.PD["忘情我无"][eid] = 5 
			Set_Eff_Text(enemyid, "特效文字1","三花聚顶得归根・五气朝元通透彻")
		end
	end
	--寒冰化骨・化骨绵掌攻击
	if wugong == 118 and WGZH(pid,5,118) then
		if JLSD(30,70,pid) then
			ztd(enemyid,"中毒点数",7)
			local a = (JY.Person[eid]["中毒程度"] or 0)
			ztd(enemyid,"生命点数",-math.modf(a*1.5))
			ztd(enemyid,"内力点数",-math.modf(a*3))
			ztd(enemyid,"体力点数",-math.modf(a/5))
			Set_Eff_Text(enemyid, "特效文字3","化骨寒冰・赤毒")
		end		
	end
	--化骨铁指
	if wugong == 118 and WGZH(pid,118,121) then
		ztd(enemyid,"生命点数",-JY.Person[eid]["流血程度"])
		if JLSD(20,60,pid) then
			ztd(enemyid,WAR.LXXS,100)
			Set_Eff_Text(enemyid, "特效文字3","外柔内刚・迅猛爆发")
		end
		if JLSD(20,60,pid) then	
			ztd(enemyid,WAR.LXXS,10)
			if WAR.PD['扫荡群魔'][eid] == nil then
				WAR.PD['扫荡群魔'][eid] = 25
			end
			Set_Eff_Text(enemyid, "特效文字3","内蓄刚劲・外现绵柔")
		end
	end
	--透骨打穴
	if (wugong == 127 and PersonKF(pid,95)) or match_ID(pid,60) or match_ID(pid,61) then 
		zshurt = zshurt + math.modf(ang*0.2)
		ztd(enemyid,WAR.FXXS,6)
		ztd(enemyid,"内伤点数",10)
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["中毒程度"] * 2
			ztd(enemyid,"中毒点数",50)
			ztd(WAR.CurID,"生命点数",a)
			WAR.PD["迟缓状态"][eid] = limitX((WAR.PD["迟缓状态"][eid] or 0) + 6, 0, 30)
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["中毒程度"] * 5
			ztd(enemyid,WAR.BFXS,30)
			ztd(enemyid,"内力点数",-a)
			if psx(eid,'冰封程度') >= 50 then
				WAR.PD['冰冻状态'][eid] = limitX((WAR.PD["冰冻状态"][eid] or 0) + 6, 0, 30)
			end
		end
		if JLSD(20,50,pid) then
			local b = TrueZF(pid)
			zshurt = zshurt + b
			WAR.PD['中毒不解'][eid] = limitX((WAR.PD['中毒不解'][eid] or 0) + 10, 0, 30)
		end
	end
	--多罗叶指
	if (wugong == 132 and PersonKF(pid,96)) or match_ID(pid,577) or match_ID(pid,103) then 
		if WAR.ATNum < 5 then
			WAR.ATNum = 5
			hurtzs1[#hurtzs1+1] = -0.5
			WAR.YNXJ = 1
			ztd(enemyid,"生命点数",-JY.Person[eid]["封穴程度"]*2)
			ztd(enemyid,"内力点数",-JY.Person[eid]["封穴程度"]*2)
			Set_Eff_Text(WAR.CurID, "特效文字1", "五指齐发")
		end
		if JLSD(20,50,pid) then
			local a = (JY.Person[pid]["内力"]+JY.Person[eid]["内力"])/20
			zshurt = zshurt + a
			if WAR.PD['重度内伤'][eid] == nil then
				WAR.PD['重度内伤'][eid] = 10
			end
			Set_Eff_Text(enemyid, "特效文字1", "震金断石")
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.FXXS,6)
			if WAR.PD['散功状态'][eid] == nil then
				WAR.PD['散功状态'][eid] = 10
			end
			if WAR.PD['集气倒退'][eid] == nil then
				WAR.PD['集气倒退'][eid] = 10
			end
			Set_Eff_Text(enemyid, "特效文字1", "波罗花开")
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.FXXS,6)
			WAR.PD["锁足状态"][eid] = 1;
			Set_Eff_Text(enemyid, "特效文字1", "花开花落")
		end
	end
	--凝血神爪
	if wugong == 134 and JY.Person[eid]["流血程度"] > 0 then
		zshurt = zshurt + JY.Person[eid]["流血程度"]
	end
	--参合指
	if (wugong == 138 and MuRongDZ(pid)) or match_ID(pid,529) then
		addbuff(eid,WAR.PD['参合状态'],1,3)
		zshurt = zshurt + TrueZF(pid)
		local jl = 30
		if match_ID(pid,529) then
			jl = 100
		end
		if JLSD(0,jl,pid) then
			for j = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD["辰宿列张"][tmppid] = 1
				end
			end
			local sh = math.abs(1000+WAR.Person[enemyid].Time)
			ztd(enemyid,"内力点数",-sh/2)
			Set_Eff_Text(enemyid, "特效文字3","慕・玄指为先")	
		end	
		if JLSD(0,jl,pid) then	
			local ch = get_skill_power(pid,138,11);
			local zy = 0
			if JY.Person[eid]["主运内功"] > 0 then
				local cur_NG = JY.Person[eid]["主运内功"]
				zy = get_skill_power(eid,cur_NG,11);
			end
			ztd(enemyid,"生命点数",-(zy+ch)/2)
			Set_Eff_Text(enemyid, "特效文字1","容・混气柔刚")		
		end	
		if JLSD(0,jl,pid) then
			local a = math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"])/JY.Person[eid]["内力最大值"])
			local b = math.modf((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"])/JY.Person[eid]["生命最大值"])
			local c = math.modf((100 - JY.Person[eid]["体力"])/100)
			hurtzs1[#hurtzs1+1] = a + b + c
			if psxper(enemyid,'内力',0.3,2) then
				addbuff(eid,WAR.PD['内力恢复停止'],1)
			end
			if psxper(enemyid,'生命',0.3,2) then
				addbuff(eid,WAR.PD["生命恢复停止"],1,2)
			end
			if psxper(enemyid,'体力',0.3,2) then
				addbuff(eid,WAR.PD['力竭'],1,2)
			end
			Set_Eff_Text(enemyid, "特效文字2","参・海运洞显")		
		end
		if JLSD(0,jl,pid) then
			local a = math.modf((JY.Person[pid]["内力"] + JY.Person[eid]["内力"]) / 10)
			zshurt = zshurt + a
			WAR.TZ_MRF = 1
			Set_Eff_Text(enemyid, "特效文字3","合・日月济世")	
		end
	end
	--达摩九阳
	if wugong == 140 and JFZH(pid,140,243) then
		ztd(enemyid,WAR.FXXS,math.random(3,5))
		if WAR.PD['苦难达摩'][pid] ~= nil and WAR.PD['苦难达摩'][pid] > 0 then
			local kn = WAR.PD['苦难达摩'][pid]/3
			zshurt = zshurt + kn
		end
		if JY.Person[eid]["封穴程度"] > 0 then
			WAR.PD['必杀气'][pid] = 1
			if JY.Person[eid]["封穴程度"] > 20 then
				WAR.PD['封气绝脉'][eid] = 1
				Set_Eff_Text(enemyid, "特效文字2", "达摩定心剑",59)
			end
		end
		if WAR.PD['苦难达摩'][pid] ~= nil and WAR.PD['苦难达摩'][pid] == 2000 then
			local kn = WAR.PD['苦难达摩'][pid]/3
			zshurt = zshurt + kn
		end
	end
	--百胜刀法
	if wugong == 141 and PersonKF(pid,146) then 
		local a = TrueSD(pid)
		local b = JY.Person[pid]["轻功"]
		ztd(enemyid,WAR.LXXS,10)
		zshurt = zshurt + a + b
		if JLSD(30,50,pid) then
			ztd(enemyid,"生命点数",-math.modf(JY.Person[eid]["生命最大值"]*0.15))
			Set_Eff_Text(enemyid, "特效文字1","百胜刀法・千军万马")
		end
	end
	if wugong == 141 and PersonKF(pid,146) then 
		local str = ""
		local a = math.random(1,4)
		if a == 1 then
			zshurt = zshurt + math.modf(ang * 0.2)
			str = "・横扫千军"	
		elseif a == 2 then
			zshurt = zshurt + math.modf(ang * 0.4)
			str = "・血战八方"				
		elseif a == 3 then
			zshurt = zshurt + math.modf(ang * 0.6)
			str = "・烈火燎原"		
		elseif a == 4 then
			zshurt = zshurt + math.modf(ang * 0.8)
			str = "・雷霆万钧"					
		 end 	
		Set_Eff_Text(enemyid, "特效文字2","百胜刀法"..str)
	end
	--妙笔一阳
	if (wugong == 142 and WGZH(pid,17,142)) or match_ID(pid,747) then
		ztd(enemyid,"生命点数",-300)
		if JLSD(20,60,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					if JY.Person[WAR.Person[j]["人物编号"]]["内力"] > 300 then
						ztd(j,'内力点数',-300)
					else
						JY.Person[WAR.Person[j]["人物编号"]]["内力"] = 0
						ztd(j,'生命点数',-200)
					end
				end
			end
			Set_Eff_Text(enemyid, "特效文字3","六门绝技・二龙争珠")
		end
		if JLSD(0,30,pid) then
			local a = JY.Person[pid]["特殊兵器"]
			ztd(enemyid,"生命点数",-a)
			WAR.PD["无明业火"][eid] = 20
			Set_Eff_Text(enemyid, "特效文字3","六门绝技・双龙出海")
		end
	end
	--霜之哀伤增伤
	if wugong == 153 and WAR.PD['霜之哀伤'][pid] ~= nil and WAR.PD['霜之哀伤'][pid]> 0 and WAR.ACT < 6 then
		if WAR.SZAS ~= 1 then
			local aa = math.modf(WAR.PD['霜之哀伤'][pid]*200)
			if psx(eid,'冰封程度') > 100 then
				aa = aa + math.modf(aa*((psx(eid,'冰封程度')-100)/50))
			end
			zshurt = zshurt + math.modf(aa)
		else
			local bb = math.modf(WAR.PD['霜之哀伤'][pid]*400)
			if psx(eid,'冰封程度') > 100 then
				bb = bb + math.modf(bb*((psx(eid,'冰封程度')-100)/50))
			end	
			zshurt = zshurt + math.modf(bb)
			addbuff(eid,WAR.PD['冰冻状态'],WAR.PD['霜之哀伤'][pid],40)
			addbuff(eid,WAR.PD['冰冻扣血'],WAR.PD['霜之哀伤'][pid])
			addbuff(eid,WAR.PD['利刃寒锋'],WAR.PD['霜之哀伤'][pid],20)
		end	
	end
	--越女剑法156
	if WGZH(pid,wugong,188) or WAR.YYLMJJF == 1 then
		local a = math.modf(Qg(WAR.CurID)*0.5)
		zshurt = zshurt + a
		if JLSD(20,50,pid) then
			local a = math.modf(TrueYJ(pid)/2)
			if a > 2000 then a  = 2000 end
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local id = WAR.Person[j]["人物编号"]
					WAR.Person[j]["生命点数"] = (WAR.Person[j]["生命点数"] or 0) + AddPersonAttrib(id, "生命", -a)
				end
			end
			Set_Eff_Text(enemyid, "特效文字2","枝击白猿")
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["流血程度"]*5
			ztd(enemyid,WAR.LXXS,100)
			zshurt = zshurt + a
			WAR.PD["刺目"][eid] = 2
			Set_Eff_Text(enemyid, "特效文字3","凤凰点头")
		end
		if JLSD(10,60,pid) then
			WAR.ATNum = WAR.ATNum + 1
		end
		if JLSD(20,50,pid) then
			if (WAR.JQSDXS[eid] or 0) > (WAR.JQSDXS[pid] or 0) then
				addbuff(pid,WAR.PD['回气'],100)
			else
				addbuff(pid,WAR.PD['增加气攻'],100)
			end
			Set_Eff_Text(WAR.CurID, "特效文字3","追光逐影")
		end
	end
	--玄女剑法
	if wugong == 161 and JY.Person[pid]['性别'] == 1 then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--白蟒鞭法
	if (wugong == 164 and Curr_NG(pid,107)) or match_ID(pid,637) then
		local a = JY.Person[pid]["内力"] - JY.Person[eid]["内力"];
		if a < 300 then a = 300 end
		zshurt = zshurt + a
		if JLSD(20,50,pid) then
			ztd(enemyid,"内伤点数",15)
			ztd(enemyid,WAR.LXXS,15)
			ztd(enemyid,WAR.FXXS,15)
			ztd(enemyid,"体力点数",-5)
			Set_Eff_Text(enemyid, "特效文字3","白蟒鞭法・灵蛇出洞")
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[pid]["特殊兵器"]
			local b = JY.Person[pid]["内力"]/10000*math.random(3)
			nuqi(pid,10)
			ztd(enemyid,"生命点数",-a)
			hurtzs1[#hurtzs1+1] = b
			Set_Eff_Text(enemyid, "特效文字3","白蟒鞭法・婉若游龙")
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["特殊兵器"]
			ztd(enemyid,"内力点数",-a) 
			WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(3)
			if JY.Person[eid]["受伤程度"] >= 50 then 
				WAR.PD["洞火"][eid] = 1
			end
			Set_Eff_Text(enemyid,"特效文字2","白蟒鞭法・风吹柳絮")
		end
		if JLSD(20,50,pid) then
			WAR.PD['时序闪避'][pid] = (WAR.PD['时序闪避'][pid] or 0) + 20
			Set_Eff_Text(enemyid,"特效文字2","白蟒鞭法・如似鬼魅")
		end
		if JLSD(20,50,pid) then
			WAR.PD['白蟒鞭法'][eid] = 20
			Set_Eff_Text(enemyid,"特效文字1","白蟒鞭法・灵动之极")
		end
	end
	--圣火阴风
	if wugong == 174 and PersonKF(pid,93) then	
		WAR.PD['必冰封'][pid] = 1
		ztd(enemyid,WAR.LXXS,math.random(10,20))
		local aa = math.modf(0.3*TrueSD(pid))
		local cc = math.modf(0.1*TrueTS(pid))
		local bb = (JY.Person[eid]["冰封程度"] or 0)
		zshurt = zshurt + aa + cc
		if BNJQ(pid) then
			if WAR.ACT == 1 then
				hurtzs1[#hurtzs1+1] = 1
				zshurt = zshurt + aa * 1.5
			elseif WAR.ACT == 2 then
				hurtzs1[#hurtzs1+1] = 3.5
				zshurt = zshurt + aa * 2 + bb * 2
			end
			Set_Eff_Text(enemyid, "特效文字3", "始解袖白雪")
		end
		if WAR.HSYFD == 2 then
			hurtzs1[#hurtzs1+1] = 1.5
			WAR.PD['利刃寒锋'][eid] = (WAR.PD['利刃寒锋'][eid] or 0) + math.random(5,10)
		end
		if WAR.YFDLW == 1 then
			zshurt = zshurt + math.modf((JY.Person[eid]["冰封程度"] or 0) * 1.5)
			WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.random(1,3)
		end
		if WAR.YFDLW == 2 then
			local a = (JY.Person[eid]["冰封程度"] or 0)
			ztd(enemyid,"内伤点数",a)
			ztd(WAR.CurID,"生命点数",a)
			ztd(WAR.CurID,"内力点数",a)
		end
		if WAR.YFDLW == 3 then
			local aa = math.modf(JY.Person[pid]["内力最大值"] - JY.Person[eid]["内力"])
			local bb = aa * 0.1
			zshurt = zshurt + aa
			ztd(enemyid,"生命点数",-bb)
		end
	end
	--碧海惊涛掌
	if wugong == 179 and (PersonKF(pid,180) or match_ID(pid,635)) then
		local a = TrueQZ(pid)
		zshurt = zshurt + a
		local str = ""
		local a = math.random(1,4)
		if a == 1 then
			ztd(enemyid,WAR.BFXS,20)
			ztd(enemyid,WAR.ZSXS,20)
			str = "・波澜壮阔"	
		elseif a == 2 then
			ztd(enemyid,"内伤点数",20)
			WAR.PD["锁足状态"][eid] = 1
			str = "・惊涛拍岸"				
		elseif a == 3 then
			ztd(enemyid,WAR.FXXS,10)
			WAR.PD["刺目"][eid] = 2
			str = "・海动波涛"		
		elseif a == 4 then
			ztd(enemyid,WAR.LXXS,20)
			WAR.PD["昏迷状态"][eid] = 1
			str = "・千漩百转"					
		 end 	
		Set_Eff_Text(enemyid, "特效文字2","碧海惊涛掌"..str)
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["轻功"] * 0.4
			zshurt = zshurt + a
			ztd(WAR.CurID,"体力点数",3)
			WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + math.random(10)
			Set_Eff_Text(enemyid, "特效文字3","碧海惊涛掌・大海无量")
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["内力"] * 0.1
			local b = JY.Person[pid]["内力"] * 0.1
			local aa = JY.Person[eid]["受伤程度"]
			local bb = JY.Person[eid]["流血程度"]
			local cc = JY.Person[eid]["封穴程度"]
			local dd = JY.Person[eid]["冰封程度"]
			local ee = JY.Person[eid]["灼烧程度"]
			zshurt = zshurt + a + b
			zshurt = zshurt + aa + bb + cc + dd + ee
			WAR.PD["恐惧状态"][eid] = 1
			Set_Eff_Text(enemyid, "特效文字1","碧海惊涛掌・百川归海")
		end
		if WAR.ACT == 1 then
			local c = math.modf(JY.Person[eid]["轻功"]/400)
			WAR.ATNum = limitX(WAR.ATNum + c,1,6)
		end
	end
	--井月八法
	if PersonKF(pid,181) and yongdao(wugong) then
		for i = 1, JY.Base["武功数量"] do
			local dfjc = 0
			if JY.Wugong[JY.Person[pid]['武功'.. i]]['武功类型'] == 4 and JY.Person[pid]['武功等级'.. i] == 999 then
				dfjc = dfjc + 1
			end
			if dfjc >= 4  then
				zshurt = zshurt + dfjc*100
				break
			end
		end
	end
	--井中八法181
	if WAR.KZJYBF > 0 then
		zshurt = zshurt + TrueSD(pid)
		if WAR.KZJYBF == 8 then
			local a = math.modf(TrueSD(eid)/10)
			ztd(enemyid,WAR.LXXS,a)
			WAR.PD['恐惧状态'][eid] = 1 
		end 
		if WAR.KZJYBF == 7 then
			if JY.Person[eid]["内力性质"] == 0 then
				WAR.PD["冰冻状态"][eid] = (WAR.PD["冰冻状态"][eid] or 0) + math.random(20,30)	        
			elseif JY.Person[eid]["内力性质"] == 1 then
				WAR.PD["迟缓状态"][eid] = (WAR.PD["迟缓状态"][eid] or 0) + math.random(5,8)	
			else
				ztd(enemyid,WAR.LXXS,20)
			end
			WAR.PD['昏迷状态'][eid] = 1
		end 	
		if WAR.KZJYBF == 6 then
			for j = 0, WAR.PersonNum - 1 do
				local tmpid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					local sm = math.modf(JY.Person[tmpid]["生命"]/4)
					if sm < 300 then
						sm = 300
					end
					ztd(j,WAR.FXXS,20)
					ztd(j,"生命点数",-sm)
				end
			end
		end	
		if WAR.KZJYBF == 5 then
			for i = 0, WAR.PersonNum - 1 do 
				if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
					if WAR.Person[i].Time > -200 then
						WAR.Person[i].Time = -200
					end
					ztd(i,"内伤点数",math.random(15,30))
				end
			end
		end 
		if WAR.KZJYBF == 4 then
			ztd(enemyid,"中毒点数",15)
			addbuff(eid,WAR.PD['灵蛇拳'],10,15)
		end 
		if WAR.KZJYBF == 3 then
			ztd(enemyid,"内伤点数",15)
			WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(3)
		end
		if WAR.KZJYBF == 2 then
			WAR.PD['沉睡状态'][eid] = 1
		end 
		if WAR.KZJYBF == 1 then
			WAR.PD['脆弱状态'][eid] = 3
		end 		
	end
	--般若金刚189
	if QFZH(pid,wugong,91) then
		local WL = get_skill_power(pid,wugong,11)
		local a = math.modf(JY.Person[pid]["攻击力"]/20)
		local b = math.modf(JY.Person[pid]["防御力"]/100)
		local c = math.modf(JY.Person[pid]["轻功"]/100)
		zshurt = zshurt + WL*2
		if WAR.NGJL > 0 then
			if PersonKF(pid,108) then
				ztd(enemyid,WAR.FXXS,c)
				ztd(enemyid,"内力点数",-WL)
			end
			if PersonKF(pid,96) then
				ztd(enemyid,"内伤点数",b)
			end
			if PersonKF(pid,144) then
				ztd(enemyid,"生命点数",-a)
				ztd(enemyid,WAR.LXXS,10)
			end
		end
		--般若防御
		if WAR.Defup[pid] ~= nil and JLSD(0,33,pid) then
			WAR.PD['坚甲状态'][pid] = (WAR.PD['坚甲状态'][pid] or 0) + 10
			if WAR.NGJL == 108 then
				if WAR.PD['神教逆杀'][eid] == nil then
					WAR.PD['神教逆杀'][eid] = 10 
				end
			end
		end
		--般若蓄力
		if WAR.Actup[pid] ~= nil then
			if JLSD(66,99,pid) then
				if WAR.PD["封印"][eid] == nil then
					WAR.PD["封印"][eid] = 8
				end
			end
			if JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 2 and JLSD(50,90,pid) then
				local a = math.modf(JY.Person[pid]["生命最大值"] *0.05)
				WAR.BRXL = 1
				ztd(enemyid,"生命点数",-a)
			end
			if PersonKF(pid,96) and JLSD(0,50,pid) then
				WAR.PD['罗汉血'][eid] = (WAR.PD['罗汉血'][eid] or 0) + 1
			end
		end
		if WAR.PD['般若休息'][pid] ~= nil then
			WAR.BJ = 1
			WAR.PD['金刚力'][pid] = (WAR.PD['金刚力'][pid] or 0) + math.random(6,10)
		end
		if WAR.PD["金刚力"][pid] ~= nil and (WAR.PD["金刚力"][pid] or 0) > 0 then
			local jg = (WAR.PD["金刚力"][pid] or 0)*15
			zshurt = zshurt + jg
		end
	end
	--解牛刀法
	if wugong == 193 then
		local jl = (1- JY.Person[eid]["生命"]/JY.Person[eid]["生命最大值"])*30
		if JY.Person[eid]["生命"]/JY.Person[eid]["生命最大值"] < 0.3 and math.random(100) <= jl then
			zshurt = zshurt + JY.Person[eid]["生命"]
		end
		if JY.Person[eid]["生命"]/JY.Person[eid]["生命最大值"] < 0.5 and JLSD(10,60,pid) then
			zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]*0.05)
			Set_Eff_Text(enemyid, "特效文字3", "良疱岁更刀",116)
		end
	end
	--周天庖丁--族庖岁更刀
	if wugong == 193 and PersonKF(pid,190) then
		zshurt = zshurt + math.modf(TrueSD(pid)*0.5)
		if JLSD(10,60,pid) then
			ang = ang + 800
			WAR.PD['虚弱状态'][eid] = limitX((WAR.PD['虚弱状态'][eid] or 0) + 8,0,50)
			Set_Eff_Text(enemyid,1,"族庖月更刀",240)
		end
		if JLSD(10,40,pid) then
			local a = 0
			if BNJQ(pid) then
				if JY.Person[pid]["武器"] >= 0 then
					a = JY.Thing[JY.Person[pid]["武器"]]["加攻击力"]
				else
					a = 100
				end	
			end	
			zshurt = zshurt + a + 400
			hurtzs1[#hurtzs1+1] = 1
			for i = 0, WAR.PersonNum-1 do
				local pdid = WAR.Person[i]["人物编号"] 
				if WAR.Person[i]["死亡"] == false and inteam(pdid) then
					WAR.PD['神兵'][pdid] = 25
				end	
			end
			Set_Eff_Text(enemyid,1,"良庖岁更刀",240)
		end
		if JLSD(10,40,pid) then
			local b = 0
			local c = 0
			if JY.Person[pid]["武器"] >= 0 then
				b = JY.Thing[JY.Person[pid]["武器"]]["加攻击力"]
			else
				b = 100
			end
			if 	JY.Person[eid]["防具"] >= 0 then
				c = JY.Thing[JY.Person[eid]["防具"]]["加防御力"]
			else
				c = 0
			end	
			if b >= c then
				local d = b-c
				if d > 500 then d = 500 end 
				WAR.PD['创伤'][eid] = limitX((WAR.PD['创伤'][eid] or 0) + 5,0,25)
				ztd(enemyid,WAR.LXXS,20)
				ztd(enemyid,'生命点数',-d)
			end	
			Set_Eff_Text(enemyid,3,"无厚入有间",240)
		end
		if JY.Person[eid]["流血程度"] > 0 then
			WAR.PD['必杀气'][pid] = 1
			WAR.PD['血淬'][pid] = (WAR.PD['血淬'][pid] or 0 ) + JY.Person[eid]["流血程度"]
			Set_Eff_Text(enemyid,2,"刀刃若新发",240)
		end	
	end
	--岳王散手
	if wugong == 198 and PersonKF(pid,199) then
	    local str = {"・铁禀锁喉","・生铁铸身","・猛虎扒地","・天门峰顶","・玉骨顶心","・五蟒绝脉"}
	    local zt = {'内伤点数','中毒点数',WAR.BFXS,WAR.ZSXS,WAR.FXXS,WAR.LXXS}
	    local a = math.random(1,6)
	    zshurt = zshurt + 600
	    ztd(enemyid,zt[a],math.random(5,10))	
		Set_Eff_Text(enemyid, "特效文字3","散手诀"..str[a])
		if JLSD(20,50,pid) then
			WAR.PD["无明业火"][eid] = (WAR.PD["无明业火"][eid] or 0) + math.random(20)
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD["盲目状态"][WAR.Person[j]["人物编号"]] = 2
				end
		    end
			Set_Eff_Text(enemyid, "特效文字3","岳王散手・云雾手")
		end
		if JLSD(20,50,pid) then
			WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + math.random(10)
			for j = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['利刃寒锋'][tmppid] = 15
				end
			end
			Set_Eff_Text(enemyid, "特效文字2","岳王散手・托塔手")
		end
		if JLSD(20,50,pid) then
			WAR.PD["混乱状态"][eid] = 1
			for j = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['恐惧状态'][tmppid] = 1
				end
			end	
			Set_Eff_Text(enemyid, "特效文字1","岳王散手・偷桃手")
		end
	end	
	--岳家枪法
	if wugong == 200 and PersonKF(pid,199) then 
		local b = JY.Person[pid]["生命最大值"]/15
		zshurt = zshurt + b
		if JLSD(15,50,pid) then
			local str = ""
			local a = math.random(1,5)
			if a == 1 then
				local a1 = JY.Person[eid]["流血程度"] * 3
				ztd(enemyid,"生命点数",-a1)
				str = "・刺"
			elseif a == 2 then 
				local a2 = JY.Person[eid]["受伤程度"] * 3	
				ztd(enemyid,"生命点数",-a2)
				str = "・戳"
			elseif a == 3 then 
				local a3 = JY.Person[eid]["封穴程度"] * 3 
				ztd(enemyid,"生命点数",-a3)
				str = "・点"
			elseif a == 4 then 
				local a4 = JY.Person[eid]["冰封程度"] * 3
				ztd(enemyid,"生命点数",-a4)
				str = "・扫"	
			elseif a == 5 then 
				local a5 = JY.Person[eid]["灼烧程度"] * 3
				ztd(enemyid,"生命点数",-a5)
				str = "・挑"	
			end	
			Set_Eff_Text(enemyid, "特效文字3","岳家枪法"..str)
		end
		if JLSD(15,50,pid) then 
			WAR.PD['岳家枪诀'][eid] = 20 
			ztd(enemyid,"内伤点数",20)
			ztd(enemyid,WAR.BFXS,20)
			ztd(enemyid,WAR.ZSXS,20)
			ztd(enemyid,WAR.LXXS,20)
			ztd(enemyid,WAR.FXXS,10)
			Set_Eff_Text(enemyid, "特效文字3","岳家枪绝・大漠孤烟")
		end	
		if JLSD(15,50,pid) then 
			local a = TrueTS(pid)
			ztd(enemyid,"内力点数",-a)
			WAR.PD['昏迷状态'][eid] = 1
			Set_Eff_Text(enemyid, "特效文字1","岳家枪绝・长河落日")
		end 	
	end
	--寒袖拂穴
	if wugong == 201 and PersonKF(pid,98) or match_ID(pid,118) or match_ID(pid,634) then
		local a = JY.Person[eid]["冰封程度"] * 3 
		local b = JY.Person[eid]["受伤程度"] * 3
		local c = JY.Person[pid]["内力"]/25
		local d = TrueZF(pid)
		zshurt = zshurt + a + b + c
		if JLSD(20,50,pid) then
			ztd(enemyid,"生命点数",-d)
		end 	
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.BFXS,25)
			WAR.PD['锁足状态'][eid] = 1
			if JY.Person[eid]["冰封程度"] > 50 then
				WAR.PD['昏迷状态'][eid] = 1
			end
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.FXXS,6)
			if JY.Person[eid]["封穴程度"] > 30 then
				WAR.PD['创伤'][eid] = 50
			end
		end
		if JLSD(20,50,pid) then
			ztd(enemyid,"内伤点数",15)
			if JY.Person[eid]["受伤程度"] > 50 then 
				WAR.PD['恐惧状态'][eid] = 1
			end
		end
	end	
	--葵花点穴手--点穴大师组合
	if (yongzhi(wugong) and (PersonKF(pid,226) or (JXPD(pid,27,1) or match_ID(pid,777)))) or match_ID(pid,92) then		
		local b = JY.Person[pid]["暗器技巧"] + JY.Person[eid]["指法技巧"]/2
		zshurt = zshurt + b
		if PersonKF(pid,127) or match_ID(pid,92) or JXPD(pid,27,1) or match_ID(pid,777) then --透骨
			WAR.PD['点穴大师1'][eid] = 1
			ztd(enemyid,WAR.FXXS,math.random(10,20))
			if psx(eid,"封穴程度") > 0 then
				zshurt = zshurt + math.modf(psx(eid,"封穴程度")*5)
				zhanyi(eid,-math.modf(psx(eid,"封穴程度")*0.2))
				if JLSD(10,45,pid) then
					WAR.PD['侵如火'][pid] = 1
				end	
				if BNJQ(pid) then
					ztd(enemyid,"生命点数",-math.modf(psx(eid,"封穴程度")*5))
				end
				if psx(eid,"封穴程度") >= 50 then
					WAR.PD['脆弱状态'][eid] = 3
					WAR.PD['侵如火'][pid] = 1
				end
			end	
		end
		if PersonKF(pid,126) or match_ID(pid,92) or JXPD(pid,27,1) or match_ID(pid,777) then --兰花
			WAR.PD['点穴大师2'][eid] = 1
			ztd(enemyid,WAR.FXXS,math.random(10,20))
			zshurt = zshurt + math.modf((WAR.LQZ[eid] or 0)*psx(eid,"封穴程度")/4)
		end
		if (wugong == 226 and PersonKF(pid,201) and (PersonKF(pid,127) or PersonKF(pid,126))) or match_ID(pid,92) or JXPD(pid,27,1) or match_ID(pid,777) then
			if WAR.PD['点穴大师3'][eid] == nil then
				WAR.PD['点穴大师3'][eid] = 2
			end
			ztd(enemyid,WAR.FXXS,math.random(10,20))
			if JLSD(10,50,pid) then
				WAR.PD["封气绝脉"][eid] = 1
			end	
			if Curr_NG(pid,105) then
				local wl = get_skill_power(pid,wugong,11)*0.1
				ztd(enemyid,"生命点数",-wl)
				if WAR.PD['盲目状态'][eid] ~= nil or WAR.PD['刺目'][eid] ~= nil or JLSD(10,45,eid) then
					WAR.PD['点穴大师3'][eid] = 2
				end	
				WAR.PD['必连击'][pid] = 3
			end
		end
	end
	--八卦刀诀
	if (wugong == 231 and PersonKF(pid,235)) or (yongdao(wugong) and match_ID(pid, 9922)) then
		--Set_Eff_Text(enemyid,"特效文字0","八卦刀法秘传・席卷八荒式");
		zshurt = zshurt + 300
		if JLSD(20,50,pid) then
			Set_Eff_Text(enemyid, "特效文字3", "八卦刀诀・阴阳无极")
			zshurt = zshurt + 300
			WAR.PD["迟缓状态"][eid] = (WAR.PD["迟缓状态"][eid] or 0) + math.random(3,6)
			ztd(enemyid,'内伤点数',8) 	
		end
		if JLSD(20,50,pid) then
			Set_Eff_Text(enemyid, "特效文字2", "八卦刀诀・阴阳相生")
			if JY.Person[eid]["内力性质"] == 0 then
				ztd(enemyid,WAR.LXXS,8)
				ztd(WAR.CurID,'生命点数',100)
			elseif JY.Person[eid]["内力性质"] == 1 then
				WAR.PD["迟缓状态"][eid] = (WAR.PD["迟缓状态"][eid] or 0) + 5
				ztd(WAR.CurID,'内力点数',200) 
			elseif JY.Person[eid]["内力性质"] == 2 then
				WAR.PD["虚弱状态"][eid] = (WAR.PD["虚弱状态"][eid] or 0) + 5 
				ztd(WAR.CurID,'体力点数',2)
			end
		end
		if JLSD(20,50,pid) then
			Set_Eff_Text(enemyid, "特效文字1", "八卦刀诀・乾坤一气")
			local a = math.modf(TrueSD(pid) / 3)
			local b = math.modf(TrueSD(eid) / 3)
			zshurt = a + b 
			nuqi(pid,10)
			nuqi(eid,-5)
			if JY.Person[eid]["受伤程度"] >= 30 then
				ztd(enemyid,"生命点数",-100)
				ztd(enemyid,'内力点数',-500)
			end
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[pid]["内力"] / 20
			local b = JY.Person[eid]["受伤程度"] * 2
			local c = JY.Person[eid]["冰封程度"] * 2
			local d = JY.Person[eid]["灼烧程度"] * 2
			zshurt = zshurt + a + b + c + d 
			Set_Eff_Text(enemyid, "特效文字0", "八卦刀诀・乾坤无极")
		end
	end
	--纯阳神门
	if (wugong == 236 and PersonKF(pid,99)) or (yongjian(wugong) and MPTX(pid,4,3) and PersonKF(pid,99)) or match_ID(pid,5) then	
		zshurt = zshurt + 200
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.FXXS,13)
			Set_Eff_Text(enemyid, "特效文字3", "剑刺神门・平息干戈")
		end
		if JLSD(20,50,pid) then
			WAR.PD['恐惧状态'][eid] = 1
			Set_Eff_Text(enemyid, "特效文字2", "剑刺神门・卷甲韬戈")
		end	
	end
	--周公剑意
	if wugong == 271 and PersonKF(pid,356) then
		if WAR.PD['周公剑意'][pid] ~= nil and WAR.PD['周公剑意'][pid] > 0 then
			zshurt = zshurt + math.modf(TrueYJ(pid)*0.2*WAR.PD['周公剑意'][pid])
			local str = ''
			if WAR.PD['周公剑意'][pid] == 1 or (WAR.PD['周公剑意'][pid] > 4 and JLSD(25,60,pid)) then
				str = '剑浪奔腾'
				ztd(enemyid,WAR.ZSXS,math.random(5,8))
				WAR.PD['烈火核'][eid] = 1
			end
			if WAR.PD['周公剑意'][pid] == 2 or (WAR.PD['周公剑意'][pid] > 4 and JLSD(30,60,pid)) then
				str = '剑蛊食心'
				ztd(enemyid,'中毒点数',math.random(5,8))
				WAR.PD['食心蛊'][eid] = 1
			end
			if WAR.PD['周公剑意'][pid] == 3 or (WAR.PD['周公剑意'][pid] > 4 and JLSD(35,60,pid)) then
				str = '剑蟒缠绵'
				ztd(enemyid,WAR.FXXS,math.random(5,8))
				WAR.PD['缚身蛇'][eid] = 1
			end
			if WAR.PD['周公剑意'][pid] == 4 or (WAR.PD['周公剑意'][pid] > 4 and JLSD(40,60,pid)) then
				str = '剑寒凝霜'
				ztd(enemyid,WAR.BFXS,math.random(5,8))
				WAR.PD['寒冰魄'][eid] = 1
			end
			if WAR.PD['周公剑意'][pid] == 6 then
				str = '剑飞惊天'
				WAR.PD['再次行动'][pid] = 35
				WAR.PD['惊雷咒'][pid] = 20
				WAR.PD['感电状态'][eid] = limitX((WAR.PD['感电状态'][eid] or 0) + 1,0,5)
			end
			if WAR.PD['周公剑意'][pid] == 7 then
				str = '剑芒霹雳'
				WAR.PD['御雷阵'][pid] = 20
				for j = 0, WAR.PersonNum - 1 do
					local id = WAR.Person[j]["人物编号"]
					if dead(j) == false and DWPD(WAR.CurID,j) then
						WAR.PD['感电状态'][id] = limitX((WAR.PD['感电状态'][id] or 0) + 1,0,5)
					end
				end
				if BNJQ(pid) then
					local a = math.abs(300-JY.Person[eid]["受伤程度"])
					local b = math.abs(300-JY.Person[eid]["中毒程度"])
					local c = math.abs(500-JY.Person[eid]["冰封程度"])
					local d = math.abs(300-JY.Person[eid]["灼烧程度"])
					local e = math.abs(100-JY.Person[eid]["封穴程度"])
					local f = math.abs(300-JY.Person[eid]["流血程度"])
					local g = a + b + c + d + e + f
					ztd(enemyid,"生命点数",-g)
				end
			end
			Set_Eff_Text(enemyid,3,str)
		end
	end
	--葵花神针＋葵花神功
	if (wugong == 313 and Curr_NG(pid,105)) or JXPD(pid,27,2) or match_ID(pid,777) then
		zshurt = zshurt + TrueYJ(pid) + JY.Person[pid]["暗器技巧"]
		if WAR.PD['刺目'][eid] ~= nil then
			ztd(enemyid,WAR.FXXS,math.random(10,15))
			WAR.PD['残劲袭魄'][eid] = 1
			WAR.PD['败血破命'][eid] = 1
		end
		if (WAR.JQSDXS[pid] or 0) > (WAR.JQSDXS[eid] or 0) then
			local a = math.modf((WAR.JQSDXS[pid]-WAR.JQSDXS[eid])*10)
			zshurt = zshurt + a
		end	
		if JY.Person[eid]["流血程度"] >= 50 then
			ztd(enemyid,"生命点数",-JY.Person[eid]["流血程度"])
		end	
	end
	--千蛛万毒手，强制上毒20 标记修改
	if wugong == 334 then
		ztd(enemyid,"中毒点数",20)
	end
	--天刀九问组合（天刀＋井月＋长生）
	if wugong == 335 and WAR.TDJW > 0 then
		zhanyi(pid,10)
		zshurt = zshurt + math.modf(WAR.SPIRIT[pid]*(TrueSD(pid)*0.01)*WAR.TDJW)
		if WAR.TDJW == 6 or WAR.TDJW == 10 then
			local a = math.modf(psx(eid,"生命")*0.1)
			local b = math.modf(psx(eid,"内力")*0.05)
			local c = math.modf(psx(eid,"体力")*0.1)
			ztd(WAR.CurID,"生命点数",a)
			ztd(WAR.CurID,"内力点数",b)
			ztd(WAR.CurID,"体力点数",c)
			if math.modf(psx(pid,"生命") + a) > psx(pid,"生命最大值") then
				WAR.PD['神兵'][eid] = (WAR.PD['神兵'][eid] or 0) + ((psx(pid,"生命") + a) - psx(pid,"生命最大值"))
			end
			if math.modf(psx(pid,"内力") + b) > psx(WAR.CurID,"内力最大值") then
				WAR.PD['五宝花蜜酒'][eid] = (WAR.PD['五宝花蜜酒'][eid] or 0) + ((psx(pid,"内力") + b) - psx(pid,"内力最大值"))
			end
			if math.modf(psx(pid,"体力") + c) > 100 then
				WAR.PD['集气速度'][eid] = (WAR.PD['集气速度'][eid] or 0) + ((psx(pid,"体力") + a) - 100)
			end	
		end
		if WAR.TDJW == 7 or WAR.TDJW == 10 then
			local dd = math.modf(psx(pid,"品德") - psx(eid,"品德"))
			zshurt = zshurt + math.modf((WAR.SPIRIT[pid] or 0)*dd*0.1)
		end
		if WAR.TDJW == 8 or WAR.TDJW == 10 then
			for j = 0, WAR.PersonNum-1 do
				if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then
					ztd(j,"生命点数",math.modf(hurt*0.1))
					WAR.TXXS[WAR.Person[j]["人物编号"]] = 1
				end
			end
		end	
	end
	--大九天手组合
	if wugong == 340 and Curr_NG(pid,97) then
		local djt = limitX(math.random(8-(JY.Person[pid]['畅想分阶'])) -1,1,3)
		if MPTX(pid,13) then
			djt = djt + 1
		end	
		zshurt = zshurt + TrueZF(pid)
		hurtzs1[#hurtzs1+1] = djt
		if WAR.DJTS == 1 then
			if WAR.PD["封印"][eid] == nil then
				WAR.PD["封印"][eid] = 5
			end
		end	
		if WAR.DJTS == 2 then
			ztd(enemyid,'内伤点数',25)
			addbuff(eid,WAR.PD['重度内伤'],10,10)
		end	
		if WAR.DJTS == 5 then
			ztd(enemyid,WAR.BFXS,25)
			local a = psx(eid,'内力') - math.modf(psx(eid,'冰封程度')*5)
			if a >= 0 then
				ztd(enemyid,'内力点数',-math.modf(psx(eid,'冰封程度')*5))
			else
				ztd(enemyid,'内力点数',-psx(eid,'内力'))
				ztd(enemyid,'生命点数',a)
			end		
		end
		if WAR.DJTS == 6 then
			ztd(enemyid,'集气位置',-150)
		end
		if WAR.DJTS == 8 then
			ztd(enemyid,WAR.ZSXS,25)
			ztd(enemyid,'生命点数',-math.modf(psx(eid,'灼烧程度')*5))
		end
		if WAR.DJTS == 9 then
			ztd(enemyid,WAR.FXXS,9)
			ztd(enemyid,'体力点数',-math.modf(psx(eid,'封穴程度')*0.2))
		end
	end
	--圣火令诀组合
	if yongwu(wugong,360) and Curr_NG(pid,93) then
		--应左则前
		zshurt = zshurt + math.modf(Qg(enemyid)*(8-psx(pid,'畅想分阶'))*0.5)
		--需右乃后
		if JLSD(0,36,pid) then
			local a = math.random(2)
			if a == 1 then
				addbuff(eid,WAR.PD['混乱状态'],1)	
			else
				addbuff(eidmWAR.PD['头晕目眩'],1)
			end
			Set_Eff_Text(enemyid,2,'圣火诡谲・需右乃后')
		end
		--三虚七实
		if WAR.PD['圣火三虚七实'][pid] == 2 then
			hurtzs1[#hurtzs1+1] = 0.3
			Set_Eff_Text(enemyid,2,'圣火诡谲・三虚七实')
		end
		--无中生有
		local jl = limitX(1-(psx(pid,'生命')/psx(pid,'生命最大值')),0.15,1)
		if WAR.PD['圣火无中生有'][pid] ~= nil and WAR.PD['圣火无中生有'][pid] > 0 and JLSD(0,100*jl,pid) then
			zshurt = zshurt + math.modf(WAR.PD['圣火无中生有'][pid]*0.5)
		end	 
	end	
	--狂风迅雷功组合
	if wugong == 341 and WAR.BLJJ > 0 then
		local a,b,c = get_skill_power(pid,341,11),get_skill_power(pid,191,11),get_skill_power(pid,55,11)
		zshurt = zshurt + math.modf((a+b+c)*TrueTS(pid)*0.01)
		if WAR.BLJJ == 1 then
			zshurt = zshurt + math.modf(Qg(WAR.CurID)*math.random(10,20)*0.1)
			if math.random(10) < 4 then
				WAR.PD['头晕目眩'][eid] = 1
			end	
		end
		if WAR.BLJJ == 2 then
			zshurt = zshurt + math.modf(TrueQZ(pid)*math.random(10,20)*0.1)
			if math.random(10) < 4 then
				WAR.PD['头晕目眩'][eid] = 1
			end
		end	
		if WAR.BLJJ == 4 then
			hurtzs1[#hurtzs1+1] = math.random(10,20)*0.1
		end
		if WAR.BLJJ == 5 then
			if math.random(10) < 4 then
				WAR.PD['头晕目眩'][eid] = 1
			end
			ang = ang + 2000
		end	
		if WAR.BLJJ == 6 then
			ztd(enemyid,"内伤点数",math.random(10,15))
			zshurt = zshurt + math.modf(psx(eid,"受伤程度")*psx(pid,"内力")*0.005)
			if JLSD(10,45,pid) then
				addbuff(eid,WAR.PD['重度内伤'],10,10)
			end
			if math.random(10) < 4 then
				WAR.PD['头晕目眩'][eid] = 1
			end
		end
		if WAR.BLJJ == 7 then
			zshurt = zshurt + math.modf(TrueSD(pid)*math.random(10,20)*0.1)
			if JLSD(10,45,pid) then
				WAR.PD['创伤'][eid] = (WAR.PD['创伤'][eid] or 0) + 10
			end
			if math.random(10) < 4 then
				WAR.PD['头晕目眩'][eid] = 1
			end
		end
		if WAR.BLJJ == 8 then
			hurtzs1[#hurtzs1+1] = 0.5
			WAR.PD['虚弱状态'][eid] = (WAR.PD['虚弱状态'][eid] or 0) + 20
			WAR.PD['脆弱状态'][eid] = math.random(3)
			WAR.PD['霸王破甲'][eid] = (WAR.PD['霸王破甲'][eid] or 0) + 15
			local gj,fy,qg = Atk(WAR.CurID),Def(WAR.CurID),Qg(WAR.CurID)
			local sw = limitX(gj+fy+qg,0,1000)
			ztd(enemyid,"生命点数",-sw)
		end	
	end
	--大伏魔拳342
	if WAR.DFMQ == 1 then
		zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]*0.05)
		if wugong == 342 then
			zshurt = zshurt + math.modf(JY.Person[eid]["生命最大值"]*0.05)
		end
	end
	--大伏魔九阴
	if (wugong == 342 and Curr_NG(pid,107)) or match_ID(pid,637) then
		local a = JY.Person[eid]["灼烧程度"]*9
		zshurt = zshurt + 999 + a
		ztd(enemyid,WAR.ZSXS,9)
		if JLSD(20,50,pid) then	
		    WAR.PD['霸王破甲'][eid] = 20
		end 	
		if JLSD(20,50,pid) then
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid, "特效文字3","九阴拳劲・刚猛")
		end
		local jl = 50
		if match_ID(pid,637) then
			jl = 65
		end
		if JLSD(20,jl,pid) then
			WAR.PD["九阴伏魔1"][eid] = 20
			Set_Eff_Text(enemyid, "特效文字2","九阴拳劲・蓝劲")
		end
		if JLSD(20,jl,pid) then
			WAR.PD["九阴伏魔3"][eid] = 20
			Set_Eff_Text(enemyid, "特效文字2","九阴拳劲・青劲")
		end
	end
	--释迦掷象功
	if wugong == 357 and PersonKF(pid,233) then
		zshurt = zshurt + JY.Person[pid]["生命增长"]*50
	end
	--唯识龙啸
	if (wugong == 370 and PersonKF(pid,369) and JLSD(20,50,pid)) or (wugong == 370 and match_ID(pid,747) and JLSD(20,60,pid)) then
		WAR.PD['唯识剑意1'][eid] = 1
		Set_Eff_Text(enemyid, "特效文字2","唯识剑意・乱心")
	end
	if (wugong == 370 and PersonKF(pid,369) and JLSD(20,50,pid)) or (wugong == 370 and match_ID(pid,747) and JLSD(20,60,pid)) then
		WAR.PD['唯识剑意2'][eid] = 20
		Set_Eff_Text(enemyid, "特效文字3","唯识剑意・剑心")
	end
	if (wugong == 370 and PersonKF(pid,369) and JLSD(20,50,pid)) or (wugong == 370 and match_ID(pid,747) and JLSD(20,60,pid)) then
		local a = JY.Person[eid]["御剑能力"]/3
		local b = JY.Person[eid]["内力"]/6
		local c = a + b
		ztd(enemyid,'生命点数',-c)
		local str = ""
		local a = math.random(1,4)
		if a == 1 then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['灵蛇拳'][WAR.Person[j]["人物编号"]] = 15
				end 
			end 
			str = "・心"	
		elseif a == 2 then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['昏迷状态'][WAR.Person[j]["人物编号"]] = 1
				end
			end	
			str = "・念"	
		elseif a == 3 then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['集气倒退'][WAR.Person[j]["人物编号"]] = 20
				end
			end	
			str = "・意"	
		elseif a == 4 then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false then
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
						ztd(j,"生命点数",math.random(450,600))
					end
				end
			end	
			str = "・剑"			
		end
		Set_Eff_Text(enemyid, "特效文字1","唯识剑意"..str)
	end
	--霹雳刀法
	if wugong == 371 and Curr_NG(pid,372) then
		hurtzs1[#hurtzs1+1] = 1
		local str = ""
		local a = math.random(1,4)
		if a == 1 then
			ztd(enemyid,"生命点数",-100)
			str = "・春雨"	
		elseif a == 2 then
			ztd(enemyid,"内力点数",-300)
			str = "・夏芒"				
		elseif a == 3 then
			ztd(enemyid,"体力点数",-1)
			str = "・秋露"		
		elseif a == 4 then
			ztd(enemyid,"中毒点数",10)
			str = "・冬雪"					
		end
		Set_Eff_Text(enemyid, "特效文字3","狂刀决"..str)
		if JLSD(20,50,pid) then
			local str = ""
			local a = math.random(1,4)
			if a == 1 then
				ztd(enemyid,WAR.FXXS,10)
				str = "・横扫千军"	
			elseif a == 2 then
				ztd(enemyid,WAR.LXXS,20)
				str = "・血战八方"				
			elseif a == 3 then
				ztd(enemyid,WAR.ZSXS,20)
				str = "・烈火燎原"		
			elseif a == 4 then
				ztd(enemyid,WAR.BFXS,20)
				str = "・雷霆万钧"					
			end
			Set_Eff_Text(enemyid, "特效文字3","霹雳狂刀"..str)
		end
		if JLSD(20,50,pid) then
			local str = ""
			local b = math.random(1,4)
			if b == 1 then
				local a = JY.Person[eid]["封穴程度"] * 3
				ztd(enemyid,"生命点数",-a)
				str = "・灭魄"	
			elseif b == 2 then
				local a = JY.Person[eid]["流血程度"] * 3
				ztd(enemyid,"生命点数",-a)
				str = "・鬼雄"				
			elseif b == 3 then
				local a = JY.Person[eid]["灼烧程度"] * 3
				ztd(enemyid,"生命点数",-a)
				str = "・祝融"		
			elseif b == 4 then
				local a = JY.Person[eid]["冰封程度"] * 3
				ztd(enemyid,"生命点数",-a)
				str = "・共工"					
			 end 	
			Set_Eff_Text(enemyid, "特效文字2","霹雳狂刀"..str)
		end
		if JLSD(20,50,pid) then
			local str = ""
			local a = math.random(1,3)
			if a == 1 then
				if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] > 0 then
					nuqi(eid,-200)
				end
				WAR.PD['昏迷状态'][eid] = 1
				str = "・天火围城"	
			elseif a == 2 then
				for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
						WAR.PD['恐惧状态'][WAR.Person[j]["人物编号"]] = 1
					end
				end	
				str = "・梵天烈焰"	
			elseif a == 3 then
				local a = TrueSD(pid) / 2
				local b = JY.Person[pid]["内力"] / 20
				local c = a + b
				ztd(enemyid,"生命点数",-c)
				str = "・天河洪泄"					
			end	 
			Set_Eff_Text(enemyid, "特效文字1","霹雳狂刀"..str)
		end
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["受伤程度"] * 2
			ztd(enemyid,"内伤点数",15)
			ztd(enemyid,"生命点数",-a)
			WAR.PD['利刃寒锋'][eid] = limitX((WAR.PD['利刃寒锋'][eid] or 0) + 6,0,30)
			Set_Eff_Text(enemyid, "特效文字2","霹雳狂刀・刀气蚀体")
		end
	end
	--万剑归宗
	if wugong == 374 or match_ID(pid,520) then 
		zshurt = zshurt + ang
		if JLSD(20,50,pid) then
			ztd(enemyid,"内伤点数",20) 
			ztd(enemyid,WAR.LXXS,20) 
			ztd(enemyid,WAR.FXXS,10)
		end
		if JLSD(20,50,pid) then
			for j = 0, WAR.PersonNum - 1 do
				local id = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(j,"生命点数",-50) 
				end
			end
		end
		if PersonKF(pid,106) and PersonKF(pid,107) then --万剑九九
			ztd(enemyid,"体力点数",-2) 
			ztd(WAR.CurID,"体力点数",2) 
			if JLSD(20,50,pid) then
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 427, 3, "凌厉无匹・剑势如网")
				WAR.PD['万剑归宗'][eid] = 15
			end
			if JLSD(20,50,pid) then
				local a = JY.Person[pid]["御剑能力"]
				local b = JY.Person[pid]["内力"]
				local c = JY.Person[eid]["受伤程度"] + JY.Person[eid]["冰封程度"] + JY.Person[eid]["灼烧程度"] + JY.Person[eid]["封穴程度"] + JY.Person[eid]["流血程度"]
				local d = a + c
				if b > 1500 then
					b = 1500
				end
				ang = ang + b
				ztd(enemyid,"生命点数",-d)
				Set_Eff_Text(enemyid, "特效文字2","气离脉腕・反而太冲・乾坤倒转・化柔为刚")
			end
		end
	end
	--秘传打狗棒
	if wugong == 80 and match_ID(pid,772) then
		local a = JY.Person[pid]["特殊兵器"]
		zshurt = zshurt + 500 + a
		--ztd(enemyid,WAR.ZSXS,9)
		if JLSD(20,50,pid) then
			local a = JY.Person[eid]["受伤程度"]
			local b = JY.Person[eid]["冰封程度"]
			local c = JY.Person[eid]["灼烧程度"]
			local d = JY.Person[eid]["封穴程度"]
			local e = JY.Person[eid]["流血程度"]
			local f = a + b + c + d + e
			ztd(enemyid,WAR.ZSXS,100)
			ztd(enemyid,WAR.BFXS,100)
			ztd(enemyid,WAR.FXXS,50)
			ztd(enemyid,WAR.LXXS,100)
			ztd(enemyid,"内伤点数",100)
			ztd(enemyid,"生命点数",-f)
			Set_Eff_Text(enemyid, "特效文字3","秘传・天地不仁")
		end
		if JLSD(20,50,pid) then
			ztd(WAR.CurID,"生命点数",1500)
			ztd(WAR.CurID,"内力点数",3500)
			ztd(WAR.CurID,"体力点数",10)
			WAR.PD['真利刃寒锋'][eid] = 10
			Set_Eff_Text(enemyid, "特效文字2","秘传・以万物为刍狗")
		end	
	end	
	--寒冰火焰刀
	if wugong == 66 and match_ID(pid,771) then
		local a = JY.Person[eid]["冰封程度"] * 5
		ztd(enemyid,WAR.BFXS,100)			
		if JLSD(20,50,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['集气倒退'][WAR.Person[j]["人物编号"]] = 20
				end
			end	
			Set_Eff_Text(enemyid, "特效文字3","逆火焰刀诀・风雪冰天")	
		end	
		if JLSD(20,50,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false then
					local tmppid = WAR.Person[j]["人物编号"]
					if WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
						WAR.PD['封印'][WAR.Person[j]["人物编号"]] = 10
						ztd(j,"生命点数",-a)
					end
				end
			end	
			Set_Eff_Text(enemyid, "特效文字2","逆火焰刀诀・万里飞霜")	
		end	
	end 
	--黯然化境
	if wugong == 25 and match_ID(pid,775) then
		if JLSD(20,50,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['阴阳双劲'][WAR.Person[j]["人物编号"]] = 20 
				end
			end	
			Set_Eff_Text(enemyid, "特效文字3","相思无用・唯别而已")	
		end		
		if JLSD(20,50,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['深入骨髓'][WAR.Person[j]["人物编号"]] = 30  
				end
			end	
			Set_Eff_Text(enemyid, "特效文字2","别期若有定・千般煎熬又何如")	
		end		
		if JLSD(20,50,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD['重度内伤'][WAR.Person[j]["人物编号"]] = 30  
				end
			end	
			Set_Eff_Text(enemyid, "特效文字1","相思无用・唯别而已")	
		end	
	end	
	--擒龙手+擒龙功
	if wugong == 187 and Curr_NG(pid,204) then
		ztd(enemyid,WAR.FXXS,10)
		ztd(enemyid,WAR.BFXS,10)
		ztd(enemyid,"内伤点数",10)
		local str = ""
		local a = math.random(1,4)
		if a == 1 then
			WAR.PD["洞火"][eid] = 1
			str = "・抚琴"	
		elseif a == 2 then
			WAR.PD['利刃寒锋'][eid] = 10
			str = "・鼓瑟"				
		elseif a == 3 then
			WAR.PD['集气倒退'][eid] = 10 
			str = "・批亢"		
		elseif a == 4 then
			WAR.PD['真利刃寒锋'][eid] = 10 
			str = "・捣虚"					
		end
		Set_Eff_Text(enemyid, "特效文字3","擒龙诀"..str)	
		if JLSD(20,50,pid) then 
			WAR.PD["锁足状态"][eid] = 1
			Set_Eff_Text(enemyid, "特效文字3","擒龙秘技・捉风捕月")
		end	
		if JLSD(20,50,pid) then 
			WAR.PD['恐惧状态'][eid] = 1
			Set_Eff_Text(enemyid, "特效文字2","擒龙秘技・抟空捕影")
		end	
		if JLSD(20,50,pid) then 
			WAR.PD['力竭'][eid] = 1
			Set_Eff_Text(enemyid, "特效文字1","擒龙秘技・捕影拿风")
		end
	end
	--连城剑法+（神照/长生）
	if wugong == 114 and (PersonKF(pid,94) or PersonKF(pid,203)) then
		local a = JY.Person[eid]["流血程度"]
		ztd(enemyid,WAR.LXXS,20)
		ztd(WAR.CurID,"生命点数",(a*6))
		if JLSD(20,50,pid) then
			zshurt = zshurt + ang
			Set_Eff_Text(enemyid, "特效文字3","i太华俯咸京・天外三峰削不成")
		end 	
		if JLSD(20,50,pid) then
			ztd(enemyid,WAR.BFXS,10)
			if JY.Person[eid]["冰封程度"] >= 35 then
				WAR.PD['利刃寒锋'][eid] = 30
			end	
			Set_Eff_Text(enemyid, "特效文字3","万里寒光生积雪・三边曙色动危旌")
		end 	
		if JLSD(20,50,pid) then
			ztd(enemyid,"内伤点数",10)
			if JY.Person[eid]["受伤程度"] >= 40 then
				WAR.PD["封印"][eid] = 10
			end
			Set_Eff_Text(enemyid, "特效文字2","鸿雁不堪愁里听・云山况是客中过")
		end 	
		if JLSD(20,50,pid) then 
			local a = math.modf(ang/10)
			ztd(enemyid,"生命点数",-a) 
			nuqi(pid,25)
			Set_Eff_Text(enemyid, "特效文字1","云里帝城双凤阙・ 雨中春树万人家")
		end 	
	end 
    --玉箫落英
	if wugong == 38 and WGZH(pid,38,12) then	
		local a = JY.Person[eid]["流血程度"]
		local b = JY.Person[pid]["内力最大值"] - JY.Person[eid]["内力"]
		ztd(enemyid,WAR.LXXS,15)
		if JY.Person[eid]["内力"] <= 3000 then
		    ztd(enemyid,"生命点数",-(b*0.1))
		end 
		if JLSD(20,50,pid) then
			WAR.PD['利刃寒锋'][eid] = 10
		end 
	end 			
		
	-----------------------------------------------------------------------
    ---------------------------多武功组合命中敌人后加成------------------------
	-----------------------------------------------------------------------
	--小无相杂学
	if WAR.XWXZX > 0 then
		if WAR.XWXZX == 1 or WAR.XWXZX == 2 then
			zshurt = zshurt + TrueQZ(pid)/2
		end
		if WAR.XWXZX == 3 or WAR.XWXZX == 4 then
			zshurt = zshurt + TrueZF(pid)/2
		end
		if WAR.XWXZX == 5 or WAR.XWXZX == 6 then
			zshurt = zshurt + TrueYJ(pid)/2
		end
		if WAR.XWXZX == 7 or WAR.XWXZX == 8 then
			zshurt = zshurt + TrueSD(pid)/2
		end
		if WAR.XWXZX == 9 or WAR.XWXZX == 10 then
			zshurt = zshurt + TrueTS(pid)/2
		end
		if WAR.XWXZX == 2 then
			ztd(enemyid,"内伤点数",15)
			if JY.Person[eid]["受伤程度"] > 80 then
				addbuff(eid,WAR.PD['重度内伤'],5,10)
			end
		end
		if WAR.XWXZX == 3 then
			local a = math.modf(TrueZF(pid) * 0.1)
			ztd(enemyid,WAR.LXXS,a)
			ztd(enemyid,'生命点数',-JY.Person[eid]["流血程度"])
		end
		if WAR.XWXZX == 7 then
			zshurt = zshurt + math.modf(TrueSD(pid)*(WAR.SPIRIT[pid] or 0)*0.05)
			if ZYJQ(pid) then
				WAR.PD['虚弱状态'][eid] = 30
				WAR.PD['脆弱状态'][eid] = 3
			end	
		end
		if WAR.XWXZX == 9 then
			zshurt = zshurt + math.modf(Qg(enemyid))
		end
		if WAR.XWXZX == 10 then
			local life = math.modf(JY.Person[eid]["生命"] * math.random(5,10)*0.01)
			ztd(enemyid,"生命点数", -life)
		end	
	end
	--阴阳铁布衫
	if ((yongjian(wugong) or yongdao(wugong)) and PersonKF(pid,77) and PersonKF(pid,196)) or (wugong == 77 and match_ID(pid,616)) then
		local a = math.modf(TrueYJ(pid)/3)
		local b = math.modf(TrueSD(pid)/3)
		local c = math.modf(TrueTS(pid)/3)
		local d = a + b + c 
		zshurt = zshurt + d 
		WAR.PD['必灼烧'][pid] = 1
		WAR.PD['必冰封'][pid] = 1
		if match_ID(pid,616) then
			local SN = math.modf(JY.Person[eid]["内力"] / 10 + 200)
			ztd(enemyid,"内力点数",-SN)
			WAR.PD['利刃寒锋'][eid] = 10
			WAR.PD['举火燎原'][eid] = 10
		end
	end
	if WAR.YYDL == 1 then
		zshurt = zshurt + math.modf(Atk(enemyid)*0.5)
	end
	if WAR.YYDL == 2 then
		ztd(enemyid,"内力点数",-(TrueSD(pid)+TrueYJ(pid)))	
	end
	if WAR.YYDL == 3 then
		zshurt = zshurt + math.modf(Def(enemyid)*0.5)	
	end
	if WAR.YYDL1 == 5 or WAR.YYDL1 == 11 then --渔网阵
		WAR.PD['锁足状态'][eid] = 1
		WAR.PD["脆弱状态"][eid] = 2
	end
	if WAR.YYDL1 == 6 or WAR.YYDL1 == 11  then	--烈阳舞
		ztd(enemyid,WAR.ZSXS,10)
		if (WAR.PD["无明业火"][eid] or 0) < 20 then
			WAR.PD["无明业火"][eid] = 20
		end	
	end
	if WAR.YYDL1 == 7 or WAR.YYDL1 == 11  then	--一文字
		ztd(enemyid,WAR.FXXS,math.random(5,15))
	end
	if WAR.YYDL1 == 8 or WAR.YYDL1 == 11  then --枣核钉
		local a = math.modf(JY.Person[pid]["暗器技巧"] * 0.8)
		local b = math.modf(JY.Person[pid]["暗器技巧"] * 0.3)
		if JLSD(10,25,pid) then
			ztd(enemyid,"生命点数",-a)
		else
			ztd(enemyid,"生命点数",-b)
		end		
	end
	if WAR.YYDL1 == 9 or WAR.YYDL1 == 11  then--霜雪扬
		WAR.PD['利刃寒锋'][eid] = (WAR.PD['利刃寒锋'][eid] or 0) + math.random(10,15)
		WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.random(20,40)
		WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + math.random(10,20)
	end
	if WAR.YYDL1 == 10 or WAR.YYDL1 == 11  then--天丛云
		WAR.PD['恐惧状态'][eid] = 1
		WAR.PD['西域奇毒'][eid] = 20
	end
	--天魔四相指
	if yongzhi(wugong) then
		if WAR.MXSX1 == 1 then
			if JY.Person[eid]["冰封程度"] >= 30 and JLSD(10,60,pid) then
				WAR.PD['寒毒入体'][eid] = 1
			end
			if JY.Person[eid]["灼烧程度"] >= 30 and JLSD(10,60,pid) then
				WAR.PD['火毒攻心'][eid] = 1
			end
			if JY.Person[eid]["受伤程度"] >= 30 and JLSD(10,60,pid) then
				WAR.PD['残劲袭魄'][eid] = 1
			end
			if JY.Person[eid]["封穴程度"] > 30 and JLSD(10,60,pid) then
				WAR.PD['封气绝脉'][eid] = 1
			end
		end
		if WAR.MXSX2 == 1 then
			local n = 0
			for j = 0, WAR.PersonNum-1 do 
				if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false then
					n = n + 1
				end
			end
			if n > 0 then
				zshurt = zshurt + math.modf(400*n)
			end
		end
		if WAR.MXSX3 == 1 then
			WAR.PD['混乱状态'][eid] = 1
		end
		if WAR.MXSX4 == 1 then
			local dao = math.modf((JY.Person[eid]["品德"])*4+100)
			ztd(enemyid,"生命点数",-dao)
		end
	end
	--三指诛仙
	if WAR.SZZX > 0 then
		zshurt = zshurt + TrueZF(pid)
		if WAR.SZZX == 2 and (JLSD(10,50,pid) or BNJQ(pid)) then
			addbuff(eid,WAR.PD['冰心状态'],10,20)
			addbuff(eid,WAR.PD['重度内伤'],10,10)
		end
		if WAR.SZZX == 3 then
			local aa = math.random(1,2)
			if aa == 1 then
				zshurt = zshurt + math.modf(JY.Person[eid]["冰封程度"]*math.random(2,5))
				WAR.PD['寒毒入体'][eid] = 1
			else
				zshurt = zshurt + math.modf(JY.Person[eid]["灼烧程度"]*math.random(4,10))
				WAR.PD['火毒攻心'][eid] = 1
			end
		end
		if WAR.SZZX == 4 then
			ztd(WAR.CurID,"内力点数",-math.random(555,999))
			zshurt = zshurt + JY.Person[pid]["内力"]
			if JY.Person[eid]["生命"] < math.modf(JY.Person[eid]["生命最大值"]*0.5) then
				WAR.PD['诛仙状态'][eid] = 30
			end
		end	
	end
	--五岳神剑真传盟主专属
	if WAR.WYLW1 > 0 and JY.Person[eid]["冰封程度"] and DWPD(WAR.CurID,enemyid)  then
		hurtzs1[#hurtzs1+1] = JY.Person[eid]['冰封程度'] / 120
	end
	if WAR.WYLW2 > 0 and JY.Person[eid]["中毒程度"] > 0 and DWPD(WAR.CurID,enemyid)  then
		hurtzs1[#hurtzs1+1] = JY.Person[eid]["中毒程度"] / 150 
	end
	if WAR.WYLW3 > 0 and JY.Person[eid]["灼烧程度"] > 0 and DWPD(WAR.CurID,enemyid)  then
		hurtzs1[#hurtzs1+1] = JY.Person[eid]["灼烧程度"] / 120
	end
	if WAR.WYLW4 > 0 and JY.Person[eid]["受伤程度"] > 0 and DWPD(WAR.CurID,enemyid)  then
		hurtzs1[#hurtzs1+1] = JY.Person[eid]["受伤程度"] / 120
	end
	if WAR.WYLW5 > 0 and JY.Person[eid]["流血程度"] > 0 and DWPD(WAR.CurID,enemyid)  then
		hurtzs1[#hurtzs1+1] = JY.Person[eid]["流血程度"] / 120
	end
	--五岳神剑 万花 第三、第四
	if WAR.WYLW1 == 1 and DWPD(WAR.CurID,enemyid) then
		addbuff(eid,WAR.PD['冰冻状态'],math.modf(JY.Person[eid]["冰封程度"]/4),40)
	end
	if WAR.WYLW1 == 3 and DWPD(WAR.CurID,enemyid) then
		ztd(enemyid,'体力点数',-25)
		if WAR.PD['虚弱状态'][eid] == nil or WAR.PD['虚弱状态'][eid] < 30 then
			WAR.PD['虚弱状态'][eid] = 30
		end	
		if WAR.PD['脆弱状态'][eid] == nil or WAR.PD['脆弱状态'][eid] < 3 then
			WAR.PD['脆弱状态'][eid] = 3
		end
		if WAR.PD['迟缓状态'][eid] == nil or WAR.PD['迟缓状态'][eid] < math.modf(JY.Person[eid]["冰封程度"]/4) then
			WAR.PD['迟缓状态'][eid] = math.modf(JY.Person[eid]["冰封程度"]/4)
		end
	end
	if WAR.WYLW1 == 4 and DWPD(WAR.CurID,enemyid) then
		ztd(enemyid,'内力点数',-hurt)
		WAR.PD['寒毒入体'][eid] = 1
	end
	--五岳神剑东岳
	if WAR.WYLW2 > 0 and JLSD(10,40,pid) then
		ztd(enemyid,'中毒点数',math.random(5,10)) 
	end
	if WAR.WYLW2 == 1 then
		local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 500)
		if d < 10 then
		   d = 10
		end
		zshurt = zshurt + math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"])*0.03*d)
		if math.random(10) > 4 then
			WAR.PD['恐惧状态'][eid] = (WAR.PD['恐惧状态'][eid] or 0) + 1
		end	
	end	
	if WAR.WYLW2 == 3 then
		WAR.PD['西域奇毒'][eid] = limitX((WAR.PD['西域奇毒'][eid] or 0) + math.modf(JY.Person[eid]["中毒程度"]/15),0,30)
		WAR.PD['基础蛊毒'][eid] = 1
	end
	--五岳神剑南岳
	if WAR.WYLW3 == 2 and DWPD(WAR.CurID,enemyid) then--松明抚斩
		zshurt = zshurt + math.modf(JY.Person[pid]["轻功"] * 2)
		hurtzs1[#hurtzs1+1] = JY.Person[eid]["内力"] / JY.Person[eid]["内力最大值"]
		if JY.Person[eid]["灼烧程度"] > 0 then
			hurtzs1[#hurtzs1+1] = JY.Person[eid]["灼烧程度"]/100
		end
	end
	if WAR.WYLW3 == 4 and DWPD(WAR.CurID,enemyid) then
		if math.random(2) == 1 then
			WAR.PD['怒气负面效果1'][eid] =  1
		else
			WAR.PD['怒气负面效果2'][eid] =  1
		end	
	end
	if WAR.WYLW3 == 3 and DWPD(WAR.CurID,enemyid) then
		WAR.PD['火毒攻心'][eid]= 1
		if JY.Person[eid]["灼烧程度"] > 40 and JLSD(10,45,pid) then
			WAR.PD['举火燎原'][eid] = 15
		end	
	end
	--五岳神剑中岳
	if WAR.WYLW4 == 1 then
		local aa = math.modf(Def(enemyid)-Def(WAR.CurID)/200)
		if aa < 0 then aa = -aa/2 end
		hurtzs1[#hurtzs1+1] = aa
	end
	--五岳神剑西岳
	if WAR.WYLW5 == 1 and DWPD(WAR.CurID,enemyid) then
		local aa = math.modf(Atk(enemyid)-Atk(WAR.CurID)/200)
		if aa < 0 then aa = -aa/2 end
		hurtzs1[#hurtzs1+1] = aa
	end
	if WAR.WYLW5 == 2 then --华山领悟
		local n = 0
		for j = 0, WAR.PersonNum - 1 do
			local tmppid = WAR.Person[j]["人物编号"]
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] and n < 10 then
				n=n+1
			end
		end	
		local fhurt = math.modf(TrueYJ(pid) * n / 400)
		hurtzs1[#hurtzs1+1] = fhurt - 1
	end
	if WAR.WYLW5 == 3 and DWPD(WAR.CurID,enemyid) then
		local aa = math.modf(TrueYJ(pid)-TrueYJ(eid))
		if aa < 0 then aa = -aa end
		aa = aa + 5
		WAR.PD['创伤'][eid] = limitX((WAR.PD['创伤'][eid] or 0) + aa,0,30)
	end
	--五岳北岳
	if WAR.WYJF == 4 or WAR.WYJF == 6 then
		WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + math.random(5)
	end	
	if WAR.WYJF1 == 1 then
		ztd(enemyid,'生命点数', -math.random(25,125))
	end
	--五岳神剑
	if WAR.WYJF > 4 then
		ztd(enemyid,"内伤点数",math.random(5,25)) 
	end
	--易水四寒
	if (wugong == 21 or wugong == 153) and Curr_NG(pid,43) and WAR.PD['易水四寒2'][pid] ~= nil then
		if WAR.PD['易水四寒'][eid] == nil  and JLSD(10,45,pid) then
			WAR.PD['易水四寒'][eid] = WAR.PD['易水四寒2'][pid]
			WAR.PD['易水四寒1'][eid] = 0
		end	
		if WAR.YSSH1 == 1 or WAR.PD['雪羽战神'][pid] == 1 then
			local str = '瀑雪倾泻'
			ztd(enemyid,WAR.BFXS,math.random(10,25))
			if psx(eid,'冰封程度') >= 100 then
				WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.random(3,7)
			end
			if (WAR.PD['冰冻状态'][eid] or 0) >= 30 then
				WAR.PD['利刃寒锋'][eid] = (WAR.PD['利刃寒锋'][eid] or 0) + math.random(3,7)
			end
			if WAR.PD['易水四寒'][eid] ~= nil then
				hurtzs1[#hurtzs1+1] = WAR.MYCHAIN * 0.1
				if WAR.PD['易水四寒'][eid] == 1 or WAR.PD['易水四寒'][eid] == 5 then
					str = '玄天寒・瀑雪倾泻'
					ztd(enemyid,'生命点数',-math.modf(psx(pid,'冰封程度')*3))
				end
			end	
			Set_Eff_Text(enemyid,1,str)
		end
		if WAR.YSSH2 == 1 or WAR.PD['雪羽战神'][pid] == 1 then
			local str = '万鬼哀嚎'
			if math.random(100) > 75 then
				WAR.PD['混乱状态'][eid] = 1
			elseif math.random(100) > 65 then
				WAR.PD['恐惧状态'][eid] = 1
			end
			if WAR.PD['易水四寒'][eid] ~= nil then
				local a = math.modf(psx(eid,'冰封程度')*0.01)
				if a < 1 then a = 1 end
				zshurt = zshurt + math.modf((1000 - WAR.Person[enemyid].TimeAdd)*a)
				if WAR.PD['易水四寒'][eid] == 2 or WAR.PD['易水四寒'][eid] == 5 then
					ztd(enemyid,'生命点数',-math.modf(1000 - WAR.Person[enemyid].TimeAdd))
					WAR.PD['举火燎原'][eid] = math.random(10,20)
					str = '冥狱寒・万鬼哀嚎'
				end
			end	
			Set_Eff_Text(enemyid,1,str)				
		end	
		if WAR.YSSH3 == 1 or WAR.PD['雪羽战神'][pid] == 1 then
			local str = '冰覆双极'
			
			if WAR.PD['易水四寒'][eid] == 3 or WAR.PD['易水四寒'][eid] == 5 then
				zshurt = zshurt + math.modf(psx(eid,'生命最大值')*0.05*(psx(pid,'冰封程度')+1)*0.02)
				str = '沧海寒・冰覆双极'
			end	 
			Set_Eff_Text(enemyid,1,str)
		end	
		if WAR.YSSH4 == 1 or WAR.PD['雪羽战神'][pid] == 1 then
			local str = '幽魂恸哭'
			if JLSD(10,55,pid) then
				WAR.PD['虚弱状态'][eid] = (WAR.PD['虚弱状态'][eid] or 0) + 10
			end	
			if JLSD(10,45,pid) then
				WAR.PD['脆弱状态'][eid] = 2
			end
			if WAR.PD['易水四寒'][eid] ~= nil then
				hurtzs1[#hurtzs1+1] = DWJL(WAR.CurID,enemyid)*0.1
				if WAR.PD['易水四寒'][eid] == 4 or WAR.PD['易水四寒'][eid] == 5 then
					local a = math.modf((10-DWJL(WAR.CurID,enemyid))*150)
					if a < 150 then a = 150 end
					ztd(enemyid,'生命点数',-a)
					WAR.PD['西域奇毒'][eid] = (WAR.PD['西域奇毒'][eid] or 0) + 10
					str = '溟渊寒・幽魂恸哭'
				end	
			end	
			Set_Eff_Text(enemyid,1,str)
		end
		if WAR.PD['易水四寒2'][pid] == 5 or WAR.PD['雪羽战神'][pid] == 1 then
			zshurt = zshurt + math.modf(psx(pid,'内力最大值')*0.3)
		end	
	end
	-----------------------------------------------------------------------
    ---------------------------武器装备命中敌人后加成------------------------
	-----------------------------------------------------------------------
	--套装效果
	if PDTZ(pid,JY.Person[pid]["武器"]) and wugong > 0 then
		local n = JY.Person[pid]["武器"]
		if Setmeal[n][4] <=18 then
			--冻结
			if Setmeal[n][4] == 1 then
				WAR.PD["冰冻状态"][eid] = (WAR.PD["冰冻状态"][eid] or 0) + math.random(2,5)
				WAR.PD["利刃寒锋"][eid] = (WAR.PD["利刃寒锋"][eid] or 0) + math.random(1,3)
				WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + math.random(2,5)
				if  WAR.PD["冰冻状态"][eid] > 50 then
					WAR.PD["冰冻状态"][eid] = 50
				end
				Set_Eff_Text(enemyid,3,"冻结")
			end
			--点燃
			if Setmeal[n][4] == 2 then
				if JLSD(0, 50, pid) then
					WAR.PD['举火燎原'][eid] = (WAR.PD['举火燎原'][eid] or 0) + math.random(3,5)
					Set_Eff_Text(enemyid,3,"点燃")
				end
			end
			--剧毒
			if Setmeal[n][4] == 3 then
				WAR.PD['毒击'][eid] = (WAR.PD['毒击'][eid] or 0) + math.random(2,5)
				Set_Eff_Text(enemyid,3,"剧毒")
			end
			--昏迷
			if Setmeal[n][4] == 4 then
				if JLSD(0,10, pid) then
					WAR.PD["昏迷状态"][eid] = 1
					Set_Eff_Text(enemyid,3,"昏迷")
				end
			end
			--撕裂
			if Setmeal[n][4] == 5 then
				if JLSD(0, 50, pid) then
					WAR.PD['扫荡群魔'][eid] = (WAR.PD['扫荡群魔'][eid] or 0) + math.random(5,10)
					ztd(enemyid,WAR.LXXS,math.random(5,15))
					Set_Eff_Text(enemyid,3,"撕裂")
				end
			end
			--虚弱
			if Setmeal[n][4] == 6 then
				if JLSD(0, 50, pid) then
					WAR.PD["虚弱状态"][eid] = (WAR.PD["虚弱状态"][eid] or 0) + math.random(5,15)
					Set_Eff_Text(enemyid,3,"虚弱")
				end
			end
			--再次行动
			if Setmeal[n][4] == 7 then
				WAR.PD["再次行动"][pid] = 20
			end
			--集气加速
			if Setmeal[n][4] == 8 then
				if JLSD(0, 50, pid) then
					WAR.PD["集气速度"][pid] = (WAR.PD["集气速度"][pid] or 0) + math.random(3,8) 
				end
			end
			--同归
			if Setmeal[n][4] == 9 then
				if JLSD(0, 30, pid) then
					WAR.PD["同归状态"][eid] = 1
					Set_Eff_Text(enemyid,3,"同归")
				end
			end
			--麻痹
			if Setmeal[n][4] == 10 then
				if JLSD(0, 30, pid) then
					WAR.PD["麻痹状态"][eid] = (WAR.PD["麻痹状态"][eid] or 0) + 1
					Set_Eff_Text(enemyid,3,"锁足")
				end
			end
			--反击
			if Setmeal[n][4] == 11 then
				if JLSD(0, 40, pid) then
					WAR.PD["刺猬状态"][pid] = 1
				end
			end
			--格挡
			if Setmeal[n][4] == 12 then
				WAR.PD["格挡状态"][pid] = 1
				if JLSD(0, 40, pid) then
					WAR.PD["不破防"][pid] = 1
				end
			end
			--散功
			if Setmeal[n][4] == 13 then
				if JLSD(0, 50, pid) then
					WAR.PD["散功状态"][eid] = (WAR.PD["散功状态"][eid] or 0) + math.random(5,10)
					Set_Eff_Text(enemyid,3,"散功")
				end
			end
			--外伤
			if Setmeal[n][4] == 14 then
				if JLSD(0, 30, pid) then
					addbuff(eid,WAR.PD["生命恢复停止"],1,2)
				end
			end
			--集气紊乱
			if Setmeal[n][4] == 15 then
				if JLSD(0, 50, pid) then
					addbuff(eid,WAR.PD['灵蛇拳'],5,15)
					Set_Eff_Text(enemyid,3,"集气紊乱")
				end
			end
			--恐惧
			if Setmeal[n][4] == 16 then
				if JLSD(0, 10, pid) then
					WAR.PD["恐惧状态"][eid] = 1
					Set_Eff_Text(enemyid,3,"恐惧")
				end
			end
			--废除封穴
			if Setmeal[n][4] == 17 then
				if JLSD(0, 30, pid) then
					WAR.PD["邪魅苍生"][eid] = (WAR.PD["邪魅苍生"][eid] or 0) + math.random(1,5)
					Set_Eff_Text(enemyid,3,"断脉")
				end
			end
			--迟缓
			if Setmeal[n][4] == 18 then
				if JLSD(0, 50, pid) then
					WAR.PD["迟缓状态"][eid] = (WAR.PD["迟缓状态"][eid] or 0) + math.random(3,5)
					Set_Eff_Text(enemyid,3,"迟缓")
				end
			end
		end
	end	
	--装备6级鸳鸯刀或天衣无缝组合，夫妻伤害提高20%
    if (JY.Person[pid]["武器"] == 217 and wugong == 62 and JY.Thing[217]["装备等级"] == 6) or (WGZH(pid,54,62) and wugong == 62) then
        hurtzs1[#hurtzs1+1] = 0.2
    end	
    if (JY.Person[pid]["武器"] == 218 and wugong == 54 and JY.Thing[218]["装备等级"] == 6) or (WGZH(pid,54,62) and wugong == 54) then
        hurtzs1[#hurtzs1+1] = 0.2
    end
	--西毒蛇杖、灵蛇杖法
	if JY.Person[pid]["武器"] == 244 or wugong == 81 then
		WAR.PD["散功状态"][eid] = 20
		ztd(enemyid,"中毒点数",45)
	end
	--伏魔禅杖造成内伤10~15点
	if JY.Person[pid]["武器"] == 323 and JY.Thing[323]["装备等级"] >= 2 and JLSD(0, 50+(JY.Thing[323]["装备等级"]-1)*10, pid) then
		ztd(enemyid,"内伤点数",math.random(10,15))
	end
	--张家辉的麻痹戒指
	if JY.Person[pid]["防具"] == 301 then
		local mb = 1
		if JY.Thing[301]["装备等级"] >=5 then
			mb = 3
		elseif JY.Thing[301]["装备等级"] >=3 then
			mb = 2
		end
		WAR.PD["麻痹状态"][eid] = mb
	end
	-----------------------------------------------------------------------
    ---------------------------异常状态命中敌人后加成------------------------
	-----------------------------------------------------------------------
	--一刀流・无影无相
	if WAR.WYWX[pid] ~= nil then
		hurtzs1[#hurtzs1+1] = -0.5
	end
	--微醺
	if WAR.PD['微醺'][pid] ~= nil and WAR.PD['微醺'][pid] > 0 then
		zshurt = zshurt+math.modf(WAR.PD['微醺'][pid]*100)
	end	
	--醉八仙
	if WAR.PD['醉八仙'][pid] ~= nil and (yongquan(wugong) or yongte(wugong)) then
		zshurt = zshurt+TrueQZ(pid)+TrueTS(pid)
	end
	--神兵
	if WAR.PD['神兵'][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = 0.5
	end
	if WAR.PD['阳神降世'][pid] ~= nil then
		addbuff(eid,WAR.PD['阳气侵蚀'],30)	
		zshurt = zshurt + math.modf((psx(eid,'内力最大值')-psx(eid,'内力'))*2)
	end
	if WAR.PD['阴圣再临'][pid] ~= nil then
		addbuff(eid,WAR.PD['阴气污染'],30)
		if JLSD(10,35,pid) then
			WAR.PD['九阴摄魂'][eid] = 1
		elseif JLSD(10,65,pid) then
			WAR.PD['集气倒退'][eid] = limitX((WAR.PD['集气倒退'][eid] or 0) +5,0,20)
		end		
	end
	--昆仑刀剑阵攻击
	if rwnlxz(pid,0) and WAR.PD['顺逆两仪2'][pid] ~= nil and JLSD(0,math.modf(WAR.PD['顺逆两仪2'][pid]*15)+10,pid) then
		hurtzs1[#hurtzs1+1] = -0.4
	end
	if WAR.PD['风雷惊蛰1'][pid] ~= nil then
		local a = WAR.PD['风雷惊蛰1'][pid]
		if WAR.ACT > 2 and JLSD(0,math.modf(a*15)+10,pid) and psx(eid,"受伤程度") > 0 then
			ztd(enemyid,"生命点数",-psx(eid,"受伤程度"))
			Set_Eff_Text(enemyid, 1,"怒雷招来",71)	
		end
	end
	if WAR.PD['风雷惊蛰3'][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = 0.5
		Set_Eff_Text(WAR.CurID,1,'真・怒雷辟野')
	end
	if WAR.PD['天剑绝刀1'][pid] ~= nil then
		zshurt = zshurt + TrueYJ(pid) + TrueSD(pid)
		if WAR.TJJD == 1 then
			hurtzs1[#hurtzs1+1] = 0.5
			WAR.PD['侵如火'][pid] = 1
			WAR.PD['创伤'][eid] = limitX((WAR.PD['创伤'][eid] or 0) + 10,0,30)
			if JLSD(0,60,pid) then
				WAR.PD['恐惧状态'][eid]	= 1
			end
		end
	end
	if WAR.PD['天剑绝刀2'][pid] ~= nil then
		if yongjian(wugong) or yongdao(wugong) then
			hurtzs1[#hurtzs1+1] = -0.5
		else
			hurtzs1[#hurtzs1+1] = -0.2
		end
	end
	--陷阱
	if WAR.PD['败血破命'][pid] ~= nil and WAR.NGJL > 0 then
		zshurt = zshurt - math.random(300,500)
	end	
	if WAR.PD['无极剑环'][pid] ~= nil then
		zshurt = zshurt - WAR.PD['无极剑环'][pid] * 2
		WAR.PD['无极剑环'][pid] = nil
	end
	--黄天无极割裂
	if WAR.XWSD[pid] ~= nil and WAR.XWSD[pid] > 0 then 
		zshurt = zshurt - math.modf(100*WAR.LBPM)
		WAR.XWSD[pid] = nil
	end
	--碧海玉箫
	if WAR.BYCX[pid] ~= nil and WAR.BYCX[pid] > 0 then
		hurtzs1[#hurtzs1+1] = -0.9
		WAR.BYCX[pid] = nil
	end
	--斗转星移伤害和杀集气计算
	if WAR.DZXYLV[pid] ~= nil and WAR.DZXYLV[pid] > 10 and MuRongDZ(pid) then
		local dz = WAR.DZXYLV[pid] / 50
		hurtzs1[#hurtzs1+1] = dz
	end
	if WAR.PD["参合状态"][pid] ~= nil then
		local b = math.random(7,9)*0.1 - 1
		hurtzs1[#hurtzs1+1] = b
	end
	--标主西瓜刀境增伤
	if WAR.PD['西瓜刀・残刀'][pid] ~= nil then 
		if WAR.PD['西瓜刀・残刀'][pid][1] ~= nil then 
			local pf = WAR.PD['西瓜刀・残刀'][pid][1]
			local xg =  pf/100
			hurtzs1[#hurtzs1+1] = xg
		end
	end
	--逆运走火
	if WAR.PD["走火状态"][pid] == 1 or match_ID(pid, 98) then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--菩提咒伤害增加10%
	if WAR.PD["菩提咒"][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = 0.2
	end
	--虚弱状态，伤害减半
	if WAR.PD["虚弱状态"][pid] ~= nil or (WAR.NGJL > 0 and WAR.PD['业障缠身'][pid] == 31)  then
		hurtzs1[#hurtzs1+1] = -0.5
	end
	--放下屠刀伤害减少30%
	if WAR.PD["放下屠刀"][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = -0.3
	end	
	--七伤拳，意恍惚
	if WAR.PD["意恍惚"][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = -0.3
	end
	--金刚咒伤害减少20%
	if WAR.PD["金刚咒"][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = -0.2
	end
	if WAR.PD["洞火"][pid] ~= nil then
		hurtzs1[#hurtzs1+1] = -0.9
	end
	--野球拳境
	if WAR.PD['野球拳'][pid] == 1 then
		ztd(enemyid,"内伤点数",math.random(15,20)) 
	end
	--霍青桐指挥
	if WAR.HQT_ZL[pid]~= nil then --1041
		local n = 0
		local n1 = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"]  then
				n = n + 1
			end	
		end
		hurtzs1[#hurtzs1+1] = n * 0.05
	end
	--曼珠沙华，血量越低伤害越高，100%血无加成，0血100%加成
	if WAR.JYZT[pid]~=nil then
	    local bonus_perctge = 0
	    bonus_perctge = 1 - JY.Person[pid]["生命"] / JY.Person[pid]["生命最大值"]
		hurtzs1[#hurtzs1+1] = bonus_perctge
	end
	--万佛朝宗
	if WAR.PD["万佛朝宗"][pid]~=nil and WAR.PD["万佛朝宗"][pid] == 1 then
		local a1 = JY.Person[eid]["生命" ]/JY.Person[eid]["生命最大值"]
		local nl = JY.Person[eid]["内力最大值"] * 0.05
		zshurt = zshurt + math.modf(JY.Person[eid]["生命"]*0.2)	
		ztd(enemyid,"内力点数",-nl)
		if a1 < 0.333 and JLSD(0, (1-a1) * 20,pid) then
			zshurt = zshurt + JY.Person[eid]["生命"]
		end
	end
	--护龙军师大阵
	if WAR.PD["后土阵"][pid] == 1 then
		for j = 0, WAR.PersonNum - 1 do
			local p = WAR.Person[j]["人物编号"]
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				if WAR.PD['麻痹状态'][p] == nil then
					WAR.PD['麻痹状态'][p] = 3
				end
			end
		end
	end
	--左右互搏蓄力
	if WAR.PD['互搏真谛蓄力'][pid] ~= nil and (WAR.ZYHB == 2 or WAR.PD['真左右互搏'][pid] == 1) then
		zshurt = zshurt + WAR.PD['互搏真谛蓄力'][pid]
		if math.random(10) > 8 or WAR.ACT > 1 then
			WAR.PD['互搏真谛蓄力'][pid] = nil
		end	
	end
	--战神状态
	if WAR.PD['战神状态'][pid] ~= nil and JLSD(10,40,pid) then
		local jcyc = {'受伤程度','流血程度','中毒程度','封穴程度','冰封程度','灼烧程度'}
		local jjyc = {'重度内伤','西域奇毒','毒击','创伤','冰魄毒','举火燎原'}
		for k = 1, #jcyc do
			if psx(eid,jcyc[k]) > 0 then
				WAR.PD[jjyc[k]][eid] = (WAR.PD[jjyc[k]][eid] or 0) + 5
				if k == 5 then
					WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + 10
				end
			end
		end	
	end
	--密宗龙象拳、龙木岛主
	if WAR.LXBRZ == 1 then
		if WAR.PD['重度内伤'][eid] == nil then
			WAR.PD['重度内伤'][eid] = 10
		end
		if WAR.PD['散功状态'][eid] == nil then
			WAR.PD['散功状态'][eid] = 10
		end
		ztd(enemyid,"内伤点数",math.random(15,20)) 
	end	
	if WAR.LXBRZ == 2 then
		for j = 1,#WAR.Debuf10 do
			local yc =  WAR.Debuf10[j][1]
			if WAR.PD[yc][pid] ~= nil then
				WAR.PD[yc][eid] = WAR.PD[yc][pid]
			end	
		end		
		for j = 1,#WAR.Debuf11 do
			local yc = WAR.Debuf11[j][1]
			if WAR.PD[yc][pid] ~= nil then
				WAR.PD[yc][eid] = WAR.PD[yc][pid]
			end
		end
		for j = 1,#WAR.Debuf3 do
			local yc = WAR.Debuf3[j][1]
			if WAR.PD[yc][pid] ~= nil then
				WAR.PD[yc][eid] = WAR.PD[yc][pid]
			end
		end
	end	
	--畅想暴怒技
	if WAR.PD['玩家暴怒'][pid] ~= nil and WAR.PD['玩家暴怒'][pid] == 1 then
		local kx = 8 - JY.Person[pid]["畅想分阶"]
		local lx = kx*70
		hurtzs1[#hurtzs1+1] = 1
		zshurt = zshurt + 100*kx
		local a = JY.Person[eid]["受伤程度"]
		local b = JY.Person[eid]["中毒程度"]
		local c = JY.Person[eid]["冰封程度"]
		local d = JY.Person[eid]["灼烧程度"]
		local e = JY.Person[eid]["封穴程度"]
		local f = JY.Person[eid]["流血程度"]
		local g = a + b + c + d + e + f
		ztd(enemyid,"生命点数",-g)
		ztd(enemyid,"生命点数",-lx)
	end
	--电脑暴怒技
	if WAR.PD['电脑暴怒'][pid] ~= nil and WAR.PD['电脑暴怒'][pid] == 1 then
		local kx = 8 - JY.Person[pid]["畅想分阶"]
		local lx = kx*50
		hurtzs1[#hurtzs1+1] = 1
		zshurt = zshurt + JY.Base["周目"]*JY.Base["难度"]*kx
		local a = JY.Person[eid]["受伤程度"]
		local b = JY.Person[eid]["中毒程度"]
		local c = JY.Person[eid]["冰封程度"]
		local d = JY.Person[eid]["灼烧程度"]
		local e = JY.Person[eid]["封穴程度"]
		local f = JY.Person[eid]["流血程度"]
		local g = a + b + c + d + e + f
		ztd(enemyid,"生命点数",-g)
		ztd(enemyid,"生命点数",-lx)
	end
	-----------------------------------------------------------------------
    ---------------------------门派命中敌人后加成---------------------------
	-----------------------------------------------------------------------
	local n = MPPD(pid)
	if MPTX(pid,1) and DWPD(WAR.CurID,enemyid) then  --星宿
		local mpdj=MPDJ(pid)
		if match_ID(pid,46) then
			mpdj = 3
		end
		zshurt = zshurt + JY.Person[pid]["用毒能力"]*2
		zshurt = zshurt + math.modf((JY.Person[eid]["中毒程度"] + JY.Person[pid]["中毒程度"])*0.7*(mpdj+1))
		if WAR.SYWGZ == 2 and DWPD(WAR.CurID,enemyid) then----引毒
			zshurt = zshurt + math.modf((JY.Person[eid]["中毒程度"]) *(mpdj+1))
			local YD = math.modf(JY.Person[eid]["中毒程度"])
			ztd(enemyid,'生命点数',-YD)
		end
		if (PersonKF(pid,87) and match_ID(pid,47) and JLSD(10,50,pid)) or (PersonKF(pid,87) and MPTX(pid,1,2) and JLSD(10,65,pid)) then
			local YD=math.modf(JY.Person[eid]["中毒程度"]*mpdj/3)
			WAR.PD["毒击"][eid] = WAR.PD["毒击"][eid] or 0 + YD
			WAR.PD["中毒不解"][eid] = (WAR.PD["中毒不解"][eid] or 0) + YD
			Set_Eff_Text(enemyid,1,"神木毒髓.摧脉毒心",132)
		end
		--星宿2级弟子
		if MPTX(pid,1,2) then
			ztd(enemyid,"中毒点数",100)
			if JLSD(20,50,pid) then
				WAR.PD["星宿奇毒"][eid] = 10
				Set_Eff_Text(enemyid, "特效文字3", "星宿奇毒・损脉伤心")
			end
		end 	
		if MPTX(pid,1,2) then
			local str = ""
			local a = math.random(1,6)
			local b = 0
			if MPTX(pid,1,3) then
				b = a
			end
			if a == 1 or b == 6 then
				ztd(enemyid,'内伤点数',50)
				local c = JY.Person[eid]["受伤程度"] * 3
				ztd(enemyid,'生命点数',-c)
				zshurt = zshurt + c
			str = "・抽髓掌"	
			elseif a == 2 or b == 5 then
				ztd(enemyid,WAR.BFXS,50)
				local c = JY.Person[eid]["冰封程度"] * 3
				ztd(enemyid,'生命点数',-c)
				zshurt = zshurt + c
			str = "・穿心钉"				
			elseif a == 3 or b == 4 then
				ztd(enemyid,WAR.ZSXS,50)
				local c = JY.Person[eid]["灼烧程度"] * 3
				ztd(enemyid,'生命点数',-c)
				zshurt = zshurt + c
			str = "・极乐刺"		
			elseif a == 4 or b == 3 then
				ztd(enemyid,WAR.LXXS,50)
				local c = JY.Person[eid]["流血程度"] * 3
				ztd(enemyid,'生命点数',-c)
				zshurt = zshurt + c
			str = "・无形粉"			
			elseif a == 5 or b == 2 then
				ztd(enemyid,WAR.FXXS,20)
				local c = JY.Person[eid]["封穴程度"] * 3
				ztd(enemyid,'生命点数',-c)
				zshurt = zshurt + c
				str = "・碧磷针"		
			elseif a == 6 or b == 1 then
				ztd(enemyid,'中毒点数',50)
				local c = JY.Person[eid]["中毒程度"] * 3
				ztd(enemyid,'生命点数',-c)
				ztd(enemyid,'体力点数',-10)
				zshurt = zshurt + c
				str = "・腐尸毒"
			end 	
			Set_Eff_Text(enemyid, "特效文字2","星宿毒功"..str)
		end
		--星宿3级弟子
		if MPTX(pid,1,3) and PersonKF(pid,87) and JLSD(20,50,pid) then
			WAR.PD["连环腐尸毒"][eid] = 10
			WAR.LHFSD = 1
			Set_Eff_Text(enemyid, "特效文字3", "星宿邪功・连环腐尸毒")
		end 
		if MPTX(pid,1,3) then
			zshurt = zshurt + math.modf((JY.Person[pid]["体力"]/5+JY.Person[pid]["中毒程度"])*(JY.Person[pid]["中毒程度"]/20))
		end
		--星宿九死龙爪
		if wugong == 20 and WAR.JSLZ > 0 then
			if WAR.PD['龙爪毒'][pid] ~= nil then
				WAR.PD['龙爪毒'][pid] = nil
			end
			if (WAR.PD['龙爪毒'][eid] or 0) < 1 and JLSD(10,50,pid) then
				WAR.PD['龙爪毒'][eid] = 1
			end	
			local mpdj = math.random(2,4)
			zshurt = zshurt + math.modf((JY.Person[eid]["中毒程度"] + JY.Person[pid]["中毒程度"]) * 0.7*(mpdj+1))
			if DWPD(WAR.CurID,enemyid) then----引毒
				zshurt = zshurt + math.modf((JY.Person[eid]["中毒程度"]) *(mpdj+1))
				local YD = math.modf(JY.Person[eid]["中毒程度"])
				ztd(enemyid,'生命点数',-YD)
			end
			if JLSD(10,65,pid) then
				local YD = math.modf(JY.Person[eid]["中毒程度"]*mpdj*0.33)
				WAR.PD["毒击"][eid] = (WAR.PD["毒击"][eid] or 0) + YD
				WAR.PD["中毒不解"][eid] = (WAR.PD["中毒不解"][eid] or 0) + YD
				Set_Eff_Text(enemyid,1,"九死龙爪・诡毒食髓")
			end
			if PersonKF(pid,11) and JLSD(10,40,pid) then
				WAR.PD['创伤'][eid] = 20
				ztd(enemyid,WAR.LXXS,JY.Person[eid]["中毒程度"])
				Set_Eff_Text(enemyid,2,"九死龙爪・戮血暗毒")
			end
			if PersonKF(pid,11) and PersonKF(pid,4) and PersonKF(pid,87) and JY.Person[eid]["中毒程度"] > 100 and JLSD(0,40,pid) then	
				ztd(enemyid,'内力点数',-math.modf(JY.Person[eid]["内力"]))
				ztd(enemyid,'中毒点数',300)
				if math.random(100) > 75 and JY.Person[eid]["生命"] < math.modf(JY.Person[eid]["生命最大值"]*0.2) then
					Set_Eff_Text(enemyid,0,"九死龙爪・狱龙索命")
					ztd(enemyid,'生命点数',-JY.Person[eid]["生命"])
					JY.Person[eid]["生命"] = 0
					WAR.Person[enemyid]["死亡"] = true
					WarSetPerson()
				end	
			end	
		end
		--星宿暴怒技
		if MPTX(pid,1,2) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = JY.Person[eid]["中毒程度"]
			ztd(enemyid,"中毒点数",100)
			ztd(enemyid,"生命点数",-(a * 3))
			ztd(WAR.CurID,"生命点数",(a * 1.5))
		end
	end
	--丐帮
	if MPTX(pid,2) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,50) then
			mpdj = 4
		end
		if match_ID(pid,69) then
			mpdj = 4
		end		
		if JLSD(0,30,pid) then
			WAR.TD = - 2
		end
		zshurt = zshurt + 200*mpdj
		nuqi(pid,3*mpdj)
		--丐帮2级
		if MPTX(pid,2,2) then
			if PersonKF(pid,215) then
				ztd(enemyid,'中毒点数',10)
				local a = JY.Person[eid]["中毒程度"] * 2
				zshurt = zshurt + a
			end
			if Curr_NG(pid,204) then
				local a = JY.Person[pid]["品德"] * 3 
				zshurt = zshurt + a
			end
		end
		--丐帮3级弟子
		if MPTX(pid,2,3) and (yongquan(wugong) or yongte(wugong) or WAR.PD['醉八仙'][pid] ~= nil) and JLSD(20,50,pid) then
			local str = ""
			local a = math.random(1,3)
			if a == 1 then
				local aa = Atk(WAR.CurID)*0.2
				ztd(enemyid,"生命点数",-aa)
				str = "醉罗汉・睁眉怒目力降龙"
			elseif a == 2 then
			local aa = Def(WAR.CurID)*0.2
				ztd(enemyid,"生命点数",-aa)
				str = "醉仙鹤・长空展翅连环击"	
			elseif a == 3 then	
			local aa = Qg(WAR.CurID)*0.2
				ztd(enemyid,"生命点数",-aa)
				str = "醉猛虎・奔腾下山擒豺狼"
			end
			Set_Eff_Text(enemyid, "特效文字2","醉拳奥义・"..str)
		end
		if WAR.GBZY > 0 then
			hurtzs1[#hurtzs1+1] = 0.1*WAR.GBZY
		end	
		--丐帮醉八仙
		if WAR.ZBX > 0 then
			zshurt = zshurt + 200*WAR.ZBX
			if WAR.ZBX == 8 then
				ztd(enemyid,'生命点数',-888)
			end
		end
		--丐帮帮主
		if WAR.GBBZ == 1 then 
			WAR.BBF = 1
			WAR.BZS = 1
			local a = TrueQZ(pid) / 2
			local b = TrueTS(pid) / 2
			local c = a + b
			zshurt = zshurt + math.modf(c)
		end
		--丐帮暴怒技
		if BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.4
			local a = TrueQZ(pid)
			local b = TrueTS(pid)
			zshurt = zshurt + a + b
			ztd(enemyid,"内伤点数",18)
			ztd(enemyid,WAR.LXXS,18)
		end
	end
	--古墓
	if MPTX(pid,3) and DWPD(WAR.CurID,enemyid) then  
		local mpdj=MPDJ(pid)
		if match_ID(pid,605) then
			mpdj = 3
		end	
		hurtzs1[#hurtzs1+1] = 0.3
		--古墓1级弟子
		if MPTX(pid,3,1) then
			WAR.PD['必冰封'][pid] = 1
			WAR.PD['必灼烧'][pid] = 1
			ztd(enemyid,"内伤点数",12)	
			ztd(enemyid,WAR.LXXS,12)
			if JLSD(20,50,pid) then		
				if WAR.PD["虚弱状态"][eid] == nil then
					WAR.PD["虚弱状态"][eid] = 10
				end
			end 
		end 
		--古墓1级弟子
		if MPTX(pid,3,1) and Curr_NG(pid,154) then	
			local a1 = math.modf(TrueQZ(pid) / 3)
			local a2 = math.modf(TrueYJ(pid) / 3)
			local a3 = math.modf(TrueTS(pid) / 3)
			zshurt = zshurt + a1 + a2 + a3
		end
		--古墓用剑
		if yongjian(wugong) then
			local a = TrueYJ(pid)-TrueYJ(eid)
			local b = psx(eid,'内力') - psx(pid,"内力")
			if a < 0 then a = 0 end
			if b < 0 then b = 0 end
			zshurt = zshurt + a + b 
			Set_Eff_Text(enemyid,1,"纤手素心・以巧破力")
		end	
		if Curr_NG(pid,154) and MPTX(pid,3,1) then
			local a  = 1
			local b = 0.1
			local str = "・娉婷秀雅"
			if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] >= 0 then
				a = WAR.LQZ[eid] * 0.5
			end
			if yongquan(wugong) then
				zshurt = zshurt + math.modf(TrueQZ(pid)*a*b*mpdj)
			elseif yongjian(wugong) then
				zshurt = zshurt + math.modf(TrueYJ(pid)*a*b*mpdj)
			elseif yongte(wugong) then
				zshurt = zshurt + math.modf(TrueTS(pid)*a*b*mpdj)
			end
			if JLSD(10,40,pid) and WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] >= 0 then
				if BNJQ(eid) then
					nuqi(eid,-20)
					WAR.PD['昏迷状态'][eid] = 1
				else
					WAR.LQZ[eid] = math.modf(WAR.LQZ[eid]/2)
					WAR.PD['虚弱状态'][eid] = 30
				end
				str = "・美目盼兮"
			elseif match_ID(pid,59) or match_ID(pid,605) or NGQH(pid,154) then
				WAR.PD['霸王破甲'][eid] = 20
				WAR.PD['脆弱状态'][eid] = 2
				WAR.PD['回魂仙梦'][eid] = 10
				str = "・媚眼如丝"
			end
			Set_Eff_Text(enemyid,2,"玉女清心诀"..str)
		end
		if MPTX(pid,3,2) and Curr_QG(pid,148) and JLSD(20,50,pid) then
			WAR.PD['混乱状态'][eid] = 1
		end
		--古墓暴怒技
		if MPTX(pid,3,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = JY.Person[eid]["冰封程度"]
			local b = JY.Person[eid]["灼烧程度"]
			zshurt = zshurt + a + b 
			ztd(enemyid,"生命点数",-(a*2))
			ztd(enemyid,"内力点数",-(b*3))
		end
	end
	--武当
	if MPTX(pid,4) and DWPD(WAR.CurID,enemyid) then 
		zshurt = zshurt + math.modf(ang*0.2) + 400 
		hurtzs1[#hurtzs1+1] = 0.33
		local mpdj = MPDJ(pid)
		if match_ID(pid,5) then
			mpdj = 5
		end	
		--武当弟子
		if (WAR.TJZX2[pid] or 0) > 0 then 
			local act = WAR.ACT / 10
			hurtzs1[#hurtzs1+1] = act
		end	
		--武当以静制动
		if MPTX(pid,4) and WAR.PD['以静制动2'][pid] ~= nil then
			hurtzs1[#hurtzs1+1] = 2
			if WAR.PD['以静制动2'][pid][1] ~= nil then
				ztd(enemyid,"内伤点数",WAR.PD['以静制动2'][pid][1])
			end
			if WAR.PD['以静制动2'][pid][2] ~= nil then
				ztd(enemyid,"中毒点数",WAR.PD['以静制动2'][pid][2])
			end
			if WAR.PD['以静制动2'][pid][3] ~= nil then
				ztd(enemyid,WAR.FXXS,WAR.PD['以静制动2'][pid][3])
			end
			if WAR.PD['以静制动2'][pid][4] ~= nil then
				ztd(enemyid,WAR.LXXS,WAR.PD['以静制动2'][pid][4])
			end
			if WAR.PD['以静制动2'][pid][5] ~= nil then
				if WAR.PD['迟缓状态'][eid] == nil then
					WAR.PD['迟缓状态'][eid] = WAR.PD['以静制动2'][pid][5]
				else
					WAR.PD['迟缓状态'][eid] = WAR.PD['迟缓状态'][eid] + WAR.PD['以静制动2'][pid][5]
				end
			end
		end
		--武当1级弟子
		if MPTX(pid,4,1) and JLSD(10,40,pid) then
			zshurt = zshurt + 500
			if yongquan(wugong) then
				ztd(enemyid,WAR.FXXS,5)
			end 
			if yongjian(wugong) then	 
				ztd(enemyid,WAR.LXXS,10)
			end 	
			if yongdao(wugong) then
				ztd(enemyid,"内伤点数",10)	
			end 
			if yongte(wugong) then	
				ztd(enemyid,WAR.BFXS,10)
			end 
			if yongzhi(wugong) then
				ztd(enemyid,WAR.ZSXS,10)
			end
		end	
		--武当八卦
		if MPTX(pid,4,2) and WAR.BG[pid] ~= nil then 
			zshurt = zshurt + math.modf(WAR.BG[pid] * MPDJ(pid))
			if match_ID(pid,5) and (WAR.TJZX2[pid] or 0) > 1 then
				zshurt = zshurt + WAR.BG[pid]*(WAR.TJZX2[pid] - 1)
			end
			if PersonKF(pid,99) or match_ID(pid,5) then
				local aa = JY.Person[pid]["受伤程度"]
				zshurt = zshurt + math.modf(WAR.BG[pid] * math.random(2,5))
			end
		end
		--武当无极
		if MPTX(pid,4,2) and WAR.WJ[pid] ~= nil then 
			zshurt = zshurt + math.modf(WAR.WJ[pid] * MPDJ(pid))
			WAR.PD['无极剑环'][eid] = WAR.WJ[pid] or 0
			if match_ID(pid,5) and (WAR.TJZX2[pid] or 0) > 1 then
				zshurt = zshurt + WAR.WJ[pid] * (WAR.TJZX2[pid] - 1)
			end
			if PersonKF(pid,99) or match_ID(pid,5) then
				local aa = JY.Person[pid]["流血程度"]
				zshurt = zshurt + math.modf(WAR.WJ[pid] * math.random(2,5))
			end
		end
		--武当3级弟子太极拳
		if wugong == 16 and MPTX(pid,4,3) and Curr_NG(pid,99) then
			local a = JY.Person[eid]["封穴程度"] * 6
			zshurt = zshurt + a 
			hurtzs1[#hurtzs1+1] = 0.35
			ztd(enemyid,WAR.FXXS,6)
			if JLSD(20,50,pid) then
				if JY.Person[eid]["受伤程度"] >= 20 then
					ztd(enemyid,"生命点数",-300)
				end
			end	
			Set_Eff_Text(enemyid, "特效文字2", "纯阳拳罡・如封似闭")
		end	
		--武当3级弟子太极剑
		if wugong == 46 and MPTX(pid,4,3) and Curr_NG(pid,99) then
			ztd(enemyid,WAR.LXXS,8)
			ztd(enemyid,WAR.BFXS,8)
			ztd(enemyid,WAR.ZSXS,8)
		end
		--武当4级弟子太极拳
		if wugong == 16 and MPTX(pid,4,4) and Curr_NG(pid,171) then
			if JLSD(20,50,pid) then 
				local gj = Atk(enemyid)/2
				ztd(enemyid,"生命点数",-gj)
			end 	
			Set_Eff_Text(enemyid, "特效文字1", "太极奥义・借力打力")
		end	
		--武当4级弟子太极剑
		if wugong == 46 and MPTX(pid,5,4) and Curr_NG(pid,171) then
			if JLSD(20,50,pid) then
				local fy = Def(enemyid)/2
				ztd(enemyid,"内力点数",-fy)
			end 	
			Set_Eff_Text(enemyid, "特效文字1", "太极奥义・刚柔共济")
		end		
		--武当暴怒技
		if MPTX(pid,4,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = math.modf(JY.Person[pid]["品德"] * 2)
			local b = math.modf(JY.Person[pid]["品德"] * 0.1)
			ztd(enemyid,"生命点数",-a)
			ztd(enemyid,"体力点数",-b)
		end
	end
	--少林
	if MPTX(pid,5) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,577) then
			mpdj = 5
		end	
		if JLSD(0, 50, pid) then
			WAR.PD['必灼烧'][pid] = 1
		end
		--少林基础攻击
		if JY.Person[pid]["品德"] > 50 then 
			local pd = (JY.Person[pid]["品德"] - 50) / 200
			hurtzs1[#hurtzs1+1] = pd
		end
		--少林1级弟子
		if PersonKF(pid,208) then
			if wugong == 122 and JLSD(10,60,pid) then--天竺
				addbuff(eid,WAR.PD['怯战状态'],1) 
			end
			if wugong == 124 and JLSD(10,45,pid) then--去凡
				addbuff(eid,WAR.PD['冰心状态'],10)	
			end
			if wugong == 128 then--一指
				zshurt = math.modf(zshurt*(10-WAR.ATNum))
			end	
		end		
		--少林2级弟子金刚殿
		if MPTX(pid,5,2) and Curr_NG(pid,144) then
			--金刚拳掌
			if WAR.JGDQZ == 1 then --金刚印
				ztd(enemyid,'内伤点数',math.random(5,15))
				if wugong == 22 then
					zshurt = zshurt + math.modf(Def(WAR.CurID)*1.5) + (WAR.PD['金刚护盾'][eid] or 100)
				else
					zshurt = zshurt + Def(WAR.CurID) + (WAR.PD['金刚护盾'][eid] or 100)
				end	
				if Def(WAR.CurID) >= Def(enemyid) then
					zshurt = zshurt + math.modf((Def(WAR.CurID)- Def(enemyid))*mpdj)
				end	
			end	
			if WAR.JGDQZ == 2 then --梵莲印
				ztd(enemyid,'内伤点数',math.random(5,15))
				if wugong == 22 then
					ztd(enemyid,'生命点数',-math.modf(psx(eid,'受伤程度')*2))
				else
					ztd(enemyid,'生命点数',-math.modf(psx(eid,'受伤程度')*1.35))
				end		
			end	
			if WAR.JGDQZ == 3 then --雷音印
				ztd(enemyid,'内伤点数',math.random(5,15))
				WAR.PD['头晕目眩'][eid] = 1
				if wugong == 22 then
					addbuff(eid,WAR.PD['脆弱状态'],2)
				end		
			end	
			--金刚指
			if WAR.JGDZF == 1 then
				ztd(enemyid,WAR.FXXS,math.random(3,5))
				zshurt = zshurt + math.modf(zshurt*psx(eid,'封穴程度')*0.07)
				addbuff(eid,WAR.PD['金刚指断肢'],1)
				if wugong == 135 and JLSD(0,25,pid) then
					addbuff(eid,WAR.PD['金刚指断肢'],1)
				end	
			end	
			if WAR.JGDZF == 2 then
				addbuff(eid,WAR.PD['霸王破甲'],10)
				if wugong == 135 and JLSD(0,35,pid) then
					addbuff(eid,WAR.PD['霸王破甲'],10)
				end
			end
			if WAR.JGDZF == 3 then
				addbuff(eid,WAR.PD['金刚指绝脉'],1)
				if wugong == 135 and JLSD(0,35,pid) then
					addbuff(eid,WAR.PD['金刚指绝脉'],10)
				end	
			end		
		end
			
		--少林2级弟子罗汉堂
		if MPTX(pid,5,2) and Curr_NG(pid,96) then 
			hurtzs1[#hurtzs1+1] = 0.5
			--_h果位效果
			if WAR.PD['罗汉果位'][pid] ~= nil then
				ztd(enemyid,'内力点数',math.random(150,350))
				if WAR.PD['罗汉果位'][pid] == 2 then
					zhanyi(eid,-math.random(10,25))
				end
			end		
			if yongdao(wugong) then
				local jl = 15
				if WAR.PD['罗汉果位'][pid] ~= nil then
					jl = jl + math.abs(WAR.PD['罗汉果位'][pid]*10)
				end
				if JLSD(0,jl,pid) then
					nuqi(pid,5)
				end		
				local d = math.modf(JY.Person[pid]["内力最大值"] /500)
				if d < 10 then
					d = 10
				end
				ztd(enemyid,WAR.LXXS,d)
				WAR.PD["迟缓状态"][eid] = limitX((WAR.PD["迟缓状态"][eid] or 0) + d, 0, 50)
				zshurt = zshurt + math.modf(JY.Person[eid]['流血程度']*d)
				Set_Eff_Text(enemyid,1,"佛罪断杀")
			elseif yongte(wugong) then
				local jl = 15
				if WAR.PD['罗汉果位'][pid] ~= nil then
					jl = jl + math.abs(WAR.PD['罗汉果位'][pid]*10)
				end
				if JLSD(0,jl,pid) then
					nuqi(pid,5)
				end
				if JLSD(10,30,pid) then
					WAR.PD['头晕目眩'][eid] = 1
				end
				local d = JY.Person[pid]['品德'] + JY.Person[eid]['受伤程度']
				local c = 1 - (JY.Person[eid]["内力"]/JY.Person[eid]["内力最大值"])
				ztd(enemyid, "生命点数",-(d+math.modf(d*c)))
				Set_Eff_Text(enemyid,1,"雷霆破妄")
			end	
			--佛邢刀诀
			if WAR.LHTDF > 0 then
				ztd(enemyid,WAR.LXXS,math.random(10,15))
				if BNJQ(pid) and JLSD(10,40,pid) then
					addbuff(eid,WAR.PD['创伤'],10)
					if wugong == 267 then
						addbuff(eid,WAR.PD['创伤'],10)
					end	
				end	
				if WAR.LHTDF == 1 then --斩业
					local a = limitX((WAR.LQZ[pid] or 0),0,100)
					a = a / 250
					if wugong == 267 then
						a = math.modf(a*2)
					end	
					if (WAR.LQZ[eid] or 0) > 0 then
						nuqi(eid,-math.modf((WAR.LQZ[eid] or 0)*a)+mpdj)
					else
						if wugong == 267 then
							zhanyi(eid,-(mpdj*2))
						else
							zhanyi(eid,-mpdj)
						end	
					end		
				end
				if WAR.LHTDF == 2 then
					local a = (WAR.LQZ[pid] or 0)*0.01
					local b = (WAR.LQZ[eid] or 0)*0.01
					if wugong == 267 then
						if a == b then
							ztd(enemyid,'内力点数',-math.random(350,550))
						else
							ztd(enemyid,'内力点数',-math.abs(math.modf(psx(eid,'内力最大值')*(a-b)*2)))
						end
					else	
						if a == b then
							ztd(enemyid,'内力点数',-math.random(200,350))
						else
							ztd(enemyid,'内力点数',-math.abs(math.modf(psx(eid,'内力最大值')*(a-b))))
						end	
					end		
				end	
				if WAR.LHTDF == 3 then
					local a = math.abs((WAR.SPIRIT[pid] or 0)-(WAR.SPIRIT[eid] or 0))
					local b = math.abs((WAR.LQZ[pid] or 0)-(WAR.LQZ[eid] or 0))
					if wugong == 267 then
						a = a*2
						b = b*2
					end	
					zshurt = zshurt + math.modf(zshurt*a*0.025) + math.modf(zshurt*b*0.05)
					local c  = math.modf(zshurt*0.05)
					if wugong == 267 then
						c = c*2
					end	
					zshurt = zshurt - c
					ztd(enemyid,'生命点数',-c)
				end	
			end	
			--伏魔奇门
			if WAR.LHTQM == 2 then--怒目荡磨
				local a = math.modf((WAR.LQZ[pid] or 0)*psx(pid,'内力')*math.random(3)*0.0007)
				if wugong == 86 then
					a= a*2
				end	
				ztd(enemyid,'生命点数',-a)
			end
			if WAR.LHTQM == 3 and WAR.PD['三入地狱'][pid] ~= nil and WAR.PD['三入地狱'][pid] < 4 then
				local jc = {1.5,3,4.5}
				if wugong == 86 then
					zshurt = zshurt + math.modf(zshurt*jc[WAR.PD['三入地狱'][pid]])
				else
					zshurt = math.modf(zshurt*jc[WAR.PD['三入地狱'][pid]])
				end	
				WAR.PD['三入地狱'][pid] = WAR.PD['三入地狱'][pid] + 1
			end	
		end

		--少林三级弟子
		if MPTX(pid,5,3) and Curr_NG(pid,108) then
			--少林3级弟子用拳掌
			if WAR.SLSQF > 0 then
				if JLSD(20,50,pid) or wugong == 22 then
					WAR.PD["回魂仙梦"][eid] = limitX((WAR.PD["回魂仙梦"][eid] or 0) + math.random(15),0,15)
					ztd(enemyid,'内伤点数',math.random(10,25))
					local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 50)
					if d < 50 then
						d = 50
					end
					zshurt = zshurt + math.modf((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"]) * 0.005 * d)
					for j = 0, WAR.PersonNum-1 do 
						if dead(j) == false and DWPD(j,enemyid) == false and RealJL(j,enemyid,4) then
							ztd(j,'内伤点数',math.random(5,20))
						end
					end		
					Set_Eff_Text(enemyid,2,"达摩智拳・金刚镇邪")
				end	
				if JLSD(20,50,pid) or wugong == 189 then
					local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 30)
					local str=""
					if d < 10 then
						d = 10
					end
					ztd(enemyid, WAR.FXXS, math.random(10,20))
					for i = 0, WAR.PersonNum - 1 do 
						if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
							local yjid = WAR.Person[i]["人物编号"] 
							if nokillspeed(i) == false then
								ztd(i,'集气位置',-100)
							end
						end
					end
					local bb = (math.random(2,5) * 0.1)
					local aa = math.modf(JY.Person[eid]["生命"] * bb)
					zshurt = zshurt + math.modf(zshurt*bb) + aa
					Set_Eff_Text(enemyid,2,"达摩智拳・血手慈心")
				end	
			end	
			if WAR.SLSZF > 0 then
				--少林3级弟子达摩院多罗叶指 花瓣纷飞
				if JLSD(20,50,pid) then
					local str=""
					local a = JY.Person[eid]["内力"] / 20
					zshurt = zshurt + a
					if JY.Person[eid]["受伤程度"] > 0 then
						ztd(enemyid, "生命点数", -200)
						str="・罗花绽开"
					else
						WAR.PD['时序闪避'][pid] = limitX((WAR.PD['时序闪避'][pid] or 0) + 10, 0, 30)
						str="・法华天坠"	
					end
					Set_Eff_Text(enemyid,2,"达摩定指・"..str)
				end
				--少林3级弟子达摩院大智无定指
				if JLSD(20,50,pid) then
					local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 300)
					if d < 0 then
						d = 0
					end
					ztd(enemyid, "内伤点数", 5 * MPDJ(pid) + d)
					local SN = JY.Person[eid]["受伤程度"] * 5
					ztd(enemyid, "生命点数", -SN)
					Set_Eff_Text(enemyid,2,"达摩定指・大智真如")
				end
			end
			--少林3级弟子达摩院刀法
			if WAR.SLSDF > 0 then
				if JLSD(20,50,pid) or wugong == 267 then
					local SN = 0
					if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] >= 0 then
						SN = WAR.LQZ[eid]
						WAR.XMPM = WAR.XMPM + (SN * 1.5)
						WAR.KMWD2 = math.modf(WAR.KMWD2 + SN)
					end
					local cc = math.modf(WAR.KMWD2*math.random(5,10))
					ztd(enemyid, "生命点数", -WAR.KMWD2)
					ztd(enemyid, "内力点数", -cc)
					Set_Eff_Text(enemyid,2,"韦陀斩戒・嗔恶退治")
				end
				if wugong == 65 or JLSD(10,40,pid) then
					local str = ""
					local a = math.random(2)
					WAR.PD["必灼烧"][pid] = 1
					if a == 1 then
						str = "・火宅佛狱"
						local aa = math.modf(JY.Person[eid]["灼烧程度"]/10)
						local bb = math.modf(JY.Person[eid]["内力"] *0.004)
						local cc = math.modf(bb * 10)
						if aa < 1 then
							aa = 1
						end
						for j = 0,WAR.PersonNum -1 do
							if dead(j) == false and DWPD(enemyid,j) == false and RealJL(j,enemyid,aa) then
								ztd(j,"生命点数",-bb)
								ztd(j,'内力点数',-cc)
							end
						end		
					else
						str = "・业力火莲"
						WAR.PD['举火燎原'][eid] = (WAR.PD['举火燎原'][eid] or 0) + 15
						WAR.PD['无明业火'][eid] = (WAR.PD['无明业火'][eid] or 0) + 10
						zshurt = zshurt + limitX(math.modf((120-psx(eid,'品德')*psx(eid,'灼烧程度'))),0,8000)
					end	
					if str ~= '' then
						Set_Eff_Text(enemyid,3,"达摩斩戒"..str)
					end						
				end	
			end	
			if WAR.SLSQM > 0 then
				if JLSD(10,40,pid) or wugong == 86 then
					local d = math.modf(JY.Person[pid]["内力"] / 500)
					if d < 10 then
						d = 10
					end
					ztd(enemyid,WAR.LXXS,d)
					zshurt = zshurt + math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"]) * 0.005 * d)
					Set_Eff_Text(enemyid,2,"达摩心悲・大悲伏魔")
				end	
				if JLSD(10,40,eid) or wugong == 82 then
					local SN = math.modf(JY.Person[pid]["内力"] / 500)
					local SN2 = MPDJ(pid) + 5
					zshurt = math.modf(zshurt*1.25)
					WAR.KMWD2 = math.modf(zshurt*0.01*SN2)
					ztd(enemyid,"生命点数",-WAR.KMWD2)
					Set_Eff_Text(enemyid,2,"达摩心悲・法尊慑邪")
				end 
			end	
				
			--少林金刚龙爪组合预备用
			--[[if ((MPTX(pid,5,3) and Curr_NG(pid,144) and PersonKF(pid,20) and yongzhi(wugong)) or match_ID(pid,577)) then
				local str=''
				if JLSD(20,50,pid) then
					local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 200)
					str = str .. '・刚猛绝伦'
					if d < 10 then
						d = 10
					end
					ztd(enemyid,WAR.LXXS,d)
					zshurt = zshurt + math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"]) * 0.005 * d)
					if JY.Person[eid]["流血程度"] > 49 then
						local aa = math.modf(JY.Person[eid]["流血程度"] * math.random(1,3))
						ztd(enemyid, "生命点数", -aa * 2)
					end
				end	
				if JLSD(20,50,pid) then
					WAR.PD["血流不止"][eid] = limitX((WAR.PD["血流不止"][eid] or 0) + math.random(15),0,40)
					WAR.PD["霸王破甲"][eid] = limitX((WAR.PD["霸王破甲"][eid] or 0) + math.random(15),0,20)
					ztd(enemyid,WAR.LXXS,20)
					local lx = math.modf(JY.Person[eid]["流血程度"] / 2)
					ztd(enemyid,"生命点数", -lx * 2)
					ztd(enemyid,"内伤点数", -lx)
					ztd(enemyid,"内力点数", -lx * 3)
					str = str .. "・破石碎玉"
				end
				if str ~= '' then
					Set_Eff_Text(enemyid,2,"金刚怒目"..str)
				end	
			end 	]]	
			--少林3级弟子达摩院达摩剑法
			if (wugong == 140 or (MPTX(pid,5,4) and yongjian(wugong))) and JLSD(20,50,pid) then
				local a = JY.Person[eid]["内力"] / 20
				zshurt = zshurt + a
				if JY.Person[eid]["受伤程度"] > 0 then
					ztd(enemyid,WAR.LXXS,10+math.modf(JY.Person[eid]["受伤程度"]*0.1))
				end
				Set_Eff_Text(enemyid,2,"达摩慧剑・法相文殊")
			end	
			
			if MPTX(pid,5,3) and Curr_NG(pid,108) and WAR.TFJS > 0 then
				if JLSD(10,50,pid) and WAR.PD['业障缠身'][eid] == nil then
					WAR.PD['业障缠身'][eid] = 31
				end
			end	
		end
		--达摩指法
		if WAR.DMZF > 0 then
			if WAR.DMZF == 1 then
				WAR.PD['恐惧状态'][eid] = 1
			end
			if WAR.DMZF == 2 then
				WAR.PD['昏迷状态'][eid] = 1
			end
			if WAR.DMZF == 3 then
				WAR.PD['沉睡状态'][eid] = 1
			end
			if WAR.DMZF == 4 then
				WAR.PD['麻痹状态'][eid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(6)
			end
			if WAR.DMZF == 5 then
				WAR.PD['脆弱状态'][eid] = 3
			end 
			if WAR.DMZF == 6 then
				WAR.PD['同归状态'][eid] = 1
			end 		
		end	
		--少林暴怒技
		if MPTX(pid,5,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = JY.Person[pid]["品德"]
			ztd(enemyid,"内伤点数",a)
			ztd(WAR.CurID,"生命点数",(a*2))
			ztd(WAR.CurID,"内力点数",(a*4))
		end
	end
	--密宗
	if MPTX(pid,6) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,62) or match_ID(pid,97) or match_ID(pid,103) then
			mpdj = 3
		end	
		zshurt = zshurt + mpdj*math.random(100,400)
		if WAR.PD["伤害储存"][pid] ~= nil and WAR.PD["伤害储存"][pid] > 0 then
			if WAR.PD["伤害储存"][pid] >=1000 then
				WAR.PD["混乱状态"][eid] = 1
			end
			zshurt = zshurt + mpdj*WAR.PD["伤害储存"][pid]
			WAR.PD["伤害储存"][pid] = nil
		end
		--密宗龙象
		if WAR.LXFM == 1 then
			local nlmod = JY.Person[pid]["内力"]/2000 
			local wgmod = JY.Wugong[wugong]["消耗内力点数"]/200
			local totalmod = nlmod * wgmod;
			hurtzs1[#hurtzs1+1] = totalmod
		end
		--密宗龙象
		if match_ID(pid,9931) and wgnlxz(wugong) == 1 and JLSD(10,50,pid) then
			ztd(enemyid,'生命点数',-300)
		end	

		--密宗1级血刀门
		if MPTX(pid,6,1) and wugong == 63 then
			WAR.BLX = 1
			zshurt = zshurt + math.modf(psx(eid,"流血程度"))*2
		end
		--密宗1级血刀门
		if MPTX(pid,6,1) and wugong == 63 and JLSD(20,50,pid) then
			if JLSD(20,50,pid) then
				local a = math.modf(psx(eid,"流血程度") * 3)
				ztd(WAR.CurID,"生命点数",a)
				ztd(enemyid,"生命点数",-a)
				WAR.BBF = 1
				Set_Eff_Text(enemyid,3,"寒锋饮血")
			end
		end
		--密宗2级血刀门
		if MPTX(pid,6,2) and Curr_NG(pid,163) then
			ztd(WAR.CurID,WAR.LXXS,8)
			ztd(enemyid,WAR.LXXS,8)
			if JY.Person[pid]["流血程度"] > 0 then
				local a = math.modf(psx(pid,"流血程度")/8)
				ztd(enemyid,WAR.FXXS,a)
				Set_Eff_Text(enemyid,3,"血气逆转")
			end
			if JY.Person[eid]["封穴程度"] > 0 then
				local b = math.modf(psx(eid,"封穴程度")/8)
				ztd(enemyid,WAR.LXXS,b)
			end
			if WAR.PD['凝血纹印'][pid] ~= nil and WAR.PD['凝血纹印'][pid] > 0 then
				zshurt = zshurt + (WAR.PD['凝血纹印'][pid] or 0)
			end
		end
		--密宗2级
		if MPTX(pid,6,2) and Curr_NG(pid,103) then
			local str =''
			if JLSD(20,50,pid) then
				local a = (JY.Person[pid]["内力"] + JY.Person[eid]["内力"])/4
				hurtzs1[#hurtzs1+1] = 0.5
				zshurt = zshurt + a
				if zshurt >= 300 then
					zshurt = zshurt + 300
				end
				str = str .. "・无上威德"
			end
			if JLSD(20,50,pid) then
				local a = JY.Person[eid]["受伤程度"] * 2
				local b = JY.Person[pid]["内力"] / 200
				local c = a + b
				WAR.LXLL = 1
				WAR.ATNum = limitX(WAR.ATNum + c,1,5)
				ztd(enemyid,"内伤点数",100)
				ztd(enemyid,"生命点数",-c)
				str = str .. '・精进勇猛'
			end
			if str ~= '' then
				Set_Eff_Text(enemyid,2,'龙象巨力'..str)	
			end	
		end	
		--密宗3级
		if ((MPTX(pid,6,3) and Curr_NG(pid,103) and wugong == 66) or match_ID(pid,103)) and JLSD(20,50,pid) then
			local a = JY.Person[pid]["内力"]/10
			zshurt = zshurt + a
			ztd(enemyid,"生命点数",-a)
			WAR.JuHuo = 1
			if JY.Person[pid]["内力"] >= 3000 then
				WAR.PD['回魂仙梦'][eid] = 10
			end
			if JY.Person[pid]["内力"] >= 6000 then
				WAR.PD['脆弱状态'][eid] = 3
			end
			if JY.Person[pid]["内力"] >= 9000 then
				WAR.PD['昏迷状态'][eid] = 1
			end
			Set_Eff_Text(enemyid,1,"无形刀气・缥缈虚无")
		end
		--密宗3级神足
		if ((MPTX(pid,6,3) and PersonKF(pid,233)) or match_ID(pid,103)) and JLSD(40,70,pid) then
			local a = WAR.LBPM + 1
			zshurt = zshurt + a * 200
			if a > 5 then
				WAR.PD['增加气攻'][pid] = (WAR.PD['增加气攻'][pid] or 0) + a * 100
			end
			WAR.PD["麻痹状态"][eid] = (WAR.PD["麻痹状态"][eid] or 0) + math.random(1,a)
			Set_Eff_Text(enemyid,1,"无上瑜珈密乘・断行成就")
		end
		if ((MPTX(pid,6,3) and PersonKF(pid,233)) or match_ID(pid,103)) and JLSD(20,50,pid) then		
			hurtzs1[#hurtzs1+1] = 0.3
			zshurt = zshurt + math.modf(ang*0.3)
			ztd(enemyid,"生命点数",-math.modf(ang*0.03))
			ztd(enemyid,"内力点数",-math.modf(ang*0.03))
			Set_Eff_Text(enemyid,1,"无上瑜珈密乘・欲三摩地")		
		end
		--密宗暴怒技
		if MPTX(pid,6,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = -0.5
		end
	end
	--逍遥派
	if MPTX(pid,7) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,634) then
			mpdj = 5
		end
		if match_ID(pid,116) or match_ID(pid,117) or match_ID(pid,118) then
			mpdj = 4
		end
		ang = ang + math.modf(JY.Person[pid]["内力"]/10)
		zshurt = zshurt + math.modf(JY.Person[pid]["内力"]/3+200)
		if JLSD(0,40,pid) then
			WAR.PD['必冰封'][pid] = 1
		end
		--主运北冥的攻击加成
		if MPTX(pid,7,2) and (Curr_NG(pid,85) or (XiaoYaoYF(pid) and PersonKF(pid,85))) then
			local a = JY.Person[pid]["内力"]
			zshurt = zshurt + a
			local sw = {"攻击力","防御力","轻功"}
			for i = 1,3 do
				AddPersonAttrib(pid,sw[i],50)--这个function就已经设定好了上限
			end
			if JLSD(10,35,pid) then
				ztd(WAR.CurID,"生命点数", 300)
				ztd(WAR.CurID,"内力点数", 500)
				Set_Eff_Text(enemyid,3,"北冥真气・为我所用")
			end
		end
		if MPTX(pid,7,3) and PersonKF(pid,85) then		
			WAR.PD["逍遥北冥"][eid] = 10
		end
		--主运八荒的攻击加成
		if MPTX(pid,7,3) and (Curr_NG(pid,101) or (XiaoYaoYF(pid) and PersonKF(pid,101))) then
			hurtzs1[#hurtzs1+1] = 1
			if JLSD(20,55,pid) then
				local a = JY.Person[eid]["灼烧程度"]
				ztd(enemyid,WAR.ZSXS,100)
				ztd(enemyid,"生命点数",-a)
				zshurt = zshurt + (a * 3)
				if JY.Person[eid]["流血程度"] > 50 then
					WAR.PD["利刃寒锋"][eid] = 20
				end
			end
		end
		if MPTX(pid,7,3) and PersonKF(pid,101) then		
			WAR.PD["逍遥八荒"][eid] = 10
		end
		--主运不老长春的攻击加成
		if (MPTX(pid,7,3) and (Curr_NG(pid,183) or (XiaoYaoYF(pid) and PersonKF(pid,183)))) or match_ID(pid,117) or match_ID(pid,634) then	
			zshurt = zshurt + 2000
			if JLSD(20,55,pid) then
				local a = JY.Person[eid]["冰封程度"]
				ztd(enemyid,WAR.BFXS,100)
				ztd(enemyid,"生命点数",-a)
				zshurt = zshurt + (a*3)		
			end
		end
		if MPTX(pid,7,3) and PersonKF(pid,183) then		
			WAR.PD["逍遥长春"][eid] = 10
		end
		--小无相
		if MPTX(pid,7,3) and (Curr_NG(pid,98) or (XiaoYaoYF(pid) and PersonKF(pid,98))) then
			local str= ""
			local n = math.random(1,6)
			if n == 1 then
				WAR.PD['无明业火'][eid] = 10
				WAR.PD['昏迷状态'][eid] = 1
				str = "・色相"
			elseif n == 2 then
				WAR.PD['回魂仙梦'][eid] = 10
				WAR.PD['恐惧状态'][eid] = 1
				str = "・声相"
			elseif n == 3 then
				WAR.PD['精神错乱'][eid] = math.random(5,10)
				WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0)+10,0,50)
				str = "・香相"
			elseif n == 4 then
				WAR.PD['混乱状态'][eid] = 1
				WAR.PD['脆弱状态'][eid] = 3
				str = "・味相"
			elseif n == 5 then	
				WAR.PD['沉睡状态'][eid] = 1
				WAR.PD['麻痹状态'][eid] = (WAR.PD["麻痹状态"][eid] or 0) + math.random(5)
				str = "・触相"
			else
				WAR.PD['内力恢复停止'][eid] = 2
				WAR.PD['散功状态'][eid] = 5
			end
			str = "・无我无相"
			local wx = {"拳掌功夫","御剑能力","耍刀技巧","特殊兵器","暗器技巧","指法技巧"}
			for i = 1,6 do
				AddPersonAttrib(pid,wx[i],30)--这个function就已经设定好了上限，陈家洛是9999，其他人都999，不用在这里另外写上限
			end
			Set_Eff_Text(enemyid,2,"无如是相"..str)
		end
		if MPTX(pid,7,3) and PersonKF(pid,98) then		
			WAR.PD["逍遥无相"][eid] = 10
		end
		--逍遥暴怒技
		if MPTX(pid,7,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			WAR.JYZJ_FXJ = 1
		end
	end
	
	if MPTX(pid,8) then  --白驼
		local mpdj = MPDJ(pid)
		if match_ID(pid,60) then
			mpdj = 3
		end	
		local zd = JY.Person[eid]["中毒程度"] * 2 + JY.Person[pid]["中毒程度"] * 2
		ztd(enemyid,'中毒点数',20)
		if match_ID(pid, 60) then
			ztd(enemyid,'中毒点数',30)
		end
		zshurt = zshurt + zd
		if Curr_NG(pid,95) or Curr_NG(pid,104) then
			zshurt = zshurt + math.modf(JY.Person[eid]["中毒程度"]*(mpdj * 2))
			WAR.PD['西域奇毒'][eid] = (WAR.PD['西域奇毒'][eid] or 0) + math.random(3,8)
			WAR.PD['中毒不解'][eid] = (WAR.PD['中毒不解'][eid] or 0) + math.random(3,8)
			WAR.PD['毒击'][eid] = (WAR.PD['毒击'][eid] or 0) + math.random(3,8)
			Set_Eff_Text(enemyid,3,"白驼・玄蛇剧毒")
		end
		if Curr_NG(pid,95) or Curr_NG(pid,104) then
			local aa = JY.Person[eid]["中毒程度"] + JY.Person[pid]["中毒程度"]
			if aa > 0 and WAR.NGJL > 0 then
				ztd(WAR.CurID,"生命点数",aa * math.random(5))
				ztd(WAR.CurID,"内力点数",aa * math.random(5,15))
				Set_Eff_Text(enemyid,3,"白驼・汲毒自疗")
			end
		end
		--武骧金星：白驼山集毒
		if WAR.PD['万毒归元'][pid] ~= nil then 
			if WAR.PD["凝毒化血"][pid] ~= nil then
				local wd = WAR.PD['万毒归元'][pid] or 0
				ztd(enemyid,'生命点数',-wd)
			else
			zshurt = zshurt + WAR.PD['万毒归元'][pid]
			end
			WAR.PD['万毒归元'][pid] = nil
		end
		--白驼山2级
		if MPTX(pid,8,2) and Curr_NG(pid,95) then
			local a = math.random(2) * mpdj
			local b = math.modf(JY.Person[eid]["中毒程度"] * mpdj) 
			local c = math.modf(JY.Person[pid]["中毒程度"] * mpdj) 
			ztd(WAR.CurID,"生命点数",c)
			ztd(WAR.CurID,"内力点数",b)
			ztd(WAR.CurID,"中毒程度",(8 * a))
			Set_Eff_Text(enemyid,1,"蟾毒秘要・引毒自愈")
			local d = JY.Person[eid]["中毒程度"] * 2
			zshurt = zshurt + d
			zshurt = zshurt + math.modf(ang * 0.2) 
			if JLSD(20,50,pid) then
				ztd(enemyid,WAR.FXXS,math.random(5,10))
				Set_Eff_Text(enemyid, "特效文字2","天蛤神气")		
			end
			if JLSD(10,40,pid) then
				ztd(enemyid,'中毒点数',20)
				ztd(enemyid,'内伤点数',12)
				ztd(enemyid,'生命点数',-psx(eid,'中毒程度'))
			end
			if JLSD(10,40,pid) then
				if JY.Person[eid]["中毒程度"] >= 50 then
					WAR.PD['灵蛇拳'][eid] = 10
					Set_Eff_Text(enemyid,2,"蟾毒秘要・神魂撩乱")
				end
			end
		end	
			
		--白驼山3级蛤蟆
		if (MPTX(pid,8,3) and Curr_NG(pid,95)) and JLSD(10,40,pid) then
			local a = math.modf(JY.Person[eid]["受伤程度"] * 2.5)
			zshurt = zshurt + (JY.Person[pid]["内力"] *0.33) + a
			ztd(enemyid,'生命点数',-a)  
			if JY.Person[eid]["中毒程度"] >= 75 then
				WAR.PD['混乱状态'][eid] = 3
				Set_Eff_Text(enemyid,3,"蟾毒秘要・神志不清")
			end
		end
		--白驼山2级逆运
		if (MPTX(pid,8,2) and Curr_NG(pid,104)) then
			hurtzs1[#hurtzs1+1] = 1
			if JLSD(10,40,pid) then
				local a =  JY.Person[eid]["中毒程度"] * 2
				local b = math.modf((TrueQZ(pid)+TrueTS(pid))*0.3)
				local d = a+b
				ztd(enemyid,'生命点数',-d)
			end	
		end
		--白驼山3级逆运
		if (MPTX(pid,8,3) and Curr_NG(pid,104)) then
			local fx = JY.Person[pid]["封穴程度"] or 5
			if JY.Person[pid]["封穴程度"] >= 50 then
				if JLSD(0,fx+5,pid) then
					if WAR.PD['降龙・双龙取水'][pid] == nil then
						WAR.PD['降龙・双龙取水'][pid] = 1
					end
					JY.Person[pid]["封穴程度"] = 10
				end
			end
			if JY.Person[eid]["中毒程度"] >= 50 and WAR.ACT == 1 then
				ztd(enemyid,'生命点数',-JY.Person[eid]["中毒程度"] * 4)
				WAR.PD["凝毒化血"][pid] = 3
				JY.Person[eid]["中毒程度"] = 0
			end	
			if JLSD(20,50,pid) then
				local a = math.modf(JY.Person[eid]["中毒程度"]/20) 
				local b = math.modf(JY.Person[eid]["封穴程度"]*2)
				local c = JY.Person[eid]["封穴程度"]/100
				ztd(enemyid,WAR.FXXS,a)
				ztd(enemyid,'生命点数',-b)
				hurtzs1[#hurtzs1+1] = c
				if WAR.PD["逆转经脉"][eid] == nil then
					WAR.PD["逆转经脉"][eid] = 2
				end
			end	
		end
		--白驼山暴怒技
		if MPTX(pid,8,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = JY.Person[eid]["中毒程度"]
			zshurt = zshurt + (a*2) + math.modf(ang*0.5)
			if dng > 0 then
				ztd(enemyid,'生命点数',-dng/2)
				ztd(WAR.CurID,'生命点数',dng/2)
			end
		end
	end
	--唐门
	if MPTX(pid,9) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if WAR.LZZ == 1 then
			WAR.PD['昏迷状态'][eid] = 1
		end
		if WAR.HXB == 1 then
			WAR.HXB1[100 + eid] = 50
		end
		if WAR.CXN == 1 then
			WAR.HXB1[200 + eid] = 50
		end
		if WAR.JTJD1 == 1 then
			WAR.JTJD[eid] = 1
		end
		if WAR.TMMS[pid] == 1 then
			if WAR.DPJ[pid] == 4 then
				hurtzs1[#hurtzs1+1] = 0.5
				if JY.Person[eid]["生命"] > math.modf(JY.Person[eid]["生命最大值"] * 0.7) then 
					hurtzs1[#hurtzs1+1] = 0.7
				end
			end 
		end
		--唐门模式千机变
		if WAR.QJBMS[pid] == 2 then  
			hurtzs1[#hurtzs1+1] = 2  
		end
		--唐门模式千机变
		if WAR.QJBMS[pid] == 3 then    
			hurtzs1[#hurtzs1+1] = -0.5
		end
		--唐门模式
		if WAR.JTJD[pid] == 1 and JLSD(0,40,pid) then 
			WAR.PD['闪避'][pid] = 1
		end
		--唐门模式
		if WAR.ZXJ == 1 then 
			if WAR.HXB1[100 + eid] ~= nil and WAR.HXB1[100 + eid] > 0 then
				zshurt = zshurt + WAR.HXB1[100 + eid] * 5
				WAR.HXB1[100 + eid] = 50
			end
			if WAR.HXB1[200 + eid] ~= nil and WAR.HXB1[200 + eid] > 0 then 
				zshurt = zshurt + WAR.HXB1[200 + eid] * 5
				ztd(enemyid,"内力点数",-WAR.HXB1[200 + eid] * 15)
				WAR.HXB1[200 + eid] = 50
			end
		end
		--唐门模式
		if WAR.TMMS[pid] == 2 and JLSD(10,40,pid) then 
			if WAR.HXB1[100 + eid] ~= nil and WAR.HXB1[100 + eid] > 0 then 
				zshurt = zshurt + WAR.HXB1[100 + eid] * 5
				WAR.HXB1[100 + eid] = 50
			end
			if WAR.HXB1[200 + eid] ~= nil and WAR.HXB1[200 + eid] > 0 then 
				zshurt = zshurt + WAR.HXB1[200 + eid] * 5
				ztd(enemyid,"内力点数",-WAR.HXB1[200 + eid] * 15)
				WAR.HXB1[200 + eid] = 50
			end
		end
		--唐门异常状态
		local jilv = 0
		jilv = jilv + math.modf(JY.Person[pid]["实战"] / 25)
		if JLSD(10,25 + jilv,pid) then 
			ztd(enemyid,WAR.FXXS,math.random(5,10))
		end
		if JLSD(10,35 + jilv,pid) then
			ztd(enemyid,WAR.LXXS,math.random(10,20))
		end
		if JLSD(10,30 + jilv,pid) then
			WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0) + math.random(5,10), 0, 50)
		end
		if JLSD(10,35 + jilv,pid) then
			ztd(enemyid,WAR.BFXS,math.random(10,15))
		end
		if JLSD(10,35 + jilv,pid) then
			ztd(enemyid,WAR.ZSXS,math.random(10,15))
		end
		--唐门暴怒技
		if MPTX(pid,9,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			ztd(enemyid,"内伤点数",100)
			ztd(enemyid,"中毒点数",100)
			ztd(enemyid,WAR.BFXS,100)
			ztd(enemyid,WAR.ZSXS,100)
			ztd(enemyid,WAR.LXXS,100)
			ztd(enemyid,WAR.FXXS,50)
		end
	end
	--桃花岛
	if MPTX(pid,10) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,57) then
			mpdj = 3
		end	
		if match_ID(pid,588) then
			mpdj = 2
		end	
		ztd(enemyid,'生命点数',-math.random(50,150))
		zshurt = zshurt +  math.modf(Xishu_sum(pid)/4)
		if JLSD(0, 40, pid) then
			addbuff(eid,WAR.PD['灵蛇拳'],math.random(5,10),15)
		end
		--桃花岛基础伤害	
		if WAR.PD['九花玉露'][pid] ~= nil then --武骧金星：桃花岛九花玉露
			zshurt = zshurt + WAR.PD['九花玉露'][pid]
			WAR.PD['九花玉露'][pid] = nil
		end
		--桃花岛1级主运碧海
		if MPTX(pid,10,1) and WAR.THSB == 1 then
			local a = math.modf(JY.Person[eid]["受伤程度"] * 2)
			ztd(enemyid,'内伤点数',10)
			ztd(enemyid,'生命点数',-a)
			zshurt = zshurt + a 
			if (WAR.PD['迟缓状态'][eid] or 0) < 10 then
				WAR.PD['迟缓状态'][eid] = 10
			end
		end	
		--桃花岛1级主运碧海
		if MPTX(pid,10,1) and WAR.THSB == 2 then
			local a = math.modf(JY.Person[eid]["内力"] *0.033) + 300
			ztd(enemyid,'内力点数',-a)   
			zshurt = zshurt + a 
			ztd(enemyid,WAR.LXXS,10)
		end 	
		--桃花岛1级主运碧海
		if MPTX(pid,10,1) and WAR.THSB == 3 then
			local a = math.modf(JY.Person[eid]["受伤程度"]*2)
			zshurt = zshurt + a
			ztd(enemyid,WAR.LXXS,JY.Person[eid]["受伤程度"])
			ztd(enemyid,'体力点数',-10)	
		end
		--桃花岛2级主运遁甲
		if MPTX(pid,10,2) and Curr_NG(pid,251) then
			ztd(enemyid,'生命点数',-200)
			if JY.Person[pid]["内力"] >= JY.Person[eid]["内力"] then
				hurtzs1[#hurtzs1+1] = 0.3 * mpdj
			else
				hurtzs1[#hurtzs1+1] = 0.2
			end
		end
		--桃花岛2级主运遁甲学会兰花
		if MPTX(pid,10,2) and Curr_NG(pid,251) and PersonKF(pid,126) then
			if JLSD(20,50,pid) then
				zshurt = zshurt + math.modf(JY.Person[pid]["内力"]*0.3)
				ztd(enemyid,WAR.FXXS,5)
				ztd(enemyid,"内伤点数",10)
				WAR.PD["迟缓状态"][eid] = (WAR.PD["迟缓状态"][eid] or 0) + math.random(3,6)
				Set_Eff_Text(enemyid, "特效文字3","兰花拂穴・春兰葳蕤")
			end
			if JLSD(20,50,pid) then
				if WAR.ATNum < 3 then
					WAR.ATNum = 3
				end
				WAR.PD["徐如林"][pid] = (WAR.PD["徐如林"][pid] or 0) + 1
			end
		end
		--桃花岛2级主运遁甲学会落英
		if MPTX(pid,10,2) and Curr_NG(pid,251) and PersonKF(pid,12) then
			if JLSD(20,50,pid) then
				local a = JY.Person[pid]["攻击力"]
				hurtzs1[#hurtzs1+1] = 2
				ztd(enemyid,"内力点数",-a)
				WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.random(3,6)
				Set_Eff_Text(enemyid, "特效文字3","落英桃花・优雅闲逸")
			end
			if JLSD(20,50,pid) then
				local a = JY.Person[eid]["受伤程度"] * 3
				ztd(enemyid,"生命点数",-a)
				WAR.PD['脆弱状态'][eid] = 3
				Set_Eff_Text(enemyid, "特效文字3","轻描淡写・行若无事")
			end
		end
		if WAR.THSB1 == 1 then
			if WAR.PD["封印"][eid] == nil then
				WAR.PD["封印"][eid] = 5
			end
		end	
		if WAR.THSB2 == 1 then
		    WAR.PD["精神错乱"][eid] = 5
			WAR.PD["同归状态"][eid] = 1
	    end
		if WAR.THSB3 == 1 then
		    WAR.PD["忘情日明"][eid] = 1
			WAR.PD["洞火"][eid] = 1
	    end
		--桃花岛暴怒技
		if BNJQ(pid) and MPTX(pid,10,1) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = JY.Person[eid]["受伤程度"]
			local b = JY.Person[eid]["中毒程度"]
			ztd(WAR.CurID,"生命点数",math.modf(a*3))
			ztd(WAR.CurID,"内力点数",math.modf(b*3))
			WAR.PD["锁足状态"][eid] = 1
			WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + math.random(9)
		end
	end
	--一刀流
	if MPTX(pid,11) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,92) or match_ID(pid,501) or match_ID(pid,596) then
			mpdj = 3
		end	
		--一刀流基础伤害
		if wugong == 151 then 
			zshurt = zshurt + math.modf(TrueYJ(pid)/3)+300
			hurtzs1[#hurtzs1+1] = 0.5
			if MPTX(pid,11,2) then
				zshurt = zshurt + math.modf(TrueYJ(pid) *0.5)
				if Curr_NG(pid,152) then
					zshurt = zshurt + JY.Person[pid]["内力"]
				end
			end	
		end
		if MPTX(pid,11,2) and wugong == 151 and Curr_NG(pid,152) and JLSD(20,50,pid) then
			local a = math.modf((zshurt + TrueYJ(pid) + JY.Person[pid]["内力"]) * 0.25)
			local b = math.modf(a * 1.1)
			ztd(enemyid,"内力点数",-b)
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid,2,"秘剑演武・天道剑势・剑气破体")
		end
		--一刀流
		if WAR.ZLJS > 0 then
			local a = TrueYJ(pid)
			zshurt = zshurt + a 
		end
		if WAR.ZLJS1 == 1 then
			WAR.PD['利刃寒锋'][eid] = 10
		end
		if WAR.ZLJS3 == 1 then 
			WAR.PD['回魂仙梦'][eid] = 10
		end 	
		if WAR.ZLJS4 == 1 then 
			WAR.PD["昏迷状态"][eid] = 1	
		end 	
		if WAR.ZLJS5 == 1 then 
			WAR.PD["混乱状态"][eid] = 1	 
		end 
		if WAR.ZLJS6 == 1 then 
			WAR.PD["恐惧状态"][eid] = 1	
		end
		--一刀流2级
		if MPTX(pid,11,2) and wugong == 151 and Curr_NG(pid,152) then
			if JLSD(20,50,pid) then
				for j = 0, WAR.PersonNum-1 do
					if dead(j) == false and DWPD(WAR.CurID,j) then
						if RealJL(WAR.CurID,j,9) then
							ztd(j,"生命点数",-math.modf(zshurt/4))
						end
					end
				end 
			end
			Set_Eff_Text(enemyid,1,'秘剑演武・居合斩')		
		end
		--一刀流暴怒技
		if MPTX(pid,11,1) and BNJQ(pid) and Curr_NG(pid,152) then
			hurtzs1[#hurtzs1+1] = 0.25
		end	
	end
	--日月
	if MPTX(pid,12) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,26) then
			mpdj = 5
		end	
		WAR.PD["盲目状态"][eid] = 2
		ztd(WAR.CurID,'体力点数',1)
		ztd(enemyid,'体力点数',-1)
		zshurt = zshurt + (120-JY.Person[eid]["体力"])*5
		hurtzs1[#hurtzs1+1] = 0.1*mpdj
		--日月2级
		if MPTX(pid,12,2) then
			local a = JY.Person[eid]["中毒程度"]
			hurtzs1[#hurtzs1+1] = 0.2 * mpdj
			zshurt = zshurt + a
			if PersonKF(pid,219) or PersonKF(pid,88) then
				if JLSD(20,50,pid) then
					local a = JY.Person[pid]["内力最大值"] * 0.05
					zshurt = zshurt + a
				end	
				if JLSD(20,50,pid) then
					local a = JY.Person[pid]["内力"] / 30	
					ztd(WAR.CurID,'生命点数',a)
				end
			end
		end
		--日月4级
		if MPTX(pid,12,4) and Curr_NG(pid,88) and JLSD(20,50,pid) then
			WAR.PD['日月吸星'][eid] = 20
			Set_Eff_Text(enemyid,2,"吸星神髓")	
		end						
		--日月暴怒技
		if MPTX(pid,12,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = math.modf(psx(eid,"流血程度"))
			ztd(enemyid,WAR.LXXS,100)
			ztd(enemyid, "生命点数", -(a * 3))
			ztd(enemyid, "内力点数", -(a * 5))
			if Curr_QG(eid,316) then
				WAR.PD['免疫中毒'][eid] = 3
				WAR.PD['免疫灼烧'][eid] = 3
			end	
		end
	end
	--明教
	if MPTX(pid,13) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,641) then
			mpdj = 5
		end
		--明教基础伤害
		local a = TrueSD(pid) + TrueTS(pid)
		if wugong == 340 then
			a = a + TrueZF(pid)
		end	
		hurtzs1[#hurtzs1+1] = a * 0.001    
		addbuff(eid,WAR.PD["光明圣火"],5*mpdj)   
		--明教
		if WAR.PD['时序闪避'][pid] ~= nil and WAR.PD['时序闪避'][pid] > 0 then  
			local aa = 100 * mpdj
			ang = ang + aa
			if yongdao(wugong) then
				if Curr_NG(pid,93) then
					aa = aa + 500
				end
				ztd(enemyid,'中毒点数',30)
				ztd(enemyid, "生命点数", -aa)
				Set_Eff_Text(enemyid,2,"焚影圣诀・影刀突杀")        
			elseif yongte(wugong) then
				WAR.BJ = 1
				local bb = JY.Person[eid]["灼烧程度"] * 2
				if Curr_NG(pid,93) then
					bb = bb + 150
				end
				ztd(enemyid,'内伤点数',JY.Person[eid]["灼烧程度"]) 
				if nokillspeed(enemyid) == false then
					ztd(enemyid,"集气位置",-bb)
				end
				Set_Eff_Text(enemyid,2,"焚影圣诀・火影无双")
			elseif MPTX(pid,12,3) then
				ztd(enemyid,'中毒点数',30)
				ztd(enemyid,WAR.BFXS,50)
			end
		end
		--明教3级
		if (MPTX(pid,13,3) and Curr_NG(pid,93)) or match_ID(pid,641) then
			local aa = 20
			if JLSD(10, 30 + mpdj * 5 + aa, pid) then
				WAR.PD['时序闪避'][pid] = (WAR.PD['时序闪避'][pid] or 0) + 10 * (mpdj + 1)
				CurIDTXDH(WAR.CurID, 98, 1, "焚影秘传・遁入暗影")
			end
		end	
		--明教3级
		if MPTX(pid,13,4) and Curr_NG(pid,93) and (yongdao(wugong) or yongte(wugong) or wugong == 340) then 
			hurtzs1[#hurtzs1+1] = 0.35
			if (Qg(WAR.CurID) >= 500) or ((Qg(WAR.CurID) - Qg(enemyid)) >= 100) then
				ztd(enemyid, "生命点数", -(JY.Person[eid]["流血程度"] * 6))
				Set_Eff_Text(enemyid,2,"袖刃刺杀")
			end
		end
		--明教暴怒技
		if MPTX(pid,13,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = JY.Person[eid]["灼烧程度"] * 2
			zshurt = zshurt + a 
			ztd(enemyid, "生命点数", -a)
			WAR.PD["无明业火"][eid] =(WAR.PD["无明业火"][eid] or 0) + math.random(3,8)
		end			
	end
	--五岳剑派
	if MPTX(pid,14) and DWPD(WAR.CurID,enemyid) then 
		local mpdj = MPDJ(pid)
		--五岳剑派基础伤害
		zshurt = zshurt +  math.random(50,150) * mpdj + math.modf(TrueYJ(pid) * 0.33)
		--五岳2级 华山混元
		if MPTX(pid,14,2) and (Curr_NG(pid,90) or Curr_NG(pid,375)) and yongquan(wugong) then
			hurtzs1[#hurtzs1+1] = 1
		end
		--五岳2级 华山紫霞
		if MPTX(pid,14,2) and Curr_NG(pid,89) then
			hurtzs1[#hurtzs1+1] = mpdj* 0.05
		end
		--五岳紫霞・剑气
		if (MPTX(pid,14,2) and PersonKF(pid,89)) or JXPD(pid,19,1) then
			if WAR.ZXQJ[pid] ~= nil and WAR.ZXQJ[pid] > 0 then
				local zx = WAR.ZXQJ[pid] or 0
				zshurt = zshurt + zx * 100
				ang = ang + zx * 150
				if JLSD(10,50,pid) then
					local jq = (WAR.ZXQJ[pid] or 0) * 50
					ztd(enemyid,'生命点数',-jq)
					Set_Eff_Text(enemyid, "特效文字2", "剑气环绕・暗劲破体")
				end
				WAR.ZXQJ[pid] = WAR.ZXQJ[pid] - 1
	            if WAR.ZXQJ[pid] <= 0 then 
	                WAR.ZXQJ[pid] = nil
				end
				Set_Eff_Text(enemyid, "特效文字3","紫霞・剑劲创体")
			end
			if JLSD(15,55,pid) and yongjian(wugong) then
				WAR.JJBS[eid] = (WAR.JJBS[eid] or 0) + math.random(3)
			end
			if WAR.JJBS[eid] ~=nil and WAR.JJBS[eid] > 9 then
				local zx = WAR.JJBS[eid] or 1
				ztd(enemyid,'生命点数',-100*zx)
				ztd(enemyid,'内力点数',-100*zx)
				ztd(enemyid,WAR.LXXS,100)
				if WAR.PD['创伤'][eid] == nil then
					WAR.PD['创伤'][eid] = 15
				end
				WAR.JJBS[eid] = 0
				Set_Eff_Text(enemyid, "特效文字3", "剑劲侵蚀",163)
			end
		end
		--五岳2级 嵩山寒冰
		if MPTX(pid,14,2) and Curr_NG(pid,216) then 
			local a = JY.Person[eid]["冰封程度"] * 5
			zshurt = zshurt + a
		end
		--五岳2级 恒山古针
		if MPTX(pid,14,2) and Curr_NG(pid,259) then
			local a = JY.Person[eid]["流血程度"] * 5
			zshurt = zshurt + a
		end
		--五岳2级 衡山镇岳
		if MPTX(pid,14,2) and Curr_NG(pid,263) then
			local a = JY.Person[eid]["灼烧程度"] * 5
			zshurt = zshurt + a
		end
		--五岳2级 泰山磐石
		if MPTX(pid,14,2) and Curr_NG(pid,264) then
			local a = JY.Person[eid]["中毒程度"] * 5
			zshurt = zshurt + a
		end
			
		--五岳3级 华山紫霞
		if MPTX(pid,14,3) and Curr_NG(pid,89) and JLSD(20,50,pid) then
			ang = ang + math.modf(JY.Person[pid]["内力"]*0.8)
			Set_Eff_Text(enemyid,3,"正气歌・天地有正气")
		end
		--五岳2级 嵩山寒冰
		if MPTX(pid,14,3) and Curr_NG(pid,216) and JLSD(20,50,pid) then 
			local a = JY.Person[eid]["冰封程度"]*2
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid,3,"寒冰真气・寒锋透体")	
		end
		--五岳2级 恒山古针
		if MPTX(pid,14,3) and Curr_NG(pid,259) and JLSD(20,50,pid) then
			local a = JY.Person[eid]["流血程度"]*2
			ztd(WAR.CurID, "生命点数",a)
			Set_Eff_Text(enemyid,3,"古针禅功・余意不尽")
		end
		--五岳2级 衡山镇岳
		if MPTX(pid,14,3) and Curr_NG(pid,263) and JLSD(20,50,pid) then
			local a = JY.Person[eid]["灼烧程度"]*2
			ztd(enemyid, "内力点数", -a)
			Set_Eff_Text(enemyid,3,"镇岳诀・回风落雁")
		end
		--五岳2级 泰山磐石
		if MPTX(pid,14,3) and Curr_NG(pid,264) and JLSD(20,50,pid) then
			local a = JY.Person[eid]["中毒程度"]*2
			ztd(enemyid, "体力点数", -a)
			Set_Eff_Text(enemyid,3,"磐石法诀・老树盘根")
		end
		--五岳暴怒技
		if MPTX(pid,14,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = TrueYJ(pid)
			zshurt = zshurt + a 
			WAR.PD["刺目"][eid] = 2
		end
	end
	--大理
	if MPTX(pid,15) and DWPD(WAR.CurID,enemyid) then 
		local mpdj = MPDJ(pid)
		if match_ID(pid,65) or match_ID(pid,499) then
			mpdj = 4
		end	
		--大理基础攻击
		zshurt = zshurt + math.modf(TrueZF(pid)/3+JY.Person[pid]["内力"]/3)
		WAR.PD['必灼烧'][pid] = 1
		WAR.BFX = 1
		if wugong == 17 and JLSD(10,40,pid) then
			ztd(enemyid,WAR.FXXS,math.random(5,10))
			Set_Eff_Text(enemyid, "特效文字2","一指天南")	
		end
		--大理2级攻击
		if MPTX(pid,15,2) and Curr_NG(pid,207) then
			local a = JY.Person[pid]["内力最大值"] * 0.33
			local b = TrueZF(pid) *0.33
			local c = a + b
			zshurt = zshurt + math.modf(c)
		end
		--大理3级攻击
		if MPTX(pid,15,3) and Curr_NG(pid,314) then
			zshurt = zshurt + math.modf((TrueQZ(pid)+TrueZF(pid))*math.modf(JY.Person[pid]["内力最大值"]/5000)*JY.Person[pid]["生命增长"]/10*mpdj/2)
		end
		--大理1级
		if wugong == 17 or match_ID(pid,499) then
			if JLSD(20,50,pid) then
				local a = JY.Person[eid]["灼烧程度"] * 2
				zshurt = zshurt + a
				Set_Eff_Text(enemyid,3,"大理阳炎")
			end	
			if JLSD(20,50,pid) then
				local a = JY.Person[eid]["受伤程度"] * 2
				zshurt = zshurt + math.modf(a * 2)
				Set_Eff_Text(enemyid,3,"大理秘手・铁指寸劲")
			end
		end 
		--大理2级攻击
		if MPTX(pid,15,2) and Curr_NG(pid,207) then
			if JLSD(20,50,pid) then
				WAR.PD['必冰封'][pid] = 1
				WAR.PD['必灼烧'][pid] = 1
				WAR.JuHuo = 1
				Set_Eff_Text(enemyid, "特效文字2","一阳指劲")
			end
			if JLSD(20,50,pid) then
				WAR.KMZWD = 1
				WAR.PD["恐惧状态"][eid] = 1	
				if JY.Person[eid]["流血程度"] < 50 then
					JY.Person[eid]["流血程度"] = 50
				else
					ztd(enemyid,WAR.LXXS,11)
				end	
				Set_Eff_Text(enemyid, "特效文字1","一阳气劲")
			end 	
		end 
		--大理2级
		if MPTX(pid,15,2)  and Curr_NG(pid,207) and (wugong == 17 or match_ID(pid,499)) and JLSD(20,50,pid) then
			WAR.PD["一阳指劲"][eid] = 30
			zshurt = zshurt + ang * 1.1
			for j = 0, WAR.PersonNum - 1 do
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
					local tmpid = WAR.Person[j]["人物编号"]
					ztd(j,'生命点数',500)
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字3","一阳指法・枯木逢春")		
		end 
		--大理3级
		if MPTX(pid,15,3) and Curr_NG(pid,314) and (wugong == 49 or match_ID(pid,499))  then	
			if JLSD(20,50,pid) then	
				local a = JY.Person[eid]["内力"] * 0.1 
				zshurt = zshurt + a		 			
				WAR.PD["六脉剑指"][eid] = 30
			--大理3级
			end
			if JLSD(44,66,pid) then
				WAR.PD["恐惧状态"][eid] = 1
				hurtzs1[#hurtzs1+1] = 1
				ztd(enemyid,"体力点数",-66)
				Set_Eff_Text(enemyid, "特效文字1","六剑齐发")
			end	
		end	
		--大理暴怒技
		if MPTX(pid,15,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = TrueZF(pid)
			local b = TrueYJ(pid)
			local c = JY.Person[pid]["内力"]
			zshurt = zshurt + a + b + c 
			ztd(enemyid, WAR.LXXS, 100)
			if yongzhi(wugong) and JLSD(20,50,pid) then
				WAR.PD['逆转经脉'][eid] = 1
			end
		end
	end
	--全真
	if MPTX(pid,16) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,129) or match_ID(pid,64) then
			mpdj = 5
		end
		ztd(enemyid,"生命点数",-77*mpdj)
		local shz = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
				shz = shz + 1
			end
		end
		if shz >= 2 then
			ang = ang + (shz) * 100 * mpdj
			zshurt = zshurt + (shz) * 100 * mpdj
		end
		--全真3级弟子主运先天
		if MPTX(pid,16,3) and Curr_NG(pid,100) and yongjian(wugong) then
			local str = ''
			if JLSD(20,50,pid)  then
				str = str .. '・两仪化形'
				local a = JY.Person[pid]["内力"] *0.1
				zshurt = zshurt + a + math.modf(ang*0.1) 
			end
			if JLSD(20,50,pid) and yongjian(wugong) then
				local a = JY.Person[eid]["受伤程度"]
				zshurt = zshurt + math.modf(a*2)
				str = str .. '・大道无形'
			end
			Set_Eff_Text(enemyid,3,'紫阳剑罡'..str)
			if WAR.QZ_QXJF > 0 then
				if WAR.PD['忘情云翳'][eid] == nil then
					WAR.PD['忘情云翳'][eid] = 20
				end
				if WAR.QZ_QXJF == 1 then
					addbuff(eid,WAR.JXSMD,7)
				elseif WAR.QZ_QXJF == 2 then
					addbuff(eid,WAR.PD['举火燎原'],7)
				elseif WAR.QZ_QXJF == 3 then
					addbuff(eid,WAR.QFQXM,7)
				elseif WAR.QZ_QXJF == 4 then
					addbuff(eid,WAR.ZFQXM,7)
				elseif WAR.QZ_QXJF == 5 then
					addbuff(eid,WAR.PD['扫荡群魔'],7)
				elseif WAR.QZ_QXJF == 6 then
					addbuff(eid,WAR.PD['散功状态'],7)
				elseif WAR.QZ_QXJF == 7 then
					addbuff(eid,WAR.PD['透骨针2'],7)
				end
			end
		end	 	
		--全真2级弟子主运金关
		if MPTX(pid,16,2) and Curr_NG(pid,249) and yongquan(wugong) and JLSD(20,50,pid) then
			local a = TrueQZ(pid) + JY.Person[pid]["内力"] *0.2
			zshurt = zshurt + a
			Set_Eff_Text(enemyid, "特效文字3","金关刚拳・杀意化实")	
		end
		--全真暴怒技
		if MPTX(pid,16,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = JY.Person[pid]["攻击力"]
			local b = JY.Person[pid]["防御力"]
			local c = JY.Person[pid]["轻功"]
			local d = TrueQZ(pid)
			local e = TrueYJ(pid)
			zshurt = zshurt + a + b + c
			ztd(WAR.CurID, "生命点数", d)
			ztd(WAR.CurID, "内力点数", e)
		end
	end
	--峨眉
	if MPTX(pid,17) and DWPD(WAR.CurID,enemyid)  then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,626) then
			mpdj = 4
		end	
		zshurt = zshurt +  math.random(100,200) * WAR.ACT
		if WAR.PD['峨眉士气'][pid] ~= nil and WAR.PD['峨眉士气'][pid] > 0 then
			hurtzs1[#hurtzs1+1] = WAR.PD['峨眉士气'][pid]
			WAR.PD['峨眉士气'][pid] = 0
		end
		--峨眉2级
		if MPTX(pid,17,2) then 
			hurtzs1[#hurtzs1+1] = 0.25
			if JY.Person[pid]["内力"] >= 6000 then
				hurtzs1[#hurtzs1+1] = 0.3
			end
		end
		--峨眉3级
		if MPTX(pid,17,3) then
			hurtzs1[#hurtzs1+1] = 1.2
		end
		--峨眉2级
		if MPTX(pid,17,2) and Curr_NG(pid,242) and JLSD(20,50,pid) then
			local a = JY.Person[eid]["封穴程度"] * 2
			local b = JY.Person[eid]["受伤程度"] * 2
			ztd(enemyid,WAR.FXXS,4)
			ztd(enemyid,"内伤点数",20)
			ztd(enemyid,"体力点数",-6)
			zshurt = zshurt + a + b			
			Set_Eff_Text(enemyid, "特效文字3","浪起湖心动山摇")
		end 	
		--峨眉2级
		if MPTX(pid,17,2) and PersonKF(pid,242) and yongquan(wugong) and JLSD(10,40,pid) then
			local SN = math.modf(JY.Person[pid]["内力"] * 0.03)
			local SN2 = math.modf(SN * 3)
			ztd(enemyid,"生命点数",-SN)
			ztd(enemyid,"内力点数",-SN2)
			WAR.JuHuo = 1
			Set_Eff_Text(enemyid, "特效文字3", "飘雪穿云掌")
		end
		--峨眉2级
		if MPTX(pid,17,2) and Curr_NG(pid,242) and JLSD(20,50,pid) then
			local a = JY.Person[eid]["流血程度"] * 2
			zshurt = zshurt + a	
			Set_Eff_Text(enemyid, "特效文字2","闪现雷鸣山压顶")
		end 		
		--峨眉3级
		if MPTX(pid,17,3) and Curr_NG(pid,247) and JLSD(20,50,pid) then
			WAR.PD["峨眉临济"][eid] = 30
			WAR.PD["无明业火"][eid] = (WAR.PD["无明业火"][eid] or 0) + math.random(10,15)
			Set_Eff_Text(enemyid, "特效文字2","临济十二桩")
		end
		--峨眉4级 祖师专属
		if MPTX(pid,17,4) and JLSD(10,60,pid) then 
			ztd(enemyid,"生命点数",-666)
			ztd(enemyid,"内力点数",-1000)
			Set_Eff_Text(WAR.CurID, "特效文字1", "一树开五花・五花八叶扶")
		end
		--峨眉暴怒技
		if MPTX(pid,17,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			WAR.EMBN = 1
			ztd(enemyid,WAR.LXXS,100)
		end
	end
	--崆峒
	if MPTX(pid,18) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		--崆峒基础伤害
		zshurt = zshurt + math.random(150,550) + TrueQZ(pid)*0.33
		--分光两仪
		if WAR.KTAY1 == 1 then
			WAR.WS = 1
			zshurt = zshurt + math.modf(JY.Person[eid]["受伤程度"] * 2) + math.modf(TrueQZ(pid) * 2)
			hurtzs1[#hurtzs1+1] = JY.Person[eid]["内力最大值"]/5000
		end
		--崆峒2级
		if MPTX(pid,18,2) then
			WAR.PD['必冰封'][pid] = 1
			WAR.PD['必灼烧'][pid] = 1
			ztd(enemyid,WAR.FXXS,5)
		end
		--崆峒2级
		if MPTX(pid,18,2) and yongquan(wugong) and JLSD(25,60,pid) then
			ztd(enemyid,WAR.FXXS,math.random(5,15))
			Set_Eff_Text(enemyid, "特效文字2","伤敌无痕")
		end
		--崆峒2级
		if MPTX(pid,18,2) and yongquan(wugong) and PersonKF(pid,221) then
			local a = JY.Person[eid]["冰封程度"] * 7
			local b = JY.Person[eid]["灼烧程度"] * 7
			zshurt = zshurt + a + b
			Set_Eff_Text(enemyid, "特效文字3", "阴阳双劲")	
		end 	
		--崆峒2级
		if MPTX(pid,18,2) and yongquan(wugong) and PersonKF(pid,221) and JLSD(20,50,pid) then
			WAR.PD["阴阳双劲"][eid] = 20
			Set_Eff_Text(enemyid, "特效文字3", "聚水成冰・触物燃烧")	
		end 	
		--崆峒3级
		if MPTX(pid,18,3) and TrueQZ(pid) >= 400 and yongquan(wugong) and JLSD(10,45,pid) then
			ztd(enemyid,"内伤点数",100)		
			zshurt = zshurt + math.modf(hurt + (JY.Person[eid]["受伤程度"] * 3)+(TrueQZ(pid)*2)) 
			Set_Eff_Text(enemyid, "特效文字2", "崆峒拳劲・拳倾天下")	
		end
		--崆峒3级
		if MPTX(pid,18,3) and wugong == 23 and Curr_NG(pid,221) then
			local a = JY.Person[pid]["内力"]
			zshurt = zshurt + a
		end	
		--崆峒3级
		if MPTX(pid,18,3) and wugong == 23 and Curr_NG(pid,221) then
			local str= ""
			local a = math.random(1,7)
			if a == 1 then	
				WAR.PD["七伤拳阴"][eid] = 20
				str = "・阴"	
			elseif a == 2 then
				WAR.PD["七伤拳阳"][eid] = 15
				str = "・阳"
			elseif a == 3 then
				WAR.PD["集气倒退"][eid] = 20
				str = "・金"	  
			elseif a == 4 then
				WAR.PD["七伤拳木"][eid] = 30
				str = "・木"	  
			elseif a == 5 then
				WAR.PD["利刃寒锋"][eid] = 20
				str = "・水"	  
			elseif a == 6 then
				WAR.PD["七伤拳火"][eid] = 30
				str = "・火"	  
			elseif a == 7 then
				if WAR.PD["封印"][eid] == nil then
					WAR.PD["封印"][eid] = 5
				end
			  str = "・土"	
			end	  	
			Set_Eff_Text(enemyid, "特效文字2","七伤拳劲"..str)				
		end			
		--崆峒暴怒技
		if MPTX(pid,18,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = TrueQZ(pid) * 2
			local b = JY.Person[eid]["受伤程度"]
			zshurt = zshurt + a
			ztd(enemyid,"生命点数", -(b*6))
			ztd(enemyid,"内伤点数",100)	
		end
	end
	--昆仑
	if MPTX(pid,19) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,586) then
			mpdj = 4
		end	
		--昆仑基础伤害
		local a = math.modf(TrueYJ(pid)/3)
		local b = math.modf(TrueSD(pid)/3)
		zshurt = zshurt + a + b 
		--昆仑2级
		if MPTX(pid,19,2) and wugong == 37 then
			WAR.PD['必冰封'][pid] = 1
			ztd(enemyid,WAR.LXXS,10)
		end
		--昆仑2级
		if MPTX(pid,19,2) and wugong == 60 then
			WAR.PD['必灼烧'][pid] = 1
			ztd(enemyid,'内伤点数',15)
		end
		--昆仑3级
		if MPTX(pid,19,3) and wugong == 37 then
			if WAR.LQZ[eid] ~= nil then
				if WAR.LQZ[eid] >= 10 then
					nuqi(eid,-10)
				end
			end
			local a = JY.Person[eid]["冰封程度"] * 2
			zshurt = zshurt + a 
			Set_Eff_Text(enemyid, "特效文字2", "两仪四象")
		end
		if WAR.PD['顺逆两仪3'][pid] ~= nil and WAR.LYWC > 0 then
			zshurt = zshurt + math.modf(WAR.LYWC*0.8)
		end	
		--昆仑3级
		if MPTX(pid,19,3) and wugong == 60 then
			local a = JY.Person[eid]["灼烧程度"] * 2 + JY.Person[eid]["受伤程度"] * 2
			zshurt = zshurt + a 
			Set_Eff_Text(enemyid, "特效文字3", "反两仪刀劲")
		end
		--昆仑暴怒技
		if MPTX(pid,19,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = TrueYJ(pid)
			local b = TrueSD(pid)
			ztd(enemyid,WAR.LXXS,100)
			nuqi(eid,-200)
			zshurt = zshurt + a + b
		end
	end
	--雪羽宗
	if MPTX(pid,20) then  
		hurtzs1[#hurtzs1+1] = (WAR.LQZ[pid] or 0)/200
		--雪羽宗基础攻击
		local mpdj = MPDJ(pid)
		--杨冰羽的雪羽宗门派效果另外写在这里
		if match_ID(pid,514) then
			mpdj = 6
			local a = (TrueQZ(pid) + TrueSD(pid))/2
			local b = (JY.Person[eid]["冰封程度"] or 0)/50
			ztd(enemyid,WAR.BFXS,math.random(20,100))
			zshurt = zshurt + math.modf(a * b)
		else
			local a = (TrueQZ(pid) + TrueSD(pid))/3
			local b = (JY.Person[eid]["冰封程度"] or 0)/10
			ztd(enemyid,WAR.BFXS,math.random(10,30))
			zshurt = zshurt + math.modf(a * b)
		end
		if yongdao(wugong) then
			ztd(enemyid,"内伤点数",6)
		end
		if yongquan(wugong) then
			ztd(enemyid,WAR.FXXS,3)
		end	
		--雪羽宗2级攻击
		if MPTX(pid,20,2) then 
			hurtzs1[#hurtzs1+1] = 0.15
			if rwnlxz(pid,0) or match_ID(pid,745) or match_ID(pid,514) then
				ztd(enemyid,"生命点数",-(psx(pid,"冰封程度")*4))
			elseif rwnlxz(pid,1) or match_ID(pid,745) or match_ID(pid,514) then
				ztd(enemyid,"内力点数",-(psx(pid,"冰封程度")*2)) 
			else 
				ztd(enemyid,"体力点数",-10)
			end
			Set_Eff_Text(enemyid,1,"易水・寒劲贯体")
			if JLSD(20,50,pid) then
				local a = JY.Person[eid]["冰封程度"] + JY.Person[pid]["冰封程度"]
				zshurt = zshurt + a
				WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0) + a,0,50)
				Set_Eff_Text(enemyid, 1, "雪上加霜")
			end	
		end 
		--雪羽宗2级攻击
		if MPTX(pid,20,2) and wugong == 21 and Curr_NG(pid,43) then 
			local a = math.modf(TrueQZ(pid)/2)
			local b = JY.Person[eid]["中毒程度"]*3
			local jl = 50
			zshurt = zshurt + a	
		    ztd(enemyid,"中毒点数",100)
		    ztd(enemyid,"生命点数",-b)	
		    if JLSD(20,50,pid) then
			    WAR.PD["伤重不治"][eid] = 10
			    Set_Eff_Text(enemyid, "特效文字3","雪羽玄冥・冥杀冰封")
		    end
		    if JLSD(20,jl,pid) then
			    ztd(WAR.CurID,"中毒点数",-100)
				ztd(WAR.CurID,"生命点数",b)	
			    Set_Eff_Text(enemyid, "特效文字3","雪羽玄冥・玄冥破脉")
		    end
		    if JLSD(20,jl,pid) then
			    WAR.PD["混乱状态"][eid] = 1	 
			    Set_Eff_Text(enemyid, "特效文字3","雪羽玄冥・玄元寒极")
		    end
		end 
		--雪羽宗3级攻击
		if MPTX(pid,20,3) and JLSD(10,30,pid) then
			if BNJQ(eid) then
				nuqi(eid,-100)
				Set_Eff_Text(enemyid, "特效文字2", "冷雪冰心")
			end
		end
		--雪羽宗3级攻击
		if MPTX(pid,20,3) and wugong == 153 and Curr_NG(pid,43) then 
			local x = JY.Person[pid]["内力"] * 0.08
			ztd(enemyid,"生命点数",-x)	
			local a = math.random(3)
			local str = ""
			if a == 1 then 				
				WAR.PD["冰冻状态"][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.random(5,10)
				Set_Eff_Text(WAR.CurID,2,"残风寒刃・沧浪一刀")
			elseif a == 2 then 
				WAR.PD["头晕目眩"][eid] = 1;
				Set_Eff_Text(WAR.CurID,2,"残风寒刃・溟幻瀑灵")		
			elseif a == 3 then 	
				WAR.PD["恐惧状态"][eid] = 1;
				Set_Eff_Text(WAR.CurID,2,"残风寒刃・沧溟渺浔")		
			end	
		end	
		--雪羽宗4级攻击
		if MPTX(pid,20,4) and JLSD(20,60,pid) then
			local a = JY.Person[eid]["冰封程度"] * 10
			zshurt = zshurt + a 
			Set_Eff_Text(enemyid, 3, "雪似飞羽蔽天穹")
			if JY.Person[eid]["冰封程度"] >= 100 and JY.Person[pid]["冰封程度"] >= 100 then
				local bf  = JY.Person[eid]["冰封程度"] + JY.Person[pid]["冰封程度"]
				if math.random(1000) < bf then
					ztd(enemyid,'生命点数',-bf*mpdj*2)
					JY.Person[eid]["冰封程度"] = 0
					JY.Person[pid]["冰封程度"] = 0
				end
			end		
		end
		--易水沧溟
		if (wugong == 153 and Curr_NG(pid,43)) or (match_ID(pid,745) and yongdao(wugong)) or match_ID(pid,514)  then
			if JLSD(10,45,pid) then
				local a = math.modf(psx(eid,"冰封程度")*0.03)
				WAR.PD['集气速度'][pid] = limitX((WAR.PD['集气速度'][pid] or 0) + a,0,30)
			end	
			if WAR.YSCM1 == 1 then
				zhanyi(eid,-10)
				if TrueSD(pid) > TrueSD(eid) then
					local a = TrueSD(pid) - TrueSD(eid)
					ztd(enemyid,"生命点数",-a)
				end	
			end
			if WAR.YSCM2 == 1 then
				WAR.PD['锁足状态'][eid] = 1
				WAR.PD['混乱状态'][eid] = 2
			end
			if WAR.YSCM3 == 1 then
				ztd(enemyid,"体力点数",-math.random(10))
				local v = ((100-psx(eid,"体力"))*0.01)
				hurtzs1[#hurtzs1+1] = v
				WAR.PD['出血蛇毒'][eid] = math.random(5,15)
				WAR.PD['创伤'][eid] = (WAR.PD['创伤'][eid] or 0) + math.random(5,15)
			end	
		end
		--雪羽宗暴怒技
		if BNJQ(pid) and MPTX(pid,20,1) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = (JY.Person[eid]["冰封程度"] or 0) 
			local b = (JY.Person[eid]["灼烧程度"] or 0)
			local c = (JY.Person[eid]["受伤程度"] or 0)
			local d = (JY.Person[eid]["流血程度"] or 0)
			local e = TrueSD(pid)	
			local f = math.modf(TrueQZ(pid)*0.5)
			zshurt = zshurt + ((a + b + c + d) * 2) + e + f
		end 
	end
	--花涧派
	if MPTX(pid,21) then  
		--花涧基础攻击
		local a = Atk(WAR.CurID) *0.17
		local b = Def(WAR.CurID) *0.17
		local c = Qg(WAR.CurID) *0.17
		zshurt = zshurt + a + b + c 			
		--花涧基础
		if JLSD(20,50,pid) then
			if WAR.PD["脆弱状态"][eid] == nil then
				WAR.PD["脆弱状态"][eid] = 3
			end
			Set_Eff_Text(enemyid, "特效文字3", "绮筵公子・绣幌佳人")
		end 	
		--花涧2级攻击
		if MPTX(pid,21,2) and JLSD(20,50,pid) then
			WAR.PD['花涧如雾'][eid] = 3 
			Set_Eff_Text(enemyid, "特效文字2", "新月曲如眉・未有团栾意")
		end 
		--花涧派2级攻击
		if MPTX(pid,21,2) and JLSD(20,50,pid) then
			ztd(enemyid,WAR.FXXS,6)
			ztd(enemyid,WAR.BFXS,11)
			ztd(enemyid,WAR.ZSXS,11)
			ztd(enemyid,WAR.LXXS,11)
		end			
		--花涧派3级攻击
		if MPTX(pid,21,3) and JLSD(20,50,pid) then	
			local a = Atk(enemyid)
			local b = Def(enemyid)
			local c = Qg(enemyid)
			local d = math.modf((a + b + c)*0.1)
			ztd(enemyid,"生命点数",-d)
			Set_Eff_Text(enemyid, "特效文字2", "金锁重门荒苑静・绮窗愁对秋空")
		end	
		--花涧派3级攻击
		if MPTX(pid,21,3) and JLSD(20,50,pid) then	
			local a = JY.Person[pid]["受伤程度"]
			local b = JY.Person[pid]["中毒程度"]
			local c = JY.Person[pid]["冰封程度"]
			local d = JY.Person[pid]["灼烧程度"]
			local e = JY.Person[pid]["封穴程度"]
			local f = JY.Person[pid]["流血程度"]
			local g = a + b + c + d + e + f
			ztd(enemyid,"生命点数",-g)
			Set_Eff_Text(enemyid, "特效文字2", "烟月不知人事改・夜阑还照深宫")
		end
		--花涧派3级攻击
		if MPTX(pid,21,3) and JLSD(20,50,pid) then
			zshurt = zshurt + 300
			nuqi(eid,-6)
			local str= ""
			local a = math.random(1,4)
			if a == 1 then
				WAR.PD['昏迷状态'][eid] = 1
				str = "・酒"
			elseif a == 2 then	
				WAR.PD['回魂仙梦'][eid] = 10
				str = "・色"
			elseif a == 3 then		
				WAR.PD['精神错乱'][eid] = math.random(5,10)
				str = "・财"
			elseif a == 4 then	
				WAR.PD['麻痹状态'][eid] = math.random(1,10)
				str = "・气"
			end
			Set_Eff_Text(enemyid, "特效文字2","花间游"..str)	
		end
		--花涧派4级攻击
		if MPTX(pid,21,4) and JLSD(20,50,pid) then
			zshurt = zshurt + 800
			local str = ""
			local a = math.random(1,8)
			if a == 1 then
				WAR.PD['残劲袭魄'][eid] = 1
				str = "・乾"
			elseif a == 2 then	
				WAR.PD['败血破命'][eid] = 1
				str = "・坤"
			elseif a == 3 then	
				WAR.PD['火毒攻心'][eid] = 1
				str = "・震"	
			elseif a == 4 then	
				WAR.PD['寒毒入体'][eid] = 1
				str = "・巽"	
			elseif a == 5 then	
				WAR.PD['五蕴炽盛'][eid] = 1
				str = "・坎"	
			elseif a == 6 then	
				WAR.PD['封气绝脉'][eid] = 1
				str = "・离"	
			elseif a == 7 then	
				WAR.PD["盲目状态"][eid] = 2
				str = "・艮"	
			elseif a == 8 then	
				WAR.PD['参合状态'][eid] = math.random(3)
				str = "・兑"								
			end
			Set_Eff_Text(enemyid, "特效文字1","破莲八著"..str)	
		end
		--花涧派暴怒技
		if BNJQ(pid) and MPTX(pid,21,1) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = (JY.Person[eid]["灼烧程度"] or 0)
			local b = (JY.Person[eid]["受伤程度"] or 0)
			local c = (JY.Person[eid]["流血程度"] or 0)
			zshurt = zshurt + ((a + b + c) * 2)
		end
	end
	--中华阁
	if MPTX(pid,22) and DWPD(WAR.CurID,enemyid) then  		
		--中华阁1级
		local a = Qg(WAR.CurID)
		local b = Qg(enemyid)
		local c = a + b
		zshurt = zshurt + c
		local e = JY.Person[eid]["流血程度"] * 2
		ztd(enemyid,WAR.LXXS,10)
		ztd(enemyid,'生命点数',-e)
		Set_Eff_Text(enemyid,"特效文字3", "跑堂身法・背刺")
		local f = JY.Person[eid]["冰封程度"]
		local g = JY.Person[eid]["灼烧程度"]
		local h = f + g 
		ztd(enemyid,WAR.BFXS,5)
		ztd(enemyid,WAR.ZSXS,5)
		ztd(WAR.CurID,'生命点数',(h * 2))
		--中华阁2级
		if MPTX(pid,22,2) and JLSD(20,50,pid) then 
			local a = math.modf(Atk(WAR.CurID) * 0.25)
			ztd(enemyid,"生命点数",-a) 
			Set_Eff_Text(enemyid, "特效文字3", "五味篇・酸")
		end
		
		if MPTX(pid,22,2) and JLSD(20,50,pid) then 
			WAR.PD["山珍海味"][pid] = 30
			Set_Eff_Text(enemyid, "特效文字3", "五味篇・甜")
		end
		
		if MPTX(pid,22,2) and JLSD(20,50,pid) then 
			WAR.PD["深入骨髓"][eid] = 30
			Set_Eff_Text(enemyid, "特效文字3", "五味篇・苦")
		end
		
		if MPTX(pid,22,2) and JLSD(20,50,pid) then 
			local a = JY.Person[eid]["灼烧程度"] * 3
			ztd(enemyid,WAR.ZSXS,100)
			ztd(enemyid,"生命",-a)
			if JY.Person[eid]["生命"] <= 1500 then
				WAR.PD["刺目"][eid] = 2	
			end
			Set_Eff_Text(enemyid, "特效文字3", "五味篇・辣")
		end 
		
		if MPTX(pid,22,2) and JLSD(20,50,pid) then 
			local a = math.modf(Atk(WAR.CurID) * 2)
			zshurt = zshurt + a
			if JY.Person[eid]["内力"] >= 8000 or JY.Person[eid]["内力"] <= 500 then
				local a = JY.Person[eid]["受伤程度"] / 5
				ztd(enemyid,"内伤点数",math.random(30,50))
				WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0) + a,0,50)
			end
			Set_Eff_Text(enemyid, "特效文字3", "五味篇・咸")
		end        
		--中华阁3级
		if MPTX(pid,22,3) and JLSD(20,50,pid) then 
			nuqi(eid,-8)
		end			
		
		if MPTX(pid,22,4) and JLSD(20,50,pid) then     
			ztd(enemyid,'生命点数',-math.modf(JY.Person[eid]["生命最大值"] * 0.025))	
			WAR.PD["走火入魔"][eid] = 10			
		end			
		if MPTX(pid,22,4) and JLSD(20,50,pid) then 
			WAR.PD['昏迷状态'][eid] = 1
		end
		--中华阁暴怒技
		if BNJQ(pid) and MPTX(pid,22,1) then
			hurtzs1[#hurtzs1+1] = 0.25 
			ztd(enemyid,"生命点数",-1000)
		end 	 								
	end 
	--背嵬军
	if MPTX(pid,23) then  
		local mpdj = MPDJ(pid)
		if match_ID(pid,568) then
			mpdj = 4
		end	
		zshurt = zshurt + 200
		if (PersonKF(pid,68) or PersonKF(pid,200)) and yongte(wugong) then
			zshurt = zshurt + TrueTS(pid)
		end
		if MPTX(pid,23,2) then
			local zy = (WAR.SPIRIT[pid] or 0)
			zshurt = zshurt + math.modf(zy*mpdj*1.5)
			if ZYJQ(pid) then
				zshurt = zshurt + math.modf(zy*mpdj*3)
			end
		end
		if MPTX(pid,23,2) and (PersonKF(pid,68) or PersonKF(pid,200)) and WAR.ACT == 1 and yongte(wugong) then
			zshurt = zshurt + WAR.LBPM*120
			WAR.PD['曲径通幽'][pid] = 1
			Set_Eff_Text(WAR.CurID, "特效文字3", "一击贯通")
		end
		if MPTX(pid,23,2) and PersonKF(pid,200) and yongte(wugong) and JLSD(10,40,pid) then
			local zs = (Qg(enemyid)+Atk(WAR.CurID))/400
			if zs < 2 then
				zs = 2
			end
			hurtzs1[#hurtzs1+1] = zs/10
			if math.random(10) < zs then
				WarDrawMap(0); --不加这条则动画位置无法正常显示
				War_ActupMenu()
			end
			ztd(enemyid,WAR.LXXS,math.random(2,zs))
			ztd(enemyid,WAR.FXXS,math.random(2,zs))
			if Qg(enemyid)/200 > 5 then
				if WAR.PD['血流不止'][eid] == nil then
					WAR.PD['血流不止'][eid] = 10
				end
				if WAR.PD['逆转经脉'][eid] == nil then
					WAR.PD['逆转经脉'][eid] = 1
				end
			end
			Set_Eff_Text(WAR.CurID, "特效文字3", "以力破巧")
		end
		if MPTX(pid,23,4) and Curr_NG(pid,199) and PersonKF(pid,198) and yongquan(wugong) and JLSD(0,20,pid) then
			local sz = math.modf(JY.Person[pid]["实战"]*3)
			local ns = math.modf(JY.Person[pid]["实战"]/30)
			zshurt = zshurt + sz
			if WAR.PD["封印"][eid] == nil then
				WAR.PD["封印"][eid] = 8
			end
			ztd(enemyid,"内伤点数",math.random(3,ns))
			ztd(enemyid,WAR.FXXS,math.random(3,ns))
		end
		if MPTX(pid,23,4) and Curr_NG(pid,199) and PersonKF(pid,200) and yongte(wugong) then
			local sh = WAR.LBPM*(WAR.SPIRIT[pid] or 0)
			zshurt = zshurt + sh*1.5
			ztd(enemyid,"生命点数",-sh)
		end
		--殊死一搏
		if WAR.PD['满江红'][pid] == 1 then
			local smbl = math.modf(((JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"])/JY.Person[pid]["生命最大值"])*30)
			if JLSD(10,15+smbl,pid) then
				smbl = smbl*JY.Person[pid]["体力"]
				local zs = Sanwei_sum(pid)/5+JY.Person[pid]["实战"]*WAR.LBPM
				JY.Person[pid]["体力"] = math.modf(JY.Person[pid]["体力"]/2)
				zshurt = zshurt + zs
				ztd(enemyid,"生命点数",-smbl)
				WAR.SSYB = 1
			end
		end
		--背嵬军武穆岳枪
		if WAR.CTWM1 == 1 then
			zhanyi(pid,5)
			zhanyi(eid,-5)
			nuqi(pid,5)
			nuqi(eid,-5)
		end
		if WAR.CTWM2 == 1 then
			local wl = get_skill_power(pid,wugong,11)
			ztd(enemyid,"生命点数",-wl)
			ztd(enemyid,"体力点数",-5)
		end
		if WAR.CTWM3 == 1 then
			if WAR.PD["枪神诀2"][eid] == nil then
				WAR.PD["枪神诀2"][eid] = 6
			end
			WAR.PD["昏迷状态"][eid] = 1
			WAR.PD["头晕目眩"][eid] = 1
		end
		if WAR.CTWM5 == 1 then
			for j = 0, WAR.PersonNum - 1 do
				local df = WAR.Person[j]["人物编号"] 
				local offset1 = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[j]["坐标X"]) 
				local offset2 = math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[j]["坐标Y"])	
				local lx = JY.Person[df]["生命"]/10
				if WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and WAR.Person[j]["死亡"] == false 
				and offset1 <= 8 and offset2 <= 8 then
					ztd(j,"生命点数",-lx)
					if JY.Person[df]["生命"] < JY.Person[df]["生命最大值"]*0.15 then
						JY.Person[df]["生命"] = 0
						WAR.Person[j]["死亡"] = true
						WarSetPerson()
						break				   
					end  
				end
			end
		end
		--武穆
		if WAR.YSJG > 0 and MPTX(pid,23,3) and Curr_NG(pid,199) then
			local sm = WAR.YSJG * 40
			local nl = WAR.YSJG * 60
			ztd(enemyid,"生命点数",-sm)
			ztd(enemyid,"内力点数",-nl)
			WAR.YSJG = WAR.YSJG - 1
			if WAR.YSJG < 1 then
				WAR.YSJG = 0
			end
		end
		--暴怒技
		if BNJQ(pid) and MPTX(pid,23,1) then
			hurtzs1[#hurtzs1+1] = 0.3 
			local a = JY.Person[pid]["实战"] + (WAR.SPIRIT[pid] or 0)
			local sz = math.modf(JY.Person[pid]["实战"] / 18)
			zshurt = zshurt + (a * 2)
			WAR.PD['集气速度'][eid] = (WAR.PD['集气速度'][eid] or 0) - sz
		end 
	end	
	--夜雨楼
	if MPTX(pid,24) then 
		local mpdj = MPDJ(pid)
		if match_ID(pid,517) then
			mpdj = 5
		end
		if match_ID(pid,526) then
			mpdj = 4
		end		
		zshurt = zshurt + math.modf(psx(eid,'冰封程度')*psx(eid,'冰封程度')*0.5)
		zshurt = zshurt + math.modf(psx(eid,'流血程度')*psx(eid,'流血程度')*0.5)
		if WAR.PD['血衣剑法'][pid] ~= nil then
			zshurt = zshurt + math.modf(TrueYJ(pid)*mpdj)
		end
		if WAR.PD['无常索命诀'][pid] ~= nil then
			zshurt = zshurt + math.modf(TrueTS(pid)*mpdj)
		end	
		if Cat('背刺侧攻') == 2 or (Cat('背刺侧攻') == 1 and JLSD(0,50,pid)) then
			if WAR.ACT == 1 then
				for i = 0, WAR.PersonNum-1 do 
					local zid = WAR.Person[i]['人物编号']
					if WAR.Person[i]['死亡'] == false and DWPD(WAR.CurID,i) then
						ztd(i,WAR.LXXS,math.random(30,60))
						WAR.PD['创伤'][zid] = (WAR.PD['创伤'][zid] or 0) + math.random(15,30)
						WAR.Person[i]['特效动画'] = 14
					end
				end
			end
			ztd(enemyid,'生命点数',-math.modf(psx(eid,'流血程度')*3))
			if match_ID(pid,525) and WAR.PD['南子燎原枪'][pid] ~= nil then
				addbuff(eid,WAR.PD['南子脏焰'],25)
				Set_Eff_Text(enemyid,2,'脏焰缠身')
			end	
		end
		if WAR.PD['血衣剑法'][pid][2] == 1 then
			WAR.PD['血袍艳花'][pid] = limitX((WAR.PD['血袍艳花'][pid] or 0) + psx(eid,'流血程度'),0,300)
		end	
		if WAR.PD['血衣剑法'][pid][4] == 1 then
			WAR.PD['枯血泣魂'][eid] = limitX((WAR.PD['枯血泣魂'][eid] or 0)+math.random(3,10),0,30)
			addbuff(eid,WAR.PD['禁疗'],5,10)
		end
		if WAR.PD['血衣剑法'][pid][5] == 1 then
			WAR.PD['极乐血海'][eid] = limitX((WAR.PD['极乐血海'][pid] or 0)+math.random(10,30),0,100)
		end	
		if WAR.PD['无常索命诀'][pid][1] == 1 then
			WAR.PD['混乱状态'][eid] = 1
			WAR.PD['洞火'][eid] = 1
		end
		if WAR.PD['无常索命诀'][pid][1] == 2 then
			zshurt = zshurt + math.modf(mpdj*(WAR.LQZ[pid] or 1)*math.ramdom(3,5))
			if WAR.ACT == WAR.ATnum or WAR.ACT == 10 then
				nuqi(eid,-200)
			end	
		end	
		if WAR.PD['无常索命诀'][pid][4] == 1 then
			WAR.PD['昏迷状态'][eid] = 1
			addbuff(eid,WAR.PD['冰冻状态'],20,40)
			addbuff(eid,WAR.PD['冰冻扣血'],20)
			addbuff(eid,WAR.PD['举火燎原'],10,20)
		end	
		if WAR.PD['无常索命诀'][pid][5] == 1 then
			WAR.PD['命无常'][eid] = 30
		end	
	end
	--护龙山庄
	if MPTX(pid,25) and DWPD(WAR.CurID,enemyid) then 
		--档头
		if MPTX(pid,25,2) then
			hurtzs1[#hurtzs1+1] = 0.15
			if JLSD(20,50,pid) then
				ztd(enemyid,'内伤点数',6)
				ztd(enemyid,'中毒点数',6)
				local a = JY.Person[eid]["受伤程度"]
				local b = JY.Person[eid]["中毒程度"]
				local c = a + b
				zshurt = zshurt + c 
				nuqi(pid,5)
				zhanyi(pid,5)
			end
			if JLSD(20,50,pid) then
				if JY.Person[eid]["受伤程度"] >= 30 then
					WAR.PD['混乱状态'][eid] = 1
				end
			end
			if JLSD(20,50,pid) then
				if JY.Person[eid]["中毒程度"] >= 30 then
					WAR.PD['脆弱状态'][eid] = 5
				end
			end
		end
		--密探剑法
		if (MPTX(pid,25,3) and Curr_NG(pid,365)) or match_ID(pid,748) then
			if yongjian(wugong) and JLSD(20,50,pid) then
				local a = JY.Person[eid]["受伤程度"] * 3
				ztd(enemyid,'内伤点数',10)
				zshurt = zshurt + a 
			end
			if yongjian(wugong) and JLSD(20,50,pid) then
				local a = JY.Person[pid]["御剑能力"]
				ztd(enemyid,'生命点数', -a)
				WAR.PD['护龙剑法'][pid] = 1
				Set_Eff_Text(enemyid, "特效文字3", "幻剑・心剑")
			end
			if yongjian(wugong) and JLSD(20,50,pid) then
				WAR.PD['时序闪避'][pid] = (WAR.PD['时序闪避'][pid] or 0) + 20
				Set_Eff_Text(enemyid, "特效文字3", "幻剑・无相")
			end
		end	   
		--密探刀法
		if (MPTX(pid,25,3) and Curr_NG(pid,365)) or match_ID(pid,748) then
			if yongdao(wugong) and JLSD(20,50,pid) then
				WAR.KMZWD = 1
				WAR.PD['伏魔逆气'][eid] = 10
				ztd(enemyid,WAR.LXXS,100)
				Set_Eff_Text(enemyid, "特效文字3", "霸刀・破罡")
			end
		end
		--密探特系
		if (MPTX(pid,25,3) and Curr_NG(pid,365)) or match_ID(pid,748) then
			if yongte(wugong) and JLSD(20,50,pid) then
				ztd(enemyid,'内伤点数',100)
				ztd(enemyid,'中毒点数',100)
				ztd(enemyid,WAR.LXXS,100)
				ztd(enemyid,WAR.BFXS,100)
				ztd(enemyid,WAR.ZSXS,100)
				ztd(enemyid,WAR.FXXS,20)
				WAR.PD["护龙特殊"][eid] = 15
			end
			if yongte(wugong) and JLSD(20,50,pid) then
				WAR.PD['无明业火'][eid] = 10
				WAR.PD['回魂仙梦'][eid] = 10
				WAR.PD['恐惧状态'][eid] = 1
				Set_Eff_Text(enemyid, "特效文字3", "漫天花雨撒金钱")
			end
			if yongte(wugong) and JLSD(20,50,pid) then
				WAR.PD['精神错乱'][eid] = math.random(5,10)
				WAR.PD['迟缓状态'][eid] = limitX((WAR.PD['迟缓状态'][eid] or 0) + 10,0,50)	
				WAR.PD['沉睡状态'][eid] = 1
				Set_Eff_Text(enemyid, "特效文字3", "奇门遁甲")
			end
		end 	
		--密探空手
		if (MPTX(pid,25,3) and Curr_NG(pid,365)) or match_ID(pid,748) then 
			if yongquan(wugong) and WAR.ACT == 1 then
				local a = JY.Person[pid]["拳掌功夫"]
				local b = JY.Person[pid]["指法技巧"]
				local c = a + b
				if c > 1000 then
					c = 1000
				end
				ztd(enemyid,'集气位置',-c)	
			end
			if (yongquan(wugong) or yongzhi(wugong)) and JLSD(20,50,pid) then
				WAR.PD['护龙空手'][eid] = 10
			end
			if (yongquan(wugong) or yongzhi(wugong)) and JLSD(20,50,pid) then
				local a = JY.Person[pid]["攻击力"]
				local b = JY.Person[pid]["防御力"]
				ztd(enemyid,"内力点数",-b)
				ztd(enemyid,"生命点数",-a)
			end
		end	 
		--军师
		if ((MPTX(pid,25,4) and Curr_NG(pid,366)) or match_ID(pid,748)) and JLSD(20,50,pid) then
			local a = limitX(math.modf(JY.Person[eid]["内力"]*0.3),0,2000)
			if match_ID(pid,748) then
				a = JY.Person[eid]["内力"]
			end	
			ztd(enemyid,'内力点数',-a)
			ztd(WAR.CurID,'内力点数',a)
			if JLSD(0,55,pid) then
				if JY.Person[eid]["内力性质"] == 0 then
					WAR.PD['寒毒入体'][eid] = 1	        
				elseif JY.Person[eid]["内力性质"] == 1 then  
					WAR.PD['火毒攻心'][eid] = 1
				elseif JY.Person[eid]["内力性质"] == 2 then
					WAR.PD['五蕴炽盛'][eid] = 1
				end
			end
			Set_Eff_Text(enemyid, "特效文字2", "护龙秘术・嗜血狱魔")   
		end 	

		--庄主
		if MPTX(pid,25,5) and Curr_NG(pid,366) and JLSD(20,50,pid) then
			local d = math.modf((JY.Person[pid]["指法技巧"]+JY.Person[pid]["特殊兵器"]+JY.Person[pid]["暗器技巧"])*0.33)
			ztd(enemyid,'生命点数',-d)
		end 	
		--护龙山庄暴怒技
		if BNJQ(pid) and MPTX(pid,25,1) then
			hurtzs1[#hurtzs1+1] = 0.25 
			WAR.PD["利刃寒锋"][eid] = 20
		end 	
	end
	--云梦涧
	if MPTX(pid,26) and DWPD(WAR.CurID,enemyid) then
		hurtzs1[#hurtzs1+1] = 0.2
		--1级弟子
		if yongte(wugong) then
			if JLSD(20,50,pid) then
				local a = JY.Person[pid]["特殊兵器"]
				zshurt = zshurt + a 
			end
			if JLSD(20,50,pid) then
				ztd(enemyid,WAR.BFXS,15)
			end
			if JLSD(20,50,pid) then
				local a = JY.Person[eid]["冰封程度"] * 3
				ztd(enemyid,"生命点数",-a)
			end
			if JLSD(20,50,pid) then
				if JY.Person[eid]["冰封程度"] >= 35 then
					JY.Person[eid]["受伤程度"] = 100
				end
			end
			if JLSD(20,50,pid) then
				local a = JY.Person[eid]["受伤程度"] * 2
				ztd(enemyid,"生命点数",-a)
			end
		end
		--2级弟子				
		if MPTX(pid,26,2) and yongte(wugong) then	
			if JLSD(10,50,pid) then
				if (WAR.PD["精神错乱"][eid] or 0) < 10 then
					WAR.PD["精神错乱"][eid] = 10
					Set_Eff_Text(enemyid, "特效文字3", "倾国倾城貌・惊为天下人")
				end
			end
			if JLSD(10,50,pid) then
				WAR.PD["锁足状态"][eid] = 1
				Set_Eff_Text(enemyid, "特效文字3", "芸芸众神赞・飘飘仙子舞")
			end
		end
		--云梦涧暴怒技
		if BNJQ(pid) and MPTX(pid,26,1) then
			hurtzs1[#hurtzs1+1] = 0.25 
			WAR.PD["利刃寒锋"][eid] = 30
		end 					
	end 
	if MPTX(pid,27) and DWPD(WAR.CurID,enemyid) then	--兽王庄
		local yc = JY.Person[pid]["流血程度"] + JY.Person[pid]["受伤程度"] + JY.Person[pid]["中毒程度"] 
		+ JY.Person[pid]["封穴程度"] + JY.Person[pid]["冰封程度"] + JY.Person[pid]["灼烧程度"]
		local sm = (1-JY.Person[pid]["生命"])/JY.Person[pid]["生命最大值"]*2000
		local nl = (1-JY.Person[pid]["内力"])/JY.Person[pid]["内力最大值"]*2000
		local tl = (1-JY.Person[pid]["体力"])/50
		zshurt = zshurt + sm + nl + yc
		hurtzs1[#hurtzs1+1] = tl
		if WAR.PD['兽血沸腾'][pid] ~= nil and WAR.PD['兽血沸腾'][pid] > 0 then
			zshurt = zshurt + WAR.PD['兽血沸腾'][pid]
			ztd(enemyid,'生命点数',-math.modf(WAR.PD['兽血沸腾'][pid]/3))
			if WAR.Person[WAR.CurID]["死亡"] == true then
				WAR.Person[WAR.CurID]["死亡"] = false
			end
			if JY.Person[pid]["生命"] < 1 then
				JY.Person[pid]["生命"] = 1
			end
		end
		if JLSD(0,100,pid) then
		    WAR.PD['无明业火'][eid] = 20
		end 	
		--2级弟子
		if MPTX(pid,27,2) then
			if yongquan(wugong) and JLSD(20,50,pid) then
				local a = JY.Person[pid]["攻击力"]
				ztd(WAR.CurID,'生命点数',a)
				ztd(WAR.CurID,'内力点数',a)
				Set_Eff_Text(enemyid, "特效文字2","狼啸")
			end
			if yongdao(wugong) and JLSD(20,50,pid) then
				WAR.PD['兽王蛇毒'][eid] = 30
				Set_Eff_Text(enemyid, "特效文字2","蛇咬")
			end
		end
		--3级弟子
		if MPTX(pid,27,3) then
			local str= ""
			local a = math.random(1,4)
			if a == 1 then	
				ztd(enemyid,'集气位置',-600)	
				str = "・虎啸"	
			elseif a == 2 then
				WAR.PD["兽王创伤"][eid] = 20
				str = "・象踏"
			elseif a == 3 then
				WAR.PD["兽王负面"][eid] = 20
				str = "・熊掌"	  
			elseif a == 4 then
				WAR.PD["兽王恢复"][pid] = 20
				str = "・鲸息"	  
			end	  	
			Set_Eff_Text(enemyid, "特效文字3","拟兽战法"..str)			
			if yongquan(wugong) then 
				local str = ""
			    local a = math.random(1,4)
			    if a == 1 then
	 		    	WAR.PD['残劲袭魄'][eid] = 1
			    	str = "・青龙斗气"
			    elseif a == 2 then	
			    	WAR.PD['败血破命'][eid] = 1
			    	str = "・白虎斗气"
			    elseif a == 3 then	
			    	WAR.PD['火毒攻心'][eid] = 1
			    	str = "・朱雀斗气"	
			    elseif a == 4 then	
			    	WAR.PD['寒毒入体'][eid] = 1
			    	str = "・玄武斗气"					
			    end
			    Set_Eff_Text(enemyid, "特效文字2","神兽斗气"..str)	
			end	
		end 
	end
	--青城
	if MPTX(pid,28) and DWPD(WAR.CurID,enemyid) then  
		local mpdj = MPDJ(pid)
		--青城基础伤害
		zshurt = zshurt + TrueYJ(pid)*0.4 + TrueQZ(pid)*0.3
		hurtzs1[#hurtzs1+1] = 2
		--青城2级
		if MPTX(pid,28,2) and yongquan(wugong) and JLSD(30,60,pid) then
			local a = JY.Person[eid]["流血程度"] * 3
			ztd(enemyid,WAR.LXXS,35)
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid, "特效文字2","天罡掌劲・奔雷")
		end
		--青城2级
		if MPTX(pid,28,2) and wugong == 328 and JLSD(30,60,pid) then
			local a = JY.Person[pid]["内力"] * 0.1
			ztd(enemyid,"生命点数",-a)
			Set_Eff_Text(enemyid, "特效文字2", "天罡掌劲・飓风")	
		end 
		--青城3级
		if MPTX(pid,28,3) and wugong == 27 and Curr_NG(pid,379) then
			if JLSD(30,60,pid) then
				WAR.PD['白蟒鞭法'][eid] = 10
				WAR.PD["峨眉临济"][eid] = 10
				Set_Eff_Text(enemyid, "特效文字3", "雌雄龙虎剑・雪雨天遁")	
			end
			if JLSD(30,60,pid) then
				WAR.PD["逍遥长春"][eid] = 15
				Set_Eff_Text(enemyid, "特效文字3", "雌雄龙虎剑・水云旋涡")	
			end
			if JLSD(25,60,pid) then
				WAR.PD['扫荡群魔'][eid] = 15
				Set_Eff_Text(enemyid, "特效文字3", "雌雄龙虎剑・八仙伏魔")	
			end
			if JLSD(30,60,pid) then
				local a = JY.Person[pid]["内力"]
				zshurt = zshurt + a
			end
		end
		--青城暴怒技
		if MPTX(pid,28,1) and BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = TrueQZ(pid)
			local b = TrueYJ(pid)
			local c = JY.Person[pid]["内力"] * 0.2
			zshurt = zshurt + a
			ztd(enemyid,"生命点数", c)
		end
	end
	
	--五毒教
	if MPTX(pid,29) and DWPD(WAR.CurID,enemyid) then
		ztd(enemyid,"生命点数",-JY.Person[eid]["中毒程度"]*3)
		addbuff(eid,WAR.PD['西域奇毒'],3,25)
		zshurt = zshurt + JY.Person[eid]["中毒程度"]*3
		--五毒教2级
		if MPTX(pid,29,2) then
			if yongquan(wugong) and JLSD(30,60,pid) then
				ztd(enemyid,"中毒点数",50)
				addbuff(eid,WAR.PD['冰冻状态'],5,40)
				addbuff(eid,WAR.PD['冰冻扣血'],5,40)
				Set_Eff_Text(enemyid, "特效文字3","五圣诀・含荼茹毒")
			end
			if yongte(wugong) and JLSD(30,60,pid) then
				ztd(enemyid,WAR.BFXS,25)
				ztd(enemyid,WAR.FXXS,5)
				WAR.PD["刺目"][eid] = 2
			end
		end
		--五毒教3级
		if MPTX(pid,29,3) then
			if yongquan(wugong) and JLSD(30,60,pid) then
				local a = JY.Person[eid]["中毒程度"]*5
				ztd(enemyid,WAR.LXXS,50)
				addbuff(eid,WAR.PD['扫荡群魔'],5,25)
				ztd(enemyid,"生命点数",-a)
				Set_Eff_Text(enemyid, "特效文字2","五圣诀・五毒俱全")
			end
			if yongte(wugong) and JLSD(30,60,pid) then
				local a = JY.Person[eid]["冰封程度"]*5
				ztd(enemyid,"内力点数",-a)
			end
		end
		--五毒教4级
		if MPTX(pid,29,4) then
			if yongquan(wugong) and JLSD(30,60,pid) then
				addbuff(eid,WAR.PD['五毒教1'],5,15)
				Set_Eff_Text(enemyid, "特效文字1","五圣诀・阳解阴毒")
			end
			if yongte(wugong) and JLSD(30,60,pid) then
				hurtzs1[#hurtzs1+1] = 1
				addbuff(eid,WAR.PD['麻痹状态'],10,10)
			end
		end
		--五毒教暴怒技
		if BNJQ(pid) then
			hurtzs1[#hurtzs1+1] = 0.25
			local a = TrueTS(pid)
			local b = JY.Person[eid]["中毒程度"]
			local c = a + b
			ztd(enemyid,"生命点数",-c)
		end
	end 		
	
	--天机宫
	if (MPTX(pid,30) or match_ID(pid,635)) and DWPD(WAR.CurID,enemyid) then
		local a = JY.Person[pid]["内力"] / 25
		ztd(enemyid,"生命点数",-a)
		--3级弟子
		if MPTX(pid,30,3) then
			if wugong == 58 and Curr_NG(pid,180) then
				local a = TrueSD(pid)
				zshurt = zshurt + a
				local str=''
				if JLSD(20,50,pid) then
					local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 200)
					str = str .. '・无间影狱'
					if d < 10 then
						d = 10
					end
					ztd(enemyid,WAR.LXXS,d)
					zshurt = zshurt + math.modf((JY.Person[eid]["内力最大值"] - JY.Person[eid]["内力"]) * 0.005 * d)
					if JY.Person[eid]["流血程度"] > 20 then
						local aa = math.modf(JY.Person[eid]["流血程度"] * math.random(1,3))
						ztd(enemyid, "生命点数", -aa * 2)
					end
				end	
				if JLSD(20,50,pid) then
					WAR.PD["血流不止"][eid] = limitX((WAR.PD["血流不止"][eid] or 0) + math.random(15),0,40)
					WAR.PD["霸王破甲"][eid] = limitX((WAR.PD["霸王破甲"][eid] or 0) + math.random(15),0,20)
					ztd(enemyid,WAR.LXXS,20)
					local lx = math.modf(JY.Person[eid]["流血程度"] / 2)
					ztd(enemyid,"生命点数", -lx * 2)
					ztd(enemyid,"内伤点数", -lx)
					ztd(enemyid,"内力点数", -lx * 3)
					str = str .. "・疾灭劫灰"
				end
				Set_Eff_Text(enemyid,2,"修罗灭世刀"..str)
			end	
			if wugong == 192 and Curr_NG(pid,180) then
				local a = TrueYJ(pid)
				zshurt = zshurt + a
			    local str = ""
			    local a = math.random(1,8)
			    if a == 1 then
				    WAR.PD['无明业火'][eid] = 10
				    str = "・乾剑道"
			    elseif a == 2 then	
				    WAR.PD['回魂仙梦'][eid] = 10
				    str = "・坤剑道"
			    elseif a == 3 then	
				    WAR.PD['精神错乱'][eid] = 10
				    str = "・震剑道"	
			    elseif a == 4 then	
				    WAR.PD["麻痹状态"][eid] = 10
				    str = "・巽剑道"	
			    elseif a == 5 then	
				    WAR.PD["集气倒退"][eid] = 10
				    str = "・坎剑道"	
			    elseif a == 6 then	
				    ztd(enemyid,"生命点数", -500)
				    str = "・离剑道"	
			    elseif a == 7 then	
				    ztd(enemyid,"内力点数", -1500)
				    str = "・艮剑道"	
			    elseif a == 8 then	
				    ztd(enemyid,"体力点数", -8)
				    str = "・兑剑道"								
			    end
			    Set_Eff_Text(enemyid, "特效文字2","归藏剑"..str)	
			end 
			if wugong == 179 and Curr_NG(pid,180) then
				local a = TrueQZ(pid)
				zshurt = zshurt + a
			    local str = ""
			    local a = math.random(1,6)
			    if a == 1 then
				    WAR.PD['锁足状态'][eid] = 1
				    str = "・滔天"
			    elseif a == 2 then	
				    WAR.PD["脆弱状态"][eid] = 2
				    str = "・陷空力"
			    elseif a == 3 then	
				    WAR.PD['利刃寒锋'][eid] = 20
				    str = "・阴阳流"	
			    elseif a == 4 then	
				    WAR.PD['冰冻状态'][eid] = 20
				    str = "・生灭道"	
			    elseif a == 5 then	
				    WAR.PD['冰冻扣血'][eid] = 20
				    str = "・涡旋劲"	
			    elseif a == 6 then	
				    WAR.PD['恐惧状态'][eid] = 1
				    str = "・滴水劲"									
			    end
			    Set_Eff_Text(enemyid, "特效文字2","碧海惊涛掌"..str)	
			end 	
			--天机宫暴怒技
		    if BNJQ(pid) then
			    hurtzs1[#hurtzs1+1] = 0.25
			    local a = TrueQZ(pid) / 2
			    local b = TrueYJ(pid) / 2
			    local c = TrueSD(pid) / 2
				local d = a + b + c
			    ztd(enemyid,"生命点数", d)
		    end		
		end
	end	
	-----------------------------------------------------------------------
    ---------------------------轻功命中敌人后加成----------------------------
	-----------------------------------------------------------------------
	--神行
	if QGQH(pid,146,2) then
		if WAR.ACT == 1 or JLSD(10,50,pid) then
			local ab = Cat('背刺侧攻')
			ztd(enemyid,WAR.LXXS,25)
			local aa = JY.Person[eid]["流血程度"]
			zshurt = zshurt + math.modf((aa+Qg(WAR.CurID))*(2+ab))
			if ab > 0 then
				Set_Eff_Text(enemyid,"特效文字1","侠客经典・神行背刺")
			end	
		end	
	end
	--天罗地网
	if Curr_QG(pid,148) then
		WAR.TLDW[eid] = 1;
		if QGQH(pid,148,1) then
			local wqg = math.modf(JY.Person[pid]["轻功"])
			local dqg = math.modf(JY.Person[eid]["轻功"]/2)
			if wqg > dqg then
				zshurt = zshurt + math.modf((wqg-dqg)*2)
			else
				zshurt = zshurt + math.random(200,300)
			end
		end
		if TFQG(pid,148) then
			if JLSD(10,30,pid) then
				WAR.PD["锁足状态"][eid] = 1
			end
			if WAR.PD["锁足状态"][eid] ~= nil then
				ztd(enemyid,"内伤点数",10)
				ztd(enemyid,WAR.BFXS,10)
			end
		end	
	end	
	--君子风
	if Curr_QG(pid,262) and QGQH(pid,262,2) then
		zshurt = zshurt + ang
		if WAR.NGJL > 0 then
			WAR.BFX = 1
		end	
	end
	--花间游高阶
	if QGQH(pid,286,2) then
		local fac = WAR.HJY*0.1
		hurtzs1[#hurtzs1+1] = fac
		if WAR.HJY > 5 then
			WAR.PD['再次行动'][pid] = 60
		end
	end
	--风吟步
	if Curr_QG(pid,300) then
		if TFQG(pid,300) and JLSD(10,40,pid) then
			local xz = Qg(WAR.CurID)
			zshurt = zshurt + xz
			ang = ang + xz
			if math.random(10) > 5 then
				WAR.PD['创伤'][eid] = (WAR.PD['创伤'][eid] or 0) + 15
				Set_Eff_Text(enemyid,1,'风吟・风刃')
			end	
		end	
		if QGQH(pid,300,1) and JLSD(10,45,pid) then
			addbuff(eid,WAR.PD['灵蛇拳'],10,15)
			addbuff(eid,WAR.PD['透骨针2'],10,15)
			Set_Eff_Text(enemyid,2,'风吟・风有声')
		end	
	end
	--追魂无影
	if QGQH(pid,278,2) then
		ztd(enemyid,"中毒点数",100)
		WAR.PD["利刃寒锋"][eid] = 10
	end			
	----------------------------------奇穴命中后效果---------------------------------------
	--拳系奇穴
	if yongquan(wugong) and QUANQX(pid,'拳倾天下') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"内伤点数",math.modf(QUANQX(pid,'拳倾天下')))
	end 		
	
	if yongquan(wugong) and QUANQX(pid,'霸王惊雷') >= 1 then
		local a = JY.Person[eid]["受伤程度"] * math.modf(QUANQX(pid,'霸王惊雷')+1)
		zshurt = zshurt + a 
	end 	 
	
	if yongquan(wugong) and QUANQX(pid,'排山倒海') >= 1 then
		local a = JY.Person[eid]["受伤程度"] * math.modf(QUANQX(pid,'排山倒海')+1)
		zshurt = zshurt + math.modf(ang + a)
	end 			
	
	if yongquan(wugong) and QUANQX(pid,'翻江倒海') >= 1 and JLSD(20,50,pid) then
		if nokillspeed(enemyid) == false then
			ztd(enemyid,'集气位置',-math.modf(QUANQX(pid,'翻江倒海')*100))
		end
	end
	
	if yongquan(wugong) and QUANQX(pid,'沉元破月') >= 1 and JLSD(20,50,pid) then
		WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + math.random((QUANQX(pid,'沉元破月')+1))
	end 	
	
	
	if yongquan(wugong) and QUANQX(pid,'泰山压顶') >= 1 and JLSD(20,50,pid) then
		local a = JY.Person[eid]["受伤程度"] * math.modf(QUANQX(pid,'泰山压顶')+1)
		ang = ang + a
	end 	
	
	if yongquan(wugong) and QUANQX(pid,'君临天下') >= 1 and JLSD(20,50,pid) then
		WAR.QFQXM[eid] = math.modf(QUANQX(pid,'君临天下')*5)
	end 	 		
	
	if yongquan(wugong) and QUANQX(pid,'傲看苍生') >= 1 and JLSD(20,50,pid) then
		WAR.QFQXN[eid] = math.modf(QUANQX(pid,'傲看苍生')*5)
	end	

	if yongquan(wugong) and QUANQX(pid,'问鼎天下') >= 1 and JLSD(20,50,pid) then
		local wd = QUANQX(pid,'问鼎天下') or 1	
		addbuff(eid,WAR.PD['重度内伤'],wd*3,10)
	end	
	
	if yongquan(wugong) and QUANQX(pid,'纵横宇内') >= 1 and JLSD(20,50,pid) then	
		WAR.PD['虚弱状态'][eid] = math.modf(QUANQX(pid,'纵横宇内')*5)
	end 	
		
	if yongquan(wugong) and QUANQX(pid,'天机难寻') >= 1 and JLSD(20,50,pid) then	
		local a =  2
		if QUANQX(pid,'天机难寻') >= 3 then
			a = 3
		elseif QUANQX(pid,'天机难寻') == 2 then
			a = 2.5
		end		 
		ztd(enemyid,"生命点数",-math.modf(psx(eid,'受伤程度')*a))
	end 	 
	
	if yongquan(wugong) and QUANQX(pid,'主宰人神') >= 1 and JLSD(20,50,pid) then	
		local a = math.modf(JY.Person[pid]["拳掌功夫"] *QUANQX(pid,'主宰人神')*0.1)
		ztd(enemyid,"内力点数",-a)
	end 
	
	if yongquan(wugong) and QUANQX(pid,'回魂七刺') >= 1 and JLSD(20,50,pid) then	
		ztd(enemyid,"中毒点数",math.modf(QUANQX(pid,'回魂七刺')*5))
	end	
	
	if yongquan(wugong) and QUANQX(pid,'邪元蛊毒') >= 1 and JLSD(20,50,pid) then	
		local a = JY.Person[eid]["受伤程度"]
		local b = JY.Person[eid]["中毒程度"]
		local c = a + b
		ztd(enemyid,"生命点数",-(c * math.modf(QUANQX(pid,'邪元蛊毒')+1)))
	end 	
	
	if yongquan(wugong) and QUANQX(pid,'七雾麻香') >= 1 and JLSD(20,50,pid) then
		WAR.PD['伤重不治'][eid] = math.modf(5*QUANQX(pid,'七雾麻香'))
	end 	 	
	
	if yongquan(wugong) and QUANQX(pid,'三日断肠') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"体力点数",-math.modf(QUANQX(pid,'三日断肠')))
	end	
	
	if yongquan(wugong) and QUANQX(pid,'锁筋蚀骨') >= 1 and JLSD(20,50,pid) then
		WAR.PD['脆弱状态'][eid] = math.modf(QUANQX(pid,'锁筋蚀骨'))
	end
	
	--指系奇穴
	if yongzhi(wugong) and ZHIQX(pid,'白阳破晓') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,WAR.FXXS,math.modf(ZHIQX(pid,'白阳破晓')*2))
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'执念断妄') >= 1 and JLSD(20,50,pid) then
		local a = ZHIQX(pid,'执念断妄')+1
		zshurt = zshurt + math.modf(psx(eid,'封穴程度')*a)
	end 		
	
	if yongzhi(wugong) and ZHIQX(pid,'日坐愁城') >= 1 and JLSD(20,50,pid) then
		local a = 0.2+(ZHIQX(pid,'日坐愁城')*0.1)
		hurtzs1[#hurtzs1+1] = a
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'烈火燎原') >= 1 and JLSD(20,50,pid) then
		ang = ang + math.modf(ZHIQX(pid,'烈火燎原')*100)
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'风火无边') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"体力点数",-ZHIQX(pid,'风火无边'))
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'烈阳普照') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"内力点数",-math.modf(ZHIQX(pid,'烈阳普照')*100))
	end 			

	if yongzhi(wugong) and ZHIQX(pid,'空山灵雨') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"生命点数",-math.modf(ZHIQX(pid,'空山灵雨')*50))
	end 				
	
	if yongzhi(wugong) and ZHIQX(pid,'黄泉寒雾') >= 1 and JLSD(20,50,pid) then	
		WAR.PD["走火入魔"][eid] = math.modf(ZHIQX(pid,'黄泉寒雾')+1)
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'九续雪寒') >= 1 and JLSD(20,50,pid) then	
		WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + math.modf(ZHIQX(pid,'九续雪寒')+2)
	end 
	
	if yongzhi(wugong) and ZHIQX(pid,'荡为寒烟') >= 1 and JLSD(20,50,pid) then	
		WAR.PD["灵蛇拳"][eid] = math.modf(ZHIQX(pid,'荡为寒烟')+5)
	end 
	if yongzhi(wugong) and ZHIQX(pid,'绝浪凌波') >= 1 and JLSD(20,50,pid) then	
		ztd(enemyid,WAR.FXXS,math.modf(ZHIQX(pid,'绝浪凌波')*5))
		ztd(enemyid,'内力点数',math.modf(ZHIQX(pid,'绝浪凌波')*9))
	end
	if yongzhi(wugong) and ZHIQX(pid,'战鼓鸣笛') >= 1 and JLSD(20,50,pid) then	
		WAR.PD['无明业火'][eid] = (WAR.PD['无明业火'][eid] or 0) + math.modf(ZHIQX(pid,'战鼓鸣笛')+5)
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'射石饮羽') >= 1 and JLSD(20,50,pid) then	 
		local a = JY.Person[pid]["指法技巧"] * ((ZHIQX(pid,'射石饮羽')*0.1)+0.4)
		zshurt = zshurt + a
	end 

	if yongzhi(wugong) and ZHIQX(pid,'九幽夺魂') == 1 and JLSD(20,50,pid) then	 
		WAR.PD['麻痹状态'][eid] = 1
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'魔渡八方') >= 1 and JLSD(20,50,pid) then
		WAR.ZFQXN[eid] = math.modf(10*ZHIQX(pid,'魔渡八方'))
	end 	
	
	if yongzhi(wugong) and ZHIQX(pid,'邪性定聚') >= 1 and JLSD(20,50,pid) then
		WAR.ZFQXM[eid] = math.modf(15*ZHIQX(pid,'邪性定聚'))
	end 	
	
	--剑系奇穴
	if yongjian(wugong) and JIANQX(pid,'纵观天地') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,WAR.BFXS,math.modf(JIANQX(pid,'纵观天地')))
	end 
	
	if yongjian(wugong) and JIANQX(pid,'剑影纵横') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"生命点数",-((JIANQX(pid,'剑影纵横')+1)*50))
	end 
	
	if yongjian(wugong) and JIANQX(pid,'以意成型') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"内力点数",-((JIANQX(pid,'以意成型')+2)*100))
	end 
	
	if yongjian(wugong) and JIANQX(pid,'随心所意') >= 1 and JLSD(20,50,pid) then
		ztd(enemyid,"体力点数",-JIANQX(pid,'随心所意'))
	end  
	
	if yongjian(wugong) and JIANQX(pid,'剑迭晖煌') >= 1 and JLSD(20,50,pid) then
		WAR.PD['迟缓状态'][eid] = (WAR.PD['迟缓状态'][eid] or 0) + math.random(JIANQX(pid,'剑迭晖煌')*10)
	end  
	
	if yongjian(wugong) and JIANQX(pid,'日丽中天') >= 1 and JLSD(20,50,pid) then
		local a = JY.Person[eid]["冰封程度"] * JIANQX(pid,'日丽中天')* 0.01
		hurtzs1[#hurtzs1+1] = a
	end 
	
	if yongjian(wugong) and JIANQX(pid,'落霞孤鹜') >= 1 and JLSD(20,50,pid) then
		local a = math.modf(JY.Person[eid]["冰封程度"] * (JIANQX(pid,'落霞孤鹜')+1))
		ztd(enemyid,"内力点数",-a)
	end
	
	if yongjian(wugong) and JIANQX(pid,'夜雨飞花') >= 1 and JLSD(20,50,pid) then
		WAR.PD["刺目"][eid] = 2
	end	
	
	if yongjian(wugong) and JIANQX(pid,'浪汤碧江') >= 1 and JLSD(20,50,pid) then
		WAR.PD["灵蛇拳"][eid] = math.modf(JIANQX(pid,'浪汤碧江')*10)
	end	
	
	if yongjian(wugong) and JIANQX(pid,'碎破穹苍') >= 1 and JLSD(20,50,pid) then
		WAR.PD['混乱状态'][eid] = 1
	end	
	
	if yongjian(wugong) and JIANQX(pid,'化金元诀') >= 1 and JLSD(20,50,pid) then
		WAR.JXSMD[eid] = math.modf(3*JIANQX(pid,'化金元诀'))
	end 	
	
	if yongjian(wugong) and JIANQX(pid,'绝木干罡') >= 1 and JLSD(20,50,pid) then
		WAR.JXNLD[eid] = math.modf(4*JIANQX(pid,'绝木干罡'))
	end 	
	
	if yongjian(wugong) and JIANQX(pid,'灭水空焰') >= 1 and JLSD(20,50,pid) then
		WAR.JXSMW[pid] = math.modf(2*JIANQX(pid,'灭水空焰'))
	end 
	
	if yongjian(wugong) and JIANQX(pid,'御火吞天') >= 1 and JLSD(20,50,pid) then
		WAR.JXNLW[pid] = math.modf(3*JIANQX(pid,'御火吞天'))
	end 	
	if yongjian(wugong) and JIANQX(pid,'断土狂雷') >= 1 and JLSD(20,50,pid) then
		local a = JY.Person[eid]["生命"] * ((JIANQX(pid,'断土狂雷')*0.01) + 0.02)
		ztd(enemyid,'生命点数',-a)
	end		
	
	if yongjian(wugong) and JIANQX(pid,'独点寒松') >= 1 and JLSD(20,50,pid) then
		WAR.PD['麻痹状态'][eid] = (WAR.PD["麻痹状态"][eid] or 0) + math.random(JIANQX(pid,'独点寒松')*2)
	end 	

	if yongjian(wugong) and JIANQX(pid,'妙连天机') >= 1 and JLSD(20,50,pid) then
		WAR.PD['无明业火'][eid] = (WAR.PD['无明业火'][eid] or 0) + math.modf(JIANQX(pid,'妙连天机')*3)
	end	
	
	if yongjian(wugong) and JIANQX(pid,'天地玄空') >= 1 and JLSD(20,50,pid) then
		WAR.PD['利刃寒锋'][eid] = math.modf(5*JIANQX(pid,'天地玄空'))
	end
	
	if yongjian(wugong) and JIANQX(pid,'乾坤剑傲') >= 1 and JLSD(20,50,pid) then
		WAR.PD['昏迷状态'][eid] = 1
	end
	
	--刀法奇穴
	--沉星月
	if yongdao(wugong) and DAOQX(pid,'沉星月') >= 1 then
		local a = DAOQX(pid,'沉星月')*2
		local b = DAOQX(pid,'沉星月')*20
		local c = DAOQX(pid,'沉星月')*5
		if RealJL(WAR.CurID,enemyid,a) then
			hurtzs1[#hurtzs1+1] = b/100
			zshurt = zshurt + c*30
		end
	end		
	if yongdao(wugong) and (wgnlxz(wugong) ~= rwnlxz(eid)) and DAOQX(pid,'交阴阳') >= 1 and JLSD(10,55,pid) then
		local c = DAOQX(pid,'交阴阳')*5
		addbuff(eid,WAR.PD['回魂仙梦'],math.modf(c))
	end	
	if yongdao(wugong) and DAOQX(pid,'辟鸿蒙')	>= 1 and JLSD(10,40,pid) then
		WAR.PD['辟鸿蒙'][eid] =  limitX((WAR.PD['辟鸿蒙'][eid] or 0) + 1,0,30)
		local cj = math.abs(TrueSD(pid)-TrueSD(eid))
		if cj < 100 then cj = 100 end
		ztd(enemyid,'生命点数',-cj)
	end
	--慈航引
	if yongdao(wugong) and DAOQX(pid,'慈航引')	>= 1 then
		local jl = math.modf(DAOQX(pid,'慈航引')*5)
		local jzy = math.modf(DAOQX(pid,'慈航引')*3)
		if JLSD(0,jl,pid) then
			zhanyi(eid,-jzy)
			nuqi(eid,-5)
		end
	end
	if yongdao(wugong) and DAOQX(pid,'涤罪角') >= 1 then
		local eiddaode = math.modf(DAOQX(pid,'涤罪角')*20)
		local jnl = math.modf((DAOQX(pid,'涤罪角')+1)*100)
		if psx(eid,'品德') <= eiddaode and JLSD(10,55,pid) then
			ztd(enemyid,'内力点数',-jnl)
			WAR.PD['内力恢复停止'][eid] = 2
		end
	end
	if yongdao(wugong) and DAOQX(pid,'佛刑禅') >= 1 then
		local eiddaode = math.modf(DAOQX(pid,'佛刑禅')*20) +40
		local jnl = math.modf((DAOQX(pid,'佛刑禅'))*100)+150
		if psx(eid,'品德') <= eiddaode and JLSD(10,55,pid) then
			ztd(enemyid,'生命点数',-jnl)
			addbuff(eid,WAR.PD["生命恢复停止"],1,2)
		end
	end		
	if yongdao(wugong) and DAOQX(pid,'萧索刀') >= 1 and JLSD(10,45,pid) then
		local a= (DAOQX(pid,'萧索刀')*5)+10
		addbuff(eid,WAR.PD['冰心状态'],a)
		WAR.PD['怒气负面效果2'][eid] = 1
	end
	if yongdao(wugong) and DAOQX(pid,'碎梦刀') == 1 and math.random(100) <= 15 then
		if WAR.PD['昏迷状态'][eid] ~= nil or WAR.PD['恐惧状态'][eid] ~= nil or WAR.PD['沉睡状态'][eid] ~= nil or WAR.PD['头晕目眩'][eid] ~= nil then
			WAR.Person[enemyid]['生命点数'] = -JY.Person[eid]['生命']
			JY.Person[eid]['生命'] = 0		
			WAR.Person[enemyid]['死亡'] = true
			WarSetPerson()
		end
	end		
	--
	--奇门奇穴
	if yongte(wugong) and QIQX(pid,'龙狼牙') > 0 then
		local a = 0
		if JY.Person[pid]["武器"] ~= nil and JY.Person[pid]["武器"] > 0 then
			a = (JY.Thing[JY.Person[pid]["武器"]]["加攻击力"] or 0)
		else	 
			a = math.modf(TrueTS(pid)*0.6)
		end		
		local b = (QIQX(pid,'龙狼牙')*10) + 20
		zshurt = zshurt + math.modf(a*QIQX(pid,'龙狼牙')*b*0.01)
	end
	if yongte(wugong) and QIQX(pid,'贯云枪') > 0 then
		local a =	QIQX(pid,'贯云枪')*8
		local b = QIQX(pid,'贯云枪')*5
		if JLSD(0,a,pid) then
			addbuff(eid,WAR.PD['禁疗'],5,b)
		end
	end
	if yongte(wugong) and QIQX(pid,'问途寒') > 0 then
		local b = math.abs(Atk(WAR.CurID) - Atk(enemyid))
		local qiang = {68,70,165,200}
		local buff = 0
		for i = 1, #qiang do 
			if PersonKF(pid,qiang[i]) then
				buff = buff + 1
			end
		end
		b = b + math.random(80,160)*buff
		if JLSD(0,15+(buff*2),pid) then
			ztd(enemyid,'生命点数',-b)
		end
	end
	if yongte(wugong) and QIQX(pid,'幻胧穿') > 0 then
		local a = QIQX(pid,'幻胧穿')
		if JLSD(0,a*12,pid) then
			ztd(enemyid,WAR.FXXS,5*a)
			addbuff(pid,WAR.PD['回气'],math.random(a*100,a*150))
		end
	end
	if yongte(wugong) and QIQX(pid,'火神鸣') > 0 then
		local a = QIQX(pid,'火神鸣')
		if JLSD(0,a*12,pid) then
			ztd(enemyid,WAR.ZSXS,10*a)
			if JY.Person[eid]["灼烧程度"] > 30 then
				ztd(WAR.CurID,'生命点数',psx(eid,'灼烧程度')*math.random(2,6))
				addbuff(pid,WAR.PD['集气速度'],math.random(5,10))
			end	
		end
	end
	if yongte(wugong) and QIQX(pid,'血时雨') > 0 then
		local a = QIQX(pid,'血时雨')
		if JLSD(0,a*12,pid) then
			ztd(enemyid,WAR.LXXS,10*a)
			if JY.Person[eid]["流血程度"] > 50 then
				addbuff(eid,WAR.PD['创伤'],7*a)
				for j = 1, WAR.PersonNum - 1 do
					if dead(j) == false and DWPD(enemyid,j) == false and RealJL(j,enemyid,3) then
						local jid = WAR.Person[j]['人物编号']
						addbuff(jid,WAR.PD['创伤'], 5*a)
					end
				end
			end			
		end
	end
	if yongte(wugong) and QIQX(pid,'三途暗') > 0 then
		local a = QIQX(pid,'三途暗')
		if JLSD(0,a*12,pid) then
			ztd(enemyid,'中毒点数',10*a)
			if psx(eid,'中毒程度') > 1 then
				if JLSD(0,psx(eid,'中毒程度'),pid) then
					WAR.PD['盲目状态'][eid] = 2
					WAR.PD['虚弱状态'][eid] = (WAR.PD['虚弱状态'][eid] or 0) + 10
				end
			end	
		end
	end
	if yongte(wugong) and QIQX(pid,'黄泉沉') > 0 then
		local a = QIQX(pid,'黄泉沉')
		if JLSD(0,a*12,pid) then
			ztd(enemyid,'内伤点数',10*a)
			if psx(eid,'受伤程度') > 1 then
				if JLSD(0,math.random(psx(eid,'受伤程度')),pid) then
					WAR.PD['锁足状态'][eid] = 1
					zshurt = zshurt + math.modf(TrueTS(pid)*psx(eid,'受伤程度')*0.05)
				end
			end	
		end
	end
	--内功奇穴
	--万佛朝宗
	--[[if NGQX(pid,'万佛朝宗') >= 0 then
		if JLSD(0,100,pid) then
			for j = 0, WAR.PersonNum - 1 do
				if dead(j) == false and DWPD(j,WAR.CurID) then
					if nokillspeed(j) == false then
							WAR.Person[j].TimeAdd = WAR.Person[j].TimeAdd - 200
					end	
				end
			end
			DrawTimeBar2()
		end
	end]]		

	-----------------以下是单纯利用异常状态增加的伤害-----------------------
	--昆仑刀剑阵防御
	if (WAR.PD["两倍攻击"][eid] ~= nil and WAR.PD["两倍攻击"][eid] > 0) or (Curr_QG(pid,2) and match_ID(pid,50)) then 
		hurtzs1[#hurtzs1+1] = 1
	end
	if WAR.PD['霜炎九重2'][eid] ~= nil then
		local a = WAR.PD['霜炎九重2'][eid]
		local b = 0
		local c = 0
		if rwnlxz(eid,0) then
			b = 10
		end
		if rwnlxz(eid,1) then
			c = 10
		end	
		ztd(enemyid,"内力点数",-math.modf(psx(eid,"冰封程度")*3))
		ztd(enemyid,"生命点数",-math.modf(psx(eid,"灼烧程度")*1.5))
		if psx(eid,"冰封程度") > 0 and JLSD(0,math.modf(a*15)+10+b,eid) then
			WAR.PD['冰冻状态'][eid] = limitX((WAR.PD['冰冻状态'][eid] or 0) + math.modf(psx(eid,"冰封程度")*0.5),0,50)
			WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + math.modf(psx(eid,"冰封程度")*0.5)
			WAR.PD['利刃寒锋'][eid] = limitX((WAR.PD['利刃寒锋'][eid] or 0) + math.modf(psx(eid,"冰封程度")*0.5),0,20)
			ztd(enemyid,WAR.BFXS,-JY.Person[eid]["冰封程度"])
		end	
		if psx(eid,"灼烧程度") > 0 and JLSD(0,math.modf(a*15)+10+c,eid) then
			WAR.PD['无明业火'][eid] = limitX((WAR.PD['无明业火'][eid] or 0) + math.modf(psx(eid,"灼烧程度")*0.5),0,30)
			WAR.PD['举火燎原'][eid] = limitX((WAR.PD['举火燎原'][eid] or 0) + math.modf(psx(eid,"灼烧程度")*0.5),0,20)
			ztd(enemyid,WAR.ZSXS,-JY.Person[eid]["灼烧程度"])
		end
	end	
	if WAR.PD['天剑绝刀1'][eid] ~= nil then
		zshurt = zshurt - TrueYJ(eid) - TrueSD(eid)
		ztd(enemyid,"生命点数",math.random(50,100))
	end
	--踏雪无痕标记
	if WAR.PD['雪夜追猎'][eid] ~= nil and DWPD(WAR.CurID,enemyid) then
		WAR.PD['雪夜追猎'][eid] = WAR.PD['雪夜追猎'][eid] + 1
		hurtzs1[#hurtzs1+1] = WAR.PD['雪夜追猎'][eid]*0.1
	end
	--天刀九问
	if PersonKF(eid,335) and PersonKF(eid,203) and PersonKF(eid,181) then
		if yongdao(wugong) then
			hurtzs1[#hurtzs1+1] = -0.9
		end
	end
	--周公剑意霸王惊雷
	if WAR.PD["感电状态"][eid] ~= nil then
		addbuff(eid,WAR.PD['麻痹状态'],1)
		local a = math.abs(300-JY.Person[eid]["受伤程度"])
		local b = math.abs(300-JY.Person[eid]["中毒程度"])
		local c = math.abs(500-JY.Person[eid]["冰封程度"])
		local d = math.abs(300-JY.Person[eid]["灼烧程度"])
		local e = math.abs(100-JY.Person[eid]["封穴程度"])
		local f = math.abs(300-JY.Person[eid]["流血程度"])
		local g = a + b + c + d + e + f 
		zshurt = zshurt + g
	end
	--血色诅咒
	if WAR.PD["血色诅咒"][eid] ~= nil then
		zshurt = zshurt + 100 * (WAR.PD["血色诅咒"][eid] or 0)
	end
	--疯魔
	if WAR.PD["疯魔"][eid] ~= nil then
		zshurt = zshurt + 300
	end
	--破甲蛇毒
	if WAR.PD['破甲蛇毒'][eid] ~= nil and  WAR.PD['破甲蛇毒'][eid] > 0 then
		hurtzs1[#hurtzs1+1] = 0.5
		zshurt = zshurt + 100
		WAR.PD['破甲蛇毒'][eid] =  WAR.PD['破甲蛇毒'][eid] - 1
		if WAR.PD['破甲蛇毒'][eid] <= 0 then
			WAR.PD['破甲蛇毒'][eid] = nil
		end	 
	end
	--一通万法
	if match_ID(eid,9738) and Def(enemyid) >= Def(WAR.CurID) then
		hurtzs1[#hurtzs1+1] = -0.35
		if WAR.PD['雪羽战神'][eid] ~= nil then
			hurtzs1[#hurtzs1+1] = -0.35
		end
	end
	--被杨逍击中的人，伤害增加2%，上限100%
	if WAR.GMZS[eid] ~= nil then
		local bn = WAR.GMZS[eid] / 50
		if bn > 1 then
			bn = 1
		end
		hurtzs1[#hurtzs1+1] = bn
	end
	--陈家洛被女性攻击伤害*150%
    if (match_ID(eid,75) or match_ID(eid,9896)) and JY.Person[pid]["性别"] == 1 then
        hurtzs1[#hurtzs1+1] = 0.5
    end
	--辰宿列张
	if WAR.PD["参合状态"][eid] ~= nil then
		local sh = math.random(15,30)/100
		hurtzs1[#hurtzs1+1] = sh
	end
	--重度内伤追加
	if WAR.PD['重度内伤'][eid] ~= nil then
		zshurt = zshurt + JY.Person[eid]["受伤程度"] * math.random(3,5)
	end
	--内伤增加伤害
	if JY.Person[eid]["受伤程度"] > 0 then
		if PersonKF(eid, 238) then --蜉蝣功免疫内伤加成
		elseif MPTX(eid,8) and Curr_QG(eid,150) then
		else
			local ns = JY.Person[eid]["受伤程度"] * 0.0015
			ns = ns * math.random(2,6)
			hurtzs1[#hurtzs1+1] = ns
		end
	end
	--灼烧追加伤害
	if JY.Person[eid]["灼烧程度"] >= 50 and ((not (PersonKF(eid,13) and PersonKF(eid,196))) or (not PersonKF(eid,314))) then
		zshurt = zshurt + JY.Person[eid]["灼烧程度"] * math.random(2,5)
	elseif JY.Person[eid]["灼烧程度"] > 0 and ((not (PersonKF(eid,13) and PersonKF(eid,196))) or (not PersonKF(eid,314))) then
		zshurt = zshurt + JY.Person[eid]["灼烧程度"] * math.random(3)
	end
	--罗汉金刚组合第一击减伤80%
	if NGQHB(eid,144) then
		if WAR.ACT == 1 then
			WAR.PD["不破防"][eid] = 1
			hurtzs1[#hurtzs1+1] = -0.8
			if zshurt > 0 then
				zshurt = 0
			end
			Set_Eff_Text(enemyid, "特效文字3", "罗汉金身")
		end
		if JLSD(10,30,eid) then
			hurtzs1[#hurtzs1+1] = -0.6
			Set_Eff_Text(enemyid, 3, "固若金汤",189)
		else
			zshurt = zshurt - 600
		end
	end
	--怒涛武穆
	if NGQHB(eid,252) then
		local jl = JY.Person[eid]["生命增长"]*4
		if JLSD(15,5+jl,eid) then
			zshurt = zshurt - jl*20
			hurtzs1[#hurtzs1+1] = -(JY.Person[eid]["生命增长"]/30)
			ztd(enemyid,"中毒点数",-JY.Person[eid]["生命增长"])
			ztd(enemyid,"内伤点数",-JY.Person[eid]["生命增长"])
			ztd(enemyid,WAR.ZSXS,-JY.Person[eid]["生命增长"])
			ztd(enemyid,WAR.BFXS,-JY.Person[eid]["生命增长"])
			ztd(enemyid,WAR.LXXS,-JY.Person[eid]["生命增长"])
			ztd(enemyid,WAR.FXXS,-JY.Person[eid]["生命增长"])
			Set_Eff_Text(enemyid, "特效文字1", "军形练体")
		end
	end
	--大周吸星
	if NGQH(eid,190) and (WAR.PD['三垣'][eid] or 0) < 30 then
		hurtzs1[#hurtzs1+1] = -0.2
		if JLSD(10,45,eid) then
			WAR.DLJ = 1
			WAR.DZY = 1
		end
		Set_Eff_Text(enemyid, 2, "周天星辰・天市辰幻")
	end
	if NGQH(eid,190) and (WAR.PD['三垣'][eid] or 0) > 30 and (WAR.PD['三垣'][eid] or 0) < 61 then
		local a = 0
		local b = 0
		for j = 1, JY.Base['武功数量'] do 
			local wgid = JY.Person[eid]["武功"..j]
			if JY.Wugong[wgid]["武功类型"] == WGLX then
				a = a + JY.Wugong[wgid]["攻击力10"]
			end
			if JY.Wugong[wgid]["武功类型"] == 6 then
				b = b + JY.Wugong[wgid]["攻击力10"]
			end
		end
		zshurt = zshurt - math.modf(a+b)	
		Set_Eff_Text(enemyid, 2, "周天星辰・天微之护")
	end
	--三才身
	if Sancai(eid) then
		if JLSD(10,43,eid) then
			if hurt > math.modf(psx(eid,"生命最大值")*0.1) then
				zshurt = zshurt - math.modf(psx(eid,"生命最大值")*0.1)
			else
				zshurt = 0
				if zshurt > math.modf(psx(eid,"生命最大值")*0.1) then
					ztd(enemyid,"生命点数",math.modf((psx(eid,"生命最大值")*0.1)-zshurt))
				end
			end
			Set_Eff_Text(enemyid,3,"三才・天")
		end
		if JLSD(10,43,eid) and dng > 0 then
			zshurt = zshurt - dng
			Set_Eff_Text(enemyid,1,"三才・人")
		end
	end
	--太极蓄劲
	if WAR.PD["太极蓄劲"][eid] ~= nil then
		local xj = WAR.PD["太极蓄劲"][eid] or 0
		local tj = math.modf(JY.Person[eid]["防御力"]/9*xj)
		zshurt = zshurt - tj
	end
	--奇门五转
	if Curr_NG(eid,317) and JLSD(50,55,eid) and WAR.QMWZ < 1 then
		if zshurt > 0 then
			local NL = math.modf(zshurt/2)
			Set_Eff_Text(enemyid,2,"奇门五转.西金",95)
			hurtzs1[#hurtzs1+1] = -0.5
			ztd(enemyid,"内力点数",NL)
			if MPTX(eid,10) and JLSD(0,50,eid) then
				WAR.QMWZ = 0
			else
				WAR.QMWZ=WAR.QMWZ+1
			end
		end
	end
	-----------------------转化真实伤害-------------------------------
	--世尊降魔
	if WAR.SZXM == 1 then
		if zshurt < 100 then
			ztd(enemyid,'生命点数',-100)
		else
			zshurt = zshurt + 300
		end
	end	
	--剑二十三
	if WAR.SL23 == 1 then
		if zshurt < 200 then
			ztd(enemyid,'生命点数',-200)
		end
	end
	if zshurt > 0 then
		--黯然组合
		if wugong == 25 and WAR.ARJX > 0 then
			local a = math.modf(zshurt*0.15)
			zshurt = math.modf(zshurt*0.85)
			ztd(enemyid,'生命点数',-a)
		end
		--九阴太极
		if NGQH(pid,107) and DWPD(WAR.CurID,enemyid) then
			zshurt = math.modf(zshurt*0.9)
			ztd(enemyid,"生命点数",-math.modf(zshurt*0.1))
		end
		--雪羽战神
		if match_ID(pid,514) and WAR.PD['雪羽战神'][pid] == 1 then
			local a = math.modf(zshurt*0.1)
			zshurt = math.modf(zshurt*0.9)
			ztd(enemyid,'生命点数',-a)
		end
		--龙象神足9931
		if match_ID(pid,9931) and WAR.LXBL > 0 then
			local a = math.modf(zshurt*WAR.LXBL*0.02)
			zshurt = zshurt - a
			ztd(enemyid,'生命点数',-a)
		end
		--神足乾坤
		if NGQH(pid,233) then
			local a = math.modf(zshurt*0.8)
			ztd(enemyid,'生命点数',-a)
		end 	
		--天魔易筋
		if NGQH(pid,160) then
			local dd = (psx(eid,"品德") - psx(pid,"品德"))/400
			if dd < 0.05 then dd = 0.05 end
			zshurt = math.modf(zshurt*(1-dd))
			ztd(enemyid,'生命点数',-math.modf(zshurt*dd))
		end
		--鲸息九阴
		if NGQH(pid,180) then 
			local a = JY.Person[pid]["内力最大值"] * 0.1
			ztd(enemyid,'生命点数',-a)
		end
	end
	-----------------------增伤对应的伤害结算--------------------------
	--say('增伤前伤害：'..zshurt,0,1)
	--天魔
	-----------------------增伤对应的伤害结算--------------------------
	zshurt = zshurt + (swhurt+wxhurt)/2.5
	if hurtzs1 ~= nil then
		for i = 1, #hurtzs1 do
			local zs = 0
			zs = hurtzs1[i]
			zshurt = math.modf(zshurt*(1+zs))
		end
	end
	--降低特效伤害
	if zshurt > 999 then
		zshurt = 999 + math.modf((zshurt - 999)^0.95)
		if zshurt > 1999 then
			zshurt = 1999 + math.modf((zshurt - 1999)^0.9)
			if zshurt > 3999 then
				zshurt = 3999 + math.modf((zshurt - 3999)^0.85)
			end
		end
	end
	hurt = hurt + zshurt
	--say('增伤后伤害：'..zshurt,0,1)
	hurt = math.modf(hurt)
	--伤害归0
	if hurt < 0 then
		hurt = 0 
	end
	---伤害记录
	--辟邪剑法
	if wugong == 48 and Curr_NG(pid,105) then
		WAR.SHJL[pid] = hurt
	end
	--玄武真功・棍
	if (Curr_NG(pid,315) and yongte(wugong)) or match_ID(pid,520) then
		WAR.SHJL[pid] = hurt
	end
	--真龙破灭击
	if (PersonKF(pid,281) and inteam(pid) and JY.ZLXF == 1) or match_ID(pid,524) or match_ID(pid,776) then
		WAR.SHJL[pid] = hurt
	end
	--太极张三丰
	if match_ID(pid,5) then 
		WAR.TJZS[1000 + pid] = math.modf(hurt * 0.2)
	end
	----------------------------------------------------------------------------------------------
	--------------------------------------减伤开始------------------------------------------------
	---------------------------------------------------------------------------------------------
	----------------------hurtjs1对应百分比减伤，越高减伤越多，最高为1------------------------------
	----------------------hurtjs2对应减伤至固定数值，越低减伤越高，最低为0---------------------------
	----------------------jsm是纪录减法减伤害的量--------------------------------------------------
	----------------------------------------------------------------------------------------------
	----------------------人物天赋减伤及受击效果----------------------------------------------------
	----------------------------------------------------------------------------------------------
	--张三丰
	if match_ID(eid,5) then
		local ft = (WAR.TJZX[eid] or 0)*100 
		ztd(WAR.CurID,'生命点数',-ft)
		if WAR.TJZX0[eid] ~= nil then
			if JLSD(10, 60 + (WAR.TJZX0[eid]*10), eid) then
				WAR.TJZX0[eid] = WAR.TJZX0[eid] + 1
				hurtjs1[#hurtjs1+1] = 0.3
				if JLSD(20,10+WAR.TJZX0[eid],eid) then
					hurtjs2[#hurtjs2+1] = 30
					Set_Eff_Text(enemyid,"特效文字2","阴阳无极")
				end 
			end
		end
		if hurt > math.modf(JY.Person[eid]["生命"]*0.2) then
		    local sm = math.modf(JY.Person[eid]["生命"]*0.2)
		    if sm < 100 then
				sm = 100
			end
			hurtjs2[#hurtjs2+1] = sm
			if WAR.PD['阴阳二气'][eid] == nil then
				hurtjs2[#hurtjs2+1] = 1
				Set_Eff_Text(enemyid, "特效文字3", "太极归心・万法如一")
			end
		end
		if math.random(2) == 1 then
			if WAR.PD['气阻中门'][pid] == nil then
				WAR.PD['气阻中门'][pid] = 10
				Set_Eff_Text(enemyid,"特效文字3","折中调和")
			end
		else
			addbuff(pid,WAR.PD['力竭'],1,2)
		end
		if JY.Person[eid]["内力"] < 4000 then
			JY.Person[eid]["内力"] = 4000
		end
	end
	--范遥挨打加减伤，上限100%
	if match_ID(eid,10) then
		local rd = (100 - WAR.GMYS)/50
		if rd > 1 then
			rd = 1
		end
		hurtjs1[#hurtjs1+1] = rd
	end
	--谢逊，被攻击时伤害一*85%
	if match_ID(eid,13) then
		hurtjs1[#hurtjs1+1] = 0.15
	end
	--东方不败
	if match_ID(eid,27) or match_ID(eid,777) then
		if JXPD(eid,27,1) and PersonKF(eid,105) and JLSD(20,50,eid) then
			Set_Eff_Text(enemyid, "特效文字0", "日出东方・唯我不败")   
			WAR.DLJ = 1
			WAR.PD['神教逆杀'][pid] = 6
			ztd(enemyid,'集气位置',1005-WAR.Person[enemyid].TimeAdd)
		end
		if JXPD(eid,27,2) and PersonKF(eid,105) then
			if WAR.Miss[eid] == nil and JLSD(0,30,eid) then
				local a = math.modf(JY.Person[eid]["轻功"])
				jsm = jsm + a
				Set_Eff_Text(enemyid, "特效文字1", "葵花境界")
			else
				local heal = math.modf((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"])*0.06)
				ztd(enemyid,"生命点数",heal)
				Set_Eff_Text(enemyid, "特效文字1", "真・葵花境界")
			end
		end
	end
	--木岛主，被攻击时伤害20%
	if match_ID(eid,40) then
		hurtjs1[#hurtjs1+1] = 0.2
	end
	--郭靖北斗罡步，免疫70%伤害，打断连击
	if match_ID(eid,55) and JLSD(10,30,eid) then
		hurtjs1[#hurtjs1+1] = 0.7
		WAR.DLJ = 1
		ztd(enemyid,'集气位置',1005-WAR.Person[enemyid].TimeAdd)
		Set_Eff_Text(enemyid, "特效文字2", "北斗罡步",51)
	end
	--黄药师
	if match_ID(eid,57) and JLSD(0,50,eid) then
		hurtjs1[#hurtjs1+1] = 0.25
		if math.random(2) == 1 then
			if WAR.PD['精神错乱'][pid] == nil then
				WAR.PD['精神错乱'][pid] = 10
			end	
		else
			if WAR.PD['神经蛇毒'][pid] == nil then
				WAR.PD['神经蛇毒'][pid] = 10
			end	
		end	
		Set_Eff_Text(enemyid,"特效文字3","奇门遁甲・咒")	
	end
	--一灯复活后，不受连击伤害
	if match_ID(eid,65) and WAR.FUHUOZT[eid] ~= nil then
		ztd(enemyid,'集气位置',200)
		if WAR.ACT > 1 then
			hurtjs2[#hurtjs2+1] = 0
			Set_Eff_Text(enemyid, "特效文字2", "不动明王",136)
		end
	end
	--丘处机、马钰
	if match_ID(eid,68) or match_ID(eid,123) then
		hurtjs1[#hurtjs1+1] = 0.1
	end	
	--苏荃和霍青桐，为守方，在战场时，伤害一减少10%
	for j = 0, WAR.PersonNum - 1 do
		if (match_ID(WAR.Person[j]["人物编号"], 87) or match_ID(WAR.Person[j]["人物编号"], 74)) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
			hurtjs1[#hurtjs1+1] = 0.1
		end
	end
	--喵太极
	if match_ID(eid,92) then
		WAR.DLJ = 1
	    WAR.DZY = 1
		WAR.PD['格挡状态'][eid] = 1	
		local a = math.modf(JY.Person[eid]["轻功"])
		jsm = jsm + a
		if JY.Person[eid]["生命最大值"]/2 < JY.Person[eid]["生命"] then
			ztd(enemyid,'生命点数',2000)
			ztd(enemyid,'内力点数',2000)
		end
		Set_Eff_Text(enemyid,"特效文字2","阴阳并流・天地一气")
		if JY.Person[eid]["生命最大值"]/2 > JY.Person[eid]["生命"] and JLSD(0,30,eid) then
		    local heal = math.modf((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"])*0.2)
			ztd(enemyid,"生命点数",heal)
		    Set_Eff_Text(enemyid, "特效文字3", "山川隐逸")
		end
		if JLSD(30,60,eid) then
			hurtjs2[#hurtjs2+1] = 1
			if WAR.BTZT[eid] == nil then
				WAR.BTZT[eid]= 1
			end
			Set_Eff_Text(enemyid, "特效文字2", "三气合一",51)
		end
	end
	--鸠摩智，不受非连击伤害	
	if match_ID(eid,103) then
		local zs = JY.Person[pid]["灼烧程度"]
		if JY.Person[pid]["灼烧程度"] > 0 then
			ztd(WAR.CurID,"生命点数",-zs)
		else
		    ztd(WAR.CurID,WAR.ZSXS,25)
		end
		if WAR.ACT == 1 then
			hurtjs2[#hurtjs2+1] = 0
			Set_Eff_Text(enemyid, "特效文字2", "火焰刀体",136)
		end
	end
	--火焰刀奥义
	if WAR.PD['残日狱衣'][eid] ~= nil and (match_ID(eid,103) or match_ID(eid,745) or match_ID(eid,771)) then
		local dj = math.modf(psx(eid,'内力')*0.05) + limitX(math.modf((psx(pid,'畅想分阶')-psx(eid,'畅想分阶'))*50),0,350)
		if psx(pid,'灼烧程度') > 0 then
			ztd(enemyid,'生命点数',psx(pid,'灼烧程度')*5)
		end
		if DWPD(WAR.CurID,enemyid) then		
			ztd(WAR.CurID,'生命点数',-(dj))
			ztd(WAR.CurID,WAR.ZSXS,(dj * 0.1))
		end  
 	end   
	--扫地老僧
	if match_ID(eid,114) then
        hurtjs1[#hurtjs1+1] = 0.3
        Set_Eff_Text(enemyid, "特效文字3", "天佛化生・身如净土")
	end
	--谢烟客亦正亦邪		
	if match_ID(eid,164) and JY.Person[pid]["品德"] <= 60 then
		hurtjs1[#hurtjs1+1] = 0.2
	end
	--观止
	if match_ID(eid,456) then
		if WAR.PD['遮蔽'][eid] ~= nil and WAR.PD['遮蔽'][eid] == 1 then
			ztd(enemyid,'集气位置',300)
		else
			ztd(enemyid,'集气位置',-300)
		end
		if math.random(3) < 2 then
			if WAR.PD['神教逆杀'][pid] == nil then
				WAR.PD['神教逆杀'][pid] = 10
			end	
		else
			addbuff(pid,WAR.PD['力竭'],1,2)
		end
		ztd(WAR.CurID,'生命点数', -999)
		ztd(WAR.CurID,'内力点数', -999)
		ztd(WAR.CurID,'体力点数', -9)
	end
	--点点剑典
	if match_ID(eid,457) and JLSD(10,35,eid) then
		WAR.PD['虚邪不染尘'][eid] = limitX((WAR.PD['虚邪不染尘'][eid] or 0) +1,0,9)
		ztd(enemyid,'集气位置',100)
		Set_Eff_Text(enemyid,3,'虚邪・剑步')
	end
	--陆渐三十二身相
	if match_ID(eid,497) then
		WAR.SSESS[eid] = 100
		hurtjs1[#hurtjs1+1] = 0.15
		Set_Eff_Text(enemyid, "特效文字2", "一合相护体",136)
		if JY.Base["天书数量"] > 6 then
			WAR.HZD_2 = 1
			Set_Eff_Text(enemyid, 1, "海纳百川",111)
		end
	end
	--梅长苏在场，敌方每5点冰封值减少伤害1%
    if ZDGH(enemyid,507) then
        local bfjs = JY.Person[pid]["冰封程度"]/500
        hurtjs1[#hurtjs1+1] = bfjs
		if JLSD(20,50,eid) and JY.Base["天书数量"] > 2 and WAR.SSESS[eid] ~= nil then
			hurtjs2[#hurtjs2+1] = 50
			Set_Eff_Text(enemyid, "特效文字1", "雀母相")
		end
    end
	--竹风雨滴
	if match_ID(eid,520) then
		local sp = math.modf(TrueYJ(pid) / 10)
		sp = sp + math.modf((WAR.LQZ[pid] or 0) * 0.25)
		hurtjs2[#hurtjs2+1] = 500
		local sp2 = 1 - sp / 100
		local str = "剑意"
		if fjpd(WAR.CurID) == false then
			for i = 0, WAR.PersonNum - 1 do
				if match_ID(WAR.Person[i]["人物编号"],520) and JY.Person[WAR.Person[i]["人物编号"]]["生命"] > 0 then
					local pre_target_list = {}
					local pre_target_num = 0
					local tx_1 = WAR.Person[WAR.CurID]["特效文字0"] or nil
					local tx_2 = WAR.Person[WAR.CurID]["特效文字1"] or nil
					local tx_3 = WAR.Person[WAR.CurID]["特效文字2"] or nil
					local tx_4 = WAR.Person[WAR.CurID]["特效文字3"] or nil
					local tx_5 = WAR.Person[WAR.CurID]["特效文字4"] or nil
					local tx_6 = WAR.Person[WAR.CurID]["特效动画"]
					WAR.Person[WAR.CurID]["特效文字0"] = nil
					WAR.Person[WAR.CurID]["特效文字1"] = nil
					WAR.Person[WAR.CurID]["特效文字2"] = nil
					WAR.Person[WAR.CurID]["特效文字3"] = nil
					WAR.Person[WAR.CurID]["特效文字4"] = nil
					WAR.Person[WAR.CurID]["特效动画"] = -1
					for i = 0, CC.WarWidth - 1 do
						for j = 0, CC.WarHeight - 1 do
							local pre_effect = GetWarMap(i, j, 4)
							if pre_effect > 0 then
								local pre_target = GetWarMap(i, j, 2)
								pre_target_num = pre_target_num + 1
								pre_target_list[pre_target_num] = {i, j, pre_target, pre_effect}
							end
						end
					end
					CleanWarMap(4, 0)
					str = "莫名剑法"
					local tmppid = WAR.CurID
					WAR.CurID = i
					WAR.TJFJ = 1
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 132,1, "莫名剑意・悲痛莫名", C_RED)    
					--万剑反击
					local n = 1
					for w = 1, 10 do
						if match_ID(eid,520) and JY.Person[WAR.Person[WAR.CurID]["人物编号"]]["武功" .. w] == 374 then
							n = w
						end
					end	
					War_Fight_Sub(WAR.CurID, n, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"])
					WAR.TJFJ = 0
					lib.Delay(200)
					--如果被上一步反击死亡，那么该人物的攻击就结束了
					if JY.Person[WAR.Person[tmppid]["人物编号"]]["生命"] <= 0 then
						return 1
					else		
						WAR.CurID = tmppid
						CleanWarMap(4, 0)
						WAR.Effect = 0
						for i = 1, pre_target_num do
							SetWarMap(pre_target_list[i][1], pre_target_list[i][2], 2, pre_target_list[i][3])
							SetWarMap(pre_target_list[i][1], pre_target_list[i][2], 4, pre_target_list[i][4])
						end
						WAR.Person[WAR.CurID]["特效文字0"] = tx_1
						WAR.Person[WAR.CurID]["特效文字1"] = tx_2
						WAR.Person[WAR.CurID]["特效文字2"] = tx_3
						WAR.Person[WAR.CurID]["特效文字3"] = tx_4
						WAR.Person[WAR.CurID]["特效文字4"] = tx_5
						WAR.Person[WAR.CurID]["特效动画"] =  tx_6
					end		
				end
			end    
		end	
		Set_Eff_Text(enemyid, "特效文字1","莫名剑诀・"..str)
	end
	if (match_ID(eid,520) or match_ID(eid,456)) and JY.Person[eid]["内力"] < 1000 then
		JY.Person[eid]["内力"] = 1000
	end
	--上官剑南 
    if match_ID(eid,567) then
        hurtjs1[#hurtjs1+1] = 0.1
    end
	--李沅芷在场减少伤害
	if ZDGH(enemyid,569) then
		hurtjs1[#hurtjs1+1] = 0.2
	end
	--司空摘星 相由心生降低伤害为10点
	if match_ID(eid,579) then
		WAR.PD["徐如林"][eid] = (WAR.PD["徐如林"][eid] or 0) + 2
        Set_Eff_Text(enemyid, 3, "千变万幻")
		if JLSD(15,35+JY.Base["天书数量"],eid) then
			hurtjs2[#hurtjs2+1] = 10
			Set_Eff_Text(enemyid, "特效文字0", "千变.相由心生",102)
		end
	end
	--仪琳
	if match_ID(eid,583) then
		hurtjs1[#hurtjs1+1] = 0.15
	end
	--冯衡
	if match_ID(eid,588) then
		hurtjs1[#hurtjs1+1] = 0.1
	end
	--独孤求败剑境
	if match_ID(eid,592) then
		ztd(enemyid,'集气位置',300)
		WAR.PD['独孤剑势'][eid] = (WAR.PD['独孤剑势'][eid] or 1)
		if WAR.PD['独孤剑势'][eid] ~= nil then
			local pxs = {"破掌式","破指式", "破剑式", "破刀式", "破枪式","破气式"}
			local wgtype = JY.Wugong[wugong]["武功类型"];
			WAR.PD['独孤破招'][eid] = WAR.PD['独孤破招'][eid] or -1
			--重复使用相同的武功攻击时，攻击无效
			if wgtype == WAR.PD['独孤破招'][eid] or wgtype == 6 then
				hurtjs2[#hurtjs2+1] = 0
				ang = 0;
				WAR.PD['独孤剑势'][eid] = (WAR.PD['独孤剑势'][eid] or 1) + 1;
			elseif (WAR.PD['独孤破招'][eid] == 1 and wgtype == 2) or (WAR.PD['独孤破招'][eid] == 2 and wgtype == 3) 
			or (WAR.PD['独孤破招'][eid] == 3 and wgtype == 4) or (WAR.PD['独孤破招'][eid] == 4 and wgtype == 5) 
			or (WAR.PD['独孤破招'][eid] == 5 and wgtype == 1) then
                hurtjs1[#hurtjs1+1] = WAR.PD['独孤剑势'][eid]/10
				WAR.PD['独孤剑势'][eid] = WAR.PD['独孤剑势'][eid] - 1;
			else
			    hurtjs1[#hurtjs1+1] = WAR.PD['独孤剑势'][eid]/10
				ang = 0;
				WAR.PD['独孤剑势'][eid] = WAR.PD['独孤剑势'][eid] + 1;
			end
			--brolycjw: 改变防御类型
			if wgtype > 0 and wgtype ~= 6 then 
				WAR.PD['独孤破招'][eid] = wgtype;
			end
			--连击无效，可以左右
			WAR.DLJ = 1;
			if WAR.PD['独孤剑势'][eid] <= 1 then
				WAR.PD['独孤剑势'][eid] = 1;
			end
			Set_Eff_Text(enemyid, "特效文字3", pxs[wgtype],96)
		end
	end
	--独孤求败料敌先机
	if match_ID(eid,592) then
		hurtjs2[#hurtjs2+1] = 999
		local sp = math.modf(TrueYJ(pid) / 10)
		sp = sp + math.modf((WAR.LQZ[pid] or 0) * 0.25)
		local sp2 = 1 - sp / 100
		local str = "剑境"
		if fjpd(WAR.CurID) == false then
			for i = 0, WAR.PersonNum - 1 do
				if match_ID(WAR.Person[i]["人物编号"],592) and JY.Person[WAR.Person[i]["人物编号"]]["生命"] > 0 then
					local pre_target_list = {}
					local pre_target_num = 0
					local tx_1 = WAR.Person[WAR.CurID]["特效文字0"] or nil
					local tx_2 = WAR.Person[WAR.CurID]["特效文字1"] or nil
					local tx_3 = WAR.Person[WAR.CurID]["特效文字2"] or nil
					local tx_4 = WAR.Person[WAR.CurID]["特效文字3"] or nil
					local tx_5 = WAR.Person[WAR.CurID]["特效文字4"] or nil
					local tx_6 = WAR.Person[WAR.CurID]["特效动画"]
					WAR.Person[WAR.CurID]["特效文字0"] = nil
					WAR.Person[WAR.CurID]["特效文字1"] = nil
					WAR.Person[WAR.CurID]["特效文字2"] = nil
					WAR.Person[WAR.CurID]["特效文字3"] = nil
					WAR.Person[WAR.CurID]["特效文字4"] = nil
					WAR.Person[WAR.CurID]["特效动画"] = -1
					for i = 0, CC.WarWidth - 1 do
						for j = 0, CC.WarHeight - 1 do
							local pre_effect = GetWarMap(i, j, 4)
							if pre_effect > 0 then
								local pre_target = GetWarMap(i, j, 2)
								pre_target_num = pre_target_num + 1
								pre_target_list[pre_target_num] = {i, j, pre_target, pre_effect}
							end
						end
					end
					CleanWarMap(4, 0)
					str = "独孤剑气"
					local tmppid = WAR.CurID
					WAR.CurID = i
					WAR.XTCJ = 1
					WarDrawMap(0)
					CurIDTXDH(WAR.CurID, 88,1, "料敌先机・后发先至", C_RED)    
					--九剑反击
					local n = 1
					for w = 1, 15 do
						if match_ID(eid,592) and JY.Person[WAR.Person[WAR.CurID]["人物编号"]]["武功" .. w] == 47 then
							n = w
						end
					end	
					War_Fight_Sub(WAR.CurID, n, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"])
					WAR.XTCJ = 0
					lib.Delay(200)
					--如果被上一步反击死亡，那么该人物的攻击就结束了
					if JY.Person[WAR.Person[tmppid]["人物编号"]]["生命"] <= 0 then
						return 1
					else		
						WAR.CurID = tmppid
						CleanWarMap(4, 0)
						WAR.Effect = 0
						for i = 1, pre_target_num do
							SetWarMap(pre_target_list[i][1], pre_target_list[i][2], 2, pre_target_list[i][3])
							SetWarMap(pre_target_list[i][1], pre_target_list[i][2], 4, pre_target_list[i][4])
						end
						WAR.Person[WAR.CurID]["特效文字0"] = tx_1
						WAR.Person[WAR.CurID]["特效文字1"] = tx_2
						WAR.Person[WAR.CurID]["特效文字2"] = tx_3
						WAR.Person[WAR.CurID]["特效文字3"] = tx_4
						WAR.Person[WAR.CurID]["特效文字4"] = tx_5
						WAR.Person[WAR.CurID]["特效动画"] =  tx_6
					end		
				end
			end    
		end	
		Set_Eff_Text(enemyid, "特效文字1","独孤剑意・"..str)	
	end	
	--我方赵敏在场
	if ZDGH(enemyid,609) and WAR.Miss[eid] == nil then
		--蓄力时20%减伤
		if WAR.Actup[eid] ~= nil then
			hurtjs1[#hurtjs1+1] = 0.2
		end
	end
	--花满楼
	if match_ID(eid,610) and JLSD(0,30,eid) then
		hurtjs2[#hurtjs2+1] = 0
		WAR.PD["流云飞袖"][eid] = 1
	end
	--阿九 凤凰涅
	if JXPD(eid,629,1) and (JLSD(20,70,eid) or BNJQ(eid)) then
		WAR.FGPZ[eid] = 1
		Set_Eff_Text(enemyid, 1, "凤凰涅",154)
	end
	if WAR.FGPZ[eid] ~= nil and WAR.FGPZ[eid]== 1 then  
		hurtjs2[#hurtjs2+1] = 30
	end
	--黄衫女被男性攻击减伤10%
    if match_ID(eid,640) and JY.Person[pid]["性别"] == 0 then
        hurtjs1[#hurtjs1+1] = 0.1
    end
	--鹿杖客
	if match_ID(eid,648) and  WAR.ACT == 1 and JY.Person[pid]["性别"] == 0  then
		hurtjs2[#hurtjs2+1] = 0
		Set_Eff_Text(enemyid, "特效文字0", "江南苟王",126)
	end
	--柳如絮
	if match_ID(eid,747) and JLSD(20,65,eid) then 
	    WAR.PD['柳如絮'][eid] = 1
		hurtjs2[#hurtjs2+1] = 0
		local size = 60
        local x = CC.ScreenW/2;
        local y = CC.ScreenH/2;
        local offx = (#"【纵剑万里不如身前一尺】")*size/4
        local offy = size/2
        for k = 1,10 do
            Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
            lib.Background(0,y-50,CC.ScreenW,y+50,98)
            DrawString(x-offx,y-offy,"【纵剑万里不如身前一尺】",C_GOLD,size);  
            ShowScreen();
            lib.Delay(CC.BattleDelay)
        end
	end
	--施施
	if match_ID(eid,754) then
		hurtjs2[#hurtjs2+1] = 600
	end
	--虾米六如
	if match_ID(eid,759) then
		if JLSD(10,50,eid) then
			Set_Eff_Text(enemyid, "特效文字0", "不动如山",6)	
			hurtjs2[#hurtjs2+1] = 0
		end
		if JLSD(10,50,eid) then
			Set_Eff_Text(enemyid,"特效文字2","难知如阴",6)
			WAR.DLJ = 1
			WAR.DZY = 1
			WAR.FLHS5 = 2
		end
		if JLSD(10,50,eid) then
            Set_Eff_Text(enemyid,0,"其徐如林",6)
            WAR.PD['徐如林'][eid] = limitX((WAR.PD['徐如林'][eid] or 0) + math.random(2, 3),0,50)
        end
	end
	--梵
	if (match_ID(eid,760) or match_ID(eid,771) or match_ID(eid,772) or match_ID(eid,773) or match_ID(eid,774)) and WAR.SXTJ <= 40 then
		Set_Eff_Text(enemyid, "特效文字3", "肉如磐石",36)
	end
    --斗气
	if (match_ID(eid,767) or match_ID(eid,768) or match_ID(eid,769) or match_ID(eid,770)) and WAR.SXTJ <= 20 then
		Set_Eff_Text(enemyid, "特效文字3", "秘・铜墙铁壁",36)
	end
	--马踏飞燕
	if (match_ID(eid,9736) or match_ID(eid,515)) and JLSD(0,30,eid) then
		hurtjs2[#hurtjs2+1] = 0
		Set_Eff_Text(enemyid, "特效文字2", "雕虫小技竟敢班门弄斧",126)
	end
	--凉风有信
	if match_ID(eid,9770) and JY.Person[pid]["性别"] == 1 and WAR.ACT > 1 then
		hurtjs2[#hurtjs2+1] = 0
		Set_Eff_Text(enemyid, "特效文字2", "凉风有信")
	end
	--苗若兰不受连击伤害
	if (match_ID(eid,545) or match_ID(eid,9771)) and JY.Person[pid]["性别"] == 0 and WAR.ACT > 1 then
		hurtjs2[#hurtjs2+1] = 0
		Set_Eff_Text(enemyid, "特效文字2", "望雪颦愁")
	end
	--胡夫人：冰肌玉骨减伤
	if match_ID(eid,738) or match_ID(eid,9773) then
		hurtjs1[#hurtjs1+1] = 0.5
		Set_Eff_Text(enemyid, "特效文字2", "冰肌玉骨")
	end
	--六如公子的山林阴
	if match_ID(eid,9778) then
		--local rate = limitX(math.modf(20 + (121-JY.Person[eid]["资质"])/10 + JY.Person[eid]["实战"]/50 + JY.Person[eid]["攻击力"]/50 + JY.Person[eid]["武学常识"]/10),0,100)
		local rate = 45
		local low = 10
		local rl = 0
		local rs = 0
		local ry = 0
		local times = 1
		for i = 1, times do
			if JLSD(low, rate, eid) then
				rl = 1
			end
			if JLSD(low, rate, eid) then
				rs = 1
			end
			if JLSD(low, rate, eid) then
				ry = 1
			end
		end
		--[[for i = 1, times do
			if JLSD(low, rate, eid) then
				local lr = math.random(3)
				if lr == 1 then
					rl = 1
				elseif lr == 2 then
					rs = 1
				elseif lr == 3 then
					ry = 1
				end
			end
		end]]
		--如林
		if rl == 1  then
			Set_Eff_Text(enemyid,"特效文字2","其徐如林",66)
			WAR.PD['徐如林'][eid] = limitX((WAR.PD['徐如林'][eid] or 0) + math.random(3,8),0,50)
		end
		--如山
		if rs == 1  then
			Set_Eff_Text(enemyid,"特效文字2","不动如山",9)
			hurtjs2[#hurtjs2+1] = 30
			WAR.PD['免疫杀气'][eid] = 1
		end
		--如阴
		if ry == 1 then
			Set_Eff_Text(enemyid,"特效文字2","难知如阴",61)
			WAR.DLJ = 1
			WAR.DZY = 1
			WAR.FLHS5 = 2
		end
	end
	--得意门生
	if match_ID(eid,9780) and JLSD(10,40,eid) then
		local bj=100-Person_BJ(eid)*0.5
		hurtjs1[#hurtjs1+1] = bj*0.01
		Set_Eff_Text(enemyid,"特效文字1","得意门生");
	end
	--范遥挨打加减伤，上限20%
	if (match_ID(eid,10) or match_ID(eid,9787)) and WAR.GMYS < 20 then
		WAR.GMYS = WAR.GMYS + 1
	end
	--袁紫衣每个奇门到极减少受到的5%伤害  1041
	if match_ID(eid,587) or match_ID(eid,9793) then
        local YZYQM = 0
		local YZYQM1 = 0
        for i = 1, JY.Base["武功数量"] do
            if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 5 and JY.Person[0]["武功等级" .. i] == 999 then
                YZYQM = YZYQM + 1
            end
        end
        if YZYQM > 7 then
            YZYQM = 7
        end
		YZYQM1=YZYQM*0.05
        hurtjs1[#hurtjs1+1] = YZYQM1
    end
	--元伤天怒红颜
    if (match_ID(eid,656) or match_ID(eid,9796)) and JY.Person[pid]["性别"] ~= 1 then
        hurtjs1[#hurtjs1+1] = (0.2)
    end
	--元悲红粉骷髅
    if (match_ID(eid,655) or match_ID(eid,9797)) and JY.Person[pid]["性别"] == 1 then
        hurtjs1[#hurtjs1+1] = (0.2)
    end
	--周芷若，每个内功、轻功减少受到的5%伤害
	if match_ID(eid,631) or match_ID(eid,9798) then
		local zzr = 0
		local zzr1 = 0
		for i = 1, JY.Base["武功数量"] do
			if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 6 or JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 7 then
				zzr = zzr + 1
			end
		end
		if zzr > 10 then 
			zzr = 10
		end
		zzr1 = 0.05 * zzr
		hurtjs1[#hurtjs1+1] = zzr1
	end
	--宝象减伤10%
    if match_ID(eid,595) or match_ID(eid,9809) then
        hurtjs1[#hurtjs1+1] = 0.1
    end
	--无根无形减伤
    if (match_ID(eid,5) or match_ID(eid,9821)) and JLSD(0,50,eid) then
        hurtjs1[#hurtjs1+1] = 0.3
        Set_Eff_Text(enemyid, "特效文字2", "无根无形")
    end
	--白无常
	if match_ID(eid,156) or match_ID(eid,9834) then
		local bwc=0
		bwc = math.random(25)*0.01
		hurtjs1[#hurtjs1+1] = bwc
	end
	--天山童姥 被攻击后生命
	if (match_ID(eid,117) or match_ID(eid,9869)) and JLSD(25,52,eid) then
		ztd(enemyid,'生命点数',521)
		Set_Eff_Text(enemyid,"特效文字2","韶华易逝・真情难留")
	end
	--无崖子被女性攻击减伤20%
    if (match_ID(eid,116) or match_ID(eid,9870)) and JY.Person[pid]["性别"] == 1 then
        hurtjs1[#hurtjs1+1] = 0.2
    end
	--精忠报国
	if match_ID(eid,9910) then
        if JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"]/2 then
			hurtjs1[#hurtjs1+1] = 0.2
        elseif JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"]/4 then
			hurtjs1[#hurtjs1+1] = 0.4
        end
    end
	--金轮十龙十象，受伤减半
	if match_ID(eid,9931)  then
		hurtjs1[#hurtjs1+1] = 0.5
		Set_Eff_Text(enemyid, "特效文字2", "龙象般若功.十龙十象",395)
	end
	--仁者无敌
	if match_ID(eid,9933) and JY.Person[0]["品德"] >= 100 and WAR.ACT < 4 then
		hurtjs2[#hurtjs2+1] = 0
		Set_Eff_Text(enemyid, "特效文字2", "仁者无敌")
	end
	--剑神
	if match_ID(eid,9941) then
        local YZYQM = 0
		local YZYQM1 = 0
        for i = 1, JY.Base["武功数量"] do
            if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 3 and JY.Person[0]["武功等级" .. i] == 999 then
                YZYQM = YZYQM + 1
            end
        end
        if YZYQM > 7 then
            YZYQM = 7
        end
		YZYQM1=YZYQM*0.1
        hurtjs1[#hurtjs1+1] = YZYQM1
    end
	--流云飞袖
	if match_ID(eid,9944) and JLSD(0,30,eid) then
		WAR.PD["格挡状态"][eid] = 1
		WAR.PD["流云飞袖"][eid] = 1
	end
	--浩然罡气
	if match_ID(eid,9946) and JLSD(0,50,eid) then
		hurtjs1[#hurtjs1+1] = (dng/5000)
		Set_Eff_Text(enemyid, "特效文字1", "罡气护体",90)
	end
	--乔峰，文泰来 萧秋水减伤15%，气血越少减伤越高，最多减伤35%
	if match_ID(eid,9950) or match_ID(eid,50) or match_ID(eid,151) or match_ID(eid,652) then	
		local qfjs = 1 - JY.Person[eid]["生命"] / JY.Person[eid]["生命最大值"]
		qfjs = limitX(qfjs,0.15,0.55)
		hurtjs1[#hurtjs1+1] = qfjs
	end
	--氤氲紫气
	if match_ID(eid,9966) then
		hurtjs1[#hurtjs1+1] = 0.3
	end
	--其徐如林
	if match_ID(eid,9970) and JLSD(10,50,eid) then
		Set_Eff_Text(enemyid,0,"其徐如林",6)
		WAR.PD['徐如林'][eid] = limitX((WAR.PD['徐如林'][eid] or 0) + math.random(2, 3),0,50)
	end
	--不动如山
	if match_ID(eid,9971) and JLSD(10,30,eid) then
		hurtjs2[#hurtjs2+1] = math.random(10,30)
		Set_Eff_Text(enemyid, "特效文字0", "不动如山",6)
	end
	--九剑真传70%几率减伤20%，并降低攻方下回合集气位置
    --令狐冲自带二次觉醒
	if match_ID(eid,9974) or JXPD(eid,35,2) then
		local pd = false
		if match_ID(eid,592) then 
			pd = true
		elseif JLSD(0,50,eid) then 
			pd = true
		end
		if pd == true then
			local jpwz = ""
			if JY.Wugong[wugong]["武功类型"] == 1 or JY.Wugong[wugong]["武功类型"] == 2 then
				jpwz = "九剑真传・破掌式"
			elseif JY.Wugong[wugong]["武功类型"] == 3 then
				jpwz = "九剑真传・破剑式"
			elseif JY.Wugong[wugong]["武功类型"] == 4 then
				jpwz = "九剑真传・破刀式"
			elseif JY.Wugong[wugong]["武功类型"] == 5 then
				jpwz = "九剑真传・破棍式"
			elseif JY.Wugong[wugong]["武功类型"] == 6 then
				jpwz = "九剑真传・破气式"
			end
			hurtjs1[#hurtjs1+1] = 0.2
			WAR.JJPZ[pid] = (WAR.JJPZ[pid] or 0) + 1	--九剑破招
			Set_Eff_Text(enemyid, "特效文字1", jpwz,83)
		end
	end
	--九字真言9979不动根本印降低伤害为999点
	if WAR.PD["临"][eid]~= nil and WAR.PD["临"][eid] == 1 then 
		hurtjs2[#hurtjs2+1] = 999
		Set_Eff_Text(enemyid, "特效文字1", "不动根本印")
	end
	--无妄无我
    if match_ID(eid,9980) then
		local WWWWF = JY.Base["天书数量"]
		local WWWWF1=0
		if WWWWF>15 then
			WWWWF=15
		end
		WWWWF1=WWWWF*0.01
		hurtjs1[#hurtjs1+1] = WWWWF1
	end
	--诸法无我9984每行动一次，减伤10%
    if WAR.PD["诸法无我"][eid] ~=nil and WAR.PD["诸法无我"][eid] > 0 then
        local zfjs = WAR.PD["诸法无我"][eid] / 10
        hurtjs1[#hurtjs1+1] = zfjs
    end
	--魔道天行
	if ZDGH(enemyid,9991) then
	    hurtjs1[#hurtjs1+1] = 0.1
    end
	--菩提金身
	if match_ID(eid,9995) or match_ID(eid,114) then
		if WAR.BJ == 1 or WAR.ACT > 1 then
			hurtjs1[#hurtjs1+1] = 0.5
		end
		Set_Eff_Text(enemyid, "特效文字1", "菩提金身",118)	 
		if match_ID(eid,9995) and Curr_NG(eid,108) and WAR.NGJL > 0 and JLSD(0,30,eid) then
			WAR.PD["昏迷状态"][pid] = 1
			Set_Eff_Text(enemyid,"特效文字2","金刚怒目")
		end
	end
	--主角拳系，每个拳法练到极，减少受到的5%伤害
	if actor(eid,1) then
        local lxzq = 0
        local lxzq1 = 0
        for i = 1, JY.Base["武功数量"] do
            if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 1 and JY.Person[0]["武功等级" .. i] == 999 then
                lxzq = lxzq + 1
            end
        end
        if lxzq > 7 then
            lxzq = 7
        end
        lxzq1 = 0.05 * lxzq
        hurtjs1[#hurtjs1+1] = lxzq1
    end
	--仁主免疫伤害
	if actor(eid,7) and JY.Person[eid]["品德"] >= 100 then
		if JLSD(0,psx(eid,'品德') - 40,eid) then
			hurtjs1[#hurtjs1+1] = 0.3
			Set_Eff_Text(enemyid, "特效文字1", "善恶有报")
		end	
	end
	--毒王根据自身中毒减伤
	if actor(eid,9) and JY.Person[eid]["中毒程度"] > 0 then
		jsm = jsm + JY.Person[eid]["中毒程度"]
		if JXPD(0,9,1) then
			local ns = JY.Person[eid]["中毒程度"] / 300
			hurtjs1[#hurtjs1+1] = ns
		end
	end
	--嫖主回血
	if actor(eid,10) then
		if JY.Person[pid]['性别'] == 0 then
			hurtjs1[#hurtjs1+1] = 0.2
			if JXPD(eid,10,2) then 
				hurtjs1[#hurtjs1+1] = 0.15
				if WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[enemyid]['我方'] then
					WAR.PD['强人锁男'][pid] = 1
				end
			end
		else
			ztd(enemyid,"内力点数", JY.Person[eid]['内力最大值']*0.05);	
			ztd(enemyid,"体力点数", 5);
			if JXPD(0,10,1) then
				if CC.PTF[pid] ~= nil then
					for i,v in pairs(CC.PTF[pid]) do 
						if CC.PTF[0][i] == nil then
							WAR.LSTF[eid][i] = 2
						end
					end
				end
			end
		end
	end
	--魔主
	if WAR.PD['魔之甲'][eid] == 1 then
		hurtjs1[#hurtjs1+1] = 0.999
	end
	--不在队伤害减少
	if inteam(eid) == false then	 
		local WGDJJLF = 0
		local WGDJJLF1 = 0
		for i = 1, JY.Base["武功数量"] do
			if JY.Person[eid]["武功等级" .. i] == 999 then
				WGDJJLF = WGDJJLF + 1
			end
		end
		if WGDJJLF > 15 then 
			WGDJJLF = 15
		end
		local sz = {1,0.9,0.8,0.6,0.5,0.4,0.3,0.2}
		local jssz = sz[JY.Person[eid]['畅想分阶']+1]
		--jsm = jsm + 10*JY.Base["难度"]*WGDJJLF
		WGDJJLF1 = 0.02 * WGDJJLF
		if JY.Base["难度"] == 4 then
			hurtjs1[#hurtjs1+1] = WGDJJLF1
		end
	end
	--极限挑战npc固定减伤
	if (not inteam(eid)) and JY.Person[456]["论剑奖励"] > 0 then
		jsm = jsm + JY.Base["周目"]
	end
	--畅想高资质暴怒技
	if eid == 0 and JY.Base["畅想"] > 0 and (JY.Person[0]["资质"] < 101 and JY.Person[0]["资质"] > 79) then
		if BNJQ(eid) then
			WAR.DLJ = 1
			if JLSD(20,50,eid) then
				WAR.ACT = 10
				WAR.PD['免疫杀气'][eid] = 1
			end
			Set_Eff_Text(enemyid,"特效文字2","怒气爆发・断武截式")
		end 
	end
	--畅想中资质暴怒技
	if eid == 0 and JY.Base["畅想"] > 0 and (JY.Person[0]["资质"] < 80 and JY.Person[0]["资质"] > 30) then
		if BNJQ(eid) then
			hurtjs2[#hurtjs2+1] = JY.Base["周目"]/5*4
			WAR.PD['不破防'][eid] = 1
			Set_Eff_Text(enemyid,"特效文字2","怒气爆发・固若金汤")
		end
	end
	--中庸觉醒
	if eid == 0 and (JY.Base["畅想"] > 0 or JY.Base["标准"] > 0) and (JY.Person[0]["资质"] < 80 and JY.Person[0]["资质"] > 30) and JY.Base["天书数量"] > 1 and JLSD(20,45,eid) then
		hurtjs2[#hurtjs2+1] = 200
		if JY.Person[0]["中庸"] == 3 then
			ztd(enemyid,"生命点数",200)
		end
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx = (#"【伪・鲸龟深眠沉海息】")*size/4
		local offy = size/2
		for k = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.Background(0,y-50,CC.ScreenW,y+50,98)
			DrawString(x-offx,y-offy,"【伪・鲸龟深眠沉海息】",C_GOLD,size);  
			ShowScreen();
			lib.Delay(CC.BattleDelay)
		end
	end
	--斗转妙法
	if (MuRongDZ(eid) and JY.Person[eid]["畅想分阶"] < 3) or match_ID(eid,529) or match_ID(eid,456) then
		local a = 0
		if match_ID(eid,529) then
			a = 0.5
		else
			a = math.random(4)
		end	
		hurtjs2[#hurtjs2+1] = 400*a
		if a == 1  or (match_ID(eid,529) and JLSD(0,60,eid)) then
			WAR.DLJ = 1
			WAR.DZY = 1
			Set_Eff_Text(enemyid,"特效文字0","斗转妙法・日月交替")
		elseif a == 2 or (match_ID(eid,529) and JLSD(0,60,eid)) then
			local a = Atk(WAR.CurID)
			ztd(WAR.CurID,"内力点数", -a)
			Set_Eff_Text(enemyid,"特效文字1","斗转妙法・北斗移辰")
		elseif a == 3 or (match_ID(eid,529) and JLSD(0,60,eid)) then
		    local wl = get_skill_power(pid,wugong,11)
			ztd(WAR.CurID,"生命点数",-wl)
			Set_Eff_Text(enemyid,"特效文字2","斗转妙法・陨石星浪")
		elseif a == 4  or (match_ID(eid,529) and JLSD(0,60,eid)) then
		    WAR.PD['忘情日明'][pid] = 1
			WAR.PD['参合状态'][pid] = 3
			Set_Eff_Text(enemyid,"特效文字3","斗转妙法・参商合离")
		end	
	end
	--论剑打赢扫地，减伤30%
	if match_ID(eid,0) and JY.Person[114]["论剑奖励"] == 1 then
		hurtjs1[#hurtjs1+1] = 0.3
	end
	--护体真气减伤
    if WAR.ZQHT > 0 then
	    hurtjs1[#hurtjs1+1] = 0.1
	    WAR.ZQHT = 0
    end
	--点点传授剑招
	if WAR.XTTX == 1 then
		jsm = jsm + 800
		if JLSD(20,50,eid) then
			WAR.PD['回气'][eid] = (WAR.PD['回气'][eid] or 0) + 200
			WAR.JJPZ[pid] = (WAR.JJPZ[pid] or 0) + 1
		end
		WAR.XTTX = 0
	end
	
	--圣火三使 受伤害减少、气防提高
	if WAR.ZDDH == 14 and (eid == 173 or eid == 174 or eid == 175) then
		local shz = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
			shz = shz + 1
			end
		end
		if shz == 3 then
			hurtjs1[#hurtjs1+1] = 0.5
		end
	end
	--全真七子七星聚会，每行动一次，受伤减少一10% 1041
    if eid==68 or eid==123 or eid==124 or eid==125 or eid==126 or eid==127 or eid==128 then
		local s = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and (WAR.Person[j]["人物编号"] == 68 or WAR.Person[j]["人物编号"] == 123 or WAR.Person[j]["人物编号"] == 124 or WAR.Person[j]["人物编号"] ==125 or WAR.Person[j]["人物编号"] == 126 or WAR.Person[j]["人物编号"] == 127 or WAR.Person[j]["人物编号"] == 128) then
				s = s + 0.1
			end
		end
		local ztb = WAR.QXJH / 10
		if ztb > s then
			ztb = s
		end
		hurtjs1[#hurtjs1+1] = ztb
	end
	--渔樵耕读大理四象
	if eid==119 or eid==120 or eid==121 or eid==122 then
		ztd(enemyid,'生命点数',444)
		Set_Eff_Text(enemyid, "特效文字1", "渔樵耕读",112)	
	end	
	--江南七怪
	if match_ID(eid,130) or match_ID(eid,131) or match_ID(eid,132) or match_ID(eid,133) or match_ID(eid,134) or match_ID(eid,135) or match_ID(eid,136) and hurt>0 then
		local JLQX = 0
		local effstr = "同生共死"
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
				JLQX = JLQX + 1
			end
		end
		if JLQX > 1 then
			hurtjs1[#hurtjs1+1] = 0.1*(JLQX-1)
		end
	end
	--武当七侠真武七截阵，每行动一次，受伤减少一10% 1041
	if eid==532 or eid==533 or eid==534 or eid==535 or eid==536 or eid==537 or eid==538 then
		local s = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and (WAR.Person[j]["人物编号"] == 532 or WAR.Person[j]["人物编号"] == 533 or WAR.Person[j]["人物编号"] == 534 or WAR.Person[j]["人物编号"] ==535 or WAR.Person[j]["人物编号"] == 536 or WAR.Person[j]["人物编号"] == 537 or WAR.Person[j]["人物编号"] == 538) then
				s = s + 0.1
			end
		end
		local ztb = WAR.ZWQJZ / 10
		local ztb1 = 0
		if ztb > s then
			ztb = s
		end
		hurtjs1[#hurtjs1+1] = ztb
	end
	--打狗阵
    if (WAR.ZDDH == 344 or WAR.ZDDH == 84) and WAR.Person[enemyid]["我方"] == false then
        hurtjs1[#hurtjs1+1] = 0.3
    end
	--黄蓉奇门遁甲，绿色减伤
	if WAR.Person[enemyid]["我方"] == true and GetWarMap(WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"],6) == 1 then
		hurtjs1[#hurtjs1+1] = 0.2
	end
	----------------------------------------------------------------------------------------------
	----------------------内功减伤及受击效果-------------------------------------------------------
	----------------------------------------------------------------------------------------------
	--纯阳无极功，男性减伤20%
	if Curr_NG(eid,99) and JY.Person[eid]['性别'] == 0 then
		hurtjs1[#hurtjs1+1] = 0.2
	end
	--无酒不欢：八荒六合功
	if (PersonKF(eid,101) and JLSD(40,60,eid)) or (Curr_NG(eid,101) and JLSD(20,80,eid)) or WAR.NGHT == 101 then
		local reduction = math.modf(zshurt/2)
		jsm = jsm + reduction
		ztd(enemyid,"内力点数",reduction/2)
		local bhwz;
		if math.random(2) == 1 then
			bhwz = "八荒六合.唯我独尊"
		else
			bhwz = "唯我独尊.八荒六合"
		end
		Set_Eff_Text(enemyid, "特效文字3", bhwz)
	end
	--太玄之轻40%几率
	if Curr_NG(eid,102) and JLSD(20,60,eid) and match_ID(eid,40) == false then
		WAR.TXZQ[eid] = 1
	end
	--龙象减伤10%
    if Curr_NG(eid,103) then
        hurtjs1[#hurtjs1+1] = 0.1
    end
	--无酒不欢：葵花移行、萧半和觉醒
	if Curr_NG(eid,105) then
		--葵花尊者必定移形
		local khzz = 0
		if JLSD(20,50,eid) or match_ID(pid,92) or match_ID(eid,27) or match_ID(eid,777) or match_ID(eid,511) then
			hurtjs1[#hurtjs1+1] = 0.3
			ang = math.modf(ang*0.7)
			Set_Eff_Text(enemyid, 2, "葵花移形",51)
		end
	end
	--阳内主运或者阳罡学会九阳后，主运减伤30%，被动减伤10%
    if PersonKF(eid,106) and rwnlxz(eid,1) then
        if Curr_NG(eid,106) then
            hurtjs1[#hurtjs1+1] = 0.3
        else
            hurtjs1[#hurtjs1+1] = 0.15
        end
    end
	--九阳神功105
	if WAR.PD['氤氲紫气'][eid] == 1 then
		if hurt > 1999 then
			jsm = jsm + 1999
		else
			jsm = jsm + 999
	    end
    end
	--学会九阴并且是阴内或者天罡，减伤10%
    if PersonKF(eid,107) and rwnlxz(eid,1) then
        hurtjs1[#hurtjs1+1] = 0.1
    end
	--同时学有易筋神功+金刚不坏体，主运易筋神功必出“金钟罩护”特效
    --天佛降世/鳌拜主运 必出金刚不坏  
    if (Curr_NG(eid,144) and (JLSD(30,90,eid) or match_ID(eid,603))) or match_ID(eid,9986) or (match_ID(eid,0) and CC.TX['少林掌院选择'] == 1) then
		hurtjs1[#hurtjs1+1] = 0.3
		ang = math.modf(ang *0.7)
		if JLSD(10,35,eid) and (QFZH(eid,22,144) or QFZH(eid,135,144)) then
			Cat('清除高级异常',enemyid)
			Cat('清除中级异常',enemyid)
			Set_Eff_Text(enemyid,0,'金刚四正・自在观空')
		else
			Set_Eff_Text(enemyid, "特效文字0","金刚不坏")
		end	
	elseif PersonKF(eid,144) and (JLSD(30,65,eid) or Curr_NG(eid,108)) then
		hurtjs1[#hurtjs1+1] = 0.2
		ang = math.modf(ang*0.8)
		if JLSD(10,35,eid) and (QFZH(eid,22,144) or QFZH(eid,135,144)) then
			Cat('清除中级异常',enemyid)
			Set_Eff_Text(enemyid,0,'金刚四正・自在观空')
		else
			Set_Eff_Text(enemyid, "特效文字0","金钟罩护体")
		end
	end
	--忘情天书・土掩
	if (match_ID(eid,652) or Curr_NG(eid,177)) and JLSD(0, 35,eid) and JY.Base["天书数量"] > 3 then
		hurtjs2[#hurtjs2+1] = 320
		Set_Eff_Text(enemyid, "特效文字3", "土掩",63)
		if NGQH(eid,177) then
			local heal = math.modf((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"]) * 0.07)
			ztd(enemyid,"生命点数",heal)
		    Set_Eff_Text(enemyid, "特效文字3", "完璧",139)
		end
	end
	--九霄中华
	if NGQH(eid,184) then
		local yj = math.modf(TrueYJ(eid)/2)
		jsm = jsm + yj
		ztd(enemyid,"生命点数",yj)
	end
	--铁布衫
	if PersonKF(eid,196) then
		if Curr_NG(eid,196) then
			jsm = jsm + 1000
		else
			jsm = jsm + 500
	    end
	end
	--长生诀
    if Curr_NG(eid,203) and JLSD(0,25,eid) then
		if WAR.PD['长生诀'][eid] == nil then
			WAR.PD['长生诀'][eid] = 10
			Set_Eff_Text(enemyid, "特效文字0", "顾道长生")
		end
    end
	--擒龙功
	if PersonKF(eid,204) then
		hurtjs1[#hurtjs1+1] = 0.2
	end
	--少林心法
	if PersonKF(eid,208) then
		jsm = jsm + 200
	end
	--武当心法
	if PersonKF(eid,209) then
		hurtjs1[#hurtjs1+1]= 0.25
	end
	--寒冰真气・冰盾
	if PersonKF(eid,216) and rwnlxz(eid,0) then
		local m = 100
		if JLSD(10,40,eid) then
			m= m + math.random(100,180)		
			jsm = jsm + m * 3
			Set_Eff_Text(enemyid, 3, "冰盾.冰之墙",135)
		else
			jsm = jsm + m
		end	
	end
	--阴阳无极功
	if PersonKF(eid,221) then
		local a = 0.25
		local b = 1000
		local c = 0.35
		if Curr_NG(eid,221) then
			if rwnlxz(eid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				hurtjs1[#hurtjs1+1] = c
			else
				jsm = jsm + b
				hurtjs1[#hurtjs1+1] = c
			end
		elseif JLSD(10,55,eid) then
			if rwnlxz(eid) < 3 and rwnlxz(pid) ~= rwnlxz(eid) then
				hurtjs1[#hurtjs1+1] = a
			else
				jsm = jsm + b
				hurtjs1[#hurtjs1+1] = a
			end
		end		
	end
	--小周天减伤15%
    if PersonKF(eid,225) then
		if Curr_NG(eid,225) then
			hurtjs1[#hurtjs1+1] = 0.15
		else
			hurtjs1[#hurtjs1+1] = 0.05	
		end
	end
	--龟息功
	if PersonKF(eid,227) then
		local gl = 25 
		local bl = limitX(JY.Person[eid]['生命']/JY.Person[eid]['生命最大值'],0.25,1)
		local gl2 = math.modf((1-bl)*100)
		if JLSD(0,gl+gl2,eid) and WAR.Defup[eid] == nil then 
			WAR.Defup[eid] = 1
		end
		if WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0 then
			ztd(WAR.CurID,"内伤点数",15)
		end
	end
	--神足经减伤 
    if PersonKF(eid,233) then
		local KS=JY.Person[eid]["生命增长"] * 0.02
		hurtjs1[#hurtjs1+1] = KS	
	end
	--蜉蝣功
	if Curr_NG(eid,238) then
		if WAR.Person[enemyid].Time > 0 then
			local bl = WAR.Person[enemyid].Time/2000
			hurtjs1[#hurtjs1+1] = bl
		else
			hurtjs2[#hurtjs2+1] = 0
		end
	end
	--武当九阳功减伤10%
    if PersonKF(eid,241) then
        hurtjs1[#hurtjs1+1] = 0.1
    end
	--奇门遁甲
	if PersonKF(eid,251) and JLSD(25,55,eid) then
		WAR.PD['奇门五转'][eid] = math.modf((WAR.PD['奇门五转'][eid] or 0) + math.modf(hurt/3))
		if WAR.Person[enemyid]['护盾'] == nil or WAR.Person[enemyid]['护盾'] <=0 then
			WAR.Person[enemyid]['护盾'] = 10
		end
	end
	--磐石法诀
	if Curr_NG(eid,264) and JLSD(10,40,eid) then
		hurtjs1[#hurtjs1+1] = 0.1
		ztd(WAR.CurID,"内伤点数",10)
		Set_Eff_Text(enemyid, "特效文字3", "磐石法・反震")
	end
	--苍龙令防御
	if PersonKF(eid,281) then
		local a = math.random(1,3)
		local str = ""
		if a == 1 then
			str = "难知如阴】"
			WAR.DLJ = 1
			WAR.DZY = 1
			WAR.FLHS5 = 2
		elseif a == 2 then
			str = "其徐如林】"
			WAR.PD['徐如林'][eid] = limitX((WAR.PD['徐如林'][eid] or 0) + math.random(5,10),0,60)
		elseif a == 3 then
			str = "不动如山】"
			hurtjs2[#hurtjs2+1] = 30
			WAR.PD['免疫杀气'][eid] = 1
		end
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx1 = (#"【苍龙心诀・")*size/4
		local offx2 = (#str)*size/4
		local offx = offx1 + offx2
		local offy = size/2
		for k = 1,10 do
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.Background(0,y-50,CC.ScreenW,y+50,98)
			DrawString(x-offx,y-offy,"【苍龙心诀・"..str,C_GOLD,size);  
			ShowScreen();
			lib.Delay(CC.BattleDelay)
		end
	end
	--苍龙心法防御
	if (PersonKF(eid,282) and inteam(eid) and WAR.CLXF == 1) or match_ID(eid,754) then
	    local a = math.random(1,3)
	    local str = ""
	    if a == 1 then
		    str = "难知如阴】"
		    ztd(enemyid,'生命点数',math.random(500,1000))
		    ztd(enemyid,'内力点数',math.random(1000,2000))
		    ztd(enemyid,'体力点数',math.random(3,5))
	    elseif  a == 2 then
	        str = "其徐如林】"
		    local n = math.random(1,3)
		    if n == 1 then
			    WAR.PD['昏迷状态'][pid] = 1
			    WAR.PD['麻痹状态'][pid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(2)
		    elseif n == 2 then				    
				WAR.PD['混乱状态'][pid] = 1
				WAR.PD['同归状态'][pid] = 1
		    elseif n == 3 then
			    WAR.PD['恐惧状态'][pid] = 1
				WAR.PD['放下屠刀'][pid] = 2
		    end
	    elseif  a == 3 then
	        str = "不动如山】"
		    hurtjs2[#hurtjs2+1] = 30
		    WAR.DLJ = 1
	    end
	    local size = 60
        local x = CC.ScreenW/2;
	    local y = CC.ScreenH/2;
	    local offx1 = (#"【苍龙心法・")*size/4
	    local offx2 = (#str)*size/4
        local offx = offx1 + offx2
        local offy = size/2
	    for k = 1,10 do
		    Cat('实时特效动画')
		    Cls()
		    Cat('实时特效动画2')
		    lib.Background(0,y-50,CC.ScreenW,y+50,98)
		    DrawString(x-offx,y-offy,"【苍龙心法・"..str,C_GOLD,size);  
		    ShowScreen();
		    lib.Delay(CC.BattleDelay)
	    end
	end
	--鲸息九阴
	if NGQH(eid,180) then
	    local a = math.random(1,4)
	    local str = ""
	    if a == 1 then
		    str = "山】"
		    ztd(enemyid,'生命点数',1500)
		    ztd(enemyid,'内力点数',3000)
		    ztd(enemyid,'体力点数',8)
	    elseif  a == 2 then
	        str = "风】"
		    local n = math.random(1,3)
		    if n == 1 then
			    WAR.PD['昏迷状态'][pid] = 1
			    WAR.PD['麻痹状态'][pid] = (WAR.PD['麻痹状态'][eid] or 0) + math.random(2)
		    elseif n == 2 then				    
				WAR.PD['混乱状态'][pid] = 1
				WAR.PD['同归状态'][pid] = 1
		    elseif n == 3 then
			    WAR.PD['恐惧状态'][pid] = 1
				WAR.PD['放下屠刀'][pid] = 2
		    end
	    elseif  a == 3 then
	        str = "地】"
		    hurtjs2[#hurtjs2+1] = 10
		elseif  a == 4 then 	
		    str = "天】"
		    WAR.DLJ = 1
			WAR.DZY = 1
	    end
	    local size = 60
        local x = CC.ScreenW/2;
	    local y = CC.ScreenH/2;
	    local offx1 = (#"【周流八劲・")*size/4
	    local offx2 = (#str)*size/4
        local offx = offx1 + offx2
        local offy = size/2
	    for k = 1,10 do
		    Cat('实时特效动画')
		    Cls()
		    Cat('实时特效动画2')
		    lib.Background(0,y-50,CC.ScreenW,y+50,98)
		    DrawString(x-offx,y-offy,"【周流八劲・"..str,M_DeepSkyBlue,size);  
		    ShowScreen();
		    lib.Delay(CC.BattleDelay)
	    end
	end
	--奇门五转
	if Curr_NG(eid,317) and WAR.QMWZ < 1 and JLSD(10,15,eid) then
		Set_Eff_Text(enemyid, "特效文字2", "奇门五转.南火",95)
		hurtjs1[#hurtjs1+1] = 0.5
		WAR.PD['奇门五转'][eid] = math.modf((WAR.PD['奇门五转'][eid] or 0) + hurt)
		if MPTX(eid,10) and JLSD(0,50,eid) then
			WAR.QMWZ = 0
		else
			WAR.QMWZ=WAR.QMWZ+1
		end
	end
	----------------------------------------------------------------------------------------------
	----------------------轻功减伤及受击效果-------------------------------------------------------
	----------------------------------------------------------------------------------------------
	--飞天神行减伤
	if Curr_QG(eid,145) then
		if QGQH(eid,145,2) then
			hurtjs1[#hurtjs1+1] = 0.6
			WAR.PD["飞天步1"][eid] = math.random(3)
		elseif	QGQH(eid,145,1) then	
			hurtjs1[#hurtjs1+1] = 0.4
		end
		if TFQG(eid,145) and JLSD(10,75,eid) then
			WAR.PD["飞天步"][eid] = 1
		end	
		if match_ID(eid,3) then
			ztd(WAR.CurID,WAR.ZSXS,20)
		end
		if match_ID(eid,633) or match_ID(eid,1) then
			ztd(WAR.CurID,WAR.BFXS,20)
		end
		if match_ID(eid,587) then
			hurtjs1[#hurtjs1+1] =  math.modf(TrueTS(eid)/1000)
			if JY.Wugong[wugong]["武功类型"] == 2 then
				WAR.PD['闪避'][eid] = 1
				Set_Eff_Text(enemyid, "特效文字2", "紫衣银鞭・闪")
			end	
		end
		Set_Eff_Text(enemyid, "特效文字2", "飞天神行减伤",113)
	end
	if WAR.PD["飞天步1"][eid] ~= nil and math.random(10) > 5 then
		jsm = jsm + math.modf(JY.Person[eid]["轻功"]/(WAR.PD["飞天步1"][eid] or 1))
		WAR.PD["飞天步1"][eid] = nil
	end
	--无酒不欢：袁承志神行百变减伤
	if Curr_QG(eid,146) and match_ID(eid,54) and WAR.Miss[eid] == nil then
		local c_up = 0
		--袁承志觉醒后，减伤
		if JXPD(eid,54,1) then
			c_up = 10
		end
		if JLSD(20,65+c_up,eid) then
			hurtjs1[#hurtjs1+1] = 0.3
			ang = math.modf(ang *0.7)
			Set_Eff_Text(enemyid, "特效文字2", "攀云乘龙",51)
		end   
	end
	--无酒不欢：凌波微步，
	if Curr_QG(eid,147) then
		local wyjs = 0 --o崖子的凌波减伤
		if (JLSD(30,60,eid) or match_ID(eid,117) or match_ID(eid,634)) and WAR.PD['凌波微步闪避'][eid] == nil then
			WAR.PD['凌波微步闪避'][eid] = 5
			if match_ID(eid,117) or match_ID(eid,634) then
				ztd(enemyid,"生命点数",math.random(300,800))
			end
		elseif JLSD(30,60,eid) then	
			if JY.Person[eid]["天赋轻功"] == JY.Person[eid]["主运轻功"] then
				hurtjs1[#hurtjs1+1] = 0.5
				ang = math.modf(ang *0.3)
			else
				hurtjs1[#hurtjs1+1] = 0.4
				ang = math.modf(ang *0.6)
			end
			wyjs = 1
			Set_Eff_Text(enemyid, "特效文字2", "凌波微步减伤",51)
		end	
		if wyjs == 1 then
			if match_ID(eid,116) then
				if math.random(10) > 6 then
					local aa = math.modf(JY.Person[eid]["内力"]*0.2)
					ztd(enemyid,'内力点数',-aa)
					jsm = jsm + aa
				end
			end
			if match_ID(eid,634) then
				if math.random(10) > 6 then
					local aa = math.modf(JY.Person[eid]["内力"]*0.2)
					ztd(enemyid,'内力点数',-aa)
					hurtjs1[#hurtjs1+1] = 0.9
				end
			end
			wyjs = 0
		end
	end
	--君子风
	if Curr_QG(eid,262) then
		local dd = psx(eid,"品德")
		if TFQG(eid,262) then
			dd = dd * 2
		end
		if JLSD(20,dd,eid) then
			for j = 0, WAR.PersonNum-1 do
				if DWPD(j,enemyid) == false then
					ztd(j,"生命点数",dd * 3)
					ztd(j,"内力点数",dd * 5)
				end
			end	
			Set_Eff_Text(enemyid, "特效文字1", "君子齐家")
		end
		if QGQH(eid,262,1) then
			if JLSD(20,dd,eid) then
				local a = psx(eid,"实战")*0.001 + psx(eid,"品德")/600
				hurtjs1[#hurtjs1+1] = a
				Set_Eff_Text(enemyid, "特效文字1", "君子修身")
			end	
		end	
	end
	--瞬息千里高阶效果
	if QGQH(eid,150,2) then
		local ns = math.modf(JY.Person[eid]["受伤程度"] / 5)
		if JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"] * 0.2 then
			ns = ns + 5
		end	
		if WAR.Person[enemyid].TimeAdd < 0 and JLSD(0,5+ns,eid) then --
			WAR.DLJ = 1
			WAR.DZY = 1
			WAR.PD['瞬息千里'][eid] = 1
		end	
	end	
	--一苇渡江高阶效果
	if QGQH(eid,186,2) and JY.Person[eid]["封穴程度"] > 0 then
		local aa = JY.Person[eid]["封穴程度"]
		if JLSD(0,math.modf(aa/2),eid) then
			WAR.PD['闪避'][eid] = 1
			Set_Eff_Text(enemyid, "特效文字2", "一苇渡江・空如我相")
		end
	end
	--龙行虎步
	if QGQH(eid,280,1) then
		local a = (WAR.SPIRIT[eid] or 0)
		hurtjs1[#hurtjs1+1] = (a*0.005)
		Set_Eff_Text(enemyid, "特效文字3", "天子身")
	end
	--花间游天轻
	if TFQG(eid,286) then
		local num = 0
		num = WAR.ACT
		local num1,num2 = math.modf(num/2)
		if (num2 == 0) then
		else
			hurtjs2[#hurtjs2+1] = 0
			ztd(enemyid,'集气位置',200)
			Set_Eff_Text(enemyid, "特效文字2", "养生聚气")
		end
	end
	--摘星功
	if Curr_QG(eid,296) then
		local jl = math.modf(psx(eid,"用毒能力")*0.1)
		if JLSD(10,jl+math.random(5,10),eid) then
			ztd(WAR.CurID,"中毒点数",math.random(10,20))
			WAR.PD['基础蛊毒'][pid] = 1
			Set_Eff_Text(enemyid,1,"星罗毒步")
		end
		if MPTX(eid,1) and JY.Person[eid]["中毒程度"] >= 100 then
			local zdjl = math.modf((JY.Person[eid]["中毒程度"]-100)*0.1)
			if JLSD(0,zdjl+15,eid) then
				WAR.PD['闪避'][eid] = 1
				Set_Eff_Text(enemyid,2,"毒影幢幢")
			end
		end	
		if match_ID(eid,47) and JLSD(10,jl,eid) then
			WAR.PD['刺目'][pid] = 2
		end	
		jsm = jsm + math.modf((psx(pid,"中毒程度")+psx(eid,"中毒程度"))*jl*0.1)
	end
	--风吟步
	if Curr_QG(eid,300) then
		if QGQH(eid,300,1) then
			local jl = math.modf(Qg(enemyid)*0.01*(WAR.SPIRIT[eid] or 0)*0.03)
			if jl > 80 then jl = 80 end
			if JLSD(10,jl,eid) then
				hurtjs1[#hurtjs1+1] = 0.8
				WAR.PD['时序闪避'][eid] = (WAR.PD['时序闪避'][eid] or 0) + 20
				Set_Eff_Text(enemyid,2,'风吟・风无形')
			end
		end
		if QGQH(eid,300,2) and JLSD(10,45,eid) then
			local jqz = math.modf(Qg(enemyid)*0.25)
			ztd(enemyid,'集气位置',jqz)
			Set_Eff_Text(enemyid,3,'风吟・乘风起')
		end	
	end	
	----------------------------------------------------------------------------------------------
	----------------------内功被动组合减伤及受击效果------------------------------------------------
	----------------------------------------------------------------------------------------------
	--罗汉周天
	if NGQHB(eid,96) then
		jsm = jsm + 400
		WAR.PD['集气速度'][eid] = (WAR.PD['集气速度'][eid] or 0) + 6
	end
	--鲸龟二息
	if NGQHB(eid,180) and JLSD(10,40,eid) then
		hurtjs2[#hurtjs2+1] = 100
		ztd(enemyid,"生命点数",500)
		ztd(enemyid,"内力点数",500)
		ztd(enemyid,"体力点数",5)
		local size = 60
		local x = CC.ScreenW/2;
		local y = CC.ScreenH/2;
		local offx = (#"【鲸龟深眠沉海息】")*size/4
		local offy = size/2
		for k = 1,10 do
            Cat('实时特效动画')
            Cls()
            Cat('实时特效动画2')
            lib.Background(0,y-50,CC.ScreenW,y+50,98)
            DrawString(x-offx,y-offy,"【鲸龟深眠沉海息】",C_GOLD,size);  
            ShowScreen();
            lib.Delay(CC.BattleDelay)
        end
	end
	--天魔吸星
	if PersonKF(eid,160) and PersonKF(eid,88) then
		local m = 0
		if WAR.PD['暴走状态'][eid]~=nil then
			m = WAR.PD['暴走状态'][eid]
			jsm = jsm + m
			--WAR.Person[enemyid]["特效动画"] = 190
			--Set_Eff_Text(enemyid, 3, "种魔・格挡")
		end
	end
	--龟息周天
	if NGQHB(eid,190) then
		--每降低1%生命，减伤增加1%
		if JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"] then 
			local n = 1 - (JY.Person[eid]["生命"]/JY.Person[eid]["生命最大值"])
			hurtjs1[#hurtjs1+1] = n
		end
		if JY.Person[eid]["封穴程度"] > 0 then
			ztd(enemyid,WAR.FXXS,-5)
		end
		if JLSD(10,35,eid) then 
			local a = math.modf(JY.Person[eid]["防御力"]/10)
			local b = math.modf(JY.Person[pid]["攻击力"]/10)
			local c = (a+b) 
			ztd(WAR.CurID,"内力点数",-c);
			ztd(WAR.CurID,"生命点数",-c);
			ztd(WAR.CurID,WAR.FXXS,5);
			Set_Eff_Text(enemyid, "特效文字0", "玄武反震")
		end
	end
	--十三太保横练 标记修改
	if NGQHB(eid,196) then
		WAR.PD['不破防'][eid] = 1
		hurtjs1[#hurtjs1+1] = 0.13 
	end
	--枯禅冰火
	if NGQHB(eid,207) and JLSD(35,70,eid) then
		ztd(enemyid,'内力点数',-600)
		hurtjs1[#hurtjs1+1] = 0.6
		jsm = jsm + 600
		if MPTX(eid,15) then
			if WAR.PD["转龙呼吸"][eid] == nil then
				WAR.PD["转龙呼吸"][eid] = 1
			end
		end
		Set_Eff_Text(enemyid, "特效文字3", "枯禅真诀・气护心脉")
	end
	--小星辰法
	if NGQHB(eid,219) then
		local n = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['死亡'] == false then
				n = n + 0.05
			end
		end
		if n > 0.8 then n = 0.8 end
		hurtjs1[#hurtjs1+1] = n
		Set_Eff_Text(enemyid, 1, "群星之力・星曜")
	end
	--龙啸混元
	if NGQHB(eid,369) then
		if psxper(enemyid,'生命',0.4,2) then
			WAR.GXHM[eid] = 20
			jsm = jsm + JY.Person[eid]["生命最大值"]
			Set_Eff_Text(enemyid, "特效文字3", "龙啸九天・龙吟")
		else
			hurtjs1[#hurtjs1+1] = 0.9
			Set_Eff_Text(enemyid, "特效文字2", "龙啸九天・龙甲",61)
		end
		if JLSD(20,50,eid) then
			WAR.DLJ = 1
			WAR.DZY = 1
			if WAR.PD['枪神诀2'][pid] == nil then
				WAR.PD['枪神诀2'][pid] = 8
			end
			Set_Eff_Text(enemyid,"特效文字2","龙啸九天・龙息")
		end
		--龙啸混元
		if JLSD(20,50,eid) then 
			if WAR.PD['武当纯阳'][pid] == nil then
				WAR.PD['武当纯阳'][pid] = 1
			end
			if WAR.PD['封印'][pid] == nil then
				WAR.PD['封印'][pid] = 5
			end
			Set_Eff_Text(enemyid,"特效文字2","龙啸九天・龙鸣")
		end  	
		--龙啸混元
		if JLSD(20,50,eid) then 
			WAR.PD['龙啸九天'][pid] = 20
			Set_Eff_Text(enemyid,"特效文字2","龙啸九天・龙王")
		end	
	end
	
	----------------------------------------------------------------------------------------------
	----------------------内功主运组合减伤及受击效果------------------------------------------------
	----------------------------------------------------------------------------------------------
	--蛤蟆逆运
	if NGQH(eid,95) then
		hurtjs1[#hurtjs1+1]= 0.5
		local a = math.random(3)
		local b = JY
		local c = math.modf(hurt/9)
		local str = ""
		if (WAR.HMJT[eid] or 0) > 0 and (WAR.HMJT[eid] or 0) ~= nil then
			jsm = jsm + WAR.HMJT[eid]
			WAR.HMJT[eid] = (WAR.HMJT[eid] or 0) - c
			if WAR.HMJT[eid] < 100 then 
				WAR.HMJT[eid] = 100
			end
			addbuff(pid,WAR.PD['回气'],c)
			Set_Eff_Text(enemyid,"特效文字2","气吞山河・御")	
		end
		for j = 0, WAR.PersonNum -1 do 
			local df = WAR.Person[j]["人物编号"] 
			local offset1 = math.abs(WAR.Person[enemyid]["坐标X"] - WAR.Person[j]["坐标X"]) 
			local offset2 = math.abs(WAR.Person[enemyid]["坐标Y"] - WAR.Person[j]["坐标Y"])	
			if WAR.Person[j]["我方"] ~= WAR.Person[enemyid]["我方"] and WAR.Person[j]["死亡"] == false and offset1 <= 8 and offset2 <= 8 then
				if a == 1 then 
					ztd(j,"中毒点数",50)
					WAR.PD['中毒不解'][df] = 10
					str = "毒蟾・毒"
				elseif a == 2 then 
					ztd(j,WAR.ZSXS,50)
					WAR.PD['焚炎不尽'][df] = 10
					str = "火蟾・火"
				elseif a == 3 then
					ztd(j,WAR.BFXS,50)
					WAR.PD['玄冰不化'][df] = 10
					str = "冰蟾・冰"
				end
			end
		end
		Set_Eff_Text(enemyid,"特效文字3",str)	
	end
	--乾坤反弹强化
	if NGQH(eid,97) and PersonKF(eid,97) and inteam(eid) then
		if JY.Person[pid]["内力"] < JY.Person[eid]["内力"] then
			WAR.PD['明尊白莲'][eid] = 1
		end
	end
	--乾坤龟息
	if NGQH(eid,97) then
		hurtjs1[#hurtjs1+1] = 0.5
		local str = ""
		if JLSD(20,50,eid) then
			str = "・天地无情"
			local ft = get_skill_power(pid,wugong,11)
			for j = 0, WAR.PersonNum - 1 do
				if dead(j) == false and DWPD(j,enemyid) then
					ztd(j,'生命点数',-ft)
				end
			end
		end
		if JLSD(20,50,eid) then
			str = "・无相天音"
			local d = 0
			for j = 0, WAR.PersonNum - 1 do
				if dead(j) == false and DWPD(j,enemyid) then
					d = d + 1
				end
			end
			ztd(enemyid,"生命点数",200*d)
			ztd(enemyid,"内力点数",400*d)
			ztd(enemyid,"体力点数",2*d)
		end
		if JLSD(20,50,eid) then
			str = "・乾坤易理"
			for j = 0, WAR.PersonNum - 1 do
				if dead(j) == false then
					if DWPD(j,enemyid) then
						ztd(j,"内伤点数",10)
						ztd(j,WAR.BFXS,10)
						ztd(j,WAR.ZSXS,10)
						ztd(j,"中毒点数",10)
						ztd(j,WAR.FXXS,5)
						ztd(j,WAR.LXXS,10)
					else
						ztd(j,"内伤点数",-20)
						ztd(j,WAR.BFXS,-20)
						ztd(j,WAR.ZSXS,-20)
						ztd(j,"中毒点数",-20)
						ztd(j,WAR.FXXS,-10)
						ztd(j,WAR.LXXS,-20)
					end
				end
			end
		end
		Set_Eff_Text(enemyid,"特效文字3","明尊白莲"..str)	
	end
	--纯阳太极
	if NGQH(eid,99) then
		if JLSD(0,30,eid) then
			WAR.CYAY = 1
			Set_Eff_Text(enemyid,"特效文字2", "纯阳奥义・万物无极")
		end
		if rwnlxz(eid,1) then
			hurtjs1[#hurtjs1+1] = 0.5
		end
	end
	--先天神照
	if NGQH(eid,100) then
		if psxper(enemyid,'生命',0.5,2) then
		   hurtjs1[#hurtjs1+1] = 0.5
		end
		if WAR.PD['先天护盾'][eid] ~= nil and WAR.PD['先天护盾'][eid] > 0 then
			jsm = jsm + WAR.PD['先天护盾'][eid] 
			local aa = JY.Person[eid]["生命最大值"]
			local bb = JY.Person[eid]["生命"]
			local cc = limitX(math.modf((aa-bb)/5-WAR.PD['先天护盾'][eid]),500,2000)
			ztd(enemyid,"生命点数",500)
			ztd(enemyid,"内力点数",-cc)
		end
		if JLSD(30,60,eid) then
			local aa = JY.Person[pid]["生命最大值"]
			local bb = JY.Person[pid]["生命"]
			local cc =  limitX(math.modf((aa-bb)/5),500,2000)
			ztd(enemyid,"内力点数",cc)
			ztd(enemyid,"内伤点数",-100)
			Set_Eff_Text(enemyid,"特效文字3","腾云驾雾")
		end
		if JLSD(30,60,eid) then
			local aa = JY.Person[eid]["内力最大值"]
			local bb = JY.Person[eid]["内力"]
			local cc =  limitX(math.modf((aa-bb)/6),500,2000)
			ztd(enemyid,"生命点数",cc)
			ztd(enemyid,WAR.LXXS,-100)
			Set_Eff_Text(enemyid,"特效文字2","气通百会")
		end
	end
	--八荒北冥
	if NGQH(eid,101) then
		local xnl = (JY.Person[pid]["内力"]+JY.Person[eid]["内力"])/38
		ztd(WAR.CurID,"生命点数",-math.modf(xnl))
		local a = math.modf((ang+1000)/800)
		if a > 10 then 
			a = 10 
		elseif a < 1 then
			a = 1
		end   
		hurtjs1[#hurtjs1+1] = a*0.1
		Set_Eff_Text(enemyid,"特效文字3","唯我独尊")
	end
	--太玄乾坤
	if NGQH(eid,102) then
		local jl = math.modf(JY.Person[eid]["实战"]/50)
		if JLSD(10,45+jl,eid) then
			WAR.PD["太玄组合防御1"][eid] = 1
			Set_Eff_Text(enemyid,"特效文字0","纵死侠骨香 不惭世上英")
		end
		if JLSD(10,45+jl,eid) or WAR.PD["太玄组合防御1"][eid] ~= nil then	
			local aa = JY.Person[eid]["受伤程度"] or 0
			local bb = JY.Person[eid]["中毒程度"] or 0
			local cc = JY.Person[eid]["冰封程度"] or 0
			local dd = JY.Person[eid]["灼烧程度"] or 0
			local ee = JY.Person[eid]["流血程度"] or 0
			local ff = JY.Person[eid]["封穴程度"] or 0
			local hh = aa+bb+cc+dd+ee+ff
			if hh < 50 then hh = 50 end
				jsm = jsm + (hh*10)
				ztd(enemyid,"内力点数",-500)
				if JLSD(10,45,eid) then
					ztd(enemyid,"内伤点数",-JY.Person[eid]["受伤程度"])
					ztd(enemyid,"中毒点数",-JY.Person[eid]["中毒程度"])
					ztd(enemyid,WAR.BFXS,-JY.Person[eid]["冰封程度"])
					ztd(enemyid,WAR.ZSXS,-JY.Person[eid]["灼烧程度"])
					ztd(enemyid,WAR.LXXS,-JY.Person[eid]["流血程度"])
					ztd(enemyid,WAR.FXXS,-JY.Person[eid]["封穴程度"])
				end
			Set_Eff_Text(enemyid,"特效文字2","千秋二壮士 @赫大梁城")
		end
		if JLSD(10,45+jl,eid) or WAR.PD["太玄组合防御1"][eid] ~= nil then
			addbuff(eid,WAR.PD['时序闪避'],10)
			ztd(enemyid,"内力点数",500)
			Set_Eff_Text(enemyid,"特效文字1","眼花耳热后 意气素霓生")
		end	
		if JLSD(10,45+jl,eid) or WAR.PD["太玄组合防御1"][eid] ~= nil then
			WAR.PD["太玄组合防御2"][eid] = 1
			ztd(enemyid,"生命点数",200)
			Set_Eff_Text(enemyid,"特效文字3","将炙啖朱亥 持觞劝侯嬴")
		end
		if JLSD(10,45+jl,eid) or WAR.PD["太玄组合防御1"][eid] ~= nil then
			for txjq = 0, WAR.PersonNum-1 do 
				if WAR.Person[txjq]["我方"] ~= WAR.Person[enemyid]["我方"] and WAR.Person[txjq]["死亡"] == false then
					if nokillspeed(txjq) == false then
						ztd(txjq,'集气位置',-math.random(100,200))
					end	
				end
			end
			Set_Eff_Text(enemyid,"特效文字1","闲过信陵饮 脱剑膝前横")
		end
	end
	if WAR.PD["太玄组合防御2"][eid] ~= nil then
		hurtjs1[#hurtjs1+1] = 0.4
	end
	if WAR.PD["太玄组合防御3"][eid] ~= nil then
		hurtjs1[#hurtjs1+1] = 0.9
	end	
	--龙象神足
	if NGQH(eid,103) then	
		local YNWG = {}
		local THWG = {}
		local ynwg = 0
		local thwg = 0
		for i = 0, JY.ThingNum - 1 do
			if JY.Thing[i]["需内力性质"] == 1 then
				ynwg = ynwg + 1
				YNWG[ynwg] = JY.Thing[i]["练出武功"]
			end
		end
		for i = 0, JY.ThingNum - 1 do
			if JY.Thing[i]["需内力性质"] ~= 1 and JY.Thing[i]["需内力性质"] ~= 0 then
				thwg = thwg + 1
				THWG[thwg] = JY.Thing[i]["练出武功"]
			end   
		end
		for i = 1, #YNWG do
			if wugong == YNWG[i] then 
				hurtjs1[#hurtjs1+1] = 0.8
			end
		end
		for i = 1, #THWG do
			if wugong == THWG[i] then 
				hurtjs1[#hurtjs1+1] = 0.4
			end
		end  
		Set_Eff_Text(enemyid, "特效文字3", "血龙炎劲",396)
	end
	--葵花紫霞
	if NGQH(eid,105) or JXPD(eid,19,1) then 
		if JY.Person[eid]["内力"] >= 1000 and JLSD(33,68,eid) then
			ztd(enemyid,"内力点数",-500)
			hurtjs2[#hurtjs2+1] = 500
			Set_Eff_Text(enemyid,1,"天人化生・万物滋养")
		end
	end
	--九阳怒涛
	if NGQH(eid,106) then 
		hurtjs1[#hurtjs1+1] = 0.5
		local jynl = math.modf((JY.Person[eid]["内力最大值"] or 0)*0.3)
		if JY.Person[eid]["内力"] < jynl then
			--JY.Person[eid]["内力"] = jynl
			ztd(enemyid,"体力点数",9)
			ztd(enemyid,"内力点数",jynl-JY.Person[eid]["内力"])
			Set_Eff_Text(enemyid,"特效文字2","九阳圆满・生生不息")	
		end	
		if JY.Person[eid]["封穴程度"] < 1 then
			ztd(WAR.CurID,WAR.FXXS,9)
		else
			ztd(WAR.CurID,WAR.FXXS,JY.Person[eid]["封穴程度"])
			ztd(enemyid,WAR.FXXS,-JY.Person[eid]["封穴程度"])
			Set_Eff_Text(enemyid,"特效文字3","九阳・诸法不侵")
		end
		if JLSD(0,60,eid) then
			jsm = jsm + 1999
			Set_Eff_Text(enemyid,"特效文字1","他强由他强・清风拂山岗")
		end
		if JLSD(50,80,eid) and JY.Person[eid]["内力"] >= 999 then
			ztd(enemyid,"内力点数",-999)
			ztd(enemyid,"生命点数",500)
			hurtjs2[#hurtjs2+1] = 99
			Set_Eff_Text(enemyid,"特效文字3","他自狠来他自恶・我自一口真气足")
		end
	end
	--易筋经组合
	if NGQH(eid,108) then
		if JLSD(10,45,eid) then
			if dng > 2000 then
				jsm = jsm + dng
			else
				jsm = jsm + math.random(2000,3000)
			end
			if WAR.PD['业力引爆'][pid] == nil then
				WAR.PD['业力引爆'][pid] = 30
			end
			Set_Eff_Text(enemyid,3,"易筋神髓・过去弥陀")
		else
			jsm = jsm + math.random(500,1500)
		end	
	end
	--金刚铁布组合
	if NGQH(eid,144) then
		local aa = JY.Person[eid]["内力"]
		local str = "大乘如来・金刚不坏"
		hurtjs1[#hurtjs1+1] = 0.3
		jsm = jsm + aa
		if WAR.PD["金刚护盾"][eid] ~=nil and WAR.PD["金刚护盾"][eid] > 0 then
			jsm = jsm + WAR.PD["金刚护盾"][eid]
		end
		if JY.Person[eid]["资质"] >= 100 then
			aa = aa*2
		elseif JY.Person[eid]["资质"] >= 80 then
			aa = aa*1.5
		end
		ztd(WAR.CurID,"内伤点数",math.modf(aa/400))
		ztd(enemyid,"内伤点数",-math.modf(aa/200))
		if Fjkx(WAR.CurID) ~= 2 and JLSD(0,50,eid) then
			local zz = JY.Person[eid]["资质"]*3
			local ns = JY.Person[pid]["受伤程度"]*3
			ztd(WAR.CurID,"生命点数",-math.modf(ns+zz))
			str = "大乘如来・金刚不坏・佛罡业反"
		end
		Set_Eff_Text(enemyid,3,str)
		if math.random(100) > 85 then
			hurtjs1[#hurtjs1+1] = 999
			WAR.PD['不漏琉璃'][eid] = 1
			Set_Eff_Text(enemyid, 4, "大乘如来・金刚不坏・不漏琉璃",142)
		end
	end
	--玉女先天
	if NGQH(eid,154) then 
		if WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] > 0 then 
			local a = WAR.LQZ[pid]/100
			if a > 1 then 
				a = 1
			end
			hurtjs1[#hurtjs1+1] = a
		end 
		jsm = jsm + JY.Person[eid]["冰封程度"]*5
		for j = 0, WAR.PersonNum - 1 do
			local jd = WAR.Person[j]["人物编号"]
			if dead(j) == false and DWPD(enemyid,j) then
				WAR.QX1[jd] = 1	
				if WAR.LQZ[jd] ~= nil and WAR.LQZ[jd] > 0 then
					local nq = math.modf(WAR.LQZ[jd]/10)
					if nq > 50 then
						nq = 50
					end
					ztd(j,"生命点数",-nq*20)
					WAR.LQZ[jd] = math.modf(WAR.LQZ[jd]*0.9)
				end
			end
		end		
	end
	--天魔易筋
	if NGQH(eid,160) then
		local aa = math.modf((120-JY.Person[eid]["品德"])/10)
		if aa > 0.9 then aa = 0.9 end
		hurtjs1[#hurtjs1+1] = aa
		if MPTX(pid,5) then
			ztd(WAR.CurID,"内伤点数",10)
			Set_Eff_Text(enemyid, "特效文字1", "魔问伪佛・魔相法华",71)
		end	
		if WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] > 50 then
			ztd(enemyid,'集气位置', math.random(200,300))
		end
	end	
	--神足乾坤
	if NGQH(eid,233) then
		hurtjs1[#hurtjs1+1] = 0.5
		ztd(enemyid,"内伤点数",-JY.Person[eid]["受伤程度"])
		ztd(enemyid,"中毒点数",-JY.Person[eid]["中毒程度"])
		local szsm = math.modf((JY.Person[eid]["生命最大值"] or 0)*0.25)
		if JY.Person[eid]["生命"] < szsm then
			JY.Person[eid]["生命"] = szsm
			--ztd(enemyid,"生命点数",szsm-JY.Person[eid]["生命"])
			Set_Eff_Text(enemyid,"特效文字2","神足秘术・活血化毒")	
		end	
	end 	
	--太极纯阳
	if NGQH(eid,171) then
		WAR.DLJ = 1
		hurtjs1[#hurtjs1+1] = 0.4
		if WAR.PD["太极蓄力"][eid] ~= nil and WAR.PD["太极蓄力"][eid] > 0 then
			local tjxl = math.modf(WAR.PD["太极蓄力"][eid]+dng/2)
			jsm = jsm + tjxl
		end
		if JY.Person[eid]["封穴程度"] > 0 then
			jsm = jsm + 500
			if WAR.PD["太极蓄力"][eid] ~= nil and WAR.PD["太极蓄力"][eid] > 0 then
				jsm = jsm + (WAR.PD["太极蓄力"][eid] or 0)
			end
			ztd(WAR.CurID,WAR.FXXS,JY.Person[eid]["封穴程度"]/2)
			ztd(enemyid,WAR.FXXS,-JY.Person[eid]["封穴程度"]/2)
			Set_Eff_Text(enemyid,1,"太极・如封似闭")
		end
		if WAR.LQZ[eid] == nil then
			WAR.LQZ[eid] = 30
		elseif WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] < 101 then
			nuqi(eid,30)
			Set_Eff_Text(enemyid,1,"太极・后发先至")
		end
	end
	--太极纯阳
	if NGQH(eid,171) and WAR.PD['阴阳二气'][eid] ~= nil and WAR.PD['阴阳二气'][eid] > 0 then
		local cs = ""
		local names = 
		{
		{1, "一"},
		{2, "二"},
		{3, "三"},
		{4, "四"},
		{5, "五"},
		{6, "六"},
		{7, "七"},
		{8, "八"},
		{9, "九"},
		}
		for i,v in ipairs(names) do
			if v[1] == WAR.PD['阴阳二气'][eid] then
				cs = v[2]
				break
			end
		end
		if WAR.PD['阴阳二气'][eid] ~= nil then
			Set_Eff_Text(enemyid,"特效文字1","太极真气护体"..cs.."层")
		end
	end
	--忘情天书
	if NGQH(eid,177) or match_ID(eid,652) then
		WAR.PD['忘情日明'][pid] = 1
		Set_Eff_Text(enemyid,1,"忘情天书・日明")
	end
	--长春北冥
	if NGQH(eid,183) then	
		WAR.PD['不破防'][eid] = 1
		hurtjs1[#hurtjs1+1] = 0.5
		if JLSD(10,60,eid) then 
			hurtjs2[#hurtjs2+1] = 30
		end
		Set_Eff_Text(enemyid,"特效文字1","不老长春・天长地久")
	end
	--长生组合守护
	if NGQH(eid,203) then
		local aa = 1-psx(eid,'生命')/psx(eid,'生命最大值')
		if aa < 0.3 then aa = 0.3 end
		hurtjs1[#hurtjs1+1] = aa
		Set_Eff_Text(enemyid, "特效文字1", "长生・命护")
	end
	--擒龙罗汉
	if NGQH(eid,204) then
		hurtjs1[#hurtjs1+1] = 0.5
		if JY.Person[eid]["封穴程度"] > 0 then 
			jsm = jsm + JY.Person[eid]["封穴程度"]*100
			ztd(enemyid,WAR.FXXS,-math.random(10,20))
			Set_Eff_Text(enemyid, "特效文字1", "擒龙逆转")
		end
	end
	--周天星辰207
	if WAR.PD['三垣'][eid] ~= nil then
		if WAR.PD['三垣'][eid] >= 61 and WAR.PD['三垣'][eid] < 91 then
			hurtjs1[#hurtjs1+1] = 0.8
		end
	end
	--阴阳无极组合
	if NGQH(eid,221) then
		Set_Eff_Text(enemyid,1,'真・阴阳磨')
		ztd(WAR.CurID,'内力点数',-math.random(500,1000))
		local a = math.modf(psx(pid,'内力最大值')-psx(pid,'内力'))
		if a ~= nil and a > 0 then
			jsm = jsm + math.modf(a*7)
			ang = ang - math.modf(a*7)
		end
		if WAR.PD['阴阳双极'][eid] ~= nil and WAR.PD['阴阳双极'][eid] < 31 then --阳极状态
			hurtjs1[#hurtjs1+1] = (math.random(3,7)*0.1)
			ztd(WAR.CurID,WAR.ZSXS,25)
			ztd(WAR.CurID,'内力点数',-psx(pid,'灼烧程度'))
			addbuff(pid,WAR.PD['阳气侵蚀'],30)
		end
		if WAR.PD['阴阳双极'][eid] ~= nil and WAR.PD['阴阳双极'][eid] >= 31 then --阳极状态
			ztd(enemyid,'生命点数',math.random(500,1000))
			ztd(WAR.CurID,WAR.BFXS,25)
			ztd(WAR.CurID,'内力点数',-psx(pid,'冰封程度'))
			addbuff(pid,WAR.PD['阴气污染'],30)
		end
	end
	--龟息蛤蟆诀
	if NGQH(eid,227) then
		hurtjs1[#hurtjs1+1] = 0.5
		Set_Eff_Text(enemyid, "特效文字3", "龟息蛤蟆诀・潜心真定")
		if JY.Person[eid]["生命"] <= 1500 then 
			WAR.GXHM[eid] = 30 
			Set_Eff_Text(enemyid, "特效文字3", "龟息蛤蟆诀・潜息出定")
		end
	end
	--玄武真功
	if NGQH(eid,315) then
		if yongquan(wugong) then
			jsm = jsm+TrueQZ(pid)+TrueQZ(eid)
		elseif yongzhi(wugong) then
			jsm = jsm+TrueZF(pid)+TrueZF(eid)
		elseif yongjian(wugong) then
			jsm = jsm+TrueYJ(pid)+TrueYJ(eid)
		elseif yongdao(wugong) then
			jsm = jsm+TrueSD(pid)+TrueSD(eid)
		elseif yongte(wugong) then
			jsm = jsm+TrueTS(pid)+TrueTS(eid)
		end
		Set_Eff_Text(enemyid,"特效文字2","玄武真气护体")	
	end
	--霹雳气诀
	if NGQH(eid,372) then
		hurtjs1[#hurtjs1+1] = 0.5
		if JLSD(20,50,eid) then
			WAR.PD["刺目"][pid] = 2
			Set_Eff_Text(enemyid,"特效文字3","风扫千里")
		end
		--霹雳气诀
		if JLSD(20,50,eid) then
			WAR.PD["恐惧状态"][pid] = 1
			Set_Eff_Text(enemyid,"特效文字2","虚凝御风")
		end	
	end
	--神照龟息
	if NGQH(eid,94) then
		local szsm = math.modf((JY.Person[eid]["生命最大值"] or 0)*0.4)
		local a = JY.Person[eid]["内力最大值"] * 0.00008
		hurtjs1[#hurtjs1+1] = a
		ang = 0
		if JY.Person[eid]["生命"] < szsm then
			JY.Person[eid]["生命"] = szsm
			--ztd(enemyid,"生命点数",szsm-JY.Person[eid]["生命"])	
		end	 
		if JY.Person[eid]["封穴程度"] > 0 then
			ztd(enemyid,WAR.FXXS,-50)
		end
		if JY.Person[eid]["流血程度"] > 0 then
			ztd(enemyid,WAR.LXXS,-50)
		end
		if JY.Person[eid]["受伤程度"] > 0 then
			ztd(enemyid,"内伤点数",-50)
		end
		if JY.Person[eid]["中毒程度"] > 0 then
			ztd(enemyid,"中毒点数",-50)
		end
		Set_Eff_Text(enemyid, "特效文字3", "太初之道・道神同行・所谓天道")
		if JLSD(20,50,eid) then
			Cat('清除高级异常',enemyid)
			Set_Eff_Text(enemyid, "特效文字2", "万物复苏・不离光照・神游太虚")
		end
		if JLSD(20,50,eid) then
            local a = JY.Person[eid]["内力"]
			ztd(enemyid,"生命点数",a)
			Set_Eff_Text(enemyid, "特效文字1", "万物复苏・不离光照・神游太虚")
		end
	end
	----------------------------------------------------------------------------------------------
	----------------------外功组合减伤及受击效果--------------------------------------------------
	----------------------------------------------------------------------------------------------
	--玄寒毒爆组合被攻击减伤15%
	if XHDB(eid) then
		hurtjs1[#hurtjs1+1] = 0.15
	end
	--除却四相
	if ChuQueSX(eid) >= 1 and JLSD(20,70,eid) then
		WAR.CQSX_WZSX = 1 --除却四相，50%几率无视敌方武常
		Set_Eff_Text(enemyid, 2, "无众生相")
    end
	if ChuQueSX(eid) >= 2 and JLSD(20,90,eid) then
        WAR.CQSX = 1 --除却四相，50%几率免疫本次攻击造成的内伤/封穴/冰封/灼烧
        Set_Eff_Text(enemyid, 2, "无我相",79)
    end
	if ChuQueSX(eid) >= 4 and JLSD(20,70,eid) then
		ztd(enemyid,'生命点数',400)
		Set_Eff_Text(enemyid,"特效文字2","无寿者相")
	end
	--铁甲依然在
	if Tjyrz(eid) and 0 < JY.Person[eid]["生命"] and JLSD(20,40,eid) then
		local ts = math.modf(JY.Person[eid]["生命最大值"]*0.02)
		ztd(enemyid,'生命点数',ts)
		Set_Eff_Text(enemyid, "特效文字0", "铁甲依然在")
	end
	--太空卸劲
    if WGZH(eid,15,16) then 
		if JLSD(0, 35, eid) then 
			hurtjs1[#hurtjs1+1] = 0.3
			WAR.TKJQ[pid] = (WAR.TKJQ[pid] or 0) + 1	--太空卸劲
			WAR.TKJQ1[eid] = 1
			Set_Eff_Text(enemyid, "特效文字3", "太空卸劲",113)
		end
	end
	--太极奥义
	if PersonKF(eid,16) and PersonKF(eid,46) then
		hurtjs1[#hurtjs1+1] = 0.45
		--张三丰85%几率
		if match_ID(eid, 5) then
			if JLSD(10, 95, eid) then
				WAR.TJAY = 3
			end
		--其他人(45+资质/4)%几率
		else
			if JLSD(10, 55 + math.modf(JY.Person[eid]["资质"]/4), eid) then
				WAR.TJAY = 3
			end
		end
		if WAR.TJAY == 3 then
			--学有太极神功，触发太极奥义减伤10%
			if PersonKF(eid, 171) then
				hurtjs1[#hurtjs1+1] = 0.1
			end
			--学有太极神功必出35%几率发动真太奥
			if PersonKF(eid,171) and JLSD(40,75,eid) then
				WAR.TJAY = 4
				Set_Eff_Text(enemyid,"特效文字1","太极真义・四两拨千斤",21);
			else
				Set_Eff_Text(enemyid,"特效文字2","太极奥义",21);
			end
		end
	end
	--接化发
	if (Curr_NG(pid,90) or Curr_NG(pid,375)) and PersonKF(eid,99) and (PersonKF(eid,16) and PersonKF(eid,306) and PersonKF(eid,164)) then
		local str = ""
		if WAR.PD['接化发'][eid] == nil or WAR.PD['接化发'][eid] < 1 then
			hurtjs1[#hurtjs1+1] = 0.2
			WAR.PD['接化发'][eid] = 1
			str = "接！"
		elseif WAR.PD['接化发'][eid] ~= nil and WAR.PD['接化发'][eid] == 1 then
			if ang > 0 then
				WAR.PD['伤害储存'][eid] = (WAR.PD['伤害储存'][eid] or 0) + math.modf(ang/2)
				str = "化！！"
				WAR.PD['接化发'][eid] = 2
			end
		end	
		Set_Eff_Text(enemyid,"特效文字3",str)
	end
	--五毒玄冥
	if PersonKF(eid,21) and (PersonKF(eid,220) or match_ID(eid,523) or match_ID(eid,648)) then
    	addbuff(eid,WAR.PD['玄冥冥寒'],math.random(5,10))
    	if match_ID(eid,523) then
    		addbuff(eid,WAR.PD['玄冥冥寒'],math.random(5,10))
    	end
    	if WAR.PD['玄冥冥寒'][eid] ~= nil and WAR.PD['玄冥冥寒'][eid] > 0 then
    		WAR.PD['玄冥冥寒'][eid] = limitX(WAR.PD['玄冥冥寒'][eid],0,50)
    		jsm = jsm + 500*WAR.PD['玄冥冥寒'][eid]
    		hurtjs1[#hurtjs1+1] = WAR.PD['玄冥冥寒'][eid] * 0.1
    		if WAR.PD['玄冥冥寒'][eid] >= 50 then
    			ztd(enemyid,'生命点数',math.modf(psx(eid,'生命最大值')*0.5))
    			WAR.PD['玄冥冥寒'][eid] = math.random(10)
    		end	
    	end	
    end
	--紫气天罗 附带冰冻
	if WGZH(eid,21,118) then
		WAR.PD["利刃寒锋"][pid]= (WAR.PD["利刃寒锋"][pid] or 0) + 5
		Set_Eff_Text(enemyid, 3, "紫气凝霜",116)
	end
	--两仪守护
	if WGZH(eid,37,60) then
		--32%几率变两仪守护・极 水岱100%
		if (JLSD(30,62,eid) or match_ID(eid,96))  then 
			hurtjs2[#hurtjs2+1] = 320
            ang = ang - 1000
			Set_Eff_Text(enemyid, "特效文字1", "两仪守护・极",21)
		else  
			hurtjs1[#hurtjs1+1] = 0.3
			ang = ang - 320
			Set_Eff_Text(enemyid, "特效文字1", "两仪守护",21)
		end
	end
	--太极功太极剑
	if (PersonKF(eid,46) and Curr_NG(eid,171)) or match_ID(eid,5) then
		if (WAR.LQZ[pid] or 0) >= 50 then
			nuqi(pid,-10)
			Set_Eff_Text(enemyid,"特效文字2","太极剑法・阴阳动静")
		end
	end 	
	--怒涛黯然
	if PersonKF(eid,25) and (Curr_NG(eid,252) or match_ID(eid,58)) then
		if (WAR.PD['黯然值'][eid] or 0) < 100 then
			WAR.PD['黯然值'][eid] = limitX((WAR.PD['黯然值'][eid] or 0) + math.random(10,20),0,100)
			if (WAR.PD['黯然值'][eid] or 0) > 99 then
				WAR.DLJ = 1
				WAR.DZY = 1
			end	
		end	
		if PersonKF(eid,104) then
			if JLSD(0,30,eid) and WAR.BTZT[eid]== nil then
				WAR.BTZT[eid] = 1
				WAR.PD['黯然・呆若木鸡'][eid] = 1
				Set_Eff_Text(enemyid,1,'黯然・呆若木鸡')
			end
			if math.random(10) > 8 and WAR.PD['九阴摄魂'][pid] == nil then
				WAR.PD['九阴摄魂'][pid] = 1
				Set_Eff_Text(enemyid,3,'黯然・面无人色')
			end	
		end	
	end
	if PersonKF(eid,25) and WAR.PD['黯然值'][eid] ~= nil then
		local n = math.modf(WAR.PD['黯然值'][eid]*0.01)
		if n > 0.5 then n = 0.5 end
		hurtjs1[#hurtjs1+1] = n
	end
	--独孤九剑
	if (PersonKF(eid,47) and PersonKF(eid,184)) or match_ID(eid,592) then
		zhanyi(eid,9)
	end
	--慈悲为怀
	if WGZH(eid,57,346) and math.random(100) >= 33 then
		jsm = jsm + JY.Person[0]["品德"] * 6
		Set_Eff_Text(enemyid, "特效文字3", "慈悲为怀")
    end
	--神门+玄虚，30%几率将吸收杀气转化为内力增加，并降低一半伤害
	if WGZH(eid,64,236) and JLSD(40,70,eid) then
		local NL = math.modf(hurt / 8)
		hurtjs1[#hurtjs1+1] = 0.5
		ztd(enemyid,"内力点数",NL)
		Set_Eff_Text(enemyid,2,"炼神还虚",159)
	end
	--天地玄黄・地
	if TSZH(eid,78,315) then
		if JLSD(20,30,eid) then
			hurtjs1[#hurtjs1+1] = 0.5
			ztd(enemyid,"内力点数",math.modf(psx(pid,'内力最大值')/3))
			Set_Eff_Text(enemyid,2,"天地玄黄・黄",159)
		end
		if JLSD(20,30,eid) then
			hurtjs2[#hurtjs2+1] = 0
			if WAR.BTZT[eid] == nil then
				WAR.BTZT[eid]= 1
			end
			Set_Eff_Text(enemyid, "特效文字2", "天地玄黄・地",159)
		end
	end
	--金刚伏魔圈，伤害一减少，气防提高
	if PersonKF(eid,82) then
		local jgfmq = 0
		local effstr = "金刚伏魔圈"
		for j = 0, WAR.PersonNum - 1 do
			if PersonKF(WAR.Person[j]["人物编号"], 82) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
				jgfmq = jgfmq + 1
			end
		end
		--上限3人
		if jgfmq > 3 then
			jgfmq = 3
		end
		if jgfmq == 3 then
			effstr = "真."..effstr
		end
		if jgfmq > 1 then
			hurtjs1[#hurtjs1+1] = 0.15*(jgfmq-1)
		end
	end
	--玉女素心玉女先天
	if (PersonKF(eid,139) and PersonKF(eid,100) and PersonKF(eid,154)) or match_ID(eid,605) then
		if yongjian(wugong) or JLSD(10,60,eid) then
			WAR.PD['格挡状态'][eid] = 1
		end	
	end
	--般若金刚189
	if WAR.PD['般若等待'][eid] ~= nil and JLSD(30,60,eid) then
		Cat("清除低级异常",enemyid)
		if PersonKF(eid,144) and WAR.BTZT[eid] == nil then 
			WAR.BTZT[eid] = 1
		end
	end
	--般若金刚，打断连击
	if WAR.PD['般若蓄力'][eid] ~= nil and JLSD(30,60,eid) then
		local jg = (WAR.PD['金刚力'][eid] or 0)*10
		WAR.DLJ = 1
		ztd(enemyid,'集气位置',jg)
		if Fjkx(WAR.CurID) ~= 2 then
			ztd(WAR.CurID,"生命点数",-jg)
		end
	end
	--般若金刚
	if WAR.PD['般若休息'][eid] ~= nil and WAR.PD["金刚护盾"][eid] ~=nil and WAR.PD["金刚护盾"][eid] > 0 then
		local a = (WAR.PD["金刚护盾"][eid] or 0)
		if Fjkx(WAR.CurID) ~= 2 then
			if JLSD(40,60,eid) then
				ztd(WAR.CurID,"生命点数",-a)
			end
		end
		if Curr_NG(eid,108) and JLSD(30,50,eid) then
			WAR.PD['金刚力'][eid] = (WAR.PD['金刚力'][eid] or 0) + math.random(6,10)
		end
	end
	--周公剑意
	if PersonKF(eid,271) and PersonKF(eid,356) then
		if WAR.PD['周公剑意'][eid] ~= nil and WAR.PD['周公剑意'][eid] > 0 then
			if WAR.PD['周公剑意'][eid] >= 5 then
				local atk = math.modf(Atk(WAR.CurID)*0.5)
				if WAR.PD["枪神诀2"][pid] == nil then
					WAR.PD["枪神诀2"][pid] = 10
				end
				ztd(WAR.CurID,'生命点数',-atk)
				ztd(enemyid,'集气位置',1000)
				Cat('清除中级异常',enemyid)
				Set_Eff_Text(enemyid,3,"剑影迷踪")
			end
			if WAR.PD['周公剑意'][eid] == 7 then
				WAR.ACT = 10
				Set_Eff_Text(enemyid, 3, "大道归一")
			end
		end
	end
	--天刀九问
	if PersonKF(eid,335) and PersonKF(eid,181) and PersonKF(eid,203) then
		if yongdao(wugong) then
			hurtjs1[#hurtjs1+1] = 0.9
		else
			hurtjs1[#hurtjs1+1] = 0.5
		end
	end
	--圣火神功组合
	if PersonKF(eid,360) and Curr_NG(eid,93) then
		local jl = limitX(1-(psx(eid,'生命')/psx(eid,'生命最大值')),0.15,1)
		if WAR.PD['圣火无中生有'][eid] ~= nil and WAR.PD['圣火无中生有'][eid] > 0 and JLSD(0,100*jl,eid) then
			jsm = jsm + math.mdof(WAR.PD['圣火无中生有'][eid]*0.5)
		end	
	end
	--唯识心剑
	if (PersonKF(eid,369) and PersonKF(eid,370) and JLSD(20,55,eid)) or (PersonKF(eid,370) and match_ID(eid,747)) then
		hurtjs2[#hurtjs2+1] = 0
		WAR.PD["唯识剑意3"][eid] = 1
	end
	----------------------------------------------------------------------------------------------
	----------------------武器防具减伤及受击效果--------------------------------------------------
	----------------------------------------------------------------------------------------------
	--套装效果降低伤害
    if PDTZ(eid,JY.Person[eid]["武器"]) and Setmeal[JY.Person[eid]["武器"]][5] == 8 then
	    if JLSD(0,50,eid) then
			hurtjs1[#hurtjs1+1] = 0.5
			angzj[#angzj+1] = -0.5
			Set_Eff_Text(enemyid, 1, "套装抵挡")
		end
    end
	--套装效果坐骑	
	if PDTZ(eid,JY.Person[eid]["武器"]) then
		local n = JY.Person[eid]["武器"]
		if Setmeal[n][6] == 6 and JLSD(0,8,eid) then
			hurtjs2[#hurtjs2+1] = 0
			Set_Eff_Text(enemyid, "特效文字2", "套装效果.班门弄斧",126)
		end
	end
	--软猬甲减伤20点
	if (JY.Person[eid]["防具"] == 58) or match_ID(eid,56) or match_ID(eid,9864) then
		local hurt_reduction =  200
		jsm = jsm + hurt_reduction
		--被拳指系武功攻击，会给攻击方强制上10点流血
		if yongquan(wugong) or yongzhi(wugong) then
			ztd(WAR.CurID,WAR.LXXS,10);
		end
	end
	--张家辉的护身戒指     
	if JY.Person[eid]["防具"] == 302 then    
		local factor = 3    
		if JY.Thing[302]["装备等级"] >=5 then
			factor = 1
		elseif JY.Thing[302]["装备等级"] >=3 then
			factor = 2
		end
		local hn = math.modf(hurt/2*factor)
		if JY.Person[eid]["内力"] > hn then
			hurtjs1[#hurtjs1+1] = 0.5
			ztd(enemyid,"内力点数", -hn,144)
		end
	end
	if JY.Person[eid]["坐骑"] == 312 then
		hurtjs2[#hurtjs2+1] = 30
	end
	----------------------------------------------------------------------------------------------
	----------------------异常状态减伤及受击效果--------------------------------------------------
	----------------------------------------------------------------------------------------------
	--菩提咒受伤减少10%
	if WAR.PD["菩提咒"][eid] ~= nil then
		hurtjs1[#hurtjs1+1] = 0.2
	end
	--凝冰成凯216
	if WAR.PD['凝冰成铠'][eid] ~= nil then
		local bf = (WAR.PD['凝冰成铠'][pid] or 0)/150
		hurtjs1[#hurtjs1+1] = bf
		if (WAR.PD['凝冰成铠'][eid] or 0) >= 80 then	
			WAR.DLJ = 1 
			for j = 0, WAR.PersonNum - 1 do
				local nb = WAR.PD['凝冰成铠'][eid] or 0
				local df = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[enemyid]["我方"] then
					ztd(j,'生命点数',-8*nb)
					WAR.PD["利刃寒锋"][df] = (WAR.PD['利刃寒锋'][df] or 0) + 10
					WAR.PD['冰冻状态'][df] = (WAR.PD['冰冻状态'][df] or 0) + 15
				end
			end
			WAR.PD["凝冰成铠"][eid] = nil
		end
	end
	if WAR.PD["走火状态"][eid] == 1 or match_ID(eid, 98) then
		hurtjs1[#hurtjs1+1] = 0.1
	end
	--霍青桐指令
	if WAR.HQT_ZL[eid]~= nil then
		local n = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"]  then
				n = n + 1
			end	
		end
		hurtjs1[#hurtjs1+1] = n*0.05
	end
	if WAR.PD['醉八仙'][eid] ~= nil then
		hurtjs1[#hurtjs1+1] = 0.5
	end
	--帝释天临
	if WAR.PD["帝释天临"][eid] ~= nil then
		hurtjs2[#hurtjs2+1] = 0
		WAR.Person[enemyid]["特效文字0"] = nil
		WAR.Person[enemyid]["特效文字1"] = nil
		WAR.Person[enemyid]["特效文字2"] = nil
		WAR.Person[enemyid]["特效文字3"] = nil
		WAR.Person[enemyid]["特效文字4"] = nil
		WAR.Person[enemyid]["特效动画"] = nil
		WAR.Person[enemyid]["特效动画"] = 171
		local heal_amount = math.modf((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"])*0.08)
		ztd(enemyid,'生命点数',heal_amount)
		local dtkl = math.modf(((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"])/JY.Person[eid]["生命最大值"] + 0.6) * 500)
		for i = 0, WAR.PersonNum - 1 do
			if WAR.Person[i]["我方"] ~= WAR.Person[enemyid]["我方"] and WAR.Person[i]["死亡"] == false then
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID, 131,1,"帝天狂雷")
				ztd(i,'生命点数',-dtkl)
			end
		end
	end
	--九阴降龙・腾云
	if WAR.PD["羽蛇腾云"][eid] ~= nil and (WAR.PD['羽蛇腾云'][eid] or 0) >= 100 and 0 < JY.Person[eid]["生命"] then
		local heal_amount = math.modf((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"])*0.1)
		ztd(enemyid,'生命点数',heal_amount)
		Cat('清除高级异常',enemyid)
		ztd(enemyid,'集气位置',1005-WAR.Person[enemyid].TimeAdd)
		WAR.PD["羽蛇腾云"][eid] = nil
		Set_Eff_Text(enemyid,"特效文字2","腾云驾雾")
	end
	if WAR.PD['锁穴奇劲'][eid] ~= nil then
		if WAR.PD['锁穴奇劲'][eid] >= 10000 or (WAR.PD['锁穴奇劲'][eid] > 5000 and JLSD(10,40,pid)) then
			local sx = WAR.PD['锁穴奇劲'][eid]
			sx = 2000+sx*0.2
			ztd(enemyid,'生命点数',-math.modf(sx*1.2))
			ztd(enemyid,'内力点数',-math.modf(sx*1.8))
			ztd(enemyid,'体力点数',-25)
			zhanyi(eid,-math.modf(WAR.SPIRIT[eid]*0.5))
			WAR.PD['恐惧状态'][eid] = 1
			WAR.PD['锁穴奇劲'][eid] = nil
			if psx(eid,"生命") <= math.modf(psx(eid,"生命最大值")*0.07) then
				if math.random(100) > 85 then
					JY.Person[eid]["生命"] = 0
				else
					if psx(eid,"生命") < 1 then
						JY.Person[eid]["生命"] = 1
					end
				end
			end
		end
		local nlsx = -1
		if psx(pid,"内力性质") < 3	then
			nlsx = psx(pid,"内力性质")
		else
			nlsx = math.random(3)-1
		end
		if nlsx == 0 then
			WAR.PD['冰冻状态'][eid] = (WAR.PD['冰冻状态'][eid] or 0) + math.random(10,30)
			WAR.PD['冰冻扣血'][eid] = (WAR.PD['冰冻扣血'][eid] or 0) + math.random(10,30)
		elseif nlsx == 1 then
			WAR.PD['举火燎原'][eid] = (WAR.PD['举火燎原'][eid] or 0) + 10
		elseif nlsx == 2 then	
			WAR.PD['创伤'][eid] = (WAR.PD['创伤'][eid] or 0) + 10
		end
	end
	--东方不败花天
	if WAR.PD['含苞'][pid] ~= nil then
		hurtjs1[#hurtjs1+1] = 0.9
	end
	--凋零状态
	if WAR.PD['凋零'][eid] ~= nil then		
		local ss = JY.Person[eid]["受伤程度"] + JY.Person[pid]["受伤程度"]
		local zd = JY.Person[eid]["中毒程度"] + JY.Person[pid]["中毒程度"]
		local bf = JY.Person[eid]["冰封程度"] + JY.Person[pid]["冰封程度"]
		local zs = JY.Person[eid]["灼烧程度"] + JY.Person[pid]["灼烧程度"]
		local lx = JY.Person[eid]["流血程度"] + JY.Person[pid]["流血程度"]
		local fx = JY.Person[eid]["封穴程度"] + JY.Person[pid]["封穴程度"]
		local dl = ss + zd + bf +lx + fx
		ztd(enemyid,'生命点数',-dl)
	end
	--文泰来否极泰来 	
	if WAR.WTL_PJTL[eid] ~= nil then	        
		WAR.Person[enemyid]["特效文字0"] = nil
		WAR.Person[enemyid]["特效文字1"] = nil
		WAR.Person[enemyid]["特效文字2"] = nil
		WAR.Person[enemyid]["特效文字3"] = nil
		WAR.Person[enemyid]["特效文字4"] = nil
		WAR.Person[enemyid]["特效动画"] = nil
		WAR.Person[enemyid]["特效动画"] = 157
		hurtjs2[#hurtjs2+1] = 0
		Set_Eff_Text(enemyid, "特效文字1", "否极泰来")
	end	
	--霸体状态
	if WAR.BTZT[eid] ~= nil then		
	    local aa = hurt
		if aa < 100 then aa = 100 end
		if eid == 739 and WAR.PD['伤害储存1'][eid] ~= nil then
			WAR.PD['伤害储存1'][eid] = WAR.PD['伤害储存1'][eid] + aa
			if WAR.PD['伤害储存1'][eid] > 8000 then WAR.PD['伤害储存1'][eid] = 8000 end	
		end	
		hurtjs2[#hurtjs2+1] = 0
	    WAR.Person[enemyid]["特效文字0"] = nil
		WAR.Person[enemyid]["特效文字1"] = nil
		WAR.Person[enemyid]["特效文字2"] = nil
		WAR.Person[enemyid]["特效文字3"] = nil
		WAR.Person[enemyid]["特效文字4"] = nil
		WAR.Person[enemyid]["特效动画"] = nil		
	    WAR.Person[enemyid]["特效动画"] = 118
	    WAR.BTZT[eid] = WAR.BTZT[eid] + 1	
	end
	--易水寒
	if WAR.PD['易水寒冰'][eid] ~= nil then		
		local aa = hurt
		if aa < 10 then aa = 10 end	
		hurtjs2[#hurtjs2+1] = 0
	    WAR.Person[enemyid]["特效文字0"] = nil
		WAR.Person[enemyid]["特效文字1"] = nil
		WAR.Person[enemyid]["特效文字2"] = nil
		WAR.Person[enemyid]["特效文字3"] = nil
		WAR.Person[enemyid]["特效文字4"] = nil
		WAR.Person[enemyid]["特效动画"] = nil
	end
		
	--护龙军师大阵
	if WAR.PD['灌木阵'][pid] == 1 then
		local a = 1/WAR.ACT
		hurtjs1[#hurtjs1+1] = 1-a
	end
	--左右互搏真谛格挡
	if ZYHBPD(eid) == 2 then
		local gd1 = 0.5
		if PersonKF(eid,15) then
			gd1 = 0.35
			WAR.PD['不破防'][eid] = 1
		end
		hurtjs1[#hurtjs1+1] = (1-gd1)
		WAR.Person[enemyid]["特效动画"] = nil
		WAR.Person[enemyid]["特效动画"] = 196
		Set_Eff_Text(enemyid, "特效文字4", "互搏・格档")
		if WAR.TKJQ1[eid] ~= nil then
			hurtjs2[#hurtjs2+1] = 1000
		end	
		if JLSD(10,55,eid) then
			WAR.PD['互搏真谛杀气'][eid] = 1
		end	
	end
	--如山
	if WAR.PD['守如山'][eid] ~= nil then
		hurtjs2[#hurtjs2+1] = 30 - WAR.PD['守如山'][eid]
		WAR.PD['不破防'][eid] = 1
		WAR.PD['守如山'][eid] = nil
	end
	-----------------------------------奇穴防御效果--------------------------------------
	if QIQX(eid,'诡道兵') > 0 then
		local a = QIQX(eid,'诡道兵')
		if JLSD(0,(a*10)+5,eid) then
			local b = JY.Thing[JY.Person[id]["武器"]]["加攻击力"]
			if b == nil or b < 0 then
				b = math.modf(Xishu_sum(pid)*0.5)
			end	
			jsm = jsm + b*a
		end	 
	end
	--奇门奇穴格挡
	if WAR.PD['涤瑕格挡'][eid] ~= nil then
		hurtjs1[#hurtjs1+1] = 0.7
		WAR.Person[enemyid]["特效动画"] = nil
		WAR.Person[enemyid]["特效动画"] = 196
		Set_Eff_Text(enemyid, "特效文字4", "涤瑕格档")
	end
	if WAR.PD["格挡状态"][eid] ~= nil and WAR.PD["格挡状态"][eid] > 0 then
		local wxj = (QIQX(eid,'无瑕击') or 0)*3
		if JLSD(0,60+wxj,eid) then
			hurtjs1[#hurtjs1+1] = 0.25
			WAR.Person[enemyid]["特效动画"] = nil
			WAR.Person[enemyid]["特效动画"] = 196
			Set_Eff_Text(enemyid, "特效文字4", "格档")
		end
	end
	---------------------------------------------------------------------------------------------------------
	-------------------------------------门派减伤及受击效果--------------------------------------------------------
	---------------------------------------------------------------------------------------------------------
	if DWPD(WAR.CurID,enemyid) then
		local n = MPPD(eid)
		local dj = MPDJ(eid)
		if MPTX(eid,1) then  --星宿
			--星宿派减伤
		if MPTX(eid,1) then
			local zd = JY.Person[eid]["中毒程度"] / 400
			if PersonKF(eid,87) then
					hurtjs1[#hurtjs1+1] = (zd*2)
				else
					hurtjs1[#hurtjs1+1] = (zd*1.5)
				end	
			end
			if match_ID(eid,46) then
				dj = 3
			end	
			ztd(enemyid,"中毒点数",math.random(5, 15))
			if PersonKF(eid,87) then
				local jj = dj*10
				if JLSD(10, 25 + jj, eid) and MPTX(eid,1,2) then
					SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 4, 5)
					ztd(WAR.CurID,"中毒点数",math.random(jj-5, jj+5))
					local bl = math.modf((jj+2)*15)
					ztd(WAR.CurID,"内力点数",-bl)
					ztd(enemyid,"内力点数",bl)
					local bl2 = math.modf((jj+2)*10)
					ztd(WAR.CurID,"生命点数",-bl2)
					ztd(enemyid,"生命点数",bl2)
					Set_Eff_Text(enemyid,2,"神木毒髓.邪毒侵袭",40)  	
				end
			end
			if PersonKF(eid,20) and PersonKF(eid,4) and MPTX(eid,1,3) then
			    if JLSD(10,20,eid) then
				    WAR.PD['闪避'][eid] = 1
				    Set_Eff_Text(enemyid,1,"九死龙爪・龙隐长空")
			    end
		    end	
		end
		
		if MPTX(eid,2) then  --丐帮
			if match_ID(eid,50) or match_ID(eid,69) then
				dj = 4
			end	
			jsm = jsm + 100
			local JLQX = 0
			local effstr = "丐帮・打狗阵"
			for j = 0, WAR.PersonNum - 1 do
					if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] and MPTX(WAR.Person[j]['人物编号'],2) then
					JLQX = JLQX + 1
				end
			end
			if JLQX > 1 then
				hurtjs1[#hurtjs1+1] = 0.1*(JLQX-1)
				Set_Eff_Text(enemyid, "特效文字3", effstr)
			end
			if MPTX(eid,2,2) and PersonKF(eid,215) then
				hurtjs1[#hurtjs1+1] = 0.5 
			end
			--主运擒龙功
			if MPTX(eid,2,2) and Curr_NG(eid,204) then
				jsm = jsm + 400 
			end
		end
		
		if MPTX(eid,3) then  --古墓
			if match_ID(eid,605) then
				dj = 3
			end
			if JLSD(0,30,eid) then
				if WAR.PD["刺猬状态"][eid] == nil then
					WAR.PD["刺猬状态"][eid] = dj
				end
			end
			--古墓初级减伤
			local a = JY.Person[eid]["轻功"]/2
			jsm = jsm + a  	
			--古墓玉女素心剑
			if (PersonKF(eid,139) and PersonKF(eid,100) and PersonKF(eid,154)) or match_ID(eid,605) then
				jsm = jsm + TrueYJ(eid)
			end
		    --古墓反击
			if (MPTX(eid,3,2) and Curr_NG(eid,154)) or match_ID(eid,605) then	
				WAR.YFZ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
			end
			--古墓2级弟子玉女清心诀
			if ((MPTX(eid,3,2) and Curr_NG(eid,154)) or match_ID(eid,605)) and JLSD(10,60,eid) then
				WAR.DLJ = 1
				local a = 0
				if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] >= 0 then
					a = WAR.LQZ[eid]*5
					hurtjs1[#hurtjs1+1] = 0.4
				else
					a = 300
					hurtjs1[#hurtjs1+1] = 0.3
				end
				ztd(enemyid,"内力点数",a)
				local str = "・一笑倾人城"
				if JLSD(20,55,eid) or (match_ID(eid,59) and PersonKF(eid,139)) or match_ID(eid,605) then
					WAR.PD['利刃寒锋'][pid] = 15
					local tmp1 = math.modf(hurt * dj / 100);
					local tmp2 = 0
					if WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] > 0 then 
						tmp2 = WAR.LQZ[pid]
					end
					ztd(enemyid,"内伤点数",-20)
					ztd(enemyid,"体力点数",10)
					jsm = jsm + tmp2 * math.random(5,10)
					WAR.PD['不破防'][eid] = 1
					if WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] > 0 then 
						if WAR.LQZ[pid] >= 50 then
							WAR.LQZ[pid] = math.modf((WAR.LQZ[pid] or 0)/2)
						else
							WAR.LQZ[pid] = 0
						end
					end
					str = "・再笑倾人国"
				elseif JLSD(55,90,eid) or (match_ID(eid,59) and PersonKF(eid,139)) or match_ID(eid,605) then
					WAR.PD['灵蛇拳'][pid] = 10
					local tmp1 = math.modf(hurt*dj/100);
					local tmp2 = 0
					if WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] > 0 then 
						tmp2 = WAR.LQZ[pid]
					end
					ztd(enemyid,"生命点数",tmp1)
					ztd(enemyid,"内力点数",tmp1*2)
					jsm = jsm + tmp2 * math.random(5,10)
					WAR.PD['不破防'][eid] = 1;
					str = "・烽火戏诸侯"
				end
				Set_Eff_Text(enemyid,2,"玉女清心诀"..str)
			end
		end
		if MPTX(eid,4) then  --武当
			if match_ID(eid,5) then
				dj = 5
			end
			WAR.BG[eid] = limitX((WAR.BG[eid] or 0) + hurt, 0, 8888)
			--武当1级弟子防御+15%  
			hurtjs1[#hurtjs1+1] = 0.15
			--武当4级弟子主运太极
			if Curr_NG(eid,171) and JLSD(10,35,eid) then
				local str = "太极奥义"
				local str1 = ""
				if match_ID(eid,5) then 
					str = "太极奥义・万物无极"
				end
				WAR.PD['不破防'][eid] = 1
				--武当4级弟子主运太极
				if MPTX(eid,4,4) and JLSD(10,55,eid) then
					WAR.DLJ = 1
					WAR.DZY = 1
					str1 = str1.."・揽雀尾"
					WAR.TJZX0[eid] = (WAR.TJZX0[eid] or 0) + 2
					WAR.PD['九阳反震'][pid] = 2
					str1 = str1.."・倒卷肱"
					WAR.TJZX1[eid] = (WAR.TJZX1[eid] or 0) + 2
				end	
				if str1 ~= "" then
					Set_Eff_Text(enemyid,3,str..str1)
				else
				    Set_Eff_Text(enemyid,3,str)
				end
			end	
			--武当3级弟子主运纯阳
			if MPTX(eid,4,3) and Curr_NG(eid,99) then
				local str = "纯阳无极"
				local str1 = ""
				if JLSD(10,45,eid) then 
					local aa = JY.Person[eid]["受伤程度"]
					if JY.Person[eid]["受伤程度"] ~= nil and JY.Person[eid]["受伤程度"] > 0 then
						ztd(enemyid,"生命点数",aa*2)
						ztd(enemyid,"内伤点数",-aa/2)
						if BNJQ(eid) then
							ztd(enemyid,WAR.FXXS,-JY.Person[eid]["封穴程度"])
						end	
						str1 = str1.."・定阳针"
					end
				end
				if JLSD(30,65,eid) then
					if psx(pid,'灼烧程度') < 20 then
						ztd(WAR.CurID,WAR.ZSXS,math.random(15,35))
					else
						ztd(WAR.CurID,WAR.ZSXS,math.random(15,35))
						WAR.PD['无明业火'][pid] = (WAR.PD['无明业火'][pid] or 0) + 8
					end	
					WAR.PD['盲目状态'][pid] = 2
					str1 = str1.."・昊阳体"
				end	
				if str1 ~= "" then
					Set_Eff_Text(enemyid,3,str..str1)
				else
				    Set_Eff_Text(enemyid,3,str)
				end	
			end	
			--武当3级弟子修炼梯云纵
			if (MPTX(eid,4,3) and PersonKF(eid,149) and JLSD(15,40,eid)) or (match_ID(eid,5) and JLSD(12,65,eid)) then
				WAR.PD['免疫内伤'][eid] = 1
				WAR.PD['免疫中毒'][eid] = 1
				WAR.PD['免疫流血'][eid] = 1
				WAR.PD['免疫冰封'][eid] = 1
				WAR.PD['免疫灼烧'][eid] = 1
				WAR.PD['免疫封穴'][eid] = 1
				WAR.PD['集气速度'][eid] = (WAR.PD['集气速度'][eid] or 0) + math.random(2)
			end
			--武当3级弟子修炼梯云纵
			if (MPTX(eid,4,3) and PersonKF(eid,149) and JLSD(20,50,eid)) or match_ID(eid,5) then
				local str2 = ""
				WAR.DLJ = 1 
				WAR.PD['恐惧状态'][pid] = 1
				str2 = "・身若流虹"
				if str2 ~= "" then
					Set_Eff_Text(enemyid,1,str2)
				end
			end
		end
		
		if MPTX(eid,5) then  --少林
			if match_ID(eid,577) then
				dj = 5
			end
			jsm = jsm + math.random(80,180)
			--少林1级金钟罩
			if JLSD(25,55,eid) then 
				if WAR.Defup[eid] == nil then
					WAR.Defup[eid] = 1
				else
				    --addbuff(eid,WAR.PD['金刚护盾'],180)
					WAR.PD["金刚护盾"][eid] = limitX((WAR.PD["金刚护盾"][eid] or 0) + 100,0,3000)
					if WAR.Person[enemyid]['护盾'] == nil or WAR.Person[enemyid]['护盾'] <=0 then
						WAR.Person[enemyid]['护盾'] = 2
					end
				end
				Set_Eff_Text(enemyid, "特效文字1", "金钟罩",156)
			end
			--少林1级金刚不坏
			if WAR.PD['金刚不坏'][eid] ~= nil then 
				ztd(enemyid,"内力点数",-math.modf(hurt/18))
				hurtjs2[#hurtjs2+1] = 0	
				if JY.Person[eid]["内力"] < 1000 then
					WAR.PD['金刚不坏'][eid] = nil
				end
		    end
			
			--少林2级金刚不坏
			if MPTX(eid,5,2) and JLSD(20,50,eid) then
				jsm = jsm + 300
				if Curr_NG(eid,144) then
					local aa = math.modf(dng/10)
					jsm = jsm + aa
					Set_Eff_Text(enemyid, "特效文字1", "十八铜人") 
				end 
			end 		
			--少林2级不动明王
			if MPTX(eid,5,2) and Curr_NG(eid,144) then
				--local bb = 0
				local WZTS = {"一","二","三","四","五","六","七","八","九","十","十一"}
				local shierJL = 45
				if WAR.Defup[eid] ~= nil then
					shierJL = 55
				end	
				if JLSD(25,shierJL,eid) then
					local tmp = limitX(math.modf(hurt/5*dj,0,1800));
					local tmp1 = math.modf(hurt/100*dj);
					hurtjs2[#hurtjs2+1] = 1;
					ztd(enemyid,"内力点数",tmp)
					ztd(WAR.CurID,"内伤点数",tmp1)
					addbuff(eid,WAR.PD['金刚护盾'],200,3000)
					ztd(enemyid,"生命点数",200)
					if WAR.Person[enemyid]['护盾'] == nil or WAR.Person[enemyid]['护盾'] <= -1 then
						WAR.Person[enemyid]['护盾'] = 2
					end	
					Set_Eff_Text(enemyid,1,"刚相金身・金钟十二关・馈内震外",156)
				else
				    WAR.JZSEG = math.random(1,11)
					addbuff(eid,WAR.PD['金刚护盾'],WAR.JZSEG*10,3000)
					if WAR.Person[enemyid]['护盾'] == nil or WAR.Person[enemyid]['护盾'] <= -1 then
						WAR.Person[enemyid]['护盾'] = 2
					end
					if hurt >= dj*30*WAR.JZSEG then
						jsm = jsm + math.modf(dj*30*WAR.JZSEG);
					else
					    hurtjs1[#hurtjs1+1] = 1;
					end
					Set_Eff_Text(enemyid,3,"刚相金身・金钟"..WZTS[WAR.JZSEG].."关")
				end
			end
			--少林3级不灭怒佛
			if MPTX(eid,5,3) and Curr_NG(eid,108) then
				jsm = jsm + math.random(300,700)
				local a = ((WAR.LQZ[eid] or 0)*0.01)+0.1
				if a > 1 then a = 1 end
				hurtjs1[#hurtjs1+1] = a
				if BNJQ(eid) then
					Set_Eff_Text(enemyid,1,'不灭怒佛')
				end
			end	
		end
		if MPTX(eid,6) then  --密宗
			if match_ID(eid,97) or match_ID(eid,62) then
				dj = 3
			end
			ztd(enemyid,"内伤点数",-dj*3)
			WAR.PD["伤害储存"][eid] = math.modf((WAR.PD["伤害储存"][eid] or 0) + hurt)
			if WAR.PD["伤害储存"][eid] > 2000 then
				WAR.PD["伤害储存"][eid] = 2000
			end
			if Curr_NG(eid,103) then
				if math.random(100) > 70 then
					ang = 0
					WAR.PD['不破防'][eid] = 1
					if WAR.BTZT[eid] == nil then
						WAR.BTZT[eid]= 1
					end	
					ztd(WAR.CurID,"内伤点数",math.random(10,20))
					WAR.PD["天香续命"][eid] = 100
					Set_Eff_Text(enemyid,0,"龙象金身・绝对霸体")
				else
					ang = math.modf((ang-(Def(enemyid)*dj))*0.5)
					WAR.PD["天香续命"][eid] = 50
					Set_Eff_Text(enemyid,0,"龙象金身")
				end	
			end	
			
			if MPTX(eid,6,2) then
				jsm = jsm + math.random(50,120) + math.modf((WAR.PD["伤害储存"][eid] or 0)/2) + dj * 15
			else
				jsm = jsm + math.random(100,200)
			end
			
			--密宗1级血刀门
			if MPTX(eid,6,1) and PersonKF(eid,63) then
				--JY.Person[eid]["生命最大值"] = JY.Person[eid]["生命最大值"] + (WAR.PD['凝血纹印'][eid] or 0)*5*dj
				--if JY.Person[eid]["生命最大值"] >= 30000 then
					--JY.Person[eid]["生命最大值"] = 30000
				--end
				hurtjs1[#hurtjs1+1] = 0.5
				local aa = math.abs((JY.Person[eid]["内力"] - JY.Person[pid]["内力"])/40)
				ztd(enemyid,"生命点数",math.modf(aa))
				Set_Eff_Text(enemyid,3,"凝血成符")
				if JY.Person[eid]["流血程度"] > 0 then
					local a = JY.Person[pid]["流血程度"] * 2
					local b = JY.Person[eid]["流血程度"] * 2
					local c = a + b
					local d = math.modf(c/15)
					ztd(WAR.CurID,"生命点数",-c)
					ztd(WAR.CurID,"内伤点数",d)
					ztd(enemyid,"内伤点数",-d)
					Set_Eff_Text(enemyid,3,"血气唤醒")
				end	
			end  

			--密宗2级血刀门
			if MPTX(eid,6,2) and Curr_NG(eid,163) and JLSD(20,50,eid) then
				hurtjs1[#hurtjs1+1] = JY.Person[eid]["流血程度"] / 120
				if WAR.PD['血淬'][eid] ~= nil and WAR.PD['血淬'][eid] > 0 then
					local a = math.modf(WAR.PD['血淬'][eid]/10)
					ztd(enemyid,"生命点数",a)
				end
				Set_Eff_Text(enemyid,3,"凝血化精")
			end
			--密宗2级
			if MPTX(eid,6,2) and Curr_NG(eid,103) and JY.Person[eid]["生命"] > 0 then
				local str= ""
				hurtjs1[#hurtjs1+1] = 0.6
				if JLSD(20,40,eid) then
					local a = math.modf(hurt * dj);
					local b = JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"]
					local c = math.modf(a/math.random(4,7))
					local d = math.modf(b/math.random(2,3))
					if c > 2000 then c = 2000 end
					if d > 1000 then d = 1000 end
					WAR.PD['不破防'][eid] = 1;
					ztd(enemyid,"生命点数",c)
					ztd(enemyid,"内力点数",d)
					str="・硬气钢体"
				else
				    if ang >= dj * 300 then
						ang = ang - dj * 300;
					else
					    ang = 0
					end
				end
				Set_Eff_Text(enemyid, "特效文字2","密宗龙象・苦修瑜伽"..str)	
			end
			--密宗3级
			if (MPTX(eid,6,3) and PersonKF(eid,233)) or match_ID(eid,103) then
				ztd(enemyid, "内伤点数", -100);
				jsm = jsm + JY.Person[pid]["防御力"]/2
				if JLSD(10,40,eid) then 
					local a = JY.Person[pid]["防御力"]
					local b = JY.Person[eid]["防御力"]
					local c = a + b
					ztd(WAR.CurID, "内伤点数",(c*0.05));
					ztd(WAR.CurID, "生命点数",-(c/5));
				end	
				Set_Eff_Text(enemyid, "特效文字1","无上瑜珈密乘・无穷无尽")	
				--梵我合一 标记修改
				if JLSD(20,50,eid) and (WAR.BJ == 1 or WAR.ACT > 1) then
					Set_Eff_Text(enemyid, "特效文字0", "无上瑜珈密乘・梵我合一")
					ztd(enemyid,"生命点数",300)
					WAR.DLJ = 1
				end
			end
		end
		
		if MPTX(eid,7) then  --逍遥派
			if match_ID(eid,634) then
				dj = 5
			end
			if match_ID(eid,116) or match_ID(eid,117) or match_ID(eid,118) then
				dj = 4
			end		
			if JLSD(0,20,eid) then
				addbuff(eid,WAR.PD['凌波微步闪避'],1)
			end
			--主运小无相的防御加成
			if Curr_NG(eid,98) or (XiaoYaoYF(eid) and PersonKF(eid,98)) then
				WAR.PD['不破防'][eid] = 1
				hurtjs1[#hurtjs1+1] = 0.5
				Set_Eff_Text(enemyid, "特效文字2", "幻化无相")
			end
			--主运八荒的防御加成
			if Curr_NG(eid,101) or (XiaoYaoYF(eid) and PersonKF(eid,101)) then
				if JLSD(10,40,eid) then
					hurtjs1[#hurtjs1+1] = 0.5
					ztd(enemyid,"内力点数",hurt/2);	
					ztd(enemyid,"生命点数",800);	
					ztd(enemyid,"体力点数",8);
					Set_Eff_Text(enemyid, "特效文字1", "八荒六合")
				end
			end
			--三级弟子主运北冥的防御加成
			if MPTX(eid,7,3) and (Curr_NG(eid,85) or (XiaoYaoYF(eid) and PersonKF(eid,85))) then
				local str = "北冥真气护体"
				if JY.Person[eid]["内力"] > 500 then
					ztd(enemyid,"内力点数", -500);
					jsm = jsm+1000
				end
				if JLSD(20,55,eid) then
					WAR.DLJ = 1
					WAR.DZY = 1
					ztd(enemyid,"生命点数",666);
					str = "北冥真气・海纳百川"
				end
				if JLSD(10,40,eid) then
					if JY.Person[eid]["内力"] > 1000 then
						ztd(enemyid,"内力点数", -1000);
						hurtjs2[#hurtjs2+1] = 1
					end	
					str = "北冥真气・运转周身"
				end 
				Set_Eff_Text(enemyid, "特效文字1",str)
			end
			--三级弟子主运不老长春的防御加成
			if MPTX(eid,7,3) and (Curr_NG(eid,183) or (XiaoYaoYF(eid) and PersonKF(eid,183))) then
				if JLSD(10,55,eid) then
					hurtjs2[#hurtjs2+1] = 999
					WAR.PD['免疫杀气'][eid] = 1
					Set_Eff_Text(enemyid, "特效文字1", "天长地久・不老长春")
				end	
			end
		end
		
		if MPTX(eid,8) then  --白驼
			if match_ID(eid,60) then
				dj = 3
			end	
			local zd = JY.Person[eid]["中毒程度"] * 2 + JY.Person[pid]["中毒程度"] * 2
			jsm = jsm + zd
			if JLSD(0,40,eid) then
				WAR.PD["格挡状态"][eid] = 1
			end 
		 	if Curr_NG(eid,95) then
				local ns = JY.Person[eid]["中毒程度"] / 200
				hurtjs1[#hurtjs1+1] = ns
			end
			--白驼山1级
			if (MPTX(eid,8,1) and (Curr_NG(eid,95) or Curr_NG(eid,104))) or match_ID(eid,61) then
				ztd(WAR.CurID,'中毒点数',math.random(15, 25))
				ztd(enemyid,'中毒点数',math.random(15, 25))
				Set_Eff_Text(enemyid, "特效文字1", "蟾毒秘要・荒蟾毒息")
			end
			--白驼山2级
			if (MPTX(eid,8,2) and Curr_NG(eid,95)) or match_ID(eid,61) then
				WAR.PD['西域奇毒'][pid] = (WAR.PD['西域奇毒'][pid] or 0) + 10
				Set_Eff_Text(enemyid, "特效文字2", "蟾毒秘要・万毒缠身")
			end
			--白驼山3级
			if WAR.PD["凝毒化血"][eid] ~= nil and WAR.PD["凝毒化血"][eid] > 0 then
				ztd(enemyid,'生命点数',JY.Person[pid]["中毒程度"])
				WAR.PD['西域奇毒'][pid] = (WAR.PD['西域奇毒'][pid] or 0) + 3
				WAR.PD['毒击'][pid] = (WAR.PD['毒击'][pid] or 0) + 3
				WAR.PD['白驼蛇蛊'][pid] = (WAR.PD['白驼蛇蛊'][pid] or 0) + 3
				Set_Eff_Text(enemyid, "特效文字2", "蛇毒护体")
			end
			--白驼山3级
			if MPTX(eid,8,3) and Curr_NG(eid,104) then	
				local a = JY.Person[eid]["中毒程度"] * dj
				local b = JY.Person[pid]["中毒程度"] * dj
				local c = math.modf((a + b)/2)
				WAR.PD['不破防'][eid] = 1
				hurtjs1[#hurtjs1+1] = a * 0.002
				jsm = jsm + c
				ztd(WAR.CurID,WAR.FXXS,dj*3)
			end
		end
		
		if MPTX(eid,9) then  --唐门
			if JLSD(0,30,eid) then
				if WAR.PD["刺猬状态"][eid] == nil then
					WAR.PD["刺猬状态"][eid] = 2
				end
			end
			WAR.TMFJ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
		end
		
		if MPTX(eid,10) then  --桃花岛
			--桃花岛基础防御
			hurtjs1[#hurtjs1+1] = 0.6;
			--桃花岛2级
			if MPTX(eid,10,2) or match_ID(eid,588) then 
				local nn = math.modf(JY.Person[eid]["内力"]*0.08)
				local mm = math.modf(JY.Person[pid]["内力"]*0.08)
				local nn2 = math.max((nn-mm),0)
				jsm = jsm + nn2
				ang = math.max(ang - nn,0)
				ztd(enemyid,'内力点数',ang)
				ztd(enemyid,'生命点数',nn2)
				Set_Eff_Text(enemyid, "特效文字3","碧海・无量潮生")
				if Curr_NG(eid,251) then
					local str= ""
					local a = math.random(1,8)
					if a == 1 then
						WAR.PD["八门金锁1"][pid] = 10
						WAR.PD['机率下降'][pid] = 10
						str = "・休门"	
					elseif a == 2 then	
					    JY.Person[eid]["生命"] = JY.Person[eid]["生命最大值"]
						Cat('清除所有异常',enemyid)
						str = "・生门"
					elseif a == 3 then	
				        WAR.PD["八门金锁3"][pid] = 10
						ztd(WAR.CurID,"生命点数",-500)
					    str = "・伤门"	
					elseif a == 4 then	
					    WAR.PD["八门金锁4"][pid] = 10
						str = "・杜门"	
					elseif a == 5 then	
					    WAR.PD["八门金锁2"][eid] = 10
						str = "・景门"	
					elseif a == 6 then
					    if WAR.PD["秘孔战术"][pid] == nil then
							WAR.PD["秘孔战术"][pid] = 18
							str = "・死门"	
						end
					elseif a == 7 then	
		    		    ztd(WAR.CurID,"内力点数", -JY.Person[pid]["内力"])
						JY.Person[pid]["内力"] = 1
						WAR.PD['内力恢复停止'][pid] = 2
						str = "・惊门"	
					elseif a == 8 then	
					    JY.Person[eid]["内力"] = JY.Person[eid]["内力最大值"]
						JY.Person[eid]["体力"] = 100
						str = "・开门"								
					end
					Set_Eff_Text(enemyid, "特效文字1","八门金锁阵"..str)
				end		
			end		
		end  
		
		if MPTX(eid,11) then  --一刀流
			if match_ID(eid,92) or match_ID(eid,501) or match_ID(eid,596) then
				dj = 3
			end
			--一刀流1级
			if JLSD(0,40,eid) then
				WAR.DLJ = 1
				WAR.DZY = 1
				WAR.PD['格挡状态'][eid] = 1
				Set_Eff_Text(enemyid,"特效文字1","秘剑・切返")
			end
			--一刀流2级
			if MPTX(eid,11,2) then
				local a = math.modf((TrueYJ(pid) + TrueYJ(eid))/2)
				jsm = jsm + a
				WAR.PD['免疫杀气'][eid] = 1
				if Curr_NG(eid,152) then
					WAR.PD['不漏琉璃'][eid] = 1
				end
			end
		end
		
		if MPTX(eid,12) then  --日月
			--日月基础防御
			if match_ID(eid,27) or match_ID(eid,26) or match_ID(eid,777) then
				dj = 5
			end	 
			hurtjs1[#hurtjs1+1] = JY.Person[eid]["防御力"] / 12000 * dj
			if JLSD(0,20,eid) then
				WAR.PD["吸星真气"][eid] = (WAR.PD["吸星真气"][eid] or 0) + 400
				if WAR.Person[enemyid]["护盾"] == nil or WAR.Person[enemyid]["护盾"] <= -1 then
					WAR.Person[enemyid]["护盾"] = 5
				end
				WAR.Person[enemyid]["特效动画"] = 155
			end
			if Curr_NG(eid,88) then
				WAR.PD["吸星真气"][eid] = (WAR.PD["吸星真气"][eid] or 0) + 300
				if WAR.Person[enemyid]["护盾"] == nil or WAR.Person[enemyid]["护盾"] <= -1 then
					WAR.Person[enemyid]["护盾"] = 5
				end
			end
			--日月3级
			if (MPTX(eid,12,3) and Curr_NG(eid,88)) or match_ID(eid,456) then	
				local jl = 30
				if match_ID(eid,456) then
					jl = 100
				end
				if JLSD(0,jl,eid) then	
					hurtjs1[#hurtjs1+1] = 0.5 
					jsm = jsm + 200
					Set_Eff_Text(enemyid,"特效文字2","星落云散")
				end 
				if JLSD(0,jl,eid) then
					ztd(WAR.CurID,WAR.FXXS,5)
					ztd(WAR.CurID,WAR.LXXS,10)
					ztd(WAR.CurID,WAR.ZSXS,10)
					ztd(WAR.CurID,WAR.BFXS,10)
					addbuff(pid,WAR.PD["迟缓状态"],math.random(4,8),40)
					Set_Eff_Text(enemyid,"特效文字2","星流反照")
				end
			end
		end
		
		if MPTX(eid,13) then  --明教
			jsm = jsm + math.random(100,250)
			--明教基础防御	
			if match_ID(eid,641) then
				dj = 5
			end	
			local p = JY.Person[eid]
			local tymj2 = p["内力"]
			if tymj2 >= 8000 then
            hurtjs1[#hurtjs1+1] = 0.4
			elseif tymj2 >= 6000 then
			hurtjs1[#hurtjs1+1] = 0.3
			elseif tymj2 >= 4000 then
			hurtjs1[#hurtjs1+1] = 0.2	  
			elseif tymj2 >= 2000 then
			hurtjs1[#hurtjs1+1] = 0.1
			end 
			--明教基础防御		
			if MPTX(eid,13,1) then
				ztd(WAR.CurID,'生命点数',-(dj*50))
				ztd(WAR.CurID,'内伤点数',(dj*5))
				ztd(WAR.CurID,WAR.ZSXS,(dj*5))
				if WAR.PD["明教指令4"][pid] ~= nil and WAR.PD["明教指令4"][pid] > 0 then
					local zl = dj+(WAR.PD["明教指令4"][pid] or 0)
					ztd(WAR.CurID,'生命点数',-(dj*50))
					ztd(WAR.CurID,'内伤点数',(dj*5))
					ztd(WAR.CurID,WAR.ZSXS,(dj*5))
				end		
				Set_Eff_Text(enemyid,"特效文字3","焚我残躯")
			end
			--明教3级
			if ((MPTX(eid,13,3) and PersonKF(eid,97)) or match_ID(eid,9)) and JLSD(0,45,eid) then	
				jsm = jsm + 400
				if JLSD(10,35,eid) then
					WAR.DLJ = 1
					ztd(WAR.CurID,"内伤点数",100)
					ztd(WAR.CurID,"中毒点数",100)
					Set_Eff_Text(enemyid,"特效文字3","明尊琉璃・乾坤挪移")
				else
					ztd(WAR.CurID,WAR.ZSXS,30)
				end
				if Curr_NG(eid,97) and JLSD(0,40,eid) then
					local WL = get_skill_power(pid,wugong,11)/2
					for i = 0, WAR.PersonNum - 1 do
						if WAR.Person[i]["我方"] ~= WAR.Person[enemyid]["我方"] and WAR.Person[i]["死亡"] == false then
							ztd(i,"生命点数",-WL)
							SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 9, 9);	--反弹者标识为被命中
						end
					end
					Set_Eff_Text(enemyid,"特效文字1","明尊琉璃・乾坤逆转")
				end
	        end
			--明教3级
			if MPTX(eid,13,3) and Curr_NG(eid,93) and WAR.PD['时序闪避'][eid] == nil then 
				local str = ""
				if JLSD(10, 30 + dj * 5, eid)  then
					WAR.PD['时序闪避'][eid] = limitX((WAR.PD['时序闪避'][eid] or 0) + math.random(5,10) * (dj + 1),0,50)
					Set_Eff_Text(enemyid,"特效文字2","焚影圣诀・暗影封息")
				elseif JLSD(10,40,eid) then
					hurtjs1[#hurtjs1+1] = 0.99
					Set_Eff_Text(enemyid,"特效文字2","焚影圣诀・海市蜃楼")
				end
			end	
			--明教4级
			if MPTX(eid,13,4) and Curr_NG(eid,93) and WAR.PD['时序闪避'][eid] ~= nil then
				ztd(enemyid,"内伤点数",-20)
				local fhurt = math.modf(hurt/12)+Rnd(100)*dj
				ztd(enemyid,"生命点数",fhurt)
				hurtjs2[#hurtjs2+1] = 0
				WAR.PD['时序闪避'][eid] = nil
				Set_Eff_Text(enemyid,"特效文字1","幻光游世・万象天隐")
			end
		end
		
		if MPTX(eid,14) then  --五岳剑派
			--受连击伤害减少，已统一写在hurtjs的部分
			--五岳剑派基础
			if WAR.ACT > 1 then 
				hurtjs1[#hurtjs1+1] = dj * 0.1 * WAR.ACT
				Set_Eff_Text(enemyid,"特效文字3","剑气冲霄")
			end
			--五岳剑派2级弟子
			if MPTX(eid,14,2) then
				hurtjs1[#hurtjs1+1] = 0.5
				Set_Eff_Text(enemyid,"特效文字2","吞气入体・气脉悠长")
				if Curr_QG(eid,262) then
					hurt = math.modf(hurt * 0.8)
					if math.random(10) > 7 then
						WAR.DLJ = 1
					end
				end
			end
            --五岳剑派3级弟子
			if MPTX(eid,14,3) and JLSD(20,50,eid) then
				local a =math.modf(TrueYJ(eid) *0.33)
				jsm = jsm + a
				Set_Eff_Text(enemyid,"特效文字1","护体剑诀")
			end 
			if Curr_QG(eid,262) and JLSD(10,40,eid) then
				local a = math.modf(psx(pid,"品德")*1.2)
				if TFQG(eid,262) then
					a = a * 2
				end
				for j = 0,WAR.PersonNum-1 do
					if DWPD(j,enemyid) and dead(j) == false then
						ztd(j,"集气位置",-a)
					end
				end	
				Set_Eff_Text(enemyid,"特效文字1","以德服人")
			end	
		end
		
		if MPTX(eid,15) then  --大理
			--大理2级
			if match_ID(eid,499) then
				dj = 4
			end	
			if MPTX(eid,15,2) and Curr_NG(eid,207) and JLSD(20,55,eid) then
				local a = JY.Person[eid]["内力最大值"] * 0.00006
				hurtjs1[#hurtjs1+1] = a
				ang = 0
				local a = math.modf(dng/2)
				local b = a / 10
				ztd(enemyid,'内力点数',a)
				ztd(enemyid,'内伤点数',-b)
				addbuff(pid,WAR.PD['利刃寒锋'],10,20)
				Set_Eff_Text(enemyid, "特效文字2", "大理秘技・龙气护体")
			end
			--大理2级
			if MPTX(eid,15,2) and PersonKF(eid,207)  then
				jsm = jsm + math.modf(dng*0.6)
				hurtjs1[#hurtjs1+1] = 0.3
				Set_Eff_Text(enemyid, "特效文字2", "枯荣禅功护体")
			end		
			--大理3级
			if MPTX(eid,15,3) and Curr_NG(eid,314) and JLSD(20,55,eid) then
				ztd(enemyid,'内力点数',-500)
				hurtjs1[#hurtjs1+1] = 0.75
				Set_Eff_Text(enemyid, "特效文字1", "天南易阳・龙脉气护")
			end
			--大理转龙
			if WAR.PD['转龙呼吸'][eid] ~= nil then
				hurtjs1[#hurtjs1+1] = 0.33
				local nn = math.modf(dng/2)
				local nn2 = math.modf(TrueQZ(eid)/33)
				ztd(enemyid,"内力点数",nn)
				ztd(enemyid,"内伤点数",-nn2)
				if JY.Person[pid]["灼烧程度"] < 50 then
					JY.Person[pid]["灼烧程度"] = 50
				else
					ztd(WAR.CurID,WAR.ZSXS,30)
					WAR.PD['无明业火'][pid] = 15
				end
				Set_Eff_Text(enemyid, "特效文字2", "气脉贯通・六气合一")
			end
		end
		
		if MPTX(eid,16) then  --全真
			if match_ID(eid,129) then
				dj = 5 
			end
			if match_ID(eid,64) then
				dj = 4
			end
			if WAR.PD['七星阵步闪避'][eid] == nil then
				WAR.PD['七星阵步闪避'][eid] = 1
			end
			--全真基础恢复
			jsm = jsm + math.random(100,300)*dj
			if MPTX(eid,16,3) then
				local mpdj2 = (dj + math.modf(TrueQZ(pid) * 0.2) + math.modf(TrueYJ(pid) * 0.2)) *0.33
				ztd(enemyid,'生命点数',mpdj2)
				if Curr_NG(eid,100) and JLSD(20,50,eid) then
					jsm = jsm + math.modf(dng*0.3)
					hurtjs2[#hurtjs2+1] = 600
				end
				Set_Eff_Text(enemyid,3,"紫阳罡气・紫气护体")
			end  		
			--全真2级主运金关
			if MPTX(eid,16,2) and JLSD(20,50,eid) then
				ztd(enemyid,"中毒点数",-20)
				ztd(enemyid,"内伤点数",-10)
				ztd(enemyid,"生命点数",500)
				ztd(enemyid,"内力点数",500)
				ztd(enemyid,"体力点数",10)
				hurtjs2[#hurtjs2+1] = 1000
				Set_Eff_Text(enemyid,3,"金关玉锁・牢镇四门")
			end 
		end
		
		if MPTX(eid,17) then  --峨眉
			if WAR.PD['流云逐月闪避'][eid] == nil then
				WAR.PD['流云逐月闪避'][eid] = 1
			end
			--峨眉基础防御
			if match_ID(eid,626) then
				dj = 4
			end	
			if (JY.Person[eid]["品德"] > 50) or match_ID(pid,626) then 
				hurtjs1[#hurtjs1+1] = (JY.Person[eid]["品德"]-30) / 100
			end
			--峨眉2级
			if ((MPTX(eid,17,2) and PersonKF(eid,247)) or match_ID(eid,626)) then 
				hurtjs1[#hurtjs1+1] = 0.5
				if JY.Person[eid]["生命"] + 500 >= JY.Person[eid]["生命最大值"] then
					JY.Person[eid]["生命"] = JY.Person[eid]["生命最大值"]
				else
				    JY.Person[eid]["受伤程度"] = math.floor(JY.Person[eid]["受伤程度"]/2)
					ztd(enemyid,"生命点数",500)
				end
			end  
		end
		
		if MPTX(eid,18) then  --崆峒
			jsm = jsm + math.random(80,300)
			---崆峒减伤
			hurtjs1[#hurtjs1+1] = 0.25
			--崆峒3级
			if MPTX(eid,18,3) then
				local a = math.modf(TrueQZ(eid)/2*dj)
				jsm = jsm + a
			end
			--九天都录
			if WAR.KTAY2 == 1 then
				if JY.Person[eid]["内力"] >= 500 then
					ztd(enemyid,"内力点数", -500)
					hurtjs1[#hurtjs1+1] = 0.5
					jsm = jsm + 500
					Set_Eff_Text(enemyid,2,"崆峒秘法・九天都录",144)
				end
			end	
		end
		--昆仑
		if MPTX(eid,19) then  
			if WAR.PD['顺逆两仪3'][eid] ~= nil and WAR.LYWC > 0 then
				jsm = jsm + math.modf(WAR.LYWC*0.5)
			end	
			if JLSD(0,15,eid) then
				hurtjs2[#hurtjs2+1] = 0
				Set_Eff_Text(enemyid, "特效文字2", "昆仑.坚若磐石",126)
			end
		end
		--雪羽宗防御
		if MPTX(eid,20) then  
			if match_ID(eid,514) then
				dj = 6
			end
			ztd(WAR.CurID,WAR.BFXS,20*dj)	
			if MPTX(eid,20,3) and PersonKF(eid,43) then
				local bf = JY.Person[eid]["冰封程度"]+JY.Person[pid]["冰封程度"]
				jsm = jsm + bf*dj
				if Curr_NG(eid,43) and JLSD(10,40,eid) and JY.Person[eid]["冰封程度"] >= 100 then
					ztd(enemyid,"生命点数",bf*2)
					ztd(enemyid,"内力点数",bf*3)
					JY.Person[eid]["冰封程度"] = math.modf(JY.Person[eid]["冰封程度"]/2)
					ztd(enemyid,"集气位置",math.modf(bf/2))
					Set_Eff_Text(enemyid, "特效文字2", "寒气愈体")
				end
			end
		end
		--花涧派
		if MPTX(eid,21) then  
			--if match_ID(eid,515) then
				--mpdj = 4
			--end	
			local a = JY.Person[eid]["轻功"] / 2
			jsm = jsm + a	
			if JLSD(0,45,eid) then
				WAR.PD['闪避'][eid] = 1
			end    
			--花涧3级
			if MPTX(eid,21,3) and JLSD(20,50,eid) then
				if JLSD(20,50,eid) then
					ztd(enemyid,"内力点数",-2000)
					hurtjs2[#hurtjs2+1] = 100
					Set_Eff_Text(enemyid, "特效文字3", "乘彩舫・过莲塘")
				end
				if JLSD(20,50,eid) then
					local a = JY.Person[eid]["内力"] / 20
					ztd(enemyid,"生命点数",a)
					Set_Eff_Text(enemyid, "特效文字2", "相见处・晚晴天")
				end	
				if JLSD(20,50,eid) then		
					ztd(WAR.CurID,"中毒点数",100)
					ztd(WAR.CurID,"内伤点数",100)
					ztd(WAR.CurID,WAR.LXXS,100)
					ztd(WAR.CurID,WAR.ZSXS,100)
					ztd(WAR.CurID,WAR.BFXS,100)
					ztd(WAR.CurID,WAR.FXXS,20)
					WAR.PD['刺目'][pid] = 2
					Set_Eff_Text(enemyid, "特效文字2", "遗双翠・争窈窕")
				end
			end   
		end
		
		if MPTX(eid,22) then  --中华阁
		    if WAR.ACT == 1 or WAR.Dodge == 1 then	
				local fy = 0
				for i = 0, WAR.PersonNum - 1 do
					local tid = WAR.Person[i]["人物编号"]
					if WAR.Person[i]["我方"] ~= WAR.Person[enemyid]["我方"] and WAR.Person[i]["死亡"] == false and RealJL(enemyid, i, 8) then
						fy = math.modf(JY.Person[tid]["防御力"]/10)
					end
				end
				jsm = jsm + fy
				Set_Eff_Text(enemyid, "特效文字3", "长风破浪会有时 直挂云帆济沧海") 	
			end
		end
		if MPTX(eid,23) then  --背嵬军
			if PersonKF(eid,68) or PersonKF(eid,200) then
				jsm = jsm + TrueTS(eid)
			end
			if MPTX(eid,23,2) then  
		        local zy = (WAR.SPIRIT[eid] or 0)
			    jsm = jsm + math.modf(zy * dj * 1.5)
				if ZYJQ(eid) then
	                jsm = jsm + math.modf(zy * dj * 2.5)
	            end
	        end
			if MPTX(eid,23,4) and PersonKF(eid,200) then  
				if WAR.Adapt[eid][wugong] == nil then
					WAR.Adapt[eid][wugong] = 1
				end
				if WAR.Adapt[eid][wugong] ~= nil then
					WAR.Adapt[eid][wugong] = WAR.Adapt[eid][wugong] + 1
					if WAR.Adapt[eid][wugong] > 10 then
						WAR.Adapt[eid][wugong] = 10
					end
					hurtjs1[#hurtjs1+1] = WAR.Adapt[eid][wugong]/10
					Set_Eff_Text(enemyid, "特效文字2", "招式见破")
					local jp = WAR.Adapt[eid][wugong] 
					if math.random(10) <= jp then
						WAR.PD['闪避'][eid] = 1
					end
				end
			end
			--满江红
			if MPTX(eid,23,4) then
				if JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"]*0.3 and WAR.PD['满江红'][eid] ~= 1 then
					WAR.ACT = 10
					WAR.DLJ = 1
					WAR.DZY = 1
				end
			end
		end
		
		if MPTX(eid,24) then --夜雨楼
			
		end
		
		if MPTX(eid,25) then --护龙山庄
			--侍卫
			ztd(enemyid,"生命点数",200)
			hurtjs2[#hurtjs2+1] = 300
			--庄主
			if MPTX(eid,25,5) or (MPTX(eid,25,4) and Curr_NG(eid,366) and PersonKF(eid,105)) then 
				WAR.HLFJ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
			end		
		end
		
		if MPTX(eid,26) then --云梦涧		
			if JLSD(15,55,eid) then
				WAR.PD['闪避'][eid] = 1
				WAR.PD['云梦涧1'][pid] = 20
			end
			---2级弟子
			if MPTX(eid,26,2) then
				Set_Eff_Text(enemyid,"特效文字2","亭亭玉立")
				hurtjs1[#hurtjs1+1] = 0.85
				WAR.PD['云梦涧2'][pid] = 20
				WAR.PD['免疫杀气'][eid] = 1
				--云梦涧
				if JLSD(20,50,eid) then
					hurtjs1[#hurtjs1+1] = 0.7
					jsm = jsm + 1000	
					Set_Eff_Text(enemyid,"特效文字3","千娇百媚")	
				end
				--云梦涧
				if  JLSD(20,50,eid) then
					WAR.PD['同归状态'][pid] = 1
					Set_Eff_Text(enemyid, "特效文字0", "凡圣同归")
				end
			end	
			--3级弟子
			if MPTX(eid,26,3) then
				WAR.PD['忘情云翳'][pid] = 20
				if JLSD(20,50,eid)  then
					WAR.PD['时序闪避'][eid] = limitX((WAR.PD['时序闪避'][eid] or 0) + 15,0,50)
				end
				Set_Eff_Text(enemyid, "特效文字3", "翩若惊鸿・婉若游龙")
				--云梦涧
				if JLSD(20,50,eid) then
					JY.Person[eid]["受伤程度"] = math.floor(JY.Person[eid]["受伤程度"] / 3)
					ztd(enemyid,'生命点数', math.random(500,2000))
					Set_Eff_Text(enemyid,"特效文字3","艳如桃李")	
				end 
			end
		end
		--兽王庄
		if MPTX(eid,27) then
			local yc = JY.Person[eid]["流血程度"] + JY.Person[eid]["受伤程度"] + JY.Person[eid]["中毒程度"] 
			+ JY.Person[eid]["封穴程度"] + JY.Person[eid]["冰封程度"] + JY.Person[eid]["灼烧程度"]
			local sm = (1-JY.Person[eid]["生命"])/JY.Person[eid]["生命最大值"]/2
			local nl = (1-JY.Person[eid]["内力"])/JY.Person[eid]["内力最大值"]/2
			local tl = (1-JY.Person[eid]["体力"])/300
			local jd = tl+sm+nl
			local jl = 5*MPDJ(eid) + math.modf(Def(enemyid)/40)
			if jd < 0.1 then jd = 0.1 end
			if jd > 1 then jd = 1 end
			hurtjs1[#hurtjs1+1] = jd
			jsm = jsm + yc
			if JLSD(0,jl,pid) then
				WAR.DLJ = 1
				WAR.DZY = 1
				WAR.FLHS5 = 2
				Set_Eff_Text(enemyid,"特效文字0","游龙",61)
			end
			--2级弟子
			if MPTX(eid,27,2) then	
				WAR.SWFJ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
			end
			--3级弟子
			if MPTX(eid,27,3) then
				if JLSD(20,50,eid) then
					WAR.PD["流云飞袖"][eid] = 1
					WAR.PD["格挡状态"][eid] = 1
				end
				Set_Eff_Text(enemyid,"特效文字3","豹王・潜影杀机",61)
			end
		end
		--青城派
		if MPTX(eid,28) then
			--基础防御
			WAR.PD['免疫杀气'][eid] = 1
			WAR.PD['不破防'][eid] = 1
			--2级
			if MPTX(eid,28,2) then
			    hurtjs1[#hurtjs1+1] = 0.5
			end	
			--3级
			if MPTX(eid,28,3) and JLSD(0,35,eid) then
				WAR.PD["格挡状态"][eid] = 1
			end 
		end
		--五毒教
		if MPTX(eid,29) then
			hurtjs1[#hurtjs1+1] = 0.5
			--五毒2级
			if MPTX(eid,29,2) then
				jsm = jsm + 500
				addbuff(pid,WAR.PD['西域奇毒'],15,25)
			end
			--五毒3级
			if MPTX(eid,29,3) then
				WAR.WDFJ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
			end
			--五毒教4级
			if MPTX(eid,29,4) then	
				addbuff(pid,WAR.PD['五毒教1'],15,20)
			end
		end
		--天机宫
		if MPTX(eid,30) or match_ID(eid,635) then 
			hurtjs1[#hurtjs1+1] = 0.5
			--2级弟子
			if MPTX(eid,30,2) and JLSD(20,50,eid) then
				WAR.PD['时序闪避'][eid] = limitX((WAR.PD['时序闪避'][eid] or 0) + 10,0,30)
				Set_Eff_Text(enemyid, "特效文字3", "十方步")
			end
		end
	end
	----------------------------------------------------------------------------------------------
	----------------------护盾减伤及受击效果--------------------------------------------------
	----------------------------------------------------------------------------------------------
	if match_ID(pid,517) == false and (match_ID(eid,601) or match_ID(eid,9808)) and WAR.SXTJ <= 50 then
		hurtjs2[#hurtjs2+1] = math.random(20,30)
		Set_Eff_Text(enemyid, "特效文字1", "机敏无双",90)
	end
	--先天太极
	if match_ID(eid,520) and WAR.PD['先天太极'][eid] ~= nil and WAR.PD['先天太极'][eid] > 0 then
		local cs = ""
		local names = 
		{
		{1, "一"},
		{2, "二"},
		{3, "三"},
		{4, "四"},
		{5, "五"},
		{6, "六"},
		{7, "七"},
		{8, "八"},
		}
		for i,v in ipairs(names) do
			if v[1] == WAR.PD['先天太极'][eid] then
				cs = v[2]
				break
			end
		end
		if WAR.PD['先天太极'][eid] ~= nil then
			Set_Eff_Text(enemyid,"特效文字1","先天太极真气护体"..cs.."层")
		end
	end
	--先天太极
	if WAR.PD['先天太极'][eid] ~= nil and WAR.PD['先天太极'][eid] > 0 then
		WAR.PD['先天太极'][eid] = WAR.PD['先天太极'][eid] - 1	
		WAR.DLJ = 1
		WAR.DZY = 1
		if WAR.PD['先天太极'][eid] <= 0 then 
			WAR.PD['先天太极'][eid] = nil 
			Cat('护盾停止',enemyid)
		end
	end
	--倾国倾城
	if (match_ID(eid,754) or MPTX(eid,26,3)) and WAR.PD['倾国倾城'][eid] ~= nil and WAR.PD['倾国倾城'][eid] > 0 then
		local cs = ""
		local names = 
		{
		{1, "一"},
		{2, "二"},
		{3, "三"},
		{4, "四"},
		{5, "五"},
		}
		for i,v in ipairs(names) do
			if v[1] == WAR.PD['倾国倾城'][eid] then
				cs = v[2]
				break
			end
		end
		if WAR.PD['倾国倾城'][eid] ~= nil then
			Set_Eff_Text(enemyid,"特效文字1","玄元真气护体"..cs.."层")
		end
	end
	--倾国倾城
	if WAR.PD['倾国倾城'][eid] ~= nil and WAR.PD['倾国倾城'][eid] > 0 then
		WAR.PD['倾国倾城'][eid] = WAR.PD['倾国倾城'][eid] - 1
		if WAR.PD['倾国倾城'][eid] <= 0 then 
			WAR.PD['倾国倾城'][eid] = nil 
			Cat('护盾停止',enemyid)
		end
	end
	--奇门护盾
	if WAR.PD['奇门五转'][eid] ~= nil and WAR.PD['奇门五转'][eid] > 0 then
		local qm = WAR.PD['奇门五转'][eid] or 0
		local qmsm = math.modf((WAR.PD['奇门五转'][eid] or 0)*0.4)
		local qmnl = math.modf((WAR.PD['奇门五转'][eid] or 0)*0.7)
		hurtjs1[#hurtjs1+1] = qm/3000
		if WAR.PD['奇门五转'][eid] ~= nil and WAR.PD['奇门五转'][eid] > 3000 then
			ztd(enemyid,"生命点数", qmsm)
			ztd(enemyid,"内力点数", qmnl)
			WAR.PD['奇门五转'][eid] = nil
			Cat('护盾停止',enemyid)
		end
	end
	--长生护盾
	if WAR.PD['长生真气'][eid] ~= nil  and WAR.PD['长生真气'][eid] > 0 then
		hurtjs1[#hurtjs1+1] = WAR.PD['长生真气'][eid]*0.12
		WAR.PD['长生真气'][eid] = WAR.PD['长生真气'][eid] - 1
		if WAR.PD['长生真气'][eid] <= 0 then
			WAR.PD['长生真气'][eid] = nil
			Cat('护盾停止',enemyid)
		end
	end
	--吸星真气
	if WAR.PD['吸星真气'][eid] ~= nil and WAR.PD["吸星真气"][eid] > 0 then 
		if JY.Person[eid]["内力"] > JY.Person[eid]["内力"]/2 then
			jsm = jsm + JY.Person[eid]["内力"]
			ztd(enemyid,"内力点数",-(hurt/4))
			if JY.Person[eid]["内力"] < 1000 then
			    JY.Person[eid]["内力"] = 1000
			end
		else
		    jsm = jsm + WAR.PD["吸星真气"][eid]    
			WAR.PD["吸星真气"][eid] = WAR.PD["吸星真气"][eid] - hurt
			ztd(enemyid,"内力点数",(hurt/4))
			if WAR.PD["吸星真气"][eid] < 0 then
				WAR.PD["吸星真气"][eid] = nil
				Cat('护盾停止',enemyid)
			end
		end
	end
	--龟息蛤蟆减伤
	if NGQH(eid,227) and WAR.PD['蛤蟆蓄力'][eid] ~= nil and WAR.PD['蛤蟆蓄力'][eid] > 0 and hurt > 0 then
		if hurt < WAR.PD["蛤蟆蓄力"][eid] then	 
			WAR.PD["蛤蟆蓄力"][eid] = WAR.PD["蛤蟆蓄力"][eid] - hurt
			hurt = 0
			hurtjs2[#hurtjs2+1] = 0
		else
		    hurt = hurt - WAR.PD["蛤蟆蓄力"][eid]
			WAR.PD["蛤蟆蓄力"][eid] = nil
		end
	end
	--先天罡气
	if WAR.PD["先天护盾"][eid] ~=nil and WAR.PD["先天护盾"][eid] > 0 and hurt > JY.Person[eid]["生命"] then
		if hurt < WAR.PD["先天护盾"][eid] then	 
			WAR.PD["先天护盾"][eid] = WAR.PD["先天护盾"][eid] - hurt
			hurt = 0
			hurtjs2[#hurtjs2+1] = 0
		else
		    hurt = hurt - WAR.PD["先天护盾"][eid]
			WAR.PD["先天护盾"][eid] = nil
			Cat('护盾停止',enemyid)
		end
	end
	--金刚护体
	if WAR.PD["金刚护盾"][eid] ~=nil and WAR.PD["金刚护盾"][eid] > 0 and hurt > 0 then
		if hurt < WAR.PD["金刚护盾"][eid] then	 
			WAR.PD["金刚护盾"][eid] = WAR.PD["金刚护盾"][eid] - hurt
			addbuff(eid,WAR.PD['金刚手'],hurt)
			hurt = 0
			hurtjs2[#hurtjs2+1] = 0
		else
		    hurt = hurt - WAR.PD["金刚护盾"][eid]
			addbuff(eid,WAR.PD['金刚手'],WAR.PD['金刚护盾'][eid])
			WAR.PD["金刚护盾"][eid] = nil
			Cat('护盾停止',enemyid)
		end
	end
	--神足护体	标记修改
	if WAR.PD["神足护盾"][eid] ~=nil and WAR.PD["神足护盾"][eid] > 0 and hurt > 0 then
		if hurt < WAR.PD["神足护盾"][eid] then	 
			WAR.PD["神足护盾"][eid] = WAR.PD["神足护盾"][eid] - hurt
			if  WAR.Person[enemyid]['护盾']==nil or WAR.Person[enemyid]['护盾'] <=-1 then
				WAR.Person[enemyid]['护盾'] = 21
			end
			hurt = 0
			hurtjs2[#hurtjs2+1] = 0
		else
		    hurt = hurt - WAR.PD["神足护盾"][eid]
			WAR.PD["神足护盾"][eid] = nil
			Cat('护盾停止',enemyid)
		end
	end
	--神足乾坤
	if NGQH(eid,233) and WAR.PD['神足乾坤'][eid] ~= nil and WAR.PD['神足乾坤'][eid] > 0 then
		local cs = ""
		local names = 
		{
		{1, "一"},
		{2, "二"},
		{3, "三"},
		{4, "四"},
		{5, "五"},
		{6, "六"},
		{7, "七"},
		{8, "八"},
		}
		for i,v in ipairs(names) do
			if v[1] == WAR.PD['神足乾坤'][eid] then
				cs = v[2]
				break
			end
		end
		if WAR.PD['神足乾坤'][eid] ~= nil then
			Set_Eff_Text(enemyid,"特效文字1","神足真气护体"..cs.."层")
		end
	end
	--神足乾坤
	if WAR.PD['神足乾坤'][eid] ~= nil and WAR.PD['神足乾坤'][eid] > 0 then
		WAR.PD['神足乾坤'][eid] = WAR.PD['神足乾坤'][eid] - 1	
		WAR.DLJ = 1
		if WAR.PD['神足乾坤'][eid] <= 0 then 
			WAR.PD['神足乾坤'][eid] = nil 
			Cat('护盾停止',enemyid)
		end
	end
	--say('减伤计算前伤害：'..hurt,0,1)
	-----------------------减伤效果伤害结算----------------------------------------------------------------------
	if hurt > 0 then
		--奇穴
		if (WAR.PD['鬼龙袭'][eid] ~= nil) or (ZYHBPD(pid) == 2 and WAR.ZYHB == 2 and WAR.PD['真左右互搏'][pid] == 1) 
			or (wugong == 67 and WAR.PD['铁碎牙'][pid] == 3) or (wugong == 340 and WAR.DJTS == 4) then
			hurtjs1 = {}
		end	
		if hurtjs1 ~= nil and #hurtjs1 > 0 then	
			local a = 0
			local d = #hurtjs1
			if WAR.PD['脆弱状态'][eid] ~= nil and WAR.PD['脆弱状态'][eid] > 0 then
				WAR.PD['脆弱状态'][eid] = limitX(WAR.PD['脆弱状态'][eid],1,5)
				if JY.Person[eid]['畅想分阶'] > 2 then
					a = (8 - WAR.PD['脆弱状态'][eid]) * 0.1
				else
					a = (8 - WAR.PD['脆弱状态'][eid]) * 0.05
				end
				WAR.PD["脆弱状态"][eid] = nil	
			end
			local c = limitX(d,1,7) 
			if c == 1 then
				local b = 1 - (hurtjs1[1] - a)
				if b < 0 then 
					b = 0 
					hurt = 0
				end
				hurt = math.modf(hurt * b)
			else
				for i = 1, c do
					local b = 1 - (hurtjs1[i] - a)
					if b < 0 then 
						b = 0 
						hurt = 0
						break
					end
					hurt = math.modf(hurt * b)
				end
			end
			hurtjs1 = {}
		end	
		if jsm > 1 then
			hurt = hurt - jsm
			jsm = 1
		end
		jsm = 1
		if hurt < 0 then 
			hurt = 0 
		end
	end	
	::label2::
	hurt = math.modf(hurt)
	---------------------------破绽整体增伤----------------------------------
	-------------------------------------------------------------------------
	if hurt > 0 and WAR.Weakspot[eid] ~= nil then 
		local num = 0
		if Cat('破绽',enemyid) then
			num = 3
		end
		if wugong == 335 and (WAR.TDJW == 5 or WAR.TDJW == 10) then
			num = 4
		end
		if match_ID(pid,9987) then 
			num = 5
		end		
		if match_ID(pid,635) and (JXPD(pid,635,1) or JY.Person[pid]["实战"] >=500 or isteam(pid) == false) then 
			num = 6   
		end
		local pz_str = "击中破绽";
		if WAR.Weakspot[eid] < num then 
			hurt = math.modf(hurt * (1.15+(WAR.Weakspot[eid]/10)))
			ang = math.modf(ang * (1.15+(WAR.Weakspot[eid]/10)))
			if WAR.PD['无常索命诀'][pid][2] == 1 then
				hurt = math.modf(hurt*2)
			end
			if MPTX(pid,23,4) and Curr_NG(pid,199) then
				local sm = -math.modf(JY.Person[pid]['生命最大值']*0.09)
				ztd(enemyid,"生命点数",-sm)
				pz_str = "惯力破体";
			end					    
			--少林一苇渡江
			if MPTX(eid,5) and Curr_QG(eid,186) then
				ang = ang - JY.Person[eid]["轻功"]
				WAR.PD['集气速度'][eid] = (WAR.PD['集气速度'][eid] or 0) + 5
			end	
			--暗香疏影
			if TFQG(eid,316) then
				WAR.PD['免疫杀气'][eid] = 1
				AddPersonAttrib(pid,"受伤程度", -JY.Person[pid]['受伤程度'])
				AddPersonAttrib(pid,"中毒程度", -JY.Person[pid]['中毒程度'])
				AddPersonAttrib(pid,"冰封程度", -JY.Person[pid]['冰封程度'])
				AddPersonAttrib(pid,"灼烧程度", -JY.Person[pid]['灼烧程度'])
				AddPersonAttrib(pid,"封穴程度", -JY.Person[pid]['封穴程度'])
				AddPersonAttrib(pid,"流血程度", -JY.Person[pid]['流血程度'])
			end	
			if WAR.Weakspot[eid] == 1 then
				pz_str = "再中破绽";
			elseif WAR.Weakspot[eid] == 2 then
				pz_str = "叁中破绽";
			elseif WAR.Weakspot[eid] == 3 then
				pz_str = "肆中破绽";
			elseif WAR.Weakspot[eid] == 4 then
				pz_str = "伍中破绽";
			elseif WAR.Weakspot[eid] == 5 then
				pz_str = "陆中破绽";				
			end
			--葵花点穴
			if (wugong == 226 and PersonKF(pid,226) and PersonKF(pid,201) and (PersonKF(pid,127) or PersonKF(pid,126))) or match_ID(pid,92) then
				ztd(enemyid,"生命点数",-math.modf(WAR.Weakspot[eid]*psx(eid,"封穴程度")))
			end	
			WAR.Weakspot[eid] = WAR.Weakspot[eid] + 1
			if WAR.Person[enemyid]["特效文字0"] ~= nil then
				WAR.Person[enemyid]["特效文字0"] = pz_str.."+"..WAR.Person[enemyid]["特效文字0"]
			else
				WAR.Person[enemyid]["特效文字0"] = pz_str
			end
			--Set_Eff_Text(enemyid, 0, pz_str)
			if WAR.Person[enemyid]["特效动画"] == nil or WAR.Person[enemyid]["特效动画"] == -1 then
				WAR.Person[enemyid]["特效动画"] = 63
			end
		end 
	end
	---------------------------连锁整体增伤----------------------------------
	-------------------------------------------------------------------------
	if hurt > 0 then
		if WAR.Person[WAR.CurID]["我方"] then 
			if WAR.MYCHAIN > 1 then
				hurt = math.modf(hurt * (1 + (WAR.MYCHAIN/90)))
				ang = math.modf(ang * (1 + (WAR.MYCHAIN/90)))
			end
		else
		    if WAR.URCHAIN > 1 then
				hurt = math.modf(hurt * (1 + (WAR.URCHAIN/50)))
				ang = math.modf(ang * (1 + (WAR.URCHAIN/50)))
			end
		end 
	end
	---------------------------蓄力整体增伤----------------------------------
	-------------------------------------------------------------------------
	--蓄力攻击
	if WAR.Actup[pid] ~= nil and WAR.Actup[pid] > 0 and hurt > 0 then
		--主运蛤蟆，伤害一*140%
		if Curr_NG(pid,95)  then
			hurt = math.modf(hurt*(1+0.4))
		--常态，伤害一*120%
		else
			hurt = math.modf(hurt*(1+0.2))
		end
		--太玄金乌
		if WAR.JWDF == 2 then
			hurt = math.modf(hurt*3)
		end
		--易筋须弥山
		if (wugong == 24 and PersonKF(pid,108)) or match_ID(pid, 577) then 
			hurt = math.modf(hurt*4)
		end
	end
	---------------------------防御整体减伤----------------------------------
	-------------------------------------------------------------------------
	--防御状态减伤15%
	if WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0 and hurt > 0 then
		--主运八荒，减伤30%
		if Curr_NG(eid,101) then
			hurt = math.modf(hurt * 0.7)
			--学会八荒，减伤20%
		elseif PersonKF(eid,101) then	
			hurt = math.modf(hurt * 0.8)
		else
			hurt = math.modf(hurt * 0.85)
		end
	end
	---------------------------距离整体减伤----------------------------------
	-------------------------------------------------------------------------
	if hurt > 0 then
		--此处正常判定距离特效
		local offset = math.abs(WAR.Person[WAR.CurID]["坐标X"] - WAR.Person[enemyid]["坐标X"]) 
		+ math.abs(WAR.Person[WAR.CurID]["坐标Y"] - WAR.Person[enemyid]["坐标Y"])
	    if offset > 11 then
	        offset = 11
	    end
		if offset < 1 then
	        offset = 1
	    end
		--萧秋水天剑
		if (match_ID(pid, 652) and JY.Base["天书数量"] > 5) or WAR.YLTW == 1 then
			hurt = math.modf(hurt*(50+(offset-1)*4)/50)
		--寸长寸短使用特殊攻击
		elseif WGZH(pid,165,206) and yongte(wugong) then
			hurt = math.modf(hurt*(50+(offset-1)*2)/50)
	    elseif isteam(pid) == false then 
		--梯云纵
	    elseif Curr_QG(pid,149) == false then
		--剑气碧烟横
	    elseif WAR.JQBYH ~= 1 then 
		--离剑式
	    elseif WAR.JJZC ~= 1 then
		--魔帝BOSS距离越远，伤害越低
	  	elseif match_ID(eid,26) then
		    hurt = math.modf(hurt*(11-offset)/10)
	    else
		    hurt = math.modf(hurt*(100-(offset-1)*3)/100) --距离对应伤害结算 
	    end
	end
	---------------------------闪避清除伤害----------------------------------
	-------------------------------------------------------------------------
	if WAR.Miss[eid] == 1 then 
		hurt = 0
	end
	--强制减伤
	if hurt > 0 then	
		if (not(ZYHBPD(pid) == 2 and WAR.ZYHB == 2 and WAR.PD['真左右互搏'][pid] == 1)) and (not (wugong == 67 and WAR.PD['铁碎牙'][pid] == 3)) 
		and WAR.PD['鬼龙袭'][eid] == nil and (not(match_ID(pid,9927) and NGQH(pid,102) and JY.Person[pid]['资质'] <= 50)) then		
			if hurtjs2 ~= nil then
				if Curr_NG(pid,367) and wgnlxz(wugong) == 0 then
				else
					for i = 1, #hurtjs2 do
						if hurt > hurtjs2[i] then
							hurt = hurtjs2[i]
						end	
					end
					hurtjs2 = {}
				end	
			end
			if hurt < 0 then hurt = 0 end
		end	
	end
	----------------清空伤害-----------------------
	hurt = limitX(math.modf(hurt),0)
	--江南七怪同生共死
	if match_ID(eid,130) or match_ID(eid,131) or match_ID(eid,132) or match_ID(eid,133) or match_ID(eid,134) or match_ID(eid,135) or match_ID(eid,136) then
		local s = 1
		local p = 0
		for j = 0, WAR.PersonNum - 1 do
			local zid = WAR.Person[j]["人物编号"]
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] and (zid == 130 or zid == 131 or zid ==132 or zid == 133 or zid == 134 or zid == 135 or zid == 136) then
				s = s + 3
			end
		end
		p = math.modf(hurt/s)
		for i = 0, WAR.PersonNum - 1 do
			local mid = WAR.Person[i]["人物编号"]	
			if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[enemyid]["我方"] and (mid == 130 or mid == 131 or mid ==132 or mid == 133 or mid == 134 or mid == 135 or mid == 136) then
				ztd(i,'生命点数',-p)
			end
		end	
		hurt = math.modf(hurt/s)
		angzj[#angzj+1] = -s/7
	end
	--一灯保护・渔樵耕读大理四象阵
	if eid==119 or eid==120 or eid==121 or eid==122 then
		local s = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["人物编号"]== 65 and JY.Person[WAR.Person[j]["人物编号"]]["生命"]>0 and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				ztd(j,'生命点数',math.modf(hurt/4))
				ztd(j,'内力点数',math.modf(hurt/4))
				ztd(j,'体力点数',4)
			end
		end
		hurt = math.modf(hurt/5)
	end
	--花间游门派
	if MPTX(eid,21) then
		if Curr_QG(eid,286) then
			local s = 1
			local p = 0
			for j = 0, WAR.PersonNum - 1 do
				local zid = WAR.Person[j]["人物编号"]
				if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] and RealJL(enemyid,j,5) then
					s = s + 2
				end
			end
			p = math.modf(hurt/s)
			for i = 0, WAR.PersonNum - 1 do
				local mid = WAR.Person[i]["人物编号"]	
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[enemyid]["我方"] and RealJL(enemyid,i,5) then
					ztd(i,'生命点数',-p)
				end
			end
			hurt = math.modf(hurt/s)
			angzj[#angzj+1] = -s/10
			if s > 1 then
				ztd(enemyid,'生命点数',s*400)
				ztd(enemyid,'内力点数',s*400)
				Set_Eff_Text(enemyid,2,"繁华盛开")
			end
		end
	end
	--赤血真龙
	if JY.Wugong[281]["名称"] == "赤血真龙诀" or JY.Wugong[281]["名称"] == "赤血真龙诀" then
		if JY.ZLXF == 0 then
			JY.ZLXF = 1
		end
	end
	--赤血苍龙
	if JY.Wugong[282]["名称"] == "赤血苍龙诀" or JY.Wugong[282]["名称"] == "赤血苍龙诀" then 
		if JY.CLXF == 0 then
			JY.CLXF = 1 
		end
	end
	--独孤九剑反击
	if (PersonKF(eid,47) and PersonKF(eid,184)) or match_ID(eid,592) then
		WAR.HFXZ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
	end
	--车神
	if match_ID(eid,524) then
		WAR.CSFJ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
	end	
	--观止
	if match_ID(eid,456) then
		WAR.LMWZ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
	end	
	--真龙心法反击
	if (PersonKF(eid,281) and inteam(eid) and JY.ZLXF == 1) or match_ID(eid,524) or match_ID(eid,776) then 
		WAR.CLFJ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
	end
	--夜雨楼反击
	if QGQH(eid,304,1) then
		  local jl = 30
		  if JY.Person[eid]['门派技能2'] == 486 then
			  jl = jl +15
		  end	
		  if JLSD(10,40,eid) then
			  WAR.PD['闪避'][eid] = 1
			if JLSD(10,15+jl,eid) then
				WAR.PD['夜雨反击'][eid] = {pid,WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
			end
		end
	end
	--峨眉3级・峨眉九阳
	if MPTX(eid,17,3) and PersonKF(eid,242) and JLSD(10,40,eid) then  
		local str = "・转危为安"
		local a = math.modf(hurt*MPDJ(eid)/1.5);
		local b = math.modf(hurt*MPDJ(eid)/15);
		ztd(enemyid,"生命点数",a)
		ztd(enemyid,"内力点数",a)
		ztd(enemyid,"内伤点数",-b)
		ztd(enemyid,"中毒点数",-b)
		ang = 0
		Set_Eff_Text(enemyid,3,"峨眉九阳功"..str)
	end
	--九阳怒涛
	if NGQH(eid,106) and JY.Person[eid]["生命"] > 0 then
		local jl = 40
		if match_ID(eid,648) or match_ID(eid,9966) then
			jl = jl + 10
		end	
		if JLSD(10,jl,eid) then	
			local str = "・氤氲紫气"
			local a = math.modf(hurt/6)*math.random(9)
			local b = 19*math.random(9)
			if JY.Person[eid]["受伤程度"] ~= nil and JY.Person[eid]["受伤程度"] > 0 then
				a = a + math.modf(JY.Person[eid]["受伤程度"]*99)
			end	
			ztd(enemyid,"生命点数",a)
			ztd(enemyid,"内力点数",a)
			ztd(enemyid,"内伤点数",-b)
			ztd(enemyid,"中毒点数",-b)
			if ang >= a then
				ang = ang - a
			else
				ang = 0
			end
			Set_Eff_Text(enemyid,"特效文字2","九阳真气护体"..str)	
		end	
	end
	--剑胆琴心，挨打增加御剑
	if WGZH(eid,47,73) then
		local max_bonus = 1999 - JY.Person[eid]["御剑能力"]
		if WAR.JDYJ[eid] == nil then
			WAR.JDYJ[eid] = 0
		end
		if WAR.JDYJ[eid] < max_bonus then
			WAR.JDYJ[eid] = WAR.JDYJ[eid] + math.modf(hurt/20)
			local jdqx = JY.Person[eid]["御剑能力"] *0.33
			hurt = hurt - jdqx
			Set_Eff_Text(enemyid,"特效文字3","剑胆")
			if WAR.JDYJ[eid] > max_bonus then
				WAR.JDYJ[eid] = max_bonus
			end
		end
	end
	--龟息周天，挨打50%几率增加防御力
	if NGQHB(eid,190) and JLSD(30, 80, eid) then
		local max_bonus1 = 2000 - JY.Person[eid]["防御力"]
		if max_bonus1 < 0 then
			max_bonus1 = 0
		end
		if WAR.GXZT[eid] == nil then
			WAR.GXZT[eid] = 0
		end
		if WAR.GXZT[eid] < max_bonus1 then
			WAR.GXZT[eid] = WAR.GXZT[eid] + hurt
			Set_Eff_Text(enemyid,"特效文字3","龟龙麟凤",63)
			if WAR.GXZT[eid] > max_bonus1 then
				WAR.GXZT[eid] = max_bonus1
			end
		end
	end
	--一苇渡江，挨打40%几率增加轻功
	if Curr_QG(eid, 186) and JLSD(30, 70, eid) then
		local max_bonus1 = 2000 - JY.Person[eid]["轻功"]
		if max_bonus1 < 0 then
			max_bonus1 = 0
		end
		if WAR.YWDJ[eid] == nil then
			WAR.YWDJ[eid] = 0
		end
		if WAR.YWDJ[eid] < max_bonus1 then
			WAR.YWDJ[eid] = WAR.YWDJ[eid] + hurt
			Set_Eff_Text(enemyid,"特效文字3","一苇渡江",155)
			if WAR.YWDJ[eid] > max_bonus1 then
				WAR.YWDJ[eid] = max_bonus1
			end
		end
	end
	--------------------------------------------------------------------------------------------
	------------------------被打回血前，清空伤害，防止伤害出现小数字--------------------------------
	hurt = math.modf(hurt)
	--死亡
	if JY.Person[pid]["生命"] < 0 then
		JY.Person[pid]["生命"] = 0
	end
	--无酒不欢：伤害的结算到此为止，扣除被攻击方血量
	if hurt > 888 and WAR.PD['鬼龙袭'][eid] == nil and (not(match_ID(pid,9927) and NGQH(pid,102) and JY.Person[pid]['资质'] <= 50)) then
		hurt = 888 + math.modf((hurt - 888)^0.9)
		if hurt > 1999 then
			hurt = 1999 + math.modf((hurt - 1999)^0.85)
			if hurt > 3000 then
				hurt = 3000 + math.modf((hurt - 3000)^0.82)
			end
		end
	end
	--say('减伤计算后伤害：'..hurt,0,1)
	---------------------------------------受击记录伤害----------------------------------------------------------
	--太极纯阳伤害计算
	if NGQH(eid,171) then
		WAR.TJJSJS[eid] = hurt
	end
	--太极纯阳
	if WAR.PD['阴阳二气'][eid] ~= nil and WAR.PD['阴阳二气'][eid] > 0 and hurt > 0 then
		hurt = math.modf(hurt*0.1)
		if WAR.PD["借力打力"][eid] == nil then
			WAR.PD["借力打力"][eid] = math.modf((hurt+ang)/2)
		else
			WAR.PD["借力打力"][eid] = (WAR.PD["借力打力"][eid] or 0) + math.modf((hurt+ang)/4)
		end		
		if (WAR.PD["借力打力"][eid] or 0) > 3000 then
			WAR.PD["借力打力"][eid] = 3000
		end	
		WAR.PD["伤害储存"][eid] = (WAR.PD["借力打力"][eid] or 0)
		WAR.PD['阴阳二气'][eid] = WAR.PD['阴阳二气'][eid] - 1	
		if WAR.PD['阴阳二气'][eid] <= 0 then 
			WAR.PD['以静制动1'][eid] = 3
			WAR.PD['阴阳二气'][eid] = nil 
			Cat('护盾停止',enemyid)
		end
	end
	--扫地无形气墙
	if hurt > 0 then
		if match_ID(eid,114) then 
			if WAR.PD['无形气墙'][eid] == nil then 
				WAR.PD['无形气墙'][eid] = hurt
				if WAR.Person[enemyid]['护盾']== nil or WAR.Person[enemyid]['护盾'] <=-1 then
					WAR.Person[enemyid]['护盾'] = 11
				end
			else
			    if hurt < WAR.PD['无形气墙'][eid] then 
					WAR.PD['无形气墙'][eid] = (WAR.PD['无形气墙'][eid] or 0) - math.modf(hurt/3)
					hurt = 0
				else
				    hurt = hurt - (WAR.PD['无形气墙'][eid] or 0)*2
					if hurt < 0 then
						hurt = 0
					end
					WAR.PD['无形气墙'][eid] = nil
					Cat('护盾停止',enemyid)
				end
			end
		end
	end
	--论剑打赢张三丰记录受到的伤害
	if (match_ID(eid,0) and JY.Person[5]["论剑奖励"] == 1) or match_ID(eid,5) then
		if hurt > math.modf(JY.Person[eid]["生命最大值"]/10) then
			WAR.PD['强制减伤'][eid] = JY.Person[eid]["生命最大值"]/10
		end
	end
	if WAR.PD['强制减伤'][eid] ~= nil then
		WAR.PD['强制减伤'][eid] = nil
	end
	--奇门五转
	if Curr_NG(eid,317) and JLSD(40,45,eid) and WAR.QMWZ < 1 then
		if hurt > 0 then
			Set_Eff_Text(enemyid,2,"奇门五转.北水",95)
			ztd(enemyid,"生命点数",(hurt/3))
			if Fjkx(WAR.CurID) ~= 2 then
				if hurt > psx(pid,'生命最大值') then
					hurt = psx(pid,'生命最大值')
				end
				ztd(WAR.CurID,"生命点数",-(hurt/2))
			end	
			if MPTX(eid,10) and JLSD(0,50,eid) then
				WAR.QMWZ = 0
			else
				WAR.QMWZ=WAR.QMWZ+1
			end
		end
	end
	--达摩九阳
	if JFZH(eid,140,243) then
		if WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0 then
			WAR.PD["格挡状态"][eid] = 1
		end
		WAR.PD['苦难达摩'][eid] = (WAR.PD['苦难达摩'][eid] or 0) + hurt
		if WAR.PD['苦难达摩'][eid] > 1500 and hurt > JY.Person[eid]["生命"] then
			if WAR.WTL_PJTL[eid] == nil then
			    WAR.WTL_PJTL[eid] = 2
			end
		end
		if WAR.PD['苦难达摩'][eid] > 2500 then 
		    WAR.PD['苦难达摩'][eid] = 2500 
		end
	end
	--夜雨楼背刺
	if MPTX(pid,24) and WAR.PD['无常索命诀'][pid][3] == 1 and hurt > 0 then
		if Cat('背刺侧攻') == 2 then
			local yyhurt = math.modf(hurt*(100-(MPDJ(pid)*10))*0.01)
			hurt = hurt - yyhurt
			ztd(enemyid,'生命点数',-yyhurt)
			if JLSD(0,MPDJ(pid)*10,pid) then
				for j = 0, WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and WAR.Person[j]['死亡'] == false then
						ztd(j,'生命点数',-math.modf(yyhurt*0.4))
					end
				end
			end	
		elseif Cat('背刺侧攻') == 1 then
			local yyhurt = math.modf(hurt*(100-(MPDJ(pid)*7))*0.01)
			hurt = hurt - yyhurt
			ztd(enemyid,'生命点数',-yyhurt)
			if JLSD(0,MPDJ(pid)*7,pid) then
				for j = 0, WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and WAR.Person[j]['死亡'] == false then
						ztd(j,'生命点数',-math.modf(yyhurt*0.3))
					end
				end
			end
		else
			local yyhurt = math.modf(hurt*(100-(MPDJ(pid)*5))*0.01)
			hurt = hurt - yyhurt
			ztd(enemyid,'生命点数',-yyhurt)
			if JLSD(0,MPDJ(pid)*5,pid) then
				for j = 0, WAR.PersonNum-1 do
					if DWPD(WAR.CurID,j) and WAR.Person[j]['死亡'] == false then
						ztd(j,'生命点数',-math.modf(yyhurt*0.2))
					end
				end
			end	
		end
	end	
	--夜雨楼突袭
	if WAR.PD['潜影突袭'][pid] ~= nil and hurt > 0 then
		if match_ID(pid,517) and  WAR.ACT < 4 then
			local a = math.modf(hurt*0.44)
			if a > 8000 then a = 8000 end
			hurt = hurt - a
			ztd(enemyid,'生命点数',-a)
		end	
		if match_ID(pid,526) and yongjian(wugong) and WAR.ACT < 4 then
			local a = math.modf(hurt*0.33)
			if a > 8000 then a = 8000 end
			hurt = hurt - a
			ztd(enemyid,'生命点数',-a)
		end	
		if match_ID(pid,525) and WAR.PD['南子燎原枪'][pid] ~= nil and WAR.ACT < 4 then
			local a = math.modf(hurt*0.11)
			if a > 8000 then a = 8000 end
			hurt = hurt - a
			ztd(enemyid,'生命点数',-a)
		end	
	end
	if match_ID(pid,9919) and wgnlxz(wugong) == 0 then
		hurt = hurt + limitX(math.modf(psx(pid,'实战')*0.4),0,3000)
	end	
	--先天九阴
	if NGQHB(eid,100) and JLSD(0,30,eid) and hurt > 0 then
		Set_Eff_Text(enemyid,2,"大道无情・运行日月",80)
		ztd(enemyid,"生命点数",500)
		if hurt > 500 then
			hurt = 500
		end
		ztd(WAR.CurID,"生命点数",-math.modf(hurt/3+500))
	end
	------------------------------------挨打回血---------------------------
	--暗香疏影
	if WAR.PD['暗香疏影'][pid] == 1 and hurt > 0 then
		if math.random(100) <= 25 then
			hurt = 0
			WAR.PD['虚邪散魂2'][pid] = 1
		elseif 	math.random(100) >= 75 then
		    hurt = -math.modf(hurt*0.7)
			WAR.PD["回魂仙梦"][pid] = 10
		else
			hurt = math.modf(hurt*0.2)	
		end
	end
	--血海飘香
	if WAR.PD['血海飘香'][pid] == 1 and hurt > 0 then 
		if math.random(100) <= 75 then
			hurt = 0
			WAR.PD['虚邪散魂2'][pid] = 1
			ztd(WAR.CurID,'生命点数',-(WAR.PD['凝血纹印'][eid] or 0))
		else
			hurt = -math.modf(hurt*0.4)
			WAR.PD["回魂仙梦"][pid] = 10
			ztd(WAR.CurID,'生命点数',-math.modf((WAR.PD['凝血纹印'][eid] or 0)*1.5))
		end
	end
	--大理转龙呼吸回血
	if MPTX(eid,15) and WAR.PD["转龙呼吸"][eid] ~= nil and hurt > 0  then
		if math.random(10) > 7 then
			hurt = -math.modf(hurt/2)
		end
	end
	--石破天觉醒后，有30%几率挨打回血
	if (JXPD(eid,38,1) or (Curr_NG(eid,102) and JY.Person[191]["品德"] == 60) or (Curr_NG(eid,102) and not isteam(eid))) and math.random(10) <= 3 then
		if hurt > 0 then
			hurt = -hurt
			Set_Eff_Text(enemyid,2,"混沌太玄",147)
		end
	end
	--天地玄黄・玄
	if TSZH(eid,78,315) and JLSD(20,30,eid) then
		if hurt > 0 then
		   hurt = -math.modf(hurt/3)
		   Set_Eff_Text(enemyid,2,"天地玄黄・玄",145)
		end
	end	
	--贝海石，有15%几率挨打回血
	if (match_ID(eid, 85) or match_ID(eid, 9866)) and math.random(100) >= 85 then
		if hurt > 0 then
			hurt = -math.modf(hurt/5)
			Set_Eff_Text(enemyid,2,"妙手回春",12)
		end
	end
	--天关张三丰
	if WAR.ZDDH == 348 and WAR.PD['天关阵4'][eid] == 5 then
		if hurt > 0 then
			hurt = -hurt
			Set_Eff_Text(enemyid, "特效文字0", "收化反元")
		end
	end
	--秘孔战术
	if WAR.PD["秘孔战术"][pid] ~= nil and WAR.PD["秘孔战术"][pid] > 0 then
		if JY.Person[pid]["生命"] > 1 then
			JY.Person[pid]["生命"] = 1
		end
	end
	if WAR.PD["秘孔战术"][eid] ~= nil and WAR.PD["秘孔战术"][eid] > 0 then
		if JY.Person[eid]["生命"] > 1 then
			JY.Person[eid]["生命"] = 1
		end
	end
	--龟息周天
	if NGQHB(eid,190) and WAR.ACT == 1 and hurt > JY.Person[eid]["生命"] then
		hurt = math.modf(JY.Person[eid]["生命"]/2)
		Set_Eff_Text(enemyid, "特效文字0", "护身甲盾・坚不可摧")
	end
	-----------------------以下不要再写任何伤害加减效果---------------------------------------------------
	--最终伤害结算
	if hurt < 0 then
		hurt = limitX(math.modf(hurt),-8000,-1)
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + AddPersonAttrib(eid, "生命", -hurt)
	else
		if (wugong == 26 or (JXPD(pid,527,1) and yongquan(wugong))) and  match_ID(pid,527) and MPPD(pid) == 24 and Curr_NG(pid,367) then 
			WAR.PD['降龙逆光掌1'][pid] = limitX((WAR.PD['降龙逆光掌1'][pid] or 0) + hurt,0,math.modf(((7-JY.Person[pid]['畅想分阶'])*700)+100))
		end	
		hurt = limitX(math.modf(hurt)*(7+JY.Base['难度'])*0.1,0,8000)
		if MPPD(pid) == 24 and WAR.PD['无常索命诀'][pid][4] == 1 then
			WAR.PD['魂无常'][eid] = hurt
		end	
		if Curr_NG(eid,367) and JLSD(10,35,eid) then
			WAR.DLJ = 1
			WAR.PD['极阴无相3'][eid] = hurt
			hurt = 0
		end	
		if WAR.PD['极阴无相3'][eid] ~= nil then
			local a = WAR.PD['极阴无相3'][eid] or 0
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) - AddPersonAttrib(eid, "生命", -(WAR.PD['极阴无相3'][eid]-a))
			WAR.PD['极阴无相3'][eid] = nil
		end
		--甩锅
		if (match_ID(eid,515) or match_ID(eid,9776)) and JLSD(10,35,eid) then
			WAR.PD['甩锅发动'][eid] = 1
			WAR.PD['免疫杀气'][eid] = 1
		elseif match_ID(eid,748) and hurt > JY.Person[eid]["生命"] and math.random(10) > 5 then
		    WAR.PD['玄之又玄'][eid] = 1
		--文泰来 否极泰来
	    elseif match_ID(eid,151) and WAR.WTL_1[eid] == 0 and hurt > JY.Person[eid]["生命"] then
			WAR.WTL_PJTL[eid] = 20
		--斗酒僧不受连击伤害
		elseif (match_ID(eid,9966) or match_ID(eid,638)) and WAR.ACT > 1 then
		--乾坤逆转
		elseif WAR.PD['明尊逆转'][eid] == 1 and hurt > JY.Person[eid]["生命"] then
			if JY.Person[pid]["生命"] > JY.Person[eid]["生命"] then
				local bl = JY.Person[eid]["生命"]/JY.Person[eid]["生命最大值"]
				if bl < 0.05 then
					bl = 0.05
				end
				JY.Person[pid]["生命"] = bl * JY.Person[pid]["生命最大值"]
				JY.Person[eid]["生命"] = JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"] * JY.Person[eid]["生命最大值"]
			else
				WAR.PD['甩锅发动'][eid] = 1
			end
			addbuff(eid,WAR.PD["神足护盾"],1000)
			local size = 60
			local x = CC.ScreenW/2;
			local y = CC.ScreenH/2;
			local offx = (#"【明尊白莲・倒转乾坤】")*size/4
			local offy = size/2
			for k = 1,10 do
				Cat('实时特效动画')
				Cls()
				Cat('实时特效动画2')
				lib.Background(0,y-50,CC.ScreenW,y+50,98)
				DrawString(x-offx,y-offy,"【明尊白莲・倒转乾坤】",C_GOLD,size);  
				ShowScreen();
				lib.Delay(CC.BattleDelay)
			end
		    WAR.PD['明尊逆转'][eid] = nil
		--华佗
		elseif WAR.PD['华佗'][eid] == 1 and hurt > JY.Person[eid]["生命"] then
			addbuff(eid,WAR.PD["神足护盾"],1000)
		    WAR.PD['华佗'][eid] = nil
		elseif MPTX(eid,25,5) and hurt < JY.Person[eid]["内力"] then
			if WAR.PD['不败金刚'][eid] == nil then
				WAR.PD['不败金刚'][eid] = hurt
			else
				WAR.PD['不败金刚'][eid] = (WAR.PD['不败金刚'][eid] or 0) + hurt
			end
			Set_Eff_Text(enemyid, "特效文字0", "不败金刚")
		elseif WAR.PD['四智妙法'][pid] == 3 and WAR.BJ == 1 then
			local a = hurt - JY.Person[eid]['内力']
			ztd(enemyid,'内力点数',-hurt)
			if a > 0 then
				WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + AddPersonAttrib(eid, "生命", -a)
			end	
			if JLSD(10,30,pid) and psx(eid,'内力') < psx(eid,'生命') then
				JY.Person[eid]['生命'] = psx(eid,'内力')
			end	
		else
			WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + AddPersonAttrib(eid, "生命", -hurt)
		end	 
	end	
	if WAR.PD['鬼龙袭'][eid] ~= nil and psx(eid,'生命') <= 666 then
		if math.random(100) < 85 then
			JY.Person[eid]['生命'] = 0
			Set_Eff_Text(enemyid,4,'鬼龙斩杀')
			WAR.Person[enemyid]['死亡'] = true
			WAR.PD['鬼龙袭'][eid] = nil
		end
	end		
	--say('税后伤害：'..hurt,0,1)
	-----------------------------------------------------------------------------
	--Cat("伤害反弹",enemyid,hurt)
	------------------------------------------------------------------------------------------------
	--------------------------写在hurt结算后：专用于记录与hurt相关-----------------------------------
	------------------------------------------------------------------------------------------------
	--天魔修罗刀
	if ((wugong == 58 and PersonKF(pid,160)) or (MPTX(eid,6,2) and (wugong == 58 or wugong == 63 or wugong == 66))) and hurt > 0 then
		WAR.PD['鬼禅六断'][pid] = (WAR.PD['鬼禅六断'][pid] or 0) + math.modf(hurt/16)
		if WAR.PD['鬼禅六断'][pid] ~= nil and WAR.PD['鬼禅六断'][pid] > 5000 then
			WAR.PD['鬼禅六断'][pid] = 5000
		end
	end
	--胡刀三刀
	if wugong == 67 and WAR.PD['铁碎牙'][pid] ~= nil and WAR.PD['铁碎牙'][pid] == 1 and hurt > 0 then
		local a = hurt
		if a > 1000 then a = math.modf(a*0.1) end
		if a > math.modf(psx(pid,'生命最大值')*0.33) then a = math.modf(psx(pid,'生命最大值')*0.33) end
		WAR.PD['铁碎牙'][pid] = WAR.PD['铁碎牙'][pid] + a
	end
	if wugong == 67 and (Curr_QG(pid,145) or (PersonKF(pid,145) and TrueSD(pid) >= 350) or match_ID(pid,633) or JXPD(pid,1,1)) and JLSD(10,35,pid) then
		if WAR.PD['狱龙破'][eid] ~= nil and JY.Person[eid]['生命'] < 1 and WAR.PD['度化状态'][eid] == nil then
			local n = 0
			for j = 0,WAR.PersonNum - 1 do 
				if DWPD(j,enemyid) == false and WAR.Person[j]['死亡'] == false and j ~= enemyid then
					n = n + 1
				end
			end
			if n > 0 then	
				JY.Person[eid]['生命'] = 1
				WAR.PD['度化状态'][eid] = 1
				Cat('清除所有异常',enemyid)
			end
		end	
	end
	--东方不败：伤害过低额外追加伤害
	if match_ID(pid,27) or match_ID(pid,777) then
		if hurt < math.modf(JY.Person[eid]["生命最大值"]*0.03) then
			ztd(enemyid,'生命点数',-math.modf(JY.Person[eid]["生命最大值"]*0.03))
		end
	end
	--林平之觉醒后，根据伤害回气
	if JXPD(pid,36,1) or match_ID(pid, 9887) then
		local jq = (WAR.JQSDXS[pid] or 0)*3
		if BNJQ(pid) then
			jq = jq * 2
		end
		ztd(enemyid,'生命点数',-jq)
		WAR.LPZ = math.modf(hurt/4)
		if WAR.LPZ > 1000 then
			WAR.LPZ = 1000
		end
	end
	--狄云赤心连城追加连击
	if match_ID(pid,37) or match_ID(pid,9903) then
		if hurt < 500 then
			WAR.ATNum = limitX(WAR.ATNum + 1,1,4)
			for i = 1, 10 do
				DrawStrBox(-1, 24, "赤心连城", M_Red, 20 + i)  
				ShowScreen()
				lib.Delay(20)
			end
		end
	end
	--白万剑
	if (match_ID(pid,43) or match_ID(pid,9823)) and JY.Person[eid]["冰封程度"] > 50 then
		if WAR.PD["利刃寒锋"][eid] == nil then
			WAR.PD["利刃寒锋"][eid] = 5
			WAR.Person[enemyid]["特效动画"] = 116
		end
	end
	--游坦之攻击冰封大于50的敌人，有60%几率将其冻结10时序
    if (match_ID(pid,48) or match_ID(pid,9884)) and JLSD(20,80,pid) then
		if JY.Person[eid]["冰封程度"] > 50 then
			if WAR.PD["利刃寒锋"][eid] == nil then
				WAR.PD["利刃寒锋"][eid] = 10
				Set_Eff_Text(enemyid, 3, "千年冰蚕・冻结",116)
			end
		end
	end
	--被游坦之冰蚕毒掌击中 标记修改
    if WAR.YTZ == 1  then
		addbuff(eid,WAR.PD["冰冻状态"],math.random(10),40)
	end
	--玄慈拳法 集气倒退
		if WAR.YKDD == 1 then
			WAR.PD["伏魔逆气"][pid] = 10
			for j = 0, WAR.PersonNum - 1 do
            local mid = WAR.Person[j]["人物编号"]
			    if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD["集气倒退"][mid] = 10
				end
			end
		end
	--曲非烟
	if WAR.PD['曲夕烟隙'][pid] == 1 then
        WAR.PD["混乱状态"][eid] = 1
    end
    --亦复如是
    if match_ID(eid,577) or (WAR.ZDDH == 288 and eid == 664) then
        WAR.PD['亦复如是'][eid] = 1
        Set_Eff_Text(enemyid, "特效文字0", "亦复如是")
	end
	--白绣
	if match_ID(pid,582) and JY.Person[eid]["冰封程度"] > 50 and (JLSD(20,70,pid) or BNJQ(pid)) then
		if WAR.PD["利刃寒锋"][eid] == nil then
			WAR.PD["利刃寒锋"][eid] = 10
			WAR.Person[enemyid]["特效动画"] = 116
		end
    end
	--胡一刀、装备冷月宝刀攻击冰封大于50的敌人，有60%几率将其冻结10时序
    if (match_ID(pid,633) or JY.Person[pid]["武器"] == 45) and JY.Person[eid]["冰封程度"] > 50 and JLSD(20,80,pid) then
		if WAR.PD["利刃寒锋"][eid] == nil then
			WAR.PD["利刃寒锋"][eid] = 10
			Set_Eff_Text(enemyid, 3, "冷月刀气・冻结",116)
		end
	end
	--阿三、大力金刚指，攻击30%概率冻结10时序	
	if (match_ID(pid,645) or wugong == 135) and JLSD(10,40,pid) then
		if WAR.PD["利刃寒锋"][eid] == nil then
			WAR.PD["利刃寒锋"][eid] = 10
			Set_Eff_Text(enemyid, 3, "大力金刚・碎金断石",98)
		end
	end
    --萧秋水攻击冰封大于50的敌人，有60%几率将其冻结5时序
    if (match_ID(pid,652)  or Curr_NG(pid,177)) and JY.Person[eid]["冰封程度"] > 50 and JY.Base["天书数量"] > 1 and JLSD(20,70,pid) then
		if WAR.PD["利刃寒锋"][eid] == nil then
			WAR.PD["利刃寒锋"][eid] = 5
			Set_Eff_Text(enemyid, 3, "月映",116)
		end
    end   
    --萧秋水攻击燃烧大于50的敌人，将其引燃
    if (match_ID(pid,652)  or Curr_NG(pid,177)) and JY.Person[eid]["灼烧程度"] > 50 and JY.Base["天书数量"] > 2 and JLSD(20,70,pid) then
		if WAR.PD["举火燎原"][eid] == nil then
			WAR.PD["举火燎原"][eid] = 10
			Set_Eff_Text(enemyid, 3, "日明",127)
		end
    end
	--青莲剑歌 创伤
	if WAR.QLJG == 1 then
		WAR.PD['创伤'][eid] = 50
		WAR.PD['血流不止'][eid] = 50
		Set_Eff_Text(enemyid,3,"青莲剑气",80)
	end	
	
	if WAR.DJD == 1 then
		WAR.PD['创伤'][eid] = 30
		Set_Eff_Text(enemyid,3,"创伤")
	end			
			
	--雷动九天
	if WAR.LDJT == 1 then
		addbuff(eid,WAR.WTL_LDJT,1,3)
	end	
	   
	--苗人凤指令 破军
	if match_ID(pid, 3) and WAR.MRF == 1 then
		WAR.PD["散功状态"][eid] = 20
		WAR.PD["破军"][eid] = 10
	end
	--喵太极攻击敌人破军
	if match_ID(pid, 92) and math.random(10) > 5 then
		WAR.PD["散功状态"][eid] = 5
		WAR.PD["力竭"][eid] = 1
		WAR.PD["破军"][eid] = 5
	end
	--商剑鸣八卦游龙
	if match_ID(pid, 722) and wugong == 230 then
		WAR.PD["散功状态"][eid] = 20
		Set_Eff_Text(enemyid,3,"散功")
	end	
	--商夫人八卦游龙
	if match_ID(pid,737) and wugong == 231 then
		WAR.PD["虚弱状态"][eid] =20
		Set_Eff_Text(enemyid,3,"虚弱")
	end
	--金轮，十龙十象蓄力
	if WAR.SLSX[pid] ~= nil then
		WAR.PD["昏迷状态"][eid] = 1
	end
	
	if WAR.PD['降龙・震惊百里'][pid] == 1 then 
		WAR.PD["昏迷状态"][eid] = 1
	end  
	--何太冲，攻击时附加琴音状态，上限20层
	if match_ID(pid, 7) then
		addbuff(eid,WAR.PD["琴音状态"],math.random(3),20)
		Set_Eff_Text(enemyid,0,"铁琴琴音",63)
	end
	
	--任盈盈，攻击时附加琴音状态，上限50层
	if match_ID(pid, 73) then
		addbuff(eid,WAR.PD["琴音状态"],math.random(5),50)
		Set_Eff_Text(enemyid,0,"天魔幻音",63)
	end              
	--剑二十三
	if WAR.SL23 == 1 and JLSD(20,50,pid) then
		WAR.PD["昏迷状态"][eid] = 1
	end	
	
	--擒龙罗汉
	if WAR.KLST == 1 then
		if JLSD(10,30,pid) then
			WAR.PD["锁足状态"][pid] = nil
			WAR.PD["锁足状态"][eid] = 1
		end
		if JLSD(10,30,pid) then
			WAR.PD["盲目状态"][pid] = nil
			WAR.PD["盲目状态"][eid] = 2
		end
		if JLSD(10,30,pid) then
			WAR.PD["同归状态"][pid] = nil
			WAR.PD["同归状态"][eid] = 1
		end
		if JLSD(10,30,pid) then
			WAR.PD["恐惧状态"][pid] = nil
			WAR.PD["恐惧状态"][eid] = 1
		end
		if JLSD(10,30,pid) then
			WAR.PD["昏迷状态"][pid] = nil
			WAR.PD["昏迷状态"][eid] = 1
		end
		if JLSD(10,30,pid) then
			WAR.PD["参合状态"][eid] = WAR.PD["参合状态"][pid] or 0
			WAR.PD["参合状态"][pid] = nil
		end
		if JLSD(10,30,pid) then
			WAR.PD["麻痹状态"][eid] = WAR.PD["麻痹状态"][pid] or 0
			WAR.PD["麻痹状态"][pid] = nil
		end
	end	
	
	
	--卓天雄震天铁掌
	if match_ID(pid,613) and wugong == 205 and JLSD(10,20,pid) then
		WAR.PD["昏迷状态"][eid] = 1
	end	
			
	--雷动九天
	if BNJQ(pid) and WAR.WTL_LDJT[eid] ~= nil and WAR.WTL_LDJT[eid] >=3 then
		WAR.PD["枪神诀2"][eid] = 10
		WAR.WTL_LDJT[eid] = nil
	end	

	--云罗天网 锁足
	if WAR.YLTW == 1 and JLSD(20,70,pid) then
		WAR.PD["锁足状态"][eid] = 1
	end	
			
	--野球拳 锁足
	if WAR.PD['野球拳'][pid] == 3 and JLSD(0,40,pid) then
		WAR.PD["锁足状态"][eid] = 1
	end	
	
	--金蛇缠丝手
	if match_ID(pid,9961) and JLSD(0,30,pid) then
		WAR.PD["锁足状态"][eid] = 1
	end	

	--扫地
	if match_ID(pid,114) and JLSD(0,30,pid) then
		WAR.PD['放下屠刀'][eid] = 5
	end	

	--虚弱1
	if WAR.NZZ1 ==1 then
		WAR.PD["虚弱状态"][eid] = 25
	end
	if  WAR.DHBUFF == 1 then
		WAR.PD["洞火"][eid] = 1
	end	

	--一灯用一阳指，无明业火
	if WAR.WMYH == 1 then
		WAR.PD["无明业火"][eid] = 30
	end
		
	--王重阳1  同归剑气，
	if WAR.TGJF == 1 then
		WAR.PD["同归状态"][eid] = 1
	end	
	
	--无酒不欢：利刃寒锋，修罗+阴风+沧溟，暴怒造成冻结效果
	if WAR.LiRen == 1 then
		if WAR.PD["利刃寒锋"][eid] == nil then
			WAR.PD["利刃寒锋"][eid] = 10
			WAR.Person[enemyid]["特效动画"] = 116
		end
	end	
	--无酒不欢：举火燎原，金乌+燃木+火焰刀，暴怒造成引燃效果
	if WAR.JuHuo == 1 then
		WAR.PD['举火燎原'][eid] =(WAR.PD['举火燎原'][eid] or 0) + math.random(5,8)	
		WAR.Person[enemyid]["特效动画"] = 112
	end
	
	if WAR.PD['西瓜刀'][pid] == 2 then
		if rwnlxz(pid,0) then 
			if WAR.PD["利刃寒锋"][eid] == nil then
				WAR.PD["利刃寒锋"][eid] = 12
				WAR.Person[enemyid]["特效动画"] = 116
			end
		end
		if rwnlxz(pid,1) then 
			WAR.PD['举火燎原'][eid] =(WAR.PD['举火燎原'][eid] or 0) + math.random(5,8)	
			WAR.Person[enemyid]["特效动画"] = 112
		end
	end    
	
	
	--大唐双龙・冰
	if (match_ID(pid,578) or match_ID(pid,9978)) and JLSD(0,50,pid) then
		addbuff(eid,WAR.PD['冰冻状态'],10,40)
		addbuff(eid,WAR.PD['冰冻扣血'],10)
	end	
	
	--圣火明尊
	if match_ID(pid,9992) and JY.Person[eid]["灼烧程度"] > 25 then
		WAR.PD['举火燎原'][eid] =(WAR.PD['举火燎原'][eid] or 0) +  math.random(5,8)
		WAR.Person[enemyid]["特效动画"] = 112
	end
		
	if match_ID(pid,9992) and JY.Person[eid]["灼烧程度"] > 25 then
		for i = 0,WAR.PersonNum -1 do
			if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[enemyid]["我方"] then
				local e = WAR.Person[i]["人物编号"]
				local x1,y1 = WAR.Person[enemyid]["坐标X"],WAR.Person[enemyid]["坐标Y"]
				local x2,y2 = WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"]
				if math.abs(x1-x2) + math.abs(y1-y2) <= 5 then
					WAR.Person[enemyid]["特效动画"] = 112
					WAR.PD['举火燎原'][e] = (WAR.PD['举火燎原'][e] or 0) + math.random(3,5)
					ztd(i,'生命点数',-JY.Person[e]["灼烧程度"])
				end		
			end
		end
	end
	--般若金刚
	if WAR.BRXL == 1 then
		for i = 0,WAR.PersonNum-1 do
			if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[enemyid]["我方"] then
				local e = WAR.Person[i]["人物编号"]
				local p = math.modf(JY.Person[pid]['生命最大值']/20)
				local x1,y1 = WAR.Person[enemyid]["坐标X"],WAR.Person[enemyid]["坐标Y"]
				local x2,y2 = WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"]
				if math.abs(x1-x2) +math.abs(y1-y2) <= 8 then
					ztd(i,'生命点数',-p)
				end		
			end
		end
	end

	--被虚竹生死符击中的
	if WAR.TZ_XZ == 1 then
		WAR.PD["生死符"][eid] = 1
	end
	--黄衫女天罗地网觉醒增加疾风状态
	if Curr_QG(pid,148) and (match_ID(pid,640) or match_ID(pid,605) or match_ID(pid,455)) then
		addbuff(pid,WAR.JFJQ,math.random(3),10)
	end	
	
	--逍遥御风
	if XiaoYaoYF(eid) and JLSD(20,70,eid) and (WAR.XYYF[eid] == nil or WAR.XYYF[eid] < 9) and WAR.YFCS < 3 and WAR.PD['逍遥御风闪避'][eid] == nil then
		local str = "逍遥御风"
		WAR.YFCS = WAR.YFCS + 1
		WAR.XYYF[eid] = (WAR.XYYF[eid] or 0) + 1
		if MPTX(eid,7) and Curr_QG(eid,147) and WAR.XYYF[eid] >= 8 then
			WAR.XYYF[eid] = 11
			WAR.XYYF_10 = 1
			WAR.PD['逍遥御风闪避'][eid] = 20
			str = "逍遥御风・迅"
		elseif WAR.XYYF[eid] == 9 then
			WAR.XYYF[eid] = 11
			WAR.XYYF_10 = 1
			WAR.PD['逍遥御风闪避'][eid] = 10
			str = "逍遥御风・迅"
		end
		Set_Eff_Text(enemyid,"特效文字0",str,153)
	end
	--欧阳锋逆运走火
	--有逆运才会
	if WAR.PD["走火状态"][eid] ~= 1 and match_ID(eid, 60) and PersonKF(eid, 104) then
		if JY.Person[eid]["体力"] > 50 then
			Set_Eff_Text(enemyid, "特效文字3", "真--逆运筋脉走火入魔",math.fmod(wugong,10)+85)
			WAR.PD["走火状态"][eid] = 1
		end
	end

	--何铁手，给攻击方强制上毒
	if match_ID(eid, 83) then
		local d = math.random(45, 50)
		ztd(WAR.CurID,"中毒点数",d)
	end
	
	 --何红药，给攻击方强制上毒
	if match_ID(eid, 176) or match_ID(eid, 9813) then			
		local xnl = 200
		if JY.Person[pid]['中毒程度'] > 50 then 
			ztd(WAR.CurID,"生命点数",-200)
		end
		ztd(WAR.CurID,"中毒点数",20)
		ztd(WAR.CurID,"内力点数",-xnl)
		ztd(WAR.CurID,"体力点数",-5)
	end
	
	--宁中则，降低攻击方体力
	if match_ID(eid,649) or match_ID(eid,9789) then
		local sm = 100 - JY.Person[pid]['体力']
		ztd(WAR.CurID,"体力点数",-math.random(5,10))
		ztd(WAR.CurID,"生命点数",-sm)
		Set_Eff_Text(enemyid, 1, "娇美人妻")
	end

	--大周天功 养生主
	if PersonKF(eid,190) and WAR.ZTHF[eid] == nil then
		local jl = 30
		if Curr_NG(eid,190) then
			jl = 50
		end
		if JLSD(0,jl,eid) then
			WAR.ZTHF[eid] = 10
			Set_Eff_Text(enemyid, 1, "养生主")
		end
	end

	--主运太极神功，60%几率累积太极之形
	if Curr_NG(eid, 171) and JLSD(20,80,eid) then
		addbuff(eid,WAR.TJZX,math.random(1,3),10)
		Set_Eff_Text(enemyid, 3, "太极之形")
	end
	--三丰其徐如林
	if match_ID(eid,5) and isteam(eid) == false and WAR.ZDDH == 348 and JLSD(10,40,eid) then
		Set_Eff_Text(enemyid,0,"其徐如林",6)
		WAR.PD['徐如林'][eid] = limitX((WAR.PD['徐如林'][eid] or 0) + math.random(2,3),0,50)
	end
	--鳌拜满洲摔跤，下回合不可移动
	if (match_ID(pid,603) or match_ID(pid,9915)) and wugong == 119 then
		WAR.PD["锁足状态"][eid] = 1;
		Set_Eff_Text(enemyid, 1, "锁足")
	end
	-------------------------------------------------------------------------------------------------------
	-----------------------------------外功组合攻击、受击效果（不计算伤害）--------------------------------
	-------------------------------------------------------------------------------------------------------
	--太极拳组合
	if hurt > 0 and PersonKF(eid,16) and (PersonKF(eid,99) or PersonKF(eid,171)) then
		if WAR.PD['借力打力'][eid] == nil then
			WAR.PD['借力打力'][eid] = get_skill_power(pid,wugong,11)
			WAR.PD['借力打力'][eid] = limitX((WAR.PD['借力打力'][eid] or 0) + hurt,0,3000)
		else
			WAR.PD['借力打力'][eid] = WAR.PD['借力打力'][eid] + get_skill_power(pid,wugong,11)
			WAR.PD['借力打力'][eid] = limitX((WAR.PD['借力打力'][eid] or 0) + hurt,0,3000)
		end
	end
	--九阴降龙
	if PersonKF(eid,26) and PersonKF(eid,107) then
		--蓄力机制
		if WAR.PD["羽蛇腾云"][eid] == nil or WAR.PD["羽蛇腾云"][eid] == 0 then
			WAR.PD["羽蛇腾云"][eid] = 10
		else
			WAR.PD["羽蛇腾云"][eid] = WAR.PD["羽蛇腾云"][eid] + 10 + math.modf(math.random(2)*5)
		end
		--上限100
		if WAR.PD["羽蛇腾云"][eid] > 100 then
			WAR.PD["羽蛇腾云"][eid] = 100
		end
	end
	--易水寒诀
	if Curr_NG(eid,43) then
		local j = 5
		if match_ID(eid,514) and math.random(10) > 5 then
			j = j + math.modf(math.random(2)*5)
		end
		if WAR.PD["易水寒诀"][eid] == nil or WAR.PD["易水寒诀"][eid] == 0 then
			WAR.PD["易水寒诀"][eid] = j
		else
			WAR.PD["易水寒诀"][eid] = WAR.PD["易水寒诀"][eid] + j + math.modf(math.random(2)*5)
		end
		--上限1080
		if WAR.PD["易水寒诀"][eid] > 100 then
			WAR.PD["易水寒诀"][eid] = 100
		end
	end
	--蛤蟆功蓄力
	if hurt > 0 and PersonKF(eid, 95) then
		if WAR.PD["蛤蟆蓄力"][eid] == nil or WAR.PD["蛤蟆蓄力"][eid] == 0 then
			WAR.PD["蛤蟆蓄力"][eid] = 100+math.modf(hurt);
		else
			WAR.PD["蛤蟆蓄力"][eid] = WAR.PD["蛤蟆蓄力"][eid]+math.modf(hurt)+math.random(50,500);
		end
		if MPTX(eid,8) then
			WAR.PD["蛤蟆蓄力"][eid] = (WAR.PD["蛤蟆蓄力"][eid] or 0)*2
		end	
		if WAR.PD["蛤蟆蓄力"][eid] ~= nil and NGQH(eid,227) == false then
			WAR.PD['蛤蟆蓄力'][eid] = limitX(WAR.PD["蛤蟆蓄力"][eid],0,3000)
		end		
		Set_Eff_Text(enemyid,2,"蛤蟆功蓄力")
	end
	--鲸息功蓄力
	if hurt > 0 and PersonKF(eid,180) then
		--蓄力机制
		if WAR.PD["鲸息蓄力"][eid] == nil or WAR.PD["鲸息蓄力"][eid] == 0 then
			WAR.PD["鲸息蓄力"][eid] = 50+math.modf(hurt);
		else
			WAR.PD["鲸息蓄力"][eid] = WAR.PD["鲸息蓄力"][eid]+math.modf(hurt)+math.random(50,500);
		end
		--上限3000
		if WAR.PD["鲸息蓄力"][eid] > 3000 then
			WAR.PD["鲸息蓄力"][eid] = 3000
		end
	end
	--太极蓄力
	if hurt > 0 and Curr_NG(eid,171) then
		if WAR.PD["太极蓄力"][eid] == nil or WAR.PD["太极蓄力"][eid] == 0 then
			WAR.PD["太极蓄力"][eid] = 50
		end
		if match_ID(eid,5) then
            WAR.PD["太极蓄力"][eid] = (WAR.PD["太极蓄力"][eid] or 0) + math.modf(hurt*1.5)+math.random(35,350)
		else
            WAR.PD["太极蓄力"][eid] = (WAR.PD["太极蓄力"][eid] or 0) + math.modf(hurt)+math.random(20,200);
		end
		--上限2000
		if WAR.PD["太极蓄力"][eid] > 2000 then
			WAR.PD["太极蓄力"][eid] = 2000
			
		end
	end
	--胡刀三刀
	if PersonKF(eid,67) and (Curr_QG(eid,145) or (PersonKF(eid,145) and TrueSD(eid) >= 350) or match_ID(eid,633) or JXPD(eid,1,1)) then
		if hurt > 500 then
			WAR.PD['暴流破'][eid] = limitX((WAR.PD['暴流破'][eid] or 0) + hurt,0,5000)
		end
	end
	--氤氤氲氲
	if Curr_QG(eid,148) and PersonKF(eid,148) and PersonKF(eid,78) then
		if WAR.PD["氤氤氲氲"][eid] == nil or WAR.PD["氤氤氲氲"][eid] == 0 then
			WAR.PD["氤氤氲氲"][eid] = 1
		end
		if WAR.PD["氤氤氲氲"][eid] > 120 then
			WAR.PD["氤氤氲氲"][eid] = 120
		end
	end
	--被无招胜有招、黄衫女 广寒清辉、梁萧谐之道
    if WAR.FQY == 1 or WAR.LXXZD == 1 or WAR.GHQH == 1 then
        WAR.PD["无招胜有招"][eid] = 10
    end
	--虎爪绝户手
	if WAR.HZJHS == 1 then
		lib.Delay(40)
		if JY.Person[eid]["性别"]==0 then
			lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_RED, 128)
			ShowScreen()
			JY.Person[eid]["性别"] = 2
			JY.Person[eid]["半身像"] = 721
			--JY.Person[eid]["头像代号"] = 27
			Set_Eff_Text(enemyid,2,"鸡飞蛋打")
			addbuff(eid,WAR.PD['创伤'],30,40)
			addbuff(eid,WAR.PD['扫荡群魔'],30,40)
			addbuff(eid,WAR.PD['血色诅咒'],20,40)
			addbuff(eid,WAR.PD['极乐血海'],10,10)
			addbuff(eid,WAR.PD['神教逆杀'],5,10)
		end
    end
	--六道尽灭
	if WAR.LDJM == 1 and WAR.LQZ[eid] ~= nil then
		local lq = math.modf(WAR.LQZ[eid] or 0) * 5
		nuqi(eid,-100)
		ztd(enemyid,"生命点数",-lq)
		ztd(enemyid,"内伤点数",100)
		ztd(enemyid,"中毒点数",150)
		ztd(enemyid,WAR.BFXS,100)
		ztd(enemyid,WAR.ZSXS,100)
		ztd(enemyid,WAR.LXXS,100)
		ztd(enemyid,WAR.FXXS,50)
		WAR.PD["中毒不解"][eid] = 30
		WAR.PD["伤重不治"][eid] = 30
		WAR.PD["焚炎不尽"][eid] = 30
		WAR.PD["玄冰不化"][eid] = 30
		WAR.PD["血流不止"][eid] = 30
		WAR.PD["逆转经脉"][eid] = 2
		WAR.PD["神教逆杀"][eid] = 10
	end
	--左右互搏真谛
	if hurt > 0 and ZYHBPD(eid) == 2 then
		if WAR.PD['互搏真谛蓄力'][pid] == nil then
			local a = hurt
			local b = get_skill_power(pid,wugong,11)
			local c = 0
			if a >= b then
				c = a
			else
				c = b
			end	
			if yongquan(wugong) then
				c = math.modf(c*2)
			end	
			if WAR.ZYHB == 1 then
				WAR.PD['互搏真谛蓄力'][pid] = c
			end
		end	
	end
	-------------------------------------------------------------------------------------------------------
	-----------------------------------内功组合攻击、受击效果（不计算伤害）--------------------------------
	-------------------------------------------------------------------------------------------------------
	--混元紫霞
	if NGQHB(eid,90) and JY.Person[eid]["体力"] > 50 and JY.Person[eid]['生命'] < 1 then	
		JY.Person[eid]['生命'] = 600
		WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + 600
		WAR.Person[enemyid]["内力点数"] = (WAR.Person[enemyid]["内力点数"] or 0) + AddPersonAttrib(eid,"内力",600)
		WAR.Person[enemyid]["内伤点数"] = (WAR.Person[enemyid]["内伤点数"] or 0) + AddPersonAttrib(eid,"受伤程度",-100)
		if match_ID(eid,524) then
			WAR.Person[enemyid]["体力点数"] = (WAR.Person[enemyid]["体力点数"] or 0) + AddPersonAttrib(eid,"体力",-15)
		else
			JY.Person[eid]["体力"] = JY.Person[eid]["体力"] - 50
			if JY.Person[eid]["体力"] < 1 then
				JY.Person[eid]["体力"] = 0
			end
		end
		Set_Eff_Text(enemyid,1,"混元紫霞・气行周天")
	end	
	--天魔吸星组合
	if Curr_NG(eid,160) and PersonKF(eid, 88) then
		if WAR.PD["暴走状态"][eid] == nil or WAR.PD["暴走状态"][eid] == 0 then
			WAR.PD["暴走状态"][eid] = 20
		end
		--上限50
		if WAR.PD["暴走状态"][eid] >= 50 then
			WAR.PD["暴走状态"][eid] = 50
		end
		if (WAR.PD["暴走状态2"][eid] == nil or WAR.PD["暴走状态2"][eid] == 0) and WAR.LQZ[eid] == 100 then
		    WAR.PD["暴走状态2"][eid] = 2
		end
	end
	--十三太保横练
	if NGQHB(eid,196) and psxper(enemyid,'生命',0.5,1) then
		if hurt >= psx(eid,'生命') then
			JY.Person[eid]['生命'] = math.modf(JY.Person[eid]['生命最大值']*0.48)
			WAR.BTZT[eid] = 1
			Set_Eff_Text(enemyid,"特效文字0","十三太保横练",31);
		end
	end
	--凝冰成铠
	if NGQHB(eid,216) then
		if match_ID(eid,22) then
            addbuff(eid,WAR.PD["凝冰成铠"],10,100)
		else
            addbuff(eid,WAR.PD["凝冰成铠"],5,100)
		end
	end
	--长生诀蓄力
	if NGQH(eid,203) or ((match_ID(eid,505) or match_ID(eid,578)) and Curr_NG(eid,203)) then
		WAR.PD['长生蓄力'][eid] = (WAR.PD['长生蓄力'][eid] or 0) + math.modf(hurt*0.8)
		local qtxl = {'蛤蟆蓄力','太极蓄力','鲸息蓄力'}
		for xl = 1, #qtxl do
			if WAR.PD[qtxl[xl]][eid] ~= nil and WAR.PD[qtxl[xl]][eid] > 0 then
				WAR.PD['长生蓄力'][eid] = (WAR.PD['长生蓄力'][eid] or 0) + WAR.PD[qtxl[xl]][eid]
			end
		end	
		if WAR.PD['长生蓄力'][eid] > 3000 then
			WAR.PD['长生蓄力'][eid] = 3000
		end
	end
	------------------------------------------------------------------------------------------------------
	-----------------------------------门派攻击、受击效果（不计算伤害）-----------------------------------
	------------------------------------------------------------------------------------------------------
	--武当太极蓄劲
	if match_ID(eid,5) or (MPTX(eid,4,4) and Curr_NG(eid,171) and match_ID(eid, 9820)) then
		if WAR.PD["太极蓄劲"][eid] == nil or WAR.PD["太极蓄劲"][eid] == 0 then
			WAR.PD["太极蓄劲"][eid] = 2
		end
		if JXPD(eid,5,1) then
            WAR.PD["太极蓄劲"][eid] = WAR.PD["太极蓄劲"][eid] + math.random(2)
		else
            WAR.PD["太极蓄劲"][eid] = WAR.PD["太极蓄劲"][eid] + 1
		end
		if WAR.PD["太极蓄劲"][eid] > 18 then
			WAR.PD["太极蓄劲"][eid] = 18
		end
	end
	--少林九阳功概率自动防御 标记修改
	if (PersonKF(eid,243) or MPTX(eid,5,3)) and WAR.Defup[eid] == nil and JLSD(0,40,eid) then
		local s = WAR.CurID
        WAR.CurID = enemyid
		WarDrawMap(0)
		War_DefupMenu()
		WAR.CurID = s
	end	
	--少林九阳功
	if (Curr_NG(eid,243) and WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0) or MPTX(eid,5,3) then
		for j = 0, WAR.PersonNum - 1 do
            if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] and JY.Person[WAR.Person[j]["人物编号"]]["生命"] > 0 then
                ztd(j,'生命点数',200)
				ztd(j,'内力点数',400)
            end
        end
    end
	--大理秘孔战术
	if WAR.MKZS > 0 and inteam(pid) then
		local d = math.modf((JY.Person[pid]["内力"] - JY.Person[eid]["内力"]) / 100)
		local str=""
		if d < 10 then
			d = 10
		end
		ztd(enemyid,WAR.LXXS,d)
		ztd(enemyid,WAR.FXXS,50)
		if WAR.MKZS == 1 then
			JY.Person[eid]["生命"] = 1
			if WAR.PD["秘孔战术"][eid] == nil then
				WAR.PD["秘孔战术"][eid] = 50
			end
		elseif WAR.MKZS == 2 then
			ztd(enemyid,WAR.ZSXS,math.random(25,50))
			WAR.PD["利刃寒锋"][eid] = WAR.PD['利刃寒锋'][eid] or 0 + math.random(5)
			WAR.PD['冰冻状态'][eid] = WAR.PD['冰冻状态'][eid] or 0 + d
		elseif WAR.MKZS == 3 then
			WAR.PD["回魂仙梦"][eid] = WAR.PD["回魂仙梦"][eid] or 0 + math.random(10,15)
		elseif WAR.MKZS == 4 then
			WAR.PD['恐惧状态'][pid] = 1
		end	
	end
	--昆仑刀剑阵
	if WAR.PD['风雷惊蛰4'][eid] ~= nil and JLSD(10,40,pid) then
		Set_Eff_Text(enemyid,3,'狂雷连锁')
		for j = 0,WAR.PersonNum -1 do
			if dead(j)== false and DWPD(WAR.CurID,j) then
				ztd(j,'生命点数',-math.modf((hurt*0.1)+150))
			end		
		end	
	end
	--中华阁真龙心法
    if (PersonKF(eid,281) and inteam(eid) and JY.ZLXF == 1) or match_ID(eid,524) or match_ID(eid,776) then
	    local sbjl = math.modf(((JY.Person[eid]["生命最大值"] - JY.Person[eid]["生命"]) / JY.Person[eid]["生命最大值"]) * 50)
	    if JLSD(10, 50 + sbjl, eid) then
		    WAR.PD['闪避'][eid] = 1
			Set_Eff_Text(enemyid,3,"【游龙身法】")
		end
	end
	------------------------------------------------------------------------------------------------------
	-----------------------------------异常攻击、受击效果（不计算伤害）-----------------------------------
	------------------------------------------------------------------------------------------------------
	--精神错乱
	if WAR.PD['精神错乱'][pid] ~= nil then
		if hurt > 0 then
			ztd(enemyid,'集气位置',math.modf(hurt/6))
			ztd(enemyid,'生命点数',math.modf(hurt/6))
			ztd(WAR.CurID,'生命点数',-math.modf(hurt/6))
			ztd(enemyid,'内力点数',math.modf(hurt/6))
			ztd(WAR.CurID,'内力点数',-math.modf(hurt/6))
		end
	end
	--狂龙天征
	if WAR.PD["虎啸龙吟"][pid] == 1 then
		for j = 0, WAR.PersonNum - 1 do
			if DWPD(WAR.CurID,j) and dead(j) == false then 
				if nokillspeed(j) == false then
					ztd(j,'集气位置',-100)
				end	
			end
		end
	end
	if WAR.PD["虎啸龙吟"][pid] == 2 then
		for i = 1,WAR.PersonNum do
			if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then 
				local e = WAR.Person[WAR.CurID]["人物编号"]
                local x1,y1 = WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"]
                local x2,y2 = WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"]
                if math.abs(x1-x2) +math.abs(y1-y2) <= 5 then
                    WAR.PD["混乱状态"][eid] = 1
                end		
            end
        end
	end
	--负面状态
	if WAR.DN == 1 or WAR.YTML == 1 or WAR.PD['负面状态'][pid] == 1 then
		local DN=math.random(1,16)
		if DN==1 then
		WAR.PD["混乱状态"][eid] = math.random(1,3)
		Set_Eff_Text(enemyid,3,"混乱")
		elseif DN==2 then
		WAR.PD["迟缓状态"][eid] = math.random(5,15)	
		Set_Eff_Text(enemyid,3,"迟缓")
		elseif DN==3 then
		WAR.PD["虚弱状态"][eid] = math.random(30,50)	
		Set_Eff_Text(enemyid,3,"虚弱")
		elseif DN==4 then
		WAR.PD["昏迷状态"][eid] = 1
		Set_Eff_Text(enemyid,3,"昏迷")
		elseif DN==5 then
		WAR.PD["散功状态"][eid] = math.random(35,50)
		Set_Eff_Text(enemyid,3,"散功")
		elseif DN==6 then
		WAR.PD["灵蛇拳"][eid] = math.random(5,15)
		Set_Eff_Text(enemyid,3,"迷茫")
		elseif DN==7 then
		WAR.PD["同归状态"][eid] = 1
		Set_Eff_Text(enemyid,3,"同归")
		elseif DN==8 then
		WAR.PD["无明业火"][eid] = math.random(15,25)
		Set_Eff_Text(enemyid,3,"业火")
		elseif DN==9 then
		WAR.PD["利刃寒锋"][eid] = math.random(5,10)
		Set_Eff_Text(enemyid,3,"冻结")
		elseif DN==10 then
		WAR.PD['创伤'][eid] = math.random(20,35)
		Set_Eff_Text(enemyid,3,"撕裂")
		elseif DN==11 then
		WAR.PD["盲目状态"][eid] = 2
		Set_Eff_Text(enemyid,3,"盲目")
		elseif DN==12 then
		WAR.PD["集气倒退"][eid] = math.random(10,20)
		Set_Eff_Text(enemyid,3,"失智")
		elseif DN==13 then
		WAR.PD["冰冻状态"][eid] = math.random(5,15)	
		Set_Eff_Text(enemyid,3,"冰冻")
		elseif DN==14 then
		WAR.PD["恐惧状态"][eid] = 1	
		Set_Eff_Text(enemyid,3,"止戈")
		elseif DN==15 then
		WAR.PD["放下屠刀"][eid] = math.random(3,5)	
		Set_Eff_Text(enemyid,3,"佛系")
		elseif DN==16 then
		WAR.PD['举火燎原'][eid] = math.random(10,25)	
		Set_Eff_Text(enemyid,3,"点燃")
		end
		if WAR.PD['负面状态'][pid] ~= nil then
			WAR.PD['负面状态'][pid] = nil 
		end	
	end
	--灵鳌分身爆炸
	if eid == 739 and JY.Person[eid]["生命"] < 1 and WAR.PD['伤害储存1'][eid] ~= nil then
		CurIDTXDH(enemyid, 58, 1, "金鳌化生・潮涌暗劲")
		local a = WAR.PD['伤害储存1'][eid]
		for j = 0, WAR.PersonNum -1 do 
			local df = WAR.Person[j]["人物编号"] 
			local offset1 = math.abs(WAR.Person[enemyid]["坐标X"] - WAR.Person[j]["坐标X"]) 
			local offset2 = math.abs(WAR.Person[enemyid]["坐标Y"] - WAR.Person[j]["坐标Y"])	
			if WAR.Person[j]["我方"] ~= WAR.Person[enemyid]["我方"] and WAR.Person[j]["死亡"] == false then
				WAR.TXXS[df] = 1
				ztd(j,'生命点数',-a)
			end
			if WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] and WAR.Person[j]["死亡"] == false then
				if WAR.PD['分身判定'][df] ~= nil then
					WAR.PD['分身判定'][df] = nil
				end
			end	
		end
	end
	-------------------------------------------------------------------------------------------------------
	---------------------------------------奇穴攻击、受击效果（不计算伤害）--------------------------------
	-------------------------------------------------------------------------------------------------------
	--轮回末
	if yongdao(wugong) and DAOQX(pid,'轮回末') >= 1 and JY.Person[eid]['生命'] <= 0 and WAR.PD['轮回末'][eid] == nil then
		local jl = DAOQX(pid,'轮回末')*15
		if JLSD(0,jl,pid) then
			WAR.PD['轮回末'][eid] = 1
		end
		if DAOQX(pid,'涅盘初') == 1 and JLSD(10,30,pid) then
			WAR.PD['涅盘初'][pid] = 1
		end	
	end
	--获取得经验
	WAR.Person[WAR.CurID]["经验"] = WAR.Person[WAR.CurID]["经验"] + math.modf((hurt) / 5)
	--装备获取经验
	if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[enemyid]["我方"] and WAR.ZDDH ~= 226 then
		--武器获取经验
		if JY.Person[pid]["武器"] ~= - 1 then
			JY.Thing[JY.Person[pid]["武器"]]["装备经验"] = JY.Thing[JY.Person[pid]["武器"]]["装备经验"] + 5
			if JY.Thing[JY.Person[pid]["武器"]]["装备经验"] > 100 and JY.Thing[JY.Person[pid]["武器"]]["装备等级"] < 6 then
				JY.Thing[JY.Person[pid]["武器"]]["装备经验"] = 0
				JY.Thing[JY.Person[pid]["武器"]]["装备等级"] = JY.Thing[JY.Person[pid]["武器"]]["装备等级"] + 1
			end
		end
		--防具获取经验
		if JY.Person[eid]["防具"] ~= - 1 then
			JY.Thing[JY.Person[eid]["防具"]]["装备经验"] = JY.Thing[JY.Person[eid]["防具"]]["装备经验"] + 5
			if JY.Thing[JY.Person[eid]["防具"]]["装备经验"] > 100 and JY.Thing[JY.Person[eid]["防具"]]["装备等级"] < 6 then
				JY.Thing[JY.Person[eid]["防具"]]["装备经验"] = 0
				JY.Thing[JY.Person[eid]["防具"]]["装备等级"] = JY.Thing[JY.Person[eid]["防具"]]["装备等级"] + 1
			end
		end
		--坐骑获取经验
		if JY.Person[eid]["坐骑"] ~= - 1 then
			JY.Thing[JY.Person[eid]["坐骑"]]["装备经验"] = JY.Thing[JY.Person[eid]["坐骑"]]["装备经验"] + 5
			if JY.Thing[JY.Person[eid]["坐骑"]]["装备经验"] > 100 and JY.Thing[JY.Person[eid]["坐骑"]]["装备等级"] < 6 then
				JY.Thing[JY.Person[eid]["坐骑"]]["装备经验"] = 0
				JY.Thing[JY.Person[eid]["坐骑"]]["装备等级"] = JY.Thing[JY.Person[eid]["坐骑"]]["装备等级"] + 1
			end
		end		
	end
	
	----------------------------------------------------------免疫一般杀气------------------------------------------------
	--九阴太极
	if NGQH(eid,107) and JLSD(20,50,eid) then
		WAR.PD['不破防'][eid] = 1
		ztd(enemyid,"生命点数",300)
		WAR.DLJ = 1
		WAR.DZY = 1
		Set_Eff_Text(enemyid,"特效文字2","九阴奥义・蛇行狸翻")
	end
	--长春北冥
	if NGQH(eid,183) then	
		WAR.PD['不破防'][eid] = 1
	end
	--葵花紫霞
	if NGQH(eid,105) then
		WAR.PD['不破防'][eid] = 1
	end
	--逆运蛤蟆
	if NGQH(eid,104) then
		WAR.PD['不破防'][eid] = 1
	end
	--东方不败，岳云精忠报国 葵花秘法・化凤为凰免疫一般杀气
	if ((match_ID(eid,27) and PersonKF(eid,105)) or match_ID(eid,568) or match_ID(eid,777)) and BNJQ(eid) then
		WAR.PD['不破防'][eid] = 1
    end	
	--入魔
	if WAR.PD['入魔'][eid] ~= nil and  WAR.PD['入魔'][eid] == 1 then
		WAR.PD['不破防'][eid] = 1
    end	
	--白毫相
	if match_ID(eid, 497) and JLSD(20,70,eid) and (JY.Base["天书数量"] > 1 or isteam(eid) == false) then
		Set_Eff_Text(enemyid,"特效文字1","白毫相",144);
		WAR.PD['不破防'][eid] = 1
	end
	--狄云
	if match_ID(eid,37) and PersonKF(eid,94) then
		Set_Eff_Text(enemyid,"特效文字1","真名神照",89);
		WAR.PD['不破防'][eid] = 1
	end
	--易筋真谛 免杀气
	if Curr_NG(eid,108) and JLSD(30,70,eid) then
		Set_Eff_Text(enemyid,"特效文字1","易筋真谛",39);
		WAR.PD['不破防'][eid] = 1
		if NGQH(eid,108) then
			WAR.PD['免疫杀气'][eid] = 1
		end
	end
	--黑级浮屠
    if match_ID(eid,9930) and JLSD(20,70,eid) then
		WAR.PD['免疫内伤'][eid] = 1
		WAR.PD['不破防'][eid] = 1
        Set_Eff_Text(enemyid, "特效文字1", "黑级浮屠",47)
    end
	--盖世无双，50%几率免内伤，免杀气
	for i = 1, JY.Base["武功数量"] do
		if (JY.Person[eid]["武功" .. i] == 26 or JY.Person[eid]["武功" .. i] == 80) and JY.Person[eid]["武功等级" .. i] == 999 then
			WAR.GSWS = WAR.GSWS + 1
		end
	end
	if WAR.GSWS == 2 then
	    if Curr_NG(eid,204) or JLSD(20,70,eid) then
	        WAR.PD['不破防'][eid] = 1
		    Set_Eff_Text(enemyid,"特效文字1","盖世无双",10)
		else
		    WAR.PD['格挡状态'][eid] = 1
	    end
    end
    if WAR.PD['西瓜刀・天人'][eid] ~= nil then 
		WAR.PD['不破防'][eid] = 1
        Set_Eff_Text(enemyid,"特效文字1","天人合一")
    end
	--龙象般若
	if match_ID(eid,9932) and WAR.Actup[eid] ~= nil then
		WAR.PD['免疫内伤'][eid] = 1
		WAR.PD['不破防'][eid] = 1
		WAR.PD['免疫封穴'][eid] = 1
	end
	--悲天佛怜 
	if match_ID(eid, 9983) and JY.Person[eid]["生命"] < JY.Person[eid]["生命最大值"] * 0.8 then
		WAR.PD['不破防'][eid] = 1
	end
	------------------------------------------------------------免疫强制杀气---------------------------------------
	--木凭・顾影自怜
	if match_ID(eid,763) then
		WAR.PD['免疫杀气'][eid] = 1
	end
	--逍遥游概率免疫集气速度比自己低的人的杀气
	if TFQG(eid,2) and Curr_QG(eid,2) and (WAR.JQSDXS[eid] or 0) > (WAR.JQSDXS[pid] or 0) then
		if JLSD(10,45,eid) then
			WAR.PD['免疫杀气'][eid] = 1
		end
	end
	--真太奥免疫杀气
	if WAR.TJAY == 4 then
		WAR.PD['免疫杀气'][eid] = 1
	end
	if WAR.ZDDH == 348 and WAR.PD['天关阵4'][eid] == 27 then 
		WAR.PD['免疫杀气'][eid] = 1
		ztd(enemyid,'集气位置',1000-WAR.Person[enemyid].TimeAdd)
		Set_Eff_Text(enemyid, "特效文字0", "疾如风",6)
	end
  --------------------------以下是必破气防----------- 
	--刀系大招，忽视绝对气防
	if WAR.ASKD == 1 then
		WAR.PD['必杀气'][pid] = 1
	end
	--太极奥义
    if PersonKF(pid,16) and PersonKF(pid,46) and JLSD(30,70,pid) then
		WAR.PD['必杀气'][pid] = 1
	end
	if wugong == 67 and WAR.PD['铁碎牙'][pid] == 3 then
		WAR.PD['必杀气'][pid] = 1
	end
	--擒龙降龙
	if WAR.QLXL == 2 then
		WAR.PD['必杀气'][pid] = 1
	end
	
    if WAR.PD['侵如火'][pid] == 1 then 
        WAR.PD['必杀气'][pid] = 1
		addbuff(pid,WAR.PD['增加气攻'],100)
		ztd(enemyid,"生命点数",-100)
    end
	
	if WAR.ZDDH == 348 and WAR.PD['天关阵4'][pid] == 50 then
		addbuff(pid,WAR.PD['增加气攻'],500)
		ztd(enemyid,"生命点数",-500)
		WAR.PD['必杀气'][pid] = 1
	end
	
	--冰火夫妻刀
	if WAR.FQDF == 1 then
		WAR.PD['必杀气'][pid] = 1
	end 	
	
	--圣火阴风
	if WAR.HSYFD == 2 then
		WAR.PD['必杀气'][pid] = 1
	end
	
	--太玄青莲
	if WAR.TXQL == 1 then
		WAR.PD['必杀气'][pid] = 1
	end 	
	
	if PersonKF(pid, 252) and JLSD(0, 50, pid) then
		WAR.PD['必杀气'][pid] = 1
	end
	
	--排云掌
	if WAR.BJYPYZ > 9 then
		WAR.PD['必杀气'][pid] = 1
	end
	--天罡大招，忽视绝对气防
	if WAR.JSTG == 1 then
		WAR.PD['必杀气'][pid] = 1
	end
	--浩然罡气
	if match_ID(pid,9946) and BNJQ(pid) then
		WAR.PD['必杀气'][pid] = 1
	end
	--奇门弹指
	if ((wugong == 18 and Curr_NG(pid,251)) or (wugong == 18 and match_ID(pid,57))) then	
		WAR.PD['必杀气'][pid] = 1
	end	
	--陆渐大金刚神力，忽视绝对气防
	if WAR.JGSL == 1 then
		WAR.PD['必杀气'][pid] = 1
	end
	--青莲剑歌绝技，忽视绝对气防
	if WAR.QLJG == 1 then
		WAR.PD['必杀气'][pid] = 1
	end
	--忽视绝对气防
	if WAR.SL23 == 1 then
		WAR.PD['必杀气'][pid] = 1
	end	
	--五岳剑法+五岳剑诀，忽视绝对气防
	if WAR.ZWYJF == 1 then
		WAR.PD['必杀气'][pid] = 1
	end
	if WAR.JMZL == 2 then
	    WAR.PD['侵如火'][pid] = 1
	end
    if WAR.DSP_LM1 == 1	then
	    WAR.PD['必杀气'][pid] = 1
	end	
	--天魔易筋如是我斩
	if WAR.TMYJ1 > 0  then
		local aa = math.modf(JY.Person[eid]["品德"] - JY.Person[pid]["品德"])
		if aa > 30 or MPTX(eid,5) then
			WAR.PD['必杀气'][pid] = 1
		end
	end	
	--龙象之力暴怒，忽视绝对气防
	if WAR.LXZL10 == 1 then
		WAR.PD['必杀气'][pid] = 1
	end				
	--李文秀14书，特效忽视绝对气防
	if WAR.LWX == 1 then
		WAR.PD['必杀气'][pid] = 1
	end
	--郭靖降龙后劲超过11道，忽视绝对气防
	if WAR.YYBJ > 11 then
		WAR.PD['必杀气'][pid] = 1
	end
	--黯然极意
	if WAR.ARJY == 1 then
		WAR.PD['必杀气'][pid] = 1
	end	
	--鲸息功 陷空力
    if WAR.BHJTZ6 == 1 then
       WAR.PD['必杀气'][pid] = 1
    end	    
	if WAR.WYLW5 == 1 then
		WAR.PD['必杀气'][pid] = 1
	end
	if NGQH(pid,183) then
		WAR.PD['必杀气'][pid] = 1
    end
	if (NGQH(pid,108) or (match_ID(pid,114) and Curr_NG(pid,108))) and JLSD(10,40,pid) then
		WAR.PD['神兵'][pid] = limitX((WAR.PD['神兵'][pid] or 0) + 10,0,30)
		Set_Eff_Text(enemyid,2,"易筋神髓・释迦禅意")
	end	
	if WAR.PD['神兵'][pid] ~= nil then
		WAR.PD['必杀气'][pid] = 1
	end	
	--六脉神剑
    if (wugong == 49 and PersonKF(pid,17)) or (match_ID(pid,53) and wugong == 49) then
		WAR.PD['必杀气'][pid] = 1
	end
	
	--陆渐60%几率 大自在相 
	if match_ID(eid, 497) and JLSD(20, 80, eid) and JY.Base["天书数量"] > 3 and WAR.SSESS[eid] ~= nil  then
		WAR.DZZ[eid] = 1	
	end
	--梯云纵横效果
	if QGQH(eid,149,1) then
		local str = ""
		if dng < 300 then
			str = "封魔玄坤"
			WAR.PD['野球拳'][eid] = 3
			WAR.PD['必连击'][eid] = 2
			for ty = 0, WAR.PersonNum-1 do 
				if WAR.Person[ty]["死亡"] == false and WAR.Person[ty]["我方"] == WAR.Person[enemyid]["我方"] then
					WAR.PD['野球拳'][WAR.Person[ty]["人物编号"]] = 3
					WAR.PD['必连击'][WAR.Person[ty]["人物编号"]] = 2
				end
			end
		else
			if JLSD(0,50,eid) and JY.Person[eid]["流血程度"] > 0 then
				ztd(enemyid,WAR.LXXS,-JY.Person[eid]["流血程度"])
				str = "怀若虚云"
			end
			if JLSD(0,50,eid) and JY.Person[eid]["封穴程度"] > 0 then
				ztd(enemyid,WAR.FXXS,-JY.Person[eid]["封穴程度"])
				str = "怀若虚云"
			end
			if JLSD(0,50,eid) and JY.Person[eid]["受伤程度"] > 0 then
				ztd(enemyid,"内伤点数",-JY.Person[eid]["受伤程度"])
				str = "怀若虚云"
			end
			if JLSD(0,50,eid) and JY.Person[eid]["中毒程度"] > 0 then
				ztd(enemyid,"中毒点数",-JY.Person[eid]["中毒程度"])
				str = "怀若虚云"
			end
			if JLSD(0,50,eid) and JY.Person[eid]["冰封程度"] > 0 then
				ztd(enemyid,WAR.BFXS,-JY.Person[eid]["冰封程度"])
				str = "怀若虚云"
			end
			if JLSD(0,50,eid) and JY.Person[eid]["灼烧程度"] > 0 then
				ztd(enemyid,WAR.ZSXS,-JY.Person[eid]["灼烧程度"])
				str = "怀若虚云"
			end
		end	
		if str ~= "" then
			Set_Eff_Text(enemyid,2,"煌煌道威・"..str,159)
		end
	end
	if WAR.PD['醉八仙'][eid] ~= nil or WAR.PD['锁喉'][eid] ~= nil  or WAR.PD['锁喉1'][eid] ~= nil then
		ang = 0
	end
	-----------------------对应气攻结算--------------------------
	if angzj ~= nil then
		for i = 1, #angzj do
			local zj = 0
			zj = angzj[i]
			ang = math.modf(ang*(1+zj))
		end
	end
	--气攻最终
	ang = limitX(math.modf(ang),0)
	-----------------------对应气防结算--------------------------
	if dngzj ~= nil then
		for i = 1, #dngzj do
			local zj = 0
			zj = dngzj[i]
			dng = math.modf(dng*(1+zj))
		end
	end
	--气防最终
	dng = limitX(math.modf(dng),0)
	--破防杀集气计算
	--local killsq = 1
	local killjq = 0--被打的扣集气
	local antishaqi = 0--被打的加集气
	local fanshaqi = 0--打人的扣集气
	--if dng == 0 and hurt > 30 then
	if hurt > 100 then	
		--killjq = math.modf(ang / 20)
		---------------------------------杀气计算------------------------------------
		--say('气攻:'..ang..'，气防：'..dng,0,1)
		if WAR.NGHT == 0 and dng < math.modf(get_skill_power(eid,JY.Person[eid]['主运内功'],11)*0.6) and JLSD(10,45,eid) then
			dng = math.modf(get_skill_power(eid,JY.Person[eid]['主运内功'],11)*0.6)
		end	
		local sz = {0.9,0.7,0.55,0.45,0.4,0.3,0.2,0.1}
		local jssz = sz[JY.Person[pid]['畅想分阶']+1] * 1000
		local jssz1 = sz[JY.Person[pid]['畅想分阶']+1] * 1200
		killjq = limitX(math.modf((ang - dng)*0.6),0,jssz)
		if WAR.PD['必杀气'][pid] ~= nil then
			if killjq <= 0 then
				killjq = limitX(math.modf(ang/25),100,jssz)
			end
			WAR.PD['必杀气'][pid] = nil	
		end
		if WAR.PD['增加气攻'][pid] ~= nil and WAR.PD['增加气攻'][pid] > 0 then
            local n = WAR.PD['增加气攻'][pid]
			if n > 1000 then n = math.modf(n*math.random(7,10)*0.1) end
			killjq = killjq + n
        end
		--金关领悟 杀意波动
		if NGQH(pid,249) and JLSD(10,60,pid) then
			killjq = math.modf(killjq * 2)
			local aa = killjq
			if aa < 100 then
				aa = 100
			end
			ztd(enemyid,"内力点数",-aa)
			Set_Eff_Text(enemyid,2,"杀意波动・凝气破脉")
		end 
		--太玄金乌
		if WAR.JWDF == 3 then
		    killjq = killjq + 300
	    end 
		--一文字
		if WAR.YYDL1 == 7 or WAR.YYDL1 == 11  then
		    killjq = killjq + 300
	    end
		--雪羽宗杀气
		if MPTX(pid,20,4) then
			killjq = killjq + psx(eid,"冰封程度")
			Set_Eff_Text(enemyid,3,"寒梅傲雪")
		end	
		--先天护盾
		if WAR.PD['先天护盾'][eid] ~= nil then
			WAR.PD['先天护盾'][eid] = (WAR.PD['先天护盾'][eid] or 0) + killjq
			if WAR.PD['先天护盾'][eid] ~= nil and WAR.PD['先天护盾'][eid] > 4000 then
				WAR.PD['先天护盾'][eid] = 4000
			end
		end	
		if MPTX(eid,16,2) and Curr_NG(eid,100) then 
			if WAR.PD['先天护盾'][eid] == nil then
			    WAR.PD['先天护盾'][eid] = killjq
			else
			    WAR.PD['先天护盾'][eid] = (WAR.PD['先天护盾'][eid] or 0) + killjq
			end
			if WAR.PD['先天护盾'][eid] ~= nil and WAR.PD['先天护盾'][eid] > 5000 then
				WAR.PD['先天护盾'][eid] = 5000
			end
		end
		if WAR.PD['西瓜刀'][pid] == 1 then 
            WAR.PD['回气'][pid] = (WAR.PD['回气'][pid] or 0) + killjq
        end
		--武当2级弟子 无极
		if WAR.WJ[pid] ~= nil then
			killjq  = killjq + math.modf(WAR.WJ[pid] / 2)
		end	
        if MPTX(eid,4,2)then 
		    if WAR.WJ[eid] == nil then
			    WAR.WJ[eid] = killjq
			else
				WAR.WJ[eid] = WAR.WJ[eid] + killjq
		    end
			if WAR.WJ[eid] ~= nil and WAR.WJ[eid] >= 10000 then
				WAR.WJ[eid] = 10000
			end
	    end
		--以柔克刚
		if WGZH(eid,36,46) then
			local jl = 50
			local heal_amount = math.modf(killjq/2)
			if match_ID(eid,5) or match_ID(eid,95) or match_ID(eid,456) or match_ID(eid,9878) then
				jl = 100
			end	
			if Curr_QG(pid,149) then
				heal_amount = heal_amount + math.random(200,500)
			end
			if JLSD(0,jl,pid) then
				WAR.Person[enemyid]["生命点数"] = (WAR.Person[enemyid]["生命点数"] or 0) + AddPersonAttrib(eid,"生命",math.modf(heal_amount))
				--Cls()
				--War_Show_Count(WAR.CurID, "以柔克刚恢复生命")
			end
		end
		--------------------------自己加集气---------------------------
		if Curr_NG(eid, 227) and WAR.Defup[eid] ~= nil and WAR.Defup[eid] > 0 then
			if WAR.Person[enemyid].TimeAdd <= 0 then
				ztd(enemyid,'集气位置',0 - WAR.Person[enemyid].TimeAdd)
				WAR.PD['免疫杀气'][eid] = 1
				if JLSD(0,35,eid) then
					antishaqi = antishaqi + 100
				end
				Set_Eff_Text(enemyid,"特效文字1","伺机而动")
			end
		end
        --太玄之轻，把被杀的集气转为自己的集气值
		if WAR.TXZQ[eid] ~= nil and WAR.TXZQ[eid] == 1 then
			antishaqi = antishaqi + killjq
			Set_Eff_Text(enemyid,"特效文字0","太玄之轻")
		end
		--九阳怒涛
		if NGQH(eid,106) then	
			antishaqi = antishaqi + killjq	
		end
		--太极纯阳
		if NGQH(eid,171) or match_ID(eid,92) then	
			antishaqi = antishaqi + 500
		    Set_Eff_Text(enemyid,"特效文字2","太极・白鹤亮翅")
	    end
		--唐门模式	
		if MPTX(eid,9) and WAR.TMMS[eid] == 1 and WAR.ACT == 1 then 
			antishaqi = antishaqi + 200
		end
		--桃花岛
		if (MPTX(eid,10) and PersonKF(eid,237)) or match_ID(eid,57) or match_ID(eid,588) then
			antishaqi = antishaqi + killjq*2
			Set_Eff_Text(enemyid,"特效文字3","旋风扫叶")
		end
		--一刀流
		if MPTX(eid,11) then
			antishaqi = antishaqi + math.modf(TrueYJ(eid)/3)
			Set_Eff_Text(enemyid,"特效文字2","逆流")	
		end
		--刀宗
		if match_ID(eid,501) or match_ID(eid,92) or match_ID(eid,596) then
			antishaqi = antishaqi + TrueYJ(eid)	
		end
		--兽王庄
		if MPTX(eid,27,2) then
			antishaqi = antishaqi + 300
			Set_Eff_Text(enemyid,"特效文字2","隼旋")	
		end 	
		--真龙心法
	    if (PersonKF(eid,281) and inteam(eid) and JY.ZLXF == 1) or match_ID(eid,524) or match_ID(eid,776) then
		    antishaqi = antishaqi + 500
			Set_Eff_Text(enemyid,"特效文字2","真龙飞升")
		end
		--太空卸劲，挨打自己集气
		if WAR.TKJQ[eid] ~= nil and WAR.TKJQ[eid] == 1 then
			antishaqi = antishaqi + 100
		end
		--陆渐，被打加200集气	
		if WAR.DZZ[eid] ~= nil and WAR.DZZ[eid] == 1 then
			antishaqi = antishaqi + 200
			Set_Eff_Text(enemyid,"特效文字1","大自在相")
		end
		--除却四相，50%几率被打加100集气		
        if ChuQueSX(eid)>=3 and JLSD(20, 70, eid) then
			antishaqi = antishaqi + 100
			Set_Eff_Text(enemyid,"特效文字2","无人相")
		end
		--龙象般若
		if match_ID(eid,9932) and WAR.Actup[eid] ~= nil then
			antishaqi = antishaqi + 100
			Set_Eff_Text(enemyid,"特效文字2","龙象・反冲劲")		
        end
		--神行百变，被打加反加集气	
		if Curr_QG(eid,146) then
			local sxjl = 30
			if MPTX(eid,18) then
				sxjl = 50
			end	
			if JLSD(0,sxjl,eid) then
				local kjq = math.modf(killjq*0.5+100)
				if QGQH(eid,146,2) then
					kjq = kjq * 3
				elseif QGQH(eid,146,1) then
					kjq = kjq * 2
				else
				end
				antishaqi = antishaqi + kjq
				if JY.Person[eid]["天赋轻功"] == 146 then
					antishaqi = antishaqi + 100
				end
				if match_ID(eid, 629) then
					if (WAR.LQZ[eid] or 0) < 100 then
						WAR.LQZ[eid] = 100
					end
				end
				if 	match_ID(eid,607) or match_ID(eid,717) or match_ID(eid,54) then
					if WAR.PD['神行百变闪避'][eid] == nil then
						WAR.PD['神行百变闪避'][eid] = 3
					end
				end	
				Set_Eff_Text(enemyid, "特效文字2", "神行百变")
			end	
		end
		--阴圣
		if WAR.PD['阴圣再临'][eid] ~= nil then
			antishaqi = antishaqi + (killjq*1.2)
		end
		-----------------杀攻击者的气
		--极限挑战npc防御特效
		if (not inteam(eid)) and JY.Person[456]["论剑奖励"] > 0 then
			local jx = {90,70,60,45,30,20,10,0}
			local jsjx = jx[JY.Person[eid]['畅想分阶']+1]
			local fy = math.random(1,4)
			if math.random(100) <= jsjx then
				if fy == 1 then
					WAR.PD['免疫杀气'][eid] = 1
					WAR.PD['不破防'][eid] = 1
					Set_Eff_Text(enemyid,"特效文字3","不动")
				elseif fy == 2 then
				    WAR.DLJ = 1
					WAR.DZY = 1
					Set_Eff_Text(enemyid,"特效文字3","据守")
				elseif fy == 3 then
				    fanshaqi = fanshaqi + JY.Base["周目"]
					antishaqi = antishaqi + JY.Base["周目"]
					Set_Eff_Text(enemyid,"特效文字3","宝衣")
				elseif fy == 4 then
				    ztd(enemyid,'内伤点数',-10)
					ztd(enemyid,'中毒点数',-10)
					ztd(enemyid,WAR.LXXS,-10)
					ztd(enemyid,WAR.ZSXS,-10)
					ztd(enemyid,WAR.BFXS,-10)
					ztd(enemyid,WAR.FXXS,-10)
					Set_Eff_Text(enemyid,"特效文字3","轻身")
				end
			end
		end
		--太极功太极剑
	    if (PersonKF(eid,46) and Curr_NG(eid,171)) or match_ID(eid,5) then
			fanshaqi = fanshaqi + 200
		end
		--纯阳太极
		if (PersonKF(eid,171) and Curr_NG(eid,99) and WAR.CYAY == 1) or match_ID(eid, 5) then 
		    fanshaqi = fanshaqi + killjq
		end
		--天池怪侠
		if match_ID(eid,9988) and JLSD(20,50,eid) then
		   fanshaqi = fanshaqi + killjq/2
		   Set_Eff_Text(enemyid,"特效文字3","百花行逆")
		end
		--奇门五转
		if PersonKF(eid, 317) and JLSD(80,85,eid) then
			Set_Eff_Text(enemyid,"特效文字0","奇门五转・气反")
			antishaqi = antishaqi + killjq/2
			fanshaqi = fanshaqi + killjq/2
		end
		--阿九 杀自己的气变成杀攻击者的气
		if WAR.FGPZ[eid] ~= nil and WAR.FGPZ[eid] == 1 then
		    antishaqi = antishaqi + killjq/2
		    fanshaqi = fanshaqi + killjq/2
		    WAR.FGPZ[eid] = nil
		end
		--太极功太极剑
	    if ((PersonKF(eid,46) and Curr_NG(eid,171)) or match_ID(eid,5)) and JLSD(10,60,eid) then
			if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[enemyid]["我方"] then
		        if (math.random(1000) + JY.Person[eid]["防御力"]) > 200 and ang > 0 then
			        if ang < 0 then
				        ang = 0
			        end
				    local aa = 0	
			        for j = 0,WAR.PersonNum-1 do
				        if WAR.Person[j]["死亡"] == false and DWPD(j,enemyid) and nokillspeed(j) == false then
					        local x0 = WAR.Person[WAR.CurID]["坐标X"];
					        local y0 = WAR.Person[WAR.CurID]["坐标Y"];
					        local dx = WAR.Person[j]["坐标X"] - x0
					        local dy = WAR.Person[j]["坐标Y"] - y0
					        local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
					        local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
					        local w,h = CC.Fontsmall,CC.Fontsmall+5;
					        local len = string.len("太极剑法・以慢打快")/2
					        local fx = rx-len*w/2
					        local fy = ry-h*1
					        DrawString(fx,fy,"太极剑法・以慢打快",C_GOLD,CC.Fontsmall)
					        ShowScreen()
					        if ang ~= 0 then 
							    ztd(j,"集气位置",-math.floor((ang)/5))
					        end
				        end
			        end
			        local x0 = WAR.Person[WAR.CurID]["坐标X"];
			        local y0 = WAR.Person[WAR.CurID]["坐标Y"];
			        local dx = WAR.Person[enemyid]["坐标X"] - x0
			        local dy = WAR.Person[enemyid]["坐标Y"] - y0
			        local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
			        local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
			        local w,h = CC.Fontsmall,CC.Fontsmall+5;
			        local len = string.len("太极剑法・后发先至") / 2 + string.len(ang)
			        --local fx = rx - len * w / 2
			        --local fy = ry - h * 2
			        DrawString(rx,ry,"太极剑法・后发先至",C_RED,CC.Fontsmall)
			        ShowScreen()
			        lib.Delay(1000)
			        Cls()
				end
	        end
	        if WAR.tmp[7500 + WAR.CurID] == 1 and WAR.Person[WAR.CurID]["Time"] >= 1000 then
		        fanshaqi = fanshaqi + 300
	        end	
        end
		--以柔克刚
		if WGZH(pid,36,46) then
			local jl = 50
			local heal_amount = math.modf(fanshaqi/2)
			if match_ID(pid,5) or match_ID(pid,95) or match_ID(pid,456) or match_ID(pid,9878) then
				jl = 100
			end	
			if Curr_QG(pid,149) then
				heal_amount = heal_amount + math.random(200,500)
			end
			if JLSD(0,jl,pid) then
				WAR.Person[WAR.CurID]["生命点数"] = (WAR.Person[WAR.CurID]["生命点数"] or 0) + AddPersonAttrib(pid,"生命",math.modf(heal_amount))
				Cls()
				War_Show_Count(WAR.CurID, "以柔克刚恢复生命")
			end
		end
		Cat('伤害杀气反弹',enemyid,hurt,killjq)
		--死亡
		-----------------减少杀气总量
		--龙象减少杀气
		if PersonKF(eid, 103) then
			killjq = math.modf(killjq * 0.8)
		end
		--如果学了八荒不受伤害杀集气
		if Curr_NG(eid, 101) then
			killjq = math.modf(killjq * 0.6)
		elseif PersonKF(eid, 101) then
			killjq = math.modf(killjq * 0.8)
		end
		--太玄组合
		if WAR.PD["太玄组合防御2"][eid] ~= nil then
			killjq = math.modf(killjq * 0.5)
		end
		--长生组合
		if WAR.PD['长生真气'][eid] ~= nil then
			killjq = math.modf(killjq * 0.7)
		end	
		--金刚铁布
		if NGQH(eid,144) then
			if JLSD(10,50,eid) or BNJQ(eid) then
				killjq = math.modf((killjq - 333) / 2)
			end
		end	
		--太极纯阳
		if NGQH(eid,171) or match_ID(eid,92) then
			if WAR.TJSG[eid] == nil or WAR.TJSG[eid] == 0 then
			    WAR.TJSG[eid] =  math.modf(killjq * 1.5)
		    else
			    WAR.TJSG[eid] = WAR.TJSG[eid] + math.modf(killjq * 1.5)
		    end
		    if WAR.TJSG[eid] > 5000 then 
		        WAR.TJSG[eid] = 5000 
		    end
		end
		--蛤蟆逆运
        if NGQH(eid,95) then
			if WAR.HMJT[eid] == nil or WAR.HMJT[eid] == 0 then
			    WAR.HMJT[eid] = killjq * 2 + 200;
		    else
			    WAR.HMJT[eid] = WAR.HMJT[eid] + killjq * 2 + 200;
		    end
		    if WAR.HMJT[eid] > 5000 then 
		        WAR.HMJT[eid] = 5000 
		    end
			killjq = killjq - (WAR.HMJT[eid] or 0)
			Set_Eff_Text(enemyid,"特效文字1","气吞山河・吞")
		end
		local jgjsq = 0
		if NGQH(eid,249) and JLSD(10,45,eid) then
			jgjsq = math.modf(JY.Person[eid]["内力"] * 0.5)	
			killjq = killjq - jgjsq
			Set_Eff_Text(enemyid,3,"杀意波动.气脉回旋",114)
		end
		if WAR.PD['不破防'][eid] ~= nil and killjq > 0 then
			if math.random(10) > 9 then
				killjq = 0
			else
			    killjq = math.modf(killjq*0.01)
			end
			WAR.PD['不破防'][eid] = nil
		end
		if WAR.PD['醉八仙'][eid] ~= nil or WAR.PD['虎辟'][eid] ~= nil or WAR.PD['坚甲状态'][eid] ~= nil or WAR.PD['锁喉1'][eid] ~= nil or WAR.PD['以静制动1'][eid] ~= nil or WAR.PD['锁喉'][eid] ~= nil then
			killjq = 0
		end
		
		
		if killjq > 0 and NGQH(eid,JY.Person[eid]['主运内功']) == true and JY.Person[eid]['畅想分阶'] < 7 then
			local sz = {0.1,0.2,0.25,0.3,0.35,0.5,0.7}
			local jssz = sz[JY.Person[eid]['畅想分阶']+1] + 0.1
			if jssz > 1 then jssz = 1 end
			killjq = math.modf((killjq*jssz)-get_skill_power(eid,JY.Person[eid]['主运内功'],11))
		elseif killjq > 0 and NGQH(eid,JY.Person[eid]['门派技能1']) == true and JY.Person[eid]['畅想分阶'] < 7 then
			local sz = {0.1,0.2,0.25,0.3,0.35,0.5,0.7}
			local jssz = sz[JY.Person[eid]['畅想分阶']+1] + 0.1
			if jssz > 1 then jssz = 1 end
			killjq = math.modf((killjq*jssz)-get_skill_power(eid,JY.Person[eid]['门派技能1'],11))
		end	
		
		if killjq > 0  then	
			killjq = limitX(math.modf(killjq),0,1000)
			if nokillspeed(enemyid) == false then
				WAR.Person[enemyid].TimeAdd = limitX(WAR.Person[enemyid].TimeAdd - math.modf(killjq),-1500,1500)
			end	
			--易筋组合
			if NGQH(eid,108) then
				ztd(enemyid,'集气位置',100)
				WAR.PD['回魂仙梦'][pid] = limitX((WAR.PD['回魂仙梦'][pid] or 0) + 5,0,15)
				ztd(WAR.CurID,"生命点数",-math.modf(killjq/2))
				Set_Eff_Text(enemyid,3,"易筋神髓・现世如来")
			end	
			if NGQH(pid,249) and WAR.Person[enemyid].TimeAdd < 0 then --金关领悟 杀意波动
				if math.random(10) > 3 then
					WAR.PD['利刃寒锋'][eid] = limitX((WAR.PD['利刃寒锋'][eid] or 0) + 20,0,50)
					WAR.PD['残劲袭魄'][eid] = 1
				else
					WAR.PD['昏迷状态'][eid] = 1
				end
			end	
		end	
		if antishaqi > 0 then
			if antishaqi > 1000 then antishaqi = 1000 end
			ztd(enemyid,"集气位置",antishaqi)
		end
		if fanshaqi > 0 then
			if fanshaqi > 1000 then fanshaqi = 1000 end
			if nokillspeed(WAR.CurID) == false then
				ztd(WAR.CurID,'集气位置',-fanshaqi)
			end
		end	
		--WAR.Person[enemyid].TimeAdd = limitX(WAR.Person[enemyid].TimeAdd,-999,999)
	end
	if JY.Person[pid]["生命"] < 0 then
		JY.Person[pid]["生命"] = 0
	end

	WAR.QMWZ = 0
  
	--小龙女死掉，杨过吼
	if match_ID(eid, 59) and JY.Person[eid]["生命"] <= 0 then -- 
		WAR.XK = 1
		WAR.XK2 = WAR.Person[enemyid]["我方"]
	end 

	if match_ID(eid,58) and JY.Person[eid]["生命"] <= 0 and JY.Base['单通'] == 1 then
		if inteam(59) and JY.Person[59]['生命'] > 1 then
			JY.Person[59]['生命'] = 1
			JY.Person[eid]["生命"] = JY.Person[eid]["生命最大值"]
			WAR.XK = 1
			WAR.XK2 = WAR.Person[enemyid]["我方"]
		end	
	end
	--无酒不欢：优化钟灵闪电貂偷东西and WAR.ZDDH ~= 354and WAR.ZDDH ~= 354
	if WAR.TD == -2 and WAR.ZDDH ~= 354 then
		for i = 1, 4 do
			if 0 < JY.Person[eid]["携带物品数量" .. i] and -1 < JY.Person[eid]["携带物品" .. i] then
				WAR.TD = JY.Person[eid]["携带物品" .. i]
				WAR.TDnum = JY.Person[eid]["携带物品数量" .. i]
				JY.Person[eid]["携带物品数量" .. i] = 0
				JY.Person[eid]["携带物品" .. i] = -1
				break
			end
		end
	else
		WAR.TD = -1
	end
	--入魔吸血
	if WAR.PD['入魔'][pid] ~= nil and WAR.PD['入魔'][pid] == 1 then
        WAR.RMXX = WAR.RMXX + math.modf(hurt * 0.2)
        if WAR.RMXX > 800 then
            WAR.RMXX = 800
        end
    end	
	--血刀吸血，1级5%，3级6%，5级7%
	--上限400点

	if JY.Person[pid]["武器"] == 44 or MPTX(pid,21) then
		local bs = 0
		if JY.Thing[44]["装备等级"] >= 5 then
			bs = 2
		elseif JY.Thing[44]["装备等级"] >= 3 then
			bs = 1
		end
		local leech_rate = 0.01 + 0.01 * bs
		if WAR.XDLeech < 400 then
			WAR.XDLeech = WAR.XDLeech + limitX(math.modf(hurt * leech_rate),0,400)
			if WAR.XDLeech > 400 then
				WAR.XDLeech = 400
			end
		end
	end
	--天魔功吸血20%
	if Curr_NG(pid, 160)  then
        WAR.TMGLeech = WAR.TMGLeech + math.modf(hurt * 0.2)
        if WAR.TMGLeech > 800 then 
            WAR.TMGLeech = 800
        end
	end	
	--血河，10%吸血
	if PersonKF(pid, 163) then
		if WAR.XHSJ < 400 then
			WAR.XHSJ = WAR.XHSJ + limitX(math.modf(hurt * 0.1),0,400)
			if WAR.XHSJ > 400 then
				WAR.XHSJ = 400
			end
		end
	end
	
	--韦一笑吸血10%，上限100点
	if match_ID(pid, 14) or match_ID(pid, 9818) then
		if WAR.WYXLeech < 400 then
			WAR.WYXLeech = WAR.WYXLeech + limitX(math.modf((hurt) * 0.1),0,400)
			if WAR.WYXLeech > 400 then
				WAR.WYXLeech = 400
			end
		end
	end
	--套装效果吸血
	if PDTZ(pid,JY.Person[pid]["武器"]) then
		local n = JY.Person[pid]["武器"]
		if Setmeal[n][4] == 19 then
			if WAR.TZLeech < 400 then
				WAR.TZLeech = WAR.TZLeech + limitX(math.modf((hurt) * 0.1),0,400)
				if WAR.TZLeech > 400 then
					WAR.TZLeech = 400
				end
			end
		end
		
	end
	--云中鹤吸血10%，上限400点
	if (match_ID(pid, 100) or match_ID(pid, 9874)) and JY.Person[eid]["性别"]>0 then
		if WAR.YZHLeech < 400 then
			WAR.YZHLeech = WAR.YZHLeech + limitX(math.modf((hurt) * 0.1),0,400)
			if WAR.YZHLeech > 400 then
				WAR.YZHLeech = 400
			end
		end
	end

	--套装效果、程英杀内力
	if WAR.CY == 1 then
		if PDTZ(pid,JY.Person[pid]["武器"]) then	
			local n =  JY.Person[pid]["武器"]
			if Setmeal[n][4] == 24 then
				ztd(enemyid,'内力点数',-300)
				ztd(enemyid,'体力点数',-3)
			end
			if match_ID(pid, 63) or WAR.PD['杀内力'][pid] ~=nil then
				ztd(enemyid,'内力点数',-300)
			end
		else
			ztd(enemyid,'内力点数',-300)
		end
	end
	--进阶万岳，杀内力
	if wugong == 33 and WYJJ(pid) then
		local neiliLoss = math.modf(hurt/2)
		ztd(enemyid,'内力点数',-neiliLoss)
	end

	--阎基偷钱
	if eid ~= 591 and match_ID(pid, 4) and JY.Person[eid]["生命"] <= 0 and isteam(pid) then
		WAR.YJ = WAR.YJ + math.random(15) + 25
	end
    --峨眉暴怒技
	if WAR.EMBN == 1 then
		WAR.PD["盲目状态"][eid] = 2
    end		
		
	--辟邪刺目，100%MISS
	if WAR.KHBX == 2 and 0 < hurt then
       WAR.PD["盲目状态"][eid] = 2
    end
 	--辟邪刺目，100%MISS
	if WAR.BXZS == 4 and 0 < hurt then
		WAR.PD["刺目"][eid] = 2
	end   	
	--喵太极 真境界
	if WAR.MTJJ == 1 and math.random(10) < 9 then
		WAR.Person[enemyid]["生命点数"] = -JY.Person[eid]["生命"];
		JY.Person[eid]["生命"] = 0
		WAR.PD['复活无效'][eid] = 1
	end
	if match_ID(pid,92) and math.random(10) < 4 then
		local xx  = math.modf(JY.Person[eid]["生命最大值"] / 3);
		ztd(enemyid,'生命点数',-xx)
	end
    if WAR.PD['戳字决'][pid] == 1 and math.random(100) <= 40 then
        WAR.PD["刺目"][eid] = 2
    end

    if WAR.PD['野球拳'][pid] == 2 and 0 < hurt and math.random(100) <= 40 then
        WAR.PD["盲目状态"][eid] = 2
	end
	--------------------------------------------------封穴计算----------------------------------------------
	--拳主大招，高几率封穴
	if WAR.LXZQ == 1 and JLSD(25, 75, pid) then
		WAR.BFX = 1
	end
	if match_ID(pid,613) and wugong == 206 and JLSD(10,60,pid) then
       WAR.BFX = 1
	end	
	--琴棋书画之倚天屠龙功，必封穴
	if WAR.QQSH3 == 1 then
		WAR.BFX = 1
	end
	--神门十三剑，必封穴
	if wugong == 236 then
		WAR.BFX = 1
	end
	if WGZH(pid,64,236) and wugong ==64 then
		WAR.BFX = 1
	end
	--奇门主角大招，必封穴
	if WAR.GCTJ == 1 then
		WAR.BFX = 1
	end
	
    --黯然大招
	if WAR.ARJX == 4 then
		WAR.BFX = 1
	end		
	
	--太极功太极剑
	if (wugong == 46 and PersonKF(pid,171)) or match_ID(pid,5) then
		WAR.BFX = 1
	end	
	
	--一阳指50%几率封穴，优先判定
	if wugong == 17 and JLSD(30,80,pid) then
		WAR.BFX = 1
	end
	
	--拳法指法45%几率封穴
	if (yongquan(wugong) or yongzhi(wugong)) and JLSD(30, 75, pid) then
		WAR.BFX = 1
	else
		if JLSD(0, 25, pid) then
			WAR.BFX = 1
		end
	end
    if WAR.WYJF == 1 or WAR.WYJF == 6 then --寒冰被动
		WAR.BFX = 1
	end	
    if wugong == 226 then 
        WAR.BFX = 1
    end
	--毒王大招必封穴
	if WAR.YTML == 1 then
		WAR.BFX = 1
	end	
	--梁萧星罗散手必封穴
	if match_ID(pid,635)  then
		WAR.BFX = 1
	end	
	--岳云岳王散手必封穴
	if match_ID(pid,568) and wugong == 198 then
		WAR.BFX = 1
    end
    
    --穴袖拂穴必封穴
	if wugong == 201 then
        WAR.BFX = 1
	end	
	
    if WAR.PD['戳字决'][pid] == 1 then 
        WAR.BFX = 1
    end
    --黄药师高几率封穴
    if match_ID(pid, 57) and JLSD(0,50,pid) then
        WAR.BFX = 1
    end
	------------------------ 战斗内伤状态------------------------
	--拳法额外内伤，降龙高内伤
	--除却四相免疫内伤
	--毒王大招上内伤
	if (WAR.YTML == 1 or match_ID(pid, 80) or match_ID(pid, 9838) or yongquan(wugong) or WAR.PD["奇门内伤"][pid] == 1) and hurt > 0 and myns(enemyid) == false then
		local n = 0;		--内伤点数值
		local wlns = get_skill_power(pid,wugong,11) 
		local atkns = Atk(WAR.CurID)
		if match_ID(eid,738) then
			n = (wlns)/1000 + (atkns)/1000
		elseif isteam(eid) then--队友内伤计算
			n = (wlns)/300 + (atkns)/300
		else
			n = (wlns)/500 + (atkns)/500
		end
		--张召重攻击，内伤加倍
		if match_ID(pid, 80) or match_ID(pid, 9838) then
			n = n * 2
		end
		nssz = nssz + n
    end
	---------------------- 战斗封穴状态-------------------------
	--指法额外封穴，一阳指高封穴，其他30%几率封穴，根据武功威力来增加封穴
	--除却四相免疫封穴
	if (WAR.BFX == 1 or yongzhi(wugong) or WAR.PD["奇门封穴"][pid] == 1) and hurt > 0 and myfx(enemyid) == false then
		--无酒不欢：使用分段函数
		local fxz = 1;
		local wl = get_skill_power(pid,wugong,11)
		local atk = Atk(WAR.CurID)
		if wl >= 100 and wl < 300 then
			fxz = fxz + math.modf((wl)/100 + atk/600)
		elseif wl >= 300 and wl < 700 then
			fxz = math.modf((wl)/200 + atk/550)
		elseif wl >= 700 and wl < 1500 then
			fxz = math.modf((wl)/300 + atk/500)
		elseif wl >= 1500 then
			fxz = math.modf((wl)/400 + atk/400)
		end
		--白展堂攻击附带封穴
		if match_ID(pid, 511) then 
			fxz = fxz + math.random(10)
		end
        if WAR.PD['戳字决'][pid] == 1 then 
            fxz = fxz + math.random(10)
        end
		--封穴调整
		if isteam(pid) then
			fxz = math.modf(fxz *0.4)
		else
			fxz = math.modf(fxz * 0.8)
		end
		--主运混元，造成的封穴效果提高20%
		--萧半和
		if Curr_NG(pid, 90) or Curr_NG(pid,375) or match_ID(pid,189) then
			fxz = math.modf(fxz * 1.2)
		--被动混元，造成的封穴效果提高10%
		elseif (PersonKF(pid,90) or PersonKF(pid,375)) then
			fxz = math.modf(fxz * 1.1)
		end	
		if fxz < 0 then
			fxz = 0
        end
        fxsz = fxsz + fxz
		WAR.BFX = 0
	end
	--野球拳
	if WAR.PD['野球拳'][pid] == 2 then
        local lx = JY.Person[eid]["流血程度"]
        if lx >= 25 then
            fxsz = fxsz + lx
			ztd(enemyid,WAR.LXXS,-lx/2)
            Set_Eff_Text(enemyid,"特效文字1","凝血封穴")
        end    
	end
	--立地成佛
	if match_ID(pid,114) and BNJQ(pid) then
        local lq = (WAR.LQZ[eid] or 0)
        if lq > 0 and WAR.ACT == 1 then 
			fxsz = fxsz + math.modf(lq/2)
			nssz = nssz + math.modf(lq/2)
        end
    end
	--石破天，50%几率给攻击方上封穴
    if (JXPD(eid,38,1) or (Curr_NG(eid,102) and not isteam(eid))) and JLSD(20,70,eid) then
        fxsz1 = fxsz1 + 15
		Set_Eff_Text(enemyid, 2, "逆转太玄",math.fmod(wugong, 10) + 85)
    end		
    --白展堂被打反10点封穴
    if match_ID(eid, 511) and myfx(WAR.CurID) == false then
        fxsz1 = fxsz1 + math.random(20)
		Set_Eff_Text(enemyid, 2, "葵花点穴・反")
	end
	------------------------------------战斗流血状态---------------------  
	--倚天剑，必流血
	--1级70%几率流血
	--4级开始追加灼烧
	if (JY.Person[pid]["武器"] == 37 or PersonKF(pid,41)) then
		if JLSD(0, 40 + math.modf(JY.Person[pid]["实战"]/25), pid) then
			WAR.BLX = 1
		end
	end
	--狼牙，必流血
	--1级70%几率流血
	if JY.Person[pid]["武器"] == 320 or (PersonKF(pid, 159) and PersonKF(pid, 160)) then
		if JLSD(0, 40 + math.modf(JY.Person[pid]["实战"]/10), pid) then
			WAR.BLX = 1
		end
	end	
	--田归农或装备闯王军刀，攻击必流血
	if JY.Person[pid]["武器"] == 202 or match_ID(pid, 72) then
		WAR.BLX = 1
	end
	--陆无双，必流血
	if  match_ID(pid, 580) then
		WAR.BLX = 1
	end	
	--钟灵必流血
	if match_ID(pid, 90) or match_ID(pid, 9879) then
		WAR.BLX = 1
	end
	
	--碧海落英
	if WAR.LYBF > 0 then
		WAR.BLX = 1 
	end	
	
	--剑法、刀法45%几率流血
	if (yongjian(wugong) or yongdao(wugong)) and JLSD(30, 65, pid) then
		WAR.BLX = 1
	end
	if WAR.WYJF == 3 or WAR.WYJF == 6 then
		WAR.BLX = 1
	end
	
	--沧溟刀法特效，必流血
	if WAR.CMDF == 1 then
		WAR.BLX = 1
	end
	
	--主运血河神鉴，必流血
	if Curr_NG(pid, 163) then
		WAR.BLX = 1
	end
	
	--毒王大招必流血
	if WAR.YTML == 1 then
		WAR.BLX = 1
	end
	--龙爪手必流血
	if wugong == 20 then
	   WAR.BLX = 1
	end  
	--凝血神爪必流血
	if wugong == 134 then
		WAR.BLX = 1
    end

    --罗汉拳夺魄指
	if WGZH(pid,1,123) then
		WAR.BLX = 1
	end 	

	--绣花针必流血
    if JY.Person[pid]["武器"] == 349 or wugong == 313 then   
       WAR.BLX = 1
	end
    if WAR.PD['野球拳'][pid] == 2 then
       WAR.BLX = 1
	end
	--流血计算
	--装备倚天剑，屠龙刀第一种特效，奇门标主大招，必流血，其他30%几率流血
	--防御方带6级金丝  标记修改
	if hurt > 0 and ((JY.Person[eid]["武器"] == 239 and JY.Thing[239]["装备等级"] == 6) == false)
	and (WAR.L_TLD == 1 or WAR.BLX == 1 or WAR.GCTJ == 1 or yongdao(wugong) or yongjian(wugong) or WAR.PD["奇门流血"][pid] == 1) then
	    local wllx = get_skill_power(pid,wugong,11)
		local atkls = Atk(WAR.CurID)
        lxsz = lxsz + math.modf(wllx/200+atkls/450)
	end
   
	WAR.BLX = 0
	
	---------------------------------------------战斗冰封状态-----------------------------------------------------
    -- 阴内九阴必冰封
	if JY.Wugong[wugong]["冰封系数"] == 1 and ((PersonKF(pid, 107) and rwnlxz(pid,0)) or JLSD(40,90,pid)) then
		WAR.BBF = 1
	end
	-- 寒冰真气 必冰封
	if PersonKF(pid,216) or PersonKF(pid,43) or match_ID(pid,9978) or match_ID(pid,578) then
		WAR.BBF = 1
    end	
	-- 易水寒诀 必冰封
	if Curr_NG(pid, 43) then
		WAR.BBF = 1
    end	
	--林朝英流风回雪
	if WAR.LFHX == 1 then
		WAR.BBF = 1
	end
	
	if WAR.PD['必冰封'][pid]~=nil and wugong > 0 then
		WAR.BBF = 1
	end
	
	--初生牛犊
	if match_ID(pid, 9743) and JLSD(10,90,pid) then
		WAR.BBF = 1
	end 	
	
	--琴棋书画的妙笔丹青特效
	if WAR.QQSH2 >= 1 then
		WAR.BBF = 1
	end

	if WGZH(pid,64,236) and wugong ==236 then
		WAR.BBF = 1
	end
	
	--冰火夫妻刀
	if WAR.FQDF == 2 then
		WAR.BBF = 1
	end 	
	
	--玉箫剑法配合桃花绝技60%冰封
	if wugong == 38 and WGZH(pid,12,18) and JLSD(20,80,pid) then
		WAR.BBF = 1
	end 
	--左冷禅，李四，高几率冰封
	if (match_ID(pid, 22) or match_ID(pid, 42)) and JLSD(10,90,pid) then
		WAR.BBF = 1
	end
	--胡一刀、装备冷月宝刀攻击冰封
	if match_ID(pid,633) or JY.Person[pid]["武器"] == 45 then
		WAR.BBF = 1
	end		
	--毒王大招必冰封
	if WAR.YTML == 1 then
		WAR.BBF = 1
	end
	--白绣必冰封
	if match_ID(pid,582) then
		WAR.BBF = 1
	end	
	--白万剑必冰封
	if match_ID(pid,43) or match_ID(pid,9823) then
		WAR.BBF = 1
	end
    --阴阳流2	
	if WAR.BHJTZ1== 1 then
		WAR.BBF = 1
	end
	------------------------------------------战斗灼烧状态----------------------------------------------
	if MPTX(pid,15) then
		WAR.BZS = 1
		zssz = math.modf(JY.Person[pid]["内力"] / 500)
	end	
	--金乌映雪
    if WGZH(pid,35,61) and wugong == 35 then 
		WAR.BZS = 1
        zssz = zssz + bfsz
    end
	--阳内九阳必灼烧
	if JY.Wugong[wugong]["灼烧系数"] == 1 and ((PersonKF(pid, 106) and rwnlxz(pid,1)) or JLSD(40,90,pid)) then
		WAR.BZS = 1
	end
	
	if WAR.PD['必灼烧'][pid]~=nil and wugong > 0 then
		WAR.BZS = 1
	end
	--天南易阳
	if PersonKF(pid, 314) then
		WAR.BZS = 1
	end
	--圣火明尊
	if match_ID(pid,9992) or wugong == 93 then
		WAR.BZS = 1
    end
    if WAR.PD['火延'][pid] == 1 then 
        WAR.BZS = 1
    end
	--苗人凤，天门，张三，高几率灼烧
	if (match_ID(pid, 3) or match_ID(pid, 23) or match_ID(pid, 41)) and JLSD(10,90,pid) then
		WAR.BZS = 1
	end
	
	--毒王大招必灼烧
	if WAR.YTML == 1 then
		WAR.BZS = 1
	end
	
	--初生牛犊
	if match_ID(pid, 9743) and JLSD(10,90,pid) then
		WAR.BZS = 1
	end 	
	
	if WGZH(pid,64,236) and wugong ==236 then
		WAR.BZS = 1
	end

    --冰火夫妻刀
	if WAR.FQDF == 3 then
		WAR.BZS = 1
	end 	
	--九阳怒涛
	if NGQH(pid,106) then	
		WAR.BZS = 1
	end	
    -- 六脉大招1 天山六阳掌
    if WAR.DSP_LM2 == 1 or wugong == 8 then
      	WAR.BZS = 1
	end
	--林殊必灼烧
	if match_ID(pid,508) then
		WAR.BZS = 1
    end
	--徐子陵必灼烧
	if match_ID(pid,505) or match_ID(pid,9977) then
		WAR.BZS = 1
	end	
	--九字真言 在
	if WAR.PD["在"][pid] ~= nil and WAR.PD["在"][pid] == 1 then
	  WAR.BZS = 1
    end
    --阴阳流1	
	if WAR.BHJTZ1== 1 then
        WAR.BZS = 1
	end	
	if WAR.WYJF == 2 or WAR.WYJF == 6 then
		WAR.BZS = 1
	end	
    -- 丁当
 	if match_ID(pid,581) then
		WAR.BZS = 1
	end	
    --长生
    if WAR.BZS == 1 and PersonKF(pid,203) then
        WAR.BBF = 1
    elseif WAR.BBF == 1 and PersonKF(pid,203) then
        WAR.BZS = 1
    end
	if actor(pid,10) and Curr_NG(pid,90) then 
		WAR.BZS = 1
	end
	if actor(pid,10) and Curr_NG(pid,90) then 
		WAR.BBF = 1
	end
	--金乌映雪
	if WGZH(pid,35,61) and wugong == 61 then 
		WAR.BBF = 1
		bfsz = bfsz + zssz
	end

	--雪花神剑
	if WAR.BXXHSJ ==1 then
		bfsz = bfsz + 10 + Rnd(10)
    end
	
	--灼烧计算
	--除却四相免疫灼烧
	if hurt > 0 and WAR.BZS == 1 then
		local wl = get_skill_power(pid,wugong,11)
		local zsz = math.modf(wl/80)
        zssz = zssz + zsz
	end	
	--冰封计算 
	--除却四相 寒冰真气 免疫冰封
	if hurt > 0 and WAR.BBF == 1 then
		local wl = get_skill_power(pid,wugong,11)
		local bfz = math.modf(wl/80)
		--琴棋书画的妙笔丹青特效江山如画
		if WAR.QQSH2 == 2 then
			bfz = bfz * 2
		end
        bfsz = bfsz + bfz
	end
	--必冰封、必灼烧清零
    WAR.BZS = 0
	WAR.BBF = 0
    
	--先天罡气清蓄力
	if PersonKF(pid,100) then
		if WAR.PD["太极蓄力"][eid] ~= nil or WAR.PD["蛤蟆蓄力"][eid] ~= nil or WAR.PD["鲸息蓄力"][eid] ~= nil then
			if WAR.PD["太极蓄力"][eid] ~= nil and  WAR.PD["太极蓄力"][eid] > 0 then
				WAR.PD["太极蓄力"][eid] = nil
			end
			if WAR.PD["鲸息蓄力"][eid] ~= nil and  WAR.PD["鲸息蓄力"][eid] > 0 then
				WAR.PD["鲸息蓄力"][eid] = nil
			end
			if WAR.PD["蛤蟆蓄力"][eid] ~= nil and  WAR.PD["蛤蟆蓄力"][eid] > 0 then
				WAR.PD["蛤蟆蓄力"][eid] = nil
			end
			Set_Eff_Text(enemyid,3,"罡气破力")
		end
	end

    --怒气值计算，斗转星移不加怒，指法大招不加怒
	if JY.Person[eid]["生命"] > 0 and hurt > 0 and (WAR.LQZ[eid] == nil or WAR.LQZ[eid] < 100) then 
		if DWPD(WAR.CurID,enemyid) and WAR.DZXY ~= 1 and WAR.LXYZ ~= 1  then
			local lqzj = 0
			lqzj = lqzj + math.modf((hurt/15)+1)
			if lqzj == nil or lqzj < 1 then
				lqzj = 1
			end
			lqzj = math.random(lqzj+1, lqzj+10)
			--敌人难度下额外增加的怒气值
			if WAR.Person[enemyid]["我方"] == false then
				local flqzj = 0
				if JY.Base["难度"] == 1 then
					flqzj = 2
				elseif JY.Base["难度"] == 2 then
				    flqzj = 4
				else
				    flqzj = 6 + JY.Base["难度"] * 2
				end
				lqzj = lqzj + flqzj;
			end
			if lqzj < 5 then 
				lqzj = 5 
			end
			--紫霞修罗刀或者天魔修罗刀
			if wugong == 58 and (PersonKF(pid,160) or PersonKF(pid,89)) then
				local aa = lqzj
				if aa < 20 then
					aa = aa * 2 
				end
				aa = aa + 5 * math.random(1,2)
				nuqi(eid,-aa)
				nuqi(pid,aa)
				if WAR.LQZ[pid] == 100 and (WAR.PD['暴走状态2'][pid] or 0) < 1 then
					WAR.PD['暴走状态2'][pid] = 2
				end
				lqzj = 0
			end
			--竹风雨滴
			if WAR.WTJJ2 == 1 then
				nuqi(eid,-5)
				nuqi(pid,5)
			end
			--罗汉伏魔杖法
			if (wugong == 86 and PersonKF(pid,96)) or match_ID(pid, 577) then
				nuqi(pid,8) 
			end
			if (PersonKF(eid,86) and PersonKF(eid,96)) or match_ID(eid, 577) then
				lqzj = math.modf(lqzj * 2)
			end
			--主运太玄攻击怒气减半
			if Curr_NG(pid,102) then 
				lqzj = math.modf(lqzj/2)
			end
			--雪羽宗攻击怒气减半
			if (MPTX(pid,20,3) and JLSD(10,40,pid)) or match_ID(pid,514) then
				lqzj = math.modf(lqzj*0.5)
			end
			--葵花点穴手
			if wugong == 226 and PersonKF(pid,226) and PersonKF(pid,126) then
				lqzj = math.modf(lqzj*(1-(JY.Person[eid]["封穴程度"]*0.01)))-5
				if lqzj < -JY.Base["难度"] then
					lqzj = -JY.Base["难度"]
				end
			end
			--怒气增加最终计算
			--草木成佛
			if WAR.PD['西瓜刀'][pid] == 3 then
            --护龙军师大阵  
			elseif WAR.PD['黄金阵'][pid] == 1 then
			--独孤九剑
			elseif WAR.PJS2 == 1 then
			--太玄之重，不加怒
			elseif WAR.TXZZ == 1 then
			--琴棋书画之持瑶琴不加怒
			elseif WAR.QQSH1 > 0 then
			--古墓打人不加怒
			elseif (MPTX(pid,3) and Curr_NG(pid,154)) or match_ID(pid,605) then
			--冰心状态不加怒
			elseif WAR.PD['冰心状态'][eid] ~= nil then
			--玉女先天挨打不加怒
			elseif NGQH(eid,154) then
			elseif match_ID(eid,9939) then
			elseif WAR.PD['暗香疏影'][eid] == 2 then
			else
			    WAR.PD['怒气爆发'][eid] = 1
				nuqi(eid,math.modf(lqzj+JY.Base["难度"]))
			end
			if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] <= 0 then
				WAR.LQZ[eid] = nil;
			end
		end
	end
	--一苇渡江达摩
	if  Curr_QG(pid,186) and match_ID(pid,577) then
		if BNJQ(eid) then
			nuqi(pid,20)
			nuqi(eid,-20)
		end
	end  
	--西瓜刀天人
	if WAR.PD['西瓜刀'][pid] == 3 then
		if BNJQ(eid) then 
			WAR.PD["昏迷状态"][eid] = 1
		end
		nuqi(eid,-20)
	end
    --北冥吸怒，斗转不触发   
	if XiaoYaoYF(pid) and PersonKF(pid,85) and WAR.DZXY ~= 1 and WAR.LQZ[eid] ~= nil and JLSD(25, 40 + math.modf(JY.Person[pid]["实战"]/20), pid) then
		local lq = WAR.LQZ[eid] or 0
		if lq >= 10 then 
			WAR.BMSGXL = WAR.BMSGXL + 10
			nuqi(eid,-10)
		else 
			WAR.BMSGXL = WAR.BMSGXL + lq
			WAR.LQZ[eid] = 0
		end
		Set_Eff_Text(enemyid,"特效文字1","北冥.气吞山河");
	end	
	--触发太玄之重时，敌方已经暴怒的话，则有几率清怒，
	if (WAR.PD["TXZHATK3"][pid] ~= nil or WAR.PD["太玄组合攻击5"][pid] ~= nil) and WAR.LQZ[eid] ~= nil then
		nuqi(eid,-20)
		if WAR.LQZ[eid] >= 100 then
			nuqi(eid,-50)
			ztd(enemyid,"内伤点数",math.random(10,WAR.LQZ[eid]))
		end
		--Set_Eff_Text(enemyid,"特效文字1","救赵挥金锤.邯郸先震惊");
	end
	--指法大招清一半怒
	if WAR.LXYZ == 1 and WAR.LQZ[eid] ~= nil then
		WAR.LQZ[eid] = math.modf(WAR.LQZ[eid]*0.5)
    end
    
	--菩提清心清一半怒
	if WAR.QQSH1 == 2 and WAR.LQZ[eid] ~= nil then
		WAR.LQZ[eid] = math.modf(WAR.LQZ[eid]*0.5)
	end
	--独孤九剑
	if WAR.PJS2 == 1 then
		if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] > 0 then
			local nq = 0
			if inteam(eid) == false then
				WAR.LQZ[eid] = math.modf((WAR.LQZ[eid] or 0)/2)
			else
				nq = math.modf((WAR.LQZ[eid] or 0)/2)
				if nq < 1 then nq = 1 end
				nuqi(eid,-nq)
			end
		end
	end

    --防止怒气小于0
    if WAR.LQZ[eid] ~= nil and WAR.LQZ[eid] < 0 then 
        WAR.LQZ[eid] = 0
    end
	
	
	--武功反击
	if fjpd(WAR.CurID) == false and Fjkx(WAR.CurID) ~= 2 and JY.Person[eid]["生命"] > 0 and JY.Person[eid]["体力"] > 10 and JY.Person[eid]["内力"] > 100 and WAR.DZXY ~= 1 and DWPD(WAR.CurID,enemyid) then
		--招式反击
		if WAR.PD["刺猬状态"][eid] ~= nil then		
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			local fjwg = 0
			if JY.Person[eid]['优先使用'] > 0 then
				fjwg = JY.Person[eid]['优先使用']
			else
				if JY.Person[eid]['天赋外功1'] > 0 then
					fjwg = JY.Person[eid]['天赋外功1']
				end
			end
			WAR.Person[enemyid]['反击武功'] = fjwg
			Set_Eff_Text(enemyid,"特效文字2",JY.Wugong[fjwg]['名称'].."招式反击")
		end
		if WAR.PD["唯识剑意3"][eid] == 1 then	
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			WAR.Person[enemyid]['反击武功'] = 370
			Set_Eff_Text(enemyid,"特效文字1","唯识剑意・以意为形",77)
		end
		if WAR.PD["流云飞袖"][eid] == 1 then		
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			local fjwg = 240
			if JY.Person[eid]['优先使用'] > 0 then
				fjwg = JY.Person[eid]['优先使用']
			else
				if JY.Person[eid]['天赋外功1'] > 0 then
					fjwg = JY.Person[eid]['天赋外功1']
				end
			end	
			WAR.Person[enemyid]['反击武功'] = fjwg
			Set_Eff_Text(enemyid,"特效文字1","流云飞袖・"..JY.Wugong[fjwg]['名称'],93)
		end
		--混元霹雳手，混元指反击
		if (match_ID(eid,18) or match_ID(eid,9744)) and JLSD(20,50,pid) then		
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			WAR.Person[enemyid]['反击武功'] = 19
			Set_Eff_Text(enemyid,"特效文字2","混元霹雳手")
		end
		--被攻击反击般若掌
	    if WAR.PD['般若等待'][eid] ~= nil and JLSD(0, 40, pid) then
			WAR.DZXYLV[eid] = 4		--反击100%伤害
			WAR.Person[enemyid]['反击武功'] = 189
			Set_Eff_Text(enemyid,"特效文字1","十八种观")
		end
		--被攻击反击太极拳
		if tjqfj(eid) then
			local jl = math.modf(TrueQZ(eid)/10)
			if jl > 60 then jl = 60 end
			if JLSD(10,jl,eid) then
				WAR.YJZD[eid] = 1
				WAR.YJZD1[pid] = 10
				WAR.DZXYLV[eid] = 5		--反击100%伤害
				WAR.Person[enemyid]['反击武功'] = 16
			end	
		end 
		if WAR.PD['大圆镜智'][eid] == 1 then
			if JLSD(10,55,eid) then
				WAR.DZXYLV[eid] = 5
				local fjwg = wugong
				if JY.Person[eid]['优先使用'] > 0 then
					fjwg = JY.Person[eid]['优先使用']
				else
					if JY.Person[eid]['天赋外功1'] > 0 then
						fjwg = JY.Person[eid]['天赋外功1']
					end
				end
				WAR.Person[enemyid]['反击武功'] = fjwg
				Set_Eff_Text(enemyid,"特效文字1","心若圆镜")
			end
		end		
		--九阴降龙反击
		if PersonKF(eid,26) and PersonKF(eid,107) then 
			WAR.JYXLF[eid] = 1
			WAR.DZXYLV[eid] = 4		--全屏无锁定
			WAR.PD['霸王破甲'][pid] = 15
			WAR.Person[enemyid]['反击武功'] = 26
			War_ActupMenu()
		end   
		--雪羽宗宗主反击
		if match_ID(eid,514) and JLSD(0,30,eid) then
			Set_Eff_Text(enemyid, "特效文字0", "风萧萧兮")
			WAR.DLJ = 1
			WAR.DZY = 1
			Cat('清除中级异常',WAR.CurID)
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			WAR.Person[enemyid]['反击武功'] = 153
		end
		--鲸息九阴
		if (match_ID(eid,635) or NGQH(eid,180)) and PersonKF(eid,179) then
			WAR.JXBH[eid] = 1
			WAR.DZXYLV[eid] = 4		--全屏无锁定
			WAR.PD['霸王破甲'][pid] = 15
			WAR.Person[enemyid]['反击武功'] = 179
			War_ActupMenu()
		end    
		--王杰 标记修改
		if (match_ID(eid,9921) or match_ID(eid,722)) and JLSD(20, 50, pid) then
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			WAR.Person[enemyid]['反击武功'] = 231
			Set_Eff_Text(enemyid,"特效文字2","八卦・回手刀")
		end
		--王τ 标记修改	
		if (match_ID(eid,9920) or match_ID(eid,737)) and JLSD(20, 50, pid) then
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			WAR.Person[enemyid]['反击武功'] = 230
			Set_Eff_Text(enemyid,"特效文字2","八卦・旋身掌")
		end
		--追魂无影门派效果
		if Curr_QG(eid,278) and MPTX(eid,9) then
			WAR.DZXYLV[eid] = 5		--反击100%伤害
			local fjwg = 240
			if JY.Person[eid]['优先使用'] > 0 then
				fjwg = JY.Person[eid]['优先使用']
			else
				if JY.Person[eid]['天赋外功1'] > 0 then
					fjwg = JY.Person[eid]['天赋外功1']
				end
			end	
			WAR.Person[enemyid]['反击武功'] = fjwg
			Set_Eff_Text(enemyid,"特效文字1","唐门秘技・"..JY.Wugong[fjwg]['名称'],93)
		end
	end
	---------------------------------------------记录秒杀----------------------------------------------
	--成不忧 被令狐冲 秒杀
	if WAR.ZDDH == 205 and eid == 141 then
		WAR.Person[enemyid]["生命点数"] = -JY.Person[eid]["生命"];
		JY.Person[eid]["生命"] = 0
	end
	--小拾秒杀点点
	if WAR.ZDDH == 456 and pid == 748 and eid == 457 then
		WAR.Person[enemyid]["生命点数"] = -JY.Person[eid]["生命"];
		JY.Person[eid]["生命"] = 0
	end
	
	--木桩被秒杀
	if WAR.ZDDH == 226 and eid == 591 then
		WAR.Person[enemyid]["生命点数"] = -JY.Person[eid]["生命"];
		JY.Person[eid]["生命"] = 0
	end

	--丁敏君 被周芷若 秒杀
	if WAR.ZDDH == 279 and eid == 632 then
		WAR.Person[enemyid]["生命点数"] = -JY.Person[eid]["生命"];
		JY.Person[eid]["生命"] = 0
	end
	
	--不老长春谷
	if WAR.ZDDH == 303 and eid == 0 then
		if JLSD(20,70,eid) then
		    WAR.Person[enemyid]["生命点数"] = -JY.Person[eid]["生命"];
		    JY.Person[eid]["生命"] = 0
		end
	end
	-------------------------------------------------吸功-----------------------------------------------
	--大威天龙
    if match_ID(pid, 515) and JY.Person[eid]["性别"] == 1 then
		AddPersonAttrib(pid, "攻击力", 20)
		AddPersonAttrib(pid, "防御力", 20)
		AddPersonAttrib(pid, "轻功", 20)
    end
	if match_ID(eid, 515) and JY.Person[pid]["性别"] == 1 then
		AddPersonAttrib(eid, "拳掌功夫", 10)
		AddPersonAttrib(eid, "指法技巧", 10)
		AddPersonAttrib(eid, "御剑能力", 10)
		AddPersonAttrib(eid, "耍刀技巧", 10)
		AddPersonAttrib(eid, "特殊兵器", 10)
    end
    
  
    --北冥
	if WAR.BMXH == 1 and 0 < hurt then
		local xnl = nil
		xnl = math.modf(JY.Person[eid]["内力"] * 0.07)
		if xnl < 300 then
			xnl = 300
		end
		--方证不会被吸
		if match_ID(eid,149) then
			xnl = 0
		end
		if NGQH(eid,108) then
			ztd(enemyid,"内力点数",xnl)
		else
			ztd(enemyid,"内力点数",-xnl) 
			ztd(WAR.CurID,"内力点数",xnl)
		end
        if isteam(pid) then
            AddPersonAttrib(pid, "内力最大值", xnl * 10)
        end    
		--畅想无崖子发动北冥时吸取属性
		if WAR.BMXH == 1 and match_ID(pid,116) and pid == 0 then
			AddPersonAttrib(pid, "攻击力", 5)
			AddPersonAttrib(pid, "防御力", 5)
			AddPersonAttrib(pid, "轻功", 5)
        end
    end

    --吸星
	if WAR.BMXH == 2 and 0 < hurt then
		local xnl = nil
        xnl = math.modf(JY.Person[eid]["内力"] * 0.07)
		if xnl < 100 then
			xnl = 100
        end
		--吸星魔帝
        if MPTX(pid,12) then 
            xnl = xnl + math.random(100,400)
        end
        --吸星魔帝
        if match_ID(pid,26) then 
            xnl = xnl + math.random(500,1000)
        end
		--吸星魔帝
        if JXPD(pid,26,1) then 
            xnl = xnl + 500
        end
		if NGQH(pid,190) then
			xnl = xnl + math.random(200,400)
		end
		--方证不会被吸
		if match_ID(eid,149) then
			xnl = 0
        end
        --吸星魔帝吸不到内就会直接杀血
        if xnl > JY.Person[eid]['内力'] then 
            if match_ID(pid,26) or NGQH(pid,190) then
                local sm = math.modf((xnl - JY.Person[eid]['内力'])/2)
				ztd(enemyid,"生命点数",-sm)
            end
        end
		--吸星魔帝根据吸收内力获得护盾
        if match_ID(pid,26) or NGQH(pid,190) then
           if JY.Person[pid]['内力最大值'] - JY.Person[pid]['内力'] < xnl then 
                local xn = xnl - (JY.Person[pid]['内力最大值'] - JY.Person[pid]['内力'])
                if WAR.PD['吸星真气'][pid] == nil and (WAR.Person[WAR.CurID]['护盾'] == nil or WAR.Person[WAR.CurID]['护盾'] <= -1) then 
                    WAR.Person[WAR.CurID]['护盾'] = 5
                end
                WAR.PD['吸星真气'][pid] = limitX((WAR.PD['吸星真气'][pid] or 0) + math.modf(xn/2),0,JY.Person[pid]['生命最大值']*0.3)
           end
        end
		if NGQH(eid,108) then
			local sm = math.modf((xnl-JY.Person[eid]['内力'])/2)
			ztd(enemyid,"生命点数",sm)
		else
			ztd(enemyid,"内力点数",-xnl)
			ztd(WAR.CurID,"内力点数",xnl)
		end	
        --吸星大法，一般人吸3-4体力
        local xt1 = 3 + Rnd(2)
		if NGQH(eid,108) then xt1 = 0 end
        --任我行 额外吸3体力
        if match_ID(pid, 26) then
            xt1 = xt1 + 3
            xt1 = xt1 + 3
        end
        ztd(enemyid,"体力点数",-xt1)
		ztd(WAR.CurID,"体力点数",xt1)
    end
	
	--化功大法 攻击上毒 减内力
	if WAR.BMXH == 3 and 0 < hurt then
		local xnl = nil
		xnl = math.modf(JY.Person[eid]["内力"] * 0.07)
		if xnl < 300 then
			xnl = 300
		end
		--方证不会被吸
		if match_ID(eid,149) then
			xnl = 0
		end
		ztd(enemyid,"中毒点数",math.random(16,20))
		if WAR.JSLZ > 0 then
			ztd(enemyid,"中毒点数",math.random(3,9))
		end
		if NGQH(eid,108) then
			local xtl = math.modf(xnl*0.01)
			ztd(enemyid,"体力点数",-xtl)
		else	
			ztd(enemyid,"内力点数",-xnl)
		end	
	end
	
	--胡刀三刀
	if wugong == 67 and WAR.PD['铁碎牙'][pid] == 2 then
		local xnl = math.modf(JY.Person[eid]["内力最大值"] * 0.05)
		ztd(enemyid,"内力点数",-xnl)
		ztd(WAR.CurID,"内力点数",xnl)
		if psx(eid,'内力') < math.modf(psx(eid,'内力最大值')*0.01) and math.random(10) > 9 then
			ztd(enemyid,'生命点数',-psx(eid,'生命最大值'))
			WAR.Person[enemyid]['死亡'] = true
		end
	end
	
	--田伯光
	if match_ID(pid, 29) and JY.Person[eid]["性别"] >0 and 0 < hurt then
		local xnl = nil
		xnl = math.modf(JY.Person[eid]["内力"] * 0.05)
		if xnl < 100 then
			xnl = 100
		end
		local xtl = math.modf(xnl*0.01)
		ztd(enemyid,"内力点数",-xnl)
		ztd(WAR.CurID,"内力点数",xnl)
		ztd(enemyid,"体力点数",-xtl)
		ztd(WAR.CurID,"体力点数",xtl)
	end
	
	--海大富化骨绵掌
	if wugong == 118 and 0 < hurt and match_ID(pid,602) then
		local xnl = nil
		xnl = math.modf(JY.Person[eid]["内力"] * 0.05)
		if xnl < 300 then
			xnl = 300
		elseif xnl > 500 then
			xnl = 500
		end
		local xtl = 3 + Rnd(2)
		ztd(enemyid,"内力点数",xnl)
		ztd(enemyid,"体力点数",-xtl)
	end
	
	--主运北冥挨打也吸内
	if Curr_NG(eid, 85) and 0 < hurt and JLSD(20,70,eid) then
		local xnl = 500
		--方证不会被吸
		if match_ID(pid,149) then
			xnl = 0
		end
		ztd(WAR.CurID,"内力点数",-xnl)
		ztd(enemyid,"内力点数",xnl)
		nuqi(eid,5)
		AddPersonAttrib(eid, "内力最大值", xnl * 10)
		Set_Eff_Text(enemyid,"特效文字1","百川入海",63);
	end
	--主运吸星挨打也吸内
	if (Curr_NG(eid, 88) and 0 < hurt and JLSD(20,70,eid)) or match_ID(eid,26) then
        local xnl = 400
        --吸星魔帝
        if match_ID(eid,26) then 
            xnl = xnl + 500
        end
		--吸星魔帝
        if JXPD(eid,26,1) then 
            xnl = xnl + 500
        end
		--方证不会被吸
		if match_ID(pid,149) then
			xnl = 0
        end
        --吸星魔帝吸不到内就会直接杀血
        if xnl > JY.Person[pid]['内力'] then 
            if match_ID(eid,26) then
                local sm = math.modf((xnl - JY.Person[pid]['内力'])/2)
				ztd(WAR.CurID,"生命点数",-sm)
            end
        end
        --任我行吸星加护盾
        if match_ID(eid,26) then
            if JY.Person[eid]['内力最大值'] - JY.Person[eid]['内力'] < xnl then 
                local xn = xnl - (JY.Person[eid]['内力最大值'] - JY.Person[eid]['内力'])
                if WAR.PD['吸星真气'][eid] == nil and (WAR.Person[enemyid]['护盾'] == nil or WAR.Person[enemyid]['护盾'] <= -1) then 
                    WAR.Person[enemyid]['护盾'] = 5
                end
                WAR.PD['吸星真气'][eid] = limitX((WAR.PD['吸星真气'][eid] or 0) + math.modf(xn/2),0,JY.Person[eid]['生命最大值']*0.3)
            end
        end
		ztd(WAR.CurID,"内力点数",-xnl)
		ztd(enemyid,"内力点数",xnl)
		--任我行 额外吸3体力
        if match_ID(eid, 26) then
			ztd(WAR.CurID,"体力点数",-3)
			ztd(enemyid,"体力点数",3)
        end
		Set_Eff_Text(enemyid,"特效文字1","万物相吸",71);
	end
	--主运化功挨打也吸内+上毒
	if Curr_NG(eid, 87) and 0 < hurt and JLSD(20,70,eid) then
		local xnl = 500
		--方证不会被吸
		if match_ID(pid,149) then
			xnl = 0
        end
        local d = math.random(10, 15)
        --d = math.modf(d*atkd)
		ztd(WAR.CurID,"中毒点数",d)
		ztd(WAR.CurID,"内力点数",-xnl)
		Set_Eff_Text(enemyid,"特效文字1","化功大法",64);
	end
  
   
    -----------------------------------------------------
    ----------------流血统一计算--------------------------
    -----------------------------------------------------
    --lxsz = lxkx(enemyid,lxsz)
	--葵花神针追加流血
	if WAR.KHSZ1 == 3  then
		lxsz = lxsz + math.modf(lxsz*0.5)
	end	
    --lxsz = limitX(math.modf(lxsz),0,100)

    if lxsz > 0 and hurt > 0 and match_ID(pid, 150) == false then 
		ztd(enemyid,WAR.LXXS,lxsz)
    end
    -----------------------------------------------------
    ----------------封穴统一计算--------------------------
    -----------------------------------------------------
    if fxsz > 0 and hurt > 0 then 
		ztd(enemyid,WAR.FXXS,fxsz)
    end
    -----------------------------------------------------
    ----------------灼烧统一计算--------------------------
    -----------------------------------------------------
    if zssz > 0 and hurt > 0 then 
		ztd(enemyid,WAR.ZSXS,zssz)
    end
    -----------------------------------------------------
    ----------------冰封统一计算--------------------------
    -----------------------------------------------------
    if bfsz > 0 and hurt > 0 then 
		ztd(enemyid,WAR.BFXS,bfsz)
    end
    -----------------------------------------------------
    ----------------内伤统一计算--------------------------
    -----------------------------------------------------
    if nssz > 0  and hurt > 0 then
		ztd(enemyid,"内伤点数",nssz)
    end
    --概率进入重度内伤
	if hurt > 0 and JY.Person[eid]["受伤程度"] >= 100 then
		local a = math.modf(JY.Person[eid]["生命最大值"] * 0.7)
		if JY.Person[eid]['生命'] < a then
			addbuff(eid,WAR.PD['重度内伤'],math.random(3,5),10)
		end
	end	
    -----------------------------------------------------
    ----------------战斗中毒状态-------------------------
    -----------------------------------------------------
	if hurt > 0 then
		--中毒计算
		local poisonnum = math.modf(JY.Wugong[wugong]["敌人中毒点数"] + JY.Person[pid]["攻击带毒"])
		poisonnum = math.modf(poisonnum/5)
        --田归农与阎基的加成，中毒+5 + 随机15
        if match_ID(pid, 72) then
            for j = 0, WAR.PersonNum - 1 do
                if match_ID(WAR.Person[j]["人物编号"],4) and WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[WAR.CurID]["我方"] then
                    poisonnum = poisonnum + 5 + math.random(15)
                    break
                end
            end
        end
		if poisonnum < 0 then
			poisonnum = 0
		end
        --------------------------------中毒统一显示-------------------------------
		if poisonnum > 0 then
			ztd(enemyid,"中毒点数",math.random(math.modf(poisonnum/2),math.modf(poisonnum/2)+1))
		end
		--千蛛万毒手 标记修改
		if wugong == 334 then
			WAR.QZWDS = WAR.QZWDS + JY.Person[WAR.Person[enemyid]['人物编号']]['中毒程度']
			if WAR.QZWDS > 300 then
				WAR.QZWDS = 300
			end
		end
		--殷离吸血 标记修改
		if match_ID(pid, 646) or match_ID(pid, 9790) then
			WAR.YLXX = WAR.YLXX + JY.Person[WAR.Person[enemyid]['人物编号']]['中毒程度']
			if WAR.YLXX > 400 then
				WAR.YLXX = 400
			end
			local zd = math.modf(WAR.YLXX/4+5)
			if zd > 100 then
				zd = 100
			end
			if JLSD(0,zd,pid) then
				addbuff(eid,WAR.PD["生命恢复停止"],1,2)
			end
		end
    end
	
    if nssz1 > 0 then 
       -- nssz1 = nskx(WAR.CurID,nssz1)
       -- if nssz1 > 0 then 
		ztd(WAR.CurID,"内伤点数",nssz1)
		--WAR.Person[WAR.CurID]["内伤点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid, "受伤程度", nssz1);
		-- end
    end
    --[[中毒暂时不计算抗性
    if zdsz1 > 0 then 
        zdsz1 = nskx(WAR.CurID,zdsz1)
        if zdsz1 > 0 then 
            WAR.Person[WAR.CurID]["中毒点数"] = (WAR.Person[WAR.CurID]["内伤点数"] or 0) + AddPersonAttrib(pid, "中毒程度", zdsz1);
        end
    end
    ]]
    if zssz1 > 0 then 
		ztd(WAR.CurID,WAR.ZSXS,zssz1)
    end
    if bfsz1 > 0 then 
		ztd(WAR.CurID,WAR.BFXS,bfsz1)
    end
    if fxsz1 > 0 then 
		ztd(WAR.CurID,WAR.FXXS,fxsz1)
    end
    if lxsz1 > 0 then 
		ztd(WAR.CurID,WAR.LXXS,lxsz1)
    end
	
	if JY.Person[eid]["生命"] <= 0 and inteam(eid) and WAR.SZJPYX[eid] == nil then
		WAR.SZJPYX[eid] = 1
		for ar = 0, WAR.PersonNum-1 do
			local arid = WAR.Person[ar]['人物编号']
			if DWPD(ar,enemyid) == false and WAR.Person[ar]['死亡'] == false and PersonKF(arid,25) and (Curr_NG(arid,252) or match_ID(arid,58)) and (WAR.PD['黯然值'][arid] or 0) < 100 then
				WAR.PD['黯然值'][arid] = limitX((WAR.PD['黯然值'][arid] or 0) + math.random(20,35),0,100)
			end
		end
	end	
	
	--判断是否可以加实战
	if JY.Person[eid]["生命"] <= 0 and inteam(pid) and DWPD(WAR.CurID,enemyid) and WAR.SZJPYX[eid] == nil and JY.Person[pid]["实战"] < 1000 then --一剑 500改为1000
		--崆峒派战斗、高升客栈杀欧阳克、家里练功房、全真教练功、青城派练功、少林练功   不加实战
		local wxzd = {17, 67, 226, 220, 224, 219, 79}
		local wx = 0
		for i = 1, 7 do
			if WAR.ZDDH == wxzd[i] then
				wx = 1
			end
		end
		--丐帮门口
		if WAR.ZDDH == 82 and GetS(10, 0, 18, 0) == 1 then
			wx = 1
		end
		--木人巷
		if WAR.ZDDH == 214 and GetS(10, 0, 19, 0) == 1 then
			wx = 1
		end
		--如果可加实战
		if wx == 0 and isteam(pid) then
			local szexp = 1
			if eid < 191 and 0 < eid then
				szexp = WARSZJY[eid]
				szexp = szexp - 2
				if szexp < 0 then 
					szexp = 1 
				end 
			end
			AddPersonAttrib(pid,'实战',szexp)
			WAR.SZJPYX[eid] = 1
		end
	elseif CC.PTF[eid][9919] ~= nil and (JY.Person[eid]["实战"] or 0) ~= nil and JY.Person[eid]["实战"] < 9999 then --一剑 万恶罪魁实战上限9999，打架加实战
		CC.PersonAttribMax["实战"] = 9999
			--崆峒派战斗、高升客栈杀欧阳克、家里练功房、全真教练功、青城派练功、少林练功   不加实战
		local wxzd = {17, 67, 226, 220, 224, 219, 79}
		local wx = 0
		for i = 1, 7 do
			if WAR.ZDDH == wxzd[i] then
				wx = 1
			end
		end
		--丐帮门口
		if WAR.ZDDH == 82 and GetS(10, 0, 18, 0) == 1 then
			wx = 1
		end
		--木人巷
		if WAR.ZDDH == 214 and GetS(10, 0, 19, 0) == 1 then
			wx = 1
		end
		--如果可加实战
		if wx == 0 and isteam(pid) then
			local szexp = 1
			if eid < 191 and 0 < eid then
				szexp = WARSZJY[eid]
				szexp = szexp - 2
				if szexp < 0 then 
					szexp = 1 
				end 
			end
			if JY.Person[pid]["实战"] > 1000 then		
			    AddPersonAttrib(pid,'实战',szexp*10)
			else
			   AddPersonAttrib(pid,'实战',szexp)
			   WAR.SZJPYX[eid] = 1
		    end
	    end	
	end	
	
	--复活
	fuhuo1(enemyid)

	--人物死亡
	if JY.Person[eid]["生命"] < 0 then
		JY.Person[eid]["生命"] = 0
	    WAR.Person[WAR.CurID]["经验"] = WAR.Person[WAR.CurID]["经验"] + JY.Person[eid]["等级"] * 5
	    WAR.Person[enemyid]["反击武功"] = -1		--如果被打死则不会触发反击
	    if WAR.SZSD == eid then						--取消死战标记
		    WAR.SZSD = -1
	    end
	end
	
	
	
	--平一指杀人
	if JY.Person[eid]["生命"] <= 0 and (match_ID(pid, 28) or match_ID(pid, 9889)) then
		WAR.PYZ = WAR.PYZ + 1
		if 10 < WAR.PYZ then
			WAR.PYZ = 10
		end
	end
	--无酒不欢：袁承志碧血长风杀人
	--限主角
	if JY.Person[eid]["生命"] <= 0 and match_ID(pid, 54) then
		WAR.BXCF = 1
	end
	--点点连斩
	if JY.Person[eid]["生命"] <= 0 and match_ID(pid, 457) and WAR.PD['虚邪剑来'][pid] == 1 then
		WAR.DDLZ = 1
	end
	--李白杀人
	if JY.Person[eid]["生命"] <= 0 and match_ID(pid, 636) then
		WAR.SBSYR = 1
	end
	--阿紫杀人
	if JY.Person[eid]["生命"] <= 0 and (match_ID(pid, 47) or match_ID(pid, 9886)) then
		WAR.MZSH = WAR.MZSH + 1
	end
	--血战沙场
	if JY.Person[eid]["生命"] <= 0 and WGZH(pid,198,200) then
		WAR.XZSC = WAR.XZSC + 1
	end   
	--沧溟杀人
    if JY.Person[eid]["生命"] <= 0 and wugong == 153 then 
		WAR.CM = WAR.CM + 1
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				if nokillspeed(j) == false then
					ztd(j,'集气位置',-(100 * WAR.CM)) 
				end
				local tid = WAR.Person[j]["人物编号"]
				if WAR.SZAS == 1 then
					ztd(j,WAR.FXXS,math.modf(JY.Person[pid]["实战"]/20))
					WAR.LQZ[tid] = math.modf((WAR.LQZ[tid] or 0) * 0.5)
				end	
			end		
		end
	end
	--血战八方
    if JY.Person[pid]["耍刀技巧"] >= 400 then
		if JY.Person[eid]["生命"] <= 0 then
			WAR.XZBFZT[pid]  = 1
		end
	end
	--夜雨楼杀人
	if JY.Person[525]['论剑奖励'] > 0 and pid == 0 and JY.Person[eid]["生命"] <= 0 and inteam(eid) == false then
		if MPPD(pid) == 24 then
			if JY.Person[525]['论剑奖励'] == 1 and JY.Person[eid]['畅想分阶'] <= 5 then
				CC.TX['夜雨暗杀1']=CC.TX['夜雨暗杀1']+1
			end
			if JY.Person[525]['论剑奖励'] == 2 and JY.Person[eid]['畅想分阶'] <= 2 then
				CC.TX['夜雨暗杀2']=CC.TX['夜雨暗杀2']+1
			end	
			if JY.Person[525]['论剑奖励'] > 2  then
				if eid == JY.Person[525]['论剑奖励']	then
					CC.TX['夜雨暗杀3'] = eid
				elseif JY.Person[eid]['姓名'] == JY.Person[JY.Person[525]['论剑奖励']]['姓名'] then
					CC.TX['夜雨暗杀3'] = eid
				end	
			end		
		else
			if JY.Person[525]['论剑奖励'] == 1 and JY.Person[eid]['畅想分阶'] <= 5 then
				CC.TX['夜雨暗杀1']=CC.TX['夜雨暗杀1']+1
			end
			if JY.Person[525]['论剑奖励'] == 2 and JY.Person[eid]['畅想分阶'] <= 2 then
				CC.TX['夜雨暗杀2']=CC.TX['夜雨暗杀2']+1
			end	
			if JY.Person[525]['论剑奖励'] > 2  then
				if eid == JY.Person[525]['论剑奖励']	then
					CC.TX['夜雨暗杀3'] = eid
				elseif JY.Person[eid]['姓名'] == JY.Person[JY.Person[525]['论剑奖励']]['姓名'] then
					CC.TX['夜雨暗杀3'] = eid
				end	
			end
		end
	end		
	
	if (wugong == 66 and match_ID(pid,103)) or (match_ID(pid,745) and yongdao(wugong)) and JY.Person[eid]["生命"] <= 0 and inteam(eid) == false and pid ~= eid then
		if CC.TX['死葬者身份'] == 0 then
			CC.TX['死葬者身份'] = eid
		else
			if JY.Person[eid]['畅想分阶'] < JY.Person[CC.TX['死葬者身份']]['畅想分阶'] then
				CC.TX['死葬者身份'] = eid
			end
		end
	end	
	
		
	--李莫愁赤练神掌
	if WAR.WD_CLSZ == 1  then
		local dam = JY.Person[eid]["中毒程度"]
		WAR.ZQTL = {dam, enemyid, WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"], pid}
	end
	
	--丁春秋 连环腐尸毒
	if WAR.LHFSD == 1 then
		local dam = JY.Person[eid]["中毒程度"]*3
		WAR.ZQTL = {dam, enemyid, WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"], pid}
	end
	--鲜血爆裂
	if WAR.XDLX == 1 then
		local dam = (JY.Person[eid]["流血程度"]+JY.Person[pid]["流血程度"])*2
		WAR.ZQTL = {dam, enemyid, WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"], pid}
	end
	--玄寒毒爆
	if WAR.XHDB == 1 then
		local dam = (JY.Person[eid]["冰封程度"]+JY.Person[eid]["中毒程度"])*2
		WAR.ZQTL = {dam, enemyid, WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"], pid}
	end
	
	--九阴降龙・荒龙爆
	if WAR.HLZB == 1 then
		local dam = (JY.Person[eid]["受伤程度"]+JY.Person[pid]["受伤程度"])*math.random(2,5)
		WAR.ZQTL = {dam, enemyid, WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"], pid}
	end

	--实力升级
	if inteam(pid) and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[enemyid]['我方'] and JY.Person[eid]["生命"] <= 0 then 
		local nd = JY.Base["难度"]
		local zm = limitX(JY.Base["周目"],1,125)
 	 	local xs = 0
 	 	local wc = 0
		--npc随周目增加自身强度
		if nd > 1 then 
			local fd = nd + ((nd-1)*0.33)
			xs = math.modf(zm*fd)
			wc = math.modf(zm*fd)
		end
		local can_nei = {}
		local neilist = {}
		for nei = 0, JY.WugongNum -1 do
			if JY.Wugong[nei]['武功类型'] == 6 and nei ~= 43 and nei ~= 166 and nei ~= 169 and nei ~= 172 and nei ~= 212 and nei ~= 213 and nei ~= 214 and nei ~= 218
			and nei ~= 235 and nei ~= 281 and nei ~= 282 and nei ~= 301 and nei ~= 354 and nei ~= 359 and nei ~= 365 and nei ~= 366 and nei ~= 373 and nei ~= 378 and nei ~= 379
			and nei ~= 381 then
				neilist[#neilist+1] = nei
			end
		end
		--修改标记
		--local fj = limitX(6-JY.Person[p]["畅想分阶"],1,6)
		--local sz = sw * fj
		--local tt = 5
		--local fx = math.random(4)
		while JY.Person[pid]["畅想分阶"] > JY.Person[eid]["畅想分阶"] do
			JY.Person[pid]["畅想分阶"] = JY.Person[pid]["畅想分阶"] - 1	
			if pid == 0 and JY.Person[456]["论剑奖励"] ~= 1 then 
				for p = 0, JY.PersonNum-1 do
					if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 and p ~= 739 and p ~= 740 and JY.Person[p]['畅想分阶'] <= JY.Person[0]['畅想分阶'] then
						if nd >= 3 and JY.Person[p]["畅想分阶"] <= 3 then
							xs = xs + nd * math.modf(zm*2)
							wc = wc + nd * math.modf(zm*2)
						end
						xs = math.modf(xs/7*2)
						wc = math.modf(wc/7*2)
						JY.Person[p]["拳掌功夫"] = JY.Person[p]["拳掌功夫"] + xs
						JY.Person[p]["指法技巧"] = JY.Person[p]["指法技巧"] + xs
						JY.Person[p]["御剑能力"] = JY.Person[p]["御剑能力"] + xs
						JY.Person[p]["耍刀技巧"] = JY.Person[p]["耍刀技巧"] + xs
						JY.Person[p]["特殊兵器"] = JY.Person[p]["特殊兵器"] + xs
						JY.Person[p]["武学常识"] = JY.Person[p]["武学常识"] + wc
						JY.Person[p]['实战'] = JY.Person[p]['实战'] + 50
						AddPersonAttrib(p,'生命',math.huge)
						local tt = math.modf(JY.Base['周目']*(7-JY.Person[pid]["畅想分阶"]))
						JY.Person[p]["攻击力"] = JY.Person[p]["攻击力"] + tt
						JY.Person[p]["防御力"] = JY.Person[p]["防御力"] + tt
						JY.Person[p]["轻功"] = JY.Person[p]["轻功"] + tt
					end
				end
				--CC.TX['敌人渐进增强'] = math.modf(CC.TX['敌人渐进增强']*(1+(zm/550)))			
			end 
			if pid == 0 then
				--say('内功加强开始',0,1)	
				for p = 0, JY.PersonNum-1 do
					if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 and p ~= 739 and p ~= 740 then
						for k = 1 , #neilist do
							local pd = false
							for j = 1,JY.Base['武功数量'] do
								if neilist[k] == JY.Person[p]['武功'..j] then
									pd = true
								end
							end
							if pd == false then
								can_nei[#can_nei+1] = neilist[k]
							end
						end
						if can_nei ~= nil and #can_nei > 0 then
							local wg = can_nei[math.random(#can_nei)]
							can_nei = {}
							for l = 1, JY.Base['武功数量'] do
								if JY.Person[p]['武功'..l] == 0 then
									JY.Person[p]['武功'..l] = wg
									JY.Person[p]['武功等级'..l] = 999
									break
								end
							end	
						end					
					end
				end
			end
			if JY.Person[pid]["畅想分阶"] == 6 then
				--CC.TX["弟子"] = 1
				AddPersonAttrib(pid,"攻击力",10)
				AddPersonAttrib(pid,"防御力",10)
				AddPersonAttrib(pid,"轻功",10)
				--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)
			end
			if JY.Person[pid]["畅想分阶"] == 5 then
				--CC.TX["三流"] = 1
				AddPersonAttrib(pid,"拳掌功夫",10)
				AddPersonAttrib(pid,"指法技巧",10)
				AddPersonAttrib(pid,"御剑能力",10)
				AddPersonAttrib(pid,"耍刀技巧",10)
				AddPersonAttrib(pid,"特殊兵器",10)
				--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
			end
			if JY.Person[pid]["畅想分阶"] == 4 then
				--CC.TX["二流"] = 1
				AddPersonAttrib(pid,"攻击力", 20)
				AddPersonAttrib(pid,"防御力", 20)
				AddPersonAttrib(pid,"轻功", 20)
				--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
			end
			if JY.Person[pid]["畅想分阶"] == 3 then
				--CC.TX["一流"] = 1
				AddPersonAttrib(pid,"拳掌功夫", 20)
				AddPersonAttrib(pid,"指法技巧", 20)
				AddPersonAttrib(pid,"御剑能力", 20)
				AddPersonAttrib(pid,"耍刀技巧", 20)
				AddPersonAttrib(pid,"特殊兵器", 20)
				--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
			end
			if JY.Person[pid]["畅想分阶"] == 2 then
				--CC.TX["豪侠"] = 1
				AddPersonAttrib(pid,"攻击力",30)
				AddPersonAttrib(pid,"防御力", 30)
				AddPersonAttrib(pid,"轻功", 30)
				if pid ~= 0 and inteam(pid) then
					SetJX(pid,1)
				end	
				--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
			end
			if JY.Person[pid]["畅想分阶"] == 1 then
				--CC.TX["宗师"] = 1
				AddPersonAttrib(pid,"拳掌功夫",30)
				AddPersonAttrib(pid,"指法技巧",30)
				AddPersonAttrib(pid,"御剑能力",30)
				AddPersonAttrib(pid,"耍刀技巧",30)
				AddPersonAttrib(pid,"特殊兵器",30)
				if pid ~= 0 and inteam(pid) then
				 	SetJX(pid,1)
				end
				--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
			end
			if JY.Person[pid]["畅想分阶"] == 0 then
				--CC.TX["传说"] = 1
				AddPersonAttrib(pid, "武学常识",100)
				if pid ~= 0 and inteam(pid) then
				 	SetJX(pid,1)
				end
				--say( "我方"..JY.Person[pid]["姓名"].."升"..JY.Person[pid]["畅想分阶"].."阶",0,1)	
			end
		end					   
	end
	for i = 1,JY.Base["武功数量"] do
		if JY.Person[eid]["武功"..i] == JY.Person[eid]["主运内功"] and JY.Person[eid]["武功"..i]>1 then
			if JY.Person[eid]["武功等级" .. i] < 900 then
				JY.Person[eid]["武功等级" .. i] = JY.Person[eid]["武功等级" .. i] + 10
			elseif JY.Person[eid]["武功等级" .. i] < 999 then
				--JY.Person[pid]["武功等级" .. wugongnum] = JY.Person[pid]["武功等级" .. wugongnum] + math.modf(JY.Person[pid]["资质"] / 20 + math.random(2)) + rz
				JY.Person[eid]["武功等级" .. i] = JY.Person[eid]["武功等级" .. i]  + math.modf(JY.Person[eid]["资质"] / 20 + math.random(2)) + 10
				--武功提升为极
				if 999 <= JY.Person[eid]["武功等级" .. i] then
					JY.Person[eid]["武功等级" .. i] = 999
					PlayWavAtk(42)
					DrawStrBoxWaitKey(string.format("%s修炼%s到登峰造极", JY.Person[eid]["姓名"], JY.Wugong[JY.Person[eid]["武功" .. i]]["名称"]), C_ORANGE, CC.DefaultFont)
				end
			end
		end	
	end
	
	for i = 1,JY.Base["武功数量"] do
		if JY.Person[eid]["武功"..i] == JY.Person[eid]["主运轻功"] and JY.Person[eid]["武功"..i]>1 then
			if JY.Person[eid]["武功等级" .. i] < 900 then
				JY.Person[eid]["武功等级" .. i] = JY.Person[eid]["武功等级" .. i] + 10
			elseif JY.Person[eid]["武功等级" .. i] < 999 then
				--JY.Person[pid]["武功等级" .. wugongnum] = JY.Person[pid]["武功等级" .. wugongnum] + math.modf(JY.Person[pid]["资质"] / 20 + math.random(2)) + rz
				JY.Person[eid]["武功等级" .. i] = JY.Person[eid]["武功等级" .. i]  + math.modf(JY.Person[eid]["资质"] / 20 + math.random(2)) + 10
				--武功提升为极
				if 999 <= JY.Person[eid]["武功等级" .. i] then
					JY.Person[eid]["武功等级" .. i] = 999
					PlayWavAtk(42)
					DrawStrBoxWaitKey(string.format("%s修炼%s到登峰造极", JY.Person[eid]["姓名"], JY.Wugong[JY.Person[eid]["武功" .. i]]["名称"]), C_ORANGE, CC.DefaultFont)
				end
			end
		end	
	end
	--北冥神功和吸星大法，加内力上限

	  
	WAR.NGHT = 0	--内功护体
	WAR.CQSX = 0	--除却四相
 
	--血刀老祖杀人转化为己方单位
	if match_ID(pid, 97) and JY.Person[eid]["生命"] <= 0 then    
		WAR.Person[enemyid]["我方"] = WAR.Person[WAR.CurID]["我方"]
		JY.Person[eid]["生命"] = JY.Person[eid]["生命最大值"]
		JY.Person[eid]["内力"] = JY.Person[eid]["内力最大值"]
		JY.Person[eid]["中毒程度"] = 0
		JY.Person[eid]["受伤程度"] = 0
		JY.Person[eid]["冰封程度"] = 0
		JY.Person[eid]["灼烧程度"] = 0
		JY.Person[eid]["流血程度"] = 0
		JY.Person[eid]["封穴程度"] = 0
		JY.Person[eid]["体力"] = 100
		WAR.FXXS[eid] = nil
		WAR.LXXS[eid] = nil
		WAR.XDLZ[eid] = 1
	end
	--被血刀老祖击杀的人物该回合显示动画
	if WAR.XDLZ[eid] ~= nil then
		WAR.Person[enemyid]["特效动画"] = 123
		WAR.XDLZ[eid] = nil
	end
    --白展堂、张三丰吸收别人护盾
	if ((match_ID(pid, 511) or match_ID(pid,5)) and DWPD(WAR.CurID,enemyid)) or (match_ID(pid,456) and WAR.Dodge == 1) then
		local zt = {{'先天护盾',1},{'先天太极',1},{'阴阳二气',1},{'长生真气',1},{'神足瑜伽'},
					{'金刚护盾',1},{'神足护盾',1},{'葵花护盾',1},{'九阳护盾',1},{'吸星真气',1},
					{'六阳正气',2},{'黄连解毒',2},{'牛黄血蝎',2},{'小还丹',2},{'天香续命',2},{'白云熊胆',2},
					{'即墨老酒',2},{'玉露酒',2},{'梨花酒',2},{'五宝花蜜酒',2},
					{'神兵',2},{'战神状态',2},{'长生诀',2},{'破剑八刀',2},{'天魔金身',2},
					}
		--local zt2 = {{'BTZT',2},{'WTL_LDJT',2},{'ZTHF',2},{'QGZT',2},
					--}
		local pd = false 
		--local n = 0
		local menu = {}
		--for j = 1,#zt do 
			--local yc = zt[j][1]
			--if WAR.PD[yc][eid] ~= nil and WAR.PD[yc][eid] > 0 then 
				--menu[#menu+1] = {j,1}
			--end
		--end
		--for j = 1,#zt2 do 
			--local yc = zt2[j][1]
			--if WAR[yc][eid] ~= nil and WAR.PD[yc][eid] > 0 then 
				--menu[#menu+1] = {j,2}
			--end
		--end
		if #menu > 0 then 
			local n = math.random(#menu)
			if menu[n][2] == 1 then 
				local yc = zt[menu[n][1]][1]
				local lx = zt[menu[n][1]][2]
				if lx == 2 then
					WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
				end
				WAR.PD[yc][eid] = nil
			--else 
				--local yc = zt2[menu[n][1]][1]
				--local lx = zt2[menu[n][1]][2]
				--if lx == 2 then
					--WAR[yc][pid] = (WAR[yc][pid] or 0) + WAR[yc][eid]
				--end
				--WAR[yc][eid] = nil
			end
		end
	end
	--套装、主运太极反弹异常
 	if enemyid ~= WAR.CurID and (Fjkx(WAR.CurID) ~= 2 or match_ID(eid,456)) then
		local pd = false 
		if (Curr_NG(eid, 171) and JLSD(0,30,eid)) or (match_ID(eid,5) and JLSD(0,40,eid)) or match_ID(eid,456) then
			pd = true
		end
		
		if PDTZ(eid,JY.Person[eid]["武器"]) then	
			local n = JY.Person[eid]["武器"]
			local jl = 30 	
			if JLSD(0,jl,eid) and Setmeal[n][4] == 26 then
				pd = true	
			end
		end
		
		if pd == true then
			for j = 1,#WAR.Debuf10 do
				local yc = WAR.Debuf10[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
					WAR.PD[yc][eid] = nil
				end
			end
			for j = 1,#WAR.Debuf11 do
				local yc = WAR.Debuf11[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
					WAR.PD[yc][eid] = nil
				end
			end
			if Curr_NG(eid,171) then
				for j = 1,#WAR.Debuf4 do
					local yc = WAR.Debuf4[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
				for j = 1,#WAR.Debuf5 do
					local yc = WAR.Debuf5[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
				for j = 1,#WAR.Debuf9 do
					local yc = WAR.Debuf9[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end	
			end	
			if (match_ID(eid,5) and JXPD(eid,5,1)) or (NGQH(eid,171) and JLSD(0,30,eid)) then
				for j = 1,#WAR.Debuf do
					local yc = WAR.Debuf[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
				for j = 1,#WAR.Debuf1 do
					local yc = WAR.Debuf1[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
				for j = 1,#WAR.Debuf2 do
					local yc = WAR.Debuf2[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
				for j = 1,#WAR.Debuf3 do
					local yc = WAR.Debuf3[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
			end	
			if match_ID(eid,456) then
				for j = 1,#WAR.Debuf6 do
					local yc = WAR.Debuf6[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
				for j = 1,#WAR.Debuf7 do
					local yc = WAR.Debuf7[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
				for j = 1,#WAR.Debuf8 do
					local yc = WAR.Debuf8[j][1]
					if WAR.PD[yc][eid] ~= nil then 
						WAR.PD[yc][pid] = (WAR.PD[yc][pid] or 0) + WAR.PD[yc][eid]
						WAR.PD[yc][eid] = nil
					end
				end
			end	
			local ns = JY.Person[eid]["受伤程度"]
			local zd = JY.Person[eid]["中毒程度"]
			local bf = JY.Person[eid]["冰封程度"]
			local zs = JY.Person[eid]["灼烧程度"]
			local lx = JY.Person[eid]["流血程度"]
			local fx = JY.Person[eid]["封穴程度"]
			if ns > 0 then
				ztd(WAR.CurID,"内伤点数",ns)
				ztd(enemyid,"内伤点数",-ns)
				if match_ID(eid,5) then
					JY.Person[eid]['受伤程度'] = 0
				end
			end
			if zd > 0 then 
				ztd(WAR.CurID,"中毒点数",zd)
				ztd(enemyid,"中毒点数",-zd)
				if match_ID(eid,5) then
					JY.Person[eid]['中毒程度'] = 0
				end
			end
			if bf > 0 then 
				ztd(WAR.CurID,WAR.BFXS,bf)
				ztd(enemyid,WAR.BFXS,-bf)
				if match_ID(eid,5) then
					JY.Person[eid]['冰封程度'] = 0
				end
			end
			if zs > 0 then 
				ztd(WAR.CurID,WAR.ZSXS,zs)
				ztd(enemyid,WAR.ZSXS,-zs)
				if match_ID(eid,5) then
					JY.Person[eid]['灼烧程度'] = 0
				end
			end
			if lx > 0 then 
				ztd(WAR.CurID,WAR.LXXS,lx)
				ztd(enemyid,WAR.LXXS,-lx)
				if match_ID(eid,5) then
					JY.Person[eid]['流血程度'] = 0
				end
			end
			if fx > 0 then 
				ztd(WAR.CurID,WAR.FXXS,fx)
				ztd(enemyid,WAR.FXXS,-fx)
				if match_ID(eid,5) then
					JY.Person[eid]['封穴程度'] = 0
				end
			end
			if Curr_NG(eid,171) then
				Set_Eff_Text(enemyid,"特效文字0","转阴阳");
			else
				Set_Eff_Text(enemyid,"特效文字0","化三清");	
			end	
		end	
	end
	--降龙逆光
	if wugong == 26 and (JXPD(pid,527,1) or pid == 527) and MPPD(pid) == 24 and Curr_NG(pid,367) then
		if WAR.PD['降龙逆光掌2'] == nil then
			for j = 1,#WAR.Debuf do
				local yc = WAR.Debuf[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf2 do
				local yc = WAR.Debuf2[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf3 do
				local yc = WAR.Debuf3[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf4 do
				local yc = WAR.Debuf4[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf15 do
				local yc = WAR.Debuf15[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf6 do
				local yc = WAR.Debuf6[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf7 do
				local yc = WAR.Debuf7[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
		else
			for j = 1,#WAR.PD['降龙逆光掌2'] do
				local yc = WAR.PD['降龙逆光掌2'][j][1]
				local ycl = WAR.PD['降龙逆光掌2'][j][2]
				WAR.PD[yc][eid] = (WAR.PD[yc][eid] or 0) + ycl
			end		
			for j = 1,#WAR.Debuf do
				local yc = WAR.Debuf[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf2 do
				local yc = WAR.Debuf2[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf3 do
				local yc = WAR.Debuf3[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf4 do
				local yc = WAR.Debuf4[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf15 do
				local yc = WAR.Debuf15[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf6 do
				local yc = WAR.Debuf6[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
			for j = 1,#WAR.Debuf7 do
				local yc = WAR.Debuf7[j][1]
				if WAR.PD[yc][eid] ~= nil then 
					WAR.PD['降龙逆光掌2'][#WAR.PD['降龙逆光掌2']+1] = {yc,WAR.PD[yc][eid]}
				end
			end
		end
	end		
	WAR.PD['氤氲紫气'][eid] = nil
	WAR.GSWS = 0
	WAR.TJAY = 0
  ::label0::
end

Ct['伤害结算'] = function(wugong, level, ang, x, y,ZHEN_ID)
    local pid = WAR.Person[WAR.CurID]['人物编号']
    local hurt = 0
    local swhurt,wxhurt = nil,nil
	--没有合击
	if not ZHEN_ID then
		ZHEN_ID = -1
    end
    if hurt == nil or hurt < 0 then
    	do return end
    end	
    --计算攻击方的输出
    Cat('挪移闪避',wugong,x,y,hurt,ang)
	Cat('区域免疫',wugong,x,y,hurt,ang)	
    --同归剑法
    if WAR.PD["同归状态"][pid] ~= nil and Fjkx(WAR.CurID) ~= 2 then	
        swhurt,wxhurt,ang = Cat('三围五系伤害计算',WAR.CurID,wugong, level, ang, x, y)
        Cat('总伤害计算',WAR.CurID, wugong, level, ang, hurt,swhurt,wxhurt)
        SetWarMap(WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y'],4,2)
        WAR.TXXS[pid] = 1
    end
    for i = 0,WAR.PersonNum - 1 do 
		local id = WAR.Person[i]['人物编号']
		local x1,y1 = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
		--是否命中，默认命中
		local mz = true
		--是否为反弹伤害
		local fs = false
		local hurt2 = hurt 
		local ang2 = ang
		--闪避不结算
	    if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID  then
			if nomiss(pid,WAR.Person[i]['人物编号'],wugong) == false then
				Cat('闪避',i,wugong,hurt,ang)
			end	
		end
		if yongwu(wugong,360) and Curr_NG(pid,93) then
			if WAR.Miss[id] ~= nil then
				WAR.Miss[id] = nil
			else
				WAR.PD['圣火三虚七实'][pid] = 2
			end
		end			
		--反弹
     	if WAR.Person[i]['死亡'] == false and GetWarMap(x1,y1,4) > 0 and i ~= WAR.CurID then
			--是否队友误伤，队友情况下
			if DWPD(WAR.CurID,i) == false then
				if WAR.PD["幽冥血河2"][pid] ~= nil then
					WAR.WS = 0
				end
				--混乱为误伤，伤害不衰减
				if WAR.PD["混乱状态"][pid] ~= nil or WAR.PD["荒天龙灭"][pid] ~= nil or WAR.PD['精神错乱'][pid] ~= nil or WAR.PD['三尸脑神丹'][pid] ~= nil then
					--SetWarMap(x1,y1,4,2)
					mz = true
					--标记为反弹伤害
					fs = true
					--误伤不打到队友
				elseif WAR.WS == 1 then
					mz = false
					--合击不打队友
				elseif ZHEN_ID >= 0 then
					mz = false
				elseif WAR.WS == 0 then
					local a = Atk(WAR.CurID) - Def(i)
					a = limitX(math.modf(a*0.8),0,math.modf(psx(id,'生命最大值')*0.3))
					if a > 0 then
						ztd(i,'生命点数',-math.modf(a))
						for j = 0,WAR.PersonNum - 1 do
							local eid = WAR.Person[j]['人物编号']
							if WAR.Person[j]['死亡'] == false and WAR.PD["幽冥血河1"][eid] ~= nil then
								WAR.Person[j]["特效文字1"] = "幽冥血海・冥河往生"
								WAR.Person[j]["特效动画"] = 178
								ztd(j,'生命点数',math.modf(a))
							end
						end
					end	
					mz = false  
				end 
			end
			--夜雨不沾衣
			if QGQH(id,304,2) then
				local jl = 20
				if JXPD(id,525,1) then
					jl = jl + 10
				end	
				if (match_ID(id,526) and WAR.ACT >= 4) or JLSD(0,jl,id) then 
					Cat('遮影',i)
					mz = false
				end	
			end
			if WAR.PD['遮影'][id] ~= nil then
				mz = false
			end	
			--夜雨楼
			if WAR.PD['无明夜'][id] ~= nil then
				WAR.Person[i]["特效文字2"] = "无明沉夜"
				WAR.Person[i]["特效动画"] = 184
				mz = false
			end	
			--踏雪无痕
			if QGQH(id,277,2) and JLSD(10,35,id) then
				Cat('雪遁',i)
				mz = false
				if match_ID(id,103) then
					zhanyi(id,25)
				end	
			end
			if WAR.PD['雪遁'][id] ~= nil then
				mz = false
			end
			--林朝阳 轻云蔽月 无法被打到
			if match_ID(id, 605) or match_ID(id, 9803) then
				if WAR.QYBY[id] == nil then
					WAR.QYBY[id] = 50
				end
				if WAR.QYBY[id] > 40 then
					WAR.Person[i]["特效文字2"] = "轻云蔽月"
					WAR.Person[i]["特效动画"] = 102
					mz = false
				end	
			end
			--开宗明卷之内，唯有佛首常胜
			if WAR.PD['无始无明'][id] ~= nil then
				mz = false
			end	
			--魔主
			if actor(id,11) then
				if math.random(100) > 85 then
					WAR.PD['魔之甲'][id] = 1
				end
			end	
			--一刀流
			if (MPTX(id,11,2) and Curr_NG(id,152)) or match_ID(id,596) or match_ID(id,501) then
				if WAR.JBMY[id] == nil then
					WAR.JBMY[id] = 30
				end	
				if WAR.JBMY[id] > 15 then 
					if match_ID(id,501) then
						WAR.Person[i]["特效文字0"] = "不坏身・万法无我"
						WAR.BTZT[id] = 1
					elseif match_ID(id,596) then
						WAR.Person[i]["特效文字0"] = "无距境・天地任行"
						ztd(i,'集气位置',300)
					else
						WAR.Person[i]["特效文字0"] = "秘剑演武・剑步谜影"
					end
					mz = false
				end
			end
			--青城虎辟
			if WAR.QCHP == 1 and MPTX(id,28,2) then
				WAR.PD['虎辟'][id] = 15
				WAR.Person[i]["特效文字0"] = "虎辟"
				mz = false
				WAR.QCHP = 0
			end
			--YSHJ易水寒决
			if (MPTX(id,20,3) or match_ID(id,514)) and WAR.YSHJ[id] ~= nil then
				WAR.Person[i]["特效文字1"]	= "壮士一去兮"			
				mz = false
			end	
			--竹风雨滴
			if match_ID(id,520) then 
				if WAR.MHBF[id] == nil then
					WAR.MHBF[id] = 30
				end 
				if WAR.MHBF[id] > 20 then 
					WAR.Person[i]["特效文字1"] = "速水无痕・纵走梅花"
					mz = false
				end
			end
			--天魔金身
			if Curr_NG(id,160) and JY.Person[id]["生命"] < JY.Person[id]["生命最大值"]/2 then
				if WAR.PD['天魔金身'][id] == nil then
					WAR.PD['天魔金身'][id] = 70
					if NGQH(id,160) then
						if JLSD(10,60,id) then
							WAR.PD['天魔金身'][id] = WAR.PD['天魔金身'][id] + math.random(30,50)
						else
							WAR.PD['天魔金身'][id] = WAR.PD['天魔金身'][id] + 20
						end	
					end
					if ZhongYongZD1(id) then
						local pz = 80 - math.abs(50-JY.Person[id]["资质"]) 
						if JLSD(0,pz,id) then
							if (WAR.PD['中庸'][id] or 0) < 25 then
								WAR.PD['中庸'][id] = 25
							end
						end
					end
					if WAR.Person[i]["护盾"] == nil or WAR.Person[i]["护盾"] ~= 13 then
						WAR.Person[i]["护盾"] = 13
					end	
				end
			end
			if (WAR.PD['天魔金身'][id] or 0) > 50 then
				ztd(i,'集气位置',math.random(200,300))
				if psx(id,'内力') > math.modf(JY.Wugong[wugong]['消耗内力点数']*30) then
					WAR.Person[i]["特效文字1"] = "天魔金身"
					WAR.Person[i]["特效动画"] = 122
					mz = false
				end
			end	
			--满江红
			if MPTX(id,23,4) and ZYJQ(id) then
				WAR.Person[i]["特效文字1"] = "壮怀激烈"
			end
			--护龙金刚
			if (MPTX(id,25,4) and Curr_NG(id,366)) or match_ID(id,748) then
				if match_ID(id,748) and JY.Person[id]["生命"] > 0 then
					ztd(i,'集气位置',math.random(200,300))
				end
				if WAR.HLJG[id] == nil then
					WAR.HLJG[id] = 30
				end			
				if WAR.HLJG[id] > 15 and psx(id,'内力') > math.modf(JY.Wugong[wugong]['消耗内力点数']*30) then
					WAR.Person[i]["特效文字0"] = "护龙绝技・明心见性"
					mz = false
				end
			end
			--天机宫
			if (MPTX(id,30,3) and Curr_NG(id,180)) or match_ID(id,635) then
				if WAR.HLJG[id] == nil then
					WAR.HLJG[id] = 30
				end			
				if WAR.HLJG[id] > 15 then
					WAR.Person[i]["特效文字0"] = "乘风蹈海"
					mz = false
				end
			end
			--中庸之道2 标记修改，25%几率打断敌人行动，并反击 中庸觉醒
			if ZhongYongZD2(id) then
				local jl = 25
				if ZYJQ(id) then
					jl = jl*2
				end
				if BNJQ(id) then
					jl = jl*2
				end
				if JLSD(0,jl,id) then
					WAR.DLJ = 1
					WAR.DZY = 1
					if Fjkx(WAR.CurID) ~= 2 or (JY.Person[0]["中庸"] == 3) then
						if JY.Person[0]["中庸"] == 3 then
							JY.Person[id]["封穴程度"] = 0
							if (WAR.SPIRIT[id] or 0) < 100 then
								zhanyi(id,100)
							end
						end
						Cat('清除高级异常',WAR.CurID)
						local fjwg = wugong
						if JY.Person[id]['优先使用'] > 0 then
							fjwg = JY.Person[id]['优先使用']
						else
							if JY.Person[id]['天赋外功1'] > 0 then
								fjwg = JY.Person[id]['天赋外功1']
							end
						end
						WAR.Person[i]['反击武功'] = fjwg
						ztd(i,'集气位置',200)
					end
					WAR.Person[i]["特效文字0"] = "庸人也有天"
				end
			end
			--无形气墙
			if WAR.PD['无形气墙'][id] ~= nil and WAR.PD['无形气墙'][id] > 0 and math.random(100) <= 20 then
				mz = false
			end
			--天罗地网
			if QGQH(pid,148,2) or match_ID(pid,520) or (WAR.SSYB == 1 and MPTX(pid,23,4)) or WAR.PD['曲径通幽'][pid] == 1 then
				if mz == false then
					mz = true
				end
			end
			--护龙军师大阵
			if WAR.PD['后土阵'][pid] == 1 and math.random(100) < 30 then 
				if mz == false then
					mz = true
				end
			end
			if WAR.PD['凝结时空'][id] == 1 then 
				if mz == false then
					mz = true
				end
			end
			-----------------------------------------------------------------------------------------------------
			------------------------------------------------------分身------------------------------------------- 
			-----------------------------------------------------------------------------------------------------
				--一刀流
				if MPTX(id,11,2) and Curr_NG(id,152) and id ~= 740 and isteam(id) and WAR.PD["分身判定"][id] == nil and WAR.PD["分身判定1"][id] == nil then
					if WAR.PD["分身上限"][id] == nil or JLSD(70,100,id) then
						local str = ""
						local x, y = WE_xy(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] - 1)
						local mid = 740			--定义一个临时的戚长发数据
						JY.Person[mid]["暂时无用"] = JY.Base["畅想"]			
						JY.Person[mid]["头像代号"] = JY.Person[id]["头像代号"]
						JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
						JY.Person[mid]["天赋内功"] = JY.Person[id]["天赋内功"]
						JY.Person[mid]["天赋外功1"] = JY.Person[id]["天赋外功1"]
						JY.Person[mid]["天赋外功2"] = JY.Person[id]["天赋外功2"]	
						JY.Person[mid]["天赋轻功"] = JY.Person[id]["天赋轻功"]			
						JY.Person[mid]["指法技巧"] = JY.Person[id]["指法技巧"]
						JY.Person[mid]["御剑能力"] = JY.Person[id]["御剑能力"]	
						JY.Person[mid]["耍刀技巧"] = JY.Person[id]["耍刀技巧"]
						JY.Person[mid]["特殊兵器"] = JY.Person[id]["特殊兵器"]
						JY.Person[mid]["武学常识"] = JY.Person[id]["武学常识"]
						JY.Person[mid]["攻击带毒"] = JY.Person[id]["攻击带毒"]
						JY.Person[mid]["左右互搏"] = JY.Person[id]["左右互搏"]
						JY.Person[mid]["中庸"] = JY.Person[id]["中庸"]
						JY.Person[mid]["攻击力"] = JY.Person[id]["攻击力"]
						JY.Person[mid]["防御力"] = JY.Person[id]["防御力"]
						JY.Person[mid]["轻功"] = JY.Person[id]["轻功"]
						JY.Person[mid]["医疗能力"] = JY.Person[id]["医疗能力"]
						JY.Person[mid]["用毒能力"] = JY.Person[id]["用毒能力"]
						--JY.Person[mid]["解毒能力"] = JY.Person[id]["解毒能力"]
						JY.Person[mid]["暗器技巧"] = JY.Person[id]["暗器技巧"]
						JY.Person[mid]["抗毒能力"] = JY.Person[id]["抗毒能力"]
						JY.Person[mid]["个人觉醒"] = JY.Person[id]["个人觉醒"]
						JY.Person[mid]["六如觉醒"] = JY.Person[id]["六如觉醒"]
						JY.Person[mid]["畅想分阶"] = JY.Person[id]["畅想分阶"]
						JY.Person[mid]["主运轻功"] = JY.Person[id]["主运轻功"]
						JY.Person[mid]["主运内功"] = JY.Person[id]["主运内功"]
						JY.Person[mid]["冰封程度"] = 0
						JY.Person[mid]["灼烧程度"] = 0
						JY.Person[mid]["中毒程度"] = 0
						JY.Person[mid]["受伤程度"] = 0
						JY.Person[mid]["实战"] = JY.Person[id]["实战"]
						JY.Person[mid]["等级"] = JY.Person[id]["等级"]
						JY.Person[mid]["门派技能1"] = JY.Person[id]["门派技能1"]
						for o = 1,JY.Base["武功数量"] do
							JY.Person[mid]["武功"..o] = JY.Person[id]["武功"..o]
							JY.Person[mid]["武功等级"..o] = JY.Person[id]["武功等级"..o]
						end
						for i=1,5 do
							JY.Person[mid]["出招动画帧数" .. i]=JY.Person[id]["出招动画帧数" .. i]
							JY.Person[mid]["出招动画延迟" .. i]=JY.Person[id]["出招动画延迟" .. i]
							JY.Person[mid]["武功音效延迟" .. i]=JY.Person[id]["武功音效延迟" .. i]
						end	
						JY.Person[mid]["武器"] = JY.Person[id]["武器"]
						JY.Person[mid]["防具"] = JY.Person[id]["防具"]
						JY.Person[mid]["坐骑"] = JY.Person[id]["坐骑"]
						JY.Person[mid]["生命最大值"] = math.modf(JY.Person[id]["生命最大值"] * 1)
						JY.Person[mid]["生命"] = JY.Person[id]["生命最大值"]
						JY.Person[mid]["内力最大值"] = math.modf(JY.Person[id]["内力最大值"] * 1)
						JY.Person[mid]["内力"] = JY.Person[id]["内力最大值"]
						JY.Person[mid]["体力"] = 100
						JY.Person[mid]["生命增长"] = JY.Person[id]["生命增长"]
						JY.Person[mid]["内力性质"] = JY.Person[id]["内力性质"]
						JY.Person[mid]["性别"] = JY.Person[id]["性别"]
						JY.Person[mid]["资质"] = JY.Person[id]["资质"]
						NewWARPersonZJ(mid, true, x, y, false, 1);
						WAR.JQSDXS[mid] = (WAR.JQSDXS[id] or 50)
						WAR.SPIRIT[mid] = (WAR.SPIRIT[id] or 50)
						WAR.PD["分身判定"][id] = mid --判断自己是不是发动过分身
						WAR.PD["分身判定1"][mid] = id --用来做死后复活
						WAR.PD["分身瞬动"][mid] = 1 --让分身第一回合瞬动
						WAR.PD["分身上限"][id] = 1
								--[[if WAR.PD['中庸'][id] ~= nil then
									WAR.PD['中庸'][id] = math.modf(WAR.PD['中庸'][id] * 2)
								end	]]
					end	
				end		
			
                --云梦涧4级
				if MPTX(id,26,4) and id ~= 740 and isteam(id) and WAR.PD["分身判定"][id] == nil and WAR.PD["分身判定1"][id] == nil then
					if WAR.PD["分身上限"][id] == nil or JLSD(70,100,id) then
						local str = ""
						local x, y = WE_xy(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] - 1)
						local mid = 740			--定义一个临时的戚长发数据
						JY.Person[mid]["暂时无用"] = JY.Base["畅想"]			
						JY.Person[mid]["头像代号"] = JY.Person[id]["头像代号"]
						JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
						JY.Person[mid]["天赋内功"] = JY.Person[id]["天赋内功"]
						JY.Person[mid]["天赋外功1"] = JY.Person[id]["天赋外功1"]
						JY.Person[mid]["天赋外功2"] = JY.Person[id]["天赋外功2"]	
						JY.Person[mid]["天赋轻功"] = JY.Person[id]["天赋轻功"]			
						JY.Person[mid]["指法技巧"] = JY.Person[id]["指法技巧"]
						JY.Person[mid]["御剑能力"] = JY.Person[id]["御剑能力"]	
						JY.Person[mid]["耍刀技巧"] = JY.Person[id]["耍刀技巧"]
						JY.Person[mid]["特殊兵器"] = JY.Person[id]["特殊兵器"]
						JY.Person[mid]["武学常识"] = JY.Person[id]["武学常识"]
						JY.Person[mid]["攻击带毒"] = JY.Person[id]["攻击带毒"]
						JY.Person[mid]["左右互搏"] = JY.Person[id]["左右互搏"]
						JY.Person[mid]["中庸"] = JY.Person[id]["中庸"]
						JY.Person[mid]["攻击力"] = JY.Person[id]["攻击力"]
						JY.Person[mid]["防御力"] = JY.Person[id]["防御力"]
						JY.Person[mid]["轻功"] = JY.Person[id]["轻功"]
						JY.Person[mid]["医疗能力"] = JY.Person[id]["医疗能力"]
						JY.Person[mid]["用毒能力"] = JY.Person[id]["用毒能力"]
						JY.Person[mid]["暗器技巧"] = JY.Person[id]["暗器技巧"]
						JY.Person[mid]["抗毒能力"] = JY.Person[id]["抗毒能力"]
						JY.Person[mid]["个人觉醒"] = JY.Person[id]["个人觉醒"]
						JY.Person[mid]["六如觉醒"] = JY.Person[id]["六如觉醒"]
						JY.Person[mid]["畅想分阶"] = JY.Person[id]["畅想分阶"]
						JY.Person[mid]["主运轻功"] = JY.Person[id]["主运轻功"]
						JY.Person[mid]["主运内功"] = JY.Person[id]["主运内功"]
						JY.Person[mid]["冰封程度"] = 0
						JY.Person[mid]["灼烧程度"] = 0
						JY.Person[mid]["中毒程度"] = 0
						JY.Person[mid]["受伤程度"] = 0
						JY.Person[mid]["实战"] = JY.Person[id]["实战"]
						JY.Person[mid]["等级"] = JY.Person[id]["等级"]
						JY.Person[mid]["门派技能1"] = JY.Person[id]["门派技能1"]
						for o = 1,JY.Base["武功数量"] do
							JY.Person[mid]["武功"..o] = JY.Person[id]["武功"..o]
							JY.Person[mid]["武功等级"..o] = JY.Person[id]["武功等级"..o]
						end
						for i=1,5 do
							JY.Person[mid]["出招动画帧数" .. i]=JY.Person[id]["出招动画帧数" .. i]
							JY.Person[mid]["出招动画延迟" .. i]=JY.Person[id]["出招动画延迟" .. i]
							JY.Person[mid]["武功音效延迟" .. i]=JY.Person[id]["武功音效延迟" .. i]
						end	
						JY.Person[mid]["武器"] = JY.Person[id]["武器"]
						JY.Person[mid]["防具"] = JY.Person[id]["防具"]
						JY.Person[mid]["坐骑"] = JY.Person[id]["坐骑"]
						JY.Person[mid]["生命最大值"] = math.modf(JY.Person[id]["生命最大值"] * 1)
						JY.Person[mid]["生命"] = JY.Person[id]["生命最大值"]
						JY.Person[mid]["内力最大值"] = math.modf(JY.Person[id]["内力最大值"] * 1)
						JY.Person[mid]["内力"] = JY.Person[id]["内力最大值"]
						JY.Person[mid]["体力"] = 100
						JY.Person[mid]["生命增长"] = JY.Person[id]["生命增长"]
						JY.Person[mid]["内力性质"] = JY.Person[id]["内力性质"]
						JY.Person[mid]["性别"] = JY.Person[id]["性别"]
						JY.Person[mid]["资质"] = JY.Person[id]["资质"]
						NewWARPersonZJ(mid, true, x, y, false, 1);
						WAR.JQSDXS[mid] = (WAR.JQSDXS[id] or 50)
						WAR.SPIRIT[mid] = (WAR.SPIRIT[id] or 50)
						WAR.PD["分身判定"][id] = mid --判断自己是不是发动过分身
						WAR.PD["分身判定1"][mid] = id --用来做死后复活
						WAR.PD["分身瞬动"][mid] = 1 --让分身第一回合瞬动
						WAR.PD["分身上限"][id] = 1
						--[[if WAR.PD['中庸'][id] ~= nil then
							WAR.PD['中庸'][id] = math.modf(WAR.PD['中庸'][id] * 2)
						end	]]
					end
				end 					
			
				if NGQH(id,160) and id ~= 739 and isteam(id) and WAR.PD["分身判定"][id] == nil and WAR.PD["分身判定1"][id] == nil and JY.Person[id]["生命"] < 1000 then				
					if WAR.PD["分身上限"][id] == nil or JLSD(10,30,id) then
						local str = ""
						local x, y = WE_xy(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] - 1)
						local mid = 739			--定义一个临时的戚长发数据
						--JY.Person[mid] = {};
						--复制上面三行过来
						--JY.Person[id]["生命"] = 5
						JY.Person[mid]["姓名"] = "魔念化身"
						--JY.Person[mid]["生命"] = JY.Person[id]["生命"]
						JY.Person[mid]["暂时无用"] = JY.Base["畅想"]			
						JY.Person[mid]["头像代号"] = JY.Person[id]["头像代号"]
						JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
						JY.Person[mid]["天赋内功"]=JY.Person[id]["天赋内功"]
						JY.Person[mid]["天赋外功1"]=JY.Person[id]["天赋外功1"]
						JY.Person[mid]["天赋外功2"]=JY.Person[id]["天赋外功2"]	
						JY.Person[mid]["天赋轻功"]=JY.Person[id]["天赋轻功"]			
						JY.Person[mid]["指法技巧"]=JY.Person[id]["指法技巧"]
						JY.Person[mid]["御剑能力"]=JY.Person[id]["御剑能力"]	
						JY.Person[mid]["耍刀技巧"]=JY.Person[id]["耍刀技巧"]
						JY.Person[mid]["特殊兵器"]=JY.Person[id]["特殊兵器"]
						JY.Person[mid]["武学常识"]=JY.Person[id]["武学常识"]
						JY.Person[mid]["攻击带毒"]=JY.Person[id]["攻击带毒"]
						JY.Person[mid]["左右互搏"]=JY.Person[id]["左右互搏"]
						JY.Person[mid]["中庸"]=JY.Person[id]["中庸"]
						JY.Person[mid]["攻击力"]=JY.Person[id]["攻击力"]
						JY.Person[mid]["防御力"]=JY.Person[id]["防御力"]
						JY.Person[mid]["轻功"]=JY.Person[id]["轻功"]
						JY.Person[mid]["医疗能力"]=JY.Person[id]["医疗能力"]
						JY.Person[mid]["用毒能力"]=JY.Person[id]["用毒能力"]
						--JY.Person[mid]["解毒能力"]=JY.Person[id]["解毒能力"]
						JY.Person[mid]["暗器技巧"]=JY.Person[id]["暗器技巧"]
						JY.Person[mid]["抗毒能力"]=JY.Person[id]["抗毒能力"]
						JY.Person[mid]["个人觉醒"]= JY.Person[id]["个人觉醒"]
						JY.Person[mid]["六如觉醒"]= JY.Person[id]["六如觉醒"]
						JY.Person[mid]["畅想分阶"]= JY.Person[id]["畅想分阶"]
						JY.Person[mid]["主运轻功"]=JY.Person[id]["主运轻功"]
						JY.Person[mid]["主运内功"]=JY.Person[id]["主运内功"]
						JY.Person[mid]["冰封程度"] = 0
						JY.Person[mid]["灼烧程度"] = 0
						JY.Person[mid]["中毒程度"] = 0
						JY.Person[mid]["受伤程度"] = 0
						JY.Person[mid]["实战"] = JY.Person[id]["实战"]
						JY.Person[mid]["等级"] = JY.Person[id]["等级"]
						JY.Person[mid]["门派技能1"] = JY.Person[id]["门派技能1"]
						for o = 1,JY.Base["武功数量"] do
							JY.Person[mid]["武功"..o] = JY.Person[id]["武功"..o]
							JY.Person[mid]["武功等级"..o] = JY.Person[id]["武功等级"..o]
						end
						for i=1,5 do
							JY.Person[mid]["出招动画帧数" .. i]=JY.Person[id]["出招动画帧数" .. i]
							JY.Person[mid]["出招动画延迟" .. i]=JY.Person[id]["出招动画延迟" .. i]
							JY.Person[mid]["武功音效延迟" .. i]=JY.Person[id]["武功音效延迟" .. i]
						end	
						JY.Person[mid]["武器"]=JY.Person[id]["武器"]
						JY.Person[mid]["防具"]=JY.Person[id]["防具"]
						JY.Person[mid]["坐骑"]=JY.Person[id]["坐骑"]
						JY.Person[mid]["生命最大值"] = math.modf(JY.Person[id]["生命最大值"]*1)
						JY.Person[mid]["生命"] = JY.Person[id]["生命最大值"]
						JY.Person[mid]["内力最大值"] = math.modf(JY.Person[id]["内力最大值"]*1)
						JY.Person[mid]["内力"] =JY.Person[id]["内力最大值"]
						JY.Person[mid]["体力"] = 100
						JY.Person[mid]["生命增长"] =JY.Person[id]["生命增长"]
						JY.Person[mid]["内力性质"] =JY.Person[id]["内力性质"]
						JY.Person[mid]["性别"] =JY.Person[id]["性别"]
						JY.Person[mid]["资质"] =JY.Person[id]["资质"]
						JoinMP(mid,MPPD(id),MPDJ(id))
						CC.PTF[mid] = {}	
						for k,v in pairs(CC.PTFSM) do
							if CC.PTFSM[k][1] ~= nil and CC.PTF[0][k] == 1 then
								CC.PTF[mid][k] = 1
							end	
						end
						NewWARPersonZJ(mid, true, x, y, false, 1);
						WAR.JQSDXS[mid] = (WAR.JQSDXS[id] or 50)
						WAR.SPIRIT[mid] = (WAR.SPIRIT[id] or 50)
						WAR.PD["分身判定"][id] = mid --判断自己是不是发动过分身
						--WAR.JSJY[100+mid] = 20--判断分身可以存在多久
						WAR.PD["分身判定1"][mid] = id --用来做死后复活
						WAR.PD["分身瞬动"][mid] = 1 --让分身第一回合瞬动
						WAR.PD["分身上限"][id] = 1
						if WAR.PD['中庸'][id] ~= nil then
							WAR.PD['中庸'][id] = math.modf(WAR.PD['中庸'][id]*2)
						end	
						--[[str = "佛魔分化"
						Set_Eff_Text(id,"特效文字3",str)]]
						for i = 40, 80 do
							NewDrawString(-1, -1, "天魔奥义 佛魔双化", C_BLACK, i)
							ShowScreen()
							if i == 80 then
								Cls()
								NewDrawString(-1, -1, "天魔奥义 佛魔双化", C_BLACK, i)
								ShowScreen()
								lib.Delay(400)
							else
								lib.Delay(1)
							end
						end
					end	
				end
			--被打中时
			if mz == true and WAR.Miss[id] == nil then 
				WAR.PD['受击判定'][id] = 1
				if WAR.BJ == 1 and Curr_NG(pid,367) and rwnlxz(pid,0) and math.random(10) < 2 then 
					WAR.PD['极阴无相6'][id] = 1	
				end
				swhurt,wxhurt,ang = Cat('三围五系伤害计算',i,wugong, level, ang, x, y)
				local ftnum = 0
				if WAR.QGZT[id] ~= nil then
					ftnum = 1
					WAR.Person[i]["特效动画"] = 149
					Set_Eff_Text(i, "特效文字1", "倾国倾城")
					WAR.QGZT[id] = WAR.QGZT[id] -1
					if WAR.QGZT[id] < 1 then
						WAR.QGZT[id] = nil
					end
				elseif MPTX(id,26,4) and WAR.PD['倾国倾城'][id] ~= nil and WAR.PD['倾国倾城'][id] > 0 then
					Set_Eff_Text(i,"特效文字1", "倾国倾城")
					ftnum = 1
					WAR.PD['倾国倾城'][id] = WAR.PD['倾国倾城'][id] - 1
					if WAR.PD['倾国倾城'][id] < 1 then
						WAR.PD['倾国倾城'][id] = nil
					end
				elseif MPTX(id,26,4) and JLSD(20,55,id) then
					ftnum = 1
					Set_Eff_Text(i, "特效文字1", "丹唇列素齿・翠彩发蛾眉")
				elseif Curr_NG(id,317) and WAR.QMWZ < 1 and JLSD(85,90,id) then
					ftnum = 1
					WAR.Person[i]["特效动画"] = 95
					Set_Eff_Text(i, "特效文字2", "奇门五转.东木")
					if MPTX(id,10) and JLSD(0,50,id) then
						WAR.QMWZ = 0
					else
						WAR.QMWZ=WAR.QMWZ+1
					end
				elseif TSZH(id,78,315) and JLSD(20,30,id) then
					ftnum = 2
					WAR.Person[i]["特效动画"] = 151
					Set_Eff_Text(i, "特效文字2", "天地玄黄・天")
				elseif (match_ID(id,456) or match_ID(id,92)) and JLSD(20,50,id) then
					ftnum = 2
					Set_Eff_Text(i, "特效文字1", "枯木逢春")
				elseif (psx(id,"门派技能3") == 2 and JLSD(20,50,id)) or (match_ID(id,529) and math.random(10) > 3) then
					ftnum = 2
					WAR.Person[i]["特效动画"] = 423
					Set_Eff_Text(i, "特效文字1", "斗转・无间轮")
				end
				if ftnum > 0 then
					local list = {}
					for q = 0, WAR.PersonNum - 1 do
						if WAR.Person[q]["死亡"] == false and DWPD(i,q) and Fjkx(q) ~= 2 then
							table.insert(list,q)
						end
					end
					local F_target
					--将自己切换为随即敌方目标
					if list[1] ~= nil then
						F_target = list[math.random(#list)]
						i = F_target
					end
					if yongte(wugong) and QIQX(pid,'天水影') > 0 and JLSD(0,(WAR.LQZ[pid] or 0),pid) then
						local a = (WAR.LQZ[pid] or 0)
						local list1 = {}
						if JLSD(0,a,pid) then
							for hh = 0, WAR.PersonNum - 1 do
								if dead(hh) == false and DWPD(hh,WAR.CurID) and Fjkx(hh) ~= 2 then
									table.insert(list1,hh)
								end
							end
						end
						if list1 ~= nil and #list1 > 0 then
							i = list1[math.random(#list1)]
						end
					end					
					--无论是否有第三方，既无论是否反弹，都消耗一次次数
					id = WAR.Person[i]['人物编号']
					--标记为反弹伤害
					fs = true
				end
				--斗转星移
				Cat('斗转',i,wugong)
				--乾坤反弹减伤
				hurt2,ang2 = Cat('乾坤反弹',i,wugong,hurt,ang,level)
				--误伤时候伤害只有5%
				if DWPD(WAR.CurID,i) == false and fs == false then
					hurt2 = math.modf(hurt2*0.05)
					ang2 = math.modf(ang2*0.05)
				end
				--闪避的人物不计算伤害
				if WAR.Miss[id] == nil then
					if WAR.PD['九阳护盾'][id] ~= nil and WAR.PD['九阳护盾'][id] > 0 then
					--Cat('伤害计算Def',i, wugong, level, ang2, hurt2*0)
						WAR.PD['九阳护盾'][id] = WAR.PD['九阳护盾'][id] - 1
						WAR.Person[i]['生命点数'] = 0
						if WAR.PD['九阳护盾'][id] < 1 then 
							WAR.PD['九阳护盾'][id] = nil 
							Cat('护盾停止',i)
						end
					--金刚铁布组合
					elseif WAR.PD['不漏琉璃'][id] == 1 then
						WAR.Person[i]['生命点数'] = 0
						WAR.PD['不漏琉璃'][id] = nil
					--神足乾坤	
					elseif 	
					    WAR.PD['神足乾坤'][id] ~= nil and WAR.PD['神足乾坤'][id] > 0 then
						WAR.PD['神足乾坤'][id] = WAR.PD['神足乾坤'][id] - 1
						WAR.Person[i]['生命点数'] = 0
						if WAR.PD['神足乾坤'][id] < 1 then 
							WAR.PD['神足乾坤'][id] = nil 
							Cat('护盾停止',i)
						end
					--易水寒	
					elseif 	
					    WAR.PD['易水寒冰'][id] ~= nil and WAR.PD['易水寒冰'][id] > 0 then
						WAR.PD['易水寒冰'][id] = WAR.PD['易水寒冰'][id] + 1
						WAR.Person[i]['生命点数'] = 0
						if WAR.PD['易水寒冰'][id] > 10 then 
							WAR.PD['易水寒冰'][id] = nil 
							Cat('护盾停止',i)
						end	
					else					
						Cat('总伤害计算',i, wugong, level, ang2, hurt2,swhurt,wxhurt)
						if QIQX(pid,'鬼龙袭') > 0 and yongte(wugong) and BNJQ(pid) and ZYJQ(pid) and WAR.ACT == 1 then
							local n = (WAR.SPIRIT[id] or 0)
							local gl = i
							for k = 0, WAR.PersonNum -1 do
								if dead(k) == false and DWPD(i,k) == false then
									if (WAR.SPIRIT[WAR.Person[k]['人物编号']] or 0) < n then
										gl = k
									end
								end
							end
							WAR.PD['鬼龙袭'][WAR.Person[gl]['人物编号']] = 1
							Cat('总伤害计算',gl, wugong, level, ang2, hurt2,swhurt,wxhurt)	
						end			
						if wugong == 153 and MPTX(pid,20) and Curr_NG(pid,43) and WAR.PD['利刃寒锋'][id] ~= nil then
							if WAR.PD['利刃寒锋'][id] > 10 then
								WAR.PD['利刃寒锋'][id] = WAR.PD['利刃寒锋'][id] - 10
								WAR.PD['真利刃寒锋'][id] = 10
							else
								WAR.PD['真利刃寒锋'][id] = WAR.PD['利刃寒锋'][id]
								WAR.PD['利刃寒锋'][id] = nil
							end	
						end	
					end	
					SetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4,2)
					WAR.TXXS[id] = 1
					--点桑专属
					if WAR.Person[i]['我方'] ~= WAR.Person[WAR.CurID]['我方'] then
						if match_ID(pid,457) then
							if WAR.DSZS[WAR.CurID] == nil then 
								WAR.DSZS[WAR.CurID] = {}
							end
							WAR.DSZS[WAR.CurID][i] = 20
						end
						--点桑专属
						if match_ID(id,457) then
							if WAR.DSZS[i] ~= nil and WAR.DSZS[i][WAR.CurID] ~= nil then 
								if Fjkx(WAR.CurID) ~= 2 then
									WarDrawMap(0); --不加这条则动画位置无法正常显示
							        CurIDTXDH(WAR.CurID, 414,1,"极死・七夜",LightSkyBlue);
									local sm = JY.Person[id]["生命最大值"]*0.02*WAR.DSZS[i][WAR.CurID]
									local sm1 = JY.Person[pid]["生命最大值"]*0.02*WAR.DSZS[i][WAR.CurID]
									ztd(WAR.CurID,"生命点数",-math.modf((sm+sm1)/2))
									ztd(i,"生命点数", math.modf(WAR.DSZS[i][WAR.CurID]*TrueYJ(id)*0.2))
									WAR.DSZS[i][WAR.CurID] = nil
								end
							end
							if WAR.DSZS[i] == nil then 
								WAR.DSZS[i] = {}
							end
							WAR.DSZS[i][WAR.CurID] = 20
						end
					end
				end
				if WAR.PD["太玄组合防御1"][id] ~= nil then
					WAR.PD["太玄组合防御1"][id] = nil
				end
				if WAR.PD["太玄组合防御2"][id] ~= nil then
					WAR.PD["太玄组合防御2"][id] = nil
				end	
				if yongwu(wugong,360) and Curr_NG(pid,93) then
					if WAR.PD['圣火三虚七实'][pid] == 2 then
						WAR.PD['圣火三虚七实'][pid] = 1
					end
				end
			end
		end
	end
end


Ct['伤害杀气反弹'] = function(enemyid,hurt,killjq)
	local atkid = WAR.CurID
	local pid = WAR.Person[atkid]['人物编号']
	local eid = WAR.Person[enemyid]['人物编号']
	local hurt2 = 0
	local killjq2 = 0
	if hurt == nil or hurt < 0 then
		hurt = 0
	end
	if killjq == nil or killjq < 0 then
		killjq = 0
	end	
	--古针禅功反伤
	if Curr_NG(eid,259) and JLSD(10,40,eid) then
		Set_Eff_Text(enemyid,"特效文字0", "古针禅功・返")
		hurt2 = hurt2 + math.modf(hurt*0.2)
		killjq2 = killjq2 + math.modf(killjq*0.2)
	end
	--锦毛虎一身是胆 
	if WGZH(eid,59,232) and JLSD(30,60,eid) then
		Set_Eff_Text(enemyid, "特效文字3", "锦毛虎一身是胆")
		hurt2 = hurt2 + math.modf(hurt*0.2)
		killjq2 = killjq2 + math.modf(killjq*0.2)
	end	
	--黄蓉反震
	if ((match_ID(eid, 56) or match_ID(eid, 9864)) or JY.Person[eid]["防具"] == 58) then
		Set_Eff_Text(enemyid, "特效文字0", "带刺玫瑰")
		hurt2 = hurt2 + math.modf(hurt*0.2)
		killjq2 = killjq2 + math.modf(killjq*0.2)
	end	
	--赵敏反震
	if match_ID(eid, 609) or match_ID(eid, 9801) then
		Set_Eff_Text(enemyid, "特效文字0", "绍敏郡主")
		hurt2 = hurt2 + math.modf(hurt*0.2)
		killjq2 = killjq2 + math.modf(killjq*0.2)
	end
	--中华阁
	if MPTX(eid,22,2) and JLSD(20,50,eid) then
		Set_Eff_Text(enemyid, "特效文字0", "五味俱全")
		if JLSD(0,20,eid) then
			Cat('清除低级异常',enemyid)
		end	
		hurt2 = hurt2 + math.modf(hurt*0.3)
		killjq2 = killjq2 + math.modf(killjq*0.3)
	end
	--乾坤非队友被动反弹伤害杀气
	if isteam(eid) == false and PersonKF(eid,97) then 
		local jl = 30 + JY.Base["天书数量"]
		if JLSD(0,jl,eid) then
			Set_Eff_Text(enemyid, "特效文字0", "乾坤反弹")
			hurt2 = hurt2 + math.modf(hurt*0.4)
			killjq2 = killjq2 + math.modf(killjq*0.4)
		end
	end
	--阴阳无极・阳极
	if WAR.PD['阴阳双极'][eid] ~= nil and WAR.PD['阴阳双极'][eid] < 31 then
		hurt2 = hurt2 + math.modf(hurt*0.49)
		killjq2 = killjq2 + math.modf(killjq*0.49)
	end
	--纯阳蓄力
	if WAR.PD['纯阳蓄力'][eid] ~= nil then
		Set_Eff_Text(enemyid, "特效文字0", "纯阳・乾坤奥义")
		hurt2 = hurt2 + math.modf(hurt*0.5)
		killjq2 = killjq2 + math.modf(killjq*0.5) 
		WAR.PD['纯阳蓄力'][eid] = nil
	end
	--太极纯阳
	if NGQH(eid,171) and JLSD(30,65,eid) then
		Set_Eff_Text(enemyid, "特效文字0", "太极・无极阴阳")
		hurt2 = hurt2 + math.modf(hurt*0.6)
		killjq2 = killjq2 + math.modf(killjq*0.6)
	end 
	--先天罡气
	if WAR.PD["先天护盾"][eid] ~=nil and WAR.PD["先天护盾"][eid] > 0 then
		hurt2 = hurt2 + math.modf(hurt*0.6)
		killjq2 = killjq2 + math.modf(killjq*0.6)
	end
	--九阳三阳
	if NGQH(eid,106) then
		if JLSD(30,60,eid) then
			Set_Eff_Text(enemyid, "特效文字0", "他横任他横・明月照大江")
			hurt2 = hurt2 + math.modf(hurt*0.6)
			killjq2 = killjq2 + math.modf(hurt*0.6)
		else 	
			--斗酒僧
			local nn = math.modf((JY.Person[eid]["内力最大值"] - JY.Person[pid]["内力"]) / 3000)
			if match_ID(eid,638) then 
				nn = nn + 1
			end
			Set_Eff_Text(enemyid, "特效文字0", "九阳神功・反震")
			WAR.PD['九阳反震'][pid] = nn
			hurt2 = hurt2 + math.modf(hurt*0.3)
			killjq2 = killjq2 + math.modf(hurt*0.3)
		end
	end
	--易筋经组合
	if NGQH(eid,108) and JLSD(10,40,eid) then
		Set_Eff_Text(enemyid,"特效文字0","天佛化生・应法反劫")
		if JLSD(10,30,eid) then
			WAR.PD['封气绝脉'][pid] = 1
		end
		hurt2 = hurt2 + math.modf(hurt*0.6)
		killjq2 = killjq2 + math.modf(hurt*0.6)
	end	
	--破剑八刀标记为反弹伤害，反弹的是攻击者本身，不需要判定反弹伤害
	if WAR.PD['破剑八刀'][eid] ~= nil then
		hurt2 = hurt2 + math.modf(hurt*0.6)
		killjq2 = killjq2 + math.modf(hurt*0.6)
	end
	--黯然反伤
	if PersonKF(eid,25) and ((Curr_NG(eid,252) and PersonKF(eid,104)) or match_ID(eid,58)) and WAR.PD['黯然・呆若木鸡'][eid] == nil then
		Set_Eff_Text(enemyid, 2, "黯然・心惊肉跳")
		hurt2 = hurt2 + math.modf(hurt*0.6)
		killjq2 = killjq2 + math.modf(hurt*0.6)
	end	
	if PersonKF(eid,21) and (PersonKF(eid,220) or match_ID(eid,647) or match_ID(eid,523)) then
		if (WAR.PD['玄冥冥寒'][eid] or 0) >= (WAR.PD['玄冥玄毒'][pid] or 0) then
			hurt2 = hurt2 + math.modf(hurt2*(WAR.PD['玄冥冥寒'][eid] or 0)*0.01)
			killjq2 = killjq2 + math.modf(hurt2*(WAR.PD['玄冥冥寒'][eid] or 0)*0.005)
		end	
	end	
	--玄之又玄
	if WAR.PD['玄之又玄'][eid] ~= nil then
		Set_Eff_Text(enemyid, "特效文字2", "玄之又玄",6)
		hurt2 = hurt2 + hurt
		killjq2 = killjq2 + hurt
		WAR.PD['玄之又玄'][eid] = nil
	end
	--观止
	if match_ID(eid,456) then
		Set_Eff_Text(enemyid, "特效文字0", "暴怒河豚")
		hurt2 = hurt2 + hurt
		killjq2 = killjq2 + killjq
		if math.random(100) < 60 then
			if WAR.PD['毒击'][pid] == nil then
				WAR.PD['毒击'][pid] = 10
			end
		end
	end
	--甩锅
	if WAR.PD['甩锅发动'][eid] ~= nil then
		Set_Eff_Text(enemyid, "特效文字2", "甩锅",75)
		hurt2 = hurt2 + hurt
		killjq2 = killjq2 + hurt
		WAR.PD['甩锅发动'][eid] = nil
	end	
	--亦复如是
	if WAR.PD['亦复如是'][eid] ~= nil then
		hurt2 = hurt2 + hurt
		killjq2 = killjq2 + killjq
	end
	--玉女先天
	if NGQH(eid,154) then
		local a = (WAR.LQZ[pid] or 0)*3
		local nq = limitX(a,0,800)
		Set_Eff_Text(enemyid, "特效文字0", "玉女・杨柳清心")
		killjq2 = killjq2 + a
		hurt2 = hurt2 + a
	end
	--反伤伤害结算
	if hurt2 > 0 and NGQH(WAR.Person[atkid]['人物编号'],108) == false then
		if Fjkx(atkid) == 2 then
			hurt2 = math.modf(hurt2*0.5)
		end	
		if WAR.DZAY[eid] ~= nil then
			ztd(enemyid,"生命点数",-hurt2)
			SetWarMap(WAR.Person[WAR.DZAY[eid]]['坐标X'],WAR.Person[WAR.DZAY[eid]]['坐标Y'],4,2)
		elseif QIQX(pid,'天水影') > 0 and JLSD(0,(WAR.LQZ[pid] or 0),pid) then
			local ftn = {}
			local n = -1
			for j = 0, WAR.PersonNum - 1 do
				if dead(j) == false and DWPD(enemyid,j) == false and j ~= enemyid then
					ftn[#ftn+1] = j
				end	
			end	
			if #ftn > 0 then
				n = ftn[math.random(#ftn)]
				ztd(n,"生命点数",-hurt2)
				SetWarMap(WAR.Person[n]['坐标X'],WAR.Person[n]['坐标Y'],4,2)
				if killjq > 0 and killjq2 > 0 then
					if Fjkx(atkid) == 2 then
						killjq2 = math.modf(killjq2*0.5)
					end
					if nokillspeed(n) == false then
						ztd(n,'集气位置',-killjq2)
					end
				end			
			end	
		else
			ztd(atkid,"生命点数",-hurt2)
			SetWarMap(WAR.Person[atkid]['坐标X'],WAR.Person[atkid]['坐标Y'],4,2)
		end	
		WAR.TXXS[pid] = 1
	end	
	--lib.Debug(hurt2)
	if killjq > 0 and killjq2 > 0 and NGQH(WAR.Person[atkid]['人物编号'],108) == false then
		if Fjkx(atkid) == 2 then
			killjq2 = math.modf(killjq2*0.5)
		end 
		if nokillspeed(atkid) == false then
			ztd(atkid,'集气位置',-killjq2)
		end	
	end
end

Ct['集气停止效果'] = function(i)
	local jqid = WAR.Person[i]['人物编号']
	local pd = 0
	--[[if match_ID(jqid,457) and WAR.PD['虚邪剑域'][jqid] ~= nil and WAR.PD['虚邪剑域'][jqid] >= 30 then
		return false
	end]]
	for k = 1, #WAR.Debuf19 do 
		local yc = WAR.Debuf19[k][1]
		if WAR.PD[yc][jqid] ~= nil then
			if match_ID(jqid,596) and (WAR.JBMY[jqid] or 0) > 15 and WAR.JBMY[jqid] ~= nil then
				WAR.PD[yc][jqid] = nil
			end
		end
	end
	if Curr_QG(jqid,304) then
		for k = 1, #WAR.Debuf19 do 
			local yc = WAR.Debuf19[k][1]
			if WAR.PD[yc][jqid] ~= nil then
				if match_ID(jqid,517) then
					WAR.PD[yc][jqid] = nil
				elseif match_ID(jqid,526) and (WAR.PD['无明夜'][jqid] ~= nil or WAR.PD['遮影'][jqid] ~= nil) then
					WAR.PD[yc][jqid] = nil
				elseif (JXPD(jqid,525,1) or MPTX(jqid,24,3)) and WAR.PD['无明夜'][jqid] ~= nil then
					WAR.PD[yc][jqid] = limitX(WAR.PD[yc][jqid],0,8)
				end
			end
		end
	end
	--沉睡的敌人，无法集气
	if WAR.PD["沉睡状态"][jqid] == 1 then
		pd = 1
	end
	--凝结时空
	if WAR.PD["凝结时空"][jqid] == 1 then
		pd = 1
	end
	--十方无敌
    if WAR.PD["十方无敌"][jqid] ~= nil then
	    AddPersonAttrib(jqid,'封穴程度',10)
	    WAR.PD["十方无敌"][jqid] = limitX(WAR.PD["十方无敌"][jqid],0,100)
		WAR.PD["十方无敌"][jqid] = WAR.PD["十方无敌"][jqid] - 1
		if Curr_QG(jqid,316) then
			WAR.PD["十方无敌"][jqid] = WAR.PD["十方无敌"][jqid] - 2
		end
		if WAR.PD["十方无敌"][jqid] < 1 then
			if match_ID(jqid,520) then
				WAR.Person[i].Time = WAR.Person[i].Time + 400
			end
			WAR.PD["十方无敌"][jqid] = nil
		end
		pd = 1
	end	
	if WAR.PD['虚邪断空'][jqid] ~= nil then
		WAR.PD["虚邪断空"][jqid] = limitX(WAR.PD["虚邪断空"][jqid],0,20)
		WAR.PD['虚邪断空'][jqid] = WAR.PD['虚邪断空'][jqid] - 1
		if Curr_QG(jqid,316) then
			WAR.PD["虚邪断空"][jqid] = WAR.PD["虚邪断空"][jqid] - 2
		end
		if WAR.PD['虚邪断空'][jqid] < 1 then
			WAR.PD['虚邪断空'][jqid] = nil
		end
		pd = 1
	end
	--冻结的敌人，无法集气				
	if WAR.PD['真利刃寒锋'][jqid] ~= nil then
		WAR.PD['真利刃寒锋'][jqid] = limitX(WAR.PD['真利刃寒锋'][jqid],0,10)
		WAR.PD['真利刃寒锋'][jqid] = WAR.PD['真利刃寒锋'][jqid] - 1
		if Curr_QG(jqid,316) then
			WAR.PD["真利刃寒锋"][jqid] = WAR.PD["真利刃寒锋"][jqid] - 2
		end
		if WAR.PD['真利刃寒锋'][jqid] < 1 then
			WAR.PD['真利刃寒锋'][jqid] = nil
		end
		pd = 1
	end
	--被无招胜有招击中的人，无法集气
    if WAR.PD["无招胜有招"][jqid] ~= nil then
		AddPersonAttrib(jqid,'流血程度',5)
		WAR.PD["无招胜有招"][jqid] = limitX(WAR.PD["无招胜有招"][jqid],0,10)
		if QGQH(jqid,316,2) then
			WAR.PD["无招胜有招"][jqid] = WAR.PD["无招胜有招"][jqid] - 3
		end		
		WAR.PD["无招胜有招"][jqid] = WAR.PD["无招胜有招"][jqid] - 1
		if Curr_QG(jqid,316) then
			WAR.PD["无招胜有招"][jqid] = WAR.PD["无招胜有招"][jqid] - 2
		end	
		if WAR.PD["无招胜有招"][jqid] < 1 then
			WAR.PD["无招胜有招"][jqid] = nil
		end
		pd = 1
	end	
	--走火入魔
	if WAR.PD["走火入魔"][jqid] ~= nil then
		AddPersonAttrib(jqid,'受伤程度',5)
		AddPersonAttrib(jqid,"生命",-math.modf(JY.Person[jqid]["受伤程度"]/2))
		if QGQH(jqid,316,2) then
			WAR.PD["走火入魔"][jqid] = nil
		else	
		    WAR.PD["走火入魔"][jqid] = limitX(WAR.PD["走火入魔"][jqid],0,10)
			WAR.PD["走火入魔"][jqid] = WAR.PD["走火入魔"][jqid] - 1
			if Curr_QG(jqid,316) then
				WAR.PD["走火入魔"][jqid] = WAR.PD["走火入魔"][jqid] - 2
			end	
			if WAR.PD["走火入魔"][jqid] < 1 then
				WAR.PD["走火入魔"][jqid] = nil
			end	
		end	
		pd = 1
	end
    if WAR.PD["利刃寒锋"][jqid] ~= nil  then
        if QGQH(jqid,186,2) then
			AddPersonAttrib(jqid,"封穴程度",WAR.PD["利刃寒锋"][jqid])
			WAR.PD["利刃寒锋"][jqid] = nil 
			local tmppid = WAR.CurID
			WAR.CurID = i
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 6, 1, "一苇渡江・西天坦途", LightSkyBlue)
			WAR.CurID = tmppid
		elseif NGQH(jqid,190) then
			WAR.PD["利刃寒锋"][jqid] = nil
		elseif QGQH(jqid,316,2) then
			WAR.PD["利刃寒锋"][jqid] = nil
		else
			--上限10
			WAR.PD["利刃寒锋"][jqid] = limitX(WAR.PD["利刃寒锋"][jqid],0,15)
			WAR.PD["利刃寒锋"][jqid] = WAR.PD["利刃寒锋"][jqid] - 1
			if WAR.PD['霜炎九重1'][jqid] ~= nil then
				WAR.PD["利刃寒锋"][jqid] = WAR.PD["利刃寒锋"][jqid] - 2
			end	
			if WAR.PD['霜炎九重2'][jqid] ~= nil then
				WAR.PD["利刃寒锋"][jqid] = WAR.PD["利刃寒锋"][jqid] + 0.5
			end	
			if Curr_QG(jqid,316) then
				WAR.PD["利刃寒锋"][jqid] = WAR.PD["利刃寒锋"][jqid] - 2
			end
			if WAR.PD["利刃寒锋"][jqid] < 1 then
				WAR.PD["利刃寒锋"][jqid] = nil
			end
		end	
		pd = 1
	end				
    if WAR.PD['锁喉'][jqid] ~= nil then --锁喉
	    WAR.PD['锁喉'][jqid] = limitX(WAR.PD['锁喉'][jqid],0,50)
		WAR.PD['锁喉'][jqid] = WAR.PD['锁喉'][jqid] - 1	
		if WAR.PD['锁喉'][jqid] < 1 then
			WAR.PD['锁喉'][jqid] = nil
		end	
		pd = 1
	end	
	if WAR.PD['锁喉1'][jqid] ~= nil then
		WAR.PD['锁喉1'][jqid] = limitX(WAR.PD['锁喉1'][jqid],0,50)
		WAR.PD['锁喉1'][jqid] = WAR.PD['锁喉1'][jqid] - 1
		if JLSD(10,35,jqid) then
			WAR.Person[i].Time = WAR.Person[i].Time + 40
		end
		if WAR.PD['锁喉1'][jqid] <= 0 then
			WAR.PD['锁喉1'][jqid] = nil
		end
		pd = 1
	end	 
	if WAR.PD['以静制动1'][jqid] ~= nil then --以静制动
		WAR.PD['以静制动1'][jqid] = WAR.PD['以静制动1'][jqid] - 1
		if WAR.PD['以静制动1'][jqid] < 1 then
			WAR.PD['以静制动1'][jqid] = nil
			WAR.PD['以静制动3'][jqid] = 1
			if WAR.Person[i].Time < 1005 then
			    WAR.Person[i].Time = 1005
			end
		end	
		pd = 1
	end		
	if WAR.BLJC1[jqid] ~= nil then --碧落九重剑・加重岩不集气
		WAR.BLJC1[jqid] = WAR.BLJC1[jqid] - 1
		if WAR.BLJC1[jqid] < 1 then
			WAR.BLJC1[jqid] = nil
			WAR.Person[i].TimeAdd = 0
			if WAR.Person[i].Time > 0 then
			    WAR.Person[i].Time = 0
			end
		end
		pd = 1
	end
	--木桩、李秋水的无相分身
	if (jqid == 591 and WAR.ZDDH == 226) or (jqid == 600) then
		pd = 1
	end
	if JY.Person[jqid]['封穴程度'] ~= nil and JY.Person[jqid]['封穴程度'] > 0 then
		if MPTX(jqid,8,3) and Curr_NG(jqid,104) then
			pd = 0
		else
			pd = 1
		end
		if WAR.PD['点穴大师3'][jqid] ~= nil then
			local a = psx(jqid,"受伤程度")+ psx(jqid,"流血程度")+ psx(jqid,"封穴程度")
			local b = psx(jqid,"中毒程度")+ psx(jqid,"冰封程度")+ psx(jqid,"灼烧程度")
			WAR.PD['锁穴奇劲'][jqid] = (WAR.PD['锁穴奇劲'][jqid] or 0) + a + b
		end	
		--夜雨楼轻功
		if Curr_QG(jqid,304) then
			AddPersonAttrib(jqid,'封穴程度',-math.random(2,5))
			WAR.Person[i].Time = WAR.Person[i].Time + math.random(25,50)
		end		
		if WAR.PD['邪魅苍生'][jqid] ~= nil then--凌波微步第三性效果：废除普通解封穴
			AddPersonAttrib(jqid,"封穴程度",6)
			AddPersonAttrib(jqid,"生命",-psx(jqid,"封穴程度"))
			WAR.PD['邪魅苍生'][jqid] = WAR.PD['邪魅苍生'][jqid] - 1
			if WAR.PD['邪魅苍生'][jqid] < 1 then
				if math.random(100) > 31 and WAR.PD['混乱状态'][jqid] == nil then
					WAR.PD['混乱状态'][jqid] = 1
				end
				WAR.PD['邪魅苍生'][jqid] = nil 
			end	
		else
			AddPersonAttrib(jqid,"封穴程度",-1)
			if (not inteam(jqid)) and WAR.Person[i].Time <= -300 then
				AddPersonAttrib(jqid,"封穴程度",-math.random(2))
			end
		end
		--易筋经 封穴回复+1
		if PersonKF(jqid, 108) then
			AddPersonAttrib(jqid,"封穴程度",-1)
		end
		--封穴恢复
		if WAR.PD['封穴恢复'][jqid] ~= nil and WAR.PD['封穴恢复'][jqid] ~= 0 then
			local n = WAR.PD['封穴恢复'][jqid]
			AddPersonAttrib(jqid,"封穴程度",-n)
		end
		--九霄中华
		if NGQH(jqid,184) then
			AddPersonAttrib(jqid,"封穴程度",-1)
		end
		if (WAR.PD['阴阳双极'][jqid] or -1) < 31 then
			if JLSD(10,25,jqid) then
				AddPersonAttrib(jqid,'封穴程度',-7)
			end
		end		
		if Curr_NG(jqid, 238) then 
			AddPersonAttrib(jqid,"封穴程度",-2)
		elseif PersonKF(jqid, 238) then
			AddPersonAttrib(jqid,"封穴程度",-1)
		end
		--瞬息千里天轻效果
		if Curr_QG(jqid,150) then 
			if TFQG(jqid,150) then
				AddPersonAttrib(jqid,"封穴程度",-1)
				if BNJQ(jqid) then
					AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
				end
			end
		end	
		--一苇渡江扫地效果
		if Curr_QG(jqid,186) and match_ID(jqid,114) then
			if math.random(10) > 8 then
				AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"])
			end
		end	
		--黑级浮屠 封穴回复+2
		if match_ID(jqid,9930) then
			AddPersonAttrib(jqid,"封穴程度",-2)
		end
		--先天+玉女，封穴回复+1
		if PersonKF(jqid, 100) and PersonKF(jqid, 154) then
			AddPersonAttrib(jqid,"封穴程度",-1)
		end
		--九阳5时序解除封穴
		--阳内主运或者阳罡学会九阳后
		if Curr_NG(jqid, 106) and rwnlxz(jqid,1)  then
			if WAR.JYFX[jqid] == nil then
				WAR.JYFX[jqid] = 1;
			elseif WAR.JYFX[jqid] < 5 then
				WAR.JYFX[jqid] = WAR.JYFX[jqid] + 1;
			else
				AddPersonAttrib(jqid,"封穴程度",-JY.Person[jqid]["封穴程度"]);
				WAR.JYFX[jqid] = nil;
			end
		end
		--暴怒时解穴速度加倍
		if JY.Person[jqid]["封穴程度"] > 0 and BNJQ(jqid) then
			AddPersonAttrib(jqid,"封穴程度",-1)
			if MPTX(jqid,8) then
				AddPersonAttrib(jqid,"封穴程度",-1)
			end
		end
		if WAR.PD['燎原枪2'][jqid] ~= nil and (psx(jqid,'封穴程度') == nil or psx(jqid,'封穴程度') < 1) then
			WAR.PD['燎原枪2'][jqid] = WAR.PD['燎原枪2'][jqid] - 1
			if WAR.PD['燎原枪2'][jqid] <= 0 then
				addbuff(jqid,WAR.PD['举火燎原'],10,20)
				addbuff(jqid,WAR.PD['回魂仙梦'],10,20)
				AddPersonAttrib(jqid,'生命',-(psx(jqid,'灼烧程度')+100))
				local p = WAR.CurID
				WAR.CurID = i
				WarDrawMap(0)
				CurIDTXDH(WAR.CurID,55,1,'枪焰爆发')
				WAR.CurID = p
				WAR.PD['燎原枪2'][jqid] = nil
			end
		end
		if JY.Person[jqid]["封穴程度"] == nil or JY.Person[jqid]["封穴程度"] < 1 then	
			JY.Person[jqid]["封穴程度"] = 0
			WAR.PD['点穴大师1'][jqid] = nil
			WAR.PD['点穴大师2'][jqid] = nil
			WAR.PD['点穴大师3'][jqid] = nil
			if WAR.PD['封气绝脉'][WAR.Person[i]["人物编号"]] ~= nil then
				WAR.Person[i].Time = WAR.Person[i].Time - math.random(200,300)
				WAR.PD['封气绝脉'][WAR.Person[i]["人物编号"]] = nil
			end	
			if WAR.PD['锁穴奇劲'][jqid] ~= nil and WAR.PD['锁穴奇劲'][jqid] > 3000 then
				local sx = WAR.PD['锁穴奇劲'][jqid]
				if sx > 2000 then
					sx = 2000+sx*0.1
				end	
				AddPersonAttrib(jqid,"生命",-math.modf(sx*1.2))
				AddPersonAttrib(jqid,"内力",-math.modf(sx*1.5))
				AddPersonAttrib(jqid,"体力",-math.modf(15,25))
				zhanyi(jqid,-math.modf((WAR.SPIRIT[jqid] or 0)*0.5))
				WAR.PD['昏迷状态'][jqid] = 1
				if psx(jqid,"生命") <= math.modf(psx(jqid,"生命最大值")*0.07) then
					if math.random(100) > 85 then
						JY.Person[jqid]["生命"] = 0
						WAR.Person[i]["死亡"] = true
						local tmpjqid = WAR.CurID
						WAR.CurID = i
						WarDrawMap(0); 
						CurIDTXDH(WAR.CurID, 78,1,"你已经死了",C_ORANGE);
						WAR.CurID = tmpjqid
						WarSetPerson()
					else
						JY.Person[jqid]["生命"] = 1
					end
				end	
				WAR.PD['锁穴奇劲'][jqid] = nil
			end	
		end
	end	
	if NGQH(jqid,171) or match_ID(jqid,5) then
		if WAR.Person[i].Time > 500 then
			local jq = math.modf((WAR.Person[i].Time-500)/5)
			if JLSD(0,jq,jqid) then
				if pd > 0 then
					pd = 0
				end
			end
		end
	end
	if WAR.PD['无我之境'][jqid] ~= nil and WAR.PD['无我之境'][jqid] > 0 then
		if pd > 0 then
			pd = 0
		end
	end	
	if WAR.PD['血战到底'][jqid] ~= nil and WAR.PD['血战到底'][jqid] == 1 then
		if pd > 0 then
			pd = 0
		end
	end	
	if WAR.PD['阳神降世'][jqid] ~= nil or WAR.PD['阴圣再临'][jqid] ~= nil then
		if pd > 0 then
			pd = 0
		end
	end
	if pd > 0 then
		return true
	else
		return false
	end		
end

Ct['集气紊乱效果'] = function(i,jq)
	local jqid = WAR.Person[i]['人物编号']
	if jq == nil then
		return 0
	end
	local mywl = jq
	if match_ID(jqid,457) and WAR.PD['虚邪剑来'][jqid] == 1 then
		return jq
	elseif WAR.PD['血战到底'][jqid] ~= nil and WAR.PD['血战到底'][jqid] == 1 then
	    return jq
	elseif match_ID(jqid,596) and (WAR.JBMY[jqid] or 0) > 15 and WAR.JBMY[jqid] ~= nil then
		return jq
	end	
	if NGQH(jqid,171) or match_ID(jqid,5) then
		if WAR.Person[i].Time > 500 then
			local jq = math.modf((WAR.Person[i].Time-500)/5)
			if JLSD(0,jq,jqid) then
				return jq
			end
		end
	end
	if WAR.PD["玄武逆行"][jqid] ~= nil then
		WAR.PD["玄武逆行"][jqid] = limitX(WAR.PD["玄武逆行"][jqid],0,5)
		if TFQG(jqid,304) then
			WAR.PD["玄武逆行"][jqid] = WAR.PD["玄武逆行"][jqid] - 2
		elseif QGQH(jqid,186,2) then
		    AddPersonAttrib(jqid,"封穴程度",WAR.PD["玄武逆行"][jqid])
		    WAR.PD["玄武逆行"][jqid] = nil	
		elseif QGQH(jqid,316,2) then
	  	    WAR.PD["玄武逆行"][jqid] = nil
		else	
			WAR.PD["玄武逆行"][jqid] = WAR.PD["玄武逆行"][jqid] - 1
			if Curr_QG(jqid,316) then
				WAR.PD["玄武逆行"][jqid] = WAR.PD["玄武逆行"][jqid] - 2
			end
			if WAR.PD["玄武逆行"][jqid] <= 0 then
				WAR.PD["玄武逆行"][jqid] = nil
			end	
		end	
	end
	if WAR.PD["伏魔逆气"][jqid] ~= nil then
		WAR.PD["伏魔逆气"][jqid] = limitX(WAR.PD["伏魔逆气"][jqid],0,10)
		if TFQG(jqid,304) then
			WAR.PD["伏魔逆气"][jqid] = WAR.PD["伏魔逆气"][jqid] - 2
		elseif QGQH(jqid,186,2) then
		    AddPersonAttrib(jqid,"封穴程度",WAR.PD["伏魔逆气"][jqid])
		    WAR.PD["伏魔逆气"][jqid] = nil	
		elseif QGQH(jqid,316,2) then
	  	    WAR.PD["伏魔逆气"][jqid] = nil
		else	
			WAR.PD["伏魔逆气"][jqid] = WAR.PD["伏魔逆气"][jqid] - 1
			if Curr_QG(jqid,316) then
				WAR.PD["伏魔逆气"][jqid] = WAR.PD["伏魔逆气"][jqid] - 2
			end
			if WAR.PD["伏魔逆气"][jqid] <= 0 then
				WAR.PD["伏魔逆气"][jqid] = nil
			end	
		end	
	end
	if WAR.PD["集气倒退"][jqid] ~= nil then -- 集气倒退
		WAR.PD["集气倒退"][jqid] = limitX(WAR.PD["集气倒退"][jqid],0,15)
		if TFQG(jqid,304) then
			WAR.PD["集气倒退"][jqid] = nil
		elseif QGQH(jqid,186,2) then
			AddPersonAttrib(jqid,"封穴程度",WAR.PD["集气倒退"][jqid])
			WAR.PD["集气倒退"][jqid] = nil
		elseif QGQH(jqid,316,2) then
			WAR.PD["集气倒退"][jqid] = nil
		else
			WAR.PD["集气倒退"][jqid] = WAR.PD["集气倒退"][jqid] - 1
			if Curr_QG(jqid,316) then
				WAR.PD["集气倒退"][jqid] = WAR.PD["集气倒退"][jqid] - 2
			end	
			if WAR.PD["集气倒退"][jqid] <= 0 then
				WAR.PD["集气倒退"][jqid] = nil
			end
		end	
	end	
	
	if WAR.PD["灵蛇拳"][jqid] ~= nil then	--被灵蛇拳击中，集气波动10时序
		WAR.PD["灵蛇拳"][jqid] = limitX(WAR.PD["灵蛇拳"][jqid],0,10)
		AddPersonAttrib(jqid,"生命",-WAR.PD["灵蛇拳"][jqid])
		if TFQG(jqid,304) then
			WAR.PD["灵蛇拳"][jqid] = nil
		elseif QGQH(jqid,186,2) then
			AddPersonAttrib(jqid,"封穴程度",WAR.PD["灵蛇拳"][jqid])
			WAR.PD["灵蛇拳"][jqid] = nil
		elseif QGQH(jqid,316,2) then
			WAR.PD["灵蛇拳"][jqid] = nil
		else  
			WAR.PD["灵蛇拳"][jqid] = WAR.PD["灵蛇拳"][jqid] - 1
			if Curr_QG(jqid,316) then
				WAR.PD["灵蛇拳"][jqid] = WAR.PD["灵蛇拳"][jqid] - 2
			end							
			if WAR.PD["灵蛇拳"][jqid] <= 0 then
				WAR.PD["灵蛇拳"][jqid] = nil
			end
		end	
	end	
	if WAR.PD["回魂仙梦"][jqid] ~= nil then --回魂仙梦集气
		WAR.PD["回魂仙梦"][jqid] = limitX(WAR.PD["回魂仙梦"][jqid],0,10)
		if TFQG(jqid,304) then
			WAR.PD["回魂仙梦"][jqid] = nil 
		elseif QGQH(jqid,186,2) then
			AddPersonAttrib(jqid,"封穴程度",WAR.PD["回魂仙梦"][jqid])
			WAR.PD["回魂仙梦"][jqid] = nil 
			local tmppid = WAR.CurID
			WAR.CurID = i
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 6, 1, "一苇渡江・西天坦途", LightSkyBlue)
			WAR.CurID = tmppid
		else
			WAR.PD["回魂仙梦"][jqid] = WAR.PD["回魂仙梦"][jqid] - 1
			if Curr_QG(jqid,316) then
				WAR.PD["回魂仙梦"][jqid] = WAR.PD["回魂仙梦"][jqid] - 2
			end	
			if WAR.PD["回魂仙梦"][jqid] < 1 then
				WAR.PD["回魂仙梦"][jqid] = nil
				if math.random(100) > 75 and WAR.PD['精神错乱'][jqid] == nil then
					WAR.PD['精神错乱'][jqid] = 6
				end
			end
		end	
	end
	--虚邪乱魄2
	if WAR.PD['虚邪乱魄2'][jqid] ~= nil then
		WAR.PD["虚邪乱魄2"][jqid] = limitX(WAR.PD["虚邪乱魄2"][jqid],0,5)
		WAR.PD['虚邪乱魄2'][jqid] = WAR.PD['虚邪乱魄2'][jqid] - 1
		if WAR.PD['虚邪乱魄2'][jqid] < 1 then
			WAR.PD['虚邪乱魄2'][jqid] = nil
		end
	end
	if WAR.PD["东方浩然"][jqid] ~= nil then
		WAR.PD["东方浩然"][jqid] = limitX(WAR.PD["东方浩然"][jqid],0,30)
		AddPersonAttrib(jqid,"生命",-WAR.PD["东方浩然"][jqid] * 10)
		if WAR.PD['东方浩然'][jqid] < 1 then
			WAR.PD['东方浩然'][jqid] = nil
		end
	end
	jq = math.ceil(jq)
	if WAR.PD['玄武逆行'][jqid] ~= nil then
		if jq > 0 and jq ~= 0 then
			jq = -math.modf(jq*1.2)
		end
	elseif WAR.PD["伏魔逆气"][jqid] ~= nil then
		if jq > 0 and jq ~= 0 then
			jq = -jq
		end
	elseif WAR.PD["集气倒退"][jqid] ~= nil then
		if jq > 0 and jq ~= 0 then
			jq = -math.modf(jq*0.5)
		end
	elseif WAR.PD["灵蛇拳"][jqid] ~= nil then
	    if jq > 0 and jq ~= 0 then
			jq = math.random(-jq,jq)
		end 
	elseif WAR.PD["虚邪乱魄2"][jqid] ~= nil then
		if jq > 0 and jq ~= 0 then
			jq = math.random(-jq,jq)
		end
	elseif WAR.PD["回魂仙梦"][jqid] ~= nil then --回魂仙梦集气	
		local aa = math.modf(jq*0.6)
		if aa < 1 then
			aa = 1
		end
		jq = math.random(aa)
	end
	if WAR.PD['无我之境'][jqid] ~= nil and WAR.PD['无我之境'][jqid] > 0 then
		if jq < mywl then
			jq = mywl
		end
	end
	if WAR.PD['雪羽战神'][jqid] ~= nil and WAR.PD['雪羽战神'][jqid] > 0 then
		if jq < mywl then
			jq = mywl
		end
	end
	if WAR.PD['阳神降世'][jqid] ~= nil or WAR.PD['阴圣再临'][jqid] ~= nil then
		if jq < mywl then
			jq = mywl
		end
	end		
	return jq
end

Ct['乾坤反弹'] = function(i,wugong,hurt,ang,level)
    local id = WAR.Person[i]['人物编号']
    if WAR.Person[i]['死亡'] == false and JY.Person[id]['生命'] > 0 and hurt > 0 then 
    	if PersonKF(id,97) or (Curr_NG(id,102) and JY.Person[191]["品德"] == 60) or match_ID(id,9) or match_ID(id,456) or match_ID(id,641) then
			local menu = {}
			local f1 = -1
			local f2 = -1
			local fs = 0
			local ng = 0
			local mzll = 0
			local ftpd = true
			local jl = 0
			local cfr = 0
			if NGQH(id,97) and (WAR.PD['明尊白莲'][id] == 1 or MPTX(id,13,4)) then
				for j = 0,WAR.PersonNum - 1 do 
					if WAR.Person[j]['死亡'] == false and DWPD(i,j) then 
						menu[#menu+1] = j
					end
				end
			else
				for j = 0,WAR.PersonNum - 1 do 
					if WAR.Person[j]['死亡'] == false and DWPD(i,j) and Fjkx(j) ~= 2 then 
						menu[#menu+1] = j
					end
				end
			end
			--主角专属被动乾坤
			if isteam(id) then
				--概率45
				jl = 30 + JY.Base["天书数量"]
				--减伤20
				cfr = 0.8
			end
			--主运乾坤概率65，返10
			if Curr_NG(id,97) then
			--明教主运乾坤
				if MPTX(id,13,3) then
					jl = 100
					cfr = math.random(2,5)*0.1
					if JLSD(10,35,id) then
						mzll = 1
					end
				else
					jl = 50 + JY.Base["天书数量"]
					cfr = 0.7
				end
			end
			--乾坤组合
			if NGQH(id,97) then
				jl = 85
				cfr = 0.4
			end
			--张无忌、斗酒反弹50%
			if match_ID(id,9) or match_ID(id,641) then
				jl = 100
				cfr = 0.5
			end
			--观止，反弹90%
			if match_ID(id,456) then
				jl = 100
				cfr = 0.1
			end
			--逆转乾坤，必定反弹50%
			if WAR.NZQK == 1 then
				jl = 100
				cfr = 0.5
			end
			--太玄反震
			if PersonKF(id,102) and JY.Person[191]["品德"] == 60 then
				jl = 30
				cfr = 0.7
			end
			local str = '乾坤挪移'
			--概率触发
			if math.random(100) <= jl then
				--反伤返杀气
				fs = hurt*(1-cfr)
				ng = ang*(1-cfr)
				--承受伤害
				hurt = math.modf(hurt*cfr)
				ang = math.modf(fang*cfr)
				if MPTX(id,13,3) and Curr_NG(id,97) and mzll == 1 then
					hurt = 1
					ang = 1
					Set_Eff_Text(i,"特效文字3",'明尊琉璃・诸恶皆烬');
				end
				--如果能够被反弹
				if Fjkx(WAR.CurID) == 2 then
					if NGQH(id,97) and (WAR.PD['明尊白莲'][id] == 1 or MPTX(id,13,4)) then
						ftpd = true
					else
						ftpd = false
					end
				end	
				if ftpd == true then
					--有人可以弹
					if #menu > 0 then
						local n = math.random(#menu)
						f1 = menu[n]
						table.remove(menu,n)
						if isteam(id) == false then
							ng = math.modf(ng/2)
							fs = math.modf(fs/2)
						end
						if MPTX(id,13) and Curr_NG(id,97) and JLSD(30,65,id) then
							Set_Eff_Text(i, "特效文字1", "生亦何欢・死亦何苦")
							ng = math.modf(ng*1.5)
							fs = math.modf(fs*1.5)
						end
						if NGQH(id,97) and JLSD(30,65,id) then
							fs = math.modf(fs+500)
							ng = math.modf(ng+500)
						end
						Cat('总伤害计算',f1, wugong, level, ng, fs,0,0,1)
						WAR.TXXS[WAR.Person[f1]['人物编号']] = 1
					end
					--有人可以反弹，张无忌之类的可以返2次
					if #menu > 0 then
						if match_ID(id,9) or match_ID(id,456) or match_ID(id,9990) then
							local n = math.random(#menu)
							f2 = menu[n]
							table.remove(menu,n)
							ng = math.modf(ng*2)
							fs = math.modf(fs*2)
							Cat('总伤害计算',f2, wugong, level, ng, fs,0,0,1)
							str = '以待天时・乾坤逆转'
							WAR.TXXS[WAR.Person[f2]['人物编号']] = 1
						elseif MPTX(id,13) and Curr_NG(id,97) and JLSD(30,65,id) then
							local n = math.random(#menu)
							f2 = menu[n]
							table.remove(menu,n)
							ng = math.modf(ng*1.2)
							fs = math.modf(fs*1.2)
							Cat('总伤害计算',f2, wugong, level, ng, fs,0,0,1)
							str = '乾坤挪移・双'
							WAR.TXXS[WAR.Person[f2]['人物编号']] = 1
						elseif MPTX(id,13,3) and Curr_NG(id,97) and mzll == 1 then
							local n = math.random(#menu)
							f2 = menu[n]
							table.remove(menu,n)
							ng = math.modf(ng*1.5)
							fs = math.modf(fs*1.5)
							Cat('总伤害计算',f2, wugong, level, ng, fs,0,0,1)
							str = '明尊琉璃・白莲真意'
							WAR.TXXS[WAR.Person[f2]['人物编号']] = 1
						end
					end
					Set_Eff_Text(i,"特效文字2",str);
				end
			end
			if WAR.PD['明尊白莲'][id] == 1 then
				WAR.PD['明尊白莲'][id] = nil
			end
			if mzll == 1 then
				mzll = 0
			end	
		end
	end
	return hurt,ang
end

function DWPD(a,d)
    if WAR.Person[a]['我方'] ~= WAR.Person[d]['我方'] then 
        return true
    end
    return false
end
function dead(i)
	if WAR.Person[i]['死亡'] == false then
		return false
	else
		return true
	end
end	
function nomiss(pid,eid,wugong)
	if WAR.PD['后土阵'][pid] == nil and WAR.SSYB ~= 1 then
		if match_ID(eid,457) and WAR.PD['虚邪夜玄'][eid] ~= nil then
			return false
		end
		if NGQH(eid,105) and WAR.PD['葵花护盾'][eid] ~= nil and WAR.PD['葵花护盾'][eid] > 3 then
			return false
		end
		if QGQH(eid,147,2) and WAR.PD['凌波微步闪避'][eid] ~= nil and WAR.PD['凌波微步闪避'][eid] > 0 then
			return false
		end
		if QGQH(eid,286,2) and JLSD(10,40,pid) then
			return false
		end
	end
	--观止攻击废除自身必命中
	if match_ID(pid,456) then
		return false
	end	
	if match_ID(pid,457) and WAR.PD['虚邪剑来'][pid] ~= nil then
		return true
	end
	--岳云岳家枪法必命中
	if (match_ID(pid,568) or PersonKF(pid,199)) and wugong == 200  then
		return true
	end
	--独孤九剑组合必命中
	if Cat('九剑真传',pid,wugong) then
		return true
	end
	--越女剑法必命中
	if (wugong == 156 and WGZH(pid,156,188))  or WAR.YYLMJJF == 1 then 
		return true
	end
	--中华阁、竹风雨滴
	if MPTX(pid,22,3) or match_ID(pid,520) then
		return true
	end
	--易水寒诀
	if Curr_NG(pid,43) then
		if WAR.PD['易水寒诀'][pid]~=nil and WAR.PD['易水寒诀'][pid] > 55 and JLSD(10, 70, pid) then
			return true
		end
	end
	--殊死一击
	if WAR.SSYB == 1 and MPTX(pid,23,4) then
		return true
	end
	--曲非烟
	if WAR.PD['曲径通幽'][pid] == 1 then 
		return true
	end	
	--听风辨位、阿青、喵姐
	if match_ID(pid, 9942) or match_ID(pid,604) or match_ID(pid, 92) then
		return true
	end
	--李寻欢必中  
	if match_ID(pid, 498) and WAR.XLFD[pid] ~= nil then
		return true
	end
	--护龙军师大阵
	if WAR.PD['后土阵'][pid] == 1 and JLSD(10,50,pid) then 
		return true
	end
	--惊天一剑、剑二十三
	if WAR.JTYJ[pid] ~= nil or WAR.SL23 == 1 then 
		return true
	end
	--天罗地网
	if Curr_QG(pid,148) and (QGQH(pid,148,1) or JLSD(0,60,pid)) then
		return true
	end
	--古墓2级弟子玉女心经必中
	if ((MPTX(pid,3) and Curr_NG(pid,154)) or match_ID(pid,605)) and JLSD(20,60,pid) then
		return true
	end
	--追魂无影高阶
	if QGQH(pid,278,2) then
		return true
	end 	
	--九阴飞絮劲
	if WAR.JYZJ_FXJ == 1 then
		return true
	end
	--暴怒技
	if WAR.EMBN == 1 then
		return true
	end
	--一刀流
	if MPTX(pid,11) then
		return true
	end 	
	--心念合一
	if WAR.Focus[pid] ~= nil then
		return true	
	end
	--黯然大招
	if wugong == 25 and WAR.ARJX == 1 then
		return true
	end	
	--闪电五连鞭
	if WAR.SDWLB == 1 then
		return true
	end	
	--套装效果
	if PDTZ(pid,JY.Person[pid]["武器"]) then
		local n = JY.Person[pid]["武器"]
		if Setmeal[n][4] == 20 then
			if math.random(100) <= 70 then
				return true
			end
		end
	end
	--达尔巴死战
	if WAR.SZSD == eid then
		return true
	end
	--龙女天罗必中
	if WAR.PD["龙女天罗"][eid] ~= nil then
		if WAR.PD["龙女天罗"][eid] == 1 then
			WAR.PD["龙女天罗"][eid] = 2
		end	
		return true
	end
	if wugong == 341 and (WAR.BLJJ == 2 or (WAR.BLJJ > 0 and WAR.PD['头晕目眩'][eid] ~= nil)) then
		return true
	end	
	if (wugong == 21 or wugong == 153) and WAR.YSSH3 == 1 and (WAR.PD['易水四寒'][eid] == 3 or WAR.PD['易水四寒'][eid] == 5) then
		return true
	end
	--必中buff
	if WAR.PD['必命中'][pid] ~= nil then
		return true
	end
	if WAR.PD['全屏攻击'][pid] ~= nil and math.random(100) < 16 then
		return true
	end
	if WAR.PD['降龙・见龙在田'][pid] == 1 then
		return true
	end
	if WAR.PD['龙爪手'][pid] == 1 then
		return true
	end
	--护龙山庄
	if WAR.PD['护龙剑法'][pid] == 1 then
		return true
	end
	if WAR.PD['无常索命诀5'][pid] == 1 then
		return true
	end	
	if WAR.PD['燎原枪1'][pid] == 1 then
		return true
	end	
	if WAR.PD['天地之心'][pid] == 1 and psx(pid,'体力') > 90 then
		return true
	end	
	return false
end

Ct['闪避'] = function(enemyid,wugong,hurt,ang)
  local pid = WAR.Person[WAR.CurID]['人物编号']
  local eid = WAR.Person[enemyid]['人物编号']
  ------------------------------------闪避计算--------------------------------------
	--凌波微步
	if WAR.PD['凌波微步闪避'][eid] ~= nil and WAR.PD['凌波微步闪避'][eid] > 0 then
		WAR.PD['凌波微步闪避'][eid] = WAR.PD['凌波微步闪避'][eid] - 1
		if WAR.PD['凌波微步闪避'][eid] < 1 then
			WAR.PD['凌波微步闪避'][eid] = nil
		end
		if QGQH(eid,147,2) then
			local jl = 20
			if MPTX(eid,7) then
				jl = jl + 10
			end	
			if JY.Person[eid]["性别"] == 0 and math.random(95) <= (jl) then--
				WAR.PD["格挡状态"][eid] = 2
				WAR.PD["集气速度"][eid]=limitX((WAR.PD["集气速度"][eid] or 0) + 15, 0, 30)
				WAR.PD["天香续命"][eid]=limitX((WAR.PD["天香续命"][eid] or 0) + 15, 0, 30)
				Set_Eff_Text(enemyid,2,"凌波微步・烟雨谪仙")
			elseif JY.Person[eid]["性别"] == 1 then
					if WAR.PD['机率下降'][pid] == nil then
						WAR.PD['机率下降'][pid] = 10
					end	
					if DWPD(WAR.CurID,enemyid) then	
						local tmpcount = 0
						for i = 0, WAR.PersonNum - 1 do
							if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[enemyid]["我方"] then
								tmpcount = tmpcount + 1
							end
						end
						if JY.Person[pid]["性别"] == 0 and JLSD(10,jl,eid) and tmpcount > 1 then
							WAR.Person[WAR.CurID]["我方"] = WAR.Person[enemyid]["我方"] 
							WAR.PD["魅惑状态"][pid] = 2
							if WAR.PD['机率下降'][pid] ~= nil then
								WAR.PD['机率下降'][pid] = nil
							end	
						elseif JY.Person[pid]["性别"] == 1 and JLSD(10,jl+20,eid) and tmpcount > 1 then
							WAR.Person[WAR.CurID]["我方"] = WAR.Person[enemyid]["我方"] 
							WAR.PD["魅惑状态"][pid] = 1
							if WAR.PD['机率下降'][pid] ~= nil then
								WAR.PD['机率下降'][pid] = nil
							end
						end	
					end
					Set_Eff_Text(enemyid,2,"凌波微步・羞月洛神")
			elseif JY.Person[eid]["性别"] == 2 and JLSD(10,jl+15,eid) then
				WAR.PD['邪魅苍生'][pid] = 15
				WAR.PD['锁足状态'][pid] = 1
				ztd(WAR.CurID,WAR.FXXS,15)
				nuqi(eid,10)
				Set_Eff_Text(enemyid,2,"凌波微步・邪魅苍生")
			end
		end
		Set_Eff_Text(enemyid,0,"凌波微步・闪避")
		WAR.Dodge = 1
	end
	--神行百变
	if WAR.PD['神行百变闪避'][eid] ~= nil and WAR.PD['神行百变闪避'][eid] > 0 then
		local c_up = 0
        local jl = 24      
        if JXPD(eid,54,1) then
            c_up = 10
        end
		if JLSD(0,jl+c_up,eid) then
			WAR.PD['神行百变闪避'][eid] = WAR.PD['神行百变闪避'][eid] - 1
			if WAR.PD['神行百变闪避'][eid] < 1 then
				WAR.PD['神行百变闪避'][eid] = nil
			end
			WAR.Dodge = 1
			Set_Eff_Text(enemyid,0,"神行百变・闪避")
		end
	end
	--全真门派被动七星阵步
	if WAR.PD['七星阵步闪避'][eid] ~= nil and WAR.PD['七星阵步闪避'][eid] > 0 then
		local xg = MPDJ(eid)
		local shz = 0
		local jl=10
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["死亡"] == false and WAR.Person[j]["我方"] == WAR.Person[enemyid]["我方"] then
				shz = shz + 1
			end
		end
		if shz > 7 then
			shz = 7
		end
		if shz >= 2 then
			jl = jl + (shz)* (xg-1)
		end
		if JLSD(10,5+jl,eid) then 
			WAR.PD['七星阵步闪避'][eid] = WAR.PD['七星阵步闪避'][eid] - 1
			if WAR.PD['七星阵步闪避'][eid] < 1 then
				WAR.PD['七星阵步闪避'][eid] = nil
			end
			Set_Eff_Text(enemyid,0,"七星阵步・闪避")
			WAR.Dodge = 1
		end
	end
	--峨眉门派被动流云逐月
	if WAR.PD['流云逐月闪避'][eid] ~= nil and WAR.PD['流云逐月闪避'][eid] > 0 then
		local jl = 35
		if Curr_QG(eid,290) then
			jl = 45
		end	
		if MPTX(eid,17) and MPDJ(eid) > 0 then
			jl = jl + MPDJ(eid)
		end	
		if JLSD(0,jl+5,eid) then
			WAR.PD['流云逐月闪避'][eid] = WAR.PD['流云逐月闪避'][eid] - 1
			if WAR.PD['流云逐月闪避'][eid] < 1 then
				WAR.PD['流云逐月闪避'][eid] = nil
			end
			Set_Eff_Text(enemyid,0,"流云逐月・闪避")
			WAR.Dodge = 1
		end
	end
	--逍遥御风
	if WAR.PD['逍遥御风闪避'][eid] ~= nil and WAR.PD['逍遥御风闪避'][eid] > 0 then
		--WAR.Person[enemyid]["特效动画"] = 153
		Set_Eff_Text(enemyid,0,"逍遥御风・闪避")
		WAR.Dodge = 1
	end
	--闪避
	if WAR.PD['闪避'][eid] ~= nil and WAR.PD['闪避'][eid] > 0 then
		WAR.Dodge = 1
		WAR.PD['闪避'][eid] = nil
	end
	--隐蔽状态
	if WAR.PD['时序闪避'][eid] ~= nil and WAR.PD['时序闪避'][eid] > 0 then
        WAR.Dodge = 1
    end
	--九阴降龙
	if WAR.PD['羽蛇腾云'][eid] ~= nil and WAR.PD['羽蛇腾云'][eid] > 0 then	
		local aa = math.modf((WAR.PD['羽蛇腾云'][eid] or 0) / 2)
		if JLSD(0,aa,eid) then
			WAR.Dodge = 1
			WAR.Person[enemyid]["特效文字2"] = "蛇行・瞬闪"
		end
	end
	---------------------------------------------------------------门派闪避------------------------------------------------------------------------------------
	
	--丐帮闪避
	if ((MPTX(eid,2,4) and (JY.Person[eid]["武器"] == 49 or JY.Person[eid]["武器"] == 620 or JY.Person[eid]["武器"] == 638)) or match_ID(eid, 50) or match_ID(eid, 69)) and JLSD(10,45,eid) then	
	    WAR.Dodge = 1
	    WAR.Person[enemyid]["特效文字1"] = "衣袂破风"
    end
	--古墓2级天罗地网闪避
	if ((MPTX(eid,3,2) and PersonKF(eid,148)) or match_ID(eid,605)) and JLSD(20,60,eid) then
		WAR.Dodge = 1	
		WAR.Person[enemyid]["特效文字1"] = "玉女素心妙如神"
	end 
	--逍遥派闪避
    if ((MPTX(eid,7) and PersonKF(eid,147)) and JLSD(20,60,eid)) or ((match_ID(eid,116) or match_ID(eid,117) or match_ID(eid,118)) and JLSD(30,75,eid)) 
	or (match_ID(eid,634) and JLSD(35,85,eid)) then
	    WAR.Dodge = 1 
		WAR.Person[enemyid]["特效文字1"] = "动无常则・若危若安"
    end 
	--桃花岛指令闪避
	if MPTX(eid,10) and WAR.BHHJ > 0 then
		WAR.BHHJ = WAR.BHHJ - 1
		WAR.Person[enemyid]["特效文字2"] = "桃花阵图・碧海幻境"	
		WAR.Dodge = 1
	end
	--中华阁1级
	if MPTX(eid,22) then 
		local a = JY.Person[eid]['轻功']/30
		if JLSD(30,55+a,eid) then
		    WAR.Dodge = 1
			WAR.Person[enemyid]["特效文字3"] = "跑堂身法・雁过无痕"
		end
    end	
	
    	
	---------------------------------------------------------------------人物特性闪避-------------------------------------------------
	--祖千秋，30%闪避
    if (match_ID(eid, 88) or match_ID(eid, 9841)) and JLSD(0,30,eid) then
        WAR.Dodge = 1
        WAR.Person[enemyid]["特效文字2"] = "酒神秘踪步"	
    end
    --虾米绝影闪
	if match_ID(eid,759) and (JLSD(10,50,eid) or WAR.XMJYS > 0) then 
	    if WAR.XMJYS > 0 then
            WAR.XMJYS = WAR.XMJYS - 1
        end
		WAR.Dodge = 1
        WAR.Person[enemyid]["特效文字1"] = "风天流・绝影闪"
        WAR.Person[enemyid]["特效动画"] = 120
    end	
    --斗气绝影闪
	if (match_ID(eid,767) or match_ID(eid,768) or match_ID(eid,769) or match_ID(eid,770)) and (JLSD(10,50,eid) or WAR.DQJYS > 0) then 
		if WAR.DQJYS > 0 then
            WAR.DQJYS = WAR.DQJYS - 1
        end
		WAR.Dodge = 1
        WAR.Person[enemyid]["特效文字1"] = "风天流・绝影闪"
        WAR.Person[enemyid]["特效动画"] = 120
    end	
	--套装效果闪避
    if PDTZ(eid,JY.Person[eid]["武器"]) and Setmeal[JY.Person[eid]["武器"]][5] == 10 then
	    if JLSD(0,15,eid) then
		    WAR.Dodge = 1
		    WAR.Person[enemyid]["特效文字2"] = "套装闪避"
		end
    end	
	--畅想低资质暴怒技
	if eid == 0 and JY.Base["畅想"] > 0 and (JY.Person[0]["资质"] < 31 and JY.Person[0]["资质"] > 0) then
		if BNJQ(eid) then
			WAR.Dodge = 1
			if JLSD(0,20,eid) then
				ztd(enemyid,"集气位置",math.random(20,50))
			end
			Set_Eff_Text(enemyid,"特效文字2","怒气爆发・雁过无痕")
		end
	 end 
    --八酒杯闪避        
    if match_ID(eid, 9965) then 
        local jl = 5 
        if WAR.PD['八酒杯'][eid] ~= nil then
            jl = jl + 30
        end
        if JLSD(0,jl,eid) then
            WAR.Dodge = 1
            WAR.Person[enemyid]["特效文字2"] = "八酒杯・酒神迷踪步"
        end    
    end
    --萧秋水 风流，15%闪避
	if (match_ID(eid, 652) or Curr_NG(eid,177)) and JLSD(0,15,eid) and JY.Base["天书数量"] > 5 then
	    WAR.Dodge = 1
		WAR.Person[enemyid]["特效文字2"] = "风流"	
		WAR.Person[enemyid]["特效动画"] = 89
		if NGQH(eid,177) then
			WAR.TYJW = 1
			WAR.Person[enemyid]["特效文字2"] = "腾云"
		end
	end
    --电饭锅，25%闪避
	if match_ID(eid, 515) or match_ID(eid, 9775) then
		local jl = 25
		if JLSD(0,jl,eid) then
			WAR.Dodge = 1
			WAR.Person[enemyid]["特效文字2"] = "不粘锅"	
		end
	end
	--袁冠南 闪避
    if match_ID(eid, 566) or match_ID(eid, 9907) then
        local sbjl = 15
        if  JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 4 then 
            sbjl = sbjl+20
        elseif JY.Person[pid]["生命"] < JY.Person[pid]["生命最大值"] / 2 then 
            sbjl = sbjl+10 
        end	
        if JLSD(0,sbjl,eid) then
            WAR.Dodge = 1
        end
    end
	
    --段誉 指令，50%闪避
    if match_ID(eid, 53) and WAR.TZ_DY == 1 and JLSD(0,50,eid) then
        WAR.Dodge = 1
        WAR.Person[enemyid]["特效文字2"] = "凌波微步"
    end
    --绝影闪
	if eid == 0 and JY.Base["标准"] > 0 and WAR.JYS > 0 then 
        if WAR.JYS > 0 then
            WAR.JYS = WAR.JYS - 1
        end
		WAR.Dodge = 1
        WAR.Person[enemyid]["特效文字1"] = "御风・绝影闪"
        WAR.Person[enemyid]["特效动画"] = 120
    end	
    --主角 特系，初始15%闪避，每个奇门练到极，增加5%闪避
    if actor(eid,5) then
        local gctj = 15
        for i = 1, JY.Base["武功数量"] do
            if JY.Wugong[JY.Person[0]["武功" .. i]]["武功类型"] == 5 and JY.Person[0]["武功等级" .. i] == 999 then
                gctj = gctj + 5
            end
        end
        if gctj > 50 then
            gctj = 50
        end
        if JLSD(0,gctj,eid) then
            WAR.Dodge = 1
            WAR.Person[enemyid]["特效文字1"] = "天机身法"		--天机身法
        end
    end
	--黄蓉奇门遁甲，紫色，30%闪避
    if WAR.Person[enemyid]["我方"] == true and GetWarMap(WAR.Person[enemyid]["坐标X"], WAR.Person[enemyid]["坐标Y"],6) == 4 and JLSD(0,30,eid) then
        WAR.Dodge = 1
    end
    --李沅芷 闪避
    if ZDGH(enemyid,569) and JLSD(0,15,eid) then	
        WAR.Dodge = 1
        WAR.Person[enemyid]["特效文字1"] = "沅芷澧兰"		
    end
	--赵敏
	for i = 0, WAR.PersonNum - 1 do
        local zid = WAR.Person[i]["人物编号"]
        if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and match_ID(zid, 609) then
            if WAR.Defup[eid] == 1 and JLSD(0,20,zid) then
                WAR.Dodge = 1
            end
            break
        end
    end
	----------------------------------------------------内功组合闪避-----------------------------------------------------------
	--隼龙令
	if PersonKF(eid,282) and (math.random(10) < 5 or WAR.SLS > 0) then 
        if WAR.SLS > 0 then
            WAR.SLS = WAR.SLS - 1
        end
		WAR.Dodge = 1
        WAR.Person[enemyid]["特效文字1"] = "隼龙诀・闪避"
        WAR.Person[enemyid]["特效动画"] = 120
    end
	--妖风祸世
	if WAR.YFHS == 1 and YaoFengHuoShi(eid) and JLSD(0,30,eid) then	
        WAR.Dodge = 1
		WAR.Person[enemyid]["特效文字2"] = "妖风祸世・迷神"
    end
	--葵花紫霞
	if WAR.PD['葵花护盾'][eid] ~= nil and WAR.PD['葵花护盾'][eid] > 0 then
		WAR.Dodge = 1
	end
    --葵花移行
    if Curr_NG(eid, 105) then
        --葵花尊者必定移形
        local jl = 20
        local jl1 = 0
        if match_ID(eid,27) or match_ID(eid,777) or match_ID(eid,511) or JXPD(eid,19,1) then
            jl1 = jl1 + 20
        end
		if NGQH(eid,105) or (JXPD(eid,27,2) or match_ID(eid,777)) then
            jl1 = jl1 + 20
        end
        if JLSD(0,jl+jl1,eid)  then
            WAR.Dodge = 1
            WAR.Person[enemyid]["特效文字2"] = "真.葵花移形"
            WAR.Person[enemyid]["特效动画"] = 89
        end
    end
	---------------------------------------------------------------攻击状态闪避---------------------------------------------------
	--观止打不中人
    if match_ID(pid, 456) then
		if math.random(10) < 6 or JXPD(pid,456,1) then
			WAR.Dodge = 1
		end
	end
    --被刺目，伤害杀气降低15%，有15%几率miss
    if WAR.PD["盲目状态"][pid] == 2 or WAR.PD['微醺'][pid] ~= nil or WAR.PD['业障缠身'][pid] == 31 or WAR.PD['暗香疏影'][pid] == 4 then
        if WAR.MMGJ == 1 then
            WAR.Dodge = 1
        end
    end

    if WAR.PD["忘情日明"][pid] == 1 or WAR.PD['头晕目眩'][pid] == 1 or WAR.PD["意恍惚"][pid] ~= nil then
        if WAR.MMGJ == 1 then
            WAR.Dodge = 1
        end
    end				
	
	if WAR.PD["刺目"][pid] == 2 then
        if WAR.CMGJ == 1 then
            WAR.Dodge = 1
        end
    end		
	---------------------------------------------------------------轻功闪避---------------------------------------------------------------------------
    --逍遥游 
    if QGQH(eid,2,1) and WAR.ACT > 3 then
        local jl = 10 + math.modf(WAR.ACT*10)
        if inteam(eid) then
			if JLSD(0,jl,eid) then
				WAR.Dodge = 1
			end
		else
			if JLSD(10,math.modf(jl/3),eid) then
				WAR.Dodge = 1
			end	
        end	
    end
    if WAR.PD['醉八仙'][eid] ~= nil and (JY.Wugong[wugong]["武功类型"] == 1 or JY.Wugong[wugong]["武功类型"] == 5) then
		if JLSD(10,60,eid) then
			WAR.Dodge = 1
			WAR.Person[enemyid]["特效文字1"] = "形醉意不醉"
		end	
	end	
	--花间游
	if Curr_QG(eid,286) then
		local jl = (1500 - WAR.Person[enemyid].Time)/25
		if JLSD(0,jl+5,eid) then
			WAR.Person[enemyid]["特效文字1"] = "万花轮舞曲"
			WAR.Dodge = 1
			ztd(enemyid,"体力点数",5)
		end
	end
	--流云逐月
	if QGQH(eid,290,1) then
		local a = math.modf(Qg(enemyid)*0.05)
		if a < 10 then a = 10 end
		if a > 50 then a = 50 end
		if ((Qg(enemyid) >= Qg(WAR.CurID)) or math.abs(Qg(enemyid) - Qg(WAR.CurID)) <= 100) and QGQH(eid,290,2) then
			WAR.Dodge = 1
			WAR.Person[enemyid]["特效文字1"] = "流云逐月・真云身"
			ztd(enemyid,"生命点数",a*10)
			if TFQG(eid,290) then
				ztd(enemyid,"体力点数",a)
				ztd(enemyid,"内力点数",a*30)
			end	
			if match_ID(eid,626) then
				Cat("清除低级异常",enemyid)
			end	
		elseif JLSD(0,a,eid) then
			WAR.Dodge = 1
			if QGQH(eid,290,2) then
				WAR.Person[enemyid]["特效文字1"] = "流云逐月・真云身"
				ztd(enemyid,"生命点数",a*10)
			else
			    WAR.Person[enemyid]["特效文字1"] = "流云逐月・云身"
			end
			if TFQG(eid,290) then
				ztd(enemyid,"体力点数",a)
				ztd(enemyid,"内力点数",a*30)
				ztd(enemyid,"内伤点数",-psx(eid,"受伤程度"))
				ztd(enemyid,WAR.FXXS,-psx(eid,"封穴程度"))
			end	
			if match_ID(eid,626) then
				Cat("清除中级异常",enemyid)
			end	
		end
	end	
	--踏雪无痕
	if QGQH(eid,277,1) then
		local jql={0,-100,-200,-300,-400,-400,-400,-400}
		local jl = 30
		if MPTX(eid,6) then
			jl = jl + 10
		end	
		if JLSD(10,jl,eid) and WAR.Person[enemyid].Time ~= nil and WAR.Person[enemyid].Time < jql[JY.Person[eid]['畅想分阶']+1] then
			WAR.Dodge = 1
			WAR.Person[enemyid]["特效文字1"] = "雪地迷踪"
			if match_ID(eid,62) and JLSD(10,35,eid) then
				WAR.BTZT[eid] = 1
			end	
		end
	end		
	--追魂无影进阶
	if QGQH(eid,278,1) then
		local a = math.modf(Qg(enemyid)*0.025)
		if JLSD(0,20+a,eid) then
			WAR.Dodge = 1
			WAR.Person[enemyid]["特效文字1"] = "无影无形"
		end	
		ztd(enemyid,"中毒点数",-a)
		ztd(enemyid,"内伤点数",-a)
		ztd(enemyid,WAR.BFXS,-a)
		ztd(enemyid,WAR.ZSXS,-a)
		ztd(enemyid,WAR.FXXS,-a)
		ztd(enemyid,WAR.LXXS,-a)
	end 	
	--闪避失效
	if WAR.PD['头晕目眩'][eid] ~= nil then
		if JLSD(10,35,pid) and WAR.Dodge == 1 then
			WAR.Dodge = 0
		end
	end	
	if WAR.PD['凝结时空'][eid] ~= nil then
		if WAR.Dodge == 1 then
			WAR.Dodge = 0
		end
	end
    ---闪避生效
	if WAR.Dodge == 1 then 
		WAR.Miss[eid] = 1 
		WAR.Person[enemyid]['闪避'] = true
		WAR.MissPd = 1
		--白驹过隙
		if match_ID(eid,566) or match_ID(eid,9907) then
			if fjpd(WAR.CurID) == false and Fjkx(WAR.CurID) ~= 2 then
				WAR.Person[enemyid]["特效文字2"] = "白驹过隙"
				if WAR.AutoFight == 1 or WAR.Person[enemyid]['我方'] == false then 
					War_AutoFight()
				else 
					WAR.Person[enemyid]['反击'] = 1
				end
			end
		end
		--招式见破・自动攻击
		if MPTX(eid,23,4) then 
			if WAR.Adapt[eid][wugong] ~= nil and WAR.Adapt[eid][wugong] > 4 then
				if fjpd(WAR.CurID) == false and Fjkx(WAR.CurID) ~= 2 then
					WAR.Person[enemyid]['反击'] = 1
					WAR.Person[enemyid]["特效文字2"] = "见破武学"
					WAR.Adapt[eid][wugong] = 1
				end
			end
		end
		--绝影闪
		if eid == 0 and JY.Base["标准"] > 0 and WAR.JYS > 0 then
			local zz = JY.Person[eid]["资质"]
			local ts = JY.Base["天书数量"] * 4
			local cs = 0
			cs = 30 + zz + ts
			ztd(enemyid,"集气位置",math.random(30,cs))
		end
		--花间游进阶
		if QGQH(eid,286,1) then
			local jq = math.modf((WAR.JQSDXS[eid] or 0)/5)
			ztd(enemyid,"中毒点数",-jq)
			ztd(enemyid,"内伤点数",-jq)
			ztd(enemyid,WAR.BFXS,-jq)
			ztd(enemyid,WAR.ZSXS,-jq)
			ztd(enemyid,WAR.FXXS,-jq)
			ztd(enemyid,WAR.LXXS,-jq)
			WAR.PD["盲目状态"][eid] = nil
			WAR.PD['业障缠身'][eid] = nil
			WAR.PD['暗香疏影'][eid] = nil
			WAR.PD["忘情日明"][eid] = nil
			WAR.PD['头晕目眩'][eid] = nil
			WAR.PD["意恍惚"][eid] = nil
			WAR.PD["刺目"][eid] = nil
			WAR.PD['微醺'][eid] = nil
		end
		--葵花紫霞
		if NGQH(eid,105) and WAR.PD['葵花护盾'][eid] ~= nil and WAR.PD['葵花护盾'][eid] > 0 then
			WAR.PD['葵花护盾'][eid] = WAR.PD['葵花护盾'][eid] - 1
			WAR.KHFJ[eid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
			if WAR.PD['葵花护盾'][eid] < 1 then 
				WAR.PD['葵花护盾'][eid] = nil 
				if WAR.Person[enemyid]["护盾"] ~= nil and WAR.Person[enemyid]["护盾"] == 7 then
					WAR.Person[enemyid]["护盾"] = -1
				end	
			end
		end
		--葵花诡影
		if (NGQH(eid,105) or JXPD(eid,19,1) or match_ID(eid,27) or match_ID(eid,777)) and JLSD(20,50,eid) then
			WAR.Person[enemyid]["特效文字2"] = "葵花诡影"
			if fjpd(WAR.CurID) == false and Fjkx(WAR.CurID) ~= 2 then
				WAR.Person[enemyid]['反击'] = 1
			end
		end
		--李白深藏功与名
		if match_ID(eid,636) then
			WAR.Person[enemyid]["特效文字2"] = "深藏功与名"
			ztd(WAR.CurID,"生命点数",-math.random(300,500))
			ztd(enemyid,"集气位置",math.random(300,500))
		end
		--梁萧十方步
		if match_ID(eid,635) then
			WAR.Person[enemyid]["特效文字2"] = "乘风蹈海"
			ztd(enemyid,"生命点数",math.random(300,500))
			ztd(enemyid,"集气位置",math.random(300,500))
		end
		--遁甲奇书
		if (PersonKF(eid,251) and match_ID(eid,9848)) or match_ID(eid,57) then
			WAR.Person[enemyid]["特效文字2"] = "奇门遁甲・闪"
			WAR.PD['奇门五转'][eid] = (WAR.PD['奇门五转'][eid] or 0) + math.random(500,1000)
		end
	    --踏雪无痕门派效果
	    if Curr_QG(eid,277) and MPTX(eid,6) and (Curr_NG(eid,103) or Curr_NG(eid,163) or Curr_NG(eid,233)) then
	    	local jl = limitX(psx(eid,'品德'),0,80)
	    	if JLSD(0,100-jl,eid) then
		    	WAR.Person[enemyid]["特效文字2"] = "踏雪无痕・梵空行"
				WAR.DZY = 1
				WAR.DLJ = 1
				if fjpd(WAR.CurID) == false and Fjkx(WAR.CurID) ~= 2 then
					if WAR.AutoFight == 1 or WAR.Person[enemyid]['我方'] == false then 
					    War_AutoFight()
				    else 
					    --Cat('武功')
						WAR.Person[enemyid]['反击'] = 1
				    end
				end	
			end	
	    end
		--逍遥派凌波
		if MPTX(eid,7) and PersonKF(eid,147) then	
			local mpdj = MPDJ(eid)
			WAR.Person[enemyid]["特效文字2"] = "罗袜生尘"
			ztd(WAR.CurID,'体力点数',-mpdj*3)
			ztd(enemyid,"集气位置",mpdj*math.random(30,50))
			if JLSD(10,10*mpdj,eid) then
				WAR.DLJ = 1
				WAR.DZY = 1
			end
		end
		--明教闪避
		if MPTX(eid,13) and Curr_NG(eid,93) then
			local mpdj = MPDJ(eid)+(WAR.PD["明教指令4"][pid] or 0)	
			WAR.Person[enemyid]["特效文字2"] = "焚我残躯"
			ztd(WAR.CurID,'生命点数',-mpdj*100)
			ztd(WAR.CurID,'内伤点数',mpdj*5)
			ztd(WAR.CurID,WAR.ZSXS,mpdj*5)
		end
		--易水四寒
		if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][eid] == 1 then
			WAR.PD['十方无敌'][eid] = (WAR.PD['十方无敌'][eid] or 0) + 10
			ztd(enemyid,'生命点数',-psx(eid,'冰封程度')-100)
			ztd(enemyid,WAR.BFXS,-math.modf(psx(eid,'冰封程度')*0.5))
			WAR.PD['冰覆双极'][eid] = nil
		end
		--达摩九阳
		if wugong == 140 and JFZH(pid,140,243) and WAR.PD['苦难达摩'][pid] ~= nil and WAR.PD['苦难达摩'][pid] > 0 then
			WAR.Person[enemyid]["特效文字2"] = "拙劲破巧"
			local dm = math.modf(WAR.PD['苦难达摩'][pid] * 0.4)
			ztd(enemyid,"生命点数",-dm)
		end
		--套装效果
	    if PDTZ(pid,JY.Person[pid]["武器"]) then
	       	local n = JY.Person[pid]["武器"]
		    if Setmeal[n][4] == 20 then
				WAR.Person[enemyid]["特效文字2"] = "套装真伤"
			    ztd(enemyid,"生命点数", -80)
		    end
	    end
		--混元狂风刀
		if (wugong == 55 and (PersonKF(pid,90) or PersonKF(pid,375))) 
			or (wugong == 78 and (PersonKF(pid,90) or PersonKF(pid,375)) and PersonKF(pid,55)) 
			or (wugong == 55 and match_ID(pid,29)) then
	    	WAR.Person[enemyid]["特效文字2"] = "狂风刃割"
			ztd(enemyid,"生命点数", -75)
			ztd(enemyid,"内力点数", -100)
			ztd(enemyid,"体力点数", -1)
		end
		--观止
		if match_ID(pid,456) then
			local jmm = 10 - (WAR.PD['九命猫'][pid] or 0)
			if jmm < 1 then
				jmm = 1
			end
			nuqi(eid,-jmm/2)
			zhanyi(eid,-jmm/2)
			local nq1 = math.random(2,5)
			if JXPD(pid,456,1) then
				ztd(enemyid,"生命点数", -30 * jmm)
				ztd(enemyid,"内力点数", -30 * jmm)
				ztd(enemyid,"体力点数", -1 * jmm)
				if WAR.PD['九阳护盾'][eid] ~= nil then
					WAR.PD['九阳护盾'][eid] = nil
				end
				if WAR.PD['天魔金身'][eid] ~= nil and WAR.PD['天魔金身'][eid] > 30 then
					WAR.PD['天魔金身'][eid] = 30
				end
				if WAR.PD["颠倒的世界"][eid] ~= nil and WAR.PD["颠倒的世界"][eid] == 1 then
					ztd(enemyid,"生命点数", 50 * jmm)
					ztd(enemyid,"内力点数", 50 * jmm)
				end
				WAR.PD['玄铁剑创'][eid] = (WAR.PD['玄铁剑创'][eid] or 0) + jmm
				WAR.PD['九剑破尽'][eid] = (WAR.PD['九剑破尽'][eid] or 0) + jmm
			end
			WAR.PD['冰心状态'][eid] = (WAR.PD['冰心状态'][eid] or 0) + nq1
			WAR.PD['黯然销魂'][eid] = (WAR.PD['黯然销魂'][eid] or 0) + nq1
			WAR.PD['七伤拳火'][eid] = (WAR.PD['七伤拳火'][eid] or 0) + nq1
			WAR.PD['同归状态'][eid] = 1
		end
		--无量禅震
		if match_ID(pid,9994) then
			ztd(enemyid,"生命点数", -(100 + JY.Person[eid]["受伤程度"]))
			ztd(enemyid,"内力点数", -(100 + JY.Person[eid]["受伤程度"]))
			ztd(enemyid,"内伤点数", 5)
			ztd(enemyid,"体力点数", -2)
			WAR.PD['疯魔'][eid] = (WAR.PD['疯魔'][eid] or 0) + 2
		end
  		--无量禅震
  		if match_ID(pid,9994) then
    		if WAR.PD['无量禅震'][pid] == nil then
	            WAR.PD['无量禅震'][pid] = {}
	            WAR.PD['无量禅震'][pid].n = 1
	            WAR.PD['无量禅震'][pid].s = 1
			else 
	            if WAR.PD['无量禅震'][pid].s == nil then
	                WAR.PD['无量禅震'][pid].s = 1
	                WAR.PD['无量禅震'][pid].n = (WAR.PD['无量禅震'][pid].n or 0) + 1
	            end
    		end
		end
		WAR.Dodge = 0
	end
end

Ct['区域免疫'] = function(wugong,x,y,hurt,ang)
	local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
  	local pid = WAR.Person[WAR.CurID]['人物编号']
  	if WAR.PD['四智妙法'][pid] == 2 and WAR.BJ == 1 then
  		do return end
  	end	
	--护龙军师大阵
	if WAR.PD['后土阵'][pid] == 1 and math.random(100) < 30 then 
		do return end
	end
	if WAR.SSYB == 1 and MPTX(pid,23,4) then
		do return end
	end
	for i = 0,WAR.PersonNum -1 do 
        local mid = WAR.Person[i]['人物编号']
		--[[--点点诡计
		if match_ID(pid, 456) or match_ID(pid, 92) then
			if WAR.PD['点点诡计'][mid] == 1 and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID and match_ID(mid,457) then
				WAR.Person[i]["我方"] = false
			end	
		end--]]
		--木凭
		if match_ID(mid,763) and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID then
			ztd(i,'集气点数',300)
			ztd(WAR.CurID,'体力点数',-10)
		end
        --铁锁横江
		if (WGZH(mid,76,79) or match_ID(mid,9892)) and WAR.Person[i]['死亡'] == false 
		and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[i]['我方'] then 
			local jl = 20
			if match_ID(mid,594) then
				jl = jl + 20
			end
			if JLSD(0,jl,mid) then
            	local x1,y1 = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
            	for j = -1,1 do 
                	for k = -1,1 do 
                   	    SetWarMap(j+x1,k+y1,4,0)
					end
				end
				WAR.Person[i]['特效文字3'] = '铁锁横江'
				WAR.Person[i]['特效动画'] = 6	
            end
        end
		--破尽天下
		if (match_ID(mid,92) or match_ID(mid,457) or match_ID(mid,592)) and WAR.Person[i]['死亡'] == false 
			and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[i]['我方'] then 
			local jl = 30
			if match_ID(mid,92) then
				jl = jl + 20
			end
			if JLSD(0,jl,mid) or (WAR.PD['无我之境'][mid] ~= nil and WAR.PD['无我之境'][mid] > 0) then
      			local x1,y1 = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
  				for j = -1,1 do 
          			for k = -1,1 do 
             	 		SetWarMap(j+x1,k+y1,4,0)
					end
				end
				if match_ID(mid,92) or match_ID(mid,592) then
					WAR.PD['破军'][pid] = 3
					if match_ID(mid,92) then
						if WAR.PD['神经蛇毒'][pid] == nil then
							WAR.PD['神经蛇毒'][pid] = 5
						end
						if WAR.PD['重度内伤'][pid] == nil then
							WAR.PD['重度内伤'][pid] = 5
						end
						if WAR.PD['走火入魔'][pid] == nil then
							WAR.PD['走火入魔'][pid] = 5
						end
					end
					if match_ID(mid,592) then
						WAR.PD['无招胜有招'][pid] = 5
						WAR.BTZT[mid] = 1
						ztd(WAR.CurID,'生命点数',-999)
						WAR.HFXZ[mid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
					end
					ztd(i,'生命点数',999)
				end
				if WAR.PD['虚邪剑来'][mid] == 1 or (WAR.PD['无我之境'][mid] ~= nil and WAR.PD['无我之境'][mid] > 0) then
					WAR.PD['虚邪不染尘'][mid] = limitX((WAR.PD['虚邪不染尘'][mid] or 0) + 1,0,9)
					ztd(i,'集气位置',100)
					WAR.Person[WAR.CurID]['护盾'] = -1 
					WAR.Person[WAR.CurID]['护盾贴图'] = -1 
				    WAR.Person[WAR.CurID]['护盾延迟'] = nil
				    --自动循环判定是否存在其他护盾，防止一个护盾被破其他护盾还存在
				    if WAR.Person[WAR.CurID]['护盾'] == nil or WAR.Person[WAR.CurID]['护盾'] == -1 then
				        local id = WAR.Person[WAR.CurID]['人物编号']
				        for j = 1,#CC.HD do 
				            local hname = CC.HD[j].name
				            if WAR.PD[hname] ~= nil then 
				                if WAR.PD[hname][id] ~= nil then 
				                    WAR.PD[hname][id] = nil
				                end
				            end
				        end
				    end
				end	
				WAR.Person[i]['特效文字3'] = '破尽天下'
				WAR.Person[i]['特效动画'] = 226
      		end
    	end
		--达摩返璞归真
		--if match_ID(mid,577) and (ZYJQ(mid) or JLSD(0,30,mid)) and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID then
			--addbuff(pid,WAR.PD['玄铁剑创'],20)
			--if WAR.PD['诛仙状态'][pid] == nil then
				--WAR.PD['诛仙状态'][pid] = 7
			--end
		--end
		--朝廷铁马阵
		if WAR.TMZF > 0 and MPTX(mid,23,2) and WAR.Person[i]['死亡'] == false 
			and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and WAR.Person[WAR.CurID]['我方'] ~= WAR.Person[i]['我方'] then 
      		local x1,y1 = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
	      	for j = -1,1 do 
		        for k = -1,1 do 
		         	SetWarMap(j+x1,k+y1,4,0)
				end
			end
			WAR.TMZF =WAR.TMZF - 1
			WAR.Person[i]['特效文字3'] = '铁马阵法'
			WAR.Person[i]['特效动画'] = 161	
  		end
		--踏雪寻梅
	  	if QGQH(mid,277,1) then
	  		local jql={0,-100,-200,-300,-400,-400,-400,-400}
	  		local x1,y1 = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
	  		if JLSD(10,20,mid) and WAR.Person[i].Time ~= nil and WAR.Person[i].Time < jql[JY.Person[mid]['畅想分阶']+1] then
    			for j = -1,1 do 
		        	for k = -1,1 do 
		         		SetWarMap(j+x1,k+y1,4,0)
					end
				end
				addbuff(mid,WAR.PD['天香续命'],25)
				--WAR.TMZF =WAR.TMZF - 1
				WAR.Person[i]['特效文字3'] = '雪影茫茫'
				WAR.Person[i]['特效动画'] = 80
				if match_ID(mid,62) and JLSD(10,35,mid) then
	  				WAR.BTZT[mid] = 1
	  			end
			end
		end	
		--云龙三折
		if MPTX(mid,19) and WAR.PD['时序闪避'][mid] ~= nil and math.random(100) > 85 then
			local x1,y1 = WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y']
			WAR.Person[i]['特效文字3'] = '真・云龙隐'
			for j = -1,1 do 
	        	for k = -1,1 do 
	         		SetWarMap(j+x1,k+y1,4,0)
				end
			end
		end
	end	
end

Ct['挪移闪避'] = function(wugong,x,y,hurt,ang)
    local x0,y0 = WAR.Person[WAR.CurID]['坐标X'],WAR.Person[WAR.CurID]['坐标Y']
    local pid = WAR.Person[WAR.CurID]['人物编号']
		local axjl,axny = 0,0
		if match_ID(pid,517) then
			do return end
		end	
		if WAR.PD['四智妙法'][pid] == 2 and WAR.BJ == 1 then
			do return end
		end
		if WAR.PD['全屏攻击'][pid] ~= nil and math.random(100) < 10 then
			do return end
		end
		--护龙军师大阵
		if WAR.PD['后土阵'][pid] == 1 and math.random(100) < 30 then 
			do return end
		end
		if WAR.SSYB == 1 and MPTX(pid,23,4) then
			do return end
		end
		for i = 0,WAR.PersonNum -1 do 
			local mid = WAR.Person[i]['人物编号'] 
			if QGQH(mid,316,1) then
				axjl = axjl + 10
				axny = 1
			end
			if (WAR.PD['锁足状态'][mid] ~= nil or WAR.PD['头晕目眩'][mid] ~= nil) then
				axjl = axjl - 8
			end
			--天罗地网
			if QGQH(pid,148,2) and JLSD(0,30,pid) and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID then
				WAR.PD["麻痹状态"][mid] = (WAR.PD["麻痹状态"][mid] or 0) + 1
				do return end
			end
			if WAR.PD['遮影'][pid] ~= nil and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID then
				do return end
			end
			if WAR.PD['雪遁'][pid] ~= nil and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID then
				do return end
			end
			--葵花挪移
			if Curr_NG(mid, 105) then	
				local jl = 0 + axjl
				if match_ID(mid,27) or JXPD(mid,19,1) or NGQH(mid,105) then
					jl = jl + 35
				elseif match_ID(mid,9967) or JXPD(mid,27,1) then
					jl = jl + 25
				elseif JXPD(mid,27,2) or match_ID(mid,92) then
					jl = jl + 15
				elseif match_ID(mid,92) then
				    jl = jl + 20	
				elseif match_ID(mid,777) then
				    jl = jl + 30	
				end
				if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID and JLSD(0,jl,mid) then
					if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
						WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
						ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
						ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
						WAR.PD['冰覆双极'][mid] = nil
					end	
					if match_ID(mid,27) or match_ID(mid,777) then
						Cat('挪移',i,10 + axny,1,nil,'真・葵花挪移',201)
						WAR.KHFJ[mid] = {pid, WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"]}
					else
						Cat('挪移',i,8 + axny,1,nil,'葵花挪移',201)
					end
				end
			end
			--夜雨楼副楼主
			if MPTX(mid,24,4) and JY.Person[mid]['主运轻功'] > 0 then
				local qin = 0
				for j = 1,JY.Base['武功数量'] do
					if yongqin(JY.Person[mid]['武功'..j]) then
						qin = qin +1 
					end
				end
				if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 
					and i ~= WAR.CurID and qin > 0 and JLSD(0,qin*10,mid) then
					Cat('挪移',i,5 + axny + qin,1,nil,'血不染',128)
				end
			end	
			--点点玄虚
			if match_ID(mid,457) and WAR.PD['虚邪不染尘'][mid] ~= nil and WAR.PD['虚邪不染尘'][mid] < 10 then
				local a = math.modf(WAR.PD['虚邪不染尘'][mid]*8)
				if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID and JLSD(0,a,mid) then
					Cat('挪移',i,7 + axny,1,nil,'虚邪剑步・不染尘',nil)
					WAR.PD['虚邪不染尘'][mid] = 10
					WAR.ACT = 10
				end
			end		
			--灵鳌步
			if Curr_QG(mid,237) and (math.abs(x0-WAR.Person[i]['坐标X']) + math.abs(y0-WAR.Person[i]['坐标Y'])) then
				local jl = 20 + axjl
				if match_ID(mid,635) then
					jl = jl + 30
				elseif MPTX(mid,10) then
					jl = jl + 10
				end
				if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 
					and i ~= WAR.CurID and JLSD(0,jl,mid) then
					if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
						WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
						ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
						ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
						WAR.PD['冰覆双极'][mid] = nil
					end		
					if match_ID(mid,635) then
						Cat('灵鳌步',i,7+ axny)
						WAR.PD['时序闪避'][mid] = 20
					elseif QGQH(mid,237,1) then
						Cat('灵鳌步',i,4+ axny)
					elseif MPTX(mid,10) then
						Cat('灵鳌步',i,5+ axny)
						WAR.BHHJ = WAR.BHHJ + 1
					else
						Cat('灵鳌步',i,2+ axny)
					end
				end	
			end
			--套装效果挪移
			if PDTZ(mid,JY.Person[mid]["武器"]) and (math.abs(x0-WAR.Person[i]['坐标X']) + math.abs(y0-WAR.Person[i]['坐标Y'])) then
				local jl = 15 + axjl
				local n = JY.Person[mid]["武器"]
				if Setmeal[n][6] == 3 and WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 
				and i ~= WAR.CurID and JLSD(0,jl,mid) then
					if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
						WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
						ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
						ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
						WAR.PD['冰覆双极'][mid] = nil
					end		
					Cat('套装效果.挪移',i,3+ axny)
				end	
			end
			--奇门五转
			if Curr_NG(mid, 317) and (math.abs(x0-WAR.Person[i]['坐标X']) + math.abs(y0-WAR.Person[i]['坐标Y'])) then
				local jl = 5 + axjl
				if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 
				and i ~= WAR.CurID and JLSD(0,jl,mid) then
					if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
						WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
						ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
						ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
						WAR.PD['冰覆双极'][mid] = nil
					end	
					if match_ID(mid,57) then
						Cat('奇门五转',i,7+ axny,1) 
						WAR.BHHJ = WAR.BHHJ + 1
					else
						Cat('奇门五转',i,5+ axny,1)
					end
					WAR.QMWZ=WAR.QMWZ+1
				end
			end
			--金雁功高阶位移
			if instruct_18(148,1) then
				if Curr_QG(mid,223) and JY.Person[mid]["畅想分阶"] < 2 and WAR.PD['金雁功闪避'][mid] ~= nil and inteam(mid) then 
				--if match_ID(mid,129) and WAR.PD['金雁功闪避'][mid] ~= nil then
					if (WAR.PD['金雁功闪避'][mid][3] ~= nil and WAR.PD['金雁功闪避'][mid][3]) or JLSD(0,35+axjl,mid) then
						if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID then
							if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
								WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
								ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
								ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
								WAR.PD['冰覆双极'][mid] = nil
							end	
							Cat('金雁功挪移',i,7+ axny,1)
						end
					end	
				end	
				if Curr_QG(mid,223) and JY.Person[mid]["畅想分阶"] < 2 and WAR.PD['金雁功闪避1'][mid] ~= nil and JLSD(10,45+axjl,mid) and inteam(mid) then
				--if match_ID(mid,129) and WAR.PD['金雁功闪避1'][mid] ~= nil then
					if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID then
						if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
							WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
							ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
							ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
							WAR.PD['冰覆双极'][mid] = nil
						end	
						Cat('金雁功挪移',i,7+ axny,1)
					end
				end
			end
			--竹风雨滴
			if match_ID(mid, 520) then
				local jl = 65
				if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID and JLSD(15,jl+ axjl,mid) then
					if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
						WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
						ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
						ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
						WAR.PD['冰覆双极'][mid] = nil
					end	
					Cat('梅花步',i,12+ axny,1)
				end
			end
			--洛梵音
			if match_ID(mid, 760) then
				local jl = 90
				if WAR.Person[i]['死亡'] == false and GetWarMap(WAR.Person[i]['坐标X'],WAR.Person[i]['坐标Y'],4) > 0 and i ~= WAR.CurID and JLSD(15,jl+ axjl,mid) then
					if ((wugong == 21 or wugong == 153) and WAR.YSSH3 == 1) or WAR.PD['冰覆双极'][mid] == 1 then
						WAR.PD['十方无敌'][mid] = (WAR.PD['十方无敌'][mid] or 0) + 10
						ztd(i,'生命点数',-psx(mid,'冰封程度')-100)
						ztd(i,WAR.BFXS,-math.modf(psx(mid,'冰封程度')*0.5))
						WAR.PD['冰覆双极'][mid] = nil
					end	
					Cat('天机闪',i,12+ axny,1)
				end
			end
			--::label1::
			--闪避
		end	
end
--夜雨楼如影随形特效
Ct['遮影'] = function(i)
	local ii = WAR.CurID
	local pid = WAR.Person[WAR.CurID]['人物编号']
	if match_ID(pid,517) then
		do return end
	end
	if WAR.Person[i]['死亡'] == false then
		local eid = WAR.Person[i]['人物编号']
		--if match_ID() then
			local x,y = WAR.Person[i]['坐标X'], WAR.Person[i]['坐标Y']
			if WAR.PD['遮影'][eid] == nil then
				PlayWavE(5)
				WAR.CurID = i
				WarDrawMap(0)
				Cat('遮影DH',WAR.CurID)
				WAR.PD['遮影'][eid] = pid
				WAR.PD['影随'][pid] = pid
				if WAR.Stop[x] == nil then
					WAR.Stop[x] = {}
				end
				WAR.Stop[x][y] = 1
			end
		--end
	end
	WAR.CurID = ii
end

--夜雨楼如影随形特效
Ct['遮影DH'] = function(i,flag)
	if flag == nil then 
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 5, -1)
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2, -1)
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 10, -1)
		WarDrawMap(0)

		local x0 = WAR.Person[WAR.CurID]["坐标X"]
		local y0 = WAR.Person[WAR.CurID]["坐标Y"]
		local dx = WAR.Person[i]["坐标X"] - x0
		local dy = WAR.Person[i]["坐标Y"] - y0
		local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		
		local id = WAR.Person[i]['人物编号']
		local tx = JY.Person[id]['头像代号'] + 101
		local tt = WAR.Person[i]["贴图"]
		local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100


		local txt = 1345
		for j = 0,240,12 do 
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.PicLoadCache(3,(txt)*2,rx,ry-hb,2,240-j,nil,0,0)
			lib.PicLoadCache(tx,tt,rx,ry-hb,2,240-j,nil,0,0)
			DrawString(-1, CC.ScreenH / 2 - hb, "遮影・无影无形", C_RED, CC.DefaultFont)
			txt = txt + 1
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	elseif flag == 1 then
		WarDrawMap(0)
		
		local x0 = WAR.Person[WAR.CurID]["坐标X"]
		local y0 = WAR.Person[WAR.CurID]["坐标Y"]
		local dx = WAR.Person[i]["坐标X"] - x0
		local dy = WAR.Person[i]["坐标Y"] - y0
		local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		
		local id = WAR.Person[i]['人物编号']
		local tx = JY.Person[id]['头像代号'] + 101
		local tt = WAR.Person[i]["贴图"]
		local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100

		WAR.PD['遮影'][id] = nil
		WAR.PD['潜影突袭'][id] = 1
		local txt = 1345
		for j = 0,240,12 do 
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.PicLoadCache(3,(txt)*2,rx,ry-hb,2,240-j,nil,0,0)
			lib.PicLoadCache(tx,tt,rx,ry-hb,2,j,nil,0,0)
			DrawString(-1, CC.ScreenH / 2 - hb, "遮影・潜影突袭", C_RED, CC.DefaultFont)
			txt = txt + 1
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
end

--夜雨楼如影随形特效
Ct['遮影DH2'] = function(i)
	if WAR.PD['遮影'][WAR.Person[i]['人物编号']] ~= nil then
		for j = 0, WAR.PersonNum-1 do
			local jj = WAR.Person[j]['人物编号']
			if WAR.PD['影随'][jj] ~= nil and WAR.PD['影随'][jj] == WAR.PD['遮影'][WAR.Person[i]['人物编号']] then
				WAR.PD['影随'][jj] = nil
			end
		end		
		PlayWavE(5)
		Cat('遮影DH',i,1)
		if WAR.Stop[WAR.Person[i]["坐标X"]] ~= nil and WAR.Stop[WAR.Person[i]["坐标X"]][WAR.Person[i]["坐标Y"]] ~= nil then
			WAR.Stop[WAR.Person[i]["坐标X"]][WAR.Person[i]["坐标Y"]] = nil
		end
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2, i)
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 5, WAR.Person[i]["贴图"])
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 10, JY.Person[WAR.Person[i]["人物编号"]]['头像代号'])
		Cat('实时特效动画')
		WarDrawMap(0)
		Cat('实时特效动画2')
		ShowScreen()
		lib.Delay(CC.BattleDelay)
	end
end

--踏雪无痕被打时的遁地特效
Ct['雪遁'] = function(i)
	local ii = WAR.CurID
	local pid = WAR.Person[WAR.CurID]['人物编号']
	
	if WAR.Person[i]['死亡'] == false then
		local eid = WAR.Person[i]['人物编号']
		--if match_ID() then
			local x,y = WAR.Person[i]['坐标X'], WAR.Person[i]['坐标Y']
			if WAR.PD['雪遁'][eid] == nil then
				PlayWavE(5)
				WAR.CurID = i
				WarDrawMap(0)
				Cat('雪遁DH',WAR.CurID,ii)
				WAR.PD['雪遁'][eid] = pid
				--WAR.PD['影随'][pid] = pid
				if WAR.Stop[x] == nil then
					WAR.Stop[x] = {}
				end
				WAR.Stop[x][y] = 1
			end
		--end
	end
	WAR.CurID = ii
end

--夜雨楼如影随形特效
Ct['雪遁DH'] = function(i,flag,ii)
	if flag == nil then 
		WarDrawMap(0)
		local x0 = WAR.Person[WAR.CurID]["坐标X"]
		local y0 = WAR.Person[WAR.CurID]["坐标Y"]
		local dx = WAR.Person[i]["坐标X"] - x0
		local dy = WAR.Person[i]["坐标Y"] - y0
		local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		local id = WAR.Person[i]['人物编号']
		local tx = JY.Person[id]['头像代号'] + 101
		local tt = WAR.Person[i]["贴图"]
		local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100
		local txt = 1345
		for j = 0,240,12 do 
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.PicLoadCache(3,(txt)*2,rx,ry-hb,2,240-j,nil,0,0)
			lib.PicLoadCache(tx,tt,rx,ry-hb,2,240-j,nil,0,0)
			DrawString(-1, CC.ScreenH / 2 - hb, "风雪漫天・潜影无痕", C_RED, CC.DefaultFont)
			txt = txt + 1
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 5, -1)
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2, -1)
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 10, -1)
		local tsg = {}
		for n = 0, WAR.PersonNum -1 do
			if dead(n) == false and DWPD(i,n) and n ~= ii then
				tsg[#tsg+1] = n
			end
		end
		if #tsg > 0 then
			local nn = tsg[math.random[#tsg]]
			local wx,wy = WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] 
			local nnx,nny = WAR.Person[nnx]['坐标X'],WAR.Person[nnx]['坐标Y']
			SetWarMap(nnx, xxy, 5, -1)
			SetWarMap(nnx, xxy, 2, -1)
			SetWarMap(nnx, xxy, 10, -1)
			WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] = nnx,nny
			WAR.Person[nnx]['坐标X'],WAR.Person[nnx]['坐标Y'] = wx,wy
			SetWarMap(WAR.Person[nn]["坐标X"], WAR.Person[nn]["坐标Y"], 2, nn)
			SetWarMap(WAR.Person[nn]["坐标X"], WAR.Person[nn]["坐标Y"], 5, WAR.Person[nn]["贴图"])
			SetWarMap(WAR.Person[nn]["坐标X"], WAR.Person[nn]["坐标Y"], 10, JY.Person[WAR.Person[nn]["人物编号"]]['头像代号'])
			SetWarMap(WAR.Person[nn]["坐标X"], WAR.Person[nn]["坐标Y"],4, 1)
		else
			ztd(WAR.CurID,'生命点数',math.modf(psx('生命最大值')*0.1))
		end	
	elseif flag == 1 then
		WarDrawMap(0)
		local x0 = WAR.Person[WAR.CurID]["坐标X"]
		local y0 = WAR.Person[WAR.CurID]["坐标Y"]
		local dx = WAR.Person[i]["坐标X"] - x0
		local dy = WAR.Person[i]["坐标Y"] - y0
		local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
		local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2
		
		local id = WAR.Person[i]['人物编号']
		local tx = JY.Person[id]['头像代号'] + 101
		local tt = WAR.Person[i]["贴图"]
		local hb = GetS(JY.SubScene, dx + x0, dy + y0, 4)*CONFIG.Zoom/100

		WAR.PD['遮影'][id] = nil
		WAR.PD['潜影突袭'][id] = 1
		local txt = 1345
		for j = 0,240,12 do 
			Cat('实时特效动画')
			Cls()
			Cat('实时特效动画2')
			lib.PicLoadCache(3,(txt)*2,rx,ry-hb,2,240-j,nil,0,0)
			lib.PicLoadCache(tx,tt,rx,ry-hb,2,j,nil,0,0)
			DrawString(-1, CC.ScreenH / 2 - hb, "遮影・潜影突袭", C_RED, CC.DefaultFont)
			txt = txt + 1
			ShowScreen()
			lib.Delay(CC.BattleDelay)
		end
	end
end

--夜雨楼如影随形特效
Ct['雪遁DH2'] = function(i)
	if WAR.PD['雪遁'][WAR.Person[i]['人物编号']] ~= nil then		
		PlayWavE(5)
		WAR.PD['雪遁'][WAR.Person[i]['人物编号']] = nil
		--Cat('雪遁DH',i,1)
		if WAR.Stop[WAR.Person[i]["坐标X"]] ~= nil and WAR.Stop[WAR.Person[i]["坐标X"]][WAR.Person[i]["坐标Y"]] ~= nil then
			WAR.Stop[WAR.Person[i]["坐标X"]][WAR.Person[i]["坐标Y"]] = nil
		end
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 2, i)
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 5, WAR.Person[i]["贴图"])
		SetWarMap(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"], 10, JY.Person[WAR.Person[i]["人物编号"]]['头像代号'])
		Cat('实时特效动画')
		WarDrawMap(0)
		Cat('实时特效动画2')
		ShowScreen()
		lib.Delay(CC.BattleDelay)
	end
end

Ct['斗转'] = function(enemyid,wugong)
    local pid = WAR.Person[WAR.CurID]['人物编号']
    local eid = WAR.Person[enemyid]['人物编号']
    --斗转星移
    --50%几率发动，慕容复，慕容博必发动PersonKF(eid, 43)
    if MuRongDZ(eid) and JY.Person[eid]["体力"] > 10 and WAR.DZXY ~= 1 and WAR.Person[enemyid]["反击武功"] == -1 
	and WAR.Person[enemyid]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and psx(eid,"生命") > 0 then
        local gl = (JY.Person[eid]['资质'] - 50)
        if BNJQ(eid) then
            gl = gl + 20
        end
		if ZYBF(eid) then
			gl = gl + 30
        end
        if fjpd(WAR.CurID) == false and (Fjkx(WAR.CurID) ~= 2 or psx(eid,"门派技能3") == 2) 
		and (JLSD(0,gl,eid) or match_ID(eid,51) or match_ID(eid,113) or match_ID(eid,529) or match_ID(eid, 9882)) then
            local dzlv = math.modf(Xishu_sum(eid)/5)
            local dzwz = nil
            --兵器值之和大于等于360出离合参商
            --慕容复，慕容博，天罡必出
            if dzlv >= 360 or match_ID(eid,51) or match_ID(eid,529) or match_ID(eid,113) 
			or match_ID(eid, 9882) or actor(eid,6) or WAR.TZ_MRF == 1 then
                local hm = 0
				hm = 3
				if WAR.TZ_MRF == 1 then
					hm = 1
				end
                --兵器值之和超过550，有几率出幻梦星辰反击
                --几率为兵器值之和-550，上限50%几率
				if dzlv > 550 or match_ID(eid, 529) then
					local chance = limitX(dzlv - 550,0, 50)
					if JLSD(0,chance,eid) or match_ID(eid, 529) then
						if psx(eid,"门派技能3") == 2 or match_ID(eid, 529) then
							hm = 2
						else
						    hm = 1
						end
					end
				end
				if hm == 2 then
					dzwz = "耀若日星"
					WAR.DZXYLV[eid] = 6
				elseif hm == 1 then
                    dzwz = "幻梦星辰"
                    WAR.DZXYLV[eid] = 4
                else
                    dzwz = "离合参商"
                    WAR.DZXYLV[eid] = 3
                end
            --兵器值之和大于等于240出斗转星移
            elseif dzlv >= 240 then
                dzwz = "斗转星移"
                WAR.DZXYLV[eid] = 2
            --都不满足，则是北斗移辰
            else
                dzwz = "北斗移辰"
                WAR.DZXYLV[eid] = 1
            end
            Set_Eff_Text(enemyid, "特效文字2",dzwz,93)
            WAR.Person[enemyid]["反击武功"] = wugong
		end
    end
end

--[[function NewWARPersonZJ(id, dw, x, y, life, fx)
	WAR.Person[WAR.PersonNum]["人物编号"] = id
	WAR.Person[WAR.PersonNum]["我方"] = dw
	WAR.Person[WAR.PersonNum]["坐标X"] = x
	WAR.Person[WAR.PersonNum]["坐标Y"] = y
	WAR.Person[WAR.PersonNum]["死亡"] = life
	WAR.Person[WAR.PersonNum]["人方向"] = fx
	WAR.Person[WAR.PersonNum]["贴图"] = WarCalPersonPic(WAR.PersonNum)
	lib.PicLoadFile(string.format(CC.FightPicFile[1], JY.Person[id]["头像代号"]), string.format(CC.FightPicFile[2], JY.Person[id]["头像代号"]), 4 + WAR.PersonNum)
	WAR.tmp[5000+WAR.PersonNum] =  JY.Person[id]["头像代号"]
	WAR.JQSDXS[id] = 0
	SetWarMap(x, y, 2, WAR.PersonNum)
	SetWarMap(x, y, 5, WAR.Person[WAR.PersonNum]["贴图"])
	WAR.PersonNum = WAR.PersonNum + 1
	JY.Person[id]["受伤程度"] = 0
	JY.Person[id]["中毒程度"] = 0
	JY.Person[id]["冰封程度"] = 0
	JY.Person[id]["灼烧程度"] = 0
	WAR.FXXS[id]=0
	WAR.LXXS[id]=0
end]]

function hasthing(pp)
	return instruct_18(pp)
end

function War_MPMenu() --门派指令菜单
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local mptype = MPPD(pid)
	local mpdj = MPDJ(pid)
	local menu = {}
	for i = 1, #CC.SKILLNAME[mptype] do
		menu[i] = {CC.SKILLNAME[mptype][i], nil, 1}			
	end	
	--say("menu[i]"..menu[5][1],0,1)
	local aaa = false
	for i = 1, #menu do
		if menu[i][3] == 1 then
			aaa = true
		end
	end
	if not aaa then
		Cls()
		QZXS("没有目前可用的技能")
		return 0
	end
	local r
	DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY,"门派技能", C_WHITE, CC.DefaultFont);
	if mptype == 1 and mpdj >= 3 then --星宿指令
		if JY.Person[pid]["体力"] < 20 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 200 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			CleanWarMap(4, 0)
			DIYdisplay(menu[4][1])	
			for i = 0, WAR.PersonNum - 1 do				
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
					WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 3) then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)
					ztd(i,"中毒点数",math.random(20, 30))
					if JLSD(10, 45, pid) then
						WAR.LQZ[WAR.Person[i]["人物编号"]] = nil
					end
				end
			end			
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 80)	
			AddPersonAttrib(pid, "体力", -20)
			--return 1
		elseif r == 5 then			
			CleanWarMap(4, 0)
			DIYdisplay(menu[5][1])
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
					WAR.Person[i]["死亡"] == false and (WAR.Person[i]["人物编号"]) and WAR.PD['三笑逍遥散'][WAR.Person[i]["人物编号"]] == nil and RealJL(WAR.CurID, i, 3) then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)
					if JLSD(10, 40, pid) then						
						WAR.PD['三笑逍遥散'][WAR.Person[i]["人物编号"]] = 3
					end
				end
			end					
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 114)	
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -200)				
			--return 1
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 2 and mpdj >= 2 then --丐帮指令
		-- for i = 1, #CC.ASKILL[mptype] do
			-- menu[i] = {CC.ASKILL[mptype][i], nil, 1}			
		-- end
		if JY.Person[pid]["体力"] < 15 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 30 then
			menu[5][3] = 0
		end		
		if JY.Person[pid]["体力"] < 15 or WAR.PD['醉八仙'][pid] ~= nil then
			menu[6][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then	
			CleanWarMap(4, 0)
			DIYdisplay(menu[4][1])
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
					WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 1) then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)				
					WAR.PD['锁喉'][WAR.Person[i]["人物编号"]] = 50
				end
			end		
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 56)	
			AddPersonAttrib(pid, "体力", -15)
			WAR.PD['锁喉1'][pid] = 50
		elseif r == 5 then
			CleanWarMap(4, 0)
			DIYdisplay(menu[5][1])
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] == WAR.Person[WAR.CurID]["我方"] and 
					WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 1) then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 4)	
					AddPersonAttrib(WAR.Person[i]["人物编号"], "受伤程度", -100)	
				end
			end		
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 93)	
			AddPersonAttrib(pid, "体力", -30)
		elseif r == 6 then
			local jiu = -1 
			for i = 22, 25 do
				if hasthing(i) then
					jiu = i
					break
				end
			end
			if jiu == -1 then
				Cls()
				QZXS("没有酒了！")
				return 0
			else
				Cat('遮影DH2',WAR.CurID)
				addthing(jiu, -1, 1)
				--CurIDTXDH(WAR.CurID,98, 1, menu[3][1])
				DIYdisplay("逍遥吾命")
				lib.Delay(50)
				DIYdisplay("一醉沧然")
				CurIDTXDH(WAR.CurID, 80, 1, "醉・八仙", LightSkyBlue)
				lib.Delay(50)
						--WAR.CurID = s
				JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 15
				addbuff(pid,WAR.PD['醉八仙'],9)
				if WAR.PD['微醺'][pid] ~= nil then
					WAR.PD['微醺'][pid] = nil
				end	
			end
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 3 and mpdj >= 2 then --古墓指令
		if JY.Person[pid]["体力"] < 20 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 25 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			CleanWarMap(4, 0)
			DIYdisplay(menu[4][1])
			for i = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[i]["人物编号"]
				if WAR.Person[i]["死亡"] == false then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)	
					if WAR.LQZ[tmppid] ~= nil then
						WAR.LQZ[tmppid] = math.modf(WAR.LQZ[tmppid] * 0.5)
					end
				end
			end		
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 63)	
			AddPersonAttrib(pid, "体力", -20)				
		elseif r == 5 then
			CleanWarMap(4, 0)
			local tmpcount = 0
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					tmpcount = tmpcount + 1
				end
			end			
			if tmpcount < 2 then
				Cls()
				QZXS("没有可被魅惑的敌人！")	
				return 0
			end
			local nx, ny, victim, victimid = selectPerson(5, 1)
			if nx == -1 then
				return 0
			end
			DIYdisplay(menu[5][1])
			SetWarMap(nx, ny, 4, 2)
			War_ShowFight(pid,0,0,0,nx,ny,0);	
			local jilv = 50
			if JLSD(10, 10 + jilv, pid) then
				WAR.Person[victim]["我方"] = WAR.Person[WAR.CurID]["我方"] 
				WAR.PD["魅惑状态"][victimid] = 3	
				QZXS(JY.Person[victimid]["姓名"].."被魅惑！")					
			else
				QZXS(JY.Person[victimid]["姓名"].."魅惑失败！")		
			end
			SetWarMap(nx, ny, 4, -1)			
			AddPersonAttrib(pid, "体力", -25)	
		end
		if r > 3 then
			return 1
		end		
	elseif mptype == 4 and mpdj >= 2 then --武当指令
		if JY.Person[pid]["体力"] < 25 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 500 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			CleanWarMap(4, 0)
			local nx, ny, victim, victimid = selectPerson(4, 1)
			if nx == -1 then
				return 0
			end
			SetWarMap(nx, ny, 4, 2)
			War_ShowFight(pid,0,0,0,nx,ny,21);	
			SetWarMap(nx, ny, 4, -1)			
			AddPersonAttrib(pid, "体力", -25)	
			if WAR.LQZ[victimid] ~= nil then
				WAR.LQZ[victimid] = math.modf(WAR.LQZ[victimid] * 0.5)
			end
			WAR.LQZ[pid] = nil
			if WAR.PD['集气速度'][victimid] == nil then
				WAR.PD['集气速度'][victimid] = -15
			else
				WAR.PD['集气速度'][victimid] = WAR.PD['集气速度'][victimid] - 10
			end
		elseif r == 5 then
			Cat('遮影DH2',WAR.CurID)
			CleanWarMap(4, 0)
			CurIDTXDH(WAR.CurID,101, 1, CC.ASKILL[mptype][r])
			--DHdisplay(298, 306, CC.ASKILL[mptype][r])
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -500)
			WAR.PD['以静制动1'][pid] = 10
			WAR.Defup[pid] = 1			
		end
		if r > 3 then
			return 1
		end		
	elseif mptype == 5 and mpdj >= 2 then --少林指令
		if JY.Person[pid]["体力"] < 25 or JY.Person[pid]["品德"] < 50 or JY.Person[pid]["内力"] < math.modf(JY.Person[pid]["内力最大值"]*0.4) then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			menu[5][3] = 0
		end
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 3000 then
			menu[6][3] = 0
		end		
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			CleanWarMap(4, 0)
			local tmpcount = 0
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == false then
					tmpcount = tmpcount + 1
				end
			end			
			if tmpcount < 2 then
				Cls()
				QZXS("只剩一个敌人的时候无法使用")	
				return 0
			end
			local nx, ny, victim, victimid = selectPerson(4, 1)
			if nx == -1 then
				return 0
			end
			if MPPD(victimid) == 5 or JY.Person[victimid]["生命"] > math.modf(JY.Person[victimid]["生命最大值"]/2) then
			Cls()
			QZXS("目标不可被点化") 
			   return 0
			else
			Cls()
			say("放下屠刀，立地成佛！",pid,0,JY.Person[pid]["姓名"]) 		
			SetWarMap(nx, ny, 4, 2)
			War_ShowFight(pid,0,0,0,nx,ny,104);	
			local jc = math.modf(JY.Person[pid]["品德"] * 0.3)
			local jilv = math.modf(((JY.Person[pid]["品德"]) - 50) / 5) + 14
			if JLSD(10, 16 + jilv + jc, pid) then
				QZXS(JY.Person[victimid]["姓名"].."退场！")
				WAR.Person[victim]["死亡"] = true
				lib.SetWarMap(nx, ny, 5, -1)
				lib.SetWarMap(nx, ny, 2, -1)					
			else
				QZXS(JY.Person[victimid]["姓名"].."点化失败！")		
			end
			SetWarMap(nx, ny, 4, -1)			
			AddPersonAttrib(pid, "体力", -25)
			AddPersonAttrib(pid, "内力", -math.modf(JY.Person[pid]["内力"]*0.5))
			end
		elseif r == 5 then
			Cat('遮影DH2',WAR.CurID)
			CleanWarMap(4, 0)
			--CurIDTXDH(WAR.CurID,98, 1, menu[3][1])
			CurIDTXDH(WAR.CurID,136, 1, CC.ASKILL[5][2])
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -200)
			WAR.PD['金刚不坏'][pid] = 1			
		elseif r == 6 then
			Cls()
			say("苦--海--无--边--回--头--是--岸-----",pid,0,JY.Person[pid]["姓名"]) 		
			local sq = math.modf(JY.Person[pid]["内力"] / 15)
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["死亡"] == false and WAR.Person[e]["我方"] ~= WAR.Person[WAR.CurID]["我方"]
					and JY.Person[pid]["内力"] > JY.Person[tmppid]["内力"] then
					--WAR.Person[e].TimeAdd = WAR.Person[e].TimeAdd - 1000
					ztd(e,'集气位置',-1000)
				end
			end		
			DrawTimeBar2()
			AddPersonAttrib(pid, "体力", -30)
			AddPersonAttrib(pid, "内力", -math.modf(JY.Person[pid]["内力"] / 2))
		end
		if r > 3 then
			return 1
		else
			return 0
		end		
	elseif mptype == 6 and mpdj >= 2 then --密宗指令
		if JY.Person[pid]["体力"] < 15 or WAR.PD['血魔'][pid] ~= nil or
			JY.Person[pid]["生命"] < math.modf(JY.Person[pid]["生命最大值"] * 0.5) then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 25 or WAR.PD['换血'][pid] ~= nil or
			JY.Person[pid]["生命"] > math.modf(JY.Person[pid]["生命最大值"] * 0.5) then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			Cat('遮影DH2',WAR.CurID)
			CleanWarMap(4, 0)
			CurIDTXDH(WAR.CurID,89, 1, CC.ASKILL[6][1])
			AddPersonAttrib(pid, "体力", -15)
			addbuff(pid,WAR.PD['血魔'],1)
			WAR.LQZ[pid] = 100
		elseif r == 5 then	
			CleanWarMap(4, 0)
			local nx, ny, victim, victimid = selectPerson(4, 1)
			if nx == -1 then
				return 0
			end
			Cls()
			SetWarMap(nx, ny, 4, 2)
			DIYdisplay(CC.ASKILL[6][2])
			War_ShowFight(pid,0,0,0,nx,ny,98);	
			QZXS(JY.Person[victimid]["姓名"].."与"..JY.Person[pid]["姓名"].."血量交换")		
			SetWarMap(nx, ny, 4, -1)			
			AddPersonAttrib(pid, "体力", -25)	
			local tmpratio1 = JY.Person[pid]["生命"] / JY.Person[pid]["生命最大值"]
			local tmpratio2 = JY.Person[victimid]["生命"] / JY.Person[victimid]["生命最大值"]
			JY.Person[pid]["生命"] = math.modf(tmpratio2 * JY.Person[pid]["生命最大值"])
			JY.Person[victimid]["生命"] = math.modf(tmpratio1 * JY.Person[victimid]["生命最大值"])
			if JY.Person[pid]["生命"] < 1 then JY.Person[pid]["生命"] = 1 end
			if JY.Person[victimid]["生命"] < 1 then JY.Person[victimid]["生命"] = 1 end			
			addbuff(pid,WAR.PD['换血'],1)
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 7 and mpdj >= 2 then --逍遥指令
		if JY.Person[pid]["体力"] < 15 or JY.Person[pid]["内力"] < 300 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or WAR.PD['凌波微步闪避'][pid] ~= nil then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		
		r = MenPaJN(menu)
		if r == 4 then
			Cls()		
			Cat('遮影DH2',WAR.CurID)
			for i = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[i]["人物编号"]
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					addbuff(tmppid,WAR.PD['恐惧状态'],1)
				end
			end
			CurIDTXDH(WAR.CurID,137, 1, "唯不争・故天下莫能与之争")
			AddPersonAttrib(pid, "体力", -15)
			AddPersonAttrib(pid, "内力", -300)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
			AddPersonAttrib(pid, "受伤程度", -100)
			AddPersonAttrib(pid, "中毒程度", -100)
			addbuff(pid,WAR.PD['凌波微步闪避'],3)
			addbuff(pid,WAR.PD['神足护盾'],1000,2000)
			CurIDTXDH(WAR.CurID,145, 1, "休迅飞凫・飘忽若神")
			AddPersonAttrib(pid, "体力", -20)
		elseif r == 6 then
			if JY.Person[pid]["体力"] > 20  then
				War_CalMoveStep(WAR.CurID, 10, 2)
				local x,y = War_SelectMove()
				if not x then
					return 0
				end
				if GetWarMap(x, y, 1) > 0 or GetWarMap(x, y, 2) > 0 or GetWarMap(x, y, 5) > 0 or CC.WarWater[GetWarMap(x, y, 0)] ~= nil then
					return 0
				else
					CurIDTXDH(WAR.CurID, 25,1, "真・白虹", Violet);
					WAR.Person[WAR.CurID]["移动步数"] = 10
					War_MovePerson(x, y, 1)
					WAR.Person[WAR.CurID]["移动步数"] = 0
					JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 10
				end
			else
				DrawStrBoxWaitKey("未满足发动条件", C_WHITE, CC.DefaultFont)
				return 0
			end	
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 8 and mpdj >= 2 then --白驼指令 武骧金星：实装白驼山指令
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 300 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			Cls()		
			Cat('遮影DH2',WAR.CurID)
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["我方"] then
					if WAR.PD['万毒归元'][pid] == nil then
						WAR.PD['万毒归元'][pid] = JY.Person[tmppid]["中毒程度"]
					else
						WAR.PD['万毒归元'][pid] = WAR.PD['万毒归元'][pid] + JY.Person[tmppid]["中毒程度"]
					end					
					JY.Person[tmppid]["中毒程度"] = 0
				end
			end		
			CurIDTXDH(WAR.CurID,89, 1, "白驼山秘技・万毒归元")
			AddPersonAttrib(pid, "体力", -30)
			AddPersonAttrib(pid, "内力", -300)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
			War_ActupMenu()
			War_DefupMenu()
			if WAR.tmp[200 + pid] == nil or WAR.tmp[200 + pid] == 0 then
				WAR.tmp[200 + pid] = 50;
			else
				WAR.tmp[200 + pid] = WAR.tmp[200 + pid] + 35;
			end
			AddPersonAttrib(pid, "体力", -20)
		end
		if r > 3 then
			return 1
		end
	elseif mptype == 9 then --唐门指令
	    local num = 0
		local list = {}
		for i = 0, WAR.PersonNum - 1 do
			local wid = WAR.Person[i]["人物编号"]
			if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false 
				and RealJL(WAR.CurID, i, 10) then
				num = num + 1
				list[num] = {wid, WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"]}
			end
		end					
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);	
		r =MenPaJN(menu)
		if r == 1 then
			if JY.Person[pid]["内力"] < 5000 or JY.Person[pid]["体力"] < 50 then -- 
				QZXS("不满足发动条件！")
			elseif num == 0  then
				QZXS("范围内没有敌人！")
			else		
				Cat('遮影DH2',WAR.CurID)
				AddPersonAttrib(pid, "体力", -25)
				AddPersonAttrib(pid, "内力", -1000)
				for j = 1, 10 do
					local victim = math.random(#list)
					local anqi = randomanqi()
					War_ExecuteMenu_Sub(list[victim][2], list[victim][3], 4, anqi)
					num = 0
					list = {}
					for i = 0, WAR.PersonNum - 1 do
						local wid = WAR.Person[i]["人物编号"]
						if WAR.Person[i]["我方"] == false and WAR.Person[i]["死亡"] == false 
							and JY.Person[wid]["生命"] > 0 and RealJL(WAR.CurID, i, 10) then
							num = num + 1
							list[num] = {wid, WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"]}
						end
					end				
					if num == 0 then
						break
					end
				end
				return 1
			end	
		elseif r == 2 then
            if WAR.TMMS[pid] == 1 then 	
                WAR.TMMS[pid] = 2 
			    QZXS("切换为天罗诡道！")	
            else 
                WAR.TMMS[pid] = 1
			    QZXS("切换为惊羽决！")
            end			
		end					
	elseif mptype == 10 and mpdj >= 2 then --桃花岛指令
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 300 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or WAR.BHHJ ~= 0 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 3 then
			Cls()		
			Cat('遮影DH2',WAR.CurID)
			local wg = JYMsgBox("桃花武学", "请选择切换武学。", {"弹指", "玉萧", "落英"}, 3, JY.Person[pid]["半身像"],1)
			if wg == 1 then
				JY.Person[pid]["武功1"] = 18
			elseif wg == 2 then
			    JY.Person[pid]["武功1"] = 38
			elseif wg == 3 then
			    JY.Person[pid]["武功1"] = 12
			end
			Cat('武功')
		elseif r == 4 then
			Cls()		
			Cat('遮影DH2',WAR.CurID)
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["我方"] then
					if WAR.PD['九花玉露'][pid] == nil then
						WAR.PD['九花玉露'][pid] = JY.Person[tmppid]["受伤程度"]
					else
						WAR.PD['九花玉露'][pid] = WAR.PD['九花玉露'][pid] + JY.Person[tmppid]["受伤程度"]
					end					
					JY.Person[tmppid]["受伤程度"] = 0
				end
			end		
			CurIDTXDH(WAR.CurID,78, 1, "桃花岛秘药・九花玉露")
			AddPersonAttrib(pid, "体力", -30)
			AddPersonAttrib(pid, "内力", -300)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
			WAR.BHHJ = 3
			CurIDTXDH(WAR.CurID,45, 1, "桃花阵图・碧海幻境")
			AddPersonAttrib(pid, "体力", -20)
		end
		if r > 2 then
			return 1
		end
	elseif mptype == 11 then --一刀流指令
		if JY.Person[pid]["体力"] < 15 then
			menu[4][3] = 0
		end 
		if JY.Person[pid]["体力"] < 25 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 1 then
			Cat('遮影DH2',WAR.CurID)
			CurIDTXDH(WAR.CurID,25, 1, "秘剑・切返")
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 15
			for i = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[i]["人物编号"]
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
				    AddPersonAttrib(tmppid, "受伤程度", -100)
					AddPersonAttrib(tmppid, "中毒程度", -100)
				end
			end
	    elseif r == 2 then
			Cat('遮影DH2',WAR.CurID)
			CurIDTXDH(WAR.CurID,35, 1, "斩流・切返")
			JY.Person[pid]["体力"] = JY.Person[pid]["体力"] - 20
			for i = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[i]["人物编号"]
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					AddPersonAttrib(tmppid, "体力", 30)
				end
			end
		end
		if r > 3 then
			return 1
		end		
	elseif mptype == 12 and mpdj >= 3 then --日月神教指令
		if JY.Person[pid]["体力"] < 25 or WAR.SSNSD < 1 then
			menu[4][3] = 0
		end 
		if JY.Person[pid]["体力"] < 25 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)	
			if r == 4 then
				if JY.Person[pid]["体力"] > 25 and WAR.SSNSD == 1 then
					local nx, ny, victim, victimid = selectPerson(8, 1)
					if nx == -1 then
						return 0
					end
					CleanWarMap(4, 0)
					SetWarMap(WAR.Person[victim]["坐标X"],WAR.Person[victim]["坐标Y"], 4, 2)
					QZXS("嘿嘿，哈哈哈哈，尝尝本教的三尸脑神丹吧！")
					WAR.PD["三尸脑神丹"][victimid] = 50
					War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 145)	
					WAR.SSNSD = WAR.SSNSD - 1
				else
					DrawStrBoxWaitKey("条件不符，不可使用", C_WHITE, 30)
					return 0
				end
				AddPersonAttrib(pid, "体力", -25)
			    --[[CleanWarMap(4, 0)
			    local tmpcount = 0
			    for i = 0, WAR.PersonNum - 1 do
				    if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					    tmpcount = tmpcount + 1
				    end
			    end			
			    if tmpcount < 2 then
				    Cls()
				    QZXS("没有可被魅惑的敌人！")	
				    return 0
			    end
			    local nx, ny, victim, victimid = selectPerson(5, 1)
			    if nx == -1 then
				    return 0
			    end
			    DIYdisplay(menu[5][1])
			    SetWarMap(nx, ny, 4, 2)
			    War_ShowFight(pid,0,0,0,nx,ny,0);	
			    local jilv = 30
			    if JLSD(10, 10 + jilv, pid) then
				    WAR.Person[victim]["我方"] = WAR.Person[WAR.CurID]["我方"] 
				    WAR.PD["度化状态"][victimid] = 5	
				    QZXS(JY.Person[victimid]["姓名"].."被魅惑！")					
			    else
				    QZXS(JY.Person[victimid]["姓名"].."魅惑失败！")		
			    end
			    SetWarMap(nx, ny, 4, -1)			
			    AddPersonAttrib(pid, "体力", -25)--]]
		    elseif r == 5 then
				CurIDTXDH(WAR.CurID,97, 1,"逆杀")
				CleanWarMap(4, 0)
				local x1 = WAR.Person[WAR.CurID]["坐标X"];
			    local y1 = WAR.Person[WAR.CurID]["坐标Y"];
			    for ex = x1 - 5, x1 + 5 do
				    for ey = y1 - 5, y1 + 5 do
					    SetWarMap(ex, ey, 4, 1)
					    if GetWarMap(ex, ey, 2) ~= nil and GetWarMap(ex, ey, 2) > -1 then
						    local ep = GetWarMap(ex, ey, 2)
						    if WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[ep]["我方"] then
							    JY.Person[WAR.Person[ep]["人物编号"]]["流血程度"] = 100
                                WAR.PD['神教逆杀'][WAR.Person[ep]["人物编号"]] = 10
							    SetWarMap(ex, ey, 4, 4)
						    end
					    end
				    end
			    end
			    War_ShowFight(pid,0,0,0,x1,y1,30);
				AddPersonAttrib(pid, "体力", -25)
			end	
		if r > 3 then
			return 1
		end	
	elseif mptype == 13 and mpdj >= 2 then --明教指令
		if JY.Person[pid]["体力"] < 50 then
			menu[4][3] = 0
		end 
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 500 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)	
			if r == 4 then
			    if (WAR.LQZ[pid] == nil or WAR.LQZ[pid] < 100) and JY.Person[pid]["生命"]>=math.modf(JY.Person[pid]["生命最大值"]*0.25) then
					DrawStrBoxWaitKey("条件不符，不可使用", C_WHITE, 30)
					return 0
			    end
				WAR.LQZ[pid] = nil
				WAR.PD["明教指令3"][pid] = JY.Person[pid]["内力"]
				WAR.PD["明教指令3"][pid] = 150 + math.modf(WAR.PD["明教指令3"][pid] / 10) 
				WAR.PD["明教指令3"][pid] = math.modf(WAR.PD["明教指令3"][pid] * (3-JY.Person[pid]["生命"]/JY.Person[pid]["生命最大值"]))
				for i = 86, 1 do
					CurIDTXDH(WAR.CurID, i, i, "怜我世人・忧患实多");		--动画显示	
					lib.Delay(10)
				end						
				WAR.PD["明教指令1"][pid] = 1
				WAR.PD["明教指令2"][pid] = 1
				local nx, ny, victim, victimid = selectPerson(7, 1)
				if nx == -1 then
					return 0
				end
				CleanWarMap(4, 0)
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
						WAR.Person[i]["死亡"] == false and RealJL(victim, i, 3) then
						SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)
						ztd(i,'生命点数',-WAR.PD["明教指令3"][pid])
						ztd(i,WAR.ZSXS,math.modf(WAR.PD["明教指令3"][pid]/100))
						ztd(i,'内伤点数',math.modf(WAR.PD["明教指令3"][pid]/100))
					end
				end		
				for i = 0, WAR.PersonNum - 1 do
					if WAR.Person[i]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
						local bid = WAR.Person[i]["人物编号"]
						if JLSD(10,30,bid) or (Curr_QG(pid,195) and MPPD(bid) == 13 and JLSD(10,30,bid)) then
							WAR.LQZ[bid] = 100
						end
					end
				end	
				War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 111)	
				for i = 21, 1 do
					CurIDTXDH(WAR.CurID, i, i, "喜乐悲愁・皆归尘土");		--动画显示	
				    lib.Delay(10)
				end							
				WAR.PD["明教指令1"][pid] = 0
				WAR.PD["明教指令2"][pid] = 0
				--JY.Person[pid]["生命"] = 0
				--WAR.Person[WAR.CurID]["死亡"] = true
                JY.Person[pid]["内力"] = 0
				JY.Person[pid]["生命"] = 1
                AddPersonAttrib(pid, "体力", -25)
                AddPersonAttrib(pid, "受伤程度", 100)
				
		    elseif r == 5 then
				if JY.Person[pid]["体力"] > 25 and WAR.MJCJ > 0 then
					local nx, ny, victim, victimid = selectPerson(7, 1)
					if nx == -1 then
						return 0
					end
					CleanWarMap(4, 0)
					SetWarMap(WAR.Person[victim]["坐标X"],WAR.Person[victim]["坐标Y"], 4, 2)
					QZXS("我指认面前的敌人是光明的死敌，邪恶的帮凶！")
					WAR.PD["明教指令4"][victimid] = (WAR.PD["明教指令4"][victimid] or 0) + 1
					--WAR.LQZ[victimid] = 0
					War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 145)	
					AddPersonAttrib(pid, "体力", -20)
					WAR.MJCJ = WAR.MJCJ - 1						
				else
					DrawStrBoxWaitKey("条件不符，不可使用", C_WHITE, 30)
					return 0
				end
			end	
		if r > 3 then
			return 1
		end	
	elseif mptype == 14 and mpdj >= 2 then --五岳剑派技能
		if JY.Person[pid]["体力"] < 50 or JY.Person[pid]["内力"] < 500 then
			menu[4][3] = 0
		end 
		if JY.Person[pid]["体力"] < 25 or JY.Person[pid]["内力"] < 500 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)	
			if r == 4 then
				Cat('遮影DH2',WAR.CurID)
                for i = 12, 1 do
				    CurIDTXDH(WAR.CurID, i, i, "剑宗秘传・夺命连环三仙剑");		--动画显示	
				    lib.Delay(10)
			    end
			    WAR.SXJ = 1
			    Cat('武功')
				AddPersonAttrib(pid, "体力", -30)
			    AddPersonAttrib(pid, "内力", -1000)
                WAR.SXJ = 0				
		    elseif r == 5 then
				Cat('遮影DH2',WAR.CurID)
                --for i = 97, 1 do
				    CurIDTXDH(WAR.CurID, 97, 1, "寒冰秘法・冰封天下");		--动画显示	
				    lib.Delay(10)
			   -- end
			    WAR.BFTX = 1
			    Cat('武功')
	            AddPersonAttrib(pid, "内力", -1500) 
			    AddPersonAttrib(pid, "体力", -25)
			    WAR.BFTX = 0			
	        end	
		if r > 3 then
			return 1
		end		
	elseif mptype == 15 and mpdj >= 2 then --大理技能
		if JY.Person[pid]["体力"] < 25 or JY.Person[pid]["内力"] < 500 then
			menu[4][3] = 0
		end 
		if JY.Person[pid]["体力"] < 50 or JY.Person[pid]["内力"] < 2500 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)	
			if r == 4 then
				Cat('遮影DH2',WAR.CurID)
				local str = ""
				local a = 0
                if JLSD(10,30,pid) then
				    a = 1
				else
				    a = math.random(2,4)
                end
                local WZTS = {"残悔","新血愁","足三里","手三里"}
                str = WZTS[a]		   
			    for i = 21, 1 do
				    CurIDTXDH(WAR.CurID, i, i, "秘孔战术"..str);		--动画显示	
				    lib.Delay(10)
			    end
			    WAR.MKZS = a
			    Cat('武功')
			    AddPersonAttrib(pid, "体力", -30)
			    AddPersonAttrib(pid, "内力", -1000)
                WAR.MKZS = 0			
		    elseif r == 5 then
				Cat('遮影DH2',WAR.CurID)
                for i = 97, 1 do
				    CurIDTXDH(WAR.CurID, i, i, "天南大理・转龙呼吸法");		--动画显示	
				    lib.Delay(10)
			    end
				WAR.PD["转龙呼吸"][pid] = 3
			    WAR.PD["闪避"][pid] = 100
			    WAR.PD["集气速度"][pid] = 10	
	            AddPersonAttrib(pid, "内力", -2500) 
		        AddPersonAttrib(pid, "体力", -25)			
	        end	
		if r > 3 then
			return 1
		end		
	elseif mptype == 16 and mpdj >= 2 then --全真技能
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			menu[4][3] = 0
		end 
		if JY.Person[pid]["体力"] < 25 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)	
		if r == 4 then
			Cat('遮影DH2',WAR.CurID)
			for i = 51, 1 do
				CurIDTXDH(WAR.CurID, i, i, "重阳遗剑.真打一击");		--动画显示	
				lib.Delay(10)
			end
			if match_ID(pid, 129) then
	            nuqi(pid,100)
	            WAR.BDQS = 1
			end
			WAR.CYYJ  = 1
			Cat('武功')
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -1000)
            WAR.CYYJ = 0				
		elseif r == 5 then
			Cat('遮影DH2',WAR.CurID)
			local aa = math.modf(JY.Person[pid]["生命最大值"] - JY.Person[pid]["生命"])
			local bb = math.modf(JY.Person[pid]["内力"])
			    if bb > aa * 10 then
					DrawStrBoxWaitKey("条件不符，不可使用", C_WHITE, 30)
					return 0
			   end
            for i = 97, 1 do
				CurIDTXDH(WAR.CurID, i, i, "重阳秘法.气返先天");		--动画显示	
				lib.Delay(10)
			end
			if match_ID(pid, 129) then
				WAR.Person[WAR.CurID].Time = 1000
				nuqi(pid,100)
				WAR.BDQS = 1
			end
			JY.Person[pid]["内力"] = JY.Person[pid]["内力"] - aa * 10
			JY.Person[pid]["生命"] = JY.Person[pid]["生命最大值"]
			for i = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[i]["人物编号"]
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[WAR.CurID]["我方"] then
				    AddPersonAttrib(tmppid, "受伤程度", -100)
				end
			end
		    AddPersonAttrib(pid, "体力", -25)			
	    end	
		if r > 3 then
			return 1
		end	
	elseif mptype == 17 and mpdj >= 2 then --峨眉技能
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 500 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			Cls()
			Cat('遮影DH2',WAR.CurID)
			say("南--明--离--火--剑-----!!!",pid,0,JY.Person[pid]["姓名"]) 		
			local sq = math.modf(JY.Person[pid]["内力"] / 8)
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["死亡"] == false and WAR.Person[e]["我方"] ~= WAR.Person[WAR.CurID]["我方"]
					and JY.Person[pid]["内力"] > JY.Person[tmppid]["内力"] then
					--WAR.Person[e].TimeAdd = WAR.Person[e].TimeAdd - sq
					ztd(e,'集气位置',-sq)
				end
			end		
			DrawTimeBar2()
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -math.modf(JY.Person[pid]["内力"] / 2))
		elseif r == 5 then	
			Cls()		
			Cat('遮影DH2',WAR.CurID)
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["我方"] then
					if WAR.PD['九花玉露'][pid] == nil then
						WAR.PD['九花玉露'][pid] = JY.Person[tmppid]["受伤程度"]
					else
						WAR.PD['九花玉露'][pid] = WAR.PD['九花玉露'][pid] + JY.Person[tmppid]["受伤程度"]
					end					
					JY.Person[tmppid]["受伤程度"] = 0
				end
			end		
			CurIDTXDH(WAR.CurID,22, 1, "三阳归一")
			AddPersonAttrib(pid, "体力", -20)
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 18 and mpdj >= 2 then --崆峒指令
		if JY.Person[pid]["体力"] < 15 or JY.Person[pid]["内力"] < 1000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 2000 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			Cat('遮影DH2',WAR.CurID)
			for i = 24, 1 do
				CurIDTXDH(WAR.CurID, i, i, "分光两仪 阴柔共济");		--动画显示	
				lib.Delay(10)
			end	
			WAR.KTAY1 = 1
			Cat('武功')
			AddPersonAttrib(pid, "体力", -15)
			AddPersonAttrib(pid, "内力", -1000)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
			WAR.KTAY2 = 1
			Cls()		
			CurIDTXDH(WAR.CurID, 44, 1, "九天都录")
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -2000)
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 19 and mpdj >= 2 then --昆仑指令
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 2500 then
			menu[4][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			Cls()
			Cat('遮影DH2',WAR.CurID)
			say("身演两仪，敌若微尘！！",pid,0,JY.Person[pid]["姓名"]) 		
			WAR.PD["昆仑门派指令1"][pid] = 1
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -2500)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
			WAR.PD["昆仑门派指令2"][pid] = 50		
			CurIDTXDH(WAR.CurID,11, 1, "大静神")
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 20 and mpdj >= 2 then --雪羽宗指令
		if JY.Person[pid]["体力"] < 50 or JY.Person[pid]["内力"] < 2000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 30 or JY.Person[pid]["内力"] < 3000 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			-- for i = 24, 1 do
				-- CurIDTXDH(WAR.CurID, i, i, "雪漫天地 冰封千里");		--动画显示	
				-- lib.Delay(10)
			-- end	
			Cat('遮影DH2',WAR.CurID)
			CurIDTXDH(WAR.CurID,174, 1, "雪漫天地 冰封千里")
			--WAR.KTAY1 = 1
			--Cat('武功')
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["死亡"] == false and WAR.Person[e]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					WAR.PD["利刃寒锋"][tmppid] = (WAR.PD['利刃寒锋'][tmppid] or 0) + 10
					WAR.PD['冰冻状态'][tmppid] = (WAR.PD['冰冻状态'][tmppid] or 0) + 15
					ztd(e,"生命点数",-500)
					War_Show_Count(e)
					WAR.Person[e]["特效动画"] = 135
				end
			end
			
			
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -2000)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
			Cat('清除高级异常',WAR.CurID)
			WarDrawMap(0); --不加这条则动画位置无法正常显示
			CurIDTXDH(WAR.CurID, 174,1,"雪落无声.冰心诀",C_ORANGE);		
			WAR.BTZT[pid] = 1
			AddPersonAttrib(pid, "体力", -30)
			AddPersonAttrib(pid, "内力", -3000)
		end
		
		if r > 3 then
			return 1
		end
	elseif mptype == 21 then --花涧派指令
		r =MenPaJN(menu)
		
		
		
		
		
		
		
		if r > 5 then
			return 1
		end
	elseif mptype == 22 then --中华阁指令
		if JY.Person[pid]["内力"] < 1000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 2000 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		
		r = MenPaJN(menu)
		if r == 4 then
			Cat('遮影DH2',WAR.CurID)
			AddPersonAttrib(pid, "体力", 1)
			CurIDTXDH(WAR.CurID,88, 1, "苦尽甘来")
			AddPersonAttrib(pid, "内力", -1000)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
			AddPersonAttrib(pid, "生命", 200)
			CurIDTXDH(WAR.CurID,89, 1, "运筹帷幄")
			AddPersonAttrib(pid, "体力", -20)	
			AddPersonAttrib(pid, "内力", -2000)
		elseif r == 6 then
    	    if (WAR.SPIRIT[pid] == nil or WAR.SPIRIT[pid] < 150) and JY.Person[pid]["生命"] >= math.modf(JY.Person[pid]["生命最大值"] * 0.25) then
			    DrawStrBoxWaitKey("条件不符，不可使用", C_WHITE, 30)
				return 0
	        end
			zhanyi(pid,-WAR.SPIRIT[pid])
			WAR.PD["明教指令3"][pid] = JY.Person[pid]["内力"] * 3
			WAR.PD["明教指令3"][pid] = 200 + math.modf(WAR.PD["明教指令3"][pid] / 5) 
			WAR.PD["明教指令3"][pid] = math.modf(WAR.PD["明教指令3"][pid] * (3 - JY.Person[pid]["生命"] / JY.Person[pid]["生命最大值"]))
			for i = 86, 1 do
				CurIDTXDH(WAR.CurID, i, i, "中华傲诀・傲气中华");		--动画显示	
				lib.Delay(10)
			end						
			WAR.PD["明教指令1"][pid] = 1
			WAR.PD["明教指令2"][pid] = 1
			local nx, ny, victim, victimid = selectPerson(7, 1)
			if nx == -1 then
				return 0
			end
			CleanWarMap(4, 0)
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
					WAR.Person[i]["死亡"] == false and RealJL(victim, i, 3) then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)
					ztd(i,'生命点数',-WAR.PD["明教指令3"][pid])
					ztd(i,WAR.ZSXS,math.modf(WAR.PD["明教指令3"][pid]/100))
					ztd(i,'内伤点数',math.modf(WAR.PD["明教指令3"][pid]/100))
				end
			end		
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] == WAR.Person[WAR.CurID]["我方"] and WAR.Person[i]["死亡"] == false then
					local bid = WAR.Person[i]["人物编号"]
					if JLSD(10,30,bid) and MPPD(bid) == 22 then
						zhanyi(bid,(150-WAR.SPIRIT[bid]))
					end
				end
			end	
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 111)	
			for i = 21, 1 do
				CurIDTXDH(WAR.CurID, i, i, "中华傲诀・傲气中华");		--动画显示	
			    lib.Delay(10)
			end							
			WAR.PD["明教指令1"][pid] = 0
			WAR.PD["明教指令2"][pid] = 0
			--JY.Person[pid]["生命"] = 0
			--WAR.Person[WAR.CurID]["死亡"] = true
            JY.Person[pid]["内力"] = 0
			JY.Person[pid]["生命"] = 1
            AddPersonAttrib(pid, "体力", -25)
            AddPersonAttrib(pid, "受伤程度", 100)	
        elseif r == 7 then
		    Cat('遮影DH2',WAR.CurID)
		    if WAR.HLFS ~= 0 then
				DrawStrBoxWaitKey("已经制造过分身了", C_WHITE, 30)
				return 0
			end		
			if JY.Person[pid]["体力"] >= 10 and JY.Person[pid]["内力"] >= 2000 then
				say("镜花水月", 0, 1)  
				AddPersonAttrib(pid, "生命", -math.modf(JY.Person[pid]["生命"] * 0.01))
				AddPersonAttrib(pid, "内力", -math.modf(JY.Person[pid]["内力"] * 0.01))  
				AddPersonAttrib(pid, "体力", -math.modf(JY.Person[pid]["体力"] * 0.01))					
				local x, y = WE_xy(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] - 1)
				NewWARPersonZJ(pid, true, x, y, false, 2);
				WAR.HLFS = 1
				AddPersonAttrib(pid, "体力", -10)
			    AddPersonAttrib(pid, "内力", -2000)
			else
				return 0	
			end		
		elseif r == 8 then
			--QZXS("君问归期～未有期，巴山夜雨～涨秋池。")
			War_CalMoveStep(WAR.CurID, 15, 1)
			local nx, ny = nil, nil
			while true do
				nx, ny = War_SelectMove()
				if nx ~= nil then
					if lib.GetWarMap(nx, ny, 2) > 0 or lib.GetWarMap(nx, ny, 5) > 0 then
						QZXS("此处有人！请重新选择")			--此处有人！请重新选择
					elseif CC.SceneWater[lib.GetWarMap(nx, ny, 0)] ~= nil then
						QZXS("水面，不可进入！请重新选择")		--水面，不可进入！请重新选择
					else
						break;
					end
				end
			end
			Cat('遮影DH2',WAR.CurID)
			--PlayWavE(5)
			--CurIDTXDH(WAR.CurID, 88,1, "九阳明尊 挪移乾坤")		--九阳明尊 挪移乾坤
			local Ocur = WAR.CurID
			--WAR.CurID = nyp[r][4]
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 18,1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 18,1)
			WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 18,1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 18,1)
			WAR.CurID = Ocur
			--WAR.PD['夜雨涨秋池'][pid] = math.modf(MPDJ(pid)*10)
			ztd(WAR.CurID,'内力点数',-1500)
			ztd(WAR.CurID,'体力点数',-15)	
		elseif r == 9 then	
		    Cat('遮影DH2',WAR.CurID)	
			if JY.Person[pid]["体力"] >= 25 and JY.Person[pid]["内力"] >= 2500 then
			    local dxp = {}
			    local num = 1
			    for i = 0, WAR.PersonNum - 1 do 
				    if WAR.Person[i]["我方"] and WAR.Person[i]["死亡"] == false and i ~= WAR.CurID then
					    dxp[num] = {}
					    dxp[num][1] = JY.Person[WAR.Person[i]["人物编号"]]["姓名"] 
					    dxp[num][2] = nil
					    dxp[num][3] = 1
					    dxp[num][4] = i
					    num = num + 1
				    end
			    end
			    if num <= 1 then
				    DrawStrBoxWaitKey("场上没有可施展的目标", C_WHITE, 30)
				    return 0							
			    end
			    DrawStrBox(CC.MainMenuX, CC.MainMenuY, "请选择人物", C_GOLD, 30)
			    local r = ShowMenu(dxp, num - 1, 10, CC.MainMenuX, CC.MainMenuY + 45, 0, 0, 1, 0, CC.DefaultFont, C_RED, C_GOLD)
			    Cls()
			    local mid = WAR.Person[dxp[r][4]]["人物编号"] 
			    PlayWavE(28)
			    lib.Delay(10)
				say("偷天换日状态下集气提升至1000", 0, 1)
			    local Ocur = WAR.CurID
			    WAR.CurID = dxp[r][4] --选择的人物暂时变行动人物，战场动画移动
			    WarDrawMap(0)
			    PlayWavE(36)
			    lib.Delay(100)
			    WAR.CurID = Ocur
			    WarDrawMap(0)
			    WAR.Person[dxp[r][4]].Time = 1000
			    AddPersonAttrib(pid, "体力", -25)
			    AddPersonAttrib(pid, "内力", -2500)		
			end	
	    end
		if r > 3 then
			return 1
		end
		
	elseif mptype == 23 and mpdj >= 2 then --朝廷指令
		if JY.Person[pid]["体力"] < 10 or JY.Person[pid]["内力"] < 1000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 15 or JY.Person[pid]["内力"] < 1500 then
			menu[5][3] = 0
		end
		r = MenPaJN(menu)
		if r == 4 then
			Cat('遮影DH2',WAR.CurID)
			zhanyi(pid,200)
			CurIDTXDH(WAR.CurID,6, 1, "不屈")
			AddPersonAttrib(pid, "体力", -10)	
			AddPersonAttrib(pid, "内力", -1000)
		elseif r == 5 then	
			Cat('遮影DH2',WAR.CurID)
	        Cat('清除低级异常',WAR.CurID)
			WAR.PD['续战'][pid] = 20
			CurIDTXDH(WAR.CurID,19, 1, "续战")
			AddPersonAttrib(pid, "体力", -15)	
			AddPersonAttrib(pid, "内力", -1500)
	    end
		if r > 3 then
			return 1
		end
	elseif mptype == 24 then --夜雨楼
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 2000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]['生命'] < 2000  or JY.Person[pid]['内力'] < 2000 or  JY.Person[pid]['体力'] < 30 and WAR.PD["断命四绝句1"][pid] == nil then
			menu[5][3] = 0
		end	
		r = MenPaJN(menu)
		if r == 4 then
			QZXS("君问归期～未有期，巴山夜雨～涨秋池。")
			War_CalMoveStep(WAR.CurID, 15, 1)
			local nx, ny = nil, nil
			while true do
				nx, ny = War_SelectMove()
				if nx ~= nil then
					if lib.GetWarMap(nx, ny, 2) > 0 or lib.GetWarMap(nx, ny, 5) > 0 then
						QZXS("此处有人！请重新选择")			--此处有人！请重新选择
					elseif CC.SceneWater[lib.GetWarMap(nx, ny, 0)] ~= nil then
						QZXS("水面，不可进入！请重新选择")		--水面，不可进入！请重新选择
					else
						break;
					end
				end
			end
			Cat('遮影DH2',WAR.CurID)
			--PlayWavE(5)
			--CurIDTXDH(WAR.CurID, 88,1, "九阳明尊 挪移乾坤")		--九阳明尊 挪移乾坤
			local Ocur = WAR.CurID
			--WAR.CurID = nyp[r][4]
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 88,1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, -1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, -1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, -1)
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 88,1)
			WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] = nx, ny
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 88,1)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 5, WAR.Person[WAR.CurID]["贴图"])
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 2, WAR.CurID)
			SetWarMap(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"], 10, JY.Person[WAR.Person[WAR.CurID]["人物编号"]]['头像代号'])
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID, 88,1)
			WAR.CurID = Ocur
			WAR.PD['夜雨涨秋池'][pid] = math.modf(MPDJ(pid)*10)
			ztd(WAR.CurID,'内力点数',-2000)
			ztd(WAR.CurID,'体力点数',-20)
		elseif r == 5  then
			local nx, ny, victim, victimid = selectPerson(8, 1)
			if nx == -1 then
				return 0
			end
			Cat('遮影DH2',WAR.CurID)
			CleanWarMap(4, 0)
			SetWarMap(WAR.Person[victim]["坐标X"],WAR.Person[victim]["坐标Y"], 4, 2)
			QZXS("夜雨书名待四日，断命血满残楼时！")
			WAR.PD["断命四绝句"][victimid] = 0
			WAR.PD["断命四绝句1"][pid] = 1
			--WAR.LQZ[victimid] = 0
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 145)	
			ztd(WAR.CurID,'生命点数',-math.modf(JY.Person[pid]['生命']*0.7))
			ztd(WAR.CurID,'内力点数',-math.modf(JY.Person[pid]['内力']*0.7))
			ztd(WAR.CurID,'体力点数',-math.modf(JY.Person[pid]['体力']*0.7))			
	    end
		if r > 3 then
			return 1
		end
	elseif mptype == 25 then --护龙山庄
	    if JY.Person[pid]["体力"] < 15 or JY.Person[pid]["内力"] < 1500 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 2000 then
			menu[5][3] = 0
		end
		r = MenPaJN(menu)
		if r == 4 then	
		    Cat('遮影DH2',WAR.CurID)
			if JY.Person[pid]["体力"] >= 15 and JY.Person[pid]["内力"] >= 1500 then
				say("丹书铁券", 0, 1)				
				WAR.PD['时序闪避'][pid] = 30
				AddPersonAttrib(pid, "体力", -15)
				AddPersonAttrib(pid, "内力", -1500)								
			end
		elseif r == 5  then	
			Cat('遮影DH2',WAR.CurID)
			for i = 51, 1 do
				CurIDTXDH(WAR.CurID, i, i, "尚方宝剑");		--动画显示	
				lib.Delay(10)
			end
	        nuqi(pid,100)
			WAR.SFBJ = 1
			Cat('武功')
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -200)
            WAR.SFBJ = 0
		end
		if r > 3 then
			return 1
		end		
	elseif mptype == 26 and mpdj >= 3 then --云梦涧指令
		if JY.Person[pid]["体力"] < 90 or JY.Person[pid]["内力"] < 5000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 25 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			CleanWarMap(4, 0)
			local tmpcount = 0
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					tmpcount = tmpcount + 1
				end
			end			
			if tmpcount < 2 then
				Cls()
				QZXS("没有可被控心的敌人！")	
				return 0
			end
			local nx, ny, victim, victimid = selectPerson(5, 1)
			if nx == -1 then
				return 0
			end
			DIYdisplay(menu[5][1])
			SetWarMap(nx, ny, 4, 2)
			War_ShowFight(pid,0,0,0,nx,ny,0);	
			local jilv = mpdj * 10
			if JLSD(0,50+jilv,pid) then
				WAR.Person[victim]["我方"] = WAR.Person[WAR.CurID]["我方"] 
				WAR.PD["魔岭玫瑰"][victimid] = 30	
				QZXS(JY.Person[victimid]["姓名"].."被万道森罗所控")					
			else
				QZXS(JY.Person[victimid]["姓名"].."控心失败！")		
			end
			SetWarMap(nx, ny, 4, -1)			
			AddPersonAttrib(pid, "体力", -90)
			AddPersonAttrib(pid, "内力", -5000)				
		elseif r == 5 then
			if JY.Person[pid]["体力"] > 15 then
			    local fenshen_count = (WAR.YFS_COUNT[pid] or 0) 
				if fenshen_count >= 6 then
					DrawStrBoxWaitKey("已经为 "..JY.Person[pid]["姓名"].." 制造分身", C_WHITE, 30)
					return 0
				else				
					say("芸芸众神赞・飘飘仙子舞", pid) 
					if WAR.XIANSHU_COUNT_INONEACTION == 0 then
						AddPersonAttrib(pid, "体力", -15)
						AddPersonAttrib(pid, "内力", -1500)
					end
					local shadowCount = 1
					if JY.DIFF >= 5 then
						shadowCount = 3
					elseif JY.DIFF >= 3 then
						shadowCount = 2
					end
					local debug = false
					if debug then
						shadowCount = 6
					end
					local now_person_count = WAR.PersonNum - 1		-- 记录增加人之前的人数，一会循环用来从这个数以后遍历新的人
					for j = 1,shadowCount do
						local x, y = WE_xy(WAR.Person[WAR.CurID]["坐标X"], WAR.Person[WAR.CurID]["坐标Y"] - 1 -(j-1))
						NewWARPersonZJ(pid, true, x, y, false, 2);
						WAR.Person[WAR.PersonNum - 1].Time	= WAR.Person[WAR.CurID].Time
						WAR.Person[WAR.PersonNum - 1]["我方"] = true				--刚创建的是 WAR.Person[WAR.PersonNum - 1]
					end
					WAR.YFS_COUNT[pid] = (WAR.YFS_COUNT[pid] or 0) + shadowCount
					return 
				end
			end	
		end
		if r > 3 then
			return 1
		end
	elseif mptype == 27 and mpdj >= 2 then --兽王庄指令						
		if JY.Person[pid]["体力"] < 10 or JY.Person[pid]["内力"] < 1000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["生命"] < math.modf(JY.Person[pid]["生命最大值"]/2) then
			menu[5][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 2000 then
			menu[6][3] = 0
		end
		r =MenPaJN(menu)
		if r == 4 then
			AddPersonAttrib(pid, "体力", -10)
			AddPersonAttrib(pid, "内力", -1000)
		elseif r == 5 then
		    local sm = JY.Person[pid]["生命"]*0.75
			AddPersonAttrib(pid, "生命",-sm)	
			CurIDTXDH(WAR.CurID,115, 1, "残体化劲・狂兽沸血")
			WAR.PD['兽血沸腾'][pid] = sm
			Cat('武功')
		elseif r == 6 then
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -2000)
		end
		if r > 3 then
			return 1
		end
	elseif mptype == 28 and mpdj >= 2 then --青城指令
		if JY.Person[pid]["体力"] < 15 or JY.Person[pid]["内力"] < 1000 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 2000 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			Cat('遮影DH2',WAR.CurID)
			WAR.QCHP = 1
			CurIDTXDH(WAR.CurID,26, 1, "青城奥义・虎辟")
			AddPersonAttrib(pid, "体力", -20)
		elseif r == 5 then	
			Cls()
			Cat('遮影DH2',WAR.CurID)
			say("龙----------棘!!!",pid,0,JY.Person[pid]["姓名"]) 		
			local sq = math.modf(JY.Person[pid]["内力"] / 10)
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["死亡"] == false and WAR.Person[e]["我方"] ~= WAR.Person[WAR.CurID]["我方"]
					and JY.Person[pid]["内力"] > JY.Person[tmppid]["内力"] then
					ztd(e,'集气位置',-sq)
				end
			end		
			DrawTimeBar2()
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -2000)
		end
		if r > 3 then
			return 1
		end	
	elseif mptype == 29 and mpdj >= 2 then --五毒教指令
		if JY.Person[pid]["体力"] < 20 then
			menu[4][3] = 0
		end
		if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 200 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)
		if r == 4 then
			CleanWarMap(4, 0)
			DIYdisplay(menu[4][1])	
			for i = 0, WAR.PersonNum - 1 do				
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
					WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 3) then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)
					ztd(i,"中毒点数",1)
				end
			end			
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 80)	
			AddPersonAttrib(pid, "体力", -20)
		elseif r == 5 then			
			CleanWarMap(4, 0)
			DIYdisplay(menu[4][1])
			for i = 0, WAR.PersonNum - 1 do
				if WAR.Person[i]["我方"] ~= WAR.Person[WAR.CurID]["我方"] and 
					WAR.Person[i]["死亡"] == false and RealJL(WAR.CurID, i, 1) then
					SetWarMap(WAR.Person[i]["坐标X"],WAR.Person[i]["坐标Y"], 4, 2)				
					WAR.PD['利刃寒锋'][WAR.Person[i]["人物编号"]] = 20
				end
			end		
			War_ShowFight(pid, 0, 0, 0, WAR.Person[WAR.CurID]["坐标X"],WAR.Person[WAR.CurID]["坐标Y"], 56)	
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -200)				
			--return 1
		end
		if r > 3 then
			return 1
		end		
	elseif mptype == 30 and mpdj >= 2 then --天机宫指令	
	    if JY.Person[pid]["体力"] < 20 or JY.Person[pid]["内力"] < 1000 then
			menu[4][3] = 0
		end 
		if JY.Person[pid]["体力"] < 25 then
			menu[5][3] = 0
		end
		--r = ShowMenu(menu,#menu,0,CC.MainSubMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);
		r =MenPaJN(menu)	
		if r == 4 then
			Cat('遮影DH2',WAR.CurID)
			for i = 51, 1 do
				CurIDTXDH(WAR.CurID, i, i, "万法自然・天地之变");		--动画显示	
				lib.Delay(10)
			end
			WAR.TJGJ  = 1
			for e = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[e]["人物编号"]
				if WAR.Person[e]["死亡"] == false and WAR.Person[e]["我方"] ~= WAR.Person[WAR.CurID]["我方"] then
					ztd(e,'生命点数',-1500)
				end
			end		
			Cat('武功')
			AddPersonAttrib(pid, "体力", -20)
			AddPersonAttrib(pid, "内力", -1000)
            WAR.TJGJ = 0				
		elseif r == 5 then
			Cat('遮影DH2',WAR.CurID)
			local a = JY.Person[pid]["内力"]
			if a < 4000 then
				DrawStrBoxWaitKey("条件不符，不可使用", C_WHITE, 30)
				return 0
			end
            for i = 97, 1 do
				CurIDTXDH(WAR.CurID, i, i, "周流秘术・以气补虚");		--动画显示	
				lib.Delay(10)
			end
			WAR.Person[WAR.CurID].Time = 1000
			nuqi(pid,100)
            AddPersonAttrib(pid, "生命", 2000)	
			AddPersonAttrib(pid, "内力", -4000)
			for i = 0, WAR.PersonNum - 1 do
				local tmppid = WAR.Person[i]["人物编号"]
				if WAR.Person[i]["死亡"] == false and WAR.Person[i]["我方"] == WAR.Person[WAR.CurID]["我方"] then
				    AddPersonAttrib(tmppid, "受伤程度", -100)
					AddPersonAttrib(tmppid, "中毒程度", -100)
					AddPersonAttrib(tmppid, "冰封程度", -100)
					AddPersonAttrib(tmppid, "灼烧程度", -100)
					AddPersonAttrib(tmppid, "流血程度", -100)
					AddPersonAttrib(tmppid, "封穴程度", -100)
				end
			end
		    AddPersonAttrib(pid, "体力", -25)			
	    end	
		if r > 3 then
			return 1
		end	
	end 	 
end 


function DIYdisplay(str,strColor)
	if strColor == nil then
		strColor = C_GOLD
	end	
	for i=12,24 do
		NewDrawString(-1,-1,str,strColor,25+i)
		ShowScreen();
		if i==24 then
			Cls();							
			NewDrawString(-1,-1,str,strColor,25+i)
			ShowScreen();
			lib.Delay(500);
		else
			lib.Delay(1);
		end						
	end
end


function MenPaJN(menu1)
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	
	local pid = WAR.Person[WAR.CurID]["人物编号"]
	local mptype = MPPD(pid)
	local mpdj = MPDJ(pid)
	local numwugong = 0
	local kfmenu = {}
	local zs = {}
	
	-- for i = 1, JY.Base["武功数量"] do
		
	-- end
	
	
	--local menu = {}
	local tmp = 0
	-- for ai = 1, JY.Base["武功数量"] do
		-- tmp = JY.Person[pid]["武功"..ai]
	-- end
	-- for i = 1,#kfmenu do --查找kfmenu表
		-- if kfmenu[i][3] == 1 then  --如果表中第三项等于1则
			-- menu[#menu+1] = {kfmenu[i][1],i} -- menu表添加1个等于kfneu表中1项
		-- end
	-- end	
	-- for i = 1, #menu1 do
		-- menu[i] = {menu1[i], nil, 1}			
	-- end
	--menu = menu1
	local aaa = false
	for i = 1, #menu1 do
		if menu1[i][3] == 1 then
			aaa = true
		end
	end
	if not aaa then
		Cls()
		QZXS("没有目前可用的技能")
		return 0
	end
	
	
	if #menu1 == 0 then
		return 0
	end
	local num = 15
	if num > #menu1 then 
		num = #menu1 
	end	

	local size = CC.FontSmall--*0.95
	local cot = 1
	local cot1 = 0
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cat('实时特效动画')
		Cls()
		Cat('实时特效动画2')
		local yx=1
		for i = 1,num do 
			--lib.LoadPNG(91, 64 * 2 ,bx, by*417, 1,0,63)
			lib.LoadPNG(91, 64 * 2 ,bx, by*417, 1,0,63)
			lib.PicLoadCache(92,1*2,bx*25+(i-1)*bx*40,CC.ScreenH-by*60,2,255)
			local cl = C_WHITE
			if i == cot then 
				cl = C_RED
			end
			local stn = string.len(menu1[i+cot1][1])/2
			local hsize = bx*100/stn
			draw3(menu1[i+cot1][1],bx*25+(i-1)*bx*40,CC.ScreenH-by*60- ((stn-1)*hsize+size)/2, cl, size,nil,hsize)
			
			local zsmc1
			zsmc1 = "说明：".."Ｇ".."◆"..CC.SKILLNAME[mptype][cot]
			tjm(bx*10, by*425,zsmc1,C_WHITE,size*1.2,11,size)
			
			local zsqg = "Ｇ"..CC.SKILLINFO[mptype][cot]			
			tjm(bx*10, by*450,zsqg,C_WHITE,size,11,size)
		end
		
		-- local zsmc1
		-- -- if menu[i+cot1][3] == 1 then
			-- -- zsmc1 = "Ｇ".."◆"..CC.SKILLNAME[i+cot1][1]
		-- -- end
		
		-- zsmc1 = "Ｇ".."◆"..CC.SKILLNAME[i+cot1][yx]
		
		
		-- local zsmc1
		-- zsmc1 = "Ｇ".."◆"..CC.SKILLNAME[i+cot1][yx]
		-- tjm(bx*10, by*425,zsmc1,C_WHITE,size*1.2,11,size)
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
--[[			if CC.KFMove[tmp] ~= nil then
				return Cat("武功招式")
			else
				return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
			end	--]]
			return cot+cot1
			--return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
			--return Cat("武功招式")
		elseif X == VK_ESCAPE or ktype == 4 then
			return 0
		elseif X == VK_UP then	
			
		elseif X == VK_DOWN then
			
		elseif X == VK_LEFT then
			if cot > 1 then 
				cot = cot - 1 
			else 
				if cot1 > 0 then 
					cot1 = cot1 - 1
				else 
					cot = num
					cot1 = #menu1 - num
				end
			end
		elseif X == VK_RIGHT then
			if cot + cot1 < #menu1 then 
				if cot < num then 
					cot = cot + 1
				else 
					cot1 = cot1 + 1
				end
			else 
				cot = 1
				cot1 = 0
			end	
		elseif X >= 49 and X <= 57 then
			--local r = War_FightMenu(nil, nil, X-48);
			if r == 1 then 
				return 1
			end
		else 	
			local mxx = false 
			for i = 1,#menu1 do 
				if mx >= bx*25+(i-1)*bx*40 - bx*20 and mx <= bx*25+(i-1)*bx*40 + bx*20 and 
					my >= CC.ScreenH-by*60 - by*55 and my <= CC.ScreenH-by*60 + by*55 then 
					cot = i 
					mxx = true
					break
				end
			end
			if ktype == 3 and mxx == true then
				--return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
--[[				if CC.KFMove[tmp] ~= nil then
					return Cat("武功招式")
				else
					return War_Fight_Sub(WAR.CurID, menu[cot+cot1][2])
				end--]]
				return cot+cot1	
			end
		end
		
	end
end
function addthing(pp, num, flag)
	if num == nil then
		num = 1
	end
	if flag == 1 then
		instruct_32(pp, num)
	else
		instruct_2(pp, num)
	end
end

function addbuff(pp,eft,num1,num2)
	if eft[pp] == nil then
		eft[pp] = num1
	else
		if num2 == nil then
			eft[pp] = eft[pp] + num1
		else
			eft[pp] = eft[pp] + num1
			if eft[pp] > num2 then
				eft[pp] = num2
			end
		end
	end	
end


function freefight(pid)
	if MPPD(pid) == 7 then
		return true
	end
	return false
end

function MPReq(tmppid, mptype) --队友条件
	if MPPD(tmppid) == MPPD(0) and MPDJ(tmppid) == MPDJ(0) - 1 then
		return false
	end
	if mptype == 1 then --星宿派
		if JY.Person[tmppid]["用毒能力"] >= 40 and JY.Person[tmppid]["品德"] <= 50 then
			return true
		end
	elseif mptype == 2 then --丐帮
		if JY.Person[tmppid]["内力最大值"] >= 4000 and JY.Person[tmppid]["品德"] >= 50 then
			return true
		end		
	elseif mptype == 3 then --古墓派
		if JY.Person[tmppid]["性别"] == 1 and JY.Person[tmppid]["轻功"] >= 400 then
			return true
	    end		
	elseif mptype == 4 then --武当派
		if JY.Person[tmppid]["品德"] >= 60 then
			return true
		end	
	elseif mptype == 5 then --少林寺
		if JY.Person[tmppid]["性别"] == 0 and JY.Person[tmppid]["品德"] >= 50 then
			return true
		end		
	elseif mptype == 6 then --密宗
		if JY.Person[tmppid]["性别"] == 0 and TrueSD(tmppid) >= 100 then
			return true
		end		
	elseif mptype == 7 then --逍遥派
		if JY.Person[tmppid]["资质"] >= 75 then
			return true
		end	
	elseif mptype == 8 then --白驼山
		if JY.Person[tmppid]["内力最大值"] >= 4000 and JY.Person[tmppid]["品德"] <= 50 then
			return true
		end	
	elseif mptype == 9 then --唐门
		if JY.Person[tmppid]["暗器技巧"] >= 150 then
			return true
		end			
	elseif mptype == 10 then --桃花岛
		if JY.Person[tmppid]["资质"] >= 70 and TrueYJ(tmppid) >= 70 and TrueQZ(tmppid) >= 70 and TrueZF(tmppid) >= 70 then
			return true
		end			
	elseif mptype == 11 then --一刀流
		if TrueYJ(tmppid) >= 300 then
			return true
		end	
	elseif mptype == 12 then --日月神教
		if JY.Person[tmppid]["品德"] <= 40 then
			return true
		end	
	elseif mptype == 13 then --明教
		if JY.Person[tmppid]["内力最大值"] >= 4000 and (JY.Person[tmppid]["耍刀技巧"] >= 150 or TrueTS(tmppid) >= 150) then
			return true
		end
	elseif mptype == 14 then --五岳剑派
		if TrueYJ(tmppid) >= 150 then
			return true
		end	
	elseif mptype == 15 then --大理
		if JY.Person[tmppid]["内力最大值"] >= 5000 and TrueZF(tmppid) >= 100 and JY.Person[tmppid]["品德"] >= 50 then
			return true
		end
	elseif mptype == 16 then --全真教
		if JY.Person[tmppid]["内力最大值"] >= 5000 and (TrueYJ(tmppid) >= 150 or TrueQZ(tmppid) >= 150) and JY.Person[tmppid]["品德"] >= 50 then
			return true
		end		
	elseif mptype == 17 then --峨眉派
		if JY.Person[tmppid]["性别"] == 1 and TrueYJ(tmppid) >= 70 and TrueQZ(tmppid) >= 70 and JY.Person[tmppid]["品德"] >= 50 then
			return true
	    end		
	elseif mptype == 18 then --崆峒派
		if TrueQZ(tmppid) >= 150  and JY.Person[tmppid]["品德"] >= 50 then
			return true
	    end
	elseif mptype == 19 then --昆仑派
		if TrueYJ(tmppid) >= 150  and JY.Person[tmppid]["品德"] >= 50 then
			return true
	    end	
	elseif mptype == 22 then --中华阁
		if JY.Person[tmppid]["品德"] >= 70 then
			return true
	    end		
	elseif mptype == 63 then
		return true
	end
	return false
end

function reseteffect(eft, pp)
	if eft[pp] ~= nil then
		--if T9ZY(pp) then
		    --eft[0] = eft[0] - 1
		    --eft[582] = eft[582] - 1
		--else
		    eft[pp] = eft[pp] - 1
		--end	
		if eft[pp] <= 0 then
			eft[pp] = nil
		end
	end
end

--判断两人之间的距离
function RealJL(id1, id2, len)
	if not len then
		len = 1
	end
	local x1, y1 = WAR.Person[id1]["坐标X"], WAR.Person[id1]["坐标Y"]
	local x2, y2 = WAR.Person[id2]["坐标X"], WAR.Person[id2]["坐标Y"]
	local s = math.abs(x1 - x2) + math.abs(y1 - y2)
	if len == nil then
		return s
	end
	if s <= len then
		return true
	else
		return false
	end
end



function selectPerson(num, flag)  --1敌2我3both
	War_CalMoveStep(WAR.CurID, num, 1) 
	local nx, ny = nil, nil
	local victim = -1
	local victimid = -1
	while true do
		nx, ny = War_SelectMove()
		if nx == nil then
			return -1, -1, -1, -1
		end
		if nx ~= nil then
			if lib.GetWarMap(nx, ny, 2) < 0 and lib.GetWarMap(nx, ny, 5) < 0 then
				QZXS("此处无人，请重新选择")			
			elseif GetWarMap(nx, ny, 2) == nil or GetWarMap(nx, ny, 2) < 0 then
				QZXS("此处无人，请重新选择")	
			else
				victim = GetWarMap(nx, ny, 2)
				victimid = WAR.Person[victim]["人物编号"]
				if flag == 1 and WAR.Person[WAR.CurID]["我方"] == WAR.Person[victim]["我方"] then
					QZXS("不能选择我方人物")	
				elseif flag == 2 and WAR.Person[WAR.CurID]["我方"] ~= WAR.Person[victim]["我方"] then
					QZXS("不能选择敌方人物")	
				else
					break;
				end
			end
		end
	end
	return nx, ny, victim, victimid
end

--杀集气
function nokillspeed(i)
    local pid = WAR.Person[i]["人物编号"]
	--逆运蛤蟆
	if NGQH(pid,104) and WAR.L_NYZH[pid] ~= nil then 
		return true
	end
	--纯阳太极
	if NGQH(pid,99) and WAR.CYAY == 1 then	
	    return true
	end
	--易筋经组合
	if NGQH(pid,108) and JLSD(10,55,pid) then
		return true
	end	
	--流云
	if QGQH(pid,290,1) then
		local jl = math.modf(Qg(i)*0.01)
		if QGQH(pid,290,2) then
			jl = jl + 10
		end
		if JLSD(0,jl,pid) then
			return true
		end
	end
	--佛门至高
	if match_ID(pid,92) or match_ID(pid,114) or match_ID(pid,577) then
		return true
	end
	if match_ID(pid,65) and WAR.PD['复活・一灯'][pid] == 1 then
		return true
	end
	if MPTX(pid,25,5) then
		return true
	end
	if WAR.PD['血战到底'][pid] ~= nil and WAR.PD['血战到底'][pid] == 1 then
		return true
	end	
	if WAR.PD['雪羽战神'][pid] ~= nil and WAR.PD['雪羽战神'][pid] > 0 then
		return true
	end
	if WAR.PD['战神状态'][pid] ~= nil and JLSD(0,60,pid) then
		return true
	end
	if WAR.PD['免疫杀气'][pid] ~= nil or WAR.PD['魔之甲'][pid] == 1 or WAR.PD['血袍艳花'][pid] ~= nil then
		return true
	end	
	if WAR.MHBF[pid] ~= nil or WAR.JBMY[pid] ~= nil or WAR.YSHJ[pid] ~= nil then
		return true
	end	
	if WAR.PD['八雷神'][pid] == 1 and BNJQ(pid) then
		return true
	end
	return false
end

--战意
function zhanyi(pp, aa, flag)
	aa = math.modf(aa)	
	if JY.Status == GAME_WMAP then
		if WAR.PD['怯战状态'][pp] ~= nil and WAR.PD['怯战状态'][pp] > 0 then
			if aa > 0 then
				aa = 0
			end
		end
		--圣火狮子
		if NGQHB(pp,93) and WAR.SPIRIT[pp] ~= nil and WAR.SPIRIT[pp] < 200 then 
			if aa < 1 then
				aa = 1
			end
		end
		if aa > 0 then
			if WAR.SPIRIT[pp] ~= nil and WAR.SPIRIT[pp] < 200 then
				WAR.SPIRIT[pp] = limitX((WAR.SPIRIT[pp] or 20) + aa, (WAR.SPIRITMIN[pp] or 15), (WAR.SPIRITMAX[pp] or 200))
			elseif WAR.SPIRIT[pp] ~= nil and WAR.SPIRIT[pp] >= 200 then
				do return end	
			end
		else
			WAR.SPIRIT[pp] = (WAR.SPIRIT[pp] or 15) + aa
			if WAR.SPIRIT[pp] < (WAR.SPIRITMIN[pp] or 15) then
				WAR.SPIRIT[pp] = (WAR.SPIRITMIN[pp] or 15)
			end
			--WAR.SPIRIT[pp] = limitX((WAR.SPIRIT[pp] or 20) + aa, (WAR.SPIRITMIN[pp] or 20), (WAR.SPIRITMAX[pp] or 200))
		end			 
		if WAR.CurID > -1 and WAR.SPIRIT[pp] ~= nil and WAR.SPIRIT[pp] >= 200 then
			WAR.SPIRIT[pp] = 200
			local s = WAR.CurID
			for j = 0 ,WAR.PersonNum -1 do
				if WAR.Person[j]['人物编号'] == pp then
					WAR.CurID = j
					break
				end
			end
			WarDrawMap(0)
			CurIDTXDH(WAR.CurID,6,1,'战意爆发')	
			if (match_ID(pp,103) or match_ID(pp,745) or match_ID(pp,771)) and WAR.PD['残火太刀'][pp] == nil then
				WAR.PD['残火太刀'][pp] = 1
				WAR.PD['残日狱衣'][pp] = 4
				WAR.CHLY = 1
				CurIDTXDH(WAR.CurID,197,1,'d解・残火太刀')	
				if WAR.Person[WAR.CurID]["护盾"] == nil or WAR.Person[WAR.CurID]["护盾"] ~= 24 then
					WAR.Person[WAR.CurID]["护盾"] = 24
				end	
			end	
			if WAR.PD['阴阳双极'][pp] ~= nil then
				local a = 0.5
				AddPersonAttrib(pp,'生命',psx(pp,'生命最大值')*a)
				AddPersonAttrib(pp,'内力',psx(pp,'内力最大值')*a)
				AddPersonAttrib(pp,'体力',50)
				if rwnlxz(pp,3) then
					WAR.PD['阳神降世'][pp] = 1
					WAR.PD['阴圣再临'][pp] = 1
					CurIDTXDH(WAR.CurID,240,1,'阴阳合道・神圣归一')
				elseif rwnlxz(pp,2) then
					if math.random(2) == 1 then
						WAR.PD['阳神降世'][pp] = 1
						CurIDTXDH(WAR.CurID,225,1,'阳神降世')
					else
						WAR.PD['阴圣再临'][pp] = 1
						CurIDTXDH(WAR.CurID,223,1,'阴圣再临')
					end
				elseif rwnlxz(pp) == 0 then
					WAR.PD['阴圣再临'][pp] = 1
					CurIDTXDH(WAR.CurID,223,1,'阴圣再临')
				else
					WAR.PD['阳神降世'][pp] = 1
					CurIDTXDH(WAR.CurID,225,1,'阳神降世')
				end
			end
			if QIQX(pp,'鏖杀阵') > 0 and math.random(10) > 7 then
				for k = 0, WAR.PersonNum -1 do
					if dead(k) == false and DWPD(WAR.CurID,k) == false then
						nuqi(WAR.Person[k]['人物编号'],100)
						addbuff(WAR.Person[k]['人物编号'],WAR.PD['战神状态'],15)
					end
				end
				CurIDTXDH(WAR.CurID,228,1,'鏖杀阵')
			end		
			if MPTX(pp,5,3) and Curr_NG(pp,108) then
				WAR.PD['斗战胜佛'][pp] = 1
			end	
			WAR.CurID = s	
		end		
	end	
end

function nuqi(pp,aa)
	aa = math.modf(aa)
	local id = pp
	local jqid = pp
	if JY.Status == GAME_WMAP then
		if aa > 0 and WAR.PD['暗香疏影'][pp] == 2 then
			aa = math.modf(aa*0.5)
		end	
		--庄子天魔
		if NGQHB(pp,160) then
			if aa < 1 then
				aa = 1
			end
		end
		if aa >= 0 then
			if (PersonKF(pp,58) and PersonKF(pp,160)) or match_ID(pp,112) then
				WAR.LQZ[pp] = (WAR.LQZ[pp] or 0) + aa
			elseif (WAR.LQZ[pp] or 0) < 100 then
				WAR.LQZ[pp] = limitX((WAR.LQZ[pp] or 0) + aa,0,100)
			else
				do return end
			end	
		else
			WAR.LQZ[pp] = limitX((WAR.LQZ[pp] or 0) + aa,0)	
		end	
		if WAR.CurID > -1 and WAR.LQZ[pp] ~= nil and WAR.LQZ[pp] >= 100 then
			local s = WAR.CurID
			for j = 0, WAR.PersonNum -1 do
				if dead(j) == false and WAR.Person[j]['人物编号'] == pp then
					WAR.CurID = j
					break
				end
			end
			local str,dh = '怒气爆发',6
			WarDrawMap(0)
			if WAR.QX1[pp] == nil then
				if (WAR.PD["暴走状态2"][id] ==nil or  WAR.PD["暴走状态2"][id]==0) and Curr_NG(id,160) and PersonKF(id, 88)  then
					WAR.PD["暴走状态2"][id] = 2
				end
				if (match_ID(jqid, 27) or match_ID(jqid, 777)) and PersonKF(jqid, 105) then
					str = "葵花秘法・化凤为凰"
					dh = 7
				end
				if match_ID(jqid, 568) then
					str = "精忠报国"
					dh = 8
				end	
				--聂风
				if match_ID(jqid,9949) and JLSD(0,60,jqid) then
					WAR.PD['入魔'][jqid] = 1
					dh = 157
					str = "冰心见魔・入魔"
				end 
				--天魔功
				if Curr_NG(jqid, 160) and JLSD(0,30,jqid) then
					WAR.PD['入魔'][jqid] = 1
					dh = 157
					str = "天魔大法"
				end
				if WAR.PD['鬼如来'][id] == 1 and JLSD(0,30,id) then
					WAR.PD['入魔'][id] = 1
					dh = 157
					str = "孽罪怒佛"
				end
				--瞬息千里
				if TFQG(id,150) then
					ztd(WAR.CurID,WAR.FXXS,-JY.Person[id]["封穴程度"])
				end	
				--少林金刚
				if MPTX(id,5,2) and Curr_NG(id,144) then
					local yc = {{'中毒点数','中毒程度'},{'内伤点数','受伤程度'},{WAR.ZSXS,'灼烧程度'},{WAR.FXXS,'封穴程度'},{WAR.LXXS,'流血程度'},{WAR.BFXS,'冰封程度'}}
					for i = 1,#yc do
						ztd(WAR.CurID,yc[i][1],-(math.modf(psx(id,yc[i][2]))*0.5))
					end	
					if JLSD(10,35,id) then
						ztd(WAR.CurID,'内伤点数',-psx(id,'受伤程度'))
					end	
				end
			end
			--中庸觉醒
			if jqid == 0 and (JY.Base["畅想"] > 0 or JY.Base["标准"] > 0) and JY.Person[0]["中庸"] == 3 then
				str = "布衣之怒"
			end
			--天魔组合	
			if NGQH(id,160) and WAR.QX1[id] == nil then
				if JLSD(10,40,id) then
					Cat('清除中级异常',WAR.CurID)
				end
				WAR.PD['怒气负面效果1'][id] = nil
				WAR.PD['怒气负面效果2'][id] = nil
				WAR.PD['伤害储存'][id] = (WAR.PD['伤害储存'][id] or 0) + math.random(500,1000)
				if (WAR.Person[WAR.CurID].Time or 0) < 1000 then
					WAR.Person[WAR.CurID].Time = limitX(WAR.Person[WAR.CurID].Time + 300,-500,1000)
				end	
				if WAR.PD['天魔金身'][id] ~= nil and WAR.PD['天魔金身'][id] <= 50 and JLSD(10,50,id) then
					WAR.PD['天魔金身'][id] = nil
				end
				dh = 157
				str = '怒气爆发・魔之战息'
			end	
			if Curr_NG(jqid, 43) and WAR.PD['易水寒诀'][jqid]~=nil and WAR.PD['易水寒诀'][jqid] > 95 and WAR.QX1[jqid] == nil then
				if WAR.PD["昏迷状态"][jqid] ~= nil then
				    WAR.PD["昏迷状态"][jqid] = nil
				end
				if WAR.PD["恐惧状态"][jqid] ~= nil then
					WAR.PD["恐惧状态"][jqid] = nil
				end
				str = '易水寒诀.疑是银河落九天'
			end	
			if WAR.PD['怒气负面效果1'][id] ~= nil then
				AddPersonAttrib(id,"受伤程度",50)
				AddPersonAttrib(id,"灼烧程度",25)
				addbuff(id,WAR.PD['灵蛇拳'],10,15)
				CurIDTXDH(WAR.CurID, 6, 1, "怒火中烧")
				WAR.PD['怒气负面效果1'][id] = nil
			elseif WAR.PD['怒气负面效果2'][id] ~= nil then
				AddPersonAttrib(id,"受伤程度",50)
				AddPersonAttrib(id,"灼烧程度",25)
				addbuff(id,WAR.PD['七伤拳火'],15,20)
				CurIDTXDH(WAR.CurID, 6, 1, "急怒攻心")
				WAR.PD['怒气负面效果2'][id] = nil
			end 
			if WAR.PD['怒气爆发'][id] ~= nil then
				Set_Eff_Text(WAR.CurID,1,str,dh)
				WAR.PD['怒气爆发'][id] = nil
			else	
				CurIDTXDH(WAR.CurID, dh, 1, str)
			end	
			WAR.CurID = s
		end	
	end
end


--[[--判断触发机率
function myrandom(p, pp)
	if JY.Status == GAME_WMAP then
		for i = 0, WAR.PersonNum - 1 do
			local pid = WAR.Person[i]["人物编号"]
		end
		--逆运蛤蟆走火+40点
		
	end
	
	p = math.modf(p + JY.Person[pp]["生命最大值"] * 4 / (JY.Person[pp]["生命"] + 20) + JY.Person[pp]["体力"] / 20)		--生命值越低，机率越高
	
	--满实战+11点
	local jp = math.modf(JY.Person[pp]["实战"] / 50 + 1)
	p = p + jp
	
	--内力值最多+10点
	p = p + limitX(math.modf(JY.Person[pp]["内力"] / 1000), 0, 10)
	
	if not inteam(pp) then
		p = p + 30
	end
	
	--战意的几率加成
	if WAR.SPIRIT[pp] >= 200 then 
		p = p + limitX(math.modf((WAR.SPIRIT[pp] - 100) * 0.5), 0, 20)
	end
	
	local times = 1
	
	for i = 1, times do
		local bd = math.random(130) + 10
		if bd <= p then
		  return true
		end
	end
	return false
end
--]]
function randomanqi()
	return math.random(28,35)
end

function acsj() --唐门模式暗藏杀机
    for i = 0,WAR.PersonNum -1 do 
        if MPPD(WAR.Person[i]["人物编号"]) == 9 and WAR.TMMS[WAR.Person[i]["人物编号"]] == 2 and inteam(WAR.Person[i]["人物编号"]) then
            WAR.CurID = i
	        WAR.ShowHead = 1
            --WAR.ShowHead = 1
            QZXS("请选择暗藏杀机坐标")  -- DrawStrBox(CC.MainMenuX, CC.MainMenuY, CC.EVB183, C_GOLD, 30)
            War_CalMoveStep(WAR.CurID, 15, 1) --武功移动步数
            local nx, ny = nil, nil
            while true do
	        nx, ny = War_SelectMove() --显示+选择步数
	        if nx ~= nil then
	            QZXS("已定位坐标点")
	            WAR.ACSJ[100 + WAR.Person[i]["人物编号"]] = {nx,ny}
	            --WAR.ShowHead = 0
	            break;
	        end
	    end
	    local nx, ny = nil, nil
	    while true do
	        nx, ny = War_SelectMove() --显示+选择步数
	        if nx ~= nil then
	            QZXS("已定位坐标点")
	            WAR.ACSJ[200 + WAR.Person[i]["人物编号"]] = {nx,ny}
	            --WAR.ShowHead = 0
	            break;
	        end
	    end
	    local nx, ny = nil, nil
	        while true do
	            nx, ny = War_SelectMove() --显示+选择步数
	            if nx ~= nil then
	                QZXS("已定位坐标点")
	                WAR.ACSJ[300+WAR.Person[i]["人物编号"]] = {nx,ny}
	                WAR.ShowHead = 0
	                break;
	           end
	       end
	    end
    end
end

function qjb() --唐门模式千机变
    local id = WAR.Person[WAR.CurID]["人物编号"]
    QZXS("请选择安放坐标")  -- DrawStrBox(CC.MainMenuX, CC.MainMenuY, CC.EVB183, C_GOLD, 30)
    War_CalMoveStep(WAR.CurID, 15, 1) --武功移动步数
    local nx, ny = nil, nil
    while true do
	   nx, ny = War_SelectMove() --显示+选择步数
	    if nx ~= nil then
	        if lib.GetWarMap(nx, ny, 2) > 0 or lib.GetWarMap(nx, ny, 5) > 0 then
                QZXS("此处有人！请重新选择")			--此处有人！请重新选择
	        elseif CC.SceneWater[lib.GetWarMap(nx, ny, 0)] ~= nil then
	            QZXS("水面，不可进入！请重新选择")		--水面，不可进入！请重新选择
	        else
	            --QZXS("已定位坐标点")
	            --WAR.ACSJ[100+WAR.Person[i]["人物编号"]] = {nx,ny}
	            --WAR.ShowHead = 0
				break;
			end
	    end
	end
	for i = 0,WAR.PersonNum - 1 do
	    if MPPD(id) == 9 and id ~= 740 and isteam(id) and WAR.PD["分身判定"][id] == nil and WAR.PD["分身判定1"][id] == nil then
		    if WAR.PD["分身上限"][id] == nil then
			    local str = ""
			    local x, y = WE_xy(WAR.Person[i]["坐标X"], WAR.Person[i]["坐标Y"] - 1)
			    local mid = 740			--定义一个临时的戚长发数据
			    JY.Person[mid]["暂时无用"] = JY.Base["畅想"]			
			    JY.Person[mid]["头像代号"] = JY.Person[id]["头像代号"]
			    JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
			    JY.Person[mid]["半身像"] = JY.Person[id]["半身像"]
			    JY.Person[mid]["姓名"] = "千机变"
			    JY.Person[mid]["天赋内功"] = JY.Person[id]["天赋内功"]
			    JY.Person[mid]["天赋外功1"] = JY.Person[id]["天赋外功1"]
			    JY.Person[mid]["天赋外功2"] = JY.Person[id]["天赋外功2"]	
			    JY.Person[mid]["天赋轻功"] = JY.Person[id]["天赋轻功"]			
			    JY.Person[mid]["指法技巧"] = JY.Person[id]["指法技巧"]
			    JY.Person[mid]["御剑能力"] = JY.Person[id]["御剑能力"]	
			    JY.Person[mid]["耍刀技巧"] = JY.Person[id]["耍刀技巧"]
			    JY.Person[mid]["特殊兵器"] = JY.Person[id]["特殊兵器"]
			    JY.Person[mid]["武学常识"] = JY.Person[id]["武学常识"]
			    JY.Person[mid]["攻击带毒"] = JY.Person[id]["攻击带毒"]
			    JY.Person[mid]["左右互搏"] = JY.Person[id]["左右互搏"]
			    JY.Person[mid]["中庸"] = JY.Person[id]["中庸"]
			    JY.Person[mid]["攻击力"] = JY.Person[id]["攻击力"]
			    JY.Person[mid]["防御力"] = JY.Person[id]["防御力"]
			    JY.Person[mid]["轻功"] = JY.Person[id]["轻功"]
			    JY.Person[mid]["医疗能力"] = JY.Person[id]["医疗能力"]
			    JY.Person[mid]["用毒能力"] = JY.Person[id]["用毒能力"]
			    --JY.Person[mid]["解毒能力"] = JY.Person[id]["解毒能力"]
			    JY.Person[mid]["暗器技巧"] = JY.Person[id]["暗器技巧"]
			    JY.Person[mid]["抗毒能力"] = JY.Person[id]["抗毒能力"]
			    JY.Person[mid]["个人觉醒"] = JY.Person[id]["个人觉醒"]
			    JY.Person[mid]["六如觉醒"] = JY.Person[id]["六如觉醒"]
			    JY.Person[mid]["畅想分阶"] = JY.Person[id]["畅想分阶"]
			    JY.Person[mid]["主运轻功"] = JY.Person[id]["主运轻功"]
			    JY.Person[mid]["主运内功"] = JY.Person[id]["主运内功"]
			    JY.Person[mid]["冰封程度"] = 0
			    JY.Person[mid]["灼烧程度"] = 0
			    JY.Person[mid]["中毒程度"] = 0
			    JY.Person[mid]["受伤程度"] = 0
			    JY.Person[mid]["实战"] = JY.Person[id]["实战"]
			    JY.Person[mid]["等级"] = JY.Person[id]["等级"]
			    JY.Person[mid]["门派技能1"] = JY.Person[id]["门派技能1"]
			    for o = 1,JY.Base["武功数量"] do
				    JY.Person[mid]["武功"..o] = JY.Person[id]["武功"..o]
				    JY.Person[mid]["武功等级"..o] = JY.Person[id]["武功等级"..o]
			    end
			    for i = 1,5 do
				    JY.Person[mid]["出招动画帧数" .. i]=JY.Person[id]["出招动画帧数" .. i]
				    JY.Person[mid]["出招动画延迟" .. i]=JY.Person[id]["出招动画延迟" .. i]
			 	    JY.Person[mid]["武功音效延迟" .. i]=JY.Person[id]["武功音效延迟" .. i]
			    end	
			    JY.Person[mid]["武器"] = JY.Person[id]["武器"]
		        JY.Person[mid]["防具"] = JY.Person[id]["防具"]
			    JY.Person[mid]["坐骑"] = JY.Person[id]["坐骑"]
			    JY.Person[mid]["生命最大值"] = math.modf(JY.Person[id]["生命最大值"] * 1)
			    JY.Person[mid]["生命"] = JY.Person[id]["生命最大值"]
			    JY.Person[mid]["内力最大值"] = math.modf(JY.Person[id]["内力最大值"] * 1)
			    JY.Person[mid]["内力"] = JY.Person[id]["内力最大值"]
			    JY.Person[mid]["体力"] = 100
			    JY.Person[mid]["生命增长"] = JY.Person[id]["生命增长"]
			    JY.Person[mid]["内力性质"] = JY.Person[id]["内力性质"]
			    JY.Person[mid]["性别"] = JY.Person[id]["性别"]
			    JY.Person[mid]["资质"] = JY.Person[id]["资质"]
			    NewWARPersonZJ(mid, true, x, y, false, 1);
			    WAR.JQSDXS[mid] = (WAR.JQSDXS[id] or 50)
			    WAR.PD["分身判定"][id] = mid --判断自己是不是发动过分身
			    WAR.PD["分身判定1"][mid] = id --用来做死后复活
			    WAR.PD["分身瞬动"][mid] = 1 --让分身第一回合瞬动
			    WAR.PD["分身上限"][id] = 1
			    --[[if WAR.PD['中庸'][id] ~= nil then
				    WAR.PD['中庸'][id] = math.modf(WAR.PD['中庸'][id] * 2)
			    end	]]
		        local hh2 = JYMsgBox("攻击模式", "请选择攻击模式？", {"连弩", "重弩", "毒煞"}, 3, id)	
			    if hh2 <= 0 then
				    return 0
			    end	
			    if hh2 == 1 then 
				    WAR.QJBMS[mid] = 1
				    JY.Person[mid]["姓名"] = "千机变・连弩"
			    elseif hh2 == 2 then 
				    WAR.QJBMS[mid] = 2 
				    JY.Person[mid]["姓名"] = "千机变・重弩"
			    else
				    WAR.QJBMS[mid] = 3 
				    JY.Person[mid]["姓名"] = "千机变・毒煞"
				   --acsj()
			    end
			end 
		end 	
	end 				
end

function hgb() --幻光步
    for i = 0,WAR.PersonNum-1 do --17-2-19-幻光步
        if (Curr_NG(WAR.Person[i]["人物编号"],93) and PersonKF(WAR.Person[i]["人物编号"],97)) and inteam(WAR.Person[i]["人物编号"]) then
            WAR.CurID = i
	        WAR.ShowHead = 1
            --WAR.ShowHead = 1
            QZXS("请选择定位坐标")  -- DrawStrBox(CC.MainMenuX, CC.MainMenuY, CC.EVB183, C_GOLD, 30)
            War_CalMoveStep(WAR.CurID, 15, 1) --武功移动步数
            local nx, ny = nil, nil
            while true do
	            nx, ny = War_SelectMove() --显示+选择步数
	            if nx ~= nil then
	                if lib.GetWarMap(nx, ny, 2) > 0 or lib.GetWarMap(nx, ny, 5) > 0 then
                        QZXS("此处有人！请重新选择")			--此处有人！请重新选择
	                elseif CC.SceneWater[lib.GetWarMap(nx, ny, 0)] ~= nil then
	                    QZXS("水面，不可进入！请重新选择")		--水面，不可进入！请重新选择
	                else
	                    QZXS("已定位坐标点")
	                    WAR.HGB[100+WAR.Person[i]["人物编号"]] = {nx,ny}
	                    WAR.ShowHead = 0
	                    break;
	                end
	            end
	        end
        end
    end
end

--攻击不能护体
function NGHTKX(pid)
	if WAR.KMZWD == 1 then
		return true
	end
	if WAR.XTQKG == 1 then
	    return true
	end
	return false
end

--判定所用武功是不是能够触发特效的武功，用途在于让某些角色解放武功限制
function yongwu(a,b)
	if a == nil or a < 0 or b == nil or b < 0 then
		return false
	end	
	if a == b then
		return true
	end
	return false	
end	

--指定用拳攻击
function yongquan(pp)
	if JY.Wugong[pp]["武功类型"] == 1 then
		return true
	else
		return false
	end
end

--指定用指攻击
function yongzhi(pp)
	if JY.Wugong[pp]["武功类型"] == 2 then
		return true
	else
		return false
	end
end

--指定用剑攻击
function yongjian(pp)
	if pp == 49 then
		return true
	elseif JY.Wugong[pp]["武功类型"] == 3 then
		return true
	elseif JY.Status == GAME_WMAP then
		if WAR.CurID > -1 and match_ID(WAR.Person[WAR.CurID]['人物编号'],761) and JY.Wugong[pp]["武功类型"] == 5 then
			return true
		end	
	else
		return false
	end
end

--指定用刀攻击
function yongdao(pp)
	if pp == 66 then
		return true
	elseif JY.Wugong[pp]["武功类型"] == 4 then
		return true
	else
		return false
	end
end

--指定用特殊攻击
function yongte(pp)
	if JY.Wugong[pp]["武功类型"] == 5 then
		return true
	elseif JY.Status == GAME_WMAP then
		if WAR.CurID > -1 and match_ID(WAR.Person[WAR.CurID]['人物编号'],761) and JY.Wugong[pp]["武功类型"] == 2 then
			return true
		end	
	else
		return false
	end
end

--指定用内功攻击
function yongnei(pp)
	if pp == nil or pp < 0 then
		return false 
	end
	if JY.Wugong[pp]["武功类型"] == 6 then
		return true
	else
		return false
	end
end

function yongqin(pp)
	if pp == nil or pp < 0 then
		return false 
	end
	if JY.Wugong[pp]["武功类型"] == 7 then
		return true
	else
		return false
	end
end

function wgnumber(tmppid, wgtype, flag)
	local wg = 0
	local ji = true
	if flag == nil then
		ji = false
	end
	if wgtype == 0 then
		for i = 1, CC.Kungfunum do
			if ji or JY.Person[tmppid]["武功等级" .. i] >= 999 then
				wg = wg + 1
			end
		end
	elseif wgtype == 1 then 
		for i = 1, CC.Kungfunum do
		  if yongquan(JY.Person[tmppid]["武功" .. i]) and (ji or JY.Person[tmppid]["武功等级" .. i] >= 999) then
			wg = wg + 1
		  end
		end
	elseif wgtype == 2 then
		for i = 1, CC.Kungfunum do
		  if yongzhi(JY.Person[tmppid]["武功" .. i]) and (ji or JY.Person[tmppid]["武功等级" .. i] >= 999) then
			wg = wg + 1
		  end
		end
	elseif wgtype == 3 then
		for i = 1, CC.Kungfunum do
		  if yongjian(JY.Person[tmppid]["武功" .. i]) and (ji or JY.Person[tmppid]["武功等级" .. i] >= 999) then
			wg = wg + 1
		  end
		end
	elseif wgtype == 4 then
		for i = 1, CC.Kungfunum do
		  if yongdao(JY.Person[tmppid]["武功" .. i]) and (ji or JY.Person[tmppid]["武功等级" .. i] >= 999) then
			wg = wg + 1
		  end
		end
	elseif wgtype == 5 then
		for i = 1, CC.Kungfunum do
			if yongte(JY.Person[tmppid]["武功" .. i]) and (ji or JY.Person[tmppid]["武功等级" .. i] >= 999) then
				wg = wg + 1
			end
		end	
	elseif wgtype == 6 then
		for i = 1, CC.Kungfunum do
          	if yongnei(JY.Person[tmppid]["武功" .. i]) and (ji or JY.Person[tmppid]["武功等级" .. i] >= 999) then
				wg = wg + 1			
			end  
		end			
	end
	return wg
end

--[[
function filelength(filename)
    SetS(40, 11, 33, 3, 58)
    instruct_3(40, 58, 1, 0, 10086, 0, 0, 7266, 7266, 7266, 0, 0, 0)
    --dofile(".\\script\\nino_emblem_event.lua")
    local inp = io.open(filename, "rb")
    if inp == nil then
        return -1
    end
    local l = inp:seek("end")
    inp:close()
    return l
end
]]
--[[
function instruct_2(thingid, num)
    if JY.Thing[thingid] == nil then
        return
    end
    instruct_32(thingid, num)
    if 0 < num then
        DrawStrBoxWaitKey(string.format("得到物品:%s %d", JY.Thing[thingid]["名称"], num), C_ORANGE, CC.DefaultFont)
    else
        DrawStrBoxWaitKey(string.format("失去物品:%s %d", JY.Thing[thingid]["名称"], -num), C_ORANGE, CC.DefaultFont)
    end
    for i = 144, 157 do
        if thingid == i and num == 1 then
            if JY.Thing[202][WZ7] > 3 then
                local hd = math.random(3)
                if hd == 1 then
                    DrawStrBoxWaitKey("得到免伤卡一个", C_GOLD, CC.DefaultFont)
                    JY.Person[318]["受伤程度"] = JY.Person[318]["受伤程度"] + 1
                elseif hd == 2 then
                    DrawStrBoxWaitKey("得到遥控色子一个", C_GOLD, CC.DefaultFont)
                    JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] + 1
                else
                    DrawStrBoxWaitKey("得到福神卡一个", C_GOLD, CC.DefaultFont)
                    JY.Person[318]["抗毒能力"] = JY.Person[318]["抗毒能力"] + 1
                end
            else
                DrawStrBoxWaitKey("得到遥控色子、免伤卡和福神卡各一个", C_GOLD, CC.DefaultFont)
                JY.Person[318]["受伤程度"] = JY.Person[318]["受伤程度"] + 1
                JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] + 1
                JY.Person[318]["抗毒能力"] = JY.Person[318]["抗毒能力"] + 1
            end
        end
    end
    instruct_2_sub()
end
]]
function ksyx()
    SetS(52, 4, 1, 5, 0)
    TalkEx3("“步步惊心”九万两玩一次。", 779, 0, "苍井空")
    local f = DrawStrBoxYesNo(-1, -1, "是否要和苍井空玩“步步惊心”呢？(Y/N)?", C_ORANGE, 32)
    if f == false then
        return
    elseif instruct_31(90000) == false then
        SetS(52, 4, 1, 5, 1)
        TalkEx3("你身上的钱不够啊！", 779, 0, "苍井空")
        return
    else
        instruct_2(174, -90000)
        SetS(52, 4, 1, 5, 1)
        TalkEx3("游戏开始！", 779, 0, "苍井空")
        SetS(52, 4, 1, 5, 0)
        SetS(52, 1, 1, 5, GetS(52, 1, 1, 5) + 1)
        ksyx2()
    end
end

function ksyx2()
    JY.Person[318]["携带物品4"] = 0
    JY.Person[318]["携带物品数量4"] = 0
    JY.Person[318]["携带物品3"] = 0
    JY.Person[318]["携带物品数量3"] = 0
    JY.Person[318]["武学常识"] = 0
    JY.Person[318]["品德"] = 0
    JY.Person[318]["资质"] = 0
    JY.Person[318]["攻击带毒"] = 0
    JY.Person[318]["中毒程度"] = 0
    JY.Person[318]["解毒能力"] = 0
    JY.Person[318]["左右互搏"] = 0
    JY.Person[318]["携带物品2"] = 0
    JY.Person[318]["携带物品数量2"] = 0
    JY.Person[318]["携带物品数量1"] = 0
    for i = 1, 25 do
        JY.Person[460 + i]["携带物品4"] = 0
        JY.Person[460 + i]["携带物品数量4"] = 0
    end
    local size = CC.DefaultFont
    local width = 19 * size
    local h = size + CC.PersonStateRowPixel
    local height = 15 * h
    local dx = (CC.ScreenW - width) / 2
    local dy = (CC.ScreenH - height) / 2
    local dx2 = dx + width
    local dy2 = dy + height
    local BJ1 = CONFIG.PicturePath .. "BJ1.png"
    local BJ2 = CONFIG.PicturePath .. "BJ2.png"
    local HK = CONFIG.PicturePath .. "H01.png"
    local FK = CONFIG.PicturePath .. "F01.png"
    local J2 = CONFIG.PicturePath .. "J2.png"
    local C2 = CONFIG.PicturePath .. "C2.png"
    local tx = GetS(52, 3, 1, 5)
    local wpbh = {}
    lib.LoadPicture(BJ1, dx - 90, dy + 2 - 70)
    DrawBox(dx - 95, dy - 75, dx2 + 159, dy2 + 76, C_WHITE)
    local wp = {
    411,  --炸弹
    174,  --银两
    2,    --黑玉断续膏
    412,  --陷阱
    74,   --乾坤大挪移
    411,  --炸弹
    174,  --银两
    93,   --葵花宝典
    411,  --炸弹
    25,   --五宝花蜜酒
    174,  --银两
    37,   --倚天剑
    411,  --炸弹
    168,  --打狗棒法
    14,   --千年灵芝
    411,  --炸弹
    174,  --银两
    76,   --纯阳无极功
    412,  --陷阱
    88,   --须弥山神掌
    174,  --银两
    411,  --炸弹
    75,   --小无相功
    411,  --炸弹
    115,  --太极剑法
    412,  --陷阱
    116,  --玄铁剑法
    411,  --炸弹
    168,  --伏魔杖法
    174,  --银两
    411,  --炸弹
    174,  --银两
    412,  --陷阱
    77,   --先天功
    235,  --左右互搏术
    411,  --炸弹
    174,  --银两
    65,   --吸星大法
    66,   --化功大法
    174,  --银两
    270,  --参合指法
    411,  --炸弹
    69,   --狮吼功法
    174,  --银两
    411,  --炸弹
    174,  --银两
    113,  --六脉神剑
    412,  --陷阱
    174,  --银两
    118,  --斗转星移
    411,  --炸弹
    81,   --龙象般若功
    136,  --胡家刀法
    411,  --炸弹
    174,  --银两
    411,  --炸弹
    137,  --燃木刀法
    70,   --圣火神功
    411,  --炸弹
    71,   --神照功
    174,  --银两
    15,   --大蟠桃
    411,  --炸弹
    114,  --独孤九剑
    412,  --陷阱
    73,   --蛤蟆功法
    411,  --炸弹
    43,   --屠龙刀
    174,  --银两
    8,    --天王保命丹
    411,  --炸弹
    13,   --玉灵散
    174,  --银两
    411,  --炸弹
    82,   --逆运真经
    412,  --陷阱
    83,   --九阳真经
    174,  --银两
    411,  --炸弹
    265,  --金刚不坏体
    411,  --银两
    85,   --易筋经
    174,  --银两
    86,   --降龙十八掌
    411,  --炸弹
    271,  --沧溟刀法
    174,  --银两
    87,   --黯然销魂掌
    411,  --炸弹
    17,   --天山雪莲
    252,  --凌波微步
    412,  --陷阱
    174,  --银两
    96,   --一阳指法
    412,  --陷阱
    97,   --太极拳经
    308,  --鲸息功
    411,  --炸弹
    470,  --葵花神针功
    174,  --银两
    267,  --神行百变
    411,  --银两
    135,  --火焰刀法
    411,  --银两
    90,   --大金刚掌
    412,  --陷阱
    64,   --北冥神功
    411,  --炸弹
    174,  --银两  
    297,  --瞬息千里
    411,  --银两
    68,   --混元功法
    411,  --银两
    539,  --龙啸九天
    412,  --陷阱
    174,  --银两
    387,  --神足经
    411,  --炸弹
    388,  --天刀九问
    16,   --千年人参
    411,  --炸弹
    78,   --辟邪剑法
    411,  --炸弹
    79,   --八荒六合功
    174,  --银两
    80,   --太玄经
    411,  --炸弹
    84,   --九阴真经
    174,  --银两
    412,  --陷阱
    336,  --武穆遗书
    411   --炸弹
    }
    for i = 1, 25 do
        JY.Person[460 + i]["携带物品4"] = math.random(#wp)
    end
    for i = 1, 25 do
        wpbh[i] = JY.Person[460 + i]["携带物品4"]
    end
    for k1 = 0, 8 do
		if wp[wpbh[14 + k1]] == 411 or wp[wpbh[14 + k1]] == 412 then
			lib.LoadPNG(91,wp[wpbh[14 + k1]] * 2, CC.ScreenW / 2 - 367 + 90 * k1, CC.ScreenH / 2 - 317, 1)
		else
			lib.PicLoadCache(2, wp[wpbh[14 + k1]] * 2, CC.ScreenW / 2 - 367 + 90 * k1, CC.ScreenH / 2 - 317, 1)
		end
	
        
    end
    for k2 = 0, 8 do
        lib.LoadPicture(FK, CC.ScreenW / 2 - 373 + 90 * k2, CC.ScreenH / 2 - 324)
    end
    for k3 = 0, 7 do
		if wp[wpbh[8 - k3]] == 411 or wp[wpbh[8 - k3]] == 412 then
			lib.LoadPNG(91, wp[wpbh[8 - k3]] * 2, CC.ScreenW / 2 - 367 + 90 * k3, CC.ScreenH / 2 + 238, 1)
		else
			lib.PicLoadCache(2, wp[wpbh[8 - k3]] * 2, CC.ScreenW / 2 - 367 + 90 * k3, CC.ScreenH / 2 + 238, 1)
		end
        
    end
    lib.LoadPNG(91, 816, CC.ScreenW / 2 + 353, CC.ScreenH / 2 + 238, 1)
    for k4 = 0, 8 do
        lib.LoadPicture(FK, CC.ScreenW / 2 - 373 + 90 * k4, CC.ScreenH / 2 + 231)
    end
    lib.LoadPicture(HK, CC.ScreenW / 2 + 347, CC.ScreenH / 2 + 231)
    for k8 = 0, 4 do
		if	wp[wpbh[13 - k8]] == 411 or wp[wpbh[13 - k8]] == 412 then
			lib.LoadPNG(91, wp[wpbh[13 - k8]] * 2, CC.ScreenW / 2 - 367, CC.ScreenH / 2 - 222 + 92 * k8, 1)
		else
			lib.PicLoadCache(2, wp[wpbh[13 - k8]] * 2, CC.ScreenW / 2 - 367, CC.ScreenH / 2 - 222 + 92 * k8, 1)
		end
        
    end
    for k5 = 0, 4 do
        lib.LoadPicture(FK, CC.ScreenW / 2 - 373, CC.ScreenH / 2 - 229 + 92 * k5)
    end
    for k6 = 0, 2 do
		if wp[wpbh[23 + k6]] ==411 or wp[wpbh[23 + k6]] == 412 then
			lib.LoadPNG(91, wp[wpbh[23 + k6]] * 2, CC.ScreenW / 2 + 353, CC.ScreenH / 2 - 226 + 93 * k6, 1)
		else
			lib.PicLoadCache(2, wp[wpbh[23 + k6]] * 2, CC.ScreenW / 2 + 353, CC.ScreenH / 2 - 226 + 93 * k6, 1)
		end
	
        
    end
    lib.LoadPNG(91, 820, CC.ScreenW / 2 + 353, CC.ScreenH / 2 + 54, 1)
    lib.LoadPNG(91, 818, CC.ScreenW / 2 + 353, CC.ScreenH / 2 + 147, 1)
    for k7 = 0, 4 do
        lib.LoadPicture(FK, CC.ScreenW / 2 + 347, CC.ScreenH / 2 - 231 + 93 * k7)
    end
    lib.PicLoadCache(87, (tx - 10) * 2, CC.ScreenW / 2 - 50, CC.ScreenH / 2 - 190, 1)
    lib.PicLoadCache(87, 0, CC.ScreenW / 2 - 245, CC.ScreenH / 2 - 190, 1)
    lib.LoadPNG(91, 812, CC.ScreenW / 2 - 70, CC.ScreenH / 2 + 15, 1)
    lib.LoadPNG(91, 814, CC.ScreenW / 2 - 250, CC.ScreenH / 2 - 205, 1)
    ShowScreen()
    DH("遍地都是宝，看谁运气好。")
    DH("花钱都一样，就怕跑不了。")
    DH("欢迎来到“步步惊心”！")
    DH("注意哦，踩到炸弹或者掉进陷阱")
    DH("之前获得的奖品都会消失的！")
    DH("祝你好运～加油！")
    xd()
end

function js()
    local DS = 0
    local Z = JY.Person[318]["资质"]
    local wpbh = {}
    local wp2 = {
    411,  --炸弹
    174,  --银两
    2,    --黑玉断续膏
    412,  --陷阱
    74,   --乾坤大挪移
    411,  --炸弹
    174,  --银两
    93,   --葵花宝典
    411,  --炸弹
    25,   --五宝花蜜酒
    174,  --银两
    37,   --倚天剑
    411,  --炸弹 
    168,  --打狗棒法
    14,   --千年灵芝
    411,  --炸弹
    174,  --银两
    76,   --纯阳无极功
    412,  --陷阱
    88,   --须弥山神掌
    174,  --银两
    411,  --炸弹
    75,   --小无相功
    411,  --炸弹
    115,  --太极剑法
    412,  --陷阱
    116,  --玄铁剑法
    411,  --炸弹
    168,  --伏魔杖法
    174,  --银两
    411,  --炸弹
    174,  --银两
    412,  --陷阱
    77,   --先天功
    235,  --左右互搏术
    411,  --炸弹
    174,  --银两
    65,   --吸星大法
    66,   --化功大法
    174,  --银两
    270,  --参合指法
    411,  --炸弹
    69,   --狮吼功法
    174,  --银两
    411,  --炸弹
    174,  --银两
    113,  --六脉神剑
    412,  --陷阱
    174,  --银两
    118,  --斗转星移
    411,  --银两
    81,   --龙象般若功
    136,  --胡家刀法
    411,  --炸弹
    174,  --银两
    411,  --陷阱
    137,  --燃木刀法
    70,   --圣火神功
    411,  --炸弹
    71,   --神照经
    174,  --银两
    15,   --大蟠桃
    411,  --炸弹
    114,  --独孤九剑
    412,  --陷阱
    73,   --蛤蟆功法
    411,  --炸弹
    43,   --屠龙刀
    174,  --银两
    8,    --天王保命丹
    411,  --炸弹
    13,   --玉灵散
    174,  --银两
    411,  --炸弹
    82,   --逆运真经
    412,  --陷阱
    83,   --九阳真经
    174,  --银两
    411,  --炸弹
    265,  --金刚不坏体
    411,  --炸弹
    85,   --易筋经
    174,  --银两
    86,   --降龙十八掌
    411,  --炸弹
    271,  --沧溟刀法
    174,  --银两
    87,   --黯然销魂掌
    411,  --炸弹
    17,   --天山雪莲
    252,  --凌波微步
    412,  --陷阱
    174,  --银两
    96,   --一阳指法
    412,  --陷阱
    97,   --太极拳经
    308,  --鲸息功
    411,  --炸弹
    470,  --葵花神针功
    174,  --银两
    267,  --神行百变
    411,  --炸弹
    135,  --火焰刀法
    411,  --炸弹
    90,   --大金刚掌
    412,  --陷阱
    64,   --北冥神功
    411,  --炸弹
    174,  --银两
    297,  --瞬息千里
    411,  --炸弹
    68,   --混元功法
    411,  --炸弹
    539,  --龙啸九天
    412,  --陷阱
    174,  --银两
    387,  --神足经
    411,  --炸弹
    388,  --天刀九问
    16,   --千年人参
    411,  --炸弹
    78,   --辟邪剑法
    411,  --炸弹
    79,   --八荒六合功
    174,  --银两
    80,   --太玄经
    411,  --炸弹
    84,   --九阴真经
    174,  --银两
    412,  --陷阱
    336,  --武穆遗书
    411   --炸弹
    }
    for i = 1, 25 do
        wpbh[i] = JY.Person[460 + i]["携带物品4"]
    end
    DS = JY.Person[318]["武学常识"]
    Z = Z + DS
    JY.Person[318]["资质"] = Z
    if wp2[wpbh[Z]] == 411 then
        if JY.Person[318]["中毒程度"] == 1 then
            JY.Person[318]["中毒程度"] = 0
            DH("踩到炸弹了！！")
            DH("呼~~还好你用了免伤卡！")
            DH("毫发未伤！")
        else
            DH("踩到炸弹了，好可惜哦！！")
            DH("下次一定会赢大的，加油！")
            DH("本局结束，欢迎下次再来～")
            fuyuan()
            return 0
        end
    end
    if wp2[wpbh[Z]] == 412 then
        if JY.Person[318]["中毒程度"] == 1 then
            JY.Person[318]["中毒程度"] = 0
            DH("唉～～ 掉进陷阱了！！！！")
            DH("哦也，你之前用了免伤卡！")
            DH("毫发未伤！继续！！")
        else
            DH("唉～～ 掉进陷阱了！！")
            DH("期待下一次好运气！")
            DH("本局结束，欢迎下次再来～")
            fuyuan()
            return 0
        end
    end
    if JY.Person[318]["携带物品数量1"] == 11 then
        js3()
    end
    if wp2[wpbh[Z]] ~= 411 and wp2[wpbh[Z]] ~= 412 then
        if wp2[wpbh[Z]] == 174 then
            local yl = math.random(70, 499)
            DH("恭喜您得到了" .. yl .. JY.Thing[wp2[wpbh[Z]]]["名称"])
            JY.Person[318]["携带物品数量2"] = JY.Person[318]["携带物品数量2"] + yl
        elseif JY.Person[318]["攻击带毒"] ~= 99 then
            DH("恭喜您得到了" .. JY.Thing[wp2[wpbh[Z]]]["名称"])
            JY.Person[318]["携带物品2"] = JY.Person[318]["携带物品2"] + 1
            local hdcs = JY.Person[318]["携带物品2"]
            JY.Person[460 + hdcs]["携带物品数量4"] = wp2[wpbh[Z]]
        end
    end
    if JY.Person[318]["攻击带毒"] ~= 99 then
        xd()
    end
end

function js3()
    DH("恭喜您获得了大礼包！")
    DH("本次礼包包括：")
    local dlb = math.random(1, 4)
    if dlb == 1 then
        DH("1.五系值+5 2.套装一套 ")
        JY.Person[318]["携带物品数量1"] = 21
    end
    if dlb == 2 then
        DH("1.攻击力+50 2.套装一套 ")
        JY.Person[318]["携带物品数量1"] = 22
    end
    if dlb == 3 then
        DH("1.防御力+50 2.套装一套 ")
        JY.Person[318]["携带物品数量1"] = 23
    end
    if dlb == 4 then
        DH("1.轻功+50 2.套装一套 ")
        JY.Person[318]["携带物品数量1"] = 24
    end
    SetS(52, 2, 1, 5, GetS(52, 2, 1, 5) + 1)
    DH("终点就在眼前了，加油！")
    xd()
end

function PDHZ()
    local num = 0
    for i = 1, 34 do
        if hasHZ(i) == true then
            num = num + 1
        end
    end
    if num == 34 then
        return 35
    end
    local hz = math.random(1, 34)
    if hasHZ(hz) == true then
        return PDHZ()
    else
        return hz
    end
end

function js2()
    DH("恭喜通关！！！！！")
    DH("干得漂亮！您真是太帅了！")
    DH("这是本次全部奖品请收好！")
    DH("欢迎下次光临。")
    local hdcs = JY.Person[318]["携带物品2"]
    local hdjq = JY.Person[318]["携带物品数量2"]
    if JY.Person[318]["解毒能力"] == 1 then
        DrawStrBoxWaitKey("福神显灵，5000银两，无极丹1枚，60技能点", C_GOLD, CC.DefaultFont)
        --addHZ2()
		instruct_2(174, 5000)    --得到或失去物品
		instruct_2(348,1)        --得到无极丹
		JY.Person[523]["声望"] = JY.Person[523]["声望"] + 60
    end
    if JY.Person[318]["携带物品数量1"] == 21 then
        DrawStrBoxWaitKey("大礼包奖励：五系兵器值+15", C_GOLD, CC.DefaultFont)
        AddPersonAttrib(0, "拳掌功夫", 15)
        AddPersonAttrib(0, "御剑能力", 15)
        AddPersonAttrib(0, "耍刀技巧", 15)
        AddPersonAttrib(0, "特殊兵器", 15)
		AddPersonAttrib(0, "指法技巧", 15)
        --addHZ2()
		local n = 548+3*math.random(0,129)
		instruct_2(Setmeal[n][1], 1)
		instruct_2(Setmeal[n][2], 1)
		instruct_2(Setmeal[n][3], 1) 
        JY.Person[318]["携带物品数量1"] = 0
    end
    if JY.Person[318]["携带物品数量1"] == 22 then
        DrawStrBoxWaitKey("大礼包奖励：攻击力+50", C_GOLD, CC.DefaultFont)
        AddPersonAttrib(0, "攻击力", 50)
        --addHZ2()
		local n = 548+3*math.random(0,129)
		instruct_2(Setmeal[n][1], 1)
		instruct_2(Setmeal[n][2], 1)
		instruct_2(Setmeal[n][3], 1)
		
        JY.Person[318]["携带物品数量1"] = 0
    end
    if JY.Person[318]["携带物品数量1"] == 23 then
        DrawStrBoxWaitKey("大礼包奖励：防御力+50", C_GOLD, CC.DefaultFont)
        AddPersonAttrib(0, "防御力", 50)
        --addHZ2()
		local n = 548+3*math.random(0,129)
		instruct_2(Setmeal[n][1], 1)
		instruct_2(Setmeal[n][2], 1)
		instruct_2(Setmeal[n][3], 1)
        JY.Person[318]["携带物品数量1"] = 0
    end
    if JY.Person[318]["携带物品数量1"] == 24 then
        DrawStrBoxWaitKey("大礼包奖励：轻功+50", C_GOLD, CC.DefaultFont)
        AddPersonAttrib(0, "轻功", 50)
        --addHZ2()
		local n = 548+3*math.random(0,129)
		instruct_2(Setmeal[n][1], 1)
		instruct_2(Setmeal[n][2], 1)
		instruct_2(Setmeal[n][3], 1)
        JY.Person[318]["携带物品数量1"] = 0
    end
    if 0 < hdcs then
        for i = 1, hdcs do
            instruct_2(JY.Person[460 + i]["携带物品数量4"], 1)
        end
    else
        DrawStrBoxWaitKey("没有获得任何物品", C_GOLD, CC.DefaultFont)
    end
    if 0 < hdjq then
        instruct_2(174, hdjq)
    else
        DrawStrBoxWaitKey("没有获得银两", C_GOLD, CC.DefaultFont)
    end
    fuyuan()
    return 0
end

function fuyuan()
    JY.Person[318]["携带物品4"] = 0
    JY.Person[318]["携带物品数量4"] = 0
    JY.Person[318]["携带物品3"] = 0
    JY.Person[318]["携带物品数量3"] = 0
    JY.Person[318]["携带物品2"] = 0
    JY.Person[318]["携带物品数量2"] = 0
    JY.Person[318]["携带物品数量1"] = 0
    for i = 1, 25 do
        JY.Person[460 + i]["携带物品4"] = 0
        JY.Person[460 + i]["携带物品数量4"] = 0
    end
end

function yksz()
    local size = CC.DefaultFont
    local width = 19 * size
    local h = size + CC.PersonStateRowPixel
    local height = 15 * h
    local dx = (CC.ScreenW - width) / 2
    local dy = (CC.ScreenH - height) / 2
    local menu = {
    {
      "1",
      nil,
      1
    },
    {
      "2",
      nil,
      1
    },
    {
      "3",
      nil,
      1
    },
    {
      "4",
      nil,
      1
    },
    {
      "5",
      nil,
      1
    },
    {
      "6",
      nil,
      1
    }
        }
    local r = ShowMenu(menu, #menu, 6, dx + 470, dy + 320, 0, 0, 1, 1, 30, C_ORANGE, C_WHITE)
    if r == 1 then
        JY.Person[318]["左右互搏"] = 1
        JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] - 1
        return 1
    end
    if r == 2 then
        JY.Person[318]["左右互搏"] = 2
        JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] - 1
        return 1
    end
    if r == 3 then
        JY.Person[318]["左右互搏"] = 3
        JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] - 1
        return 1
    end
    if r == 4 then
        JY.Person[318]["左右互搏"] = 4
        JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] - 1
        return 1
    end
    if r == 5 then
        JY.Person[318]["左右互搏"] = 5
        JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] - 1
        return 1
    end
    if r == 6 then
        JY.Person[318]["左右互搏"] = 6
        JY.Person[318]["医疗能力"] = JY.Person[318]["医疗能力"] - 1
        return 1
    end
    if r <= 0 then
        return 1
    end
end

function dj()
    if JY.Person[318]["医疗能力"] == 0 and JY.Person[318]["受伤程度"] == 0 and JY.Person[318]["抗毒能力"] == 0 then
        DH("没有道具可用.")
        return 0
    end
    local size = CC.DefaultFont
    local width = 19 * size
    local h = size + CC.PersonStateRowPixel
    local height = 15 * h
    local dx = (CC.ScreenW - width) / 2
    local dy = (CC.ScreenH - height) / 2
    local menu = {
    {
      "遥控色子x" .. JY.Person[318]["医疗能力"],
      yksz,
      1
    },
    {
      "免伤卡x" .. JY.Person[318]["受伤程度"],
      nil,
      1
    },
    {
      "福神卡x" .. JY.Person[318]["抗毒能力"],
      nil,
      1
    }
        }
    if JY.Person[318]["医疗能力"] == 0 then
        menu[1][3] = 0
    end
    if JY.Person[318]["受伤程度"] == 0 then
        menu[2][3] = 0
    end
    if JY.Person[318]["抗毒能力"] == 0 then
        menu[3][3] = 0
    end
    local r = ShowMenu(menu, #menu, 2, dx + 470, dy + 230, 0, 0, 1, 1, 30, C_ORANGE, C_WHITE)
    if r == 2 then
        JY.Person[318]["受伤程度"] = JY.Person[318]["受伤程度"] - 1
        JY.Person[318]["中毒程度"] = 1
        DH("您使用了免伤卡.")
        DH("炸弹和陷阱无效一次.")
    end
    if r == 3 then
        JY.Person[318]["抗毒能力"] = JY.Person[318]["抗毒能力"] - 1
        JY.Person[318]["解毒能力"] = 1
        DH("您使用了福神卡.")
        DH("通关后增加套装奖励，福气啦！")
    end
    if r <= 0 then
        return 0
    end
end

function xd()
    local size = CC.DefaultFont
    local width = 19 * size
    local h = size + CC.PersonStateRowPixel
    local height = 15 * h
    local dx = (CC.ScreenW - width) / 2
    local dy = (CC.ScreenH - height) / 2
    local DS = 0
    local SZ = math.random(1, 6)
    local a = 0
    local menu = {
    {
      "摇点",
      nil,
      1
    },
    {
      "使用道具",
      dj,
      2
    },
    {
      "秘技",
      nil,
      3
    },
    {
      "点播",
      nil,
      4
    }
        }
    local r = ShowMenu(menu, 4, 2, dx + 470, dy + 130, 0, 0, 1, 0, 30, C_ORANGE, C_WHITE)
    if r == 1 then
        for i = 1, SZ do
            a = math.random(401, 406)
            lib.LoadPNG(91, a * 2, CC.ScreenW / 2 - 70, CC.ScreenH / 2 + 15, 1)
            ShowScreen()
            lib.Delay(20)
        end
        for i = 1, SZ do
            a = math.random(401, 406)
            lib.LoadPNG(91, a * 2, CC.ScreenW / 2 - 70, CC.ScreenH / 2 + 15, 1)
            ShowScreen()
            lib.Delay(50)
            if i >= SZ - 5 then
                lib.Delay(100)
            end
            if i >= SZ - 2 then
                lib.Delay(400)
            end
        end
        a = math.random(401, 406)
        if JY.Person[318]["左右互搏"] == 1 then
            a = 401
        end
        if JY.Person[318]["左右互搏"] == 2 then
            a = 402
        end
        if JY.Person[318]["左右互搏"] == 3 then
            a = 403
        end
        if JY.Person[318]["左右互搏"] == 4 then
            a = 404
        end
        if JY.Person[318]["左右互搏"] == 5 then
            a = 405
        end
        if JY.Person[318]["左右互搏"] == 6 then
            a = 406
        end
		
		
        --lib.PicLoadCache(2, a * 2, CC.ScreenW / 2 - 70, CC.ScreenH / 2 + 15, 1)
		lib.LoadPNG(91, a * 2, CC.ScreenW / 2 - 70, CC.ScreenH / 2 + 15, 1)
        ShowScreen()
        lib.Delay(1)
        DS = a - 400
        JY.Person[318]["武学常识"] = DS
        ShowScreen()
        lib.Delay(800)
        DH(DS .. "点！")
        JY.Person[318]["左右互搏"] = 0
        ys()
    end
    if r == 2 then
    end
    if r == 3 then
        DH("本次版本，暂未开启.")
        xd()
    end
    if r == 4 then
        DH("本次版本，暂未开启.")
        xd()
    end
end

function ys()
    local DS = JY.Person[318]["武学常识"]
    for i = 1, DS do
        zg1(i)
        if JY.Person[318]["攻击带毒"] == 99 then
            break
        end
    end
    if JY.Person[318]["攻击带毒"] ~= 99 then
        js()
    end
end

function zg4()
    local HK = CONFIG.PicturePath .. "H01.png"
    local FK = CONFIG.PicturePath .. "F01.png"
    local DS = 1
    local ZDS = JY.Person[318]["携带物品数量3"]
    local x3 = 347
    local y3 = 324
    y3 = y3 - ZDS * 93
    lib.LoadPicture(FK, CC.ScreenW / 2 + x3, CC.ScreenH / 2 - y3)
    lib.LoadPicture(HK, CC.ScreenW / 2 + x3, CC.ScreenH / 2 - y3 + DS * 93)
    ShowScreen()
    lib.Delay(600)
    JY.Person[318]["携带物品数量3"] = JY.Person[318]["携带物品数量3"] + DS
    if -y3 + DS * 93 == 48 then
        JY.Person[318]["携带物品数量1"] = 11
    end
    if -y3 + DS * 93 >= 136 then
        JY.Person[318]["攻击带毒"] = 99
        js2()
    end
end

function zg3()
    local HK = CONFIG.PicturePath .. "H01.png"
    local FK = CONFIG.PicturePath .. "F01.png"
    local DS = 1
    local ZDS = JY.Person[318]["携带物品3"]
    local x2 = -373
    local y2 = 324
    x2 = x2 + ZDS * 90
    lib.LoadPicture(FK, CC.ScreenW / 2 - 373, CC.ScreenH / 2 - 321)
    ShowScreen()
    if 2 < JY.Person[318]["品德"] then
        zg4()
    elseif x2 == 347 then
        JY.Person[318]["品德"] = 3
        zg4()
    else
        lib.LoadPicture(FK, CC.ScreenW / 2 + x2, CC.ScreenH / 2 - y2)
        lib.LoadPicture(HK, CC.ScreenW / 2 + x2 + DS * 90, CC.ScreenH / 2 - y2)
        ShowScreen()
        lib.Delay(600)
        JY.Person[318]["携带物品3"] = JY.Person[318]["携带物品3"] + DS
    end
end

function zg2()
    local HK = CONFIG.PicturePath .. "H01.png"
    local FK = CONFIG.PicturePath .. "F01.png"
    local DS = 1
    local ZDS = JY.Person[318]["携带物品数量4"]
    local x1 = 373
    local y1 = 231
    y1 = y1 - ZDS * 92
    if 1 < JY.Person[318]["品德"] then
        zg3()
    elseif y1 == -321 then
        JY.Person[318]["品德"] = 2
        zg3()
    else
        lib.LoadPicture(FK, CC.ScreenW / 2 - x1, CC.ScreenH / 2 + y1)
        lib.LoadPicture(HK, CC.ScreenW / 2 - x1, CC.ScreenH / 2 + y1 - DS * 92)
        ShowScreen()
        lib.Delay(600)
        JY.Person[318]["携带物品数量4"] = JY.Person[318]["携带物品数量4"] + DS
    end
end

function zg1()
    local HK = CONFIG.PicturePath .. "H01.png"
    local FK = CONFIG.PicturePath .. "F01.png"
    local DS = 1
    local ZDS = JY.Person[318]["携带物品4"]
    local x = 347
    local y = 231
    x = x - ZDS * 90
    if JY.Person[318]["品德"] > 0 then
        zg2()
    elseif x == -373 then
        JY.Person[318]["品德"] = 1
        zg2()
    else
        lib.LoadPicture(FK, CC.ScreenW / 2 + x, CC.ScreenH / 2 + y)
        lib.LoadPicture(HK, CC.ScreenW / 2 + x - DS * 90, CC.ScreenH / 2 + y)
        ShowScreen()
        lib.Delay(600)
        JY.Person[318]["携带物品4"] = JY.Person[318]["携带物品4"] + DS
    end
end

function DH(str)
    local menu = {
    {
      str,
      nil,
      1
    }
        }
    local ll = #str
    local size = 30
    local w = size * ll / 2 + 2 * CC.MenuBorderPixel
    local h = size + 2 * CC.MenuBorderPixel
    local x = (CC.ScreenW - size / 2 * ll - 2 * CC.MenuBorderPixel) / 2 + 30
    local y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2 + 148
    ShowMenu(menu, 1, 0, x, y, 0, 0, 1, 0, size, C_ORANGE, C_WHITE)
end

function TalkEx3(s, pid, flag, name)
    lib.PicLoadFile(CONFIG.DataPath .. "CJ.idx", CONFIG.DataPath .. "CJ.grp", 87)
    local cs = GetS(52, 2, 1, 5)
    local pd = GetS(52, 4, 1, 5)
    local tx
    local picw = 130
    local pich = 130
    local talkxnum = 24
    local talkynum = 3
    local dx = 10
    local dy = 10
    local boxpicw = picw + 10
    local boxpich = pich + 10
    local boxtalkw = talkxnum * CC.DefaultFont + 10
    local boxtalkh = boxpich + 10
    pid = pid or 0
    if flag == nil then
        if pid == 0 then
            flag = 1
        else
            flag = 0
        end
    end
    name = name or JY.Person[318]["姓名"]
    local talkBorder = (pich - talkynum * CC.DefaultFont) / (talkynum + 1) + 5
    local xy = {
    {
      headx = 0,
      heady = 0,
      talkx = (CC.ScreenW - dx - boxpicw - boxtalkw + 140) / 2,
      talky = CC.ScreenH - dy - boxpich - 40,
      namex = (CC.ScreenW - dx + boxpicw + 990) / 2,
      namey = CC.ScreenH - dy - boxpich - 20,
      showhead = 1
    }
        }
    if flag ~= 1 then
        flag = 1
    end
    local headid = pid
    if xy[flag].showhead == 0 then
        headid = -1
    end
    if CONFIG.KeyRepeat == 0 then
        lib.EnableKeyRepeat(0, CONFIG.KeyRepeatInterval)
    end
    lib.GetKey()
    local readstr = function(str)
    local T1 = {
      "０",
      "１",
      "２",
      "３",
      "４",
      "５",
      "６",
      "７",
      "８",
      "９"
    }
    local T2 = {
      {"Ｒ", C_RED},
      {"Ｇ", C_GOLD},
      {"Ｂ", C_BLACK},
      {"Ｗ", C_WHITE},
      {"Ｏ", C_ORANGE}
    }
    local T3 = {
      {
        "Ｈ",
        CC.FontNameSong
      },
      {
        "Ｓ",
        CC.FontNameHei
      },
      {
        "Ｆ",
        CC.FontName
      }
    }
    for i = 0, 9 do
        if T1[i + 1] == str then
            return 1, i * 50
        end
    end
    for i = 1, 5 do
        if T2[i][1] == str then
            return 2, T2[i][2]
        end
    end
    for i = 1, 3 do
        if T3[i][1] == str then
            return 3, T3[i][2]
        end
    end
    return 0
    end
    local mydelay = function(t)
        if t <= 0 then
            return
        end
        lib.ShowSurface(0)
        lib.Delay(t)
    end
    local page, cy, cx = 0, 0, 0
    local color, t, font = C_WHITE, 0, CC.FontName
    while 1 < string.len(s) do
        if page == 0 then
            Cls()
            if pd == 0 then
                if cs <= 3 then
                    tx = 11
                elseif 3 < cs and cs <= 6 then
                    tx = math.random(11, 12)
                elseif 6 < cs and cs <= 9 then
                    tx = math.random(11, 13)
                elseif 9 < cs and cs <= 12 then
                    tx = math.random(11, 14)
                elseif 12 < cs and cs <= 15 then
                    tx = math.random(11, 15)
                elseif 15 < cs then
                    tx = math.random(11, 16)
                end
                SetS(52, 3, 1, 5, tx)
            else
                tx = GetS(52, 3, 1, 5)
            end
            lib.PicLoadCache(87, tx * 2, xy[flag].namex - 490, xy[flag].namey - 330, 1)
            MyDrawString(xy[flag].namex - 750, xy[flag].namex, xy[flag].namey - 60, name, C_GOLD, 42)
            DrawBox(xy[flag].talkx, xy[flag].talky, xy[flag].talkx + boxtalkw, xy[flag].talky + boxtalkh, C_WHITE)
            page = 1
        end
        local str
        if string.find(s, "*") ~= nil then
            s = GenTalkString(s, 24)
        end
        str = string.sub(s, 1, 1)
        if str == "*" then
            str = "Ｈ"
            s = string.sub(s, 2, -1)
        else
            str = string.sub(s, 1, 2)
            s = string.sub(s, 3, -1)
        end
        if str == "Ｈ" then
            cx = 0
            cy = cy + 1
        if cy == 3 then
            cy = 0
            page = 0
        end
    elseif str == "Ｐ" then
        cx = 0
        cy = 0
        page = 0
    elseif str == "ｐ" then
        ShowScreen()
        WaitKey()
        lib.Delay(100)
    elseif str == "Ｎ" then
        s = JY.Person[318]["姓名"] .. s
    elseif str == "ｎ" then
        s = JY.Person[318]["姓名"] .. s
    else
        local kz1, kz2 = readstr(str)
        if kz1 == 1 then
            t = kz2
        elseif kz1 == 2 then
            color = kz2
        elseif kz1 == 3 then
            font = kz2
        else
            lib.DrawStr(xy[flag].talkx + CC.DefaultFont * cx + 5, xy[flag].talky + (CC.DefaultFont + talkBorder) * cy + talkBorder + 0, str, color, CC.DefaultFont, font, 0, 0)
            mydelay(t)
            cx = cx + 1
            if cx == talkxnum then
                cx = 0
                cy = cy + 1
                if cy == talkynum then
                    cy = 0
                    page = 0
                end
            end
        end
    end
    if page == 0 or 2 > string.len(s) then
        ShowScreen()
        WaitKey()
        lib.Delay(100)
    end
    end
    if CONFIG.KeyRepeat == 0 then
        lib.EnableKeyRepeat(CONFIG.KeyRepeatDelay, CONFIG.KeyRepeatInterval)
    end
    Cls()
end

function instruct_2_sub()
    if JY.Person[0]["声望"] < 200 then
        return 
    end
    if instruct_18(189) == true then
        return 
    end
    local booknum = 0
    for i = 1, CC.BookNum do
        if instruct_18(CC.BookStart + i - 1) == true then
            booknum = booknum + 1
        end
    end
    if booknum == CC.BookNum then
        instruct_3(70, 11, -1, 1, 932, -1, -1, 7968, 7968, 7968, -2, -2, -2)
    end
end

function NQBF(pid)
	if WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] >= 100 then
		return true
	else
	    return false
	end
end

function BNJQ(pid)
	if NQBF(pid) and WAR.LQZ[pid] ~= nil and WAR.LQZ[pid] >= 100 then
		if WAR.QX1[pid] ~= nil then
			return false
		else	
			return true
		end	
	else	
	  return false
	end	
end

function ZYBF(pid)
	if WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[pid] >= 200 then
		return true
	else 
		return false
	end	
end

function ZYJQ(pid)
	if ZYBF(pid) and WAR.SPIRIT[pid] ~= nil and WAR.SPIRIT[pid] >= 200 then
		return true
	else	
	    return false
	end 	
end

function Jianxuefusheng(pid)
	if match_ID(pid,520) then
	    return true
	end
	if MPPD(pid) == 11 and MPDJ(pid) >= 2 and Curr_NG(pid,152) then
		return true
	end 
end

--标准主角
function actor(id,n)
	if id == 0 and JY.Base["标准"] == n then 
		return true 
	end
	return false
end


Ct['融合武功'] = function (id,wglx)
	local k = JY.Person[id]
	--local menuwai = {}
	local menu  = {}
	local ng = 0
	for i = 1, JY.Base['武功数量'] do
		if JY.Person[id]["武功"..i] > 0 then
			local kfname = JY.Wugong[k['武功'..i]]["名称"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["武功"..i] > 0 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['武功'..i]]["武功类型"] == wglx then
					ng = ng + 1
					menu[i][3] = 1
				end
			end	
		end	
	end
	if ng < 2 then
		if wglx == 6 then
			QZXS('所会内功数量不足二个')
		elseif wglx == 7 then
			QZXS('所会轻功数量不足二个')
		end		
		do return end
	end	
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng1 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"选择第一武功")
    if ng1 == 0 then
		return
	end
	menu  = {}
	for i = 1, JY.Base['武功数量'] do
		if JY.Person[id]["武功"..i] > 0 then
			local kfname = JY.Wugong[k['武功'..i]]["名称"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["武功"..i] > 0 and i ~= ng1 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['武功'..i]]["武功类型"] == wglx  then
					menu[i][3] = 1
				end
			end	
		end	
	end
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng2 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"选择第二武功")
    if ng2 == 0 then
		return
	end
	local rh = 0
	if wglx == 6 then
		rh = 354
	elseif wglx == 7 then
		rh = 380
	end		
	local name = ""
	if wglx == 6 then
		if DrawStrBoxYesNo(-1, -1, "是否要为融合内功命名？【选否则为Config中的预设名称】", C_WHITE, CC.DefaultFont) then
			name = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
		else
			name = CONFIG.WoNGName	
		end		
	elseif wglx == 7 then
		if DrawStrBoxYesNo(-1, -1, "是否要为融合轻功命名？【选否则为Config中的预设名称】", C_WHITE, CC.DefaultFont) then
			name = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
		else
			name = CONFIG.WoQGName
		end	
	end	
	if ng1 > 0 and ng2 > 0 then
		JY.Wugong[rh]['名称'] = name
		JY.Wugong[rh]['冰封系数'] = JY.Person[id]['武功'..ng1]
		JY.Wugong[rh]['灼烧系数'] = JY.Person[id]['武功'..ng2]
		JY.Person[id]["武功"..ng1] = rh
		JY.Person[id]["武功等级"..ng1] = 999
		--JY.Person[id]['主运内功'] = rh
		if ng2 == JY.Base["武功数量"] then
			JY.Person[0]["武功" .. JY.Base["武功数量"]] = 0
			JY.Person[0]["武功等级" .. JY.Base["武功数量"]] = 0
		else
			for i = ng2, JY.Base['武功数量'] - 1 do
				if JY.Person[id]["武功"..i] > 0  then
					JY.Person[id]["武功"..i] = JY.Person[id]["武功"..i+1]
					JY.Person[id]["武功等级"..i] = JY.Person[id]["武功等级"..i+1]
				end	
			end
			JY.Person[0]["武功" .. JY.Base["武功数量"]] = 0
			JY.Person[0]["武功等级" .. JY.Base["武功数量"]] = 0
		end	
	end	
end

Ct['融合武功2'] = function (id,wglx)
	local k = JY.Person[id]
	--local menuwai = {}
	local menu  = {}
	local ng = 0
	for i = 1, JY.Base['武功数量'] do
		if JY.Person[id]["武功"..i] > 0 then
			local kfname = JY.Wugong[k['武功'..i]]["名称"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["武功"..i] > 0 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['武功'..i]]["武功类型"] == wglx then
					ng = ng + 1
					menu[i][3] = 1
				end
			end	
		end	
	end
	if ng < 2 then
		if wglx == 6 then
			QZXS('所会内功数量不足二个')
		elseif wglx == 7 then
			QZXS('所会轻功数量不足二个')
		end		
		do return end
	end	
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng1 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"选择第一武功")
    if ng1 == 0 then
		return
	end
	menu  = {}
	for i = 1, JY.Base['武功数量'] do
		if JY.Person[id]["武功"..i] > 0 then
			local kfname = JY.Wugong[k['武功'..i]]["名称"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["武功"..i] > 0 and i ~= ng1 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['武功'..i]]["武功类型"] == wglx  then
					menu[i][3] = 1
				end
			end	
		end	
	end
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng2 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"选择第二武功")
    if ng2 == 0 then
		return
	end
	local rh = 0
	if wglx == 6 then
		rh = 381
	elseif wglx == 7 then
		rh = 380
	end		
	local name = ""
	if wglx == 6 then
		if DrawStrBoxYesNo(-1, -1, "是否要为融合内功命名？【选否则为Config中的预设名称】", C_WHITE, CC.DefaultFont) then
			name = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
		else
			name = CONFIG.WoNGName2	
		end		
	elseif wglx == 7 then
		if DrawStrBoxYesNo(-1, -1, "是否要为融合轻功命名？【选否则为Config中的预设名称】", C_WHITE, CC.DefaultFont) then
			name = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
		else
			name = CONFIG.WoQGName2
		end	
	end	
	if ng1 > 0 and ng2 > 0 then
		JY.Wugong[rh]['名称'] = name
		JY.Wugong[rh]['冰封系数'] = JY.Person[id]['武功'..ng1]
		JY.Wugong[rh]['灼烧系数'] = JY.Person[id]['武功'..ng2]
		JY.Person[id]["武功"..ng1] = rh
		JY.Person[id]["武功等级"..ng1] = 999
		--JY.Person[id]['主运内功'] = rh
		if ng2 == JY.Base["武功数量"] then
			JY.Person[0]["武功" .. JY.Base["武功数量"]] = 0
			JY.Person[0]["武功等级" .. JY.Base["武功数量"]] = 0
		else
			for i = ng2, JY.Base['武功数量'] - 1 do
				if JY.Person[id]["武功"..i] > 0  then
					JY.Person[id]["武功"..i] = JY.Person[id]["武功"..i+1]
					JY.Person[id]["武功等级"..i] = JY.Person[id]["武功等级"..i+1]
				end	
			end
			JY.Person[0]["武功" .. JY.Base["武功数量"]] = 0
			JY.Person[0]["武功等级" .. JY.Base["武功数量"]] = 0
		end	
	end	
end

Ct['遗忘天赋'] = function()
	local menu = {}
	local menu1 = {}
	for i,v in pairs(CC.PTF[0]) do 
		if v > 0 and CC.PTFSM[i] ~= nil then
			menu[#menu+1]={CC.PTFSM[i][1],nil, 1}--竹风雨滴＆tony：开放昆仑派
			menu1[#menu1+1] = i
		end	
	end
	if menu1 ~= nil and #menu1 > 0 then
		local TF = ShowMenu(menu, #menu, 22, CC.MainSubMenuX-80, CC.MainSubMenuY, 0, 0, 1, 1, CC.DefaultFont, M_YellowGreen, C_WHITE)
		if TF > 0 then
		    CC.PTF[0][menu1[TF]] = nil
		    QZXS(JY.Person[0]['姓名']..'已遗忘「'..menu[TF][1]..'」天赋')
		end
	else
		QZXS('没有可遗忘的天赋')
	end		
	do return end
end