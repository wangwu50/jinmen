function IncludeFile()
	package.path=CONFIG.ScriptLuaPath;  --?????????¡¦??
	require("jyconst")					--??????????????????require????????????
	--require("MP")
	require("jywar")
	require("jyacvmts")
	require("kdef")
	require("ItemInfo")
	require("Random mission")
	require("nino_gambling_event")
end
OEVENTLUA = {}		 --????¡Á???
function SetGlobal()  	 --???????¡¦??????????????????
	JY={};

	JY.Status=GAME_INIT; --???¡¦???¡ã¡Á???
	--????R??????
	JY.Base={};          --????????
	JY.PersonNum=0;      --????????
	JY.Person={};        --????????
	JY.ThingNum=0        --???¡¦????
	JY.Thing={};         --???¡¦????
	JY.SceneNum=0        --???¡ã????
	JY.Scene={};         --???¡ã????
	JY.WugongNum=0       --???¡¦????
	JY.Wugong={};        --???¡¦????
	JY.ShopNum=0 		 --????????
	JY.Shop={};    		 --????????
   
	JY.MyCurrentPic = 0		--?¡Â?????¡ã¡Á??¡¦????????????????????
	JY.MyPic = 0     		--?¡Â?????¡ã????
	JY.Mytick = 0			--?¡Â??????¡Á??¡¦??????????
	JY.MyTick2 = 0			--??????????????????
	JY.LOADTIME = 0
	JY.SAVETIME = 0
	JY.GTIME = 0			--???¡¦????
	JY.GOLD = 0				--???¡¦????
	JY.YEAR = 1
	JY.MONTH = 1
	JY.DAY = 1
	
	JY.ZLXF = 0	             --???¨²??¡¦¡§????
	JY.CLXF = 0	             --???¨²??¡¦¡§????
	
	JY.DIFF = 1

	JY.SubScene=-1;         --???¡ã¡Á????¡ã????
	JY.SubSceneX=0;         --¡Á????¡ã?????????????????¡ã????????????
	JY.SubSceneY=0;
	JY.ThingUse = -1;
	JY.Darkness=0;          --=0 ??????????????=1 ????????????????

	JY.CurrentD=-1;         --???¡ã?¡Â??D*??????
	JY.OldDPass=-1;         --??????¡¦??¡¦????????D*????, ??????????¡¦?
	JY.CurrentEventType=-1  --???¡ã??¡¦???????¡¦??? 1 ???¨½ 2 ???¡¦ 3 ?¡¦??

	JY.CurrentThing=-1;     --???¡ã???¨½???¡¦????¡¦?????????

	JY.MmapMusic=-1;        --?????¨®??????????¡¦????¡Â???????????????????¨¾??¡¦???????

	JY.CurrentMIDI=-1;      --???¡ã??¡¦???????id??????????????????????????id??
	JY.EnableMusic=1;       --??¡¦¨½??¡¦????? 1 ??¡¦???0 ????¡¦?
	JY.EnableSound=1;       --??¡¦¨½??¡¦????¡ì 1 ??¡¦???0 ????¡¦?

	WAR={};					--???¡¦?????????????? ???????????????¨¾?????¨¾?¨®???????¨ª?¡§????????????????????????WarSetGlobal??????

	AutoMoveTab = {[0] = 0}
	
	JY.Restart = 0			--¡¦??????¡¦????????
	JY.WalkCount = 0		--¡Á??¡¦????
	
	
	IsViewingKungfuScrolls = 0
	
	Achievements = {}
	Achievements.pChar = {}
	
	YC={}
	YC.ZJH = 0				--?????¡Â????????
end

function JY_Main()        --?¡Â???¨¾????
	os.remove("debug.txt");      	  --???????¡ã??debug????
    xpcall(JY_Main_sub,myErrFun);     --???¨½?¡Â???¨ª?¨®
end

function myErrFun(err)      --?¨ª?¨®???¨ª???¨¾???¨ª?¨®????
    lib.Debug(err);                 --?????¨ª?¨®????
    lib.Debug(debug.traceback());   --?????¡Â??????????
end

function JY_Main_sub()		--?????????¡¦?¡Â???¨¾????
	Ct = {};
    IncludeFile();			--???????????¨¦
    SetGlobalConst2();		--????????????CC, ???¨¾??????????
    SetGlobal();			--????????????JY

    --????¡¦???????????
    setmetatable(_G,{ __newindex =function (_,n)
                       error("attempt read write to undeclared variable " .. n,2);
                       end,
                       __index =function (_,n)
                       error("attempt read read to undeclared variable " .. n,2);
                       end,
                     }  );
					
	
    lib.Debug("JY_Main start.");

	math.randomseed(os.time());			--?????????¨²??¡¦??¨²?¡Â

    JY.Status=GAME_START;				--???????¡¦¡Á???

    lib.PicInit(CC.PaletteFile);		--??????????256???¡Â??¡ã?
	
	lib.FillColor(0,0,0,0,0);
	--????
	lib.LoadPNGPath(CC.ThingPath, 2, CC.ThingNum, limitX(CC.ScreenW/1360*100,0,100))	--????????PNG???????¡¦??
	--lib.LoadPNGPath(CC.Head1Path, 2, CC.Head1Num, limitX(CC.ScreenW/1360*100,0,100))	--????????PNG???????¡¦??
	-- lib.PicLoadFile(CC.WMAPPicFile[1], CC.WMAPPicFile[2], 0)
	-- lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,100))	--????????PNG???????¡¦??
	-- lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)			--???¡¦?????????????¨¾2
	-- lib.PicLoadFile(CC.EFTFile[1], CC.EFTFile[2], 3)								--???¡ì?????????????¨¾3
	-- lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	--¡ã??¨ª?¨®
	-- lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI	
	-- lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92) 
	lib.LoadPNGPath(CC.BJPath, 92, CC.BJNum, limitX(CC.ScreenW/1360*100,0,100))	--????????PNG???????¡¦??
	-- lib.LoadPNGPath('./data/mmap',93,-1,100)
	-- lib.LoadPNGPath('./data/smap',94,-1,100)
	-- lib.LoadPNGPath(CC.PTPath, 95, CC.PTNum, limitX(CC.ScreenW/1360*100,0,100))
	-- lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.LoadPNGPath('./data/thing',0,-1,100)
	-- --97????????????????
	-- lib.LoadPNGPath(CC.IconPath, 98, CC.IconNum, limitX(CC.ScreenW/1360*100,0,100))	--¡Á????????????????¨¾98
	-- lib.LoadPNGPath(CC.HeadPath, 99, CC.HeadNum, 26.923076923)						--???????¡¦?¨½?????????????????????¨¾99
	--
	
	local pic = {"1000.png","1001.png","1002.png","1003.png"}
	
	CC.FirstFile=CONFIG.PicturePath..pic[math.random(4)];
	
	while true do
		if JY.Restart == 1 then
			JY.Restart = 0
			JY.Status=GAME_START;
		end
		if JY.Status == GAME_END then
			break;
		end
		
		PlayMIDI(75);
		Cls();
		lib.ShowSlow(20,0);
		
		local r = StartMenu();
		if r ~= nil then
			return;
		end

		lib.LoadPicture("",0,0);
		lib.GetKey();
		
		Game_Cycle();
		
	end
end

function TitleSelection()
	local choice = 1
	local pyx = 150
	local pyy = 50
	local buttons ={
	{3,6,151+pyx,460+pyy,613+pyx,507+pyy},
	{4,7,351+pyx,460+pyy,613+pyx,507+pyy},
	{5,8,551+pyx,460+pyy,613+pyx,507+pyy}
	}
	local buttons2 ={
	{3,6,226+pyx,466+pyy,345+pyx,500+pyy},
	{4,7,425+pyx,466+pyy,550+pyx,500+pyy},
	{5,8,625+pyx,466+pyy,747+pyx,500+pyy}
	}
	--[[
	local choice = 1  ???¨½1
	local buttons ={
	{961,964,351,340,613,387}, --{??1????????1?¡Á??????,X?¨¢????1Y?¨¢??????????
	{962,965,351,400,613,447},
	{963,966,351,460,613,507}
	}
	]]
	local function on_button(mx, my)
		local r = 0
			for i = 1, #buttons2 do
				if mx >= buttons2[i][3] and mx <= buttons2[i][5] and my >= buttons2[i][4] and my <= buttons2[i][6] then
					r = i
					break
				end
			end
		return r
	end
	while true do
		if JY.Restart == 1 then
			return
		end
		local keypress, ktype, mx, my = lib.GetKey()
		if keypress == VK_DOWN or keypress == VK_RIGHT then
			choice = choice + 1
			if choice > #buttons then
				choice = 1
			end
		elseif keypress == VK_UP or keypress == VK_LEFT then
			choice = choice - 1
			if choice < 1 then
				choice = #buttons
			end
		else
			if (ktype == 2 or ktype == 3) then
				local r = on_button(mx, my)
				if r > 0 then
					choice = r
				end
			end
			if keypress == VK_RETURN or (ktype == 3 and on_button(mx, my)>0) then
				break
			end
		end
		Cls()
		for i = 1, #buttons do
			local picid = buttons[i][1]
			if i == choice then
				picid = buttons[i][2]
			end
			
			lib.LoadPNG(91, picid * 2 , buttons[i][3], buttons[i][4], 1)
		end
		--¡ã?????
		DrawString(CC.ScreenW-115-810,CC.ScreenH-30-670,CC.Version,C_WHITE,CC.Fontsmall)
		ShowScreen()
		lib.Delay(CC.Frame)

	end
	return choice
end

function StartMenu()
	Cls()
	local menuReturn = TitleSelection()
    if menuReturn == 1 then        --???????????¡¦
    Cls()

		NewGame();   		       --?????????¡¦????
		
		if JY.Restart == 1 then
			do return end
		end
		
		--???????????????¡ã
		if JY.Base["????"] == 58 then
			JY.SubScene = 18
			JY.Base["??X"] = 144
			JY.Base["??Y"] = 218
			JY.Base["??X1"] = 30
			JY.Base["??Y1"] = 32
		else
			JY.SubScene = CC.NewGameSceneID
			JY.Base["??X1"] = CC.NewGameSceneX
			JY.Base["??Y1"] = CC.NewGameSceneY
		end
		--???????????????¡Â?????¡§
		if JY.Person[0]["????"] == 0 then
			JY.MyPic = CC.NewPersonPicM
		else
			JY.MyPic = CC.NewPersonPicF
		end
		JY.Status = GAME_SMAP
		JY.MmapMusic = -1
		CleanMemory()
		Init_SMap(0)
        lib.ShowSlow(20,0)
        
		--if DrawStrBoxYesNo(-1, -1, "??¡¦¨½?????¨¾?????¨¦??", C_GOLD, CC.DefaultFont, LimeGreen) == true then 
			--oldCallEvent(CC.NewGameEvent)
		--end
		if DrawStrBoxYesNo(-1,-1,"?????¨½??¡¦¨½???????????????????????????¨®npc?¨¢?¨²??????????????????????buff(Y/N)?",C_WHITE,CC.DefaultFont) == true then
			Cls();
			JY.Person[456]["????????"] = 1
			instruct_2(14, 1)
			instruct_2(15, 5)
			instruct_2(16, 5)
			instruct_2(348, 1)
			--??¡Á??¨½??1?¨¾??
			if JY.Base["??¡Á?"] > 0 then
				instruct_2(174, 10000)
			end
			--?¨§???¡è ?¨§??????
			if JY.Person[0]["?¨§??????"] == 0 then
				instruct_2(343, 1)
			end
			--?¨§???¡è ?¨§??????
			if JY.Person[0]["?¨§??????1"] == 0 or JY.Person[0]["?¨§??????2"] == 0  then
				instruct_2(345, 1)
			end
			for p = 0, JY.PersonNum -1 do
				if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 then
					local tt = math.modf(1500/(JY.Person[p]['????¡¦??¡Á']+1))
					local xs = math.modf(1000/(JY.Person[p]['????¡¦??¡Á']+1))
					local wc = math.modf(500/(JY.Person[p]['????¡¦??¡Á']+1))
					local sz = 150+limitX(math.modf(40*(8-JY.Person[p]['????¡¦??¡Á'])),0,320)
					if JY.Person[p]['????¡¦??¡Á'] >= 0 and JY.Person[p]['????¡¦??¡Á'] < 3 then
						tt = tt + 480
					end	
					JY.Person[p]["???¡Â??"] = JY.Person[p]["???¡Â??"] + tt 
					JY.Person[p]["¡¦?????"] = JY.Person[p]["¡¦?????"] + tt 
					JY.Person[p]["?¨¢??"] = JY.Person[p]["?¨¢??"] + tt 
					JY.Person[p]["??????¡¦¨¾"] = JY.Person[p]["??????¡¦¨¾"] + xs
					JY.Person[p]["??¡¦¡§????"] = JY.Person[p]["??¡¦¡§????"] + xs
					JY.Person[p]["????????"] = JY.Person[p]["????????"] + xs
					JY.Person[p]["????????"] = JY.Person[p]["????????"] + xs
					JY.Person[p]["???????¡Â"] = JY.Person[p]["???????¡Â"] + xs
					if JY.Person[p]['????¡¦??¡Á'] <= 3 then
						JY.Person[p]["???¡ì????"] = JY.Person[p]["???¡ì????"] + wc
						JY.Person[p]["????"] = JY.Person[p]["????"] + sz
					else
						JY.Person[p]["???¡ì????"] = JY.Person[p]["???¡ì????"] + 50
						JY.Person[p]["????"] = JY.Person[p]["????"] + 50
					end		
				end
			end
		else
			Cls();
			instruct_2(348, 3)
		end
		if MPPD(0) > 0 then
			MPAttrib(0)
			if MPTX(0,5,4) then
				local r = JYMsgBox(rwwh(0,1), "???????¨½??????????????¡ã???    *???????????¡ã??????",  {"???????¡Â", "???????¡Â","???????¡Â"},3 , 1055, 1)
				local str = {"???????¡Â", "???????¡Â","???????¡Â"}
				QZXS('????'..str[r]..'??')
				CC.TX['???????????¨½'] = r 
			end	
		end	
		--????????
		if JY.Base["????"] == 58 then		--????????
			CallCEvent(4187)
		else								--??????
			CallCEvent(691)
		end
		
		--?????????¨½??¡Á??¨ª??¡Á¡ã??
		if JY.Base["????"] > 0 then
			if JY.Person[0]["???¡Â"] ~= - 1 and JY.Base["????"]~= 27 then
				instruct_2(JY.Person[0]["???¡Â"], 1)
				JY.Person[0]["???¡Â"] = - 1
			end
			if JY.Person[0]["¡¦???"] ~= - 1 then
				instruct_2(JY.Person[0]["¡¦???"], 1)
				JY.Person[0]["¡¦???"] = - 1
			end
			if JY.Person[0]["¡Á???"] ~= - 1 then
				instruct_2(JY.Person[0]["¡Á???"], 1)
				JY.Person[0]["¡Á???"] = - 1
			end			
		end
		--?????¨¹???¡Â?¨½?????¨¾??
		if JY.Base["????"] == 158 then
			instruct_2(174, 10000)
		end	
        if JY.Base["????"] == 721 then
            instruct_2(174, 20000)
        end
		--???????¡ã?¨½?????????¨¢????
		if JY.Base["????"] == 748 then
			instruct_2(281, 3)
		end
		--???????¡ã???¨½??????¡¦???
		if JY.Base["????"] == 498 then
			instruct_2(309, 1)
		end
		--???????¡ã???¨½??????¡¦???
		if JY.Base["????"] == 498 then
			instruct_2(29, 99)
		end			
         --???¡Â?????????????¡§???¡ì?¡ã??¡Á???
		if JY.Base["??¡Á?"] > 0 then
			addevent(41, 0, 1, 4144, 1, 8694)
		end
		--????????¡Á¡§??¡Á¡ã??
		if JY.Base["????"] == 651 then
			for i = 301, 304 do
				instruct_2(i, 1)
			end
		end
		
			instruct_10(104)
			instruct_10(105)
		--????????

        os.remove(CONFIG.DataPath..'TgJl')
        for i = 1, #CC.commodity do
            if CC.commodity[i][5] > 0 then 
                instruct_2(CC.commodity[i][1],CC.commodity[i][5])
                CC.commodity[i][5] = 0
            end
        end
        tgsave(1)
        
        CC.TGJL = {}
	elseif menuReturn == 2 then         --????????????
		lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
    	DrawStrBox(-1,CC.ScreenH*1/6-20,"????????",LimeGreen,CC.Fontbig,C_GOLD);
		--DrawStrBox(104,CC.ScreenH*1/6+26,string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"),C_ORANGE,CC.DefaultFont,C_GOLD);
		--DrawString(200,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"), C_ORANGE, CC.DefaultFont)
    	local r = SaveList();
    	--ESC ????¡¦???????
    	if r < 1 then
    		local s = StartMenu();
    		return s;
    	end
    	
    	Cls();
		DrawStrBox(-1,CC.StartMenuY,"?????¨¾...",C_GOLD,CC.DefaultFont);
		ShowScreen();
    	local result = LoadRecord(r);
    	if result ~= nil then
    		return StartMenu();
    	end

		if JY.Base["????"] ~= -1 then
			if JY.SubScene < 0 then
				CleanMemory()
				--lib.UnloadMMap()
			end
			--lib.PicInit()
			lib.ShowSlow(20, 1)
			JY.Status = GAME_SMAP
			JY.SubScene = JY.Base["????"]
			JY.MmapMusic = -1
			JY.MyPic = GetMyPic()
			Init_SMap(1)
		else
			JY.SubScene = -1
			JY.Status = GAME_FIRSTMMAP
		end
	elseif menuReturn == 3 then
        return -1;
	end
end

function CleanMemory()            --???¨ªlua????
    if CONFIG.CleanMemory==1 then
		collectgarbage("collect");
    end
end

--????????
--x,y????????????¡Á???
function Shurufa(x, y)
	local pinyin = ""
	local word = ""
	while 1 do
	  local tmp = nil
	  pinyin, tmp = GetPinyin(x, y, word)
	  if tmp ~= nil then
		word = tmp
	  end
	  if pinyin == "finish" then
		break;
		elseif pinyin ~= -1 and pinyin ~= "" then
		  word = word .. (SeleteHanzi(x, y, word, pinyin) or "")
	  end
	end
	return word
  end
  
  --?????¨½????¡Á?
  --x,y????¡Á???????¡Á???
  --word????????????????¡Á?
  --pinyin????????????
  function SeleteHanzi(x, y, word, pinyin)
	local T1 = {
	  de = {"??", "??", "??", "??", "?¡Á", "??"}, 
	  di = {"??", "??", "??", "?¨¢", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "¨¦?", "??", "??", "??", "??", "??", "¨ª?", "??", "??", "??", "?¨¢", "¨ª?", "¡Â?", "??", "??", "?¡ã", "?¨¢", "??", "¨ª?", "??"}, 
	  yi = {"??", "??", "??", "??", "?¨¦", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "?¨§", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨ª", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "??", "¨§?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¦¨®", "??", "??", "??", "??", "??", "??", "¨§?", "??", "??", "??", "¨½?", "??", "??", "??", "??", "??", "¨¢?", "??", "¨ª?", "?¡Á", "??", "¡Â?", "??", "??", "??", "??", "??", "??", "?¡Á", "?¡Á", "¨¢?", "??", "??", "¨¦¨§", "??", "??", "¨¾?", "??", "??", "¨½?", "??", "?¡§", "??", "??", "¨§?", "??", "?¨¹", "??", "??", "??", "??"}, 
	  guo = {"?¨²", "??", "??", "??", "??", "?¨¹", "??", "??", "¨¦¡è", "¨¾?", "??", "¨½?", "??", "??", "??", "¨¢?", "¨¾?", "??", "??"}, 
	  zai = {"??", "??", "??", "??", "??", "¡Á?", "?¡Á", "??", "¨¢?", "??"}, 
	  ren = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨®", "??", "??", "??", "¨¦¨ª", "¨½?", "??"}, 
	  le = {"??", "??", "??", "??", "?¡¦", "¡Â?", "?¨§", "??"}, 
	  liao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡è", "??", "??", "??", "??"}, 
	  you = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨®", "??", "?¨¹", "¡Â?", "??", "¨¦?", "¨¾?", "??", "??", "¨¾?", "??", "??", "??", "??", "?¨ª", "??", "??", "¡Â?", "¨¾?", "??", "¨¾?", "?¡ì"}, 
	  zhong = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "?¨§", "?¨½", "??", "¨®?"}, 
	  shi = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡§", "??", "?¡ã", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "??", "¨®?", "??", "??", "??", "¨§?", "??", "??", "¨®¡ì", "?¡ì", "¨®?", "??", "??", "?¨¦", "??", "??"}, 
	  nian = {"??", "??", "??", "??", "??", "??", "?¨ª", "?¨§", "?¨¦", "??", "?¨®", "??", "??", "¨¦?", "?¡è"}, 
	  he = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¾?", "??", "??", "??", "??", "?¨¹", "¨¾?", "??"}, 
	  hu = {"??", "?¡è", "?¡ì", "??", "??", "??", "??", "??", "?¨²", "?¡¦", "??", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "?¡Â", "?¡ã", "??", "?¨²", "¨§?", "??", "??", "??", "¨§?", "?¨½", "?¨²", "¨®?", "??", "??", "??", "?¨¹", "¨§?", "¨¦?", "¨§?", "¨§?", "??", "?¨¹", "??", "¨¢?", "?¡Á", "¨§?", "¨¦?"}, 
	  huo = {"??", "??", "?¨¾", "??", "?¨½", "??", "??", "?¨®", "??", "??", "?¨ª", "??", "??", "??", "¨®?", "??", "¨½?", "?¨§", "?¡¦", "??", "??"}, 
	  da = {"?¨®", "??", "?¨¾", "??", "??", "??", "¨ª?", "?¨½", "??", "??", "??", "¡Â?", "??", "¡Â¡ã", "¨½¡Á", "¨®?", "?¨¾", "?¡ì"}, 
	  dai = {"?¨®", "?¨²", "??", "??", "??", "?¡Â", "?¨¹", "??", "??", "??", "¨¢¡¦", "??", "??", "??", "¡Â¨§", "?¡ã", "?¡è", "??", "?¨¦", "??", "??", "??"}, 
	  ye = {"??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "¨§?", "??", "¡Á¡ì", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  bu = {"??", "??", "??", "??", "??", "??", "?¡è", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  wei = {"??", "??", "??", "??", "??", "??", "?¡ì", "??", "??", "?¡ã", "??", "??", "??", "??", "?¡§", "??", "??", "??", "??", "??", "?¡è", "??", "?¡¦", "¨¢?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "?¡Á", "??", "??", "??", "¨¢?", "??", "??", "??", "??", "?¨ª", "??", "?¨®", "??", "??", "??", "¨¢?", "??", "¨§?", "??", "??", "??", "??", "?¨ª", "?¨½", "??", "??"}, 
	  fa = {"¡¦?", "¡¦¡§", "¡¦?", "¡¦?", "¡¦?", "¡¦¡ì", "¡¦¡è", "¨ª?", "??", "¡¦?"}, 
	  hui = {"?¨¢", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "??", "??", "¡Â?", "??", "??", "??", "?¨ª", "?¡Á", "?¡ì", "??", "¨¾?", "¨ª?", "¨®?", "??", "??", "??", "??"}, 
	  kuai = {"?¨¢", "?¨§", "?¨¦", "??", "??", "?¨¢", "??", "??", "??", "¨¢?", "??"}, 
	  gong = {"?¡è", "??", "??", "??", "??", "?¨§", "??", "??", "??", "??", "?¡§", "?¡ì", "?¡ã", "??", "??", "??", "¨¾?", "??", "??", "??"}, 
	  jing = {"??", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??","??", "??", "??", "??", "??", "??", "?¡ì", "??", "?¡è", "??", "??", "??", "?¡§", "??", "??", "??", "??", "??", "¨§?", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "?¨¾", "?¡ã"}, 
	  shang = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¹", "¨¦?", "¨§?", "??"}, 
	  yao = {"??", "??", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "?¡è", "??", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡§", "¨½?", "?¡Á", "??", "??", "?¨ª", "¨¢?", "¨¦¡Â", "??", "¡Â?", "¨¢?", "?¨¾"}, 
	  ge = {"??", "??", "?¡Â", "??", "?¨½", "??", "??", "??", "??", "??", "?¨®", "??", "??", "??", "?¨¦", "??", "?¨§", "??", "?¨ª", "??", "¡Â?", "?¨¾", "??", "??", "??", "¨¾?", "??", "¨ª?", "??", "??", "??", "?¨¹", "¨½?", "??", "??", "??", "¨¾?"}, 
	  chan = {"?¨²", "??", "??", "??", "??", "¨§?", "?¨¹", "??", "??", "?¨®", "??", "¨®?", "??", "??", "??", "??", "??", "??", "??", "?¡Â", "?¡è", "??", "?¨½", "??", "??", "??", "??"}, 
	  zhe = {"??", "??", "¡Á?", "??", "??", "??", "?¨¢", "??", "??", "¨¦¨¹", "??", "??", "¨½?", "¨¾?", "??", "??", "??", "?¡Â", "??", "¨ª?"}, 
	  chu = {"??", "??", "??", "??", "??", "??", "?¨®", "??", "??", "??", "??", "??", "?¡Â", "?¨²", "¨½?", "?¨¹", "??", "??", "??", "?¡è", "??", "¨¾?", "¡Â¨ª", "??", "?¨¦", "??", "¨¦?", "??", "?¨²"}, 
	  xing = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨ª?", "??"}, 
	  hang = {"??", "??", "??", "??", "??", "??", "?¨½", "?¨§", "??", "¨½?"}, 
	  heng = {"??", "??", "?¨¢", "??", "??", "??", "?¨½", "?¨§", "??"}, 
	  zuo = {"¡Á¡Â", "¡Á?", "¡Á?", "¡Á¨®", "¡Á?", "¡Á¨¾", "¡Á?", "¡Á?", "??", "??", "?¨¦", "¨§¨½", "¡Á?", "?¨¾", "??", "??", "¨®?", "??", "??"}, 
	  sheng = {"?¨²", "??", "??", "??", "?¡è", "??", "??", "??", "??", "?¨¹", "??", "¨®?", "??", "¨¢?", "??", "??", "¨ª¨¾"}, 
	  jia = {"??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡è", "??", "?¡è", "??", "??", "??", "??", "??", "¨®?", "?¨§", "¨¢?", "??", "??", "??", "??", "??", "¨½?", "??", "?¨¾", "??", "¨¾?", "¨ª?"}, 
	  jie = {"??", "?¨¢", "??", "??", "??", "??", "??", "?¨§", "?¨¦", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "¨ª?", "??", "¨¾?", "¨¾?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¡Â?"}, 
	  cheng = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨®", "?¨¢", "¨¾?", "??", "?¨½", "?¡§", "¨½?", "??"}, 
	  dao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "¨§?", "??", "??", "?¨¹", "?¨¢"}, 
	  ri = {"??"}, 
	  min = {"?¨½", "??", "??", "??", "?¨®", "??", "¨¢?", "??", "??", "?¨¾", "??", "??", "??", "¨ª?", "??", "¡Â?"}, 
	  lai = {"??", "??", "??", "¨ª?", "¨¢?", "??", "??", "??", "??", "¨½?", "¨¢?", "??"}, 
	  wo = {"??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "¨¢?", "??", "??", "??", "??", "??", "??", "¨ª?"}, 
	  dui = {"??", "??", "??", "??", "??", "¨ª?", "¨ª?", "¨ª?"}, 
	  jin = {"??", "??", "?¨½", "?¨¹", "??", "??", "??", "?¨¾", "??", "??", "??", "??", "?¨²", "?¡Â", "??", "?¨ª", "??", "?¨®", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "?¨¢", "¨½?", "?¨¢"}, 
	  duo = {"??", "??", "?¨¢", "??", "??", "?¨§", "??", "?¨¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨½?", "?¨¢"}, 
	  quan = {"??", "?¡§", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "¨¾¨¦", "?¡ì", "??", "¨®?", "¡Â?", "??", "¨¦¨²", "?¡ã"}, 
	  jian = {"?¡§", "??", "??", "??", "?¨¢", "?¨§", "??", "??", "??", "?¨¾", "??", "??", "??", "??", "?¨¹", "??", "?¨ª", "??", "??", "??", "??", "??", "??", "??", "??", "?¨®", "??", "??", "?¨¦", "??", "??", "?¨½", "??", "?¨²", "??", "?¡Â", "?¡ì", "??", "??", "?¡è", "??", "??", "¨ª¨²", "??", "??", "?¨§", "??", "??", "??", "??", "¨®?", "??", "??", "¡Â?", "??", "??", "??", "??", "??", "¨½?", "??", "??", "??", "??", "?¨®", "??", "??", "?¡ì", "??", "¨¦?"}, 
	  ta = {"??", "?¨¹", "??", "??", "??", "?¡è", "?¨²", "¨¦?", "¨ª?", "??", "??", "??", "??", "??", "??", "??", "??", "¡Â?", "??", "??"}, 
	  kai = {"??", "??", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "??", "??", "??"}, 
	  men = {"??", "??", "??", "??", "¨§?", "¨ª?", "??"}, 
	  chang = {"??", "?¡è", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "??", "?¡§", "??", "??", "??", "??", "¨¢?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  zhan = {"??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "?¨¹", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "¨§?", "??", "??"}, 
	  li = {"?¨ª", "??", "??", "??", "??", "??", "?¨²", "??", "??", "??", "?¨½", "??", "??", "?¡ì", "?¡Â", "??", "??", "?¨¾", "??", "??", "??", "?¨®", "?¡è", "??", "?¨§", "?¡§", "??", "??", "??", "?¨¦", "??", "¨ª?", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "¨®?", "¨®?", "¨¾?", "??", "?¡§", "??", "?¨¹", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "??", "??", "¨¾?", "¡Â¨®", "¨¢?", "??", "??", "?¨½", "??", "??", "??", "??", "??", "¡Â?", "??", "??", "??", "??", "¨®?", "¨¦?"}, 
	  xin = {"??", "??", "??", "?¡ã", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "¨§¡ì", "??", "??"}, 
	  fang = {"¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "?¨²", "??", "¨¢?", "??", "??", "??"}, 
	  zhu = {"?¡Â", "??", "¡Á?", "¡Á?", "?¨²", "??", "??", "??", "??", "¡Á¡è", "?¨§", "?¨¦", "¡Á?", "?¨ª", "??", "??", "?¨½", "??", "??", "??", "??", "?¨¹", "?¨®", "?¨¾", "¨½?", "??", "??", "??", "?¡§", "¨®?", "??", "??", "??", "??", "??", "??", "??", "¨®?", "¨§?", "??", "??", "?¨®", "??", "¨¦?", "??", "¨¦?", "?¨½", "¡Â?", "??"}, 
	  qi = {"??", "??", "??", "??", "??", "??", "?¡Â", "??", "??", "??", "??", "?¨§", "??", "??", "?¨²", "??", "??", "??", "??", "??", "??", "?¨¢", "??", "?¨½", "?¨¹", "¨¢?", "??", "??", "??", "?¡Â", "?¨¹", "?¨¾", "??", "??", "?¨¦", "??", "¨§¡Â", "??", "?¨ª", "??", "??", "??", "??", "¡Â?", "??", "¨¢?", "¨ª?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¡Â?", "??", "??", "??", "¨¢¡§", "¨½?", "??", "¨ª?", "??", "??", "?¨§", "??", "??", "¨¾?", "¨¦?", "¨§?", "??", "??", "¨¾?"}, 
	  zi = {"¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "?¡Â", "??", "¡Á?", "??", "?¡§", "??", "¨ª¡ì", "??", "?¡è", "¡Á?", "??", "??", "??", "?¡¦", "??", "¨ª?", "??", "??", "¨®?", "??", "¨¢?", "¡Â?", "??", "??", "??", "¨½?"}, 
	  xue = {"?¡ì", "??", "??", "?¡Â", "??", "?¡§", "??", "??", "??", "¡Â¡§", "??", "¨ª?"}, 
	  bao = {"?¡§", "??", "¡ã¨¹", "??", "??", "¡ã?", "??", "??", "??", "??", "?¡ì", "?¡è", "¡ã?", "??", "??", "?¨¢", "??", "??", "??", "¡ã?", "??", "??", "¡ã¨²", "¨§?", "¨½?", "??", "??", "??"}, 
	  zhi = {"??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡§", "??", "??", "??", "?¡è", "??", "??", "¨§¨ª", "?¨§", "??", "¨¾?", "??", "?¡Á", "??", "¨¢?", "??", "??", "??", "¨§¨®", "??", "??", "??", "¨¦¨¾", "??", "¨¦?", "?¨¦", "??", "??", "??", "?¨²", "¨ª¨¦", "??", "??", "??", "??"}, 
	  zheng = {"??", "??", "?¡è", "??", "??", "?¡Â", "??", "??", "??", "??", "??", "??", "??", "¨®?", "?¨¹", "??", "¨¢?", "?¨²", "??", "??", "¨¢?", "??"}, 
	  ji = {"??", "?¨²", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Â", "??", "?¡è", "?¡§", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "??", "??", "??", "¨ª?", "??", "??", "?¡ì", "??", "¨½¡è", "?¡Â", "??", "??", "??", "??", "??", "??", "??", "¨¢¡ì", "??", "??", "??", "??", "¨¦?", "??", "??", "??", "??", "?¨²", "?¨¦", "¡Â?", "??", "?¨¢", "¨®?", "?¡Â", "??", "?¨®", "?¨§", "¡Â?", "??", "??", "??", "¨®?", "??", "??", "??", "??", "??", "¨¢?", "¨¾?", "?¨¢", "¨§?", "¨¦?", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  yong = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "¡Â?", "??", "¡Â?", "??"}, 
	  tong = {"??", "?¡§", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "¨ª?", "??", "?¨²", "¨¢?", "??", "??", "??", "?¨ª", "?¨ª"}, 
	  yu = {"??", "??", "??", "??", "?¡è", "?¨¾", "??", "??", "??", "??", "?¨½", "??", "??", "??", "??", "??", "?¨²", "?¨¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¹", "?¡Â", "??", "??", "??", "?¨ª", "?¨¢", "??", "??", "??", "??", "??", "??", "??", "?¨§", "??", "??", "??", "?¡è", "??", "??", "??", "??", "?¨®", "¨§?", "??", "??", "¨§?", "??", "¨§?", "?¡ì", "??", "¨ª?", "¨®?", "??", "??", "?¨¦", "??", "??", "?¨§", "?¨ª", "??", "??", "??", "??", "?¡Á", "??", "??", "?¡Â", "¨§?", "?¨¾", "??", "??", "¨¢?", "?¡ì", "??", "??", "??", "¨¾?", "?¨½", "?¨²", "¨½?", "¨½?", "??", "?¡Â", "¨¢¨¹", "?¡§", "¨¾?", "¨§?"}, 
	  gao = {"??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "¨¦?"}, 
	  zhang = {"?¡è", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "¨¢?", "??", "??", "¨®?", "??", "¨¢¡è", "??", "??"}, 
	  xian = {"??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¾?", "??", "¨¢?", "??", "¨§?", "??", "??", "??", "??", "??", "¨¢?", "¨§¨§", "¨®?"}, 
	  ben = {"??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  yue = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "¨¦?", "??", "??", "??"}, 
	  ding = {"?¡§", "??", "??", "??", "??", "??", "?¡è", "?¡ì", "??", "??", "?¨²", "??", "?¨²", "?¡è", "¨ª?", "??", "??", "??", "¨½?"}, 
	  hua = {"??", "??", "??", "?¡ã", "?¡§", "??", "??", "??", "?¨ª", "??", "??", "??", "?¨¹", "¨ª?"}, 
	  dong = {"??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "¨¢?", "??", "??", "??", "¨ª?", "?¨ª", "??", "¨¢?", "??"}, 
	  pin = {"?¡¦", "??", "??", "??", "??", "??", "??", "¨¾?", "?¡ã", "??", "¨¦?", "?¨¾"}, 
	  chong = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  guan = {"??", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "??", "?¡Á", "¨½?", "??", "??", "¡Â¡è", "??", "??", "??"}, 
	  fen = {"¡¦?", "¡¦?", "¡¦¡Á", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "??", "??", "¡Â¡Â", "??", "??", "?¡Â"}, 
	  wai = {"??", "?¨¢"}, 
	  qu = {"??", "??", "??", "??", "?¨²", "?¡Â", "??", "?¡è", "??", "?¨¹", "??", "¨¢¨¦", "??", "¨§?", "??", "??", "¨¢?", "??", "??", "??", "¨¾?", "¨½?", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "¡Â¨½", "¨®?", "??", "??", "??", "¨ª¨¢"}, 
	  ou = {"??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "¨½?", "??"}, 
	  neng = {"??"}, 
	  she = {"??", "??", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "??", "??", "¡Â?", "¨§¡§", "??", "??", "??", "??", "??"}, 
	  hou = {"?¨®", "?¨¾", "?¨½", "??", "??", "?¨ª", "??", "??", "¨®¨®", "?¡Á", "¡Â?", "¨¢¨¢", "?¡Á", "?¨²", "??"}, 
	  jiu = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨½", "??", "??", "??", "??", "??", "??", "??", "¡Â?"}, 
	  deng = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "¨ª?", "¨¢?", "??", "??", "??"}, 
	  ti = {"??", "?¨¢", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "¨½?"}, 
	  xia = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¡Â?", "¨ª?", "¨®?", "¨¢¨¾", "??", "??"}, 
	  wan = {"?¨¾", "??", "?¨ª", "??", "??", "??", "??", "?¨§", "??", "??", "??", "??", "??", "??", "?¨½", "?¨®", "¨¾?", "??", "?¨¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  mo = {"?¨¾", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "??", "??", "?¡è", "?¡ì", "??", "?¡ã", "?¡§", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Â", "??", "??", "??", "¨¦?", "¨½¨¾", "¨½?", "??", "??"}, 
	  yuan = {"??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "?¡§", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "?¡ì", "??", "?¡ã", "??", "?¡Â", "??", "??", "??", "¨¦?", "¨®?", "¨ª¨®", "¨®?", "?¨¾"}, 
	  qian = {"?¡ã", "?¡ì", "??", "??", "??", "?¡§", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¾?", "??", "??", "??", "??", "??", "??", "?¡è", "?¡¦", "??", "¨®?", "??", "??", "??", "??", "?¡Á", "??", "¨ª?", "??", "??", "¨¢?", "??", "¨®¨¦", "??", "??"}, 
	  mian = {"??", "??", "??", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "¨ª¨ª"}, 
	  nong = {"??", "?¡§", "??", "?¡ì", "??", "??"}, 
	  shuo = {"??", "??", "??", "??", "?¡¦", "??", "??", "¨¦?", "??", "?¡Â"}, 
	  shui = {"??", "??", "?¡ã", "??", "??"}, 
	  yun = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "??", "??", "??", "??", "¨¦?", "??", "??", "¨¢¨½"}, 
	  er = {"??", "??", "??", "??", "?¨²", "??", "?¨¹", "??", "¡¦?", "??", "?¨ª", "??", "??", "??"}, 
	  wu = {"?¨½", "??", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "??", "?¨®", "??", "?¨½", "??", "??", "?¨¾", "?¨¢", "?¨ª", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¹", "¨§?", "?¨§", "??", "??", "¨¾?", "?¨ª", "??", "??", "¨§?", "??", "??", "??", "¡Â?", "??", "??", "??", "??", "?¨ª", "??", "??", "??", "??"}, 
	  dian = {"??", "??", "??", "??", "?¨§", "?¨¦", "??", "?¨ª", "??", "??", "??", "?¨¢", "¨½?", "¨¢?", "??", "??", "¨½¡ã", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  wen = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??"}, 
	  ke = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ì", "??", "¨¦?", "¨½?", "??", "??", "¨¾¨¾", "¨¢?", "¨¾¡è", "¡Â?", "??", "??", "?¨§", "??", "??"}, 
	  zong = {"¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "??", "¡Á¡Á", "??", "??", "??"}, 
	  xmjc = {"??", "??", "??", "??", "??", "??", "??"}, 
	  gai = {"??", "??", "??", "??", "??", "??", "?¡è", "??", "??", "?¨¾", "??", "??"}, 
	  san = {"??", "??", "??", "??", "??", "??", "?¡ì"}, 
	  hao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "¨¾?", "??", "¨¾?", "??", "??", "??"}, 
	  si = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "?¨¢", "??", "??", "??", "??", "¨¾?", "??", "¨½?", "¨®?", "??", "??", "??", "??", "?¨¢", "??", "??"}, 
	  cong = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  ping = {"??", "??", "??", "??", "¡¦?", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??"}, 
	  dang = {"??", "??", "??", "??", "??", "??", "¨ª?", "¨½?", "??", "??", "??"}, 
	  tian = {"?¨§", "??", "?¨ª", "??", "??", "?¨½", "?¨®", "??", "?¨¾", "??", "??", "¨¦?", "??", "??"}, 
	  nei = {"??", "??", "??", "??"}, 
	  xiao = {"??", "?¡ì", "?¨²", "??", "??", "??", "??", "?¡è", "?¡Â", "??", "??", "?¨§", "??", "?¨¹", "??", "??", "??", "??", "??", "¨®?", "??", "¨®?", "??", "??", "??", "??", "¨¾?", "¨¢?", "??", "¡Â?"}, 
	  mu = {"??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡è", "?¨¦"}, 
	  hai = {"??", "??", "??", "??", "??", "??", "??", "??", "?¡ì", "?¡è", "??", "??", "?¡ã"}, 
	  suo = {"??", "?¡Â", "??", "??", "??", "?¨®", "??", "??", "??", "??", "??", "?¨¾", "??", "??", "??", "??", "¨ª¨¹"}, 
	  ru = {"??", "??", "?¨¦", "??", "??", "??", "??", "?¨§", "??", "??", "??", "?¨¦", "??", "?¨¢", "?¡§", "??", "??", "¨½?", "¨¾?", "??"}, 
	  liang = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "¡Â?", "??"}, 
	  du = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨®?", "??", "??", "??", "??", "¨®?", "?¨¹", "¡Â¨¾", "??", "¡Â?"}, 
	  bei = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "?¨ª", "?¨¦", "??", "?¡¦", "??", "??", "¨ª?", "¨½?", "??", "¡Â?", "??", "??", "??", "??", "??"}, 
	  huan = {"??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡§", "?¡Â", "??", "?¨¦", "¡Â?", "??", "??", "?¨½", "??", "??", "?¡ì"}, 
	  dou = {"??", "?¡¦", "??", "??", "??", "??", "??", "??", "¨½?", "¨¾?", "??", "?¨²", "¨®?"}, 
	  shu = {"??", "?¨¦", "??", "??", "?¡Â", "??", "??", "??", "??", "?¨§", "??", "??", "??", "??", "?¨®", "??", "??", "??", "??", "??", "?¨¢", "??", "??", "?¨²", "?¨½", "?¨ª", "?¨¢", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "??", "??", "??", "??", "??", "?¨¾", "?¨¾", "??", "?¡§", "¨§?", "?¨®", "??"}, 
	  ming = {"?¡Â", "??", "?¨¹", "??", "??", "?¨²", "?¡è", "??", "?¨¦", "?¡è", "?¡§", "??", "??"}, 
	  zhao = {"¡Á?", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "?¡ã", "¡Á?", "??", "?¨²", "??", "¨®?"}, 
	  zhuo = {"¡Á?", "??", "??", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "??", "?¨ª", "¡Á?", "??", "¨§?", "??", "??", "¨ª?", "??", "??", "?¡¦", "¨§¨²"}, 
	  ci = {"??", "??", "??", "??", "??", "??", "??", "¡Á?", "??", "??", "??", "¨§?", "??", "??", "??", "??", "??", "??", "??"}, 
	  jiang = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "?¨½", "??", "¨ª?", "??", "?¨¹", "??", "¨½?"}, 
	  qiang = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨½?", "??", "??", "¨¦?", "??", "??", "?¡§", "¨§?", "??", "??", "¨¾?"}, 
	  zeng = {"??", "??", "¡Á?", "??", "?¡Â", "??", "??", "??", "??"}, 
	  xiang = {"?¨¾", "??", "??", "??", "??", "?¨®", "?¨§", "??", "??", "?¨½", "?¨ª", "??", "?¨¦", "??", "??", "??", "??", "??", "??", "?¨¢", "??", "¡Â?", "??", "??", "??", "??", "??", "??", "??", "¨®?"}, 
	  ying = {"??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "??", "?¡è", "??", "??", "?¡§", "??", "??", "??", "??", "??", "¨¾?", "??", "?¡ì", "??", "¨¦?", "¨®?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨½¡§", "??", "?¨¹", "??"}, 
	  mei = {"??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "¡Â?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨½?", "¨¦?", "??", "¨¢?", "??", "??", "??", "??"}, 
	  gui = {"??", "?¨®", "?¨¦", "?¨§", "??", "?¨½", "??", "?¨ª", "??", "??", "?¨¾", "??", "??", "??", "??", "??", "¡Â?", "?¨ª", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "¨®?", "??", "??", "??"}, 
	  xie = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "?¡ã", "??", "??", "??", "??", "??", "¨¦?", "??", "??", "??", "??", "?¡§", "¨¾?", "??", "??", "??", "??", "¨¦?", "??", "??", "??", "??", "??", "?¨®"}, 
	  biao = {"?¨ª", "??", "??", "?¡Á", "??", "¨½?", "?¨§", "¨§?", "??", "??", "??", "¨§?", "??", "¡Â?", "¡Â¡ì", "¨½?"}, 
	  xi = {"??", "?¡Â", "??", "??", "??", "?¡ã", "?¨¹", "??", "??", "??", "?¡¦", "??", "?¡è", "??", "??", "?¡ì", "??", "??", "??", "?¨²", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡§", "??", "¨§?", "??", "??", "??", "??", "??", "¨¢?", "??", "??", "??", "??", "¨§¡§", "¨§?", "??", "¨®?", "??", "?¨½", "??", "??", "¨¦?", "??", "¨¾¨¢", "??", "??", "??", "??", "??", "??", "¨®?", "??", "??", "¨§¡è", "??", "??", "¡Â?", "¨½?", "¨½?", "??", "??", "¨§?", "??", "??"}, 
	  ban = {"¡ã¨§", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã¨¦", "¡ã¨¢", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "??", "??", "¡ã¨ª", "??", "¨½?", "??", "¨½?"}, 
	  jiao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¾?", "??", "??", "??", "?¡§", "?¨²", "¨¢?", "??", "??", "??", "??", "¨¢?", "??", "??", "??", "??", "??", "??"}, 
	  tiao = {"??", "?¡Â", "??", "??", "??", "?¡Â", "??", "¨½?", "¨®?", "??", "??", "¡Â?", "¨§?", "??", "¨¾?", "??"}, 
	  zui = {"¡Á?", "¡Á?", "??", "¡Á¨§", "¡Á¨ª", "?¡Á", "??"}, 
	  te = {"??", "¨§?", "??", "??", "¨ª?"}, 
	  shou = {"??", "??", "??", "?¡Á", "??", "??", "??", "?¨§", "??", "??", "??", "¨¢¡Â", "?¡¦", "??"}, 
	  bing = {"??", "??", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "?¨²", "¨¦?", "?¡Â", "??"}, 
	  an = {"?¡ì", "??", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã¡ã", "¡ã?", "¡ã?", "¡ã¡¦", "?¡ì", "??", "??", "¡Â?", "??", "?¨½", "??", "¨¢¨ª", "??"}, 
	  kou = {"??", "??", "??", "??", "??", "??", "??", "¨ª?", "¨®?"}, 
	  diao = {"?¡Â", "??", "?¨½", "?¨½", "??", "??", "?¨®", "??", "?¨¾", "??", "??", "??", "??", "??"}, 
	  zu = {"¡Á¨¦", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "??", "¡Á?", "??", "??"}, 
	  lu = {"?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¾", "??", "??", "??", "?¡è", "¨¦?", "??", "??", "??", "??", "??", "¨½?", "??", "??", "?¡ã", "¨¦?", "¨¦¨½", "??", "??", "?¡è", "??", "??", "??", "??", "??", "??", "¨®¨¹", "??", "??", "¨¦?", "??", "??"}, 
	  guang = {"??", "??", "??", "¨¢?", "?¡Á", "??", "??"}, 
	  bi = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "¡¦¡Â", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "¨½?", "??", "??", "??", "??", "¨®¡Â", "??", "?¨¦", "??", "¨®?", "??", "??", "??", "??", "??", "??", "?¡§", "??", "??", "??", "??", "??", "??", "¨®?", "??", "¡Â?", "??", "??", "¨¢?", "??", "??", "??", "?¡ã"}, 
	  tou = {"??", "?¡¦", "??", "??", "?¡Á", "¡Â?"}, 
	  jue = {"??", "??", "??", "??", "??", "?¨¾", "¨¢?", "?¡Â", "??", "?¨½", "??", "??", "?¨®", "??", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "??", "??", "??", "¨§?"}, 
	  nan = {"??", "??", "??", "¨¦?", "??", "??", "??", "??", "??", "¨¾?"}, 
	  na = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨½?", "??", "??"}, 
	  ling = {"?¨§", "??", "?¨ª", "??", "?¨¦", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "??", "??", "¨½?", "?¨¢", "??", "??", "?¨¾", "??", "??", "??", "¨¾?", "??", "?¨§", "??"}, 
	  qing = {"?¨¦", "??", "??", "??", "?¡Á", "?¨¢", "?¨§", "??", "??", "??", "??", "??", "??", "??", "¨®?", "¨ª?", "¨¾?", "¨®?", "??", "?¨§", "??", "¡Â?", "??", "¨¦?", "??"}, 
	  shan = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "??", "??", "??", "?¡¦", "?¡è", "??", "??", "??", "¡Â?", "??", "?¨²", "?¡§", "??", "??", "??", "?¡ì", "??", "??", "??", "¨®?", "??", "??", "?¨®"}, 
	  che = {"??", "??", "?¡¦", "??", "??", "??", "??", "??", "¨ª?"}, 
	  ju = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨½", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "?¡Á", "??", "??", "??", "??", "?¨§", "¨¦?", "¨§?", "??", "??", "?¨¾", "?¨¢", "?¨¢", "??", "??", "¨¦¡ì", "??", "¨½?", "¨¦¡ã", "??", "??", "¨¦¡¦", "??", "??", "??", "??", "¨½?", "¡Â?", "??", "??", "??"}, 
	  ran = {"??", "??", "??", "??", "??", "¡Â¡Á", "¨¾?"}, 
	  yin = {"?¨¾", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨®", "??", "?¨¹", "?¨½", "?¡Â", "¨½?", "?¨²", "??", "??", "?¨®", "??", "??", "¨¾?", "??", "?¡¦", "??", "¨½?", "??", "?¡Â", "??", "¨¢?", "??", "??", "??", "?¨¢", "?¡ì"}, 
	  ba = {"¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "??", "??", "¨¢?", "??", "??", "¡ã?", "??", "¡Â?", "??"}, 
	  chi = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "¨®¡Á", "??", "??", "¨¾?", "??", "¡Â?", "¨®?", "¨½?", "¨¢?", "?¡¦", "¨®¡è", "¨½?", "¨ª¡Â", "??"}, 
	  dan = {"??", "??", "??", "??", "?¡è", "?¡§", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "¨¦¨¦", "??", "??", "¨ª¨½", "??", "??", "?¡ì", "??", "¨®¨§", "¨½?", "??", "?¡Â", "??"}, 
	  cun = {"??", "??", "??", "?¡Á", "??", "¨½?"}, 
	  qiu = {"?¨®", "?¨¾", "??", "??", "?¨½", "??", "??", "??", "??", "??", "??", "?¨²", "¨¾¡ã", "¨¾?", "??", "¨¦?", "??", "¨¢¨§", "??", "??", "??", "¨¾?", "??", "¡Â¨¹", "??"}, 
	  fu = {"??", "¡¦?", "??", "??", "??", "??", "??", "¡¦¨¾", "??", "¡¦?", "??", "¡¦?", "??", "¡¦?", "??", "??", "?¡ã", "¡¦?", "??", "??", "?¡§", "??", "¡¦¨¹", "?¡ì", "??", "¡¦?", "??", "??", "¡¦?", "?¡¦", "?¡è", "??", "??", "¡¦¨²", "??", "??", "¡¦¨®", "??", "¡¦¡Â", "¡¦?", "??", "??", "¡¦?", "??", "??", "??", "??", "?¨¾", "??", "??", "??", "??", "?¡¦", "??", "¨¾?", "??", "??", "¨¾?", "??", "?¨§", "??", "¨¾¨®", "??", "?¡§", "¨¾?", "¨ª?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¢?", "¨§?", "??", "¨ª?", "¨ª?", "??"}, 
	  yan = {"??", "??", "?¨¦", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "?¨®", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "??", "¨¦?", "??", "??", "??", "??", "??", "??", "??", "¨®?", "¨§?", "??", "??", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "¡Â?", "??", "??", "??", "¨¢?", "??", "??", "??", "¡Â¨²", "??", "¡Â?", "??", "??", "??", "??"}, 
	  jun = {"?¨¹", "??", "??", "??", "??", "?¨²", "??", "??", "??", "??", "??", "?¡è", "¨®?", "¨½?", "¡Â?", "??"}, 
	  yo = {"??", "??", "??"}, 
	  gan = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "¨ª¡¦", "??", "??", "??", "??", "?¡è", "??", "?¨¢", "??", "?¨¢", "?¡Â"}, 
	  tuan = {"??", "??", "??", "??", "??"}, 
	  zao = {"?¨§", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨ª", "??", "?¨¦", "??"}, 
	  lian = {"??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "¨¦?", "??", "¨¦?", "?¨¾", "¨½?", "¨½?", "¨§?", "??", "¨®?", "?¨¹"}, 
	  zhuan = {"¡Á¡§", "¡Á?", "??", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "??", "??", "??", "¨¾¡ì"}, 
	  shao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "¨®?", "??", "¨¾?", "??"}, 
	  fei = {"¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¨§?", "¨¾?", "?¨²", "¡¦?", "¨§¨¦", "??", "??", "¡¦?", "??", "??", "?¨¾", "??", "??", "??", "¨¢?", "¨¦?", "??", "¨®?", "??"}, 
	  shen = {"??", "??", "?¨ª", "?¨½", "??", "?¨®", "??", "??", "?¨¾", "?¨§", "?¡Â", "??", "??", "??", "?¡¦", "??", "??", "??", "?¨¦", "¨¾¡Á", "??", "¨¦?", "??", "??", "?¡¦", "??", "?¨¾", "??"}, 
	  geng = {"?¨¹", "??", "??", "??", "??", "??", "??", "??", "?¨§", "??", "??", "?¨¢"}, 
	  kan = {"??", "??", "??", "?¡ã", "??", "??", "??", "??", "?¡Â", "??", "??", "¨ª?", "??", "?¡§"}, 
	  tai = {"?¡§", "??", "??", "??", "?¡ì", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "¨§?"}, 
	  yang = {"??", "??", "??", "??", "?¨®", "??", "??", "?¨¾", "??", "??", "?¨ª", "?¡Â", "?¨²", "?¨½", "?¨®", "??", "¨ª?", "?¨§", "¨¢?", "??", "?¨®", "¨§?", "¨§?", "¡Â?", "¨¾?"}, 
	  lao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¢?", "??", "??", "??", "?¨§", "??", "??", "??", "?¨¢", "¨½¨§"}, 
	  liu = {"?¡Â", "??", "??", "??", "??", "??", "??", "?¨¾", "??", "??", "??", "?¨½", "??", "?¨®", "??", "??", "?¨¾", "??", "??", "¨§?", "¨§?", "??", "??"}, 
	  hen = {"??", "??", "??", "??"}, 
	  gei = {"??"}, 
	  chuang = {"??", "??", "?¡ã", "??", "??", "??", "??"}, 
	  lun = {"??", "??", "?¡Á", "??", "??", "??", "??", "??"}, 
	  bie = {"??", "??", "??", "?¨½", "??"}, 
	  bian = {"??", "??", "??", "??", "?¨¦", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "¨§?", "¨ª?", "??", "¨¾?", "??", "??", "¨½?", "¨®?", "¨§?", "¨½?", "¨ª?", "?¨ª", "??"}, 
	  feng = {"¡¦?", "¡¦¨¢", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦¨§", "¡¦?", "¡¦?", "¡¦?", "¡¦¨ª", "¡¦¨¦", "??", "??", "??", "¨ª?", "?¡Á", "??"}, 
	  pi = {"?¨²", "¡¦¨½", "?¡è", "??", "??", "??", "??", "??", "??", "?¡ì", "??", "?¡Â", "??", "??", "?¨¹", "??", "?¡§", "??", "?¨¹", "¨½?", "??", "¨½?", "?¨¦", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¾¡¦", "??", "??", "??", "¨¾?", "¨½?", "??", "?¨¾", "??", "?¡§", "??", "??"}, 
	  cha = {"?¨¦", "?¨§", "??", "??", "??", "??", "??", "??", "¨¦?", "?¨ª", "??", "??", "??", "??", "??", "??", "??", "¨½?", "??", "¨¦?", "??", "¨¦?", "??", "??", "??"}, 
	  zha = {"?¨¦", "?¨²", "?¡§", "??", "??", "??", "?¨¹", "??", "??", "?¡ì", "??", "¨¦?", "??", "?¡è", "??", "??", "¡Á?", "??", "??", "??", "¨¾?", "??", "¨ª?", "??", "??", "??", "¡Â?"}, 
	  lin = {"??", "??", "??", "??", "??", "?¡Á", "??", "¡Â?", "??", "??", "??", "??", "??", "??", "??", "¨¢¡Á", "??", "??", "¨¦?", "??", "??", "¨§?", "??", "??"}, 
	  zhuai = {"¡Á?", "¡Á¡ì", "?¡¦"}, 
	  huai = {"??", "??", "??", "??", "??", "??", "?¡Á"}, 
	  zhun = {"¡Á?", "??", "¡Á?", "??", "¨½?"}, 
	  xu = {"??", "?¨ª", "??", "??", "?¨¾", "?¨§", "??", "?¨®", "?¨¦", "??", "?¡Â", "??", "?¨½", "??", "??", "?¨¾", "??", "?¡Á", "??", "??", "¨½?", "??", "?¡ã", "¨§?", "??", "??", "¨ª¨§", "??", "??", "??", "??", "??", "??", "¨ª?", "??"}, 
	  chuan = {"??", "?¡§", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "?¡ã", "??", "??"}, 
	  gou = {"??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "¨®?", "??", "??", "??", "¨¢?", "¨§¡ã", "??", "¨®?", "¡Â?", "?¨ª", "??"}, 
	  bai = {"¡ã?", "¡ã¡Á", "¡ã?", "¡ã?", "??", "¡ã?", "¡ã?", "¡ã?", "??", "??", "¡ã?"}, 
	  cai = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  can = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¡Â?"}, 
	  cen = {"??", "¨¢?", "??"}, 
	  zhen = {"?¨¾", "??", "??", "??", "?¨½", "??", "??", "?¨®", "??", "?¨§", "?¨¦", "??", "?¨ª", "??", "??", "¨§?", "??", "??", "??", "¨®?", "??", "??", "¨¦?", "??", "¨¦?", "??", "??", "??", "??", "¨¦?", "??", "??", "??"}, 
	  tui = {"??", "??", "??", "??", "??", "??", "??", "¨§?"}, 
	  sai = {"??", "?¨¹", "??", "??", "??", "?¨²"}, 
	  zou = {"¡Á?", "¡Á?", "¡Á?", "¡Á¨¢", "??", "??", "??", "??", "?¨ª"}, 
	  zhuang = {"¡Á¡ã", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "??", "¡Á?", "??", "?¡Á"}, 
	  ze = {"??", "?¨¾", "?¨®", "?¨½", "??", "??", "??", "??", "¨®?", "??", "¨®?", "?¡¦", "??", "??", "??"}, 
	  zhou = {"??", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ì", "??", "?¡§", "?¨²", "??", "?¨ª", "¨ª?", "??", "?¨¹", "?¡ì"}, 
	  que = {"?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Á", "¨ª¡§"}, 
	  mao = {"??", "??", "??", "?¡ã", "??", "??", "??", "??", "?¡§", "¡Â?", "??", "¨ª?", "?¨®", "?¨®", "??", "??", "??", "¨¢?", "??", "¨®?", "??", "¨§?", "?¡Â", "??", "??"}, 
	  fan = {"¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦¡¦", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "¡¦?", "?¨®", "??", "¡¦¡ã", "¨¢?", "??", "??", "?¨§", "¨§?"}, 
	  xuan = {"??", "??", "??", "??", "?¨¹", "??", "?¨²", "??", "?¡è", "??", "??", "¨§?", "??", "??", "??", "??", "??", "¨§?", "??", "¨¦?", "??", "??", "??", "¨ª?", "??", "??", "??"}, 
	  ya = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨®", "??", "??", "??", "??", "¨ª?", "?¨¦", "??", "¨¢?", "¨ª?"}, 
	  me = {"??", "¡Â¨¢"}, 
	  ma = {"??", "?¨ª", "??", "??", "?¨¦", "??", "??", "??", "??", "??", "?¡§", "?¨§", "?¨¦", "¨®?", "¨¢?", "??", "??"}, 
	  wang = {"??", "??", "??", "??", "?¨¹", "??", "?¨²", "??", "??", "?¡Â", "??", "??", "??", "¨¦?", "¡Â?", "??"}, 
	  ce = {"??", "??", "?¨¢", "??", "??", "?¨¹"}, 
	  nu = {"??", "??", "??", "??", "?¨®", "??", "??", "??", "??", "??", "¨ª¡è"}, 
	  tan = {"??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "?¡ã", "??", "??", "??", "??"}, 
	  kuang = {"??", "?¨®", "?¨¾", "?¨½", "??", "??", "??", "??", "?¡Â", "??", "??", "??", "??", "??", "??", "??"}, 
	  se = {"??", "??", "??", "??", "??", "??", "?¡è"}, 
	  shai = {"??", "??", "??"}, 
	  tsmz = {"????????", "SYP", "????????", "??????"}, 
	  lie = {"??", "??", "??", "??", "??", "??", "??", "?¨®", "??", "¡Â?", "??", "??", "?¨½"}, 
	  gang = {"??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "¨ª¡ã", "¨®?"}, 
	  kuan = {"??", "?¨ª", "¡Â?"}, 
	  la = {"??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "¨ª?", "??", "??"}, 
	  gu = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "?¨®", "¨¢?", "¨¦?", "??", "??", "??", "??", "¨§?", "¡Â?", "??", "??", "??", "??", "??", "??", "¨¾?", "??", "??", "?¨½"}, 
	  gen = {"??", "?¨²", "?¡§", "??", "??", "??"}, 
	  tu = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  qun = {"??", "??", "??"}, 
	  su = {"??", "??", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "?¨ª", "??", "¨®?", "??", "??", "??", "??", "??", "??", "??"}, 
	  lei = {"??", "??", "?¡Á", "??", "?¨¢", "??", "??", "??", "??", "??", "??", "?¨²", "¨½?", "??", "??", "??", "??", "??", "??", "¨¦?"}, 
	  xun = {"??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "¨¢?", "??", "??", "??", "??", "??", "??", "?¡Â", "??", "??", "¨¢?", "?¡Â", "??", "?¡§", "??", "??", "¨½?", "??", "??", "??"}, 
	  zhua = {"¡Á?", "??"}, 
	  re = {"??", "??", "??"}, 
	  mi = {"?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¡Â?", "?¡§", "?¡Á", "??", "??", "??", "??", "??", "?¡Á", "??", "??", "??", "¨§¨¾", "¡Â?", "??", "??", "?¨¦", "??"}, 
	  pei = {"??", "??", "??", "??", "??", "??", "?¨¢", "??", "??", "¨§¡¦", "?¨²", "??", "??", "??", "??"}, 
	  kao = {"??", "??", "??", "??", "?¨ª", "??", "??", "??"}, 
	  duan = {"??", "??", "??", "??", "??", "??", "¨§?", "¨¦?", "¨®?"}, 
	  luo = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "?¨®", "??", "??", "¨ª?", "??", "¨¦?", "??", "¨½¡ì", "??", "?¨¢", "?¡è", "??", "??"}, 
	  e = {"??", "?¨ª", "?¨½", "?¨§", "??", "??", "?¨¾", "??", "??", "?¨®", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨½", "?¡ã", "¨¾?", "??", "?¨ª", "??", "¨¦?"}, 
	  shuang = {"??", "??", "??", "?¡Á", "?¨½"}, 
	  rang = {"??", "??", "??", "??", "??", "??", "¨§¨¹"}, 
	  qie = {"??", "??", "??", "??", "??", "??", "??", "?¡è", "??", "??", "?¨¹", "?¡ì", "¨®?", "??"}, 
	  pian = {"??", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "??", "??", "?¨²", "??"}, 
	  kong = {"??", "??", "?¡Á", "??", "??", "¨¢?", "¨®¨ª"}, 
	  ni = {"??", "?¨¢", "??", "??", "??", "?¨¾", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "??", "??", "?¨¾", "??", "??", "¨ª?", "¨§¨¾", "??", "¨ª?"}, 
	  ceng = {"??", "??", "??"}, 
	  huang = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¾", "¨¢?", "??", "??", "¨®¨¾", "?¨¹", "¨®¡§", "¨½?"}, 
	  suan = {"??", "?¨¢", "??", "??"}, 
	  po = {"??", "¡¦?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "??", "¨®?", "??", "??", "??", "??", "?¡¦"}, 
	  tie = {"?¨²", "??", "??", "¡Â?", "??"}, 
	  man = {"?¨²", "??", "?¨¹", "??", "??", "?¡Â", "??", "¡Â?", "??", "¨¢?", "??", "¨¾?", "¨§¡Á", "??", "??", "¨¾?", "??", "¡Â?"}, 
	  ai = {"¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "??", "¡ã¡ì", "¡ã¡è", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã¡§", "¡ã?", "?¡ã", "??", "??", "??", "??", "?¡§", "??", "??", "¨ª?"}, 
	  rong = {"??", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "?¡Á", "??", "¨¢?", "??", "¨¢?", "¨¾?"}, 
	  chen = {"??", "??", "?¨¾", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "¨ª¡Á", "??", "??", "¨¦?", "?¡Â", "??", "??"}, 
	  pai = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  cu = {"??", "??", "??", "?¡Á", "¡Á?", "?¨ª", "?¡ì", "??", "??", "??", "¨¦?", "¨¢?"}, 
	  kun = {"?¡ì", "??", "?¡è", "??", "??", "??", "??", "??", "¡Â?", "?¡ì", "??"}, 
	  chao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "¨§?", "¨½¨¦", "?¡Â"}, 
	  sui = {"??", "??", "??", "?¨¦", "?¨¾", "?¨ª", "?¨§", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "¨ª?", "??"}, 
	  chun = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "¨¾¨ª"}, 
	  kuo = {"??", "??", "?¡§", "??", "??", "?¨¦", "¨¾?"}, 
	  hong = {"?¨§", "??", "?¨¦", "??", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "??", "?¡ì", "??", "??", "?¡ã"}, 
	  mai = {"?¨¾", "??", "?¨®", "??", "??", "?¨½", "??", "?¡è", "??"}, 
	  xiu = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "¨¢?", "??", "??", "??", "??", "¡Â?", "??", "?¡Â"}, 
	  qin = {"?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨½?", "??", "¨½?", "??", "?¨§", "??", "??", "??", "??", "?¡¦", "??", "¨¦?", "¨¾?"}, 
	  cuo = {"??", "?¨ª", "??", "?¨§", "??", "?¨¦", "??", "??", "??", "¨¢?", "??", "?¨®", "??", "??", "??"}, 
	  long = {"?¨²", "??", "??", "??", "??", "??", "??", "?¡è", "??", "??", "??", "?¡Á", "?¨¹", "¨ª?", "??", "?¨½", "??", "¨½?"}, 
	  dun = {"??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "¨§?", "¨ª?", "??", "??", "¨ª?", "??", "¨ª?"}, 
	  kang = {"??", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??"}, 
	  pu = {"??", "??", "??", "??", "??", "?¡è", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡ì", "??", "??", "??", "?¨¦", "??", "??", "??", "??"}, 
	  reng = {"??", "??"}, 
	  bo = {"?¡§", "??", "??", "??", "??", "??", "??", "??", "??", "¡ã?", "??", "?¡ã", "¡ã?", "??", "??", "?¡¦", "??", "??", "??", "?¡è", "?¡è", "¨ª?", "??", "??", "??", "?¨½", "?¡ì", "??", "??", "??", "??", "??", "??", "¨¦?", "??", "??", "??", "??"}, 
	  lan = {"??", "??", "??", "??", "??", "¨¢¡ã", "??", "??", "??", "??", "??", "??", "??", "¨¦?", "¨§?", "?¡¦", "??", "¨½?", "??", "??", "??", "?¨ª"}, 
	  piao = {"??", "??", "??", "??", "??", "?¡ã", "??", "??", "¨¦?", "??", "??", "??", "??", "¨®?"}, 
	  sun = {"??", "??", "?¨½", "??", "¨¦?", "??", "¨¢?", "??"}, 
	  ning = {"??", "??", "??", "??", "??", "??", "??", "?¨¹", "?¨²", "¨½¡Â", "??"}, 
	  ku = {"??", "??", "??", "?¨¢", "??", "??", "??", "¡Â?", "??", "??", "??", "?¡¦"}, 
	  nao = {"??", "??", "??", "??", "??", "?¡ì", "?¡Á", "??", "?¨½", "?¨®", "??", "¨ª?", "??", "¨¾?"}, 
	  tao = {"?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "??", "??", "¡Â?", "??"}, 
	  song = {"??", "??", "??", "??", "??", "??", "??", "¨¢?", "??", "??", "?¡è", "¨¢?", "??", "?¨§", "¨½?", "??"}, 
	  mou = {"??", "??", "??", "??", "¨ª?", "??", "¨¾¨²", "??", "¨¾?", "?¡ã"}, 
	  pa = {"??", "??", "??", "??", "¡ã?", "??", "??", "??", "??", "¡ã?", "??", "??", "¨®¨¢"}, 
	  lue = {"??", "??", "??"}, 
	  hei = {"??", "??"}, 
	  chai = {"??", "??", "?¨½", "??", "?¨¾", "??", "¨¾?", "??"}, 
	  a = {"¡ã?", "¡ã?", "??", "??", "??", "??", "??"}, 
	  ting = {"??", "??", "??", "?¨¹", "??", "??", "?¡è", "?¡ì", "??", "??", "?¨²", "??", "??", "??", "¨¾?", "??", "??", "??"}, 
	  sha = {"??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "?¡¦", "??", "??", "??", "??", "??", "??", "??", "??", "¨§?"}, 
	  tuo = {"??", "??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨ª?", "??", "??", "??", "¨¦?", "??", "??", "??", "??", "¨®?", "??"}, 
	  pan = {"??", "??", "¡¦?", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨®?", "?¨²", "¨½?", "¨½¨¢"}, 
	  gua = {"?¡§", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¦"}, 
	  lou = {"??", "??", "??", "??", "??", "?¡ì", "?¡§", "??", "??", "??", "?¨¹", "¡Â?", "¨½?", "¨¾¡Â", "¨¢?", "??"}, 
	  han = {"??", "??", "??", "??", "??", "??", "??", "??", "?¡ã", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¡§", "?¡¦", "??", "¡Â?", "??", "¨¾?", "¨¾?", "??", "??", "¨½¨¹", "¨§?", "??"}, 
	  cao = {"??", "??", "??", "??", "??", "??", "??", "¨®?", "??"}, 
	  cang = {"??", "??", "??", "?¡Á", "??"}, 
	  zang = {"??", "??", "?¨¢", "??", "?¡ã", "??", "??"}, 
	  shun = {"??", "??", "??", "??"}, 
	  ka = {"?¡§", "??", "?¡ì", "??", "??", "??", "??"}, 
	  qia = {"?¡§", "??", "??", "?¡è", "??", "¡Â?", "¨½?", "??"}, 
	  qiao = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨½", "??", "¨¦?", "??", "??", "??", "¨¢?", "??", "??", "??", "¡Â?", "¨ª?", "??", "??"}, 
	  fou = {"¡¦¨½", "¨®?"}, 
	  bang = {"¡ã?", "¡ã?", "¡ã¨½", "¡ã?", "¡ã¨¾", "¡ã¡Â", "¡ã¨®", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "??", "?¨¾"}, 
	  ao = {"¡ã?", "¡ã?", "¡ã?", "¡ã?", "¡ã?", "??", "¡Â?", "¡ã?", "??", "¡Â¨¦", "¡ã?", "??", "¡ã?", "??", "??", "¡ã?", "¨¢?", "¨¾¨¹", "?¨½", "¨¦¨¢", "??", "??", "??", "¨½¨²"}, 
	  zhai = {"??", "?¨½", "??", "??", "??", "??", "??", "??", "??", "??", "¨ª?", "¨½?"}, 
	  zhui = {"¡Á¡¦", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "¡Á?", "?¡¦", "?¨ª", "??"}, 
	  chou = {"??", "?¨¦", "?¨½", "??", "??", "?¨®", "??", "??", "??", "?¨ª", "?¨¾", "?¨§", "?¡ã", "??", "¨½?", "??", "?¨¹"}, 
	  zen = {"??", "??"}, 
	  kui = {"?¡Â", "?¨¹", "??", "??", "??", "??", "??", "??", "?¨²", "??", "??", "??", "??", "¨½?", "?¡ã", "??", "¨®¨½", "??", "??", "?¨½", "?¨®", "??", "??", "??", "??", "??", "??", "¨¾¨½"}, 
	  ha = {"??", "??", "?¨¾", "??"}, 
	  za = {"??", "?¨²", "??", "??", "??", "??", "??"}, 
	  luan = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  xiong = {"??", "??", "??", "??", "?¡Á", "??", "??", "??"}, 
	  ne = {"??", "??", "??", "??"}, 
	  zan = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  rui = {"??", "?¨½", "??", "??", "??", "?¡§", "¨¾?", "??"}, 
	  tang = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "??", "¨®?", "??", "??", "??", "¨¦?", "??", "¨®?", "¨½¨ª", "??", "??"}, 
	  run = {"?¨®", "?¨¾"}, 
	  kua = {"??", "??", "??", "??", "??", "?¡§"}, 
	  wa = {"??", "??", "??", "??", "??", "??", "¡ã?", "??", "??", "??", "??"}, 
	  meng = {"??", "??", "??", "??", "??", "??", "??", "?¨¹", "??", "??", "??", "??", "¨¾¨§", "¨¾?", "¨®¡¦", "??", "??", "??", "??", "¨ª?"}, 
	  bin = {"??", "??", "?¨®", "?¨¾", "??", "¨¦?", "??", "¡Â?", "¨¦?", "?¡Â", "?¡Â", "??", "??", "¨¢?", "¡Â?", "??"}, 
	  leng = {"??", "??", "??", "??", "?¡§"}, 
	  peng = {"??", "?¨®", "?¨ª", "?¨¾", "??", "??", "??", "??", "??", "?¨½", "?¨§", "??", "??", "?¨½", "?¨¦", "??", "¨®?", "??"}, 
	  niu = {"??", "??", "?¡è", "??", "??", "?¡è", "??", "¨¢?"}, 
	  rou = {"??", "?¨¢", "??", "??", "¡Â¡¦", "??"}, 
	  ruo = {"??", "??", "??"}, 
	  sen = {"??"}, 
	  sa = {"??", "?¡Â", "??", "¨§?", "??", "?¨ª", "??", "??"}, 
	  juan = {"?¨ª", "??", "??", "?¨§", "??", "??", "??", "??", "??", "??", "?¨¦", "??", "??", "¨¢¨²", "??", "??"}, 
	  pao = {"??", "??", "??", "?¡Á", "??", "??", "??", "??", "??", "¨¢¨®", "??", "??"}, 
	  ruan = {"?¨ª", "??", "??"}, 
	  lang = {"??", "??", "??", "??", "??", "??", "??", "¨¾?", "??", "??", "??", "??", "??", "?¨¹"}, 
	  zun = {"¡Á?", "¡Á¨½", "¡Â?", "¨¦¡Á", "?¡è"}, 
	  ken = {"??", "??", "??", "??", "¨½?"}, 
	  hun = {"?¨¦", "?¨§", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  en = {"?¡Â", "??", "??", "?¨§"}, 
	  qiong = {"??", "?¨ª", "¨½¡¦", "??", "??", "¨®?", "??", "¨¾?", "??"}, 
	  rao = {"??", "??", "??", "??", "??", "?¨¦"}, 
	  mang = {"??", "?¡è", "??", "??", "??", "?¡ì", "¨¾?", "??", "¨ª?", "??"}, 
	  nuo = {"??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  teng = {"??", "??", "??", "??", "??"}, 
	  nin = {"?¨²"}, 
	  miao = {"??", "??", "??", "??", "?¨ª", "?¨¦", "??", "?¨§", "¨ª?", "??", "??", "??", "??", "??", "¨ª?", "?¡Â"}, 
	  mie = {"??", "??", "¨®¨²", "??", "??", "¨®?"}, 
	  niang = {"??"}, 
	  nai = {"??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  sang = {"??", "??", "?¡è", "?¨²", "¨¾?", "¨ª?"}, 
	  ca = {"??", "??", "??", "¨ª?"}, 
	  sao = {"?¡§", "?¡ì", "??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  zuan = {"¡Á?", "¡Á?", "¡Á?", "??", "??", "?¨¾"}, 
	  shua = {"??", "??", "?¡ì"}, 
	  gun = {"??", "?¡Â", "??", "?¨¾", "¨ª?", "??", "??"}, 
	  guai = {"??", "??", "??"}, 
	  pang = {"??", "??", "??", "¡ã¨¾", "??", "¡ã?", "¨®?", "¨¢?", "??", "??", "??"}, 
	  nuan = {"??"}, 
	  shuai = {"??", "?¡ì", "?¡è", "??", "¨®¡ã"}, 
	  cui = {"??", "??", "??", "??", "??", "??", "??", "??", "??", "?¨¢", "??", "??", "??", "??", "??", "¨¦?"}, 
	  niao = {"?¨½", "?¨¾", "??", "??", "??", "??", "??"}, 
	  die = {"??", "??", "??", "?¨¹", "?¨²", "??", "??", "??", "¨½¨®", "??", "??", "??", "??", "??", "?¨§", "?¨¦", "??"}, 
	  pen = {"??", "??", "??"}, 
	  chui = {"??", "??", "??", "??", "¡Á?", "??", "¨¦?", "?¡¦", "¨¦?"}, 
	  ang = {"¡ã?", "¡ã?", "¡ã?"}, 
	  keng = {"??", "??", "??"}, 
	  tun = {"??", "??", "??", "??", "??", "??", "??", "??", "??"}, 
	  diu = {"??", "??"}, 
	  weng = {"??", "??", "??", "??", "??"}, 
	  sou = {"??", "??", "??", "??", "??", "??", "??", "??", "¨§?", "??", "??", "??", "¨¾?", "?¡è"}, 
	  ga = {"??", "??", "??", "?¨§", "??", "??", "??", "??", "??"}, 
	  lia = {"??"}, 
	  nen = {"??", "¨ª?"}, 
	  nang = {"??", "??", "?¨§", "??", "??"}, 
	  nie = {"??", "?¨®", "??", "??", "??", "??", "??", "??", "??", "??", "?¡Â", "¨¾¡§", "??", "?¨ª"}, 
	  beng = {"??", "??", "¡ã?", "??", "??", "??", "??", "??", "??"}, 
	  cou = {"??", "??", "?¨ª", "¨¦¡§"}, 
	  pou = {"??", "??", "??"}, 
	  seng = {"??"}, 
	  nue = {"?¡ã"}, 
	  cuan = {"??", "??", "??", "??", "??", "¨§?", "??", "?¨¦"}, 
	  chuo = {"??", "??", "??", "?¡§", "??", "??"}, 
	  chuai = {"?¡ì", "??", "?¡§", "??", "??", "?¨²"}, 
	  jiong = {"??", "??", "??", "??", "¨§?"}, 
	  shuan = {"?¡§", "??", "??", "??"}, 
	  zei = {"??"}, 
	  pie = {"??", "??", "??", "??", "??"}, 
	  miu = {"??"}, 
	  o = {"??", "??", "??"}, 
	  dia = {"??"}, 
	  nou = {"¨½¨½"}, 
	  ei = {"??"}, 
	  s = {"S"}, 
	  y = {"Y"}, 
	  p = {"P"}, 
	  sz = {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9"}}
	local T2 = T1[pinyin]
	if T2 == nil then
	  Cls()
	  DrawStrBox(x, y, "?¨¦????¡Á?????????????", C_GOLD, 24)
	  lib.ShowSurface(0)
	  lib.Delay(2000)
	  return ""
	end
	local page = 0
	local str = ""
	while true do
	  str = ""
	  for i = 1, 9 do
		if T2[i + 9 * page] == nil then
		  break;
		else
			str = str .. i .. "." .. T2[i + 9 * page] .. " "
		end
	  end
	  ShowPinyin(x, y, word, pinyin, str)
	  local keypress = WaitKey()
	  lib.Delay(100)
	  if keypress == VK_DOWN and T2[9 * (page + 1) + 1] ~= nil then
		page = page + 1
	  elseif keypress == VK_UP and 0 < page then
		page = page - 1
	  elseif keypress == 27 then
		return ""
	  elseif 48 >= keypress or keypress < 58 then
		return T2[(page) * 9 + keypress - 48]
	  end
	end
  end
  
  --????????????¡Á?????
  function GetPinyin(x, y, word)
	local T3 = {"a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"}
	local T4 = {"?¡ã", "??", "??", "??", "??", "??", "??", "?¡¦", "??", "??"}
	local str = ""
	while true do
	  ShowPinyin(x, y, word, str)
	  local keypress = WaitKey()
	  lib.Delay(100)
	  if keypress > 96 and keypress < 123 then
		str = str .. T3[keypress - 96]
	  elseif keypress == 8 then
		if string.len(str) == 0 then
		  word = string.sub(word, 1, -3)
		else
			str = string.sub(str, 1, -2)
		end
	  elseif keypress > 47 and keypress < 58 then
		return -1, word .. T4[keypress - 47]
	  
	  elseif keypress == VK_RETURN and str == "" then
		return "finish"
	  
	  elseif keypress == VK_SPACE or keypress == VK_RETURN then
		return str, word
	  
	  elseif keypress == VK_ESCAPE then
		return -1
	  end
	end
  end
  
  --????????????¡Á?¡ã???
  function GetPinyin1(x, y)
	local T3 = {"a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"}
	local T4 = {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9"}
	local str = ""
	while true do
	  ShowPinyin1(x, y, str)
	  local keypress = WaitKey()
	  lib.Delay(100)
	  if keypress > 96 and keypress < 123 then
		str = str .. T3[keypress - 96]
	  elseif keypress == 8 then
		str = string.sub(str, 1, -2)
	  elseif keypress > 47 and keypress < 58 then
		str = str .. T4[keypress - 47]
	  elseif keypress == VK_SPACE then
		str = str .. " "
	  elseif keypress == VK_RETURN then
		return str
	  end
	end
  end
  
  --????????
  function ShowPinyin(x, y, str1, str2, str3)
	Cls()
	local size = 24
	DrawBox(x, y + size, CC.ScreenW - x, y + 5 * size, C_ORANGE)
	if str3 == nil then
	  DrawStrBox(x, y - size / 2, "??????(??)", C_WHITE, size)
	else
	  DrawStrBox(x, y - size / 2, "?????¨½", C_WHITE, size)
	  DrawString(x + 15, y + size * 3.5, str3, C_WHITE, size)
	end
	lib.DrawRect(x + 10, y + size * 3, CC.ScreenW - 10 - x, y + size * 3 + 2, C_WHITE)
	DrawString(x + 20, y + size * 1.6, str1, C_RED, size)
	DrawString(x + 20 + size * string.len(str1) / 2, y + size * 1.6, str2, C_GOLD, size)
	lib.ShowSurface(0)
  end
  
  --????????
  function ShowPinyin1(x, y, str2, str3)
	Cls()
	local size = 24
	DrawBox(x, y + size, 640 - x, y + 5 * size, C_ORANGE)
	if str3 == nil then
	  DrawStrBox(x, y - size / 2, "??????(??)", C_WHITE, size)
	else
	  DrawStrBox(x, y - size / 2, "?????¨½", C_WHITE, size)
	  DrawString(x + 15, y + size * 3.5, str3, C_WHITE, size)
	end
	lib.DrawRect(x + 10, y + size * 3, 630 - x, y + size * 3 + 2, C_WHITE)
	DrawString(x + 20, y + size * 1.6, str2, C_GOLD, size)
	lib.ShowSurface(0)
  end







function NewGame()     --???¨½?????¡¦???????¡Â??????????
	Cls();
	ShowScreen();
	LoadRecord(0); --  ?????????¡¦????
	rest()
	--PlayMIDI(77);
	CC.Week = 1
	CC.Gold = 0
	CC.Sp = 0
	if existFile(CONFIG.DataPath..'TgJl') then
		tgload()
	end
    
	--????????????
	if existFile(CC.Acvmts) then
		dofile(CC.Acvmts)
	--??????
	else
		Achievements.Round = 1
		Achievements.pChar = {}
		Achievements.rdsCpltd = {}
		for i = 1, JY.PersonNum do
			Achievements.rdsCpltd[i] = {}
			Achievements.rdsCpltd[i].n = 0
			Achievements.rdsCpltd[i].lvlReached1 = 0
			Achievements.rdsCpltd[i].lvlReached2 = 0
		end
		Achievements.sp = 0
		Achievements.bonus = {}
		for i = 1, 7 do
			Achievements.bonus[i] = 0
		end
		--???¨ª?¨½??????????????
		SaveTable(Achievements)
	end
    if CC.Week > 1 then 
        CC.Week = 125
    end
	JY.Base["????"] = CC.Week
	JY.Base["?¨¦??"] = CC.Sp
	JY.Status = GAME_NEWNAME
	lib.PlayMPEG(CONFIG.DataPath .. "/avi/1.mp4",VK_ESCAPE) --????????
    Cls()
	
	--???¨½???¡Â????????
	lib.LoadPicture(CC.BG01File,-1,-1)	
	local xz = Moshixz()
	--local player_type = JYMsgBox("?¡Â?????¨½", "???¨½?????????¡Â??????*", {"??¡Á??¡Â??","?????¡Â??"}, 2, 903)
	
	if JY.Base["????5"] == 0 then
		bzzjmenu()
	elseif JY.Base["????5"] == 1 then
		local player_type = 0
		--local cx,zj,ts,xb = firstmenu()
		local cx,zj,ts,xb = firstmenu1()
		
		if ts > 0 then 
			player_type = 3
		elseif cx > 0 then
			player_type = 2
		else 
			player_type = 1
		end


		Cls()
		JY.Person[0]["????"]=CC.NewPersonName; 
		JY.Person[0]["?¨²?¨¹¡Á??¨®??"] = 500
		JY.Person[0]["????¡Á??¨®??"] = 500
		JY.Person[0]["?¨²?¨¹"] = JY.Person[0]["?¨²?¨¹¡Á??¨®??"]
		JY.Person[0]["????"] = JY.Person[0]["????¡Á??¨®??"]
		JY.Person[0]["???¡Â??"] = 80
		JY.Person[0]["¡¦?????"] = 80
		JY.Person[0]["?¨¢??"] = 80
		JY.Person[0]["????????"] = 30
		JY.Person[0]["????????"] = 30
		--JY.Person[0]["????????"] = 30
		JY.Person[0]["????????"] = 0
		JY.Person[0]["??????¡¦¨¾"] = 40
		JY.Person[0]["??¡¦¡§????"] = 40
		JY.Person[0]["????????"] = 40
		JY.Person[0]["????????"] = 40
		JY.Person[0]["???????¡Â"] = 40
		JY.Person[0]["¡ã??¡Â????"] = 40

		local zm = JY.Base["????"]
		local nd = JY.Base["????"] 
		local addkfnum  
		if nd < 4 then 
			addkfnum = 12 + math.modf(zm/2)
		else
			addkfnum = 12 + math.modf(zm/1)
		end 
		JY.Base["????????"] = JY.Base["????????"] + addkfnum + 3
		if JY.Base["????????"] > 15 then 
			JY.Base["????????"] = 15
		end	
		--??¡Á??¡Â??+?????¡Â??
		lib.LoadPicture(CC.BG01File,-1,-1)
		if player_type == 3 then
			if ts == 1 then 
				JY.Base["????"] = 1
				--?????¡Â????????
				JY.Person[0]["????"] = "????????"
				JY.Person[0]["?¡¦?¨½?¨²??"] = 355
				JY.Person[0]["¡ã??¨ª?¨½"] = 355
				local T_ani = {
					{0, 0, 0}, 
					{0, 0, 0}, 
					{10, 8, 6}, 
					{0, 0, 0}, 
					{0, 0, 0}}
				for i = 1, 5 do
					JY.Person[0]["????????????" .. i] = T_ani[i][1]
					JY.Person[0]["????????????" .. i] = T_ani[i][3]
					JY.Person[0]["???????¡ì????" .. i] = T_ani[i][2]
				end
			elseif ts == 2 then
				JY.Base["????"] = 2
				JY.Person[0]["????"] = "¡¦?????"
				JY.Person[0]["????"] = 1
				JY.Person[0]["????"] = "????"
				JY.Person[0]["????2"] = "???¡¦"
				JY.Person[0]["?¡¦?¨½?¨²??"] = 368
				JY.Person[0]["¡ã??¨ª?¨½"] = 580
				local f_ani = {
						{0, 0, 0}, 
						{0, 0, 0}, 
						{17, 15, 13}, 
						{0, 0, 0}, 
						{0, 0, 0}}
				for i = 1, 5 do
					JY.Person[0]["????????????" .. i] = f_ani[i][1]
					JY.Person[0]["????????????" .. i] = f_ani[i][3]
					JY.Person[0]["???????¡ì????" .. i] = f_ani[i][2]
				end
			end
			
			--if DrawStrBoxYesNo(-1, -1, "??¡¦¨½¡Á???????", C_WHITE, CC.DefaultFont) == true then

				for i=1,JY.Base["????????"] do
					JY.Person[0]["????" .. i]=JY.Person[clone_choice]["????" .. i]
					JY.Person[0]["????????" .. i]=JY.Person[clone_choice]["????????" .. i]
					if i > 2 then
						JY.Person[0]["????" .. i] = 0
					   JY.Person[0]["????????" .. i] = 0	
					end
				end
			--else
				--[[for i=1,JY.Base["????????"] do
					JY.Person[0]["????" .. i]=JY.Person[clone_choice]["????" .. i]
					JY.Person[0]["????????" .. i]=JY.Person[clone_choice]["????????" .. i]
					if i > 0 then
						JY.Person[0]["????" .. i] = 0
					   JY.Person[0]["????????" .. i] = 0	
					end
				end		
			end]]
		elseif player_type == 2 then
				
			local clone_choice = cx
			JY.Base["????"] = cx
			
			JY.Person[0]["?¨²??"]=JY.Person[clone_choice]["?¨²??"]
			JY.Person[0]["?¡¦?¨½?¨²??"]=JY.Person[clone_choice]["?¡¦?¨½?¨²??"]
			JY.Person[0]["¡ã??¨ª?¨½"]=JY.Person[clone_choice]["¡ã??¨ª?¨½"]
			JY.Person[0]["?¨²?¨¹???¡è"]=JY.Person[clone_choice]["?¨²?¨¹???¡è"]
			if JY.Person[0]["?¨²?¨¹???¡è"] < 6 then
				JY.Person[0]["?¨²?¨¹???¡è"] = 6
			end
			if JY.Person[0]["?¨²?¨¹???¡è"] > 12 then
				JY.Person[0]["?¨²?¨¹???¡è"] = 12
			end
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			if DrawStrBoxYesNo(-1, -1, "??¡¦¨½?????????¡Â???¨¹????", C_WHITE, CC.DefaultFont) then
				JY.Person[0]["????"] = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
			else
				JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			end
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]

			JY.Person[0]["???¡Â"]=-1
			JY.Person[0]["¡¦???"]=-1
			JY.Person[0]["¡Á???"]=-1
			for i=1,5 do
				JY.Person[0]["????????????" .. i]=JY.Person[clone_choice]["????????????" .. i]
				JY.Person[0]["????????????" .. i]=JY.Person[clone_choice]["????????????" .. i]
				JY.Person[0]["???????¡ì????" .. i]=JY.Person[clone_choice]["???????¡ì????" .. i]
			end
			
			--??????¡¦??¨¢¡Á???55
			JY.Person[0]["???¡Â??"]=limitX(JY.Person[clone_choice]["???¡Â??"]/4,55,75)
			JY.Person[0]["¡¦?????"]=limitX(JY.Person[clone_choice]["¡¦?????"]/4,55,75)
			JY.Person[0]["?¨¢??"]=limitX(JY.Person[clone_choice]["?¨¢??"]/4,55,75)
			--????????????¡Á???30
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],30)
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],30)
			--JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],30)
			JY.Person[0]["¡ã??¡Â????"]=limitX(JY.Person[clone_choice]["¡ã??¡Â????"],30)
			JY.Person[0]["????????"]=JY.Person[clone_choice]["????????"]
			JY.Person[0]["?¡Â??????"]=nil
			JY.Person[0]["?¡Â???¨¢??"]=nil	
			JY.Person[0]["????????"]= 0
			JY.Person[0]["????????"]= 0

			if CC.PersonExit[clone_choice] ~= nil  then
			
			JY.Person[0]["??????¡¦¨¾"]=limitX(JY.Person[clone_choice]["??????¡¦¨¾"],40,70)
			JY.Person[0]["??¡¦¡§????"]=limitX(JY.Person[clone_choice]["??¡¦¡§????"],40,70)
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],40,70)	
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],40,70)
			JY.Person[0]["???????¡Â"]=limitX(JY.Person[clone_choice]["???????¡Â"],40,70)
			else
			
			JY.Person[0]["??????¡¦¨¾"]=limitX(JY.Person[clone_choice]["??????¡¦¨¾"]/3,40,70)
			JY.Person[0]["??¡¦¡§????"]=limitX(JY.Person[clone_choice]["??¡¦¡§????"]/3,40,70)
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"]/3,40,70)		
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"]/3,40,70)	
			JY.Person[0]["???????¡Â"]=limitX(JY.Person[clone_choice]["???????¡Â"]/3,40,70)	
			end
			
			JY.Person[0]["???¡ì????"]=JY.Person[clone_choice]["???¡ì????"]
			JY.Person[0]["???¡Â????"]=JY.Person[clone_choice]["???¡Â????"]
			JY.Person[0]["¡Á¨®??????"]=JY.Person[clone_choice]["¡Á¨®??????"]
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			-- if JY.Base["????"] == 514 then
					-- JY.Person[0]["??????¡¦¨¾"]= 50 + zm
					-- JY.Person[0]["??¡¦¡§????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["???????¡Â"]= 50 + zm
			-- end
			
			-- if JY.Base["????"] == 515 then
					-- JY.Person[0]["??????¡¦¨¾"]= 50 + zm
					-- JY.Person[0]["??¡¦¡§????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["???????¡Â"]= 50 + zm
			-- end
			if JY.Base["????"] ~= 52 then	--????????
				Cls();	
				--if DrawStrBoxYesNo(-1, -1, "??¡¦¨½¡Á???????", C_WHITE, CC.DefaultFont) == true then

				for i=1,JY.Base["????????"] do
					JY.Person[0]["????" .. i]=JY.Person[clone_choice]["????" .. i]
					JY.Person[0]["????????" .. i]=JY.Person[clone_choice]["????????" .. i]
					if i > 2 then
						JY.Person[0]["????" .. i] = 0
					   JY.Person[0]["????????" .. i] = 0	
					end
				end
				--else
					--[[for i=1,JY.Base["????????"] do
						JY.Person[0]["????" .. i]=JY.Person[clone_choice]["????" .. i]
						JY.Person[0]["????????" .. i]=JY.Person[clone_choice]["????????" .. i]
						if i > 0 then
							JY.Person[0]["????" .. i] = 0
						   JY.Person[0]["????????" .. i] = 0	
						end
					end		
				end]]
			end
			
			--???¡§????
			--[[if JY.Base['???¡§'] == 1 then
				local id = JY.Base['????']
				if MPPD(id) > 0 then
					local mptype, mpdj = MPDISPLAY(id)
					if DrawStrBoxYesNo(-1, -1, "??¡¦¨½¡Á???????????????"..mptype.."??".."???¡Á??"..mpdj, C_WHITE, CC.DefaultFont) == true then
						JoinMP(0,MPPD(id),MPDJ(id))
						MPAttrib(0)
					else
					end
				end
			end]]	
			for i=1,4 do
				JY.Person[0]["???????¡¦" .. i]=JY.Person[clone_choice]["???????¡¦" .. i]
				JY.Person[0]["???????¡¦????" .. i]=JY.Person[clone_choice]["???????¡¦????" .. i]
			end
			
			for i=1,4 do
				JY.Person[0]["?¨§??????"..i]=JY.Person[clone_choice]["?¨§??????"..i]
			end
			
			JY.Person[0]["?¨§??????"]=JY.Person[clone_choice]["?¨§??????"]
			JY.Person[0]["?¨§???¨¢??"]=JY.Person[clone_choice]["?¨§???¨¢??"]
			--JY.Person[0]["????¡¦??¡Á"]=JY.Person[clone_choice]["????¡¦??¡Á"]
			JY.Person[0]["????2"]=JY.Person[clone_choice]["????2"]
			JY.Person[0]["????????"] = JY.Person[clone_choice]["????????"]
				
			--?????????¨¢????????¡ã???????????????????upedit-------------		
			--?¡Â????????????
			JY.Person[92]['????????1'] = 171
			--????????????
			
			--??¡¦?????
			JY.Person[539]["????"] = "??¡¦?"
			JY.Person[539]["????????????2"]= JY.Person[50]["????????????2"]
			JY.Person[539]["????????????2"]= JY.Person[50]["????????????2"]
			JY.Person[539]["???????¡ì????2"]= JY.Person[50]["???????¡ì????2"]
			JY.Person[539]["????????????4"]= 0
			JY.Person[539]["????????????4"]= 0
			JY.Person[539]["???????¡ì????4"]= 0
			--???????¡ì???¡¦?¨½????
			if JY.Base["????"] == 617 then
				JY.Person[0]["?¡¦?¨½?¨²??"]=848
				JY.Person[0]["¡ã??¨ª?¨½"]=353
				JY.Person[0]["????????????3"]=10
				JY.Person[0]["????????????3"]=8
				JY.Person[0]["???????¡ì????3"]=8
			end
			--????????¡Á?
			if JY.Base["????"] == 116 then
				JY.Person[0]["?¡¦?¨½?¨²??"]=882
				JY.Person[0]["¡ã??¨ª?¨½"]=1089
				JY.Person[0]["????????????2"]=17
				JY.Person[0]["????????????2"]=15
				JY.Person[0]["???????¡ì????2"]=15
			end
			--??¡¦???¡ã?????
			if JY.Base["????"] == 27 then
			   --instruct_32(349,-1)
			end		
			
			--??????¡¦????????¨½????
			if JY.Base["????"] == 50 then
				--[[
				local wcywg = JYMsgBox("?????¨½", "?????¨½????????????", {"???¨²??¡ã???","?¨¾?¡¦¡ã?¡¦¡§"}, 2, 50)
				if wcywg == 1 then
					JY.Person[0]["????1"] = 26
					JY.Person[0]["????????1"] = 999
				elseif wcywg == 2 then
					JY.Person[0]["????1"] = 80
					JY.Person[0]["????????1"] = 999
				end
				]]
				JY.Person[0]["????1"] = 26
				JY.Person[0]["????????1"] = 999
				JY.Person[0]["????2"] = 80
				JY.Person[0]["????????2"] = 999
				--JY.Person[0]["????3"] = 204
				--JY.Person[0]["????????3"] = 999
				ClsN()
			end
			
			--??????????????
			if JY.Base["????"] == 58 then
				JY.Scene[19]["????????"] = 1
				JY.Scene[101]["????????"] = 1
				JY.Scene[36]["????????"] = 1
				JY.Scene[28]["????????"] = 1
				JY.Scene[93]["????????"] = 1
				JY.Scene[105]["????????"] = 1
				null(18, 6)
				null(70, 87)
				addevent(70, 95, 0, 4188, 3, 0)
			end
			--????????
			if JY.Base["????"] == 592 then
				JY.Person[0]["????2"]= 0
				JY.Person[0]["????????2"]= 0
				JY.Person[0]["????????"]=30
				JY.Person[0]["???????¡Â"]=30
				JY.Person[0]["??¡¦¡§????"]=30
				JY.Person[0]["??????¡¦¨¾"]=30
			end
			local menu = {}
			for k,v in pairs(CC.PTFSM) do
				if CC.PTFSM[k][1] ~= nil and CC.PTF[clone_choice][k] == 1 then
					CC.PTF[0][k] = 1
				end	
			end
			Hp_Max(0)	
			--SetJX(626,1)
		elseif player_type == 1 then 
			if xb == 1 then 
				JY.Person[0]["????"] = 1
				JY.Person[0]["????"] = "????"
				JY.Person[0]["????2"] = "???¡¦"				
				local f_ani = {
				{0, 0, 0}, 
				{9, 9, 7}, 
				{8, 8, 6}, 
				{8, 8, 6}, 
				{9, 7, 7}}
				for i = 1, 5 do
					JY.Person[0]["????????????" .. i] = f_ani[i][1]
					JY.Person[0]["????????????" .. i] = f_ani[i][3]
					JY.Person[0]["???????¡ì????" .. i] = f_ani[i][2]
				end
			end
			
			--?????¡Â
			if zj == 1 then         --??
				JY.Base["??¡Á?"] = 1
				JY.Person[0]["??????¡¦¨¾"] = 60
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end
				SetTF(0,9960,1)
			elseif zj == 2 then     --??
				JY.Person[0]["??¡¦¡§????"] = 60
				JY.Base["??¡Á?"] = 2
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end
				SetTF(0,9959,1)
			elseif zj == 3 then     --??
				JY.Person[0]["????????"] = 60
				JY.Base["??¡Á?"] = 3	
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547--228
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end
				SetTF(0,9958,1)
			elseif zj == 4 then     --??
				JY.Person[0]["????????"] = 60
				JY.Base["??¡Á?"] = 4
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end
				SetTF(0,9957,1)
			elseif zj == 5 then		 --?? 
				JY.Person[0]["???????¡Â"] = 60
				JY.Base["??¡Á?"] = 5
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end
				SetTF(0,9956,1)
			elseif zj == 6 then		 --?¨§??
				JY.Person[0]["????¡Á??¨®??"] = 5000
				JY.Person[0]["????"] = 5000
				JY.Person[0]["?¨²?¨¹???¡è"] = 7
				JY.Base["??¡Á?"] = 6
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end
				--SetTF(0,9947,1)
				SetTF(0,9946,1)
			elseif zj == 7 then		 --????
				JY.Person[0]["?¡¦??"] = 100
				JY.Person[0]["??????¡¦¨¾"] = 50
				JY.Person[0]["??¡¦¡§????"] = 50
				JY.Person[0]["????????"] = 50
				JY.Person[0]["????????"] = 50
				JY.Person[0]["???????¡Â"] = 50
				JY.Base["??¡Á?"] = 7
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end				
			elseif zj == 8 then		 --???¨²
				JY.Base["??¡Á?"] = 8
				JY.Person[0]["????????"] = 200
				JY.Person[0]["????????"] = 200
				JY.Person[0]["?¨²?¨¹???¡è"] = 7
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end				
			elseif zj == 9 then		 --????
				JY.Base["??¡Á?"] = 9
				JY.Person[0]["?¨²?¨¹???¡è"] = 7
				JY.Person[0]["????????"] = 300
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end		
			elseif zj == 10 then		 --???¡Â
				JY.Base["??¡Á?"] = 10
				JY.Person[0]["??????¡¦¨¾"] = 50
				JY.Person[0]["??¡¦¡§????"] = 50
				JY.Person[0]["????????"] = 50
				JY.Person[0]["????????"] = 50
				JY.Person[0]["???????¡Â"] = 50
				JY.Person[0]["?¨²?¨¹???¡è"] = 7
				if xb == 1 then
					JY.Person[0]["?¡¦?¨½?¨²??"] = 547
				else
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
				end			
			end            	
		end
    else
		local player_type = 0
		--local cx,zj,ts,xb = firstmenu()
		local cx,zj,ts,xb = firstmenu2()
		
		if ts > 0 then 
			player_type = 3
		elseif cx > 0 then
			player_type = 2
		else 
			player_type = 1
		end


		Cls()
		JY.Person[0]["????"]=CC.NewPersonName; 
		JY.Person[0]["?¨²?¨¹¡Á??¨®??"] = 500
		JY.Person[0]["????¡Á??¨®??"] = 500
		JY.Person[0]["?¨²?¨¹"] = JY.Person[0]["?¨²?¨¹¡Á??¨®??"]
		JY.Person[0]["????"] = JY.Person[0]["????¡Á??¨®??"]
		JY.Person[0]["???¡Â??"] = 80
		JY.Person[0]["¡¦?????"] = 80
		JY.Person[0]["?¨¢??"] = 80
		JY.Person[0]["????????"] = 30
		JY.Person[0]["????????"] = 30
		--JY.Person[0]["????????"] = 30
		JY.Person[0]["????????"] = 0
		JY.Person[0]["??????¡¦¨¾"] = 40
		JY.Person[0]["??¡¦¡§????"] = 40
		JY.Person[0]["????????"] = 40
		JY.Person[0]["????????"] = 40
		JY.Person[0]["???????¡Â"] = 40
		JY.Person[0]["¡ã??¡Â????"] = 40

		local zm = JY.Base["????"]
		local nd = JY.Base["????"] 
		local addkfnum  
		if nd < 4 then 
			addkfnum = 12 + math.modf(zm/2)
		else
			addkfnum = 12 + math.modf(zm/1)
		end 
		JY.Base["????????"] = JY.Base["????????"] + addkfnum + 3
		if JY.Base["????????"] > 15 then 
			JY.Base["????????"] = 15
		end	
		--??¡Á??¡Â??+?????¡Â??
		lib.LoadPicture(CC.BG01File,-1,-1)
		if player_type == 2 then
				
			local clone_choice = cx
			JY.Base["????"] = cx
			
			JY.Person[0]["?¨²??"]=JY.Person[clone_choice]["?¨²??"]
			JY.Person[0]["?¡¦?¨½?¨²??"]=JY.Person[clone_choice]["?¡¦?¨½?¨²??"]
			JY.Person[0]["¡ã??¨ª?¨½"]=JY.Person[clone_choice]["¡ã??¨ª?¨½"]
			JY.Person[0]["?¨²?¨¹???¡è"]=JY.Person[clone_choice]["?¨²?¨¹???¡è"]
			if JY.Person[0]["?¨²?¨¹???¡è"] < 6 then
				JY.Person[0]["?¨²?¨¹???¡è"] = 6
			end
			if JY.Person[0]["?¨²?¨¹???¡è"] > 12 then
				JY.Person[0]["?¨²?¨¹???¡è"] = 12
			end
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			if DrawStrBoxYesNo(-1, -1, "??¡¦¨½?????????¡Â???¨¹????", C_WHITE, CC.DefaultFont) then
				JY.Person[0]["????"] = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
			else
				JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			end
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]

			JY.Person[0]["???¡Â"]=-1
			JY.Person[0]["¡¦???"]=-1
			JY.Person[0]["¡Á???"]=-1
			for i=1,5 do
				JY.Person[0]["????????????" .. i]=JY.Person[clone_choice]["????????????" .. i]
				JY.Person[0]["????????????" .. i]=JY.Person[clone_choice]["????????????" .. i]
				JY.Person[0]["???????¡ì????" .. i]=JY.Person[clone_choice]["???????¡ì????" .. i]
			end
			
			--??????¡¦??¨¢¡Á???55
			JY.Person[0]["???¡Â??"]=limitX(JY.Person[clone_choice]["???¡Â??"]/4,55,75)
			JY.Person[0]["¡¦?????"]=limitX(JY.Person[clone_choice]["¡¦?????"]/4,55,75)
			JY.Person[0]["?¨¢??"]=limitX(JY.Person[clone_choice]["?¨¢??"]/4,55,75)
			--????????????¡Á???30
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],30)
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],30)
			--JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],30)
			JY.Person[0]["¡ã??¡Â????"]=limitX(JY.Person[clone_choice]["¡ã??¡Â????"],30)
			JY.Person[0]["????????"]=JY.Person[clone_choice]["????????"]
			JY.Person[0]["?¡Â??????"]=nil
			JY.Person[0]["?¡Â???¨¢??"]=nil	
			JY.Person[0]["????????"]= 0
			JY.Person[0]["????????"]= 0

			if CC.PersonExit[clone_choice] ~= nil  then
			
			JY.Person[0]["??????¡¦¨¾"]=limitX(JY.Person[clone_choice]["??????¡¦¨¾"],40,70)
			JY.Person[0]["??¡¦¡§????"]=limitX(JY.Person[clone_choice]["??¡¦¡§????"],40,70)
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],40,70)	
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"],40,70)
			JY.Person[0]["???????¡Â"]=limitX(JY.Person[clone_choice]["???????¡Â"],40,70)
			else
			
			JY.Person[0]["??????¡¦¨¾"]=limitX(JY.Person[clone_choice]["??????¡¦¨¾"]/3,40,70)
			JY.Person[0]["??¡¦¡§????"]=limitX(JY.Person[clone_choice]["??¡¦¡§????"]/3,40,70)
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"]/3,40,70)		
			JY.Person[0]["????????"]=limitX(JY.Person[clone_choice]["????????"]/3,40,70)	
			JY.Person[0]["???????¡Â"]=limitX(JY.Person[clone_choice]["???????¡Â"]/3,40,70)	
			end
			
			JY.Person[0]["???¡ì????"]=JY.Person[clone_choice]["???¡ì????"]
			JY.Person[0]["???¡Â????"]=JY.Person[clone_choice]["???¡Â????"]
			JY.Person[0]["¡Á¨®??????"]=JY.Person[clone_choice]["¡Á¨®??????"]
			JY.Person[0]["????"]=JY.Person[clone_choice]["????"]
			-- if JY.Base["????"] == 514 then
					-- JY.Person[0]["??????¡¦¨¾"]= 50 + zm
					-- JY.Person[0]["??¡¦¡§????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["???????¡Â"]= 50 + zm
			-- end
			
			-- if JY.Base["????"] == 515 then
					-- JY.Person[0]["??????¡¦¨¾"]= 50 + zm
					-- JY.Person[0]["??¡¦¡§????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["????????"]= 50 + zm
					-- JY.Person[0]["???????¡Â"]= 50 + zm
			-- end
			if JY.Base["????"] ~= 52 then	--????????
				Cls();	
				--if DrawStrBoxYesNo(-1, -1, "??¡¦¨½¡Á???????", C_WHITE, CC.DefaultFont) == true then

				for i=1,JY.Base["????????"] do
					JY.Person[0]["????" .. i]=JY.Person[clone_choice]["????" .. i]
					JY.Person[0]["????????" .. i]=JY.Person[clone_choice]["????????" .. i]
					if i > 2 then
						JY.Person[0]["????" .. i] = 0
					   JY.Person[0]["????????" .. i] = 0	
					end
				end
				--else
					--[[for i=1,JY.Base["????????"] do
						JY.Person[0]["????" .. i]=JY.Person[clone_choice]["????" .. i]
						JY.Person[0]["????????" .. i]=JY.Person[clone_choice]["????????" .. i]
						if i > 0 then
							JY.Person[0]["????" .. i] = 0
						   JY.Person[0]["????????" .. i] = 0	
						end
					end		
				end]]
			end
			
			--???¡§????
			--[[if JY.Base['???¡§'] == 1 then
				local id = JY.Base['????']
				if MPPD(id) > 0 then
					local mptype, mpdj = MPDISPLAY(id)
					if DrawStrBoxYesNo(-1, -1, "??¡¦¨½¡Á???????????????"..mptype.."??".."???¡Á??"..mpdj, C_WHITE, CC.DefaultFont) == true then
						JoinMP(0,MPPD(id),MPDJ(id))
						MPAttrib(0)
					else
					end
				end
			end]]	
			for i=1,4 do
				JY.Person[0]["???????¡¦" .. i]=JY.Person[clone_choice]["???????¡¦" .. i]
				JY.Person[0]["???????¡¦????" .. i]=JY.Person[clone_choice]["???????¡¦????" .. i]
			end
			
			for i=1,4 do
				JY.Person[0]["?¨§??????"..i]=JY.Person[clone_choice]["?¨§??????"..i]
			end
			
			JY.Person[0]["?¨§??????"]=JY.Person[clone_choice]["?¨§??????"]
			JY.Person[0]["?¨§???¨¢??"]=JY.Person[clone_choice]["?¨§???¨¢??"]
			--JY.Person[0]["????¡¦??¡Á"]=JY.Person[clone_choice]["????¡¦??¡Á"]
			JY.Person[0]["????2"]=JY.Person[clone_choice]["????2"]
			JY.Person[0]["????????"] = JY.Person[clone_choice]["????????"]
				
			--?????????¨¢????????¡ã???????????????????upedit-------------		
			--?¡Â????????????
			JY.Person[92]['????????1'] = 171
			--????????????
			
			--??¡¦?????
			JY.Person[539]["????"] = "??¡¦?"
			JY.Person[539]["????????????2"]= JY.Person[50]["????????????2"]
			JY.Person[539]["????????????2"]= JY.Person[50]["????????????2"]
			JY.Person[539]["???????¡ì????2"]= JY.Person[50]["???????¡ì????2"]
			JY.Person[539]["????????????4"]= 0
			JY.Person[539]["????????????4"]= 0
			JY.Person[539]["???????¡ì????4"]= 0
			--??¡¦???¡ã?????
			if JY.Base["????"] == 27 then
			   --instruct_32(349,-1)
			end		
			
			--??????¡¦????????¨½????
			if JY.Base["????"] == 50 then
				--[[
				local wcywg = JYMsgBox("?????¨½", "?????¨½????????????", {"???¨²??¡ã???","?¨¾?¡¦¡ã?¡¦¡§"}, 2, 50)
				if wcywg == 1 then
					JY.Person[0]["????1"] = 26
					JY.Person[0]["????????1"] = 999
				elseif wcywg == 2 then
					JY.Person[0]["????1"] = 80
					JY.Person[0]["????????1"] = 999
				end
				]]
				JY.Person[0]["????1"] = 26
				JY.Person[0]["????????1"] = 999
				JY.Person[0]["????2"] = 80
				JY.Person[0]["????????2"] = 999
				JY.Person[0]["????3"] = 204
				JY.Person[0]["????????3"] = 999
				ClsN()
			end
			
			--??????????????
			if JY.Base["????"] == 58 then
				JY.Scene[19]["????????"] = 1
				JY.Scene[101]["????????"] = 1
				JY.Scene[36]["????????"] = 1
				JY.Scene[28]["????????"] = 1
				JY.Scene[93]["????????"] = 1
				JY.Scene[105]["????????"] = 1
				null(18, 6)
				null(70, 87)
				addevent(70, 95, 0, 4188, 3, 0)
			end
			--????????
			if JY.Base["????"] == 592 then
				JY.Person[0]["????2"]= 0
				JY.Person[0]["????????2"]= 0
				JY.Person[0]["????????"]=30
				JY.Person[0]["???????¡Â"]=30
				JY.Person[0]["??¡¦¡§????"]=30
				JY.Person[0]["??????¡¦¨¾"]=30
			end
			local menu = {}
			for k,v in pairs(CC.PTFSM) do
				if CC.PTFSM[k][1] ~= nil and CC.PTF[clone_choice][k] == 1 then
					CC.PTF[0][k] = 1
				end	
			end
			Hp_Max(0)	
			--SetJX(626,1)
		end
    end
    GAME_START1()
	GAME_START2()	

	ClsN()
	lib.LoadPicture(CC.BG01File,-1,-1)	
	TGTF1()
    TGTF()
	
	
	
	--TGTF2()
	--TGTF3()

	ClsN()
	ShowScreen()

    if JY.Base["??¡Á?"] == 6 then 
        JY.Person[0]["????????"] = 3
    end
    if JY.Restart ~= 1 then
		local zhidaiwg = {}
		local zhidaiwgdj = {}
		for pid = 0, JY.PersonNum -1 do
			local p = JY.Person[pid]
			for wg = 1, JY.Base['????????'] do
				if JY.Person[pid]['????'..wg] > 0 then
					zhidaiwg[#zhidaiwg+1] = JY.Person[pid]['????'..wg]
					zhidaiwgdj[#zhidaiwgdj+1] = JY.Person[pid]['????????'..wg]
				end
			end
			if zhidaiwg ~= nil and #zhidaiwg > 0 then
				for k = 1, #zhidaiwg do
					for thingid = 0, JY.ThingNum -1 do
						if JY.Thing[thingid]['?¡¦??????'] > 0 and JY.Thing[thingid]['?¡¦??????'] == zhidaiwg[k] then
							local cs = 0
							local wgdj = zhidaiwgdj[k]
							if wgdj >= 900 then
								wgdj = 1000
							end	
							while cs < math.modf(wgdj*0.01) do
								if match_ID(pid, 588)  or match_ID(pid, 9862) or match_ID(pid, 9928) or (MPTX(pid,10)) then		--¡¦??? ??????????
									AddPersonAttrib(pid, "????¡Á??¨®??", JY.Thing[thingid]["??????¡Á??¨®??"])
									AddPersonAttrib(pid, "???¡Â??", JY.Thing[thingid]["?????¡Â??"] * 4)
									AddPersonAttrib(pid, "?¨¢??", JY.Thing[thingid]["???¨¢??"] * 4)
									AddPersonAttrib(pid, "¡¦?????", JY.Thing[thingid]["??¡¦?????"] * 4)
									AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
									AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
									--AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
									AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
								else 
									AddPersonAttrib(pid, "????¡Á??¨®??", JY.Thing[thingid]["??????¡Á??¨®??"])
									AddPersonAttrib(pid, "???¡Â??", JY.Thing[thingid]["?????¡Â??"] * 2)
									AddPersonAttrib(pid, "?¨¢??", JY.Thing[thingid]["???¨¢??"] * 2)
									AddPersonAttrib(pid, "¡¦?????", JY.Thing[thingid]["??¡¦?????"] * 2)
									AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
									AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
									AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
								end
								
								local mp = 1
								local tf = 1
								if match_ID(pid, 56) or match_ID(pid, 77)  or match_ID(pid, 9862) or match_ID(pid, 9863) or match_ID(pid, 9928) then
									tf = 2
								end
								if JY.Thing[thingid]["????????¡¦¨¾"] > 0 then	
									--???¡§??????????
									if MPTX(pid,10) then
										mp = MPDJ(pid) + 1
									end
									--????????????
									if MPTX(pid,17) then
										mp = 3
									end
									--¨¢?¨¢?????????
									if MPTX(pid,18) then
										mp = 3
									end	
									--?¡è¡ã?????????
									if MPTX(pid,2) then
										mp = 2
									end
									--??????????
									if MPTX(pid,3) then  
										mp = 1.5
									end	
									if MPTX(pid,20) or match_ID(pid,514) then
										AddPersonAttrib(pid, "????????", JY.Thing[thingid]["????????¡¦¨¾"])
									end	
									if mp == 1 and tf == 1 then
										AddPersonAttrib(pid, "??????¡¦¨¾", JY.Thing[thingid]["????????¡¦¨¾"])
									else
										if mp >= tf then
											AddPersonAttrib(pid, "??????¡¦¨¾", JY.Thing[thingid]["????????¡¦¨¾"]*mp)
										else
											AddPersonAttrib(pid, "??????¡¦¨¾", JY.Thing[thingid]["????????¡¦¨¾"]*tf)
										end
									end
								end	
								if JY.Thing[thingid]["????¡¦¡§????"] > 0 then
									--???¡§??????????
									if MPTX(pid,10) then
										mp = 3
									end
									--?¨®?¨ª????????
									if MPTX(pid,15) then
										mp = 2.5
									end
									
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "??¡¦¡§????", JY.Thing[thingid]["????¡¦¡§????"])
									else
										
										if mp >= tf then
											AddPersonAttrib(pid, "??¡¦¡§????", JY.Thing[thingid]["????¡¦¡§????"]*mp)
										else
											AddPersonAttrib(pid, "??¡¦¡§????", JY.Thing[thingid]["????¡¦¡§????"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["??????????"] > 0 then
									--???¡§??????????
									if MPTX(pid,10) then
										mp = 3
									end
									--????????????
									if MPTX(pid,17) then
										mp = 3
									end
									--????????????
									if MPTX(pid,16) then
										mp = 1.5
									end
									--????????????
									if MPTX(pid,3) then  
										mp = 2
									end
									if mp == 1 and tf == 1 then
										AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
										
									else
										
										if mp >= tf then
											AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"]*mp)
										else
											AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["??????????"] > 0 then
									--???¡§??????????
									if MPTX(pid,10) then
										mp = 3
									end
									--??¡Á?????????
									if MPTX(pid,6) then
										mp = 1.5
									end	
									--????????????
									if MPTX(pid,20) or match_ID(pid,514) then
										--mp = 1.5
										AddPersonAttrib(pid, "??????¡¦¨¾", JY.Thing[thingid]["??????????"])
									end	
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"])
									else
										
										if mp >= tf then
											AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"]*mp)
										else
											AddPersonAttrib(pid, "????????", JY.Thing[thingid]["??????????"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["?????????¡Â"] > 0 then
									--???¡§??????????
									if MPTX(pid,10) then
										mp = 3
									end
									--????????????
									if MPTX(pid,5) then
										mp = 1.5
									end
									--?¡è¡ã???????
									if MPTX(pid,2) then
										mp = 2
									end		
									--????????????	
									if MPTX(pid,3) then  
										mp = 1.5 
									end
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "???????¡Â", JY.Thing[thingid]["?????????¡Â"])
									else
										if JY.Base['????'] > 2 then
											AddPersonAttrib(pid, "???????¡Â", JY.Thing[thingid]["?????????¡Â"])
										end
										if mp >= tf then
											AddPersonAttrib(pid, "???????¡Â", JY.Thing[thingid]["?????????¡Â"]*mp)
										else
											AddPersonAttrib(pid, "???????¡Â", JY.Thing[thingid]["?????????¡Â"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["??¡ã??¡Â????"] > 0 then
									--???¡§??¡ã??¡Â????
									if MPTX(pid,10) then
										mp = 3
									end
									--????¡ã??¡Â????	
									if MPTX(pid,3) then  
										mp = 1.5 
									end
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "¡ã??¡Â????", JY.Thing[thingid]["??¡ã??¡Â????"])
									else
										if JY.Base['????'] > 2 then
											AddPersonAttrib(pid, "¡ã??¡Â????", JY.Thing[thingid]["??¡ã??¡Â????"])
										end
										if mp >= tf then
											AddPersonAttrib(pid, "¡ã??¡Â????", JY.Thing[thingid]["??¡ã??¡Â????"]*mp)
										else
											AddPersonAttrib(pid, "¡ã??¡Â????", JY.Thing[thingid]["??¡ã??¡Â????"]*tf)
										end
									end
								end
								AddPersonAttrib(pid, "???¡ì????", JY.Thing[thingid]["?????¡ì????"])
								AddPersonAttrib(pid, "?¡¦??", JY.Thing[thingid]["???¡¦??"])
								AddPersonAttrib(pid, "???¡Â????", JY.Thing[thingid]["?????¡Â????"])
								if JY.Thing[thingid]["?????¡Â????"] == 1 then
									if JY.Base["????"] == 152 and JY.Person[pid] == JY.Person[0] then
									else
										p["¡Á¨®??????"] = 1
									end
								end
								--????????????????
								if  p["????????6"] < 1 then
									if thingid >= 187 and thingid <= 193 then
										p["????????6"] = thingid
									end
								end
								--????????¡ã??¡Â????
								if JY.Thing[thingid]["????6"] == 1 and p["????????2"] < 1 then
									p["????????2"] = thingid
									if thingid == 458 then
										AddPersonAttrib(pid, "¡¦?????", 20)
										AddPersonAttrib(pid, "¡ã??¡Â????", 70)
										AddPersonAttrib(pid, "????????", 20)
									end	
									if thingid == 457 then
										AddPersonAttrib(pid, "¡ã??¡Â????", 50)
										AddPersonAttrib(pid, "?¨¢??", 20)
										--AddPersonAttrib(pid, "¡¦?????", JY.Thing[thingid]["??¡¦?????"] * 2)
									end
									if thingid == 469 then
										AddPersonAttrib(pid, "¡ã??¡Â????", 60)
										AddPersonAttrib(pid, "?¨¢??", 10)
										AddPersonAttrib(pid, "????????", 30)
									end
									if thingid == 489 then
										AddPersonAttrib(pid, "¡ã??¡Â????", 60)
										AddPersonAttrib(pid, "???¡Â????", 50)
									end
									if thingid == 469 then
										AddPersonAttrib(pid, "¡ã??¡Â????", 70)
										AddPersonAttrib(pid, "?¨¢??", 20)
									end
									if thingid == 486 then
										AddPersonAttrib(pid, "¡ã??¡Â????", 120)
										AddPersonAttrib(pid, "?¨¢??", 100)
										AddPersonAttrib(pid, "????????", 100)
									end	
								end	
								cs = cs + 1
							end	
						end
					end
				end
				zhidaiwg = {}
				zhidaiwgdj = {}
			end
		end		
		--??????????????
		for p = 0, JY.PersonNum-1 do
			--??¡¦?????????
			if CC.PersonExit[p] == nil and p ~= 0 then
				for i = 1, JY.Base["????????"] do
					if JY.Person[p]["????" .. i] > 0 then
						if p < 191 then
							--JY.Person[p]["????????" .. i] = 999    --BOSS??????????
						else
							--????10????????10??
							if JY.Person[p]["????????" .. i] < 900 then
								JY.Person[p]["????????" .. i] = 900
							end
						end
					else
						break;
					end
				end
			
				--?¨²?¨¹??¡Á?200??????200
				if JY.Person[p]["?¨²?¨¹¡Á??¨®??"] < 200 then
					JY.Person[p]["?¨²?¨¹¡Á??¨®??"] = 200
					JY.Person[p]["?¨²?¨¹"] = JY.Person[p]["?¨²?¨¹¡Á??¨®??"]
				end
				
				--??????¡Á?200??????200
				if JY.Person[p]["????¡Á??¨®??"] < 200 then
					JY.Person[p]["????¡Á??¨®??"] = 200
					JY.Person[p]["????"] = JY.Person[p]["????¡Á??¨®??"]
				end
				
				--????????¡¦??????????????????¨¢??
				local dif_factor;
				--??1????2
				if JY.Base["????"] < 3 then
					dif_factor = 2;
				--??3??
				elseif JY.Base["????"] == 3 then
					dif_factor = 3;
				--??4
				else
					dif_factor = 4;
				end			
				JY.Person[p]["????¡¦???"] = dif_factor
				
				--??¡Á???????¡¦???
				if p == 591 then
					JY.Person[p]["????¡¦???"] = 1
				end
				
				--????????????¡¦??¨ª??1??
				if p == 600 then
					JY.Person[p]["?¨²?¨¹¡Á??¨®??"] = 1
					JY.Person[p]["?¨²?¨¹"] = JY.Person[p]["?¨²?¨¹¡Á??¨®??"]
					JY.Person[p]["????¡¦???"] = 1
				end
				if JY.Person[p]["????¡¦???"]>1 then
		        	JY.Person[p]["?¨²?¨¹¡Á??¨®??"] = JY.Person[p]["?¨²?¨¹¡Á??¨®??"]*JY.Person[p]["????¡¦???"]+JY.Base["????"]*(7-JY.Person[p]["????¡¦??¡Á"])*10
				end
				if JY.Person[p]["????¡¦??¡Á"] == 0 then
					JY.Person[p]["?¨²?¨¹¡Á??¨®??"] = JY.Person[p]["?¨²?¨¹¡Á??¨®??"] + 1000
				end	
	  
				--if p==684 or p==683 or p ==681 then
				if p > 0 then
					JY.Person[p]["????????1"] = 999
					JY.Person[p]["????????2"] = 999
					JY.Person[p]["????????3"] = 999
					JY.Person[p]["????????4"] = 999
					JY.Person[p]["????????5"] = 999
					JY.Person[p]["????"] = 30
				end
				
				--???¨²??¡Á¡ã??
				--local nn=0
				if JY.Person[p]["????¡¦??¡Á"] <3 then
					local n = 548+3*math.random(0,129)			
					NPC_CZB(p,n)
					-- if JY.Person[p]["?¡Â???¨¢??"] == 0 then
						-- --JY.Person[p]["?¡Â???¨¢??"] = 223
					-- end
					
					-- if JY.Person[p]["????¡¦??¡Á"] == 2 then
						-- nn=math.random(100,200)
					-- elseif JY.Person[p]["????¡¦??¡Á"] == 1 then
						-- nn=math.random(200,400)
					-- elseif JY.Person[p]["????¡¦??¡Á"] == 0 then
						-- nn=math.random(300,500)
					-- end
				end
				if p > 0 and JY.Person[p]["????¡¦??¡Á"] >= 3  then
					if JY.Person[p]["????????"] == nil or JY.Person[p]["????????"] < 1 then
					 JY.Person[p]["????????"] = JY.Person[p]["????1"]
					end 
				end
				local nd = JY.Base["????"]
		    	local zm = limitX(JY.Base["????"],1,100)
		   	 	local xs = 0
		   	 	local wc = 0
	 	   		local sw = 0
				
				--npc??????????¡Á??¨ª????
				if nd > 1 and  p ~= 591 then 
					xs = math.modf(zm*2)
					sw = math.modf(zm*2)
					--wc = math.modf(zm*2)
				end
				--???¨¹????npc??????????¡Á??¨ª????
				if nd > 3 and p ~= 591 then
					local zj = math.modf(zm*1.5)
					xs = xs + zj
					sw = sw + zj 
					--wc = wc + zj
				end
				
				--????????
				local fj = limitX(6-JY.Person[p]["????¡¦??¡Á"],1,6)
				local sz = sw * fj * 0.5
				local tt = 5

	            local fx = math.random(4)
				while sz > 0 do
					--[[local n = math.random(3)           
	                if fx == 1 and n == 1 then 
	                    tt = tt * 2
	                end
	                if fx == 2 and n == 2 then 
	                    tt = tt * 2
	                end  
	                if fx == 3 and n == 3 then 
	                    tt = tt * 2
	                end
					if sz < tt then 
						tt = sz
					end
					if n == 1 then 
						JY.Person[p]["???¡Â??"] = JY.Person[p]["???¡Â??"] + tt
					elseif n == 2 then 
						JY.Person[p]["¡¦?????"] = JY.Person[p]["¡¦?????"] + tt
					else
						JY.Person[p]["?¨¢??"] = JY.Person[p]["?¨¢??"] + tt
					end]]
					tt = tt * 1.5
					sz = sz - tt				
				end
				tt = math.modf(tt)
				---say('????????'..tt,0,1)
				JY.Person[p]["???¡Â??"] = JY.Person[p]["???¡Â??"] + tt 
				JY.Person[p]["¡¦?????"] = JY.Person[p]["¡¦?????"] + tt 
				JY.Person[p]["?¨¢??"] = JY.Person[p]["?¨¢??"] + tt 
				
				JY.Person[p]["??????¡¦¨¾"] = JY.Person[p]["??????¡¦¨¾"] + xs
				JY.Person[p]["??¡¦¡§????"] = JY.Person[p]["??¡¦¡§????"] + xs
				JY.Person[p]["????????"] = JY.Person[p]["????????"] + xs
				JY.Person[p]["????????"] = JY.Person[p]["????????"] + xs
				JY.Person[p]["???????¡Â"] = JY.Person[p]["???????¡Â"] + xs
				
				JY.Person[p]['????'] = JY.Person[p]['????'] + math.modf((zm/10)*(JY.Person[p]["????¡¦??¡Á"])+1)			
				AddPersonAttrib(p,'?¨²?¨¹',math.huge)
	        else 
	            JY.Person[p]["????¡¦??¡Á"] = 7
	            JY.Person[p]["???¡Â??"] = 40
	            JY.Person[p]["¡¦?????"] = 40
	            JY.Person[p]["?¨¢??"] = 40
	            JY.Person[p]["????"] = 1
			end
		end		
	end		
	--???????????????????????????¡§
	JY.Wugong[169]['????????'] = 8
	JY.Wugong[378]['????????'] = 8
	for j = 1, JY.WugongNum - 1 do
		if JY.Wugong[j]['????????'] < 6 then
			JY.Wugong[j]["???¡Â??10"] = math.modf(JY.Wugong[j]["???¡Â??10"]*0.5)
		end	
	end	 
	--???????¡¦?¡Â??
	JY.Thing[470]["???¡¦???¡Â"] = "???¡§?????????¨®??¡¦¡§"
	
	JY.Thing[249]["???¡¦???¡Â"] = "?¨®?¨ª??¡¦¡§???¨®?¡Â??????????????"
	
	
	--?????¨®????????
	instruct_3(80, 17, 1, 0, 4105, 0, 0, 4133*2, 4133*2, 4133*2, 0, -2, -2)
	
	--??????????
	instruct_3(16, 10, -2,-2,-2,-2,-2,4153*2,4153*2,4153*2,-2,-2,-2)
	
	--??????????
	instruct_3(62,4,0,0,0,0,0,9238,9238,9238,0,0,0); 
	--??????????????
	addevent(80, 19, 1, 4141, 1, 4335*2)	--?¨¾
	
	instruct_3(-2, -2,0,0,0,0,0,0,0,0,0,0,0)  --???????¡ã????
	instruct_3(70, 45,1,0,847,848,0,7022,7022,7022,-2,-2,-2)  --???????¡ã????
	
end

--???????????¨²?????¡§????
function JLSD(s1, s2, dw)
	local s = math.random(100)
	local chance_up = 0;
	--?????¨¾??¡ã?¡¦??¨¢??????????+6
	--[[
	if dw == 0 and JY.Person[606]["????????"] == 1 then
		chance_up = 3
	end]]
	--???????????¨¦????????+20
	--if inteam(dw) == false then
	--	chance_up = 10
	--end
    if JY.Base["??¡Á?"] == 7 and dw == 0 and  WAR.SEYB == 0 then
       	chance_up = chance_up + 8 + math.modf((psx(dw,'?¡¦??'))*0.067)
	end	
	if JY.Base["??¡Á?"] == 11 and dw == 0 then
       	chance_up = chance_up + 5 + math.modf((120-psx(dw,'?¡¦??'))*0.067)
	end	
	--¡¦??????????¡ì
	if match_ID(dw,588) then
        chance_up =	chance_up + 10
    end 
	--?¨¾?????¡è
    if match_ID(dw,9735) then
        chance_up =	chance_up + 10
    end
	--¡ã???????
	if match_ID(dw,762) then
		chance_up = chance_up + 25
	end 	
	--??¡ã??? 
	if match_ID(dw,189) then
		chance_up =	chance_up + 15
    end
	--?¡§?¡ì??
	if MPTX(dw,21,2) then
		chance_up =	chance_up + 5
	end
	
	if JY.Status == GAME_WMAP then
		if WAR.PD['?¨½??????'][dw] ~= nil or WAR.PD['???¨¢????'][dw] ~= nil then
			return false
		end
		if JY.Person[dw]["???¡ì????"] > 100 then
			local wc = JY.Person[dw]["???¡ì????"] / 100
			if wc > 10 then
				wc = 10
			end
			chance_up = chance_up + wc
		end 
		if WAR.PD['????'][dw] ~= nil and WAR.PD['????'][dw] == 1 then
			local zm = JY.Base["????"]/5
			chance_up = chance_up + zm
		end 
		if WAR.PD['??????¡¦?'][dw] ~= nil and WAR.PD['??????¡¦?'][dw] == 10 and match_ID(dw,592) then
			return true
		end
		if WAR.PD["¡Á???¡Á???"][dw] == 1 and match_ID(dw,60) then
			chance_up = chance_up + 30
		end
		if QGQH(dw,280,1) then
			chance_up = chance_up + math.modf((WAR.SPIRIT[dw] or 0)*0.1)
		end
		if Curr_NG(dw,102) then
           chance_up =	 chance_up + 5
	    end
		if NGQH(dw,102) then
			chance_up = chance_up + 8
		end	
		if MPTX(dw,8,3) and Curr_NG(dw,104) then
			local zd = JY.Person[dw]["????????"] or 0
			local ns = JY.Person[dw]["????????"] or 0
			local zs = JY.Person[dw]["¡Á???????"] or 0
			local bf = JY.Person[dw]["??¡¦?????"] or 0
			local lx = JY.Person[dw]["?¡Â??????"] or 0
			local fx = JY.Person[dw]["¡¦??¡§????"] or 0
			local sh = math.modf((zd + ns + bf + lx + fx) / 50)
			chance_up = chance_up + sh
		end
		if WAR.PD['??????¡¦?'][dw] ~= nil then
			local jd = WAR.PD['??????¡¦?'][dw] or 0
			chance_up = chance_up + jd
		end
		if NGQH(dw,108) and JY.Person[dw]['?¡¦??'] >= 100 then
			chance_up = chance_up + 5
		end
		if NGQH(dw,203) and psx(dw,'?¨²?¨¹') > math.modf((psx(dw,'?¨²?¨¹¡Á??¨®??'))*0.7) then
			chance_up = chance_up + 10
		end
		if WAR.PD['?¡Á??????2'][dw] == 5 then
			chance_up = chance_up + 20
		end	
		if WAR.PD['????????'][dw] ~= nil and WAR.PD['????????'][dw] > 0 then
			for j = 0, WAR.PersonNum - 1 do
		        local zid = WAR.Person[j]["????????"]
		        if WAR.Person[j]["????"] == false then
					if WAR.Person[j]["??¡¦?"] == WAR.Person[WAR.CurID]["??¡¦?"] then
						chance_up = chance_up + 99
					else
					    chance_up = chance_up - 29
					end
		        end
	        end
		end 
		if MPTX(dw,23,4) and Curr_NG(dw,199) then --???????¨¹????
			for j = 0, WAR.PersonNum - 1 do
		        local zid = WAR.Person[j]["????????"]
				local sz  = math.modf(JY.Person[dw]["????"]/100)
		        if WAR.Person[j]["????"] == false then
					if WAR.Person[j]["??¡¦?"] == WAR.Person[WAR.CurID]["??¡¦?"] then
						chance_up = chance_up + sz
					else
					    chance_up = chance_up - sz
					end
			        
		        end
	        end
		end
		if WAR.PD['??¡ã¨²'][dw] ~= nil then
			chance_up = chance_up - 5
		end
		if WAR.PD['?¨²??????'][dw] ~= nil then
			chance_up = chance_up - 10
		end
		if WAR.PD['????????'][dw] ~= nil and psx(dw,'?¨²?¨¹') <= math.modf((psx(dw,'?¨²?¨¹¡Á??¨®??'))*0.5) then
			chance_up = chance_up - 10
		end
		if WAR.PD['????????'][dw] ~= nil and psx(dw,'?¨²?¨¹') >= math.modf((psx(dw,'?¨²?¨¹¡Á??¨®??'))*0.5) then
			chance_up = chance_up - 10
		end
		if WAR.PD['?¡Á??????'][dw] == 3 or WAR.PD['?¡Á??????'][dw] == 5 then
			chance_up = chance_up - 10
		end
		if WAR.PD['?¨¹????'][dw] ~= nil then
			chance_up = 0
			s2 = math.modf(s2*0.5)
			s1 = math.modf(s1*1.5)
		end
		if WAR.PD['?¨¦?¡ã????'][dw] ~= nil then
			chance_up = limitX(math.modf(chance_up*0.5),0,10)
		end	
	end
	s2 = s2 + chance_up
	if s1 < 0 then s1 = 0 end
	if s2 < 0 then s2 = 0 end
	--???¡§??¡¦¨½????
	if s1 < s and s <= s2 then
		return true
	else
		return false
	end
end

--???¡¦?¡Â???¡¦
function Game_Cycle()
    lib.Debug("Start game cycle");

    while JY.Status ~=GAME_END and JY.Status ~=GAME_START do
		if JY.Restart == 1 then
			break
		end
        local t1=lib.GetTime();

	    JY.Mytick=JY.Mytick+1;    --20?????????¡Â?¨¹???¨¾?¡Â??????????¡Á???
		if JY.Mytick%20==0 then
            JY.MyCurrentPic=0;
		end

        if JY.Mytick%1000==0 then
            JY.MYtick=0;
        end

        if JY.Status==GAME_FIRSTMMAP then  --?¡Á???????¡Â???¡ã???????¡Â???¡Â???¡ã???????????????????¨®¡Á???????????
			CleanMemory()
			lib.ShowSlow(20, 1)
			JY.MmapMusic = 57
			JY.Status = GAME_MMAP
			Init_MMap()
			lib.DrawMMap(JY.Base["??X"], JY.Base["??Y"], GetMyPic())
			lib.ShowSlow(20, 0)
        elseif JY.Status==GAME_MMAP then
            Game_MMap();
 		elseif JY.Status==GAME_SMAP then
            Game_SMap();
		end
		collectgarbage("step", 0)
        local t2=lib.GetTime();
	    if t2-t1<CC.Frame then
            lib.Delay(CC.Frame-(t2-t1));
	    end
	end
end

function Game_MMap()      --?¡Â????
	if JY.Restart == 1 then
		return
	end

    local direct = -1;
    local keypress, ktype, mx, my = lib.GetKey();
	--???¨§???¨²??????????¡¦??¨¾??¡¦¨½??¡ã???
    for i = VK_RIGHT,VK_UP do
        if i ~= CC.PrevKeypress and lib.GetKeyState(i) ~=0 then
			keypress = i
		end
	end 
    --????????????????¡¦??¨¾????¡ã??????¨¾?¨§??????????????¡¦??¨¾??¡¦¨½??¡ã???
	if keypress==-1 and	lib.GetKeyState(CC.PrevKeypress) ~=0 then
		keypress = CC.PrevKeypress
	end
    CC.PrevKeypress = keypress
    if keypress==VK_UP then
		direct=0;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_DOWN then
		direct=3;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_LEFT then
		direct=2;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_RIGHT then
		direct=1;
		JY.WalkCount = JY.WalkCount + 1
	else
		JY.WalkCount = 0
	end
    
	if keypress == VK_UP or keypress == VK_DOWN or keypress == VK_LEFT or keypress == VK_RIGHT then
		OEVENTLUA[30050]()
	end
	
	
    if ktype == 1 then
	    JY.Mytick=0;
		if keypress==VK_ESCAPE then
			Cls()
			--??????
			tjm_menu()
			if JY.Status ~= GAME_MMAP  then
				return ;
			end
		elseif keypress == VK_H then		--¡ã?h????????
			My_Enter_SubScene(70, 35, 31, 2);
			return;
		--?????????????¡Á?¨§???¨¹ 7-30
		elseif keypress == VK_S then	--????
			--Menu_SaveRecord()
			Cls()
			My_ChuangSong_Ex()
			if JY.Status ~= GAME_MMAP  then
				return ;
			end
		elseif keypress == VK_L then	--????
			Menu_ReadRecord()
			if JY.Status ~= GAME_MMAP  then
				return ;
			end
		elseif keypress == VK_Z then	--¡Á???
			Cls()
			local a = Team()
			
			if a ~= nil and a > 0 then
				PersonStatus(a)
			else
				do return end
			end	 
		
		elseif keypress == VK_Q then	--???? ???????¡§
			Cls()
			QUANZHANGQX1()
		elseif keypress == VK_W then	--???? ???¡ì????
			Cls()
			MJMenu()		
		elseif keypress == VK_E then	--???¡¦
			Cls()
			Menu_Thing()
		elseif keypress == VK_R then	--???? ???????¡¦
			Cls()
			ThingMenu()	
		elseif keypress == VK_F1 then	--?¨ª??	
			Cls()
			My_ChuangSong_Ex()
			if JY.Status ~= GAME_MMAP then
				return;
			end
		--elseif keypress == VK_F2 then	--????				
		--    CallCEvent(690)				
		elseif keypress == VK_F2 then	--?????¨¾???????¨§???¨¹				
		    CallCEvent(690)				
		elseif keypress == VK_F3 then	--????????
			Cls()
			Menu_TZDY()
		elseif keypress == VK_F4 then	--???¨ª
			Cls()		
			Menu_WPZL()
		end
	elseif ktype == 2 or ktype == 3 then
		local tmpx,tmpy = mx, my
		mx = mx - CC.ScreenW / 2
		my = my - CC.ScreenH / 2
		mx = (mx) / CC.XScale
		my = (my) / CC.YScale
		mx, my = (mx + my) / 2, (my - mx) / 2
		if mx > 0 then
			mx = mx + 0.99
		else
			mx = mx - 0.01
		end
		if my > 0 then
			my = my + 0.99
		else
			mx = mx - 0.01
		end
		mx = math.modf(mx)+JY.Base["??X"];
		my = math.modf(my)+ JY.Base["??Y"]
				
		--?¨®??????
		if ktype == 2 then
			if lib.GetMMap(mx, my, 3) > 0 then				--???????¡§??????????¡¦¨½??????
				for i=0, 4 do
		    		for j=0, 4 do
		    			local xx, yy = mx-i, my-j;
				    	local sid=CanEnterScene(xx,xx);
				    	if sid < 0 then
				    		xx, yy = mx+i, my+j;
				    		sid=CanEnterScene(xx,yy);
				    	end
						if sid>=0 then
							CC.MMapAdress[0] = sid;
							CC.MMapAdress[1] = tmpx;
							CC.MMapAdress[2] = tmpy;
							CC.MMapAdress[3] = xx;
							CC.MMapAdress[4] = yy;
		
							i=5;		--???????¡¦
							break;
						end
					end
				end
			else
				CC.MMapAdress[0]= nil;
			end
		--?¨®??¡Á¨®?¨¹
		elseif ktype == 3 then
			if tmpx >= 0 and tmpx <= CC.ScreenW/1360*63 and 
			   tmpy >= CC.ScreenH/768*110 and tmpy <= CC.ScreenH/768*160 then
			   tjm_menu()
			   --CMenu()
			else   
				if CC.MMapAdress[0] ~= nil then
					mx = CC.MMapAdress[3] - JY.Base["??X"];
					my = CC.MMapAdress[4] - JY.Base["??Y"];
					CC.MMapAdress[0]= nil;
				else
					AutoMoveTab = {[0] = 0}
					mx = mx - JY.Base["??X"]
					my = my - JY.Base["??Y"]
				end
				walkto(mx, my)
			end
		end
	elseif ktype == 4 then
		JY.Mytick=0;
		Cls()
		--MMenu();
		tjm_menu()
		--CMenu() 
		if JY.Status ~= GAME_MMAP then
			return ;
		end
	end
    
    if AutoMoveTab[0] ~= 0 then
	    if direct == -1 then
			direct = AutoMoveTab[AutoMoveTab[0]]
			AutoMoveTab[AutoMoveTab[0]] = nil
			AutoMoveTab[0] = AutoMoveTab[0] - 1
	    end
	else
	    AutoMoveTab = {[0] = 0}
	end


    local x,y;              --¡ã???¡¦??¨¾?¨¹????????¡Á???
	local CanMove = function(nd, nnd)
		local nx, ny = JY.Base["??X"] + CC.DirectX[nd + 1], JY.Base["??Y"] + CC.DirectY[nd + 1]
		if nnd ~= nil then
			nx, ny = nx + CC.DirectX[nnd + 1], ny + CC.DirectY[nnd + 1]
		end
		if CC.hx == nil and ((lib.GetMMap(nx, ny, 3) == 0 and lib.GetMMap(nx, ny, 4) == 0) or CanEnterScene(nx, ny) ~= -1) then
			return true
		else
			return false
		end
	end
    if direct ~= -1 then   --¡ã??????????¨¹
        AddMyCurrentPic();         --?????¡Â?????????????¨²?¨²¡Á??¡¦?¡ì??
        x=JY.Base["??X"]+CC.DirectX[direct+1];
        y=JY.Base["??Y"]+CC.DirectY[direct+1];
        JY.Base["??¡¦??¨¾"]=direct;
		if JY.WalkCount == 1 then
			lib.Delay(90)
		end
    else
        x=JY.Base["??X"];
        y=JY.Base["??Y"];

    end

	if direct~=-1 then
		JY.SubScene=CanEnterScene(x,y);   --??????¡¦¨½????¡Á????¡ã
	end

    if lib.GetMMap(x,y,3)==0 and lib.GetMMap(x,y,4)==0 then     --?????¡§????????????
        JY.Base["??X"]=x;
        JY.Base["??Y"]=y;
    end
    JY.Base["??X"]=limitX(JY.Base["??X"],10,CC.MWidth-10);           --????¡Á???????????¡¦??¡ì
    JY.Base["??Y"]=limitX(JY.Base["??Y"],10,CC.MHeight-10);

    if CC.MMapBoat[lib.GetMMap(JY.Base["??X"],JY.Base["??Y"],0)]==1 then
	    JY.Base["????"]=1;
	else
	    JY.Base["????"]=0;
	end

    lib.DrawMMap(JY.Base["??X"],JY.Base["??Y"],GetMyPic());             --?????¡Â????

	--???¡ãXY¡Á???????
    if CC.ShowXY==1 then
		lib.LoadPNG(91,43*2,CC.ScreenW/1360*136,CC.ScreenH/768*142,2)
	    DrawString(CC.ScreenW/1360*70,CC.ScreenH/768*129,string.format("%s %d %d","",JY.Base["??X"],JY.Base["??Y"]) ,C_GOLD,CC.Fontsmall*0.9);
	end
	DrawTimerA();
	--DrawTimer();		--¡Á???¡¦??????¨¢??
	JYZTB();			--¡Á¨®?????¨¾?¡Á????
		--JYZTB1();	
	lib.PicLoadCache(92,29*2,CC.ScreenW/1360*40,CC.ScreenH/768*615+70,2,256,nil,CC.ScreenW/1360*60)	
	--?????¨®???????????¡ã????
	if CC.MMapAdress[0] ~= nil then
		DrawStrBox(CC.MMapAdress[1]+10,CC.MMapAdress[2],JY.Scene[CC.MMapAdress[0]]["????"],C_GOLD,CC.DefaultFont);
	end
		
    ShowScreen();

    if JY.SubScene >= 0 then          --????¡Á????¡ã
        CleanMemory();
		--lib.UnloadMMap();
        --lib.PicInit();
        lib.ShowSlow(20,1)

		JY.Status=GAME_SMAP;
        JY.MmapMusic=-1;

        JY.MyPic=GetMyPic();
        JY.Base["??X1"]=JY.Scene[JY.SubScene]["????X"]
        JY.Base["??Y1"]=JY.Scene[JY.SubScene]["????Y"]

        Init_SMap(1);
		return
    end
end

--?¡Â??¡Á??¡¦
function walkto(xx,yy,x,y,flag)
	local x,y
	AutoMoveTab={[0]=0}
	if JY.Status==GAME_SMAP  then
		x=x or JY.Base["??X1"]
		y=y or JY.Base["??Y1"]
	elseif JY.Status==GAME_MMAP then
		x=x or JY.Base["??X"]
		y=y or JY.Base["??Y"]
	end
	xx,yy=xx+x,yy+y
	if JY.Status==GAME_SMAP then
		CC.AutoMoveEvent[0] = 0;
		CC.AutoMoveEvent[1] = 0;
		CC.AutoMoveEvent[2] = 0;

		if SceneCanPass(xx, yy) == false then
			if GetS(JY.SubScene, xx, yy, 3) > 0 and GetD(JY.SubScene, GetS(JY.SubScene, xx, yy, 3), 2) > 0 then
				CC.AutoMoveEvent[1] = xx;
				CC.AutoMoveEvent[2] = yy;
				--???????????????¡ã??????????????¡Á?????¡¦?????????????????
				if x < xx then
					if SceneCanPass(xx-1,yy) then
						xx = xx-1;
					elseif SceneCanPass(xx,yy+1) then
						yy = yy+1;
					elseif SceneCanPass(xx,yy-1) then
						yy = yy-1;
					elseif SceneCanPass(xx+1,yy) then
						xx = xx+1;
					else
						return;
					end
				else
					if SceneCanPass(xx+1,yy) then
						xx = xx+1;
					elseif SceneCanPass(xx,yy+1) then
						yy = yy+1;
					elseif SceneCanPass(xx,yy-1) then
						yy = yy-1;
					elseif SceneCanPass(xx-1,yy) then
						xx = xx-1;
					else
						return;
					end
				end
			else
				return;
			end
		end

	end
	if xx == nil or yy == nil then
		return
	end	
	if JY.Status==GAME_MMAP and ((lib.GetMMap(xx,yy,3)==0 and lib.GetMMap(xx,yy,4)==0) or CanEnterScene(xx,yy)~=-1)==false then
		return
	end
	local steparray={};
	local stepmax;
	local xy={}
	if JY.Status==GAME_SMAP then
		for i=0,CC.SWidth-1 do
			xy[i]={}
		end
	elseif JY.Status==GAME_MMAP then
		for i=0,479 do
			xy[i]={}
		end
	end
	if flag~=nil then
		stepmax=640
	else
		stepmax=240
	end
	for i=0,stepmax do
	    steparray[i]={};
        steparray[i].x={};
        steparray[i].y={};
	end
	local function canpass(nx,ny)
		if JY.Status==GAME_SMAP and (nx>CC.SWidth-1 or ny>CC.SWidth-1 or nx<0 or ny<0) then
			return false
		end
		if JY.Status==GAME_MMAP and (nx>479 or ny>479 or nx<1 or ny<1) then
			return false
		end
		if xy[nx][ny]==nil then
			if JY.Status==GAME_SMAP then
				if  SceneCanPass(nx,ny) then
					return true
				end
			elseif JY.Status==GAME_MMAP then
				if (lib.GetMMap(nx,ny,3)==0 and lib.GetMMap(nx,ny,4)==0) or CanEnterScene(nx,ny)~=-1 then
					return true
				end
			end
		end
		return false
	end

	local function FindNextStep(step)
		if step==stepmax then
			return
		end
		local step1=step+1
		local num=0
		for i=1,steparray[step].num do

			if steparray[step].x[i]==xx and steparray[step].y[i]==yy then
				return
			end

			if canpass(steparray[step].x[i]+1,steparray[step].y[i]) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]+1
				steparray[step1].y[num]=steparray[step].y[i]
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
			if canpass(steparray[step].x[i]-1,steparray[step].y[i]) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]-1
				steparray[step1].y[num]=steparray[step].y[i]
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
			if canpass(steparray[step].x[i],steparray[step].y[i]+1) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]
				steparray[step1].y[num]=steparray[step].y[i]+1
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
			if canpass(steparray[step].x[i],steparray[step].y[i]-1) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]
				steparray[step1].y[num]=steparray[step].y[i]-1
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
		end
		if num>0 then
			steparray[step1].num=num
			FindNextStep(step1)
		end
	end

	steparray[0].num=1;
	steparray[0].x[1]=x;
	steparray[0].y[1]=y;
	xy[x][y]=0
	FindNextStep(0);
  
  xx = math.floor(xx + 0.5)
  yy = math.floor(yy + 0.5)

  local movenum=xy[xx][yy];

	if movenum==nil then
		return
	end
	AutoMoveTab[0]=movenum
	for i=movenum,1,-1 do
        if xy[xx-1][yy]==i-1 then
            xx=xx-1;
            AutoMoveTab[1+movenum-i]=1;
        elseif xy[xx+1][yy]==i-1 then
            xx=xx+1;
            AutoMoveTab[1+movenum-i]=2;
        elseif xy[xx][yy-1]==i-1 then
            yy=yy-1;
            AutoMoveTab[1+movenum-i]=3;
        elseif xy[xx][yy+1]==i-1 then
            yy=yy+1;
            AutoMoveTab[1+movenum-i]=0;
        end
	end
end

function GetMyPic()      --?????¡Â?????¡ã????
    local n;
	if JY.Status==GAME_MMAP and JY.Base["????"]==1 then
		if JY.MyCurrentPic >=4 then
			JY.MyCurrentPic=0
		end
	else
		if JY.MyCurrentPic >6 then
			JY.MyCurrentPic=1
		end
	end

	if JY.Base["????"]==0 then
		if JY.Person[0]["????"] == 0 then
			n=CC.MyStartPicM+JY.Base["??¡¦??¨¾"]*7+JY.MyCurrentPic;
		else
			n=CC.MyStartPicF+JY.Base["??¡¦??¨¾"]*7+JY.MyCurrentPic;
		end
	else
	    n=CC.BoatStartPic+JY.Base["??¡¦??¨¾"]*4+JY.MyCurrentPic;
	end
	return n;
end

--???????¡ã?¡Â??¡Á??¡¦??????, ?¡Â?????????¡ã??????????
function AddMyCurrentPic()
    JY.MyCurrentPic=JY.MyCurrentPic+1;
end

--???¡ã??¡¦¨½????
--id ???¡ã?¨²??
--x,y ???¡ã?¡Â????¡Á???
--¡¦????????¡ãid??-1?¨ª?????????¡ã????
function CanEnterScene(x,y)         --???¡ã??¡¦¨½????
    for id = 0,JY.SceneNum-1 do
		local scene=JY.Scene[id];
		if (x==scene["???¡ã????X1"] and y==scene["???¡ã????Y1"]) or
		   (x==scene["???¡ã????X2"] and y==scene["???¡ã????Y2"]) then
			local e=scene["????????"];
			if e==0 then        --????
				return id;
			elseif e==1 then    --??????
				return -1
			end
		end
	end
    return -1;
end

--????¡Á?????
function Menu_System()
	local menu = {
	{"????????", Menu_ReadRecord, 1}, 
	{"????????", Menu_SaveRecord, 1}, 
	{"????????", Menu_SetMusic, 1}, 
	{"???????¡ì", Menu_SetSound, 1}, 
	{"???¡¦???¨ª", Menu_WPZL, 1}, 
	--{"????????", Menu_Help, 1},
	{"?¡§??????", pastReview, 1},
	{"?????¨²??", Menu_MYDIY, 1},
	{"???????¡¦", Menu_Exit2, 1}
	}
	if JY.EnableMusic == 0 then
		menu[3][1] = "?¨¾??????"
	end
	if JY.EnableSound == 0 then
		menu[4][1] = "?¨¾?????¡ì"
	end
	local r = ShowMenu(menu, #menu, 0, CC.MainSubMenuX, CC.MainSubMenuY, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
	if r == 0 then
		return 0
	elseif r < 0 then
		return 1
	end
end

function Menu_MYDIY()
	local r = JYMsgBox("?????¨²??","????¡Á??¡§???¨²??*???¡§??script/DIY.lua????",{"?¡¦?¡§","????"},2,nil,1);
	--local r = JYMsgBox("?????¨²??","?????¨¾???????¡¦???????????¨²??");
	if r == 1 then
		--TalkEx("???¨¦??????????198045761", 592, 1)  --???¡ã
		dofile(CONFIG.ScriptPath.."DIY.lua");
	else
		do return end
	end
end

function Menu_Help()
	--????????
	
	local title = "????????";
	local str ="¡Á¡ã?????¡Â???¨¦???¡Â??¡Á¡ã???????¡Â??"
						.."*???????¡Â???¨¦???¡Â???????????¡Â??"
						.."*?¨§?¨¦???????¡Â???¨§?¨¦????¡¦¡§?????¡ã???¡¦????????"
	local btn = {"¡Á¡ã?????¡Â","???????¡Â","?¨§?¨¦????"};
	local num = #btn;
	local r = JYMsgBox(title,str,btn,num,nil,1);

	if r == 1 then
		ZBInstruce();
	elseif r == 2 then
		WuGongIntruce();
	elseif r == 3 then
		TSInstruce();
	end
	return 1;
end

--????????
function Menu_SetMusic()
	if JY.EnableMusic == 0 then
		JY.EnableMusic = 1
		PlayMIDI(JY.CurrentMIDI)
	else
		JY.EnableMusic = 0
		lib.PlayMIDI("")
	end
	return 1
end

--???¡ì????
function Menu_SetSound()
	if JY.EnableSound == 0 then
		JY.EnableSound = 1
	else
		JY.EnableSound = 0
	end
	return 1
end

function Menu_Thing()
	local menu3 = {nil,0,1,3,4,2}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	
	while true do
		Cls()
		if JY.Restart == 1 then
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu3 do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 7 then
				
				if tb == i then 
					lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			if tb < 6 then
				ThingMenu(menu3[tb])
			else
				MJMenu()
			end
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu3
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu3 then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu3 do 
				if mx >= CC.ScreenW/2-((#menu3-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu3-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				if tb < 6 then
					ThingMenu(menu3[tb])
				else
					MJMenu()
				end
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
			end
		end
	end
end	




function New_Team()
	--local menu3 = {nil,0,1,3,4,2}
	local menu = {'¡Á???','???¨¾','????'}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	
	while true do
		Cls()
		if JY.Restart == 1 then
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 4 then
				
				if tb == i then 
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			-- if tb < 6 then
				-- ThingMenu(menu3[tb])
			-- else
				-- MJMenu()
			-- end
			
			if tb < 4 then
				Team({menu[tb]})
			--	say("????"..menu[tb],0,1)
			end
			
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu do 
				if mx >= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				-- if tb < 6 then
					-- ThingMenu(menu3[tb])
				-- else
					-- MJMenu()
				-- end
				if tb < 4 then
					Team({menu[tb]})
				--	say("????"..menu[tb],0,1)
				end
				
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
			end
		end
	end
end


function New_Team1()
	--local menu3 = {nil,0,1,3,4,2}
	local menu = {'¡Á???','???¨¾','????'}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	pd = 1
	while true do
		Cls()
		if JY.Restart == 1 then
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 4 then
				
				if tb == i then 
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			-- if tb < 6 then
				-- ThingMenu(menu3[tb])
			-- else
				-- MJMenu()
			-- end
			
			if tb < 4 then
				Team({menu[tb]})
			--	say("????"..menu[tb],0,1)
			end
			
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu do 
				if mx >= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				-- if tb < 6 then
					-- ThingMenu(menu3[tb])
				-- else
					-- MJMenu()
				-- end
				if tb < 4 then
					Team({menu[tb]})
				--	say("????"..menu[tb],0,1)
				end
				
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
			end
		end
	end
end


function New_Ssystem()
	--local menu3 = {nil,0,1,3,4,2}
	local menu = {1,2,3,4,5,6,7,8}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	
	while true do
		Cls()
		if JY.Restart == 1 then
			Cls()
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 9 then
				
				if tb == i then 
					lib.PicLoadCache(92,(29+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(29+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			-- if tb < 6 then
				-- ThingMenu(menu3[tb])
			-- else
				-- MJMenu()
			-- end
			local leave = 0
			local ReadRecord = 0
			if tb < 9 then
				--Team({menu[tb]})
			--	say("????"..menu[tb],0,1)
				if tb == 1 then
					ReadRecord = Menu_ReadRecord()
				elseif tb == 2 then
					Menu_SaveRecord()
				elseif tb == 3 then
					Menu_SetMusic()
				elseif tb == 4 then
					Menu_SetSound()
				elseif tb == 5 then
					Menu_WPZL()
				elseif tb == 6 then
					pastReview()
				elseif tb == 7 then
					Menu_MYDIY()
				elseif tb == 8 then
					leave = Menu_Exit2()
				end
			--Menu_ReadRecord,Menu_SaveRecord,Menu_SetMusic,Menu_SetSound,Menu_WPZL,pastReview,Menu_MYDIY,Menu_Exit2
			end
			
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
			if tb == 1 and ReadRecord == 1 then
				return 1
			end	
			if tb == 8 and leave == 1 then
				return 1
			end	
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu do 
				if mx >= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				local leave = 0
				local ReadRecord = 0
				-- if tb < 6 then
					-- ThingMenu(menu3[tb])
				-- else
					-- MJMenu()
				-- end
				if tb < 9 then
				--Team({menu[tb]})
			--	say("????"..menu[tb],0,1)
				if tb == 1 then
					ReadRecord = Menu_ReadRecord()
				elseif tb == 2 then
					Menu_SaveRecord()
				elseif tb == 3 then
					Menu_SetMusic()
				elseif tb == 4 then
					Menu_SetSound()
				elseif tb == 5 then
					Menu_WPZL()
				elseif tb == 6 then
					pastReview()
				elseif tb == 7 then
					Menu_MYDIY()
				elseif tb == 8 then
					leave = Menu_Exit2()
				end
			--Menu_ReadRecord,Menu_SaveRecord,Menu_SetMusic,Menu_SetSound,Menu_WPZL,pastReview,Menu_MYDIY,Menu_Exit2
			end
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
				if tb == 1 and ReadRecord == 1 then
					return 1
				end	
				if tb == 8 and leave == 1 then
					return 1
				end
			end
		end
	end
end







function Menu_Thing1()
   local bx = CC.ScreenW/1360
   local by = CC.ScreenH/768
   local size = CC.DefaultFont*0.7
   local size1 = CC.DefaultFont*0.6
   local size2 = CC.DefaultFont*0.55
   local cont = 1 
   local cont1 = 0
   local cxt = 1
   local page = 1
   local lx = {{'????',0},{'¡Á¡ã??',1},{'????',2},{'???¡¦',3},{'¡ã??¡Â',4}}
   if JY.Status == GAME_WMAP then 
	  table.remove(lx,1)
	  table.remove(lx,2)
   end
   while true do 
      Cls()
	  lib.PicLoadCache(92,130*2,0,0,1,nil,nil,bx*1360)
	  lib.PicLoadCache(92,136*2,bx*250+(cxt-1)*bx*100,by*30,2,256,nil,bx*42)
	  DrawString(bx*50,by*30-size*1.2/2,lx[cxt][1],C_ORANGE,size*1.2)
	  DrawString(bx*780,by*30-size*1.2/2,'???¡Â',C_ORANGE,size*1.2)
	  DrawString(bx*50,by*768-size/2,string.format('%11s',C_GOLD),C_WHITE,size)
      for ii = 1,#lx do
	      lib.PicLoadCache(92,(lx[ii][2]+131)*2,bx*250+(ii-1)*bx*100,by*30,2,256,nil,bx*42)
	  end
	  
      local thing = {}
      local maxn = 14
      for ii = 1,CC.MyThingNum do 
	      local tid = JY.Base['???¡¦'..ii]
		  local tidnum = JY.Base['???¡¦????'..ii]
	      if tid >= 0 and tidnum > 0 and JY.Thing[tid]['????'] == lx[cxt][2] then 
		     thing[#thing+1] = {JY.Thing[tid]['????'],tid,tidnum} --,JY.Thing[tid]['???¨½']
		  end
	  end
	  
	  if maxn > #thing then 
	     maxn = #thing
	  end 
	  if #thing > 0 then
	     for ii = 1,maxn do
	         local tid = thing[ii+cont1]
			 local cl = C_WHITE
			 if page == 2 then
				if ii == cont then 
				   DrawString(bx*1360-string.len(thing[ii+cont1][1])/4*size-150,by*72-size/2-5,thing[ii+cont1][1],C_WHITE,size)
		          -- lib.PicLoadCache(2,thing[ii+cont1][2]*2,bx*760,by*200,2,256,nil,bx*120)
				   lib.PicLoadCache(2,thing[ii+cont1][2]*2,bx*760,by*200,1)
				   --lib.PicLoadCache(2, thing[id] * 2, boxx + 1, boxy + 1, 1)
				   --cl = C_RED
				   lib.PicLoadCache(92,137*2,bx*480,by*101+(ii-1)*by*40+size/2-20,2,256,nil,bx*600)
				   -- if CC.Thing[thing[ii+cont1][2]] ~= nil then
				      -- tjm(bx*1360,by*345,CC.ThingSm[thing[ii+cont1][2]],C_WHITE,size1,math.floor(bx*400/size1)-1)
				   -- end  
				end
			 end
			 DrawString(bx*48,by*100+(ii-1)*by*40-20,thing[ii+cont1][1],cl,size)
			-- DrawString(bx*588,by*98+(ii-1)*by*40,thing[ii+cont1][4],cl,size)
			 DrawString(bx*580,by*98+(ii-1)*by*40-20,thing[ii+cont1][3],cl,size)
	     end
		 -- local thing = {}
		-- local thingnum = {}
		-- for i = 0, CC.MyThingNum - 1 do
			-- thing[i] = -1
			-- thingnum[i] = 0
		-- end
		-- local num = 0
		-- for i = 0, CC.MyThingNum - 1 do
			-- local id = JY.Base["???¡¦" .. i + 1]
			-- if id >= 0 then
				-- if flag == nil then 
					-- thing[num] = id
					-- thingnum[num] = JY.Base["???¡¦????" .. i + 1]
					-- num = num + 1
				-- else 	
					-- if JY.Thing[id]["????"] == flag then
						-- thing[num] = id
						-- thingnum[num] = JY.Base["???¡¦????" .. i + 1]
						-- num = num + 1
					-- end
				-- end
			-- end 
		-- end
		 
		 
		 
		 
	  end	 
	  
	  if page == 1 then 
	  
	  end
	  
	  ShowScreen()
	  lib.Delay(20)
	  local X,ktype,mx,my = lib.GetKey()
	  if X == VK_SPACE or X == VK_RETURN then 
         if page == 1 then 
		    if #thing > 0 then 
			   page = 2
			end
		 elseif page == 2 then
		    if #thing > 0 then 
		       UseThing(thing[cont+cont1][2])
			   if JY.Status == GAME_WMAP then
			      return 1
			   end
			end
		 end
	  elseif X == VK_ESCAPE or ktype == 4 then
	     if page > 1 then 
		    page = page - 1 
			cont = 1
			cont1 = 0
		 else 	
            break
		 end	
	  elseif X == VK_UP then
	     if page == 1 then 
		 
		 else
            if cont1 > 0 then 
               if cont > 1 then 
                  cont = cont - 1
               else 
                  cont1 = cont1 - 1	  
               end	
            else
               cont = cont - 1		
               if cont < 1 then 
		          cont = maxn
                  cont1 = #thing - cont
               end
            end
		 end	
	  elseif X == VK_DOWN then
	     if page == 1 then 
		 
		 else
            cont = cont + 1		
            if cont > maxn then 
               cont = maxn
               cont1 = cont1 + 1
            end
            if cont1 + cont > #thing then 
               cont1 = 0
               cont = 1
            end
		 end	
	  elseif X == VK_LEFT or ktype == 6 then
	     if page == 1 then 
		    cxt = cxt - 1 
			if cxt < 1 then 
			   cxt = #lx
			end
		 else 
            cont1 = cont1 - maxn
            cont = 1
            if cont1 < 0 then 
               cont1 = 0 
            end
		 end	
	  elseif X == VK_RIGHT or ktype == 7 then
	     if page == 1 then 
		    cxt = cxt + 1 
			if cxt > #lx then 
			   cxt = 1
			end
		 else
            cont1 = cont1 + maxn
            cont = maxn
            if cont1 + cont > #thing then
               cont1 = #thing-cont
            end	
		 end	
	  else 
         local mxx = false
         for ii = 1,maxn do 

		
         end		
         if ktype == 3 and mxx == true then 

         end	
	  end
   end
end	



--???¡¦???¨ª
function Menu_WPZL()
	local function swap(a, b) 
		JY.Base["???¡¦" .. a], JY.Base["???¡¦" .. b] = JY.Base["???¡¦" .. b], JY.Base["???¡¦" .. a]
		JY.Base["???¡¦????" .. a], JY.Base["???¡¦????" .. b] = JY.Base["???¡¦????" .. b], JY.Base["???¡¦????" .. a]
	end
	
	local flag = 0;
	for i=1, CC.MyThingNum do
        flag = 0;
        for j=1, CC.MyThingNum-i+1 do
             if JY.Base["???¡¦"..j] > -1 and JY.Base["???¡¦" .. j+1] > -1 then				--???????????¡¦???¡ì
				local wg1 = JY.Thing[JY.Base["???¡¦"..j]]["?¡¦??????"];
				local wg2 = JY.Thing[JY.Base["???¡¦"..j+1]]["?¡¦??????"];                           
				if wg2 < 0 then								--?????¡¦???????????????????¨¾
					if wg1 > 0 or  (wg1 < 0 and JY.Base["???¡¦"..j] > JY.Base["???¡¦"..j+1])  then                
						swap(j, j+1);
						flag = 1;
					end   
                elseif wg1 > 0 then							--???¡¦???????????????????¨¾??????????????????????????10?????????¨¾                         
					if JY.Wugong[wg1]["????????"] > JY.Wugong[wg2]["????????"] or (JY.Wugong[wg1]["????????"] == JY.Wugong[wg2]["????????"] 
					and JY.Wugong[wg1]["???¡Â??10"] > JY.Wugong[wg2]["???¡Â??10"]) then
						swap(j, j+1);
						flag = 1;
					end
				end
			end
		end
		if flag == 0 then									--???????????????????????????????¡§?????????????¨¾????????????
			break;
		end
	end
	Cls()
	DrawStrBoxWaitKey("???????¨ª????", C_WHITE, CC.DefaultFont)
end

--?¨®?????????¡¦????
function MenuDSJ()
	local menu = {
	{"???????¡¦", nil, 0}, 
	{"???¨¦???¡¦", nil, 0}, 
	{"?¨½?????¡Á", nil, 1}, 
	{"??????¨®?", nil, 1}, 
	{"?¨¦?¡è????", nil, 1}, 
	{"????¡ã??¡Â", nil, 1}}
	local r = ShowMenu(menu, 6, 0, CC.ScreenW/2-CC.DefaultFont*2-10, CC.ScreenH/2-CC.DefaultFont*3, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
	if r > 0 then
		local thing = {}
		local thingnum = {}
		for i = 0, CC.MyThingNum - 1 do
			thing[i] = -1
			thingnum[i] = 0
		end
		local num = 0
		for i = 0, CC.MyThingNum - 1 do
			local id = JY.Base["???¡¦" .. i + 1]
			if id >= 0 then
				if r == 1 then
					thing[i] = id
					thingnum[i] = JY.Base["???¡¦????" .. i + 1]  
				else
					if JY.Thing[id]["????"] == r - 2 then
						thing[num] = id
						thingnum[num] = JY.Base["???¡¦????" .. i + 1]
						num = num + 1
					end
				end
			end
		end
		--????????????¨®???????¡¦?
		if r == 4 then
			IsViewingKungfuScrolls = 1
		end
		local r = SelectThing(thing, thingnum)
		if r >= 0 then
			return r
		end
	end
	return -1
end

--?¨²?????????¡¦????
function MenuTJQH()
	local thing = {}
	local thingnum = {}
	for i = 0, CC.MyThingNum - 1 do
		thing[i] = -1
		thingnum[i] = 0
	end
	local num = 0
	for i = 0, CC.MyThingNum - 1 do
		local id = JY.Base["???¡¦" .. i + 1]
		if id >= 0 then
			if JY.Thing[id]["????"] == 1 then
				thing[num] = id
				thingnum[num] = JY.Base["???¡¦????" .. i + 1]
				num = num + 1
			end	
		end
	end
	local r = SelectThing(thing, thingnum)
	if r >= 0 then
		return r
	end
	return -1
end

--????????
function Menu_HYZB()
	if JY.SubScene ~= 25 then
		JY.SubScene = 70
		JY.Base["??X1"] = 8
		JY.Base["??Y1"] = 28
		JY.Base["??X"] = 358
		JY.Base["??Y"] = 235
	end
end

--????????????¡ã?X????
function Menu_Exit()      --????????
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	lib.SetClip(0,0,0,0)
	local t = 0
	for i = 0, (CC.ScreenH/2), 3 do
		lib.Background(0,i,CC.ScreenW,i + 3,t)
		t = t + 1
	end
	for i = (CC.ScreenH/2)+1, CC.ScreenH-3, 3 do
		lib.Background(0,i,CC.ScreenW,i + 3,t)
		t = t - 1
	end
	lib.GetKey()
	local menu = {
	{"???????¡¦", nil, 1}, 
	{"¡¦???????", nil, 1},
	{"???????¡¦", nil, 2}}
	local r = ShowMenu(menu, 3, 0, CC.ScreenW/2-105, CC.ScreenH/2-89, 0, 0, 0, 0, 50, C_GOLD, C_WHITE)
	if r == 1 then
        JY.Status =GAME_END;
		lib.FreeSur(surid)
        return 1;
	elseif r == 2 then
		JY.Restart = 1
        JY.Status =GAME_START;
		lib.FreeSur(surid)
        return 0;
	end
	lib.LoadSur(surid, 0, 0)
	ShowScreen();
	lib.FreeSur(surid)
    return 0;
end

--????????
function Menu_Exit2()
    Cls();
    if DrawStrBoxYesNo(-1,-1,"??¡¦¨½?????????????¡¦(Y/N)?",C_WHITE,CC.DefaultFont) == true then
        Cls();
		JY.Status = GAME_END;
		return 1;
    end
end

--????????
function Menu_SaveRecord()
	Cls();
	lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
	DrawStrBox(-1,CC.ScreenH*1/6-20,"????????",LimeGreen,CC.Fontbig,C_GOLD);
	--DrawStrBox(104,CC.ScreenH*1/6+26,string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"),C_ORANGE,CC.DefaultFont,C_GOLD);
	--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"), C_ORANGE, CC.DefaultFont)
	local r = SaveList();
    if r>0 then
        DrawStrBox(CC.MainSubMenuX2,CC.MainSubMenuY,"?????¨¾......",C_WHITE,CC.DefaultFont);
        ShowScreen();
        SaveRecord(r);
        Cls();
	end
    return 0;
end

--????????
function Menu_ReadRecord()
	Cls();
	lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
	DrawStrBox(-1,CC.ScreenH*1/6-20,"????????",LimeGreen,CC.Fontbig,C_GOLD);
	--DrawStrBox(104,CC.ScreenH*1/6+26,string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"),C_ORANGE,CC.DefaultFont,C_GOLD);
	-- DrawString(500,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"), C_ORANGE, CC.DefaultFont)
	local r = SaveList();
	if r < 1 then
		return 0;
	end
    	
	Cls();
	DrawStrBox(-1,CC.StartMenuY,"?????¨¾...",C_GOLD,CC.DefaultFont);
	ShowScreen();
	local result = LoadRecord(r);
	--if result ~= nil then
		--return 0;
	--end
	--¡Á????¡ã
	if JY.Base["????"] ~= -1 then
		if JY.SubScene < 0 then
			CleanMemory()
			--lib.UnloadMMap()
		end
		--lib.PicInit()
		lib.ShowSlow(20, 1)
		JY.Status = GAME_SMAP
		JY.SubScene = JY.Base["????"]
		JY.MmapMusic = -1
		JY.MyPic = GetMyPic()
		Init_SMap(1)
	--?¨®????
	else
		JY.SubScene = -1
		JY.Status = GAME_FIRSTMMAP
	end
    return 1;
end

--¡Á???¡Á?????


--????????
function Menu_PersonExit()
	DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, "???¨®??????", C_WHITE, CC.DefaultFont)
	local nexty = CC.MainSubMenuY + CC.SingleLineHeight
	local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
	if r == 1 then
		DrawStrBoxWaitKey("?¡ì?????????????¡¦??????????", C_GOLD, CC.DefaultFont, nil, LimeGreen)
	else
		if JY.SubScene == 82 then
			do return end
		end
	end
	if r > 0 and JY.SubScene == 55 and JY.Base["???¨¦" .. r] == 35 then
		do return end
	end
	if r > 1 then
		local personid = JY.Base["???¨¦" .. r]
		if CC.PersonExit[personid] ~= nil then 
			local v = CC.PersonExit[personid]
			CallCEvent(v)
		end
		if JY.Base["????"]==514 then	--615????
			instruct_21(personid)
			TalkEx(""..JY.Person[personid]["????"].."????????????¡Á???????*????????????????¡ã?????", 0, 2)  --???¡ã
		end
	end
	Cls()
	return 0
end

--???¨¦???¨½????????
function SelectTeamMenu(x,y)
	local menu={};
	for i=1,CC.TeamNum do
        menu[i]={"",nil,0};
		local id=JY.Base["???¨¦" .. i]
		if id>=0 then
            if JY.Person[id]["?¨²?¨¹"]>0 then
                menu[i][1]=JY.Person[id]["????"];
                menu[i][3]=1;
            end
		end
	end
    return ShowMenu(menu,CC.TeamNum,0,x,y,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
end

--???????¡ã????????
function GetTeamNum()
    local r=CC.TeamNum;
	for i=1,CC.TeamNum do
	    if JY.Base["???¨¦" .. i]<0 then
		    r=i-1;
		    break;
		end
    end
	return r;
end

---???????¨¦¡Á???
-- ¡Á¨®???¨¹¡¦??????????¨¹??????
function ShowPersonStatusA()
	local r = New_Team()
	--local r = Team()
	if r == 1 then
       PersonStatus(r)
	end

end

--??????????????????????????
--id ????id
function TrainNeedExp(id)         --???????????????¡¦??????????????
    local thingid=JY.Person[id]["???????¡¦"];
	local r =0;
	if thingid >= 0 then
        if JY.Thing[thingid]["?¡¦??????"] >=0 then
            local level=0;          --??????level??????level-1???????????????r????????????????????
			for i =1,JY.Base["????????"] do               -- ?¨¦?????¡ã????????????????
			    if JY.Person[id]["????" .. i]==JY.Thing[thingid]["?¡¦??????"] then
                    level=math.modf(JY.Person[id]["????????" .. i] /100);
					break;
                end
            end
			if level <9 then
                r=math.modf((5-math.modf(JY.Person[id]["¡Á???"]/25))*JY.Thing[thingid]["?????¨¦"]*(level+1)*0.5);
			else
                r=math.huge;
			end
		else
            r=(5-math.modf(JY.Person[id]["¡Á???"]/25))*JY.Thing[thingid]["?????¨¦"];
		end
	end
    return r;
end

--????????
function Menu_Doctor()       --????????
	Cls()
    DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"????????????",C_WHITE,CC.DefaultFont);
	local nexty=CC.MainSubMenuY+CC.SingleLineHeight;
    DrawStrBox(CC.MainSubMenuX,nexty,"????????",C_ORANGE,CC.DefaultFont);

	local menu1={};
	for i=1,CC.TeamNum do
        menu1[i]={"",nil,0};
		local id=JY.Base["???¨¦" .. i]
        if id >=0 then
            if JY.Person[id]["????????"]>=20 then
                 menu1[i][1]=string.format("%-10s%4d",JY.Person[id]["????"],JY.Person[id]["????????"]);
                 menu1[i][3]=1;
            end
        end
	end

    local id1,id2;
	nexty=nexty+CC.SingleLineHeight;
    local r=ShowMenu(menu1,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);

    if r >0 then
	    id1=JY.Base["???¨¦" .. r];
        Cls(CC.MainSubMenuX,CC.MainSubMenuY,CC.ScreenW,CC.ScreenH);
        DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"????????",C_WHITE,CC.DefaultFont);
        nexty=CC.MainSubMenuY+CC.SingleLineHeight;

		local menu2={};
		for i=1,CC.TeamNum do
			menu2[i]={"",nil,0};
			local id=JY.Base["???¨¦" .. i]
			if id>=0 then
				 menu2[i][1]=string.format("%-10s%4d/%4d",JY.Person[id]["????"],JY.Person[id]["?¨²?¨¹"],JY.Person[id]["?¨²?¨¹¡Á??¨®??"]);
				 menu2[i][3]=1;
			end
		end

		local r2=ShowMenu(menu2,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);

		if r2 >0 then
	        id2=JY.Base["???¨¦" .. r2];
            local num=ExecDoctor(id1,id2);
			if num>0 then
                AddPersonAttrib(id1,"????",-2);
			end
            DrawStrBoxWaitKey(string.format("%s ?¨²?¨¹???? %d",JY.Person[id2]["????"],num),C_ORANGE,CC.DefaultFont);
		end
	end

	Cls();
    return 0;
end

--????
function Menu_DecPoison()         --????
    DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"????¡ã???????",C_WHITE,CC.DefaultFont);
	local nexty=CC.MainSubMenuY+CC.SingleLineHeight;
    DrawStrBox(CC.MainSubMenuX,nexty,"?????¨§??",C_ORANGE,CC.DefaultFont);

	local menu1={};
	for i=1,CC.TeamNum do
        menu1[i]={"",nil,0};
		local id=JY.Base["???¨¦" .. i]
        if id>=0 then
            if JY.Person[id]["????????"]>=20 then
                 menu1[i][1]=string.format("%-10s%4d",JY.Person[id]["????"],JY.Person[id]["????????"]);
                 menu1[i][3]=1;
            end
        end
	end

    local id1,id2;
 	nexty=nexty+CC.SingleLineHeight;
    local r=ShowMenu(menu1,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);

    if r >0 then
	    id1=JY.Base["???¨¦" .. r];
         Cls(CC.MainSubMenuX,CC.MainSubMenuY,CC.ScreenW,CC.ScreenH);
        DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"????????",C_WHITE,CC.DefaultFont);
		nexty=CC.MainSubMenuY+CC.SingleLineHeight;

        DrawStrBox(CC.MainSubMenuX,nexty,"????????",C_WHITE,CC.DefaultFont);
	    nexty=nexty+CC.SingleLineHeight;

		local menu2={};
		for i=1,CC.TeamNum do
			menu2[i]={"",nil,0};
			local id=JY.Base["???¨¦" .. i]
			if id>=0 then
				 menu2[i][1]=string.format("%-10s%5d",JY.Person[id]["????"],JY.Person[id]["????????"]);
				 menu2[i][3]=1;
			end
		end

		local r2=ShowMenu(menu2,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
		if r2 >0 then
	        id2=JY.Base["???¨¦" .. r2];
            local num=ExecDecPoison(id1,id2);
            DrawStrBoxWaitKey(string.format("%s ???????????? %d",JY.Person[id2]["????"],num),C_ORANGE,CC.DefaultFont);
		end
	end
    Cls();
    ShowScreen();
    return 0;
end

--????
--id1 ????id2, ¡¦???id2????????????
function ExecDecPoison(id1,id2)     --????????
    local add=JY.Person[id1]["????????"];
    local value=JY.Person[id2]["????????"];

    if value > add+20 then
        return 0;
	end

 	add=limitX(math.modf(add/3)+Rnd(10)-Rnd(10),0,value);
    return -AddPersonAttrib(id2,"????????",-add);
end


--???????¡¦????
function SelectThing(thing,thingnum)    

	local xnum=CC.MenuThingXnum;
	local ynum=CC.MenuThingYnum;

	local w=CC.ThingPicWidth*xnum+(xnum-1)*CC.ThingGapIn+2*CC.ThingGapOut;  --¡Á????¨ª??
	local h=CC.ThingPicHeight*ynum+(ynum-1)*CC.ThingGapIn+2*CC.ThingGapOut; --???¡¦??????

	local dx=(CC.ScreenW-w)/2;
	local dy=(CC.ScreenH-h-2*(CC.ThingFontSize+2*CC.MenuBorderPixel+8))/2-CC.ThingFontSize-11;

	local y1_1,y1_2,y2_1,y2_2,y3_1,y3_2;                  --?????????¡Â????????Y¡Á???

	local cur_line=0;
	local cur_x=0;
	local cur_y=0;
	local cur_thing=-1;
	
	--??????????????¡Á????????¡¦
	local original_thing = {}
	local original_thingnum = {}
	if IsViewingKungfuScrolls == 1 then
		original_thing = thing
		original_thingnum = thingnum
	end
	
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		y1_1=dy;
		y1_2=y1_1+CC.ThingFontSize+2*CC.MenuBorderPixel;
		y2_1=y1_2+5
		y2_2=y2_1+CC.ThingFontSize+2*CC.MenuBorderPixel
		y3_1=y2_2+5;
		y3_2=y3_1+h;
		lib.LoadPNG(91, 9 * 2 , -1 , -1, 1)
		for y=0,ynum-1 do
			for x=0,xnum-1 do
				local id=y*xnum+x+xnum*cur_line
				local boxcolor;
				--???????¡¦????
				if x==cur_x and y==cur_y then
					boxcolor=S_Yellow;
					if thing[id]>=0 then
						cur_thing=thing[id];
						local str=JY.Thing[thing[id]]["????"];
						--¡Á¡ã??????????
						if JY.Thing[thing[id]]["¡Á¡ã??????"] > -1 then
							str = str .." LV."..JY.Thing[thing[id]]["¡Á¡ã??????"]
						end
						if JY.Thing[thing[id]]["????"]==1 or JY.Thing[thing[id]]["????"]==2 then
							if JY.Thing[thing[id]]["??????"] >=0 then
								str=str .. "(" .. JY.Person[JY.Thing[thing[id]]["??????"]]["????"] .. ")";
							end
						end
						if thing[id] == 174 then 
							str=string.format("%s X %d",str,CC.Gold);
						else
						    str=string.format("%s X %d",str,thingnum[id]);
						end
						local str2=JY.Thing[thing[id]]["???¡¦???¡Â"];
						if thing[id]==182 then
							str2=str2..string.format('(??%3d,%3d)',JY.Base['??X'],JY.Base['??Y'])
						end
						DrawString(dx+CC.ThingGapOut+20,y1_1+CC.MenuBorderPixel+10,str,C_GOLD,CC.ThingFontSize);
						DrawString(dx+CC.ThingGapOut+20,y2_1+CC.MenuBorderPixel+10,str2,C_ORANGE,CC.ThingFontSize*0.9);
						local myfont=CC.FontSmall
						local mx, my = dx + 4 * myfont, y3_2 + 2
						local myflag=0
						local myThing=JY.Thing[thing[id]]
								
						--???¡¦???¡Â????
						local function drawitem(ss,str,news)
							local color = C_GOLD
							local mys
							if str==nil then
								mys=ss
							elseif str == '????' then
								mys = string.format(str..':%d',ss)
							elseif  myThing[ss]~=0  then
								if news==nil then
									if myflag==0 then
										--??????????¡Á¡ã??????????????????
										if myThing["¡Á¡ã??????"] > -1 then
											local attr_gain = 0;
											if myThing[ss] > 0 then
												attr_gain = myThing[ss]*10 + myThing[ss]*(myThing["¡Á¡ã??????"]-1)*2
											elseif myThing[ss] < 0 then
												attr_gain = myThing[ss]*10 - myThing[ss]*(myThing["¡Á¡ã??????"]-1)*2
											end
											if attr_gain ~= 0 then
												mys=string.format(str..':%+d',attr_gain)
											end
										else
											mys=string.format(str..':%+d',myThing[ss])
										end
									elseif myflag==1 then	
											mys=string.format(str..':%d',myThing[ss])
									end
								else
									if myThing[ss]<0 then
										return
									end
									mys=string.format(str..':%s',news[myThing[ss]])
								end
								--????????
								if myThing[ss]==1 and ss=="??????????" then
									color = RGB(236, 200, 40)
								elseif myThing[ss]==2 and ss=="??????????" then
									color = RGB(236, 236, 236)
								end
							elseif myThing[ss]==0 and ss=="??????????" then
								mys=string.format(str..':%s',news[myThing[ss]])
								color = RGB(208, 152, 208)
							else
								return
							end
							
							if mys ~= nil then
								local mylen = myfont * string.len(mys) / 2 + 12
								if CC.ScreenW - dx < mx + mylen then
									my = my + myfont + 10
									mx = dx + 4 * myfont
								end
								DrawString(mx+CC.MenuBorderPixel,my+CC.MenuBorderPixel,mys,color,myfont)
								mx=mx+mylen
							end
						end
					  
						--???¨§????????????????
						if myThing["?¡¦??????"] > 0 then
							local kfname = "?¡ã??:" .. JY.Wugong[myThing["?¡¦??????"]]["????"]
							DrawString(mx+CC.MenuBorderPixel, my+CC.MenuBorderPixel, kfname, C_GOLD, myfont)
							mx = mx + myfont * string.len(kfname) / 2 + 12
						end
								
						if myThing['????'] > 0 then
							drawitem('???¨²?¨¹','?¨²?¨¹')
							drawitem('???¨²?¨¹¡Á??¨®??','?¨²?¨¹¡Á??¨®??')
							drawitem('??????????','????')
							drawitem('??????','????')
							if myThing['????????????']==2 then
								drawitem('?????????????¡Â??')
							elseif myThing['????????????']==3 then
								drawitem('???????¡¦¡Á???????')
							elseif myThing['????????????']==4 then
								drawitem('???????¡¦¡Á???????')	
							end
							drawitem('??????','????')
							drawitem('??????¡Á??¨®??','????¡Á??¨®??')
							drawitem('?????¡Â??','???¡Â')
							drawitem('???¨¢??','?¨¢??')
							drawitem('??¡¦?????','¡¦???')
							drawitem('??????????','????')
							drawitem('??????????','????')
							--drawitem('??????????','????')
							drawitem('??????????','????')
							drawitem('????????¡¦¨¾','????')
							drawitem('????¡¦¡§????','??¡¦¡§')
							drawitem('??????????','????')
							drawitem('??????????','????')
							drawitem('?????????¡Â','????')
							drawitem('??¡ã??¡Â????','¡ã??¡Â')
							drawitem('?????¡ì????','????')
							drawitem('???¡¦??','?¡¦??')
							drawitem('?????¡Â????','¡Á¨®??',{[0]='¡¦¨½','??'})
							drawitem('?????¡Â????','????')
							if myThing['????7']==1 then
                                drawitem('????????????')
							end
                            if thing[id] == 372 then 
                                drawitem('?¨§?¨¾????????')
                            end
							if thing[id] == 450 then
								drawitem('?¡ì?¨¢¡ã??¡Â?????????¡§?¡Á??')
							end
							if thing[id] == 458 then
								drawitem('?¡ì?¨¢¡ã??¡Â??????????????')
							end		
							if thing[id] == 459 then
								drawitem('?¡ì?¨¢¡ã??¡Â???????¨²??¡¦?')
							end		
							if thing[id] == 460 then
								drawitem('?¡ì?¨¢¡ã??¡Â????????????')
							end
							if thing[id] == 469 then
								drawitem('?¡ì?¨¢¡ã??¡Â???????????¨½??')
							end
							--???¡Â¡Á¡ã??????????
							for i,v in ipairs(CC.ExtraOffense) do
								if v[1] == thing[id] then
									DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,"????????:"..JY.Wugong[v[2]]["????"].."+"..v[3],PinkRed,myfont)
								end
							end
							
							if mx~=dx or my~=y3_2+2 then
								if thing[id] > 348 or thing[id] < 343 then	--???????¡¦??????
									DrawString(dx+CC.MenuBorderPixel+20, y3_2 + 2+CC.MenuBorderPixel, " ?¡ì??:", LimeGreen, myfont)
								end						
							end
						end
						
						--¡Á¡ã????????????
						if myThing['????']==1 or myThing['????']==2 then
							if mx~=dx then
								mx=dx+4*myfont
								my=my+myfont+3
							end
							myflag=1
							local my2=my
							if myThing['??????????']>-1 then
								drawitem('????:'..JY.Person[myThing['??????????']]['????'])
							end
							drawitem('??????????','????',{[0]='??','??','????'})
							drawitem('??????','????')
							drawitem('?????¡Â??','???¡Â')
							drawitem('???¨¢??','?¨¢??')
							drawitem('??????????','????')
							drawitem('??????????','????')
							--drawitem('??????????','????')
							drawitem('????????¡¦¨¾','????')
							drawitem('????¡¦¡§????','??¡¦¡§')
							drawitem('??????????','????')
							drawitem('??????????','????')
							drawitem('?????????¡Â','????')
							drawitem('??¡ã??¡Â????','¡ã??¡Â')
                            if thing[id] == 372 then 
                                drawitem('??80>¡Á???>30')
                            end
							 if thing[id] == 327 then 
                                drawitem('??80>¡Á???>30')
                            end
							--?¡¦¡Á???????
							if thing[id] == 118 then
								local exstr = "???????¡Â??????>=120 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end
							--??????????
							if thing[id] == 176 then
								local exstr = "????/????/??????????>=70 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end
							--???????¡Á??????
							if thing[id] == 239 then
								local exstr = "?????¨¾??¡¦¡§>=70 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end
							--???????¡¦??????
							if thing[id] == 200 then
								local exstr = "?????¨¾??¡¦¡§>=200 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end							
							drawitem('??¡Á???','¡Á???')
							drawitem('?????¨¦','???????¨¦')
							if thing[id] == 81 then
								drawitem(10,'????')
							end	
							if mx~=dx or my~=my2 then
								DrawString(dx+CC.MenuBorderPixel+20,my2+CC.MenuBorderPixel,' ???¨®:',LimeGreen,myfont)
							end
						end
						--???¡ì???¡Â
						if WPTX2[thing[id]] ~= nil then
							if mx~=dx then
								mx=dx+4*myfont
								my=my+myfont+3
							end
							local my2=my
							if mx~=dx or my~=my2 then
								DrawString(dx+CC.MenuBorderPixel+20,my2+CC.MenuBorderPixel,' ?¡ì??:',C_RED,myfont)
							end

							DrawString(dx+CC.MenuBorderPixel+myfont*3+20,my2+CC.MenuBorderPixel,WPTX2[thing[id]], M_DeepSkyBlue,myfont)
						end
						--???¡ì???¡Â
						if myThing['??¡¦¨½???¡ì'] == 1 and (WPTX[thing[id]][myThing['¡Á¡ã??????']] ~= nil or myThing['¡Á¡ã??????'] == -1) then
							if mx~=dx then
								mx=dx+4*myfont
								my=my+myfont+3
							end
							local my2=my
							if mx~=dx or my~=my2 then
								DrawString(dx+CC.MenuBorderPixel+20,my2+CC.MenuBorderPixel,' ???¡ì:',C_RED,myfont)
							end
							if myThing['¡Á¡ã??????'] > -1 then
								local TXstr = WPTX[thing[id]][myThing['¡Á¡ã??????']]
								--????????????????
								if thing[id] == 303 then
									TXstr = TXstr.."?¡§????"..JY.Person[651]["?¡¦??"].."????"
								end
								DrawString(dx+CC.MenuBorderPixel+myfont*3+20,my2+CC.MenuBorderPixel, TXstr, M_DeepSkyBlue,myfont)
							else
								DrawString(dx+CC.MenuBorderPixel+myfont*3+20,my2+CC.MenuBorderPixel, WPTX[thing[id]], M_DeepSkyBlue,myfont)
							end
						end
					else
						cur_thing=-1;
					end
				else
					boxcolor=C_BLACK;
				end
		  
				local boxx = dx + CC.ThingGapOut + x * (CC.ThingPicWidth + CC.ThingGapIn)
				local boxy = y3_1 + CC.ThingGapOut + y * (CC.ThingPicHeight + CC.ThingGapIn)

				if thing[id] >= 0 then
					lib.PicLoadCache(2, thing[id] * 2, boxx + 1, boxy + 1, 1)
				end
				--?????????????????¨½?¨¾
				if boxcolor == S_Yellow then
					DrawSingleLine(boxx+2, boxy+1, boxx + CC.ThingPicWidth/4, boxy+1, boxcolor)
					DrawSingleLine(boxx+2+ CC.ThingPicWidth*3/4, boxy+1, boxx + CC.ThingPicWidth, boxy+1, boxcolor)
					DrawSingleLine(boxx+2, boxy+1, boxx+2, boxy + CC.ThingPicHeight/4 - 1, boxcolor)
					DrawSingleLine(boxx + CC.ThingPicWidth-1, boxy+2, boxx + CC.ThingPicWidth-1, boxy + CC.ThingPicHeight/4 - 1, boxcolor)
					DrawSingleLine(boxx+2, boxy+2+CC.ThingPicHeight*3/4, boxx+2, boxy + CC.ThingPicHeight - 1, boxcolor)
					DrawSingleLine(boxx + CC.ThingPicWidth-1, boxy+2+CC.ThingPicHeight*3/4, boxx + CC.ThingPicWidth-1, boxy + CC.ThingPicHeight - 1, boxcolor)
					DrawSingleLine(boxx+1, boxy + CC.ThingPicHeight - 1, boxx + CC.ThingPicWidth/4, boxy + CC.ThingPicHeight - 1, boxcolor)
					DrawSingleLine(boxx+2+ CC.ThingPicWidth*3/4, boxy + CC.ThingPicHeight - 1, boxx + CC.ThingPicWidth-1, boxy + CC.ThingPicHeight - 1, boxcolor)
				end
			end
		end
		
		DrawString(CC.ScreenW-240,CC.ScreenH-CC.Fontsmall-8	, "¡ã?F1?¨¦?????????¡Â", C_CYGOLD,CC.Fontsmall)
		DrawString(CC.ScreenW-220, CC.ScreenH-CC.Fontsmall*2-8, "????:", C_GOLD, CC.Fontsmall)
	    DrawString(CC.ScreenW-220+CC.FontSmall*3, CC.ScreenH-CC.Fontsmall*2-8, CC.Gold, C_CYGOLD, CC.Fontsmall)
		if IsViewingKungfuScrolls > 0 then
			local list = {"1:????","2:??¡¦¡§","3:??¡¦¡§","4:??¡¦¡§","5:??¡¦¡§","6:????","7:???¨¢","8:???¡ì"}
			local space = 0
			local h = 0
			for i = 1, 8 do
				local color = C_GOLD
				if i == IsViewingKungfuScrolls then
					color = C_RED
				end
				if i == 5 then
					space = 0
					h = 35
				end
				space = space + 81
				DrawString(CC.ScreenW-405 + space-20 ,50+h, list[i], color,CC.Fontsmall)
			end
		end

		ShowScreen();
  	
		local keypress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame);
		if keypress==VK_ESCAPE or ktype == 4 then
			cur_thing=-1;
			break;
		elseif keypress==VK_RETURN or keypress==VK_SPACE then
			break;
		--???????¡¦?????????¡Â
		elseif (keypress==VK_F1 or keypress==VK_H) and cur_thing ~= -1 then
			detailed_info(cur_thing)
		--??¡Á?1 ????
		elseif IsViewingKungfuScrolls > 0 and keypress==49 then
			thing = original_thing
			thingnum = original_thingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 1
		--??¡Á?2 ??¡¦¡§
		elseif IsViewingKungfuScrolls > 0 and keypress==50 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["?¡¦??????"]
				if TSkill > -1 and JY.Wugong[TSkill]["????????"] == 1 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 2
		--??¡Á?3 ??¡¦¡§
		elseif IsViewingKungfuScrolls > 0 and keypress==51 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["?¡¦??????"]
				if TSkill > -1 and JY.Wugong[TSkill]["????????"] == 2 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 3
		--??¡Á?4 ??¡¦¡§
		elseif IsViewingKungfuScrolls > 0 and keypress==52 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["?¡¦??????"]
				if TSkill > -1 and JY.Wugong[TSkill]["????????"] == 3 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 4
		--??¡Á?5 ??¡¦¡§
		elseif IsViewingKungfuScrolls > 0 and keypress==53 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["?¡¦??????"]
				if TSkill > -1 and JY.Wugong[TSkill]["????????"] == 4 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 5
		--??¡Á?6 ????
		elseif IsViewingKungfuScrolls > 0 and keypress==54 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["?¡¦??????"]
				if TSkill > -1 and JY.Wugong[TSkill]["????????"] == 5 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 6
		--??¡Á?7 ???¨¢
		elseif IsViewingKungfuScrolls > 0 and keypress==55 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["?¡¦??????"]
				if TSkill > -1 and (JY.Wugong[TSkill]["????????"] == 6 or JY.Wugong[TSkill]["????????"] == 7) then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 7
		--??¡Á?8 ???¡ì
		elseif IsViewingKungfuScrolls > 0 and keypress==56 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["?¡¦??????"]
				if TSkill == -1 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 8
		elseif keypress==VK_UP or ktype == 6 then
			if  cur_y == 0 then
				if  cur_line > 0 then
					cur_line = cur_line - 1;
				end
			else
				cur_y = cur_y - 1;
			end
		elseif keypress==VK_DOWN or ktype == 7 then
			if  cur_y ==ynum-1 then
				if  cur_line < (math.modf(CC.MyThingNum/xnum)-ynum) then
					cur_line = cur_line + 1;
				end
			else
				cur_y = cur_y + 1;
			end
		elseif keypress==VK_LEFT then
			if  cur_x > 0 then
				cur_x=cur_x-1;
			else
				cur_x=xnum-1;
			end
		elseif keypress==VK_RIGHT then
			if  cur_x ==xnum-1 then
				cur_x=0;
			else
				cur_x=cur_x+1;
			end
		elseif ktype == 2 or ktype == 3 then
			if mx>dx and my>dy and mx<CC.ScreenW-dx and my<CC.ScreenH-dy then
				cur_x=math.modf((mx-dx-CC.ThingGapOut/2)/(CC.ThingPicWidth+CC.ThingGapIn))
				cur_y=math.modf((my-y3_1-CC.ThingGapOut/2)/(CC.ThingPicHeight+CC.ThingGapIn))
				if ktype==3 then
					break
				end
			end
		end
	end

	Cls();
	--????????????¨®???????¡¦?
	if IsViewingKungfuScrolls > 0 then
		IsViewingKungfuScrolls = 0
	end
	return cur_thing;
end


--???¡ã???¨ª?¡Â????
function Game_SMap()         --???¡ã???¨ª?¡Â????
	if JY.Restart == 1 then
		return
	end
	
    DrawSMap();	
	--????????????¡¦?????
	if CC.ShowXY==1 then
		lib.LoadPNG(91,43*2,CC.ScreenW/1360*136,CC.ScreenH/768*142,2)
        DrawString(CC.ScreenW/1360*70,CC.ScreenH/768*129,string.format("%s %d %d",JY.Scene[JY.SubScene]["????"],JY.Base["??X1"],JY.Base["??Y1"]) ,C_GOLD,CC.Fontsmall*0.9);
	end
		
	--DrawTimer();
	DrawTimerA();
	JYZTB();
	--JYZTB1();
    ShowScreen();
    lib.SetClip(0, 0, 0, 0)
  
	local d_pass=GetS(JY.SubScene,JY.Base["??X1"],JY.Base["??Y1"],3);   --???¡ã?¡¦??????
	if d_pass>=0 then
		if d_pass ~=JY.OldDPass then     --??????????¡¦?
			EventExecute(d_pass,3);       --?¡¦????¡¦?????
			JY.OldDPass=d_pass;
			JY.oldSMapX=-1;
			JY.oldSMapY=-1;
			JY.D_Valid=nil;
		end
		if JY.Status~=GAME_SMAP then
			return ;
		else
		   JY.OldDPass=-1;
		end
	end
	local isout=0;                --??¡¦¨½????????
	if (JY.Scene[JY.SubScene]["????X1"] ==JY.Base["??X1"] and JY.Scene[JY.SubScene]["????Y1"] ==JY.Base["??Y1"]) or
		(JY.Scene[JY.SubScene]["????X2"] ==JY.Base["??X1"] and JY.Scene[JY.SubScene]["????Y2"] ==JY.Base["??Y1"]) or
		(JY.Scene[JY.SubScene]["????X3"] ==JY.Base["??X1"] and JY.Scene[JY.SubScene]["????Y3"] ==JY.Base["??Y1"]) then
		isout=1;
	end
	--?????¨®????
	if isout == 1 then
		--???????????????¨ª??????¡¦??????¡ã?¨®?????¨¢?????¡§??????????
		if JY.Base["??X"] == JY.Scene[JY.SubScene]["???¡ã????X1"] and JY.Base["??Y"] == JY.Scene[JY.SubScene]["???¡ã????Y1"] then
			--?????????????¨ª
			if JY.SubScene == 2 then
				JY.Base["??Y"] = JY.Base["??Y"] + 1
			--?¨§???????????¨ª
			elseif JY.SubScene == 92 then
				JY.Base["??X"] = JY.Base["??X"] + 1
			else
				if JY.Base["??¡¦??¨¾"] == 0 then
					JY.Base["??Y"] = JY.Base["??Y"] - 1
				elseif JY.Base["??¡¦??¨¾"] == 1 then
					JY.Base["??X"] = JY.Base["??X"] + 1
				elseif JY.Base["??¡¦??¨¾"] == 2 then
					JY.Base["??X"] = JY.Base["??X"] - 1
				elseif JY.Base["??¡¦??¨¾"] == 3 then
					JY.Base["??Y"] = JY.Base["??Y"] + 1
				end
			end
		end
		--?¡Â???????????????¨ª
		if JY.SubScene == 13 then
			JY.Base["??X"] = 68
			JY.Base["??Y"] = 397
		end
		--????¡ã¨¹?????????¨ª
		if JY.SubScene == 6 then
			JY.Base["??X"] = 49
			JY.Base["??Y"] = 111
		end
		JY.Status = GAME_MMAP
		--lib.PicInit()
		CleanMemory()
		JY.MmapMusic = JY.Scene[JY.SubScene]["????????"]
		MMapName()
		--???????????????????????¡ã
		if JY.MmapMusic < 0 then
			JY.MmapMusic = 0
		end
		Init_MMap()
		JY.SubScene = -1
		JY.oldSMapX = -1
		JY.oldSMapY = -1
		lib.DrawMMap(JY.Base["??X"], JY.Base["??Y"], GetMyPic())
		lib.GetKey()
		lib.ShowSlow(20,0)
		return
	end
    --??¡¦¨½??¡Á??????????¡ã
    if JY.Scene[JY.SubScene]["??¡Á????¡ã"] >= 0 and JY.Base["??X1"] == JY.Scene[JY.SubScene]["??¡Á???X1"] and JY.Base["??Y1"] == JY.Scene[JY.SubScene]["??¡Á???Y1"] then
		local OldScene = JY.SubScene
		JY.SubScene = JY.Scene[JY.SubScene]["??¡Á????¡ã"]
		lib.ShowSlow(20, 1)
		if JY.Scene[OldScene]["???¡ã????X1"] ~= 0 then
			JY.Base["??X1"] = JY.Scene[JY.SubScene]["????X"]
			JY.Base["??Y1"] = JY.Scene[JY.SubScene]["????Y"]
		else
			JY.Base["??X1"] = JY.Scene[JY.SubScene]["??¡Á???X2"]
			JY.Base["??Y1"] = JY.Scene[JY.SubScene]["??¡Á???Y2"]
		end
		Init_SMap(1)
		return 
	end

    local x,y;
    local direct = -1;
    local keypress, ktype, mx, my = lib.GetKey();
	--???¨§???¨²??????????¡¦??¨¾??¡¦¨½??¡ã???
    for i = VK_RIGHT,VK_UP do
        if i ~= CC.PrevKeypress and lib.GetKeyState(i) ~=0 then
			keypress = i
		end
	end 
    --????????????????¡¦??¨¾????¡ã??????¨¾?¨§??????????????¡¦??¨¾??¡¦¨½??¡ã???
	if keypress==-1 and	lib.GetKeyState(CC.PrevKeypress) ~=0 then
		keypress = CC.PrevKeypress
	end
    CC.PrevKeypress = keypress
    if keypress==VK_UP then
		direct=0;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_DOWN then
		direct=3;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_LEFT then
		direct=2;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_RIGHT then
		direct=1;
		JY.WalkCount = JY.WalkCount + 1
	else
		JY.WalkCount = 0
	end
	
	if ktype == 1 then
		JY.Mytick=0;
		if keypress==VK_ESCAPE then
			Cls()
			--MMenu();
			--CMenu() 
			tjm_menu()
		elseif keypress==VK_SPACE or keypress==VK_RETURN then       --???¨½??¡¦?????
			if JY.Base["??¡¦??¨¾"]>=0 then
				local d_num=GetS(JY.SubScene,JY.Base["??X1"]+CC.DirectX[JY.Base["??¡¦??¨¾"]+1],JY.Base["??Y1"]+CC.DirectY[JY.Base["??¡¦??¨¾"]+1],3);
				if d_num>=0 then
					EventExecute(d_num,1);
				end
			end
		--?????????????¡Á?¨§???¨¹ 7-30
	    elseif keypress == VK_S then	--????
			Menu_SaveRecord()
	    elseif keypress == VK_L then	--????
			Menu_ReadRecord()
 
		elseif keypress == VK_Z then	--¡Á???
			Cls()
			local a = Team()
			
			if a ~= nil and a > 0 then
				PersonStatus(a)
			else
				do return end
			end	
		
		elseif keypress == VK_Q then	--???? ???????¡§
			Cls()
			QUANZHANGQX1()
		elseif keypress == VK_W then	--???? ???¡ì????
			Cls()
			MJMenu()		
		elseif keypress == VK_E then	--???¡¦
			Cls()
			Menu_Thing()
		elseif keypress == VK_R then	--???? ???????¡¦
			Cls()
			ThingMenu()	
		elseif keypress == VK_F2 then	--?????¨¾???????¨§???¨¹				
		    CallCEvent(690)			
		elseif keypress == VK_F3 then	--????????
			Cls()
			Menu_TZDY()
		elseif keypress == VK_F4 then	--???¨ª
			Cls()		
			Menu_WPZL()
		end
	elseif ktype == 3 then
		if mx >= 0 and mx <= CC.ScreenW/1360*63 and 
		   my >= CC.ScreenH/768*110 and my <= CC.ScreenH/768*160 then
		   tjm_menu()
		   --CMenu()
		else  
			AutoMoveTab = {[0]=0}
			local x0 = JY.Base["??X1"]
			local y0 = JY.Base["??Y1"]
			
			local px=x0
			local py=y0
			if CONFIG.Zoom == 100 then
				--????????????????????????¡Á????¡ã?¡¦?¨ª?¨®??????
				px=limitX(x0,13,46)
				py=limitX(y0,13,46)
			else
				px=x0
				py=y0
			end
		
			mx = mx + (px-py)*CC.XScale - CC.ScreenW/2
			my = my + (px+py)*CC.YScale - CC.ScreenH/2
				
			local xx = (mx/CC.XScale + my/CC.YScale)/2;
			local yy = (my/CC.YScale - mx/CC.XScale)/2;
				
			if xx - math.modf(xx) > 0 then
				xx = math.modf(xx);
			end
				
			if yy - math.modf(yy) > 0 then
				yy = math.modf(yy);
			end	
			
			if CONFIG.Zoom ~= 100 then		--??????????????????????????¡¦?????????????????
				xx = xx + 1
				yy = yy + 1
			end

			if xx > 0 and xx < CC.SWidth and yy > 0 and yy < CC.SHeight then
				walkto(xx - x0,yy - y0)
			end
		end
	elseif ktype == 4 then
		JY.Mytick=0;
		Cls()
		--MMenu();
		--CMenu() 
		tjm_menu()
    end

    if JY.Status~=GAME_SMAP then
        return ;
    end
	
	--????????????????????¡Á???????¡Á???¡Á????¡ã?????¨½???¨¢??¡¦?????
	if CC.AutoMoveEvent[1] ~= 0 and 
	(JY.Base["??X1"] == CC.AutoMoveEvent[1] or JY.Base["??X1"] - 1 == CC.AutoMoveEvent[1] or JY.Base["??X1"] + 1 == CC.AutoMoveEvent[1]) and 
	(JY.Base["??Y1"] == CC.AutoMoveEvent[2] or JY.Base["??Y1"] - 1 == CC.AutoMoveEvent[2] or JY.Base["??Y1"] + 1 == CC.AutoMoveEvent[2]) then
		CC.AutoMoveEvent[0] = 1			--?¨®????¡Á¡Â??¡¦?????
	end
    
    if AutoMoveTab[0] ~= 0 then			--?¨®??¡Á???¡Á???
		if direct == -1 then
			direct = AutoMoveTab[AutoMoveTab[0]]
			AutoMoveTab[AutoMoveTab[0]] = nil
			AutoMoveTab[0] = AutoMoveTab[0] - 1
	    end
	else
	    AutoMoveTab = {[0] = 0}
		if CC.AutoMoveEvent[0] == 1 then
			EventExecute(GetS(JY.SubScene,CC.AutoMoveEvent[1],CC.AutoMoveEvent[2],3),1);
			CC.AutoMoveEvent[0] = 0;
			CC.AutoMoveEvent[1] = 0;
			CC.AutoMoveEvent[2] = 0;
		end
	end
	
    if direct ~= -1 then
        AddMyCurrentPic();
        x=JY.Base["??X1"]+CC.DirectX[direct+1];
        y=JY.Base["??Y1"]+CC.DirectY[direct+1];
        JY.Base["??¡¦??¨¾"]=direct;
		if JY.WalkCount == 1 then
			lib.Delay(90)
		end
    else
        x=JY.Base["??X1"];
        y=JY.Base["??Y1"];
    end

    JY.MyPic=GetMyPic();
    DtoSMap();
    if SceneCanPass(x,y)==true then          --????¡Á???????¡Á?????
        JY.Base["??X1"]=x;
        JY.Base["??Y1"]=y;
    end

    JY.Base["??X1"]=limitX(JY.Base["??X1"],1,CC.SWidth-2);
    JY.Base["??Y1"]=limitX(JY.Base["??Y1"],1,CC.SHeight-2);
    
	--????????????
	NEvent(keypress)
end

--???¡ã¡Á???(x,y)??¡¦¨½?????¡§??
--¡¦???true,??????false????
function SceneCanPass(x,y)  --???¡ã¡Á???(x,y)??¡¦¨½?????¡§??
    local ispass=true;        --??¡¦¨½?????¡§??

    if GetS(JY.SubScene,x,y,1)>0 then     --???¡ã??1?????¡¦???????¡§??
        ispass=false;
    end

    local d_data=GetS(JY.SubScene,x,y,3);     --??????4
    if d_data>=0 then
        if GetD(JY.SubScene,d_data,0)~=0 then  --d*???????????¡§??
            ispass=false;
        end
    end

    if CC.SceneWater[GetS(JY.SubScene,x,y,0)] ~= nil then   --??????????????
        ispass=false;
    end
    return ispass;
end

function DtoSMap()          ---D*??????????????????S*???????????¨ª?????¡ì????
    for i=0,CC.DNum-1 do
        local x=GetD(JY.SubScene,i,9);
        local y=GetD(JY.SubScene,i,10);
        if x>0 and y>0 then
            SetS(JY.SubScene,x,y,3,i);

			local p1=GetD(JY.SubScene,i,5);
			if p1>=0 then
				local p2=GetD(JY.SubScene,i,6);
				local p3=GetD(JY.SubScene,i,7);
				local delay=GetD(JY.SubScene,i,8);
				if p3<=p1 then     --??????????
					if JY.Mytick %100 > delay then
						p3=p3+1;
					end
				else
					if JY.Mytick % 4 ==0 then      --4??????????????????
						p3=p3+1;
					end
				end
				if p3>p2 then
					 p3=p1;
				end
				SetD(JY.SubScene,i,7,p3);
			end
        end
    end
end


function DrawSMap()         --?????¡ã????
	local x0=JY.SubSceneX+JY.Base["??X1"]-1;    --??????????
    local y0=JY.SubSceneY+JY.Base["??Y1"]-1;

    local x=limitX(x0,12,45)-JY.Base["??X1"];
    local y=limitX(y0,12,45)-JY.Base["??Y1"];
	
	if CONFIG.Zoom == 100 then
		lib.DrawSMap(JY.SubScene,JY.Base["??X1"],JY.Base["??Y1"],x,y,JY.MyPic)
	else
		lib.DrawSMap(JY.SubScene,JY.Base["??X1"],JY.Base["??Y1"],JY.SubSceneX,JY.SubSceneY,JY.MyPic)
	end
end


-- ???????¡¦????
-- id=0 ????????=1/2/3 ????
--????????¡ã?????????Byte??¡Á¨¦???????¨®?¡§??¡¦????????¨ª??¡¦?¡¦¡§????¡¦????¨ª??????????¡Á¨¦¡¦?????
--?????¡ã?????????????????????????????????????????????????¨§??????????????????
function LoadRecord(id)       -- ???????¡¦????
    local zipfile=string.format(CONFIG.DataPath..'save/Save_%d',id)
	
	if CC.BBH~=198045761 then
		QZXS("??????¡ã???????????????????????????198045761?????¨¹??");
		return -1;
	end
    
    if id ~= 0 and ( existFile(zipfile) == false) then
		QZXS("???????????????????????????????¨½???¨¹?????¨¾????????");
		return -1;
	end
    
    Byte.unzip(zipfile, CONFIG.DataPath..'save/r.grp',CONFIG.DataPath..'save/d.grp',CONFIG.DataPath..'save/s.grp',CONFIG.DataPath..'save/tjm')

    local t1=lib.GetTime();

    --????R*.idx????
    local data=Byte.create(6*4);
    Byte.loadfile(data,CC.R_IDXFilename[0],0,6*4);

	local idx={};
	idx[0]=0;
	for i =1,6 do
	    idx[i]=Byte.get32(data,4*(i-1));
	end
	
	local grpFile = CONFIG.DataPath..'save/r.grp';
	local sFile = CONFIG.DataPath..'save/s.grp';
	local dFile = CONFIG.DataPath..'save/d.grp';
	if id == 0 then
		grpFile = CC.R_GRPFilename[id];
		sFile = CC.S_Filename[id];
		dFile = CC.D_Filename[id];
	end
	
    --????R*.grp????
    JY.Data_Base=Byte.create(idx[1]-idx[0]);              --????????
    Byte.loadfile(JY.Data_Base,grpFile,idx[0],idx[1]-idx[0]);

    --????¡¦?????????????¡¦?¡¦¡§??????????????¡¦????¨ª??¡¦???¡¦?????????????¡ã???????????¡Á??????¨ª????????????????????
	local meta_t={
	    __index=function(t,k)
	        return GetDataFromStruct(JY.Data_Base,0,CC.Base_S,k);
		end,

		__newindex=function(t,k,v)
	        SetDataFromStruct(JY.Data_Base,0,CC.Base_S,k,v);
	 	end
	}
    setmetatable(JY.Base,meta_t);


    JY.PersonNum=math.floor((idx[2]-idx[1])/CC.PersonSize);   --????

	JY.Data_Person=Byte.create(CC.PersonSize*JY.PersonNum);
	Byte.loadfile(JY.Data_Person,grpFile,idx[1],CC.PersonSize*JY.PersonNum);

	for i=0,JY.PersonNum-1 do
		JY.Person[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Person,i*CC.PersonSize,CC.Person_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Person,i*CC.PersonSize,CC.Person_S,k,v);
			end
		}
        setmetatable(JY.Person[i],meta_t);
	end

    JY.ThingNum=math.floor((idx[3]-idx[2])/CC.ThingSize);     --???¡¦
	JY.Data_Thing=Byte.create(CC.ThingSize*JY.ThingNum);
	Byte.loadfile(JY.Data_Thing,grpFile,idx[2],CC.ThingSize*JY.ThingNum);
	for i=0,JY.ThingNum-1 do
		JY.Thing[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Thing,i*CC.ThingSize,CC.Thing_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Thing,i*CC.ThingSize,CC.Thing_S,k,v);
			end
		}
        setmetatable(JY.Thing[i],meta_t);
	end

    JY.SceneNum=math.floor((idx[4]-idx[3])/CC.SceneSize);     --???¡ã
	JY.Data_Scene=Byte.create(CC.SceneSize*JY.SceneNum);
	Byte.loadfile(JY.Data_Scene,grpFile,idx[3],CC.SceneSize*JY.SceneNum);
	for i=0,JY.SceneNum-1 do
		JY.Scene[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Scene,i*CC.SceneSize,CC.Scene_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Scene,i*CC.SceneSize,CC.Scene_S,k,v);
			end
		}
        setmetatable(JY.Scene[i],meta_t);
	end

    JY.WugongNum=math.floor((idx[5]-idx[4])/CC.WugongSize);     --????
	JY.Data_Wugong=Byte.create(CC.WugongSize*JY.WugongNum);
	Byte.loadfile(JY.Data_Wugong,grpFile,idx[4],CC.WugongSize*JY.WugongNum);
	for i=0,JY.WugongNum-1 do
		JY.Wugong[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Wugong,i*CC.WugongSize,CC.Wugong_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Wugong,i*CC.WugongSize,CC.Wugong_S,k,v);
			end
		}
        setmetatable(JY.Wugong[i],meta_t);
	end

    JY.ShopNum=math.floor((idx[6]-idx[5])/CC.ShopSize);     --???¨¾????
	JY.Data_Shop=Byte.create(CC.ShopSize*JY.ShopNum);
	Byte.loadfile(JY.Data_Shop,grpFile,idx[5],CC.ShopSize*JY.ShopNum);
	for i=0,JY.ShopNum-1 do
		JY.Shop[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Shop,i*CC.ShopSize,CC.Shop_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Shop,i*CC.ShopSize,CC.Shop_S,k,v);
			end
		}
        setmetatable(JY.Shop[i],meta_t);

    end

    lib.LoadSMap(sFile,CC.TempS_Filename,JY.SceneNum,CC.SWidth,CC.SHeight,dFile,CC.DNum,11);
	collectgarbage();

	lib.Debug(string.format("Loadrecord time=%d",lib.GetTime()-t1));
	
	JY.LOADTIME = lib.GetTime()
	
	rest()
	
	if id > 0 then 
	   tjmload(id)
	end
   
	os.remove(CONFIG.DataPath..'save/r.grp')
	os.remove(CONFIG.DataPath..'save/d.grp')
	os.remove(CONFIG.DataPath..'save/s.grp')
	os.remove(CONFIG.DataPath..'save/tjm');
end


-- ?????¡¦????
-- id=0 ????????=1/2/3 ????
function SaveRecord(id)         -- ?????¡¦????
	
	if CC.BBH~=198045761 then
	return
	end

	--??????¡¦¨½??¡Á????¡ã????
	if JY.Status == GAME_SMAP then
      JY.Base["????"] = JY.SubScene
    else
      JY.Base["????"] = -1
    end
	
    --????R*.idx????
    local t1 = lib.GetTime()
	JY.SAVETIME = lib.GetTime()
	JY.GTIME = math.modf((JY.SAVETIME - JY.LOADTIME) / 60000)
	SetS(14, 2, 1, 4, GetS(14, 2, 1, 4) + JY.GTIME)
	JY.LOADTIME = lib.GetTime()

    local data=Byte.create(6*4);
    Byte.loadfile(data,CC.R_IDXFilename[0],0,6*4);

	local idx={};
	idx[0]=0;
	for i =1,6 do
	    idx[i]=Byte.get32(data,4*(i-1));
	end

	--os.remove(CONFIG.DataPath..'save/r.grp');
    --??R*.grp????
	Byte.savefile(JY.Data_Base,CONFIG.DataPath..'save/r.grp',idx[0],idx[1]-idx[0]);

	Byte.savefile(JY.Data_Person,CONFIG.DataPath..'save/r.grp',idx[1],CC.PersonSize*JY.PersonNum);

	Byte.savefile(JY.Data_Thing,CONFIG.DataPath..'save/r.grp',idx[2],CC.ThingSize*JY.ThingNum);

	Byte.savefile(JY.Data_Scene,CONFIG.DataPath..'save/r.grp',idx[3],CC.SceneSize*JY.SceneNum);

	Byte.savefile(JY.Data_Wugong,CONFIG.DataPath..'save/r.grp',idx[4],CC.WugongSize*JY.WugongNum);

	Byte.savefile(JY.Data_Shop,CONFIG.DataPath..'save/r.grp',idx[5],CC.ShopSize*JY.ShopNum);

    lib.SaveSMap(CONFIG.DataPath..'save/s.grp',CONFIG.DataPath..'save/d.grp');
	
    tjmsave(id)
	
    local zipfile=string.format(CONFIG.DataPath..'save/Save_%d',id)
    Byte.zip(zipfile, CONFIG.DataPath..'save/r.grp',CONFIG.DataPath..'save/d.grp',CONFIG.DataPath..'save/s.grp',CONFIG.DataPath..'save/tjm')
    os.remove(CONFIG.DataPath..'save/r.grp')
    os.remove(CONFIG.DataPath..'save/d.grp')
    os.remove(CONFIG.DataPath..'save/s.grp')
	os.remove(CONFIG.DataPath..'save/tjm');
    lib.Debug(string.format("SaveRecord time=%d",lib.GetTime()-t1));
end

-------------------------------------------------------------------------------------
-----------------------------------?¡§??????-------------------------------------------

function filelength(filename)         --?????????¡è??
	SetS(40, 11, 33, 3, 58)
	instruct_3(40, 58, 1, 0, 10086, 0, 0, 7266, 7266, 7266, 0, 0, 0)
    local inp=io.open(filename,"rb");
	if inp == nil then
        return -1
    end
    local l= inp:seek("end");
	inp:close();
    return l;
end

--??S??????, (x,y) ¡Á?????level ?? 0-5
function GetS(id,x,y,level)       --??S??????
	return lib.GetS(id,x,y,level);
end

--??S??
function SetS(id,x,y,level,v)       --??S??
	lib.SetS(id,x,y,level,v);
end

--??D*
--sceneid ???¡ã??????
--id D*????
--??????????????, 0-10
function GetD(Sceneid,id,i)          --??D*
    return lib.GetD(Sceneid,id,i);
end

--??D??
function SetD(Sceneid,id,i,v)         --??D??
	lib.SetD(Sceneid,id,i,v);
end

--?????????¨¢????¡¦???????
--data ????????¡Á¨¦
--offset data????????
--t_struct ???????¨¢??????jyconst?????????¡§??
--key  ¡¦?????key
function GetDataFromStruct(data,offset,t_struct,key)  --?????????¨¢????¡¦???????????????????
    local t=t_struct[key];
	local r;
	if t[2]==0 then
		r=Byte.get16(data,t[1]+offset);
	elseif t[2]==1 then
		r=Byte.getu16(data,t[1]+offset);
	elseif t[2]==2 then
		if CC.SrcCharSet==0 then
			r=lib.CharSet(Byte.getstr(data,t[1]+offset,t[3]),0);
		else
			r=Byte.getstr(data,t[1]+offset,t[3]);
		end
	end
	return r;
end

function SetDataFromStruct(data,offset,t_struct,key,v)  --?????????¨¢????¡¦?????????????????
    local t=t_struct[key];
	if t[2]==0 then
		Byte.set16(data,t[1]+offset,v);
	elseif t[2]==1 then
		Byte.setu16(data,t[1]+offset,v);
	elseif t[2]==2 then
		local s;
		if CC.SrcCharSet==0 then
			s=lib.CharSet(v,1);
		else
			s=v;
		end
		Byte.setstr(data,t[1]+offset,t[3],s);
	end
end

--¡ã???t_struct ?¡§?????¨¢??¡ã???????data???????????????¨ªt??
function LoadData(t,t_struct,data)        --data???????????????¨ªt??
    for k,v in pairs(t_struct) do
        if v[2]==0 then
            t[k]=Byte.get16(data,v[1]);
        elseif v[2]==1 then
            t[k]=Byte.getu16(data,v[1]);
		elseif v[2]==2 then
            if CC.SrcCharSet==0 then
                t[k]=lib.CharSet(Byte.getstr(data,v[1],v[3]),0);
		    else
		        t[k]=Byte.getstr(data,v[1],v[3]);
		    end
		end
	end
end

--¡ã???t_struct ?¡§?????¨¢??¡ã?????????data Byte??¡Á¨¦????
function SaveData(t,t_struct,data)      --????????data Byte??¡Á¨¦????
    for k,v in pairs(t_struct) do
        if v[2]==0 then
            Byte.set16(data,v[1],t[k]);
		elseif v[2]==1 then
            Byte.setu16(data,v[1],t[k]);
		elseif v[2]==2 then
		    local s;
			if CC.SrcCharSet==0 then
			    s=lib.CharSet(t[k],1);
            else
			    s=t[k];
		    end
            Byte.setstr(data,v[1],v[3],s);
		end
	end
end

--????x??¡¦??¡ì
function limitX(x,minv,maxv)
	if maxv == nil then
		if x < minv then
		    x = minv;
		end
	else
		if x < minv then
		    x = minv;
		end		
		if maxv ~= nil and x > maxv then
		    x = maxv;
		end
	end	
	return x
end

function RGB(r,g,b)          --????????RGB
	return r*65536+g*256+b;
end

function GetRGB(color)      --¡¦?????????RGB¡¦???
    color=color%(65536*256);
    local r=math.floor(color/65536);
    color=color%65536;
    local g=math.floor(color/256);
    local b=color%256;
    return r,g,b
end

--?????¨¹??????
function WaitKey(flag)
	--ktype  1???¨¹????2???¨®????????3:?¨®??¡Á¨®?¨¹??4???¨®?????¨¹??5???¨®?????¨¹??6??????????7????????
	local key, ktype, mx, my=-1,-1,-1,-1;
	while true do
		if JY.Restart == 1 then
			break
		end
		key, ktype, mx, my=lib.GetKey();
		if ktype == nil then
			ktype, mx, my=-1,-1,-1;
		end
		if ktype ~=-1 or key ~= -1 then
			if (flag == nil or flag == 0) and ktype ~= 2 then
				break;
			elseif flag ~= nil and flag ~= 0 then
				break;
			end
		end
		lib.Delay(CC.Frame/2);
	end
	return key, ktype, mx, my;
end

--?????????????¡ã??¡ã¡Á??¡¦??¨¾??????¡ã???
function DrawBox(x1, y1, x2, y2, color)
	local s = 4
	lib.Background(x1 + 4, y1, x2 - 4, y1 + s, 88)
	lib.Background(x1 + 1, y1 + 1, x1 + s, y1 + s, 88)
	lib.Background(x2 - s, y1 + 1, x2 - 1, y1 + s, 88)
	lib.Background(x1, y1 + 4, x2, y2 - 4, 88)
	lib.Background(x1 + 1, y2 - s, x1 + s, y2 - 1, 88)
	lib.Background(x2 - s, y2 - s, x2 - 1, y2 - 1, 88)
	lib.Background(x1 + 4, y2 - s, x2 - 4, y2, 88)
	local r, g, b = GetRGB(color)
	DrawBox_1(x1 + 1, y1 + 1, x2, y2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
	DrawBox_1(x1, y1, x2 - 1, y2 - 1, color)
end

--?????????????¡ã??¡ã¡Á??¡¦??¨¾??????¡ã???
function DrawBox_1(x1, y1, x2, y2, color)
	local s = 4
	lib.DrawRect(x1 + s, y1, x2 - s, y1, color)
	lib.DrawRect(x1 + s, y2, x2 - s, y2, color)
	lib.DrawRect(x1, y1 + s, x1, y2 - s, color)
	lib.DrawRect(x2, y1 + s, x2, y2 - s, color)
	lib.DrawRect(x1 + 2, y1 + 1, x1 + s - 1, y1 + 1, color)
	lib.DrawRect(x1 + 1, y1 + 2, x1 + 1, y1 + s - 1, color)
	lib.DrawRect(x2 - s + 1, y1 + 1, x2 - 2, y1 + 1, color)
	lib.DrawRect(x2 - 1, y1 + 2, x2 - 1, y1 + s - 1, color)
	lib.DrawRect(x1 + 2, y2 - 1, x1 + s - 1, y2 - 1, color)
	lib.DrawRect(x1 + 1, y2 - s + 1, x1 + 1, y2 - 2, color)
	lib.DrawRect(x2 - s + 1, y2 - 1, x2 - 2, y2 - 1, color)
	lib.DrawRect(x2 - 1, y2 - s + 1, x2 - 1, y2 - 2, color)
end

--???????¡ã¡Á?¡¦???
function DrawString(x,y,str,color,size)         --???????¡ã¡Á?¡¦???
	if x==-1 and str ~= nil then
		local ll=#str;
		local w=size*ll/2+2*CC.MenuBorderPixel;
		x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end
	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
    if x ~= -1 and y ~= -1 then
		lib.DrawStr(x,y,str,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
	else
		do return end
	end	
end

--???????¨¾??¡Á?¡¦???
--(x,y) ¡Á?????????????-1,?¨¾??????????????
function DrawStrBox(x,y,str,color,size,boxcolor)         --???????¨¾??¡Á?¡¦???
    local ll=#str;
    local w=size*ll/2+2*CC.MenuBorderPixel;
	local h=size+2*CC.MenuBorderPixel;
	if boxcolor == nil then
		boxcolor = C_WHITE
	end
	if x==-1 then
        x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end
	if y==-1 then
        y=(CC.ScreenH-size-2*CC.MenuBorderPixel)/2;
	end
    
   DrawBox(x,y,x+w-1,y+h-1,boxcolor);
    DrawString(x+CC.MenuBorderPixel,y+CC.MenuBorderPixel,str,color,size);
end

--????????????????????¡Á??????¡ì??
function DrawStrBox3(x, y, s, color, size, flag)         --???????¨¾??¡Á?¡¦???
    local ll=#s -flag*2;
    local w=size*ll/2+2*CC.MenuBorderPixel;
	local h=size+2*CC.MenuBorderPixel;
	local function strcolor_switch(s)
		local Color_Switch={{"??",C_RED},{"??",C_GOLD},{"??",C_BLACK},{"?¡Á",C_WHITE},{"??",C_ORANGE}}
		local Numbers = {{"1",10},{"2",15},{"3",15},{"4",15},{"5",15},{"6",15},{"7",15},{"8",15},{"9",15},{"0",15}}
		for i = 1, 5 do
			if Color_Switch[i][1] == s then
				return 1, Color_Switch[i][2]
			end
		end
		for i = 1, 10 do
			if Numbers[i][1] == s then
				return 2, Numbers[i][2]
			end
		end
		return 0
	end
	
	if x==-1 then
        x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end
	if y==-1 then
        y=(CC.ScreenH-size-2*CC.MenuBorderPixel)/2;
	end
	
	--??????????¡¦??¨¾???? 7-31
    DrawBox(x,y,x+w-1,y+h-1,LimeGreen);
	local space = 0;
	while string.len(s) >= 1 do
		local str
		str=string.sub(s,1,1)
		if string.byte(s,1,1) > 127 then		--????????¡Á?¡¦?
			str=string.sub(s,1,2)
			s=string.sub(s,3,-1)
		else
			str=string.sub(s,1,1)
			s=string.sub(s,2,-1)
		end
		local cs,cs2 = strcolor_switch(str)
		if cs == 1 then
			color = cs2
		elseif cs == 2 then
			DrawString(x+CC.MenuBorderPixel+space,y+CC.MenuBorderPixel,str,color,size);
			space = space + cs2;
		else
			DrawString(x+CC.MenuBorderPixel+space,y+CC.MenuBorderPixel,str,color,size);
			space = space + size;
		end
	end
end

--??????????Y/N?????????¡ÂY???¨¾¡¦???true, N?¨¾¡¦???false
--(x,y) ¡Á?????????????-1,?¨¾??????????????
--????????????????¡¦¨½
function DrawStrBoxYesNo(x, y, str, color, size, boxcolor)
	if JY.Restart == 1 then
		return
	end
	lib.GetKey()
	local ll = #str
	local w = size * ll / 2 + 2 * CC.MenuBorderPixel
	local h = size + 2 * CC.MenuBorderPixel
	if x == -1 then
		x = (CC.ScreenW - size / 2 * ll - 2 * CC.MenuBorderPixel) / 2
	end
	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
	Cls();
	DrawStrBox(x, y, str, color, size, boxcolor)
	local menu = {
	{"?¡¦?¡§/??", nil, 1}, 
	{"????/¡¦¨½", nil, 2}}
	local r = ShowMenu(menu, 2, 0, x + w - 4 * size - 2 * CC.MenuBorderPixel, y + h + CC.MenuBorderPixel, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE)
	if r == 1 then
		return true
	else
		return false
	end
end

--????¡Á?¡¦??????????¡Â?¨¹??¡Á?¡¦??????¨¾????????????????
function DrawStrBoxWaitKey(s,color,size,flag,boxcolor)
	if JY.Restart == 1 then
		return
	end
    lib.GetKey();
    Cls();
	--??????????¡¦???????
	if flag == nil then
		if boxcolor == nil then
			DrawStrBox(-1,-1,s,color,size);
		else
			DrawStrBox(-1,-1,s,color,size,boxcolor);
		end
	else
		DrawStrBox3(-1,-1,s,color,size,flag);
	end
    ShowScreen();
    WaitKey();
end

--¡¦??? [0 , i-1] ?????????¨²??
function Rnd(i)           --???¨²??
    local r=math.random(i);
    return r-1;
end

--????????????????????¡Á??¨®?????????¨¾????¡Á??¨®????????¡Á??????¨¾??????0
--id ????id
--str????¡Á?¡¦???
--value ?????????????????¨ª??????
--¡¦???1,????????????
--¡¦???2??¡Á?¡¦?????xxx ????/???? xxxx?????????????¡¦?¡ì??
function AddPersonAttrib(id, str, value)
	local oldvalue = JY.Person[id][str]
	local attribmax = math.huge
	if str == "?¨²?¨¹" then
		attribmax = JY.Person[id]["?¨²?¨¹¡Á??¨®??"]
	elseif str == "????" then
		attribmax = JY.Person[id]["????¡Á??¨®??"]
	elseif CC.PersonAttribMax[str] ~= nil then
		attribmax = CC.PersonAttribMax[str]
	end
	
	value = math.modf(value)
	
	if str == "????¡Á??¨®??" then
		local p_zz = JY.Person[id]["¡Á???"];
        local zz = 101 - JY.Person[id]["¡Á???"]
		local sz = {0.5,0.4,0.3,0.25,0.2,0.15,0.1}
		local jssz = sz[JY.Person[id]['????¡¦??¡Á']+1]
		local nd = JY.Base["????"]
		local mptype = (MPPD(id) or 0)
		if isteam(id) then
            attribmax = 1000
            attribmax = attribmax + zz * 40
        else
            attribmax = JY.Person[id]["????¡Á??¨®??"] + JY.Base["????"]*5*nd
        end
		
		--???????¡§?????????¨§??????¡Á????¡¦????
		if match_ID(id, 53) or match_ID(id, 114) or match_ID(id, 38) or match_ID(id, 116) 
		or match_ID(id, 638) or match_ID(id, 499) or match_ID(id, 529) or match_ID(id, 514) or match_ID(id, 520) then
			attribmax = 9999
		end
		--????¡¦¨¢
		if match_ID(id, 5) then
			attribmax = 8000
		end
		--??????
		if match_ID(id, 774) then
			attribmax = 9999
		end
		if match_ID(id,9893) then --?¨§????
			attribmax = attribmax + 1500
		end	
		if match_ID(id,9999) or match_ID(id,9740) then --?¨§????
			attribmax = attribmax + 1000
		end
		if match_ID(id,9725) then
			attribmax = attribmax + 2000
		end
		--????????????????3000
		if MPTX(id,7) then
			attribmax = attribmax + 3000
		end 
		
		--?????¨®??????????2500
		if MPTX(id,22) then
			attribmax = attribmax + 2500
		end 	
		
		--?¡è?¨²??¡Á??¨¹??????????????2000
		if MPTX(id,25,4) then
			attribmax = attribmax + 2000
		end 	 
		
		--??????????????1000
		if MPTX(id,28) then
			attribmax = attribmax + 1000
		end 	
		
		--?¨§?¨²??????????????2000
		if MPTX(id,30) then
			attribmax = attribmax + 2000
		end 	
		
		--?¨½¡Á??¡è?¡è
		if NGQH(id,233) then
			attribmax = attribmax + 2000
		end 	
		
		--?¡ì??????????¡¦?800????????
		if Num_of_Neigong(id) == 1 then
			attribmax = attribmax + 800	
		--?¡ì??????????¡¦?1600????????
		elseif Num_of_Neigong(id) == 2 then
			attribmax = attribmax + 1600
		--?¡ì??????????¡¦?2400????????
		elseif Num_of_Neigong(id) == 3 then
			attribmax = attribmax + 2400
		--?¡ì??????????¡¦?3200????????
		elseif Num_of_Neigong(id) == 4 then
			attribmax = attribmax + 3200
		--?¡ì??????????????¡¦?4000????????
		elseif Num_of_Neigong(id) > 4 then
			attribmax = attribmax + 4000
		end
		--?¡ì?????¡è?¨¾?¨¹????+500
		for i = 1, JY.Base["????????"] do
			if JY.Person[id]["????" .. i] == 85 or JY.Person[id]["????" .. i] == 88 then
				attribmax = attribmax + 500
				break
			end
		end
		--??????????????
		if match_ID(id, 58) then
			attribmax = attribmax - JY.Person[300]["????"] * 1000
		end
		if MPPD(id) > 0 then
			attribmax = math.modf((CC.MPAttrib[mptype][9])* attribmax)
		end
		
		--????????2999??????9999
		if attribmax < 2999 then
			attribmax = 2999
		end
		if actor(id,6) then
			if attribmax < 4999 then
				attribmax = 4999
			end
		end
		if attribmax > 10000 then
			attribmax = 10000
		end
    end	
    
	--???¨¦???????¨²????????????????600
	if str == "????????" and (match_ID(id, 2) or match_ID(id, 83) or match_ID(id, 17)) then
		attribmax = 600
	end
	--??¡¦?????????500
	if str == "????????" and match_ID(id, 25) then
		attribmax = 500
	end
	--?¨²????????????????????????600
	if str == "????????" and (match_ID(id, 16) or match_ID(id, 28) or match_ID(id, 45)) then
		attribmax = 600
	end
	--???????????¨¦??????500
	if str == "????????" and (match_ID(id, 85) or match_ID(id, 2)) then
		attribmax = 500
	end
	--???¡Â???¨²??????????????500
	if (str == "????????" or str == "????????") and id == 0 and JY.Base["??¡Á?"] == 8 then
		attribmax = 500
	end
	--???¡Â??????????600
	if str == "????????" and id == 0 and JY.Base["??¡Á?"] == 9 then
		attribmax = 600
	end
	--??????????????????400
	if (str == "????????" or str == "????????") and match_ID(id, 4) then
		attribmax = 400
	end
	--???????????¨®???¡Â????????
	if JXPD(id,75,1)  and (str == "??????¡¦¨¾" or str == "??¡¦¡§????" or str == "????????" or str == "????????" or str == "???????¡Â") then
		attribmax = 9999
	end	
		 
    --???¡¦????????¡¦¡§????????¡Á???
    if JY.Status == GAME_WMAP then 
	    if str == '?¨²?¨¹' then
			if value > 0 then
				if NGQH(id,203) and (WAR.PD['?¡è?¨²????'][id] or 0) > 0 then
					value = value * 2
					if psx(id,'?¨²?¨¹') + value >= psx(id,'?¨²?¨¹¡Á??¨®??') then
						WAR.QSZQ = WAR.QSZQ + 0.2
					end	
				end	
				if WAR.PD['???¨²????'][id] ~= nil and WAR.PD['???¨²????'][id] > 0 then
					local sm = psx(id,'?¨²?¨¹¡Á??¨®??') - (WAR.PD['???¨²????'][id] or 0) * 10
					if psx(id,'?¨²?¨¹') + value > sm then
						value = psx(id,'?¨²?¨¹') - sm
					end
				end
				--???¨½
				if match_ID(id,524) then
					local tl = (200-JY.Person[id]["????"])/80
					value = math.modf(value*tl)
				end
				--????¡¦¨¢????
				if JXPD(id,5,1) and JY.Person[id]["?¨²?¨¹"] <= (JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/2) then
					if value < math.modf(JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/50) then
						value = math.modf(JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/50)
					end
				end
				if WAR.PD['???¨¹?¡§'][id] ~= nil and WAR.PD['???¨¹?¡§'][id] > 0 then
					local jm = 10 - (WAR.PD['???¨¹?¡§'][id] or 0)
					value =  math.modf(value*jm)
				end
				if WAR.LXQJ[200+id] ~= nil then
					WAR.LXQJ[200+id] = (WAR.LXQJ[200+id] or 0) + value
					if WAR.LXQJ[200+id] > 2000 then
						WAR.LXQJ[200+id] = 2000
					end
				end
				if WAR.HYDJ[200+id] ~= nil then
					WAR.HYDJ[200+id] = (WAR.HYDJ[200+id] or 0) + value
					if WAR.HYDJ[200+id] > 2000 then
						WAR.HYDJ[200+id] = 2000
					end
				end
				--????????
				if WAR.PD['??????'][id] ~= nil then
					local zd = (300-JY.Person[id]["????????"])/400
					value = math.modf(value*zd)
				end
				if WAR.PD['?¨¦?¡ã????2'][id] ~= nil then
					if JY.Base['????'] == 457 then
						JY.Person[0]['?¨²?¨¹'] = limitX(JY.Person[0]['?¨²?¨¹'] + value,0,JY.Person[0]['?¨²?¨¹¡Á??¨®??'])
					else
						JY.Person[457]['?¨²?¨¹'] = limitX(JY.Person[457]['?¨²?¨¹'] + value,0,JY.Person[457]['?¨²?¨¹¡Á??¨®??'])	
					end
				end		
				if value >= 250 and WAR.PD['??????????'][id] ~= nil then
					WAR.PD['??????????'][id] = WAR.PD['??????????'][id] -1
					if WAR.PD['??????????'][id] < 1 then
						WAR.PD['??????????'][id] = nil
					end
				end	
				if NGQH(id,203) == false then
					if WAR.PD['?¨½??????'][id] ~= nil then
						value = 0
					end
					if (WAR.PD['????'][id] ~= nil or WAR.PD['?¨²?¨¹????????'][id] ~= nil or JY.Person[id]["?¨²?¨¹"] <= 0) then 
						value = 0
					end
					if WAR.PD['????¡Á???'][id] ~= nil and JY.Person[id]["?¨²?¨¹"] >= math.modf(JY.Person[id]["?¨²?¨¹¡Á??¨®??"]*0.5) then
						value = 0
					end	
				end	
				if WAR.PD['???¨¢????'][id] ~= nil then
					value = 0
				end
				if WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
					value = 0
				end
				if WAR.PD['?¡Á??????2'][id] == 5 and psx(id,'?¨²?¨¹') > 1000 then
					value = 0
				end
				value = limitX(value,0,math.abs(value))
			elseif value < 0 then
				if WAR.PD['?????¡è??'][id] ~= nil and Curr_NG(id,184) and PersonKF(id,184) then
					WAR.PD['?????¡è??'][id] = (WAR.PD['?????¡è??'][id] or 0) - math.modf(value*0.25)
				end
				if WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
					local qz = WAR.PD['????????'][id]/5
					value = math.modf((1+qz)*value)
				end
				if WAR.PD['???????¡Â'][id] == 1 and JY.Person[id]['?¨²?¨¹'] < 2000 then
					if match_ID(id,517) then
						value = 0
					else
					    value = math.modf(value/10)
					end
				end
				if NGQH(id,160) and WAR.PD['?¨§?¡ì???¨ª'][id] ~= nil and WAR.PD['?¨§?¡ì???¨ª'][id] > 50 then
					value = 0
				end
				if MPTX(id,16) and WAR.PD['???¨§?¡è??'][id] ~= nil and WAR.PD['???¨§?¡è??'][id] > 0 and NGQH(id,100) then
					local a = math.abs(value)
					local b = WAR.PD['???¨§?¡è??'][id]
					value = value + WAR.PD['???¨§?¡è??'][id]
					if a >= b then
						WAR.PD['???¨§?¡è??'][id] = nil
					else
						WAR.PD['???¨§?¡è??'][id] = b-a
					end		
				end	
				if  WAR.PD['???¡Â??'][id] ~= nil and (MPTX(id,24,4) or match_ID(id,525)) then
					local dj = MPDJ(id)
					if MPDJ(id) == nil or MPDJ(id) < 1 then
						dj = 4
					end	
					if JLSD(0,dj*15,id) then
						value = 0
					end	
				end	
				if match_ID(id,501) and (WAR.JBMY[id] or 0) > 15 and WAR.JBMY[id] ~= nil then
					value = 0
				end
				if (match_ID(id,760) or match_ID(id,771) or match_ID(id,772) or match_ID(id,773) or match_ID(id,774)) and WAR.SXTJ <= 40 then
					value = 0
				end	
				--?¡¦??
				if (match_ID(id,767) or match_ID(id,768) or match_ID(id,769) or match_ID(id,770)) and (JLSD(20,55,id) or WAR.SXTJ <= 20) then
					value = 0
				end	
				if WAR.PD['??????'][id] ~= nil and WAR.PD['??????'][id] > 0 and JLSD(10,50,id) then
					value = 0
				end
				if WAR.PD['????'][id] ~= nil and WAR.PD['????'][id] > 0 then
					value = 0
				end
				if WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
					value = 0
				end
				if NGQHB(id,180) and WAR.PD['?¡§??????'][id] ~= nil and WAR.PD['?¡§??????'][id] == 1 then
					value = 0
				end
				--?????¨²???¨§
				if MPTX(id,23,4) and ZYJQ(id) then
					value = 0
				end
				if MPTX(id,23,4) and JY.Person[id]["?¨²?¨¹"] < JY.Person[id]["?¨²?¨¹¡Á??¨®??"]*0.3 and WAR.PD['?¨²???¨§'][id] ~= 1 then
					value = 0
				end
				if match_ID(id,520) and WAR.PD['???¨§????'][id] ~= nil and WAR.PD['???¨§????'][id] > 0 then
					if value <= -30 then
						value = -30
					end	
				end
				if (match_ID(id,754) or MPTX(id,26,3)) and WAR.PD['???¨²????'][id] ~= nil and WAR.PD['???¨²????'][id] > 0 then
					if value <= -50 then
						value = -50
					end	
				end
				if NGQH(id,233) and WAR.PD['?¨½¡Á????¡è'][id] ~= nil and WAR.PD['?¨½¡Á????¡è'][id] > 0 then
					if value <= -300 then
						value = -300
					end	
				end
				if WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
					local qz = WAR.PD['????????'][id]
					if value < -qz then
						value = -qz
					end
				end
				if match_ID(id,92) and WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
					value = math.modf(value/((WAR.PD['????????'][id] or 0)*2+2))
				end	
				if NGQH(id,106) and (WAR.PD['?????¡è??'][id] or 0) > 0 then
					local a = WAR.PD['?????¡è??'][id]
					value = math.modf(value/a)
				end
				if WAR.PD['???¨¹?¡§'][id] ~= nil and WAR.PD['???¨¹?¡§'][id] == 1 and match_ID(id,456) then
					if value < -math.modf(JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/9) then
						value = -99
					end	
				end
				if WAR.PD['???¨¹?¡§'][id] ~= nil and WAR.PD['???¨¹?¡§'][id] > 0 then
					local jm = 10 - (WAR.PD['???¨¹?¡§'][id] or 0)
					value =  math.modf(value/jm)
				end
				if WAR.PD['?????¨®'][id] == 1 then
					value = math.modf(value*1.5)
					WAR.PD['??¡Á???'][id] = (WAR.PD['??¡Á???'][id] or 0) - math.modf(value*0.5)
					if WAR.PD['??¡Á???'][id] > 10000 then
						WAR.PD['??¡Á???'][id] = 10000
					end
				end
				
				if WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and match_ID(id,456) then
					value = math.modf(value * (-0.2))
				end
				--????¡¦¨¢????
				if JXPD(id,5,1) and JY.Person[id]["?¨²?¨¹"] > (JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/2) then
					local sm = math.modf(JY.Person[id]["?¨²?¨¹"]/8)
					if sm < 888 then
						sm = 888
					end
					if value <= -sm then
						value = -sm
					end	
				end
				--????¡¦¨¢????
				if JXPD(id,5,1) and JY.Person[id]["?¨²?¨¹"] <= (JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/2) then
					if value < -math.modf(JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/10) then
						value = -math.modf(JY.Person[id]["?¨²?¨¹¡Á??¨®??"]/10)
					end
				end
				if WAR.PD['???????¡Á'][id] ~= nil and WAR.PD['???????¡Á'][id] == 1 then
					local aa = 5 - JY.Person[id]['????¡¦??¡Á']
					value = math.modf(value/aa)
				end
				--???¨½
				if match_ID(id,524) then
					local tl = JY.Person[id]["????"]/100
					value = math.modf(value*tl)
				end
				if NGQHB(id,180) and WAR.PD['?¡§??????'][id] ~= nil and WAR.PD['?¡§??????'][id] == 2 then
					value = math.modf(value*0.7)
				end
				value = limitX(value,value,0)
				if PersonKF(id,360) and Curr_NG(id,93) then
					local a = math.abs(value)
					WAR.PD['?????????¨²??'][id] = (WAR.PD['?????????¨²??'][id] or 0) + a
				end	
				if WAR.PD['????'][id] ~= nil and WAR.PD['????'][id] == 1 then
					value = 100
				end
				
 			end	
        end
		if str == '????' then
			if value > 0 then
				if WAR.PD['????'][id] ~= nil or WAR.PD['????????5'][id] ~= nil or WAR.PD['????????????'][id] ~= nil or (WAR.PD['????¡Á???'][id] ~= nil and JY.Person[id]["????"] >= math.modf(JY.Person[id]["????¡Á??¨®??"]*0.5)) then
					if NGQH(id,203) == false then
						value = 0
					else
					    value = math.modf(value/3)
					end
				end
				--????????
				if WAR.PD['??????'][id] ~= nil then
					local zd = (300-JY.Person[id]["????????"])/400
					value = math.modf(value*zd)
				end
				if WAR.PD['???¨²????'][id] ~= nil and WAR.PD['???¨²????'][id] > 0 then
					local nl = psx(id,'????¡Á??¨®??') - (WAR.PD['???¨²????'][id] or 0) * 10
					if psx(id,'????') + value > nl then
						value = psx(id,'????') - nl
					end
				end
				if WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
					value = math.modf(value * (-0.2))
				end
				
				if WAR.PD['?¨¦?¡ã????2'][id] ~= nil then
					if JY.Base['????'] == 457 then
						JY.Person[0]['????'] = limitX(JY.Person[0]['????'] + value,0,JY.Person[0]['????¡Á??¨®??'])
					else
						JY.Person[457]['????'] = limitX(JY.Person[457]['????'] + value,0,JY.Person[457]['????¡Á??¨®??'])	
					end
				end	
				if NGQH(id,227) and psx(id,'????') >= math.modf(psx(id,'????¡Á??¨®??')*0.5) then
					WAR.PD['?¨¾¨®?????'][id] = (WAR.PD['?¨¾¨®?????'][id] or 0) + math.modf(value*0.5)
				end	
			elseif value < 0 then
				if NGQH(id,108) and JY.Person[id]['?¨²?¨¹'] > 1 then
					local a = math.abs(math.modf(value*0.5))
					local b = math.modf(JY.Person[id]["?¨²?¨¹¡Á??¨®??"]*0.7)
					value = value + a
					WAR.PD['?¡Á??????'][id] = limitX((WAR.PD['?¡Á??????'][id] or 0) + a,0,b)
				end
				if WAR.PD['???????¡Â'][id] == 1 and JY.Person[id]['????'] < 2000 then
					if match_ID(id,517) then
						value = 0
					else
					    value = math.modf(value/10)
					end
				end
				if WAR.PD['???????¨½'][id] == 1 and psx(id,'?¨²?¨¹') > 0 then
					value = 0
				end
				if WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
					value = 0
				end
				if WAR.PD['???????¡Á'][id] ~= nil and WAR.PD['???????¡Á'][id] == 1 then
					local aa = 5 - JY.Person[id]['????¡¦??¡Á']
					value = math.modf(value/aa)
				end
				if match_ID(id,501) and (WAR.JBMY[id] or 0) > 15 and WAR.JBMY[id] ~= nil then
					value = 0
				end	
			end	
		end
		if str == '????' then
			if value > 0 then
				if WAR.PD['????'][id] ~= nil or WAR.PD['????'][id] ~= nil or (WAR.PD['????¡Á???'][id] ~= nil and JY.Person[id]["????"] >= 50) then
					if NGQH(id,203) == false then
						value = 0
					else
					    value = math.modf(value/2)
					end
				end
				if WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
					value = math.modf(value * (-0.2))
				end
				if WAR.PD['???¨²????'][id] ~= nil and WAR.PD['???¨²????'][id] > 0 then
					local sm = 100 - (WAR.PD['???¨²????'][id] or 0)
					if JY.Person[id]['????'] + value > sm then
						value = JY.Person[id]['????'] - sm
					end
				end
			elseif value < 0 then
				if match_ID(id,9849) then
					if value <= -9 then
						value = -9
					else
						value = -1
					end
				end
				if WAR.PD['???????¨½'][id] == 1 and psx(id,'?¨²?¨¹') > 0 then
					value = 0
				end
				if match_ID(id,501) and (WAR.JBMY[id] or 0) > 15 and WAR.JBMY[id] ~= nil then
					value = 0
				end
				if WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
					value = 0
				end
				if WAR.PD['???????¡Â'][id] == 1 and JY.Person[id]['????'] < 20 then
					if match_ID(id,517) then
						value = 0
					else
					    value = math.modf(value/10)
					end
				end
				if WAR.PD['???????¡Á'][id] ~= nil and WAR.PD['???????¡Á'][id] == 1 then
					local aa = 5 - JY.Person[id]['????¡¦??¡Á']
					value = math.modf(value/aa)
				end
				if WAR.PD['?¨¦?¡ã????2'][id] ~= nil or WAR.PD['????'][id] ~= nil then
					value = math.modf(value*2)
				end
			end	
		end
        --????
		if str == '????????' then	
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['?¨²¡Á???'][id] ~= nil then
				attribmax = 300
			end	
			if (id == 0 and JY.Base['??¡Á?'] == 9) or MPTX(id,1) or MPTX(id,8) or WAR.PD['????????'][id] ~= nil then 
				if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['??¡Á?????'][id] ~= nil then
					value = value * 2
				end	
				value = zdkx(id,value)
				if myzd(id) then
					value = 0
				end	
			end	
		end	
		--????
		if str == '????????' then
			if PersonKF(id,91) then
				attribmax = 50
			end
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.YJZD1[id] ~= nil then
		        attribmax = 300
	        end	
			if (MPTX(id,8) and PersonKF(id,150)) or WAR.PD['????????'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['??¡Á?????'][id] ~= nil then
					value = value * 2
				end
				value = nskx(id,value)
				if myns(id) then
					value = 0
				end	
			end	
		end	
		--¡Á???
		if str == '¡Á???????' then
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['¡¦??¡Á????'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if PersonKF(id,13) and PersonKF(id,196) and WAR.PD['???¨²??'][id] ~= nil then
					WAR.PD['???¨²??'][id] = limitX(WAR.PD['???¨²??'][id] + math.modf(value*0.5),0,3000)
				end	
				if WAR.PD['??¡Á?????'][id] ~= nil then
					value = value * 2
				end
				value = zskx(id,value)
				if myzs(id) then
					value = 0
				end
			else
				if PersonKF(id,13) and PersonKF(id,196) and WAR.PD['???¨²??'][id] ~= nil then
					WAR.PD['???¨²??'][id] = limitX(WAR.PD['???¨²??'][id] + math.abs(math.modf(value*0.5)),0,3000)
				end
				if match_ID(id,525) then
					value = 0
				end
				if JY.Status == GAME_WMAP and WAR.CHLY == 1 then--?????¨§?¨¾
					value = 0
				end		
			end
		end
		--??¡¦?
		if str == '??¡¦?????' then
			--????¡Á???¡¦?????????
			if WAR.PD['??????¡¦?'][id] ~= nil then
				attribmax = 500
			end
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if MPTX(id,20) or WAR.PD['????????'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['??¡Á?????'][id] ~= nil then
					value = value * 2
				end
				value = bfkx(id,value)
				if mybf(id) then
					value = 0
				end
				if JY.Status == GAME_WMAP then
					if WAR.PD['?¡Á??????'][id] == 2 or WAR.PD['?¡Á??????'][id] == 5 then
						AddPersonAttrib(id,'????????',value)
						AddPersonAttrib(id,'¡Á???????',value)
					end	
					if WAR.PD['?¡Á??????'][id] == 3 or WAR.PD['?¡Á??????'][id] == 5 then
						AddPersonAttrib(id,'?¡Â??????',value)
						local ws = {'????????','¡ã??????¨¹','????????','????????','????????','¡¦???????'}
						WAR.PD[ws[math.random(6)]][id] = 1
					end	
					if WAR.PD['?¡Á??????'][id] == 4 or WAR.PD['?¡Á??????'][id] == 5 then
						AddPersonAttrib(id,'????????',value)
						AddPersonAttrib(id,'¡¦??¡§????',value)
					end	
				end	
			end
			if value < 0 then
				if WAR.PD['???¡è????'][id] ~= nil or WAR.PD['???¡è????1'][id] ~= nil then
					value = value*0.5
				end
			end
		end	
		--¡¦??¡§
		if str == "¡¦??¡§????" then
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['???¡§?¨®??1'][id] ~= nil or WAR.PD['???¡§?¨®??2'][id] ~= nil then
				attribmax = 70
			end
			if WAR.PD['???¡§?¨®??3'][id] ~= nil then
				attribmax = 100
			end	
			if value > 0 then
				if WAR.PD['???¡§?¨®??1'][id] ~= nil or WAR.PD['???¡§?¨®??2'][id] ~= nil then
					value = math.modf(value * 1.5)
				end
				if WAR.PD['???¡§?¨®??3'][id] ~= nil then
					value = value * 2
				end
				if WAR.PD['??¡Á?????'][id] ~= nil then
					value = value * 2
				end
				value = fxkx(id,value)
				if JY.Status == GAME_WMAP and myfx(id) then
					if MPTX(id,8,3) and Curr_NG(id,104) then
					else
					    value = 0
					end
				end
			end
			if value < 0 then
				if WAR.PD['???¡§?¨®??1'][id] ~= nil then
					if math.random(10) > 5 then
						value = 0
					else
						local a = math.abs(value)
						if myns(id) == false then
							a = nskx(id,a)
							JY.Person[id]["????????"] = limitX(JY.Person[id]["????????"] + a,0,100)
						end	
					end
				end	
				if WAR.PD['???¡§?¨®??2'][id] ~= nil then
					if math.random(10) > 5 then
						value = value*0.5
					else
						value = value*0.75
					end
				end
				if JY.Status == GAME_WMAP and MPTX(id,8,3) and Curr_NG(id,104) then
					value = - value
				end
				if JY.Status == GAME_WMAP and WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
					value = math.modf(value * (-0.2))
				end
			end		
		end
		--?¡Â??
		if str == "?¡Â??????" then
			if WAR.PD['????????'][id] ~= nil then
				attribmax = 300
			end
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['???¡Â????'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["??????????"][id] ~= nil and WAR.PD["??????????"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['??¡Á?????'][id] ~= nil then
					value = value * 2
				end
				value = lxkx(id,value)
				if mylx(id) then
					value = 0
				end
			end
		end		
	end
	
	local newvalue = limitX(oldvalue + value, 0, attribmax)
    JY.Person[id][str] = newvalue

    local tf = {9960,9959,9958,9957,9956}
    local jc = {"??????¡¦¨¾","??¡¦¡§????","????????","????????","???????¡Â"}

    if str == '????' then 
		if MPTX(id,23,3) and PersonKF(id,199) then --?????¨¢??
			attribmax = 800
		end
		if CC.PTF[id][9919] ~= nil then
			attribmax = 9999
		end
        if newvalue >= 500 then
            if id == 0 then
				for j = 1,#tf do 
					if CC.PTF[id][tf[j]] == 1 then 
						if JY.Person[id][jc[j]] >= 300 then 
							--CC.TG[tf[j]] = nil
							SetTF(id,tf[j],nil)
							SetTF(id,tf[j]-5,1)
						end
					end
				end
			else
				if CC.PTF[id] ~= nil then 
					for j = 1,#tf do 
						if CC.PTF[id][tf[j]] == 1 then 
							if JY.Person[id][jc[j]] >= 300 then 
								SetTF(id,tf[j],nil)
								SetTF(id,tf[j]-5,1)
							end
						end
					end
				end
			end	
        end
    end

    for j = 1,#jc do 
        if str == jc[j] then 
            if newvalue >= 300 and JY.Person[id]['????'] >= 500 then 
                if id == 0 then
					if CC.PTF[id][tf[j]] == 1 then 
						SetTF(id,tf[j],nil)
						SetTF(id,tf[j]-5,1)
					end
				else
					if CC.PTF[id] ~= nil then
						if CC.PTF[id][tf[j]] == 1 then 
							SetTF(id,tf[j],nil)
							SetTF(id,tf[j]-5,1)
						end
					end
				end	
            end
        end
    end

	local add = newvalue - oldvalue
	local showstr = ""
	if add > 0 then
		showstr = string.format("%s ???? %d", str, add)
	elseif add < 0 then
		showstr = string.format("%s ???? %d", str, -add)
	end
	return add, showstr
end

--??¡¦?midi
function PlayMIDI(id)             --??¡¦?midi
    JY.CurrentMIDI=id;
    if JY.EnableMusic==0 then
        return ;
    end
    if id>=0 then
        lib.PlayMIDI(string.format(CC.MIDIFile,id+1));
    end
end

--??¡¦????¡ìatk***
function PlayWavAtk(id)             --??¡¦????¡ìatk***
    if JY.EnableSound==0 then
        return ;
    end
    if id>=0 then
        lib.PlayWAV(string.format(CC.ATKFile,id));
    end
end

--??¡¦????¡ìe**
function PlayWavE(id)              --??¡¦????¡ìe**
    if JY.EnableSound==0 then
        return ;
    end
    if id>=0 then
        lib.PlayWAV(string.format(CC.EFile,id));
    end
end

--flag =0 or nil ????????????
--1 ?????????????¨§??????
function ShowScreen(flag)
	if JY.Darkness == 0 then
		if flag == nil then
			flag = 0
		end
		lib.ShowSurface(flag)
	end
end

--?¡§??????????
-- menuItem ?¨ª??????????????¡Á??¨ª?????????????????????¡§??
--          ???????¡§????  {   ItemName,     ??????????¡Á?¡¦???
--                          ItemFunction, ?????¡Â?????????????????¨¾??nil
--                          Visible       ??¡¦¨½????  0 ?????? 1 ????, 2 ??????¡Á¡Â?????¡ã???¨½????????????????2??
--                                        ?????¨¾????????????2?????????¨¾?????????????????¡ã???¨½????
--                                        ??????????¡¦????????¨¦???????????¡ì??
--                                        ???????¡ã????????¡¦¨½????????????¡¦¨½???¨¦??
--                       }
--          ?????¡Â?????????¡Â??         itemfunction(newmenu,id)
--
--       ¡¦?????
--              0 ????¡¦????????????????¡¦ 1 ?¡Â?????????¨®???????????????????????¡¦
--
-- numItem      ¡Á???????????
-- numShow      ??????????????????¡Á????????????????????????????¨¾?????¡§??????
--                =0?¨ª????????????????

-- (x1,y1),(x2,y2)  ???????¨¾??¡Á¨®????????????¡Á?????????x2,y2=0,?¨¾????¡Á?¡¦????¡è??????????????¡Á???????x2,y2
-- isBox        ??¡¦¨½???????¨¾??0 ????????1 ???????????????¨¾¡ã???(x1,y1,x2,y2)??????????¡ã¡Á??¡¦??¨¾??????¡¦??¨¾?????¡ã??¡ã?
-- isEsc        Esc?¨¹??¡¦¨½??¡Á¡Â?? 0 ????¡Á¡Â????1??¡Á¡Â??
-- Size         ??????¡Á????¨®??
-- color        ????????????????????RGB
-- selectColor  ??????????????,
--;
-- ¡¦?????  0 Esc¡¦???
--         >0 ????????????(1?¨ª????????)
--         <0 ???????????????¡Â?????????¨®????????????????????????????????

function ShowMenu(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--?????????????¡¦?¨§???¨¹???¨²???¡§
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "¡Á???" then
		In_Battle = true
	end
	--?????????????????????¡§
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "????" then
		In_Tactics = true
	end
	--???¨¹???????¡§
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "????" then
		In_Other = true
	end	
	--???????¡¦?????¨ª???????????¨§???¨¹
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
  
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    if isBox == 1 then
	      DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    end
  	end
	for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--?¨§???¨¹?¨¢??????
		if In_Battle == true then
			if newMenu[i][1] == "???¡Â" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¨¹" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¡¦???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
			if newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "????" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
			    elseif newMenu[i][1] == "????" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "???¡¦" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
			    elseif newMenu[i][1] == "¡Á???" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
				end
			end
		  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc ?¨¾ ????
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ?????????????¨¢??????BUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ?????????????¨¢??????BUG
				start = 1
			end
		--?????????????¡¦?¨§???¨¹
		--???¡Â
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9???????¡Â
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¨¹
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¡¦
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡Á???
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
				returnValue= -9;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????????
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C?¨¦??
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡¦???
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--????
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--?????¡¦??
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 2000 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					--??????????¡Á?
					elseif JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--????????????????¡¦???20¡Á¡Â?????¡§????
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --?¡Â??????????
			
					--????????????????????????¡¦?????????????????
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--????????????????¡¦???20¡Á¡Â?????¡§????
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end

--??????????ShowMenu??????????????????????¡Á??????¡Â
--menu ????????????????1??????2??????????3????¡¦???(0?????????¨½??1??????????2??????, 3???????????¨½)
--itemNum ?????????????¡§?????¡Â???????¨¾ #menu????????
--numShow ??????????????????
--showRow ????¡ã?????????¡Á??¨®??????????????????????????????????¡ã??????????????¨¢¡Á?????????????
--str ??????????¡Á?????nil??????
--??????
function ShowMenu2(menu,itemNum,numShow,showRow,x1,y1,x2,y2,isBox,isEsc,size,color,selectColor, str, selIndex)     --?¡§??????????
    local w=0;
    local h=0;   --???¨¾???¨ª??
    local i,j=0,0;
    local col=0;     --????????????????
    local row=0;
    
    lib.GetKey();
    Cls();
    
    --?¡§????????table
    local menuItem = {};
    local numItem = 0;                --??????¡Á???
    
    --¡ã???????????¡¦?¡¦?????table
    for i,v in pairs(menu) do
		if v[3] ~= 2 then
			numItem = numItem + 1;
			menuItem[numItem] = {v[1],v[2],v[3],i};                --¡Á?????4????????????i????
		end
    end
    
    --??????????????????????
    if numShow==0 or numShow > numItem then
        col=numItem;
        row = 1;
    else
        col=numShow;
        row = math.modf((numItem-1)/col);
    end
    
    if showRow > row + 1 then
		showRow = row + 1;
    end

    --???????¨¾?????¨ª??
    local maxlength=0;
    if x2==0 and y2==0 then
        for i=1,numItem do
            if string.len(menuItem[i][1])>maxlength then
                maxlength=string.len(menuItem[i][1]);
            end
        end
		w=(size*maxlength/2+CC.RowPixel)*col+2*CC.MenuBorderPixel;
		h=showRow*(size+CC.RowPixel) + 2*CC.MenuBorderPixel;
    else
        w=x2-x1;
        h=y2-y1;
    end
    
    if x1 == -1 then
    	x1 = (CC.ScreenW-w)/2;
    end
    if y1 == -1 then
    	y1 = (CC.ScreenH-h+size)/2;
    end

    local start=0;             --????????????

    local curx = 1;          --???¡ã???¨½??
    local cury = 0;
    local current = curx + cury*numShow;
    
    --??????????
    if selIndex ~= nil and selIndex > 0 then
    	current = selIndex;
    	curx = math.fmod((selIndex-1),numShow) + 1;
    	cury = (selIndex - curx)/numShow;
    	if cury >= showRow/2 then
			start = limitX(cury-showRow/2,0,row-showRow+1);
		end
    end
    
    local returnValue =0;
    if str ~= nil then
		DrawStrBox(-1, y1 - size - 2*CC.MenuBorderPixel, str, color, size)
    end
    local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	if isBox==1 then
		DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
	end
	while true do
		lib.GetKey()
		if JY.Restart == 1 then
			break
		end
		if col ~= 0 then
			lib.LoadSur(surid, 0, 0)
			if isBox == 1 then
				DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
			end
		end
        for i=start,showRow+start-1 do
			for j=1, col do
				local n = i*col+j;
				if n > numItem then
					break;
				end
				local drawColor=color;           --??????????????????
				if menuItem[n][3] == 0 or menuItem[n][3] == 3 then
					drawColor = M_DimGray
				end
				local xx = x1+(j-1)*(size*maxlength/2+CC.RowPixel) + CC.MenuBorderPixel
				local yy = y1+(i-start)*(size+CC.RowPixel) + CC.MenuBorderPixel
				if n==current then
					drawColor=selectColor;
					lib.Background(xx, yy, xx + size*maxlength/2, yy + size, 128, color)
				end
				DrawString(xx,yy,menuItem[n][1],drawColor,size);
			end
		end
		ShowScreen();
		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame);

		if keyPress==VK_ESCAPE or ktype == 4 then                  --Esc ????
			if isEsc==1 then
				--break;
				do return end
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			if curx + (cury+1)*col <= numItem then
				cury = cury + 1;
				if cury > row then
					cury = row;
				elseif cury >= showRow/2 and cury <= row - showRow/2 + 1 and start <= row-showRow  then
					start = start + 1;
				end
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			cury = cury -1;
			if cury < 0 then
				cury = 0;
			elseif cury >= showRow/2-1 and cury < row - showRow/2 and start > 0 then
				start = start - 1;
			end
		elseif keyPress==VK_RIGHT then                --RIGHT
			curx = curx +1;
			if curx > col then
				curx = 1;
			elseif curx + cury*col > numItem then
				curx = 1;
			end
		elseif keyPress==VK_LEFT then                  --LEFT
			curx = curx -1;
			if curx < 1 then
				curx = col;
				if curx + cury*col > numItem then
					curx = numItem - cury*col;
				end
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--????
				--?????????????????????¡§¡¦???????
				local re1, re2 = curx, cury;
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					curx = math.modf((mx-x1-CC.MenuBorderPixel)/(size*maxlength/2+CC.RowPixel)) + 1
					cury = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
				if (curx + cury*col) > #menuItem then
					curx = re1
					cury = re2
					mk = false;
				end
			end
		
			if keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				current = curx + cury*col;
				if menuItem[current][3]==3 then
                              
				elseif menuItem[current][2]==nil then
					returnValue=current;
					break;
				else
					local r=menuItem[current][2](menuItem,current);               --?¡Â??????????
					if r==1 then
						returnValue= -current;
						break;
					else
						lib.LoadSur(surid, 0, 0)
						if isBox==1 then
							DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
						end
					end
				end
			end
		end 
		current = curx + cury*col;
    end
	lib.FreeSur(surid)
        
	--¡¦?????????????????4??????????
	if returnValue > 0 then
		return menuItem[returnValue][4]
	else
		return returnValue
	end
end

function ShowMenu4(menuItem,numItem,rownum,x1,y1,x2,y2,isBox,isEsc,size,color,selectColor,Title1,color2,color3,linenum, flag)
  local w = 0
  local h = 0
  local i = 0
  local newNumItem = 0
  lib.GetKey()
  local newMenu = {}
  for i = 1, numItem do
    if menuItem[i][3] > 0 then
      newNumItem = newNumItem + 1
      newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
    end
  end
  if newNumItem == 0 then
    return 0
  end
  local maxlength = 0
  for i = 1, newNumItem do
	if maxlength < string.len(newMenu[i][1]) then
		maxlength = string.len(newMenu[i][1])
	end
  end
  if linenum == nil then
  	linenum = math.modf((newNumItem-1)/rownum+1)
  end
  if x1 == -2 and y1 == -2 or x2 == -2 and y2 == -2 then
    w = (size * maxlength / 2 + CC.MenuBorderPixel) * rownum + CC.MenuBorderPixel
	if w < size*string.len(Title1 or "")/2 + size + 2 * CC.MenuBorderPixel then
		w = size*string.len(Title1 or "")/2 + size + 2 * CC.MenuBorderPixel
	end
	if Title1 == nil then
		h = (size + CC.MenuBorderPixel*2 + 5) * linenum + CC.MenuBorderPixel
	else
		h = (size + CC.MenuBorderPixel*2 + 5) * (linenum + 1) + CC.MenuBorderPixel + 10
	end
  else
    w = x2 - x1
    h = y2 - y1
  end
  if x1 == -2 and y1 == -2 and x2 == -2 and y2 == -2 then
  	x1 = math.modf(CC.ScreenW/2 - w/2)
	y1 = math.modf(CC.ScreenH/2 - h/2)
  elseif x1 == -2 and y1 == -2 then
	x1 = x2 - w
	y1 = y2 - h
  end
  local xx = x1 + w/rownum/2 - size * maxlength / 4
  local start = 1
  local current = 1
  local keyPress = -1
  local returnValue = 0
  if isBox == 1 then
	DrawBox(x1,y1,x1+w,y1+h,C_WHITE)
  end
  local surid = lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH)
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
	if flag ~= nil then
		Cls(x1,y1,x1+w,y1+h)
	else
		Cls()
	end
	lib.LoadSur(surid, 0, 0)
	if Title1 ~= nil then
		DrawString(-1,y1 + CC.MenuBorderPixel,Title1,selectColor,size)
	end

	local over = limitX(start + rownum * linenum - 1,start,newNumItem)
	local yy = y1 + size + 2 * CC.MenuBorderPixel + 15
	if Title1 == nil then
		yy = y1 + 10
	end
	for i = start, over do
		local colorS = color
		local row = rownum - 1
		if math.fmod(i,rownum) ~= 0 then
			row = math.fmod(i,rownum) - 1
		end
		if i == current then
			colorS = selectColor
			lib.Background(xx+row*w/rownum-3,yy-3,xx+row*w/rownum+maxlength*size/2+3,yy+size+8, 128, color)
		end
		if newMenu[i][3] == 2 and color2 ~= nil then
			colorS = color2
		end
		if newMenu[i][3] == 3 and color3 ~= nil then
			colorS = color3
		end
		DrawString(xx+row*w/rownum,yy,newMenu[i][1],colorS,size)
		if math.fmod(i,rownum) == 0 then
			yy = yy + size + CC.MenuBorderPixel * 2 + 5
		end
	end
	ShowScreen()
	keyPress = WaitKey(1)
	local moda = math.fmod(newNumItem,rownum)
	if moda == 0 then
		moda = rownum
	end
	local modc = math.fmod(current,rownum)
	if modc == 0 then
		modc = rownum
	end
	if isEsc == 1 and keyPress==VK_ESCAPE then                  --Esc ????
		break;
	elseif keyPress==VK_DOWN then                --Down
		current = current + rownum
		if current > over and over < newNumItem then
			start = start + rownum
		elseif current > newNumItem then
			start = 1
			current = modc
		end
	elseif keyPress==VK_UP then                  --Up
		current = current - rownum
		if current < start and start > 1 then
			start = start - rownum
		elseif current < 1 then
			start = limitX(newNumItem-(linenum-1)*rownum-moda+1,1,newNumItem)
			if moda >= modc then
				current = newNumItem + modc - moda
			else
				current = newNumItem - moda - rownum + modc
			end
		end
	elseif keyPress == VK_RIGHT then
		current = current + 1
		if current > over and over < newNumItem then
			start = start + rownum
		elseif current > newNumItem then
			start = 1
			current = 1
		end
	elseif keyPress == VK_LEFT then
		current = current - 1
		if current < start and start > 1 then
			start = start - rownum
		elseif current < 1 then
			start = limitX(newNumItem-(linenum-1)*rownum-moda+1,1,newNumItem)
			current = newNumItem
		end
	elseif  keyPress==VK_SPACE or keyPress==VK_RETURN  then
		if newMenu[current][2]== nil and newMenu[current][3] == 1 then
			returnValue=newMenu[current][4];
			break;
		elseif newMenu[current][3] == 1 then
			local r=newMenu[current][2](newMenu,current);               --?¡Â??????????
			if r==1 then
				returnValue= -newMenu[current][4];
				break;
			else
				Cls(x1,y1,x1+w,y1+h);
				if isBox==1 then
					DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
				end
			end
		end
	--[[	
	elseif keyPress==888 and start>1 then
		start=start-rownum
	elseif keyPress==999 and start<newNumItem-(linenum-1)*rownum-moda+1 then
		start=start+rownum
	elseif keyPress>999999 then
		local kind, mx, my = nil, nil, nil
		if keyPress>1999999 then
			kind=1
			keyPress=keyPress-2000000
		else
			kind=0
			keyPress=keyPress-1000000
		end
		mx=math.modf(keyPress/1000)
		my=math.fmod(keyPress,1000)

		if mx>x1 and mx<x1+w and my>y1 and my<y1+h then
			if Title1 == nil and Title2 == nil then
				current = start-1+math.modf((mx-xx)/(w/rownum)+1) + rownum*math.modf((my-y1-10)/(size+CC.MenuBorderPixel*2+5))
			else
				current = start-1+math.modf((mx-xx)/(w/rownum)+1) + rownum*math.modf((my-y1-size-2*CC.MenuBorderPixel-15)/(size+CC.MenuBorderPixel*2+5))
			end
			current = limitX(current,1,newNumItem)
			if kind==1 then
				if newMenu[current][2]==nil and newMenu[current][3] == 1 then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][3] == 1 then
					local r=newMenu[current][2](newMenu,current);               --?¡Â??????????
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					else
						Cls(x1,y1,x1+w,y1+h);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				end
			end
		end
	end]]
	end
  end
  lib.FreeSur(surid)
  return returnValue
end
------------------------------------------------------------------------------------
--------------------------------------???¡¦????---------------------------------------
--???¡¦???????¨¦
--???¡ã???¡¦id
--¡¦???1 ?????????¡¦?? 0 ???????????¡¦???????????????¨¾????????
function UseThing(id)
	return DefaultUseThing(id);
end

--???????¡¦?????????????????????¡¦?¡ì??
--id ???¡¦id
function DefaultUseThing(id)                --???????¡¦????????
    if JY.Thing[id]["????"]==0 then
        return UseThing_Type0(id);
    elseif JY.Thing[id]["????"]==1 then
        return UseThing_Type1(id);
    elseif JY.Thing[id]["????"]==2 then
        return UseThing_Type2(id);
    elseif JY.Thing[id]["????"]==3 then
        return UseThing_Type3(id);
    elseif JY.Thing[id]["????"]==4 then
        return UseThing_Type4(id);
    end
end

--???¨¦???¡¦????¡¦?????
function UseThing_Type0(id)
    if id == 286 then
		local jyzj = 0
		for j=1, CC.MyThingNum do
			if JY.Base["???¡¦" .. j] == 287 then
				jyzj = 1;
				break;
			end
		end
		if jyzj == 1 then
			say('??????????????¡Á????????¨®???????¨®????????????????',0,1)
			say('??????...?????????????¡¦????...',0,1)
			if WarMain(436) == false then
				Cls()
				instruct_15()
				Cls()
				do return end
			end
			light()
			say('??????...??????????',0,1)
			instruct_2(286,-1)
			instruct_2(287,-1)
			instruct_2(84,1)
			Cls()  --????
		end
		return 0;
	end
		
	if id == 287 then
		local jyzj = 0
		for j=1, CC.MyThingNum do
			if JY.Base["???¡¦" .. j] == 286 then
				jyzj = 1;
				break;
			end
		end
		if jyzj == 1 then
			say('??????????????¡Á????????¨®???????¨®????????????????',0,1)
			say('??????...?????????????¡¦????...',0,1)
			if WarMain(436) == false then
				Cls()
				instruct_15()
				Cls()
				do return end
			end
			light()
			say('??????...??????????',0,1)
			instruct_2(286,-1)
			instruct_2(287,-1)
			instruct_2(84,1)
			Cls()  --????
		end
		return 0;
	end
	

	
    if JY.SubScene>=0 then
		local x=JY.Base["??X1"]+CC.DirectX[JY.Base["??¡¦??¨¾"]+1];
		local y=JY.Base["??Y1"]+CC.DirectY[JY.Base["??¡¦??¨¾"]+1];
        local d_num=GetS(JY.SubScene,x,y,3)
        if d_num>=0 then
            JY.CurrentThing=id;
            EventExecute(d_num,2);       --???¡¦??¡¦?????
            JY.CurrentThing=-1;
			return 1;
		else
		    return 0;
        end
    end
	--?????¨¦?¡è????
	if id == 315 then
		local dld = 0
		for j=1, CC.MyThingNum do
			if JY.Base["???¡¦" .. j] == 314 and JY.Base["???¡¦" .. j] == 231 and JY.Base["???¡¦" .. j] == 	26 then
				dld = 1;
				break;
			end
		end
		if dld == 1 then
			instruct_2(314,-1)
			instruct_2(231,-1)
			instruct_2(26,-1)			
			instruct_2(316,1)
		end
		return 0;
	end	

end


--????????????¡¦¨½????¡Á¡ã???¨¾???????????¡¦
--¡¦??? true??????????false????
function CanUseThing(id, personid)
	local str = ""
		
	--????????¡Á¡§??¡Á¡ã??
	if JY.Thing[id]["??????????"] == 651 then
		if personid == 0 and JY.Base["????"] == 651 then
			return true
		else
			return false
		end
	end

    --if ZhongYongZD(personid) and (id == 118 or id == 235) then 
        --return true
   -- end
		--¡¦???????
	if match_ID(personid, 9993) and (id == 72 or id == 69 or id == 83 or id == 85 or id == 88 or id == 90 or  id == 92 or id == 112 or id ==137 
      or id == 168 or id == 171 or id  == 245 or id ==250 or id == 253 or id == 260 or id == 265 or id == 268 or id == 269 or id == 274 
     or id == 277 or  id == 291 or id == 319 or id == 324 or id == 332)  then
		return true
	--????????????????????
	elseif (match_ID(personid, 76) or match_ID(personid, 637) or match_ID(personid, 774))  and JY.Thing[id]["????"] == 2 then
		return true	
	--?¡Â???¡ì????
	elseif id == 70 and personid == 0 then
		return true		
	--¡ã??¨§??¡Á¡ã??
	elseif match_ID(personid, 104) and JY.Thing[id]["¡Á¡ã??????"] >= 0 then
		return true
	--¡ã¡Á??¡Á¡ã??¡ã¡Á??
	elseif match_ID(personid, 9997) and id == 326 then
		return true	
    --????¡Á¡ã?????¡§??
    elseif (match_ID(personid, 721) and id == 349) or (match_ID(personid, 27) and JY.Base["????"]==52) then
        Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
		if DrawStrBoxYesNo(-1, -1, "¡Á¡ã???????¡¦????¡Á???????¡¦¨½????¡Á¡ã???", C_WHITE, CC.DefaultFont) == false  then
			return 0
		else
			lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_RED, 128)
			ShowScreen()
			lib.Delay(80)
			lib.ShowSlow(15, 1)
			Cls()
			lib.ShowSlow(50, 0)
			JY.Person[personid]["????"] = 2
			JY.Person[personid]["¡ã??¨ª?¨½"] = 721
			JY.Person[personid]["?¡¦?¨½?¨²??"]=322
			JY.Person[personid]["????????????2"]=16
			JY.Person[personid]["????????????2"]=14
			JY.Person[personid]["???????¡ì????2"]=14
			local add, str = AddPersonAttrib(personid, "???¡Â??", -20)
			DrawStrBoxWaitKey(JY.Person[personid]["????"] .. str, C_ORANGE, CC.DefaultFont)
			add, str = AddPersonAttrib(personid, "¡¦?????", -30)
			DrawStrBoxWaitKey(JY.Person[personid]["????"] .. str, C_ORANGE, CC.DefaultFont)
			return true
		end
	--¡¦??¡è?¡ì??????????
	elseif match_ID(personid, 149) and id == 265 then
		return true
	else
		if JY.Thing[id]["??????????"] >= 0 and JY.Thing[id]["??????????"] ~= personid and (personid == 0 and JY.Thing[id]["??????????"]==JY.Base["????"])==false then
			return false
		end
		if JY.Thing[id]["??????????"] ~= 2 and JY.Person[personid]["????????"] ~= 2 and JY.Person[personid]["????????"] ~= 3 and JY.Thing[id]["??????????"] ~= JY.Person[personid]["????????"] then
			local cond = 1
			--?¨§???????????????¡ì?¡ã
			--[[for i = 1, 4 do
				if JY.Thing[id]["?¡¦??????"] == JY.Person[personid]["?¨§??????"..i] then
					cond = 2
					break
				end
			end
			--?¨§???????????????¡ì?¡ã ???¡§¡ã??? ?¨®?????¨²????
			if JY.Thing[id]["?¡¦??????"] == JY.Person[personid]["?¨§??????"]  or match_ID(personid, 578)or match_ID(personid, 9987)
               or match_ID(personid,9978) then
				cond = 2--]]
			--?¨§???????????????¡ì?¡ã ???¡§¡ã??? ?¨®?????¨²????
			if match_ID(personid, 514) or match_ID(personid, 9987) or match_ID(personid,9978) or match_ID(personid, 9740) then
				cond = 2
			--?¡Â???¡ì???¨²????????
			elseif (match_ID(personid, 578) and yongdao(JY.Thing[id]['?¡¦??????'])) or  (match_ID(personid, 505) and yongquan(JY.Thing[id]['?¡¦??????'])) then
				cond = 2
			elseif id == 86 and personid == 0 then
				cond = 2
			end
			if cond == 1 then
				return false
			end
		end
		if JY.Person[personid]["????¡Á??¨®??"] < JY.Thing[id]["??????"] then
			return false
		end
		if JY.Person[personid]["???¡Â??"] < JY.Thing[id]["?????¡Â??"] then
			return false
		end
		if JY.Person[personid]["?¨¢??"] < JY.Thing[id]["???¨¢??"] then
			return false
		end
		if JY.Person[personid]["????????"] < JY.Thing[id]["??????????"] then
			return false
		end
		if JY.Person[personid]["????????"] < JY.Thing[id]["??????????"] then
			return false
		end
		--if JY.Person[personid]["????????"] < JY.Thing[id]["??????????"] then
			--return false
		--end

		--?¡ì???????????????¡Â????¡Á¡Â+10??
		local lv = 0;
		if PersonKF(personid, 98) then
			lv = 10
		end
		--???¡§¡ã???
		if match_ID(personid, 9987)  then
		 lv = lv + 20
		end
		--???¨²?????¡ì?????????¨®-40
		if id == 117 and PersonKF(personid, 67) then
			lv = lv + 40
		end
		--?????????¡ì?¨²???????¨®-40
		if id == 136 and PersonKF(personid, 44) then
			lv = lv + 40
		end
		
		--???¡§???????¡ì?¡ã?????????¨®???????????????¨®????-10????????
		if id == 95 or id == 101 or id == 123 then
			for i = 1, JY.Base["????????"] do
				if JY.Person[personid]["????" .. i] == 12 or JY.Person[personid]["????" .. i] == 18 or JY.Person[personid]["????" .. i] == 38 then
					lv = lv + 10
				end
			end
		end
		--????¡ã??????¡ì?¡ã?????????¨®?????????¨®????-10
		if id == 97 or id == 115  then
			for i = 1, JY.Base["????????"] do
				if JY.Person[personid]["????" .. i] == 46 or JY.Person[personid]["????" .. i] == 16  then
					lv = lv + 10
				end
			end
		end		
		--????¡ã???-40
		if id == 291 or id == 90 or id == 324  then
			for i = 1, JY.Base["????????"] do
				if JY.Person[personid]["????" .. i] == 46 or JY.Person[personid]["????" .. i] == 16  then
					lv = lv + 10
				end
			end
		end			
		--???¨¾?¡¦???¡ì???¨²-40
		if id == 86 and PersonKF(personid, 80) then
			if PersonKF(personid,204) then
			  lv = lv + 60
			  else
				lv = lv + 40
			end
		end	
		--?????¨²???¡ì?¨¾?¡¦-40
		if id == 167 and PersonKF(personid, 26) then
			if PersonKF(personid,204) then
			  lv = lv + 60
			  else
				lv = lv + 40
			end
		end	
		--???????????¡ì????????-40
		if id == 337 and PersonKF(personid, 200) then
			lv = lv + 40
		end
		--?????????????¡ì??????-40
		if id == 386 and PersonKF(personid, 198) then
			lv = lv + 40
		end
		--???¨¦???????¡ì?¨¦????¡¦¡§???¨®-40
		--?????????¡ì??????-40
		if id == 180 and PersonKF(personid, 47) then
			lv = lv + 40
		end
		--???????????¡ì????-40
		if id == 114 and PersonKF(personid, 73) then
			lv = lv + 40
		end
		
		if JY.Person[personid]["??????¡¦¨¾"] + lv < JY.Thing[id]["????????¡¦¨¾"] then
			return false
		end
		if JY.Person[personid]["??¡¦¡§????"] + lv < JY.Thing[id]["????¡¦¡§????"] then
			return false
		end
		if JY.Person[personid]["????????"] + lv < JY.Thing[id]["??????????"] then
			return false
		end
		if JY.Person[personid]["????????"] + lv < JY.Thing[id]["??????????"] then
			return false
		end
		if JY.Person[personid]["???????¡Â"] + lv < JY.Thing[id]["?????????¡Â"] then
			return false
		end
		
		if JY.Person[personid]["¡ã??¡Â????"] < JY.Thing[id]["??¡ã??¡Â????"] then
			return false
		end
    
        if id == 372 then  --????
            if JY.Person[personid]["¡Á???"] < 31 or JY.Person[personid]["¡Á???"] > 79 then 
                return false
            end
        end
		
		
        if id == 327 then --?¨§?¡ì??
            if JY.Person[personid]["¡Á???"] < 31 or JY.Person[personid]["¡Á???"] > 79 then 
                if personid == 0 and JY.Base['??¡Á?'] == 11 then
					say('?????????????¨¢???¨§???????¨§¡Á????????????????????¨¢???????????¡¦??',0,1)
					return true
				end	
				return false
            end
        end
		
		if id == 81 then
			if (JY.Person[personid]['?¨²?¨¹???¡è'] + JY.Person[personid]['????????5']) < 10 then
				return false
			end
		end		

 	
		if JY.Thing[id]["??¡Á???"] >= 0 then
			if JY.Thing[id]["??¡Á???"] > JY.Person[personid]["¡Á???"] then
				return false;
			end
		else
			if -JY.Thing[id]["??¡Á???"] < JY.Person[personid]["¡Á???"] then
				return false;
			end 
		end
        
	end
	  
	--?¡¦¡Á?????
	if id == 118 then
		local R = JY.Person[personid]
		local wp = R["??????¡¦¨¾"] + R["??¡¦¡§????"] + R["????????"] + R["????????"] + R["???????¡Â"] +JY.Base["????"]
		if wp < 120 then
			return false
		end
	end
	--????????
	if id == 176 then
		local R = JY.Person[personid]
		if R["????????"]+JY.Base["????"] >= 50 then
			return true
		elseif R["????????"]+JY.Base["????"] >= 50 then
			return true
		elseif R["???????¡Â"]+JY.Base["????"] >= 50 then
			return true
		else
			return false
		end
	end
    --???¡§??
	if id == 349 then
		--local R = JY.Person[personid]
		if match_ID(personid, 27) then
			return true
		else 
			return false
		end
	end
    --?¡ì?¨§??
	if id == 217  then
		local R = JY.Person[personid]
		if R["????"]== 0 then
			return true
		else return false
		end
	end	
    	--?¡ì?¨§??
	if id == 218  then
		local R = JY.Person[personid]
		if R["????"]== 1 then
			return true
		else return false
		end
	end		
	--???????¡Á????
	if id == 239 then
		local R = JY.Person[personid]
		if R["??????¡¦¨¾"]+JY.Base["????"] >= 50 then
			return true
		elseif R["??¡¦¡§????"]+JY.Base["????"] >= 50 then
			return true
		else
			return false
		end
	end
	--???????¡¦????
	if id == 200 then
		local R = JY.Person[personid]
		if R["??????¡¦¨¾"]+JY.Base["????"] >= 50 then
			return true
		elseif R["??¡¦¡§????"]+JY.Base["????"] >= 50 then
			return true
		else
			return false
		end
	end	
	return true
end

--???¡¦?????????¡ì??
--id ???¡¦id??
--personid ??????id
--¡¦???????0 ?????????¡ì???????¡¦??????????????1 ???????¡ì?????¨¾?????¨®???¡¦????????-1
function UseThingEffect(id, personid, amount)
	--???????????¨¾??????????1??
	if amount == nil then
		amount = 1
	end

	--???????¡¦
	if id == 343 then
		Cls()  --????
		local k = JY.Wugong;
		local menu = {}
	
		local kftype = JYMsgBox("?????¨½", "?????¨½???????¨§??????????", {"????",}, 1, 347)
	
		for i = 1, JY.WugongNum - 1 do
			local kfname = k[i]["????"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			menu[i] = {kfname,nil,2}
			if k[i]["????????"] == 6 then
				menu[i][3] = 1
			end
		end
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"?¨§?¨¾?¨§??????")
	
		if r > 0 then
			SetTianNei(personid, r)
		end
			return 2
	elseif id == 344 then
		Cls()  --????
		local k = JY.Wugong;
		local menu = {}
	
		local kftype = JYMsgBox("?????¨½", "?????¨½???????¨§???¨¢??????", {"?¨¢??",}, 1, 347)
	
		for i = 1, JY.WugongNum - 1 do
			local kfname = k[i]["????"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			menu[i] = {kfname,nil,2}
			if k[i]["????????"] == 7 then
				menu[i][3] = 1
			end
		end
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"?¨§?¨¾?¨§???¨¢??")
	
		if r > 0 then
			SetTianQing(personid, r)
		end
		return 2
	elseif id == 345 then
		Cls()  --????
		local k = JY.Wugong;
		local menu = {}
		local kftype = JYMsgBox("?????¨½", "?????¨½???????¨§??????????", {"??¡¦¡§","??¡¦¡§","??¡¦¡§","??¡¦¡§","????"}, 5, 347)
	
		for i = 1, JY.WugongNum - 1 do
			local kfname = k[i]["????"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			menu[i] = {kfname,nil,2}
			if k[i]["????????"] == kftype then
				menu[i][3] = 1
			end
		end
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"?¨§?¨¾?¨§??????")
	
		if r > 0 then
			local R = JYMsgBox("?????¨½", "???¡Â?¡Â???¨½?¨§?¨¾???¨§????????????", {"?¨§????????","?¨§????????"}, 2, 596)
			if R == 1 then
				SetTianWai(personid, 1, r)
			else	
				SetTianWai(personid, 2, r)
			end
		end
		return 2
	elseif id == 346 then
		Cls()  --????
		JY.Person[0]["?¡¦?¨½?¨²??"]=JY.Person[642]["?¡¦?¨½?¨²??"]
		JY.Person[0]["¡ã??¨ª?¨½"]=JY.Person[642]["¡ã??¨ª?¨½"]
		JY.Person[0]["????"]=JY.Person[642]["????"]
		for i=1,5 do
			JY.Person[0]["????????????" .. i]=JY.Person[642]["????????????" .. i]
			JY.Person[0]["????????????" .. i]=JY.Person[642]["????????????" .. i]
			JY.Person[0]["???????¡ì????" .. i]=JY.Person[642]["???????¡ì????" .. i]
		end
		return 2
	elseif id == 348 then
		Cls()  --????
		local nexty = CC.MainSubMenuY + CC.SingleLineHeight
        local p = SelectTeamMenu(CC.MainSubMenuX, nexty)
        if p > 0 then
            local pid = JY.Base["???¨¦" .. p]
            local menu = {}
            for i = 1, CC.Kungfunum do
                if JY.Person[pid]["????"..i] > 0 then
                    local wg = JY.Person[pid]["????"..i]
                    menu[#menu+1] = {JY.Wugong[wg]["????"], nil, 1, wg, i}
                end
            end        
            Cls()
            local r = ShowMenu2(menu, #menu, 3,10, CC.MainSubMenuX, CC.MainSubMenuY, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
			local jjj = 1
			if match_ID(pid,56) or match_ID(pid,77) then
				jjj = 2
			end 
            if r > 0 then
                local thingid = -1
                for i = 0, JY.ThingNum - 1 do
                    if JY.Thing[i]["?¡¦??????"] > 0 and JY.Thing[i]["?¡¦??????"] == menu[r][4] then
                        thingid = i
                        local level = math.modf(JY.Person[pid]["????????" .. menu[r][5]] / 100) + 1
                        AddPersonAttrib(pid, "?¨²?¨¹¡Á??¨®??", -JY.Thing[thingid]["???¨²?¨¹¡Á??¨®??"] * level)
                        AddPersonAttrib(pid, "????¡Á??¨®??", -JY.Thing[thingid]["??????¡Á??¨®??"] * level)
                        AddPersonAttrib(pid, "???¡Â??", -JY.Thing[thingid]["?????¡Â??"] * level)
                        AddPersonAttrib(pid, "?¨¢??", -JY.Thing[thingid]["???¨¢??"] * level)
                        AddPersonAttrib(pid, "¡¦?????", -JY.Thing[thingid]["??¡¦?????"] * level)        
                        AddPersonAttrib(pid, "????????", -JY.Thing[thingid]["??????????"] * jjj * level)
                        AddPersonAttrib(pid, "????????", -JY.Thing[thingid]["??????????"] * jjj * level)
                        --AddPersonAttrib(pid, "????????", -JY.Thing[thingid]["??????????"] * jjj * level)
                        AddPersonAttrib(pid, "????????", -JY.Thing[thingid]["??????????"] * jjj * level)
                        AddPersonAttrib(pid, "??????¡¦¨¾", -JY.Thing[thingid]["????????¡¦¨¾"] * jjj * level)
						AddPersonAttrib(pid, "??¡¦¡§????", -JY.Thing[thingid]["????¡¦¡§????"] * jjj * level)
                        AddPersonAttrib(pid, "????????", -JY.Thing[thingid]["??????????"] * jjj * level)
                        AddPersonAttrib(pid, "????????", -JY.Thing[thingid]["??????????"] * jjj * level)
                        AddPersonAttrib(pid, "???????¡Â", -JY.Thing[thingid]["?????????¡Â"] * jjj * level)
						AddPersonAttrib(pid, "¡ã??¡Â????", -JY.Thing[thingid]["??¡ã??¡Â????"] * jjj * level)
                        AddPersonAttrib(pid, "???¡ì????", -JY.Thing[thingid]["?????¡ì????"] * jjj * level)     										
                        break
                    end
                end
                for i = menu[r][5], #menu - 1 do
                    JY.Person[pid]["????"..i] = JY.Person[pid]["????"..i+1]
                    JY.Person[pid]["????????"..i] = JY.Person[pid]["????????"..i+1]
                end
                JY.Person[pid]["????"..#menu] = 0
                JY.Person[pid]["????????"..#menu] = 0
                QZXS(JY.Person[pid]["????"].."???????¨¹"..menu[r][1])
            end
        end
		return 2
	else
		local str = {}
		str[0] = string.format("???? %s ?? %d", JY.Thing[id]["????"], amount)
		local strnum = 1
		local addvalue = nil
		if JY.Thing[id]["???¨²?¨¹"] > 0 then
			local add = JY.Thing[id]["???¨²?¨¹"] - math.modf(JY.Thing[id]["???¨²?¨¹"] * JY.Person[personid]["????????"] / 200) + Rnd(5)
			--?¨²???????????????¡ì????2??
			if JY.Status == GAME_WMAP and inteam(personid) and (inteam(16) or JY.Base["????"] == 16) then
				for w = 0, WAR.PersonNum - 1 do
					if match_ID(WAR.Person[w]["????????"], 16) and WAR.Person[w]["????"] == false and WAR.Person[w]["??¡¦?"] then
						add = math.modf(add * 2)
						break;
					end
				end
			end
			if add <= 0 then
				add = 5 + Rnd(5)
			end
			add = math.modf(add)
			
			--?¨¦¡ã??¡§????????????????¡¦???????
			if JY.Status == GAME_WMAP then
				for w = 0, WAR.PersonNum - 1 do
					if (match_ID(WAR.Person[w]["????????"], 71) or match_ID(WAR.Person[w]["????????"], 9846)) and WAR.Person[w]["????"] == false and WAR.Person[w]["??¡¦?"] ~= WAR.Person[WAR.CurID]["??¡¦?"] then
						add = -add
						break;
					end
				end
			end
			--?¡è¡ã?????
			if MPPD(personid) == 2 and Curr_QG(personid,2) then
			    add = add * 2;
		    end	
			--????????			
			if match_ID(personid,9943) then
				add = add * JY.Base["????"];
			end
			--?????????¡ì?????????¨¢??
			if not inteam(personid) then
				add = add * JY.Base["????"];
				if JY.Person[456]["????????"] == 1 then
					add = add + JY.Base["????"]*JY.Base["????"]*10
				end
			end
			--?????¨®?????¡ì??????
			if inteam(personid) then
				add = add + JY.Base["????"]*5
				if JY.Person[0]["????"] >= 500 then
					add = add * JY.Base["????"];
				end
			end	
			if JY.Status == GAME_WMAP then
				WAR.Person[WAR.CurID]["????????"] = AddPersonAttrib(personid, "????????", -math.modf(add/8))
			end

			addvalue, str[strnum] = AddPersonAttrib(personid, "?¨²?¨¹", add)
			
			--?????????????¨²?¨¹????
			if JY.Status == GAME_WMAP then
				WAR.Person[WAR.CurID]["?¨²?¨¹????"] = addvalue;
			end
			if addvalue ~= 0 then
				strnum = strnum + 1
			end
		end
		
		if id==15 then
			War_DAPANTAO(personid,amount)
		end
	  
		if id==16 then
			War_DARENSHEN(personid,amount)
		end
		
		if id==17 then
			JY.Person[personid]["????"]=JY.Person[personid]["????"]+amount*10
		    if JY.Person[personid]["????"] > 1000 and CC.PTF[personid][9919] == nil then
			JY.Person[personid]["????"] = 1000
			elseif CC.PTF[personid][9919] ~= nil then
				JY.Person[personid]["????"] = JY.Person[personid]["????"]
				if JY.Person[personid]["????"] > 9999 then
					JY.Person[personid]["????"] = 9999
				end
			end
			--[[if JY.Person[personid]["????"] > 1000 then
			    if MPPD(personid) == 23 and MPDJ(personid) >= 3 and PersonKF(personid,199) then
					JY.Person[personid]["????"]=800
				else
				    JY.Person[personid]["????"]=500
				end
				JY.Person[personid]["????"]=1000
			end]]
		end
	  
		local function ThingAddAttrib(s)
			if JY.Thing[id]["??" .. s] ~= 0 then	
				addvalue, str[strnum] = AddPersonAttrib(personid, s, JY.Thing[id]["??" .. s]*amount)
				
				if addvalue ~= 0 then
				strnum = strnum + 1
				end
				--??????????????????????????
				if JY.Status == GAME_WMAP then
					if s == "????" then
						WAR.Person[WAR.CurID]["????????"] = addvalue;
					elseif s == "????" then
						WAR.Person[WAR.CurID]["????????"] = addvalue;
					end
				end
			end

		end
		
		ThingAddAttrib("?¨²?¨¹¡Á??¨®??")
	  
		if JY.Thing[id]["??????????"] < 0 then
			addvalue, str[strnum] = AddPersonAttrib(personid, "????????", math.modf(JY.Thing[id]["??????????"] / 2)*amount)
			if addvalue ~= 0 then
				strnum = strnum + 1
			end
			--??????????????????????
			if JY.Status == GAME_WMAP then
				if addvalue < 0 then
					WAR.Person[WAR.CurID]["????????"] = -addvalue;
				elseif addvalue > 0 then
					WAR.Person[WAR.CurID]["????????"] = addvalue;
				end
			end
		end
		  
		ThingAddAttrib("????")
	  
		if JY.Thing[id]["????????????"] == 2 then
			str[strnum] = "???????¡¦????????????"
			strnum = strnum + 1
		end
		---
        if JY.Status == GAME_WMAP then 
            if id == 25 then 
                JY.Person[personid]['????????'] = 0
                JY.Person[personid]['????????'] = 0
                JY.Person[personid]['¡Á???????'] = 0
                JY.Person[personid]['??¡¦?????'] = 0
                WAR.FXDS[personid] = nil
				WAR.LXZT[personid] = nil
				WAR.PD['?????¡§????'][personid] = 100               
            end
            if id == 24 then
                if WAR.LXZT[personid] ~= nil then 
                    WAR.LXZT[personid] = WAR.LXZT[personid] - 50
                    if WAR.LXZT[personid] < 1 then 
                        WAR.LXZT[personid] = nil
                    end
                end
                WAR.PD['????????'][personid] = 100
            end
            
            if id == 23 then 
                AddPersonAttrib(personid,'¡Á???????',-20)
                WAR.PD['?¨½????'][personid] = 50
            end    
            
            if id == 22 then 
                AddPersonAttrib(personid,'??¡¦?????',-50)
                WAR.PD['???¡§??'][personid] = 50
            end
            
            if id == 11 then 
                WAR.PD['????????'][personid] = 100
            end
            
            if id == 10 then 
                WAR.PD['????????'][personid] = 50
            end
            
            if id == 9 then 
                WAR.PD['????????'][personid] = 50
            end
            
            if id == 3 then 
                WAR.PD['¡ã¡Á?????¡§'][personid] = 200
            end
            
            if id == 1 then 
                WAR.PD['?¨§?????¨¹'][personid] = 100
            end
            
            if id == 0 then 
                WAR.PD['?????¡è'][personid] = 50
            end
        else    
            if id == 25 then 
                JY.Person[personid]['????????'] = 0
                JY.Person[personid]['????????'] = 0
                JY.Person[personid]['¡Á???????'] = 0
				JY.Person[personid]['??¡¦?????'] = 0				
            end
        end
        
	    if JY.Person[id]["?¨²?¨¹???¡è"] > 12 then
            JY.Person[id]["?¨²?¨¹???¡è"] = 12 	   
	    end	
		ThingAddAttrib("????")
		ThingAddAttrib("????¡Á??¨®??")
		ThingAddAttrib("???¡Â??")
		ThingAddAttrib("¡¦?????")
		ThingAddAttrib("?¨¢??")
		ThingAddAttrib("????????")
		ThingAddAttrib("????????")
		--ThingAddAttrib("????????")
		ThingAddAttrib("????????")
		ThingAddAttrib("??????¡¦¨¾")
		ThingAddAttrib("????????")
		ThingAddAttrib("????????")
		ThingAddAttrib("???????¡Â")
		ThingAddAttrib("¡ã??¡Â????")
		ThingAddAttrib("???¡ì????")
		ThingAddAttrib("???¡Â????")
		
		
		Cls()
		
		if strnum > 1 then
			local maxlength = 0
			for i = 0, strnum-1 do
				if maxlength < #str[i] then
					maxlength = #str[i]
				end
			end
			
			if JY.Status ~= GAME_WMAP then
				local ww = maxlength * CC.DefaultFont / 2 + CC.MenuBorderPixel * 2
				local hh = (strnum) * CC.DefaultFont + (strnum - 1) * CC.RowPixel + 2 * CC.MenuBorderPixel
				local x = (CC.ScreenW - ww) / 2
				local y = (CC.ScreenH - hh) / 2
				DrawBox(x, y, x + ww, y + hh, C_WHITE)
				DrawString(x + CC.MenuBorderPixel, y + CC.MenuBorderPixel, str[0], C_WHITE, CC.DefaultFont)
				for i = 1, strnum - 1 do
				  DrawString(x + CC.MenuBorderPixel, y + CC.MenuBorderPixel + (CC.DefaultFont + CC.RowPixel) * i, str[i], C_ORANGE, CC.DefaultFont)
				end

				ShowScreen()
			else
				--???????????¡¦??¡Á?
				DrawString(CC.MainMenuX, CC.ScreenH-(strnum+2)*CC.Fontsmall, JY.Person[WAR.Person[WAR.CurID]["????????"]]["????"].." "..str[0], C_WHITE, CC.Fontsmall);
				for i=1, strnum-1 do 
					DrawString(CC.MainMenuX, CC.ScreenH + (i-strnum-2)*CC.Fontsmall, str[i], C_WHITE, CC.Fontsmall);
				end
				
				ShowScreen()
				--????????
				War_Show_Count(WAR.CurID);
				return 1;
			end
			return 1
		else
			DrawStrBox(-1, -1, str[0], C_WHITE, CC.DefaultFont)
			ShowScreen()
			return 1
		end
	end
end

--¡Á¡ã?????¡¦
function UseThing_Type1(id)
	DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, string.format("????????%s?", JY.Thing[id]["????"]), C_WHITE, CC.DefaultFont)
	local nexty = CC.MainSubMenuY + CC.SingleLineHeight
	local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
	local pp1, pp2 = 0, 0
	if r > 0 then
		local personid = JY.Base["???¨¦" .. r]
		--???¨¦??¡Á¡ã?????¨¹??
		if id == 202 and match_ID(personid, 72) then
			say("?????????????????????????????????¡Â????????????????¡Á¡ã??????",72,0)
			if JY.Thing[id]["??????"] >= 0 then
								
				JY.Person[JY.Thing[id]["??????"]]["???¡Â"] = -1
			end
			if JY.Person[personid]["???¡Â"] >= 0 then
				JY.Thing[JY.Person[personid]["???¡Â"]]["??????"] = -1
			end
			JY.Person[personid]["???¡Â"] = id
			JY.Thing[id]["??????"] = personid
			return 1
		end
		
		if CanUseThing(id, personid) then
			if Setmeal[id] ~= nil then
				--local a,b,c = id,id+1,id+2
				if JY.Thing[id]["¡Á¡ã??????"] == 0 then
					local a,b,c = id,id+1,id+2
					if JY.Thing[a]["??????"] >= 0 then
						JY.Person[JY.Thing[a]["??????"]]["???¡Â"] = -1
					end
					if JY.Person[personid]["???¡Â"] >= 0 then
						JY.Thing[JY.Person[personid]["???¡Â"]]["??????"] = -1
					end
					JY.Person[personid]["???¡Â"] = a
					JY.Thing[a]["??????"] = personid
					if JY.Thing[b]["??????"] >= 0 then
						JY.Person[JY.Thing[b]["??????"]]["¡¦???"] = -1
					end
					if JY.Person[personid]["¡¦???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡¦???"]]["??????"] = -1
					end
					JY.Person[personid]["¡¦???"] = b
					JY.Thing[b]["??????"] = personid
					if JY.Thing[c]["??????"] >= 0 then
						
						JY.Person[JY.Thing[c]["??????"]]["¡Á???"] = -1
					end
					if JY.Person[personid]["¡Á???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡Á???"]]["??????"] = -1
					end
					JY.Person[personid]["¡Á???"] = c
					JY.Thing[c]["??????"] = personid
				elseif JY.Thing[id]["¡Á¡ã??????"] == 1 then
					local a,b,c = id-1,id,id+1
					if JY.Thing[a]["??????"] >= 0 then
						JY.Person[JY.Thing[a]["??????"]]["???¡Â"] = -1
					end
					if JY.Person[personid]["???¡Â"] >= 0 then
						JY.Thing[JY.Person[personid]["???¡Â"]]["??????"] = -1
					end
					JY.Person[personid]["???¡Â"] = a
					JY.Thing[a]["??????"] = personid
					if JY.Thing[b]["??????"] >= 0 then
						JY.Person[JY.Thing[b]["??????"]]["¡¦???"] = -1
					end
					if JY.Person[personid]["¡¦???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡¦???"]]["??????"] = -1
					end
					JY.Person[personid]["¡¦???"] = b
					JY.Thing[b]["??????"] = personid
					if JY.Thing[c]["??????"] >= 0 then
						
						JY.Person[JY.Thing[c]["??????"]]["¡Á???"] = -1
					end
					if JY.Person[personid]["¡Á???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡Á???"]]["??????"] = -1
					end
					JY.Person[personid]["¡Á???"] = c
					JY.Thing[c]["??????"] = personid
				elseif JY.Thing[id]["¡Á¡ã??????"] == 2 then
					local a,b,c = id-2,id-1,id
					if JY.Thing[a]["??????"] >= 0 then
						JY.Person[JY.Thing[a]["??????"]]["???¡Â"] = -1
					end
					if JY.Person[personid]["???¡Â"] >= 0 then
						JY.Thing[JY.Person[personid]["???¡Â"]]["??????"] = -1
					end
					JY.Person[personid]["???¡Â"] = a
					JY.Thing[a]["??????"] = personid
					if JY.Thing[b]["??????"] >= 0 then
						JY.Person[JY.Thing[b]["??????"]]["¡¦???"] = -1
					end
					if JY.Person[personid]["¡¦???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡¦???"]]["??????"] = -1
					end
					JY.Person[personid]["¡¦???"] = b
					JY.Thing[b]["??????"] = personid
					if JY.Thing[c]["??????"] >= 0 then
						
						JY.Person[JY.Thing[c]["??????"]]["¡Á???"] = -1
					end
					if JY.Person[personid]["¡Á???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡Á???"]]["??????"] = -1
					end
					JY.Person[personid]["¡Á???"] = c
					JY.Thing[c]["??????"] = personid
				end	
			else
				if JY.Thing[id]["¡Á¡ã??????"] == 0 then
					if JY.Thing[id]["??????"] >= 0 then
						JY.Person[JY.Thing[id]["??????"]]["???¡Â"] = -1
					end
					if JY.Person[personid]["???¡Â"] >= 0 then
						JY.Thing[JY.Person[personid]["???¡Â"]]["??????"] = -1
					end
					JY.Person[personid]["???¡Â"] = id
				
				elseif JY.Thing[id]["¡Á¡ã??????"] == 1 then
					if JY.Thing[id]["??????"] >= 0 then
						
						JY.Person[JY.Thing[id]["??????"]]["¡¦???"] = -1
					end
					if JY.Person[personid]["¡¦???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡¦???"]]["??????"] = -1
					end
					JY.Person[personid]["¡¦???"] = id
				elseif JY.Thing[id]["¡Á¡ã??????"] == 2 then
					if JY.Thing[id]["??????"] >= 0 then
						
						JY.Person[JY.Thing[id]["??????"]]["¡Á???"] = -1
					end
					if JY.Person[personid]["¡Á???"] >= 0 then
						JY.Thing[JY.Person[personid]["¡Á???"]]["??????"] = -1
					end
					JY.Person[personid]["¡Á???"] = id				
				end
				JY.Thing[id]["??????"] = personid
			end	
		else
			DrawStrBoxWaitKey("???????????????????¡¦", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	return 1
end
--???????¡¦????
function UseThing_Type2(id)
	if JY.Thing[id]["??????"] >= 0 and DrawStrBoxYesNo(-1, -1, "?????¡¦????????????????¡¦¨½?????????", C_WHITE, CC.DefaultFont) == false then
		Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
		ShowScreen()
		return 0
	end
	Cls()
	DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, string.format("????????%s?", JY.Thing[id]["????"]), C_WHITE, CC.DefaultFont)
	local nexty = CC.MainSubMenuY + CC.SingleLineHeight
	local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
	if r > 0 then
		local personid = JY.Base["???¨¦" .. r]
		local yes, full = nil, nil
		if JY.Thing[id]["?¡¦??????"] >= 0 then
			yes = 0
			full = 1
			for i = 1, JY.Base["????????"] do
				if JY.Person[personid]["????" .. i] == JY.Thing[id]["?¡¦??????"] then
					yes = 1
				else
					if JY.Person[personid]["????" .. i] == 0 then
						full = 0
					end
				end
			end
		end
		
        if CanUseThing(id, personid) then
			--????????????????????????????????????
			local jy = 0
			--[[if id == 83 then
				local n = {
                            {241,"??????????"},
							{242,"??????????"},
							{243,"??????????"}
						  }
				local k;
				local d;
				for i = 1,JY.Base["????????"] do
					for j = 1,#n do
						if JY.Person[personid]["????"..i] == n[j][1] then
							k = n[j][1]
							d = n[j][2]
							jy = 1
							break
						end						
					end
					if jy == 1 then
						break
					end
				end
                if PersonKF(personid,k) and PersonKF(personid, 106) == false then
                    if DrawStrBoxYesNo(-1, -1, "?????¨½??????????????¡¦¨½??"..d.."?????????¨½???", C_WHITE, CC.DefaultFont) then
                        for x = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. x] == k then
                                JY.Person[personid]["????" .. x] = 106
                                JY.Person[personid]["????????" .. x] = 50
                                if JY.Person[personid]["?¨§??????"] == k then
                                    JY.Person[personid]["?¨§??????"] = 106
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
			end	--]]
			--¡Á???????????????????¡ã???¡Á????????????????¡ì???????¡Â
            if id == 299 then
				if WYXF(personid) then
					if PersonKF(personid, 175) == false and MPPD(personid) == 14 then
						if DrawStrBoxYesNo(-1, -1, "???????¡Â????????????¡¦¨½????????¡¦¡§???????????¡Â?", C_WHITE, CC.DefaultFont) then
							AddPersonAttrib(personid,"????????",250)
							if MPDJ(personid) < 6 then
								JoinMP(personid,14,6)
							end	
							for i = 1, JY.Base["????????"] do
								if JY.Person[personid]["????" .. i] == 89 then
									JY.Person[personid]["????" .. i] = 175
									JY.Person[personid]["????????" .. i] = 50
									if JY.Person[personid]["?¨§??????"] == 89 or JY.Person[personid]["?¨§??????"] == 216 or JY.Person[personid]["?¨§??????"] == 259 or JY.Person[personid]["?¨§??????"] == 263 or JY.Person[personid]["?¨§??????"] == 264 then
										JY.Person[personid]["?¨§??????"] = 175
									end
									yes = 2
									--break
								end
							end
							local a = 0
							for j = 1, JY.Base["????????"] do
								local wg = JY.Person[personid]["????"..j]
								if wg == 264 then--??????
									a = j
								end				
							end	
							for i = a, JY.Base["????????"] - 1 do
								JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
								JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
							end
							local a = 0
							for j = 1, JY.Base["????????"] do
								local wg = JY.Person[personid]["????"..j]
								if wg == 263 then--??????
									a = j
								end				
							end	
							for i = a, JY.Base["????????"] - 1 do
								JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
								JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
							end
							local a = 0
							for j = 1, JY.Base["????????"] do
								local wg = JY.Person[personid]["????"..j]
								if wg == 259 then--????¨¢?
									a = j
								end				
							end	
							for i = a, JY.Base["????????"] - 1 do
								JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
								JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
							end
							local a = 0
							for j = 1, JY.Base["????????"] do
								local wg = JY.Person[personid]["????"..j]
								if wg == 216 then--??????
									a = j
								end				
							end	
							for i = a, JY.Base["????????"] - 1 do
								JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
								JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
							end
							JY.Person[personid]["????" .. JY.Base["????????"]] = 0
							JY.Person[personid]["????????" .. JY.Base["????????"]] = 0
						end
						if PersonKF(personid, 30) or PersonKF(personid, 31) or PersonKF(personid, 32) or PersonKF(personid, 33) or PersonKF(personid, 34)  then
							if PersonKF(personid,377) == false then
								if DrawStrBoxYesNo(-1, -1, "??????¡¦¡§????????????¡¦¨½????????¡¦¡§?????????¨½???", C_WHITE, CC.DefaultFont) then
									for i = 1, JY.Base["????????"] do
										if JY.Person[personid]["????" .. i] >= 30 and JY.Person[personid]["????" .. i] <= 34 then
											JY.Person[personid]["????" .. i] = 377
											JY.Person[personid]["????????" .. i] = 999
											
											if JY.Person[personid]["?¨§??????1"] == 34 or JY.Person[personid]["?¨§??????1"] == 33 or JY.Person[personid]["?¨§??????1"] == 32 or JY.Person[personid]["?¨§??????1"] == 31 or JY.Person[personid]["?¨§??????1"] == 30 then
												JY.Person[personid]["?¨§??????1"] = 377
											end
											yes = 2
											break
										end
									end
									local a = 0
									for j = 1, JY.Base["????????"] do
										local wg = JY.Person[personid]["????"..j]
										if wg == 34 then--??????
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["????????"] - 1 do
											JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
											JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
										end
									end	
									local a = 0
									for j = 1, JY.Base["????????"] do
										local wg = JY.Person[personid]["????"..j]
										if wg == 33 then--??????
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["????????"] - 1 do
											JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
											JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
										end
									end
									local a = 0
									for j = 1, JY.Base["????????"] do
										local wg = JY.Person[personid]["????"..j]
										if wg == 32 then--??????
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["????????"] - 1 do
											JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
											JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
										end
									end
									local a = 0
									for j = 1, JY.Base["????????"] do
										local wg = JY.Person[personid]["????"..j]
										if wg == 30 then--????¨¢?
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["????????"] - 1 do
											JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
											JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
										end
									end
									local a = 0
									for j = 1, JY.Base["????????"] do
										local wg = JY.Person[personid]["????"..j]
										if wg == 31 then--??????
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["????????"] - 1 do
											JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
											JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
										end
									end
									JY.Person[personid]["????" .. JY.Base["????????"]] = 0
									JY.Person[personid]["????????" .. JY.Base["????????"]] = 0
								end	
							else
								local a = 0
								for j = 1, JY.Base["????????"] do
									local wg = JY.Person[personid]["????"..j]
									if wg == 34 then--??????
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["????????"] - 1 do
										JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
										JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["????????"] do
									local wg = JY.Person[personid]["????"..j]
									if wg == 33 then--??????
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["????????"] - 1 do
										JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
										JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["????????"] do
									local wg = JY.Person[personid]["????"..j]
									if wg == 32 then--??????
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["????????"] - 1 do
										JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
										JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["????????"] do
									local wg = JY.Person[personid]["????"..j]
									if wg == 30 then--????¨¢?
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["????????"] - 1 do
										JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
										JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["????????"] do
									local wg = JY.Person[personid]["????"..j]
									if wg == 31 then--??????
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["????????"] - 1 do
										JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
										JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
									end
								end
								JY.Person[personid]["????" .. JY.Base["????????"]] = 0
								JY.Person[personid]["????????" .. JY.Base["????????"]] = 0
							end
						end	
					end	
				else
					if PersonKF(personid, 89) and PersonKF(personid, 175) == false  then
						if DrawStrBoxYesNo(-1, -1, "???????¡Â????????????¡¦¨½??????¡Á????¨½?????????????¡Â?", C_WHITE, CC.DefaultFont) then
							for i = 1, JY.Base["????????"] do
								if JY.Person[personid]["????" .. i] == 89 then
									JY.Person[personid]["????" .. i] = 175
									JY.Person[personid]["????????" .. i] = 50
									if JY.Person[personid]["?¨§??????"] == 89 then
										JY.Person[personid]["?¨§??????"] = 175
									end
									yes = 2
									break
								end
							end
						end
					end
				end	
            end
			--????????????????
            if id == 83 then
            	Cat('?????¨²??',personid,243,106)
            end
			--????????????????
            if id == 76 then
                Cat('?????¨²??',personid,241,99)
            end
			--????????????????????
            if id == 403 then
                Cat('?????¨²??',personid,242,247)
            end
            
			--?????¨§?¡ì??????????
            if id == 327 then
                Cat('?????¨²??',personid,163,160)
            end
			--?????¨§???¨®???¨§??????????
            if id == 328 then
                Cat('?????¨²??',personid,225,190)
            end
			--???????? ?¨¹???¨®¡¦¡§????????
            if id == 65 then
                Cat('?????¨²??',personid,219,88)
            end
            --??¡Á???????????¡¦¡§????????
            if id == 428 then
                Cat('?????¨²??',personid,321,271)
            end
			--¡ã??¡è?????¨§??
			if JY.Thing[id]["?¡¦??????"] == 335 then
				Cat('?????¨²??',personid,141,335)
            end
			--?¡§¡Á????????¡§¡Á???????????
            if id == 385 then
                Cat('?????¨²??',personid,92,91)
            end	
			--????¨§??????¨¦?¡§
			if JY.Thing[id]["?¡¦??????"] == 137 then
				Cat('?????¨²??',personid,128,137)
            end
			--??¡¦????????¨®?????¡§
			if JY.Thing[id]["?¡¦??????"] == 133 then
				Cat('?????¨²??',personid,124,133)
            end
			--?¨§¨®?¡¦???????????????????
            if id == 269 then
                Cat('?????¨²??',personid,122,136)
            end	
            --?????????¡è????
            if id == 515 then
            	Cat('?????¨²??',personid,1,347)
            end
            --?¡è????????????
            if id == 90 then
            	Cat('?????¨²??',personid,347,22)
            end
            --¡ã????????????¡ì??
            if 	id == 518 then
            	Cat('?????¨²??',personid,350,267)
            end
            --??????????????
            if id == 137 then
            	Cat('?????¨²??',personid,57,65)
            end			
			--??????????????
			if JY.Thing[id]["?¡¦??????"] == 138 then
				if PersonKF(personid,125) and PersonKF(personid,138) == false then
					if DrawStrBoxYesNo(-1, -1, "??????¡¦¡§????????????¡¦¨½??????????????????????¡¦¡§?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 125 then
                                JY.Person[personid]["????" .. i] = 138
                                JY.Person[personid]["????????" .. i] = 50
								if JY.Person[personid]["?¨§??????1"] == 125 then
                                    JY.Person[personid]["?¨§??????1"] = 138
                                end
                                if JY.Person[personid]["?¨§??????2"] == 125 then
                                    JY.Person[personid]["?¨§??????2"] = 138
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--??¡¦???????????
			if JY.Thing[id]["?¡¦??????"] == 19 then
				if PersonKF(personid,131) and PersonKF(personid,19) == false then
					if DrawStrBoxYesNo(-1, -1, "??????¡¦¡§????????????¡¦¨½????????¡¦???¡¦¡§??????????¡¦¡§?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 131 then
                                JY.Person[personid]["????" .. i] = 19
                                JY.Person[personid]["????????" .. i] = 50
								if JY.Person[personid]["?¨§??????1"] == 131 then
                                    JY.Person[personid]["?¨§??????1"] = 19
                                end
                                if JY.Person[personid]["?¨§??????2"] == 131 then
                                    JY.Person[personid]["?¨§??????2"] = 19
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--?¨²??????????
			if JY.Thing[id]["?¡¦??????"] == 17 then
				if PersonKF(personid,121) and PersonKF(personid,17) == false then
					if DrawStrBoxYesNo(-1, -1, "?¨®?¨ª??¡¦¡§????????????¡¦¨½???????¨²???¡Â??????????¡¦¡§?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 121 then
                                JY.Person[personid]["????" .. i] = 17
                                JY.Person[personid]["????????" .. i] = 50
								if JY.Person[personid]["?¨§??????1"] == 121 then
                                    JY.Person[personid]["?¨§??????1"] = 17
                                end
                                if JY.Person[personid]["?¨§??????2"] == 121 then
                                    JY.Person[personid]["?¨§??????2"] = 17
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--????????????¡¦¡§????????
            if id == 386 then
                if PersonKF(personid, 68) and PersonKF(personid, 200) == false then
                    if DrawStrBoxYesNo(-1, -1, "¡Á¨ª??????????????????¡¦¨½????????????¡¦¡§??????????¡¦¡§?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 68 then
                                JY.Person[personid]["????" .. i] = 200
                                JY.Person[personid]["????????" .. i] = 50
								if JY.Person[personid]["?¨§??????1"] == 68 then
                                    JY.Person[personid]["?¨§??????1"] = 200
                                end
                                if JY.Person[personid]["?¨§??????2"] == 68 then
                                    JY.Person[personid]["?¨§??????2"] = 200
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end		
			--?????? ?¨½¡¦????¡Á?? ????????
            if id == 498 then
                if PersonKF(personid, 68) and PersonKF(personid, 341) == false then
                    if DrawStrBoxYesNo(-1, -1, "¡Á¨ª??????????????????¡¦¨½????????????¡¦¡§?????¨½¡¦????¡Á???", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 68 then
                                JY.Person[personid]["????" .. i] = 341
                                JY.Person[personid]["????????" .. i] = 50
								if JY.Person[personid]["?¨§??????1"] == 68 then
                                    JY.Person[personid]["?¨§??????1"] = 341
                                end
                                if JY.Person[personid]["?¨§??????2"] == 68 then
                                    JY.Person[personid]["?¨§??????2"] = 341
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--?¨¢???? ????¡ã¡Á??¡Á? ????????
			if id == 102 then
                if PersonKF(personid, 123) and PersonKF(personid, 11) == false then
                    if DrawStrBoxYesNo(-1, -1, "??¡¦¡§????????????¡¦¨½???????¨¢????????????¡ã¡Á??¡Á??", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 123 then
                                JY.Person[personid]["????" .. i] = 11
                                JY.Person[personid]["????????" .. i] = 50
								if JY.Person[personid]["?¨§??????1"] == 123 then
                                    JY.Person[personid]["?¨§??????1"] = 11
                                end
                                if JY.Person[personid]["?¨§??????2"] == 123 then
                                    JY.Person[personid]["?¨§??????2"] = 11
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
            --?¨¾¨®????¡§????????????
            if id == 308 then
                if PersonKF(personid, 95) and PersonKF(personid, 180) == false then
                    if DrawStrBoxYesNo(-1, -1, "?¨¾?????¨¦????????????¡¦¨½???????¨¾¨®????????¡§?????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 95 then
                                JY.Person[personid]["????" .. i] = 180
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 95 then
                                    JY.Person[personid]["?¨§??????"] = 180
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
            --?¨½???¡è?¨²????????
            if id == 342 then
                if PersonKF(personid, 94) and PersonKF(personid, 203) == false then
                    if DrawStrBoxYesNo(-1, -1, "?¨§???¡è?¨²????????????¡¦¨½???????¨½?????????¡è?¨²?¡Â?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 94 then
                                JY.Person[personid]["????" .. i] = 203
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 94 then
                                    JY.Person[personid]["?¨§??????"] = 203
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
            --?¨½????¡¦¡§ ?¨½???????? ????????
            if id == 350 then
                if PersonKF(personid, 42) and PersonKF(personid,39) and PersonKF(personid, 139) == false then
                    if DrawStrBoxYesNo(-1, -1, "???????????¨¢?¨¢?¡§????¡¦¨½????????????¡¦¡§???¨½????¡¦¡§?????¨½????????¡¦¡§?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 42 then
                                JY.Person[personid]["????" .. i] = 139
                                JY.Person[personid]["????????" .. i] = 50
                                local a = 0
								for j = 1, JY.Base["????????"] do
									local wg = JY.Person[personid]["????"..j]
									if wg == 39 then--??????
										a = j
									end				
								end	
								for i = a, JY.Base["????????"] - 1 do
									JY.Person[personid]["????" .. i] = JY.Person[personid]["????" .. i+1]
									JY.Person[personid]["????????" .. i] = JY.Person[personid]["????????" .. i+1]
								end
								JY.Person[personid]["????" .. JY.Base["????????"]] = 0
								JY.Person[personid]["????????" .. JY.Base["????????"]] = 0
								if JY.Person[personid]["?¨§??????1"] == 42 or JY.Person[personid]["?¨§??????1"] == 39 then
                                    JY.Person[personid]["?¨§??????1"] = 139
                                end
                                if JY.Person[personid]["?¨§??????2"] == 42 or JY.Person[personid]["?¨§??????2"] == 39 then
                                    JY.Person[personid]["?¨§??????2"] = 139
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--?¨½????¡ã??¡¦ ?????????? ????????
            if id == 331 then
                if PersonKF(personid, 50) and PersonKF(personid, 193) == false then
                    if DrawStrBoxYesNo(-1, -1, "???|????????????????¡¦¨½???¨½????¡ã??¡¦???????????????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 50 then
                                JY.Person[personid]["????" .. i] = 193
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????1"] == 50 then
                                    JY.Person[personid]["?¨§??????1"] = 193
                                end
                                if JY.Person[personid]["?¨§??????2"] == 50 then
                                    JY.Person[personid]["?¨§??????2"] = 193
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--?¨¾?? ??????¡¦¡§ ????????
			if id == 158 then
				if PersonKF(personid, 51) and PersonKF(personid, 58) == false then
                    if DrawStrBoxYesNo(-1, -1, "????????????????????¡¦¨½???¨¾????¡¦¡§?¡¦??????????¡¦¡§?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 51 then
                                JY.Person[personid]["????" .. i] = 58
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????1"] == 51 then
                                    JY.Person[personid]["?¨§??????1"] = 58
                                end
                                if JY.Person[personid]["?¨§??????2"] == 51 then
                                    JY.Person[personid]["?¨§??????2"] = 58
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
            --??????¡¦¡§ ?????¨½??????????
            if id == 295 then
                if PersonKF(personid, 209) and PersonKF(personid, 171) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§?????????¨½???", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 209 then
                                JY.Person[personid]["????" .. i] = 171
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 209 then
                                    JY.Person[personid]["?¨§??????"] = 171
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end 
            --??????¡¦¡§ ?¡Á????????????
            if id == 85 then
                if PersonKF(personid, 208) and PersonKF(personid, 108) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§?????¡Á??????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 208 then
                                JY.Person[personid]["????" .. i] = 108
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 208 then
                                    JY.Person[personid]["?¨§??????"] = 108
                                end
                                yes = 2							
                                break
                            end
                        end
                    end
                end
            end    
            --??????¡¦¡§ ???¨§??????????
            if id == 77 then
                if PersonKF(personid, 210) and PersonKF(personid, 100) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§???????¨§????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 210 then
                                JY.Person[personid]["????" .. i] = 100
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 200 then
                                    JY.Person[personid]["?¨§??????"] = 100
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  
            --??????¡¦¡§ ?¨½?????? ????????
            if id == 280 then
                if PersonKF(personid, 211) and PersonKF(personid, 154) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§?????¨½????????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 211 then
                                JY.Person[personid]["????" .. i] = 154
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 211 then
                                    JY.Person[personid]["?¨§??????"] = 154
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
            --??????¡¦¡§ ¡Á????¨½?? ????????
            if id == 67 then
                if PersonKF(personid, 212) and PersonKF(personid, 89) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§????¡Á????¨½????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 212 then
                                JY.Person[personid]["????" .. i] = 89
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 212 then
                                    JY.Person[personid]["?¨§??????"] = 89
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  	
            --?????????¡Â ?¨§???¡Á???? ????????
            if id == 471 then
                if PersonKF(personid, 250) and PersonKF(personid, 314) == false then
                    if DrawStrBoxYesNo(-1, -1, "?¨®?¨ª????????????????¡¦¨½???????????¡Â?????¨§???¡Á??????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 250 then
                                JY.Person[personid]["????" .. i] = 314
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 250 then
                                    JY.Person[personid]["?¨§??????"] = 314
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end			
            --¨¢?????¡¦¡§ ???????? ????????
            if id == 366 then
                if PersonKF(personid, 213) and PersonKF(personid, 216) == false then
                    if DrawStrBoxYesNo(-1, -1, "¨¢?????????????????????¡¦¨½??¨¢?????¡¦¡§??????????????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 213 then
                                JY.Person[personid]["????" .. i] = 216
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 213 then
                                    JY.Person[personid]["?¨§??????"] = 216
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  
			--??????¡¦¡§ ?¨¾???¡Â ????????
            if id == 420 then
                if PersonKF(personid, 355) and PersonKF(personid, 263) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§?????¨¾???¡Â??", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 355 then
                                JY.Person[personid]["????" .. i] = 263
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 355 then
                                    JY.Person[personid]["?¨§??????"] = 263
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
		    --??????¡¦¡§ ????¨§??? ????????
            if id == 416 then
                if PersonKF(personid, 255) and PersonKF(personid, 259) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§????????¨§?????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 255 then
                                JY.Person[personid]["????" .. i] = 259
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 255 then
                                    JY.Person[personid]["?¨§??????"] = 259
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--??????¡¦¡§ ????¡¦¡§?? ????????
            if id == 421 then
                if PersonKF(personid, 353) and PersonKF(personid, 264) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§????????¡¦¡§????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 353 then
                                JY.Person[personid]["????" .. i] = 264
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 353 then
                                    JY.Person[personid]["?¨§??????"] = 264
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
            --??????¡¦¡§ ?????¡ì?? ????????
            if id == 285 then
                if PersonKF(personid, 214) and PersonKF(personid, 163) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½????????¡¦¡§?????????¨½????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 214 then
                                JY.Person[personid]["????" .. i] = 163
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 214 then
                                    JY.Person[personid]["?¨§??????"] = 163
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  		
            --?¡è¡ã????¡§?? ???¨²?? ????????
            if id == 351 then
                if PersonKF(personid, 215) and PersonKF(personid, 204) == false then
                    if DrawStrBoxYesNo(-1, -1, "?¡è¡ã?????????????????¡¦¨½?????¡§?????????¨²????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 215 then
                                JY.Person[personid]["????" .. i] = 204
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 215 then
                                    JY.Person[personid]["?¨§??????"] = 204
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end 
            --?????? ?????¨½?? ????????
            if id == 70 then
                if PersonKF(personid, 217) and PersonKF(personid, 93) == false then
                    if DrawStrBoxYesNo(-1, -1, "?¡Â??????????????????¡¦¨½?????????????????¨½????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 217 then
                                JY.Person[personid]["????" .. i] = 93
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 217 then
                                    JY.Person[personid]["?¨§??????"] = 93
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end 
			--????
            --?????? ?¨®?????? ????????
            if id == 90 then
                if PersonKF(personid, 1) and PersonKF(personid, 22) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????????¡¦¨½????????????¡¦¡§?????¨®???????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 1 then
                                JY.Person[personid]["????" .. i] = 22
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????1"] == 1 then
                                    JY.Person[personid]["?¨§??????1"] = 22
                                end
                                if JY.Person[personid]["?¨§??????2"] == 1 then
                                    JY.Person[personid]["?¨§??????2"] = 22
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--???????? ???¡è?¨½?? ????????
			if id == 91 then
				if PersonKF(personid, 5) and PersonKF(personid, 21) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????¡¦¡§????????????¡¦¨½?????????????????????¡è?¨½???", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 5 then
                                JY.Person[personid]["????" .. i] = 21
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????1"] == 5 then
                                    JY.Person[personid]["?¨§??????1"] = 21
                                end
                                if JY.Person[personid]["?¨§??????2"] == 5 then
                                    JY.Person[personid]["?¨§??????2"] = 21
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--??¡¦???¡¦¡§ ?¨½¡¦??¨§?? ????????
			if id == 505 then
				if PersonKF(personid, 27) and PersonKF(personid, 162) == false then
                    if DrawStrBoxYesNo(-1, -1, "????????????????????¡¦¨½????????¡¦???¡¦¡§?????¨½¡¦??¨§???", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 27 then
                                JY.Person[personid]["????" .. i] = 162
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????1"] == 27 then
                                    JY.Person[personid]["?¨§??????1"] = 162
                                end
                                if JY.Person[personid]["?¨§??????2"] == 27 then
                                    JY.Person[personid]["?¨§??????2"] = 162
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--???????? ???¡¦??¡¦¡§ ????????
            if id == 422 then
                if PersonKF(personid, 266) and PersonKF(personid, 265) == false then
                    if DrawStrBoxYesNo(-1, -1, "????????????????????????¡¦¨½?????????¡¦??¡¦¡§?????????????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 266 then
                                JY.Person[personid]["????" .. i] = 265
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????1"] == 266 then
                                    JY.Person[personid]["?¨§??????1"] = 265
                                end
                                if JY.Person[personid]["?¨§??????2"] == 266 then
                                    JY.Person[personid]["?¨§??????2"] = 265
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--?????¨¢?? ?¨¢????¡¦¡§ ????????
            if id == 125 then
                if PersonKF(personid, 245) and PersonKF(personid, 36) == false then
                    if DrawStrBoxYesNo(-1, -1, "??????????????????????¡¦¨½???????????¨¢???????¨¢????¡¦¡§?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 245 then
                                JY.Person[personid]["????" .. i] = 36
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????1"] == 245 then
                                    JY.Person[personid]["?¨§??????1"] = 36
                                end
                                if JY.Person[personid]["?¨§??????2"] == 245 then
                                    JY.Person[personid]["?¨§??????2"] = 36
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--?????? ?????¡è?? ????????	????????
			if id == 317 then
                if PersonKF(personid, 227) and PersonKF(personid, 183) == false then
                    if DrawStrBoxYesNo(-1, -1, "???????????¡è????????????????¡¦¨½?????????????????????¡è?????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 227 then
                                JY.Person[personid]["????" .. i] = 183
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 227 then
                                    JY.Person[personid]["?¨§??????"] = 183
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--?¨§?????????¨§??????
			if id == 545 then
                if PersonKF(personid, 90) and PersonKF(personid, 375) == false then
                    if DrawStrBoxYesNo(-1, -1, "?¨§?????¨§?????¡Â????????????¡¦¨½???????¨§?????????¨§?????¡Â?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 90 then
                                JY.Person[personid]["????" .. i] = 375
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 90 then
                                    JY.Person[personid]["?¨§??????"] = 375
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--????????????????
			if id == 537 then
                if PersonKF(personid, 98) and PersonKF(personid, 367) == false then
                    if DrawStrBoxYesNo(-1, -1, "????????????????????????????????¡¦¨½?????????????????????????????", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["????????"] do
                            if JY.Person[personid]["????" .. i] == 98 then
                                JY.Person[personid]["????" .. i] = 367
                                JY.Person[personid]["????????" .. i] = 50
                                if JY.Person[personid]["?¨§??????"] == 98 then
                                    JY.Person[personid]["?¨§??????"] = 367
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
        end
		--?????????¨²???????????¨½???????????¡ì?¨¢???¨¾????¡Á¡ã??????
		if yes == 0 and full == 1 then
			DrawStrBoxWaitKey("????????????????????????", C_WHITE, CC.DefaultFont)
			return 0
		end
    
		--???¡§????
		if CC.Shemale[id] == 1 then
			--???¨½?????????¡ì
			if (personid == 0 and JY.Base["??¡Á?"] == 3) or (personid == 0 and JY.Base["????"] == 652 ) or (personid == 0 and JY.Base["????"] == 189 ) then
				say("?????????????????¡Á??????????????????????????¡¦¨½¡Á???????????????????????¡¦???????????",0,1)
				yes = 1
			--?¡Â???¨¾?????¡§¡Á??????????????¡ì
			--elseif personid == 0 and CC.TX["??¡ã??¡ã??"] == 2 then
				--yes = 1
			elseif personid == 0 and JY.Base["????"] == 773 then	
			    say("??¡¦¨¾???¨²???¨§?????¨²??????????¡Á???????????????????",773,1)
			    yes = 1
			elseif personid == 0 and JY.Base["????"] == 457 then	
			    say("????¡¦?????¡ã??????¡è?????????¡§??????¡Á????¨ª??????????",457,1)
			    yes = 1	
			elseif personid == 92 then
				say("??????????????????",92,1)
				return 0
			elseif personid == 0 and JY.Base['??¡Á?'] == 10 then
				say("?¨¢???¨®????¡Á????¨½???¡ì?????¡ã?????¡ì??",0,1)
				return 0
			elseif personid == 520 then
				say("?????????¡§????????????¡ã??¡¦????",520,1)
				return 0	
			elseif JY.Person[personid]["????"] == 0 and CanUseThing(id, personid) then
				Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
				if DrawStrBoxYesNo(-1, -1, "???????¨¦??????????¡Á???????¡¦¨½?????????", C_WHITE, CC.DefaultFont) == false then
					return 0
				else
					lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_RED, 128)
					ShowScreen()
					lib.Delay(80)
					lib.ShowSlow(15, 1)
					Cls()
					lib.ShowSlow(50, 0)
					JY.Person[personid]["????"] = 2
					local add, str = AddPersonAttrib(personid, "???¡Â??", -20)
					DrawStrBoxWaitKey(JY.Person[personid]["????"] .. str, C_ORANGE, CC.DefaultFont)
					add, str = AddPersonAttrib(personid, "¡¦?????", -30)
					DrawStrBoxWaitKey(JY.Person[personid]["????"] .. str, C_ORANGE, CC.DefaultFont)
					--[[
					if JY.Base["??¡Á?"] > 0 then
						JY.Person[0]["????"] = "????"
						JY.Person[0]["????2"] = "???¡¦"
						local zddh = 227
						local js = JY.Base["??¡Á?"]
						local jsdz = JY.Person[0]["?¡¦?¨½?¨²??"]
						if js == 3 then
						jsdz = 228
						elseif js == 4 then
						jsdz = 229
						elseif js == 5 then
						jsdz = 230
						else
						jsdz = 227
						   end
						JY.Person[0]["¡ã??¨ª?¨½"] = 555+JY.Base["??¡Á?"]
						local f_ani = {
                         {0, 0, 0}, 
				         {9, 9, 7}, 
			            {8, 8, 6}, 
				        {8, 8, 6}, 
				        {9, 7, 7}}
						for i = 1, 5 do
							JY.Person[0]["????????????" .. i] = f_ani[i][1]
							JY.Person[0]["????????????" .. i] = f_ani[i][3]
							JY.Person[0]["???????¡ì????" .. i] = f_ani[i][2]
						end
					end
					]]
				end
	
			elseif JY.Person[personid]["????"] == 1 then
				DrawStrBoxWaitKey("???????????????????¡¦", C_WHITE, CC.DefaultFont)
				return 0
			end
		end


		if yes == 1 or CanUseThing(id, personid) then
			if JY.Thing[id]["??????"] == personid then
				return 0
			end
			if JY.Person[personid]["???????¡¦"] >= 0 then
				JY.Thing[JY.Person[personid]["???????¡¦"]]["??????"] = -1
			end
			if JY.Thing[id]["??????"] >= 0 then
				JY.Person[JY.Thing[id]["??????"]]["???????¡¦"] = -1
				JY.Person[JY.Thing[id]["??????"]]["???¡¦????????"] = 0
			end
			JY.Thing[id]["??????"] = personid
			JY.Person[personid]["???????¡¦"] = id
			JY.Person[personid]["???¡¦????????"] = 0
		else
			DrawStrBoxWaitKey("???????????????????¡¦", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	return 1
end

--?????????????????¡¦?????¡¦
function UseThing_Type3(id)
	local usepersonid = -1
	local amount_use = 0
	Cls()
	if JY.Status == GAME_MMAP or JY.Status == GAME_SMAP then
		--Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
		DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, string.format("????????%s?", JY.Thing[id]["????"]), C_WHITE, CC.DefaultFont)
		local nexty = CC.MainSubMenuY + CC.SingleLineHeight
		local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
		if r > 0 then
			usepersonid = JY.Base["???¨¦" .. r]

	
			--¡¦????¡¦???????¨²??????
			local max_amount = 0
			for i = 1, CC.MyThingNum do
				if JY.Base["???¡¦" .. i] == id then
					max_amount = JY.Base["???¡¦????" .. i]
					break;
				end
			end
			amount_use = InputNum("????????", 1, max_amount)
		end
	
	--???¡¦??
	elseif JY.Status == GAME_WMAP then
		--?¨²?????????¨¾????????
		if match_ID(WAR.Person[WAR.CurID]["????????"], 16) then
			War_CalMoveStep(WAR.CurID, 8, 1)
			local x, y = War_SelectMove()
			if x ~= nil then
				local emeny = GetWarMap(x, y, 2)
				if emeny >= 0 and WAR.Person[WAR.CurID]["??¡¦?"] == WAR.Person[emeny]["??¡¦?"] then
					usepersonid = WAR.Person[emeny]["????????"]
				end
			end
		else
			usepersonid = WAR.Person[WAR.CurID]["????????"]
		end
	end

	--???¡¦?????????????????????????¡¦
	if JY.Status == GAME_WMAP and (id >=14 and id <= 21) then
		return 0
	end
	
	if usepersonid >= 0 then
		--¡¦????¡¦?????????¡¦
		if JY.Status == GAME_MMAP or JY.Status == GAME_SMAP then

			local r = UseThingEffect(id, usepersonid, amount_use)
			if r == 1 then
				instruct_32(id, -amount_use)
				WaitKey()
			elseif r == 2 then
				instruct_32(id, -amount_use)
			end
			if id == 14 then
                JY.Person[usepersonid]["?¨²?¨¹???¡è"] = JY.Person[usepersonid]["?¨²?¨¹???¡è"]+amount_use
                if JY.Person[usepersonid]["?¨²?¨¹???¡è"] > 12 then
                    JY.Person[usepersonid]["?¨²?¨¹???¡è"] = 12
                end
                Hp_Max(usepersonid)
            end
		--???¡¦?????????¡¦
		elseif JY.Status == GAME_WMAP then
			if UseThingEffect(id, usepersonid) == 1 then
				instruct_32(id, -1)
                if id >= 22 and id <= 25 and match_ID(usepersonid, 9965) then 
                    WAR.PD['¡ã?????'][usepersonid] = (WAR.PD['¡ã?????'][usepersonid] or 0) + 1
                    WAR.PD['????'][usepersonid] = (WAR.PD['????'][usepersonid] or 0) + 500
                    CurIDTXDH(WAR.CurID, 79,1,"???¨½?¡è¡ã?????",C_ORANGE);
                end
			end
		end
	else
		return 0
	end
	return 1
end

--¡ã??¡Â???¡¦
function UseThing_Type4(id)
	if JY.Status == GAME_WMAP then
		return War_UseAnqi(id)
	end
	return 0
end

--------------------------------------------------------------------------------
--------------------------------------?????¡Â??-----------------------------------

--?????¡Â???¡Â????
--id??d*????????
--flag 1 ???¨½??¡¦???2?????¡¦??¡¦???3???¡¦????¡¦?
function EventExecute(id,flag)
    JY.CurrentD=id;

    oldEventExecute(flag)

    JY.CurrentD=-1;
end

--?¡Â???????????¡§??????????
--??????????¡Á??¨½????  oldevent_xxx();  xxx??????????
function oldEventExecute(flag)
	local eventnum = nil
	if flag == 1 then
		eventnum = GetD(JY.SubScene, JY.CurrentD, 2)
	elseif flag == 2 then
		eventnum = GetD(JY.SubScene, JY.CurrentD, 3)
	elseif flag == 3 then
		eventnum = GetD(JY.SubScene, JY.CurrentD, 4)
	end
	if eventnum > 0 then
			lib.Debug(eventnum.."");
		end
	if eventnum > 0 then
		CallCEvent(eventnum)  
	end
end

function existFile(filename)
    local f = io.open(filename)
    if f == nil then
        return false
    end
    io.close(f)
    return true
end
--[[
function CallCEvent(eventnum)
	local eventfilename = string.format("%s%d.lua", CONFIG.CEventPath,eventnum)
	if existFile(eventfilename) then
		dofile(eventfilename)
		return true
	else
		return false
	end
end
]]
function CallCEvent(eventnum)
	if newkdef[eventnum]~=nil then--?¡Á????????????????????¡¦¨½????
		lib.Debug("new kdef "..eventnum)--?????????????????????¡ã????debug???????¨¾????  new kdef +???????????????¡Â????????
		if eventnum>0 then--?????????????¨®??0
			newkdef[eventnum]()--??????????
		end
	end
end

--?????¨®????¡Á??????????¡ã?????¨®??????????¡Á???
function ChangeMMap(x,y,direct)          --?????¨®????¡Á???
	JY.Base["??X"]=x;
	JY.Base["??Y"]=y;
	JY.Base["??¡¦??¨¾"]=direct;
end

--???????¡ã???¡ã
function ChangeSMap(sceneid,x,y,direct)       --???????¡ã???¡ã
    JY.SubScene=sceneid;
	JY.Base["??X1"]=x;
	JY.Base["??Y1"]=y;
	JY.Base["??¡¦??¨¾"]=direct;
end


--????(x1,y1)-(x2,y2)??????????¡Á?????
--???????????????¨¾?????????????¨ª??
--¡Á?????????????????????????????
function Cls(x1,y1,x2,y2)                    --????????
    if x1==nil then        --????????????nil,?¨ª??????????????????
	    x1=0;
		y1=0;
		x2=CC.ScreenW;
		y2=CC.ScreenH;
	end

	lib.SetClip(x1,y1,x2,y2);

	if JY.Status==GAME_START then
	    lib.FillColor(0,0,0,0,0);
        lib.LoadPicture(CC.FirstFile,-1,-1);
	elseif JY.Status==GAME_MMAP then
        lib.DrawMMap(JY.Base["??X"],JY.Base["??Y"],GetMyPic());             --?????¡Â????
	elseif JY.Status==GAME_SMAP then
        DrawSMap();
	elseif JY.Status==GAME_WMAP then
        WarDrawMap(0);
	elseif JY.Status==GAME_DEAD then
	    lib.FillColor(0,0,0,0,0);
        lib.LoadPicture(CC.DeadFile,-1,-1);
    else 
        lib.FillColor(0, 0, 0, 0, 0)
	end
	lib.SetClip(0,0,CC.ScreenW,CC.ScreenH);
end


--?¨²?¨²???¡ã??????????¡Á?¡¦???????????n??????¡Á?¡¦???????????
function GenTalkString(str,n)             					 --?¨²?¨²???¡ã??????????¡Á?¡¦???
    local tmpstr="";
    for s in string.gmatch(str .. "*","(.-)%*") do           --???????¡ã????????*. ¡Á?¡¦?????????????????????????¡¦¡§????
        tmpstr=tmpstr .. s;
    end

    local newstr="";
    while #tmpstr>0 do
		local w=0;
		while w<#tmpstr do
		    local v=string.byte(tmpstr,w+1);	--???¡ã¡Á?¡¦?????
			if v>=128 then
			    w=w+2;
			else
			    w=w+1;
			end
			if w >= 2*n-1 then					--????????????????¡Á?¡¦?
			    break;
			end
		end

        if w<#tmpstr then
		    if w==2*n-1 and string.byte(tmpstr,w+1)<128 then
				newstr=newstr .. string.sub(tmpstr,1,w+1) .. "*";
				tmpstr=string.sub(tmpstr,w+2,-1);
			else
				newstr=newstr .. string.sub(tmpstr,1,w)  .. "*";
				tmpstr=string.sub(tmpstr,w+1,-1);
			end
		else
		    newstr=newstr .. tmpstr;
			break;
		end
	end
    return newstr;
end

--?????????¡ã
function TalkEx(s,pid,flag,name)
	say(s,pid,flag,name)
end

--??????????????????
function instruct_test(s)
    DrawStrBoxWaitKey(s,C_ORANGE,24);
end

--????
function instruct_0()         --????
    Cls();
end

function ReadTalk(id, flag)
	local tidx = Byte.create(id * 4 + 4)
	Byte.loadfile(tidx, CC.TDX, 0, id * 4 + 4)
	local idx1, idx2 = nil, nil
	if id < 1 then
		idx1 = 0
	else
		idx1 = Byte.get32(tidx, (id - 1) * 4)
	end
	idx2 = Byte.get32(tidx, id * 4)
	local len = idx2 - idx1
	local talk = Byte.create(len)
	Byte.loadfile(talk, CC.TRP, idx1, len)
	local str = ""
	for i = 0, len - 2 do
		local byte = Byte.getu16(talk, i)
		byte = 255 - math.fmod(byte, 256)
		str = str .. string.char(byte)
	end
	if flag == nil then
		str = lib.CharSet(str, 0)
		str = GenTalkString(str, 12)
	end
	return str
end

	
--???¡ã
--talkid: ????¡Á????¨¾?????¡ã????????¡Á?¡¦??????¨¾?????¡ã???¨ª??
--headid: ?¡¦?¨½id
--flag :???¡ã?¨¾??????0 ??????¡¦?????, ¡Á¨®???¡¦?¨½?????????¡ã
--            1 ??????¡¦?????, ¡Á¨®?????¡ã???????¡¦?¨½
--            2 ??????¡¦?????, ¡Á¨®?????????????¡ã
--            3 ??????¡¦?????, ¡Á¨®?????¡ã????????
--            4 ??????¡¦?????, ¡Á¨®?????¡ã???????¡¦?¨½
--            5 ??????¡¦?????, ¡Á¨®???¡¦?¨½?????????¡ã
function instruct_1(talkid, headid, flag)
	local s = ReadTalk(talkid)
	if s == nil then
		return 
	end
	TalkEx(s, headid, flag)
end

--???????¡¦
function instruct_2(thingid, num)
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	if JY.Thing[thingid] == nil then
		return 
	end
	instruct_32(thingid, num)
	if num > 0 then
		--DrawStrBoxWaitKey(string.format("???????¡¦%sX%d", "????"..JY.Thing[thingid]["????"].."????", num), C_ORANGE, CC.DefaultFont, 1)
		Cls()
		local name = "??"..JY.Thing[thingid]["????"].."X"..num
		lib.LoadPNG(91,121*2,CC.ScreenW/1360*355+bx*212,CC.ScreenH/768*373+by*33.5,1)
		tjm(CC.ScreenW/1360*425+bx*212,CC.ScreenH/768*386+by*33.5,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
		ShowScreen()
		WaitKey()
		Cls()
	else
		-- DrawStrBoxWaitKey(string.format("?¡ì?????¡¦%sX%d", "????"..JY.Thing[thingid]["????"].."????", -num), C_ORANGE, CC.DefaultFont, 1)
		Cls()
		local name =  "??"..JY.Thing[thingid]["????"].."X"..-num
		lib.LoadPNG(91,122*2,CC.ScreenW/1360*355+bx*212,CC.ScreenH/768*373+by*33.5,1)
		tjm(CC.ScreenW/1360*425+bx*212,CC.ScreenH/768*386+by*33.5,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
		ShowScreen()
		WaitKey()
		Cls()
	end
	if thingid >= CC.BookStart and thingid < CC.BookStart + CC.BookNum then
		instruct_2(174, 2000)
		JY.Person[512]["????"] = JY.Person[512]["????"] + 1
	end
	--[[if 0 < num then
        DrawStrBoxWaitKey(string.format("???????¡¦:%s %d", JY.Thing[thingid]["????"], num), C_ORANGE, CC.DefaultFont)
    else
        DrawStrBoxWaitKey(string.format("?¡ì?????¡¦:%s %d", JY.Thing[thingid]["????"], -num), C_ORANGE, CC.DefaultFont)
    end]]
    for i = 144, 157 do
        local str = ""
		if thingid == i and num == 1 then
            if JY.Base["????"] >= 1 then
                local hd = math.random(3)
                if hd == 1 then
					str = "?????????¡§????"
                    JY.Person[318]["????????"] = JY.Person[318]["????????"] + 1
                elseif hd == 2 then
                    str = "??????????¡Á?????"
                    JY.Person[318]["????????"] = JY.Person[318]["????????"] + 1
                else
                    str = "???????¨½?¡§????"
                    JY.Person[318]["????????"] = JY.Person[318]["????????"] + 1
                end
            else
                str = "??????????¡Á????????¡§?????¨½?¡§?¡Â????"
                JY.Person[318]["????????"] = JY.Person[318]["????????"] + 1
                JY.Person[318]["????????"] = JY.Person[318]["????????"] + 1
                JY.Person[318]["????????"] = JY.Person[318]["????????"] + 1
            end
			Cls()
			local name = "??"..str
			lib.LoadPNG(91,121*2,CC.ScreenW/1360*355+bx*212,CC.ScreenH/768*373+by*33.5,1)
			tjm(CC.ScreenW/1360*425+bx*212,CC.ScreenH/768*386+by*33.5,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
			ShowScreen()
			WaitKey()
			Cls()
        end
    end
    instruct_2_sub()
end

--???????¡§???¡ã¡Á?????????
function instruct_3(sceneid, id, v0, v1, v2, v3, v4, v5, v6, v7, v8, v9, v10)
	if JY.Restart == 1 then
		return
	end
  if sceneid == -2 then
    sceneid = JY.SubScene
  end
  if id == -2 then
    id = JY.CurrentD
  end
  if v0 ~= -2 then
    SetD(sceneid, id, 0, v0)
  end
  if v1 ~= -2 then
    SetD(sceneid, id, 1, v1)
  end
  if v2 ~= -2 then
    SetD(sceneid, id, 2, v2)
  end
  if v3 ~= -2 then
    SetD(sceneid, id, 3, v3)
  end
  if v4 ~= -2 then
    SetD(sceneid, id, 4, v4)
  end
  if v5 ~= -2 then
    SetD(sceneid, id, 5, v5)
  end
  if v6 ~= -2 then
    SetD(sceneid, id, 6, v6)
  end
  if v7 ~= -2 then
    SetD(sceneid, id, 7, v7)
  end
  if v8 ~= -2 then
    SetD(sceneid, id, 8, v8)
  end
  if v9 ~= -2 and v10 ~= -2 and v9 > 0 and v10 > 0 then
    SetS(sceneid, GetD(sceneid, id, 9), GetD(sceneid, id, 10), 3, -1)
    SetD(sceneid, id, 9, v9)
    SetD(sceneid, id, 10, v10)
    SetS(sceneid, GetD(sceneid, id, 9), GetD(sceneid, id, 10), 3, id)
  end
end

function instruct_4(thingid)
	if JY.CurrentThing == thingid then
		JY.ThingUse = thingid
		return true
	else
		return false
	end
end

function instruct_5()
	return DrawStrBoxYesNo(-1, -1, "??¡¦¨½????????(Y/N)?", C_ORANGE, CC.DefaultFont)
end

function instruct_6(warid, tmp, tmp, flag)
	return WarMain(warid, flag)
end

function instruct_7()
	instruct_test("????7????")
end

function instruct_8(musicid)
	JY.MmapMusic = musicid
end

function instruct_9()
	return DrawStrBoxYesNo(-1, -1, "??¡¦¨½???¨®????(Y/N)?", C_ORANGE, CC.DefaultFont)
end

--????????
function instruct_10(personid)
	if JY.Person[personid] == nil then
		lib.Debug("instruct_10 error: person id not exist")
		return 
	end
	local add = 0
	--????????????????????¡Á???
	if personid ~= JY.Base["????"] then
		for i = 2, CC.TeamNum do
			if JY.Base["???¨¦" .. i] < 0 then
			  JY.Base["???¨¦" .. i] = personid
			  add = 1
			  break;
			end
		end
	end	
	for i = 1, 4 do
		local id = JY.Person[personid]["???????¡¦" .. i]
		local n = JY.Person[personid]["???????¡¦????" .. i]
		if n < 0 then
			n = 0
		end
		if id >= 0 and n > 0 then
			instruct_2(id, n)
			JY.Person[personid]["???????¡¦" .. i] = -1
			JY.Person[personid]["???????¡¦????" .. i] = 0
		end
	end
	if add == 0 then
		lib.Debug("instruct_10 error: ???????¨¦???¨²")
		return
	end
end

function instruct_11()
	return DrawStrBoxYesNo(-1, -1, "??¡¦¨½(Y/N)?", C_ORANGE, CC.DefaultFont)
end

--????
function instruct_12(flag)
	for i = 1, CC.TeamNum do
		local id = JY.Base["???¨¦" .. i]
		if id >= 0 then
			JY.Person[id]["????????"] = 0
			JY.Person[id]["????????"] = 0
			JY.Person[id]["??¡¦?????"] = 0
			JY.Person[id]["¡Á???????"] = 0
			AddPersonAttrib(id, "????", math.huge)
			AddPersonAttrib(id, "?¨²?¨¹", math.huge)
			AddPersonAttrib(id, "????", math.huge)
		end
	end
end

--dark
function instruct_13()
	if JY.Restart == 1 then
		return
	end
	Cls()
	JY.Darkness = 0
	lib.ShowSlow(20, 0)
	lib.GetKey()
end

--light
function instruct_14()
	if JY.Restart == 1 then
		return
	end
	lib.ShowSlow(20, 1)
	JY.Darkness = 1
end

function instruct_15()
	JY.Status = GAME_DEAD
	dark()
	light()
	Cls()
	DrawString(CC.GameOverX, CC.GameOverY, JY.Person[0]["????"], RGB(0, 0, 0), CC.DefaultFont)
	local x = CC.ScreenW - 9 * CC.DefaultFont
	DrawString(x, 10, os.date("%Y-%m-%d %H:%M"), RGB(216, 20, 24), CC.DefaultFont)
	DrawString(x, 10 + CC.DefaultFont + CC.RowPixel, "?????¨¾??????", RGB(216, 20, 24), CC.DefaultFont)
	DrawString(x, 10 + (CC.DefaultFont + CC.RowPixel) * 2, "???????????¡ì¡Á???", RGB(216, 20, 24), CC.DefaultFont)
	DrawString(x, 10 + (CC.DefaultFont + CC.RowPixel) * 3, "????????????????", RGB(216, 20, 24), CC.DefaultFont)
	local loadMenu = {
	{"???¨½????", nil, 1},  
	{"??????????", nil, 1}}
	local y = CC.ScreenH - 4 * (CC.DefaultFont + CC.RowPixel) - 10
	local sl = ShowMenu(loadMenu, #loadMenu, 0, x, y, 0, 0, 0, 0, CC.DefaultFont, C_ORANGE, C_WHITE)
	if sl ==1 then
		local r = SaveList();
			if r < 1 then
				JY.Status = GAME_END
				return 0;
			end
			
			Cls();
			DrawStrBox(-1,CC.StartMenuY,"?????¨¾...",C_GOLD,CC.DefaultFont);
			ShowScreen();
			local result = LoadRecord(r);
			if result ~= nil then
				instruct_15();
				return 0;
			end
		if JY.Base["????"] ~= -1 then
			JY.Status = GAME_SMAP
			JY.SubScene = JY.Base["????"]
			JY.MmapMusic = -1
			JY.MyPic = GetMyPic()
			Init_SMap(1)
		else
			JY.SubScene = -1
			JY.Status = GAME_FIRSTMMAP
		end
		ShowScreen()
		lib.LoadPicture("", 0, 0)
		lib.GetKey()
		Game_Cycle()
	else
		JY.Status = GAME_END
	end
end

function inteam(pid)
	local r = false
	local xwperson;	--???¡§????
	--¡¦????¡¦?????¨²?¡ì????????¡¦????¨¦?????¡§
	if pid == JY.Base["????"] and JY.Status ~= GAME_WMAP then
		xwperson = 0
	else
		xwperson = pid
	end
	for i = 1, CC.TeamNum do
		if xwperson == JY.Base["???¨¦" .. i] then
			r = true
			break;
		end
	end
	return r
end

function instruct_16(personid)
	local r = false
	local xwperson;	--???¡§????
	--¡¦????¡¦?????¨²?¡ì????????¡¦????¨¦?????¡§
	if personid == JY.Base["????"] and JY.Status ~= GAME_WMAP then
		xwperson = 0
	else
		xwperson = personid
	end
	for i = 1, CC.TeamNum do
		if xwperson == JY.Base["???¨¦" .. i] then
			r = true
			break;
		end
	end
	return r
end

function instruct_17(sceneid, level, x, y, v)
	if sceneid == -2 then
		sceneid = JY.SubScene
	end
	SetS(sceneid, x, y, level, v)
end

function instruct_18(thingid,sl)
	if sl == nil then
		for i = 1, CC.MyThingNum do
			if JY.Base["???¡¦" .. i] == thingid then
				return true
			end
		end
	else
		for i = 1, CC.MyThingNum do
			if JY.Base["???¡¦" .. i] == thingid and JY.Base["???¡¦????" .. i] >= sl then
				return true
			end
		end
	end	
	return false
end

function instruct_19(x, y)
	JY.Base["??X1"] = x
	JY.Base["??Y1"] = y
	JY.SubSceneX = 0
	JY.SubSceneY = 0
end

function instruct_20()
	if JY.Base["???¨¦" .. CC.TeamNum] >= 0 then
		return true
	end
	return false
end

--????????
function instruct_21(personid)
	if JY.Person[personid] == nil then
		lib.Debug("instruct_21 error: personid not exist")
		return 
	end
	local j = 0
	for i = 1, CC.TeamNum do
		if personid == JY.Base["???¨¦" .. i] then
		  j = i
		end
	end
	if j == 0 then
		return 
	end
	for i = j + 1, CC.TeamNum do
		JY.Base["???¨¦" .. i - 1] = JY.Base["???¨¦" .. i]
	end
	JY.Base["???¨¦" .. CC.TeamNum] = -1
	if JY.Person[personid]["???¡Â"] >= 0 then
		JY.Thing[JY.Person[personid]["???¡Â"]]["??????"] = -1
		JY.Person[personid]["???¡Â"] = -1
	end
	if JY.Person[personid]["¡¦???"] >= 0 then
		JY.Thing[JY.Person[personid]["¡¦???"]]["??????"] = -1
		JY.Person[personid]["¡¦???"] = -1
	end
	if JY.Person[personid]["¡Á???"] >= 0 then
		JY.Thing[JY.Person[personid]["¡Á???"]]["??????"] = -1
		JY.Person[personid]["¡Á???"] = -1
	end	
	if JY.Person[personid]["???????¡¦"] >= 0 then
		JY.Thing[JY.Person[personid]["???????¡¦"]]["??????"] = -1
		JY.Person[personid]["???????¡¦"] = -1
	end
	JY.Person[personid]["???¡¦????????"] = 0
end

function instruct_22()
	for i = 1, CC.TeamNum do
		if JY.Base["???¨¦" .. i] >= 0 then
			JY.Person[JY.Base["???¨¦" .. i]]["????"] = 0
		end
	end
end

function instruct_23(personid, value)
	JY.Person[personid]["????????"] = value
	AddPersonAttrib(personid, "????????", 0)
end

function instruct_24()
	instruct_test("????24????")
end

--???¡¦????
function instruct_25(x1, y1, x2, y2)
	if JY.Restart == 1 then
		return
	end
	local sign = nil
	if y1 ~= y2 then
		if y2 < y1 then
			sign = -1
		else
			sign = 1
		end
		for i = y1 + sign, y2, sign do
			lib.GetKey()
			local t1 = lib.GetTime()
			JY.SubSceneY = JY.SubSceneY + sign
			DrawSMap()
			ShowScreen()
			local t2 = lib.GetTime()
			if t2 - t1 < CC.SceneMoveFrame then
				lib.Delay(CC.SceneMoveFrame - (t2 - t1))
			end
		end
	end
	if x1 ~= x2 then
		if x2 < x1 then
			sign = -1
		else
			sign = 1
		end
		for i = x1 + sign, x2, sign do
			lib.GetKey()
			local t1 = lib.GetTime()
			JY.SubSceneX = JY.SubSceneX + sign
			DrawSMap()
			ShowScreen()
			local t2 = lib.GetTime()
			if t2 - t1 < CC.SceneMoveFrame then
				lib.Delay(CC.SceneMoveFrame - (t2 - t1))
			end
		end
	end
end

function instruct_26(sceneid, id, v1, v2, v3)
	if sceneid == -2 then
		sceneid = JY.SubScene
	end
	local v = GetD(sceneid, id, 2)
	SetD(sceneid, id, 2, v + v1)
	v = GetD(sceneid, id, 3)
	SetD(sceneid, id, 3, v + v2)
	v = GetD(sceneid, id, 4)
	SetD(sceneid, id, 4, v + v3)
end

function instruct_27(id, startpic, endpic)
	local old1, old2, old3 = nil
	if id ~= -1 then
		old1 = GetD(JY.SubScene, id, 5)
		old2 = GetD(JY.SubScene, id, 6)
		old3 = GetD(JY.SubScene, id, 7)
	end
	for i = startpic, endpic, 2 do
		lib.GetKey()
		local t1 = lib.GetTime()
		if id == -1 then
			JY.MyPic = i / 2
		else
			SetD(JY.SubScene, id, 5, i)
			SetD(JY.SubScene, id, 6, i)
			SetD(JY.SubScene, id, 7, i)
		end
		DtoSMap()
		DrawSMap()
		ShowScreen()
		local t2 = lib.GetTime()
		if t2 - t1 < CC.AnimationFrame then
			lib.Delay(CC.AnimationFrame - (t2 - t1))
		end
	end
	if id ~= -1 then
		SetD(JY.SubScene, id, 5, old1)
		SetD(JY.SubScene, id, 6, old2)
		SetD(JY.SubScene, id, 7, old3)
	end
end

function instruct_28(personid, vmin, vmax)
	local v = JY.Person[personid]["?¡¦??"]
	if vmin <= v and v <= vmax then
		return true
	else
		return false
	end
end

function instruct_29(personid, vmin, vmax)
	local v = JY.Person[personid]["???¡Â??"]
	if vmin <= v and v <= vmax then
		return true
	else
		return false
	end
end

--????¡Á???????
function instruct_30(x1, y1, x2, y2)
	if JY.Restart == 1 then
		return
	end
  if x1 < x2 then
    for i = x1 + 1, x2 do
      local t1 = lib.GetTime()
      instruct_30_sub1(1)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  elseif x2 < x1 then
    for i = x2 + 1, x1 do
      local t1 = lib.GetTime()
      instruct_30_sub1(2)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  end
  if y1 < y2 then
    for i = y1 + 1, y2 do
      local t1 = lib.GetTime()
      instruct_30_sub1(3)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  elseif y2 < y1 then
    for i = y2 + 1, y1 do
      local t1 = lib.GetTime()
      instruct_30_sub1(0)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  end
end

function instruct_30_sub1(direct)
  local x, y = nil, nil
  AddMyCurrentPic()
  x = JY.Base["??X1"] + CC.DirectX[direct + 1]
  y = JY.Base["??Y1"] + CC.DirectY[direct + 1]
  JY.Base["??¡¦??¨¾"] = direct
  JY.MyPic = GetMyPic()
  DtoSMap()
  if SceneCanPass(x, y) == true then
    JY.Base["??X1"] = x
    JY.Base["??Y1"] = y
  end
  JY.Base["??X1"] = limitX(JY.Base["??X1"], 1, CC.SWidth - 2)
  JY.Base["??Y1"] = limitX(JY.Base["??Y1"], 1, CC.SHeight - 2)
  DrawSMap()
  ShowScreen()
  return 1
end

function instruct_30_sub(direct)
  local x, y = nil, nil
  local d_pass = GetS(JY.SubScene, JY.Base["??X1"], JY.Base["??Y1"], 3)

  if d_pass >= 0 and d_pass ~= JY.OldDPass then
    EventExecute(d_pass, 3)
    JY.OldDPass = d_pass
    JY.oldSMapX = -1
    JY.oldSMapY = -1
    JY.D_Valid = nil
  end

  JY.OldDPass = -1
  local isout = 0
  if (((JY.Scene[JY.SubScene]["????X1"] == JY.Base["??X1"] and JY.Scene[JY.SubScene]["????Y1"] == JY.Base["??Y1"]) or JY.Scene[JY.SubScene]["????X2"] ~= JY.Base["??X1"] or JY.Scene[JY.SubScene]["????Y2"] == JY.Base["??Y1"] or JY.Scene[JY.SubScene]["????X3"] == JY.Base["??X1"] and JY.Scene[JY.SubScene]["????Y3"] == JY.Base["??Y1"])) then
    isout = 1
  end
  if isout == 1 then
    JY.Status = GAME_MMAP
    --lib.PicInit()
    CleanMemory()
    lib.ShowSlow(20, 1)
    if JY.MmapMusic < 0 then
      JY.MmapMusic = JY.Scene[JY.SubScene]["????????"]
    end
    Init_MMap()
    JY.SubScene = -1
    JY.oldSMapX = -1
    JY.oldSMapY = -1
    lib.DrawMMap(JY.Base["??X"], JY.Base["??Y"], GetMyPic())
    lib.ShowSlow(20, 0)
    lib.GetKey()
    return 
  end
  if JY.Scene[JY.SubScene]["??¡Á????¡ã"] >= 0 and JY.Base["??X1"] == JY.Scene[JY.SubScene]["??¡Á???X1"] and JY.Base["??Y1"] == JY.Scene[JY.SubScene]["??¡Á???Y1"] then
    JY.SubScene = JY.Scene[JY.SubScene]["??¡Á????¡ã"]
    lib.ShowSlow(20, 1)
    if JY.Scene[JY.SubScene]["???¡ã????X1"] == 0 and JY.Scene[JY.SubScene]["???¡ã????Y1"] == 0 then
      JY.Base["??X1"] = JY.Scene[JY.SubScene]["????X"]
      JY.Base["??Y1"] = JY.Scene[JY.SubScene]["????Y"]
    else
      JY.Base["??X1"] = JY.Scene[JY.SubScene]["??¡Á???X2"]
      JY.Base["??Y1"] = JY.Scene[JY.SubScene]["??¡Á???Y2"]
    end
    Init_SMap(1)
    return 
  end
  AddMyCurrentPic()
  x = JY.Base["??X1"] + CC.DirectX[direct + 1]
  y = JY.Base["??Y1"] + CC.DirectY[direct + 1]
  JY.Base["??¡¦??¨¾"] = direct
  JY.MyPic = GetMyPic()
  DtoSMap()
  if SceneCanPass(x, y) == true then
    JY.Base["??X1"] = x
    JY.Base["??Y1"] = y
  end
  JY.Base["??X1"] = limitX(JY.Base["??X1"], 1, CC.SWidth - 2)
  JY.Base["??Y1"] = limitX(JY.Base["??Y1"], 1, CC.SHeight - 2)
  DrawSMap()
  ShowScreen()
  return 1
end

--????????¡¦¨½¡Á???
function instruct_31(num)
	local r = false
    if num <= CC.Gold then 
        return true    
    end
	return r
end

--?????????????¡¦??????
function instruct_32(thingid, num)
	local p = 1
	--?¡Á???????¨½????????????30000¡Á?????30000
	for i = 1, CC.MyThingNum do
		if JY.Base["???¡¦" .. i] == thingid then
			if thingid == 174 then 
				--JY.Base["???¡¦????" .. i] = 0
				p = i
				break;
			else
			    --?????????¡§?????????¡¦?????????????¨®????30000??¡ã?30000??
			    if (JY.Base["???¡¦????" .. i] + num) > 30000 then
				    JY.Base["???¡¦????" .. i] = 30000
			    else
				    JY.Base["???¡¦????" .. i] = JY.Base["???¡¦????" .. i] + num
			    end
			    p = i
			    break;
			end	
		elseif JY.Base["???¡¦" .. i] == -1 then
			if thingid == 174 then 
				JY.Base["???¡¦" .. i] = thingid
				--JY.Base["???¡¦????" .. i] = 0
				p = i
				break;
			else	
			    JY.Base["???¡¦" .. i] = thingid
			    JY.Base["???¡¦????" .. i] = num
			    p = i
			    break;
			end
		end
	end
	
	--?¨½???????????¨¾????????????
	if thingid == CC.MoneyID then
		CC.Gold = CC.Gold + num--JY.Base["???¡¦????" .. p]
		if CC.Gold < 0 then 
			CC.Gold = 0
		end
	end
  
  
	--?¨½???¨§?¨¦??????15??????
	--?¨½???????¨¾??????
	if num > 0 and thingid >= CC.BookStart and thingid < CC.BookStart + CC.BookNum then
		JY.Person[0]["????"] = JY.Person[0]["????"] + 15;
		JY.Base["?¨§?¨¦????"] = JY.Base["?¨§?¨¦????"] + 1
		--????????????520?????????¡¦?????¡§??????????¨®???????
		--????¨®????¡Â????
		JY.Person[520]["?¡¦??"] = JY.Person[520]["?¡¦??"] + 1
		--???????????¡Â???¨¦???????¡Â?¨¢?¨¢??????521?????????¡¦?????¡§??¡¦¨½????¡¦????¡Â????
		if JY.Person[521]["?¡¦??"] == 1 then
			addevent(70, 65, 1, 4119, 1, 2366*2)
		end

	end
	
	if JY.Base["???¡¦????" .. p] <= 0 then
        if thingid == 174 then
            if CC.Gold <= 0 then
                for i = p + 1, CC.MyThingNum do
                    JY.Base["???¡¦" .. i - 1] = JY.Base["???¡¦" .. i]
                    JY.Base["???¡¦????" .. i - 1] = JY.Base["???¡¦????" .. i]
                end
                JY.Base["???¡¦" .. CC.MyThingNum] = -1
                JY.Base["???¡¦????" .. CC.MyThingNum] = 0
            end    
		else
		    for i = p + 1, CC.MyThingNum do
		        JY.Base["???¡¦" .. i - 1] = JY.Base["???¡¦" .. i]
		        JY.Base["???¡¦????" .. i - 1] = JY.Base["???¡¦????" .. i]
		    end
			JY.Base["???¡¦" .. CC.MyThingNum] = -1
			JY.Base["???¡¦????" .. CC.MyThingNum] = 0
		end
	end
end

--?????¡ì?¨¢????
function instruct_33(personid, wugongid, flag)
	local xwperson;	--???¡§????????????
	xwperson = personid

	local add = 0
	for i = 1, JY.Base["????????"] do
		if JY.Person[xwperson]["????" .. i] == 0 then
			JY.Person[xwperson]["????" .. i] = wugongid
			JY.Person[xwperson]["????????" .. i] = 0
			add = 1		
			break;
		end
	end
	if add == 0 then
		JY.Person[xwperson]["????"..JY.Base["????????"]] = wugongid
		JY.Person[xwperson]["????????"..JY.Base["????????"]] = 0
	end
    if isteam(xwperson) then 
        Hp_Max(xwperson)
    end
	if xwperson ~= 0 and (personid == JY.Base["????"] or personid == 0) then
		xwperson = 0
		local add = 0
		for i = 1, JY.Base["????????"] do
			if JY.Person[xwperson]["????" .. i] == 0 then
				JY.Person[xwperson]["????" .. i] = wugongid
				JY.Person[xwperson]["????????" .. i] = 0
				add = 1		
				break;
			end
		end
		if add == 0 then
			JY.Person[xwperson]["????"..JY.Base["????????"]] = wugongid
			JY.Person[xwperson]["????????"..JY.Base["????????"]] = 0
		end
        Hp_Max(xwperson)
	end
	
	for i,v in pairs(CC.Copy) do 
		if v == personid then
			xwperson = i
            local add = 0
            for i = 1, JY.Base["????????"] do
                if JY.Person[xwperson]["????" .. i] == 0 then
                    JY.Person[xwperson]["????" .. i] = wugongid
                    JY.Person[xwperson]["????????" .. i] = 0
                    add = 1		
                    break;
                end
            end
            if add == 0 then
                JY.Person[xwperson]["????"..JY.Base["????????"]] = wugongid
                JY.Person[xwperson]["????????"..JY.Base["????????"]] = 0
            end
			break
		end
	end
	
	if flag == 0 then
		DrawStrBoxWaitKey(string.format("%s ?¡ì?¨¢???? %s", JY.Person[xwperson]["????"], JY.Wugong[wugongid]["????"]), C_ORANGE, CC.DefaultFont)
	end
	
end

--????¡Á???
function instruct_34(id, value)
	local xwperson;	--???¡§????
	if id == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "¡Á???", value)
	DrawStrBoxWaitKey(JY.Person[xwperson]["????"] .. str, C_ORANGE, CC.DefaultFont)
end

--??????????
function instruct_35(personid, id, wugongid, wugonglevel)
	local xwperson;	--???¡§????????????
	xwperson = personid
	local r = 0
	local gz = {'?????¨½','?????¨½','?????¨½','?????¨½','?????¨½','?????¨½','?????¨½','??¡ã??¨½','?????¨½','?????¨½','???????¨½','???????¨½','???????¨½','???????¨½','???????¨½'}
	if inteam(personid) then
		r = JYMsgBox("??????",JY.Person[personid]["????"].."??¡¦¨½??"..gz[id+1].."??"..JY.Wugong[wugongid]["????"].."??", {"??","¡¦¨½"}, 2, 189)
	else
		r = 1
	end	
	if r == 1  then
		--??????????????¡Á??????¨ª????
		if JY.Person[xwperson]["????" .. id + 1] > 0 and JY.Person[xwperson]["????" .. id + 1] ~= wugongid then
			if JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["????????"] then
				JY.Person[xwperson]["????????"] = 0
			end	
			if JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["?¡Â??????"] then
				JY.Person[xwperson]["?¡Â??????"] = 0
			end	
			if JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["?¡Â???¨¢??"] then
				JY.Person[xwperson]["?¡Â???¨¢??"] = 0
			end
		end
		if isteam(xwperson) then 
			Hp_Max(xwperson)
		end
		local pd = 0
		for k = 1, JY.Base['????????'] do
			if JY.Person[xwperson]["????"..k] == wugongid then
				JY.Person[xwperson]["????????"..k] = wugonglevel
				pd = 1
				break
			end
		end		
		if pd == 0 then
			JY.Person[xwperson]["????" .. id + 1] = wugongid
			JY.Person[xwperson]["????????" .. id + 1] = wugonglevel
		end	
		

		if personid == JY.Base["????"] then
			if DrawStrBoxYesNo(-1,-1,"????"..JY.Person[personid]["????"].."??¡¦¨½??"..gz[id+1].."??"..JY.Wugong[wugongid]["????"].."??",C_WHITE,CC.DefaultFont) == true then
				xwperson = 0
				--??????????????¡Á??????¨ª????
				if JY.Person[xwperson]["????" .. id + 1] > 0 then
					if JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["????????"] then
						JY.Person[xwperson]["????????"] = 0
					elseif JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["?¡Â??????"] then
						JY.Person[xwperson]["?¡Â??????"] = 0
					elseif JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["?¡Â???¨¢??"] then
						JY.Person[xwperson]["?¡Â???¨¢??"] = 0
					end
				end
				local pd = 0
				for k = 1, JY.Base['????????'] do
					if JY.Person[xwperson]["????"..k] == wugongid  then
						JY.Person[xwperson]["????????"..k] = wugonglevel
						pd = 1
						break
					end
				end		
				if pd == 0 then
					JY.Person[xwperson]["????" .. id + 1] = wugongid
					JY.Person[xwperson]["????????" .. id + 1] = wugonglevel
				end	
				Hp_Max(xwperson)
			else
			end	
		end
		


		for i,v in pairs(CC.Copy) do 
			if v == personid then
			--if CC.Copy[personid] ~= nil then 
				xwperson = i
				--??????????????¡Á??????¨ª????
				if JY.Person[xwperson]["????" .. id + 1] > 0 then
					if JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["????????"] then
						JY.Person[xwperson]["????????"] = 0
					elseif JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["?¡Â??????"] then
						JY.Person[xwperson]["?¡Â??????"] = 0
					elseif JY.Person[xwperson]["????" .. id + 1] == JY.Person[xwperson]["?¡Â???¨¢??"] then
						JY.Person[xwperson]["?¡Â???¨¢??"] = 0
					end
				end
				JY.Person[xwperson]["????" .. id + 1] = wugongid
				JY.Person[xwperson]["????????" .. id + 1] = wugonglevel
				break
			end
		end
    else
		do return end
	end
end

function instruct_36(sex)
	if JY.Person[0]["????"] == sex then
		return true
	else
		return false
	end
end

--??????????????????????
function instruct_37(v)
	AddPersonAttrib(0, "?¡¦??", v)
	if v < 0 then
		for i = 1, 15 do
			if JY.Restart == 1 then
				break
			end
			local y_off = i * 2 + CC.DefaultFont + CC.RowPixel
			DrawString(CC.ScreenW/2-CC.DefaultFont*5, CC.ScreenH/4 - CC.DefaultFont - CC.RowPixel + y_off, "??????????????????"..-v.."??", M_DeepSkyBlue, CC.DefaultFont)
			ShowScreen()		  
			lib.Delay(50)
			Cls()
		end
	else
		for i = 1, 15 do
			if JY.Restart == 1 then
				break
			end
			local y_off = i * 2 + CC.DefaultFont + CC.RowPixel
			DrawString(CC.ScreenW/2-CC.DefaultFont*5, CC.ScreenH/4 + 30 + CC.DefaultFont + CC.RowPixel - y_off, "?????????????¨¢????"..v.."??", PinkRed, CC.DefaultFont)
			ShowScreen()		  
			lib.Delay(50)
			Cls()
		end
	end
end

function instruct_38(sceneid, level, oldpic, newpic)
	if sceneid == -2 then
		sceneid = JY.SubScene
	end
	for i = 0, CC.SWidth - 1 do
		for j = 1, CC.SHeight - 1 do
			if GetS(sceneid, i, j, level) == oldpic then
				SetS(sceneid, i, j, level, newpic)
			end
		end
	end
end

function instruct_39(sceneid)
	JY.Scene[sceneid]["????????"] = 0
end

function instruct_40(v)
	
	if v == '??' then
		v = 0
	elseif v == '??' then
		v = 1
	elseif v == '?¡Â' then
		v = 2
	elseif v == '??' then
		v = 3
	end				
	JY.Base["??¡¦??¨¾"] = v
	JY.MyPic = GetMyPic()
	stands()
end

function instruct_41(personid, thingid, num)
	local k = 0
	for i = 1, 4 do
		if JY.Person[personid]["???????¡¦" .. i] == thingid then
			JY.Person[personid]["???????¡¦????" .. i] = JY.Person[personid]["???????¡¦????" .. i] + num
			k = i
			break;
		end
	end
	if k > 0 and JY.Person[personid]["???????¡¦????" .. k] <= 0 then
		JY.Person[personid]["???????¡¦" .. k] = -1
	end
	if k == 0 then
		for i = 1, 4 do
			if JY.Person[personid]["???????¡¦" .. i] == -1 then
				JY.Person[personid]["???????¡¦" .. i] = thingid
				JY.Person[personid]["???????¡¦????" .. i] = num
				break;
			end
		end
	end
end

function instruct_42()
	local r = false
	for i = 1, CC.TeamNum do
		if JY.Base["???¨¦" .. i] >= 0 and JY.Person[JY.Base["???¨¦" .. i]]["????"] == 1 then
			r = true
		end
	end
	return r
end

function instruct_43(thingid)
	return instruct_18(thingid)
end

function instruct_44(id1, startpic1, endpic1, id2, startpic2, endpic2)
  local old1 = GetD(JY.SubScene, id1, 5)
  local old2 = GetD(JY.SubScene, id1, 6)
  local old3 = GetD(JY.SubScene, id1, 7)
  local old4 = GetD(JY.SubScene, id2, 5)
  local old5 = GetD(JY.SubScene, id2, 6)
  local old6 = GetD(JY.SubScene, id2, 7)
  for i = startpic1, endpic1, 2 do
	lib.GetKey()
    local t1 = lib.GetTime()
    if id1 == -1 then
      JY.MyPic = i / 2
    else
      SetD(JY.SubScene, id1, 5, i)
      SetD(JY.SubScene, id1, 6, i)
      SetD(JY.SubScene, id1, 7, i)
    end
    if id2 == -1 then
      JY.MyPic = i / 2
    else
      SetD(JY.SubScene, id2, 5, i - startpic1 + startpic2)
      SetD(JY.SubScene, id2, 6, i - startpic1 + startpic2)
      SetD(JY.SubScene, id2, 7, i - startpic1 + startpic2)
    end
    DtoSMap()
    DrawSMap()
    ShowScreen()
    local t2 = lib.GetTime()
    if t2 - t1 < CC.AnimationFrame then
      lib.Delay(CC.AnimationFrame - (t2 - t1))
    end
  end
  SetD(JY.SubScene, id1, 5, old1)
  SetD(JY.SubScene, id1, 6, old2)
  SetD(JY.SubScene, id1, 7, old3)
  SetD(JY.SubScene, id2, 5, old4)
  SetD(JY.SubScene, id2, 6, old5)
  SetD(JY.SubScene, id2, 7, old6)
end

--???¨¢
function instruct_45(id, value)
	local xwperson;	--???¡§????????????
	if id == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "?¨¢??", value)
end

--????
function instruct_46(id, value)
	local xwperson;	--???¡§????????????
	if id == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "????¡Á??¨®??", value)
	AddPersonAttrib(xwperson, "????", 0)
end

--????
function instruct_47(id, value)
	local xwperson;	--???¡§????????????
	if id == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "???¡Â??", value)
end

--??¡¦?
function add_deffense(id, value)
	local xwperson;	--???¡§????????????
	if id == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "¡¦?????", value)
end

--????
function instruct_48(id, value)
	local xwperson;	--???¡§????????????
	if id == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "?¨²?¨¹¡Á??¨®??", value)
	AddPersonAttrib(xwperson, "?¨²?¨¹", value)
end

--??????
function instruct_49(personid, value)
	local xwperson;	--???¡§????????????
	if personid == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = personid
	end
	JY.Person[xwperson]["????????"] = value
    JY.Person[personid]["????????"] = value
end

function instruct_50(id1, id2, id3, id4, id5)
  local num = 0
  if instruct_18(id1) == true then
    num = num + 1
  end
  if instruct_18(id2) == true then
    num = num + 1
  end
  if instruct_18(id3) == true then
    num = num + 1
  end
  if instruct_18(id4) == true then
    num = num + 1
  end
  if instruct_18(id5) == true then
    num = num + 1
  end
  if num == 5 then
    return true
  else
    return false
  end
end

function instruct_51()
	instruct_1(2547 + Rnd(18), 114, 0)
end

function instruct_52()
	DrawStrBoxWaitKey(string.format("?????????¡¦????????: %d", JY.Person[0]["?¡¦??"]), C_ORANGE, CC.DefaultFont)
end

function instruct_53()
	DrawStrBoxWaitKey(string.format("??????????????????: %d", JY.Person[0]["????"]), C_ORANGE, CC.DefaultFont)
end

function instruct_54()
	for i = 0, JY.SceneNum - 1 do
		JY.Scene[i]["????????"] = 0
	end
	JY.Scene[2]["????????"] = 2
	JY.Scene[38]["????????"] = 2
	JY.Scene[75]["????????"] = 1
	JY.Scene[80]["????????"] = 1
end

function instruct_55(id, num)
	if GetD(JY.SubScene, id, 2) == num then
		return true
	else
		return false
	end
end

function instruct_56(v)
	--JY.Person[0]["????"] = JY.Person[0]["????"] + v
	--instruct_2_sub()
end

function instruct_57()
  instruct_27(-1, 7664, 7674)
  for i = 0, 56, 2 do
    local t1 = lib.GetTime()
    if JY.MyPic < 3844 then
      JY.MyPic = (7676 + i) / 2
    end
    SetD(JY.SubScene, 2, 5, i + 7690)
    SetD(JY.SubScene, 2, 6, i + 7690)
    SetD(JY.SubScene, 2, 7, i + 7690)
    SetD(JY.SubScene, 3, 5, i + 7748)
    SetD(JY.SubScene, 3, 6, i + 7748)
    SetD(JY.SubScene, 3, 7, i + 7748)
    SetD(JY.SubScene, 4, 5, i + 7806)
    SetD(JY.SubScene, 4, 6, i + 7806)
    SetD(JY.SubScene, 4, 7, i + 7806)
    DtoSMap()
    DrawSMap()
    ShowScreen()
    local t2 = lib.GetTime()
    if t2 - t1 < CC.AnimationFrame then
      lib.Delay(CC.AnimationFrame - (t2 - t1))
    end
  end
end

function instruct_58()
  local group = 5
  local num1 = 6
  local num2 = 3
  local startwar = 102
  local flag = {}
  for i = 0, group - 1 do
    for j = 0, num1 - 1 do
      flag[j] = 0
    end
    for j = 1, num2 do
      local r = nil
      while 1 do
        r = Rnd(num1)
        if flag[r] == 0 then
          flag[r] = 1
          do break end
        end
      end
      local warnum = r + i * num1
      WarLoad(warnum + startwar)
      instruct_1(2854 + warnum, WAR.Data["????1"], 0)
      instruct_0()
      if WarMain(warnum + startwar, 0) == true then
        instruct_0()
        instruct_13()
        TalkEx("?????????¡ã??????????", 0, 1)
        instruct_0()
      else
        instruct_15()
        return 
      end
    end
    if i < group - 1 then
      TalkEx(JY.Person[0]["????"].."????????????*??????????????", 70, 0)
      instruct_0()
      instruct_14()
      lib.Delay(300)
      if JY.Person[0]["????????"] < 50 and JY.Person[0]["????????"] <= 0 then
        JY.Person[0]["????????"] = 0
        AddPersonAttrib(0, "????", math.huge)
        AddPersonAttrib(0, "????", math.huge)
        AddPersonAttrib(0, "?¨²?¨¹", math.huge)
      end
      instruct_13()
      TalkEx("????????????????*????????????", 0, 1)
      instruct_0()
    end
  end
  TalkEx("????????????**????????*????????***????????????", 0, 1)
  instruct_0()
  TalkEx("???????????????????¨¾????*"..JY.Person[0]["????"].."????????¡Â¨¢???????¨§??*?????????????????¡Â??????*????????"..JY.Person[0]["????"].."?¨¢????***????????????*????????????*????????????*?????¡ì??"..JY.Person[0]["????"].."???????????¡Â*????????"..JY.Person[0]["????"].."?¨½????????¡ã?*???????¨½????????????????", 70, 0)
  instruct_0()
  TalkEx("?¡ì??"..JY.Person[0]["????"].."??", 12, 0)
  instruct_0()
  TalkEx("?????????¡ì??????", 64, 4)
  instruct_0()
  TalkEx("?????¨½?????????¨®?¨¢??????*???¨²?¨¢?????????¡Â???¡Â????*????????????????????????", 19, 0)
  instruct_0()
  instruct_14()
  for i = 24, 72 do
    instruct_3(-2, i, 0, 0, -1, -1, -1, -1, -1, -1, -2, -2, -2)
  end
  instruct_0()
  instruct_13()
  TalkEx("?¨²???¡ì???¨¾????????¨§??¨¾¡ã?*???????????????????¡Â????*?¡ã?¨½????*????????????????????*????¡Â¨¢?????????????????¨®*????????????*???¨¢??????????????", 0, 1)
  instruct_0()
  instruct_2(143, 1)
end

--????????????
function instruct_59()
	for i = CC.TeamNum, 2, -1 do
		if JY.Base["???¨¦" .. i] >= 0 then
			instruct_21(JY.Base["???¨¦" .. i])
		end
	end
	for i,v in ipairs(CC.AllPersonExit) do
		instruct_3(v[1], v[2], 0, 0, -1, -1, -1, -1, -1, -1, 0, -2, -2)
	end
end

function instruct_60(sceneid, id, num)
  if sceneid == -2 then
    sceneid = JY.SubScene
  end
  if id == -2 then
    id = JY.CurrentD
  end
  if GetD(sceneid, id, 5) == num then
    return true
  else
    return false
  end
end

function instruct_61()
  for i = 11, 24 do
    if GetD(JY.SubScene, i, 5) ~= 4664 then
      return false
    end
  end
  return true
end

--?¡§??????
function instruct_62(id1, startnum1, endnum1, id2, startnum2, endnum2)
	--JY.MyPic = -1
	--instruct_44(id1, startnum1, endnum1, id2, startnum2, endnum2)
	--ShowScreen()
	lib.Delay(200)
	say("???????¡¦???????????????¨½???????????????????????????¡¦??", 260, 5, "????????")
	lib.PlayMPEG("ending.mp4",VK_ESCAPE)	
    os.remove(CONFIG.DataPath..'TgJl')
	--tgsave()
    
	--????????
	local x = AddZM()
	if JY.Base["????"] == CC.Week and CC.Jl == 0 then		
		CC.Jl = 1
		CC.Sp = JY.Base["?¨¦??"] + x	
		DrawStrBoxWaitKey("?¨½????????????????????"..x, C_ORANGE, CC.DefaultFont, 2)
	end
	tgsave()
	Cls()
	lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_BLACK)
	DrawString(350, 200, "?????¨²?????¨®???¡¦", C_WHITE, CC.DefaultFont)
	DrawString(375, 300, "????????¡¦?¡Á?", C_WHITE, CC.DefaultFont)
	ShowScreen()
  
	PlayMIDI(116)
	local stime = 0
	local a = 1
	local lyrics = {
	{530,"?? ?¨¹?¨¾?????? ?????¨¾??"},
	{560,"¡Á????¡¦????????????¡Á?"},
	{590,"?¡ã????????????????"},
	{610,"????????????????"},
	{640,"???? ???????? ?????? ???¨²????????"},
	{680,"???????? ???????? ?????????¨¢????¡Á??¨½"},
	{730,"?????? ¡¦????????? ¡¦¨½?¨¾??????"},
	{810,"????????** ???????? ????????????"},
	{920,"???? ???? ????????"},
	{940,"?????????¨²?????????¨ª"},
	{970,"???? ???? ????????"},
	{1000,"?????????¨¹??????????"},
	{1030,"¡Á¡Â¡Á¡Â ¡Á¡Â¡Á¡Â ¡Á¡Â¡Á¡Â¡Á¡Â¡Á¡Â"},
	{1050,"?¨²?¨²???????????¨²?¨®¡Á¡Â"},
	{1070,"???? ???? ????????"},
	{1100,"??????¡ã¨¹????????????"},
	{1220,"?? ?????????? ????????¡Á?"},
	{1250,"?????¨ª ???????? ??¡¦???"},
	{1280,"?¨§?????? ??????????"},
	{1300,"?????? ??????????"},
	{1320,"???????¡¦???? ??????"},
	{1350,"?????¨¦??????"},
	{1370,"???????¨² ????????"},
	{1390,"??????????????¡Á??¨½"},
	{1410,"?????? ?????¡Â???? ??????¡ã¨¹??"},
	{1510,"????????** ???????? ??¡ã?????????"},
	{1610,"???? ???? ????????"},
	{1630,"?????????¨²??????????"},
	{1660,"¡¦?¡¦? ¡¦?¡¦? ¡¦?¡¦?¡¦?¡¦?"},
	{1680,"??¡¦????????????¨²????"},
	{1710,"???? ???? ????????"},
	{1730,"???¨ª?¨ª??????????????"},
	{1760,"???? ???? ????????"},
	{1780,"??????¡ã¨¹????????????"},
	{2100,"???? ???? ????????"},
	{2120,"?????????¨²?????????¨ª"},
	{2140,"???? ???? ????????"},
	{2170,"?????????¨¹??????????"},
	{2190,"¡Á¡Â¡Á¡Â ¡Á¡Â¡Á¡Â ¡Á¡Â¡Á¡Â¡Á¡Â¡Á¡Â"},
	{2210,"?¨²?¨²???????????¨²?¨®¡Á¡Â"},
	{2240,"???? ???? ????????"},
	{2260,"??????¡ã¨¹????????????"},
	{2310,"?????? ¡¦????????? ¡¦¨½?¨¾??????"},
	{2390,"????????** ???????? ????????????"},
	{2700,"?????? ?????¡ì??"},
	{2750," "}
	}
	while true do
		if JY.Restart == 1 then
			break
		end
		local key = lib.GetKey()
		lib.Delay(100)
		stime = stime + 1
		if stime == lyrics[a][1] then
			local size = CC.DefaultFont
			Cls()
			lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_BLACK)
			DrawString(350, 200, "?????¨²?????¨®???¡¦", C_WHITE, size)
			DrawString(375, 300, "????????¡¦?¡Á?", C_WHITE, size)
			local align = CC.ScreenW/2 - (string.len(lyrics[a][2])/2*size)/2
			DrawString(align, 500, lyrics[a][2], C_WHITE, size)
			ShowScreen()
			a = a + 1
		end
		if a > #lyrics then
			break
		end
		if key == VK_ESCAPE then
			break
		end
	end
	
	Cls()

	JY.Status=GAME_END;
end

function instruct_63(personid, sex)
	JY.Person[personid]["????"] = sex
end

function yxshop()
    local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*1.5
	local size1 = CC.DefaultFont*0.7
	local size2 = CC.DefaultFont*0.8
	local cont = 1 
	local cont1 = 0
	local cont2 = 0
	local jg = bx*4
    local page = 1
    local pc = 50
    local pc1 = 50
    local pc2 = 60
    local m_left = JY.Base["?¨¦??"]
	local t_price = 0
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cls()
        lib.LoadPNG(91, 61 * 2 , 0, 0, 1)
		for i = 1,5 do
			for j = 1,5 do
				local cl = 6
				local col = C_GOLD
				local p = i + (j-1+cont2)*14
				local zx = bx*419+(i-1)*(bx*100+jg)-50
				local zy = by*142+(j-1)*(by*100+jg)-50
				if cont+cont1*5 == p then
					cl = 2
					col = C_WHITE
                end
                if page == 1 then 
                    cl = 2
                end
				if CC.commodity[p] ~= nil then
					local plx = CC.commodity[p]
					local pic = plx[1]
                    lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
                    if page == 1 and cont+cont1*5 == p then 
                        lib.LoadPNG(91, pc * 2 , zx+50,zy+50, 2)
                        pc = pc + 1
                        if pc > pc2 then 
                            pc = pc1
                        end
					end
							
                    --DrawString(zx+bx*30-string.len(plx[5])*size1+size1,zy-by*45,plx[5], C_WHITE, size1)
                    --if page == 2 and cont+cont1*5 == p then
                        --DrawString(zx+bx*30-string.len(plx[3])*size1+size1,zy+by*25,plx[3], C_WHITE, size1)
                    --end
				end	
			end
		end

        if CC.commodity[cont+cont1*5] ~= nil then
            local plx = CC.commodity[cont+cont1*5]
            local pic = plx[1]
            --
            --DrawString(bx*405,by*640-size2,JY.Thing[pic]['???¡¦???¡Â'], C_ORANGE, size2)
            DrawString(bx*405,by*638-size1,plx[4], C_WHITE, size1)
            DrawString(bx*405,by*663-size1,'???¡ã??????'..plx[5], C_WHITE, size1)
            DrawString(bx*405,by*688-size1,'???¨¾??????'..plx[3], C_WHITE, size1)
        end
        lib.Background(bx*70, by*520, bx*300,by*650, 150)
        DrawString(bx*80,by*550-size2,'???¨½:'..CC.commodity[cont+cont1*5][2], C_WHITE, size2)
        DrawString(bx*80,by*580-size2,'¡Á???:'..JY.Base["?¨¦??"], C_WHITE, size2)
        DrawString(bx*80,by*610-size2,'?¡§¡¦?:'..t_price, C_WHITE, size2)
        DrawString(bx*80,by*640-size2,'????:'..m_left, C_WHITE, size2)


		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
            if page == 1 then 
                page = 2
            else 
                JY.Base["?¨¦??"] = m_left
                CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                CC.commodity[cont+cont1*5][3] = 0
				page = 1
				if CC.commodity[cont+cont1*5][5] > 0 then
				instruct_2(CC.commodity[cont+cont1*5][1],CC.commodity[cont+cont1*5][5])
				CC.commodity[cont+cont1*5][5] = 0
				--CC.Sp = CC.Sp - t_price
				m_left = JY.Base["?¨¦??"] - t_price 
				end
            end
        elseif X == VK_ESCAPE or ktype == 4 then
            CC.commodity[cont+cont1*5][3] = 0
            if page == 2 then 
                page = 1 
            else     
                break
            end
		elseif X == VK_UP then
			if cont1 > 0 then
				if cont1 == cont2 then
					cont2 = limitX(cont2 - 1,0)
				end
				cont1 = cont1 - 1
			else 
				cont = 1
			end
		elseif X == VK_DOWN then
			if cont + cont1*5 < #CC.commodity then
				if cont1 < math.ceil(#CC.commodity/5) - 1 then 
					cont1 = cont1 + 1 
					if cont + cont1*5 > #CC.commodity then
						cont = #CC.commodity - cont1*5
					end
				else 
					cont = #CC.commodity - cont1*5
				end
				if cont1 - cont2 > 4 then
					cont2 = cont2 + 1
				end
			end
        elseif X == VK_LEFT or ktype == 6 then
            if page == 1 then 
                cont = cont - 1 
                if cont1 > 0 then 
                    if cont < 1 then
                        if cont1 == cont2 then
                            cont2 = limitX(cont2 - 1,0)
                        end
                        cont1 = cont1 - 1
                        cont = 5
                    end
                elseif cont < 1 then 
                    cont = 1
                end
            else 
                if CC.commodity[cont+cont1*5][3] > 0 then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] - 1
                    m_left = m_left + CC.commodity[cont+cont1*5][2]
                    t_price = t_price - CC.commodity[cont+cont1*5][2]
                end
            end
        elseif X == VK_RIGHT or ktype == 7 then
            if page == 1 then 
                if cont + cont1*5 < #CC.commodity then
                    cont = cont + 1
                    if cont > 5 then
                        if cont1 < math.ceil(#CC.commodity/5) - 1 then 
                            cont = 1 
                            cont1 = cont1 + 1
                        end	
                    end
                    if cont1 - cont2 > 4 then
                        cont2 = cont2 + 1
                    end
                end
            else 
                if m_left >= CC.commodity[cont+cont1*5][2] then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] + 1
                    m_left = m_left - CC.commodity[cont+cont1*5][2]
                    t_price = t_price + CC.commodity[cont+cont1*5][2]
                end
            end
		else 
			local mxx = false
			for i = 1,5 do 
				for j = 1,5 do
                    if mx >= bx*405+(i-1)*(bx*100+jg) and mx <= bx*505+(i-1)*(bx*100+jg) and 
                        my >= by*94+(j-1)*(by*100+jg) and my <= by*194+(j-1)*(by*100+jg) then 
                        local p = i + (j-1+cont2)*14
                        if CC.commodity[p] ~= nil then
							cont = i 
							cont1 = j - 1 + cont2
							mxx = true 
							break
                        end	
                    end
				end
			end	
			if ktype == 3 and mxx == true then 
                if page == 1 then 
                    page = 2
                else 
                    JY.Base["?¨¦??"] = m_left
                    CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                    CC.commodity[cont+cont1*5][3] = 0
                    page = 1
                end
			end
		end
	end
end



--??????????????????
function instruct_64()
	local headid = 223
	local id = -1
	
	for i = 0, JY.ShopNum - 1 do
		if CC.ShopScene[i].sceneid == JY.SubScene then
		  id = i
		end
	end
	if id < 0 then
		return 
	end
	if id == 5 then
		--say('???????????????¨½?¨§???¨¾??????',899,0,'????')
	else
		TalkEx("???????????????????????????????????????¡Â??????????????", headid, 0,"????")
	end	
	--lib.LoadPNG(91, 10 * 2 , 0, 0, 1)
	local menu = {}
	-- for i = 1, 6 do
		-- local thingid = JY.Shop[id]["???¡¦" .. i]
		-- if thingid ~= -1 then
			-- menu[i] = {}
			-- menu[i][1] = string.format("%-12s %5d", JY.Thing[thingid]["????"], JY.Shop[id]["???¡¦???¨½" .. i])
			-- menu[i][2] = nil
			-- if JY.Shop[id]["???¡¦????" .. i] > 0 then
			  -- menu[i][3] = 1
			-- else
			  -- menu[i][3] = 0
			-- end
		-- end
	-- end
	
	for i = 1, 6 do
		local thingid = JY.Shop[id]["???¡¦" .. i]
		if thingid ~= -1 then
			menu[#menu+1] = {thingid,JY.Shop[id]["???¡¦???¨½" .. i],0,JY.Thing[thingid]["???¡¦???¡Â"],0}--JY.Shop[id]["???¡¦????" .. i]
		end
	end
	
	--3?¨¦???¡ã?????¨§??
	-- if JY.Base["?¨§?¨¦????"] < 3 and id == 0 then
		-- menu[5][3] = 0
	-- end
	--{343,600,0,'?????????¨½?¨§??????',0}


	--??????
	--say("??????"..menu[6][1],0,1)

	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*1.5
	local size1 = CC.DefaultFont*0.7
	local size2 = CC.DefaultFont*0.8
	local cont = 1 
	local cont1 = 0
	local cont2 = 0
	local jg = bx*4
    local page = 1
    local pc = 50
    local pc1 = 50
    local pc2 = 60
    local m_left = CC.Gold
	local t_price = 0
	local commodity = {}
	commodity = menu
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cls()
        lib.LoadPNG(91, 61 * 2 , 0, 0, 1)
		
		
		for i = 1,6 do
			for j = 1,6 do
				local cl = 6
				local col = C_GOLD
				local p = i + (j-1+cont2)*14
				local zx = bx*419+(i-1)*(bx*100+jg)-50
				local zy = by*142+(j-1)*(by*100+jg)-50
				
				-- local zx = bx*370 + (i-1)*(bx*100 + jg)
				-- local zy = by*90  + (j-1)*(by*100 + jg)
				-- if #ommodity > 5 then
					
				-- end
				--say("??????"..p,0,1)
				if cont+cont1*5 == p then
					cl = 2
					col = C_WHITE
                end
                if page == 1 then 
                    cl = 2
                end
				
				if commodity[p] ~= nil then
					local plx = commodity[p]
					local pic = plx[1]
					--say("??????"..p,0,1)
					if p == 6  then --and page == 1
						local zx = bx*370 + (bx*100 + jg) - (100 + jg)
						local zy = by*90  + (by*100 + jg)
						lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
						if page == 1 and cont+cont1*5 == p then 
							lib.LoadPNG(91, 50 * 2 , zx+50,zy+50, 2)
							--pc = pc + 1
							--if pc > pc2 then 
								--pc = pc1
							--end
						end
						if page == 2 and cont+cont1*5 == p then 
							lib.LoadPNG(91, pc*2 , zx+50,zy+50, 2)
							pc = pc + 1
							if pc > pc2 then 
								pc = pc1
							end
						end 
					else
						lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
						if page == 1 and cont+cont1*5 == p then 
							lib.LoadPNG(91, 50 * 2 , zx+50,zy+50, 2)
							pc = pc + 1
							if pc > pc2 then 
								pc = pc1
							end
						end
						if page == 2 and cont+cont1*5 == p then 
							lib.LoadPNG(91, pc*2 , zx+50,zy+50, 2)
							pc = pc + 1
							if pc > pc2 then 
								pc = pc1
							end
						end
					end
					
					-- lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
					-- if page == 1 and cont+cont1*5 == p then 
						-- lib.LoadPNG(91, pc * 2 , zx+50,zy+50, 2)
						-- pc = pc + 1
						-- if pc > pc2 then 
							-- pc = pc1
						-- end
					-- end
							
					--DrawString(zx+bx*30-string.len(plx[5])*size1+size1,zy-by*45,plx[5], C_WHITE, size1)
					--if page == 2 and cont+cont1*5 == p then
						--DrawString(zx+bx*30-string.len(plx[3])*size1+size1,zy+by*25,plx[3], C_WHITE, size1)
					--end
				end	
				
				
				
				
			end
			
		end
		
		-- if #commodity == 6 then
			-- local zx = bx*370 + (bx*100 + jg) - (100 + jg)
			-- local zy = by*90  + (by*100 + jg)
			-- lib.PicLoadCache(2, commodity[6][1] * 2, zx,zy, 2,256)
		-- end
		
		
		
        if commodity[cont+cont1*5] ~= nil then
            local plx = commodity[cont+cont1*5]
            local pic = plx[1]
            --
            --DrawString(bx*405,by*640-size2,JY.Thing[pic]['???¡¦???¡Â'], C_ORANGE, size2)
            DrawString(bx*405,by*638-size1,plx[4], C_WHITE, size1)
            DrawString(bx*405,by*663-size1,'???¡ã??????'..JY.Shop[id]["???¡¦????" .. (cont+cont1*5)], C_WHITE, size1)
            DrawString(bx*405,by*688-size1,'???¨¾??????'..plx[3], C_WHITE, size1)
			
        end
        lib.Background(bx*70, by*520, bx*300,by*650, 150)
        DrawString(bx*80,by*550-size2,'???¡¦????:', C_WHITE, size2)
        DrawString(bx*80,by*580-size2,'????????:', C_WHITE, size2)
        DrawString(bx*80,by*610-size2,'¡Á????¡§¡¦?:', C_WHITE, size2)
        DrawString(bx*80,by*640-size2,'??¡¦?????:', C_WHITE, size2)
        DrawString(bx*80+size2*5,by*550-size2,commodity[cont+cont1*5][2], C_GOLD, size2)
        DrawString(bx*80+size2*5,by*580-size2,CC.Gold, C_GOLD, size2)
        DrawString(bx*80+size2*5,by*610-size2,t_price, C_GOLD, size2)
        DrawString(bx*80+size2*5,by*640-size2,m_left, C_GOLD, size2)


		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
            if page == 1 then 
                page = 2
            else 
                CC.Gold = m_left
                commodity[cont+cont1*5][5] = commodity[cont+cont1*5][5] + commodity[cont+cont1*5][3]
                commodity[cont+cont1*5][3] = 0
				page = 1
				if commodity[cont+cont1*5][5] > 0 then
				instruct_2(commodity[cont+cont1*5][1],commodity[cont+cont1*5][5])
				commodity[cont+cont1*5][5] = 0
				--CC.Sp = CC.Sp - t_price
				-- if instruct_31(t_price) == false then  --????????????
					-- --say("?????¨²????????", 511, 2) --???¡ã
					-- TalkEx("??????????????????????????", headid, 0,"????")
					-- return
				-- end
				say("¡Á?????"..t_price,0,1)
				m_left = CC.Gold - t_price 
				t_price= 0
				--t_price = m_left
				end
            end
        elseif X == VK_ESCAPE or ktype == 4 then
            local sysl = cont+cont1*5
			JY.Shop[id]["???¡¦????" .. sysl] = JY.Shop[id]["???¡¦????" .. sysl] + commodity[cont+cont1*5][3]
            commodity[cont+cont1*5][3] = 0
            if page == 2 then 
                page = 1 
            else     
                break
            end
		elseif X == VK_UP then
			if page == 1 then
				if cont1 > 0 then
					if cont1 == cont2 then
						cont2 = limitX(cont2 - 1,0)
					end
					cont1 = cont1 - 1
				else 
					cont = 1
				end
			end	
		elseif X == VK_DOWN then
			if page == 1 then
				if cont + cont1*5 < #commodity then
					if cont1 < math.ceil(#commodity/5) - 1 then 
						cont1 = cont1 + 1 
						if cont + cont1*5 > #commodity then
							cont = #commodity - cont1*5
						end
					else 
						cont = #commodity - cont1*5
					end
					if cont1 - cont2 > 4 then
						cont2 = cont2 + 1
					end
				end
			end	
        elseif X == VK_LEFT or ktype == 6 then
            if page == 1 then 
                cont = cont - 1 
                if cont1 > 0 then 
                    if cont < 1 then
                        if cont1 == cont2 then
                            cont2 = limitX(cont2 - 1,0)
                        end
                        cont1 = cont1 - 1
                        cont = 5
                    end
                elseif cont < 1 then 
                    cont = 1
                end
            else 
				local sysl = cont+cont1*5
                if commodity[cont+cont1*5][3] > 0   then
                    commodity[cont+cont1*5][3] = commodity[cont+cont1*5][3] - 1
					
					JY.Shop[id]["???¡¦????" .. sysl] = JY.Shop[id]["???¡¦????" .. sysl] + 1
                	
                	m_left = m_left + commodity[cont+cont1*5][2]
				
					t_price = t_price - commodity[cont+cont1*5][2]
                end
            end
        elseif X == VK_RIGHT or ktype == 7 then
            if page == 1 then 
                if cont + cont1*5 < #commodity then
                    cont = cont + 1
                    if cont > 5 then
                        if cont1 < math.ceil(#commodity/5) - 1 then 
                            cont = 1 
                            cont1 = cont1 + 1
                        end	
                    end
                    if cont1 - cont2 > 4 then
                        cont2 = cont2 + 1
                    end
                end
            else 
				local sysl = cont+cont1*5
                if m_left >= commodity[cont+cont1*5][2] and JY.Shop[id]["???¡¦????" ..sysl] > 0  then
                    commodity[cont+cont1*5][3] = commodity[cont+cont1*5][3] + 1
					
					if JY.Shop[id]["???¡¦????" ..sysl] > 0 then
						
						JY.Shop[id]["???¡¦????" ..sysl] = JY.Shop[id]["???¡¦????" ..sysl] - 1
							
							m_left = m_left - commodity[cont+cont1*5][2]
					
							t_price = t_price + commodity[cont+cont1*5][2]

						
						
						
					end
					
					
                    
                end
            end
		else 
			local mxx = false
			for i = 1,5 do 
				for j = 1,5 do
                    if mx >= bx*405+(i-1)*(bx*100+jg) and mx <= bx*505+(i-1)*(bx*100+jg) and 
                        my >= by*94+(j-1)*(by*100+jg) and my <= by*194+(j-1)*(by*100+jg) then 
                        local p = i + (j-1+cont2)*14
                        if commodity[p] ~= nil then
							cont = i 
							cont1 = j - 1 + cont2
							mxx = true 
							break
                        end	
                    end
				end
			end	
			if ktype == 3 and mxx == true then 
                if page == 1 then 
                    page = 2
                else 
                    CC.Gold = m_left
                    commodity[cont+cont1*5][5] = commodity[cont+cont1*5][5] + commodity[cont+cont1*5][3]
                    commodity[cont+cont1*5][3] = 0
                    page = 1
                end
			end
		end
	end





	--??????


	-- local x1 = (CC.ScreenW - 9 * CC.DefaultFont - 2 * CC.MenuBorderPixel) / 2
	-- local y1 = (CC.ScreenH - 5 * CC.DefaultFont - 4 * CC.RowPixel - 2 * CC.MenuBorderPixel) / 2
	-- local r = ShowMenu(menu, #menu, 0, x1, y1, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
	-- --[[
	-- local itemJC = {}
	-- itemJC[0] = {38, 12, 28, 14, 68, -1, 400, 100, 80, 500, 6000, -1}
	-- itemJC[1] = {48, 0, 29, 15, 90, -1, 400, 100, 100, 500, 1000, -1}
	-- itemJC[2] = {54, 3, 32, 16, 159, -1, 400, 100, 100, 600, 600, -1}
	-- itemJC[3] = {63, 7, 33, 17, 175, -1, 400, 200, 120, 600, 800, -1}
	-- itemJC[4] = {27, 9, 34, 22, 69, -1, 2000, 50, 130, 400, 8000, -1}]]
	-- if r > 0 then
		-- if instruct_31(JY.Shop[id]["???¡¦???¨½" .. r]) == false then
			-- TalkEx("¡¦????¡ì???????¨ª????????????????", headid, 0,"????")
		-- else
			-- JY.Shop[id]["???¡¦????" .. r] = JY.Shop[id]["???¡¦????" .. r] - 1
			-- instruct_32(CC.MoneyID, -JY.Shop[id]["???¡¦???¨½" .. r])
			-- instruct_32(JY.Shop[id]["???¡¦" .. r], 1)
			-- TalkEx(JY.Person[0]["????"].."?¨¾???????????¡Â?????¡è?????¨®????", headid, 0,"????")
		-- end
	-- end
	for i,v in ipairs(CC.ShopScene[id].d_leave) do
		instruct_3(-2, v, 0, -2, -1, -1, 939, -1, -1, -1, -2, -2, -2)
	end
end

function instruct_65()
  local id = -1
  for i = 0, JY.ShopNum - 1 do
    if CC.ShopScene[i].sceneid == JY.SubScene then
      id = i
    end
  end
  if id < 0 then
    return 
  end
  instruct_3(-2, CC.ShopScene[id].d_shop, 0, -2, -1, -1, -1, -1, -1, -1, -2, -2, -2)
  for i,v in ipairs(CC.ShopScene[id].d_leave) do
    instruct_3(-2, v, 0, -2, -1, -1, -1, -1, -1, -1, -2, -2, -2)
  end
  local newid = id + 1
  if newid >= 5 then
    newid = 0
  end
  instruct_3(CC.ShopScene[newid].sceneid, CC.ShopScene[newid].d_shop, 1, -2, 938, -1, -1, 8256, 8256, 8256, -2, -2, -2)
end

function instruct_66(id)
  PlayMIDI(id)
end

function instruct_67(id)
  PlayWavAtk(id)
end


--???¨½?¨¾?????????????????¨¾
--title ????
--str ???? *????
--button ????
--num ???????????????¡§????????????????
--headid ??????????¡Á¨®?????????????????????¨¾??????????
function JYMsgBox(title, str, button, num, headid, isEsc)
	if JY.Restart == 1 then
		return 1
	end
	local strArray = {}
	local xnum, ynum, width, height = nil, nil, nil, nil
	local picw, pich = 0, 0
	local x1, x2, y1, y2 = nil, nil, nil, nil
	local size = CC.DefaultFont;
	local xarr = {};

	local function between(x, select)
		for i=1, num do
			if xarr[i] < x and x < xarr[i] + string.len(button[i])*size/2 then
				return i
			end
		end
		return select
	end
  
	if headid ~= nil then
		headid = headid*2;
		--picw, pich = lib.PicGetXY(1, headid)
		picw, pich = lib.GetPNGXY(1, headid)
		picw = picw + CC.MenuBorderPixel * 2
		pich = pich + CC.MenuBorderPixel * 2
	end
	ynum, strArray = Split(str, "*")
	xnum = 0
	for i = 1, ynum do
		local len = string.len(strArray[i])
		if xnum < len then
			xnum = len
		end
	end
	if xnum < 12 then
		xnum = 12
	end
	width = CC.MenuBorderPixel * 2 + math.modf(size * xnum / 2) + (picw)
	height = CC.MenuBorderPixel * 2 + (size + CC.MenuBorderPixel) * ynum
	if height < pich then
		height = pich
	end
	y2 = height
	height = height + CC.MenuBorderPixel * 2 + size * 2
	x1 = (CC.ScreenW - (width)) / 2 + CC.MenuBorderPixel
	x2 = x1 + (picw)
	y1 = (CC.ScreenH - (height)) / 2 + CC.MenuBorderPixel + 2 + size * 0.7
	y2 = y2 + (y1) - 5
	local select = 1

	Cls();
  
	DrawBoxTitle(width, height, title, C_GOLD)
	if headid ~= nil then
		--lib.PicLoadCache(1, headid, x1, y1, 1, 0)
		lib.LoadPNG(1, headid, x1, y1,1)
	end
	for i = 1, ynum do
		DrawString(x2, y1 + (CC.MenuBorderPixel + size) * (i - 1), strArray[i], C_WHITE, size)
	end
	
	local yczj = 0	--?????¡Â????????
	
	if title == "?¡Â?????¨½" then
		yczj = 1
	end
	
	local surid = lib.SaveSur((CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size, (CC.ScreenW + (width)) / 2 + 4, (CC.ScreenH + (height)) / 2 + 4)
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		lib.LoadSur(surid, (CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size)
		
		for i = 1, num do
			local color, bjcolor = nil, nil
			if i == select then
				color = M_Yellow
				bjcolor = M_DarkOliveGreen
			else
				color = M_DarkOliveGreen
			end
			xarr[i] = (CC.ScreenW - (width)) / 2 + (width) * i / (num + 1) - string.len(button[i]) * size / 4;
			DrawStrBox2(xarr[i], y2, button[i], color, size, bjcolor)
		end
		ShowScreen()
		  
		local key, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
		if key == VK_ESCAPE or ktype == 4 then
			if isEsc ~= nil and isEsc == 1 then
				select = -2
				break
			end
		elseif key == VK_LEFT or ktype == 6 then
			select = select - 1
			if select < 1 then
				select = num
			end
			if yczj == 1 and key == VK_LEFT then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_RIGHT or ktype == 7 then
			select = select + 1
			if num < select then
				select = 1
			end
			if yczj == 1 and key == VK_RIGHT then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_UP then
			if yczj == 1 then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_DOWN then
			if yczj == 1 then
				YC_ZhangJiaHui(key)
			end
		elseif key >= VK_A and key <= VK_Z then
			if yczj == 1 then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_RETURN or key == VK_SPACE or ktype == 5 then
			break
		elseif ktype == 2 or ktype == 3 then
			if mx >= x1 and mx <= x1 + width and my >= y2 and my <= y2 + 2*CC.MenuBorderPixel + size then
				--??????????????pass in select???????????¨½???????¨¦????¡¦???????????????
				select = between(mx, select);
				if select > 0 and select <= num and ktype==3 then
					break
				end
			end
		end
		--?????¡Â????????
		if yczj == 1 and YC.ZJH == 12 then
			YC.ZJH = 0
			lib.FreeSur(surid)
			return 3
		end
	end
	select = limitX(select, -2, num)
	lib.FreeSur(surid)
	
	Cls()
	return select
end

function JYMsgBox2(title, str, button, num, headid, isEsc)
	if JY.Restart == 1 then
		return 1
	end
	local strArray = {}
	local xnum, ynum, width, height = nil, nil, nil, nil
	local picw, pich = 0, 0
	local x1, x2, y1, y2 = nil, nil, nil, nil
	local size = CC.DefaultFont;
	local xarr = {};

	local function between(x, select)
		for i=1, num do
			if xarr[i] < x and x < xarr[i] + string.len(button[i])*size/2 then
				return i
			end
		end
		return select
	end
  
	if headid ~= nil then
		headid = headid*2;
		picw, pich = lib.GetPNGXY(1, headid)
		picw = picw + CC.MenuBorderPixel * 2
		pich = pich + CC.MenuBorderPixel * 2
	end
	ynum, strArray = Split(str, "*")
	xnum = 0
	for i = 1, ynum do
		local len = string.len(strArray[i])
		if xnum < len then
			xnum = len
		end
	end
	if xnum < 12 then
		xnum = 12
	end
	width = CC.MenuBorderPixel * 2 + math.modf(size * xnum / 2) + (picw)
	height = CC.MenuBorderPixel * 2 + (size + CC.MenuBorderPixel) * ynum
	if height < pich then
		height = pich
	end
	y2 = height
	height = height + CC.MenuBorderPixel * 2 + size * 2
	x1 = (CC.ScreenW - (width)) / 2 + CC.MenuBorderPixel
	x2 = x1 + (picw)
	y1 = (CC.ScreenH - (height)) / 2 + CC.MenuBorderPixel + 2 + size * 0.7
	y2 = y2 + (y1) - 5
	local select = 1

	Cls()
  
	DrawBoxTitle(width, height, title, C_GOLD)
	if headid ~= nil then
		lib.LoadPNG(1, headid, x1, y1,1)
	end
	for i = 1, ynum do
		DrawString(x2, y1 + (CC.MenuBorderPixel + size) * (i - 1), strArray[i], C_WHITE, size)
	end
	
	local surid = lib.SaveSur((CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size, (CC.ScreenW + (width)) / 2 + 4, (CC.ScreenH + (height)) / 2 + 4)
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		lib.LoadSur(surid, (CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size)
		
		for i = 1, num do
			local color, bjcolor = nil, nil
			if i == select then
				color = M_Yellow
				bjcolor = M_DarkOliveGreen
			else
				color = M_DarkOliveGreen
			end
			xarr[i] = (CC.ScreenW - (width)) / 2 + (width) * i / (num + 1) - string.len(button[i]) * size / 4;
			DrawStrBox2(xarr[i], y2, button[i], color, size, bjcolor)
		end
		ShowScreen()
		  
		local key, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
		if key == VK_ESCAPE or ktype == 4 then
			if isEsc ~= nil and isEsc == 1 then
				select = -2
				break
			end
		elseif key == VK_LEFT or ktype == 6 then
			select = select - 1
			if select < 1 then
				select = num
			end
		elseif key == VK_RIGHT or ktype == 7 then
			select = select + 1
			if num < select then
				select = 1
			end
		elseif key == VK_RETURN or key == VK_SPACE or ktype == 5 then
			break
		elseif ktype == 2 or ktype == 3 then
			if mx >= x1 and mx <= x1 + width and my >= y2 and my <= y2 + 2*CC.MenuBorderPixel + size then
				--??????????????pass in select???????????¨½???????¨¦????¡¦???????????????
				select = between(mx, select);
				if select > 0 and select <= num and ktype==3 then
					break
				end
			end
		end
	end
	select = limitX(select, -2, num)
	lib.FreeSur(surid)
	
	Cls()
	return button[select]
end

--?????????¨¾????¡Á?
function DrawBoxTitle(width, height, str, color)
  local s = 4
  local x1, y1, x2, y2, tx1, tx2 = nil, nil, nil, nil, nil, nil
  local fontsize = s + CC.DefaultFont
  local len = string.len(str) * fontsize / 2
  x1 = (CC.ScreenW - width) / 2
  x2 = (CC.ScreenW + width) / 2
  y1 = (CC.ScreenH - height) / 2
  y2 = (CC.ScreenH + height) / 2
  tx1 = (CC.ScreenW - len) / 2
  tx2 = (CC.ScreenW + len) / 2
  lib.Background(x1, y1 + s, x1 + s, y2 - s, 128)
  lib.Background(x1 + s, y1, x2 - s, y2, 128)
  lib.Background(x2 - s, y1 + s, x2, y2 - s, 128)
  lib.Background(tx1, y1 - fontsize / 2 + s, tx2, y1, 128)
  lib.Background(tx1 + s, y1 - fontsize / 2, tx2 - s, y1 - fontsize / 2 + s, 128)
  local r, g, b = GetRGB(color)
  DrawBoxTitle_sub(x1 + 1, y1 + 1, x2, y2, tx1 + 1, y1 - fontsize / 2 + 1, tx2, y1 + fontsize / 2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
  DrawBoxTitle_sub(x1, y1, x2 - 1, y2 - 1, tx1, y1 - fontsize / 2, tx2 - 1, y1 + fontsize / 2 - 1, color)
  DrawString(tx1 + 2 * s, y1 - (fontsize - s) / 2, str, color, CC.DefaultFont)
end

function DrawBoxTitle_sub(x1, y1, x2, y2, tx1, ty1, tx2, ty2, color)
  local s = 4
  lib.DrawRect(x1 + s, y1, tx1, y1, color)
  lib.DrawRect(tx2, y1, x2 - s, y1, color)
  lib.DrawRect(x2 - s, y1, x2 - s, y1 + s, color)
  lib.DrawRect(x2 - s, y1 + s, x2, y1 + s, color)
  lib.DrawRect(x2, y1 + s, x2, y2 - s, color)
  lib.DrawRect(x2, y2 - s, x2 - s, y2 - s, color)
  lib.DrawRect(x2 - s, y2 - s, x2 - s, y2, color)
  lib.DrawRect(x2 - s, y2, x1 + s, y2, color)
  lib.DrawRect(x1 + s, y2, x1 + s, y2 - s, color)
  lib.DrawRect(x1 + s, y2 - s, x1, y2 - s, color)
  lib.DrawRect(x1, y2 - s, x1, y1 + s, color)
  lib.DrawRect(x1, y1 + s, x1 + s, y1 + s, color)
  lib.DrawRect(x1 + s, y1 + s, x1 + s, y1, color)
  DrawBox_1(tx1, ty1, tx2, ty2, color)
end

function Init_SMap(showname)
	-- --lib.PicInit()
	-- ----???????¡ã????????
	-- lib.PicLoadFile(CC.SMAPPicFile[1], CC.SMAPPicFile[2], 0)
	-- lib.LoadPNGPath('./data/smap',0,-1,100)
	-- lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92)
	-- lib.LoadPNGPath('./data/bj',0,-1,100)
	-- lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,80))
	-- lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.LoadPNGPath(CC.PTPath, 95, CC.PTNum, limitX(CC.ScreenW/1360*100,0,100))
	-- lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI				
	-- lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)
    -- lib.LoadPNGPath('./data/thing',0,-1,100)
	--????
	PlayMIDI(JY.Scene[JY.SubScene]["????????"])
	JY.oldSMapX = -1
	JY.oldSMapY = -1
	JY.SubSceneX = 0
	JY.SubSceneY = 0
	JY.OldDPass = -1
	JY.D_Valid = nil
	DrawSMap()
	lib.GetKey()
	if showname == 1 then
		DrawStrBox(-1, 10, JY.Scene[JY.SubScene]["????"], C_WHITE, CC.DefaultFont)
		ShowScreen()
		WaitKey()
	end
  
	AutoMoveTab = {[0] = 0}
end

--?????¡ã¡¦???
--????????¡Á?¡¦?
--???????????¨¹?¨®????????
--??????????=red??=gold??=black?¡Á=white??=orange
--????¡Á?¡¦??????????¡ã,??,??,??,??,??,??,?¡¦,??,??
--????¡Á???????????
--??????????   ¡¦?????
--???¨²?¨ª¡Á??????¨²?¨ª?¡Â??

function say(s,pid,flag,name)          --?????????¡ã
	if JY.Restart == 1 then
		return
	end
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
    local picw=130;       --¡Á??¨®?¡¦?¨½?????¨ª??
	local pich=130;
	local talkxnum=30;         --???¡ã????¡Á???
	local talkynum=3;          --???¡ã????
	--local dx=2;
	--local dy=2;
	local dx=CC.ScreenW/680;
	local dy=CC.ScreenH/384;
    --local boxpicw=picw+10;
	--local boxpich=pich+10;
	local boxpicw=picw+CC.ScreenW/136;
	local boxpich=pich+CC.ScreenH/76.8;
	--local boxtalkw=talkxnum*CC.DefaultFont+10;
	local boxtalkw=talkxnum*CC.DefaultFont+CC.ScreenW/136;
	--local boxtalkh=boxpich-27;
	local boxtalkh=boxpich-CC.ScreenH/28.44;
	local headid = pid;
	if name == nil then 
		headid = JY.Person[pid]["¡ã??¨ª?¨½"]
	end
	name=name or JY.Person[pid]["????"]
    local talkBorder=(pich-talkynum*CC.DefaultFont)/(talkynum+1)-5;

	--?????¡¦?¨½?????¡ã??¡Á???
    local xy={ [0]={headx=dx,heady=dy,
	                talkx=dx+boxpicw+2,talky=dy+27,
					namex=dx+boxpicw+2,namey=dy,
					showhead=1},--¡Á¨®??
                   {headx=CC.ScreenW-1-dx-boxpicw-80,heady=CC.ScreenH-dy-boxpich+40,
				    talkx=CC.ScreenW-1-dx-boxpicw-boxtalkw-2-150,talky= CC.ScreenH-dy-boxpich+27,
					namex=CC.ScreenW-1-dx-boxpicw-26,namey=CC.ScreenH-dy-boxpich+100,
					showhead=1},--????
                   {headx=dx,heady=dy,
				   talkx=dx+boxpicw-43,talky=dy+27,
					namex=dx+boxpicw+2,namey=dy,
				   showhead=0},--????
                   {headx=CC.ScreenW-1-dx-boxpicw,heady=CC.ScreenH-dy-boxpich,
				   talkx=CC.ScreenW-1-dx-boxpicw-boxtalkw-2,talky= CC.ScreenH-dy-boxpich+27,
					namex=CC.ScreenW-1-dx-boxpicw-96,namey=CC.ScreenH-dy-boxpich,
					showhead=1},
                   {headx=CC.ScreenW-1-dx-boxpicw,heady=dy,
				    talkx=CC.ScreenW-1-dx-boxpicw-boxtalkw-2,talky=dy+27,
					namex=CC.ScreenW-1-dx-boxpicw-96,namey=dy,
					showhead=1},--????
                   {headx=dx+68,heady=CC.ScreenH-dy-boxpich+40,
				   talkx=dx+boxpicw+2+160,talky=CC.ScreenH-dy-boxpich+27,
					namex=dx+boxpicw-50,namey=CC.ScreenH-dy-boxpich+100,
				   showhead=1}, --¡Á¨®??
			}

	if pid==0 then
	   if name ~= JY.Person[pid]["????"] then 
	      flag=1
	   else 
	      flag=5
	   end 
	else
	   flag=1
	end
	local tx = 0
	local ty = 0
	local bs = 100
	local bs1 = 60
	local tx,ty = lib.GetPNGXY(91,312*2)
	if CONFIG.Operation==1 then
		bs = CC.ScreenH/13
		tx,ty = lib.GetPNGXY(91,312*2,bs)
		bs1 = CC.ScreenH/13
		talkxnum = 28
		xy[1].namex = xy[1].namex - CC.ScreenW/5
		xy[1].namey = xy[1].namey + CC.ScreenH/5
		xy[1].talkx = xy[1].talkx- CC.ScreenW/10
		xy[1].talky = xy[1].talky - CC.ScreenH/20 



		xy[5].namex = xy[5].namex + CC.ScreenW/25 
		xy[5].namey = xy[5].namey - CC.ScreenH/10 
		xy[5].talkx = xy[5].talkx + CC.ScreenW/10
		xy[5].talky = xy[5].talky - CC.ScreenH/20 
	end	

  if xy[flag].showhead == 0 then
    headid = -1
  end

    lib.GetKey();

	local function readstr(str)
		local T1={"?¡ã","??","??","??","??","??","??","?¡¦","??","??"}
		local T2={{"??",M_DarkRed},{"??",C_GOLD},{"??",C_BLACK},{"?¡Á",C_WHITE},{"??",C_ORANGE},{"??",M_DarkOliveGreen},{"??",M_Blue},{"??",LightPurple}}
		local T3={{"??",CC.FontNameSong},{"??",CC.FontNameHei},{"??",CC.FontName}}
		--??????????????????¡Á??????????????????????¡Â??¡Á????????¡ã¡Á???
		--????????¡Á???????¡Á?????????????????????????
		for i=0,9 do
			if T1[i+1]==str then return 1,i*50 end
		end
		for i=1,8 do
			if T2[i][1]==str then return 2,T2[i][2] end
		end
		for i=1,3 do
			if T3[i][1]==str then return 3,T3[i][2] end
		end
		return 0
	end

	local function mydelay(t)
		if t<=0 then return end
		lib.ShowSurface(0)
		lib.Delay(t)
	end

	local page, cy, cx = 0, 0, 0
  	local color, t, font = C_BLACK, 0, CC.FontName
  	while string.len(s) >= 1 do
		lib.GetKey();
		if JY.Restart == 1 then
			break
		end
    	if page == 0 then
      		Cls()
			if headid >= 0 then
				local w, h = lib.GetPNGXY(1, headid*2)
				local x = (picw - w) / 2
				local y = (pich - h) / 2
				lib.LoadPicture(CC.SayBoxFile,-1,-1);
				lib.LoadPNG(90, headid*2, xy[flag].headx + 5 + x-76, xy[flag].heady + 5 + y-by*220, 1)
				lib.LoadPicture(CC.SayBoxNMFile,xy[flag].namex-35,xy[flag].namey-10,1);	
				MyDrawString(xy[flag].namex, xy[flag].namex + 96, xy[flag].namey + 1, name, C_CYGOLD, 24)
				
			end
			page = 1
		end
		local str
		str=string.sub(s,1,1)
		if str=='*' then
			--str='??'
			s=string.sub(s,2,-1)
		else
			if string.byte(s,1,1) > 127 then		--????????¡Á?¡¦?
				str=string.sub(s,1,2)
				s=string.sub(s,3,-1)
			else
				str=string.sub(s,1,1)
				s=string.sub(s,2,-1)
			end
		end
		--????????????
		if str=='*' then
		elseif str=="??" then
			cx=0
			cy=cy+1
			if cy==3 then
				cy=0
				page=0
			end
		elseif str=="??" then
			cx=0
			cy=0
			page=0
		elseif str=="??" then
			ShowScreen();
			--WaitKey();
			lib.Delay(50)
		elseif str=="?¡Â" then
			ShowScreen();
			WaitKey();
			--lib.Delay(50)
		elseif str=="??" then
			s=JY.Person[pid]["????"]..s
		elseif str=="??" then
			s=JY.Person[0]["????"]..s
		else
			local kz1,kz2=readstr(str)
			if kz1==1 then
				t=kz2
			elseif kz1==2 then
				color=kz2
			elseif kz1==3 then
				font=kz2
			else
				lib.DrawStr(xy[flag].talkx+CC.DefaultFont*cx+CC.ScreenW/272,
							xy[flag].talky+(CC.DefaultFont+talkBorder)*cy+talkBorder-CC.ScreenH/27.428,
							str,color,CC.DefaultFont,font,0,0, 305)
				mydelay(t)
				cx=cx+string.len(str)/2
				if cx==talkxnum then
					cx=0
					cy=cy+1
					if cy==talkynum then
						cy=0
						page=0
					end
				end
			end
		end
		--???????????¨¾??????????¡ã??¨¹
		if page==0 or string.len(s)<1 then
			ShowScreen();
			WaitKey();
			lib.Delay(100)
		end

	end


	if JY.Restart == 1 then
		do return end
	end

	Cls();
end

function MyDrawString(x1, x2, y, str, color, size)
	local len = math.modf(string.len(str) * size / 4)
	local x = math.modf((x1 + x2) / 2) - len
	DrawString(x, y, str, color, size)
end

--¡¦???¡Á?¡¦???
--szFullString¡Á?¡¦???
--szSeparator¡¦???¡¦?
--¡¦???¡Á???,¡¦????¨®??¡Á¨¦
function Split(szFullString, szSeparator)
  local nFindStartIndex = 1
  local nSplitIndex = 1
  local nSplitArray = {}
  while true do
    local nFindLastIndex = string.find(szFullString, szSeparator, nFindStartIndex)
    if not nFindLastIndex then
      nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, string.len(szFullString))
      break;
    else
	    nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, nFindLastIndex - 1)
	    nFindStartIndex = nFindLastIndex + string.len(szSeparator)
	    nSplitIndex = nSplitIndex + 1
	  end
  end
  return nSplitIndex, nSplitArray
end

function DrawStrBox2(x, y, str, color, size, bjcolor)
  local strarray = {}
  local num, maxlen = nil, nil
  maxlen = 0
  num, strarray = Split(str, "*")
  for i = 1, num do
    local len = string.len(strarray[i])
    if maxlen < len then
      maxlen = len
    end
  end
  local w = size * maxlen / 2 + 2 * CC.MenuBorderPixel
  local h = 2 * CC.MenuBorderPixel + size * num
  if x == -1 then
    x = (CC.ScreenW - size / 2 * maxlen - 2 * CC.MenuBorderPixel) / 2
  end
  if y == -1 then
    y = (CC.ScreenH - size * num - 2 * CC.MenuBorderPixel) / 2
  end
  DrawBox2(x, y, x + w - 1, y + h - 1, C_WHITE, bjcolor)
  for i = 1, num do
    DrawString(x + CC.MenuBorderPixel, y + CC.MenuBorderPixel + size * (i - 1), strarray[i], color, size)
  end
end

--?????????????¡ã??¡ã¡Á??¡¦??¨¾??????¡ã???
function DrawBox2(x1, y1, x2, y2, color, bjcolor)
  local s = 4
  if not bjcolor then
    bjcolor = 0
  end
  if bjcolor >= 0 then
    lib.Background(x1, y1 + s, x1 + s, y2 - s, 128, bjcolor)
    lib.Background(x1 + s, y1, x2 - s, y2, 128, bjcolor)
    lib.Background(x2 - s, y1 + s, x2, y2 - s, 128, bjcolor)
  end
  if color >= 0 then
    local r, g, b = GetRGB(color)
    DrawBox_2(x1 + 1, y1, x2, y2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
    DrawBox_2(x1, y1, x2 - 1, y2 - 1, color)
  end
end

--????????¡ã?????¡¦??¨¾
function DrawBox_2(x1, y1, x2, y2, color)
  local s = 4
  lib.DrawRect(x1 + s, y1, x2 - s, y1, color)
  lib.DrawRect(x2 - s, y1, x2 - s, y1 + s, color)
  lib.DrawRect(x2 - s, y1 + s, x2, y1 + s, color)
  lib.DrawRect(x2, y1 + s, x2, y2 - s, color)
  lib.DrawRect(x2, y2 - s, x2 - s, y2 - s, color)
  lib.DrawRect(x2 - s, y2 - s, x2 - s, y2, color)
  lib.DrawRect(x2 - s, y2, x1 + s, y2, color)
  lib.DrawRect(x1 + s, y2, x1 + s, y2 - s, color)
  lib.DrawRect(x1 + s, y2 - s, x1, y2 - s, color)
  lib.DrawRect(x1, y2 - s, x1, y1 + s, color)
  lib.DrawRect(x1, y1 + s, x1 + s, y1 + s, color)
  lib.DrawRect(x1 + s, y1 + s, x1 + s, y1, color)
end

--???????¡Â????
function Init_MMap()
	--lib.PicInit()
	lib.LoadMMap(CC.MMapFile[1], CC.MMapFile[2], CC.MMapFile[3], CC.MMapFile[4], CC.MMapFile[5], CC.MWidth, CC.MHeight, JY.Base["??X"], JY.Base["??Y"])
  
    -- lib.PicLoadFile(CC.MMAPPicFile[1], CC.MMAPPicFile[2], 0)
	-- lib.LoadPNGPath('./data/mmap',0,-1,100)
    -- lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92)
	-- lib.LoadPNGPath('./data/BJ',0,-1,100)
	-- lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,80))
	-- lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.LoadPNGPath(CC.PTPath, 95, CC.PTNum, limitX(CC.ScreenW/1360*100,0,100))
	-- lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI		
	-- lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))
  
	-- lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)
    -- lib.LoadPNGPath('./data/thing',0,-1,100)
	
	JY.EnterSceneXY = nil
	JY.oldMMapX = -1
	JY.oldMMapY = -1
	PlayMIDI(JY.MmapMusic)
  
	AutoMoveTab = {[0] = 0}
end

--¡Á??¡§????????¡Á????¡ã??????
--??????????¡Á????¡ã????
--x????¡Á????¡ã?¨®??????X¡Á?????????-1?¨¾??????????X
--y????¡Á????¡ã?¨®??????Y¡Á?????????-1?¨¾??????????Y
--direct??????????¡¦??¨¾
function My_Enter_SubScene(sceneid,x,y,direct)
	--???¨®????????¡Á????¡ã?¡ã¡Á?????????10????
	if JY.Status == GAME_MMAP then
		SaveRecord(10)
	end
	JY.SubScene = sceneid;
	local flag = 1;   --??¡¦¨½¡Á??¡§????xy¡Á???, 0????1¡¦¨½
	if x == -1 and y == -1 then
		JY.Base["??X1"]=JY.Scene[sceneid]["????X"];
		JY.Base["??Y1"]=JY.Scene[sceneid]["????Y"];
	else
		JY.Base["??X1"] = x;
		JY.Base["??Y1"] = y;
		flag = 0;
	end
	
	if direct > -1 then
		JY.Base["??¡¦??¨¾"] = direct;
	end
 			
	
	if JY.Status == GAME_MMAP then
		CleanMemory();
		--lib.UnloadMMap();
	end
	lib.ShowSlow(20,1)

	JY.Status=GAME_SMAP;  --????¡Á???
	JY.MmapMusic=-1;

	JY.Base["????"]=0;
	JY.MyPic=GetMyPic(); 
  
	--???¡ã??????????????????¡Á????¡ã???¡§????¡Á???¡¦???????????????????
	--???????¡ã¡Á?????????????¡Á????¡ã??¡Á????????????????????¡¦????
	local sid = JY.Scene[sceneid]["??¡Á????¡ã"];
  
	if sid < 0 or (JY.Scene[sid]["???¡ã????X1"] <= 0 and JY.Scene[sid]["???¡ã????Y1"] <= 0) then
		JY.Base["??X"] = JY.Scene[sceneid]["???¡ã????X1"];  --??????¡Á????¡ã?¨®??XY¡Á???
		JY.Base["??Y"] = JY.Scene[sceneid]["???¡ã????Y1"];
	else
		JY.Base["??X"] = JY.Scene[sid]["???¡ã????X1"];  --??????¡Á????¡ã?¨®??XY¡Á???
		JY.Base["??Y"] = JY.Scene[sid]["???¡ã????Y1"];
	end

    
	Init_SMap(flag);  --??????????????
   -- lib.LoadPNGPath('./data/smap',0,-1,100)
	if flag == 0 then    --??????¡Á??¡§???????????????????????????????????¡ã????
		DrawStrBox(-1,10,JY.Scene[JY.SubScene]["????"],C_WHITE,CC.DefaultFont);
		ShowScreen();
		WaitKey();
	end
  
	Cls();	
end

--?¨¾?¡Á????
function JYZTB(id,pid)
	ShowStatus() 
end

function QZXS(s)
	DrawStrBoxWaitKey(s, C_GOLD, CC.DefaultFont)
end

--????????????¡Á?
function KungfuString(str, x, y, color, size, font, place)
  if str == nil then
    return 
  end
  local w, h = size, size + 5
  local len = string.len(str) / 2
  x = x - len * w / 2
  y = y - h * place
  lib.DrawStr(x, y, str, color, size, font, 0, 0)
end

--??????????¡Á?
function ClsN(x1, y1, x2, y2)
  if x1 == nil then
    x1 = 0
    y1 = 0
    x2 = 0
    y2 = 0
  end
  lib.SetClip(x1, y1, x2, y2)
  lib.FillColor(0, 0, 0, 0, 0)
  lib.SetClip(0, 0, 0, 0)
end


---??????????????????
--¡¦????????¨®??????????????????????¡¦?????
function ClipRect(r)
  if CC.ScreenW <= r.x1 or r.x2 <= 0 or CC.ScreenH <= r.y1 or r.y2 <= 0 then
    return nil
  else
    local res = {}
    res.x1 = limitX(r.x1, 0, CC.ScreenW)
    res.x2 = limitX(r.x2, 0, CC.ScreenW)
    res.y1 = limitX(r.y1, 0, CC.ScreenH)
    res.y2 = limitX(r.y2, 0, CC.ScreenH)
    return res
  end
end

--??????????????????Clip????
--(dx1,dy1) ????????????????????¡Á??????????????¡ã???????????????¡Â??????????
--pic1 ????????????
--id1 ????????????????
--(dx2,dy2) ????????????????????????
--pic2 ????????????
--id2 ????????????????
--¡¦????????????? {x1,y1,x2,y2}
function Cal_PicClip(dx1, dy1, pic1, id1, dx2, dy2, pic2, id2)
  local w1, h1, x1_off, y1_off = lib.PicGetXY(id1, pic1 * 2)
  local old_r = {}
  old_r.x1 = CC.XScale * (dx1 - dy1) + CC.ScreenW / 2 - x1_off
  old_r.y1 = CC.YScale * (dx1 + dy1) + CC.ScreenH / 2 - y1_off
  old_r.x2 = old_r.x1 + w1
  old_r.y2 = old_r.y1 + h1
  local w2, h2, x2_off, y2_off = lib.PicGetXY(id2, pic2 * 2)
  local new_r = {}
  new_r.x1 = CC.XScale * (dx2 - dy2) + CC.ScreenW / 2 - x2_off
  new_r.y1 = CC.YScale * (dx2 + dy2) + CC.ScreenH / 2 - y2_off
  new_r.x2 = new_r.x1 + w2
  new_r.y2 = new_r.y1 + h2
  return MergeRect(old_r, new_r)
end

--????????
function MergeRect(r1, r2)
  local res = {}
  res.x1 = math.min(r1.x1, r2.x1)
  res.y1 = math.min(r1.y1, r2.y1)
  res.x2 = math.max(r1.x2, r2.x2)
  res.y2 = math.max(r1.y2, r2.y2)
  return res
end



--???????¡ã¡Á?¡¦???
--????x,y??-1????????????????????
function NewDrawString(x, y, str, color, size)
	local ll = #str
	local w = size * ll / 2 + 2 * CC.MenuBorderPixel
	local h = size + 2 * CC.MenuBorderPixel
	if x == -1 then
		x = (CC.ScreenW - size / 2 * ll - 2 * CC.MenuBorderPixel) / 2
	else
		x = (x - size / 2 * ll - 2 * CC.MenuBorderPixel) / 2
	end
	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	else
		y = (y - size - 2 * CC.MenuBorderPixel) / 2
	end
	lib.DrawStr(x, y, str, color, size, CC.FontName, CC.SrcCharSet, CC.OSCharSet)
end

--??????????¡¦??¨§?¨¢???¨²ATM??????¡Á?????UI
function InputNum(str, minNum, maxNum, isEsc)
	local size = CC.DefaultFont;
	local b_space = size+CC.RowPixel
	local x=(CC.ScreenW-size*9-2*CC.MenuBorderPixel)/2;
	local y=(CC.ScreenH-size*9-2*CC.MenuBorderPixel)/2;
	local w=size*9+2*CC.MenuBorderPixel;
	local h=(b_space+CC.RowPixel*2)*6;
	local functional_button = {{name="?¡¦??"},{name="¡Á??¨®"},{name="????"},{name="????"},{name=0},{name=1},{name=2},{name=3},{name=4},{name=5},{name=6},{name=7},{name=8},{name=9}};
	local starting_y = 5;
	local starting_x = 1;

	for i = 1, #functional_button do
		functional_button[i].x1 = CC.ScreenW/2+(b_space+CC.RowPixel*2)*starting_x-11
		functional_button[i].y1 = y+(b_space+CC.RowPixel*2)*starting_y
		if i <= 4 then
			functional_button[i].x2 = CC.ScreenW/2+(b_space+CC.RowPixel*2)*starting_x-11+b_space*2
			functional_button[i].y2 = y+(b_space+CC.RowPixel*2)*starting_y+b_space
		else
			functional_button[i].x2 = CC.ScreenW/2+(b_space+CC.RowPixel*2)*starting_x-11+b_space
			functional_button[i].y2 = y+(b_space+CC.RowPixel*2)*starting_y+b_space
		end
		if i < 4 then
			starting_y = starting_y - 1
		elseif i == 4 then
			starting_y = 5
			starting_x = -1
		elseif i == 5 or i == 8 or i == 11 then
			starting_x = -2
			starting_y = starting_y - 1
		elseif i > 5 then
			starting_x = starting_x + 1
		end
	end

	local num = 0;
	if minNum ~= nil then
		num = minNum;
	end
	
	local selected_content = 0
	
	DrawBox(x,y,x+w-1,y+h-1,C_WHITE);
	DrawString(x+CC.MenuBorderPixel*2,y+CC.MenuBorderPixel,str.." "..minNum.." - "..maxNum,C_WHITE,size);
  
	local sid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH);
  
	while true do
		if JY.Restart == 1 then
			break
		end
		DrawShades(CC.ScreenW/2-b_space*3,y+b_space+CC.RowPixel*2,CC.ScreenW/2+b_space*3,y+b_space+CC.RowPixel*2+b_space)
		DrawString(CC.ScreenW/2,y+b_space+CC.RowPixel*2,string.format("%d",num),C_WHITE,size);
		
		for i = 1, #functional_button do
			local x_indent = 7
			local y_indent = 2
			if i > 4 then
				x_indent = 11
				y_indent = 0
			end
			local shade_color = nil;
			if i == selected_content then
				shade_color = C_GOLD
			end
			DrawShades(functional_button[i].x1,functional_button[i].y1,functional_button[i].x2,functional_button[i].y2,shade_color)
			DrawString(functional_button[i].x1+x_indent,functional_button[i].y1+y_indent,functional_button[i].name,C_GOLD,size);
		end
		
		ShowScreen()
		local key, ktype, mx, my = lib.GetKey();
		lib.Delay(CC.Frame)
        if (key == VK_ESCAPE or ktype == 4) and isEsc ~= nil then
			num = nil;
			break;
		elseif key == VK_UP then
		    num = num + 1
			if num > maxNum then
				num = maxNum
			end
		elseif key == VK_DOWN then
		    num = num - 1
			if  num <= minNum then
				num = minNum
			end	
		elseif key == VK_RIGHT then
		    num = num + 10
			if num > maxNum then
				num = maxNum
			end
		elseif key == VK_LEFT then
		    num = num - 10
			if  num <= minNum then
				num = minNum
			end	
		elseif key >= 49 and key <= 57 then
			num = num * 10
			num = num + key - 48
			if num > maxNum then
				num = maxNum
			end
		elseif key >= 1073741913 and key <= 1073741921 then
			num = num * 10
			num = num + key - 1073741912
			if num > maxNum then
				num = maxNum
			end
		elseif key == 48 or key == 1073741922 then
			num = num * 10
			if num > maxNum then
				num = maxNum
			end
		elseif key == VK_BACKSPACE then
			num = math.modf(num/10)
		elseif key == VK_SPACE or key == VK_RETURN then
			if num >= minNum and num <= maxNum then
				break;
			end
		elseif ktype == 2 or ktype == 3 then
			selected_content = 0
			if mx >= x and mx <= x + w-1 and my >= y and my <= y + h-1 then
				for k = 1, #functional_button do 
					if mx >= functional_button[k].x1 and mx <= functional_button[k].x2 and my >= functional_button[k].y1 and my <= functional_button[k].y2 then
						selected_content = k;
						break;
					end
				end
			end
			if ktype == 3 then
				if selected_content == 1 then
					if num >= minNum and num <= maxNum then
						break;
					end
				elseif selected_content == 2 then
					num = maxNum
				elseif selected_content == 3 then
					num = 0
				elseif selected_content == 4 then
					num = math.modf(num/10)
				elseif selected_content > 4 then
					num = num * 10
					num = num + functional_button[selected_content].name
					if num > maxNum then
						num = maxNum
					end
				end
			end
		end
		ClsN();
		lib.LoadSur(sid,0,0)
	end
	lib.FreeSur(sid);
	return num;
end

--¡¦???¡Á?¡¦???????¡¦¨½??????????
--??DrawTxt?????¡Â??
function AnalyString(str)
	local tlen = 0;
	local strcolor = {}
	--?¨§?¨¦??¡¦¨½??????????
	local f1, f2 = string.find(str, "<[A-R]>");
	if f1 ~= nil then
		while 1 do
			if f1 > 1 then
				local s1 = string.sub(str, 1, f1-1)
				table.insert(strcolor, {s1, nil});
				tlen = tlen + #s1;
			end
			local match = string.match(str, "<([A-R])>");
			local f3, f4 = string.find(str, "</"..match..">"); 
			if f3 ~= nil then
				local s2 = string.sub(str, f2+1, f3-1);
				table.insert(strcolor, {s2, CC.Color[match]});
				tlen = tlen + #s2;
				if f4+1 >= #str then
					break;
				end
				str = string.sub(str, f4+1, #str);
				f1, f2 = string.find(str, "<[A-R]>");
				--???????????????¨¹?????????????????????????¡¦
				if f1 == nil then
					table.insert(strcolor, {str, nil});
					break;
				end
			else		--???????????¨¢???????????????????????¡¦
				str = string.sub(str, f2+1, #str);
				table.insert(strcolor, {str, CC.Color[match]});
				break;
			end
		end
	else
		table.insert(strcolor, {str, nil});
	end
	return strcolor;
end

--???????¨ª
function SaveList()
	--????R*.idx????
	local idxData = Byte.create(24)
	Byte.loadfile(idxData, CC.R_IDXFilename[0], 0, 24)
	local idx = {}
	idx[0] = 0
	for i = 1, 6 do
		idx[i] = Byte.get32(idxData, 4 * (i - 1))
	end

	local table_struct = {}
	table_struct["????"]={idx[1]+8,2,10}
	table_struct["¡Á???"]={idx[1]+122,0,2}
  
	table_struct["????"]={idx[0]+2,0,2}
	table_struct["????"]={idx[0]+24,0,2}
	
	table_struct["??¡Á?"]={idx[0]+26,0,2}
	table_struct["????"]={idx[0]+28,0,2}
	table_struct["????"]={idx[0]+30,0,2}
	
	table_struct["?¨§?¨¦????"]={idx[0]+36,0,2}
	table_struct["????????"]={idx[0]+38,0,2}
	table_struct["???¡ã????"]={idx[3]+2,2,10}
	table_struct["?¨¦??"]={idx[0]+40,0,2}
	--?¡Â??????
	table_struct["???¨¦1"]={idx[0]+52,0,2}
  
	--table_struct[WZ7]={idx[2]+88,0,2}
  
	--?????????????¡ã??????
	--table_struct["???¡¦????"]={(CC.SWidth*CC.SHeight*(14*6+4) + CC.SWidth + 2)*2, 0, 2}
	--S_XMax*S_YMax*(id*6+level)+y*S_XMax+x
	--14, 2, 1, 4
	--sFile,CC.TempS_Filename,JY.SceneNum,CC.SWidth,CC.SHeight

	--????R*.grp????

	local len = filelength(CC.R_GRPFilename[0]);
	local data = Byte.create(len);
	
	--????SMAP.grp
	local slen  = filelength(CC.S_Filename[0]);
	local sdata = Byte.create(slen);
	
	local menu = {};

	for i=1, CC.SaveNum do
	
		local name = "";
		--local lv = "";
		local sname = "";
		local nd = "";
		local time = "";
		--?¨§?¨¦????
		local tssl = "";
		--?¡Â??????
		local zjlx = "";	
		--¡Á???
		local zz = "";
		
		if existFile(string.format(CONFIG.DataPath..'save/Save_%d',i)) then
			Byte.loadfilefromzip(data, string.format(CONFIG.DataPath..'save/Save_%d',i),CONFIG.DataPath..'save/r.grp', 0, len);
			
			local pid = GetDataFromStruct(data,0,table_struct,"???¨¦1");
			
			name = GetDataFromStruct(data,pid*CC.PersonSize,table_struct,"????");
			zz = GetDataFromStruct(data,pid*CC.PersonSize,table_struct,"¡Á???");
			
			local wy = GetDataFromStruct(data,0,table_struct,"????");
			if wy == -1 then
				sname = "?¨®????";
			else
				sname = GetDataFromStruct(data,wy*CC.SceneSize,table_struct,"???¡ã????").."";
			end
			
			local lxid1 = GetDataFromStruct(data,0,table_struct,"??¡Á?");
			local lxid2 = GetDataFromStruct(data,0,table_struct,"????");
			local lxid3 = GetDataFromStruct(data,0,table_struct,"????");
			
			if lxid1 > 0 then
				zjlx = "??¡Á?"
			elseif lxid2 > 0 then
				zjlx = "????"
			elseif lxid3 > 0 then
				zjlx = "????"
			end
			
			local wz = GetDataFromStruct(data,0,table_struct,"????");
			tssl = GetDataFromStruct(data,0,table_struct,"?¨§?¨¦????").."??";

			nd = MODEXZ2[wz]
			
			--???¡¦????
			--[[
			Byte.loadfile(sdata, string.format(CC.S_GRP,i), 0, slen);
			
			local t = GetDataFromStruct(sdata, 0, table_struct, "???¡¦????")
			local t1, t2 = 0, 0
			while t >= 60 do
				t = t - 60
				t1 = t1 + 1
			end
			t2 = t
		  
			time = string.format("%2d??%2d??", t1, t2)]]
		end
		
		if i < 10 then
			menu[i] = {string.format("????%02d %-4s %-10s %-4s %4s %4s %-10s", i, zjlx, name, nd, zz, tssl, sname), nil, 1};
		else
			menu[i] = {string.format("¡Á????? %-4s %-10s %-4s %4s %4s %-10s", zjlx, name, nd, zz, tssl, sname), nil, 1};
		end
	end

	local menux=(CC.ScreenW-24*CC.DefaultFont-2*CC.MenuBorderPixel)/2
	local menuy=(CC.ScreenH - 9*(CC.DefaultFont+CC.RowPixel))/2

	local r=saveShowMenu(menu,CC.SaveNum,10,menux,menuy,0,0,1,1,CC.DefaultFont,C_WHITE,C_GOLD)
	lib.Debug("SaveList")
	CleanMemory()
	return r;
end

--?????¨¢??????
function DrawTimer()
	if CC.OpenTimmerRemind ~= 1 then
		return;
	end
	local t2 = lib.GetTime();
	if CC.Timer.status==0 then
		if t2-CC.Timer.stime > 30000 or CC.Timer.stime == 0 then
			CC.Timer.stime=t2;
			CC.Timer.status=1;
			CC.Timer.str=CC.RUNSTR[math.random(#CC.RUNSTR)];
			CC.Timer.len=string.len(CC.Timer.str)/2+3;
		end
	else
		CC.Timer.fun(t2);
	end
end

function demostr(t)
	local tt=t-CC.Timer.stime;
	tt=math.modf(tt/25)%(CC.ScreenW+CC.Timer.len*CC.Fontsmall);
	if runword(CC.Timer.str,M_Orange,CC.Fontsmall,1,tt)==1 then
		CC.Timer.status=0;
		CC.Timer.stime=t;
	end
end

function runword(str,color,size,place,offset)
	offset=CC.ScreenW-offset;
	local y1,y2
	if place==0 then
		y1=0;
		y2=size;
	elseif place==1 then
		y1=CC.ScreenH-size;
		y2=CC.ScreenH;
	end
	lib.Background(0,y1,CC.ScreenW,y2,128);
	if -offset>(CC.Timer.len-1)*size then
		return 1;
	end
	DrawString(offset,y1,str,color,size);
	return 0;
end

function dark()
	instruct_14()
end

function light()
	instruct_13()
end

--???????????¨ª??????????
function addevent(sid, pid, pass, event, etype, pic, x, y)
	if JY.Restart == 1 then
		return
	end
	if x == nil then x = -2 end
	if y == nil then y = -2 end
	if pic == nil then pic = -2 end
	if etype == nil then etype = 1 end
	if event == nil then event = -2 end
	if pass == nil then pass = -2 end
	if etype == 1 then
		instruct_3(sid, pid, pass, 0, event, 0, 0, pic, pic, pic, -2, x, y)
	elseif etype == 2 then
		instruct_3(sid, pid, pass, 0, 0, event, 0, pic, pic, pic, -2, x, y)
	else
		instruct_3(sid, pid, pass, 0, 0, 0, event, pic, pic, pic, -2, x, y)
	end	
end

--??????????????????????
function null(sid, pid,x,y)
	if pid ~= -2 then
		addevent(sid, pid, 0, 0, 0, 0)
	else
		addevent(sid,pid,0,0,0,0,x,y)
	end		
end

--???????????????????¨½????
function ShowMenu3(menu,itemNum,numShow,showRow,x1,y1,size,color,selectColor)
    local w=0;
    local h=0;   --???¨¾???¨ª??
    local i,j=0,0;
    local col=0;     --????????????????
    local row=0;
    lib.GetKey();
    Cls();

    --?¡§????????table
    local menuItem = {};
    local numItem = 0;                --??????¡Á???
    
    --¡ã???????????????????????????table
    for i,v in pairs(menu) do
        if v[3] ~= 0 then
            numItem = numItem + 1;
			menuItem[numItem] = {v[1],v[2],v[3],i};                --¡Á?????4????????????i????
        end
    end
    
    --??????????????????????
    if numShow==0 or numShow > numItem then
        col=numItem;
        row = 1;
    else
		--????
        col=numShow;
		--(????¡Á???-1)/????=????
        row = math.modf((numItem-1)/col);
    end
    
    if showRow > row + 1 then
        showRow = row + 1;
    end

    --???????¨¾?????¨ª??
    local maxlength=0;

	for i=1,numItem do
		if string.len(menuItem[i][1])>maxlength then
			maxlength=string.len(menuItem[i][1]);
		end
	end
	w=(size*maxlength/2+CC.RowPixel*2)*col+2*CC.MenuBorderPixel;
	h=showRow*(size+CC.RowPixel*2) + 2*CC.MenuBorderPixel;

    local start=0;             --????????????

    local curx = 1;          --???¡ã???¨½??
    local cury = 0;
    local current = curx + cury*numShow;

    local returnValue =0;

    local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)

    while true do
		lib.GetKey()
		if JY.Restart == 1 then
			break
		end
        if col ~= 0 then
            lib.LoadSur(surid, 0, 0)
        end
		--???¡Â??????
		--DrawString(x1+(size+CC.RowPixel)*9-3,y1-(size+CC.RowPixel)*2-CC.RowPixel,"PgUp/PgDn/?¨®??????¡¦???",LimeGreen,size);
		--DrawString(x1+(size+CC.RowPixel)*8-50,y1-(size+CC.RowPixel)*1,"?????????????¡Á ?????????????¡Á ?¨§???????¡Á",LimeGreen,size);
		for i=start,showRow+start-1 do
			for j=1, col do
				local n = i*col+j;
				if n > numItem then
					break;
				end
                
				--??????????????????
                local drawColor=color; 
                if menuItem[n][3] == 2 then
					drawColor = M_DeepSkyBlue
				end
				if menuItem[n][1] == "?????¨®¡ã?"  or menuItem[n][1] == "?¡§??????"
				 or menuItem[n][1] == "????¡¦¨¢" 
				  then  
					drawColor = C_RED
                end
				if menuItem[n][1] == "???¨¢" or menuItem[n][1] == "????" or menuItem[n][1] == "???¡ã??" 
				or menuItem[n][1] == "??¡ã¡Á"or menuItem[n][1] == "?¡¦????"  or menuItem[n][1] == "????" 
				or menuItem[n][1] == "????¡Á?" or menuItem[n][1] == "????" or menuItem[n][1] == "????" 
				or menuItem[n][1] == "????" or menuItem[n][1] == "????????" or menuItem[n][1] == "??????"
				or menuItem[n][1] == "¡¦???" or menuItem[n][1] == "??????" or menuItem[n][1] == "??????"then
				   drawColor = M_Plum
				   end
                local xx = x1+(j-1)*(size*maxlength/2+CC.RowPixel*2) + CC.MenuBorderPixel
                local yy = y1+(i-start)*(size+CC.RowPixel*2) + CC.MenuBorderPixel
                if n==current then
                    drawColor=selectColor;
                    lib.Background(xx-5, yy-5, xx + size*maxlength/2, yy + size+5, 128, color)
                end
                DrawString(xx,yy,menuItem[n][1],drawColor,size);

            end
        end
		ShowScreen();
		local keyPress, ktype, mx, my = WaitKey(1)
		local mk = false;
		lib.Delay(CC.Frame);

		if keyPress==VK_DOWN then                --Down
			cury = cury + 1;
					if cury == showRow then
						cury = 0
					elseif curx + cury*col > numItem then
						cury = 15
					end
		elseif keyPress==VK_UP then                  --Up
					if cury ~= 15 then
						cury = cury -1;
						if cury < 0 then
							cury = showRow-1;
						end
					else
						if curx + row*col > numItem then
							cury = row - 1
						else
							cury = row
						end
					end
		elseif keyPress==VK_RIGHT then                --RIGHT
                    curx = curx +1;
                    if curx > col then
                        curx = 1;
                    elseif curx + cury*col > numItem then
                        curx = 1;
                    end
		elseif keyPress==VK_LEFT then                  --LEFT
                    curx = curx -1;
                    if curx < 1 then
                        curx = col;
                        if curx + cury*col > numItem then
							curx = numItem - cury*col;
                        end
                    end
		elseif keyPress==VK_PGUP or ktype == 6 then    --PgUp ?¨¾ ?¨®????????
					if start == 15 then
						start = start - 15;
						curx = 1
						cury = 0
						mk = true;
					end
		elseif keyPress==VK_PGDN or ktype == 7 then    --PgDn ?¨¾ ?¨®????????	
			if start == 0 then
				start = start + 15;
				curx = 1
				cury = 15
				mk = true;
			end
		else
			if ktype == 2 or ktype == 3 then			--????
				--?????????????????????¡§¡¦???????
				local re1, re2 = curx, cury;
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					curx = math.modf((mx-x1-CC.MenuBorderPixel)/(size*maxlength/2+CC.RowPixel*2)) + 1
					cury = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel*2))
					mk = true;
				end
				if (curx + cury*col) > #menuItem then
					curx = re1
					cury = re2
					mk = false;
				end
			end
			--???¨½????????
			if keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				current = curx + cury*col;
				if menuItem[current][3]==3 then
				
				elseif menuItem[current][2]==nil then
					local ys = showCXStatic(menuItem[current][4])
					if ys then
						returnValue=current
						break
					end
				else
					local r=menuItem[current][2](menuItem,current)
					if r==1 then
						returnValue= -current;
						break;
					else
						lib.LoadSur(surid, 0, 0)
					end
				end
            end
		end 
		current = curx + cury*col;
    end
	lib.FreeSur(surid)
        
	--¡¦?????????????????4??????????
	if returnValue > 0 then
		return menuItem[returnValue][4]
	else
		return returnValue
	end
end

function showCXStatic(id)
	if existFile(CC.Acvmts) then
		dofile(CC.Acvmts)
		local r = false
		local ndChn = {"?¨¾??","???¡§","?¡ì??","???¨¹"}
		local highLvl
		if Achievements.rdsCpltd[id].lvlReached2 > 0 then
			highLvl = Achievements.rdsCpltd[id].lvlReached1.."??"..ndChn[Achievements.rdsCpltd[id].lvlReached2]
		else
			highLvl = "????"
		end
		while true do
			if JY.Restart == 1 then
				return
			end
			Cls()
			
			lib.LoadPNG(91, 30 * 2 , 0, 0, 1)
			
			DrawString(390,50-40,JY.Person[id]["????"],C_GOLD,CC.FontBig*0.9)
			
			DrawString(80,130,"?¡§????????"..Achievements.rdsCpltd[id].n.."??",C_WHITE,CC.DefaultFont)
			DrawString(80,200,"¡Á????¡§????????"..highLvl,C_WHITE,CC.DefaultFont)
			
			DrawString(CC.ScreenW/2 - 160,CC.ScreenH - 40,"?????¨¹?¡¦?????¨½ ESC????",LimeGreen,CC.DefaultFont*0.98)
			
			local keypress, ktype, mx, my = lib.GetKey()
			
			if keypress == VK_RETURN then
				r = true
				break
			elseif keypress == VK_ESCAPE or ktype == 4 then
				break
			end
			ShowScreen()
			lib.Delay(CC.Frame)
		end
		return r
	end
end

--???????????¨½??????????
function get_skill_power(personid,wugongid, wugonglvl)
	local power;
	local p = JY.Person[personid]
	--??????????¡ã?10????????
	if wugonglvl == 11 then
		wugonglvl = 10
	end
	local spower = 0 	
	power = JY.Wugong[wugongid]["???¡Â??"..wugonglvl] 
	if wugongid == 354 then	
		local pw1 = JY.Wugong[354]['??¡¦?????']
		local pw2 = JY.Wugong[354]['¡Á???????']
		power = math.modf((JY.Wugong[pw1]["???¡Â??"..wugonglvl] + JY.Wugong[pw2]["???¡Â??"..wugonglvl])*0.7)
	end	
	if wugongid == 379 then
		power = power + math.modf(wugonglvl*90)
	end	
	spower = power
	--??????????????+ 50
	for i = 1,JY.Base['????????'] do
		local level = math.modf(p["????????" .. i] / 100) + 1
		if p["????????" .. i] == 999  and JY.Wugong[wugongid]['????????'] ~= 6 and wugongid == p['????'..i] then
			power = power + 50
			break
		end
	end
    if wugongid >= 109 and wugongid <= 112 then
        local xs = 0
        local lx = JY.Wugong[wugongid]['????????']
        if lx == 1 then 
            xs = TrueQZ(personid)--JY.Person[personid]["??????¡¦¨¾"]
        elseif lx == 2 then 
            xs = TrueZF(personid)--JY.Person[personid]["??¡¦¡§????"]
        elseif lx == 3 then 
            xs = TrueYJ(personid)--JY.Person[personid]["????????"]    
        elseif lx == 4 then 
            xs = TrueSD(personid)--JY.Person[personid]["????????"]
        elseif lx == 5 then 
            xs = TrueTS(personid)--JY.Person[personid]["???????¡Â"]
        end
        if isteam(personid) then
            power = limitX(power + xs*3,300,1000)
        else 
            power = 1000
        end
	end
	--?¨¢???¨§????????????
	if Given_WG(personid, wugongid) then
		power = power + 100
	end
	--?¨¢???¨§????????????
	if Given_NG(personid, wugongid) then
		if power < 800 then
			power = 800
		else
		    power = math.modf(power * 1.1)
		end
	end

	--?¡ì?????¡§???¨®?????¡ã??????
	if wugongid == 48 and PersonKF(personid, 105) then
		power = 1200
	end
	
	if wugongid == 313 and PersonKF(personid, 105) then
		power = power + 300
		if Curr_NG(personid,105) or match_ID(personid,27) then
			power = power + 200
		end	
	end
	--??¡¦?????????
	if wugongid == 27 and match_ID(personid,457) then
		power = power + 2000
	end
    --?????¨¾????
	if match_ID(personid, 138) or match_ID(personid, 9897) then
		if yongzhi(wugongid) and JY.Base["?¨§?¨¦????"] > 0 then
		    power = power+ (50 * JY.Base["?¨§?¨¦????"])
		end
	end
	--?????¨®¡¦?????????
	--??????+??????¡Á?????????¡¦¡§
	if wugongid == 39  then
		for i = 123,129 do
			if JXPD(personid,i,1) then
				power = power * 2
				break
			end
		end
		if JXPD(personid,68,1) then
			power = power * 2
		end			
	end
	--?¡¦??¡¦?????????????¡ã¡Á??¡Á?
	if wugongid == 11 and (JXPD(personid,78,1) or JXPD(personid,640,1)) then
		power = power * 1.5
	end
	--???¨§¡¦???
	if wugongid == 189 and (match_ID(personid,9983) or JinGangBR(personid)) then
		power = power * 1.5
	end
	--¡ã????¡Á
	if (wugongid == 230 or wugongid == 231) and PersonKF(personid,235) then
		power = power + 200
	end
	--?????? ??????¡¦¡§
	if wugongid == 40  and match_ID(personid, 639) then
		power = power * 1.5
	end	
	--¡ã??? ??????¡¦¡§
	if wugongid == 35 and JXPD(personid, 582,1) then
		power = power * 2
	end	
	--?¡è??????????????
	if wugongid == 5 and JXPD(personid,14,1) then
		power = power * 1.5
	end
	--?¨®?¨§??????¡Á???
	if wugongid == 4 and JXPD(personid,12,1) then
		power = power * 1.5
	end
	--?¨§????¡¦????¨ª????
	if wugongid == 117 and JXPD(personid,131,1) then
		power = power * 1.5
	end
	--?¨§??¡Á????¡Á??¡ã??¨¾
	if wugongid == 74 and JXPD(personid,157,1) then
		power = power * 2
	end
	--?????¨½?? ?????¨½?? ????¡¦??? ????????
	if wugongid==3 and Curr_NG(personid,220) then
		power = power * 2
	end 
    --?¨²¡¦?????????????¡¦???
	if match_ID(personid, 510) and wugongid == 73 then
		power = power * 2
	end	
	--????????????????
	if match_ID(personid, 605) then
		power = power * 1.1
	end
	if match_ID(personid,9749) and wugongid == 52 then
		power = power * 2
	end
	
	if match_ID(personid, 9744) and wugongid == 19 then
		power = power * 1.5
	end
	--??????¡Á?
	if PersonKF(personid, 317) then
		power = power * 1.05
	end
	--???¨²????
    if wugongid == 45 and (match_ID(personid, 58) or match_ID(personid, 592) or match_ID(personid, 628) or actor(personid,3)) then
		power = power + 300
	end
	--?????? ¡¦¨¾????¡¦¡§ 1.5??
	if wugongid == 62 and match_ID(personid, 566) then
		power = power * 1.5
	end	
    if match_ID(personid,9748) and wugongid == 141 then
		power = power + 300
	end
	
	if match_ID(personid,9747) and (wugongid == 59 or wugongid == 232) then
		power = power + 200
	end
	--??¡Á???????¡¦???
	if match_ID(personid, 587) and (wugongid == 78 or wugongid == 164) then
		power = power + 300
	end
	--???¡ã????
	if match_ID(personid, 9888)  and wugongid == 48 then
		power = power + 500
	end
	--¡Â?¡ã?????¡¦??? ????????
	if match_ID(personid,603) and wugongid == 119 then
		power = power + 600
	end
    
	--?¨§??????
	if match_ID(personid,9988) and wugongid == 10 then
		power = power + 600
	end
	if PersonKF(personid, 85) then
		if wugongid == 8 or wugongid == 14 or wugongid == 185 or wugongid == 202 or wugongid == 201 then
           power = power + 100
        end
    end 
    --???????¡¦ ????????
    if (wugongid ==8 or wugongid == 14 or wugongid == 98 or wugongid == 101 or wugongid ==185 ) and PersonKF(personid,98) then
	    power = power + 100
	end	
	--?????¡Á
	if (wugongid == 16 or wugongid == 46) and Curr_NG(personid, 171) then
	   power = power + 100
	end
    
	--????¨§??? ??????
	if wugongid ==17 and PersonKF(personid, 207) then
	   power = power + 100
	end
	-- ¡ã¡Á??
    if (match_ID(personid, 9997) or PersonKF(personid,247)) and wugongid == 188 then
       power = power + 500
	end	
	--?¨§?????¡¦?????¨¦?¨½????????????¡Á????????????????¨¢??
	if wugongid == 14 then
		if match_ID(personid, 49) or match_ID(personid, 116) or match_ID(personid, 117) or match_ID(personid, 118) or match_ID(personid, 9754)  then
			for i = 1, JY.Base["????????"] do
				if JY.Person[personid]["????"..i] ~= 14 and JY.Person[personid]["????????"..i] == 999 then
					power = power + 50
				end
			end
		end
	end
    -- ¡¦¨¹?¡ì¨§??? ¡¦¨¹?¡ì??¡¦¡§
	if wugongid == 86 and PersonKF(personid,96) then
	   power = power + 100
	   end	
    -- ¡ã¡Á?? ??????¡¦¡§
	if (wugongid == 188 or wugongid ==156) and PersonKF(personid,180) then
	   power = power + 100
	end		   
    
	if wugongid == 110 and JY.Person[personid]["???¡Â"] == 55 then
	   power = power + 100
	end	
	if wugongid == 111 and JY.Person[personid]["???¡Â"] == 56 then
	   power = power + 100
	end	
	if wugongid == 112 and JY.Person[personid]["???¡Â"] == 57 then
	   power = power + 100
    end	
    
	--¡ã¡Á????????¡¦¡§
	if wugongid == 35 then
		if JXPD(personid, 582,1) then
			for i = 1, JY.Base["????????"] do
				if JY.Person[personid]["????"..i] ~= 35 and JY.Person[personid]["????????"..i] == 999 then
					power = power + 100
				end
			end
		end
    end
    
    -- ??????????¡¦¡§
    if wugongid == 61 and JXPD(personid, 581,1) then
	    power = power + 300
	end
	
	--??????¡¦¡§?????¨¢??
	if wugongid >= 30 and wugongid <= 34 then
		power = power + WuyueJFSL(personid)*100
		if wugongid == 30 and PersonKF(personid,259) then --?¨¾?¡§??????
			power = power + 100
		end	
		if wugongid == 31 and PersonKF(personid,264) then --??¡ã?????????
			power = power + 100
		end
		if wugongid == 32 and PersonKF(personid,263) then --???¨ª???¨¾??
			power = power + 100
		end
		if wugongid == 33 and PersonKF(personid,216) then --?¨¾????????
			power = power + 100
		end
		if wugongid == 34 and PersonKF(personid,89) then --??????¡Á???
			power = power + 100
		end
	end
	--??????¡¦¡§+???????¡Â???????¨¢??
	if wugongid >= 30 and wugongid <= 34 and PersonKF(personid,175) then
		if MPTX(personid,14) then 
			power = power + 300
		else	
			power = power + 100
		end	
	end
	if wugongid == 377 and PersonKF(personid,175) then
		power = power + 300
	end	
	--???????????????¨¢??
	if (wugongid == 39 or wugongid == 42 or wugongid == 139) and WGZH(personid,39,42) then
		power = power + 100
	end
	--?????¨¦???????¨¢??
	if (wugongid == 73 or wugongid == 72 or wugongid == 84 or wugongid == 142) and WGZH(personid,72,73) then
		power = power + 100
	end
	--???¡§?????????¨¢??
	if (wugongid == 12 or wugongid == 18 or wugongid == 38) and WGZH(personid,12,18) then
		power = power + 100
	end
	--¡Á????¨§???????¨¢??
	if (wugongid == 5 or wugongid == 9 or wugongid == 21 or wugongid == 118) and WGZH(personid,21,118) then
		power = power + 300
	end
	--?????????????¨¢?? ????????
    if (wugongid==3 or wugongid==120 or wugongid==220  or wugongid==295  or wugongid==334) and DubuWL(personid) then
		power = power + 300
	end
	--?¨§???????¨¢??	????????
	if wugongid == 335 then
		power = power +JY.Base["?¨§?¨¦????"] * 50
	end
	
	if PersonKF(personid,107) then
		--???????????¨¢?? ????????
		if wugongid == 328 then
			power = power + 900
		--?????¨½????¡ã¡Á??¡Á??????¨¢??
		elseif wugongid == 11 then
		    power = power + 100
		end
	end
	
	--???????¨¦	????????
	if wugongid == 199 then
		local sz=math.modf(JY.Person[personid]["????"])
		if not inteam(personid) then
			sz = 500
		end
	   power = power + 750 + sz
    end	
	--????????????
	if MPTX(personid,5,4) and wugongid == 198 then
		local sz = JY.Person[personid]["????"]
		power = power + sz
	end
	--?¡Á?????????????¡ì
	if (wugongid == 1  or wugongid == 22 or wugongid == 24 or wugongid == 189 or wugongid == 86 or wugongid == 124 or wugongid == 132 
	or wugongid == 133 or wugongid == 135  or wugongid == 136   or wugongid == 137 or wugongid == 65 or wugongid == 140 or wugongid == 144 or wugongid== 194) and Curr_NG(personid,108) then
        power = power + 100
	end
	if MPTX(personid,5) and PersonKF(personid,208) then
		if wugongid == 1 then
			power = power + 300
		end
		if wugongid == 347 then
			power = power + TrueQZ(personid)
		end
	end			
	
	--?¡Á???????????¨¢??
	if match_ID(personid, 9928) and (Curr_NG(personid, 108) or JY.Person[personid]["????????4"] == 1001) and wugongid > 0 then
		power = power + 200 + JY.Base["?¨§?¨¦????"] * 50
	end
	
	if NGQH(personid,108) and wugongid == 108 then
		power = power + 400
	end
	
	--???¡Â¡Á¡ã??????????
	for i,v in ipairs(CC.ExtraOffense) do
		if v[1] == JY.Person[personid]["???¡Â"] and v[2] == wugongid then
			power = power + v[3]
		end
	end
	
	if wugongid == 155 and (match_ID(personid, 606) or match_ID(personid, 9761) or PDTZ(personid,JY.Person[personid]["???¡Â"])) then
		power = power + 3000
	end
	
	--????????
	if wugongid > 0 and match_ID(personid,9982) then
		if match_ID(personid,592) then
			power = power + 1000
		else
		    power = power + 100
		end
	end
	--???????¡¦????????????
	if JY.Status == GAME_WMAP then
        --¡ã¡Á????????¡¦¡§
		if WAR.PD['???¡§????'][personid] ~= nil and wugongid == 35 then 
            power = power + spower * WAR.PD['???¡§????'][personid]
        end
		--????????????¡ã???????¡¦???
		if match_ID(personid, 612) and wugongid == 206 and WAR.ZWX > 0 then
			power = power *  WAR.ZWX
		end
		--¡Á??¨§????????¡ã????????¨§?¨²??????¡¦???
		if match_ID(personid, 613) and (wugongid == 205 or wugongid == 206) and WAR.ZWX > 0 then
			power = power *  WAR.ZWX
		end	
		--???¨²?????¡¦??????????¡¦???	????????
		if match_ID(personid, 83) and wugongid == 3 and WAR.HTS > 0 then
			power = power * WAR.HTS
		end
		--???¡§???¡§??
		if wugongid == 226 and Curr_NG(personid,105) and PersonKF(personid,105) and WAR.KHZF > 0 then
			power = power * WAR.KHZF
		end
		if wugongid == 226 or wugongid == 126 or wugongid == 127 or wugongid == 201 then
			if PersonKF(personid,226) and PersonKF(personid,201) and (PersonKF(personid,126) or PersonKF(personid,127)) then
				power = power + 300
			end
		end
		--?????¨½???????¨¢??????????
        if Curr_NG(personid, 171) and (wugongid ==16 or wugongid == 46) and WAR.tmp[3000 + personid] ~= nil and WAR.tmp[3000 + personid] > 0 then
            if wugongid == 16 then
                power = power + WAR.tmp[3000 + personid]
            else			 
                power = power + math.modf(WAR.tmp[3000 + personid] / 2)
            end
        end	
		--????????
		if MPTX(personid,5,2) and WAR.PD['??????'][personid] ~= nil and (yongquan(wugongid) or yongzhi(wugongid)) then
			power = power + limitX(math.modf(WAR.PD['??????'][personid]*0.2),0,5000)
		end
		--????????
		if MPTX(personid,5,2) and WAR.PD['????????'][personid] ~= nil and (yongdao(wugongid) or yongte(wugongid)) then
			power = math.modf(power*WAR.PD['????????'][personid]*0.01)
		end
	end		
	--??????????????¡¦?
	if PersonKF(personid,41) and JY.Wugong[wugongid]["????????"] == 3 then
		if match_ID(personid, 631) or match_ID(personid,6) then
            power = power + 200
        else
            power = power + 100
        end
    end
 	--??¡¦¡§???¡§
	 if match_ID(personid,9960) and JY.Wugong[wugongid]["????????"] == 1 then
            power = power + 100
	end 
 	--??¡¦¡§???¡§
	 if match_ID(personid,9959) and JY.Wugong[wugongid]["????????"] == 2 then
		power = power + 100
	 end
 	--??¡¦¡§???¡§
	 if match_ID(personid,9958) and JY.Wugong[wugongid]["????????"] == 3 then
		power = power + 100
	 end	 
 	--??¡¦¡§???¡§
	 if match_ID(personid,9957) and JY.Wugong[wugongid]["????????"] == 4 then
		power = power + 100
	 end	
 	--???????¡§
	 if match_ID(personid,9956) and JY.Wugong[wugongid]["????????"] == 5 then
		power = power + 100
	 end
 	--?¨½??????
	 if match_ID(personid,9955) and JY.Wugong[wugongid]["????????"] == 1 then
            power = power + 200
	end 
 	--?¡ì???¨½?¡§
	 if match_ID(personid,9954) and JY.Wugong[wugongid]["????????"] == 2 then
		power = power + 200
	 end
 	--?????¡§?¨½
	 if match_ID(personid,9953) and JY.Wugong[wugongid]["????????"] == 3 then
		power = power + 200
	 end	 
 	--¡ã????¨½??
	 if match_ID(personid,9952) and JY.Wugong[wugongid]["????????"] == 4 then
		power = power + 200
	 end	
 	--????????
	 if (match_ID(personid,9951) or match_ID(personid,69)) and JY.Wugong[wugongid]["????????"] == 5 then
		power = power + 200
     end	 	  	  
	--?¨²???? ?????¨®??
	if match_ID(personid, 633) and PersonKF(personid,44) and wugongid == 67 then
		power = power + 200
	end	
	--¡¦???
	if match_ID(personid, 588)  and (wugongid == 18 or wugongid == 38 or wugongid == 12 or wugongid == 126) then
		power = power + 200
	end	
	if match_ID(personid,9919) and wgnlxz(wugongid) == 0 then
		power = power + limitX(math.modf(psx(personid,'????')*0.7),0,5000)
	end	
	
	power = math.modf(power)
	return power
end


--???????????¡§
function stands()
	JY.MyCurrentPic=0
	if JY.Person[0]["????"] == 0 then
		JY.MyPic=CC.MyStartPicM+JY.Base["??¡¦??¨¾"]*7+JY.MyCurrentPic;
	else
		JY.MyPic=CC.MyStartPicF+JY.Base["??¡¦??¨¾"]*7+JY.MyCurrentPic;
	end
end

--???????????¨ª???????¨½????
function TeleportMenu(menu, color, selectColor)
	local x1	--????????X¡Á???
    local y1	--????????Y¡Á???
    local w		--?????¨ª??
    local h		--????????
	local maxlength		--????¡Á??¨®?¡è??
	local size = CC.Fontsmall	--¡Á????¨®??
	--local size1 = CC.Fontsmall*0.9	--¡Á????¨®??
	local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
	x1 = CC.MainMenuX+3
    y1 = CC.MainMenuY+CC.Fontsmall*2 +9

	maxlength = 8
	
	w = (size*maxlength/2+CC.RowPixel*4+5)*7 + CC.MenuBorderPixel	--7??????
    h = (size+CC.RowPixel*2-1)*16 + CC.MenuBorderPixel				--16??¡Á??¨®????
	
    lib.GetKey();
    Cls();
	
	lib.LoadPNG(91, 13 * 2 , bx*212 , by*33.5, 1)		--???¡ã??
    
	--?¡§???????¨ª?¨½???????????????????¡ã
    local PType_1 = {};
    local PNum_1 = 0;
	local PType_2 = {};
    local PNum_2 = 0;
	local PType_3 = {};
    local PNum_3 = 0;
	local PType_4 = {};
    local PNum_4 = 0;
	local PType_5 = {};
    local PNum_5 = 0;
	local PType_6 = {};
    local PNum_6 = 0;
	local PType_7 = {};
    local PNum_7 = 0;
    
	--v123¡¦????????¡ã????????¡¦¨½?????????¡ã????
	--v2??0?¨²?¨ª????????1?¨²?¨ª????????
    for i,v in pairs(menu) do
        if v[4] == 1 then
			PNum_1 = PNum_1 +1
			PType_1[PNum_1] = {v[1],v[2],v[3]}
		elseif v[4] == 2 then
			PNum_2 = PNum_2 +1
			PType_2[PNum_2] = {v[1],v[2],v[3]}	
		elseif v[4] == 3 then
			PNum_3 = PNum_3 +1
			PType_3[PNum_3] = {v[1],v[2],v[3]}
		elseif v[4] == 4 then
			PNum_4 = PNum_4 +1
			PType_4[PNum_4] = {v[1],v[2],v[3]}	
		elseif v[4] == 5 then
			PNum_5 = PNum_5 +1
			PType_5[PNum_5] = {v[1],v[2],v[3]}
		elseif v[4] == 6 then
			PNum_6 = PNum_6 +1
			PType_6[PNum_6] = {v[1],v[2],v[3]}
		elseif v[4] == 7 then
			PNum_7 = PNum_7 +1
			PType_7[PNum_7] = {v[1],v[2],v[3]}
		end
    end
	
	--???¡ã????
	local P_inf = {{PType_1,PNum_1},{PType_2,PNum_2},{PType_3,PNum_3},{PType_4,PNum_4},{PType_5,PNum_5},{PType_6,PNum_6},{PType_7,PNum_7},[0]={0,0}}
	local PType_name = {"???????¨¾","????¡ã???","????¡ã??¨¢","????????","?????¨®?¡§","???????¨§","????????"}

	--??????????????
	local cursor_x = 1-- bx*212
	local cursor_y = 1-- by*33.5
	local current = 1

	--¡¦?????
    local returnValue =-1;
  
    local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)

    while true do
		if JY.Restart == 1 then
			break
		end
        lib.LoadSur(surid, 0, 0)
		--DrawString(x1+10,y1-CC.RowPixel*4-7,"X:"..cursor_x.."??Y:"..cursor_y.."??Current:"..current,LimeGreen,size);	--????????????
		for i = 1, 7 do
			--?¨®??????
		--	DrawString(x1+(i-1)*(size*maxlength/2+CC.RowPixel*4+5)+CC.MenuBorderPixel,y1-CC.RowPixel*6+1,PType_name[i],LimeGreen,size);
			for j = 1, 16 do
				if j > P_inf[i][2] then
					break;
				end
				--?¡¦?¡§???¡ã????????
				local id = 0
				for jj = 1, i do
					id = id + P_inf[jj-1][2]
				end
				id = id + j
				--??¡¦¡§?????????¡ã??????????
				local drawColor = color; 
				if P_inf[i][1][j][2] == 1 then
					drawColor = M_DimGray
				end
				local xx = x1+(i-1)*(size*maxlength/2+CC.RowPixel*4+5) + CC.MenuBorderPixel+ bx*212
				local yy = y1+(j-1)*(size+CC.RowPixel*2-1)+ by*33.5
				--???????¡ã??????????????
				if id == current then
					drawColor = selectColor;
					lib.Background(xx-5, yy-5, xx + size*maxlength/2+5, yy + size + 5, 128, color)
				end
				--???????¡ã????
				DrawString(xx,yy,P_inf[i][1][j][1],drawColor,size*0.9);
			end
		end
  
        ShowScreen();
        local keyPress, ktype, mx, my = WaitKey(1)
		
		lib.Delay(CC.Frame);
				
		--ktype  1???¨¹????2???¨®????????3:?¨®??¡Á¨®?¨¹??4???¨®?????¨¹??5???¨®?????¨¹??6??????????7????????
        if keyPress==VK_ESCAPE or ktype == 4 then
            break;
        elseif keyPress==VK_DOWN then
			cursor_y = cursor_y + 1
			if cursor_y > P_inf[cursor_x][2] then
				cursor_y = 1
			end
		elseif keyPress==VK_UP then
			cursor_y = cursor_y - 1
			if cursor_y < 1 then
				cursor_y = P_inf[cursor_x][2]
			end
		elseif keyPress==VK_RIGHT then
			cursor_x = cursor_x + 1
			if cursor_x > 7 then
				cursor_x = 1
			end
			if cursor_y > P_inf[cursor_x][2] then
				cursor_y = 1
			end
		elseif keyPress==VK_LEFT then
			cursor_x = cursor_x - 1
			if cursor_x < 1 then
				cursor_x = 7
			end
			if cursor_y > P_inf[cursor_x][2] then
				cursor_y = 1
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then
				if mx >= x1  and mx <= x1 + w +bx*212 and my >= y1 and my <= y1 + h then
					cursor_x = math.modf((mx -bx*212- x1 - CC.MenuBorderPixel)/(size*maxlength/2+CC.RowPixel*4+5)) + 1
					cursor_y = math.modf((my-by*33 - y1 - CC.MenuBorderPixel) / (size+CC.RowPixel*2-1)) + 1 
					mk = true;
				end
				if cursor_y > P_inf[cursor_x][2] then
					cursor_y = P_inf[cursor_x][2]+1
					mk = false;
				end
			end				
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or (ktype == 3 and mk) then
				if P_inf[cursor_x][1][cursor_y][2] == 0 then
					returnValue=P_inf[cursor_x][1][cursor_y][3];
					break;
				end
			end
		end
		current = 0
		for i = 1, cursor_x do 
			current = current + P_inf[i-1][2]
		end
		current = current + cursor_y
    end
    lib.FreeSur(surid)
    --¡¦?????
	return returnValue
end

--?????????????????¨¦????????????????
function More_than_2_vacant_slot()
	if JY.Base["???¨¦14"] == -1 and JY.Base["???¨¦15"] == -1 then
		return true
	end
	return false
end

--??????????????????
function SetJX(id, value)
	--local xwperson;	--???¡§??????????
	if id == 0 then
		if JY.Base['????'] > 0 then
			JY.Person[0]["????????"] = JY.Person[0]["????????"] + value
		end	
		if JY.Base['??¡Á?'] > 0 then
			JY.Person[0]["????????"] = JY.Person[0]["????????"] + value
		end
		--[[if (JY.Person[0]["????????"] >= 2 or JY.Person[0]["????????"] >= 2) and JY.Person[id]['????????1'] < 1 then
			JY.Person[id]['????????1'] = 1
		end--]]
	else	
		JY.Person[id]["????????"] = JY.Person[id]["????????"] + value	
		if match_ID(0,id) then
			JY.Person[0]["????????"] = JY.Person[0]["????????"] + value
		end
		if inteam(id) and JY.Person[id]['????????1'] < 1 then
			JY.Person[id]['????????1'] = 1
		end
	end	
end	

--??????????????????
function kungfu_knowledge(id, value)
	local xwperson;	--???¡§??????????????
	if id == JY.Base["????"] then
		xwperson = 0
	else
		xwperson = id
	end
	JY.Person[xwperson]["???¡ì????"] = JY.Person[xwperson]["???¡ì????"] + value
end

--???????¡§???¡§??????¡Á???
function set_potential(id, value)
	local xwperson;	--???¡§?????¡§¡Á???????
	if id == JY.Base["????"] or (JY.Base["???¡§"]==2 and instruct_16(id)) then
		xwperson = 0		
	else
		xwperson = id
	end
	JY.Person[xwperson]["¡Á???"] = value
end

--?????????????¡§??????????????
function secondary_wugong(wugongid)
	--?¨¢??
	if JY.Wugong[wugongid]["????????"] == 7 then
		return true
	--?¨¹?????????????????????¡Â ??¡¦??? ????????
	elseif wugongid == 85 or wugongid == 87 or wugongid == 88 or wugongid == 144 or wugongid == 175  or wugongid == 182 or wugongid == 43 or wugongid == 77 then
		return true
	end
	return false
end

function WGZHAOSHI(wugongid)
	if wugongid == 26 or wugongid == 25  or wugongid == 21 
		or wugongid == 45 or wugongid == 46  or wugongid == 48 
		or wugongid == 67 or wugongid == 66  or wugongid == 153 
		or wugongid == 80 or wugongid == 82  or wugongid == 81
		or wugongid == 49 or wugongid == 138 or wugongid == 11 then
		return true
	end
	return false
end

--?????????????¡§?¡Â????????????
function Curr_NG(personid, NGid)
	if JY.Status == GAME_WMAP and WAR.PJTX1 ~= 0 and (not match_ID(personid,592)) then
		return false
	elseif JY.Status == GAME_WMAP and WAR.PD['????????'][personid] ~= nil and math.random(10) > 7 then
		return false
	elseif JY.Status == GAME_WMAP and WAR.PD['¡Á??????¡ì'][personid] ~= nil and math.random(100) > 85 and ((not match_ID(personid,60)) or (not PersonKF(personid,104))) then
		return false
	elseif JY.Status == GAME_WMAP and WAR.PD['???¨¹'][personid] ~= nil then
	    return false
	elseif JY.Status == GAME_WMAP and WAR.PD['???¨¢????'][personid] ~= nil then
	    return false
	elseif JY.Status == GAME_WMAP and WAR.PD['?¨¦?¡ã????'][personid] == 3  then
	    return false    
	else	
		if JY.Person[personid]["?¡Â??????"] == NGid then	--????????
			if not inteam(personid) then
				return true 
			elseif PersonKF(personid,NGid) then
				return true
			end
		end	
		if JY.Person[personid]['?¡Â??????'] == 354 then
			if NGid == JY.Wugong[354]['¡Á???????'] or NGid == JY.Wugong[354]['??¡¦?????'] then
				return true
			end
		end		
		--?¨§???????¡§
		if personid == 0 and JY.Base["??¡Á?"] == 6 then
			--???????¨§?????????????¡ì?¨¢???¨¾¡Á????¡Â??
			if JY.Person[personid]["?¨§??????"] == NGid and PersonKF(personid, NGid) then
				--Hp_Max(personid)
				return true
			end
		end	
		--????
		if match_ID(personid,637)  then
			if NGid == 107 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		--?¡§??
		if match_ID(personid,114) then
			if NGid == 108 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		
		--????????
		if match_ID(personid,638) or JXPD(personid,9,1) then
			if NGid == 106 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		--????
		if JXPD(personid,38, 1) or match_ID(personid,673) or match_ID(personid,636) then
			if NGid == 102 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end
		--??????
		if match_ID(personid,514) or match_ID(personid,9740) then
			if NGid == 43 and PersonKF(personid, NGid) then
				return true
			end
		end
		--¡Á??¡ÂNPC
		if match_ID(personid,514) then
			if NGid == 95 and inteam(personid) == false then 
				return true
			end
		end	
		--?¨§??????
		if match_ID(personid,9938) and personid == 0 then
			if NGid > 0 and PersonKF(personid, NGid) then
				return true
			end
	    end
		--??¡¦?????????
		if match_ID(personid,457) then
			if NGid == 105 and (inteam(personid) == false or JY.Person[457]['????????'] == 100) then 
			    return true
			end
		end
		--¡¦??¡è
		if JXPD(personid,149,1) and match_ID(personid,149) then
			if NGid == 108 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		--??¡ã???
		if match_ID(personid,189) or match_ID(personid,9849) then
			if NGid == 90 and (PersonKF(personid, NGid) or inteam(personid) == false) then
			    return true
			end
		end	
		--???¨½
		if match_ID(personid,524) or match_ID(personid,586) or match_ID(personid,9849) then
			if NGid == 375 and (PersonKF(personid, NGid) or inteam(personid) == false) then
				return true
			end
		end	
		--????
		if match_ID(personid,511) then
			if NGid == 227 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		
		--??????
		if match_ID(personid,9) then
			if NGid == 97 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end
				

		--????
		if match_ID(personid,635) then
			if NGid == 180 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
				return true
			end
		end
		
		--????
		if match_ID(personid,58) then
			if NGid == 252 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end
		--??????¡Á?
		if match_ID(personid,9848) then
			if NGid == 317 and PersonKF(personid, NGid) then
				return true
			end			
		end
		--???¨²???¨®
		if match_ID(personid,9931) then
			if NGid == 103 and PersonKF(personid,NGid) then
				return true
			end
		end		
		--???¡Â?????? ????
		if match_ID(personid,9854) then
			if NGid == 249 and PersonKF(personid, NGid) then
				return true
			end			
		end
		--????????
		if MPPD(personid) == 14 and MPDJ(personid) == 6 and PersonKF(personid,175) then
			if NGid == 89 or NGid == 259 or NGid == 264 or NGid == 263 or NGid == 216 then
				return true
			end			
		end
		--????
	    if match_ID(personid,9893) then
			if NGid == 314 and (PersonKF(personid, NGid) or inteam(personid) == false) then
				return true
			end			
		end
		--?????¨²?¨®¡ã?????
		if match_ID(personid,84) and JXPD(personid,84,1) then
			if NGid == 103 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
				return true
			end
		end
		--?????¨®¡ã???¡ã???
		if match_ID(personid,592) or match_ID(personid,604) or match_ID(personid,636) then
			if NGid == 184 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
				return true
			end
		end
		--????¡Á?
		--if match_ID(personid,634) and JXPD(personid,634,1) then
			--if NGid > 0 and (NGid ~= 315 or NGid ~= 354 or NGid ~= 359 or NGid ~= 367) then
				--return true
			--end
		--end
		--???¡¦???????¡Â??
		if JY.Status == GAME_WMAP then
			--¡ã¡Á??????
			if personid == 0 and MPTX(personid,8,3) and JY.Person[60]['????????'] == 1 and WAR.PD['¡ã¡Á?????????¡§'][0] == 1 then
				if NGid == 107 and PersonKF(personid, NGid) then
					return true
				end
			end
			--????????
			if MPPD(personid) == 4 and MPDJ(personid) == 4 and PersonKF(personid,171) and JY.Base["?¨§?¨¦????"] > 7 then
				if NGid == 99 and PersonKF(personid, NGid) and Curr_NG(personid,171) and (JY.Person[personid]["????????"] ~= 0 ) then
					return true
				end
			end
		end	
		--????????
		if JY.Person[personid]["????????1"] > 1 then
			if JY.Person[personid]["????????1"] == NGid and PersonKF(personid,NGid) then
				return true
			else
				return false
			end
		end	
		--------------?????¨®??¡Á??¡Â????-----------------------
		if inteam(personid) == false or JXPD(personid,personid,1) or (personid == 0 and JXPD(personid,JY.Base['????'],1)) then
			local id = personid
			local ng = NGid
			if match_ID(id,46) and ng == 87 then
				return true
			end
			if (match_ID(id,50) or match_ID(id,69)) and (ng == 204 or ng == 215) then
				return true
			end
			if match_ID(id,605) and (ng == 211 or ng == 154) then
				return true
			end
			if match_ID(id,5) and (ng == 99 or ng == 227 or ng == 171 or ng == 241) then
				return true
			end	
			if match_ID(id,577) and (ng == 108 or ng == 92 or ng ==91 or ng == 106 or ng == 144 or ng ==243 or ng == 208) then
				return true
			end	
			if match_ID(id,62) and ng == 103 then
				return true
			end
			if match_ID(id,97) and (ng == 163 or ng == 214) then
				return true
			end	
			if match_ID(id,116) and ng == 85 then
 				return true
 			end
 			if match_ID(id,117) and ng == 101 then
 				return true
 			end
 			if match_ID(id,118) and ng == 98 then
 				return true
 			end
 			if match_ID(id,60) and ng == 95 then
 				return true
 			end
 			if match_ID(id,57) and (ng == 317 or ng == 248 or ng == 251) then
	 			return true
	 		end	
	 		if (match_ID(id,501) or match_ID(id,596)) and ng == 152 then
	 			return true
	 		end
	 		if match_ID(id,26) and (ng == 88 or ng == 219) then
	 			return true
	 		end
	 		if match_ID(id,27) and ng == 105 then
	 			return true
	 		end	
	 		if match_ID(id,641) and ng == 93 then
	 			return true
	 		end
			if match_ID(id,456) and (ng == 88 or ng == 93 or ng == 94 or ng == 97 or ng == 203) then
	 			return true
	 		end
			if match_ID(id,748) and (ng == 365 or ng == 366) then
	 			return true
	 		end
	 		if match_ID(id,499) and (ng == 314 or ng == 207 or ng == 250) then
	 			return true
	 		end
	 		if match_ID(id,65) and (ng == 314) then
	 			return true
	 		end
	 		if match_ID(id,129) and (ng == 100 or ng == 249 or ng == 210) then
	 			return true
	 		end
	 		if match_ID(id,64) and (ng == 249 or ng == 210) then
	 			return true
	 		end
	 		if match_ID(id,626) and (ng == 242 or ng == 247 ) then
	 			return true
	 		end
			 if match_ID(id,634) then
				if ng == 85 or ng == 98 or ng == 101 or ng == 183 or ng == 227 then
					return true
				end
			end
	 		if ng == 375 and (match_ID(id,586) or match_ID(id,604)) then
	 			return true
	 		end
	 		if match_ID(id,568) and ng == 199 then
	 			return true
	 		end	
			if match_ID(id,517) and ng == 367 then
	 			return true
	 		end					
		end	
		-------------???????¡Á¡Á????¡Â??-----------------------	
		if personid == 0 and MPTX(personid,5,4) and CC.TX['???????????¨½'] > 0 then
			local ng = {144,96,108}
			if NGid == ng[CC.TX['???????????¨½']] then
				return true
			else
				return false	
			end	
		end	
		-------------????¡Á????¡Â??----------------------------
		if personid == 638 and CC.TX['???????????¨½'] == 5 then
			if NGid == 108 then
				return true
			end
		end		
	end	
	return false
end

--?????????????¡§?¡Â???¨¢????????
function Curr_QG(personid, QGid)
	if JY.Status == GAME_WMAP and WAR.PD['???¨¢????'][personid] ~= nil then
	    return false
	end
	if JY.Person[personid]["?¡Â???¨¢??"] == QGid then	--????????
		if not inteam(personid) then
			return true 
		elseif PersonKF(personid,QGid) then
			return true
		end
	end
	if JY.Person[personid]["?¡Â???¨¢??"] == 380 then
		if JY.Wugong[380]['¡Á???????'] == QGid or JY.Wugong[380]['??¡¦?????'] == QGid then
			return true
		end	
	end
	--??????
	if match_ID(personid,517) and QGid > 0 and yongqin(QGid) then
		return true
	end
	--????
	if match_ID(personid,577) and QGid == 186 then
		return true
	end
	--???¨¾?¨½
	if match_ID(personid,130) and QGid == 145 then
		return true
	end
	--?¡è????
	if match_ID(personid,14) and QGid == 145 then
		return true
	end
	--?¡Â????
	if match_ID(personid,92) and QGid == 149 then
		return true
	end
	--????
	if match_ID(personid,456) and QGid == 195 then
		return true
	end
	--??????
	if match_ID(personid,57) and QGid == 237 then
		return true
	end
	--?¨²????
	if match_ID(personid,633) and QGid == JY.Person[personid]["?¨§???¨¢??"] then
		return true
	end
	if MPPD(personid) == 24 and MPDJ(personid) > 2 and QGid == JY.Person[personid]["?¨§???¨¢??"] then
		return true
	end
	if MPPD(personid) == 24 and MPDJ(personid) > 4 and QGid > 0 and PersonKF(personid,QGid) then
		return true
	end	
	if match_ID(personid,9938) and personid == 0 and QGid > 0 and PersonKF(personid,QGid) then
		return true
	end
	return false
end

--tony ?¨¢??????
function QGQH(id,QGid,level)
	if match_ID(id,517) then
		return true
	end	
	if match_ID(id,526) and QGid == 304 then
		return true
	end
	if Curr_QG(id,QGid) == true then
		if level == 1 then --???¡Á?¡ì??????
			if MPTX(id,24) and JY.Person[id]["?¨¢??"] > 300 then
				return true
			elseif JY.Person[id]["?¨¢??"] > 300 and JY.Person[id]["????¡¦??¡Á"] < 4 then --
				return true
			elseif match_ID(id,517) then
				return true
			elseif (WAR.ZDDH == 289 or WAR.ZDDH == 290 or WAR.ZDDH == 337) and inteam(id) == false then
			    return true
			else
				return false
			end
		end
		if level == 2 then --???¡Á?¡ì??
			if MPTX(id,24) and JY.Person[id]["?¨¢??"] > 500 and (inteam(id) or match_ID(id,525)) then
				return true
			elseif inteam(id) and JY.Person[id]["?¨¢??"] > 500 and JY.Person[id]["????¡¦??¡Á"] < 2 then -- 
				return true
			elseif match_ID(id,517) then
				return true
			elseif (WAR.ZDDH == 289 or WAR.ZDDH == 290 or WAR.ZDDH == 337) and inteam(id) == false then
			    return true
			else
				return false
			end
		end	
	else
		return false
	end	
	
	return false
end

--?????????????¡§?¨§????????????
function Given_WG(id, WGid)
	local tw = false;
	for i = 1, 2 do
		if JY.Person[id]["?¨§??????"..i] == WGid then
			tw = true;
			break;
		end
	end
	return tw;
end

--?????????????¡§?¨§????????????
function Given_NG(id, NGid)
	local tw = false;
	if JY.Person[id]["?¨§??????"] == NGid then
		tw = true;
	elseif actor(id,6) and JXPD(id,0,2) then --?¨§??
		return true
	end
	return tw;
end

function TFQG(id,QGid)
	if JY.Person[id]["?¨§???¨¢??"] == QGid then
		return true
	elseif match_ID(id,517) then
		return true
	elseif (WAR.ZDDH == 289 or WAR.ZDDH == 290 or WAR.ZDDH == 337) and JY.Person[id]["?¡Â???¨¢??"] == QGid and inteam(id) == false then
		return true
	else
		return false
	end	
end
--????????+????¡Á¨¦?? ????¡Á¨¦??
function TSZH(id,WGid,NGid)
	if match_ID(id,577) and WGid > 0 and WGid ~= 47 then  --?¨§????????????
		return true
	end
	-----------------------------????¡Á¨¦??-------------------------------------------------
	--?¨§??????
	if WGid == 78 and NGid == 315 then
		if PersonKF(id,78) and PersonKF(id,315) and PersonKF(id,148) then 
            return true
		elseif match_ID(id,456) then
			return true
		end
	end
	return false
end
--??¡¦¡§????+????¡Á¨¦??
function DFZH(id,WGid,NGid)
	if match_ID(id,577) and WGid > 0 and WGid ~= 47 then  --?¨§????????????
		return true
	end
		-----------------------------??¡¦¡§¡Á¨¦??-------------------------------------------------
	--?¨½¡¦??¨§??
	    if WGid == 55 and NGid == 90 then
			if PersonKF(id,55) and PersonKF(id,90) then 
                return true
			elseif PersonKF(id,55) and match_ID(id,29) then
			    return true
			end
		end
		--????¡Á???
	    if WGid == 58 and NGid == 89 then
			if PersonKF(id,58) and PersonKF(id,89) then 
                return true
			end
		end
		--?????¨§?¡ì
	    if WGid == 58 and NGid == 160 then
			if PersonKF(id,58) and PersonKF(id,160) then 
                return true
			end
		end
		--????????
	    if WGid == 61 and NGid == 102 then
			if PersonKF(id,61) and PersonKF(id,102) then 
                return true
			elseif PersonKF(id,61) and Curr_NG(id,96) then 
			    return true
			end
		end
		--¡¦¨¾??????
	    if WGid == 62 and NGid == 250 then
			if PersonKF(id,62) and PersonKF(id,250) then 
                return true
			end
		end
		--????????
	    if WGid == 63 and NGid == 163 then
			if PersonKF(id,63) and PersonKF(id,163) then 
                return true
			elseif match_ID(id,97) then
			    return true
			end
		end
		--???¨¦????
	    if WGid == 64 and NGid == 99 then
			if PersonKF(id,64) and PersonKF(id,99) then 
                return true
			end
		end
		--?¨²??¡¦??¨§
	    if WGid == 65 and NGid == 145 then
			if PersonKF(id,65) and PersonKF(id,145) and TrueSD(id) >= 350 then 
                return true
			elseif PersonKF(id,65) and Curr_QG(pid,145) then
			    return true
			elseif match_ID(id,633) then
			    return true
			elseif JXPD(id,1,1) then
			    return true
			end
		end
		--????????
	    if WGid == 66 and NGid == 98 then
			if PersonKF(id,66) and PersonKF(id,98) then 
                return true
			elseif match_ID(id,103) then
			    return true
			end
		end
		--?????¨²?¨®
	    if WGid == 66 and NGid == 103 then
			if PersonKF(id,66) and PersonKF(id,103) then 
                return true
			elseif match_ID(id,103) then
			    return true
			end
		end
		--¡ã??¡è?¨½??
	    if WGid == 141 and NGid == 146 then
			if PersonKF(id,141) and PersonKF(id,146) then 
                return true
			end
		end
		--?¡Á?¨¦????or?¡Á????
	    if WGid == 153 and NGid == 216 then
			if PersonKF(id,153) and PersonKF(id,216) then 
                return true
			elseif PersonKF(id,153) and PersonKF(id,43) then
			    return true
			end
		end
		--??¡¦?????
	    if WGid == 174 and NGid == 93 then
			if PersonKF(id,174) and PersonKF(id,93) then 
                return true
			end
		end
		--?????¡è?¨²
	    if WGid == 181 and NGid == 203 then
			if PersonKF(id,181) and PersonKF(id,203) then 
                return true
			elseif match_ID(id,578) then
			    return true
			end
		end
		--???????¨§
	    if WGid == 193 and NGid == 190 then
			if PersonKF(id,190) and PersonKF(id,193) then 
                return true
			end
		end
		--??¡ã???
	    if WGid == 231 and NGid == 235 then
			if PersonKF(id,231) and PersonKF(id,235) then 
                return true
			end
		end
		--?¨§??????
	    if WGid == 335 and NGid == 203 then
			if PersonKF(id,181) and PersonKF(id,203) and PersonKF(id,335) then 
                return true
			end
		end
		--???¡§??¡¦¡§
	    if WGid == 371 and NGid == 372 then
			if PersonKF(id,371) and Curr_NG(id,372) then 
                return true
			end
		end
	return false
end
--??¡¦¡§????+????¡Á¨¦??
function JFZH(id,WGid,NGid)
	if match_ID(id,577) and WGid > 0 and WGid ~= 47 then  --?¨§????????????
		return true
	end
	-----------------------------??¡¦¡§¡Á¨¦??-------------------------------------------------
		--?¨½¨®?????
		if WGid == 38 and NGid == 248 then
            if PersonKF(id,38) and PersonKF(id,248) then 
                return true
	        elseif match_ID(id,57) then 
                return true
			end
	    end
		--??????
	    if WGid == 39 and NGid == 210 then
			if PersonKF(id,39) and PersonKF(id,210) then 
                return true
			elseif match_ID(id,129) or match_ID(id,605) or JXPD(id,68,1) then
	            return true
			elseif match_ID(id,526) or MPTX(id,16) then
	            return true
			elseif PersonKF(id,39) and PersonKF(id,100) then 
                return true
			elseif PersonKF(id,139) and PersonKF(id,100) and PersonKF(id,154) then 
                return true
			end
		end	
		--???????¨§
	    if WGid == 39 and NGid == 100 then
			if PersonKF(id,39) and PersonKF(id,200) then 
                return true
			elseif match_ID(id,526) or match_ID(id,129) or JXPD(id,68,1) then
	            return true
			end
		end	
		--???¨½??
	    if WGid == 42 and NGid == 154 then
			if PersonKF(id,42) and PersonKF(id,154) then 
                return true
			elseif PersonKF(id,139) and PersonKF(id,154) then 
                return true
			elseif match_ID(id,139) and match_ID(id,59) then
	            return true
			elseif match_ID(id,526) or match_ID(id,605) then
	            return true
			end
		end
		--???¨²????
	    if WGid == 45 and NGid == 252 then
			if PersonKF(id,45) and Curr_NG(id,252) then 
                return true
			elseif match_ID(id,58) and PersonKF(id,252) then
	            return true
			elseif match_ID(id,530) and PersonKF(id,252) then
	            return true
			elseif match_ID(id,592) then
	            return true
			end
		end
		--???????¨²????
	    if WGid == 47 and NGid == 252 then
			if PersonKF(id,47) and PersonKF(id,45) and PersonKF(id,252) then 
                return true
			elseif match_ID(id,592) then
	            return true
			end
		end
		--???¡ã???¡§
	    if WGid == 48 and NGid == 105 then
			if PersonKF(id,48) and Curr_NG(id,105) then 
                return true
			elseif (match_ID(id,36) or match_ID(id,9888)) and PersonKF(id,48) then
	            return true
			end
		end	
		--?¨½?????????¨§
	    if WGid == 139 and NGid == 100 then
			if PersonKF(id,139) and PersonKF(id,154) and PersonKF(id,100) then 
                return true
			elseif match_ID(id,526) or match_ID(id,605) then
	            return true
			elseif match_ID(id,139) and match_ID(id,59) then
	            return true
			end
		end
		--????????
	    if WGid == 140 and NGid == 243 then
			if PersonKF(id,140) and PersonKF(id,243) then 
                return true
			elseif match_ID(id,577) then
	            return true
			end
		end
		--?¨½??????
	    if WGid == 236 and NGid == 99 then
			if PersonKF(id,236) and PersonKF(id,99) then 
                return true
			elseif match_ID(id,5) then
	            return true
			elseif MPTX(id,4,3) then
	            return true
			end
		end
		--?¨¾??????
	    if WGid == 374 and NGid == 107 then
			if PersonKF(id,374) and PersonKF(id,107) and PersonKF(id,106) then 
                return true
			elseif match_ID(id,520) then
	            return true
			end
		end
	return false
end
--??¡¦¡§????+????¡Á¨¦??
function ZFZH(id,WGid,NGid)
	if match_ID(id,577) and WGid > 0 and WGid ~= 47 then  --?¨§????????????
		return true
	end
	-----------------------------??¡¦¡§¡Á¨¦??-------------------------------------------------
		--??¡Á????¡è
	    if WGid == 4 and NGid == 97 then
			if PersonKF(id,3) and PersonKF(id,97) then 
                return true
			elseif match_ID(id,12) then
	            return true
			end
		end
		--??????
	    if WGid == 11 and NGid == 107 then
			if PersonKF(id,11) and PersonKF(id,107) and Curr_NG(id,107) then 
                return true
			elseif match_ID(id,637) then
	            return true
			end
		end	
		--????????
	    if WGid == 17 and NGid == 207 then
			if PersonKF(id,17) and PersonKF(id,207) then 
                return true
			elseif match_ID(id,65) or match_ID(id,499) or match_ID(id,102) then
	            return true
			end
		end	
		--????????
	    if WGid == 18 and NGid == 251 then
			if PersonKF(id,18) and PersonKF(id,251) then 
                return true
			elseif match_ID(id,57) then
	            return true
			end
		end	
		--?????¨§??
	    if WGid == 19 and NGid == 90 then
			if PersonKF(id,19) and PersonKF(id,90) then 
                return true
			elseif match_ID(id,18) or match_ID(id,9744) then
	            return true
			end
		end
		--?????????¨§??
	    if WGid == 49 and NGid == 314 then
			if PersonKF(id,17) and PersonKF(id,49) and PersonKF(id,314) then 
                return true
			elseif match_ID(id,499) or JXPD(id,53,1) then
	            return true
			end
		end	
		--?????¨¾¨®?
	    if WGid == 127 and NGid == 95 then
			if PersonKF(id,127) and PersonKF(id,95) then 
                return true
			elseif PersonKF(id,127) and match_ID(id,61) then
	            return true
			elseif match_ID(id,60) then
	            return true
			end
		end
		--??????????
	    if WGid == 132 and NGid == 96 then
			if PersonKF(id,132) and PersonKF(id,96) then 
                return true
			elseif match_ID(id,103) then
	            return true
			end
		end	
		--?????¡¦¡Á?
	    if WGid == 138 and NGid == 43 then
			if PersonKF(id,138) and MuRongDZ(id) then 
                return true
			elseif match_ID(id,113) then
	            return true
			end
		end	
		--????????
	    if WGid == 198 and NGid == 199 then
			if PersonKF(id,198) and PersonKF(id,199) then 
                return true
			elseif match_ID(id,568) then
	            return true
			end
		end	
		--????????
	    if WGid == 201 and NGid == 98 then
			if PersonKF(id,201) and PersonKF(id,98) then 
                return true
			elseif match_ID(id,634) or match_ID(id,118) then
	            return true
			end
		end
		--???¡§???????¡§
	    if WGid == 226 and NGid == 105 then
			if PersonKF(id,226) and (PersonKF(id,126) or PersonKF(id,127)) and PersonKF(id,201) and Curr_NG(id,105) then 
                return true
			elseif JXPD(id,27,2) then
	            return true
			end
		end
		--???¡¦?????????¡ì???¨¾???????????¨½??
	    if WGid == 295 and NGid == 220 then
			if PersonKF(id,3) and PersonKF(id,120) and PersonKF(id,220) then 
                return true
			elseif PersonKF(id,295) and PersonKF(id,334) and PersonKF(id,220) then 
                return true
			elseif match_ID(id,83) or match_ID(id,46) then
	            return true
			end
		end
	return false
end
--??¡¦¡§????+????¡Á¨¦??
function QFZH(id,WGid,NGid)
	    if match_ID(id,577) and WGid > 0 and WGid ~= 47 then  --?¨§????????????
			return true
		end
		-----------------------------??¡¦¡§¡Á¨¦??-------------------------------------------------
		--??????
	    if WGid == 3 and NGid == 220 then
			if PersonKF(id,3) and PersonKF(id,220) then 
                return true
			elseif match_ID(id,161) or match_ID(id,83) or match_ID(id,746) then
	            return true
			end
		end
		--??????
	    if WGid == 5 and NGid == 216 then
			if PersonKF(id,5) and PersonKF(id,216) then 
                return true
			elseif PersonKF(id,5) and PersonKF(id,43) then
	            return true
			elseif match_ID(id,14) or match_ID(id,429) then
	            return true
			end
		end	
		--????????
	    if WGid == 7 and NGid == 99 then
			if PersonKF(id,7) and PersonKF(id,99) then 
                return true
			elseif match_ID(id,5) or match_ID(id,658) then
	            return true
			end
		end
		--?¨§?????¡è
	    if WGid == 8 and NGid == 85 then
			if PersonKF(id,8) and Curr_NG(id,85) then 
                return true
			elseif match_ID(id,116) or match_ID(id,117) or match_ID(id,634) then
	            return true
			end
		end	
		--?¨§??¡ã???1
	    if WGid == 8 and NGid == 101 then
			if PersonKF(id,8) and PersonKF(id,101) then 
                return true
			elseif match_ID(id,117) or match_ID(id,634) then
	            return true
			end
		end	
		--?¨§??¡ã???2
	    if WGid == 8 and NGid == 102 then
			if PersonKF(id,8) and Curr_NG(id,101) then 
                return true
			elseif match_ID(id,117) or match_ID(id,634) then
	            return true
			end
		end	
		--?¨²???¨²????
	    if WGid == 13 and NGid == 196 then
			if PersonKF(id,13) and PersonKF(id,196) then 
                return true
			elseif match_ID(id,67) or match_ID(id,567) then
	            return true
			end
		end
		--????????
	    if WGid == 12 and NGid == 248 then
			if PersonKF(id,12) and PersonKF(id,248) then 
                return true
			elseif match_ID(id,56) or match_ID(id,57) then
	            return true
			end
		end	
		--???¡Â????
	    if WGid == 15 and NGid == 249 then
			if PersonKF(id,15) and PersonKF(id,249) then 
                return true
			elseif match_ID(id,64) then
	            return true
			end
		end	
		--????????
	    if WGid == 16 and NGid == 99 then
			if PersonKF(id,16) and PersonKF(id,99) then 
                return true
			elseif match_ID(id,5) then
	            return true
			end
		end	
		--???¡è????
	    if WGid == 21 and NGid == 216 then
			if PersonKF(id,21) and PersonKF(id,216) then 
                return true
			elseif PersonKF(id,21) and PersonKF(id,43) then
	            return true
			elseif match_ID(id,648) or match_ID(id,523) then
	            return true
			end
		end	
		--???¡è????
	    if WGid == 21 and NGid == 220 then
			if PersonKF(id,21) and PersonKF(id,220) then 
                return true
			elseif match_ID(id,647) or match_ID(id,523) then
	            return true
			end
		end
		--¡ã????????¡§¡Á???
	    if NGid == 91 then
			if WGid == 189 then
				if PersonKF(id,189) and PersonKF(id,91) then 
					return true
				elseif match_ID(id,149) or match_ID(id,114) then
				    return true
				end
			end
		end
		--??????¡Á¨¦??
		if NGid == 144 then
			if WGid == 22 or WGid == 135 then
				if (PersonKF(id,22) or PersonKF(id,135)) and PersonKF(id,144) then
					return true
				end
			end		 	
		end
			
		--????????
	    if WGid == 23 and NGid == 221 then
			if PersonKF(id,23) and PersonKF(id,221) then 
                return true
			elseif match_ID(id,357) or match_ID(id,8) or match_ID(id,13) or match_ID(id,167) or match_ID(id,168) then
	            return true
			end
		end	
		--???????¡Á??
	    if WGid == 24 and NGid == 108 then
			if PersonKF(id,24) and PersonKF(id,108) then 
                return true
			elseif match_ID(id,114) then
	            return true
			end
		end	
		--¡Â???????????
	    if WGid == 25 and NGid == 104 then
			if PersonKF(id,25) and Curr_NG(id,252) and PersonKF(id,104) then 
                return true
			elseif JXPD(id,58,1) and PersonKF(id,25) then
	            return true
			end
		end	
		--¡Â???????1
	    if WGid == 25 and NGid == 252 then
			if PersonKF(id,25) and PersonKF(id,252) then 
                return true
			elseif JXPD(id,58,1) and PersonKF(id,25) then
	            return true
			end
		end	
		--¡Â???????2
	    if WGid == 25 and NGid == 252 then
			if PersonKF(id,25) and Curr_NG(id,252) and PersonKF(id,252) then 
                return true
			elseif JXPD(id,58,1) and PersonKF(id,25) then
	            return true
			end
		end		
		--???¨²???¨²
	    if WGid == 26 and NGid == 204 then
			if PersonKF(id,26) and Curr_NG(id,204) then 
                return true
			elseif match_ID(id,69) and PersonKF(id,204) then
	            return true
			elseif match_ID(id,50) then
	            return true
			end
		end
		--???¨²????
		if WGid == 26 and NGid == 107 then
			if match_ID(id,527) and MPTX(id,24) and Curr_NG(id,367) then
				return true
			elseif match_ID(id,69) then
				return true
			elseif JXPD(id,55,1) then
				return true
			elseif PersonKF(id,107) and PersonKF(id,26) then
				return true
			end
		end					
		--???¡§????
	    if WGid == 115 and NGid == 249 then
			if PersonKF(id,115) and PersonKF(id,249) then 
                return true
			elseif match_ID(id,64) or match_ID(id,129) then
	            return true
			end
		end	
		--????????
	    if WGid == 179 and NGid == 180 then
			if PersonKF(id,179) and PersonKF(id,180) then 
                return true
			elseif match_ID(id,635) then
	            return true
			end
		end
	return false
end

--??????????????+????¡Á¨¦??
function WGZH(id,WGid1,WGid2)
	if WAR.PJTX1 ~= 0 and (not match_ID(id,592)) then
		return false
	else
	    if match_ID(id,577) and WGid1 > 0 and WGid2 > 0 and (WGid1 ~= 47 or WGid2 ~= 47) then  --?¨§????????????
			return true
		end
		--????????
        if WGid1 == 5 and WGid2 == 118 then
			if PersonKF(id,5) and PersonKF(id,118) then 
                return true
	        elseif match_ID(id,602) or match_ID(id,14) or match_ID(id,514) then
	            return true
			end
	    end
		--????¡Á???????
        if WGid1 == 11 and WGid2 == 66 then
			if PersonKF(id,11) and PersonKF(id,66) then 
                return true
	        elseif match_ID(id, 637) or match_ID(id, 103) then 
                return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á????¡§??????????
        if WGid1 == 12 and WGid2 == 18 then
			if PersonKF(id,12) and PersonKF(id,18) and PersonKF(id,38) then 
                return true
	        elseif match_ID(id, 626) or match_ID(id, 57) or match_ID(id, 9746) then 
                return true
	        elseif MPTX(id,10) and PersonKF(id,251) then 
                return true
			end
	    end
		--?¨²?¡Á???????¡è?¡è
		if WGid1 == 13 and WGid2 == 143 then
            if PersonKF(id,13) and PersonKF(id,196) then 
                return true
			elseif PersonKF(id,143) and PersonKF(id,196) then 
                return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á?????????
        if WGid1 == 15 and WGid2 == 16 then
			if PersonKF(id,15) and PersonKF(id,16) then 
                return true
	        elseif match_ID(id,5) or match_ID(id, 64) then 
                return true
			end
	    end
		--???¡Â????
        if WGid1 == 15 and WGid2 == 39 then
			if PersonKF(id,15) and PersonKF(id,39) then 
                return true
	        elseif match_ID(id,129) or match_ID(id, 64) then 
                return true
			end
	    end
		--????????
		if WGid1 == 17 and WGid2 == 142 then
			if PersonKF(id,17) and PersonKF(id,142) then 
                return true
			elseif match_ID(id,122) or match_ID(id,65) then
	            return true
			end
		end	
		--????????
		if WGid1 == 17 and WGid2 == 49 then
			if PersonKF(id,17) and PersonKF(id,49) then 
                return true
			elseif PersonKF(id,17) and match_ID(id,65) then
	            return true
			elseif match_ID(id,499) or JXPD(id,53,1) then
	            return true
			end
		end	
		--?????????????¡§??????????¡¦¨½?¨²¡Á?¡Á????¨§????????
        if WGid1 == 21 and WGid2 == 118 then
			if PersonKF(id,5) and PersonKF(id,21) then 
                return true
			elseif PersonKF(id,9) and PersonKF(id,118) then
	            return true
	        elseif match_ID(id, 523) or match_ID(id, 514) then
	            return true
			end
	    end
		--?¨®????????+??????
        if WGid1 == 22 and WGid2 == 24 then
			if PersonKF(id,22) and PersonKF(id,24) then 
                return true
			elseif match_ID(id,169) and PersonKF(id,22) then
	            return true
	        elseif match_ID(id, 114) or match_ID(id, 577) then
	            return true
			end
	    end
		--¡Â???????
        if WGid1 == 25 and WGid2 == 6 then
			if PersonKF(id,25) and PersonKF(id,6) then 
                return true
	        elseif JXPD(id,58,1) then
	            return true
			end
	    end
		--??????????????????
        if WGid1 == 26 and WGid2 == 80 then
			if PersonKF(id,26) and PersonKF(id,80) then 
                return true
	        elseif match_ID(id,50) or match_ID(id,69) then
	            return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á?????????????????
        if WGid1 == 29 and WGid2 == 114 then
			if PersonKF(id,29) and PersonKF(id,114) then 
                return true
	        elseif match_ID(id,311) or match_ID(id,594) then
	            return true
			end
	    end
		--??????????????????
		if WGid1 == 35 and WGid2 == 61 then
            if PersonKF(id,35) and PersonKF(id,61) then 
                return true
			elseif match_ID(id,38) then
			    return true		
			end
	    end
		--??????????????+?¨¢???????¨¢????
		if WGid1 == 36 and WGid2 == 46 then
            if PersonKF(id,36) and PersonKF(id,46) then 
                return true
	        elseif match_ID(id,5) or match_ID(id,95) or match_ID(id,456) or match_ID(id,9878) then 
                return true
	        elseif MPTX(id,4,3) then 
                return true
			end
	    end
		--???????¡è
		if WGid1 == 37 and WGid2 == 60 then
            if PersonKF(id,37) and PersonKF(id,60) then 
                return true
	        elseif match_ID(id,9877) or match_ID(id,96) then 
                return true
	        elseif MPTX(id,19,2) then 
                return true
			end
	    end
		--?¨½¨®?????
		if WGid1 == 38 and WGid2 == 73 then
            if PersonKF(id,38) and PersonKF(id,73) then 
                return true
	        elseif match_ID(id,63) or match_ID(id,73) then 
                return true
			end
	    end
		--???????? ??????¡¦¡§ + ?¨½????
		if WGid1 == 39 and WGid2 == 42 then
            if PersonKF(id,39) and PersonKF(id,42) and (ZYHBPD(id) > 0 or not isteam(id)) then 
                return true
	        elseif PersonKF(id,139)	and Curr_NG(id,154) then
		        return true
	        elseif match_ID(id,455) or match_ID(id,605) then
		        return true
			end
	    end
		--???????¡Â
		if WGid1 == 39 and WGid2 == 15 then
			if PersonKF(id,39) and PersonKF(id,15) then 
                return true
	        elseif match_ID(id,129) or match_ID(id,64) then
	            return true
			end
	    end
		--???¨²????
        if WGid1 == 45 and WGid2 == 47 then
			if PersonKF(id,47) and PersonKF(id,45) then 
                return true
	        elseif match_ID(id,592) then
	            return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á????¡§??????????
        if WGid1 == 47 and WGid2 == 73 then
			if PersonKF(id,47) and PersonKF(id,73) then 
                return true
	        elseif match_ID(id,35) or match_ID(id,73) then
	            return true
			end
	    end
		--???????????¨¾??????
        if WGid1 == 51 and WGid2 == 56 then
			if PersonKF(id,51) and PersonKF(id,56) then 
                return true
	        elseif match_ID(id,90) or match_ID(id,89) then 
                return true
			end
	    end
		--??????????????????
        if WGid1 == 53 and WGid2 == 78 then
			if PersonKF(id,53) and PersonKF(id,78) then 
                return true
	        elseif match_ID(id,133) or match_ID(id,456) or match_ID(id,25) then 
                return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á??¨§????¡¦¨§??????
		if WGid1 == 54 and WGid2 == 62 then
			if PersonKF(id,54) and PersonKF(id,62) then 
                return true
	        elseif match_ID(id, 77) then
	            return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á???????????????
        if WGid1 == 57 and WGid2 == 346 then
			if PersonKF(id,57) and PersonKF(id,346) then 
                return true
	        elseif match_ID(id, 114) then
	            return true
			end
	    end
		--????????????????¡¦???????or??¡¦?+?¡Á?¨¦
        if WGid1 == 58 and WGid2 == 174 then
			if PersonKF(id,153) and (PersonKF(id,58) or PersonKF(id,174)) then 
                return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á?????????????????
        if WGid1 == 59 and WGid2 == 232 then
			if PersonKF(id,59) and PersonKF(id,232) then 
                return true
	        elseif match_ID(id, 511) then
	            return true
			end
	    end
		--????????????????????????or????+??????
        if WGid1 == 61 and WGid2 == 65 then
			if PersonKF(id,61) and PersonKF(id,66) then 
                return true
	        elseif PersonKF(id,66) and PersonKF(id,65) then 
                return true
			end
	    end
		--??????????????¡Á¨¦??
        if WGid1 == 69 and WGid2 == 76 then
			if PersonKF(id,69) and PersonKF(id,76) then 
                return true
	        elseif PersonKF(id,119)  then 
                return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á?????????????
        if WGid1 == 64 and WGid2 == 236 then
			if PersonKF(id,64) and PersonKF(id,236) then 
                return true
	        elseif match_ID(id, 5) then 
                return true
	        elseif MPTX(id,4,2) then 
                return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á??????¨¦????????
        if WGid1 == 72 and WGid2 == 73 then
			if PersonKF(id,73) and PersonKF(id,72) and PersonKF(id,84) and PersonKF(id,142) then 
                return true
	        elseif match_ID(id, 31) or match_ID(id, 32) or match_ID(id, 33) or match_ID(id, 34) then 
                return true
	        elseif  match_ID(id, 115) then 
                return true
			end
	    end
		--?¨²???¨¢??
        if WGid1 == 76 and WGid2 == 79 then
			if PersonKF(id,76) and PersonKF(id,79) then 
                return true
	        elseif match_ID(id,594) or match_ID(id,9892) then
	            return true
			end
	    end
		--?????????????¡§??????????¡¦¨½?¨²¡Á?????¡¦???????????????
        if WGid1 == 78 and WGid2 == 55 then
			if PersonKF(id,78) and PersonKF(id,55) then 
                return true
	        elseif match_ID(id,99) or match_ID(id,29) then
	            return true
			end
	    end
		--?????????¡è?¡è
		if WGid1 == 118 and WGid2 == 121 then
			if PersonKF(id,118) and PersonKF(id,121) then 
                return true
			elseif PersonKF(id,118) and PersonKF(id,17) then 
                return true
			elseif match_ID(id,602) or match_ID(id,65) then
	            return true
			end
		end	
		--????????
		if WGid1 == 156 and WGid2 == 188 then
			if PersonKF(id,188) and PersonKF(id,156) then 
                return true
			elseif match_ID(id,604) then
	            return true
			end
		end	
		--???¡è????
	    if WGid1 == 165 and WGid2 == 206 then
			if PersonKF(id,165) and PersonKF(id,206) then 
                return true
			elseif PersonKF(id,155) then
			    return true
			end
		end
		--???????¨²¡Á??¡è?¡è
		if WGid1 == 20 and WGid2 == 24 then
			if PersonKF(id,20) and PersonKF(id,24) then
				return true
			elseif match_ID(id,170) or match_ID(id,114) or match_ID(id,577) then
	            return true
			end 
		end 
		--???¡ì???¡ì
		if WGid1 == 86 and WGid2 == 267 then
			if PersonKF(id,86) and PersonKF(id,267) then
				return true
			elseif match_ID(id,576) or match_ID(id,70) or match_ID(id,577) then
	            return true
			end 
		end 		 
		--????????
	    if WGid1 == 198 and WGid2 == 200 then
			if PersonKF(id,198) and PersonKF(id,199) and PersonKF(id,200) then 
                return true
			elseif match_ID(id,567) or match_ID(id,568) then
	            return true
			end
		end	
		--???¡§???¡§?¡è?¡è
	    if WGid1 == 226 and WGid2 == 126 then
			if PersonKF(id,226) and PersonKF(id,126) then 
                return true
			elseif JXPD(id,27,2) or match_ID(id,511) then
	            return true
			end
		end	
		--???¡§?????¡è?¡è
	    if WGid1 == 226 and WGid2 == 126 then
			if PersonKF(id,226) and PersonKF(id,127) then 
                return true
			elseif JXPD(id,27,2) or match_ID(id,511) then
	            return true
			end
		end	
		--???¡§?????¡è?¡è
	    if WGid1 == 226 and WGid2 == 201 then
			if PersonKF(id,226) and (PersonKF(id,126) or PersonKF(id,127)) and PersonKF(id,201) then 
                return true
			elseif JXPD(id,27,2) or match_ID(id,511) then
	            return true
			end
		end	
		--?¨§??????
	    if WGid1 == 306 and WGid2 == 90 then
			if PersonKF(id,306) and PersonKF(id,90) then 
                return true
			elseif PersonKF(id,306) and PersonKF(id,375) then
			    return true
			elseif match_ID(id,189) or match_ID(id,9795) then
	            return true
			end
		end
		--???¡§????
		if WGid1 == 12 and WGid2 == 126 then
			if PersonKF(id,12) and PersonKF(id,126) then
				return true
			elseif match_ID(id,57) then
			    return true	
			end
		end
		--????????
		if WGid1 == 56 and WGid2 == 75 then
			if PersonKF(id,56) and PersonKF(id,75) then
				return true	
			elseif match_ID(id,89) or match_ID(id,44) then
			    return true	
			end 	
		end
		--????
		if WGid1 == 57 and WGid2 == 133 then
			if PersonKF(id,57) and PersonKF(id,133) then
				return true	
			elseif match_ID(id,103) or match_ID(id,577) then
	            return true
			elseif id > 460 and id < 479 then
	            return true
			end 
		end
	end
	return false
end

--??????¡¦¡§????
function WYXF(id)
	local pd = false
	if PersonKF(id,89) and PersonKF(id,216) and PersonKF(id,259) and PersonKF(id,263) and PersonKF(id,264) then
		pd = true
	end
	for i = 19, 23 do
		if JXPD(id,i,1) then
			pd = true 
			break
		end
	end			
	if PersonKF(id,175) then
	    pd = true
	end	
	return pd
end
--?????????????¡§??????????¡¦¨½?¨²¡Á???????¡¦¡§??????
function WuyueJFSL(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if kfid == 30 or kfid == 31 or kfid == 32 or kfid == 33 or kfid == 34 then
			num = num + 1
		end
	end
	for i = 19, 23 do
		if JXPD(id,i,1) then
			num = 7
			break
		end
	end
	if PersonKF(id,377) and PersonKF(id,175) then
		num = 7
	end
	return num
end
--???????????¡Â
function WYJJ(id)
	if PersonKF(id,175) then
		return true
	end	
	for i = 19, 23 do
		if JXPD(id,i,1) then
			return true
			--break
		end
	end
	return false	
end
--?????????????¡§??????????¡¦¨½?¨²¡Á???????????????
function DubuWL(id)
    if PersonKF(id,295) and PersonKF(id,334) and PersonKF(id,220) then
        return true
	elseif PersonKF(id,3) and PersonKF(id,120) and PersonKF(id,220) then
	    return true
	elseif match_ID(id,46) or match_ID(id,83) or match_ID(id,746) then
	    return true
    end
    return false
end
--?????????????¡§??????????¡¦¨½?¨²¡Á???????????????
function XHDB(id)
    if PersonKF(id,3) and PersonKF(id,21) and (PersonKF(id,216) or PersonKF(id,43)) then
        return true
	elseif match_ID(id, 523) then
	    return true
    end
    return false
end
--?????????????¡§??????????¡¦¨½?¨²¡Á??¨²?¡Á????????????
function Tjyrz(id)
    if (PersonKF(id,13) or PersonKF(id,143)) and PersonKF(id,196) then 
        return true
	elseif match_ID(id, 112) or match_ID(id, 627) then
	    return true
    end
    return false
end
--??¡Á????¡ì??????¡¦¨¹?¡ì??or????¡¦¨¹?¡ì??or¡¦¨¹?¡ì??¡¦¡§+????¡¦¨¹?¡ì??
function ShiZunXM(id)
    if (PersonKF(id,82) or PersonKF(id,194) or PersonKF(id,86)) and PersonKF(id,96) then
        return true
    elseif match_ID(id, 577) or match_ID(id,576) or match_ID(id,160) then 
        return true
    end	
    return false
end
--????¡ã???
function JinGangBR(id)
    if PersonKF(id,22) and PersonKF(id,189) and PersonKF(id,108) then 
		return true
	elseif (match_ID(id,505) or match_ID(id,9979)) and (PersonKF(id,22) or PersonKF(id,189)) then
        return true
	elseif match_ID(id,577) or match_ID(id,114) or match_ID(id,149) then
        return true
    end
    return false
end

--?????????????¡§??????????¡¦¨½?¨²¡Á???????????????
--????????????????/?¨®?????¡§??/????????/?¨¦?¡§??????
function ChuQueSX(id)
	local sixiangnum = 0;
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		local klvl = JY.Person[id]["????????"..i]
		if (kfid == 132 or kfid == 133 or kfid == 136 or kfid == 137) and klvl == 999 then
			sixiangnum = sixiangnum + 1
		end
		if match_ID(id,577) then 
            sixiangnum = 4
        end
        if match_ID(id,638) and WAR.ZDDH == 287 and CC.TX['???????????¨½'] == 5 then
        	sixiangnum = 4
        end	
	end
	return sixiangnum
end
--??????¡¦?
function XiaoYaoYF(id)
	if PersonKF(id,85) and PersonKF(id,98) and PersonKF(id,101) and (JY.Person[240]["?¡¦??"] == 80 or (isteam(id) == false)) then	
		return true
	elseif JXPD(id,634,1) and (JY.Person[240]["?¡¦??"] == 80 or (isteam(id) == false)) then
		return true
	end
	return false
end
--??¡¦?????
function YaoFengHuoShi(id)
	if PersonKF(id,55) and (PersonKF(id,90) or PersonKF(id,375)) and PersonKF(id,148) and PersonKF(id,78) and Curr_QG(id,148) then
		return true
	elseif match_ID(id,456) then
        return true
	end
	return false
end


function NGQH(id,NGid)--?????????????¡Â??????¡Á¨¦??
	if WAR.PJTX1 ~= 0 and match_ID(id,592) == false then
		return false
	else
		if match_ID(id,634) and NGid ~= nil and NGid > 0 and NGid ~= 315 and NGid ~= 359 and NGid ~= 184 and NGid ~= 180 then
			return true
		elseif match_ID(id,520) and (NGid == 315) then 
			return true
		elseif match_ID(id,520) and (NGid == 359) then 
			return true	
		elseif (match_ID(id,592) or match_ID(id,604) or match_ID(id,636)) and (NGid == 184) then
			return true 	
		elseif match_ID(id,771) and (NGid == 233) then
			    return true		
		elseif match_ID(id,524) and (NGid == 372) then 
			return true
		elseif match_ID(id,641) and (NGid == 93 or NGid == 97) then  --???¨¢???¡Â?????¡§??????
			return true
		elseif match_ID(id,5) and (NGid == 99 or NGid == 171) then  --???????????¡Á???¡§??????
			return true
		elseif match_ID(id,577) and (NGid == 96 or NGid == 108 or NGid == 144 or NGid == 106) then  --???????????¡Á???¡§??????
			return true
		elseif match_ID(id,592) and (NGid == 177 or NGid == 252) then  --???????¨¹?¨¦?????????¡§??????
			return true
		elseif match_ID(id,638) and NGid == 106 then  --?¡¦???????????¡§??????
			return true
		elseif (match_ID(id,637) or (match_ID(id,526) and match_ID(id,9757))) and NGid == 107 then  --?????????????¡§??????
			return true
		elseif match_ID(id,9991) and id == 0 and JXPD(id,11,1) and NGid == 160 then
			return true
		elseif match_ID(id,456) and (NGid == 203 or NGid == 97) then
			return true
		elseif match_ID(id,50) and  NGid == 204 and PersonKF(id,204) then
			return true
		elseif match_ID(id,113) and NGid == 108 and PersonKF(id,108) then
			return true
		elseif match_ID(id,635) and (NGid == 180) then 
		    return true 	
		end	
		local pd = false
		if JY.Status == GAME_WMAP then
			if WAR.PD['??????????'][id] ~= nil and math.random(10) > 7 then
				pd = false
			else
			    if Given_NG(id,NGid) then
					pd = true
				elseif JY.Base["??¡Á?"] == 6 and id == 0 and JY.Base['?¨§?¨¦????'] >= 7 and JXPD(0,6,1) 
				and (JY.Person[id]['?¡Â??????'] == NGid or JY.Person[id]['????????1'] == NGid) then
				    pd = true
				elseif JY.Person[id]['?¨§??????'] ~= NGid and JY.Person[id]['????¡¦??¡Á'] ~= nil then
				    local jjl = {65,45,30,20,15,10,5,0}
					local num = 0
					if JXPD(id,11,1) then
						num = 5 + math.modf((120-psx(id,'?¡¦??'))*0.067)
					end
					if JXPD(id,7,1) and  WAR.SEYB == 0 then
						num = 8 + math.modf((psx(id,'?¡¦??'))*0.067)
					end
					if JXPD(id,6,1) then
						num = 15
					end
					if match_ID(id,9987) then
						num = 10
					end
				    local ng = 20 + jjl[JY.Person[id]['????¡¦??¡Á']+1] + num
					if math.random(100) <= (ng) then
						pd = true
					end
				end
			end
		else
			pd = true
		end
	--???????¡è
	    if NGid == 93 and pd == true then
			if Curr_NG(id,93) and PersonKF(id,97) then
			    return true
			else 
			    return false	
			end
		end	
		
	--?¨¾¨®?????
		if NGid == 95 and pd == true then
			if Curr_NG(id,95) and PersonKF(id,220) then
				return true
			elseif (match_ID(id,60) and PersonKF(id,95)) or (match_ID(id,61) and Curr_NG(id,95)) then
				return true	
			else
				return false
			end	
		end	
		
	--???¡è????
	    if NGid == 97 and pd == true then
			if Curr_NG(id,97) and PersonKF(id,227) then
				return true
			elseif match_ID(id,456) then
				return true
			elseif match_ID(id,9) and PersonKF(id,97) then	
				return true
			else 
			    return false	
			end
		end	
		
	--????????
		if NGid == 99 and pd == true then
			if Curr_NG(id,99) and PersonKF(id,149) then
				return true
			elseif match_ID(id,9) and PersonKF(id,99) then	
				return true
			elseif MPTX(id,4,2) and PersonKF(id,99) and PersonKF(id,171) then	
				return true
			elseif match_ID(id,521) or match_ID(id,747) then
			    return true		
			else 
				return false
			end		
		end
		
	--???¨§?¨½??
		if NGid == 100 and pd == true then
			if Curr_NG(id,100) and (PersonKF(id,94) or PersonKF(id,203)) then
				return true
			elseif (match_ID(id,129) or match_ID(id,64)) and PersonKF(id,100) then
				return true
			elseif Curr_NG(id,100) and match_ID(id,9729) then
				return true	
			else
				return false
			end 
		end 
		
	--¡ã??????¡è
		if NGid == 101 and pd == true then
			if Curr_NG(id,101) and PersonKF(id,85) then 
				return true
			elseif match_ID(id,117) and PersonKF(id,101) then
				return true
			elseif match_ID(id,775) then
			    return true	
			else
				return false
			end
		end
		
	--???????¡è????
		if NGid == 102 and pd == true then
			if Curr_NG(id,102) and PersonKF(id,97) and PersonKF(id,199) then
				return true
			elseif Curr_NG(id,102) and match_ID(id,604) then
				return true	
			elseif JXPD(id,38,1) then
				return true
			elseif Curr_NG(id,102) and match_ID(id,9927) then
				return true
			elseif match_ID(id,774) and Curr_NG(id,102) then
			    return true			
			else
				return false
			end
		end
		
	--?¨²?¨®?¨½¡Á?
		if NGid == 103 and pd == true then
			if Curr_NG(id,103) and PersonKF(id,233) then
				return true
			elseif match_ID(id,62) or match_ID(id,524) or match_ID(id,759) then
				return true
			elseif match_ID(id,745) and PersonKF(id,103) then
			    return 	true
			elseif JXPD(id,84,1) and PersonKF(id,103) then
			    return 	true    
			elseif Curr_NG(id,103) and match_ID(id,9727) then
				return true		
			elseif match_ID(id,771) and Curr_NG(id,103) then
			    return true		
			else
				return false
			end
		end
		
	--????????
		if NGid == 104 and pd == true then
			if Curr_NG(id,104) and PersonKF(id,150) then
				return true
			elseif Curr_NG(id,104) and JXPD(id,60,1) then 
				return true
			else
				return false
			end
		end
		
	--???¡§¡Á???
		if NGid == 105 and pd == true then
			if Curr_NG(id,105) and PersonKF(id,89) then
				return true
			elseif (match_ID(id,457) or match_ID(id,531)) and Curr_NG(id,105) then
			    return true	
			elseif match_ID(id,762) and Curr_NG(id,105) then
			    return true 	
			elseif match_ID(id,27) or match_ID(id,92) or match_ID(id,773) then
   			    return true	
			elseif match_ID(id,769) and Curr_NG(id,105) then 
			    return true 	
			else
				return false
			end
		end
	--????????
		if NGid == 106 and pd == true then
			if match_ID(id,9) then
				return true
			elseif JY.Status == GAME_WMAP and WAR.ZDDH == 393 and match_ID(id,637) then
				return true
			elseif Curr_NG(id,106) and match_ID(id,9999) then
				return true
			elseif Curr_NG(id,106) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['????¡Á¨¦?????¡§'][id] == 1 then
						return true
					end
				end	
			else
				return false
			end
		end
	--????????
		if NGid == 107 and pd == true then
			if JY.Status == GAME_WMAP and WAR.ZDDH == 393 and match_ID(id,638) then
				return true
			elseif Curr_NG(id,107) and match_ID(id,9929) then
				return true
			elseif match_ID(id,754) and PersonKF(id,107) then
			    return true 	
			elseif Curr_NG(id,107) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['????¡Á¨¦?????¡§'][id] == 1 then
						return true
					end
				end
			else
				return false
			end
		end
	--?¡Á??????????	
		if NGid == 108 and pd == true then
			if Curr_NG(id,108) and match_ID(id,9930) then
				return true
			elseif Curr_NG(id,108) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['?¡Á??¡Á¨¦?????¡§'][id] == 1 then
						return true
					end
				end
			elseif PersonKF(id,108) and match_ID(id,744) then
			    return true	
			elseif match_ID(id,770) and Curr_NG(id,108) then
			    return true	
			elseif match_ID(id,772) and Curr_NG(id,108) then
			    return true		
			else	
				return false		
			end
		end
	--?????¨²??
		if NGid == 144 and pd == true then
			if Curr_NG(id,144) and (PersonKF(id,243) or PersonKF(id,196)) then
				return true
			elseif match_ID(id,743) then
			    return true 	
			else
				return false
			end
		end
	--?¨½?????¨§
		if NGid == 154 and pd == true then
			if Curr_NG(id,154) and PersonKF(id,100) then
				return true
			elseif match_ID(id,605) and PersonKF(id,154) then
				return true
			else
				return false
			end 
		end
	--?¨§?¡ì?¡Á???¨¹?¨¦
		if NGid == 160 and pd == true then
			if Curr_NG(id,160) and PersonKF(id,108) and PersonKF(id,177) then
				return true
			elseif match_ID(id,9991) and Curr_NG(id,160) then
				return true
			else
				return false
			end
		end	
		--?????¡§¡Á?+????????
		if NGid == 91 and pd == true then	
			if Curr_NG(id,91) and PersonKF(id,144) then 
				return true
			else
				return false
			end
		end
		--????????
		if NGid == 171 and pd == true then
			if Curr_NG(id,171) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['????¡Á¨¦?????¡§'][id] == 1 then
						return true
					end
				end
			elseif match_ID(id,9) and Curr_NG(id,171) then
			   return true
			elseif Curr_NG(id,171) and match_ID(id,9820) then
				return true
			elseif match_ID(id,747) and Curr_NG(id,171) then
			   return true	
			elseif match_ID(id,768) and Curr_NG(id,171) then
			   return true
			else
				return false
			end
		end
		--?¨¹?¨¦?¨²?¨®
	    if NGid == 177 and pd == true then
			if Curr_NG(id,177) and PersonKF(id,103) then
				return true
			elseif match_ID(id,652) and PersonKF(id,177) then
				return true
			elseif match_ID(id,758) or match_ID(id,775) then
			    return true 	
			else 
			    return false	
			end
		end	
		--?¡è?????¡è
		if NGid == 183 and pd == true then
			if Curr_NG(id,183) and PersonKF(id,85) then 
				return true
			elseif match_ID(id,117) and PersonKF(id,183) then
				return true
			elseif match_ID(id,499) then
			    return true	
			elseif match_ID(id,773) then
			    return true		
			else
				return false
			end
		end
		--???¨§?¨¹??	
		if NGid == 190 and pd == true then
			if Curr_NG(id,190) and PersonKF(id,88) then
				return true
			elseif match_ID(id,26) and PersonKF(id,88) then
				return true
			elseif MPTX(id,12,4) and Curr_NG(id,88) then
			    return true
			else 
				return false
			end
		end
		--?¡è?¨²????????
		if NGid == 203 and pd == true then
			if Curr_NG(id,203) and PersonKF(id,248) and PersonKF(id,99) then
				return true
			elseif (JXPD(id,578,1) or JXPD(id,505,1)) and PersonKF(id,203) then
				return true
			elseif Curr_NG(id,203) and match_ID(id,9725) then	
			    return true 
			else
				return false
			end
		end
		--???¨²????
		if NGid == 204 and pd == true then
			if Curr_NG(id,204) and PersonKF(id,96) then 
				return true
			elseif match_ID(id,69) and Curr_NG(id,204) then
				return true
			elseif match_ID(id,764) and Curr_NG(id,204) then
			    return true	
			elseif (match_ID(id,767) and Curr_NG(id,204)) or match_ID(id,539) then	
			    return true
			elseif Curr_NG(id,204) and match_ID(id,9728) then
				return true		
			elseif match_ID(id,772) and Curr_NG(id,108) then
			    return true			
			else
				return false
			end
		end
		--????????+????????
		if NGid == 221 and pd == true then
			if Curr_NG(id,221) and PersonKF(id,250) then
				return true
			else
				return false
			end
		end	
		--????12+????????
		if NGid == 247 and pd == true then
			if Curr_NG(id,247) and PersonKF(id,242) then
				return true
			elseif JXPD(id,626,1) and PersonKF(id,247) then
				return true
			else
				return false	
			end	
		end
		--???????¨§
		if NGid == 249 and pd == true then
			if Curr_NG(id,249) and (PersonKF(id,225) or PersonKF(id,190)) then
				return true
			elseif JXPD(id,30,1) or JXPD(id,55,1) or match_ID(id,64) then
				return true
			elseif match_ID(id,764) then
			    return true	
			else 
				return false	
			end
		end
		--?????¡è?¨²
	    if NGid == 252 and pd == true then
			if Curr_NG(id,252) and (PersonKF(id,203) or PersonKF(id,94)) then
				return true
			elseif Curr_NG(id,252) and match_ID(id,9726) then
				return true			
			else
			    return false		
			end
		end	
		--?¨§????¨§?
	    if NGid == 314 and pd == true then
			if Curr_NG(id,314) and PersonKF(id,207) then
				return true
			elseif match_ID(id,499) then 
			    return true
			elseif Curr_NG(id,314) and (match_ID(id,681) or match_ID(id,53)) then 
			    return true
			else
			    return false		
			end
		end	
		--????????
	    if NGid == 315 and pd == true then
			if Curr_NG(id,315) and (PersonKF(id,203) or PersonKF(id,94)) and PersonKF(id,100) and PersonKF(id,107) then
				return true
			elseif Curr_NG(id,315) and match_ID(id,9724) then	
			    return true 
			else
				return false
			end
		end
		--?????¨¾¨®?
	    if NGid == 227 and pd == true then	
			if Curr_NG(id,227) and PersonKF(id,95) then
				return true
			else
			    return false	
			end
		end
		--?????¡§¡Á?¡Á¨¦??
		if NGid == 96 and pd == true then
			if Curr_NG(id,96) and (PersonKF(id,91) or PersonKF(id,92)) then
				return true
			elseif match_ID(id,517) or match_ID(id,38) then
				return true
			end
		end			
		--???¡§?¡§??
	    if NGid == 	372 and pd == true then
			if Curr_NG(id,372) and PersonKF(id,180) then
			    return true
			elseif match_ID(id,524) then 
			    return true
			elseif match_ID(id,776) and PersonKF(id,372) then 
			    return true	
			else	
			    return false
			end 	
		end	
		--????????
		if NGid == 184 and pd == true then 
			if Curr_NG(id,184) and PersonKF(id,359) then
				return true	
			else 
			    return false	
			end
		end
		--????????
		if NGid == 359 and pd == true then
			if Curr_NG(id,359) and PersonKF(id,184) then
				return true 
			else 
			    return false		
			end
		end
		--?¨½¡Á????¡è
		if NGid == 233 and pd == true then
			if Curr_NG(id,233) and PersonKF(id,97) then
				return true
			else 
			    return false	
			end
		end		
		--?¡§??????
		if NGid == 180 and pd == true then
			if Curr_NG(id,180) and PersonKF(id,107) then
				return true 
			else 
			    return false	
			end
		end
		--?¨½??????
		if NGid == 94 and pd == true then
			if Curr_NG(id,94) and PersonKF(id,227) then
				return true 
			elseif Curr_NG(id,94) and match_ID(id,37) then
			    return true
			else 
			    return false		
			end
		end
	end
	return false
end


function NGQHB(id,NGid)--????????????¡¦??¡Â??????¡Á¨¦??
	--if WAR.PJTX1 ~= 0 and (not match_ID(id,592)) then
		--return false
	--else
	    if match_ID(id,577) and NGid ~= nil and NGid > 0 then
			return true
		end
		--????????
		if NGid == 87 then
			if PersonKF(id,87) and	PersonKF(id,220) then
				return true	
			elseif match_ID(id,46) and PersonKF(id,87) then
				return true
			elseif match_ID(id,634) then
				return true
			else
				return false
			end
		end
		--?¨§??¡Á???
		if NGid == 90 then
			if PersonKF(id,90) and PersonKF(id,89) then
				return true
			elseif PersonKF(id,375) and PersonKF(id,89) then
				return true
			elseif match_ID(id,524) or JXPD(id,189,1) then
				return true		
			elseif JXPD(id,58,1) then
				return true	
			else 
				return false
			end
		end
		--?????¡§????
	    if NGid == 91 then
			if PersonKF(id,91) and PersonKF(id,180) then
				return true
			elseif match_ID(id,13) or match_ID(id,149) then
				return true
			elseif match_ID(id,758) or match_ID(id,635) then
			    return true	
			else 
				return false	
			end
		end
		--?????¡§¡Á?
		if NGid == 93 then
			if PersonKF(id,93) and PersonKF(id,92) then
				return true
			else 
			    return false
			end 
		end
		--?¨¾¨®??¨§??
		if NGid == 95 then
			if (PersonKF(id,90) or PersonKF(id,375)) and (PersonKF(id,95) or PersonKF(id,180)) then
				return true
			elseif JXPD(id,60,1) then
				return true
			else
				return false
			end
		end
		--???????¨§
		if NGid == 96 then
			if PersonKF(id,96) and (PersonKF(id,190) or PersonKF(id,225)) then
				return true
			elseif match_ID(id,577) or match_ID(id,576) then
				return true
			else 
				return false		
			end
		end	
		--?????¨§??
	    if NGid == 99 then
			if PersonKF(id,99) and PersonKF(id,90) then
				return true
			elseif PersonKF(id,99) and PersonKF(id,375) then
				return true
			elseif JXPD(id,5,1) then
				return true
			else 
				return false	
			end
		end
		--???¨§????
		if NGid == 100 then
			if PersonKF(id, 100) and PersonKF(id,107) then
				return true
			elseif match_ID(id,65) or match_ID(id,129) then
				return true
			else 
				return false		
			end
		end
		--????????
		if NGid == 104 then
			if PersonKF(id, 104) and PersonKF(id,107) then
				return true
			elseif JXPD(id,60,1) then
				return true
			else 
				return false		
			end
		end
		--???????¡è
		if NGid == 106 then
			if PersonKF(id, 106) and PersonKF(id,97) then
				return true
			elseif match_ID(id,9) then
				return true
			else 
				return false		
			end
		end
		--????????
		if NGid == 144 then
			if PersonKF(id,96) and PersonKF(id,144) then
				return true
			elseif match_ID(id,577) or match_ID(id,758) or match_ID(id,743) then
				return true
			else 
				return false		
			end
		end
		--¡Á?¡Á??¨§?¡ì
		if NGid == 160 then
			if PersonKF(id, 160) and PersonKF(id,190) then
				return true
			elseif match_ID(id,112) or match_ID(id,627) then
				return true
			else 
				return false		
			end
		end
		--???????¡Â?????¡§¡¦?¡Á¨¦????¡ã¨®??????
		if NGid == 175 then
			if MPTX(id,14,6) and PersonKF(id,175) then
				return true
			else
				return false
			end
		end	
		--?¨¹?¨¦????
		if NGid == 177 then
			if PersonKF(id,177) and PersonKF(id,252) then
				return true
			elseif match_ID(id,652) and PersonKF(id,177) then
				return true
			elseif match_ID(id,772) and Curr_NG(id,108) then
			    return true			
			else
				return false
			end
		end 			
		--?¡§??????
		if NGid == 180 then
			if PersonKF(id,227) and PersonKF(id,180) then
				return true
			elseif match_ID(id,759) then
			    return true 	
			elseif match_ID(id,773) then
			    return true	
			else
				return false
			end
		end
		--???????¨§
	    if NGid ==	190 then
			if PersonKF(id,190) and PersonKF(id,227) then
				return true
			elseif match_ID(id,5) then
			    return true
			else 
			    return false		
			end
		end
		--?????????¨¢?¡¦?¡§?¨²????+????????+?¨²?¨®??
		if NGid == 196 then
			if PersonKF(id,196) and PersonKF(id,144) and PersonKF(id,103) then
				return true
			elseif match_ID(id,603) or match_ID(id,9807) then
				return true
			elseif match_ID(id,771) or match_ID(id,743) then 
			    return true	
			else 
				return false	
			end
		end
		--???????¡§?????¡è?¨²or?¨½????
		if NGid == 199 then
			if PersonKF(id,199) and (PersonKF(id,203) or PersonKF(id,94)) then
				return true
			elseif (JXPD(id,578,1) or JXPD(id,505,1)) and PersonKF(id,203) then
				return true
			elseif match_ID(id,771) and PersonKF(id,94) then 
				return true
			else
				return false
			end
		end
		--??¨§?????
		if NGid == 207 then
			if PersonKF(id,207) and (PersonKF(id,250) or PersonKF(id,314)) then
				return true
			elseif match_ID(id,499) or match_ID(id,65) then
				return true
			elseif match_ID(id,102) and PersonKF(id,207) then
				return true
			else 
				return false		
			end
		end
		--????or?¡Á??????¡Á???
	    if NGid ==	216 then
			if (PersonKF(id,216) or PersonKF(id,43)) and PersonKF(id,89) then
				return true
			elseif match_ID(id,22) then
			    return true
			else 
			    return false		
			end
		end
		--?????????¨§
		if NGid == 219 then
			if PersonKF(id,219) and PersonKF(id,225) then
				return true
			elseif match_ID(id,26) then
			    return true
			else 
				return false		
			end
		end
		--??????¡Á?
	    if NGid == 248 then
			if PersonKF(id,248) and PersonKF(id,317) then
				return true
			elseif match_ID(id,56) or match_ID(id,57) or match_ID(id,588) then
			    return true
			else 
			    return false		
			end
		end
		--????????
		if NGid == 252 then
			if PersonKF(id,252) and PersonKF(id,199) then
				return true
			elseif match_ID(id,568) and PersonKF(id,199) then
			    return true
			else 
			    return false		
			end
			
		end
		--?¨²???¨§??
		if NGid == 369 then
			if PersonKF(id,369) and PersonKF(id,90) then
				return true
			elseif match_ID(id,524) or match_ID(id,758) then
			    return true
			else
			    return false		
			end
		end
	--end
	return false
end

--????????????????
function wgnlxz(wugong)
	local xz
	for i = 0, JY.ThingNum - 1 do
		if JY.Thing[i]['?¡¦??????'] >= 0 and wugong == JY.Thing[i]['?¡¦??????'] then
			xz = JY.Thing[i]["??????????"]
			break
		end		
	end
	return xz
end	
-----?????¨ª????
function Sancai(id)
	local yin,yang,tiao = 0,0,0
	for i = 1, JY.Base["????????"] do
		local wid = JY.Person[id]["????"..i]
		if wgnlxz(wid) == 0 and yongnei(wid) then
			yin = 1
			break
		end
	end	
	for i = 1, JY.Base["????????"] do
		local wid = JY.Person[id]["????"..i]
		if wgnlxz(wid) == 1 and yongnei(wid) then
			yang = 1
			break
		end
	end
	for i = 1, JY.Base["????????"] do
		local wid = JY.Person[id]["????"..i]
		if wgnlxz(wid) == 2 and yongnei(wid) then
			tiao = 1
			break
		end
	end
	if yin > 0 and yang > 0 and tiao > 0 then
		return true
	elseif match_ID(id,3) then
		return true
	else
		return false
	end
	--return false	
end

--????¡¦??¡Â
function tjqfj(eid)
	if JY.Status == GAME_WMAP then
		if (Curr_NG(eid,171) or Curr_NG(eid,99)) and PersonKF(eid,16) and JY.Person[eid]['??????¡¦¨¾'] >= 350 then
			return true
		elseif MPTX(eid,4,3) and PersonKF(eid,16) and (Curr_NG(eid,171) or Curr_NG(eid,99)) then
			return true
		end
	end
	return false
end	

--?????????????¡§??????¡ã???????????
function calc_mas_num(id)
	local mas_num = 0;
	for i = 1, JY.Base["????????"] do
		if JY.Person[id]["????????" .. i] == 999 then
			mas_num = mas_num + 1;
		end
	end
	return mas_num
end

--?????????????¡§??¡¦¨½?????¡§ID??????????¡Á¡Â?¨§???????¡§
function match_ID(personid, id)
	if JY.Status == GAME_WMAP then
		if WAR.PD['????????6'][personid] ~= nil then
			return false
		end
	end	
	--end	
	if personid == 0 then 
		if CC.TG[id] == 1 then 
			return true
        end
    end
	if id > 9700 then
		if PDTZ(personid,JY.Person[personid]["???¡Â"]) then
			local n = JY.Person[personid]["???¡Â"]
			if Setmeal[n][7] == id then
				if JY.Status == GAME_WMAP then
					if WAR.TMYJ > 0 then
						return false
					else
						return true
					end
				else	
					return true
				end	
			end
			
		end
	end
	
	--[[if personid == 0 and JY.Base["????"] > 0 then
		personid = JY.Base["????"]

	end]]
	
	
	-- if personid == 0 then 
	
		-- if PDTZ(personid,JY.Person[personid]["???¡Â"])  then
			-- local n = JY.Person[personid]["???¡Â"]
			-- if Setmeal[n][7] == id then
				-- say("???¡ã?¨§??"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	
	-- end
	
	-- if personid == 0 and JY.Base["????"] > 0 then
		-- personid = JY.Base["????"]
		-- if PDTZ(personid,JY.Person[personid]["???¡Â"])  then
			-- local n = JY.Person[personid]["???¡Â"]
			-- if Setmeal[n][7] == id then
			-- --	say("???¡ã?¨§??"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	-- end	
	if CC.Copy[personid] ~= nil then 
		personid = CC.Copy[personid]
	end
	if JY.Status == GAME_WMAP then
		--???¡Â?????¨§??
		if actor(personid,10) then 
			if WAR.LSTF[personid] == nil then 
				WAR.LSTF[personid] = {}
			end
			if WAR.LSTF[personid][id] ~= nil then 
				return true
			end
		end
		--?????????¨§?????¨²?¡ì
		if personid == 539 and id == 50 then
			return true
		end	
		if personid == 628 and id == 530 then
			return true
		end
		if personid == 681 and id == 53 then
			return true
		end
		if personid == 678 and id == 49 then
			return true
		end
		if personid == 528 and id == 523 then
			return true
		end
		if personid == 709 and (id == 92 or (id > 9700 and id ~= 9895)) then
			return true
		end
		if personid == 741 and id == 501 then
			return true
		end	
		if personid == 742 and id == 596 then
			return true
		end	
		--???¡Â??????
		if personid == 750 and id == 517 then
			return true
		end	 
	end	
	
	if personid == 512 and JY.Person[512]["????????"] > 0 then
		personid = JY.Person[512]["????????"]
	end	
	
	if (personid==512 or personid == JY.Person[512]["????????"]) then
		if id==JY.Person[512]["????????"] then
			return true
		end
	end

	-- if id > 9940  then

		-- if PDTZ(personid,JY.Person[personid]["???¡Â"])  then
			-- local n = JY.Person[personid]["???¡Â"]
			-- if Setmeal[n][7] == id then
				-- --say("???¡ã?¨§??"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	-- end

  
	--say("????"..id,0,1)	
	-- if id > 9940 then
		-- if PDTZ(personid,JY.Person[personid]["???¡Â"])  then
			-- local n = JY.Person[personid]["???¡Â"]
			-- if Setmeal[n][7] == id then
				-- say("???¡ã?¨§??"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	-- end
	--if id > 9940 then
		
	--end
	--[[if (personid==0 or personid == JY.Base["????"]) and JY.Base["???¡§"]==2 and instruct_16(29) and id==9962 then  
		return true
	end	]]
	
	if CC.PTF[personid] == nil then
		CC.PTF[personid] = {}
	end
	--for i = 1, #CC.PTF[personid] do
	if CC.PTF[personid][id] ~= nil then 
		if id == 9919 and psx(personid,'?¡¦??') > 5 then
			return false
		end	
		return true
		--[[if personid == 0 then
			
			if JY.Base["???¡§"]==2 and instruct_16(id) then
				return true
			end
			if JY.Base["???¡§"]==2 and instruct_16(29) and id == 9962 then
				return true
			end
			--if (personid==0 or personid == JY.Base["????"]) then
				if id==JY.Person[0]["?¨²??"] then
					return true
				end
			--end
			return true
		else
			return true
		end	]]	
	end
	if personid == 0 and JY.Base['????'] > 0 and JY.Base['????'] == id then 
		return true
	end	
	if personid == 0 and JY.Base["???¡§"] == 2 and instruct_16(id) then
		return true
	end
	if personid == 0 and JY.Base["???¡§"] == 2 and instruct_16(29) and id == 9962 then
		return true
	end	 
	if personid == 0 and id == JY.Person[0]["?¨²??"] then
		return true
	end	
	--???????¨®
	if WAR.ZDDH == 376 then
		if personid == 50 and (id == 55 or id == 527 or id == 69) then
			return true
		end
		if personid == 681 and (id == 65 or id == 499 or id == 114) then
			return true
		end
		if personid == 678 and (id == 116 or id == 117 or id == 118 or id == 115) then
			return true
		end
		if (personid == 540 or personid == 541 or personid == 542 or personid == 543 or personid == 544) and (id == 102 or id == 122) then
			return true
		end
	end
	--??????
	if WAR.ZDDH == 430 and (personid == 759 or personid == 743) and (id == 759 or id == 743) and JY.Person[id]["?¨²?¨¹"] > 0 then
		return true
	end
	--????????
	if WAR.ZDDH == 453 and (personid == 520 or personid == 524 or personid == 743 or personid == 747 or personid == 758 or personid == 759 or personid == 760)  
	    and (id == 520 or id == 524 or id == 743 or id == 747 or id == 758 or id == 759 or id == 760) and JY.Person[id]["?¨²?¨¹"] > 0 then
		return true
	end
	return false
end
--?????????????¡§??¡¦¨½?????¡§ID???????????????¡§??¡¦¨½???????¡§????????
function JXPD(personid, id, awkntimes)
    --personid ????????
    --id ???¡ì????
    --awkntimes ????????
	if CC.Copy[personid] ~= nil then 
		personid = CC.Copy[personid]
	end
    local pd = false

    if personid == 0 and JY.Base['??¡Á?'] > 0 and id == JY.Base['??¡Á?'] then
    	if JY.Person[personid]['????????'] >= awkntimes then
			pd = true
		end
	elseif personid == 0 and JY.Base['????'] == id and match_ID(personid,id) then	
		if JY.Person[personid]['????????'] >= awkntimes then
			pd = true
		end
	elseif personid == 0 and JY.Base["???¡§"] == 2 and instruct_16(id) then
        if JY.Person[0]["????????"] >= awkntimes then
            pd = true
		elseif JY.Person[0]["????????"] >= awkntimes then
		    pd = true
        end 	
	end 

	if personid ~= 0 and match_ID(personid,id) then
		if JY.Person[personid]['????????'] >= awkntimes then
			pd = true
		end
	end	

	if id > 9000 and match_ID(personid,id) then
		if JY.Person[personid]["????????"] >= awkntimes then
            pd = true
		elseif JY.Person[0]["????????"] >= awkntimes then
		    pd = true
        end 	
	end 
	return pd
end

--?????????????¡§???¡Â??
function Person_LJ(pid)
	--???????¨¢¡Á??????????????¡Â??
	local LJ1 = math.modf(JY.Person[pid]["?¨¢??"] / 80)
	local LJ2 = math.modf((JY.Person[pid]["????¡Á??¨®??"] + JY.Person[pid]["????"] * 2) / 3000)
	local LJ3 = math.modf(JY.Person[pid]["¡Á???"] / 8)
	local LJ = 0
	LJ = (LJ1 + LJ2 + LJ3) / 2
	
	--?????????¡ì?????¨¦???¡Â??????????¡ã????????¡è¡¦??????¨¹?????????¨®?????¡Â??+70%
	if match_ID(pid, 6) or match_ID(pid, 67) or match_ID(pid, 71) or match_ID(pid, 18)  or match_ID(pid, 594) or JXPD(pid, 35, 2) then
		LJ = LJ + (100 - LJ) * 0.7
	end
	--??¡Á?????100%??????????0??100%????
	if match_ID(pid, 586) or match_ID(pid, 9792) then
	local HZDLJ = 0
	HZDLJ = (1-JY.Person[pid]["?¨²?¨¹"] / JY.Person[pid]["?¨²?¨¹¡Á??¨®??"])*100
	LJ = LJ + HZDLJ
	end		
	
	if (match_ID(pid, 152) or match_ID(pid, 9837)) and JY.Person[pid]["?¨²?¨¹"] < JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] / 4 then
		LJ = LJ * 3
    elseif (match_ID(pid, 152) or match_ID(pid, 9837)) and JY.Person[pid]["?¨²?¨¹"] < JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] / 2 then
		LJ = LJ * 2
    end	
	--??¡ã??????¡Â+50% ????????
    if match_ID(pid, 189) or match_ID(pid, 9996) then
	   LJ = LJ +(100-LJ)*0.5
	end
	--?¨§????¡¦¨§
	if WGZH(pid,54,62) then
		LJ = LJ +(100-LJ)*0.3
	end
	--???¡Â?????????????¡Â+2.5%
	--¡ã??¡§?????¡Â???¨½???????????¡ì?¨§??¡¦???????????????????????????????????¡¦???????¡¦?, ????
	local ljup = {10, 15, 42, 31, 54, 60, 68, 76, 79, 114, 124, 131, 139}
	for i = 1, JY.Base["????????"] do
		if JY.Person[pid]["????" .. i] > 0 then
			for ii = 1, #ljup do
				if JY.Person[pid]["????" .. i] == ljup[ii] then
					LJ = LJ + (100 - LJ) * 0.025
				end
			end
		else
			break;
		end
	end
	
	--???????????¡Â+5%   
    if PersonKF(pid,47) then 
        LJ = LJ + (100 - LJ) * 0.05
    end

	--?????¨¾????????????+50%
	if pid == 0 and JY.Person[605]["????????"] == 1 then
		LJ = LJ + (100 - LJ) * 0.5
	end
	
	--????????40??+1%
	local jp = JY.Person[pid]["????"] / 4000
	LJ = LJ + (100 - LJ) * jp
	
	
	--?¡Â??????+50% 
	if  Curr_NG(pid, 107) and (JY.Person[pid]["????????"] == 0 or JY.Person[pid]["????????"] == 3 ) then
		LJ = LJ + (100 - LJ) * 0.5
    end
    
	--???????? ???¡Â??+30%
	if WGZH(pid,39,42) == true then
		LJ = LJ + (100 - LJ) * 0.3
	end
	--?¡Â???? ???¡Â??+10%
	if JY.Person[pid]["???¡Â"]  == 38 then
		LJ = LJ + (100 - LJ) * (JY.Thing[38]["¡Á¡ã??????"]/10 -0.1)
	end	 

	--?????¨¾ ?¨½???????????¡Â??+30%
	if match_ID(pid,649) and WAR.YLSJJ == 1 and JY.Status == GAME_WMAP then
		LJ = LJ + (100 - LJ) * 0.3
    end

	--???????? ?????????¡Â??+20%
	 if Curr_QG(pid,223) then
		LJ = LJ + (100 - LJ) * 0.2
    end		
    
	--??????????????????10%
    if JY.Status == GAME_WMAP then
		for wid = 0, WAR.PersonNum - 1 do
			if match_ID(WAR.Person[wid]["????????"], 607) and WAR.Person[wid]["????"] == false and WAR.Person[wid]["??¡¦?"] then
				LJ = LJ + (100 - LJ) * 0.1
				break
			end
		end
	end
	
	--????????????????¡¦????????????????¡Â??3??
    if match_ID(pid, 152) and JY.Person[pid]["?¨²?¨¹"] < JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] / 4 then
		LJ = LJ * 3
    --????????????????¡¦??????????????¡Â??2??
    elseif match_ID(pid, 152) and JY.Person[pid]["?¨²?¨¹"] < JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] / 2 then
		LJ = LJ * 2
    end

	--??¡¦???¡ã????????? ?????¡Â
	if match_ID(pid, 27) or match_ID(pid, 112)  then
		LJ = 100
	end
	--????¡ã?¡¦¡§
	for i = 1, JY.Base["????????"] do
	    if JY.Person[pid]["????" .. i] == 181 then
		    local dfjc = 0
		    for i = 1,JY.Base['????????'] do
			    if JY.Wugong[JY.Person[pid]['????'.. i]]['????????'] == 4 and JY.Person[pid]["????????" .. i] == 999 then
				   dfjc = dfjc + 1
			    end
			    if dfjc >= 8 then				
			       LJ = LJ + (100 - LJ) *dfjc*0.01
			      break
			    end
		    end
		end  
	end 	
    if match_ID(pid, 9965) then 
        LJ = LJ * 0.2
        if JY.Status == GAME_WMAP then 
            if WAR.LQZ[pid] == 100 then 
                LJ = 100
            end
        end
    end
    --?¡è¡ã????????¡Â
	if MPTX(pid,2) then
		LJ = LJ + (100 - LJ) * 0.15
	end
	--?¡è¡ã????¡Â
	if MPPD(pid) == 2 and Curr_NG(pid,204) then
		local gblj = 0
		for j = 1 ,JY.Base['????????'] do
			if JY.Person[pid]["????"..j] == 26 or JY.Person[pid]["????"..j] == 80 then
				gblj = gblj + 10
			end
		end
		LJ = LJ + gblj 
	end	
	 
	--???¡Â??????1
    if LJ < 1 then
		LJ = 1
    end
	
	--????
	LJ = math.modf(LJ)
	
	return LJ
end

--?????????????¡§???¡Â??
function Person_BJ(pid)
    --???????????????????????¡Â??
    local BJ1 = math.modf(JY.Person[pid]["???¡Â??"] / 80)
    local BJ2 = math.modf((JY.Person[pid]["????¡Á??¨®??"] + JY.Person[pid]["????"] * 2) / 3000)
    local BJ3 = math.modf(JY.Person[pid]["????"] / 10)
    local BJ = 0
    BJ = (BJ1 + BJ2 + BJ3) / 2

    --???¡Â?????????????¡Â+2.5%
	--???????¨®?????????????????????????????????¨¢???¨¹?????????¡Á?????????????¡è???¨²???¡Â????????
    local bjup = {18, 22, 39, 40, 56, 65, 71, 78, 74, 61, 21, 121, 17}
    for i = 1, JY.Base["????????"] do
		if JY.Person[pid]["????" .. i] > 0 then
			for ii = 1, #bjup do
				if JY.Person[pid]["????" .. i] == bjup[ii] then
					BJ = BJ + (100 - BJ) * 0.025
				end
			end
		else
			break;
		end
    end

	  
	--????????40??+1%
	local jp = JY.Person[pid]["????"] / 4000
	BJ = BJ + (100 - BJ) * jp

    --??????¡Á??????¡ì?????¨¦???¡Â???????????¨½??¡Á????????¡Â??+70%
    if match_ID(pid, 97) or match_ID(pid, 67) or match_ID(pid, 71) or match_ID(pid, 26) or match_ID(pid, 184) then
		BJ = BJ + (100 - BJ) * 0.7
    end
	--????¡ã?¡¦¡§???¡Â??+5%   
    if PersonKF(pid,181) then 
        local dfjc = 0
        for i = 1, JY.Base["????????"] do
            if JY.Wugong[JY.Person[pid]['????'.. i]]['????????'] == 4  and JY.Person[pid]['????????'.. i] == 999 then
              dfjc = dfjc + 1
            end
        end	
        if dfjc >= 8  then
            BJ = BJ + (100 - BJ) * dfjc*0.01
        end
    end
    if MPPD(pid) == 6 then
		if Curr_NG(pid,103) then
			BJ = BJ + (100 - BJ) * 0.4
		else
			BJ = BJ + (100 - BJ) * 0.2
		end
	end	
	--??????????¡ã??? ???¡Â??+50%
    if match_ID(pid, 54) or match_ID(pid, 189)then
		BJ = BJ + (100 - BJ) * 0.5
    end
    --??¡Á????¡ì???¡Â?¨¢??
	if ShiZunXM(pid) == true then
		BJ = BJ + (100 - BJ) * 0.5
	end
	--?????? ???¡Â??+30%
    if match_ID(pid, 580) then
		BJ = BJ + (100 - BJ) * 0.3
    end	
    if PersonKF(pid,247) then
    	if Curr_NG(pid,247) then
    		if PersonKF(pid,242) then
    			BJ = BJ + (BJ*0.7)
    		else
    			BJ = BJ + (100 - BJ) * 0.4	
    		end	
    	else
    		BJ = BJ + (100 - BJ) * 0.2
    	end
    end			
	-- --?????? ???¡Â??+30%
    -- if match_ID(pid, 580) then
		-- BJ = BJ + (100 - BJ) * 0.3
    -- end		
	--?????? ????????
       if Curr_QG(pid,223) then
		BJ = BJ + (100 - BJ) * 0.2
       end
	--??¡Á?????100%??????????0??100%????
	if match_ID(pid, 586) or match_ID(pid,9793) then
		local HZDBJ = 0
		HZDBJ = (1-JY.Person[pid]["?¨²?¨¹"] / JY.Person[pid]["?¨²?¨¹¡Á??¨®??"])*100
		BJ = BJ + HZDBJ
	end	
    --????????????????¡¦????????????????¡Â??3??
    if (match_ID(pid, 58) or match_ID(pid, 9791)) and JY.Person[pid]["?¨²?¨¹"] < JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] / 4 then
		BJ = BJ * 3
    --????????????????¡¦??????????????¡Â??2??
    elseif (match_ID(pid, 58) or match_ID(pid, 9791)) and JY.Person[pid]["?¨²?¨¹"] < JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] / 2 then
		BJ = BJ * 2
    end
	--?¡Â??????+50%
	if Curr_NG(pid, 104) then
	    BJ = BJ + (100 - BJ) * 0.5
    elseif PersonKF(pid,107) then
		BJ = BJ + (100 - BJ) * 0.3
	end
	--????
	if match_ID(pid, 578) then
        local df = 0
        for i = 1, JY.Base["????????"] do
            if JY.Wugong[JY.Person[0]["????" .. i]]["????????"] == 4 and JY.Person[0]["????????" .. i] == 999 then
                df = df + 1
                if df > 8 then
                    df = 8
                end
            end
            BJ = BJ + (100 - BJ) *df*0.05
        end
    end
	--??¡¦??????????????????????¡Â
    if match_ID(pid, 50) or match_ID(pid, 6) or match_ID(pid, 112) then
		BJ = 100
    end
	--?????¡Â
	if MPPD(pid) == 11 then
		BJ = BJ + (100 - BJ) * 0.5
		if match_ID(pid,741) or match_ID(pid,742) then --????
		    BJ = 100
	    end	 
	end
	--????????1
	if MPPD(pid) == 9 then 
	    BJ = BJ + (100 - BJ) * 0.4
    end
	--???????¡¦????????????
	if JY.Status == GAME_WMAP then
		--?¡¦??¡¦? ????¡Á??????????¡Â
		if match_ID(pid, 60) and WAR.tmp[1000+pid] == 1 then
			BJ = 100
		end
		if PersonKF(pid, 180) and WAR.PD["?¡§??????"][pid] ~= nil and WAR.PD["?¡§??????"][pid] > 500 then
        	BJ = BJ + 100
    	end	
		--???????¨§?¨¢?¡ì??
		if Curr_QG(pid,223) and TFQG(pid,223) then
			BJ = BJ + math.modf(WAR.YDBS*2)
		end	
	end
	
	--???¡Â??????1
    if BJ < 1 then
		BJ = 1
    end
	
	--????
	BJ = math.modf(BJ)
	
	return BJ
end

--??????????¡¦??????????¡ì??????????
function Num_of_Neigong(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if kfid > 0 and JY.Wugong[kfid]["????????"] == 6 then
			num = num + 1
		end
	end
	return num
end

--???????????????????????????¡§
function TrueQZ(id)
    local qz = JY.Person[id]["??????¡¦¨¾"]
    if JY.Status == GAME_WMAP and match_ID(9947,id) then 
        for i = 1, JY.Base["????????"] do
            if JY.Wugong[JY.Person[id]["????" .. i]]["????????"] == 6 then
                qz = qz + 30
            end
        end
    end
	--???????¡Á
	if JY.Status == GAME_WMAP and JY.Person[id]["???¡Â"] == 239 then
		local add = 10
		if JY.Thing[239]["¡Á¡ã??????"] >= 5 then
			add = 30
		elseif JY.Thing[239]["¡Á¡ã??????"] >= 4 then
			add = 25
		elseif JY.Thing[239]["¡Á¡ã??????"] >= 3 then
			add = 20
		elseif JY.Thing[239]["¡Á¡ã??????"] >= 2 then
			add = 15
		end
		qz = qz + add
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["???¡Â"] > 0 and JY.Person[id]["???¡Â"] ~= 239 then
		local n = JY.Person[id]["???¡Â"]
		local m = JY.Thing[n]["¡Á¡ã??????"]
		local o = 20
		if NGQH(id,203) then
			o = 40
		end	
		if m >= 2 then
			qz = qz + JY.Thing[n]["????????¡¦¨¾"]*o
		end
	end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['????'] == false then
				local jid = WAR.Person[j]["????????"]
				if psx(jid,"??????¡¦¨¾") > a then
					a = psx(jid,"??????¡¦¨¾")
				end
			end
		end
	    qz = a + JY.Base["????"]*3
	end	
	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == false  then
				df = df +1
			end          
	    end	
		 qz = qz + df * 5		
	end
	
	if JY.Status == GAME_WMAP and JY.Base["????"]>0 then
		qz=qz+JY.Base["????"]*2
	end		
	--??????????????*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		qz = qz + math.modf(qz*0.4)
	end
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'?¡¦??')*0.01
		qz = qz + math.modf(qz*dd)
	end
	if JY.Status == GAME_WMAP and WAR.PD['???¨²?¨§??'][id] ~= nil then
		qz = qz - 500
	end
	if JY.Status == GAME_WMAP and (WAR.PD['?¡Á??????'][id] == 1 or WAR.PD['?¡Á??????'][id] == 5)  then
		qz = qz - psx(id,'??¡¦?????')
	end
	if JY.Status == GAME_WMAP and WAR.PD['?¨¹????'][id] ~= nil then
		qz = math.modf(qz*0.05)
	end
	if JY.Status == GAME_WMAP and WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
		qz = qz - (WAR.PD['????????'][id] or 0) * 9
	end
	if qz < 0 then qz = 0 end
	return qz
end

--????????????????¡¦¡§?????????¡§
function TrueZF(id)
    local zf = JY.Person[id]["??¡¦¡§????"]
    
	if JY.Status == GAME_WMAP and JY.Person[id]["???¡Â"] > 0 and JY.Person[id]["???¡Â"] ~= 239 then
		local n = JY.Person[id]["???¡Â"]
		local m = JY.Thing[n]["¡Á¡ã??????"]
		local o = 20
		if NGQH(id,203) then
			o = 40
		end	
		if m >= 2 then
			zf = zf + JY.Thing[n]["????¡¦¡§????"]*o
		end
	end
	
    if JY.Status == GAME_WMAP and match_ID(9947,id) then 
        for i = 1, JY.Base["????????"] do
            if JY.Wugong[JY.Person[id]["????" .. i]]["????????"] == 6 then
                zf = zf + 30
            end
        end
    end
	--???????¡Á
	if JY.Status == GAME_WMAP and JY.Person[id]["???¡Â"] == 239 then
		local add = 10
		if JY.Thing[239]["¡Á¡ã??????"] >= 5 then
			add = 30
		elseif JY.Thing[239]["¡Á¡ã??????"] >= 4 then
			add = 25
		elseif JY.Thing[239]["¡Á¡ã??????"] >= 3 then
			add = 20
		elseif JY.Thing[239]["¡Á¡ã??????"] >= 2 then
			add = 15
		end
		zf = zf + add
	end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['????'] == false then
				local jid = WAR.Person[j]["????????"]
				if psx(jid,"??¡¦¡§????") > a then
					a = psx(jid,"??¡¦¡§????")
				end
			end
		end
		zf = a + JY.Base["????"]*3
	end	
	
	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == false  then
				df = df +1
			end         	
	    end	
		 zf = zf + df * 5	
	end
	if JY.Status == GAME_WMAP and JY.Base["????"]>0 then
		zf=zf+JY.Base["????"]*2
	end	
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'?¡¦??')*0.01
		zf = zf + math.modf(zf*dd)
	end	
	
	--??????????????*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		zf = zf + math.modf(zf*0.4)
	end
	if JY.Status == GAME_WMAP and WAR.PD['???¨²?¨§??'][id] ~= nil then
		zf = zf - 500
	end
	if JY.Status == GAME_WMAP and WAR.PD['?¨¹????'][id] ~= nil then
		zf = math.modf(zf*0.05)
	end
	if JY.Status == GAME_WMAP and WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
		zf = zf - (WAR.PD['????????'][id] or 0) * 9
	end
	if zf < 0 then zf = 0 end
	return zf
end

--???????????????????????????¡§
function TrueYJ(id)
	local yj = JY.Person[id]["????????"]
	
	local o = 20
	if NGQH(id,203) then
		o = 40
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["???¡Â"] > 0 then
		local n = JY.Person[id]["???¡Â"]
		local m = JY.Thing[n]["¡Á¡ã??????"]
		if m >= 2 then
			yj = yj + JY.Thing[n]["??????????"] * o
		end
	end
	
	--??????¡¦¡§
	if JY.Status == GAME_WMAP and WuyueJFSL(id)>0 then
		yj = yj + WuyueJFSL(id)*20
    end
	
	if JY.Status == GAME_WMAP and match_ID(9947,id) then 
        for i = 1, JY.Base["????????"] do
            if JY.Wugong[JY.Person[id]["????" .. i]]["????????"] == 6 then
                yj = yj + 30
            end
        end
    end
	if JY.Status == GAME_WMAP and JY.Base["????"]>0 then
		yj=yj+JY.Base["????"]*2
	end
	
	
	--???¡¦????????
	if JY.Status == GAME_WMAP then
		--???¡§????
		if WAR.JDYJ[id] then
			yj = yj + WAR.JDYJ[id]
		end
	   	if match_ID(id, 508) then
		   	local df = 0
		   	for j = 0, WAR.PersonNum - 1 do
			   	if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == false  then
				   df = df +1
			   	end           	
	       	end	
			yj = yj + df * 5	
	   	end		
		--??????
        if match_ID(id, 584)  then
		    local JF = 0
		    for i = 1, JY.Base["????????"] do
			    if JY.Wugong[JY.Person[id]["????" .. i]]["????????"] == 3 then
				    JF = JF + 1
			    end
		    end
		    yj =yj + JF * 10
	    end
		if YaoFengHuoShi(id) then
			local a = 0
			for j = 0, WAR.PersonNum-1 do
				if WAR.Person[j]['????'] == false then
					local jid = WAR.Person[j]["????????"]
					if psx(jid,"????????") > a then
						a = psx(jid,"????????")
					end
				end
			end
			yj = a + JY.Base["????"]*3
		end	
		
		--??????????????*140%
		if PersonKF(id, 102) then
			yj = yj + math.modf(yj*0.4)
		end
		if ((PersonKF(id,139) and PersonKF(id,100) and PersonKF(id,154)) or match_ID(id,605)) and WAR.YNSX1 > 0 then
			yj = math.modf(yj*WAR.YNSX1)
		end	
		if ((PersonKF(id,39) and PersonKF(id,100)) or match_ID(id,129) or (match_ID(id,68) and MPPD(id) == 16)) and WAR.QZ_QXJF == 1 then
			yj = math.modf(yj*1.5)
		end
		if  Curr_NG(id,247) and PersonKF(id,242) then
			local dd = psx(id,'?¡¦??')*0.01
			yj = yj + math.modf(yj*dd)
		end
		if WAR.PD['???¨²?¨§??'][id] ~= nil then
			yj = yj - 500
		end
		if WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
			yj = yj - (WAR.PD['????????'][id] or 0) * 9
		end
		if WAR.PD['?¨¹????'][id] ~= nil then
			yj = math.modf(yj*0.05)
		end
	end
	if yj < 0 then yj = 0 end
	return yj
end

--???????????????????????????¡§
function TrueSD(id)
	local sd = JY.Person[id]["????????"]
	local o = 20
	if NGQH(id,203) then
		o = 40
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["???¡Â"] > 0 then
		local n = JY.Person[id]["???¡Â"]
		local m = JY.Thing[n]["¡Á¡ã??????"]
		if m >= 2 then
			sd = sd + JY.Thing[n]["??????????"] * o
		end
	end
	
	
    if JY.Status == GAME_WMAP and match_ID(9947,id) then  
        for i = 1, JY.Base["????????"] do
            if JY.Wugong[JY.Person[id]["????" .. i]]["????????"] == 6 then
                sd = sd + 30
            end
        end
    end
	
	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
		    if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == false  then
				df = df +1
			end         
		end	
		sd = sd + df * 5	
	end	
	if JY.Status == GAME_WMAP and JY.Base["????"]>0 then
		sd=sd+JY.Base["????"]*2
	end
	--??????????????*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		sd = sd + math.modf(sd*0.4)
    end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['????'] == false then
				local jid = WAR.Person[j]["????????"]
				if psx(jid,"????????") > a then
					a = psx(jid,"????????")
				end
			end
		end
		sd = a + JY.Base["????"]*3
	end	
	if JY.Status == GAME_WMAP and PersonKF(id,335) and PersonKF(id,203) and PersonKF(id,181) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['????'] == false then
				local jid = WAR.Person[j]["????????"]
				if psx(jid,"????????") > a then
					a = psx(jid,"????????")
				end
			end
		end
		sd = sd + a + JY.Base["????"]*2
	end
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'?¡¦??')*0.01
		sd = sd + math.modf(sd*dd)
	end
	if JY.Status == GAME_WMAP and WAR.PD['???¨²?¨§??'][id] ~= nil then
		sd = sd - 500
	end
	if JY.Status == GAME_WMAP and WAR.PD['??????'][id] ~= nil and WAR.PD['??????'][id] > 0 then
		sd = sd - (WAR.PD['??????'][id] or 0) * 100
	end
	if JY.Status == GAME_WMAP and (WAR.PD['?¡Á??????'][id] == 1 or WAR.PD['?¡Á??????'][id] == 5)  then
		sd = sd - psx(id,'??¡¦?????')
	end	
	if JY.Status == GAME_WMAP and WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
		sd = sd - (WAR.PD['????????'][id] or 0) * 9
	end
	if JY.Status == GAME_WMAP and WAR.PD['?¨¹????'][id] ~= nil then
		sd = math.modf(sd*0.05)
	end
	if sd < 0 then sd = 0 end
	return sd
end

--???????????????????????????¡§
function TrueTS(id)
	local ts = JY.Person[id]["???????¡Â"]
	local o = 20
	if NGQH(id,203) then
		o = 40
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["???¡Â"] > 0 then
		local n = JY.Person[id]["???¡Â"]
		local m = JY.Thing[n]["¡Á¡ã??????"]
		if m >= 2 then
			ts = ts + JY.Thing[n]["?????????¡Â"]*o
		end
	end
	
    if JY.Status == GAME_WMAP and match_ID(9947,id) then
        for i = 1, JY.Base["????????"] do
            if JY.Wugong[JY.Person[id]["????" .. i]]["????????"] == 6 then
                ts = ts + 30
            end
        end
    end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['????'] == false then
				local jid = WAR.Person[j]["????????"]
				if psx(jid,"???????¡Â") > a then
					a = psx(jid,"???????¡Â")
				end
			end
		end
		ts = a + JY.Base["????"]*3
	end	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
		    if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == false then
				   df = df +1
			   end          	
	       end
        ts = ts + df * 5		
	end
	if JY.Status == GAME_WMAP and JY.Base["????"]>0 then
		ts=ts+JY.Base["????"]*2
	end	
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'?¡¦??')*0.01
		ts = ts + math.modf(ts*dd)
	end
	--??????????????*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		ts = ts + math.modf(ts*0.4)
    end
	if JY.Status == GAME_WMAP and WAR.PD['???¨²?¨§??'][id] ~= nil then
		ts = ts - 500
	end
	if JY.Status == GAME_WMAP and WAR.PD['????????'][id] ~= nil and WAR.PD['????????'][id] > 0 then
		ts = ts - (WAR.PD['????????'][id] or 0) * 9
	end
	if JY.Status == GAME_WMAP and WAR.PD['?¨¹????'][id] ~= nil then
		ts = math.modf(ts*0.05)
	end
	if JY.Status == GAME_WMAP and WAR.PD['??¡Á???????'][id] == 3 then
		ts = 6666
	end	
	if ts < 0 then ts = 0 end
	return ts
end

--??¡¦????? ?¡Â?????????¨¾
function Menu_TZDY()
   local menu = {}
   local px={}
   local m=0
   --????????2?????¨¢?¨²?¡ì
   if JY.Base["???¨¦" .. 3]>0 then
		Cls()
		DrawStrBox(CC.MainMenuX,CC.MainSubMenuY,"?????¡Â??????????",LimeGreen,CC.DefaultFont,C_GOLD);
		local nexty=CC.MainSubMenuY+CC.SingleLineHeight;
		for i=1,CC.TeamNum do
			menu[i]={"",nil,0};
			local id=JY.Base["???¨¦" .. i]
			if id>0 then
				menu[i]={"",nil,0};
				if JY.Person[id]["?¨²?¨¹"]>0 then
					menu[i][1]=JY.Person[id]["????"];
					menu[i][3]=1;
				end
			end
		end  
   
		local r = -1;
		while true do
			r = ShowMenu(menu,#menu,0,CC.MainMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE)
			if px["??????"]==nil and r>1 then
				px["??????"]=r
				menu[r]={"",nil,0}
				Cls()
				DrawStrBox(CC.MainMenuX,CC.MainSubMenuY,JY.Person[JY.Base["???¨¦" .. r]]["????"].."????????????",LimeGreen,CC.DefaultFont,C_GOLD);
			elseif r>1 and px["??????"]~=nil and r ~=px["??????"] then	
				local m1=JY.Base["???¨¦" .. r]
				local m2=JY.Base["???¨¦" .. px["??????"]]
				JY.Base["???¨¦" .. r]=m2
				JY.Base["???¨¦" .. px["??????"]]=m1
				say("??"..JY.Person[m2]["????"].."?¡Á ?? ??"..JY.Person[m1]["????"].."?¡Á ????????????",m2,1)
				Cls()
				--return
				break
			--??????????????ESC????????
			else
				break
			end
		end
	end
end

--??????????????????
function DrawSingleLine(x1, y1, x2, y2, color)
	lib.DrawRect(x1 + 1, y1 + 1, x2, y2, color)
	lib.DrawRect(x1, y1, x2 - 1, y2 - 1, color)
end

--?????¨§??
function SetTianWai(personid, x, wugongid)
	--local r = JYMsgBox("???¨§??????","??¡¦¨½?????¨§??????"..x.."??"..JY.Wugong[wugongid]["????"].."??", {"??","¡¦¨½"}, 2, 189)				
	--if r == 1 then
		JY.Person[personid]["?¨§??????"..x] = wugongid
		if personid == JY.Base["????"] then
			JY.Person[0]["?¨§??????"..x] = wugongid
		end	
	--elseif r == 2 then
	--end
end

--?????¨§??
function SetTianNei(personid, wugongid)
	JY.Person[personid]["?¨§??????"] = wugongid
	if personid == JY.Base["????"] then
		JY.Person[0]["?¨§??????"] = wugongid
	end	
end

--?????¨§?¨¢
function SetTianQing(personid, wugongid)
	JY.Person[personid]["?¨§???¨¢??"] = wugongid
	if personid == JY.Base["????"] then
		JY.Person[0]["?¨§???¨¢??"] = wugongid
	end	
end

--?¡ì?¨¢????
function SetHuBo(personid)
	JY.Person[personid]["¡Á¨®??????"] = 1
	if personid == JY.Base["????"] and personid~=152 then
		JY.Person[0]["¡Á¨®??????"] = 1
	end
end

--???????????¡ì?????¡§???????¡§??
function Sanwei_sum(id)
	local sum = 0
	sum = sum + JY.Person[id]["?¨¢??"]
	sum = sum + JY.Person[id]["¡¦?????"]
	sum = sum + JY.Person[id]["???¡Â??"]
	return sum
end

--???????????????¡Â??????
function Xishu_sum(id)
	local sum = 0
	sum = sum + TrueQZ(id)
	sum = sum + TrueZF(id)
	sum = sum + TrueYJ(id)
	sum = sum + TrueSD(id)
	sum = sum + TrueTS(id)
	return sum
end

--?¨®???????????¡Â??¡Á?????????
function Xishu_max(id)
	local m = 0
	local xishu = {TrueQZ,TrueZF,TrueYJ,TrueSD,TrueTS}
	for i = 1, #xishu do
		local x = xishu[i](id)
		if x > m then
			m = x
		end
	end
	return m
end

--????¡ã????¡ã??
function Clipped_BgImg(x1,y1,x2,y2,picnum)
	lib.SetClip(x1 + 2, y1 + 2, x2 - 1, y2 - 1)
	lib.LoadPNG(1, picnum * 2 , 0 , 0, 1)
	lib.SetClip(0,0,0,0)
end

--?????????¨¾????¡Á?
function DrawBoxTitle(width, height, str, color)
	local s = 4
	local x1, y1, x2, y2, tx1, tx2 = nil, nil, nil, nil, nil, nil
	local fontsize = s + CC.DefaultFont
	local len = string.len(str) * fontsize / 2
	x1 = (CC.ScreenW - width) / 2
	x2 = (CC.ScreenW + width) / 2
	y1 = (CC.ScreenH - height) / 2
	y2 = (CC.ScreenH + height) / 2
	tx1 = (CC.ScreenW - len) / 2
	tx2 = (CC.ScreenW + len) / 2
	lib.Background(x1, y1 + s, x1 + s, y2 - s, 128)
	lib.Background(x1 + s, y1, x2 - s, y2, 128)
	lib.Background(x2 - s, y1 + s, x2, y2 - s, 128)
	lib.Background(tx1, y1 - fontsize / 2 + s, tx2, y1, 128)
	lib.Background(tx1 + s, y1 - fontsize / 2, tx2 - s, y1 - fontsize / 2 + s, 128)
	local r, g, b = GetRGB(color)
	DrawBoxTitle_sub(x1 + 1, y1 + 1, x2, y2, tx1 + 1, y1 - fontsize / 2 + 1, tx2, y1 + fontsize / 2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
	DrawBoxTitle_sub(x1, y1, x2 - 1, y2 - 1, tx1, y1 - fontsize / 2, tx2 - 1, y1 + fontsize / 2 - 1, color)
	DrawString(tx1 + 2 * s, y1 - (fontsize - s) / 2, str, color, CC.DefaultFont)
end

--????????????¡ã????????¡ã
function DrawShades(x1,y1,x2,y2,color)
	local s=4;
	lib.Background(x1+4,y1,x2-4,y1+s,128,color);
	lib.Background(x1+1,y1+1,x1+s,y1+s,128,color);
	lib.Background(x2-s,y1+1,x2-1,y1+s,128,color);
	lib.Background(x1,y1+4,x2,y2-4,128,color);
	lib.Background(x1+1,y2-s,x1+s,y2-1,128,color);
	lib.Background(x2-s,y2-s,x2-1,y2-1,128,color);
	lib.Background(x1+4,y2-s,x2-4,y2,128,color);
end

--???¡¦???????¡Â
function detailed_info(thingID)
	local str=JY.Thing[thingID]["?¨²??"] .. JY.Thing[thingID]["????"]
	local str2=JY.Thing[thingID]["???¡¦???¡Â"]
	local str3=JY.Thing[thingID]["????"]	
	if ItemInfo[thingID]==nil then
		return
	end
	local info = {}
	info = ItemInfo[thingID]
	local function strcolor_switch(s)
		local Color_Switch={{"??",PinkRed},{"??",C_GOLD},{"??",C_BLACK},{"?¡Á",C_WHITE},{"??",C_ORANGE},{"??",LimeGreen},{"??",M_DeepSkyBlue},{"??",Violet}}
		for i = 1, 8 do
			if Color_Switch[i][1] == s then
				return Color_Switch[i][2]
			end
		end
	end
	local maxRowExisting = #info		--???¡ã???¡Â¡Á?????
	local maxRowDisplayable = 7		--??????????????????¡Á??¨®????
	if maxRowDisplayable > maxRowExisting-1 then
		maxRowDisplayable = maxRowExisting -1 
	end
	local startingRow = 1
	local size = CC.Fontsmall
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls()
		lib.LoadPNG(91, 30 * 2 , 0 , 0, 1)
		DrawString(CC.ScreenW/2,14.5,str3,C_GOLD,CC.ThingFontSize)
		DrawString(22,64.5,str2,C_ORANGE,CC.ThingFontSize)
		local row = 1
		for i = startingRow, startingRow+maxRowDisplayable do
			local tfstr = info[i]
			if string.sub(tfstr,1,2) == "??"  then
				row = row + 0.5
			else
				if string.sub(tfstr,1,2) == "?¡Á" then
					row = row +0.5
				end	
				local color;
				color = strcolor_switch(string.sub(tfstr,1,2))
				tfstr = string.sub(tfstr,3,-1)
				--DrawString(22, 80 + (size+CC.RowPixel*2) * (row), tfstr, color, size)
				tjm(22,80 + ((size*1)+CC.RowPixel*2) * (row),tfstr,color, size,45,size+3)
				--F1
				row = row + 1
			end
		end
		
		--?¨¦???¡Á¡Á¡ã
		if thingID > 547 then
			local n = (thingID - 547)%3
			--say("n??????"..n,0,1)
			if n == 1 then
				n = 0
			elseif n==2 then
				n=1
			else
				n=2
			end
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+1), Xguo[Setmeal[thingID-n][4]], M_YellowGreen, size)
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+2), FJXguo[Setmeal[thingID-n][5]], M_YellowGreen, size)
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+3), ZqXguo[Setmeal[thingID-n][6]], M_YellowGreen, size)	
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+4), CC.PTFSM[Setmeal[thingID-n][7]][2], C_RED, size)	

			
		end
		
		
		--????¡¦??????¡¦????
		if startingRow > 1 then
			DrawString(CC.ScreenW-40, 110, "?¨¹", C_GOLD, size)
		end
		if startingRow+maxRowDisplayable < maxRowExisting then
			DrawString(CC.ScreenW-40, CC.ScreenH-140, "??", C_GOLD, size)
		end
		DrawString(CC.ScreenW-220,CC.ScreenH-40, "¡ã?F1¡¦??????¡¦????", C_ORANGE,size)
		ShowScreen()
		local keypress, ktype, mx, my = WaitKey(1)
		if keypress==VK_ESCAPE or keypress==VK_RETURN or keypress==VK_F1 or ktype == 4 then
			return
		elseif keypress==VK_UP and startingRow > 1 then
			startingRow = startingRow - 1
		elseif keypress==VK_DOWN and startingRow+maxRowDisplayable < maxRowExisting then
			startingRow = startingRow + 1
		end
	end
end

--???????¡Â
function mp_info(MPID)
	-- local str=JY.Thing[thingID]["?¨²??"] .. JY.Thing[thingID]["????"]
	-- local str2=JY.Thing[thingID]["???¡¦???¡Â"]
	-- local str3=JY.Thing[thingID]["????"]	
	-- if ItemInfo[thingID]==nil then
		-- return
	-- end
	--local info = {}
	--info = ItemInfo[thingID]
	-- local function strcolor_switch(s)
		-- local Color_Switch={{"??",PinkRed},{"??",C_GOLD},{"??",C_BLACK},{"?¡Á",C_WHITE},{"??",C_ORANGE},{"??",LimeGreen},{"??",M_DeepSkyBlue},{"??",Violet}}
		-- for i = 1, 8 do
			-- if Color_Switch[i][1] == s then
				-- return Color_Switch[i][2]
			-- end
		-- end
	-- end
	-- local maxRowExisting = #info		--???¡ã???¡Â¡Á?????
	-- local maxRowDisplayable = 11		--??????????????????¡Á??¨®????
	-- if maxRowDisplayable > maxRowExisting-1 then
		-- maxRowDisplayable = maxRowExisting-1
	-- end
	-- local startingRow = 1
	--local Color_Switch={{"??",PinkRed},{"??",C_GOLD},{"??",C_BLACK},{"?¡Á",C_WHITE},{"??",C_ORANGE},{"??",LimeGreen},{"??",M_DeepSkyBlue},{"??",Violet}}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	local size = CC.Fontsmall
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls()
		lib.LoadPNG(91, 30 * 2 , 0 , 0, 1)
		DrawString(CC.ScreenW/2,14.5,"???????¡Â",C_GOLD,CC.ThingFontSize)
		--DrawString(22,64.5,"????????",C_ORANGE,CC.ThingFontSize)
		DrawString(22,64.5,CC.MP[MPID][1],C_ORANGE,CC.ThingFontSize)
		DrawString(22,64.5+25,"?????¨¦??",C_ORANGE,CC.ThingFontSize)
		
		local zsqg = "??"..CC.MPINFO[MPID]		
		tjm(22,64.5+50,zsqg,C_WHITE,size,33,size)
		
		DrawString(22,64.5+50+80,"???????¡Á",C_ORANGE,CC.ThingFontSize)
		-- DrawString(22,64.5+50+200,CC.MPDJ[MPID][1],C_ORANGE,CC.ThingFontSize)
		-- DrawString(22+120,64.5+50+200,CC.MPDJ[MPID][2],C_ORANGE,CC.ThingFontSize)
		-- DrawString(22+240,64.5+50+200,CC.MPDJ[MPID][3],C_ORANGE,CC.ThingFontSize)
		for i=1,#CC.MPDJ[MPID] do 
			DrawString(22+(i-1)*120,64.5+50+110,CC.MPDJ[MPID][i],M_DeepSkyBlue,CC.ThingFontSize)
		end
		
		--DrawString(22,64.5+50+250,"????????",C_ORANGE,CC.ThingFontSize)
		DrawString(22,64.5+50+140,CC.MPSUBMENU[MPID],PinkRed,CC.ThingFontSize*0.8)
		--tjm(22,64.5+50+140,CC.MPSUBMENU[MPID],C_WHITE,size,45,size)
		--DrawString(22,64.5+50+150,"????????",C_ORANGE,CC.ThingFontSize)
		
		--CC.MPDJ
		--DrawString(22,64.5+50+380,"???????????? ??"..CC.MPINFO2[MPID],C_ORANGE,CC.ThingFontSize)
		local zsqg = "?????????? ??"..CC.MPINFO2[MPID]
		tjm(22,64.5+50+170,zsqg,C_WHITE,size*0.8,45,size)
		DrawString(22,64.5+50+210,"?????¨¦??",C_ORANGE,CC.ThingFontSize)
		for i = 1,#CC.SKILLNAME[MPID] do
			local zsqg = "??"..CC.SKILLNAME[MPID][i].." "..CC.SKILLINFO[MPID][i]
			tjm(22,64.5+50+250+(i-1)*50,zsqg,C_WHITE,size*0.8,45,size)
		end
		-- CC.MP
		-- local row = 1
		-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row+1), Xguo[Setmeal[thingID-n][4]], M_YellowGreen, size)
		-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row+2), FJXguo[Setmeal[thingID-n][5]], M_YellowGreen, size)
		-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row+3), ZqXguo[Setmeal[thingID-n][6]], M_YellowGreen, size)	
		
		-- local row = 1
		-- for i = startingRow, startingRow+maxRowDisplayable do
			-- local tfstr = info[i]
			-- if string.sub(tfstr,1,2) == "??" then
				-- row = row + 1
			-- else
				-- local color;
				-- color = strcolor_switch(string.sub(tfstr,1,2))
				-- tfstr = string.sub(tfstr,3,-1)
				-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row), tfstr, color, size)
				-- row = row + 1
			-- end
		-- end
		
		--?¨¦???¡Á¡Á¡ã
		 --if thingID > 547 then
			-- local n = (thingID - 547)%3
			-- --say("n??????"..n,0,1)
			 --if n == 1 then
				-- n = 0
			 --elseif n==2 then
				-- n=1
			 --else
				-- n=2
			 --end
			 --DrawString(22, 80 + (size+CC.RowPixel*2) * (row+1), Xguo[Setmeal[thingID-n][4]], M_YellowGreen, size)
			 --DrawString(22, 80 + (size+CC.RowPixel*2) * (row+2), FJXguo[Setmeal[thingID-n][5]], M_YellowGreen, size)
			 --DrawString(22, 80 + (size+CC.RowPixel*2) * (row+3), ZqXguo[Setmeal[thingID-n][6]], M_YellowGreen, size)			
		 --end
		
		
		--????¡¦??????¡¦????
		-- if startingRow > 1 then
			-- DrawString(CC.ScreenW-40, 110, "?¨¹", C_GOLD, size)
		-- end
		-- if startingRow+maxRowDisplayable < maxRowExisting then
			-- DrawString(CC.ScreenW-40, CC.ScreenH-140, "??", C_GOLD, size)
		-- end
		-- DrawString(CC.ScreenW-220,CC.ScreenH-40, "¡ã?F1¡¦??????¡¦????", C_ORANGE,size)
		ShowScreen()
		local keypress, ktype, mx, my = WaitKey(1)
		if keypress==VK_ESCAPE or keypress==VK_RETURN or keypress==VK_F1 or ktype == 4 then
			return
		elseif keypress==VK_UP and MPID > 1 then
			MPID = MPID - 1
		elseif keypress==VK_DOWN and MPID+1 <= #CC.MP then
			MPID = MPID + 1
		end
	end
end

--??¡Á¡ã
function Avatar_Switch(id)
	--??????¡¦¨½????
	local Ani_id = id
	if id == 0 and JY.Base["????"] > 0 then
		Ani_id = JY.Base["????"]
	end
	if Avatar[Ani_id] == nil then
		return
	end
	local r = JYMsgBox("???¨¹??¡Á¡ã", "?????¨½"..JY.Person[id]["????"].."???¨§??", {Avatar[Ani_id][1].name,Avatar[Ani_id][2].name}, #Avatar[Ani_id], JY.Person[104]["?¡¦?¨½?¨²??"])
	JY.Person[id]["?¡¦?¨½?¨²??"] = Avatar[Ani_id][r].num
	JY.Person[id]["¡ã??¨ª?¨½"] = Avatar[Ani_id][r].num2
	for i = 1, 5 do
		JY.Person[id]["????????????" .. i] = Avatar[Ani_id][r].frameNum[i]
		JY.Person[id]["????????????" .. i] = Avatar[Ani_id][r].frameDelay[i]
		JY.Person[id]["???????¡ì????" .. i] = Avatar[Ani_id][r].soundDelay[i]
	end
end

function Teammember_View()

	local choice = 1

	while true do
		if JY.Restart == 1 then
			return
		end
		Cls()
		
		lib.LoadPNG(96, 1 * 2 , 0, 0, 1)
		
		local x = 8
		for i = 1, 5 do
			if choice ~= i then
				lib.SetClip(x + 10, CC.ScreenH-579 + 13, x + 184 -10, CC.ScreenH-579 + 575)
				lib.LoadPNG(95, i * 2 , x - 90, CC.ScreenH-579, 1)
				
				local h = 494
				local space = 35
				local color = C_WHITE
				
				local indent = 0
				
				if string.len(JY.Person[i]["????"]) == 8 then
					indent = 29
				elseif string.len(JY.Person[i]["????"]) == 6 then
					indent = 14
				end
				
				DrawString(x + 61 - indent, h, JY.Person[i]["????"],color,CC.DefaultFont)
				h = h + space
				
				DrawString(x + 58, h, "LV."..JY.Person[i]["????"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "???¡Â "..JY.Person[i]["???¡Â??"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "¡¦??? "..JY.Person[i]["¡¦?????"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "?¨¢?? "..JY.Person[i]["?¨¢??"],color,CC.Fontsmall)
				h = h + space
			end
			x = x + 184
		end
		
		lib.SetClip(0,0,0,0)
		
		x = 8
		for i = 1, 5 do
			if choice == i then
				lib.LoadPNG(96, 3 * 2 , x, CC.ScreenH-579, 1)
			else
				lib.LoadPNG(96, 2 * 2 , x, CC.ScreenH-579, 1)
			end
			x = x + 184
		end
		
		x = 8
		for i = 1, 5 do
			if choice == i then
				lib.SetClip(x + 10, CC.ScreenH-579 + 13, x + 184 -10, CC.ScreenH-579 + 575)
				lib.LoadPNG(95, i * 2 , x - 90, CC.ScreenH-579, 1)
				
				local h = 494
				local space = 35
				local color = LightYellow2
				
				local indent = 0
				
				if string.len(JY.Person[i]["????"]) == 8 then
					indent = 29
				elseif string.len(JY.Person[i]["????"]) == 6 then
					indent = 14
				end
				
				DrawString(x + 61 - indent, h, JY.Person[i]["????"],color,CC.DefaultFont)
				h = h + space
				
				DrawString(x + 58, h, "LV."..JY.Person[i]["????"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "???¡Â "..JY.Person[i]["???¡Â??"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "¡¦??? "..JY.Person[i]["¡¦?????"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "?¨¢?? "..JY.Person[i]["?¨¢??"],color,CC.Fontsmall)
				h = h + space
			end
			x = x + 184
		end
		
		local keypress, ktype, mx, my = lib.GetKey()
		
		if keypress == VK_LEFT then
			choice = choice - 1
		elseif keypress == VK_RIGHT then
			choice = choice + 1
		end
		
		ShowScreen()
		lib.Delay(CC.Frame)

	end
	
end

--????????
function ZhongYongZD1(id)
    if JY.Person[id]["????"] == 1 then
		return true
	end
	if JY.Person[id]["????"] == 3 then
		return true
	end
	--[[if match_ID(id,524) then
		return true
	end]]
	if match_ID(id,189) then
		return true
	end
	return false
end
function ZhongYongZD2(id)
    if JY.Person[id]["????"] == 2 then
		return true
	end
	--[[if match_ID(id,524) then
		return true
	end]]
	if JY.Person[id]["????"] == 3 then
		return true
	end
	return false
end
--?¡¦¡Á?
function MuRongDZ(id)
    if JY.Person[id]["????????3"] > 0 then
        return true
    end
	if match_ID(id,51) or match_ID(id,529) or match_ID(id,113) or match_ID(id,679) then
		return true
	end
    return false
end
--¡Á¨®??
function ZYHBPD(id)
	local s = 0
	if JY.Person[id]['¡Á¨®??????'] == 2 or match_ID(id,64) then
		s = 2
	elseif JY.Person[id]['¡Á¨®??????'] == 1 then
		s = 1
	end	
	return s
end
--???¨½????????????
--????????¡Á¨®??¡Á¨®??BABA
function YC_ZhangJiaHui(key)
	local up,down,left,right = VK_UP, VK_DOWN, VK_LEFT, VK_RIGHT
	local A,B = VK_A, VK_B
	local sequence = {up,up,down,down,left,right,left,right,B,A,B,A}
	if key == sequence[YC.ZJH + 1] then
		YC.ZJH = YC.ZJH + 1
	else
		YC.ZJH = 0
	end
end

function ZmShop()
    local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*1.5
	local size1 = CC.DefaultFont*0.7
	local size2 = CC.DefaultFont*0.8
	local cont = 1 
	local cont1 = 0
	local cont2 = 0
	local jg = bx*4
    local page = 1
    local pc = 50
    local pc1 = 50
    local pc2 = 60
    local m_left = JY.Base["?¨¦??"]
	local t_price = 0
	while true do 
		Cls()
        lib.LoadPNG(91, 10 * 2 , 0, 0, 1)
		for i = 1,5 do  -- ?¨¢?¨½
			for j = 1,5 do  --?¨²?¨½
				local cl = 6  -- ??
				local col = C_GOLD --????
				local p = i + (j-1+cont2)*14 
				local zx = bx*455+(i-1)*(bx*100+jg)-50
				local zy = by*144+(j-1)*(by*100+jg)-50
				if cont+cont1*5 == p then
					cl = 2
					col = C_WHITE
                end
                if page == 1 then 
                    cl = 2
                end
				if CC.commodity[p] ~= nil then
					local plx = CC.commodity[p]
					local pic = plx[1]
                    lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
                    if page == 1 and cont+cont1*5 == p then 
                        lib.LoadPNG(91, pc * 2 , zx+50,zy+50, 2)
                        pc = pc + 1
                        if pc > pc2 then 
                            pc = pc1
                        end
					end
							
                    --DrawString(zx+bx*30-string.len(plx[5])*size1+size1,zy-by*45,plx[5], C_WHITE, size1)
                    --if page == 2 and cont+cont1*5 == p then
                        --DrawString(zx+bx*30-string.len(plx[3])*size1+size1,zy+by*25,plx[3], C_WHITE, size1)
                    --end
				end	
			end
		end

        if CC.commodity[cont+cont1*5] ~= nil then
            local plx = CC.commodity[cont+cont1*5]
            local pic = plx[1]
            --
            --DrawString(bx*405,by*640-size2,JY.Thing[pic]['???¡¦???¡Â'], C_ORANGE, size2)
            DrawString(bx*405,by*638-size1,plx[4], C_WHITE, size1)
            DrawString(bx*405,by*663-size1,'???¡ã??????'..plx[5], C_WHITE, size1)
            DrawString(bx*405,by*688-size1,'???¨¾??????'..plx[3], C_WHITE, size1)
        end
        lib.Background(bx*70, by*520, bx*300,by*650, 150)
        DrawString(bx*80,by*550-size2,'???¨½:'..CC.commodity[cont+cont1*5][2], C_WHITE, size2)
        DrawString(bx*80,by*580-size2,'¡Á???:'..JY.Base["?¨¦??"], C_WHITE, size2)
        DrawString(bx*80,by*610-size2,'?¡§¡¦?:'..t_price, C_WHITE, size2)
        DrawString(bx*80,by*640-size2,'????:'..m_left, C_WHITE, size2)


		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
            if page == 1 then 
                page = 2
            else 
                JY.Base["?¨¦??"] = m_left
                CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                CC.commodity[cont+cont1*5][3] = 0
                page = 1
            end
        elseif X == VK_ESCAPE or ktype == 4 then
            CC.commodity[cont+cont1*5][3] = 0
            if page == 2 then 
                page = 1 
            else     
                break
            end
		elseif X == VK_UP then
			if cont1 > 0 then
				if cont1 == cont2 then
					cont2 = limitX(cont2 - 1,0)
				end
				cont1 = cont1 - 1
			else 
				cont = 1
			end
		elseif X == VK_DOWN then
			if cont + cont1*5 < #CC.commodity then
				if cont1 < math.ceil(#CC.commodity/5) - 1 then 
					cont1 = cont1 + 1 
					if cont + cont1*5 > #CC.commodity then
						cont = #CC.commodity - cont1*5
					end
				else 
					cont = #CC.commodity - cont1*5
				end
				if cont1 - cont2 > 4 then
					cont2 = cont2 + 1
				end
			end
        elseif X == VK_LEFT or ktype == 6 then
            if page == 1 then 
                cont = cont - 1 
                if cont1 > 0 then 
                    if cont < 1 then
                        if cont1 == cont2 then
                            cont2 = limitX(cont2 - 1,0)
                        end
                        cont1 = cont1 - 1
                        cont = 5
                    end
                elseif cont < 1 then 
                    cont = 1
                end
            else 
                if CC.commodity[cont+cont1*5][3] > 0 then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] - 1
                    m_left = m_left + CC.commodity[cont+cont1*5][2]
                    t_price = t_price - CC.commodity[cont+cont1*5][2]
                end
            end
        elseif X == VK_RIGHT or ktype == 7 then
            if page == 1 then 
                if cont + cont1*5 < #CC.commodity then
                    cont = cont + 1
                    if cont > 5 then
                        if cont1 < math.ceil(#CC.commodity/5) - 1 then 
                            cont = 1 
                            cont1 = cont1 + 1
                        end	
                    end
                    if cont1 - cont2 > 4 then
                        cont2 = cont2 + 1
                    end
                end
            else 
                if m_left >= CC.commodity[cont+cont1*5][2] then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] + 1
                    m_left = m_left - CC.commodity[cont+cont1*5][2]
                    t_price = t_price + CC.commodity[cont+cont1*5][2]
                end
            end
		else 
			local mxx = false
			for i = 1,5 do 
				for j = 1,5 do
                    if mx >= bx*405+(i-1)*(bx*100+jg) and mx <= bx*505+(i-1)*(bx*100+jg) and 
                        my >= by*94+(j-1)*(by*100+jg) and my <= by*194+(j-1)*(by*100+jg) then 
                        local p = i + (j-1+cont2)*14
                        if CC.commodity[p] ~= nil then
							cont = i 
							cont1 = j - 1 + cont2
							mxx = true 
							break
                        end	
                    end
				end
			end	
			if ktype == 3 and mxx == true then 
                if page == 1 then 
                    page = 2
                else 
                    JY.Base["?¨¦??"] = m_left
                    CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                    CC.commodity[cont+cont1*5][3] = 0
                    page = 1
                end
			end
		end
	end
end

--????????
function zmStore()
	dofile(CC.Acvmts)
	local mrchds = {}
	for i = 1, 4 do
		mrchds[i] = {}
		mrchds[i].num = 0
	end
	mrchds[1].name = "?¨§???¡è"
	mrchds[1].price = 600
	mrchds[2].name = "?¨§?¨¢?¡è"
	mrchds[2].price = 900
	mrchds[3].name = "?¨§???¡è"
	mrchds[3].price = 600
	mrchds[4].name = "???¨®???¡è¡¦?"
	mrchds[4].price = 500
	--mrchds[5].name = "?????¡è"
	--mrchds[5].price = 300
	--mrchds[6].name = "?????¡è"
	--mrchds[6].price = 500
	local choice = 1
	local t_price = 0
	local m_left = CC.Sp

	while true do
		if JY.Restart == 1 then
			return
		end
		Cls()
		lib.LoadPNG(91, 10 * 2 , 0, 0, 1)
		for i = 1, #CC.commodity do
			local th = CC.commodity[i]
			local thname = JY.Thing[th[1]]['????']
			local price = th[2]
			local num = th[3]
			local sm = th[4]
			local t_color = C_WHITE
			if i == choice then
				t_color = C_GOLD
			end
			lib.LoadPNG(91, 24 * 2 , 65, 115+40*(i-1), 1)
			DrawString(80,122+40*(i-1),string.format("%-14s %-8s %-6s %-6s %-6s",thname, price, th[5], num,sm),t_color,CC.DefaultFont*0.9)
		end
		
		DrawString(80,CC.ScreenH - 107,string.format("%-6s %-6s %-6s %-6s","¡Á?????",t_price,"??????",m_left), C_GOLD,CC.DefaultFont)
		
		DrawString(80,CC.ScreenH - 57,"??????????".. CC.Sp, C_ORANGE, CC.DefaultFont)
		DrawString(40,CC.ScreenH - 50,"?????¨¹???¨½ ¡Á¨®???¨¹?¡Â?????? ?????¨¹?¡¦?? ESC????",LimeGreen,CC.FontSmall)

		local keypress, ktype, mx, my = lib.GetKey()
		if keypress == VK_UP then
			choice = choice - 1
			if choice < 1 then
				choice = #CC.commodity
			end
		elseif keypress == VK_DOWN then
			choice = choice + 1
			if choice > #CC.commodity then
				choice = 1
			end
		elseif keypress == VK_LEFT then
            if CC.commodity[choice][3] > 0 then
                CC.commodity[choice][3] = CC.commodity[choice][3] - 1
			    m_left = m_left + CC.commodity[choice][2]
			    t_price = t_price - CC.commodity[choice][2]
			end
		elseif keypress == VK_RIGHT then
			if m_left >= CC.commodity[choice][2] then
				CC.commodity[choice][3] = CC.commodity[choice][3] + 1
				m_left = m_left - CC.commodity[choice][2]
				t_price = t_price + CC.commodity[choice][2]
			else
				DrawString(500,520,"?¨²????????¡Á???", C_RED, CC.FontBig)
				ShowScreen()
				lib.Delay(300)
			end
		elseif keypress == VK_RETURN then
            CC.Sp = m_left
            CC.commodity[choice][5] = CC.commodity[choice][5] + CC.commodity[choice][3]
            CC.commodity[choice][3] = 0
        elseif keypress == VK_ESCAPE then
            CC.commodity[choice][3] = 0
			break
		end
		ShowScreen()
		lib.Delay(CC.Frame)
	end
end

--????????????????????????
function tjmdh(num)
local a = 0

for i = 0,#CC.Effect do
	a = CC.Effect[i] + a
	if num <= a then
	   say(i,0,1)
	   break
	end
	if i == #CC.Effect and num > a then  
	   say('????¡¦??¡ì',0,1)
	   break
	end
end
end
function firstmenu1()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local tsmenu = {'¡¦?','??','??','?¨§','??','¡ã¡Á','??','??','?¨¦','?¨½','??','??','??','?¡ì',}
	local tsmenu1 = {'¡¦??¨¹????','????¡¦??¨¹','?????¡Â','?¨§?¨²¡ã???','???¨½??????','¡ã¡Á?¨ª???¡Â¡¦?','??????','??¡ã?????','?¨¦???¡Â????','?¨½?¨½????','??????','???¨§???¨²??','??????','?¡ì?¨§??'}
	local menu2 = {	{1,2,3,4,72,587}, --¡¦?
					{633,738,545,722}, --??
					{37,94,95,96,97,589,52,594,595}, --??
					{49,50,53,51,76,46,47,48,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,70,529,634,45,574,44,565,576,499,577},--?¨§
					{55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604,637,753}, --??
					{590,138,137}, --¡ã¡Á
					{601,86,87,602,603,150,71}, --??
					{19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583}, --??
					{74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606}, --?¨¦
					{58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,530,592,627}, --?¨½
					{38,581,582,39,40,41,42,43,85,164,162,163,636}, --??
					{9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,523}, --??
					{54,91,629,183,184,185,186,607,83,176,639}, --??
					{77,566,189,615,614,613,612}, --?¡ì
					
					-- local bsx = {400,500,550,547,548,613,610,551,360,555}
					-- local bsx1 = {556,558,559,560,15,47,545,510,564,617}
					
					--,497,578,579,584,652,500,498,637,577,635,501,596,504,505,507,721,546,610,514,515 --????
					
					-- ['¡¦?'] = {1,2,3,4,72,587},
					-- ['??'] = {633,738,545,722},
					-- ['??'] = {37,94,95,96,97,589,52,594,595},
					-- ['?¨§'] = {49,50,53,51,76,46,47,48,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,70,634,45,574,44,565,576,499},
					-- ['??'] = {55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604},
					-- ['¡ã¡Á'] = {590,138,137},
					-- ['??'] = {601,86,87,602,603,150,71,},
					-- ['??¡Á??¡Â??'] = {'?????¨½??','?¨¦??????','???¨½????','¡ã????¨½??','????????','?????¨§??','????????','???¨§????','????????'},
					-- ['??'] = {19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583},
					-- ['?¨¦'] = {74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606},
					-- ['?¨½'] = {58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,592,628,627},
					-- ['??'] = {38,581,582,39,40,41,42,43,85,164,162,163,636},
					-- ['??'] = {9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,},
					-- ['??'] = {54,91,629,183,184,185,186,607,83,176,639},
					-- ['?¡ì'] = {77,566,189,615,614,613,612},
	}
	local tb = 1
	local lb = 1
	local rw,rw1 = 1,0
	local dh = 0
	local fy ,fymax,star = 0 ,0 , 1
	local zs = 0
	local dl = 0
	local dh = 0
	--????
	local cx,ts,zj,xb = 0,0,0,0
	local tbx,tby = bx*1225,by*195
	local tsw,tsh = bx*54,by*45
	while true do 
		if JY.Restart == 1 then
			break
		end
		--???????????¨¾???????????????¡¦??¡Á??????????????????¡ã?????????????¡ã????????¡¦¨½?¨¾????????????
		ClsN()
		---------------
		lib.LoadPNG(91, 24 * 2 , 0,0, 1)
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		lib.LoadPNG(91, 26 * 2 , 0,0, 1)
		for i = 1,#tsmenu do
			local cl = C_BLACK
			local tsbx,tsby = bx*1225,by*195 --????¡Á???
			if i > 7 then
				tsbx,tsby = bx*75,by*195 --????¡Á???
			end
			local tsk = by*68*(i-1)
			if tb == i then
				cl = C_RED				
				if tb > 7 then
					lib.LoadPNG(91,22*2,tsbx-bx*10,by*68+by*68*(tb-6),1,0,40)
				else
					lib.LoadPNG(91,22*2,tsbx-bx*10,tsby+tsk,1,0,40)
				end
			end
			if i > 7 then
				tsk = by*68*(i-8)
			end
			lib.DrawStr(tsbx,tsby+tsk,tsmenu[i], cl,size*2, "./FONT/6.ttf",  0, 0)
			lib.DrawStr(bx*644-string.len(tsmenu1[tb])*size/4,by*70,tsmenu1[tb], C_WHITE,size*1.6, "./FONT/6.ttf",  0, 0)
		end	
		if lb == 1 or lb == 2 then
			for i = 1, 6 do
				local cl = C_WHITE	
				local ii = rw1 + i
				if menu2[tb][ii] ~= nil then
					local id = menu2[tb][ii]
					local pic = JY.Person[id]["¡ã??¨ª?¨½"]
					local name = JY.Person[id]["????"]
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*140,by*110 
					if rw == i then
						lib.LoadPNG(90, pic * 2 , bx*276,by*410, 1,0,90)
						if lb == 2 then
							lib.LoadPNG(91,12*2,rwx+(rw-1)*rww-bx*5,rwy-by*10,1,0,116)
						end	
						if lb == 2 then
							cl = C_RED
						end	
						local zs = 0
						local dl = 0
						for j=1,5 do
							if JY.Person[id]['????????????'..j]>0 then
								if j>1 then
									zs = JY.Person[id]['????????????'..j]
									break;
								end
								dl = dl+JY.Person[id]['????????????'..j]*4
							end
						end					
						lib.PicLoadCache(JY.Person[id]["?¡¦?¨½?¨²??"]+101,(dl+dh+zs*3)*2,bx*290,by*700)					
						dh = dh + 1
						if dh == zs then
							dh = 0
						end
						local me = {}
						local row = 0
						local maxh = 9
						if TFJS[id] ~= nil then
							local row = 0
							local maxh = 15
							for i = 1, #TFJS[id] do
								me[#me+1] = TFJS[id][i]
								if i == #TFJS[id] then 
									me[#me+1] = "??"
								end
							end
						end
						if CC.PTF[id] ~= nil then 
							for i,v in pairs(CC.PTF[id]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '??'..CC.PTFSM[i][1]
										me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
										me[#me+1] = "??"
									end
								end
							end
						end
						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "??"
							end
						end
						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "??" then
								row = row + 1
							else
								h = tjm(bx*550, by*420 + size*0.8 * (row-fy), tfstr, C_WHITE, size*0.8,math.modf((bx*554)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					end
					lib.LoadPNG(91,39*2,rwx+(i-1)*rww-bx*5,rwy,1,0,113)
					lib.LoadPNG(1,pic*2,rwx+(i-1)*rww,rwy,1,0,90)

					lib.DrawStr(rwx+size*1.8+(i-1)*rww-string.len(name)*size/4,rwy+size*3.8,name, cl,size, "./FONT/0.ttf",  0, 0)
				end
			end
		end
		--????????
		ShowScreen()
		--???¡¦???????¡§??????????
		lib.Delay(40)
		--X???¨¹????¡Á¡Â??ktype???¨®????¡Á¡Â??ktype = 3 ?¨²?¨ª¡Á¨®?¨¹??4?¨²?¨ª???¨¹??6????????7??????
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_ESCAPE or ktype == 4 then
			if lb == 2 then
				lb = 1
				if fy > 0 then
					fy = 0
				end
			end
		elseif X == VK_SPACE or X == VK_RETURN then
			if lb == 1 then
				lb = 2 
			elseif lb == 2 then
				cx = menu2[tb][rw+rw1]
				break
			end
		elseif X == VK_DOWN  then	
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb +1 
				if tb > 14 then
					tb = 1
				end
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
		elseif X == VK_UP  then
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb - 1 
				if tb < 1  then
					tb = 14
				end	
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X == VK_LEFT then
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb < 8 then
					tb = tb + 7 
				else
					tb = tb - 7	
				end
			elseif lb == 2 then
				fy = 0
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end
		elseif X == VK_RIGHT then	
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb > 7 then
					tb  = tb - 7
				else
					tb = tb + 7	
				end
			elseif lb == 2 then
				fy = 0
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end 
		elseif X == VK_PGUP or ktype == 6 then
			PlayWavE(77)
			if lb == 2 then
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end				
		elseif X == VK_PGDN or ktype == 7 then
			PlayWavE(77)
			if lb == 2 then
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end
		elseif X >= VK_A and X <= VK_Z then
			YC_ZhangJiaHui(X)
			--YC_GUXIZHAOWSC(X)
		else
			local cot = false
			local cot1 = false
			for i = 1,#tsmenu do
				local tsbx,tsby = bx*1225,by*195 --????¡Á???
				if i > 7 then
					tsbx,tsby = bx*75,by*195 --????¡Á???
				end
				local tsk = by*68*(i-1)
				if i > 7 then
					tsk = by*68*(i-8)
				end
				if mx >= tsbx and mx <= tsbx + tsw and my >= tsby + tsk and my <= tsby + tsk + tsh then
					rw = 1
					rw1 = 0
					tb = i
					zs,dl,dh = 0,0,0
					cot = true
					break
				end
			end   
			if  ktype == 3 and lb == 1  then
				lb = 2
			end
			if  lb == 2 then
				for i = 1,6 do
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*126,by*172 
					local rwk = bx*(i-1)*140
					local ii = rw1 + i
					if menu2[tb][ii] ~= nil then
						if mx >= rwx + rwk and mx < rwx +rwk + rww and my >= rwy and my <= rwy + rwh then					
							rw = i 
							zs,dl,dh = 0,0,0
							cot1 = true
							break
						end

					end
				end
				if cot1 == true and ktype == 3 then
					cx = menu2[tb][rw+rw1]
					break
				end
			end
		end		
	end
	return cx,zj,ts,xb
end
function firstmenu2()--????????
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local tsmenu = {'??','??','??','??','?¡è','??','?¡§','??','??'}
	local tsmenu1 = {'????¡Á?','??????','?????¨®','?????¨¹','?¡è?¨²??¡Á?','?????¡ì','?¡§?¡ì??','????¡ã???','????????'}
	local menu2 = {	{514,745,744}, --??
					{526,525,527,761,457}, --??
					{524,743,747,758,759,760,764,771,772,773,774,775,776}, --??
					{568},--??
					{749,750,751,752,748}, --?¡è
					{754,455,762}, --??
					{515,763}, --?¡§
					{419,429,439,765},--¡ã???
					{511,578,579,584,652,500,498,497,635,501,596,505,507,721,546}, --??
					--{74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606}, --?¨¦
					--{58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,530,592,627}, --?¨½
					--{38,581,582,39,40,41,42,43,85,164,162,163,636}, --??
					--{9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,523}, --??
					--{54,91,629,183,184,185,186,607,83,176,639}, --??
					--{77,566,189,615,614,613,612}, --?¡ì
					
					
					-- local bsx = {400,500,550,547,548,613,610,551,360,555}
					-- local bsx1 = {556,558,559,560,15,47,545,510,564,617}
					
					--,497,578,579,584,652,500,498,637,577,635,501,596,504,505,507,721,546,610,514,515 --????
					
					-- ['¡¦?'] = {1,2,3,4,72,587},
					-- ['??'] = {633,738,545,722},
					-- ['??'] = {37,94,95,96,97,589,52,594,595},
					-- ['?¨§'] = {49,50,53,51,76,46,47,48,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,70,634,45,574,44,565,576,499},
					-- ['??'] = {55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604},
					-- ['¡ã¡Á'] = {590,138,137},
					-- ['??'] = {601,86,87,602,603,150,71,},
					-- ['??¡Á??¡Â??'] = {'?????¨½??','?¨¦??????','???¨½????','¡ã????¨½??','????????','?????¨§??','????????','???¨§????','????????'},
					-- ['??'] = {19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583},
					-- ['?¨¦'] = {74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606},
					-- ['?¨½'] = {58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,592,628,627},
					-- ['??'] = {38,581,582,39,40,41,42,43,85,164,162,163,636},
					-- ['??'] = {9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,},
					-- ['??'] = {54,91,629,183,184,185,186,607,83,176,639},
					-- ['?¡ì'] = {77,566,189,615,614,613,612},
	}
	local tb = 1
	local lb = 1
	local rw,rw1 = 1,0
	local dh = 0
	local fy ,fymax,star = 0 ,0 , 1
	local zs = 0
	local dl = 0
	local dh = 0
	--????
	local cx,ts,zj,xb = 0,0,0,0
	local tbx,tby = bx*1225,by*195
	local tsw,tsh = bx*54,by*45
	while true do 
		if JY.Restart == 1 then
			break
		end
		--???????????¨¾???????????????¡¦??¡Á??????????????????¡ã?????????????¡ã????????¡¦¨½?¨¾????????????
		ClsN()
		---------------
		lib.LoadPNG(91, 24 * 2 , 0,0, 1)
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		lib.LoadPNG(91, 26 * 2 , 0,0, 1)
		for i = 1,#tsmenu do
			local cl = C_BLACK
			local tsbx,tsby = bx*1225,by*195 --????¡Á???
			if i > 7 then
				tsbx,tsby = bx*75,by*195 --????¡Á???
			end
			local tsk = by*68*(i-1)
			if tb == i then
				cl = C_RED				
				if tb > 7 then
					lib.LoadPNG(91,22*2,tsbx-bx*10,by*68+by*68*(tb-6),1,0,40)
				else
					lib.LoadPNG(91,22*2,tsbx-bx*10,tsby+tsk,1,0,40)
				end
			end
			if i > 7 then
				tsk = by*68*(i-8)
			end
			lib.DrawStr(tsbx,tsby+tsk,tsmenu[i], cl,size*2, "./FONT/6.ttf",  0, 0)
			lib.DrawStr(bx*644-string.len(tsmenu1[tb])*size/4,by*70,tsmenu1[tb], C_WHITE,size*1.6, "./FONT/6.ttf",  0, 0)
		end	
		if lb == 1 or lb == 2 then
			for i = 1, 6 do
				local cl = C_WHITE	
				local ii = rw1 + i
				if menu2[tb][ii] ~= nil then
					local id = menu2[tb][ii]
					local pic = JY.Person[id]["¡ã??¨ª?¨½"]
					local name = JY.Person[id]["????"]
					if id == 429 then
						name = '????????'
					elseif id == 439 then
						name = '?¨¾??????'
					end		
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*140,by*110 
					if rw == i then
						lib.LoadPNG(90, pic * 2 , bx*276,by*410, 1,0,90)
						if lb == 2 then
							lib.LoadPNG(91,12*2,rwx+(rw-1)*rww-bx*5,rwy-by*10,1,0,116)
						end	
						if lb == 2 then
							cl = C_RED
						end	
						local zs = 0
						local dl = 0
						for j=1,5 do
							if JY.Person[id]['????????????'..j]>0 then
								zs = JY.Person[id]['????????????'..j]
								break;
								dl = dl+JY.Person[id]['????????????'..j]*4
							end
						end					
						lib.PicLoadCache(JY.Person[id]["?¡¦?¨½?¨²??"]+101,(dl+dh+zs*3)*2,bx*290,by*700)					
						dh = dh + 1
						--say(zs..'??'..dl..'??'..dh,0,1)
						if dh == zs then
							dh = 0
						end
						local me = {}
						local row = 0
						local maxh = 9
						if TFJS[id] ~= nil then
							local row = 0
							local maxh = 15
							for i = 1, #TFJS[id] do
								me[#me+1] = TFJS[id][i]
								if i == #TFJS[id] then 
									me[#me+1] = "??"
								end
							end
						end
						if CC.PTF[id] ~= nil then 
							for i,v in pairs(CC.PTF[id]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '??'..CC.PTFSM[i][1]
										me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
										me[#me+1] = "??"
									end
								end
							end
						end
						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "??"
							end
						end
						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "??" then
								row = row + 1
							else
								h = tjm(bx*550, by*420 + size*0.8 * (row-fy), tfstr, C_WHITE, size*0.8,math.modf((bx*554)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					end
					lib.LoadPNG(91,39*2,rwx+(i-1)*rww-bx*5,rwy,1,0,113)
					lib.LoadPNG(1,pic*2,rwx+(i-1)*rww,rwy,1,0,90)

					lib.DrawStr(rwx+size*1.8+(i-1)*rww-string.len(name)*size/4,rwy+size*3.8,name, cl,size, "./FONT/0.ttf",  0, 0)
				end
			end
		end
		--????????
		ShowScreen()
		--???¡¦???????¡§??????????
		lib.Delay(40)
		--X???¨¹????¡Á¡Â??ktype???¨®????¡Á¡Â??ktype = 3 ?¨²?¨ª¡Á¨®?¨¹??4?¨²?¨ª???¨¹??6????????7??????
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_ESCAPE or ktype == 4 then
			if lb == 2 then
				lb = 1
				if fy > 0 then
					fy = 0
				end	
			end
		elseif X == VK_SPACE or X == VK_RETURN then
			if lb == 1 then
				lb = 2 
			elseif lb == 2 then
				cx = menu2[tb][rw+rw1]
				break
			end
		elseif X == VK_DOWN  then	
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb +1 
				if tb > 9 then
					tb = 1
				end
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
		elseif X == VK_UP  then
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb - 1 
				if tb < 1  then
					tb = 9
				end	
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X == VK_LEFT then
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb < 8 then
					tb = tb+7
				else
					tb = tb-7	
				end	
				if tb > 9 then
					tb = 8
				end	
			elseif lb == 2 then
				fy = 0
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end
		elseif X == VK_RIGHT then	
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb < 8 then
					tb = tb + 7
				else
					tb = tb - 7
				end
				if tb > 9 then
					tb = 8
				end	
			elseif lb == 2 then
				fy = 0
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end 
		elseif X == VK_PGUP or ktype == 6 then
			PlayWavE(77)
			if lb == 2 then
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end				
		elseif X == VK_PGDN or ktype == 7 then
			PlayWavE(77)
			if lb == 2 then
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end
		elseif X >= VK_A and X <= VK_Z then
			YC_ZhangJiaHui(X)
			--YC_GUXIZHAOWSC(X)
		else
			local cot = false
			local cot1 = false
				for i = 1,#tsmenu do
					local tsbx,tsby = bx*1225,by*195 --????¡Á???
					if i > 7 then
						tsbx,tsby = bx*75,by*195 --????¡Á???
					end
					local tsk = by*68*(i-1)
					if i > 7 then
						tsk = by*68*(i-8)
					end
					if mx >= tsbx and mx <= tsbx + tsw and my >= tsby + tsk and my <= tsby + tsk + tsh then
						rw = 1
						rw1 = 0
						tb = i
						zs,dl,dh = 0,0,0
						cot = true
						break
					end
				end   
				if  ktype == 3 and lb == 1  then
					lb = 2
				end
			if  lb == 2 then
				for i = 1,6 do
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*126,by*172 
					local rwk = bx*(i-1)*140
					local ii = rw1 + i
					if menu2[tb][ii] ~= nil then
						if mx >= rwx + rwk and mx < rwx +rwk + rww and my >= rwy and my <= rwy + rwh then					
							rw = i 
							zs,dl,dh = 0,0,0
							cot1 = true
							break
						end

					end
				end
				if cot1 == true and ktype == 3 then
					cx = menu2[tb][rw+rw1]
					break
				end
			end
		end		
	end
	return cx,zj,ts,xb
end
function bzzjmenu()  --?¡Â?????¨¹??
	local bx,by =CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont	
	local mpwz = {"?????¨½??","???¨½????","¡ã????¨½??","????????","?¨¦??????","???¨§????","???¨§????","?????¨§??","????????","¡¦???????","?¨®?¡ì?¨§?¡ì","????"} --?¡Â?????¨¹??
	local ax,ay = bx*430,by*30
	local mp = {5,14,6,2,15,1,8,13,4,9,9,9}
	local mpzb =  {
					{1015,85},{1065,196},{1115,306},{1115,417},{1065,529},
					{1015,640},{315,85},{265,196},{216,306},{216,417},{265,529},{315,640}
				}
	local bsx = {547,500,550,551,548,613,610,553,555,572,1067,0}  --?¡Â?????¨¹??
	local bsx1 = {556,558,559,560,15,47,545,510,564,1061,617,0}
	local tb = 1
	local lb = 1
	local tb1 = 1
	local fkx,fky = 29,15		
	local fy = 0
	local fymax = 0
	local star = 1		
	local pg = 1
	local xb = JY.Person[0]["????"]
	local zm = JY.Base["????"]
	--lib.PicLoadCache(92,(91+i-1)*2,bx*QZZB[i][1]-bx*22.5,by*QZZB[i][2]-by*22.5,1)
	while true do 
		if JY.Restart == 1 then
			break
		end
		ClsN()
		lib.LoadPNG(91, 110 * 2 , 0,0, 1)

		for i = 1,#mpwz do
			local cl = C_WHITE
			if i < 7 then
				if JY.Person[0]["????"] == 0 then
					lib.LoadPNG(99,bsx[i]*2,bx*mpzb[i][1]+bx*fkx*2.4,by*mpzb[i][2]-by*fky,1,0,300)
				else
					lib.LoadPNG(99,bsx1[i]*2,bx*mpzb[i][1]+bx*fkx*2.4,by*mpzb[i][2]-by*fky,1,0,300)
				end
			else
				if JY.Person[0]["????"] == 0 then
					lib.LoadPNG(99,bsx[i]*2,bx*mpzb[i][1]-bx*fkx*4,by*mpzb[i][2]-by*fky,1,0,300)
				else
					lib.LoadPNG(99,bsx1[i]*2,bx*mpzb[i][1]-bx*fkx*4,by*mpzb[i][2]-by*fky,1,0,300)
				end
			end

			if tb == i then
				cl = C_RED
				if i < 7 then
					lib.LoadPNG(91,112*2,bx*mpzb[i][1]-bx*fkx,by*mpzb[i][2]-by*fky,1)
				else
					lib.LoadPNG(91,112*2,bx*mpzb[i][1]-bx*fkx*6.4,by*mpzb[i][2]-by*fky,1)
				end
			end
			local mpnm = mpwz[i]
			local znm = {}
			local namelen  = string.len(mpnm) / 2
			for j = 1,namelen do
				znm[j] = string.sub(mpnm, j * 2 - 1, j * 2)								
				DrawString(bx*mpzb[i][1],by*mpzb[i][2]+(j-1)*by*size*0.7,znm[j],cl,size*0.8)
			end
		end
		if lb == 2 then			
			--for p = 1,#mpzw do
			if JY.Person[0]["????"] == 0 then	
				lib.LoadPNG(90,bsx[tb]*2,bx*1360/2-bx*150*1.5,by*211,1,0,150)
			elseif JY.Person[0]["????"] == 1 then
				lib.LoadPNG(90,bsx1[tb]*2,bx*1360/2-bx*150*1.5,by*211,1,0,150)
			end
			--end
			local tid = 0+tb
			local me = {}
			local row = 0
			local maxh = 20
			local bz = {'??','??','??','??','??','??','??','??','??','??','?¡ì','??'}
			local md = bz[tid]   
			if TFJS[md] ~= nil then
				for i = 1, #TFJS[md] do
					me[#me+1] = TFJS[md][i]
					if i == #TFJS[md] then 
						me[#me+1] = "??"
					end
				end
			end
			if CC.PTF[tid] ~= nil then 
				for i,v in pairs(CC.PTF[tid]) do 
					if v == 1 then 
						if CC.PTFSM[i] ~= nil then
							me[#me+1] = '??'..CC.PTFSM[i][1]
							me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
							me[#me+1] = "??"
						end
					end
				end
			end			
			for i = 1, #ZJZSJS do
				me[#me+1] = ZJZSJS[i]
				if i == #ZJZSJS then 
					me[#me+1] = "??"
				end
			end
			if tb < 7 then	
				lib.LoadPNG(91,111*2,bx*30,by*70,1)
			else
				lib.LoadPNG(91,111*2,bx*930,by*70,1)
			end

			lib.LoadPNG(91,113*2,bx*375,by*61,1)
			for i = star, #me do
				local tfstr = me[i]
				local h = 0
						
				if string.sub(tfstr,1,2) == "??" then
					--row = row + 1
				else
					if tb < 7 then
						h = tjm(bx*37, by*95 + size*0.7 * (row-fy), tfstr, C_WHITE, size*0.6,15,size*0.7,fy-row,maxh+1-row+fy)
					else
						h = tjm(bx*937, by*95 + size*0.7 * (row-fy), tfstr, C_WHITE, size*0.6,15,size*0.7,fy-row,maxh+1-row+fy)
					end
				end
				row = row + h
			end
			
			if row > maxh then
				fymax = limitX(row-maxh-1,0)
			else
				fymax = 0
			end
			local xbwz = {"????","????","??????"}
			--local xbzb = {{398,67},{470,67},{425,617}}	
			local xbzb = {{550,600},{750,600},{705,683}}
			--{425,617}
			lib.LoadPNG(91,700*2,bx*462,by*552,1)	
			for x = 1,#xbzb do
				local cl = C_WHITE
				if tb1 == x then
					cl = C_RED
				end
				DrawString(bx*xbzb[x][1],by*xbzb[x][2],xbwz[x],cl,size*0.9)
			end	
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			if lb == 2 then
				lb = 1
				tb1 = 1
				JY.Person[0]["????"] = 0
			end
		elseif X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
			if lb == 1 then
				if tb <= 11 then		
					lb = 2
				end
			elseif lb == 2 and tb1 == 3 then
				Cls()
				if DrawStrBoxYesNo(-1, -1, "??¡¦¨½?????¡Â???¨¹????????¡¦¨½?¨¾???¡è????????????????", C_WHITE, CC.DefaultFont) then
					JY.Person[0]["????"] = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
				else
					JY.Person[0]["????"]=CC.NewPersonName;
				end	
				JY.Person[0]["?¨²?¨¹???¡è"] = 6	  
				JY.Person[0]["?¨²?¨¹¡Á??¨®??"] = 500
				JY.Person[0]["????¡Á??¨®??"] = 500
				JY.Person[0]["?¨²?¨¹"] = JY.Person[0]["?¨²?¨¹¡Á??¨®??"]
				JY.Person[0]["????"] = JY.Person[0]["????¡Á??¨®??"]
				JY.Person[0]["???¡Â??"] = 80
				JY.Person[0]["¡¦?????"] = 80
				JY.Person[0]["?¨¢??"] = 80
				JY.Person[0]["????????"] = 30
				JY.Person[0]["????????"] = 30
				--JY.Person[0]["????????"] = 30
				JY.Person[0]["????????"] = 0
				JY.Person[0]["??????¡¦¨¾"] = 40
				JY.Person[0]["??¡¦¡§????"] = 40
				JY.Person[0]["????????"] = 40
				JY.Person[0]["????????"] = 40
				JY.Person[0]["???????¡Â"] = 40
				JY.Person[0]["¡ã??¡Â????"] = 40
			
				local zm = JY.Base["????"]
				local nd = JY.Base["????"] 
				local addkfnum  
				if nd < 4 then 
					addkfnum = 12+math.modf(zm/2)
				else
					addkfnum = 12+math.modf(zm/1)
				end 
				JY.Base["????????"] = JY.Base["????????"] + addkfnum
				if JY.Base["????????"]>15 then 
					JY.Base["????????"]=15
				end	
				if JY.Person[0]["????"] == 1 then 
					JY.Person[0]["????"] = "????"
					JY.Person[0]["????2"] = "???¡¦"				
					local f_ani = {
					{0, 0, 0}, 
					{9, 9, 7}, 
					{8, 8, 6}, 
					{8, 8, 6}, 
					{9, 7, 7}}
					for i = 1, 5 do
						JY.Person[0]["????????????" .. i] = f_ani[i][1]
						JY.Person[0]["????????????" .. i] = f_ani[i][3]
						JY.Person[0]["???????¡ì????" .. i] = f_ani[i][2]
					end
				end			
				--?????¡Â??
				if tb == 1 then         --????
					JY.Base["??¡Á?"] = 1
					JY.Person[0]["??????¡¦¨¾"] = 60
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end				
					--SetTF(0,9960,1)
					--CC.TG[9960] = 1
					CC.PTF[0][9960] = 1
					-- for i = 1, 5 do
						-- JY.Person[0]["????????????" .. i] = JY.Person[405]["????????????" .. i]
						-- JY.Person[0]["????????????" .. i] = JY.Person[405]["????????????" .. i]
						-- JY.Person[0]["???????¡ì????" .. i] = JY.Person[405]["???????¡ì????" .. i]
					-- end
				elseif tb == 5 then     --??
					JY.Base["??¡Á?"] = 2
					JY.Person[0]["??¡¦¡§????"] = 60
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end	
					--SetTF(0,9959,1)
					--CC.TG[9959] = 1
					CC.PTF[0][9959] = 1
				elseif tb == 2 then     --??
					JY.Base["??¡Á?"] = 3	
					JY.Person[0]["????????"] = 60
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end	
					--SetTF(0,9958,1)
					--CC.TG[9958] = 1
					CC.PTF[0][9958] = 1
				elseif tb == 3 then     --??
					JY.Base["??¡Á?"] = 4
					JY.Person[0]["????????"] = 60
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end	
					--SetTF(0,9957,1)
					--CC.TG[9957] = 1
					CC.PTF[0][9957] = 1
				elseif tb == 4 then		 --?? 
				    JY.Base["??¡Á?"] = 5
					JY.Person[0]["???????¡Â"] = 60
					--JY.Person[0]["???????¡Â"] = 40+zm
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end	
					--SetTF(0,9956,1)
					--CC.TG[9956] = 1
					CC.PTF[0][9956] = 1
				elseif tb == 8 then		 --?¨§??
					JY.Person[0]["????¡Á??¨®??"] = 5000
					JY.Person[0]["????"] = 5000
					JY.Person[0]["?¨²?¨¹???¡è"] = 7
					JY.Base["??¡Á?"] = 6
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end	
					--SetTF(0,9947,1)
					--SetTF(0,9946,1)
					--CC.TG[9946] = 1
					CC.PTF[0][9946] = 1
				elseif tb == 9 then		 --????
					JY.Person[0]["?¡¦??"] = 100
					JY.Person[0]["??????¡¦¨¾"] = 50
					JY.Person[0]["??¡¦¡§????"] = 50
					JY.Person[0]["????????"] = 50
					JY.Person[0]["????????"] = 50
					JY.Person[0]["???????¡Â"] = 50
					JY.Base["??¡Á?"] = 7
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end			
				elseif tb == 7 then		 --???¨²
					JY.Person[0]["????????"] = 200
					JY.Person[0]["????????"] = 200
					JY.Person[0]["?¨²?¨¹???¡è"] = 7
					--JY.Person[0]["????????"] = 200
					JY.Base["??¡Á?"] = 8
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end				
				elseif tb == 6 then		 --????
					JY.Base["??¡Á?"] = 9
					JY.Person[0]["?¨²?¨¹???¡è"] = 7
					JY.Person[0]["????????"] = 300
					--JY.Person[0]["????????"] = 300
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end	
				elseif tb == 10 then		 --???¡Â
					JY.Base["??¡Á?"] = 10
					JY.Person[512]["????"] = 2
					JY.Person[0]["????"] = 0
					JY.Person[0]["??????¡¦¨¾"] = 50
					JY.Person[0]["??¡¦¡§????"] = 50
					JY.Person[0]["????????"] = 50
					JY.Person[0]["????????"] = 50
					JY.Person[0]["???????¡Â"] = 50
					JY.Person[0]["?¨²?¨¹???¡è"] = 7
					JY.Person[0]["?¡¦?¨½?¨²??"] = 880
					JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
				elseif tb == 11 then    --?¡ì?¡Â
					JY.Base["??¡Á?"] = 11
					JY.Person[0]["?¨²?¨¹???¡è"] = 7
					if JY.Person[0]["????"] == 1 then
						JY.Person[0]["?¡¦?¨½?¨²??"] = 547
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx1[tb]
					else
						JY.Person[0]["?¡¦?¨½?¨²??"] = 880
						JY.Person[0]["¡ã??¨ª?¨½"] = bsx[tb]
					end
					JY.Person[0]["?¡¦??"] = 0
				end	
				--?¡ì?¡Â??????
				
				-- JY.Person[0]["????"] = mp[tb]
				-- JY.Person[0]["???????¡Á"] = 1
				--return GAME_START2()					
				--say("???¡Â??"..JY.Base["??¡Á?"],0)
				--say("?? ????"..JY.Person[0]["????"],0)		
				break
			end
		elseif X == VK_UP  then
			PlayWavE(77)
			if lb == 1 then
				tb = tb - 1 
				if tb < 1 then
					tb = #mpwz
				end
			elseif lb == 2 then
				if tb1 == 3 then
					tb1 = 1 
				elseif tb < 3 then
					tb1 = 3
				end
			end
		elseif X == VK_DOWN  then
			PlayWavE(77)
			if lb == 1 then
				tb = tb + 1
				if tb > #mpwz then
					tb = 1 
				end
			elseif lb == 2 then
				if tb1 < 3 then
					tb1 = 3
				elseif tb1 ==3 then
					tb1 = 1				
				end
			end		
		elseif X == VK_LEFT then
			PlayWavE(77)
			if lb == 1 then
				tb = tb + 6 
				if tb > #mpwz then
					tb = 1
				end
			elseif lb == 2 then
				if tb1 < 3 then
					tb1 = tb1 - 1 
					if tb1 < 1 then
						tb1 = 2
					end
					JY.Person[0]["????"] = tb1 - 1
					if tb == 10 then 
						tb1 = 1
						JY.Person[0]["????"] = 0
					end
				end
			end	

		elseif X == VK_RIGHT then
			PlayWavE(77)
			if lb == 1 then
				tb = tb - 6 
				if tb < 1 then
					tb = #mpwz
				end
			elseif lb == 2 then
				if tb1 < 3 then
					tb1 = tb1 + 1
					if tb1 > 2 then
						tb1 = 1
					end
					JY.Person[0]["????"] = tb1 - 1
					if tb == 10 then 
						tb1 = 1
						JY.Person[0]["????"] = 0
					end
				end
			end	

		elseif X==VK_PGUP or ktype == 6 then
			PlayWavE(77)
			if lb == 2 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X==VK_PGDN or ktype == 7 then
			PlayWavE(77)
			if lb == 2 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
		end
	end
end	

--?¨®?¨½???????¨½????
function firstmenu()
	--???¡§?¡ã??¡ã?¡¦?¡ã?,¡¦???????¡¦??¨®??????????????????????¡Á??????????????¡§????
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	--bx*212 by*33.5
	--??¡Á??¨®??
	local size = CC.DefaultFont
	
	--???¨ª1???????¨§?¨¦
	local menu1 = {'¡¦?','??','??','?¨§','??','¡ã¡Á','??','??¡Á??¡Â??','??','?¨¦','?¨½','??','??','??','?¡ì','?????¡Â??'}
	
	--???¨ª1????¡Á???????
	local x1,y1 = bx*147,by*74
	
	local x2,y2 = bx*70,by*165
	--???¨ª1??????
	local jg = bx*80
	
	--???¨ª2??????
	local n = 15
	
	local menu2 = {	['¡¦?'] = {1,2,3,4,72,587},
					['??'] = {633,738,545,722},
					['??'] = {37,94,95,96,97,589,52,594,595},
					['?¨§'] = {44,45,46,47,48,49,50,51,53,70,76,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,529,634,574,565,576,499},
					['??'] = {55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604},
					['¡ã¡Á'] = {590,138,137},
					['??'] = {601,86,87,602,603,150,71,},
					['??¡Á??¡Â??'] = {'?????¨½??','?¨¦??????','???¨½????','¡ã????¨½??','????????','?????¨§??','????????','???¨§????','????????'},
					['??'] = {19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583},
					['?¨¦'] = {74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606},
					['?¨½'] = {58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,530,592,627},
					['??'] = {38,581,582,39,40,41,42,43,85,164,162,163,636},
					['??'] = {9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641},
					['??'] = {54,91,629,183,184,185,186,607,83,176,639},
					['?¡ì'] = {77,566,189,615,614,613,612},
					['?????¡Â??'] = {'????','¡ã¡Á????','??¡¦???','????','????????','??????','??????','?¡Â??????','???¡ã??','????','????','????','?????¡Â','????','?¨§¡Á???','?¡¦?¡è??','???¨½','??¡¦?','?¡§?¨²??','??????','¡¦??¡Â????'},
	}

	--????????????id
	local tsrw = {	--['??????'] = 651,
                    ['????'] = 497,
					['¡ã¡Á????'] = 511,
					--['????'] = 456,
					['??¡¦???'] = 457,
	                ['????'] = 578,
			 		['????????'] = 579,
					['??????'] = 584,					
					['??????'] = 652,
					['?¡Â??????'] = 500,
					['???¡ã??'] = 498,
					['????'] = 637,
					['????'] = 577,
					['????'] = 635,
					--['?¡Â????'] = 92,
					['?????¡Â'] = 501,
					--['??????'] = 596,
					--['???¨®??'] = 642,
                    ['????'] = 504,	
                    ['?¨§¡Á???'] = 505,
                    ['?¡¦?¡è??'] = 507,
                    ['??????'] = 513,
					['???¨½'] = 721, 
					['??¡¦?'] = 546, 
					['?¡§?¨²??'] = 610,
					['??????'] = 514,
					['¡¦??¡Â????'] = 515,
	}	
	--,497,578,579,584,652,500,498,637,577,635,501,596,504,505,507,721,546,610,514,515,
	--???¨ª0¡ã??¨¹????
	local cot = 1 
	
	local cont = 1 
	local cont1 = 0
	
	--???¨ª2¡ã??¨¹????
	local coxt = 1
	--???¨ª2¡ã??¨¹¡¦???????
	local coxt1 = 0
	local coxt2 = 0
	--???????¡ã?????????¨§?¨¦????????????????
	local lb = 2
	local xb = 0
	
	--????
	local cx = 0
	--?¡Â??
	local zj = 0
	--????
	local ts = 0
	
	local dh = 0
	local fy = 0
	local fymax = 0
	local star = 1

		
	while true do 
		if JY.Restart == 1 then
			break
		end
		--???????????¨¾???????????????¡¦??¡Á??????????????????¡ã?????????????¡ã????????¡¦¨½?¨¾????????????
		ClsN()
		---------------
		
		--¡Á????????????¡ã??¡¦?????--bx*212 by*33.5
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		
			local m = menu1[cont+cont1*8]
			
			if lb == 3 or lb == 4 then
				local id = coxt + coxt1*6
				local mid = menu2[m][id]
				--lib.LoadPNGPath(string.format('./data/fight/fight%03d',JY.Person[id]["?¡¦?¨½?¨²??"]), 89, -1, 100)   --???¡¦????
				if mid ~= nil then
					if m == '??¡Á??¡Â??' then 
						--???¡Â??¡ã??¨ª?¨½????
						local tt = 546
						
						
						--???¡Â??¡ã??¨ª?¨½???? 
						if xb == 1 then 
							tt = 555
						end

						lib.LoadPNG(90, (tt+id)* 2 , bx*160+bx*212,by*370+by*33.5, 2)
						lib.LoadPNG(91, 26 * 2 , 0,0, 1)
						--
						--?¨§????????
						--
							local pic = 0
							local zs = 10
							local dl = 0
							if xb == 1 then 
								pic = 547
								zs = 10
								else
								pic = 880
								zs = 14
							end
							
							--¡Á?????????????????89??
							--lib.PicLoadFile(string.format(CC.FightPicFile[1],pic),
						--	string.format(CC.FightPicFile[2],pic), 89)
							
							lib.PicLoadCache(pic+101,(dl+dh+zs*3)*2,bx*890+bx*212,by*670+by*33.5)
							
							dh = dh + 1
							if dh == zs then
								dh = 1
							end
							
						local tid = 0+id
						local me = {}
						local row = 0
                        local maxh = 15
                        local bz = {'??','??','??','??','??','??','??','??','??','??','?¡ì','??'}
                        local md = bz[tid]   
						if TFJS[md] ~= nil then
							for i = 1, #TFJS[md] do
								me[#me+1] = TFJS[md][i]
								if i == #TFJS[md] then 
									me[#me+1] = "??"
								end
							end
						end

						if CC.PTF[tid] ~= nil then 
							for i,v in pairs(CC.PTF[tid]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '??'..CC.PTFSM[i][1]
										me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
										me[#me+1] = "??"
									end
								end
							end
						end
						
						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "??"
							end
						end	

						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "??" then
								row = row + 1
							else
								h = tjm(bx*300+bx*212, by*280 + size*0.8 * (row-fy)+by*33.5, tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					elseif m == '?????¡Â??' then 
						--local tt = {290,580}
						if tsrw[mid] ~= nil then
							local pic = JY.Person[tsrw[mid]]['¡ã??¨ª?¨½']
							lib.LoadPNG(90, pic* 2 , bx*160+bx*212,by*370+by*33.5, 2)
						end				
					        lib.LoadPNG(91, 26 * 2 , 0,0, 1)																			
							if tsrw[mid] ~= nil then 
								local tid = tsrw[mid]
								local pic = JY.Person[tid]['?¡¦?¨½?¨²??']
								
								local hh = 0
								for k = 1,2 do 
									if JY.Person[tid]['????'..k] > 0 then 
										local kf = JY.Person[tid]['????'..k]
										DrawString(x2+bx*212,by*528+(hh)*by*41+by*33.5,JY.Wugong[kf]['????'],C_WHITE,size*0.9);
										hh = hh + 1
									end
								end
								
							--	lib.PicLoadFile(string.format(CC.FightPicFile[1],pic),
							--	string.format(CC.FightPicFile[2],pic), 89)
								
								local zs = 0
								local dl = 0
								for j=1,5 do
									if JY.Person[tid]['????????????'..j]>0 then
										if j>1 then
											zs = JY.Person[tid]['????????????'..j]
											break;
										end
										dl = dl+JY.Person[tid]['????????????'..j]*4
									end
								end
								
								lib.PicLoadCache(pic+101,(dl+dh+zs*3)*2,bx*890+bx*212,by*670+by*33.5)
								
								dh = dh + 1
								if dh == zs then
									dh = 1
								end
								local me = {}
								local row = 0
								local maxh = 15
								if TFJS[tid] ~= nil then
									local row = 0
									local maxh = 15
									for i = 1, #TFJS[tid] do
										me[#me+1] = TFJS[tid][i]
										if i == #TFJS[tid] then 
											me[#me+1] = "??"
										end
									end
								end
		
								if CC.PTF[tid] ~= nil then 
									for i,v in pairs(CC.PTF[tid]) do 
										if v == 1 then 
											if CC.PTFSM[i] ~= nil then
												me[#me+1] = '??'..CC.PTFSM[i][1]
												me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
												me[#me+1] = "??"
											end
										end
									end
								end
								
								for i = 1, #ZJZSJS do
									me[#me+1] = ZJZSJS[i]
									if i == #ZJZSJS then 
										me[#me+1] = "??"
									end
								end

								for i = star, #me do
									local tfstr = me[i]
									local h = 0
											
									if string.sub(tfstr,1,2) == "??" then
										row = row + 1
									else
										h = tjm(bx*300+bx*212, by*280 + size*0.8 * (row-fy)+by*33.5, tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
									end
									row = row + h
								end
		
								if row > maxh then
									fymax = limitX(row-maxh-1,0)
								else
									fymax = 0
								end
							end
						
					else
						lib.LoadPNG(90, JY.Person[mid]['¡ã??¨ª?¨½'] * 2 , bx*160+bx*212,by*370+by*33.5, 2)
						lib.LoadPNG(91, 26 * 2 , 0,0, 1)
						--
						--?¨§????????
						--
								
						local hh = 0
							for k = 1,2 do 
								if JY.Person[mid]['????'..k] > 0 then 
									local kf = JY.Person[mid]['????'..k]	
									DrawString(x2+bx*212,by*528+(hh)*by*41+by*33.5,JY.Wugong[kf]['????'],C_WHITE,size*0.9);
									hh = hh + 1
								end
							end
						local zs = 0
						local dl = 0
						for j=1,5 do
							if JY.Person[mid]['????????????'..j]>0 then
								if j>1 then
									zs = JY.Person[mid]['????????????'..j]
									break;
								end
								dl = dl+JY.Person[mid]['????????????'..j]*4
							end
						end
						
						lib.PicLoadCache(JY.Person[mid]["?¡¦?¨½?¨²??"]+101,(dl+dh+zs*3)*2,bx*890+bx*212,by*670+by*33.5)
						
						dh = dh + 1
						if dh == zs then
							dh = 0
						end
						
						local me = {}
						local row = 0
						local maxh = 15
						if TFJS[mid] ~= nil then
							local row = 0
							local maxh = 15
							for i = 1, #TFJS[mid] do
								me[#me+1] = TFJS[mid][i]
								if i == #TFJS[mid] then 
									me[#me+1] = "??"
								end
							end
						end
						if CC.PTF[mid] ~= nil then 
							for i,v in pairs(CC.PTF[mid]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '??'..CC.PTFSM[i][1]
										me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
										me[#me+1] = "??"
									end
								end
							end
						end

						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "??"
							end
						end
						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "??" then
								row = row + 1
							else
								h = tjm(bx*300+bx*212, by*280 + size*0.8 * (row-fy)+by*33.5, tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					
					end
				end
				
				DrawString(-1,by*660+by*33.5,'PageUp ??¡¦???  PageDown ??¡¦???',C_GOLD,size*0.7);
			end

		--if lb == 2 or lb == 3 then
			--?????¨§?¨¦???¨ª
			for i = 1,8 do
				for j = 1,2 do
					local id = i + (j-1)*8
					local cl = C_WHITE
					if cont == i and cont1 == j-1 and lb == 2 then
						cl = C_RED
					end	
					
					DrawString(x1+(i-1)*jg+bx*212,y1+(j-1)*by*40+by*33.5,menu1[id],cl,size);
				end
			end
		--end
		--???????????¨ª
		--if lb == 3 or lb == 2 then 
			for i = 1,6 do
				for j = 1,2 do
					local id = i + (j-1+coxt2)*6
					local cl = C_WHITE
					local mid = menu2[m][id]
					if mid ~= nil then
						if coxt + coxt1*6 == id and lb == 3 then
							cl = C_RED
						end	
						if m == '??¡Á??¡Â??' then
							DrawString(x2+(i-1)*bx*140+bx*212,y2+(j-1)*size+by*33.5,mid,cl,size*0.8);
						elseif m == '?????¡Â??' then
							DrawString(x2+(i-1)*bx*140+bx*212,y2+(j-1)*size+by*33.5,mid,cl,size*0.8);
						
						else
							DrawString(x2+(i-1)*bx*140+bx*212,y2+(j-1)*size+by*33.5,JY.Person[mid]['????'],cl,size*0.8);
						end
						
					end
				end
				
			end
			
		----------------
		--????????
		ShowScreen()
		--???¡¦???????¡§??????????
		lib.Delay(40)
		--X???¨¹????¡Á¡Â??ktype???¨®????¡Á¡Â??ktype = 3 ?¨²?¨ª¡Á¨®?¨¹??4?¨²?¨ª???¨¹??6????????7??????
		local X,ktype,mx,my = lib.GetKey()
		
		--???¨½?¨¹??enter?¨¹?????¡¦?¡§
		if X == VK_SPACE or X == VK_RETURN then 
			if lb == 2 then 
				lb = 3
			elseif lb == 3 then 
				if menu1[cont+cont1*8] == '??¡Á??¡Â??' then 
					lb = 4
				elseif menu1[cont+cont1*8] == '?????¡Â??' then 
						cx = tsrw[menu2[m][coxt + coxt1*6]]					
					break
				else
					cx = menu2[m][coxt + coxt1*6]
					break
				end
			elseif lb == 4 then 
				zj = coxt + coxt1*6
				local tt = 546 
				if xb == 1 then 
					tt = 555
				end
				JY.Person[0]['¡ã??¨ª?¨½'] = zj+tt
				break
			end	
		--esc???¨®?????¨¹????¡¦???
		elseif X == VK_ESCAPE or ktype == 4 then
			--???¡¦?¨¢????????
			if lb == 3 then
				lb = 2
				coxt = 1 
				coxt1 = 0 
				coxt2 = 0
				dh = 0
				fy = 0
				--return 0
			elseif lb == 4 or lb == 5 then 
				lb = 3
				--return 0
			end
		elseif X == VK_UP then
			if lb == 2 then 
				if cont1 == 1 then 
					cont1 = 0
				else
					cont1 = 1
				end
			elseif lb == 3 then
				if coxt1 > 0 then
					if coxt1 == coxt2 then
						coxt2 = limitX(coxt2 - 1,0)
					end
					coxt1 = coxt1 - 1
				else 
					coxt = 1
				end
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end

		elseif X == VK_DOWN then
			if lb == 2 then 
				if cont1 == 1 then 
					cont1 = 0
				else
					cont1 = 1
				end
			elseif lb == 3 then
				if coxt + coxt1*6 < #menu2[menu1[cont+cont1*8]] then
					if coxt1 < math.ceil(#menu2[menu1[cont+cont1*8]]/6) - 1 then 
						coxt1 = coxt1 + 1 
						if coxt + coxt1*6 > #menu2[menu1[cont+cont1*8]] then
							coxt = #menu2[menu1[cont+cont1*8]] - coxt1*6
						end
					else 
						coxt = #menu2[menu1[cont+cont1*8]] - coxt1*6
					end
					if coxt1 - coxt2 > 1 then
						coxt2 = coxt2 + 1
					end
				end
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end
		elseif X == VK_LEFT or ktype == 6 then
			if lb == 2 then 
				if cont1 > 0 then
					if cont > 1 then
						cont = cont - 1 
					else 
						cont = 8
						cont1 = 0					
					end
				else 
					if cont > 1 then
						cont = cont - 1 	
					else 
						cont = 8
						cont1 = 1
					end
				end
			elseif lb == 3 then 
				if coxt > 1 then 
					coxt = coxt - 1
				else
					if coxt1 > 0 then 
						if coxt1 == coxt2 then
							coxt2 = limitX(coxt2 - 1,0)
						end
						coxt1 = coxt1 - 1
						coxt = 6
					end
				end	
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end			
		elseif X == VK_RIGHT or ktype == 7 then
			if lb == 2 then 
				if cont1 < 1 then 
					if cont < 8 then 
						cont = cont + 1 
					else 
						cont = 1
						cont1 = 1
					end
				else 
					if cont < 8 then 
						cont = cont + 1 
					else 
						cont = 1
						cont1 = 0
					end
				end
			elseif lb == 3 then 
				if coxt + coxt1*6 < #menu2[menu1[cont+cont1*8]] then
					if coxt < 6 then 
						coxt = coxt + 1
					else
						if coxt1 < math.ceil(#menu2[menu1[cont+cont1*8]]/6) - 1 then 
							coxt = 1 
							coxt1 = coxt1 + 1
						end	
					end	
					if coxt1 - coxt2 > 1 then
						coxt2 = coxt2 + 1
					end
				end
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end	
		elseif X == VK_PGUP then
			if lb == 3 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X == VK_PGDN then
			if lb == 3 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
			
		else 
			local mxx = false
			if lb == 2 then 
				for i = 1,8 do
					for j = 1,2 do
						local id = i + (j-1)*8
						if mx >= x1+(i-1)*jg+bx*212 and mx <= x1+(i-1)*jg + size*#menu1[id]/2+bx*212 and 
							my >= y1+(j-1)*by*40+by*33.5 and my <= y1+(j-1)*by*40 + size+by*33.5 then
							cont = i 
							cont1 = j-1
							mxx = true
							break
						end
					end
					if mxx == true then 
						break
					end
				end
			elseif lb == 3 then 
				for i = 1,6 do 
					for j = 1,2 do
						local s = i + (j-1+coxt2)*6
						local mid = menu2[m][s]
						local s = 0
						if mid ~= nil then
							if m == '??¡Á??¡Â??' or m == '?????¡Â??' then
								s = #mid*(size*0.8)/2
							else 
								local name = JY.Person[mid]['????']
								s = #name*(size*0.8)/2
							end
						end
						if mx >= x2+(i-1)*bx*140+bx*212 and mx <= x2+(i-1)*bx*140 + s+bx*212 and 
							my >= y2+(j-1)*size*0.8+by*33.5 and my <= y2+(j-1)*size + size*0.8+by*33.5 then 
							if mid ~= nil then 
								coxt = i
								coxt1 = j - 1 + coxt2
								mxx = true
								dh = 0
								break
							end
						end	
					end
					if mxx == true then 
						break
					end
				end	
			elseif lb == 4 then 
				mxx = true
			end--0,0
			if mxx == true and ktype == 3 then 
				if lb == 2 then 
					lb = 3
				elseif lb == 3 then 
					if menu1[cont+cont1*8] == '??¡Á??¡Â??' then 
						lb = 4
					elseif menu1[cont+cont1*8] == '?????¡Â??' then 
							cx = tsrw[menu2[m][coxt + coxt1*6]]
						break
					else
						cx = menu2[m][coxt + coxt1*6]
						if showCXStatic(cx) then						
						break
					end
                end
				elseif lb == 4 then 
				zj = coxt + coxt1*6
				local tt = 546 
				if xb == 1 then 
					tt = 555
				end
				JY.Person[0]['¡ã??¨ª?¨½'] = zj+tt
				break
				end	
			end
		end
		
	end
	return cx,zj,ts,xb
end

function tjm(x,y,str,color,size,xnum,hnum,first,last)
	if xnum == nil then 
		xnum = #str
	end  
 
	if x==-1 then
		local ll=#str;
		local w=size*ll/2+2*CC.MenuBorderPixel;
		x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end

	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
	
	local ynum=size
	local T2={};
	T2["??"] = PinkRed
	T2["??"] = LimeGreen
	T2["??"] = C_BLACK
	T2["?¡Á"] = C_WHITE
	T2["??"] = C_ORANGE
	T2["??"] = M_DeepSkyBlue
	T2["??"] = Violet
	T2['??'] = C_GOLD
	local cx,cy=0,0;
	--local sid=lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH);
	while string.len(str)>=1 do
		if JY.Restart == 1 then
			break
		end
		local try=string.sub(str,1,1)
		local control=false;

		local hs = size+CC.RowPixel
		if hnum ~= nil then 
			hs = hnum
		end
		if string.byte(try)>127 then --????
			local s=string.sub(str,1,2);
			str=string.sub(str,3,-1);

			if T2[s] ~= nil then 
				--if s ~= "?¡Á" then
					color = T2[s]
				--else
					--color = C_BLACK
				--end	
				control = true;
			end
            
			if not control then
                if s == '*' then 
                   -- cy = cy + 1 
                  --  cx = 0
                else
                    if first ~= nil then
                        if last ~= nil then
                            if cy >= first and cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            if cy >= first then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end	  
                        end
                    else 
                        if last ~= nil then
                            if cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end		  
                    end
                    cx=cx+1;
                end
			end
		else
			local s=try
			str=string.sub(str,2,-1);
            if s == '??' or s == '*' then 
                cy = cy + 1 
                cx = 0
            else
                if first ~= nil then
                    if last ~= nil then
                        if cy >= first and cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        if cy >= first then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end	  
                    end
                else 
                    if last ~= nil then
                        if cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                    end		  
                end
                cx=cx+1;
            end
			
		end

		if not control then

			if cx > xnum then
				cx = 0;
				--¡Á????¨¢????????????????
				if string.len(str) >= 1 then 
					cy = cy + 1;
				end
			end
		end

	end

	--lib.FreeSur(sid);
	return cy+1
end

function tjm1(x,y,str,color,size,xnum,hnum,first,last)
	if xnum == nil then 
		xnum = #str
	end  
 
	if x==-1 then
		local ll=#str;
		local w=size*ll/2+2*CC.MenuBorderPixel;
		x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end

	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
	
	local ynum=size
	local T2={};
	T2["??"] = PinkRed
	T2["??"] = LimeGreen
	T2["??"] = C_BLACK
	T2["?¡Á"] = C_WHITE
	T2["??"] = C_ORANGE
	T2["??"] = M_DeepSkyBlue
	T2["??"] = Violet
	T2['??'] = C_GOLD
	local cx,cy=0,0;
	--local sid=lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH);
	while string.len(str)>=1 do
		if JY.Restart == 1 then
			break
		end
		local try=string.sub(str,1,1)
		local control=false;

		local hs = size+CC.RowPixel
		if hnum ~= nil then 
			hs = hnum
		end
		if string.byte(try)>127 then --????
			local s=string.sub(str,1,2);
			str=string.sub(str,3,-1);

			if T2[s] ~= nil  then 
				if T2[s] == C_WHITE then
					color = C_BLACK
				elseif T2[s] == Violet then
					color = M_Red
				else
					color = T2[s]
				end	
				
				--else
					--color = C_BLACK
				--end	
				control = true;
			end
            
			if not control then
                if s == '*' then 
                   -- cy = cy + 1 
                  --  cx = 0
                else
                    if first ~= nil then
                        if last ~= nil then
                            if cy >= first and cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            if cy >= first then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end	  
                        end
                    else 
                        if last ~= nil then
                            if cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end		  
                    end
                    cx=cx+1;
                end
			end
		else
			local s=try
			str=string.sub(str,2,-1);
            if s == '??' or s == '*' then 
                cy = cy + 1 
                cx = 0
            else
                if first ~= nil then
                    if last ~= nil then
                        if cy >= first and cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        if cy >= first then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end	  
                    end
                else 
                    if last ~= nil then
                        if cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                    end		  
                end
                cx=cx+1;
            end
			
		end

		if not control then

			if cx > xnum then
				cx = 0;
				--¡Á????¨¢????????????????
				if string.len(str) >= 1 then 
					cy = cy + 1;
				end
			end
		end

	end

	--lib.FreeSur(sid);
	return cy+1
end

function tjm2(str,xnum)
	if xnum == nil then 
		xnum = #str
	end  
 
	local T2={};

	T2["??"] = PinkRed
	T2["??"] = LimeGreen
	T2["??"] = C_BLACK
	T2["?¡Á"] = C_WHITE
	T2["??"] = C_ORANGE
	T2["??"] = M_DeepSkyBlue
	T2["??"] = Violet
	T2['??'] = C_GOLD

	local cx,cy=0,0;
    --local color 
	while string.len(str)>=1 do
		if JY.Restart == 1 then
			break
		end
		local try=string.sub(str,1,1)
		local control=false;

		if string.byte(try)>127 then --????
			local s=string.sub(str,1,2);
			str=string.sub(str,3,-1);

			if T2[s] ~= nil then 
				--color = T2[s]
				control = true;
			end
            
			if not control then
                if s == '??' then 

                else
                    cx=cx+1;
                end
			end

		else
			local s=try
			str=string.sub(str,2,-1);
            if s == '??' or s == '*' then 
                cy = cy + 1 
                cx = 0
            else

                cx=cx+1;
            end
			
		end

		if not control then

			if cx > xnum then
				cx = 0;
				--¡Á????¨¢????????????????
				if string.len(str) >= 1 then 
					cy = cy + 1;
				end
			end
		end

	end

	return cy+1
end

function tjmsave(id)
	CC.TJMSJ = {} 
	CC.TJM = 0

	for i = 1,#CC.TXM do
		CC.TJMSJ[#CC.TJMSJ+1] = CC.TX[CC.TXM[i]]
		CC.TJM = CC.TJM + 1
	end
	
	local tg = 0
	for i,v in pairs(CC.TG) do 
		tg = tg + 1
	end 
	
	CC.TJMSJ[#CC.TJMSJ+1] = tg
	CC.TJM = CC.TJM + 1
	
	for i,v in pairs(CC.TG) do 
		CC.TJMSJ[#CC.TJMSJ+1] = i
		CC.TJM = CC.TJM + 1
	end
	
	CC.TJMSJ[#CC.TJMSJ+1] = #CC.TGJL
	CC.TJM = CC.TJM + 1
	
	for i = 1,#CC.TGJL do
		CC.TJMSJ[#CC.TJMSJ+1] = CC.TGJL[i]
		CC.TJM = CC.TJM + 1
	end

	CC.TJMSJ[#CC.TJMSJ+1] = CC.Gold
	CC.TJM = CC.TJM + 1

	--CC.SP = JY.Base["?¨¦??"]
	CC.TJMSJ[#CC.TJMSJ+1] = CC.Sp
	CC.TJM = CC.TJM + 1

	CC.TJMSJ[#CC.TJMSJ+1] = CC.Jl
	CC.TJM = CC.TJM + 1

    for i = 0,CC.PerNum do 
        if CC.PTF[i] ~= nil then
            local n = CC.TJM + 1
            local m = 0
            CC.TJMSJ[#CC.TJMSJ+1] = 0
            CC.TJM = CC.TJM + 1
            for j,k in pairs(CC.PTF[i]) do 
                CC.TJMSJ[#CC.TJMSJ+1] = j
                CC.TJM = CC.TJM + 1
                m = m + 1
            end
            CC.TJMSJ[n] = m
        else 
            CC.TJMSJ[#CC.TJMSJ+1] = 0
            CC.TJM = CC.TJM + 1
        end
    end

	local fp_tmp=io.open(CONFIG.DataPath..'save/tjm',"w");
	
	if fp_tmp then
		fp_tmp:close();
		local data_header=Byte.create(4);
		Byte.set32(data_header,0, CC.TJM);
		Byte.savefile(data_header,CONFIG.DataPath..'save/tjm', 0, 4);
		local data_keys=Byte.create(4*CC.TJM);
		for i=0,CC.TJM-1 do
			Byte.set32(data_keys, i*4, CC.TJMSJ[i+1]);
		end
		Byte.savefile(data_keys, CONFIG.DataPath..'save/tjm', 4, 4*CC.TJM);
	end
	CC.TJMSJ = {} 
	CC.TJM = 0
end

function tjmload(id)
	CC.TJMSJ = {} 
	CC.TJM = 0
	local fp_tmp=io.open(CONFIG.DataPath..'save/tjm',"r");
	if fp_tmp then
		fp_tmp:close();
   
		local data_header=Byte.create(4);
   
		Byte.loadfile(data_header,CONFIG.DataPath..'save/tjm', 0, 4);
   
		CC.TJM=Byte.get32(data_header,0);
   
		local data_keys=Byte.create(4*CC.TJM);
   
		Byte.loadfile(data_keys,CONFIG.DataPath..'save/tjm', 4, 4*CC.TJM);
		
		for i=0,CC.TJM-1 do
			CC.TJMSJ[i+1]=Byte.get32(data_keys, i*4);
		end
		
		CC.TJM = 1
		
		for i = 1,#CC.TXM do
			CC.TX[CC.TXM[i]] = CC.TJMSJ[CC.TJM]
			CC.TJM = CC.TJM + 1
		end
		
		local tg = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
		for i = 1,tg do
			local v = CC.TJMSJ[CC.TJM]
			CC.TG[v] = 1
			CC.TJM = CC.TJM + 1
		end
		
		local tgjl = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
		for i = 1,tgjl do
			CC.TGJL[i] = CC.TJMSJ[CC.TJM]
			CC.TJM = CC.TJM + 1
		end
        
        CC.Gold = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1

        CC.Jl = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
		--CC.Sp = JY.Base["?¨¦??"]
		CC.Sp = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
        for i = 0,CC.PerNum do
            local n = CC.TJMSJ[CC.TJM]
            CC.TJM = CC.TJM + 1
            CC.PTF[i] = {}
            for j = 1,n do
                local tf = CC.TJMSJ[CC.TJM]
                CC.TJM = CC.TJM + 1
                CC.PTF[i][tf] = 1
            end
        end
	end
	Weekload()
	CC.TJMSJ = {} 
	CC.TJM = 0
end

--?????¨§????n == 1?¨ª??????nil?¨ª????
function SetTF(i,tf,n)
    local zjtf = false
	local npctf = false
	local limit = 0
	if CC.PTFSM[tf][1] == nil then
		do return end
	end	
	if n ~= nil then
		for k, v in pairs(CC.PTF[i]) do
			if v == 1 then
				limit = limit + 1
			end	
		end
		if limit < 10 then
			if i == 0 then
				if DrawStrBoxYesNo(-1, -1,JY.Person[i]['????'].."??¡¦¨½???¡ì?¡ã"..CC.PTFSM[tf][1].."?¨§????", C_WHITE, CC.DefaultFont) then
					CC.PTF[i][tf] = n
					QZXS(JY.Person[i]['????'].."?¨½??"..CC.PTFSM[tf][1].."?¨§??")
				end
			else
				CC.PTF[i][tf] = n
				QZXS(JY.Person[i]['????'].."?¨½??"..CC.PTFSM[tf][1].."?¨§??")
				if JY.Base['????'] == i then
					if DrawStrBoxYesNo(-1, -1,'????'..JY.Person[0]['????'].."??¡¦¨½???¡ì?¡ã"..CC.PTFSM[tf][1].."?¨§????", C_WHITE, CC.DefaultFont) then
						CC.PTF[0][tf] = n
						QZXS('????'..JY.Person[0]['????'].."?¨½??"..CC.PTFSM[tf][1].."?¨§??")
					end
				end			
			end	
		end	
	else
		CC.PTF[i][tf] = nil
		QZXS(JY.Person[i]['????'].."???¨¹"..CC.PTFSM[tf][1].."?¨§??")
		if JY.Base['????'] == i then
			CC.PTF[i][tf] = nil
			QZXS('????'..JY.Person[i]['????'].."???¨¹"..CC.PTFSM[tf][1].."?¨§??")
		end
	end	
	--[[if i == 0 and CC.TG[tf] == nil then	
		for k, v in pairs(CC.TG) do
			limit = limit + 1
		end
		if TFJS[i] ~=nil then
			limit = limit + 1
		end	
		if limit < 9 then
			if DrawStrBoxYesNo(-1, -1,JY.Person[0]['????'].."??¡¦¨½???¡ì?¡ã"..CC.PTFSM[tf][1].."?¨§????", C_WHITE, CC.DefaultFont) then  --??/¡¦¨½
				CC.TG[tf] = n
				QZXS(JY.Person[0]['????'].."?¨½??"..CC.PTFSM[tf][1].."?¨§??")
			end	
		end
	elseif i ~= 0 then
		if CC.PTF[i] == nil then 
			CC.PTF[i] = {}
		end
		CC.PTF[i][tf] = n
		QZXS(JY.Person[i]['????'].."?¨½??"..CC.PTFSM[tf][1].."?¨§??")	
		if JY.Base['????'] == i and CC.TG[tf] == nil then
			for k, v in pairs(CC.TG) do
				limit = limit + 1
			end
			if TFJS[i] ~=nil then
				limit = limit + 1
			end	
			if limit < 9 then
				if DrawStrBoxYesNo(-1, -1,JY.Person[0]['????'].."??¡¦¨½???¡ì?¡ã"..CC.PTFSM[tf][1].."?¨§????", C_WHITE, CC.DefaultFont) then  --??/¡¦¨½
					CC.TG[tf] = n
					QZXS('????'..JY.Person[0]['????'].."?¨½??"..CC.PTFSM[tf][1].."?¨§??")
				end
			end	
		end	
	else	
	end]]
end

function ShowStatus()
	local day = {
	{1, "????"},
	{2, "????"},
	{3, "????"},
	{4, "????"},
	{5, "????"},
	{6, "????"},
	{7, "????"},
	{8, "??¡ã?"},
	{9, "????"},
	{10, "????"},
	{11, "????"},
	{12, "????"},
	{13, "????"},
	{14, "????"},
	{15, "????"},
	{16, "????"},
	{17, "????"},
	{18, "??¡ã?"},
	{19, "????"},
	{20, "????"},
	{21, "????"},
	{22, "????"},
	{23, "????"},
	{24, "????"},
	{25, "????"},
	{26, "????"},
	{27, "????"},
	{28, "??¡ã?"},
	{29, "????"},
	{30, "????"},  
  }
  
  local month = {
	{1, "?¨²??"},
	{2, "????"},
	{3, "????"},
	{4, "????"},
	{5, "????"},
	{6, "????"},
	{7, "????"},
	{8, "????"},
	{9, "????"},
	{10, "????"},
	{11, "¡Á???"},
	{12, "?¨®??"}, 
  }
  
  local year = {
	{1, "?¡Á¡Á?"},
	{2, "???¨®"},
	{3, "???¨²"},
	{4, "????"},
	{5, "?¨§??"},
	{6, "????"},
	{7, "????"},
	{8, "????"},
	{9, "????"},
	{10, "????"},
	{11, "?¡Á??"},
	{12, "????"},
	{13, "??¡Á?"},
	{14, "???¨®"},
	{15, "?¨§?¨²"},
	{16, "????"},
	{17, "????"},
	{18, "????"},
	{19, "????"},
	{20, "????"},
	{21, "?¡Á??"},
	{22, "????"},
	{23, "????"},
	{24, "????"},
	{25, "?¨§¡Á?"},
	{26, "???¨®"},
	{27, "???¨²"},
	{28, "????"},
	{29, "????"},
	{30, "????"},
	{31, "?¡Á??"},
	{32, "????"},
	{33, "????"},
	{34, "????"},
	{35, "?¨§??"},
	{36, "????"},
	{37, "??¡Á?"},
	{38, "???¨®"},
	{39, "???¨²"},
	{40, "???¨®"},
	{41, "?¡Á??"},
	{42, "????"},
	{43, "????"},
	{44, "????"},
	{45, "?¨§??"},
	{46, "????"},
	{47, "????"},
	{48, "????"},
	{49, "??¡Á?"},
	{50, "???¨®"},
	{51, "?¡Á?¨²"},
	{52, "????"},
	{53, "????"},
	{54, "????"},
	{55, "?¨§??"},
	{56, "????"},
	{57, "????"},
	{58, "????"},
	{59, "????"},
	{60, "????"},
  }

	--????
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	--??¡Á??¨®??
	local size = CC.DefaultFont*0.6
	--??¡Á??¨®??2
	local size2 = CC.DefaultFont*0.55
	--?¨²?¨¹¡Á???
	local x1,y1 = bx*183,bx*41
	--????¡Á???
	local x2,y2 = bx*183,bx*59
	--?¡¦?¨½¡Á???
	local x3,y3 = bx*56,bx*51
	--????¡Á???
	local x4,y4 = bx*152,bx*20
	--????¡Á???
	local x5,y5 = bx*235,bx*20
	--????¡Á???
	local x6,y6 = bx*135,bx*82
	--?¨§?¨¦¡Á???
	local x7,y7 = bx*215,bx*82
	--????¡Á???
	local x8,y8 = bx*40,bx*110
	--?¨²?¨¹?????¨®??
	local w = bx*78
	local h = bx*7
	--?¨²?¨¹
	local sm = JY.Person[0]['?¨²?¨¹']
	--????
	local nl = JY.Person[0]['????']
	--¡Á??¨®?¨²?¨¹
	local smmax = JY.Person[0]['?¨²?¨¹¡Á??¨®??']
	--¡Á??¨®????
	local nlmax = JY.Person[0]['????¡Á??¨®??']
	--?¡¦?¨½????
	local hid = JY.Person[0]['¡ã??¨ª?¨½']
	--????
	local name = JY.Person[0]['????']
	--????
	local zm = JY.Base["????"]..'????'
	--????????
	local sx = {'??','??','?¡Â??','?¨§??'}
	local sxcl = {LightPurple,C_CYGOLD,M_Gray,M_Red}
	--????????
	local nlsx = sx[JY.Person[0]['????????']+1]
	local nlcl = sxcl[JY.Person[0]['????????']+1]
	--?¨²?¨¹??¡Á?
	local smwz = sm..'/'..smmax
	--??????¡Á?
	local nlwz = nl..'/'..nlmax..'?¡§'..nlsx..'??'
	--????
	local yl = CC.Gold
	--?¨§?¨¦
	local ts = JY.Base["?¨§?¨¦????"]..'??'
	
	--????
	local tnd = math.fmod(JY.Base["????"],#MODEXZ2);
	if tnd == 0 then
		tnd = #MODEXZ2
	end
	tnd = MODEXZ2[tnd]
	
	--???¡§
	local yxms
	if JY.Base["???¡§"] == 0 then
		yxms = "???¡§"
	elseif JY.Base["???¡§"]==1 then
		yxms = "???¡§"
	else
		yxms = "?¨¦??"
	end
	
	--????
	local t = math.modf((lib.GetTime() - JY.LOADTIME) / 60000 + GetS(14, 2, 1, 4))
	local t1, t2 = 0, 0
	while t >= 60 do
		t = t - 60
		t1 = t1 + 1
	end
	
	t2 = t
	
	  --????????¡Á¡§??
	local t3 = math.modf((lib.GetTime() - JY.LOADTIME) / 60000 + GetS(14, 2, 1, 4))
	local t4, t5 = 0, 0
	while t3 >= 60 do
	t3 = t3 - 60
	t4 = t4 + 1
	end
	t5 = t3
	SetS(92,60,21,5,t4)
	SetS(92,60,22,5,t5)
	if GetS(92,60,23,5)==1 then
	SetS(92,60,24,5,t4)
	SetS(92,60,25,5,t5)
	SetS(92,60,23,5,0) 
	end
	if GetS(92,60,13,5)==0 and GetS(92,60,12,5)==1 then 
	local boss=JY.Person[GetS(92,60,16,5)]["????"]
	local DD=JY.Scene[GetS(92,60,14,5)]["????"]
	--lib.PicLoadCache(0,76*2,40, 110, 2, 256); 
	lib.LoadPNG(91,129*2,x8-40,y8-size2/2+115, 1);
	lib.LoadPNG(91,130*2,x8-15,y8-size2/2+110, 1);
	DrawString(x8,y8-size2/2+115, boss, C_RED, 20)
	DrawString(x8+85,y8-size2/2+115, "??"..DD.."??????", M_YellowGreen, 20)

	end

	
	--???????¡§????????
	local xx1 = string.format("%2d??%2d¡¦?", t1, t2)
	local xx = tnd..'/'..yxms..'/'.."????"..JY.Person[0]['?¡¦??']
	if JY.Person[456]['????????'] > 0 then
		xx = xx..'/'..'????'
	else
		xx = xx..'/'..'????'
	end		
	lib.LoadPNG(91, 39*2, 0, 0, 1)
	--?¡¦?¨½????
	lib.LoadPNG(1, hid*2, x3, y3, 2)
		
	--???¡ã??
	lib.LoadPNG(91, 40*2, 0, 0, 1)
	--?¨²?¨¹??
	lib.SetClip(x1-w,y1-h,(x1-w)+(w*2)*(sm/smmax),y1+h)
	lib.LoadPNG(91, 41*2, x1, y1, 2)
	lib.SetClip(0,0,0,0)
	--??????
	lib.SetClip(x2-w,y2-h,(x2-w)+(w*2)*(nl/nlmax),y2+h)
	lib.LoadPNG(91, 42*2, x2, y2, 2)
	lib.SetClip(0,0,0,0)
	
	--????
	DrawString(x4-string.len(name)/4*size-10,y4-size/2,name,C_BLACK,size)
	--????
	DrawString(x5-string.len(zm)/4*size2-10,y5-size/2,zm,LightYellow2,size2)
	--?¨²?¨¹
	DrawString(x1-string.len(smwz)/4*size2,y1-size2/2,smwz,C_WHITE,size2)
	--????
	DrawString(x2-string.len(nlwz)/4*size2,y2-size2/2,nlwz,nlcl,size2)
	--????
	DrawString(x6,y6-size2/2,yl,C_WHITE,size2)
	--?¨§?¨¦
	DrawString(x7,y7-size2/2,ts,C_WHITE,size2)
	--???????¡§????????
	DrawString(x8+42,(y8-size2/2)-2,xx,C_WHITE,size2*0.95)
	--????
	--[[local t =CC.weekday[os.date("%A", os.time())][1]
	DrawString(x8-40,y8-size2/2+55,os.date("%Y??%m??%d?? %H:%M ", os.time())..t,C_GOLD,size2*1.1)
	DrawString(x8-40,y8-size2/2+70,"???¡¦????"..xx1,C_GOLD,size2*1.1)
	
	local t = math.modf((lib.GetTime() - JY.LOADTIME) / 60000 + GetS(14, 2, 1, 4))
	local dd, mm, yy = 1, 1, 1
	while t >= 360 do
	t = t - 360
	yy = yy + 1
	end

	while t >= 30 do
	t = t - 30
	mm = mm + 1
	end 
	dd = dd + t
	JY.YEAR = yy
	JY.MONTH = mm
	JY.DAY = dd
	--DrawBox(x8-40,y8-size2/2+90, 255, 95, C_GOLD)
	
	
	DrawString(bx,y8-size2/2+90, year[yy][2].."?? "..month[mm][2].." "..day[dd][2], M_Orange, 20)]]
	
	MMapName()
end

function Cat(s,...)
	if not Ct[s] then 
		lib.Debug('?¨ª?¨®??????????')
	end
	return Ct[s](...)
end

function MJMenu() 
	local thing = {}
	local thingnum = {}
	for i = 0, CC.MyThingNum - 1 do
		thing[i] = -1
		thingnum[i] = 0
	end
	local num = 0
	for i = 0, CC.MyThingNum - 1 do
		local id = JY.Base["???¡¦" .. i + 1]
		if id >= 0 then
			if JY.Thing[id]["????"] == 2 then
				thing[num] = id
				thingnum[num] = JY.Base["???¡¦????" .. i + 1]
				num = num + 1
			end
		end 
	end

	IsViewingKungfuScrolls = 1

	local r = SelectThing(thing, thingnum)
	if r >= 0 then
		UseThing(r)
		return 1
	end
	return 0
end

function ThingMenu(flag)

		local thing = {}
		local thingnum = {}
		for i = 0, CC.MyThingNum - 1 do
			thing[i] = -1
			thingnum[i] = 0
		end
		local num = 0
		for i = 0, CC.MyThingNum - 1 do
			local id = JY.Base["???¡¦" .. i + 1]
			if id >= 0 then
				if flag == nil then 
					thing[num] = id
					thingnum[num] = JY.Base["???¡¦????" .. i + 1]
					num = num + 1
				else 	
					if JY.Thing[id]["????"] == flag then
						thing[num] = id
						thingnum[num] = JY.Base["???¡¦????" .. i + 1]
						num = num + 1
					end
				end
			end 
		end

		--IsViewingKungfuScrolls = 1

		local r = SelectThing(thing, thingnum)
		if r >= 0 then
			UseThing(r)	
			return 1
		end
		return 0
end

function Team(tab)
    local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*0.7
	local size1 = CC.DefaultFont*0.6
	local size2 = CC.DefaultFont*0.55
	local cont = 1 
	local cont1 = 0
	local tru = 0
	local p = JY.Person
	local px = 0
	local zbx1,zby1 = -40,40
	while true do 
		Cls()
		if JY.Restart == 1 then
			break
		end
		local menu = {} 
		local maxn = 6
		local i = 0
		for ii = 1,CC.TeamNum do 
			if JY.Base['???¨¦'..ii] >= 0 then 
				menu[#menu+1] = {p[JY.Base['???¨¦'..ii]]['????'],JY.Base['???¨¦'..ii]}
			end
		end
		if maxn > #menu then 
			maxn = #menu 
		end	 
		--lib.PicLoadCache(92,9*2,0,0,1,nil,nil,bx*1360)
		lib.PicLoadCache(92,9*2,-1,-1,1,nil,nil,bx*936)

		for ii = 1,maxn do 
			local h = 0
			local pyx = 0
			if CC.Png[p[menu[ii+cont1][2]]['¡ã??¨ª?¨½']] ~= nil then 
				pyx = CC.Png[p[menu[ii+cont1][2]]['¡ã??¨ª?¨½']]
			end
			
			local sm = p[menu[ii+cont1][2]]['?¨²?¨¹']
			local smmax = p[menu[ii+cont1][2]]['?¨²?¨¹¡Á??¨®??']
			local nl = p[menu[ii+cont1][2]]['????']
			local nlmax = p[menu[ii+cont1][2]]['????¡Á??¨®??']
			local tl = p[menu[ii+cont1][2]]['????']
			local tlmax = 100
			local x1,y1 = lib.GetPNGXY(99,2*2)
			--lib.SetClip(bx*42+(ii-1)*bx*220, 0, bx*38+(ii-1)*bx*220+bx*197,by*768) --???????¡ã??
			lib.SetClip(bx*42+(ii-1)*bx*220+zbx1, 0, bx*38+(ii-1)*bx*220+bx*197+zbx1,by*768+zby1) --???????¡ã??
			--lib.LoadPNG(90,p[menu[ii+cont1][2]]['¡ã??¨ª?¨½']*2,bx*138+(ii-1)*bx*220-bx*pyx,by*250,2)
			lib.LoadPNG(90,p[menu[ii+cont1][2]]['¡ã??¨ª?¨½']*2,bx*138+(ii-1)*bx*220-bx*pyx+zbx1-x1*4,by*250+zby1-y1*4.4,1)
			lib.SetClip(0,0,0,0)
			
			--lib.PicLoadCache(92,15*2,bx*138+(ii-1)*bx*220,by*425,2,256,nil,bx*170)
			lib.PicLoadCache(92,15*2,bx*138+(ii-1)*bx*220+zbx1,by*425+zby1,2,256,nil,bx*170)
			--DrawString(bx*138+(ii-1)*bx*220-string.len(menu[ii+cont1][1])*size/4,by*440,menu[ii+cont1][1],C_WHITE,size)
			if ii == cont or px == ii then 
				--lib.PicLoadCache(92,10*2,bx*138+(ii-1)*bx*220, CC.ScreenH/2,2,256,nil,bx*200) --???????¡ã??
				lib.PicLoadCache(92,10*2,bx*138+(ii-1)*bx*220+zbx1, CC.ScreenH/2+zby1,2,256,nil,bx*200) 
			DrawString(bx*138+(ii-1)*bx*220-string.len(menu[ii+cont1][1])*size/4+zbx1,by*440+zby1,menu[ii+cont1][1],C_RED,size)
			else
			DrawString(bx*138+(ii-1)*bx*220-string.len(menu[ii+cont1][1])*size/4+zbx1,by*440+zby1,menu[ii+cont1][1],C_WHITE,size)
			end

			h = h + 1
			
			local tfid = menu[ii+cont1][2]
			if JY.Base['????'] > 0 and tfid == 0 then 
				tfid = JY.Base['????']
			end	
			if RWWH[tfid] ~= nil then 
				--DrawString(bx*60+(ii-1)*bx*220,by*440+h*by*30,'??????'..RWWH[tfid],LimeGreen,size)
				DrawString(bx*60+(ii-1)*bx*220+zbx1,by*440+h*by*30+zby1,'??????'..RWWH[tfid],LimeGreen,size)
			end
			
			h = h + 1
			
			if RWTFLB[tfid] ~= nil then 
				--DrawString(bx*60+(ii-1)*bx*220,by*440+h*by*30,'?¨§????'..RWTFLB[tfid],LimeGreen,size)
				DrawString(bx*60+(ii-1)*bx*220+zbx1,by*440+h*by*30+zby1,'?¨§????'..RWTFLB[tfid],LimeGreen,size)
			end
			
			h = h + 1
			
			--lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,256,nil,bx*160)
			
			--lib.SetClip(bx*138+(ii-1)*bx*220-bx*71, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(sm/smmax),by*450+h*by*30+size1/2+by*12)
			--lib.PicLoadCache(92,12*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,150,nil,bx*160)
			lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220+zbx1,by*450+h*by*30+size1/2+zby1,2,256,nil,bx*160)
			
			lib.SetClip(bx*138+(ii-1)*bx*220-bx*71+zbx1, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(sm/smmax)+zbx1,by*450+h*by*30+size1/2+by*12+zby1)
			lib.PicLoadCache(92,12*2,bx*138+(ii-1)*bx*220+zbx1,by*450+h*by*30+size1/2+zby1,2,150,nil,bx*160)
			lib.SetClip(0,0,0,0)

			--DrawString(bx*70+(ii-1)*bx*220,by*450+h*by*30,'?¨¹  '..p[menu[ii+cont1][2]]['?¨²?¨¹'],C_WHITE,size1)
			DrawString(bx*70+(ii-1)*bx*220+zbx1,by*450+h*by*30+zby1,'?¨¹  '..p[menu[ii+cont1][2]]['?¨²?¨¹'],C_WHITE,size1)
			h = h + 1
			
			--lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,256,nil,bx*160)
			--lib.SetClip(bx*138+(ii-1)*bx*220-bx*71, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(nl/nlmax),by*450+h*by*30+size1/2+by*12)
			--lib.PicLoadCache(92,13*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,150,nil,bx*160)
			lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220+zbx1,by*450+h*by*30+size1/2+zby1,2,256,nil,bx*160)
			lib.SetClip(bx*138+(ii-1)*bx*220-bx*71+zbx1, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(nl/nlmax)+zbx1,by*450+h*by*30+size1/2+by*12+zby1)
			lib.PicLoadCache(92,13*2,bx*138+(ii-1)*bx*220+zbx1,by*450+h*by*30+size1/2+zby1,2,150,nil,bx*160)
			lib.SetClip(0,0,0,0)

			--DrawString(bx*70+(ii-1)*bx*220,by*450+h*by*30,'??  '..p[menu[ii+cont1][2]]['????'],C_WHITE,size1)
			DrawString(bx*70+(ii-1)*bx*220+zbx1,by*450+h*by*30+zby1,'??  '..p[menu[ii+cont1][2]]['????'],C_WHITE,size1)
			h = h + 1
			
			--lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,256,nil,bx*160)
			--lib.SetClip(bx*138+(ii-1)*bx*220-bx*71, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(tl/tlmax),by*450+h*by*30+size1/2+by*12)
			--lib.PicLoadCache(92,14*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,150,nil,bx*160)
			lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220+zbx1,by*450+h*by*30+size1/2+zby1,2,256,nil,bx*160)
			lib.SetClip(bx*138+(ii-1)*bx*220-bx*71+zbx1, by*450+h*by*30+size1/2-by*12+zby1, bx*138+(ii-1)*bx*220-bx*71+bx*142*(tl/tlmax)+zbx1,by*450+h*by*30+size1/2+by*12)
			lib.PicLoadCache(92,14*2,bx*138+(ii-1)*bx*220+zbx1,by*450+h*by*30+size1/2+zby1,2,150,nil,bx*160)
			lib.SetClip(0,0,0,0)

			--DrawString(bx*70+(ii-1)*bx*220,by*450+h*by*30,'??  '..p[menu[ii+cont1][2]]['????'],C_WHITE,size1)
			DrawString(bx*70+(ii-1)*bx*220+zbx1,by*450+h*by*30+zby1,'??  '..p[menu[ii+cont1][2]]['????'],C_WHITE,size1)
		end
	  
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			tru = cont + cont1
			local id = JY.Base['???¨¦'..tru]
			if tab ~= nil then
				if tab[1] == '????' then
					if tru > 1 then
						if JY.SubScene == 55 and JY.Base["???¨¦" .. tru] == 35 then
						elseif JY.SubScene == 82 then	
						else
							local personid = JY.Base["???¨¦" .. tru]
							if CC.PersonExit[personid] ~= nil then 
								local v = CC.PersonExit[personid]
								CallCEvent(v)
							end
							if JY.Base["????"]==514 then		--615????
								instruct_21(personid)
								TalkEx(""..JY.Person[personid]["????"].."????????????¡Á???????*????????????????¡ã?????", 0, 2)  --???¡ã
							end
							cont = 1
							cont1 = 0
						end
					end
				elseif tab[1] == '¡Á???' then 
					--ShowPersonStatus(tru)
					PersonStatus(tru)
				elseif tab[1] == '???¨¾' then
					if px == 0 then
						if tru > 1 then 
							px = cont
						end
					else 
						if tru > 1 then
							JY.Base['???¨¦'..tru] = JY.Base['???¨¦'..px+cont1]
							JY.Base['???¨¦'..px+cont1] = id
							px = 0
						end
					end
				end
			else 
				break
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			if tab ~= nil then
				if tab[1] == '????' then 
					
					return nil
				end
			end
			if px > 0 then 
				px = 0 
			else 
				break
			end
		elseif X == VK_LEFT then
			if cont1 > 0 then 
				if cont > 1 then 
					cont = cont - 1
				else 
					cont1 = cont1 - 1	  
				end	
			else
				cont = cont - 1		
				if cont < 1 then 
					cont = maxn
					cont1 = #menu - cont
				end
			end
		elseif X == VK_RIGHT then
			cont = cont + 1		
			if cont > maxn then 
				cont = maxn
				cont1 = cont1 + 1
			end
			if cont1 + cont > #menu then 
				cont1 = 0
				cont = 1
			end
		elseif X == VK_UP or ktype == 6 then
			cont1 = cont1 - maxn
			cont = 1
			if cont1 < 0 then 
				cont1 = 0 
			end
		elseif X == VK_DOWN or ktype == 7 then
			cont1 = cont1 + maxn
			cont = maxn
			if cont1 + cont > #menu then 
				cont1 = #menu-cont
			end	
		else 
			local mxx = false
			for ii = 1,maxn do 
				if mx >= bx*33+(ii-1)*bx*220 and mx <= bx*30+(ii-1)*bx*220+bx*197 and 
					my >= by*55 and my <= by*710 then 
					cont = ii
					mxx = true
					break
				end
			end		
			if ktype == 3 and mxx == true then 
				tru = cont + cont1
				local id = JY.Base['???¨¦'..tru]
				if tab ~= nil then
			if tab[1] == '????' then
					if tru > 1 then
						if JY.SubScene == 55 and JY.Base["???¨¦" .. tru] == 35 then
						elseif JY.SubScene == 82 then	
						else
							local personid = JY.Base["???¨¦" .. tru]
							if CC.PersonExit[personid] ~= nil then 
								local v = CC.PersonExit[personid]
								CallCEvent(v)
							end
							if JY.Base["????"]==514 then		--615????
								instruct_21(personid)
								TalkEx(""..JY.Person[personid]["????"].."????????????¡Á???????*????????????????¡ã?????", 0, 2)  --???¡ã
							end
							cont = 1
							cont1 = 0
						end
					end
					elseif tab[1] == '¡Á???' then 
						--ShowPersonStatus(tru)
						PersonStatus(tru)
					elseif tab[1] == '???¨¾' then
						if px == 0 then
							if tru > 1 then 
								px = cont
							end
						else 
							if tru > 1 then
								JY.Base['???¨¦'..tru] = JY.Base['???¨¦'..px+cont1]
								JY.Base['???¨¦'..px+cont1] = id
								px = 0
							end
						end
					end
				else 
					break
				end
			end	
		end
	end  
	return tru
end

--???????????¡ã??????¡ã?¡¦???
function psxper(i,str,sz,flag) --flag 1?¨®??2????3????
	if i == nil or str == nil or sz == nil or flag == nil then
		return false
	end
	
	if JY.Status == GAME_WMAP then
		local id = WAR.Person[i]['????????']
		if str == '?¨²?¨¹' then
			if flag == 1 and psx(id,'?¨²?¨¹') > math.modf(psx(id,'?¨²?¨¹¡Á??¨®??')*sz) then
				return true
			elseif flag == 2 and psx(id,'?¨²?¨¹') < math.modf(psx(id,'?¨²?¨¹¡Á??¨®??')*sz) then
				return true
			elseif flag == 3 and psx(id,'?¨²?¨¹') == math.modf(psx(id,'?¨²?¨¹¡Á??¨®??')*sz) then
				return true
			end
		end
		if str == '????' then
			if flag == 1 and psx(id,'????') > math.modf(psx(id,'????¡Á??¨®??')*sz) then
				return true
			elseif flag == 2 and psx(id,'????') < math.modf(psx(id,'????¡Á??¨®??')*sz) then
				return true
			elseif flag == 3 and psx(id,'????') == math.modf(psx(id,'????¡Á??¨®??')*sz) then
				return true
			end
		end	
		if str == '????' then
			if flag == 1 and psx(id,'????') > math.modf(100*sz) then
				return true
			elseif flag == 2 and psx(id,'????') < math.modf(100*sz) then
				return true
			elseif flag == 3 and psx(id,'????') == math.modf(100*sz) then
				return true
			end
		end
	else
		return false
	end	
	return false
end


function Hp_Max(id)
	local p = JY.Person[id]
	local kflvl = 0
	local wgwl = 0
	local wgwl1 = 0
	local wgwl2 = 0
	local tz = 0
	tz = p["?¨²?¨¹???¡è"] + limitX(math.modf(p['????????5'] *0.005),0,4)
	local xl = 8 - p["????¡¦??¡Á"]+1
	if tz < 1 then
		tz = 1
	end	
	if p["?¡Â??????"] > 0 then
        local zy = p["?¡Â??????"] 
		for i = 1, JY.Base["????????"] do
			if p["????" .. i]== p["?¡Â??????"] then
				kflvl = p["????????" .. i]
				break
			end
		end
		if kflvl >= 1000 then
			kflvl = 11
		else
			kflvl = math.modf(kflvl/100)+1
		end
		wgwl2 = get_skill_power(id, p["?¡Â??????"], kflvl)	
        if (id == 0 and (JY.Base["??¡Á?"] == 6  or  JY.Base["????"] == 637 or  JY.Base["????"] == 27 or JY.Base["????"] == 189)) then
		    for i = 1, JY.Base["????????"] do
				if p["????" .. i]== p["?¨§??????"] then
					wgwl1 = get_skill_power(id, p["?¨§??????"], kflvl)
				end
			end	
		end
		if wgwl1 < wgwl2 then
           wgwl = wgwl2
		else
           wgwl = wgwl1
		end		
        if wgwl < 500 then 
            wgwl = 500
        end
		if Curr_NG(id,160) and (match_ID(id,9991) or (PersonKF(id,108) and PersonKF(id,177))) then
			wgwl = wgwl + 500
		end
		if Curr_NG(id,102) and (match_ID(id,9927) or (PersonKF(id,97) and PersonKF(id,199))) then
			wgwl = wgwl + 500
		end
		if PersonKF(id,203) then
			if (Curr_NG(id,203) and PersonKF(id,248) and PersonKF(id,99)) or JXPD(id,505,1) or JXPD(id,578,1) then
				wgwl = wgwl + 500
			else
				wgwl = wgwl + 200
			end
		end	
		if MPTX(id,19) and Curr_NG(id,375) then
			wgwl = wgwl + math.modf(MPDJ(id) * 200)
		end	
		if inteam(id) == false then
			p["?¨²?¨¹¡Á??¨®??"] = tz * p["????"] * 7 + tz*(wgwl/7) + JY.Base["????"]*JY.Base["????"]*xl
		else
			p["?¨²?¨¹¡Á??¨®??"] = tz * p["????"] * 7 + tz*(wgwl/7)
		end
		if MPPD(id) > 0 then
			local mptype = MPPD(id)
			p["?¨²?¨¹¡Á??¨®??"] = math.modf(p["?¨²?¨¹¡Á??¨®??"]*(CC.MPAttrib[mptype][8]))
		end
		if match_ID(id,9929) then
			p['?¨²?¨¹¡Á??¨®??']  = p['?¨²?¨¹¡Á??¨®??'] + 500
		end	
		p['?¨²?¨¹¡Á??¨®??'] = math.modf(p['?¨²?¨¹¡Á??¨®??'])	

		if p["?¨²?¨¹¡Á??¨®??"] > 12000 then p["?¨²?¨¹¡Á??¨®??"] = 12000 end 
		if p["?¨²?¨¹¡Á??¨®??"] < 10 then p["?¨²?¨¹¡Á??¨®??"] = 10 end
		if p["?¨²?¨¹"] >  p["?¨²?¨¹¡Á??¨®??"] then
         	p["?¨²?¨¹"] =  p["?¨²?¨¹¡Á??¨®??"]
		end
		if JY.Status ~= GAME_WMAP then
			AddPersonAttrib(id,'?¨²?¨¹',math.huge)
		else 
			p["?¨²?¨¹"] = limitX(p["?¨²?¨¹"],10,p["?¨²?¨¹¡Á??¨®??"])
		end	
	else	
		if inteam(id) == false then
			p["?¨²?¨¹¡Á??¨®??"] = tz * p["????"] * 3 + JY.Base["????"]*JY.Base["????"]*3
		else
			p["?¨²?¨¹¡Á??¨®??"] = tz * p["????"] * 3 
		end
		if id == 0 and JY.Base["??¡Á?"] == 6 then
            for i = 1, JY.Base["????????"] do
                if p["????" .. i]== p["?¨§??????"] then
                    kflvl = p["????????" .. i]
                    break
                end
            end
            if kflvl >= 1000 then
                kflvl = 11
            else
                kflvl = math.modf(kflvl/100)+1
            end
		    wgwl = get_skill_power(id, p["?¨§??????"], kflvl)
            if wgwl < 500 then 
                wgwl = 500
            end
            p["?¨²?¨¹¡Á??¨®??"] = tz  * p["????"]*5+tz*(wgwl/5)
		end
        if MPPD(id) > 0 then
			local mptype = MPPD(id)
			p["?¨²?¨¹¡Á??¨®??"] = math.modf(p["?¨²?¨¹¡Á??¨®??"]*(CC.MPAttrib[mptype][8]))
		end
		p['?¨²?¨¹¡Á??¨®??'] = math.modf(p['?¨²?¨¹¡Á??¨®??'])
		if p["?¨²?¨¹¡Á??¨®??"] > 12000 then p["?¨²?¨¹¡Á??¨®??"] = 12000 end	
		if p["?¨²?¨¹¡Á??¨®??"] < 100 then p["?¨²?¨¹¡Á??¨®??"] = 100 end
		if p["?¨²?¨¹"] >  p["?¨²?¨¹¡Á??¨®??"] then
         	p["?¨²?¨¹"] =  p["?¨²?¨¹¡Á??¨®??"]
		end
		if JY.Status ~= GAME_WMAP then
			AddPersonAttrib(id,'?¨²?¨¹',math.huge)
		else 
			p["?¨²?¨¹"] = limitX(p["?¨²?¨¹"],10,p["?¨²?¨¹¡Á??¨®??"])
		end		
	end
end

function tgsave(flag)
	
	local tgjl = 0
	local tg = 0
	local tgsize = 0
	if flag == nil then
		if CC.Week < 101 then
			if JY.Base["????"] == CC.Week then
				CC.Week = CC.Week + 100				
			end
		end
	end
	
	--CC.TGJL = {9973,9970,9972,9971,9996,9998,9987,9984,9968,9992}
	tg = #CC.TGJL
    
	tgjl = tgjl + tg

	tgjl = tgjl + #CC.commodity

	tgjl = tgjl + 4

	local size = (tgjl) * 4
	local data = Byte.create(size * 4)
	
	Byte.set32(data, 0, tgjl)
	--CC.Sp = JY.Base["?¨¦??"]
	Byte.set32(data, 4, CC.Sp)
	Byte.set32(data, 8, CC.Week)
	Byte.set32(data, 12, tg)
	tgsize = 16
	for i = 0,tg-1 do
		Byte.set32(data, tgsize, CC.TGJL[i+1]);
		tgsize = tgsize + 4
	end
	for i = 1,#CC.commodity do
		Byte.set32(data, tgsize, CC.commodity[i][3]);
        tgsize = tgsize + 4
		Byte.set32(data, tgsize, CC.commodity[i][5]);
        tgsize = tgsize + 4
	end
	Byte.savefile(data, CONFIG.DataPath..'TgJl', 0, size);

	CC.TJMSJ = {} 
	CC.TJM = 0
end

function tgload()

	local tgjl = 0
	local tg = 0
	local size = 0
	local tgsize = 0
	local fp_tmp=io.open(CONFIG.DataPath..'TgJl',"r");
	if fp_tmp then
		fp_tmp:close();
		
		local data_tgjl = Byte.create(4);
		Byte.loadfile(data_tgjl,CONFIG.DataPath..'TgJl', 0, 4);
		tgjl = Byte.get32(data_tgjl,0);
		size = (tgjl) * 4

		local data = Byte.create(size*4);
		Byte.loadfile(data,CONFIG.DataPath..'TgJl', 0, size);
		CC.Sp = Byte.get32(data,4);
		CC.Week = Byte.get32(data,8);
		tg = Byte.get32(data,12);
		tgsize = 16
		for i=1,tg do
			CC.TGJL[i]=Byte.get32(data, tgsize);
			tgsize = tgsize + 4
		end

		for i = 1,#CC.commodity do
			CC.commodity[i][3]=Byte.get32(data, tgsize);
            tgsize = tgsize + 4
			CC.commodity[i][5]=Byte.get32(data, tgsize);
			tgsize = tgsize + 4
		end

	end

end


function Weekload()
	local fp_tmp=io.open(CONFIG.DataPath..'TgJl',"r");
	if fp_tmp then
		fp_tmp:close();

		local data_Sp = Byte.create(4);
		Byte.loadfile(data_Sp,CONFIG.DataPath..'TgJl', 4, 4);
		CC.Sp = Byte.get32(data_Sp,0);

		local data_Week = Byte.create(4);
		Byte.loadfile(data_Week,CONFIG.DataPath..'TgJl', 8, 4);
		CC.Week = Byte.get32(data_Week,0);

	end
end



-- function GAME_START1()
	-- local bx = CC.ScreenW/1360
	-- local by = CC.ScreenH/768
    -- local tb = 1
    -- local page = 1
    -- local size = CC.DefaultFont*0.7
    -- JY.Base["????"] = 1
	-- local m = { {'???????¨½','????????'},
                -- {'???¡§','???¡§','?¨¦??'},
                -- {'?¨¾??','???¡§','?¡ì??','???¨¹'},
                -- {'??????'},
                -- }
    -- local sz = {{582,161,180},
                -- {556,328,120},
                -- {518,489,105},
                -- {818,656,0},
                -- }        

    -- local sm = {'?¡Á??¡¦????????????????¡¦????¡¦???????????????6???????¨¢??????????????????????????????????????¡Á???',
                -- '?¡Á???????¡¦?????¡Â???????????????????¨¢????????????¡Á??¡ã???????????¨§????¡¦¡§???¡¦???¨®??????¡Á????¡Â?????????????¡ã???????????????¡§?????¨½BB????',
                -- '?¡Á???????¡¦?????¡Â?????????????????¡Â???¨ª?????¨¦?????????????¨§???????¨¢?????????????¨¦????????????¨§?????'
				-- }
    -- local zmmax = CC.Week
    -- local w = math.modf(bx*350/size/0.96)
	-- while true do 
        -- if JY.Restart == 1 then
            -- break
        -- end	
		-- ClsN()
        -- local zm = JY.Base["????"]
        -- if page ==2 then 
            -- lib.LoadPNG(91,48*2,0,0,1)
            -- tjm(bx*52+bx*212,by*108+by*33.5,sm[tb],C_WHITE,size*0.96,w,size*1.6)
        -- else
            -- lib.LoadPNG(91,44*2,0,0,1)
            -- DrawString(bx*159-string.len(zm)/4*size+bx*212,by*433-size/2+by*33.5,zm,C_RED,size)
            -- DrawString(bx*159-string.len(zmmax)/4*size+bx*212,by*468-size/2+by*33.5,zmmax,C_RED,size)
            -- DrawString(bx*150+bx*212,by*504-size/2+by*33.5,m[3][JY.Base["????"]],C_RED,size)
            -- DrawString(bx*150+bx*212,by*538-size/2+by*33.5,m[2][JY.Base["???¡§"]+1],C_RED,size)
        -- end
        
        -- for i = 1,#m do 
            -- for j = 1,#m[i] do
                -- local cl = M_Wheat
                -- local s = m[i][j]
                -- if page == i then
                    -- if tb == j then 
                        -- cl = C_RED
                    -- end
                -- end
                -- DrawString(bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3]+bx*212,by*sz[i][2]-size/2+by*33.5,s,cl,size)
            -- end
        -- end
        

        -- ShowScreen()
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if page == 1 then 
                -- if tb == 1 then 
                    -- JY.Base["????"] = InputNum("???¨½????",1,zmmax);
                -- else
                 -- --   ZmShop()--zmStore()
                -- end
            -- elseif page == 2 then 
                -- JY.Base["???¡§"] = tb - 1
            -- elseif page == 3 then 
                -- JY.Base["????"] = tb
            -- elseif page == 4 then 
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then

		-- elseif X == VK_UP then
            -- page = page - 1 
            -- if page < 1 then 
                -- page = #m
            -- end
            -- tb = 1
        -- elseif X == VK_DOWN then
            -- page = page + 1 
            -- if page > #m then 
                -- page = 1
            -- end
            -- tb = 1
        -- elseif X == VK_LEFT then
            -- tb = tb - 1 
            -- if tb < 1 then 
                -- tb = #m[page]
            -- end
		-- elseif X == VK_RIGHT then
            -- tb = tb + 1 
            -- if tb > #m[page] then 
                -- tb = 1
            -- end
        -- else 
            -- local mxx = false
            
            -- if mx >= bx*530 and mx <= bx*638 and my >= by*145 and my <= by*180 then 
                -- page = 1 
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*708 and mx <= bx*816 and my >= by*145 and my <= by*180 then 
                -- page = 1 
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*512 and mx <= bx*600 and my >= by*312 and my <= by*345 then 
                -- page = 2
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*632 and mx <= bx*720 and my >= by*312 and my <= by*345 then 
                -- page = 2
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*753 and mx <= bx*841 and my >= by*312 and my <= by*345 then 
                -- page = 2
                -- tb = 3
                -- mxx = true
            -- end
            -- if mx >= bx*474 and mx <= bx*562 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*580 and mx <= bx*668 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*685 and mx <= bx*773 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 3
                -- mxx = true
            -- end
            -- if mx >= bx*790 and mx <= bx*878 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 4
                -- mxx = true
            -- end
            -- if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                -- page = 4
                -- tb = 1
                -- mxx = true
            -- end
            -- if mxx == true and ktype == 3 then
                -- if page == 1 then 
                    -- if tb == 1 then 
                        -- JY.Base["????"] = InputNum("???¨½????",1,zmmax);
                    -- else
                    -- --    ZmShop()--zmStore()
                    -- end
                -- elseif page == 2 then 
                    -- JY.Base["???¡§"] = tb - 1
                -- elseif page == 3 then 
                    -- JY.Base["????"] = tb
                -- elseif page == 4 then 
                    -- break
                -- end
            -- end
		-- end
	-- end

-- end

-- function GAME_START2()
	-- local bx = CC.ScreenW/1360
	-- local by = CC.ScreenH/768
	-- --local size = CC.DefaultFont
    -- local tb = 1
    -- local page = 1
    -- local size = CC.DefaultFont*0.7
	-- local p = JY.Person[0]
	-- local m = { {'????','????','?¡Â??'},
                -- {'1-30','31-50','51-79','80-100'},
                -- {'??????'},
                -- }
    -- local sz ={{520,327,155},
               -- {520,488,105},
		       -- {818,656,0},
                -- }  
    -- local nlsm = {
                    -- '?????????????¡Â¡¦??????¨§???¨½?????¨¾????????????????????*??????????????????????¡Á??????????¨½?????????¡Â???????¡Â???????¡Â???????????????????????????????????????????????????????¨§????¡¦??¨§?¨½??????????????????¡¦?????*???????????????¨½?????????¨½???????¨§?????¡§???????¡è?¨²?¡Â??*?????¨¢??:??????¡¦???????¡Á???¡¦??¨§?¨½??',
                    -- '??????????¡¦???¡¦????¨¹?¡è?????????¨¾?????????????¡§???????????????¡Â????????????????*??????????????????????¡Á??????????¨½???????????¡è?¡è?¨½?????¨²?¨®¡ã??????????????????¡è?¨®????????¡¦?????????????',               
                    -- '?¡Â??????????¡Á????????¨¾???????????????¡ì???????¡Á?????¡¦?¡Á??¨§??????????????????????¡ì????????????¡¦¨¹?¡ì?????????????¨½???????????¨¹???????????????¡Â??¡¦??????????¡Á?¨ª????',  
                    -- }

    -- local zzsm = {'???????????????¨½????¡Á¨®??????',
                 -- '??????????¡Á¨®??????',
                 -- '???????¡ì??????????',
                 -- '???????¡ì???????¨½?????¡¦¡Á?????',
                 -- }
    -- p["????????"] = 0
    -- local w = math.modf(bx*333/size)
	-- while true do 
        -- if JY.Restart == 1 then
            -- break
        -- end	
		-- ClsN()
        -- local zz = JY.Person[0]["¡Á???"]
	 
        -- lib.LoadPNG(91,45*2,0,0,1)
        -- for i = 1,#m do 
            -- for j = 1,#m[i] do
                -- local cl = M_Wheat
                -- local s = m[i][j]
                -- if page == i then
                    -- if tb == j then 
                        -- cl = C_RED
                    -- end
                -- end
                -- DrawString(bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3]+bx*212,by*sz[i][2]-size/2+by*33.5,s,cl,size)
            -- end
        -- end
        -- DrawString(bx*70+bx*212,by*99+by*33.5,"????????",M_Wheat,size)
        -- DrawString(bx*70+size*5+bx*212,by*99+by*33.5,m[1][p["????????"]+1],C_RED,size)
        
        -- DrawString(bx*260+bx*212,by*97+by*33.5,'¡Á???',M_Wheat,size)
		-- DrawString(bx*260+size*3+bx*212,by*97+by*33.5,zz,C_RED,size)
        
        -- local n = 0
        -- if page == 1  then
            -- n = tjm(bx*68+bx*212,by*130+by*33.5,nlsm[tb],C_WHITE,size,w,size)
        -- else 
            -- n = tjm(bx*68+bx*212,by*130+by*33.5,nlsm[p["????????"]+1],C_WHITE,size,w,size)
        -- end
        -- n = n + 1
        -- for i = 1,#zzsm do 
            -- DrawString(bx*68+bx*212,by*130+(n+i-1)*size+by*33.5,zzsm[i],M_Wheat,size)
        -- end
        -- ShowScreen()
       
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if page == 1 then   
                 -- p["????????"] = tb - 1
            -- elseif page == 2 then 
				-- if tb == 1 then
					-- JY.Person[0]["¡Á???"] = InputNum("????¡Á???",1,30)					
				-- elseif tb == 2 then
					-- JY.Person[0]["¡Á???"] = InputNum("????¡Á???",31,50)
				-- elseif tb == 3 then
					-- JY.Person[0]["¡Á???"] = InputNum("????¡Á???",51,79)  
				-- elseif tb == 4 then
					-- JY.Person[0]["¡Á???"] = InputNum("????¡Á???",80,100)					
				-- end
            -- elseif page == 3 then 
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then

		-- elseif X == VK_UP then
            -- page = page - 1 
            -- if page < 1 then 
                -- page = #m
            -- end
            -- tb = 1
        -- elseif X == VK_DOWN then
            -- page = page + 1 
            -- if page > #m then 
                -- page = 1
            -- end
            -- tb = 1	
        -- elseif X == VK_LEFT then
            -- tb = tb - 1 
            -- if tb < 1 then 
                -- tb = #m[page]
            -- end
		-- elseif X == VK_RIGHT then
            -- tb = tb + 1 
            -- if tb > #m[page] then 
                -- tb = 1
            -- end
        -- else 
            -- local mxx = false
            
            -- if mx >= bx*475+bx*212 and mx <= bx*565+bx*212 and my >= by*313+by*33.5 and my <= by*345+by*33.5 then 
                -- page = 1 
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*630+bx*212 and mx <= bx*720+bx*212 and my >= by*313+by*33.5 and my <= by*345+by*33.5 then 
                -- page = 1 
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*785+bx*212 and mx <= bx*875+bx*212 and my >= by*313+by*33.5 and my <= by*345+by*33.5 then 
                -- page = 1
                -- tb = 3
                -- mxx = true
            -- end		
            -- if mx >= bx*477+bx*212 and mx <= bx*567+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then 
                -- page = 2
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*581+bx*212 and mx <= bx*671+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then
                -- page = 2
                -- tb = 2
                -- mxx = true
            -- end			
            -- if mx >= bx*688+bx*212 and mx <= bx*778+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then
                -- page = 2
                -- tb = 3
                -- mxx = true
            -- end
            -- if mx >= bx*788+bx*212 and mx <= bx*878+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then
                -- page = 2
                -- tb = 4
                -- mxx = true
            -- end
            -- if mx >= bx*742+bx*212 and mx <= bx*896+bx*212 and my >= by*638+by*33.5 and my <= by*673+by*33.5 then
                -- page = 3
                -- tb = 1
                -- mxx = true
            -- end
            -- if mxx == true and ktype == 3 then
               -- if page == 1 then 
                    -- if tb == 1 then
                       -- p["????????"] = 0
					-- elseif tb == 2 then
						   -- p["????????"] = 1				
					-- elseif tb == 3 then
                        -- p["????????"] = 2
				    -- end
               -- elseif page == 2 then 
				   -- if tb == 1 then
					   -- p["¡Á???"] = InputNum("????¡Á???",1,30)
				   -- elseif tb == 2 then
					  -- p["¡Á???"] = InputNum("????¡Á???",31,50)
				   -- elseif tb == 3 then
					   -- p["¡Á???"] = InputNum("????¡Á???",51,79)  
				   -- elseif tb == 4 then
					   -- p["¡Á???"] = InputNum("????¡Á???",80,100)					
				   -- end
               -- elseif page == 3 then 
                   -- break
               -- end
            -- end
		-- end
	-- end
-- end
--???????¨½
function Moshixz()
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	local zb  = {{187+100,373+50},{462+100,373+50},{737+100,373+50}}
	local tb = 1
	while true do 
		if JY.Restart == 1 then
			break
		end
		ClsN()
		lib.LoadPNG(91,1000*2,0,0,1)
		for i = 1,3 do
			lib.LoadPNG(91,(171+i-1)*2,zb[i][1],zb[i][2],1)
			if tb == i then
				lib.LoadPNG(91,(174+i-1)*2,zb[i][1],zb[i][2],1)
				lib.LoadPNG(91,112*2,zb[i][1]-5,zb[i][2]-3,1)
			end
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X, ktype, mx, my = lib.GetKey();	
		if X == VK_ESCAPE or ktype == 4 then
			break
		elseif X == VK_SPACE or X == VK_RETURN then
			break
		elseif X == VK_LEFT or X == VK_UP then
			tb = tb - 1
			if tb < 1 then
				tb = 3
			end
			JY.Base["????5"] = tb - 1
		elseif X== VK_RIGHT or X == VK_DOWN then
			tb = tb + 1
			if tb > 3 then
				tb = 1
			end
			JY.Base["????5"] = tb - 1
		else
			local mxx = false
			local x1 = 236
			local y1 = 112	
			local sb = 0							
			for i = 1,3 do
				sb = i
				if mx >= bx*zb[i][1] and mx <= bx*zb[i][1] + bx*x1 and my >= by*zb[i][2] and my <= by*zb[i][2]+by*y1 then	
					tb = sb
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then
				JY.Base["????5"] = tb - 1
				break
			end
		end
	end
end	

function GAME_START1()
	-- local bx = CC.WX
	-- local by = CC.HY
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
    local tb = 1
    local page = 1
    local size = CC.DefaultFont*0.7
    JY.Base["????"] = 1
	local m = { {'????','????'},
                {'???¡§','???¡§','?¨¦??'},
                {'?¨¾??','???¡§','?¡ì??','???¨¹'},
                {'??????'},
				}
	local ax,ay = 210,35
    local sz = {{582+ax,161+ay,180},
                {556+ax,328+ay,120},
                {518+ax,489+ay,105},
                {818+ax,656+ay,0},
                }        
    local sm1 = "?????????¡¦???¡ã???????¨½???????¡¦???????????¨¹??¡Á???????10???????¨½¡Á????????¨¹????10????????????????NPC?????????¡ì????".."*".."?¨½????¡Á??¨®????15??"
    local sm2 = "???¡ã??????".."*".."¡Á??¨®??????".."*".."???¡ã??????".."*".."???¡ã??????"
    local sm = {'?¡Á??¡¦????????????????¡¦????¡¦???????????????6??',
                '?¡Á?????¡¦???¡Â????????????',
                '?¡Á?????¡¦???¡Â?????????????????¨ª?????¨¦?????????????¨§??'
				}
    local zmmax = CC.Week
    --local sm3 = zm.."*"..zmmax.."*"..m[3][JY.Base["????"]].."*"..m[2][JY.Base["???¡§"]+1]
	local w = math.modf(bx*350/size/0.96)
	
	while true do 
        if JY.Restart == 1 then
            break
        end	
		ClsN()
		local zm = JY.Base["????"]  --267 443
		local cx,cy = bx*sz[1][1] - bx*520,by*sz[1][2]+by*203
		local sm3 = zm.."*"..zmmax.."*"..m[3][JY.Base["????"]].."*"..m[2][JY.Base["???¡§"]+1]
		lib.LoadPNG(91,48*2,0,0,1)
		tjm(bx*166,by*150,sm1,C_GOLD,size*0.9,w,size*1.65)
		tjm(bx*166,by*350,sm2,C_WHITE,size*0.9,w,size*1.65)
		tjm(bx*166,by*500,"???????¡Â??"..sm[JY.Base["???¡§"]+1],C_WHITE,size*0.9,w,size*1.65)
		tjm(bx*280,by*350,sm3,C_RED,size*0.9,w,size*1.65)
		--DrawString(cx-string.len(zm)/4*size,cy,zm,C_RED,size)
		--DrawString(cx-string.len(zmmax)/4*size,cy+size*1.6,zmmax,C_RED,size)
		--DrawString(cx-size*0.9,cy+size*3.1,m[3][JY.Base["????"]],C_RED,size)
		--DrawString(cx-size*0.9,cy+size*4.6,m[2][JY.Base["???¡§"]+1],C_RED,size)
		for i = 1,#m do 
			
			for j = 1,#m[i] do
				
                local cl = M_Wheat
                local s = m[i][j]
                if page == i then
                    if tb == j then 
                        cl = C_RED
                    end
				end
				lib.LoadPNG(91,21*2,bx*sz[i][1]+ (j-1)*bx*sz[i][3]-bx*44,by*sz[i][2]-size/2-by*5,1)
                DrawString(bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3],by*sz[i][2]-size/2,s,cl,size)
            end
        end
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if page == 1 then 
                if tb == 1 then 
                    JY.Base["????"] = InputNum("???¨½????",1,zmmax);
                else
                    ZmShop()--zmStore()
                end
            elseif page == 2 then 
                JY.Base["???¡§"] = tb - 1
            elseif page == 3 then 
                JY.Base["????"] = tb
            elseif page == 4 then 
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)

		elseif X == VK_UP then
			PlayWavE(77)
            page = page - 1 
            if page < 1 then 
                page = #m
            end
            tb = 1
		elseif X == VK_DOWN then
			PlayWavE(77)
            page = page + 1 
            if page > #m then 
                page = 1
            end
            tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
            tb = tb - 1 
            if tb < 1 then 
                tb = #m[page]
            end
		elseif X == VK_RIGHT then
			PlayWavE(77)
            tb = tb + 1 
            if tb > #m[page] then 
                tb = 1
            end
        else 
			local mxx = false --55 8
			local jh = 15
			for i = 1,2 do
				if mx >= bx*sz[1][1] - bx*55 + (i-1)*sz[1][3] and mx <= bx*sz[1][1]+bx*55  + (i-1)*sz[1][3]  and my >= by*sz[1][2] - by*jh and my <= by*sz[1][2]+by*jh then 
					page = 1 
					tb = i
					mxx = true
					break
				end
			end
			for i = 1,3 do
				if mx >= bx*sz[2][1] - bx*55 + (i-1)*sz[2][3] and mx <= bx*sz[2][1]+bx*55  + (i-1)*sz[2][3]  and my >= by*sz[2][2] - by*jh and my <= by*sz[2][2]+by*jh then 
					page = 2 
					tb = i
					mxx = true
					break
				end
			end	
			for i = 1,4 do
				if mx >= bx*sz[3][1] - bx*55 + (i-1)*sz[3][3] and mx <= bx*sz[3][1]+bx*55  + (i-1)*sz[3][3]  and my >= by*sz[3][2] - by*jh and my <= by*sz[3][2]+by*jh then 
					page = 3 
					tb = i
					mxx = true
					break
				end
			end
			if mx >= bx*sz[4][1] - bx*55 and mx <= bx*sz[4][1]+bx*55  and my >= by*sz[4][2] - by*jh and my <= by*sz[4][2]+by*jh then 
                page = 4
                tb = 1
                mxx = true
            end
			if mxx == true and ktype == 3 then
				PlayWavE(77)
                if page == 1 then 
                    if tb == 1 then 
                        JY.Base["????"] = InputNum("???¨½????",1,zmmax);
                    else
                        ZmShop()--zmStore()
                    end
                elseif page == 2 then 
                    JY.Base["???¡§"] = tb - 1
                elseif page == 3 then 
                    JY.Base["????"] = tb
                elseif page == 4 then 
                    break
                end
            end
		end
	end

end

function GAME_START2()
	-- local bx = CC.WX
	-- local by = CC.HY
	local id = JY.Base["????"]
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	--local size = CC.DefaultFont
    local tb = 1
    local page = 1
    local size = CC.DefaultFont*0.7
	local p = JY.Person[0]
	local m = { {'????','????','?¡Â??'},
				{'1-30','31-50','51-79','80-100'},
				{'??????',"??????"},
				{'??????',"??????"},
                {'??????'},
                }
    local sz ={ {536,170,140}, -- {}
			   {512,325,105},
			   {584,473,178},
			   {584,616,178},
			   {818,648,0},
				}
	JY.Person[0]['????'] = MPPD(id)
	JY.Person[0]['???????¡Á'] = MPDJ(id)
	--local bbzb = {{590,591},{762,591}}			
    local nlsm = {
                    '?????????????¡Â¡¦??????¨§???¨½?????¨¾????????????????????*??????????????????????¡Á??????????¨½?????????¡Â???????¡Â???????¡Â???????????????????????????????????????????????????????¨§????¡¦??¨§?¨½??????????????????¡¦?????',
                    '??????????¡¦???¡¦????¨¹?¡è?????????¨¾?????????????¡§???????????????¡Â????????????????*??????????????????????¡Á??????????¨½???????????¡è?¡è?¨½?????¨²?¨®¡ã??????????????????¡è?¨®????????¡¦?????????????',               
                    '?¡Â??????????¡Á????????¨¾???????????????¡ì???????¡Á?????¡¦?¡Á??¨§??????????????????????¡ì????????????¡¦¨¹?¡ì?????????????¨½???????????¨¹???????????????¡Â??¡¦??????????¡Á?¨ª????',  
                    }

    local zzsm = {'???????????????¨½????¡Á¨®??????',
                 '??????????¡Á¨®??????',
                 '???????¡ì??????????',
                 '???????¡ì???????¨½?????¡¦¡Á?????',
				 }
    --local bbsm = {'???¨§???¡¦?????¨§?????????????¨ª????????',
     --            '???¨§???¡¦?????????????????????¨ª???????????????¨¦???¡Â?¡ã???????¡è????????',
      --           }				 
	p["????????"] = 0
	
    local w = math.modf(bx*333/size)
	local wg1 = JY.Person[0]["????" .. 1]
	local wg2 = JY.Person[0]["????" .. 2]
	
	
	
	while true do 
        
        if JY.Restart == 1 then
            break
        end	
		ClsN()
        local zz = JY.Person[0]["¡Á???"]
		
		--JY.Wugong[wugong]["????"]
		--for wg = 1,JY.Base["????????"] do
			--wg1 = JY.Wugong[JY.Person[0]["????" .. 1]]["????"]
			--wg2 = JY.Wugong[JY.Person[0]["????" .. 2]]["????"]			
		--end	

        lib.LoadPNG(91,45*2,0,0,1)
        for i = 1,#m do 
            for j = 1,#m[i] do
                local cl = M_Wheat
                local s = m[i][j]
                if page == i then
                    if tb == j then 
                        cl = C_RED
                    end
				end
				if s == "??????" then
					lib.LoadPNG(91,21*2,bx*212+bx*sz[i][1]+(j-1)*bx*sz[i][3],by*sz[i][2]*1.1,2)
	                DrawString(bx*212+bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3],(by*sz[i][2]-size/2)*1.1,s,cl,size)
				else	
					lib.LoadPNG(91,21*2,bx*212+bx*sz[i][1]+(j-1)*bx*sz[i][3],by*sz[i][2],2)
	                DrawString(bx*212+bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3],by*sz[i][2]-size/2,s,cl,size)
	            end 
            end
		end
		local n = 1
		DrawString(bx*74+size*3,by*99+size,"??????????",C_WHITE,size)
        DrawString(bx*70+size*5,by*99+size,"      "..m[1][p["????????"]+1],C_RED,size)
        DrawString(bx*260+size*3,by*97+size,"¡Á???:",C_WHITE,size)
		DrawString(bx*260+size*3,by*97+size,"      "..zz,C_RED,size)
		n = n + 1
   
        if page == 1  then
            n = tjm(bx*148,by*130+(n)*size,nlsm[tb],C_WHITE,size,w,size)
        else 
            n = tjm(bx*148,by*130+(n)*size,nlsm[p["????????"]+1],C_WHITE,size,w,size)
        end
        n = n + 1
        for i = 1,#zzsm do 
            DrawString(bx*148,by*150+(n+i-1)*size,zzsm[i],M_Wheat,size)
		end
		n = n + 1
		DrawString(bx*148,by*150+(n+3)*size,"??????????",C_RED,size)
		n = n + 1
		DrawString(bx*148,by*150+(n+3)*size,JY.Wugong[JY.Person[0]["????" .. 1]]["????"],M_Wheat,size)
		n = n + 1
		DrawString(bx*148,by*150+(n+3)*size,JY.Wugong[JY.Person[0]["????" .. 2]]["????"],M_Wheat,size)	
		--n = n + 1
		--if JY.Base["???¡§"] == 1 and JY.Base["????"] > 0  then
			local mptype,mpdj = "",""
			if MPPD(0) == nil or MPPD(0) < 1 then
				mptype = "????????"
				mpdj = "??"
			else
				mptype,mpdj = MPDISPLAY(id)
			end	
			n = n + 1
			DrawString(bx*148,by*150+(n+3)*size,"??????????",C_RED,size)
			n = n + 1
			DrawString(bx*148,by*150+(n+3)*size,"??????????"..mptype,M_Wheat,size)
			n = n + 1
			DrawString(bx*148,by*150+(n+3)*size,"???????¡Á??"..mpdj,M_Wheat,size)	
			n = n + 1
		--end	
		ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if page == 1 then   
                 p["????????"] = tb - 1
            elseif page == 2 then 
				if tb == 1 then
					JY.Person[0]["¡Á???"] = InputNum("????¡Á???",1,30)					
				elseif tb == 2 then
					JY.Person[0]["¡Á???"] = InputNum("????¡Á???",31,50)
				elseif tb == 3 then
					JY.Person[0]["¡Á???"] = InputNum("????¡Á???",51,79)  
				elseif tb == 4 then
					JY.Person[0]["¡Á???"] = InputNum("????¡Á???",80,100)					
				end
			elseif page == 3 then
				if tb == 1 then									
					JY.Person[0]["????1"]=wg1
					JY.Person[0]["????2"]=wg2
					--JY.Person[0]["????????1"]=999
					--JY.Person[0]["????????2"]=999
				elseif tb == 2 then
					JY.Person[0]["????1"]=0
					JY.Person[0]["????2"]=0
				end	
			elseif page == 4 then 
					if tb == 1 then
						JY.Person[0]['????'] = MPPD(id)
						JY.Person[0]['???????¡Á'] = MPDJ(id)
					elseif tb == 2 then
						JY.Person[0]['????'] = 0
						JY.Person[0]['???????¡Á'] = 0
					end	
			elseif page == 5 then 
			   break
			end  
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)

		elseif X == VK_UP then
			PlayWavE(77)
            page = page - 1 
            if page < 1 then 
                page = #m
            end
            tb = 1
		elseif X == VK_DOWN then
			PlayWavE(77)
            page = page + 1 
            if page > #m then 
                page = 1
            end
            tb = 1	
		elseif X == VK_LEFT then
			PlayWavE(77)
            tb = tb - 1 
            if tb < 1 then 
                tb = #m[page]
            end
		elseif X == VK_RIGHT then
			PlayWavE(77)
            tb = tb + 1 
            if tb > #m[page] then 
                tb = 1
            end
        else 
			local mxx = false
			local cx = bx*90 
			local cy = by*34
			for i = 1,3 do
				local tx = bx*142*(i-1)				
				if mx >= bx*704 + tx  and mx <= bx*cx + bx*704 + tx and my >= by*153 and my <= by*185 then 
					page = 1 
					tb = i
					mxx = true
					break
				end
			end
			for i = 1,4 do
				local tx = bx*107*(i-1)	
				if mx >= bx*705 + tx and mx <= bx*705  + tx + cx and my >= by*308 and my <= by*308 + cy then
					page = 2
					tb = i
					mxx = true
					break
				end
			end
			for i = 1,2 do
				local tx = bx*179*(i-1)	
				if mx >= bx*753 + tx and mx <= bx*753 + tx + cx and my >= by*456 and my <= by*456 + cy then
					page = 3
					tb = i
					mxx = true
					break
				end
			end	
			for i = 1,2 do
				local tx = bx*179*(i-1)	
				if mx >= bx*753 + tx and mx <= bx*753 + tx + cx and my >= by*604 and my <= by*604 + cy then
					page = 4
					tb = i
					mxx = true
					break
				end
			end			
            if mx >= bx*986 and mx <= bx*986 + cx and my >= by*694 and my <= by*694 + cy then
                page = 5
                tb = 1
                mxx = true
            end		
            if 	ktype == 3 then
            	--
            end	
			if mxx == true and ktype == 3 then
				PlayWavE(77)
               if page == 1 then 
                    if tb == 1 then
                       p["????????"] = 0
					elseif tb == 2 then
						p["????????"] = 1				
					elseif tb == 3 then
                        p["????????"] = 2
				    end
               	elseif page == 2 then 
				   if tb == 1 then
					   p["¡Á???"] = InputNum("????¡Á???",1,30)
				   elseif tb == 2 then
					  p["¡Á???"] = InputNum("????¡Á???",31,50)
				   elseif tb == 3 then
					   p["¡Á???"] = InputNum("????¡Á???",51,79)  
				   elseif tb == 4 then
					   p["¡Á???"] = InputNum("????¡Á???",80,100)					
				   end
				elseif page == 3 then
					if tb == 1 then
						JY.Person[0]["????1"]=wg1
						JY.Person[0]["????2"]=wg2
						--JY.Person[0]["????????1"]=999
						--JY.Person[0]["????????2"]=999
					elseif tb == 2 then
						JY.Person[0]["????1"]=0
						JY.Person[0]["????2"]=0
					end
               	elseif page == 4 then 
					
						if tb == 1 then
							JY.Person[0]['????'] = MPPD(id)
							JY.Person[0]['???????¡Á'] = MPDJ(id)
						elseif tb == 2 then
							JY.Person[0]['????'] = 0
							JY.Person[0]['???????¡Á'] = 0
						end	
				elseif page == 5 then 
			   		break
				end
            end
		end
	end
end
-- function TGTF()
    -- local bx = CC.ScreenW/1360
    -- local by = CC.ScreenH/768
    -- local cot = 1
    -- local cot1 = 0
    -- local cot2 = 0
    -- local size = CC.DefaultFont*0.7
    -- local maxn = 7
    -- local page = 1
    -- local jl = 0
    -- local menu = {}
    -- local w = math.modf(bx*218/size)
	-- --if existFile(CONFIG.DataPath..'TgJl') then
	-- --	tgload()
			
    -- -- for i = 1,#CC.TGJL do
        -- -- menu[#menu+1] = CC.TGJL[i]
    -- -- end
		
    -- -- if #menu <= 0  then
        -- -- return   
    -- -- end
	-- --end
    -- --menu = {9999,9998,9997,9996,9995,9994,9993,9992,9991,9990,9988,9987,9986,9985,9984}
	-- menu = {9970,9971,9972,9973,9955,9954,9953,9952,9951}
    -- menu[#menu+1] = -1
    -- local max = math.ceil((#menu-1)/4)
    -- if maxn > max then 
        -- maxn = max
    -- end
   
    -- while true do
	   -- if JY.Restart == 1 then
            -- break
       -- end	
        -- ClsN()
        -- lib.LoadPNG(91,46*2,0,0,1)
        -- for i = 1,4 do 
            -- for j = 1,maxn do
                -- local tf = i + (j-1+cot2)*4
                -- local sm = CC.PTFSM[menu[tf]]
                -- local cl = M_Wheat
                -- if tf == cot + cot1*4 then 
                    -- cl = C_RED
                -- end 
                -- if sm ~= nil then
                    -- lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150+bx*212,by*100+(j-1)*by*63+by*33.5,2)
                    -- DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size+bx*212,by*99+(j-1)*by*63-size/2+by*33.5,sm[1],cl,size)
                -- end
            -- end
        -- end
        
        -- local n = 0
        -- local dtf = '??'
        -- local xtf = '??'
        
        -- DrawString(bx*63+bx*212,by*100-size/2+by*33.5,'?????¨§??',M_Wheat,size)
        
        -- if jl > 0 then 
            -- if CC.PTFSM[jl] ~= nil then 
                -- local ptf = CC.PTFSM[jl][2]
                -- dtf = CC.PTFSM[jl][1]
                -- if ptf ~= nil then 
                    -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,ptf,C_WHITE,size,w,size)
                -- end   
            -- end
        -- else 
            -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,'?????¨§??',C_WHITE,size,w,size)
        -- end
        -- n = n + 2
        -- DrawString(bx*190+bx*212,by*100-size/2+by*33.5,dtf,C_RED,size)
        
        -- if cot + cot1*4 == #menu then 
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'??????',C_RED,size)
        -- else    
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'??????',M_Wheat,size)
        -- end
        
        -- DrawString(bx*63+bx*212,by*100-size/2+ size + n*size+by*33.5,'???¡ã?¨§??',M_Wheat,size)
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        -- end    
        -- DrawString(bx*190+bx*212,by*100-size/2+ size + n*size+by*33.5,xtf,C_RED,size)
        -- n = n + 1
        
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            -- if ptf ~= nil then
                -- n = tjm(bx*63+bx*212,by*100-size/2 + size+n*size+by*33.5,ptf,C_WHITE,size,w,size)
            -- end
        -- end

        
        -- --???¡ì???¡ã??????¡¦¡§????¡Á?
        -- ShowScreen()
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if cot + cot1*4 < #menu then 
                -- jl = menu[cot+cot1*4]
            -- else
                -- if jl > 0 then
                -- CC.TG[jl] = 1
				-- end
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then
			
		-- elseif X == VK_UP then
			-- if cot1 > 0 then
				-- if cot1 == cot2 then
					-- cot2 = limitX(cot2 - 1,0)
				-- end
				-- cot1 = cot1 - 1
			-- else 
				-- cot = 1
			-- end
        -- elseif X == VK_DOWN then
			-- if cot + cot1*4 < #menu then
				-- if cot1 < math.ceil((#menu)/4) - 1 then 
					-- cot1 = cot1 + 1 
					-- if cot + cot1*4 > (#menu) then
						-- cot = (#menu) - cot1*4
					-- end
				-- else 
					-- cot = (#menu) - cot1*4
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- elseif X == VK_LEFT then
			-- cot = cot - 1 
			-- if cot1 > 0 then 
				-- if cot < 1 then
					-- if cot1 == cot2 then
						-- cot2 = limitX(cot2 - 1,0)
					-- end
					-- cot1 = cot1 - 1
					-- cot = 4
				-- end
			-- elseif cot < 1 then 
				-- cot = 1
			-- end
		-- elseif X == VK_RIGHT then
			-- if cot + cot1*4 < (#menu) then
				-- cot = cot + 1
				-- if cot > 4 then
					-- if cot1 < math.ceil((#menu)/4) - 1 then 
						-- cot = 1 
						-- cot1 = cot1 + 1
					-- end	
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- else--0,0
			-- local mxx = false
            -- if mx >= bx*742+bx*212 and mx <= bx*896+bx*212 and my >= by*638+by*33.5 and my <= by*673+by*33.5 then
                -- cot1 = maxn-1
                -- cot = (#menu) - cot1*4
                -- mxx = true
            -- else
                -- for i = 1,4 do 
                    -- for j = 1,maxn do
                        -- --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        -- if mx >= bx*396+(i-1)*bx*150-bx*67+bx*212 and mx <= bx*396+(i-1)*bx*150+bx*67+bx*212 and 
                            -- my >= by*100+(j-1)*by*63-by*17+by*33.5 and my <= by*100+(j-1)*by*63+by*17+by*33.5 then 
                            -- local p = i+(j - 1 + cot2)*4
                            -- if CC.PTFSM[menu[p]] ~= nil then 
                                -- cot = i 
                                -- cot1 = j - 1 + cot2
                                -- mxx = true 
                                -- break
                            -- end
                        -- end	
                    -- end
                -- end	 
            -- end  
            -- if mxx == true and ktype == 3 then 
                -- if cot + cot1*4 < #menu then 
                    -- jl = menu[cot+cot1*4]
                -- else
                    -- if jl > 0 then
                    -- CC.TG[jl] = 1
					-- end
                    -- break
                -- end
            -- end
        -- end
    -- end
    -- --CC.TGJL = {}
-- end

function TGTF3()
    local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxn = 9
    local page = 1
    local jl = 0
    local menu = {}
    local w = math.modf(bx*218/size)
	--if existFile(CONFIG.DataPath..'TgJl') then
	--	tgload()
			
    -- for i = 1,#CC.TGJL do
        -- menu[#menu+1] = CC.TGJL[i]
    -- end
		
    -- if #menu <= 0  then
        -- return   
    -- end
	--end
    --menu = {9999,9998,9997,9996,9995,9994,9993,9992,9991,9990,9989,9988,9987,9986,9985,9984,9983,9982,9981,9980,9979,9978,9977,9976,9975,9974,9973,9972,9971}
	-- for i, v in pairs(#CC.PTFSM) do
		-- menu[#menu+1]=CC.PTFSM[i]
	-- end 
	for k,v in pairs(CC.PTFSM) do
		menu[#menu+1]=k
	end
	--menu = {9998,9991,9962,9980,9987,9999,9929,9928,9927,9974,9975}
    menu[#menu+1] = -1
    local max = math.ceil((#menu-1)/4)
    if maxn > max then 
        maxn = max
    end
    
    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,4 do 
            for j = 1,maxn do
                local tf = i + (j-1+cot2)*4
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*4 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = '??'
        local xtf = '??'
        
        DrawString(bx*63,by*100-size/2,'?????¨§??',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'?????¨§??',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*4 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'???¡ã?¨§??',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --???¡ì???¡ã??????¡¦¡§????¡Á?
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
        if X == VK_SPACE or X == VK_RETURN then
            if cot + cot1*4 < #menu then 
                jl = menu[cot+cot1*4]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			
		elseif X == VK_UP then
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
        elseif X == VK_DOWN then
			if cot + cot1*4 < #menu then
				if cot1 < math.ceil((#menu)/4) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*4 > (#menu) then
						cot = (#menu) - cot1*4
					end
				else 
					cot = (#menu) - cot1*4
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        elseif X == VK_LEFT then
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 4
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			if cot + cot1*4 < (#menu) then
				cot = cot + 1
				if cot > 4 then
					if cot1 < math.ceil((#menu)/4) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxn-1
                cot = (#menu) - cot1*4
                mxx = true
            else
                for i = 1,4 do 
                    for j = 1,maxn do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*4
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
            if mxx == true and ktype == 3 then 
                if cot + cot1*4 < #menu then 
                    jl = menu[cot+cot1*4]
                else
                    if jl > 0 then
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end

function TGTF3()
    local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxn = 9
    local page = 1
    local jl = 0
    local menu = {}
    local w = math.modf(bx*218/size)
	--if existFile(CONFIG.DataPath..'TgJl') then
	--	tgload()
			
			
    -- for i = 1,#CC.TGJL do
        -- menu[#menu+1] = CC.TGJL[i]
    -- end
		
    -- if #menu <= 0  then
        -- return   
    -- end
	
	
	--end
    --menu = {9999,9998,9997,9996,9995,9994,9993,9992,9991,9990,9988,9987,9986,9985,9984}
	--menu = {9995,9984,9981,9901,9900,9999,9929,9928,9927,9979,9989}
	for k,v in ipairs(CC.PTFSM) do
		menu[#menu+1]=k
	end
    menu[#menu+1] = -1
    local max = math.ceil((#menu-1)/4)
    if maxn > max then 
        maxn = max
    end
    
    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,4 do 
            for j = 1,maxn do
                local tf = i + (j-1+cot2)*4
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*4 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = '??'
        local xtf = '??'
        
        DrawString(bx*63,by*100-size/2,'?????¨§??',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'?????¨§??',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*4 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'???¡ã?¨§??',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --???¡ì???¡ã??????¡¦¡§????¡Á?
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
        if X == VK_SPACE or X == VK_RETURN then
            if cot + cot1*4 < #menu then 
                jl = menu[cot+cot1*4]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			
		elseif X == VK_UP then
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
        elseif X == VK_DOWN then
			if cot + cot1*4 < #menu then
				if cot1 < math.ceil((#menu)/4) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*4 > (#menu) then
						cot = (#menu) - cot1*4
					end
				else 
					cot = (#menu) - cot1*4
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        elseif X == VK_LEFT then
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 4
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			if cot + cot1*4 < (#menu) then
				cot = cot + 1
				if cot > 4 then
					if cot1 < math.ceil((#menu)/4) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxn-1
                cot = (#menu) - cot1*4
                mxx = true
            else
                for i = 1,4 do 
                    for j = 1,maxn do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*4
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
            if mxx == true and ktype == 3 then 
                if cot + cot1*4 < #menu then 
                    jl = menu[cot+cot1*4]
                else
                    if jl > 0 then
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end

function NpcWar()
local menu = {}
local n = 0
for i = 1,JY.PersonNum-1 do
    if CC.PersonExit[i] == nil and JY.Person[i]["????¡¦??¡Á"] < 3 then 
        n = n + 1
        menu[n] = {JY.Person[i]['????'],nil,1,i}
    end
end

CC.HSLJ = {}
while #CC.HSLJ < 50 do 
	   if JY.Restart == 1 then
            break
       end	
    Cls()
    local r = ShowMenu4(menu,#menu,5,-2,-2,-2,-2,1,1,CC.DefaultFont,C_GOLD,C_WHITE,"?????¨½??????????????¡Á???50????"..#CC.HSLJ,C_ORANGE, C_WHITE,10)
    if r <= 0 then 
        break
    else
        CC.HSLJ[#CC.HSLJ + 1] = menu[r][4]
        table.remove(menu,r)
    end
    Cls()
end

if #CC.HSLJ == 0 then 
    return    
end

CC.HSLJ2 = {}
while #CC.HSLJ2 < 50 do 
	   if JY.Restart == 1 then
            break
       end	
    Cls()
    local r = ShowMenu4(menu,#menu,5,-2,-2,-2,-2,1,1,CC.DefaultFont,C_GOLD,C_WHITE,"?????¨½??????????????¡Á???50????"..#CC.HSLJ2,C_ORANGE, C_WHITE,10)
    if r <= 0 then 
        break
    else
        CC.HSLJ2[#CC.HSLJ2 + 1] = menu[r][4]
        table.remove(menu,r)
    end
    Cls()
    
end

if #CC.HSLJ2 == 0 then 
    return    
end

WarMain(354)
end
--???????¡¦???¨ª
function My_ChuangSong_List()
	local menu = {};
	for i = 0, JY.SceneNum-1 do
		--???????????¡ã??????????1 3 ?¡Â????????????????+????¡¦???3¡Á¨¦ ?????? ?????? ?¡¦¡Á????? ?¨®??¡¦????? ???????? ??????1 3 ?????¨®?? ???? ???????? ¡Â??????? ???????? ???¨¦???¡Á ???????? ???????? ???? ?????¨®?¨¢
		if i == 0 or i == 5  or i == 13 or i == 14 or i == 15 or i == 28  or i == 38 or i == 42 or i == 44 or i == 46  or i == 49 or i == 55 or i == 57 or i == 58 or i == 67 or i == 69 or i == 70
		or (i >= 80 and i <= 83) or i == 84 or i == 85 or i == 86 or i == 88 or i == 89 or i == 91 or i == 102 or i == 104  
		or i == 106 or i == 108 or i == 109 or i == 110 or i == 111 or i == 113 or i == 114 or i == 115 or i == 174 or i == 173
		or i == 116 or i == 117 or i == 118 or i == 119 or i == 122 or i == 123 or i == 126 or i == 178 or i == 177 or i == 176  or i == 175
		or i == 131 or i == 132 or i == 134 or i == 137 or i == 138 or i == 140 or i == 141 or i == 184 or i == 181 or i == 180  or i == 179
		or i == 162 or i == 164 or i == 195 or i == 193 or i == 192 or i == 191 or i == 190 or i == 189 or i == 187 or i == 186
		or i == 174 or i == 173 or i == 172 or i == 170 or i == 169 or i == 168 or i == 167 or i == 166 or i == 165
		or i == 164 or i == 163 or i == 162 or i == 171 or i == 185 or i == 182 or i == 197 or i == 198 or i == 199 
		or i == 142 or i == 143 or i == 144 or i == 145 or i == 146 or i == 147 or i == 148 or i == 149 or i == 150 or i == 200 or i == 201 or i == 202
		or i == 203 or i == 204 or i == 205 or i == 206 or i == 207 then
		else
			--??????????????i???????¡ã????
			menu[i+1] = {JY.Scene[i]["????"], JY.Scene[i]["????????"], i, JY.Scene[i]["???¡ã????"]};	
		end
	end
	--????????????????????????????
	local r = TeleportMenu(menu, C_GOLD, C_WHITE);

	--¡¦?????????0?¡§ESC????????¡¦???
	if r < 0 then
		return 0;
	end
	--¡¦??????¨®??????0??¡¦????????????¡ã????
	if r >= 0 then	
		local sid = r;
		My_Enter_SubScene(sid,-1,-1,-1);
	end
	return 1;
end

--????¡ã????????¡¦????
function My_ChuangSong_Ex()     
	local title = "?????¨ª??";
	local str = JY.Person[0]["????"].."??????????¡¦???*?????????¨²????";
	local btn = {"????????", "?¡è????¡Á?"};
	local num = #btn;
	local r = JYMsgBox(title,str,btn,num,119,1);
	if r == 1 then
		return My_ChuangSong_List();
	elseif r == 2 then
		Cls();
		local sid = InputNum("???¡ã?¨²??",0,JY.SceneNum-1,1);
		if sid ~= nil then			
			--??¡Á???????????????????????1 3 ?¡Â????????????????+????¡¦???3¡Á¨¦ ?????? ?????? ?¡¦¡Á????? ?¨®??¡¦????? ???????? ??????1 3 ???? ?????¡è????
			if sid == 0 or sid == 5 or sid == 13 or sid == 14 or sid == 15 or sid == 28 or sid == 38 or sid == 42 or sid == 44 
			or sid == 46 or sid == 49 or sid == 55 or sid == 57 or sid == 58 or sid == 67 or sid == 69 or sid == 70 or (sid >= 80 and sid <= 83) 
			or sid == 84 or sid == 85 or sid == 86 or sid == 88 or sid == 89 or sid == 91 or sid == 102 or sid == 104 or sid == 106 or sid == 108 
			or sid == 109 or sid == 110 or sid == 111 or sid == 113 or sid == 114   or sid == 115 or sid == 116 or sid == 117 or sid == 118 or sid == 119 
			or sid == 122 or sid == 123   or sid == 126 or sid == 131 or sid == 132 or sid == 134  or sid == 137 or sid == 138 or sid == 140 or sid == 141 
			or sid == 142 or sid == 143 or sid == 144 or sid == 145 or sid== 146 or sid== 147 or sid== 148 or sid== 149 or sid== 150 or sid== 161 
			or sid == 205 or sid == 207
			or JY.Scene[sid]["????????"] == 1 then
				say("?????¨²???¡ã?????????????¡ã??", 119, 5, "??¡¦¨¾");
				return 1;
			else
				My_Enter_SubScene(sid,-1,-1,-1);
			end
		end
	end
end

--???¡¦??¡¦?
function LianGong(lx)
	JY.Person[591]["????"] = "???¡Á????"
	JY.Person[591]["????"] = 1
	JY.Person[591]["????????"] = lx
	local id = math.random(190)
	JY.Person[591]["?¡¦?¨½?¨²??"] = JY.Person[id]["?¡¦?¨½?¨²??"]
	for i = 1,5 do 
		JY.Person[591]["????????????"..i] = JY.Person[id]["????????????"..i]
		JY.Person[591]["????????????"..i] = JY.Person[id]["????????????"..i]
		JY.Person[591]["???????¡ì????"..i] = JY.Person[id]["???????¡ì????"..i]
	end
	JY.Person[591]["????"] = "???¡Á????"
	JY.Person[591]["¡ã??¨ª?¨½"] = JY.Person[id]["¡ã??¨ª?¨½"]
	JY.Person[591]["?¨²?¨¹¡Á??¨®??"] = 100
	JY.Person[591]["?¨²?¨¹"] = JY.Person[591]["?¨²?¨¹¡Á??¨®??"]
    JY.Person[591]["????¡¦??¡Á"] = 7
	instruct_6(226, 8, 0, 1)
	JY.Person[591]["????????"] = 0
	light()
	--return 1;
end

--???????¡ì???¡Â
function WuGongIntruce()
	local menu = {};
	
	for i = 1, JY.WugongNum-1 do
		menu[i] = {i..JY.Wugong[i]["????"], nil, 0}
	end
	
	--??????????
	for i = 1, CC.MyThingNum do
    if JY.Base["???¡¦" .. i] > -1 and JY.Base["???¡¦????" .. i] > 0 then
    	local wg = JY.Thing[JY.Base["???¡¦" .. i]]["?¡¦??????"];
    	if wg > 0 then
    		menu[wg][3] = 1;
    	end
    else
    	break;
    end
  end
  
  --?¡ì?¨¢??????
  for i=1, CC.TeamNum do
  	if JY.Base["???¨¦"..i] >= 0 then
  		for j=1, 10 do
  			if JY.Person[JY.Base["???¨¦"..i]]["????"..j] > 0 then
  				menu[JY.Person[JY.Base["???¨¦"..i]]["????"..j]][3] = 1;
  			else
  				break;
  			end
  		end
  	else
  		break;
  	end
  end
	
	local r = -1;
	while true do
		Cls();
		
		r = ShowMenu2(menu,JY.WugongNum-1,4,12,10,(CC.ScreenH-12*(CC.DefaultFont+CC.RowPixel))/2+20,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE, "?????¨½?¨¦????????", r);
		--local r = ShowMenu(menu,n,15,CC.ScreenW/4,20,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
		
		if r > 0 and r < JY.WugongNum then	
			InstruceWuGong(r);
		else
			break;
		end
	end
	
end
--????¡ã??????¡¦?¨½
--[[function smallhead(id)
	if id < 0 or id > JY.PersonNum then
		id = 0
	end
	local filename = string.format("%s%d.png", CONFIG.Head1Path,id)
	if existFile(filename) == false then
		return;
	end
	
end	]]
--?????????¨¾???????¡ì
function InstruceWuGong(id)
	if id < 0 or id >= JY.WugongNum then
		QZXS("?????????¨ª?¨®????¡¦¡§?¨¦??");
		return;
	end
	local filename = string.format("%s%d.txt", CONFIG.WuGongPath,id)
	if existFile(filename) == false then
		QZXS("????????¡ã¨¹?????????¡Â????¡Á???¡Á???");
		return;
	end
	DrawTxt(filename);
end

function TSInstruce()
	local filemenu = {};
	local n = 0;
	for i=1, math.huge do
		if existFile(string.format("%s%d.txt",CONFIG.HelpPath, i)) then
			filemenu[i] = string.format("%s%d.txt",CONFIG.HelpPath, i);
			n = n + 1;
		else
			break;
		end
	end
	
	local menu = {}
	local maxlen = 0;
	for i=1, n do
		local file = io.open(filemenu[i],"r")
		local str = file:read("*l")
		
		if str == nil then
			str = " ";
		end
		
		if #str > maxlen then
			maxlen = #str;
		end
		
		menu[i] = {i..str, nil, 1};
		
		file:close()
	end
	
	local size = CC.DefaultFont;
	
	while true do
		Cls();
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"???¨½????")
		--local r = ShowMenu2(menu,#menu,2,12,20,(CC.ScreenH-12*(size+CC.RowPixel))/2+20,0,0,1,1,size,C_ORANGE,C_WHITE);
		if r > 0 then
			InstruceTS(r);
		else
			do return end  --???????¨¢??????;
		end
		do return end  --???????¨¢??????
	end
end

--?????????¨¾???????¡ì
function InstruceTS(id)
		
	local filename = string.format("%s%d.txt", CONFIG.HelpPath,id)
	if existFile(filename) == false then
		QZXS("????????????????????");
		return;
	end
	
	DrawTxt(filename);
end

function DrawTxt(filename)
	Cls();
	
	--???????????¡Â
	local file = io.open(filename,"r")
	local str = file:read("*a")
	file:close()
	
	local size = CC.DefaultFont;
	local color = C_WHITE;
	
	local linenum = 50;		--?????¡è??
	local maxlen = 14;
	local w = linenum*size/2 + size;
	local h = maxlen*(size+CC.RowPixel) + 2*CC.RowPixel;
	
	local bx = (CC.ScreenW-w)/2;
	local by = (CC.ScreenH-h)/2;
	DrawBox(bx,by,bx+w,by+h,C_WHITE);		--?¡Á???¨¾
	local x = bx + CC.RowPixel;
	local y = by + CC.RowPixel;
	
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	
	local strcolor = AnalyString(str)
	local l = 0
	local row = 0;


	for i,v in pairs(strcolor) do
		while 1 do
			if v[1] == nil then
				break;
			end
			local index = string.find(v[1], "\n")
			
			if l+#v[1] < linenum and index == nil then		--??????????????????????????
				DrawString(x + l*size/2, y + row*(size+CC.RowPixel), v[1], v[2] or color, size);
				l = l + #v[1]

				if i == #strcolor then
					--??????¡Á?	ALungky:j ???? j+1????????????¡Á??????¨¾??¡¦¡§????????????
					for j=0, l do
						lib.SetClip(x,y,x+(j+1)*size/2,y+size+row*(size+CC.RowPixel));
						ShowScreen(1);
					end
					lib.SetClip(0,0,0,0);
				end
				break;
			else	--????????????
				local tmp, pos1, pos2;
				if index == nil then
					pos1 = linenum-l;
					pos2 = pos1+1;
				else
					pos1 = index-1;
					pos2 = pos1+2;
					
					if pos1 > linenum-l then
						index = nil;
						pos1 = linenum-l;
						pos2 = pos1+1;
					end
				end
				
				--??????????????¡¦¨½????????v[1]??¡Á??¨®??????¡¦?
				if pos1 > #v[1] then
					tmp = v[1];
					v[1] = nil;
				else
					tmp = string.sub(v[1], 1, pos1)
					local flag = 0
					for i=1, pos1 do
						if string.byte(tmp, i) <= 127 then
							flag = flag + 1;
						end
					end
					
	
					if math.fmod(flag,2) == 1 and index == nil  then		--????¡ã¨¹??????¡Á?¡¦?
							if string.byte(tmp, -1) > 127 then
								tmp = string.sub(v[1], 1, pos1-1);
								pos2 = pos2 - 1
							end
					end
	
					v[1] = string.sub(v[1], pos2);
				end
					
	
					DrawString(x + l*size/2, y + row*(size+CC.RowPixel), tmp, v[2] or color, size);
	
	
					l = l + #tmp
					--??????¡Á?
					for j=0, l do
						lib.SetClip(x,y,x+j*size/2,y+size+row*(size+CC.RowPixel));
						ShowScreen(1);
					end
					
					--????+1
					row = row + 1
					l = 0

				
			end

			lib.SetClip(0,0,0,0);
			
			if row == maxlen then
				WaitKey();
				row = 0;
				Cls();
				lib.LoadSur(surid, 0, 0)
				
			end
		end
	end
	lib.SetClip(0,0,0,0);
	WaitKey();
	lib.FreeSur(surid)
end

--???¨¹?????¨ª
function NEvent4(keypress)
	if JY.SubScene == 7 and JY.Base["??X1"] == 34 and JY.Base["??Y1"] == 11 and JY.Base["??¡¦??¨¾"] == 2 then
		--???¨¹??????????????????
		if instruct_16(35) and instruct_18(114) and GetS(10, 1, 1, 0) ~= 1 and (keypress == VK_SPACE or keypress == VK_RETURN) then
			SetS(7, 34, 12, 3, 102)
			instruct_3(7, 102, 1, 0, 0, 0, 0, 7148, 7148, 7148, 0, 34, 12)
			say("???¨½?????????????????????????¡ã????¡¦???¡ã???¡Á??¨¹¡Á??????????????????????¨§?¨¾??????????????????????¡Á??¨¢??????", 35, 1)
			say("?????????????????????¨¾????", 140, 0)
			say("??¡¦?????????????", 35,1)
			instruct_14()
			SetS(7, 33, 12, 3, 101)
			instruct_3(7, 101, 1, 0, 0, 0, 0, 5896, 5896, 5896, 0, 33, 12)
			instruct_13()
			PlayMIDI(24)
			lib.Delay(500)
			say("?????????¨²???????????¡Á????????????????¡ã??????????????????¨½???????¨§????¡¦¡Á¡¦¡Á???????????????¡è???¨§???????????????????????????????¨§???¡Á????????????¡¦????????????????¨¦???????¨®?¨ª???????¨²?????????????????¨¦????????????", 140, 0)
			say("?????????????????????????????¡Á??????¡Á????????????¨¢¡ã?????¡¦¨¾??????????????????????????????????????????????", 140, 0)
			say("?????????????????????????????????????????????????¨¾??????¡ã???¡ã?????????", 35, 1)
			instruct_14()
			instruct_3(7, 101, 0, 0, 0, 0, 0, -1, -1, -1, 0, 33, 12)
			instruct_13()
			DrawStrBox(-1, -1, "?????¨®", C_ORANGE, CC.DefaultFont)
			ShowScreen()
			lib.Delay(500)
			say("????????????????????????????¡ã??????¨²???????¡ì???????¡ã?????¨½????¡¦¨¾????????", 35, 1)
			DrawStrBox(-1, -1, "???¨¹???¨§?¨¾??????????", C_ORANGE, CC.DefaultFont)
			ShowScreen()
			lib.Delay(500)
			Cls()
			SetJX(35,1)	--???¨¹????????????
			JY.Person[35]['????????'] = 2
			DrawStrBox(-1, -1, "???¨¹??????????", C_ORANGE, CC.DefaultFont)
			ShowScreen()
			lib.Delay(500)
			Cls()
			SetS(10, 1, 1, 0, 1)
			instruct_3(7, 102, 0, 0, 0, 0, 0, -1, -1, -1, 0, 34, 12)
		end
	end
end

--????????
function NEvent6(keypress)
	if JY.SubScene == 10 then
		SetD(10, 28, 4, -1)
		SetS(10, 23, 22, 1, 2)
		SetS(10, 22, 22, 1, 2)
	end
	if JY.SubScene == 59 then
		JY.SubSceneX = 0
		JY.SubSceneY = 0
	end
end

--?????¨®?¨¢?¨®??SYP¡Á???¡¦??¨¦
function NEvent10(keypress)
  if JY.SubScene == 25 and GetS(10, 0, 9, 0) ~= 1 then
    SetS(25, 9, 44, 3, 103)
    instruct_3(25, 103, 1, 0, 0, 0, 0, 4133*2, 4133*2, 4133*2, 0, -2, -2)
    if JY.Base["??X1"] == 10 and JY.Base["??Y1"] == 44 and JY.Base["??¡¦??¨¾"] == 2 and (keypress == VK_SPACE or keypress == VK_RETURN) and GetD(25, 82, 5) == 4662 then
      say("?????¡¦??????????????????????????¡ã???¡¦??¨¦¡ã???",596,0);
      instruct_14()
      for i = 79, 92 do
          instruct_3(25, i, 1, 0, 0, 0, 0, 4664, 4664, 4664, 0, -2, -2)
      end
      for ii = CC.BookStart, CC.BookStart + CC.BookNum -1 do
          instruct_32(ii, -10)
      end
	  JY.Base["?¨§?¨¦????"] = 15
      instruct_3(25, 75, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2, -2)
      instruct_3(25, 76, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2, -2)
      instruct_13()
      say("???¨¦????¡¦?????????????????????¡ã???", 596,0);
      SetS(10, 0, 9, 0, 1)
      instruct_3(25, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2, -2)
      
    end
  end
end

--?¨®??¡¦? ???????????¡ã?¨®?????????¨¦??
function NEvent12(keypress)
	if JY.SubScene == 95 and GetD(95, 4, 5) ~= 0 and JY.Thing[40]["??????"] ~= -1 then
		JY.Person[JY.Thing[40]["??????"]]["???¡Â"] = -1
		JY.Thing[40]["??????"] = -1
	end
end

--???????¡Â???????¨¦
function mm4R()
	local r = JYMsgBox("?????¨½", "????????????", {"????","????","?¡Â??"}, 3, JY.Person[92]["¡ã??¨ª?¨½"])
	if r == 1 then
		JY.Person[92]["????????"] = 0
		Cls()  --????
	elseif r == 2 then
		JY.Person[92]["????????"] = 1
		Cls()  --????
	elseif r == 3 then
		JY.Person[92]["????????"] = 2
		Cls()  --????
	end
	if JY.Person[0]["¡Á???"] == 50 then
		JY.Person[92]["¡Á???"] = 50
	else
		JY.Person[92]["¡Á???"] = 101 - JY.Person[0]["¡Á???"]
	end
end

--¡Á??¡§??????
function NEvent(keypress)
	--NEvent2(keypress)		--???????¨§?¨¦???¨®????5000?????????¨½??
	--NEvent3(keypress)		--?¨²¨§? ????¡¦?????????¡¦¡§
	NEvent4(keypress)		--???¨¹?????¨ª
	NEvent6(keypress)		--?????? ???¨²¡ã?
	NEvent10(keypress)	--?????¨®?¨¢¡¦??¨¦
	NEvent12(keypress)	--?¨¦????????
end

function fzdy()
	lib.Debug("fzdy");
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local x1,y1 = bx*84,by*163
	local jg = bx*30 
	local h = 20
	local cont = 1
	local cont1 = 0
	local cot = 1
	local cot1 = 0
	local cot2  = 0
	local fy = 0
	local maxh = 0
	local fymax = 0
	local menu = {
		{1,0},
		{2,0},
		{4,0},
		{9,0},
		{16,0},
		{17,0},
		{25,0},
		{28,0},
		{29,0}
	}
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls()
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		local m = menu[cont+cont1*4][1]
		local id = cot + cot1*4
		local mid = menu[m][id]
		
		if mid ~= nil then
			local me = {}
			local row = 0
			local maxh = 15
			if TFJS[mid] ~= nil then
				local row = 0
				local maxh = 15
				for i = 1, #TFJS[mid] do
					me[#me+1] = TFJS[mid][i]
					if i == #TFJS[mid] then 
						me[#me+1] = "??"
					end
				end
			end
			if CC.PTF[mid] ~= nil then 
				for i,v in pairs(CC.PTF[mid]) do 
					if v == 1 then 
						if CC.PTFSM[i] ~= nil then
							me[#me+1] = '??'..CC.PTFSM[i][1]
							me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
							me[#me+1] = "??"
						end
					end
				end
			end			
			for i = 1, #me do
				local tfstr = me[i]
				local h = 0
						
				if string.sub(tfstr,1,2) == "??" then
					row = row + 1
				else
					h = tjm(bx*300, by*280 + size*0.8 * (row-fy), tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
				end
				row = row + h
			end

			if row > maxh then
				fymax = limitX(row-maxh-1,0)
			else
				fymax = 0
			end
		end	
		for i = 1,4 do
			for j = 1,5 do
				local id = i + (j-1+cot2)*4
				local mid = menu[m][id]
				if mid ~= nil then
					local zx = (i-1)*bx*140
					local zy = (j-1)*size
					local headid = JY.Person[mid]["¡ã??¨ª?¨½"]
					lib.LoadPNG(91, headid * 2 ,zx,zy, 2)
				end					
			end
		end			
	end
	--????????
	ShowScreen()
	--???¡¦???????¡§??????????
	--lib.Delay(40)
	--X???¨¹????¡Á¡Â??ktype???¨®????¡Á¡Â??ktype = 3 ?¨²?¨ª¡Á¨®?¨¹??4?¨²?¨ª???¨¹??6????????7??????
	local X,ktype,mx,my = lib.GetKey()
end


function fzdy1()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local xs = 0
	local id = 0
	local menu = {
					{1,1},
					{2,0},
					{4,0},
					{9,0},
					{16,0},
					{17,0},
					{25,0},
					{28,0},
					{29,0}
				}	
	while true do
		lib.LoadPNG(91, 63 * 2 ,0, 0, 1)
		if JY.Restart == 1 then
			return
		end
		Cls()	
		for i = 1,#menu do
			if menu[i][1] ~= nil  then
				id = menu[i][1]
			end
		end	
		local hd = JY.Person[id]["¡ã??¨ª?¨½"]
		lib.LoadPNG(1, hd * 2 ,bx*40,by*40, 2)
		ShowScreen();
	end
end	

function MMapName() --?????¨®?????¡§??
	if JY.Status == GAME_MMAP then --???¡¦¡Á??????¨®??????
		for i = 0,JY.SceneNum - 1 do --???¡¦???????¡ã
	 		if JY.Scene[i]["???¡ã????X1"] ~= 0 then --?????????¨®????????????????¡Á????????¡ã
	 			if JY.Scene[i]["????????"] == 0 then --???????????????¡ã
	 				local sid = i
	 				if sid>=0 then
	 					local dx = JY.Scene[sid]["???¡ã????X1"] - JY.Base["??X"]
	 					local dy = JY.Scene[sid]["???¡ã????Y1"] - JY.Base["??Y"]
	 					local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
	 					local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2	
						if math.abs(dx) <= 15 and math.abs(dy) <= 15 then --?????¡Â??¡ã???15???????????¡ã--?????????????????????????????????????????¡Â??¡ã???15?????????¡ã	
	 						local str = JY.Scene[sid]["????"]
	 						local size = CC.FontSmall*2
	 						local color = C_GOLD;
							DrawStrBox(rx - #str*size/4, ry - CC.YScale*8, str, color, size*0.6)
	 					end
	 				end
				end
			end
		end
	end
end	
function Duiwumb()
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	local zuobiao = {10,312}			
	local tb = 1 
	local lieshu = 8
	local pg = 0
	local jg = 20
	local liebiao = {}
	local cl = C_CYGOLD
	local size = CC.DefaultFont
	local id = - 1
	local TB = 0
	while true do 
		Cls()
		if JY.Restart == 1 then
			break
		end	
		local i = 0
		lib.Background(0,CC.ScreenH/2-50,CC.ScreenW,CC.ScreenH/2+150,98)

		for ii = 1,CC.TeamNum do 
			if JY.Base['???¨¦'..ii] >= 0 then 
				liebiao[ii] = {JY.Person[JY.Base['???¨¦'..ii]]['????'],JY.Base['???¨¦'..ii]}				
			end	
		end		
		if lieshu > #liebiao then
			lieshu = #liebiao
		end
		for ai = 1,lieshu do
			local tw = 0
			if CC.Png[JY.Person[liebiao[ai+pg][2]]['¡ã??¨ª?¨½']] ~= nil then 
				tw = CC.Png[JY.Person[liebiao[ai+pg][2]]['¡ã??¨ª?¨½']]
			end
			local cl1 = C_CYGOLD
			local pc = 72
			local pc1 = 74
			local pc2 = 72
			if tb == ai then
				cl1 = C_RED				
			end					
			DrawString(bx*zuobiao[1]+bx*62-string.len(liebiao[ai+pg][1])/4*size+(ai-1)*bx*152,by*zuobiao[2]+by*150,liebiao[ai+pg][1],cl1,size)
			local headid = JY.Person[liebiao[ai+pg][2]]["¡ã??¨ª?¨½"]
			lib.PicLoadCache(92,116*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
			lib.LoadPNG(1,headid*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
			lib.PicLoadCache(92,117*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
			if tb == ai then
				TB = ai + pg
				lib.LoadPNG(91,pc*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
				pc = pc + 1
				if pc > pc1 then
					pc = pc2
				end
			end		
		end		
		ShowScreen()
		lib.Delay(40)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_ESCAPE or ktype == 4 then
			return pg
		elseif X == VK_SPACE or X == VK_RETURN then 
			--ShowPersonStatus(TB)
			--PersonStatus(TB)
			return TB
		elseif  X == VK_RIGHT then
			tb = tb + 1
			if tb > lieshu then
				pg = pg + 1
				tb = lieshu
			end	
			if tb + pg > #liebiao then
				tb = 1
				pg = 0
			end	
		elseif  X == VK_LEFT then
			if pg > 0 then
				if tb > 1 then
					tb = tb - 1
				else
					pg = pg - 1
				end	
			else
				tb = tb - 1
				if tb < 1 then
					tb = lieshu
				end	
			end	
		elseif X == VK_UP or ktype == 6 then
			pg = pg - lieshu
			tb = 1
			if pg < 0 then 
				pg = 0 
			end
		elseif X == VK_DOWN or ktype == 7 then
			pg = pg + lieshu
			if pg + lieshu > #liebiao then 
				pg = #liebiao-lieshu
				tb = 1
			end
		else
			local mxx = false
			for j = 1,lieshu do
				if mx > bx*10+(j-1)*bx*152 and mx < bx*152+(j-1)*bx*152 and my > by*300 and my < by*500 then
					tb = j
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then
				--ShowPersonStatus(TB)
				--PersonStatus(TB)
				return TB				
			end						
		end
	end
end


	
--?????¡Á¡Á¡ã ????id,?¡Á¡Á¡ãid
function PDTZ(id,Tid)
	-- JY.Person[id]["???¡Â"] = - 1
	-- JY.Person[id]["¡¦???"] = - 1
	-- JY.Person[id]["¡Á???"] = - 1
	if Tid <= 547 then
		return false
	
	end
	
	
	if Setmeal[Tid][1] ~= JY.Person[id]["???¡Â"] then
		return false
	end
	
	if Setmeal[Tid][2] ~= JY.Person[id]["¡¦???"] then
		return false
	end
	
	if Setmeal[Tid][3] ~= JY.Person[id]["¡Á???"] then
		return false
	end
	
	return true
	--return false
end


function NPC_CZB(id,Tid)
	if Tid <= 547 then
		return false
	
	end
	JY.Person[id]["???¡Â"] = Setmeal[Tid][1]--???????¡Á
	JY.Person[id]["¡¦???"] = Setmeal[Tid][2]--¡¦????¡Á
	JY.Person[id]["¡Á???"] = Setmeal[Tid][3]--¡ã¡Á?¨ª
	JY.Thing[JY.Person[id]["???¡Â"]]["¡Á¡ã??????"] = 6
	JY.Thing[JY.Person[id]["¡¦???"]]["¡Á¡ã??????"] = 6
	JY.Thing[JY.Person[id]["¡Á???"]]["¡Á¡ã??????"] = 6
	
	
end

function MPTX(id,mp,dj)	
	if match_ID(id,46) and mp == 1 then
		return true
	end
	if (match_ID(id,50) or match_ID(id,69)) and mp == 2 then
		return true
	end
	if match_ID(id,605) and mp == 3 then
		return true
	end
	if match_ID(id,5) and mp == 4 then
		return true
	end	
	if match_ID(id,577) and mp == 5 then
		return true
	end	
	if match_ID(id,62) and mp == 6 then
		return true
	end
	if match_ID(id,97) and mp == 6  then
		return true
	end	
	if match_ID(id,116) and mp == 7 then
		return true
	end
	if match_ID(id,117) and mp == 7 then
		return true
	end
	if match_ID(id,118) and mp == 7 then
		return true
	end
	if match_ID(id,60) and mp == 8 then
		return true
	end
	if match_ID(id,92) and mp == 9 then
		return true
	end
	if match_ID(id,57) and mp == 10 then
		return true
	end	
	if (match_ID(id,501) or match_ID(id,596)) and mp == 11 then
		return true
	end
	if match_ID(id,26) and mp == 12 then
		return true
	end
	if match_ID(id,27) and mp == 12 then
		return true
	end
	if match_ID(id,641) and mp == 13 then
		return true
	end
	if match_ID(id,456) and (mp == 12 or mp == 13) then
		return true
	end	
	if match_ID(id,499) and mp == 15 then
		return true
	end
	if match_ID(id,65) and mp == 15 then
		return true
	end
	if match_ID(id,129) and mp == 16 then
		return true
	end
	if match_ID(id,64) and mp == 16 then
		return true
	end
	if match_ID(id,626) and mp == 17 then
		return true
	end
	if mp == 19 and (match_ID(id,586) or match_ID(id,604)) then
		return true
	end	
	if match_ID(id,514) and mp == 20 then
		return true
	end
	if match_ID(id,515) and mp == 21 then
		return true
	end	
	if match_ID(id,520) and mp == 22 then
		return true
	end
	if match_ID(id,568) and mp == 23 then
		return true
	end
	if (match_ID(id,517) or match_ID(id,526)) and mp == 24 then
		return true
	end
	if match_ID(id,749) and mp == 25 then
		return true
	end
	if match_ID(id,765) and mp == 27 then
		return true
	end
	if match_ID(id,635) and mp == 30 then
		return true
	end
	if MPPD(id) > 0 then
		if dj ~= nil then
			if MPPD(id) == mp and MPDJ(id) >= dj then
				return true
			else
				return false
			end		
		else
			if MPPD(id) == mp then
				return true
			else
				return false
			end
		end			
	else
		return false
	end	
	return false	
end	

function MPPD(tmppid)
    -- local xwperson
	-- if tmppid == JY.Base["????"] then
		-- xwperson = 0
	-- else
		-- xwperson = tmppid
	-- end	
	-- if JY.Person[xwperson]["????"] == nil or JY.Person[xwperson]["????"] < 101 then
		-- return 0
	-- end
	--return tmppid
	local xwperson = (JY.Person[tmppid]["????"] or 0)
	
	return xwperson
end


function MPDISPLAY(tmppid) --????????
	local aa = MPPD(tmppid)
	local bb = MPDJ(tmppid)

	if aa == 63 then
		local name = ownMPstat(1)
		local level = ownMPstat(2)
		local mptype = name[1]
		local mpdj = level[bb]
		return mptype, mpdj
	end
	if CC.MP[aa][1] == nil or CC.MPDJ[aa][bb] == nil then
		return nil, nil
	end
	local mptype = CC.MP[aa][1]
	local mpdj = CC.MPDJ[aa][bb]
	return mptype, mpdj
end


function MPDJ(tmppid)
    -- local xwperson
	-- if tmppid == JY.Base["????"] then
		-- xwperson = 0
	-- else
		-- xwperson = tmppid
	-- end	
	-- local mpdj
	-- if MPPD(xwperson) == 0 then
		-- return 0
	-- end
	-- mpdj = math.fmod(JY.Person[xwperson]["????"], 100)
	local xwperson = JY.Person[tmppid]["???????¡Á"]
	
	return xwperson
end


function ownMPstat(flag)
	local wugong = 122
	local name = {JY.Wugong[wugong]["????"], nil, 1, "¡Á???"}
	local level = {"??????¡Á?", "??????¡Á?", "????"}
	local attrib = {} 
	for i = 1, 9 do
		attrib[i] = JY.Wugong[wugong][i.."??????????"] * 0.1
	end
	local askill = {GRTS[JY.Wugong[wugong]["????4"]], GRTS[JY.Wugong[wugong]["????5"]]}
	if flag == 1 then
		return name
	elseif flag == 2 then
		return level
	elseif flag == 3 then
		return attrib
	else
		return askill
	end
end
function ownMP()
	if GetS(106, 0, 0, 0) == 1 then
		return true
	end
	return false
end

--?¨ª??????
--[[function zj()
	--if GetS(103, 0, 0, 1) < 0 then
		--return 0
	--end
	--return GetS(103, 0, 0, 1)
	return 0
end]]

function JoinMP(tmppid, mptype, mpdj)
	
	if tmppid == JY.Base["????"] then
		tmppid = 0
	end
	local personid = tmppid
	local r = -1
	if inteam(personid) then
		r = JYMsgBox("????????",JY.Person[personid]["????"].."??¡¦¨½??????"..CC.MP[mptype][1].."??????"..CC.MPDJ[mptype][mpdj].."??", {"??","¡¦¨½"}, 2, 189)
	else
		r = 1
	end	
	if r == 1 then
		if tmppid == 0 and mptype == 5 and mpdj == 4 then
			local r = JYMsgBox(rwwh(0,1), "???????¨½??????????????¡ã???    *???????????¡ã??????",  {"???????¡Â", "???????¡Â","???????¡Â"},3 , 1055, 1)
			local str = {"???????¡Â", "???????¡Â","???????¡Â"}
			QZXS('????'..str[r]..'??')
			CC.TX['???????????¨½'] = r 
		end	
		if JY.Person[tmppid]['????'] == 0 or JY.Person[tmppid]['????'] ~= mptype then
			JY.Person[tmppid]["????"] = mptype
			JY.Person[tmppid]["???????¡Á"] = mpdj
		else
			if JY.Person[tmppid]["???????¡Á"] < mpdj then
				JY.Person[tmppid]["???????¡Á"] = mpdj
			end
		end	
	end			
end

function MPReq(tmppid, mptype) --????????
	if MPPD(tmppid) == MPPD(0) and MPDJ(tmppid) == MPDJ(0) - 1 then
		return false
	end
	if mptype == 1 then
        return true
	elseif mptype == 2 or mptype == 3 then
		if JY.Person[tmppid]["?¡¦??"] >= 50 then
			return true
		end	
	elseif mptype == 4 then
		if JY.Person[tmppid]["????¡Á??¨®??"] >= 2000 then
			return true
		end		
	elseif mptype == 5 then
		if JY.Person[tmppid]["????¡Á??¨®??"] >= 3000 then
			return true
		end
	elseif mptype == 6 then
		if JY.Person[tmppid]["????????"] >= 100 then
			return true
		end	
	elseif mptype == 7 then
		if JY.Person[tmppid]["????????"] >= 75 then
			return true
		end	
	elseif mptype == 8 then
		if JY.Person[tmppid]["¡Á???"] >= 75 then
			return true
		end	
	elseif mptype == 11 then
		if JY.Person[tmppid]["????????"] >= 300 then
			return true
		end	
	elseif mptype == 12 then
		if JY.Person[tmppid]["?¡¦??"] > 50 then
			return true
		end	
	elseif mptype == 13 then
		if JY.Person[tmppid]["????¡Á??¨®??"] >= 3000 then
			return true
		end
	elseif mptype == 13 then
		if JY.Person[tmppid]["????????"] >= 100 then
			return true
		end				
	elseif mptype == 63 then
		return true
	end
	return false
end

function MPAttrib(pid,f)	
	local mptype = MPPD(pid)
	--local mpdj = MPDJ(pid)
	if f == nil then
		f = 0
	end	
	--1?? 2¡¦? 3?¨¢ 4?? 5?? 6?? 7¡ã? 8?¨¹ 9?? 10 11 12 13???? CC.MPAttrib
	if mptype > 0 and f == 0 then
		local n = JY.Person[pid]["???¡Â??"]
		JY.Person[pid]["???¡Â??"] = math.modf(n + (CC.MPAttrib[mptype][1]-1) * n)
		
		n = JY.Person[pid]["¡¦?????"]
		JY.Person[pid]["¡¦?????"] = math.modf(n + (CC.MPAttrib[mptype][2]-1) * n)
		
		n = JY.Person[pid]["?¨¢??"]
		JY.Person[pid]["?¨¢??"] = math.modf(n + (CC.MPAttrib[mptype][3]-1) * n)
		
		n = JY.Person[pid]["????????"]
		JY.Person[pid]["????????"] = math.modf(n + CC.MPAttrib[mptype][4])
		
		n = JY.Person[pid]["????????"]
		JY.Person[pid]["????????"] = math.modf(n + CC.MPAttrib[mptype][5])
		
		--n = JY.Person[pid]["????????"]
		--JY.Person[pid]["????????"] = math.modf(n + CC.MPAttrib[mptype][6])
		
		n = JY.Person[pid]["¡ã??¡Â????"]
		JY.Person[pid]["¡ã??¡Â????"] = math.modf(n + CC.MPAttrib[mptype][7])
		
		n = JY.Person[pid]["?¨²?¨¹¡Á??¨®??"]
		JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] = math.modf(n + (CC.MPAttrib[mptype][8]-1)* n)
		
		n = JY.Person[pid]["????¡Á??¨®??"]
		JY.Person[pid]["????¡Á??¨®??"] = math.modf(n + (CC.MPAttrib[mptype][9]-1)* n)
	end
	if mptype > 0 and f == -1 then
		local n = JY.Person[pid]["???¡Â??"]
		JY.Person[pid]["???¡Â??"] = math.modf(n - (CC.MPAttrib[mptype][1]-1) * n)
		
		n = JY.Person[pid]["¡¦?????"]
		JY.Person[pid]["¡¦?????"] = math.modf(n - (CC.MPAttrib[mptype][2]-1) * n)
		
		n = JY.Person[pid]["?¨¢??"]
		JY.Person[pid]["?¨¢??"] = math.modf(n - (CC.MPAttrib[mptype][3]-1) * n)
		
		n = JY.Person[pid]["????????"]
		JY.Person[pid]["????????"] = math.modf(n - CC.MPAttrib[mptype][4])
		
		n = JY.Person[pid]["????????"]
		JY.Person[pid]["????????"] = math.modf(n - CC.MPAttrib[mptype][5])
		
		--n = JY.Person[pid]["????????"]
		--JY.Person[pid]["????????"] = math.modf(n - CC.MPAttrib[mptype][6])
		
		n = JY.Person[pid]["¡ã??¡Â????"]
		JY.Person[pid]["¡ã??¡Â????"] = math.modf(n - CC.MPAttrib[mptype][7])
		
		n = JY.Person[pid]["?¨²?¨¹¡Á??¨®??"]
		JY.Person[pid]["?¨²?¨¹¡Á??¨®??"] = math.modf(n - (CC.MPAttrib[mptype][8]-1)* n)
		
		n = JY.Person[pid]["????¡Á??¨®??"]
		JY.Person[pid]["????¡Á??¨®??"] = math.modf(n + (CC.MPAttrib[mptype][9]-1)* n)
	end
	Hp_Max(pid)
end

--????¡Á¡§??
function YishuZJ(id,ys)
	if id == nil or id < 0 then
		return false
	end
	if id ~= nil and (ys == nil or ys < 0 ) then
		if JY.Person[id]['????????6'] > 0 then
			return true
		else
			return false
		end
	end
	if ys == 187 and (JXPD(id,28,1) or (match_ID(id,28) and inteam(id) == false)) then --¡Á?????????
		return true
	end
	if ys == 188 and (JXPD(id,45,1) or (match_ID(id,45) and inteam(id) == false)) then --??????????
		return true
	end
	if ys == 189 and (JXPD(id,16,1) or (match_ID(id,16) and inteam(id) == false)) then --?¨²???????¨¦
		return true
	end
	if ys == 190 and (JXPD(id,4,1) or (match_ID(id,4) and inteam(id) == false)) then --?¡ì??¡¦?
		return true
	end
	if ys == 191 and (JXPD(id,85,1) or (match_ID(id,85) and inteam(id) == false)) then --????????
		return true
	end
	if ys == 192 and (JXPD(id,17,1) or (match_ID(id,17) and inteam(id) == false)) then --????
		return true
	end
	--[[ if ys == 193 and (JXPD(id,2,1) or (match_ID(id,2) and inteam(id) == false)) then --?????¨½??
		return true
	end ]]
	if JY.Person[id]['????????6'] > 0 then
		if JY.Person[id]['????????6'] == ys then
			return true
		else
			return false
		end		
	else
		return false
	end
end

--¡ã??¡Â???¡ì
function AnqiWG(id,aq)
	if id == nil or id < 0 then
		return false
	end
	if id ~= nil and (aq == nil or aq < 0 ) then
		if JY.Person[id]['????????2'] > 0 then
			return true
		else
			return false
		end
	end			
	-----------¡Á???¡ã??¡Â???????¡§---------
	if aq == 450 and (JXPD(id,626,1) or match_ID(id,456)) then--???¡§?¡Á????
		return true
	end
	if aq == 458 and JXPD(id,161,1)  then--????????	
		return true
	end	
	if aq == 459 and (JXPD(id,117,1) or JXPD(id,634,1)) then--?¨²??¡¦?
		return true
	end	
	if aq == 460 and (JXPD(id,57,1) or (match_ID(id,57) and inteam(id) == false)) then--??????
		return true
	end	
	if aq == 469 and (match_ID(id,456) or JXPD(id,27,1) or (match_ID(id,27) and inteam(id) == false)) then --?????¨½??
		return true
	end
	if aq == 486 and ((match_ID(id,161) and MPTX(id,24)) or match_ID(id,517)) then--?????¡§
		return true
	end
	if aq == 489 and (JXPD(id,54,1) or match_ID(id,83)) then--??¨¾???¨®???
		return true
	end	
	if aq == 490 and (JXPD(id,2,1) or (match_ID(id,2) and inteam(id) == false)) then--????¡Á?
		return true
	end	
	if aq > 0 and match_ID(id,92) then
		return true
	end	
	if JY.Person[id]['????????2'] > 0 then
		if JY.Person[id]['????????2'] == aq then
			return true
		else
			return false
		end		
	else
		return false
	end		
end

function PJPD(pp)
	if GetS(106, pp, 0, 0) ~= 0 then
		return true
	else
		return false
	end
end

function PDReq(pid, str, aa, bb)
	if JY.Person[pid][str] >= aa and JY.Person[pid][str] <= bb then
		return true
	else
		return false
	end
end

-- function TGTF2()
    -- local bx = CC.ScreenW/1360
    -- local by = CC.ScreenH/768
    -- local cot = 1
    -- local cot1 = 0
    -- local cot2 = 0
    -- local size = CC.DefaultFont*0.7
    -- local maxn = 7
    -- local page = 1
    -- local jl = 0
    -- local menu = {}
    -- local w = math.modf(bx*218/size)
	-- local zm = JY.Base["????"]
	-- local zmtf = math.ceil(zm/4)
	-- local zmtf = 10
	-- local tftable = {}
	-- local sj = JY.Base["????"]+100
	-- -- zmtf = zmtf + zm
	-- -- if zmtf > 32 then
		-- -- zmtf = 32
	-- -- end
	-- -- if sj > #CC.TGJL then
		-- -- sj = #CC.TGJL
	-- -- end	
	-- -- RandFetch(tftable,sj,#CC.TGJL)
	-- -- --table:DeleteEqualElement(?¨§???¨ª)

	-- -- for i = 0,#CC.TGJL do
		-- -- menu[i] = CC.TGJL[tftable[i]]
	-- -- end	

    -- -- if #menu <= 0  then
        -- -- return   
    -- -- end
	-- for k,v in pairs(CC.PTFSM) do
		-- menu[#menu+1]=k
	-- end
	
    -- menu[#menu+1] = -1
    -- local hs = math.ceil((#menu-1)/4)
	-- if hs > 9 then
		-- hs = 9
	-- end
    -- if hs > maxn then 
        -- maxn = hs
	-- end

    -- while true do
	   -- if JY.Restart == 1 then
            -- break
       -- end	
        -- ClsN()
        -- lib.LoadPNG(91,46*2,0,0,1)
        -- for i = 1,4 do 
            -- for j = 1,maxn do
                -- local tf = i + (j-1+cot2)*4
                -- local sm = CC.PTFSM[menu[tf]]
                -- local cl = M_Wheat
                -- if tf == cot + cot1*4 then 
                    -- cl = C_RED
                -- end 
                -- if sm ~= nil then
                    -- lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150+bx*212,by*100+(j-1)*by*63+by*33.5,2)
                    -- DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size+bx*212,by*99+(j-1)*by*63-size/2+by*33.5,sm[1],cl,size)
                -- end
            -- end
        -- end
        
        -- local n = 0
        -- local dtf = '??'
        -- local xtf = '??'
        
        -- DrawString(bx*63+bx*212,by*100-size/2+by*33.5,'?????¨§??',M_Wheat,size)
        
        -- if jl > 0 then 
            -- if CC.PTFSM[jl] ~= nil then 
                -- local ptf = CC.PTFSM[jl][2]
                -- dtf = CC.PTFSM[jl][1]
                -- if ptf ~= nil then 
                    -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,ptf,C_WHITE,size,w,size)
                -- end   
            -- end
        -- else 
            -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,'?????¨§??',C_WHITE,size,w,size)
        -- end
        -- n = n + 2
        -- DrawString(bx*190+bx*212,by*100-size/2+by*33.5,dtf,C_RED,size)
        
        -- if cot + cot1*4 == #menu then 
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'??????',C_RED,size)
        -- else    
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'??????',M_Wheat,size)
        -- end
        
        -- DrawString(bx*63+bx*212,by*100-size/2+ size + n*size+by*33.5,'???¡ã?¨§??',M_Wheat,size)
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        -- end    
        -- DrawString(bx*190+bx*212,by*100-size/2+ size + n*size+by*33.5,xtf,C_RED,size)
        -- n = n + 1
        
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            -- if ptf ~= nil then
                -- n = tjm(bx*63+bx*212,by*100-size/2 + size+n*size+by*33.5,ptf,C_WHITE,size,w,size)
            -- end
        -- end

        
        -- --???¡ì???¡ã??????¡¦¡§????¡Á?
        -- ShowScreen()
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if cot + cot1*4 < #menu then 
                -- jl = menu[cot+cot1*4]
            -- else
                -- if jl > 0 then
                -- CC.TG[jl] = 1
				-- end
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then
			
		-- elseif X == VK_UP then
			-- if cot1 > 0 then
				-- if cot1 == cot2 then
					-- cot2 = limitX(cot2 - 1,0)
				-- end
				-- cot1 = cot1 - 1
			-- else 
				-- cot = 1
			-- end
        -- elseif X == VK_DOWN then
			-- if cot + cot1*4 < #menu then
				-- if cot1 < math.ceil((#menu)/4) - 1 then 
					-- cot1 = cot1 + 1 
					-- if cot + cot1*4 > (#menu) then
						-- cot = (#menu) - cot1*4
					-- end
				-- else 
					-- cot = (#menu) - cot1*4
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- elseif X == VK_LEFT then
			-- cot = cot - 1 
			-- if cot1 > 0 then 
				-- if cot < 1 then
					-- if cot1 == cot2 then
						-- cot2 = limitX(cot2 - 1,0)
					-- end
					-- cot1 = cot1 - 1
					-- cot = 4
				-- end
			-- elseif cot < 1 then 
				-- cot = 1
			-- end
		-- elseif X == VK_RIGHT then
			-- if cot + cot1*4 < (#menu) then
				-- cot = cot + 1
				-- if cot > 4 then
					-- if cot1 < math.ceil((#menu)/4) - 1 then 
						-- cot = 1 
						-- cot1 = cot1 + 1
					-- end	
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- else--0,0
			-- local mxx = false
            -- if mx >= bx*742+bx*212 and mx <= bx*896+bx*212 and my >= by*638+by*33.5 and my <= by*673+by*33.5 then
                -- cot1 = maxn-1
                -- cot = (#menu) - cot1*4
                -- mxx = true
            -- else
                -- for i = 1,4 do 
                    -- for j = 1,maxn do
                        -- --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        -- if mx >= bx*396+(i-1)*bx*150-bx*67+bx*212 and mx <= bx*396+(i-1)*bx*150+bx*67+bx*212 and 
                            -- my >= by*100+(j-1)*by*63-by*17+by*33.5 and my <= by*100+(j-1)*by*63+by*17+by*33.5 then 
                            -- local p = i+(j - 1 + cot2)*4
                            -- if CC.PTFSM[menu[p]] ~= nil then 
                                -- cot = i 
                                -- cot1 = j - 1 + cot2
                                -- mxx = true 
                                -- break
                            -- end
                        -- end	
                    -- end
                -- end	 
            -- end  
            -- if mxx == true and ktype == 3 then 
                -- if cot + cot1*4 < #menu then 
                    -- jl = menu[cot+cot1*4]
                -- else
                    -- if jl > 0 then
                    -- CC.TG[jl] = 1
					-- end
                    -- break
                -- end
            -- end
        -- end
    -- end
    -- --CC.TGJL = {}
-- end

function TGTF()
    -- local bx = CC.WX
    -- local by = CC.HY
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxh = 7
    local page = 1
    local jl = 0
    local menu = {}
    local w = math.modf(bx*218/size)
	local zm = JY.Base["????"]
	local zmtf = math.ceil(zm/4)
	local zmtf = 10
	local tftable = {}
	local sj = JY.Base["????"]+100
	zmtf = zmtf + zm
	if zmtf > 32 then
		zmtf = 32
	end
	-- if sj > #CC.TGJL then
		-- sj = #CC.TGJL
	-- end	
	-- RandFetch(tftable,sj,#CC.TGJL)
	-- --table:DeleteEqualElement(?¨§???¨ª)

	-- for i = 0,#CC.TGJL do
		-- menu[i] = CC.TGJL[tftable[i]]
	-- end	

    -- if #menu <= 0  then
        -- return   
    -- end
	for k,v in pairs(CC.PTFSM) do
		if CC.PTFSM[k][3] < 3 then
			menu[#menu+1]=k
		end	
	end
	
    menu[#menu+1] = -1
    local hs = math.ceil((#menu-1)/6)
	if hs > 9 then
		hs = 9
	end
    if hs > maxh then 
        maxh = hs
	end

    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,6 do 
            for j = 1,maxh do
                local tf = i + (j-1+cot2)*6
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*6 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,168*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = '??'
        local xtf = '??'
        
        DrawString(bx*63,by*100-size/2,'?????¨§??',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3] > 2 then 
				local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
					n = tjm(bx*63,by*100-size/2 + size,'????????',M_Gray,size,w,size)
                end   	
			elseif CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3]<3 then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'?????¨§??',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*6 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'???¡ã?¨§??',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*6]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*6]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --???¡ì???¡ã??????¡¦¡§????¡Á?
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if cot + cot1*6 < #menu then 
                jl = menu[cot+cot1*6]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			
		elseif X == VK_UP then
			PlayWavE(77)
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
		elseif X == VK_DOWN then
			PlayWavE(77)
			if cot + cot1*6 < #menu then
				if cot1 < math.ceil((#menu)/6) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*6 > (#menu) then
						cot = (#menu) - cot1*6
					end
				else 
					cot = (#menu) - cot1*6
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
		elseif X == VK_LEFT then
			PlayWavE(77)
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 6
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			PlayWavE(77)
			if cot + cot1*6 < (#menu) then
				cot = cot + 1
				if cot > 6 then
					if cot1 < math.ceil((#menu)/6) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxh-1
                cot = (#menu) - cot1*6
                mxx = true
            else
                for i = 1,6 do 
                    for j = 1,maxh do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*6
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
			if mxx == true and ktype == 3 then 
				PlayWavE(77)
                if cot + cot1*6 < #menu then 
                    jl = menu[cot+cot1*6]
                else
                    if jl > 0 and CC.PTFSM[jl][3]<3 then
                    	--SetTF(0,jl,1)
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end
function TGTF1()
    -- local bx = CC.WX
    -- local by = CC.HY
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxh = 7
    local page = 1
    local jl = 0
	local maxn = 9
    local menu = {}
    local w = math.modf(bx*218/size)
	local zm = JY.Base["????"]
	local zmtf = math.ceil(zm/4)
	local zmtf = 10
	local tftable = {}
	local sj = JY.Base["????"] + 100
	zmtf = zmtf + zm
	if zmtf > 32 then
		zmtf = 32
	end
	-- if sj > #CC.TGJL then
		-- sj = #CC.TGJL
	-- end	
	-- RandFetch(tftable,sj,#CC.TGJL)
	-- --table:DeleteEqualElement(?¨§???¨ª)

	-- for i = 0,#CC.TGJL do
		-- menu[i] = CC.TGJL[tftable[i]]
	-- end	

    -- if #menu <= 0  then
        -- return   
    -- end
	menu = {9988,9984,9981,9980,9973,9972,
	        9971,9970,9955,9954,9953,9952,
			9951,9949,9947,9934,9924,9923,
			9922,9916,9911,9903,9901,9897,
			9890,9880,9878,9877,9875,9874,
			9872,9871,9870,9867,9864,9859,
			9852,9850,9840,9839,9825,9824,
			9804,9802,9798,9793,9769,9768,
			9767,9766,9765,9762,9755,9737}
    menu[#menu+1] = -1
    local max = math.ceil((#menu-1)/6)
    if maxn > max then 
        maxn = max
    end
	
    menu[#menu+1] = -1
    local hs = math.ceil((#menu-1)/6)
	if hs > 9 then
		hs = 9
	end
    if hs > maxh then 
        maxh = hs
	end

    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,6 do 
            for j = 1,maxh do
                local tf = i + (j-1+cot2)*6
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*6 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,168*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = '??'
        local xtf = '??'
        
        DrawString(bx*63,by*100-size/2,'?????¨§??',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3]>2 then 
			   local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
            n = tjm(bx*63,by*100-size/2 + size,'????????',M_Gray,size,w,size)
                end   	
			elseif CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3] < 3 then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'?????¨§??',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*6 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'??????',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'???¡ã?¨§??',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*6]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*6]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --???¡ì???¡ã??????¡¦¡§????¡Á?
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if cot + cot1*6 < #menu then 
                jl = menu[cot+cot1*6]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			
		elseif X == VK_UP then
			PlayWavE(77)
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
		elseif X == VK_DOWN then
			PlayWavE(77)
			if cot + cot1*6 < #menu then
				if cot1 < math.ceil((#menu)/6) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*6 > (#menu) then
						cot = (#menu) - cot1*6
					end
				else 
					cot = (#menu) - cot1*6
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
		elseif X == VK_LEFT then
			PlayWavE(77)
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 6
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			PlayWavE(77)
			if cot + cot1*6 < (#menu) then
				cot = cot + 1
				if cot > 6 then
					if cot1 < math.ceil((#menu)/6) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxh-1
                cot = (#menu) - cot1*6
                mxx = true
            else
                for i = 1,6 do 
                    for j = 1,maxh do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*6
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
			if mxx == true and ktype == 3 then 
				PlayWavE(77)
                if cot + cot1*6 < #menu then 
                    jl = menu[cot+cot1*6]
                else
                    if jl > 0 and CC.PTFSM[jl][3] < 3 then
                    	--SetTF(0,jl,1)
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end
function RandFetch(list,num,poolSize,pool) -- list ??¡¦??????¨¢????num ??????????poolSize ???????¨®????pool ??????
    pool = pool or {}
    math.randomseed( tonumber(tostring(os.time()):reverse():sub(1,6)))
    for i=1,num do
        local rand = math.random(i,10)
        local tmp = pool[rand] or rand -- ????????????¡Á????¨¾???¨²id??????????
        pool[rand] = pool[i] or i
        pool[i] = tmp
        table.insert(list, tmp)
		--math.random()
    end
end
function removebyvalue(array, value, removeadll)
	--    table?????????¡§????(¡¦??????¡Â??)
	--    @param    array ????¡Á¡Â?????¡Â
	--    @param     value ????value??
	--     @param    removeadll ??¡¦¨½????????????????
	--    @return ¡¦???????????????
    --    deleteNum????????/¡¦???????????; i/max ????????while???¡¦
    local deleteNum,i,max=0,1,#array
    while i<=max do
        if array[i] == value then
            --    ?¡§???¡Â????¡Á¡Â?¨ª??????????
            table.remove(array,i)
            --    ????????????
            deleteNum = deleteNum+1 
            i = i-1
            --    ????while???¡¦??¡Á¡Â
            max = max-1
            --    ??????¡¦¨½??????????????value??
			if not removeadll then 
				break 
			end
        end
        i= i+1
    end
    --    ¡¦???????????
    return deleteNum
end

function saveShowMenu(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
	--	lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
		DrawString(280,CC.ScreenH*1/6+40,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"), C_ORANGE, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--?????????????¡¦?¨§???¨¹???¨²???¡§
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "¡Á???" then
		In_Battle = true
	end
	--?????????????????????¡§
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "????" then
		In_Tactics = true
	end
	--???¨¹???????¡§
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "????" then
		In_Other = true
	end	
	--???????¡¦?????¨ª???????????¨§???¨¹
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--?¨§???¨¹?¨¢??????
		if In_Battle == true then
			if newMenu[i][1] == "???¡Â" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¨¹" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¡¦???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
			if newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "????" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "????" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "???¡¦" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "¡Á???" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
				end
			end
		 end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc ?¨¾ ????
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ?????????????¨¢??????BUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ?????????????¨¢??????BUG
				start = 1
			end
		--?????????????¡¦?¨§???¨¹
		--???¡Â
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9???????¡Â
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¨¹
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¡¦
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡Á???
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????????
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C?¨¦??
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡¦???
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--????
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--?????¡¦??
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 2000 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					--??????????¡Á?
					elseif JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--????????????????¡¦???20¡Á¡Â?????¡§????
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --?¡Â??????????
			
					--????????????????????????¡¦?????????????????
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--????????????????¡¦???20¡Á¡Â?????¡§????
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end



function selectShowMenu2(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
		lib.LoadPNG(91, 502 * 2 , bx*190+bx*212 , by*145+by*33.5, 1)
		--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"), C_ORANGE, CC.DefaultFont)
		DrawString(CC.ScreenW/2-CC.DefaultFont*3-25, CC.ScreenH/2-CC.DefaultFont*7+by*25, "?????¨½???¨¹????", C_RED, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--?????????????¡¦?¨§???¨¹???¨²???¡§
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "¡Á???" then
		In_Battle = true
	end
	--?????????????????????¡§
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "????" then
		In_Tactics = true
	end
	--???¨¹???????¡§
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "????" then
		In_Other = true
	end	
	--???????¡¦?????¨ª???????????¨§???¨¹
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--?¨§???¨¹?¨¢??????
		if In_Battle == true then
			if newMenu[i][1] == "???¡Â" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¨¹" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¡¦???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
		if newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¡¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "¡Á???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
			end
		end
	  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc ?¨¾ ????
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ?????????????¨¢??????BUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ?????????????¨¢??????BUG
				start = 1
			end
		--?????????????¡¦?¨§???¨¹
		--???¡Â
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9???????¡Â
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¨¹
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¡¦
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡Á???
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????????
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C?¨¦??
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡¦???
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--????
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--?????¡¦??
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 2000 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					--??????????¡Á?
					elseif JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--????????????????¡¦???20¡Á¡Â?????¡§????
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --?¡Â??????????
			
					--????????????????????????¡¦?????????????????
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--????????????????¡¦???20¡Á¡Â?????¡§????
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end


function selectShowMenu1(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
		lib.LoadPNG(91, 502 * 2 , bx*190+bx*212 , by*145+by*33.5, 1)
		--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"), C_ORANGE, CC.DefaultFont)
		DrawString(CC.ScreenW/2-CC.DefaultFont*3-25, CC.ScreenH/2-CC.DefaultFont*7+by*25, "?????¨½???¨¹????", C_RED, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--?????????????¡¦?¨§???¨¹???¨²???¡§
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "¡Á???" then
		In_Battle = true
	end
	--?????????????????????¡§
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "????" then
		In_Tactics = true
	end
	--???¨¹???????¡§
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "????" then
		In_Other = true
	end	
	--???????¡¦?????¨ª???????????¨§???¨¹
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--?¨§???¨¹?¨¢??????
		if In_Battle == true then
			if newMenu[i][1] == "???¡Â" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¨¹" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¡¦???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
		if newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¡¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "¡Á???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
			end
		end
	  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc ?¨¾ ????
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ?????????????¨¢??????BUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ?????????????¨¢??????BUG
				start = 1
			end
		--?????????????¡¦?¨§???¨¹
		--???¡Â
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9???????¡Â
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¨¹
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¡¦
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡Á???
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????????
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C?¨¦??
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡¦???
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--????
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--?????¡¦??
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 2000 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					--??????????¡Á?
					elseif JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--????????????????¡¦???20¡Á¡Â?????¡§????
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --?¡Â??????????
			
					--????????????????????????¡¦?????????????????
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--????????????????¡¦???20¡Á¡Â?????¡§????
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end
function selectShowMenu(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
		lib.LoadPNG(91, 502 * 2 , bx*190+bx*212 , by*145+by*33.5, 1)
		--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","??????", "?¡Â??", "????", "????", "¡Á???", "?¨§?¨¦", "????"), C_ORANGE, CC.DefaultFont)
		DrawString(CC.ScreenW/2-CC.DefaultFont*3-25, CC.ScreenH/2-CC.DefaultFont*7+by*25, "?????¨½???¨¹????", C_RED, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--?????????????¡¦?¨§???¨¹???¨²???¡§
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "¡Á???" then
		In_Battle = true
	end
	--?????????????????????¡§
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "????" then
		In_Tactics = true
	end
	--???¨¹???????¡§
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "????" then
		In_Other = true
	end	
	--???????¡¦?????¨ª???????????¨§???¨¹
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--?¨§???¨¹?¨¢??????
		if In_Battle == true then
			if newMenu[i][1] == "???¡Â" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¨¹" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¡¦???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
		if newMenu[i][1] == "????" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "????" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "???¡¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "¡Á???" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
			end
		end
	  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc ?¨¾ ????
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ?????????????¨¢??????BUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ?????????????¨¢??????BUG
				start = 1
			end
		--?????????????¡¦?¨§???¨¹
		--???¡Â
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9???????¡Â
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¨¹
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--???¡¦
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡Á???
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????????
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C?¨¦??
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¡¦???
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--????
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--????
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--?????¡¦??
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 2000 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					--??????????¡Á?
					elseif JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--????????????????¡¦???20¡Á¡Â?????¡§????
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["????????"]
					--??????????¡Á?
					if JY.Person[id]["????"] < 20 then
						DrawStrBoxWaitKey("??????¡Á?????¡¦¡§????",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --?¡Â??????????
			
					--????????????????????????¡¦?????????????????
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--????????????????¡¦???20¡Á¡Â?????¡§????
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end


function tjm_menu()
   local cont = 1
   local cont1 = 0
   local page = 1
   local x = CC.ScreenW/2-CC.ScreenW/1360*400
   --local w = (CC.ScreenW-x*2)/10
   local y = CC.ScreenH-CC.ScreenH/768*50
   local sx = CC.ScreenW/1360*40
   local py = 0
   local pd = 0
   local size1 = CC.DefaultFont*0.8
    
   -- local jm = {--{'????',378},
			   -- {'¡Á???',145,ShowPersonStatus},
			   -- {'???¡¦',146,tjm.tjmhs2.SelectThing},
			   -- --{'¡Á¡ã??',372},
			   -- --{'???¡ì',373,tjm.tjmhs1.tjm29},
			   -- --{'????',374},
			   -- {'????',147,Menu_Jingmai},
			   -- {'???¨½',148,nil},
			   -- --{'????',377},
			  --  {'????',149,Menu_System},
   -- }
   
   local jm = {--{'????',378},
			   {'¡Á???',400,ShowPersonStatusA},--ShowPersonStatus--New_Team
			   {'???¡¦',401,Menu_Thing},--SelectThing Menu_Thing1
			   --{'¡Á¡ã??',372},
			   {'???¡ì',406,MJMenu},
			   --{'????',374},
			   --{'????',410,QUANZHANGQX1},
			   {'????',402,QUANZHANGQX1},
			   {'???¨½',403,TSInstruce},
			   --{'????',377},
			   {'????',404,New_Ssystem},
   }
   
   local num = 10
   
   if num > #jm then 
      num = #jm 
   end	  
   local w = CC.ScreenW/1360*85
   local aa = 0
   while aa < num*w-CC.ScreenW/1360*20 do
       if JY.Restart == 1 then
		 break
		end	
	   lib.GetKey()
	   lib.SetClip(CC.ScreenW/1360*70, CC.ScreenH/768*658, CC.ScreenW) --???????¡ã??
       for i = 1,num do 
	       lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w-num*w+sx+aa,y-CC.ScreenH/768*30,2,240,nil,CC.ScreenW/1360*85)
       end
	   lib.SetClip(0,0,0,0)
	   lib.PicLoadCache(92,29*2,CC.ScreenW/1360*40,CC.ScreenH/768*615+70,2,256,nil,CC.ScreenW/1360*60)
	   ShowScreen()
	   lib.Delay(20)
	   Cls()
	   aa = aa + CC.ScreenW/1360*20
   end 
   
   while true do 
      Cls()
	  if JY.Restart == 1 then
		 break
		end	
	  lib.PicLoadCache(92,29*2,CC.ScreenW/1360*40,CC.ScreenH/768*615+70,2,256,nil,CC.ScreenW/1360*60)
	  for i = 1,num do 
	      if cont == i then 
		     lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w+sx,y-CC.ScreenH/768*30+py,2,240,nil,CC.ScreenW/1360*85)
		  else 
		     lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w+sx,y-CC.ScreenH/768*30,2,240,nil,CC.ScreenW/1360*85)
		  end
	  end
	  if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
	  ShowScreen()
	  lib.Delay(20)
	    local X,ktype,mx,my = lib.GetKey()
	    if X == VK_SPACE or X == VK_RETURN then 
			if jm[cont+cont1][3] ~= nil then
			  -- local n = cont+cont1
			 
			  -- local rr 
			  -- if n == 1  then
				 -- local te = Team()
				 -- if te > 0 then
					-- rr = jm[cont+cont1][3](te)
				-- else
					-- break
				-- end
				 
				 
			  -- else
				 -- rr = jm[cont+cont1][3]()
			  -- end
				local rr = jm[cont+cont1][3]()
				if rr ~= nil and rr > 0 then
					break
				end
			end	  
		elseif X == VK_ESCAPE or ktype == 4 then
          break
		elseif X == VK_LEFT then
		  if cont1 > 0 then 
		     if cont > 1 then 
		        cont = cont - 1
			 else 
                cont1 = cont1 - 1	  
			 end	
		  else
             cont = cont - 1		
		  if cont < 1 then 
		     cont = num
			 cont1 = #jm - cont
		  end
		  end
		  py = 0
          pd = 0
		elseif X == VK_RIGHT then
          cont = cont + 1		
		  if cont > num then 
		     cont = num
			 cont1 = cont1 + 1
		  end
		  if cont1 + cont > #jm then 
		     cont1 = 0
			 cont = 1
		  end
		  py = 0
          pd = 0
		elseif X == VK_UP or ktype == 6 then
		        cont1 = cont1 - num
				cont = 1
				if cont1 < 0 then 
				   cont1 = 0 
				end
		  py = 0
          pd = 0
		elseif X == VK_DOWN or ktype == 7 then
		        cont1 = cont1 + num
				cont = num
				if cont1 + cont > #jm then 
				   cont1 = #jm-cont
				end	
		  py = 0
          pd = 0
	    else 
		    local mxx = false
            for i = 1,num do
			    if mx >= (i)*w+sx - CC.ScreenW/1360*40 and mx <= (i)*w+sx + CC.ScreenW/1360*40 and 
				   my >= y-CC.ScreenH/768*72 and my <= y+CC.ScreenH/768*12 then 
				   cont = i
                   mxx = true
				   break
				end
			end
			if mxx == true and ktype == 3 then 
				if jm[cont+cont1][3] ~= nil then
			    --  local rr = jm[cont+cont1][3]()
				
				-- local n = cont+cont1
			    -- local rr 
				  -- if n == 1  then
					-- -- local te = Team()
					-- -- if te > 0 then
						-- -- rr = jm[cont+cont1][3](te)
					-- -- else
						-- -- break
					-- -- end
					 
				  -- else
					 -- rr = jm[cont+cont1][3]()
				  -- end
					local rr = jm[cont+cont1][3]()
				  
					if rr ~= nil and rr > 0 then
						break
					end
				end	 
			end
	    end
   end
end

function PersonStatus(t,page)
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	local size = CC.DefaultFont*0.7
	local size1 = CC.DefaultFont*0.6
	local size2 = CC.DefaultFont*0.55
	local h = by*size1*1.2
	local cx = 1 
	local cx1 = 1
	local cot = {0,0,0,0,0}
	local fy = 0 --???????¡Â¡¦???
	local fymax = 0 --¡Á??¨®¡¦???
	local team = {}
	if JY.Restart == 1 then
		do return end
	end
	if t < 0 then
		do return end
	end	
	for tt = 1,CC.TeamNum do 
		if JY.Base['???¨¦'..tt] >= 0 then 
			team[#team+1] = JY.Base['???¨¦'..tt]
		end
	end 
	if page == nil then 
		page = 1 
	end
	
   local id = -1
   if JY.Status == GAME_WMAP then
	--say("????????"..t,0,1)
		id = WAR.Person[t]["????????"]
	  --id=t
   else 
      id = JY.Base['???¨¦'..t]
   end
   -- if JY.Status == GAME_WMAP then
	    -- if WAR.Person[teamid]["??¡¦?"] == false then
	        -- pagenum = 2
	    -- end
	-- end
local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
   if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
   if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
   while true do
    
   if JY.Restart == 1 then
		do return end
	end
   Cls()
   
   local p = JY.Person[id]
   local picx,picy = lib.GetPNGXY(1,psx(id,'¡ã??¨ª?¨½')*2)
   local lb = {{},{},{},{},{}}
   local lb1 = {}
   local lb2 = {nil,nil,nil,nil,nil}
   local function DrawAttrib(str, x,y,color1,size)
		local i = 0
		--DrawString(x1, y1 + h * i, string.sub(4), color1, size)
		--????????????
		--local str;
		if str == "??????¡¦¨¾" then
			local bonus = 0
			bonus = TrueQZ(id) - JY.Person[id]["??????¡¦¨¾"] 
			if bonus > 0 then
				DrawString(x,y,  string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
		if str == "??¡¦¡§????" then
			local bonus = 0
			
			bonus = TrueZF(id) - JY.Person[id]["??¡¦¡§????"] 
			if bonus > 0 then
				DrawString(x, y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
		if str == "????????" then
			local bonus = 0
			bonus = TrueYJ(id) - JY.Person[id]["????????"] 
			if bonus > 0 then
				DrawString(x, y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
        if str == "????????" then
            local bonus = 0
			bonus = TrueSD(id) - JY.Person[id]["????????"] 		
			if bonus > 0 then
				DrawString(x, y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
        if str == "???????¡Â" then
            local bonus = 0
			bonus = TrueTS(id) - JY.Person[id]["???????¡Â"]
			if bonus > 0 then
				DrawString(x,y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		--?????¨¦??????¡ã??¡Â????
		if JY.Status == GAME_WMAP then
				if str == "????????" then
					for k,v in pairs(CC.AddDoc) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
									DrawString(x,y, "?¨¹ "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				if str == "????????" then
					for k,v in pairs(CC.AddPoi) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
									DrawString(x,y, "?¨¹ "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				
			i = i + 1
		end
	end

	-- if case == nil then
		-- if JY.Status ~= GAME_WMAP then
			-- DrawString(x1-size*5, y1 + h * (i)+2, "?????¨¹???? ?¨²?¨¹?????????¨§?? ESC????", M_PaleTurquoise, size*0.7)
		-- else
			-- DrawString(x1-size*5, y1 + h * (i)+2, "?????¨¹???? ?¨²?¨¹?????????¨§?? ESC????", Snow3, size*0.7)
		-- end
	-- else
		-- DrawString(x1-size*5, y1 + h * (i)+2, "?????¨¹???¨½???? ¡Á¨®???¨¹????/???? ?????¨¹?¡¦??????", Snow3, size*0.7)
	-- end


  --[[ if psx(id,'?¨§??????1') > 0 or psx(id,'?¨§??????2') > 0 or psx(id,'?¨§??????') > 0 or psx(id,'?¨§???¨¢??') > 0  then 
      lb1[#lb1+1] = 1
	  lb2[1] = #lb1
	  lb2[2] = lb2[1]
   end]]
   local i = 0
   --???¡ã??
   --lib.PicLoadCache(99,121*2,CC.ScreenW/2,CC.ScreenH/2,2,256,nil,bx*1360)
   lib.LoadPNG(91, 149 * 2 ,-1 , -1, 1)
   --????¡ã??¨ª?¨½
   pngxy(90,psx(id,'¡ã??¨ª?¨½')*2,bx*200,CC.ScreenH-by*300,2)
   --????
   -- if MPPD(id) ~= nil and MPPD(id) > 0 then 
	  -- DrawString(bx*30,by*70,CC.MP[MPPD(id)][1]..CC.MPDJ[MPPD(id)][MPDJ(id)],C_ORANGE,size)
   -- else 
	  -- DrawString(bx*30,by*70,'????????',C_WHITE,size)
   -- end
	if MPPD(id) ~= 0 then
		local mptype, mpdj = MPDISPLAY(id)
		local str = ""
		local str1 = ""
		local color = ""
		if mptype ~= nil then
			if MPPD(id) == 13 and match_ID(id,66) then
				str = "??".."?¡§???¡Â??".."??"
				str1 = "??".."????".."??"
				color = M_Red
				--DrawString(bx*30,by*70, , M_Red, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 4 then
				str = "??".."?¡Â??".."??"
				str1 = "??".."?¨²??????".."??"
				color = C_GOLD
				--DrawString(bx*30,by*70, "??".."?¡Â???¨²??????".."??", C_GOLD, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["?¡¦??"] == 1 then
				str = "??".."?¡Â??".."??"
				str1 = "??".."????????".."??"
				color = C_GOLD
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["?¡¦??"] == 100 then
				str = "??".."?¡Â??".."??"
				str1 = "??".."????¡Â???".."??"
				color = C_GOLD
			elseif MPPD(id) == 12 and match_ID(id,73) then
				str = "??".."?????¨½??".."??"
				str1 = "??".."????".."??"
				color = M_Red
			elseif MPPD(id) == 12 and match_ID(id,26) then	
				str = "??".."?????¨½??".."??"
				str1 = "??".."?¡ã???¡Â".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?????¨½???¡ã???¡Â".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 14 and match_ID(id,140) then	
				str = "??".."????????".."??"
				str1 = "??".."?????¡è??".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?????????????¡è??".."??", M_Red, size*0.8)		
			elseif MPPD(id) == 10 and match_ID(id,588) then	
				str = "??".."???¡§??".."??"
				str1 = "??".."???¡Â¡¦¨¾??".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."???¡§???¡Â¡¦¨¾??".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,577) then	
				str = "??".."??????".."??"
				str1 = "??".."¨¦_??¡Á???".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."????¡Á???".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,114) then	
				str = "??".."??????".."??"
				str1 = "??".."????????".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."????????".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,38) then	
				str = "??".."¡¦???".."??"
				str1 = "??".."???¨²¡Á??¨²".."??"
				color = M_Red
			elseif MPTX(id,5,4) and id == 0 and CC.TX['???????????¨½'] > 0 then	
				str = "??".."??????".."??"
				local str = {'???????¡Â','???????¡Â','???????¡Â'}
				str1 = "??"..str[CC.TX['???????????¨½']].."??"
				color = M_DeepSkyBlue	
				--DrawString(bx*30,by*70, "??".."????????".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 2 and match_ID(id,50) then	
				str = "??".."?¡è¡ã?".."??"
				str1 = "??".."?¡ã¡ã??¡Â".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?¡è¡ã??¡ã¡ã??¡Â".."??", M_Red, size*0.8)
			elseif MPPD(id) == 15 and match_ID(id,499) then	
				str = "??".."?¨®?¨ª".."??"
				str1 = "??".."¡Á?¡Á???¡Á?".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?¨®?¨ª??¡Á?".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 11 and match_ID(id,596) then	
				str = "??".."?????¡Â".."??"
				str1 = "??".."???¡Â".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?????¡Â???¡Â".."??", M_Red, size*0.8)			
			elseif MPPD(id) == 20 and match_ID(id,523) then	
				str = "??".."????¡Á?".."??"
				str1 = "??".."¡Á??¡Â¡¦¨¾??".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."¡Á??¡Â¡¦¨¾??".."??", M_Red, size*0.8)										
			elseif MPPD(id) == 24 and match_ID(id,525) then	
				str = "??".."??????".."??"
				str1 = "??".."???????¡¦".."??"
				color = M_Red
			elseif MPPD(id) == 23 and match_ID(id,637) then	
				str = "??".."??¨¢??¨¹".."??"
				str1 = "??".."?¨¹??".."??"
				color = M_Red	
			elseif MPPD(id) == 20 and match_ID(id,745) then	
				str = "??".."????¡Á?".."??"
				str1 = "??".."??????¡Á?".."??"
				color = M_Red		
			elseif MPPD(id) == 26 and match_ID(id,754) then	
				str = "??".."?????¡ì".."??"
				str1 = "??".."?¨¾?¡§???¡Â".."??"
				color = M_Red			
			else
				str = "??"..mptype.."??"
				str1 = "??"..mpdj.."??"
				color =  M_DeepSkyBlue
				--DrawString(bx*30,by*70, "??"..mptype..mpdj.."??", M_DeepSkyBlue, size*0.8)
			end
		else
			str = "????????????"
			str1 = "??????"
			color = C_ORANGE
		end
		DrawString(bx*55,by*70, "??????????"..str, color, size)
		DrawString(bx*55,by*70+size+5, "???????¡Á??"..str1, color, size)
	else
		local str = "????????????"
		local str1 = "??????"
		local color = C_ORANGE
		DrawString(bx*55,by*70, "??????????"..str, color, size)
		DrawString(bx*55,by*70+size+5, "???????¡Á??"..str1, color, size)
	end
		local ch = nil
		local chcl = C_CYGOLD
		--local fj = {[0] = {"????",C_ORANGE},{"¡Á???",M_DarkRed},{"????",C_RED},{"???¡Â",M_Pink},{"???¡Â",M_Pink},{"???¡Â",M_Blue},{"??¡Á?",M_LightBlue},{"???¨½",C_CYGOLD}}

        --local fjstr = "??"..fj[p["????¡¦??¡Á"]][1].."??"
        local nametre = p["????"]
        local djstr = p["????"].."??"
        if id == 0 and (JY.Base['??¡Á?'] == nil or JY.Base['??¡Á?'] < 1 ) and JXPD(id,JY.Base['????'],1) then
        	djstr = p["????"].."??"..'????????'
        elseif id ~= 0 and JXPD(id,id,1) then
        	djstr = p["????"].."??"..'????????'	
        end	
        --local namex = CC.ScreenW/2-string.len(fjstr..nametre..djstr)/4*size
        --local fjx = namex + string.len(nametre)/2*size
       -- local djx = fjx + string.len(fjstr)/2*size
		-- DrawString(fjx, dx*24, fjstr, fj[JY.Person[id]["????¡¦??¡Á"]][2], size*0.8)
		-- DrawString(namex, dx*20, nametre, C_CYGOLD, size)		
		-- DrawString(djx, dx*24, djstr, C_CYGOLD, size*0.8)
   --????????
   --DrawString(bx*280,by*70,name(id),C_WHITE,size)
	   DrawString(bx*150,by*10,name(id)..""..djstr,M_Yellow,size*1.3)--..fjstr
	   local tfx1 = bx*55
	   local fty1 = by*79+50
	   local fty2 = 0
	   local fty3 = 0
	   --?¡Â??
	   if id == 0 then
			local main_tf;
			--???¡Â
			if JY.Base["??¡Á?"] > 0 then
				main_tf = ZJTF[JY.Base["??¡Á?"]]
			--????
			elseif JY.Base["????"] > 0 then
				main_tf = " "
			--????
			elseif JY.Base["????"] > 0 then
				if RWTFLB[p["?¨²??"]] ~= nil then
					main_tf = RWTFLB[p["?¨²??"]]
				end
			end
			if main_tf ~= nil then
				DrawString(tfx1, fty1,"??¡ã???????".."??"..main_tf.."??", C_ORANGE, size)
			--else
				--main_tf = "???¨²¡¦¨¹¡¦?"
				--DrawString(tfx1 -string.len(main_tf)/4*size*0.8, fty1,"??¡ã???????"..main_tf , C_ORANGE, size)
			fty2 = size + 5
			end
			
		end

		--???¡§?????¨§??
		if id ~= 0 and RWTFLB[id] ~= nil then
			--DrawString(x1-7, y1 + h * (i)-142,RWTFLB[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"??¡ã???????".."??".. RWTFLB[id].."??", C_ORANGE, size)
			fty2 = size	+5	
		end
	  
		fty1 = fty1+fty2
		--?¡Â??????
		if id == 0 then
			local main_ch;
			--???¡Â
			if JY.Base["??¡Á?"] > 0 then
				if p["????????"] == 0 then
					main_ch = "?????????¡Á"
				else
					main_ch = "?????????¨²"
				end
			--????
			elseif JY.Base["????"] > 0 then
				main_ch = ''--TSTF[JY.Base["????"]]
			--????
			elseif JY.Base["????"] > 0 then
				if RWWH[JY.Base["????"]] ~= nil and JY.Base["????"] ~= 35 and JY.Base["????"] ~= 38 and JY.Base["????"] ~= 49 
				and JY.Base["????"] ~= 626 then
					main_ch = RWWH[JY.Base["????"]]
				elseif JY.Base["????"] == 35 then
					if JXPD(id,35,2) then
						main_ch = RWWH["35"]
						--DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)	
					elseif JXPD(id,35,1) then
						main_ch = RWWH[35]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
						 --DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)		
					end
				elseif JY.Base["????"] == 38 then
					if JXPD(id,38,1) then
						main_ch =  RWWH["38"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
					    --DrawString(tfx1 -string.len(RWWH["38"])/4*size*0.8, by*122,  RWWH["38"], C_ORANGE, size)		
					end
				elseif JY.Base["????"] == 49 then
					if JXPD(id,49,1) then
						main_ch = RWWH["49"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH["49"])/4*size*0.8, by*122,  RWWH["49"], C_ORANGE, size)	
					else
						main_ch = RWWH[49]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH[49])/4*size*0.8, by*122,  RWWH[49], C_ORANGE, size)	
					end
				elseif JY.Base["????"] == 626 then
					if JXPD(id,626,1) then
						main_ch = RWWH["626"]
						--DrawString(tfx1 -string.len(RWWH["626"])/4*size*0.8, by*122,  RWWH["626"], C_ORANGE, size)
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
					else
					main_ch = RWWH[626]
					--	DrawString(x1-7, y1 + h * (i)-100, RWWH[626], C_CYGOLD, size*0.8)
					 --DrawString(tfx1 -string.len(RWWH[626])/4*size*0.8, by*122,  RWWH[626], C_ORANGE, size)		
					end
			
				end
			end
			if main_ch ~= nil then
				--DrawString(x1-7, y1 + h * (i)-100, main_ch, C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"?¨§????????".."??"..main_ch.."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--??????????
		if RWWH[id] ~= nil and id ~= 35 and id ~= 38 and id ~= 49 then
			--DrawString(x1-7, y1 + h * (i)-100, RWWH[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[id].."??", C_ORANGE, size)	
			fty3 = size+5
		end

		--???¨¹??
		if id == 35 then
			if JXPD(id,35,2) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["35"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["35"].."??", C_ORANGE, size)
				fty3 = size
			elseif JXPD(id,35,1) then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[35].."??", C_ORANGE, size)
				fty3 = size+5
			end
		end

		--?¨¦?¨½
		if id == 49 then
			if JXPD(id,49,1) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["49"].."??", C_ORANGE, size)	
				fty3 = size+5
			else
				--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[49].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	  
		--?????¨§
		if id == 38 then
			if JXPD(id,38,1) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["38"].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--????
		if id == 626 then
			if JXPD(id,626,1) then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["626"].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		--??¡ã???
		if id == 189 then
			if JXPD(id,189,1) then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["189"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[189].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end	 
		--????¡¦?
		if id == 633 then
			if JXPD(id,633,1) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["633"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[633].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	fty1 = fty1 + fty3
	local fj = {[0] = {"????",C_ORANGE},{"¡Á???",M_DarkRed},{"????",C_RED},{"???¡Â",M_Pink},{"???¡Â",M_Pink},{"???¡Â",M_Blue},{"??¡Á?",M_LightBlue},{"???¨½",C_CYGOLD}}
    local fjstr = "??"..fj[p["????¡¦??¡Á"]][1].."??"
	DrawString(tfx1, fty1,"??????????"..fjstr, fj[p["????¡¦??¡Á"]][2], size)
   --???????¡Â
    -- --?????¨§??2
   if psx(id,'?¨§??????1') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then 
         DrawString(bx*420,by*50+0*h,"?¨§????????"..JY.Wugong[psx(id,'?¨§??????1')]['????'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+0*h,"?¨§??????????",C_WHITE,size1)
	--	 i = i + 1
   end
   
   if psx(id,'?¨§??????2') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then JY.Wugong[psx(id,'?¨§??????2')]['????']
         DrawString(bx*420,by*50+1*h,"?¨§????????"..JY.Wugong[psx(id,'?¨§??????2')]['????'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+1*h,"?¨§??????????",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'?¨§??????') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then 
         DrawString(bx*420,by*50+2*h,"?¨§????????"..JY.Wugong[psx(id,'?¨§??????')]['????'],M_Red,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+2*h,"?¨§??????????",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'?¨§???¨¢??') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then 
         DrawString(bx*420,by*50+3*h,"?¨§???¨¢????"..JY.Wugong[psx(id,'?¨§???¨¢??')]['????'],M_Yellow,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+3*h,"?¨§???¨¢??????",C_WHITE,size1)
	--	 i = i + 1
   end
   
   local tfid;
		--?¡Â??
	if id == 0 then
		--???¡Â
		if JY.Base["??¡Á?"] > 0 then
			tfid = 0--546 + JY.Base["??¡Á?"]
		--????
		elseif JY.Base["????"] > 0 then
			tfid = ''
		--????
		else
			tfid = JY.Base["????"]
			--??????????
			--[[if tfid == 54 and JY.Person[id]["????????"] >= 1 then
				tfid = "54-1"
			--?????????¨§
			elseif tfid == 38 and JY.Person[id]["????????"] >= 1 then
				tfid = "38-1"
			--????????
			elseif tfid == 626 and JY.Person[id]["????????"] >= 1 then
				tfid = "626-1"				
			end]]
		end
	--????
	else
		tfid = id
		--??????????
		--[[if tfid == 54 and JY.Person[id]["????????"] >= 1 then
			tfid = "54-1"
		--?????????¨§
		elseif tfid == 38 and JY.Person[id]["????????"] >= 1 then
			tfid = "38-1"
		--????????
		elseif tfid == 626 and JY.Person[id]["????????"] >= 1 then
			tfid = "626-1"				
		end]]
	end
	if psx(id,'?¨§??????1') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§??????1'
	end	 
	if psx(id,'?¨§??????2') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§??????2'
	end
	if psx(id,'?¨§??????') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§??????'
	end	 
	if psx(id,'?¨§???¨¢??') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§???¨¢??'
	end
	local me = {}
	local me1 = {}
	local me2 = {}
	local me3 = {}
	local me4 = {}
	local mid = tfid 
	local bz = {'??','??','??','??','??','??','??','??','??','??','?¡ì','??'}
	if JY.Base["??¡Á?"] > 0 and id == 0 then 
		mid = bz[JY.Base["??¡Á?"]]
	end
	
	local row = 0
	if TFJS[mid] ~= nil then
		for i = 1, #TFJS[mid] do
			me1[#me1+1] = TFJS[mid][i]
			if i == #TFJS[mid] then 
				me1[#me1+1] = "??"
				
			end
		end
	else
		me1[#me1+1] = '?????????¨§??'
	end

	if CC.PTF[tfid] ~= nil and id ~= 0 then -- 
		for i,v in pairs(CC.PTF[tfid]) do 
			if v == 1 then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
			elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
			end
		end
	end
	
	if id == 0  then 
		if actor(id,10) then 
			for i,v in pairs(CC.PTF[id]) do
				if TFJS[i] ~= nil then 
					me[#me+1] = '??'..string.sub(TFJS[i][1],3)
					local str = ''
					for k = 2, #TFJS[i]-1 do
						str = str..'*'..string.sub(TFJS[i][k],3)
					end
					me[#me+1] = '?¡Á'..str
					me[#me+1] = "??"
				end
			end
			if JY.Status == GAME_WMAP then
				if WAR.LSTF[id] ~= nil then
					for i,v in pairs(WAR.LSTF[id]) do
						if TFJS[i] ~= nil then 
							me[#me+1] = '??'..string.sub(TFJS[i][1],3)
							local str = ''
							for k = 2, #TFJS[i]-1 do
								str = str..'*'..string.sub(TFJS[i][k],3)
							end
							me[#me+1] = '?¡Á'..str
							me[#me+1] = "??"
						end
					end
				end
			end
		end
		for i,v in pairs(CC.PTF[id]) do
			if v == 1 then
				if CC.PTFSM[i] ~= nil then 
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
		   elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end	
			end
		end

		if JY.Status == GAME_WMAP then
			--???¡Â?????¨§??
			if actor(id,10) then 
				if WAR.LSTF[id] == nil then 
					WAR.LSTF[id] = {}
				else
					for i,v in pairs(WAR.LSTF[id]) do
						if CC.PTFSM[i] ~= nil then
							me[#me+1] = '??'..CC.PTFSM[i][1]
							me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
							me[#me+1] = "??"
						end
					end
				end
			end
		end	

	end
	
	if id == 0 and JY.Base["????"] ==52 then
		me1[#me1+1] = "??".."??????????"
		if TFJS[JY.Person[0]["?¨²??"]] ~= nil then
			for i = 1, #TFJS[JY.Person[0]["?¨²??"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["?¨²??"]][i]
				if i == #TFJS[JY.Person[0]["?¨²??"]] then 
				me1[#me1+1] = "??"
				
				end
			end
		end
		if CC.PTF[JY.Person[0]["?¨²??"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[0]["?¨²??"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
						end
				end
			end
		end
	end
	
	if id == 512 then
		me1[#me1+1] = "??".."???¡ì??"
		if TFJS[JY.Person[512]["????????"]] ~= nil then
			for i = 1, #TFJS[JY.Person[512]["????????"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["?¨²??"]][i]
				if i == #TFJS[JY.Person[512]["????????"]] then 
				me1[#me1+1] = "??"
				
				end
			end
		end
		if CC.PTF[JY.Person[512]["????????"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[512]["????????"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
						end
				end
			end
		end
	end
	if BOSSZT[mid] ~= nil then
		for i = 1, #BOSSZT[mid] do 
			me2[#me2+1] = BOSSZT[mid][i]
			--if i == #BOSSZT[mid] then
			--me2[#me2+1] = "??"
			--end
		end
	end
	if ZL[mid] ~= nil then
		for i = 1, #ZL[mid] do 
			me3[#me3+1] = ZL[mid][i]
			--if i == #ZL[mid] then
			--me3[#me3+1] = "??"
			--end
		end
	end
	if FY[mid] ~= nil then
		for i = 1, #FY[mid] do 
			me4[#me4+1] = FY[mid][i]
			--if i == #FY[mid] then
			--me4[#me4+1] = "??"
			--end
		end
	end
	local size = CC.DefaultFont
	local tfjsbh = 0
	local tfjswz = {}
	local tfjsbh1 = 0
	local tfjswz1 = {}
	local bossztwz = {}
	local rwzlwz = {}
	local fyjywz = {}
	local pdl = true
	i = 4 - cot[1]
	for k = 1, #me1 do
		--local tfstr = me[k]
		local tfstr1 = me1[k]
		local h1 = 0
		-- if #tfstr > math.floor(bx*345/size2)+5 then
			-- --	i = i + 1
				-- row = row + 1
		-- end		
		--if string.sub(tfstr,1,2) == "??" then
			--row = row + 1
		--else
		if string.sub(tfstr1,1,2) == '??' and pdl then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr1,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr1
			
			pdl = false
			i = i + 1
		end
		if string.sub(tfstr1,1,2) == '?¡Á' or string.sub(tfstr1,1,2) == '??' then

			if string.sub(tfstr1,1,2) == '??' then
				--string.sub(tfstr1,1,2) = '??'
			end	
			if tfjswz1[mid] == nil then
				tfjswz1[mid] = tfstr1
			else
				tfjswz1[mid] = tfjswz1[mid] .."*".. tfstr1
			end	
			--h1=--tfstr = tfstr .. "??"
		--	i = i + 1
			--lb[1][#lb[1]+1] = tfstr
		end

	end
	for k = 1, #me2 do
		local tfstr = me2[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '??' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr
			i = i + 1
		end
		if string.sub(tfstr,1,2) == '?¡Á' then

			tfjswz[#tfjswz+1] = tfstr

		end

	end
	for k = 1, #me3 do
		local tfstr = me3[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '??' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr
			i = i + 1
		end
		if string.sub(tfstr,1,2) == '?¡Á' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--rwzlwz[#rwzlwz+1] = tfstr
		end

	end
	for k = 1, #me4 do
		local tfstr = me4[k]
		local h1 = 0

		if string.sub(tfstr,1,2) == '??' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr
			i = i + 1
		end
		if string.sub(tfstr,1,2) == '?¡Á' then

			tfjswz[#tfjswz+1] = tfstr

		end

	end
	for k = 1, #me do
		local tfstr = me[k]
		--local tfstr1 = me1[k]
		local h1 = 0

		
		if string.sub(tfstr,1,2) == '??' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			i = i + 1
			lb[1][#lb[1]+1] = tfstr
		end
		if string.sub(tfstr,1,2) == '?¡Á' then

			tfjswz[#tfjswz+1] = tfstr

		end
		row = row + 1

	end
   --if psx(id,'?¨§??????1') > 0 or psx(id,'?¨§??????2') > 0 or psx(id,'?¨§??????') > 0 or psx(id,'?¨§???¨¢??') > 0  then 
	lb1[#lb1+1] = 1
	lb2[1] = #lb1
	--lb2[2] = lb2[1]
   --end
   -- if TFJS[id] ~= nil then 
	  -- for i = 1,#TFJS[id]  do
		-- tjm9(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
	-- --	DrawString(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size)
	  -- end
   
      
   -- end
   
   --tjm9(bx*30,by*80+h,'???????????¨®?¡è¡¦¡§?????????¡è??????¡¦¡§????????????????????????????????????',C_WHITE,size2,math.floor(bx*345/size2)-1,h)
   
   -- --?????¨§??1
   -- if CC.TG[id] ~= nil then 
    -- --  if CC.TF[psx(id,'?¨§??')] ~= nil then 
         
	-- --  end
	-- --	say("?????¨§??1",0,1)
		-- for k,v in pairs(CC.TG[id]) do 
			-- if v == 1 then 
			-- --	say("?????¨§??"..k,0,1)
				-- if CC.PTFSM[k] ~= nil then
					-- -- me[#me+1] = '??'..CC.PTFSM[k][1]
					-- -- me[#me+1] = '?¡Á'..CC.PTFSM[k][2]
					-- -- me[#me+1] = "??"
					
					-- DrawString(bx*420,by*60+i*h,CC.PTFSM[k][1],C_WHITE,size1)
					-- i = i + 1
					
				-- end
			-- end
		-- end
		
   -- end
	
   
   --¡Á¡ã????????????
		local str_gain, def_gain, agi_gain = 0, 0, 0
		local fb = 1
		if match_ID(id,546) or match_ID(id, 9911) then
			fb = 2
		end
		if p["???¡Â"] > -1 then
			if JY.Thing[p["???¡Â"]]["?????¡Â??"] > 0 then
				str_gain = str_gain + JY.Thing[p["???¡Â"]]["?????¡Â??"]*10 + JY.Thing[p["???¡Â"]]["?????¡Â??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["???¡Â"]]["?????¡Â??"] < 0 then
				str_gain = str_gain + JY.Thing[p["???¡Â"]]["?????¡Â??"]*10 - JY.Thing[p["???¡Â"]]["?????¡Â??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["???¡Â"]]["??¡¦?????"] > 0 then
				def_gain = def_gain + JY.Thing[p["???¡Â"]]["??¡¦?????"]*10 + JY.Thing[p["???¡Â"]]["??¡¦?????"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["???¡Â"]]["??¡¦?????"] < 0 then
				def_gain = def_gain + JY.Thing[p["???¡Â"]]["??¡¦?????"]*10 - JY.Thing[p["???¡Â"]]["??¡¦?????"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["???¡Â"]]["???¨¢??"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["???¡Â"]]["???¨¢??"]*10*fb + JY.Thing[p["???¡Â"]]["???¨¢??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2*fb
			elseif JY.Thing[p["???¡Â"]]["???¨¢??"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["???¡Â"]]["???¨¢??"]*10*fb - JY.Thing[p["???¡Â"]]["???¨¢??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2*fb
			end
		end
		if p["¡Á???"] > -1 then
			if JY.Thing[p["¡Á???"]]["?????¡Â??"] > 0 then
				str_gain = str_gain + JY.Thing[p["¡Á???"]]["?????¡Â??"]*10 + JY.Thing[p["¡Á???"]]["?????¡Â??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["¡Á???"]]["?????¡Â??"] < 0 then
				str_gain = str_gain + JY.Thing[p["¡Á???"]]["?????¡Â??"]*10 - JY.Thing[p["¡Á???"]]["?????¡Â??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡Á???"]]["??¡¦?????"] > 0 then
				def_gain = def_gain + JY.Thing[p["¡Á???"]]["??¡¦?????"]*10 + JY.Thing[p["¡Á???"]]["??¡¦?????"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["¡Á???"]]["??¡¦?????"] < 0 then
				def_gain = def_gain + JY.Thing[p["¡Á???"]]["??¡¦?????"]*10 - JY.Thing[p["¡Á???"]]["??¡¦?????"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡Á???"]]["???¨¢??"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["¡Á???"]]["???¨¢??"]*10*fb + JY.Thing[p["¡Á???"]]["???¨¢??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2*fb
			elseif JY.Thing[p["¡Á???"]]["???¨¢??"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["¡Á???"]]["???¨¢??"]*10*fb - JY.Thing[p["¡Á???"]]["???¨¢??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2*fb
			end
		end
		if p["¡¦???"] > -1 then
			local n = 2
			if MPPD(id) == 2 then
				n=4
			end	
			if JY.Thing[p["¡¦???"]]["?????¡Â??"] > 0 then
				str_gain = str_gain + JY.Thing[p["¡¦???"]]["?????¡Â??"]*10 + JY.Thing[p["¡¦???"]]["?????¡Â??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["¡¦???"]]["?????¡Â??"] < 0 then
				str_gain = str_gain + JY.Thing[p["¡¦???"]]["?????¡Â??"]*10 - JY.Thing[p["¡¦???"]]["?????¡Â??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡¦???"]]["??¡¦?????"] > 0 then
				def_gain = def_gain + JY.Thing[p["¡¦???"]]["??¡¦?????"]*10 + JY.Thing[p["¡¦???"]]["??¡¦?????"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*n
			elseif JY.Thing[p["¡¦???"]]["??¡¦?????"] < 0 then
				def_gain = def_gain + JY.Thing[p["¡¦???"]]["??¡¦?????"]*10 - JY.Thing[p["¡¦???"]]["??¡¦?????"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡¦???"]]["???¨¢??"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["¡¦???"]]["???¨¢??"]*10*fb + JY.Thing[p["¡¦???"]]["???¨¢??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2*fb
			elseif JY.Thing[p["¡¦???"]]["???¨¢??"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["¡¦???"]]["???¨¢??"]*10*fb - JY.Thing[p["¡¦???"]]["???¨¢??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2*fb
			end
		end
		--?¡Á????????
		local level = 0
		local gj = 0
		local qg = 0
		local fy = 0
		local str1_gain, def1_gain, agi1_gain = psx(id,"???¡Â??"), psx(id,"¡¦?????"), psx(id,"?¨¢??")
		local str2_gain, def2_gain, agi2_gain = psx(id,"???¡Â??"), psx(id,"¡¦?????"), psx(id,"?¨¢??")
        --?????¡Â?????? 
        if JY.Status == GAME_WMAP then
			--for i = 0, WAR.PersonNum-1 do
				--if WAR.Person[i]["????????"] == id then
					str2_gain, def2_gain, agi2_gain = Atk(t)-str_gain,Def(t)-def_gain,Qg(t)-agi_gain
				--end
			--end
			------------¡Á???????---------------
			gj = limitX((JY.Person[id]['????'] - JY.Person[id]['¡Á???']*10)/60,0)
			str1_gain = str1_gain + gj
			fy = limitX((JY.Person[id]['????'] - JY.Person[id]['¡Á???']*10)/60,0)
			def1_gain = def1_gain + fy
			qg = limitX((JY.Person[id]['????'] - JY.Person[id]['¡Á???']*10)/60,0)
			agi1_gain = agi1_gain + qg
			------------¡Á???????---------------
			for i =1,JY.Base["????????"] do               -- ?¨¦?????¡ã????????????????
				 if JY.Person[id]["????" .. i]==108 then
					if JY.Person[id]["????????" .. i] > 900 then
						level = 10
					else	
						level=math.modf(JY.Person[id]["????????" .. i] /100)+1;	
					end	
					if level >= 1 then
						gj = math.modf (JY.Person[id]["???¡Â??"]*0.03*(level))
						str1_gain = str1_gain +gj
						fy = math.modf(JY.Person[id]["¡¦?????"]*0.03*(level))
						def1_gain = def1_gain +fy
						qg = math.modf(JY.Person[id]["?¨¢??"]*0.03*(level))
						agi1_gain = agi1_gain +qg
						break
					end	
				end		
			end
			if match_ID(id, 9930) or match_ID(id,9738) then				--????????
				gj = math.modf (JY.Person[id]["???¡Â??"]*0.6)
				str1_gain = str1_gain +gj
				fy = math.modf(JY.Person[id]["¡¦?????"]*0.6)
				def1_gain = def1_gain +fy
				qg = math.modf(JY.Person[id]["?¨¢??"]*0.6)
				agi1_gain = agi1_gain +qg	
			end
			if match_ID(id, 604) or match_ID(id, 9805) then
				str1_gain = str1_gain + TrueYJ(id)
				def1_gain = def1_gain +TrueYJ(id)
			end
			--???????¨¦ ????????
			if Curr_NG(id,199) then
				local sz=math.modf(JY.Person[id]["????"]/2)
				if not inteam(id) then
					sz=100
				end
				str1_gain = str1_gain +sz
				def1_gain = def1_gain +sz
			end
			--??????????¡¦?????????????¡¦???????    
            if match_ID(id, 74) then
				local hqtgj= 0
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == WAR.Person[i]["??¡¦?"] then
                     str1_gain =  str1_gain +10
					 def1_gain =  def1_gain+10
                    end		
                end	
            end		 
            --??????¡¦?????????????¡¦???????    
            if match_ID(id, 508) then
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == false  then
                    def1_gain =  def1_gain+10
                    str1_gain =  str1_gain +10
                    end		
                end	
            end
			-----------???¡Â????-----------
			--???????¡Â??????
			for i,v in pairs(CC.AddAtk) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
							str1_gain = str1_gain + v[3]
						end
					end
				end
			end
			if WAR.PD['????'][id] ~= nil then
				str1_gain = str1_gain + WAR.PD['????'][id]
			end
			if PersonKF(id,263) or NGQH(id,175) then
				if Curr_NG(id,263) then
					str1_gain = math.modf(str1_gain*1.1)
				else
					str1_gain = math.modf(str1_gain*1.05)
				end
			end	
			if match_ID(id, 112) and WAR.XYS > 0 then	--???????????????????¡Â*1.5
				str1_gain = math.modf(str1_gain*1.5)
			end
			if WAR.PD['?¡Â?????¡è?¨§??'][id] ~= nil then 
				str1_gain = str1_gain*1.5
			end
			---------------¡¦???????--------------
			--????¡¦?????????
			for i,v in pairs(CC.AddDef) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
							def1_gain = def1_gain + v[3]
						end
					end
				end
			end
			if PersonKF(id,264) or NGQH(id,175) then
				if Curr_NG(id,264) then
					def1_gain = math.modf(def1_gain*1.1)
				else
					def1_gain = math.modf(def1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--????????????????¡¦???*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end	
			if  WAR.PD['?¡Â?????¡è?¨§??'][id] ~= nil then	--????????????????¡¦???*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end
			-------------?¨¢??????--------------
			--?????¨¢??????
			for i,v in pairs(CC.AddSpd) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
							agi1_gain = agi1_gain + v[3] 
						end
					end
				end
			end	
			if WAR.YWDJ[id]~=nil and Curr_QG(id, 186) then    --?????????????¨¢??
			   agi1_gain = agi1_gain + WAR.YWDJ[id]	
			end
			--?¨¢??????????
			if JY.Person[id]["?¡Â???¨¢??"] > 0 and JY.Person[id]["????¡¦??¡Á"] < 2 then
				qg = math.modf(JY.Person[id]["?¨¢??"]*0.3)
				agi1_gain = agi1_gain +qg
			elseif JY.Person[id]["?¡Â???¨¢??"] > 0 and JY.Person[id]["????¡¦??¡Á"] < 4 then
				qg = math.modf(JY.Person[id]["?¨¢??"]*0.15)
				agi1_gain = agi1_gain +qg
			end
			if PersonKF(id,259) or NGQH(id,175) then
				if Curr_NG(id,259) then
					agi1_gain = math.modf(agi1_gain*1.1)
				else
					agi1_gain = math.modf(agi1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--?????????????????¨¢??*1.5
				agi1_gain = math.modf(agi1_gain*1.5)
			end
			if WAR.PD['?¡Â?????¡è?¨§??'][id] ~= nil then 
				agi1_gain = agi1_gain * 1.5
			end
			if MPPD(id) == 20 or match_ID(id,514) then
				agi1_gain = math.modf(agi1_gain*2)
			end
		end
	if str1_gain ~= nil and str1_gain > 0 then
		str1_gain = limitX(str1_gain,0,999+JY.Base["????"])
	end	
    if def1_gain ~= nil and def1_gain > 0 then
		def1_gain = limitX(def1_gain,0,999+JY.Base["????"])
	end	
    if agi1_gain ~= nil and agi1_gain > 0 then
		agi1_gain = limitX(agi1_gain,0,999+JY.Base["????"])
	end
   --¡Á¡ã??????
	local pyl = -40
	lib.LoadPNG(91,166*2,bx*450+pyl,by*470,1)
   
	if p["???¡Â"] > -1 then
		lib.PicLoadCache(2,p["???¡Â"] * 2,bx*450+pyl,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl,by*470,1)
		DrawString(bx*450+pyl,by*470, "LV"..JY.Thing[p["???¡Â"]]["¡Á¡ã??????"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl,by*470+75, JY.Thing[p["???¡Â"]]["????"],C_RED , size*0.5)

	end
	if p["¡¦???"] > -1 then
		lib.PicLoadCache(2,p["¡¦???"] * 2,bx*450+pyl+75,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+75,by*470,1)
		DrawString( bx*450+pyl+78,by*470, "LV"..JY.Thing[p["¡¦???"]]["¡Á¡ã??????"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+78,by*470+75, JY.Thing[p["¡¦???"]]["????"], C_ORANGE, size*0.5)
	end		
	if p["¡Á???"] > -1 then
		lib.PicLoadCache(2,p["¡Á???"] * 2,bx*450+pyl+150,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+150,by*470,1)
		DrawString( bx*450+pyl+154,by*470, "LV"..JY.Thing[p["¡Á???"]]["¡Á¡ã??????"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+154,by*470+75, JY.Thing[p["¡Á???"]]["????"], M_Yellow, size*0.5)
	end
	--?¡Á¡Á¡ã????
	if (p["???¡Â"] > -1 and p["¡¦???"] > -1 and p["¡Á???"] > -1) then
		if p["¡¦???"]==p["???¡Â"]+1 and p["¡Á???"]==p["???¡Â"]+2 then
			local color = C_RED
			local n = Setmeal[p["???¡Â"]][4]
			if  n==4 or n==7 or n==15 or n==16 or n==2 then
				color = C_ORANGE
			elseif n==21 or n==22 or n==24 or n==26 then
				color = M_DeepSkyBlue
			elseif n==1 or n==3 then
				color = M_Green
			end
			--local n= #ItemInfo[p["???¡Â"]]
			--say("??¡Á¨¦?¡è??"..#ItemInfo[p["???¡Â"]],0,1)
			DrawString( bx*450+pyl,by*470+90, string.sub(ItemInfo[p["???¡Â"]][3], 3 , 12), C_GOLD, size*0.7)
			--tjm(bx*450+pyl,by*470+20+100,"?????¡ì??"..Xguo[Setmeal[p["???¡Â"]][4]]..'*'.."?????¡ì??"..FJXguo[Setmeal[p["???¡Â"]][5]].."*".."?????¡ì??"..ZqXguo[Setmeal[p["???¡Â"]][6]].."*".."??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_GOLD,size*0.5,14,size*0.5)
			if n < 5 and n ~= 0 then
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n >= 5 then
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 7 then
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 9 then
				--DrawString( diyx/5+ax*8-240, diyy/4+ax*3+200+40-20,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2], C_RED, size*0.5)
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2, string.sub(ItemInfo[p["???¡Â"]][5], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+20,string.sub(ItemInfo[p["???¡Â"]][7], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+40, string.sub(ItemInfo[p["???¡Â"]][9], 5 , -1), M_YellowGreen, size*0.5)
		end
	end
   
   
   
   i = 0 - cot[2]

   --local wgbh = {'?¨½','?¨¾','?¨®','??','??','??','?¡Â','??','??','?¨²','??','?¨¹','?¨²?¨®','?¨²??','?¨²??'}
   --???????¡ì
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,2,180,nil,bx*180)
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,1)
   for k = 1,JY.Base["????????"] do
       if psx(id,'????'..k) > 0 and JY.Wugong[psx(id,'????'..k)]['????????'] < 6 then
		----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
			if #lb[2]+1 > cot[2] and #lb[2]+1 - cot[2] <= 14 then
				local lv = limitX(math.modf(psx(id,'????????'..k)/100),1)
				local lx = JY.Wugong[psx(id,'????'..k)]['????????']
				local color = C_WHITE
				-- lib.LoadPNG(91,(lv+74)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
				-- lib.LoadPNG(91,(lx+149)*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
				if wgnlxz(psx(id,'????'..k)) == 0 then
					color = LightPurple
				elseif wgnlxz(psx(id,'????'..k)) == 1 then
					color = C_GOLD
				end
				if psx(id,'????????'..k) > 900 then
					lib.LoadPNG(91,167*2,bx*660+size1*7,by*50+i*h,1)
				else	
					lib.LoadPNG(91,(lv+149)*2,bx*663+size1*7,by*50+i*h,1)
				end 
				lib.LoadPNG(91,(lx+74)*2,bx*660+size1*7+bx*50,by*50+i*h,1)
				DrawString(bx*660,by*50+i*h,k,C_WHITE,size1)
				DrawString(bx*665+size1,by*50+i*h,JY.Wugong[psx(id,'????'..k)]['????'],color,size1)
			end
			i = i + 1
			lb[2][#lb[2]+1] ={ psx(id,'????'..k),k}
	   end
   end
   -- if psx(id,'¡Á¨®??????') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'¡Á¨®??????')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'¡Á¨®??????',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '¡Á¨®??????'
	  
   -- end 
   -- if psx(id,'?¡¦¡Á?') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'?¡¦¡Á?????')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'?¡¦¡Á?????',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '?¡¦¡Á?'
   -- end 
   
   if #lb[2] > 0 then 
      lb1[#lb1+1] = 2
	  --lb2[2] = lb2[1] + 1
	  lb2[2] = #lb1
   end
   
   i = 0
   local lscot = cot[2]
   if lb2[2] ~= nil then 
	lscot = cot[3]
   end
   i = 0 - lscot
   --????????????
   for k = 1,JY.Base["????????"] do 
        if psx(id,'????'..k) > 0 and JY.Wugong[psx(id,'????'..k)]['????????'] > 5 then 
			if #lb[3]+1 > lscot and #lb[3]+1 - lscot <= 14 then
				local lv = limitX(math.modf(psx(id,'????????'..k)/100),1)+1
				local lx = JY.Wugong[psx(id,'????'..k)]['????????']
				local color = C_WHITE

				if psx(id,'????????'..k) > 900 then
					lib.LoadPNG(91,167*2,bx*900+size1*7,by*50+i*h,1)
				else	
				lib.LoadPNG(91,(lv+149)*2,bx*900+size1*7,by*50+i*h,1)
				end

				lib.LoadPNG(91,(lx+74)*2,bx*900+size1*7+bx*50,by*50+i*h,1)

				if wgnlxz(psx(id,'????'..k)) == 0 then
					color = LightPurple
				elseif wgnlxz(psx(id,'????'..k)) == 1 then
					color = C_GOLD
				end	
				DrawString(bx*900,by*50+i*h,k,C_WHITE,size1)
				DrawString(bx*905+size1,by*50+i*h,JY.Wugong[psx(id,'????'..k)]['????'],color,size1)
			end
		i = i + 1
		lb[3][#lb[3]+1] ={ psx(id,'????'..k),k}
	  	end
   end

   if lb[3]~=nil and #lb[3] > 0 then
      lb1[#lb1+1] = 3
	  --lb2[3] = lb2[2] + 1
	  lb2[3] = #lb1
   end
   
   lb1[#lb1+1] = 4
   --lb2[4] = lb2[3] + 1
   lb2[4] = #lb1
   lb1[#lb1+1] = 5
   lb2[5] = #lb1
   --lb2[5] = lb2[4] + 1
   --????????
   i = 0
   local yg = {{'????????',1,'????'},{'?¡Â??????',2,'????'},{'????????1',3,'????'},{'?¡Â???¨¢??',4,'?¨¢??'},}
   -- if psx(id,'¡Á¨®??????') == 0 then 
	  -- table.remove(yg,2)
   -- end
   for k = 1,#yg do 
	   local cl =C_GOLD
	   local str = ''
       --if yg[k][2] == 1 then
	   ----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
	    --  lib.LoadPNG(91,160*2,bx*1242,by*60+i*by*48+by*18,1)
		  lib.LoadPNG(91,160*2,bx*1125+size1,by*60+i*bx*48+bx*18-size1,1)
		  if k ~= 3 and psx(id,yg[k][1]) > 0 then 
		     str = JY.Wugong[psx(id,yg[k][1])]['????']
		  elseif k == 3 and psx(id,yg[k][1]) > 1 then
			str = JY.Wugong[psx(id,yg[k][1])]['????']
		  else 
		     str = '??'..yg[k][3]
			 cl =  C_WHITE
		  end
	      if lb1[cx1] == 4 and page == 2 then 
	         if cx == k then 
		        cl = C_RED
		     end
	      end
		  --DrawString(bx*935-string.len('??????????????')/4*size,by*136-size/2,'??????????????',C_WHITE,size)
		  DrawString(bx*1233+size1-string.len(str)/4*size1,by*60+i*bx*48+bx*18-size1/2-bx*3,str,cl,size1)
		  i = i + 1
		  lb[4][#lb[4]+1] = yg[k][1]
	   --end
   end
   -- lb[4][#lb[4]+1] = '????'
   -- lib.LoadPNG(91,160*2,bx*1242,by*60+i*bx*48+bx*18,2,240,nil,bx*200)
   -- -- if lb1[cx1] == 4 and cx == #lb[4] and page == 2 then
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'??????????'..psx(id,'????'),C_RED,size1)
   -- -- else 
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'??????????'..psx(id,'????'),C_WHITE,size1)
   -- -- end
   
   -- lb[5] = {'???¡Â','¡¦???','?¡¦??','???¡¦','??¡Á?'}
   -- --????¡Á¡ã??
   -- i = 0
   -- for k = 1,#lb[5] do 
       -- lib.LoadPNG(91,160*2,bx*522,by*470+i*by*48+by*18,2,240,nil,bx*200)
	   -- local cl = C_WHITE
	   -- local str = ''
	   -- if psx(id,lb[5][k]) > 0 then 
	      -- str = JY.Thing[psx(id,lb[5][k])]['????']
	   -- else 
	      -- str = '??'..lb[5][k]
		  -- cl = C_GOLD
	   -- end
	   -- if lb1[cx1] == 5 then 
	      -- if cx == k then 
		     -- cl = C_RED
		  -- end
	   -- end
	   -- DrawString(bx*420+size1,by*470+i*bx*48+bx*18-size1/2,str,cl,size1)
	   -- i = i + 1
   -- end
	local bonus_q,bonus_z,bonus_j,bonus_d,bonus_t = psx(id,"??????¡¦¨¾"),psx(id,"??¡¦¡§????"),psx(id,"????????"),psx(id,"????????"),psx(id,"???????¡Â")
		
   --???? ???? ????
	local jqz = 0
	local jqz0 = 8
	local jqz1 = 0
	local jqz3 = 0
	local x = JY.Person[id]["?¨¢??"]
	local jqz2 = 0
    local y = JY.Person[id]["????"]	
	--local x3 = dx*427
	--local y3 = y1
	-- DrawString(x3 , y3,p["???¡ì????"], C_CYGOLD, size*0.7)
     -- if p["????"] >= 500 then
			-- DrawString(x3, y3+dh, string.format("%s", "??"), C_RED, size*0.7)
		-- else
			-- DrawString(x3, y3+dh, string.format("%s", p["????"]), C_CYGOLD, size*0.7)
		-- end	
	--??????
	
	local function getnewmove(x)
		if x <= 0 then 
			return 0
		end
		return math.sqrt(x)
	end
	--?????????????????????????????¡ã?¨§????
	local function getnewmove1(a, b)
		local x = (a*2+b)/3
		if x > 6000 then
			return 8 + math.min((x-6000)/1500, 2)
		elseif x > 4000 then
			return 6 + (x-4000)/1200
		elseif x > 2000 then
			return 4 + (x-2000)/1000
		elseif x > 1000 then
			return 2 + (x-1000)/800
		else
			return x/400
		end
	end

	--?????¨¢??
	local function Qg1(i)

		id = i
		
		local qg = 0 
		
		qg = qg + JY.Person[id]['?¨¢??']
		
		for i =1,JY.Base["????????"] do  
			local level = 0            
			if JY.Person[id]["????" .. i]==108 then
				level = math.modf(JY.Person[id]["????????" .. i]/100)+1;
				level = limitX(level/10,0,1)
				qg = qg + math.modf(JY.Person[id]["?¨¢??"]*0.3*level)	
				break
			end
		end
		
		return qg
	end
	
	jqz = (getnewmove(Qg1(id)) + getnewmove1(JY.Person[id]["????"], JY.Person[id]["????¡Á??¨®??"]) + JY.Person[id]["????"] / 30)
	
	if JY.Status == GAME_WMAP then
		jqz = (WAR.JQSDXS[id] or 0)
	else	
		jqz = math.modf(jqz)
	end	
   
   
   local cl = M_DeepSkyBlue
   local strcl = '(????)'
   if JY.Person[id]["????????"] == 0 then
		cl = M_DeepSkyBlue
		strcl = '(????)'
   elseif JY.Person[id]["????????"] == 1 then
		cl = C_ORANGE
		strcl = '(????)'
   elseif JY.Person[id]["????????"] == 2 then
		cl = C_CYGOLD
		strcl = '(?¡Â??)'
   elseif JY.Person[id]["????????"] == 3 then
		cl = C_RED
		strcl = '(?¨§??)'
   end
  -- local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
   --if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
   --if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
 
   i = 0 
   DrawString(bx*660,by*475,'?¨²?¨¹?????? '..psx(id,'?¨²?¨¹'),M_PaleGreen,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?????????? '..psx(id,'????')..strcl,cl,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'???????¨¦?? '..p["????"],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'???¡ì?????? '..p['???¡ì????'],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?????????? '..nk.."%",C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?????????? '..dk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¡Á????????? '..hk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??¡¦??????? '..bk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?¡Â???????? '..xk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¡¦??¡§?????? '..fk.."%",C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'???¨¦????'..string.format('%9s',psx(id,'???????¨¦')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'????????'..string.format('%9s',psx(id,'???¡ì????')),C_WHITE,size1)
   -- i = i + 1
   --????????1
   --[[????????1
   i = 0 
   DrawString(bx*660,by*475,'?¨²?¨¹??????'..string.format('%5s',psx(id,'?¨²?¨¹')),M_PaleGreen,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????'))..strcl,cl,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'???¡Â????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',p["???¡ì????"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',p["????"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',jqz),C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'???¨¦????'..string.format('%9s',psx(id,'???????¨¦')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'????????'..string.format('%9s',psx(id,'???¡ì????')),C_WHITE,size1)
   -- i = i + 1
   --????????1]]
   
	i = 0 
	DrawString(bx*900,by*475,'¡Á??¨®?¨²?¨¹?? '..psx(id,'?¨²?¨¹¡Á??¨®??'),M_PaleGreen,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'¡Á??¨®?????? '..psx(id,'????¡Á??¨®??')..strcl,cl,size1)--string.format('%5s',)
	--i = i + 1--p["??????¡¦¨¾"]+
	--DrawString(bx*900,by*475+i*h,'??????¡¦¨¾??'..bonus_q,M_YellowGreen,size1)--string.format('%5s',)   ?¨¹
	if JY.Status == GAME_WMAP then
		--DrawAttrib("??????¡¦¨¾", bx*890+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["??????¡¦¨¾"]+
		DrawString(bx*900,by*475+i*h,'??????¡¦¨¾?? '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)--..' ?¨¹ '..TrueQZ(id)-bonus_q
		DrawAttrib("??????¡¦¨¾", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["??¡¦¡§????"]+
		DrawString(bx*900,by*475+i*h,'??¡¦¡§?????? '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("??¡¦¡§????", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("????????", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("????????", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["???????¡Â"]+
		DrawString(bx*900,by*475+i*h,'???????¡Â?? '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("???????¡Â", bx*900+150,by*475+i*h,M_YellowGreen,size1)
	else
		i = i + 1--p["??????¡¦¨¾"]+
		DrawString(bx*900,by*475+i*h,'??????¡¦¨¾?? '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["??¡¦¡§????"]+
		DrawString(bx*900,by*475+i*h,'??¡¦¡§?????? '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["???????¡Â"]+
		DrawString(bx*900,by*475+i*h,'???????¡Â?? '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
	end	
	--[[i = i + 1--p["??¡¦¡§????"]+
	DrawString(bx*900,by*475+i*h,'??¡¦¡§??????'..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		 DrawAttrib("??¡¦¡§????", bx*880+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["????????"]+
	DrawString(bx*900,by*475+i*h,'??????????'..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("????????", bx*870+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["????????"]+
	DrawString(bx*900,by*475+i*h,'??????????'..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("????????", bx*860+150,by*475+i*h,M_YellowGreen,size1)
	end
   
	i = i + 1--p["???????¡Â"]+
	DrawString(bx*900,by*475+i*h,'???????¡Â??'..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
    if JY.Status == GAME_WMAP then
		DrawAttrib("???????¡Â", bx*850+150,by*475+i*h,M_YellowGreen,size1)
	end]]
  
	i = i + 1
 -- DrawString(bx*900,by*475+i*h,'¡ã??¡Â??????'..string.format('%5s',p["¡ã??¡Â????"]),C_WHITE,size1)
	if p["????????2"] > 0 then
		local str = ""
		if p["????????2"] == 458 then
			str = "(????)"
		end	
		if p["????????2"] == 450 then
			str = "(???¡§)"
		end	
		if p["????????2"] == 459 then
			str = "(?¨²??¡¦?)"
		end	
		if p["????????2"] == 460 then
			str = "(????)"
		end
		if p["????????2"] == 469 then
			str = "(????)"
		end	
		if p["????????2"] == 486 then
			str = "(????)"
		end	
		if p["????????2"] == 489 then
			str = "(????)"
		end
		if p["????????2"] == 490 then
			str = "(????)"
		end
		DrawString(bx*900,by*475+i*h,'¡ã??¡Â??¡¦¡§?? '..p["¡ã??¡Â????"]..str,M_Orange,size1)--string.format('%5s',)
	else
		DrawString(bx*900,by*475+i*h,'¡ã??¡Â??¡¦¡§?? '..p["¡ã??¡Â????"],M_Orange,size1)--string.format('%5s',)
	end
  
	i = i + 1
	DrawString(bx*900,by*475+i*h,'????¡Á????? '..p["¡Á???"],M_Red,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'?????????? '..p["?¨²?¨¹???¡è"] + limitX(math.modf(p['????????5'] *0.01),0,8),M_Red,size1)--string.format('%5s',)
	i = i + 1
   
   -- DrawString(bx*900,by*475+i*h,'??????????'..string.format('%5s',p["???¡ì????"]),C_WHITE,size1)
   -- i = i + 1
	local zyhb = nil
	if ZYHBPD(id) >= 1 then
		if ZYHBPD(id) == 2 then
			zyhb  = "????"
		else
			zyhb  = "?¨¾"
		end	
	else
		zyhb  = "??"
	end
	
      local zyzd = nil	
	if ZhongYongZD1(id) or ZhongYongZD2(id) then
		if JY.Person[id]["????"] == 3 then
			zyzd  = "?¨§??"
		else
			zyzd  = "?¨¾"
		end	
	else
		zyzd  = "??"
	end		
	
    local mrdz = nil	
	if MuRongDZ(id) == true then
		if JY.Person[id]["????????3"] == 2 then
			mrdz  = "????"
		else
			mrdz  = "?¨¾"
		end
	else
		mrdz  = "??"
	end	
	
   	local xshm = nil	
	if JY.Person[id]['????????4'] > 0 then
		if JY.Person[id]["????????4"] == 1001 then
			xshm  = "?¡è??"
		else
			xshm  = JY.Person[id]['????????4']
		end
	else
		xshm  = "??"
	end	
	
	local yjmc = nil
	if JY.Person[id]['????????5'] > 0 then
		if JY.Person[id]['????????5'] == 801 then
			yjmc = '????'
		elseif JY.Person[id]['????????5'] > 400 and JY.Person[id]['????????5'] < 801 then
			yjmc = '????'
		else
			yjmc = '???¡ì'
		end
	else
		yjmc = "??"	
	end			


	i = 0
	DrawString(bx*1140,by*475,'???¡Â?????? '..str2_gain,M_Yellow,size1)
	if str_gain > 0 then
		DrawString(bx*1140+120,by*475,"?? ?¨¹ "..str_gain,M_Yellow,size1)
	end	
	i = i + 1
	--DrawString(bx*1140,by*475+i*h,'¡¦???????????'..string.format('%5s %2s %2s',def2_gain,"?¨¹",def_gain),M_Yellow,size1)
	DrawString(bx*1140,by*475+i*h,'¡¦????????? '..def2_gain,M_Yellow,size1)
	if def_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"?? ?¨¹ "..def_gain,M_Yellow,size1)
	end	
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?¨¢???¨ª¡¦¡§?? '..agi2_gain,M_Yellow,size1)
	if agi_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"?? ?¨¹ "..agi_gain,M_Yellow,size1)
	end	
  --DrawString(bx*1140,by*475+i*h,'?¨¢????????'..string.format('%5s %2s %2s',p["?¨¢??"],"?¨¹",agi1_gain),M_Yellow,size1)
	--[[if agi_gain > -1 then
		DrawString(bx*1140,by*475+i*h,'?¨¢??????????'..string.format('%5s %2s %2s',agi2_gain,"?¨¹",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	else
		agi_gain = -(agi_gain)
		DrawString(bx*1140,by*475+i*h,'?¨¢????????'..string.format('%5s %2s %2s',agi2_gain,"??",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	end]]

	i = i + 1
	if p["????????6"] > 0 then
		local str = ""
		if p["????????6"] == 187 then
			str = "(¡Á???)"
		end	
		if p["????????6"] == 188 then
			str = "(????)"
		end	
		if p["????????6"] == 189 then
			str = "(????)"
		end	
		if p["????????6"] == 190 then
			str = "(?¡ì??)"
		end
		if p["????????6"] == 191 then
			str = "(????)"
		end
		DrawString(bx*1140,by*475+i*h,'?????????? '..psx(id,'????????')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'?????????? '..psx(id,'????????'),M_PaleGreen,size1)
	end
	i = i + 1
	if p["????????6"] > 0 then
		local str = ""
		if p["????????6"] == 192 then
			str = "(????)"
		end	
		DrawString(bx*1140,by*475+i*h,'?????¨§???? '..psx(id,'????????')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'?????¨§???? '..psx(id,'????????'),M_PaleGreen,size1)
	end
	i = i + 1
	--[[DrawString(bx*1140,by*475+i*h,'???¡Â?¨²???? '..Person_LJ(id)..'%',M_DeepSkyBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'???¡Â?¨²???? '..Person_BJ(id)..'%',C_RED,size1)
	i = i + 1]]
	DrawString(bx*1140,by*475+i*h,'¡Á¨®???????? '..zyhb,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?????????? '..zyzd,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?¡¦¡Á??????? '..mrdz,M_LightBlue,size1)
	i = i + 1
   	DrawString(bx*1140,by*475+i*h,'?????????? '..xshm,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?¡è?¡è?????? '..yjmc,M_LightBlue,size1)
	
   
   
   DrawString(bx*1140,by*475-160, "????", C_CYGOLD, size*0.7)
	local thingid = p["???????¡¦"]
		if thingid > 0 then
			--lib.PicLoadCache(2, p["???????¡¦"] * 2, x1 + size*4, y1*19+96-100, 1)
            DrawString(bx*1140,by*475-140, JY.Thing[thingid]["????"], M_DeepSkyBlue, size*0.7)			
			i = i + 1
			local n = TrainNeedExp(id)
			if n < math.huge then
				DrawString(bx*1140,by*475-120, string.format("%5d/%5d", p["????????"], n), C_CYGOLD, size*0.7)
			else
				DrawString(bx*1140,by*475-120, string.format("%5d/===", p["????????"]), C_CYGOLD, size*0.7)
			end
		else


	  --???¨¦??
	  ---i = i + 1
		--DrawString(x1-130, y1 + 12*h * (i)-40, "????", C_CYGOLD, size*0.8)
		local kk = nil
		if p["????"] >= 30 then
			kk = "   ="
		else
			p["????"] = limitX(p["????"],1,30)
			kk = 2 * (p["???¨¦"] - CC.Exp[p["????"] - 1])
			if kk < 0 then
				kk = "  0"
			elseif kk < 10 then
				kk = "   " .. kk
			elseif kk < 100 then
				kk = "  " .. kk
			elseif kk < 1000 then
				kk = " " .. kk
			end
		end		
		
		
		
		--????
	--	DrawString(dx*189, dy*390, kk, C_CYGOLD, size*0.8)
	--	local tmp = nil
	--	if CC.Level <= p["????"] then
	--		tmp = "="
	--	else
	--		tmp = 2 * (CC.Exp[p["????"]] - CC.Exp[p["????"] - 1])
	--	end
	--	DrawString(dx*209, dy*390, "/" .. tmp, C_CYGOLD, size*0.8)
	end
   
   --?¨²?¨¹?????¨®??
	local ww = bx*78
	--local h = bx*7
	--?¨²?¨¹¡Á???
	local x1,y1 = bx*200,bx*640
	--????¡Á???
	local x2,y2 = bx*200,bx*658
	--?¨²?¨¹
	local sm = JY.Person[id]['?¨²?¨¹']
	--????
	local nl = JY.Person[id]['????']
	--¡Á??¨®?¨²?¨¹
	local smmax = JY.Person[id]['?¨²?¨¹¡Á??¨®??']
	--¡Á??¨®????
	local nlmax = JY.Person[id]['????¡Á??¨®??']
	lib.LoadPNG(91, 35*2, x1, y1, 2)
	lib.LoadPNG(91, 35*2, x2, y2, 2)
	--?¨²?¨¹??
	lib.SetClip(x1-ww,y1-bx*7,(x1-ww)+(ww*2)*(sm/smmax),y1+bx*7)
	lib.LoadPNG(91, 31*2, x1, y1, 2)
	
	lib.SetClip(0,0,0,0)
	--??????
	lib.SetClip(x2-ww,y2-bx*7,(x2-ww)+(ww*2)*(nl/nlmax),y2+bx*7)
	lib.LoadPNG(91, 32*2, x2, y2, 2)
	
	lib.SetClip(0,0,0,0)
	-- --????????
	-- local sx = {'??','??','?¡Â??','?¨§??'}
	-- --????????
	-- local nlsx = sx[JY.Person[0]['????????']+1]
	local cl = M_DeepSkyBlue
   local strcl = '????'
   if JY.Person[id]["????????"] == 0 then
		cl = M_DeepSkyBlue
		strcl = '????'
   elseif JY.Person[id]["????????"] == 1 then
		cl = C_ORANGE
		strcl = '????'
   elseif JY.Person[id]["????????"] == 2 then
		cl = C_CYGOLD
		strcl = '?¡Â??'
   elseif JY.Person[id]["????????"] == 3 then
		cl = C_RED
		strcl = '?¨§??'
   end
	
	--?¨²?¨¹??¡Á?
	local smwz = sm..'/'..smmax
	--??????¡Á?
	local nlwz = nl..'/'..nlmax--..'?¡§'..strcl..'??'
	
	--?¨²?¨¹
	DrawString(x1-string.len(smwz)/4*size2,y1-size2/2,smwz,C_WHITE,size2)
	--????
	DrawString(x2-string.len(nlwz)/4*size2,y2-size2/2,nlwz,cl,size2)
   
   
   i = 0
   local hh = 50
   local wh = lb1[cx1]
   if lb1[cx1] ~=nil and lb1[cx1] > 4 then 
      hh = 475
	  wh = 1
   end
   if page == 2 then
	if lb1[cx1] < 4 then
		--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
	    lib.LoadPNG(91,162*2,bx*420+bx*240*(wh-1)+bx*70-bx*70,by*hh+by*25/2+cx*h-h-by*15,1)
		if lb1[cx1] == 2 then
			local li = cx + cot[2]
			local wz = 100
			local jg = 0
			local lv = math.modf(JY.Person[id]["????????" .. lb[2][li][2]]/100)+1;
			local kungfuatk = get_skill_power(id, JY.Person[id]["????" .. lb[2][li][2]], lv)
			lib.LoadPNG(91,161*2,0,0,1)
			--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
			--say("????????"..lb[lb1[cx1]][cx][1],0,1)
			local name = JY.Wugong[JY.Person[id]["????" .. lb[2][li][2]]]['????']
	        DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'????'..lb[2][li][2],M_YellowGreen,size2)
			--???????¡Â¡¦??¡ì????
		    DrawString(bx*50,by*80,'???¡Â¡¦??¡ì',C_BLACK,size)
			
			--DrawString(bx*200,by*80,'????:'..lb[2][cx][2],M_YellowGreen,size)
			
		    tjm30(id,lb[lb1[cx1]][li][1],bx*50,by*90+size)
			
			DrawString(bx*50,by*270+wz*by,'????????',C_BLACK,size*0.9)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
		     DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["????" .. lb[2][li][2]], 11).."(¡Á??¨®????)",C_ORANGE,size*0.9)
			
			
			DrawString(bx*50,by*270+wz*by+(by*40+size),'????????',C_RED,size)
		    local wgid = JY.Person[id]["????" .. lb[2][li][2]]
			if CC.KFMove[wgid] ~= nil then
				for i=1 ,#CC.KFMove[wgid] do 
					DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   ????: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
				end
			--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
			end
			
			--JY.Person[id]["????????" .. i]
			--JY.Person[pid]["????" .. lb[2][cx][2]]
			-- lb[2][#lb[2]+1] ={ psx(id,'????'..k),k}
			--lb[2][cx][1]
			--????????????
		elseif lb1[cx1] == 3 then
			lib.LoadPNG(91,161*2,0,0,1)
			local li = cx + lscot
			local name = JY.Wugong[JY.Person[id]["????" .. lb[3][cx][2]]]['????']
			DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'????'..lb[3][li][2],M_YellowGreen,size2)
			--DrawString(bx*200,by*80,'????:'..lb[3][cx][2],M_YellowGreen,size)
			if JY.Wugong[JY.Person[id]["????" .. lb[3][li][2]]]['????????'] == 6 then
				local wz = 100
				local jg = 0
				local lv = math.modf(JY.Person[id]["????????" .. lb[3][li][2]]/100)+1;
				local kungfuatk = get_skill_power(id, JY.Person[id]["????" .. lb[3][li][2]], lv)
				--lib.LoadPNG(91,161*2,0,0,1)
				--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
				--say("????????"..lb[lb1[cx1]][cx][1],0,1)
				
				
				--???????¡Â¡¦??¡ì????
				DrawString(bx*50,by*80,'???¡Â¡¦??¡ì',C_BLACK,size)
				
				tjm30(id,lb[lb1[cx1]][li][1],bx*50,by*90+size)
				DrawString(bx*50,by*270+wz*by,'????????',C_BLACK,size*0.9)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
				DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["????" .. lb[3][li][2]], 11).."(¡Á??¨®????)",C_ORANGE,size*0.9)
			
				-- --????????????
				--DrawString(bx*50,by*270+wz*by+(by*40+size),'????????',C_RED,size)
				--local wgid = JY.Person[id]["????" .. lb[3][cx][2]]
				--[[if CC.KFMove[wgid] ~= nil then
					for i=1 ,#CC.KFMove[wgid] do 
						DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   ????: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
					end
				--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
				end	]]										
			
			end
		elseif lb1[cx1] == 1 then
			
				local li = cx + cot[1]
				if li > 4 then 
					lib.LoadPNG(91,161*2,0,0,1)
					if lb[1][li] ~= nil then
					local name = lb[1][li]
					tjm(bx*50,by*10,name,M_Yellow,size)
					if li == 5 then --tfjswz = [#tfjswz+1] = tfstr
						local tfstr = tfjswz1[mid]
						if mid == 0 and JY.Base['??¡Á?'] > 0 then
							tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
						else
							tfstr = tfjswz1[mid]
							if tfstr == nil then
								tfstr = '?¡Á???????¨§???¨¦??'
							end	
							tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
						--	tjm(bx*50,by*80,tfstr,C_BLACK,size*0.7,14,h+10)
						end	
						
					else
						local tfstr = tfjswz[li-5]
						if li == 6 and (match_ID(id,26) or match_ID(id,592) or match_ID(id,577)) then
							tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
						else	
						--	tfstr = tfjswz1[j]
							tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
							--tjm(bx*35,by*50,li,M_Yellow,size*0.7,13,h+3)
						end	
					end	
				end
			end
		end
	end
end
	
	
	
   ShowScreen()
   local X,ktype,mx,my = lib.GetKey()
   if X == VK_SPACE or X == VK_RETURN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 1 then
			 page = 2		 
		  elseif page == 2 then 
			 if lb1[cx1] == 5 then
			 --   Personzb(id,cx)
			 elseif lb1[cx1] == 4 then	
				if cx == #lb[4] then 
				--  Menu_Jiali(id)
				--	say("????????1"..cx,0,1)
					Menu_Gongti(id,yg[cx][2])
				else 
				  Menu_Gongti(id,yg[cx][2])
				end
			 elseif lb1[cx1] == 3 then	
				--detailed_info(cur_thing)
				if cx <= #lb[3] then
					--say("??????????"..lb[3][cx][1],0,1)
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --???????¡¦
						if JY.Thing[j]["?¡¦??????"] >= 0 and JY.Thing[j]["?¡¦??????"] == lb[3][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 2 then
				if cx <= #lb[2] then
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --???????¡¦
						if JY.Thing[j]["?¡¦??????"] >= 0 and JY.Thing[j]["?¡¦??????"] == lb[2][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 1 then
				-- if cx >= 5 then 
				-- --  Menu_Jiali(id)
				-- --say("????????1"..cx,0,1)
					-- --Menu_Gongti(id,yg[cx][2])
					-- --lib.LoadPNG(91,165*2,bx*500,by*46+(cx*15),1)
					-- lib.LoadPNG(91,161*2,0,0,1)
					-- --local name = JY.Wugong[JY.Person[id]["????" .. lb[3][cx][2]]]['????']
					-- --DrawString(bx*50,by*12,name,M_Yellow,size)
					-- --DrawString(bx*300,by*12,'????'..lb[3][cx][2],M_YellowGreen,size2)
					-- --DrawString(bx*200,by*80,'????:'..lb[3][cx][2],M_YellowGreen,size)
					-- --for j = 1, #bossztwz do
						-- --local tfstr = bossztwz[j]
						-- --tjm(bx*50,by*80,tfstr,C_BLACK,size,10,h+10)
					-- --end	
					-- --for k = 1, tfjsbh do
						-- local n = 0
						-- local tfstr = tfjswz[cx-n] --= tfstr
						-- --local tfstr1 = tfjswz[cx-n] --= tfstr
						-- local h1 = 0
						-- if cx == 5 then
							-- --n = 5
							-- for j = 1 ,#tfjswz1 do
							-- tfstr = tfjswz1[j]
							-- tjm(bx*50,by*40+j*60,tfstr,C_BLACK,size*0.7,14,h+3)
							-- --tjm(bx*550,by*46+(cx*15)+j*20,tfstr,C_WHITE,size1,math.floor(bx*350/(size1)*0.8)+15,h+10)
							-- end
						-- --	say("¡Á¡§???¨§??",0,1)
						-- else
							-- n = 5
							-- tfstr = tfjswz[cx-n]
							-- tjm(bx*50,by*80,tfstr,C_BLACK,size*0.7,14,h+10)
							-- --tjm(bx*550,by*46+(cx*15),tfstr,C_WHITE,size*0.8,math.floor(bx*350/(size)*0.8)+2,h+10)
						-- end

					-- --DrawString(bx*935-string.len('??????????????')/4*size,by*136-size/2,'??????????????',C_WHITE,size)
					-- ShowScreen()
					-- WaitKey()
				-- else 
				  -- --Menu_Gongti(id,yg[cx][2])
				-- end
			 end
		  end
	  --end
   elseif X == VK_ESCAPE or ktype == 4 then 
      if page == 2 then 
	     page = page - 1 
		 cx = 1 
		 cx1 = 1
	  else 	 
         break
	  end
	  fy = 0
   elseif X == VK_UP then
	  --page2???????????¨½
	  --if JY.Status ~= GAME_WMAP then
		if page == 2 then 
			if cot[cx1] > 0 then 
				cot[cx1] = cot[cx1] - 1
			else
				cx = cx - 1
				if cx < 1 then
					if #lb[lb1[cx1]] > 14 then
						cx = 14
						cot[cx1] = #lb[lb1[cx1]] - 14
					else
						cx = #lb[lb1[cx1]]
					end
				end	
			end
		end
		fy = 0
	 -- end
   elseif X == VK_DOWN then
	  --page2???????????¨½
	 -- if JY.Status ~= GAME_WMAP then
		  if page == 2 then 
			 cx = cx + 1
			 if cx > 14 then 
				cx = 14
				cot[cx1] = cot[cx1] + 1
			 end
			 if cx + cot[cx1] > #lb[lb1[cx1]] then
				cx = 1
				cot[cx1] = 0
			 end
			 fy = 0
		  end
	  --end
   elseif X == VK_LEFT  then
      --page1????????????
	  if JY.Status ~= GAME_WMAP then
		  if page == 1 then 
			 t = t - 1 
			 if t < 1 then
				t = #team
			 end
			 id  = JY.Base['???¨¦'..t]
		  end
	  end  --page2???????????¨½
		  if page == 2 then 
			 cx1 = cx1 - 1
			 cx = 1
			 if cx1 < 1 then 
				cx1 = #lb1
			 end
			 fy = 0
			 cot = {0,0,0,0,0}
			 
		  end
	-- end
   elseif X == VK_RIGHT  then
      --page1????????????
	  if JY.Status ~= GAME_WMAP then
		  if page == 1 then
			 t = t + 1 
			 if t > #team then 
				t = 1
			 end
			 id  = JY.Base['???¨¦'..t]
		  end
	 end
		  --page2???????????¨½
		  if page == 2 then 
			 cx1 = cx1 + 1
			 cx = 1
			 if cx1 > #lb1 then 
				cx1 = 1
			 end	
			 fy = 0
			 cot = {0,0,0,0,0}
		  end	
    --  end	  
   elseif X == VK_PGUP then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy - 1
			 if fy < 0 then 
				fy = 0
			 end	
		  end
	  --end
   elseif X == VK_PGDN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy + 1
			 if fy > fymax then
				fy = fymax 
			 end
		  end
	  --end
   else 
     -- if JY.Status ~= GAME_WMAP then
      local mxx = false 
	  if page == 1 then 
	     if ktype == 3 then 
		    page = 2
		 end
	  elseif page == 2 then 
	     if #lb[1] > 0 then 
		    for ii = 1,#lb[1] do
				if ii <= 14 then
					if mx >= bx*420 and mx <= bx*420 + bx*160 and 
					my >= by*50+(ii-1)*h and my <= by*50+(ii-1)*h + size1 then 
					cx = ii
					cx1 = lb2[1]
					mxx = true 
					break
					end
				end
			end
		 end	
		 if #lb[2] > 0 then 
		    for ii = 1,#lb[2] do 
				if ii <= 14 then
					if mx >= bx*660 and mx <= bx*660 +size1*4 and 
					my >= by*50+(ii-1)*h and my <= by*50+(ii-1)*h + size1 then 
					cx = ii 
					cx1 = lb2[2]
					mxx = true 
					break
					end
				end
			end
		 end
		 if #lb[3] > 0 and mxx == false then 
		    for ii = 1,#lb[3] do 
				if ii <= 14 then
					if mx >= bx*900 and mx <= bx*900 +size1*4 and 
					my >= by*50+(ii-1)*h and my <= by*50+(ii-1)*h + size1 then 
					cx = ii 
					cx1 = lb2[3]
					mxx = true 
					break
					end
				end
			end
		 end
		 if #lb[4] > 0 then 
		    for ii = 1,#lb[4] do 
			    if mx >= bx*1142 and mx <= bx*1345 and 
				   my >= by*78+(ii-1)*by*48-by*18 and my <= by*78+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[4]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[5] > 0 then 
		    for ii = 1,#lb[5] do 
			    if mx >= bx*422 and mx <= bx*622 and 
				   my >= by*488+(ii-1)*by*48-by*18 and my <= by*488+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[5]
				   mxx = true 
				   break
				end
			end
		 end
		 if mxx == true and ktype == 3 then 
	        if lb1[cx1] == 5 then
		    --   Personzb(id,cx)
		    elseif lb1[cx1] == 4 then	
		       if cx == #lb[4] then 
			    
				Menu_Gongti(id,yg[cx][2])
			   else 
			      Menu_Gongti(id,yg[cx][2])
			   end
		    elseif lb1[cx1] == 2 then
		    
		    end
		 end
	  end
	  --end
   end
   
   
   end
end 

function PersonStatusA(t,page)
   local bx = CC.ScreenW/1360
   local by = CC.ScreenH/768
   local size = CC.DefaultFont*0.7
   local size1 = CC.DefaultFont*0.6
   local size2 = CC.DefaultFont*0.55
   local h = by*size1*1.2
   local cx = 1 
   local cx1 = 1
   local fy = 0 --???????¡Â¡¦???
   local fymax = 0 --¡Á??¨®¡¦???
   local team = {}
	if JY.Restart == 1 then
		do return end
	end
	if t < 0 then
		do return end
	end	
   for tt = 1,CC.TeamNum do 
       if JY.Base['???¨¦'..tt] >= 0 then 
	      team[#team+1] = JY.Base['???¨¦'..tt]
	   end
   end 
   if page == nil then 
      page = 1 
   end
   
	
   
   -- if JY.Status == GAME_WMAP then
	    -- if WAR.Person[teamid]["??¡¦?"] == false then
	        -- pagenum = 2
	    -- end
	-- end
	local id = -1
   if JY.Status == GAME_WMAP then
       id = WAR.Person[t]["????????"]
   else 
       id = t
   end
	local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
   if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
   if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
   while true do
   if JY.Restart == 1 then
		do return end
	end
   Cls()
   
   local p = JY.Person[id]
   local picx,picy = lib.GetPNGXY(1,psx(id,'¡ã??¨ª?¨½')*2)
   local lb = {{},{},{},{},{}}
   local lb1 = {}
   local lb2 = {nil,nil,nil,nil,nil}
   local function DrawAttrib(str, x,y,color1,size)
		local i = 0
		--DrawString(x1, y1 + h * i, string.sub(4), color1, size)
		--????????????
		--local str;
		if str == "??????¡¦¨¾" then
			local bonus = 0
			bonus = TrueQZ(id) - JY.Person[id]["??????¡¦¨¾"] 
			if bonus > 0 then
				DrawString(x,y,  string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
		if str == "??¡¦¡§????" then
			local bonus = 0
			
			bonus = TrueZF(id) - JY.Person[id]["??¡¦¡§????"] 
			if bonus > 0 then
				DrawString(x, y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
		if str == "????????" then
			local bonus = 0
			bonus = TrueYJ(id) - JY.Person[id]["????????"] 
			if bonus > 0 then
				DrawString(x, y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
        if str == "????????" then
            local bonus = 0
			bonus = TrueSD(id) - JY.Person[id]["????????"] 		
			if bonus > 0 then
				DrawString(x, y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		
        if str == "???????¡Â" then
            local bonus = 0
			bonus = TrueTS(id) - JY.Person[id]["???????¡Â"]
			if bonus > 0 then
				DrawString(x,y, string.format("?¨¹ %s",bonus), color1, size)
			end
		end
		--?????¨¦??????¡ã??¡Â????
		if JY.Status == GAME_WMAP then
				if str == "????????" then
					for k,v in pairs(CC.AddDoc) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
									DrawString(x,y, "?¨¹ "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				if str == "????????" then
					for k,v in pairs(CC.AddPoi) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
									DrawString(x,y, "?¨¹ "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				
			i = i + 1
		end
	end

	-- if case == nil then
		-- if JY.Status ~= GAME_WMAP then
			-- DrawString(x1-size*5, y1 + h * (i)+2, "?????¨¹???? ?¨²?¨¹?????????¨§?? ESC????", M_PaleTurquoise, size*0.7)
		-- else
			-- DrawString(x1-size*5, y1 + h * (i)+2, "?????¨¹???? ?¨²?¨¹?????????¨§?? ESC????", Snow3, size*0.7)
		-- end
	-- else
		-- DrawString(x1-size*5, y1 + h * (i)+2, "?????¨¹???¨½???? ¡Á¨®???¨¹????/???? ?????¨¹?¡¦??????", Snow3, size*0.7)
	-- end


  --[[ if psx(id,'?¨§??????1') > 0 or psx(id,'?¨§??????2') > 0 or psx(id,'?¨§??????') > 0 or psx(id,'?¨§???¨¢??') > 0  then 
      lb1[#lb1+1] = 1
	  lb2[1] = #lb1
	  lb2[2] = lb2[1]
   end]]
   local i = 0
   --???¡ã??
   --lib.PicLoadCache(99,121*2,CC.ScreenW/2,CC.ScreenH/2,2,256,nil,bx*1360)
   lib.LoadPNG(91, 149 * 2 ,0 , 0, 1)
   --????¡ã??¨ª?¨½
   pngxy(90,psx(id,'¡ã??¨ª?¨½')*2,bx*200,CC.ScreenH-by*300,2)
   --????
   -- if MPPD(id) ~= nil and MPPD(id) > 0 then 
	  -- DrawString(bx*30,by*70,CC.MP[MPPD(id)][1]..CC.MPDJ[MPPD(id)][MPDJ(id)],C_ORANGE,size)
   -- else 
	  -- DrawString(bx*30,by*70,'????????',C_WHITE,size)
   -- end
	if MPPD(id) ~= 0 then
		local mptype, mpdj = MPDISPLAY(id)
		local str = ""
		local str1 = ""
		local color = ""
		if mptype ~= nil then
			if MPPD(id) == 13 and match_ID(id,66) then
				str = "??".."?¡§???¡Â??".."??"
				str1 = "??".."????".."??"
				color = M_Red
				--DrawString(bx*30,by*70, , M_Red, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 4 then
				str = "??".."?¡Â??".."??"
				str1 = "??".."?¨²??????".."??"
				color = C_GOLD
				--DrawString(bx*30,by*70, "??".."?¡Â???¨²??????".."??", C_GOLD, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["?¡¦??"] == 1 then
				str = "??".."?¡Â??".."??"
				str1 = "??".."????????".."??"
				color = C_GOLD
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["?¡¦??"] == 100 then
				str = "??".."?¡Â??".."??"
				str1 = "??".."????¡Â???".."??"
				color = C_GOLD
			elseif MPPD(id) == 12 and match_ID(id,73) then
				str = "??".."?????¨½??".."??"
				str1 = "??".."????".."??"
				color = M_Red
			elseif MPPD(id) == 12 and match_ID(id,26) then	
				str = "??".."?????¨½??".."??"
				str1 = "??".."?¡ã???¡Â".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?????¨½???¡ã???¡Â".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 14 and match_ID(id,140) then	
				str = "??".."????????".."??"
				str1 = "??".."?????¡è??".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?????????????¡è??".."??", M_Red, size*0.8)		
			elseif MPPD(id) == 10 and match_ID(id,588) then	
				str = "??".."???¡§??".."??"
				str1 = "??".."???¡Â¡¦¨¾??".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."???¡§???¡Â¡¦¨¾??".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,577) then	
				str = "??".."??????".."??"
				str1 = "??".."¨¦_??¡Á???".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."????¡Á???".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,114) then	
				str = "??".."??????".."??"
				str1 = "??".."????????".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."????????".."??", M_Red, size*0.8)	
			elseif MPTX(id,5,4) and id == 0 and CC.TX['???????????¨½'] > 0 then	
				str = "??".."??????".."??"
				local str = {'???????¡Â','???????¡Â','???????¡Â'}
				str1 = "??"..str[CC.TX['???????????¨½']].."??"
				color = M_DeepSkyBlue	
			elseif MPPD(id) == 5 and match_ID(id,38) then	
				str = "??".."¡¦???".."??"
				str1 = "??".."???¨²¡Á??¨²".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."????????".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 2 and match_ID(id,50) then	
				str = "??".."?¡è¡ã?".."??"
				str1 = "??".."?¡ã¡ã??¡Â".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?¡è¡ã??¡ã¡ã??¡Â".."??", M_Red, size*0.8)
			elseif MPPD(id) == 15 and match_ID(id,499) then	
				str = "??".."?¨®?¨ª".."??"
				str1 = "??".."¡Á?¡Á???¡Á?".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?¨®?¨ª??¡Á?".."??", M_Red, size*0.8)	
			elseif MPPD(id) == 11 and match_ID(id,596) then	
				str = "??".."?????¡Â".."??"
				str1 = "??".."???¡Â".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."?????¡Â???¡Â".."??", M_Red, size*0.8)								
			elseif MPPD(id) == 20 and match_ID(id,523) then	
				str = "??".."????¡Á?".."??"
				str1 = "??".."¡Á??¡Â¡¦¨¾??".."??"
				color = M_Red
				--DrawString(bx*30,by*70, "??".."¡Á??¡Â¡¦¨¾??".."??", M_Red, size*0.8)										
			elseif MPPD(id) == 24 and match_ID(id,525) then	
				str = "??".."??????".."??"
				str1 = "??".."???????¡¦".."??"
				color = M_Red
			elseif MPPD(id) == 23 and match_ID(id,637) then	
				str = "??".."??¨¢??¨¹".."??"
				str1 = "??".."?¨¹??".."??"
				color = M_Red	
			elseif MPPD(id) == 20 and match_ID(id,745) then	
				str = "??".."????¡Á?".."??"
				str1 = "??".."??????¡Á?".."??"
				color = M_Red		
			elseif MPPD(id) == 26 and match_ID(id,754) then	
				str = "??".."?????¡ì".."??"
				str1 = "??".."?¨¾?¡§???¡Â".."??"
				color = M_Red			
			else
				str = "??"..mptype.."??"
				str1 = "??"..mpdj.."??"
				color =  M_DeepSkyBlue
				--DrawString(bx*30,by*70, "??"..mptype..mpdj.."??", M_DeepSkyBlue, size*0.8)
			end
		else
			str = "????????????"
			str1 = "??????"
			color = C_ORANGE
		end
		DrawString(bx*55,by*70, "??????????"..str, color, size)
		DrawString(bx*55,by*70+size+5, "???????¡Á??"..str1, color, size)
	else
		local str = "????????????"
		local str1 = "??????"
		local color = C_ORANGE
		DrawString(bx*55,by*70, "??????????"..str, color, size)
		DrawString(bx*55,by*70+size+5, "???????¡Á??"..str1, color, size)
	end
		local ch = nil
		local chcl = C_CYGOLD
		--local fj = {[0] = {"????",C_ORANGE},{"¡Á???",M_DarkRed},{"????",C_RED},{"???¡Â",M_Pink},{"???¡Â",M_Pink},{"???¡Â",M_Blue},{"??¡Á?",M_LightBlue},{"???¨½",C_CYGOLD}}

        --local fjstr = "??"..fj[p["????¡¦??¡Á"]][1].."??"
        local nametre = p["????"]
        local djstr = p["????"].."??"
        if id == 0 and (JY.Base['??¡Á?'] == nil or JY.Base['??¡Á?'] < 1 ) and JXPD(id,JY.Base['????'],1) then
        	djstr = p["????"].."??"..'????????'
        elseif id ~= 0 and JXPD(id,id,1) then
        	djstr = p["????"].."??"..'????????'	
        end
        --local namex = CC.ScreenW/2-string.len(fjstr..nametre..djstr)/4*size
        --local fjx = namex + string.len(nametre)/2*size
       -- local djx = fjx + string.len(fjstr)/2*size
		-- DrawString(fjx, dx*24, fjstr, fj[JY.Person[id]["????¡¦??¡Á"]][2], size*0.8)
		-- DrawString(namex, dx*20, nametre, C_CYGOLD, size)		
		-- DrawString(djx, dx*24, djstr, C_CYGOLD, size*0.8)
   --????????
   --DrawString(bx*280,by*70,name(id),C_WHITE,size)
	   DrawString(bx*150,by*10,name(id)..""..djstr,M_Yellow,size*1.3)--..fjstr
	   local tfx1 = bx*55
	   local fty1 = by*79+50
	   local fty2 = 0
	   local fty3 = 0
	   --?¡Â??
	   if id == 0 then
			local main_tf;
			--???¡Â
			if JY.Base["??¡Á?"] > 0 then
				main_tf = ZJTF[JY.Base["??¡Á?"]]
			--????
			elseif JY.Base["????"] > 0 then
				main_tf = " "
			--????
			elseif JY.Base["????"] > 0 then
				if RWTFLB[p["?¨²??"]] ~= nil then
					main_tf = RWTFLB[p["?¨²??"]]
				end
			end
			if main_tf ~= nil then
				DrawString(tfx1, fty1,"??¡ã???????".."??"..main_tf.."??", C_ORANGE, size)
			--else
				--main_tf = "???¨²¡¦¨¹¡¦?"
				--DrawString(tfx1 -string.len(main_tf)/4*size*0.8, fty1,"??¡ã???????"..main_tf , C_ORANGE, size)
			fty2 = size + 5
			end
			
		end

		--???¡§?????¨§??
		if id ~= 0 and RWTFLB[id] ~= nil then
			--DrawString(x1-7, y1 + h * (i)-142,RWTFLB[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"??¡ã???????".."??".. RWTFLB[id].."??", C_ORANGE, size)
			fty2 = size	+5	
		end
	  
		fty1 = fty1+fty2
		--?¡Â??????
		if id == 0 then
			local main_ch;
			--???¡Â
			if JY.Base["??¡Á?"] > 0 then
				if p["????????"] == 0 then
					main_ch = "?????????¡Á"
				else
					main_ch = "?????????¨²"
				end
			--????
			elseif JY.Base["????"] > 0 then
				main_ch = ''--TSTF[JY.Base["????"]]
			--????
			elseif JY.Base["????"] > 0 then
				if RWWH[JY.Base["????"]] ~= nil and JY.Base["????"] ~= 35 and JY.Base["????"] ~= 38 and JY.Base["????"] ~= 49 
				and JY.Base["????"] ~= 626 then
					main_ch = RWWH[JY.Base["????"]]
				elseif JY.Base["????"] == 35 then
					if JY.Person[id]["????????"] >= 2 then
						main_ch = RWWH["35"]
						--DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)	
					elseif JY.Person[id]["????????"] >= 1 then
						main_ch = RWWH[35]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
						 --DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)		
					end
				elseif JY.Base["????"] == 38 then
					if JY.Person[id]["????????"] >= 1 then
						main_ch =  RWWH["38"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
					    --DrawString(tfx1 -string.len(RWWH["38"])/4*size*0.8, by*122,  RWWH["38"], C_ORANGE, size)		
					end
				elseif JY.Base["????"] == 49 then
					if JY.Person[id]["????????"] >= 1 then
						main_ch = RWWH["49"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH["49"])/4*size*0.8, by*122,  RWWH["49"], C_ORANGE, size)	
					else
						main_ch = RWWH[49]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH[49])/4*size*0.8, by*122,  RWWH[49], C_ORANGE, size)	
					end
				elseif JY.Base["????"] == 626 then
					if JY.Person[id]["????????"] >= 1 then
						main_ch = RWWH["626"]
						--DrawString(tfx1 -string.len(RWWH["626"])/4*size*0.8, by*122,  RWWH["626"], C_ORANGE, size)
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
					else
					main_ch = RWWH[626]
					--	DrawString(x1-7, y1 + h * (i)-100, RWWH[626], C_CYGOLD, size*0.8)
					 --DrawString(tfx1 -string.len(RWWH[626])/4*size*0.8, by*122,  RWWH[626], C_ORANGE, size)		
					end
			
				end
			end
			if main_ch ~= nil then
				--DrawString(x1-7, y1 + h * (i)-100, main_ch, C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"?¨§????????".."??"..main_ch.."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--??????????
		if RWWH[id] ~= nil and id ~= 35 and id ~= 38 and id ~= 49 then
			--DrawString(x1-7, y1 + h * (i)-100, RWWH[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[id].."??", C_ORANGE, size)	
			fty3 = size+5
		end

		--???¨¹??
		if id == 35 then
			if JY.Person[id]["????????"] >= 2 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["35"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["35"].."??", C_ORANGE, size)
				fty3 = size
			elseif JY.Person[id]["????????"] >= 1 then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[35].."??", C_ORANGE, size)
				fty3 = size+5
			end
		end

		--?¨¦?¨½
		if id == 49 then
			if JY.Person[id]["????????"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["49"].."??", C_ORANGE, size)	
				fty3 = size+5
			else
				--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[49].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	  
		--?????¨§
		if id == 38 then
			if JY.Person[id]["????????"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["38"].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--??¡¦???
		if id == 457 then
			if JY.Person[id]["????????"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["457"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["457"].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end	
		
		--????
		if id == 626 then
			if JY.Person[id]["????????"] >= 1 then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH["626"].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		--??¡ã???
		if id == 189 then
			if JY.Person[id]["????????"] >= 1 then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["189"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[189].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end	 
		--????¡¦?
		if id == 633 then
			if JY.Person[id]["????????"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["633"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"?¨§????????".."??"..RWWH[633].."??", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	fty1 = fty1 + fty3
	local fj = {[0] = {"????",C_ORANGE},{"¡Á???",M_DarkRed},{"????",C_RED},{"???¡Â",M_Pink},{"???¡Â",M_Pink},{"???¡Â",M_Blue},{"??¡Á?",M_LightBlue},{"???¨½",C_CYGOLD}}
    local fjstr = "??"..fj[p["????¡¦??¡Á"]][1].."??"
	DrawString(tfx1, fty1,"??????????"..fjstr, fj[p["????¡¦??¡Á"]][2], size)
   --???????¡Â
    -- --?????¨§??2
   if psx(id,'?¨§??????1') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then 
         DrawString(bx*420,by*60+0*h,"?¨§????????"..JY.Wugong[psx(id,'?¨§??????1')]['????'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+0*h,"?¨§??????????",C_WHITE,size1)
	--	 i = i + 1
   end
   
   if psx(id,'?¨§??????2') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then JY.Wugong[psx(id,'?¨§??????2')]['????']
         DrawString(bx*420,by*60+1*h,"?¨§????????"..JY.Wugong[psx(id,'?¨§??????2')]['????'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+1*h,"?¨§??????????",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'?¨§??????') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then 
         DrawString(bx*420,by*60+2*h,"?¨§????????"..JY.Wugong[psx(id,'?¨§??????')]['????'],M_Red,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+2*h,"?¨§??????????",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'?¨§???¨¢??') > 0 then 
    --  if CC.TF[psx(id,'?¨§??2')] ~= nil then 
         DrawString(bx*420,by*60+3*h,"?¨§???¨¢????"..JY.Wugong[psx(id,'?¨§???¨¢??')]['????'],M_Yellow,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+3*h,"?¨§???¨¢??????",C_WHITE,size1)
	--	 i = i + 1
   end
   
   local tfid;
		--?¡Â??
	if id == 0 then
		--???¡Â
		if JY.Base["??¡Á?"] > 0 then
			tfid = 0--546 + JY.Base["??¡Á?"]
		--????
		elseif JY.Base["????"] > 0 then
			tfid = ''
		--????
		else
			tfid = JY.Base["????"]
			--??????????
			--[[if tfid == 54 and JY.Person[id]["????????"] >= 1 then
				tfid = "54-1"
			--?????????¨§
			elseif tfid == 38 and JY.Person[id]["????????"] >= 1 then
				tfid = "38-1"
			--????????
			elseif tfid == 626 and JY.Person[id]["????????"] >= 1 then
				tfid = "626-1"				
			end]]
		end
	--????
	else
		tfid = id
		--??????????
			--[[if tfid == 54 and JY.Person[id]["????????"] >= 1 then
				tfid = "54-1"
			--?????????¨§
			elseif tfid == 38 and JY.Person[id]["????????"] >= 1 then
				tfid = "38-1"
			--????????
			elseif tfid == 626 and JY.Person[id]["????????"] >= 1 then
				tfid = "626-1"				
			end]]
	end
	if psx(id,'?¨§??????1') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§??????1'
	end	 
	if psx(id,'?¨§??????2') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§??????2'
	end
	if psx(id,'?¨§??????') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§??????'
	end	 
	if psx(id,'?¨§???¨¢??') >= 0 then 
		lb[1][#lb[1]+1] = '?¨§???¨¢??'
	end
	local me = {}
	local me1 = {}
	local me2 = {}
	local me3 = {}
	local me4 = {}
	local mid = tfid 
	local bz = {'??','??','??','??','??','??','??','??','??','??','?¡ì','??'}
	if JY.Base["??¡Á?"] > 0 and id == 0 then 
		mid = bz[JY.Base["??¡Á?"]]
	end
	
	local row = 0
	if TFJS[mid] ~= nil then
		for i = 1, #TFJS[mid] do
			me1[#me1+1] = TFJS[mid][i]
			if i == #TFJS[mid] then 
				me1[#me1+1] = "??"
				
			end
		end
	else
		me1[#me1+1] = '?????????¨§??'
	end

	if CC.PTF[tfid] ~= nil then -- and tfid ~= 0
		for i,v in pairs(CC.PTF[tfid]) do 
			if v == 1 then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
		   elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
			end
		end
	end
	
	if id == 0 then 
		for i,v in pairs(CC.PTF[id]) do
			if v == 1 then
				if CC.PTFSM[i] ~= nil then 
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end
		   elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
				end	
			end
		end
		-- for i = 1, #ZJZSJS do
			-- me[#me+1] = ZJZSJS[i]
			-- if i == #ZJZSJS then 
				-- me[#me+1] = "??"
				
			-- end
		-- end	
	end
	
	if id == 0 and JY.Base["????"] ==52 then
		me1[#me1+1] = "??".."??????????"
		if TFJS[JY.Person[0]["?¨²??"]] ~= nil then
			for i = 1, #TFJS[JY.Person[0]["?¨²??"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["?¨²??"]][i]
				if i == #TFJS[JY.Person[0]["?¨²??"]] then 
				me1[#me1+1] = "??"
				
				end
			end
		end
		if CC.PTF[JY.Person[0]["?¨²??"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[0]["?¨²??"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
						end
				end
			end
		end
	end
	
	if id == 512 then
		me1[#me1+1] = "??".."???¡ì??"
		if TFJS[JY.Person[512]["????????"]] ~= nil then
			for i = 1, #TFJS[JY.Person[512]["????????"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["?¨²??"]][i]
				if i == #TFJS[JY.Person[512]["????????"]] then 
				me1[#me1+1] = "??"
				
				end
			end
		end
		if CC.PTF[JY.Person[512]["????????"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[512]["????????"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "??"
					me[#me+1] = '??'..CC.PTFSM[i][1]
					me[#me+1] = '?¡Á'..CC.PTFSM[i][2]
					me[#me+1] = "??"
					
						end
				end
			end
		end
	end
	if BOSSZT[mid] ~= nil then
		for i = 1, #BOSSZT[mid] do 
			me2[#me2+1] = BOSSZT[mid][i]
			--if i == #BOSSZT[mid] then
			--me2[#me2+1] = "??"
			--end
		end
	end
	if ZL[mid] ~= nil then
		for i = 1, #ZL[mid] do 
			me3[#me3+1] = ZL[mid][i]
			--if i == #ZL[mid] then
			--me3[#me3+1] = "??"
			--end
		end
	end
	if FY[mid] ~= nil then
		for i = 1, #FY[mid] do 
			me4[#me4+1] = FY[mid][i]
			--if i == #FY[mid] then
			--me4[#me4+1] = "??"
			--end
		end
	end
	local size = CC.DefaultFont
	local tfjsbh = 0
	local tfjswz = {}
	local tfjsbh1 = 0
	local tfjswz1 = {}
	local bossztwz = {}
	local rwzlwz = {}
	local fyjywz = {}
	local pdl = true
	for k = 1, #me1 do
		--local tfstr = me[k]
		local tfstr1 = me1[k]
		local h1 = 0
		-- if #tfstr > math.floor(bx*345/size2)+5 then
			-- --	i = i + 1
				-- row = row + 1
		-- end		
		--if string.sub(tfstr,1,2) == "??" then
			--row = row + 1
		--else
		if string.sub(tfstr1,1,2) == '??' and pdl then
			tjm(bx*420,by*155+i*h,tfstr1,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			
			--h1=--tfstr = tfstr .. "??"
		--	i = i + 1
			lb[1][#lb[1]+1] = tfstr1
			
			pdl = false
		end
		if string.sub(tfstr1,1,2) == '?¡Á' or string.sub(tfstr1,1,2) == '??' then
		--	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
		--	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--row = row + 1
			--DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
			--tjm(bx*420,by*155+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			--tfjsbh1 = tfjsbh1 + 1
			if tfjswz1[mid] == nil then
				tfjswz1[mid] = tfstr1
			else
				tfjswz1[mid] = tfjswz1[mid] .."*".. tfstr1
			end	
			--h1=--tfstr = tfstr .. "??"
		--	i = i + 1
			--lb[1][#lb[1]+1] = tfstr
		end
		-- row = row + 1
		-- i = i + 0.33
	end
	for k = 1, #me2 do
		local tfstr = me2[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '??' then
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			lb[1][#lb[1]+1] = tfstr
		end
		if string.sub(tfstr,1,2) == '?¡Á' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--bossztwz[#bossztwz+1] = tfstr
		end
		--row = row + 1
		i = i + 0.5
	end
	for k = 1, #me3 do
		local tfstr = me3[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '??' then
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			lb[1][#lb[1]+1] = tfstr
			--row = row + 1

		end
		if string.sub(tfstr,1,2) == '?¡Á' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--rwzlwz[#rwzlwz+1] = tfstr
		end
		i = i + 0.5
	end
	for k = 1, #me4 do
		local tfstr = me4[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '??' then
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			lb[1][#lb[1]+1] = tfstr
			
		end
		if string.sub(tfstr,1,2) == '?¡Á' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--fyjywz[#fyjywz+1] = tfstr
		end
		--row = row + 1
		i = i + 0.5
	end
	for k = 1, #me do
		local tfstr = me[k]
		--local tfstr1 = me1[k]
		local h1 = 0
		-- if #tfstr > math.floor(bx*345/size2)+5 then
			-- --	i = i + 1
				-- row = row + 1
		-- end		
		--if string.sub(tfstr,1,2) == "??" then
			--row = row + 1
		--else
		
		
		if string.sub(tfstr,1,2) == '??' then
		--	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
		--	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--row = row + 1
			--DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			
			--h1=--tfstr = tfstr .. "??"
		--	i = i + 1
			lb[1][#lb[1]+1] = tfstr
		end
		if string.sub(tfstr,1,2) == '?¡Á' then
		--	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
		--	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--row = row + 1
			--DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
			--tjm(bx*420,by*155+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--h1=--tfstr = tfstr .. "??"
		--	i = i + 1
			--lb[1][#lb[1]+1] = tfstr
		end
		row = row + 1
		i = i + 0.33
	end
   --if psx(id,'?¨§??????1') > 0 or psx(id,'?¨§??????2') > 0 or psx(id,'?¨§??????') > 0 or psx(id,'?¨§???¨¢??') > 0  then 
	lb1[#lb1+1] = 1
	lb2[1] = #lb1
	lb2[2] = lb2[1]
   --end
   -- if TFJS[id] ~= nil then 
	  -- for i = 1,#TFJS[id]  do
		-- tjm9(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
	-- --	DrawString(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size)
	  -- end
   
      
   -- end
   
   --tjm9(bx*30,by*80+h,'???????????¨®?¡è¡¦¡§?????????¡è??????¡¦¡§????????????????????????????????????',C_WHITE,size2,math.floor(bx*345/size2)-1,h)
   
   -- --?????¨§??1
   -- if CC.TG[id] ~= nil then 
    -- --  if CC.TF[psx(id,'?¨§??')] ~= nil then 
         
	-- --  end
	-- --	say("?????¨§??1",0,1)
		-- for k,v in pairs(CC.TG[id]) do 
			-- if v == 1 then 
			-- --	say("?????¨§??"..k,0,1)
				-- if CC.PTFSM[k] ~= nil then
					-- -- me[#me+1] = '??'..CC.PTFSM[k][1]
					-- -- me[#me+1] = '?¡Á'..CC.PTFSM[k][2]
					-- -- me[#me+1] = "??"
					
					-- DrawString(bx*420,by*60+i*h,CC.PTFSM[k][1],C_WHITE,size1)
					-- i = i + 1
					
				-- end
			-- end
		-- end
		
   -- end
	
   
   --¡Á¡ã????????????
		local str_gain, def_gain, agi_gain = 0, 0, 0
		local fb = 1
		if match_ID(id,546) then
			fb = 2
		end
		if p["???¡Â"] > -1 then
			if JY.Thing[p["???¡Â"]]["?????¡Â??"] > 0 then
				str_gain = str_gain + JY.Thing[p["???¡Â"]]["?????¡Â??"]*10 + JY.Thing[p["???¡Â"]]["?????¡Â??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["???¡Â"]]["?????¡Â??"] < 0 then
				str_gain = str_gain + JY.Thing[p["???¡Â"]]["?????¡Â??"]*10 - JY.Thing[p["???¡Â"]]["?????¡Â??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["???¡Â"]]["??¡¦?????"] > 0 then
				def_gain = def_gain + JY.Thing[p["???¡Â"]]["??¡¦?????"]*10 + JY.Thing[p["???¡Â"]]["??¡¦?????"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["???¡Â"]]["??¡¦?????"] < 0 then
				def_gain = def_gain + JY.Thing[p["???¡Â"]]["??¡¦?????"]*10 - JY.Thing[p["???¡Â"]]["??¡¦?????"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["???¡Â"]]["???¨¢??"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["???¡Â"]]["???¨¢??"]*10*fb + JY.Thing[p["???¡Â"]]["???¨¢??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2*fb
			elseif JY.Thing[p["???¡Â"]]["???¨¢??"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["???¡Â"]]["???¨¢??"]*10*fb - JY.Thing[p["???¡Â"]]["???¨¢??"]*(JY.Thing[p["???¡Â"]]["¡Á¡ã??????"]-1)*2*fb
			end
		end
		if p["¡Á???"] > -1 then
			if JY.Thing[p["¡Á???"]]["?????¡Â??"] > 0 then
				str_gain = str_gain + JY.Thing[p["¡Á???"]]["?????¡Â??"]*10 + JY.Thing[p["¡Á???"]]["?????¡Â??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["¡Á???"]]["?????¡Â??"] < 0 then
				str_gain = str_gain + JY.Thing[p["¡Á???"]]["?????¡Â??"]*10 - JY.Thing[p["¡Á???"]]["?????¡Â??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡Á???"]]["??¡¦?????"] > 0 then
				def_gain = def_gain + JY.Thing[p["¡Á???"]]["??¡¦?????"]*10 + JY.Thing[p["¡Á???"]]["??¡¦?????"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["¡Á???"]]["??¡¦?????"] < 0 then
				def_gain = def_gain + JY.Thing[p["¡Á???"]]["??¡¦?????"]*10 - JY.Thing[p["¡Á???"]]["??¡¦?????"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡Á???"]]["???¨¢??"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["¡Á???"]]["???¨¢??"]*10*fb + JY.Thing[p["¡Á???"]]["???¨¢??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2*fb
			elseif JY.Thing[p["¡Á???"]]["???¨¢??"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["¡Á???"]]["???¨¢??"]*10*fb - JY.Thing[p["¡Á???"]]["???¨¢??"]*(JY.Thing[p["¡Á???"]]["¡Á¡ã??????"]-1)*2*fb
			end
		end
		if p["¡¦???"] > -1 then
			local n = 2
			if MPPD(id) == 2 then
				n=4
			end	
			if JY.Thing[p["¡¦???"]]["?????¡Â??"] > 0 then
				str_gain = str_gain + JY.Thing[p["¡¦???"]]["?????¡Â??"]*10 + JY.Thing[p["¡¦???"]]["?????¡Â??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2
			elseif JY.Thing[p["¡¦???"]]["?????¡Â??"] < 0 then
				str_gain = str_gain + JY.Thing[p["¡¦???"]]["?????¡Â??"]*10 - JY.Thing[p["¡¦???"]]["?????¡Â??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡¦???"]]["??¡¦?????"] > 0 then
				def_gain = def_gain + JY.Thing[p["¡¦???"]]["??¡¦?????"]*10 + JY.Thing[p["¡¦???"]]["??¡¦?????"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*n
			elseif JY.Thing[p["¡¦???"]]["??¡¦?????"] < 0 then
				def_gain = def_gain + JY.Thing[p["¡¦???"]]["??¡¦?????"]*10 - JY.Thing[p["¡¦???"]]["??¡¦?????"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2
			end
			if JY.Thing[p["¡¦???"]]["???¨¢??"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["¡¦???"]]["???¨¢??"]*10*fb + JY.Thing[p["¡¦???"]]["???¨¢??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2*fb
			elseif JY.Thing[p["¡¦???"]]["???¨¢??"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["¡¦???"]]["???¨¢??"]*10*fb - JY.Thing[p["¡¦???"]]["???¨¢??"]*(JY.Thing[p["¡¦???"]]["¡Á¡ã??????"]-1)*2*fb
			end
		end
		--?¡Á????????
		local level = 0
		local gj = 0
		local qg = 0
		local fy = 0
		local str1_gain, def1_gain, agi1_gain = psx(id,"???¡Â??"), psx(id,"¡¦?????"), psx(id,"?¨¢??")
		local str2_gain, def2_gain, agi2_gain = psx(id,"???¡Â??"), psx(id,"¡¦?????"), psx(id,"?¨¢??")
        --?????¡Â?????? 
        if JY.Status == GAME_WMAP then
			--for i = 0, WAR.PersonNum-1 do
				--if WAR.Person[i]["????????"] == id then
					str2_gain, def2_gain, agi2_gain = Atk(t),Def(t),Qg(t)
				--end
			--end	
			------------¡Á???????---------------
			gj = limitX((JY.Person[id]['????'] - JY.Person[id]['¡Á???']*10)/60,0)
			str1_gain = str1_gain + gj
			fy = limitX((JY.Person[id]['????'] - JY.Person[id]['¡Á???']*10)/60,0)
			def1_gain = def1_gain + fy
			qg = limitX((JY.Person[id]['????'] - JY.Person[id]['¡Á???']*10)/60,0)
			agi1_gain = agi1_gain + qg
			------------¡Á???????---------------
			for i =1,JY.Base["????????"] do               -- ?¨¦?????¡ã????????????????
				 if JY.Person[id]["????" .. i]==108 then
					if JY.Person[id]["????????" .. i] > 900 then
						level = 10
					else	
						level=math.modf(JY.Person[id]["????????" .. i] /100)+1;	
					end	
					if level >= 1 then
						gj = math.modf (JY.Person[id]["???¡Â??"]*0.03*(level))
						str1_gain = str1_gain +gj
						fy = math.modf(JY.Person[id]["¡¦?????"]*0.03*(level))
						def1_gain = def1_gain +fy
						qg = math.modf(JY.Person[id]["?¨¢??"]*0.03*(level))
						agi1_gain = agi1_gain +qg
						break
					end	
				end		
			end
			if match_ID(id, 9930) or match_ID(id,9738) then				--????????
				gj = math.modf(JY.Person[id]["???¡Â??"]*0.6)
				str1_gain = str1_gain +gj
				fy = math.modf(JY.Person[id]["¡¦?????"]*0.6)
				def1_gain = def1_gain +fy
				qg = math.modf(JY.Person[id]["?¨¢??"]*0.6)
				agi1_gain = agi1_gain +qg	
			end
			if match_ID(id, 604) or match_ID(id, 9805) then
				str1_gain = str1_gain + TrueYJ(id)
				def1_gain = def1_gain +TrueYJ(id)
			end
			--???????¨¦ ????????
			if Curr_NG(id,199) then
				local sz=math.modf(JY.Person[id]["????"]/2)
				if not inteam(id) then
					sz=100
				end
				str1_gain = str1_gain +sz
				def1_gain = def1_gain +sz
			end
			--??????????¡¦?????????????¡¦???????    
            if match_ID(id, 74) then
				local hqtgj= 0
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == WAR.Person[i]["??¡¦?"] then
                     str1_gain =  str1_gain +10
					 def1_gain =  def1_gain+10
                    end		
                end	
            end		 
            --??????¡¦?????????????¡¦???????    
            if match_ID(id, 508) then
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["????"] == false and WAR.Person[j]["??¡¦?"] == false  then
                    def1_gain =  def1_gain+10
                    str1_gain =  str1_gain +10
                    end		
                end	
            end
			-----------???¡Â????-----------
			--???????¡Â??????
			for i,v in pairs(CC.AddAtk) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
							str1_gain = str1_gain + v[3]
						end
					end
				end
			end
			if WAR.PD['????'][id] ~= nil then
				str1_gain = str1_gain + WAR.PD['????'][id]
			end
			if PersonKF(id,263) or NGQH(id,175) then
				if Curr_NG(id,263) then
					str1_gain = math.modf(str1_gain*1.1)
				else
					str1_gain = math.modf(str1_gain*1.05)
				end
			end	
			if match_ID(id, 112) and WAR.XYS > 0 then	--???????????????????¡Â*1.5
				str1_gain = math.modf(str1_gain*1.5)
			end
			if WAR.PD['?¡Â?????¡è?¨§??'][id] ~= nil then 
				str1_gain = math.modf(str1_gain*1.5)
			end
			---------------¡¦???????--------------
			--????¡¦?????????
			for i,v in pairs(CC.AddDef) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
							def1_gain = def1_gain + v[3]
						end
					end
				end
			end
			if PersonKF(id,264) or NGQH(id,175) then
				if Curr_NG(id,264) then
					def1_gain = math.modf(def1_gain*1.1)
				else
					def1_gain = math.modf(def1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--????????????????¡¦???*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end	
			if  WAR.PD['?¡Â?????¡è?¨§??'][id] ~= nil then	--????????????????¡¦???*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end
			-------------?¨¢??????--------------
			--?????¨¢??????
			for i,v in pairs(CC.AddSpd) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["????????"], v[2]) and WAR.Person[wid]["????"] == false then
							agi1_gain = agi1_gain + v[3] 
						end
					end
				end
			end	
			if WAR.YWDJ[id] ~= nil and Curr_QG(id, 186) then    --?????????????¨¢??
			   agi1_gain = agi1_gain + WAR.YWDJ[id]	
			end
			--?¨¢??????????
			if JY.Person[id]["?¡Â???¨¢??"] > 0 and JY.Person[id]["????¡¦??¡Á"] < 2 then
				qg = math.modf(JY.Person[id]["?¨¢??"]*0.3)
				agi1_gain = agi1_gain +qg
			elseif JY.Person[id]["?¡Â???¨¢??"] > 0 and JY.Person[id]["????¡¦??¡Á"] < 4 then
				qg = math.modf(JY.Person[id]["?¨¢??"]*0.15)
				agi1_gain = agi1_gain +qg
			end
			if PersonKF(id,259) or NGQH(id,175) then
				if Curr_NG(id,259) then
					agi1_gain = math.modf(agi1_gain*1.1)
				else
					agi1_gain = math.modf(agi1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--?????????????????¨¢??*1.5
				agi1_gain = math.modf(agi1_gain*1.5)
			end
			if WAR.PD['?¡Â?????¡è?¨§??'][id] ~= nil then 
				agi1_gain = math.modf(agi1_gain * 1.5)
			end
			if MPPD(id) == 20 or match_ID(id,514) then
				agi1_gain = math.modf(agi1_gain*2)
			end
		end
	if str1_gain ~= nil and str1_gain > 0 then
		str1_gain = limitX(str1_gain,0,999+JY.Base["????"])
	end	
    if def1_gain ~= nil and def1_gain > 0 then
		def1_gain = limitX(def1_gain,0,999+JY.Base["????"])
	end	
    if agi1_gain ~= nil and agi1_gain > 0 then
		agi1_gain = limitX(agi1_gain,0,999+JY.Base["????"])
	end
   --¡Á¡ã??????
	local pyl = -40
	lib.LoadPNG(91,166*2,bx*450+pyl,by*470,1)
   
	if p["???¡Â"] > -1 then
		lib.PicLoadCache(2,p["???¡Â"] * 2,bx*450+pyl,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl,by*470,1)
		DrawString(bx*450+pyl,by*470, "LV"..JY.Thing[p["???¡Â"]]["¡Á¡ã??????"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl,by*470+75, JY.Thing[p["???¡Â"]]["????"],C_RED , size*0.5)

	end
	if p["¡¦???"] > -1 then
		lib.PicLoadCache(2,p["¡¦???"] * 2,bx*450+pyl+75,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+75,by*470,1)
		DrawString( bx*450+pyl+78,by*470, "LV"..JY.Thing[p["¡¦???"]]["¡Á¡ã??????"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+78,by*470+75, JY.Thing[p["¡¦???"]]["????"], C_ORANGE, size*0.5)
	end		
	if p["¡Á???"] > -1 then
		lib.PicLoadCache(2,p["¡Á???"] * 2,bx*450+pyl+150,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+150,by*470,1)
		DrawString( bx*450+pyl+154,by*470, "LV"..JY.Thing[p["¡Á???"]]["¡Á¡ã??????"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+154,by*470+75, JY.Thing[p["¡Á???"]]["????"], M_Yellow, size*0.5)
	end
	--?¡Á¡Á¡ã????
	if (p["???¡Â"] > -1 and p["¡¦???"] > -1 and p["¡Á???"] > -1) then
		if p["¡¦???"]==p["???¡Â"]+1 and p["¡Á???"]==p["???¡Â"]+2 then
			local color = C_RED
			local n = Setmeal[p["???¡Â"]][4]
			if  n==4 or n==7 or n==15 or n==16 or n==2 then
				color = C_ORANGE
			elseif n==21 or n==22 or n==24 or n==26 then
				color = M_DeepSkyBlue
			elseif n==1 or n==3 then
				color = M_Green
			end
			--local n= #ItemInfo[p["???¡Â"]]
			--say("??¡Á¨¦?¡è??"..#ItemInfo[p["???¡Â"]],0,1)
			DrawString( bx*450+pyl,by*470+90, string.sub(ItemInfo[p["???¡Â"]][3], 3 , 12), C_GOLD, size*0.7)
			--tjm(bx*450+pyl,by*470+20+100,"?????¡ì??"..Xguo[Setmeal[p["???¡Â"]][4]]..'*'.."?????¡ì??"..FJXguo[Setmeal[p["???¡Â"]][5]].."*".."?????¡ì??"..ZqXguo[Setmeal[p["???¡Â"]][6]].."*".."??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_GOLD,size*0.5,14,size*0.5)
			if n < 5 and n ~= 0 then
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n >= 5 then
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 7 then
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 9 then
				--DrawString( diyx/5+ax*8-240, diyy/4+ax*3+200+40-20,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2], C_RED, size*0.5)
				DrawString(bx*450+pyl,by*470+20+100, "??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..Xguo[Setmeal[p["???¡Â"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..FJXguo[Setmeal[p["???¡Â"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"??"..string.sub(ItemInfo[p["???¡Â"]][4]..":"..ZqXguo[Setmeal[p["???¡Â"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"??"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][1]..":"..CC.PTFSM[Setmeal[p["???¡Â"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2, string.sub(ItemInfo[p["???¡Â"]][5], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+20,string.sub(ItemInfo[p["???¡Â"]][7], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+40, string.sub(ItemInfo[p["???¡Â"]][9], 5 , -1), M_YellowGreen, size*0.5)
		end
	end
   
   
   
   i = 0
   --local wgbh = {'?¨½','?¨¾','?¨®','??','??','??','?¡Â','??','??','?¨²','??','?¨¹','?¨²?¨®','?¨²??','?¨²??'}
   --???????¡ì
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,2,180,nil,bx*180)
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,1)
   for k = 1,JY.Base["????????"]  do 
       if psx(id,'????'..k) > 0 and JY.Wugong[psx(id,'????'..k)]['????????'] < 6 then
		----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
	      local lv = limitX(math.modf(psx(id,'????????'..k)/100),1)+1
		  local lx = JY.Wugong[psx(id,'????'..k)]['????????']
		  -- lib.LoadPNG(91,(lv+74)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
		  -- lib.LoadPNG(91,(lx+149)*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  	local color = C_WHITE
	  	if wgnlxz(psx(id,'????'..k)) == 0 then
			color = LightPurple
		elseif wgnlxz(psx(id,'????'..k)) == 1 then
			color = C_GOLD
		end	
	  	if psx(id,'????????'..k) > 900 then
			lib.LoadPNG(91,167*2,bx*660+size1*6,by*60+i*h,1)
		else	
		 	lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h,1)
		end 
		 lib.LoadPNG(91,(lx+74)*2,bx*660+size1*6+bx*50,by*60+i*h,1)
		 DrawString(bx*660,by*60+i*h,k,C_WHITE,size1)
          DrawString(bx*670,by*60+i*h,JY.Wugong[psx(id,'????'..k)]['????'],color,size1)
		  i = i + 1
		  lb[2][#lb[2]+1] ={ psx(id,'????'..k),k}
	   end
   end
   -- if psx(id,'¡Á¨®??????') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'¡Á¨®??????')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'¡Á¨®??????',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '¡Á¨®??????'
	  
   -- end 
   -- if psx(id,'?¡¦¡Á?') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'?¡¦¡Á?????')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'?¡¦¡Á?????',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '?¡¦¡Á?'
   -- end 
   
   if #lb[2] > 0 then 
      lb1[#lb1+1] = 2
	  --lb2[2] = lb2[1] + 1
	  lb2[2] = #lb1
   end
   
   i = 0
   --????????????
   for k = 1,JY.Base["????????"] do 
       if psx(id,'????'..k) > 0 and JY.Wugong[psx(id,'????'..k)]['????????'] > 5 then 
		--JY.Wugong[JY.Person[id]["????" .. i]]["????????"]
	      --local lv = limitX(math.modf(psx(id,CC.Psx[k])/25),1)
		  --lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
		  local lv = limitX(math.modf(psx(id,'????????'..k)/100),1)+1
		  local lx = JY.Wugong[psx(id,'????'..k)]['????????']
		  -- lib.LoadPNG(91,(lv+74)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
		  -- lib.LoadPNG(91,(lx+149)*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  	local color = C_WHITE
	  	if wgnlxz(psx(id,'????'..k)) == 0 then
			color = LightPurple
		elseif wgnlxz(psx(id,'????'..k)) == 1 then
			color = C_GOLD
		end	
		  if psx(id,'????????'..k) > 900 then
			lib.LoadPNG(91,167*2,bx*900+size1*6,by*60+i*h,1)
		else	
		 lib.LoadPNG(91,(lv+149)*2,bx*900+size1*6,by*60+i*h,1)
		end
		  --lib.LoadPNG(91,(lv+149)*2,bx*900+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
		  lib.LoadPNG(91,(lx+74)*2,bx*900+size1*6+bx*50,by*60+i*h,1)
		  -- if k <= 7 then
		    -- -- lib.LoadPNG(91,(k+41)*2,bx*900+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
			 -- lib.LoadPNG(91,(k+41)*2,bx*900+size1*6+bx*50,by*60+i*h+size1/2,1)
		  -- end	 
          DrawString(bx*900,by*60+i*h,k,C_WHITE,size1)
          DrawString(bx*910,by*60+i*h,JY.Wugong[psx(id,'????'..k)]['????'],color,size1)
		  i = i + 1
		  lb[3][#lb[3]+1] ={ psx(id,'????'..k),k}
	   end
   end

   if lb[3]~=nil and #lb[3] > 0 then
      lb1[#lb1+1] = 3
	  --lb2[3] = lb2[2] + 1
	  lb2[3] = #lb1
   end
   
   lb1[#lb1+1] = 4
   --lb2[4] = lb2[3] + 1
   lb2[4] = #lb1
   lb1[#lb1+1] = 5
   lb2[5] = #lb1
   --lb2[5] = lb2[4] + 1
   --????????
   i = 0
   local yg = {{'????????',1,'????'},{'?¡Â??????',2,'????'},{'????????1',3,'????'},{'?¡Â???¨¢??',4,'?¨¢??'},}
   -- if psx(id,'¡Á¨®??????') == 0 then 
	  -- table.remove(yg,2)
   -- end
   for k = 1,#yg do 
	   local cl =C_GOLD
	   local str = ''
       --if yg[k][2] == 1 then
	   ----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
	    --  lib.LoadPNG(91,160*2,bx*1242,by*60+i*by*48+by*18,1)
		  lib.LoadPNG(91,160*2,bx*1125+size1,by*60+i*bx*48+bx*18-size1,1)
		  if psx(id,yg[k][1]) > 0 then 
		     str = JY.Wugong[psx(id,yg[k][1])]['????']
		  else 
		     str = '??'..yg[k][3]
			 cl =  C_WHITE
		  end
	      if lb1[cx1] == 4 and page == 2 then 
	         if cx == k then 
		        cl = C_RED
		     end
	      end
		  --DrawString(bx*935-string.len('??????????????')/4*size,by*136-size/2,'??????????????',C_WHITE,size)
		  DrawString(bx*1233+size1-string.len(str)/4*size1,by*60+i*bx*48+bx*18-size1/2-bx*3,str,cl,size1)
		  i = i + 1
		  lb[4][#lb[4]+1] = yg[k][1]
	   --end
   end
   -- lb[4][#lb[4]+1] = '????'
   -- lib.LoadPNG(91,160*2,bx*1242,by*60+i*bx*48+bx*18,2,240,nil,bx*200)
   -- -- if lb1[cx1] == 4 and cx == #lb[4] and page == 2 then
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'??????????'..psx(id,'????'),C_RED,size1)
   -- -- else 
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'??????????'..psx(id,'????'),C_WHITE,size1)
   -- -- end
   
   -- lb[5] = {'???¡Â','¡¦???','?¡¦??','???¡¦','??¡Á?'}
   -- --????¡Á¡ã??
   -- i = 0
   -- for k = 1,#lb[5] do 
       -- lib.LoadPNG(91,160*2,bx*522,by*470+i*by*48+by*18,2,240,nil,bx*200)
	   -- local cl = C_WHITE
	   -- local str = ''
	   -- if psx(id,lb[5][k]) > 0 then 
	      -- str = JY.Thing[psx(id,lb[5][k])]['????']
	   -- else 
	      -- str = '??'..lb[5][k]
		  -- cl = C_GOLD
	   -- end
	   -- if lb1[cx1] == 5 then 
	      -- if cx == k then 
		     -- cl = C_RED
		  -- end
	   -- end
	   -- DrawString(bx*420+size1,by*470+i*bx*48+bx*18-size1/2,str,cl,size1)
	   -- i = i + 1
   -- end
	local bonus_q,bonus_z,bonus_j,bonus_d,bonus_t = psx(id,"??????¡¦¨¾"),psx(id,"??¡¦¡§????"),psx(id,"????????"),psx(id,"????????"),psx(id,"???????¡Â")
		
   
   --???? ???? ????
	local jqz = 0
	local jqz0 = 8
	local jqz1 = 0
	local jqz3 = 0
	local x = JY.Person[id]["?¨¢??"]
	local jqz2 = 0
    local y = JY.Person[id]["????"]	
	--local x3 = dx*427
	--local y3 = y1
	-- DrawString(x3 , y3,p["???¡ì????"], C_CYGOLD, size*0.7)
     -- if p["????"] >= 500 then
			-- DrawString(x3, y3+dh, string.format("%s", "??"), C_RED, size*0.7)
		-- else
			-- DrawString(x3, y3+dh, string.format("%s", p["????"]), C_CYGOLD, size*0.7)
		-- end	
	--??????
	
	local function getnewmove(x)
		if x <= 0 then 
			return 0
		end
		return math.sqrt(x)
	end
	--?????????????????????????????¡ã?¨§????
	local function getnewmove1(a, b)
		local x = (a*2+b)/3
		if x > 6000 then
			return 8 + math.min((x-6000)/1500, 2)
		elseif x > 4000 then
			return 6 + (x-4000)/1200
		elseif x > 2000 then
			return 4 + (x-2000)/1000
		elseif x > 1000 then
			return 2 + (x-1000)/800
		else
			return x/400
		end
	end

	--?????¨¢??
	local function Qg1(i)

		id = i
		
		local qg = 0 
		
		qg = qg + JY.Person[id]['?¨¢??']
		
		for i =1,JY.Base["????????"] do  
			local level = 0            
			if JY.Person[id]["????" .. i]==108 then
				level = math.modf(JY.Person[id]["????????" .. i]/100)+1;
				level = limitX(level/10,0,1)
				qg = qg + math.modf(JY.Person[id]["?¨¢??"]*0.3*level)	
				break
			end
		end
		
		return qg
	end
	
	jqz = (getnewmove(Qg1(id)) + getnewmove1(JY.Person[id]["????"], JY.Person[id]["????¡Á??¨®??"]) + JY.Person[id]["????"] / 30)
	
	if JY.Status == GAME_WMAP then
		jqz = (WAR.JQSDXS[id] or 0)
	else	
		jqz = math.modf(jqz)
	end	
   
   
   local cl = M_DeepSkyBlue
   local strcl = '(????)'
   if JY.Person[id]["????????"] == 0 then
		cl = M_DeepSkyBlue
		strcl = '(????)'
   elseif JY.Person[id]["????????"] == 1 then
		cl = C_ORANGE
		strcl = '(????)'
   elseif JY.Person[id]["????????"] == 2 then
		cl = C_CYGOLD
		strcl = '(?¡Â??)'
   elseif JY.Person[id]["????????"] == 3 then
		cl = C_RED
		strcl = '(?¨§??)'
   end
   --????????1
   --local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
  -- if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
  -- if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
 
   i = 0 
   DrawString(bx*660,by*475,'?¨²?¨¹?????? '..psx(id,'?¨²?¨¹'),M_PaleGreen,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?????????? '..psx(id,'????')..strcl,cl,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'???????¨¦?? '..p["????"],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'???¡ì?????? '..p['???¡ì????'],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?????????? '..nk.."%",C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?????????? '..dk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¡Á????????? '..hk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??¡¦??????? '..bk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'?¡Â???????? '..xk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¡¦??¡§?????? '..fk.."%",C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'???¨¦????'..string.format('%9s',psx(id,'???????¨¦')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'????????'..string.format('%9s',psx(id,'???¡ì????')),C_WHITE,size1)
   -- i = i + 1
   --????????1
   --[[????????1
   i = 0 
   DrawString(bx*660,by*475,'?¨²?¨¹??????'..string.format('%5s',psx(id,'?¨²?¨¹')),M_PaleGreen,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????'))..strcl,cl,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'???¡Â????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',psx(id,'????????')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',p["???¡ì????"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',p["????"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'??????????'..string.format('%5s',jqz),C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'???¨¦????'..string.format('%9s',psx(id,'???????¨¦')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'????????'..string.format('%9s',psx(id,'???¡ì????')),C_WHITE,size1)
   -- i = i + 1
   --????????1]]
   
   
	i = 0 
	DrawString(bx*900,by*475,'¡Á??¨®?¨²?¨¹?? '..psx(id,'?¨²?¨¹¡Á??¨®??'),M_PaleGreen,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'¡Á??¨®?????? '..psx(id,'????¡Á??¨®??')..strcl,cl,size1)--string.format('%5s',)
	--i = i + 1--p["??????¡¦¨¾"]+
	--DrawString(bx*900,by*475+i*h,'??????¡¦¨¾??'..bonus_q,M_YellowGreen,size1)--string.format('%5s',)   ?¨¹
	if JY.Status == GAME_WMAP then
		--DrawAttrib("??????¡¦¨¾", bx*890+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["??????¡¦¨¾"]+
		DrawString(bx*900,by*475+i*h,'??????¡¦¨¾?? '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)--..' ?¨¹ '..TrueQZ(id)-bonus_q
		DrawAttrib("??????¡¦¨¾", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["??¡¦¡§????"]+
		DrawString(bx*900,by*475+i*h,'??¡¦¡§?????? '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("??¡¦¡§????", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("????????", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("????????", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["???????¡Â"]+
		DrawString(bx*900,by*475+i*h,'???????¡Â?? '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("???????¡Â", bx*900+150,by*475+i*h,M_YellowGreen,size1)
	else
		i = i + 1--p["??????¡¦¨¾"]+
		DrawString(bx*900,by*475+i*h,'??????¡¦¨¾?? '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["??¡¦¡§????"]+
		DrawString(bx*900,by*475+i*h,'??¡¦¡§?????? '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["????????"]+
		DrawString(bx*900,by*475+i*h,'?????????? '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["???????¡Â"]+
		DrawString(bx*900,by*475+i*h,'???????¡Â?? '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
	end	
	--[[i = i + 1--p["??¡¦¡§????"]+
	DrawString(bx*900,by*475+i*h,'??¡¦¡§??????'..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		 DrawAttrib("??¡¦¡§????", bx*880+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["????????"]+
	DrawString(bx*900,by*475+i*h,'??????????'..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("????????", bx*870+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["????????"]+
	DrawString(bx*900,by*475+i*h,'??????????'..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("????????", bx*860+150,by*475+i*h,M_YellowGreen,size1)
	end
   
	i = i + 1--p["???????¡Â"]+
	DrawString(bx*900,by*475+i*h,'???????¡Â??'..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
    if JY.Status == GAME_WMAP then
		DrawAttrib("???????¡Â", bx*850+150,by*475+i*h,M_YellowGreen,size1)
	end]]
  
	i = i + 1
 -- DrawString(bx*900,by*475+i*h,'¡ã??¡Â??????'..string.format('%5s',p["¡ã??¡Â????"]),C_WHITE,size1)
	if p["????????2"] > 0 then
		local str = ""
		if p["????????2"] == 458 then
			str = "(????)"
		end	
		if p["????????2"] == 450 then
			str = "(???¡§)"
		end	
		if p["????????2"] == 459 then
			str = "(?¨²??¡¦?)"
		end	
		if p["????????2"] == 460 then
			str = "(????)"
		end
		if p["????????2"] == 469 then
			str = "(????)"
		end	
		if p["????????2"] == 486 then
			str = "(????)"
		end
		if p["????????2"] == 489 then
			str = "(????)"
		end
		if p["????????2"] == 490 then
			str = "(????)"
		end
		DrawString(bx*900,by*475+i*h,'¡ã??¡Â??¡¦¡§?? '..p["¡ã??¡Â????"]..str,M_Orange,size1)--string.format('%5s',)
	else
		DrawString(bx*900,by*475+i*h,'¡ã??¡Â??¡¦¡§?? '..p["¡ã??¡Â????"],M_Orange,size1)--string.format('%5s',)
	end
  
	i = i + 1
	DrawString(bx*900,by*475+i*h,'????¡Á????? '..p["¡Á???"],M_Red,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'?????????? '..p["?¨²?¨¹???¡è"] + limitX(math.modf(p['????????5'] *0.01),0,8),M_Red,size1)--string.format('%5s',)
	i = i + 1
   
   -- DrawString(bx*900,by*475+i*h,'??????????'..string.format('%5s',p["???¡ì????"]),C_WHITE,size1)
   -- i = i + 1
	local zyhb = nil
	if ZYHBPD(id) >= 1 then
		if ZYHBPD(id) == 2 then
			zyhb  = "????"
		else
			zyhb  = "?¨¾"
		end	
	else
		zyhb  = "??"
	end
	
      local zyzd = nil	
	if ZhongYongZD1(id) or ZhongYongZD2(id) then
		if JY.Person[id]["????"] == 3 then
			zyzd  = "?¨§??"
		else
			zyzd  = "?¨¾"
		end	
	else
		zyzd  = "??"
	end		
	
    local mrdz = nil	
	if MuRongDZ(id) == true  then
		if JY.Person[id]["????????3"] == 2 then
			mrdz  = "????"
		else
			mrdz  = "?¨¾"
		end
	else
		mrdz  = "??"
	end		
	
	local xshm = nil	
	if JY.Person[id]['????????4'] > 0 then
		if JY.Person[id]["????????4"] == 1001 then
			xshm  = "?¡è??"
		else
			xshm  = JY.Person[id]['????????4']
		end
	else
		xshm  = "??"
	end	
	local yjmc = nil
	if JY.Person[id]['????????5'] > 0 then
		if JY.Person[id]['????????5'] == 801 then
			yjmc = '????'
		elseif JY.Person[id]['????????5'] > 400 and JY.Person[id]['????????5'] < 801 then
			yjmc = '????'
		else
			yjmc = '???¡ì'
		end
	else
		yjmc = "??"	
	end
   
   --????????2
	i = 0
	DrawString(bx*1140,by*475,'???¡Â?????? '..str2_gain,M_Yellow,size1)
	if str_gain > 0 then
		DrawString(bx*1140+120,by*475,"?? ?¨¹ "..str_gain,M_Yellow,size1)
	end	
	i = i + 1
	--DrawString(bx*1140,by*475+i*h,'¡¦???????????'..string.format('%5s %2s %2s',def2_gain,"?¨¹",def_gain),M_Yellow,size1)
	DrawString(bx*1140,by*475+i*h,'¡¦????????? '..def2_gain,M_Yellow,size1)
	if def_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"?? ?¨¹ "..def_gain,M_Yellow,size1)
	end	
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?¨¢???¨ª¡¦¡§?? '..agi2_gain,M_Yellow,size1)
	if agi_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"?? ?¨¹ "..agi_gain,M_Yellow,size1)
	end	
  --DrawString(bx*1140,by*475+i*h,'?¨¢????????'..string.format('%5s %2s %2s',p["?¨¢??"],"?¨¹",agi1_gain),M_Yellow,size1)
	--[[if agi_gain > -1 then
		DrawString(bx*1140,by*475+i*h,'?¨¢??????????'..string.format('%5s %2s %2s',agi2_gain,"?¨¹",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	else
		agi_gain = -(agi_gain)
		DrawString(bx*1140,by*475+i*h,'?¨¢????????'..string.format('%5s %2s %2s',agi2_gain,"??",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	end]]

	i = i + 1
	if p["????????6"] > 0 then
		local str = ""
		if p["????????6"] == 187 then
			str = "(¡Á???)"
		end	
		if p["????????6"] == 188 then
			str = "(????)"
		end	
		if p["????????6"] == 189 then
			str = "(????)"
		end	
		if p["????????6"] == 190 then
			str = "(?¡ì??)"
		end
		if p["????????6"] == 191 then
			str = "(????)"
		end
		DrawString(bx*1140,by*475+i*h,'?????????? '..psx(id,'????????')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'?????????? '..psx(id,'????????'),M_PaleGreen,size1)
	end
	i = i + 1
	if p["????????6"] > 0 then
		local str = ""
		if p["????????6"] == 192 then
			str = "(????)"
		end	
		DrawString(bx*1140,by*475+i*h,'?????¨§???? '..psx(id,'????????')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'?????¨§???? '..psx(id,'????????'),M_PaleGreen,size1)
	end
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'¡Á¨®???????? '..zyhb,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?????????? '..zyzd,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?¡¦¡Á??????? '..mrdz,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?????????? '..xshm,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'?¡è?¡è?????? '..yjmc,M_LightBlue,size1)
	
   
   
   
   
   
   DrawString(bx*1140,by*475-160, "????", C_CYGOLD, size*0.7)
	local thingid = p["???????¡¦"]
		if thingid > 0 then
			--lib.PicLoadCache(2, p["???????¡¦"] * 2, x1 + size*4, y1*19+96-100, 1)
            DrawString(bx*1140,by*475-140, JY.Thing[thingid]["????"], M_DeepSkyBlue, size*0.7)			
			i = i + 1
			local n = TrainNeedExp(id)
			if n < math.huge then
				DrawString(bx*1140,by*475-120, string.format("%5d/%5d", p["????????"], n), C_CYGOLD, size*0.7)
			else
				DrawString(bx*1140,by*475-120, string.format("%5d/===", p["????????"]), C_CYGOLD, size*0.7)
			end
		else


	  --???¨¦??
	  ---i = i + 1
		--DrawString(x1-130, y1 + 12*h * (i)-40, "????", C_CYGOLD, size*0.8)
		local kk = nil
		if p["????"] >= 30 then
			kk = "   ="
		else
			p["????"] = limitX(p["????"],1,30)
			kk = 2 * (p["???¨¦"] - CC.Exp[p["????"] - 1])
			if kk < 0 then
				kk = "  0"
			elseif kk < 10 then
				kk = "   " .. kk
			elseif kk < 100 then
				kk = "  " .. kk
			elseif kk < 1000 then
				kk = " " .. kk
			end
		end		
		
		
		
		--????
	--	DrawString(dx*189, dy*390, kk, C_CYGOLD, size*0.8)
	--	local tmp = nil
	--	if CC.Level <= p["????"] then
	--		tmp = "="
	--	else
	--		tmp = 2 * (CC.Exp[p["????"]] - CC.Exp[p["????"] - 1])
	--	end
	--	DrawString(dx*209, dy*390, "/" .. tmp, C_CYGOLD, size*0.8)
	end
   --?¨²?¨¹?????¨®??
	local ww = bx*78
	--local h = bx*7
	--?¨²?¨¹¡Á???
	local x1,y1 = bx*200,bx*640
	--????¡Á???
	local x2,y2 = bx*200,bx*658
	--?¨²?¨¹
	local sm = JY.Person[id]['?¨²?¨¹']
	--????
	local nl = JY.Person[id]['????']
	--¡Á??¨®?¨²?¨¹
	local smmax = JY.Person[id]['?¨²?¨¹¡Á??¨®??']
	--¡Á??¨®????
	local nlmax = JY.Person[id]['????¡Á??¨®??']
	lib.LoadPNG(91, 35*2, x1, y1, 2)
	lib.LoadPNG(91, 35*2, x2, y2, 2)
	--?¨²?¨¹??
	lib.SetClip(x1-ww,y1-bx*7,(x1-ww)+(ww*2)*(sm/smmax),y1+bx*7)
	lib.LoadPNG(91, 31*2, x1, y1, 2)
	
	lib.SetClip(0,0,0,0)
	--??????
	lib.SetClip(x2-ww,y2-bx*7,(x2-ww)+(ww*2)*(nl/nlmax),y2+bx*7)
	lib.LoadPNG(91, 32*2, x2, y2, 2)
	
	lib.SetClip(0,0,0,0)
	-- --????????
	-- local sx = {'??','??','?¡Â??','?¨§??'}
	-- --????????
	-- local nlsx = sx[JY.Person[0]['????????']+1]
	local cl = M_DeepSkyBlue
   local strcl = '????'
   if JY.Person[id]["????????"] == 0 then
		cl = M_DeepSkyBlue
		strcl = '????'
   elseif JY.Person[id]["????????"] == 1 then
		cl = C_ORANGE
		strcl = '????'
   elseif JY.Person[id]["????????"] == 2 then
		cl = C_CYGOLD
		strcl = '?¡Â??'
   elseif JY.Person[id]["????????"] == 3 then
		cl = C_RED
		strcl = '?¨§??'
   end
	
	--?¨²?¨¹??¡Á?
	local smwz = sm..'/'..smmax
	--??????¡Á?
	local nlwz = nl..'/'..nlmax--..'?¡§'..strcl..'??'
	
	--?¨²?¨¹
	DrawString(x1-string.len(smwz)/4*size2,y1-size2/2,smwz,C_WHITE,size2)
	--????
	DrawString(x2-string.len(nlwz)/4*size2,y2-size2/2,nlwz,cl,size2)
   
   
   
   i = 0
   local hh = 60
   local wh = lb1[cx1]
   if lb1[cx1] ~=nil and lb1[cx1] > 4 then 
      hh = 475
	  wh = 1
   end
   if page == 2 then
	if lb1[cx1] < 4 then
		--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
	    lib.LoadPNG(91,162*2,bx*420+bx*240*(wh-1)+bx*70-bx*70,by*hh+by*25/2+cx*h-h-by*15,1)
		if lb1[cx1] == 2 then
			local wz = 100
			local jg = 0
			local lv = math.modf(JY.Person[id]["????????" .. lb[2][cx][2]]/100)+1;
			local kungfuatk = get_skill_power(id, JY.Person[id]["????" .. lb[2][cx][2]], lv)
			lib.LoadPNG(91,161*2,0,0,1)
			--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
			--say("????????"..lb[lb1[cx1]][cx][1],0,1)
			local name = JY.Wugong[JY.Person[id]["????" .. lb[2][cx][2]]]['????']
	        DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'????'..lb[2][cx][2],M_YellowGreen,size2)
			--???????¡Â¡¦??¡ì????
		    DrawString(bx*50,by*80,'???¡Â¡¦??¡ì',C_BLACK,size)
			
			--DrawString(bx*200,by*80,'????:'..lb[2][cx][2],M_YellowGreen,size)
			
		    tjm30(id,lb[lb1[cx1]][cx][1],bx*50,by*90+size)
			
			  DrawString(bx*50,by*270+wz*by,'????????',C_BLACK,size)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
		      DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["????" .. lb[2][cx][2]], 11).."(¡Á??¨®????)",C_ORANGE,size)
			
			
			DrawString(bx*50,by*270+wz*by+(by*40+size),'????????',C_RED,size)
		    local wgid = JY.Person[id]["????" .. lb[2][cx][2]]
			if CC.KFMove[wgid] ~= nil then
				for i=1 ,#CC.KFMove[wgid] do 
					DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   ????: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
				end
			--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
			end
			
			--JY.Person[id]["????????" .. i]
			--JY.Person[pid]["????" .. lb[2][cx][2]]
			-- lb[2][#lb[2]+1] ={ psx(id,'????'..k),k}
			--lb[2][cx][1]
			--????????????
		elseif lb1[cx1] == 3 then
			lib.LoadPNG(91,161*2,0,0,1)
			local name = JY.Wugong[JY.Person[id]["????" .. lb[3][cx][2]]]['????']
			DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'????'..lb[3][cx][2],M_YellowGreen,size2)
			--DrawString(bx*200,by*80,'????:'..lb[3][cx][2],M_YellowGreen,size)
			if JY.Wugong[JY.Person[id]["????" .. lb[3][cx][2]]]['????????'] == 6 then
				local wz = 100
				local jg = 0
				local lv = math.modf(JY.Person[id]["????????" .. lb[3][cx][2]]/100)+1;
				local kungfuatk = get_skill_power(id, JY.Person[id]["????" .. lb[3][cx][2]], lv)
				--lib.LoadPNG(91,161*2,0,0,1)
				--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
				--say("????????"..lb[lb1[cx1]][cx][1],0,1)
				
				
				--???????¡Â¡¦??¡ì????
				DrawString(bx*50,by*80,'???¡Â¡¦??¡ì',C_BLACK,size)
				
				tjm30(id,lb[lb1[cx1]][cx][1],bx*50,by*90+size)
				DrawString(bx*50,by*270+wz*by,'????????',C_BLACK,size)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
				DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["????" .. lb[3][cx][2]], 11).."(¡Á??¨®????)",C_ORANGE,size)
			
				-- --????????????
				--DrawString(bx*50,by*270+wz*by+(by*40+size),'????????',C_RED,size)
				--local wgid = JY.Person[id]["????" .. lb[3][cx][2]]
				--[[if CC.KFMove[wgid] ~= nil then
					for i=1 ,#CC.KFMove[wgid] do 
						DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   ????: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
					end
				--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
				end	]]										
			
			end
		elseif lb1[cx1] == 1 and cx > 4 then
			lib.LoadPNG(91,161*2,0,0,1)
			local name = lb[1][cx]
			tjm(bx*50,by*10,name,M_Yellow,size)
			if cx == 5 then --tfjswz = [#tfjswz+1] = tfstr
				--for j = 1, #tfjswz1 do
					local tfstr = tfjswz1[mid]
					if mid == 0 and JY.Base['??¡Á?'] > 0 then
						tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
					else
						tfstr = tfjswz1[mid]
						if tfstr == nil then
							tfstr = '?¡Á???????¨§???¨¦??'
						end
						tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
					--	tjm(bx*50,by*80,tfstr,C_BLACK,size*0.7,14,h+10)
					end	
				--end
			--elseif cx == 6 and (match_ID(id,26) or match_ID(id,592) or match_ID(id,577)) then
				
			else
				--for j = 1, #tfjswz do
					local tfstr = tfjswz[cx-5]
					if cx == 6 and (match_ID(id,26) or match_ID(id,592) or match_ID(id,577)) then
						tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
					else	
					--	tfstr = tfjswz1[j]
						tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
					end	
				--end
			end	
			--DrawString
			--DrawString(bx*300,by*12,'????'..lb[3][cx][2],M_YellowGreen,size2)
			--DrawString(bx*200,by*80,'????:'..lb[3][cx][2],M_YellowGreen,size)
			--for j = 1, #bossztwz do
				--local tfstr = bossztwz[j]
				--tjm(bx*50,by*80,tfstr,C_BLACK,size,10,h+10)
			--end	
		    --DrawString(bx*50,by*270+wz*by+(by*40+size),'????????',C_RED,size)
		end
	end
    
   end
	
   ShowScreen()
   local X,ktype,mx,my = lib.GetKey()
   if X == VK_SPACE or X == VK_RETURN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 1 then
			 page = 2		 
		  elseif page == 2 then 
			 if lb1[cx1] == 5 then
			 --   Personzb(id,cx)
			 elseif lb1[cx1] == 4 then	
				-- if cx == #lb[4] then 
				-- --  Menu_Jiali(id)
				-- --	say("????????1"..cx,0,1)
					-- Menu_Gongti(id,yg[cx][2])
				-- else 
				  -- Menu_Gongti(id,yg[cx][2])
				-- end
			 elseif lb1[cx1] == 3 then	
				--detailed_info(cur_thing)
				if cx <= #lb[3] then
					--say("??????????"..lb[3][cx][1],0,1)
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --???????¡¦
						if JY.Thing[j]["?¡¦??????"] >= 0 and JY.Thing[j]["?¡¦??????"] == lb[3][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 2 then
				if cx <= #lb[2] then
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --???????¡¦
						if JY.Thing[j]["?¡¦??????"] >= 0 and JY.Thing[j]["?¡¦??????"] == lb[2][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 1 then
				-- if cx >= 5 then 
				-- --  Menu_Jiali(id)
				-- --say("????????1"..cx,0,1)
					-- --Menu_Gongti(id,yg[cx][2])
					-- --lib.LoadPNG(91,165*2,bx*500,by*46+(cx*15),1)
					-- lib.LoadPNG(91,161*2,0,0,1)
					-- --local name = JY.Wugong[JY.Person[id]["????" .. lb[3][cx][2]]]['????']
					-- --DrawString(bx*50,by*12,name,M_Yellow,size)
					-- --DrawString(bx*300,by*12,'????'..lb[3][cx][2],M_YellowGreen,size2)
					-- --DrawString(bx*200,by*80,'????:'..lb[3][cx][2],M_YellowGreen,size)
					-- --for j = 1, #bossztwz do
						-- --local tfstr = bossztwz[j]
						-- --tjm(bx*50,by*80,tfstr,C_BLACK,size,10,h+10)
					-- --end	
					-- --for k = 1, tfjsbh do
						-- local n = 0
						-- local tfstr = tfjswz[cx-n] --= tfstr
						-- --local tfstr1 = tfjswz[cx-n] --= tfstr
						-- local h1 = 0
						-- if cx == 5 then
							-- --n = 5
							-- for j = 1 ,#tfjswz1 do
							-- tfstr = tfjswz1[j]
							-- tjm(bx*50,by*40+j*60,tfstr,C_BLACK,size*0.6,12,h+3)
							-- --tjm(bx*550,by*46+(cx*15)+j*20,tfstr,C_WHITE,size1,math.floor(bx*350/(size1)*0.8)+15,h+10)
							-- end
						-- --	say("¡Á¡§???¨§??",0,1)
						-- else
							-- n = 5
							-- tfstr = tfjswz[cx-n]
							-- tjm(bx*50,by*80,tfstr,C_BLACK,size,8,h+10)
							-- --tjm(bx*550,by*46+(cx*15),tfstr,C_WHITE,size*0.8,math.floor(bx*350/(size)*0.8)+2,h+10)
						-- end
						
						
						-- --if string.sub(tfstr,1,2) == '?¡Á'  then
						-- --	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
						-- --	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
							-- --tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
							-- --row = row + 1
							-- --DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
						
						-- -- tjm(bx*550,by*46+(cx*15),tfstr,C_WHITE,size*0.8,math.floor(bx*350/(size)*0.8)+2,h+10)
							-- --DrawString(bx*935-string.len(tfstr)/4*size,by*136-size/2,tfstr,C_WHITE,size)
							-- --h1=--tfstr = tfstr .. "??"
						-- --	i = i + 1
							-- --lb[1][#lb[1]+1] = tfstr
						-- --end
						-- --row = row + 1
						-- --i = i + 0.33
					-- --end
					
					-- --DrawString(bx*935-string.len('??????????????')/4*size,by*136-size/2,'??????????????',C_WHITE,size)
					-- ShowScreen()
					-- WaitKey()
				-- else 
				  -- --Menu_Gongti(id,yg[cx][2])
				-- end
			 end
		  end
	  --end
   elseif X == VK_ESCAPE or ktype == 4 then 
      if page == 2 then 
	     page = page - 1 
		 cx = 1 
		 cx1 = 1
	  else 	 
         break
	  end
	  fy = 0
   elseif X == VK_UP then
	  --page2???????????¨½
	  --if JY.Status ~= GAME_WMAP then
		if page == 2 then 
			cx = cx - 1
			if cx < 1 then
				cx = #lb[lb1[cx1]]
			end	
			
		end
		fy = 0
	 -- end
   elseif X == VK_DOWN then
	  --page2???????????¨½
	 -- if JY.Status ~= GAME_WMAP then
		  if page == 2 then 
			 cx = cx + 1
			 if cx > #lb[lb1[cx1]] then
				cx = 1
			 end
			 fy = 0
		  end
	  --end
   elseif X == VK_LEFT  then
      --page1????????????
	  if JY.Status ~= GAME_WMAP then
		  if page == 1 then 
			 t = t - 1 
			 if t < 1 then
				t = #team
			 end
		  end
	  end  --page2???????????¨½
		  if page == 2 then 
			 cx1 = cx1 - 1
			 cx = 1
			 if cx1 < 1 then 
				cx1 = #lb1
			 end
			 fy = 0
		  end
	-- end
   elseif X == VK_RIGHT  then
      --page1????????????
	    if JY.Status ~= GAME_WMAP then
			if page == 1 then
				t = t + 1 
				if t > #team then 
					t = 1
				end
			end
		end
		--page2???????????¨½
		if page == 2 then 
			cx1 = cx1 + 1
			cx = 1
			if cx1 > #lb1 then 
				cx1 = 1
			end	
			fy = 0
		end	
    --  end	  
   elseif X == VK_PGUP then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy - 1
			 if fy < 0 then 
				fy = 0
			 end	
		  end
	  --end
   elseif X == VK_PGDN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy + 1
			 if fy > fymax then
				fy = fymax 
			 end
		  end
	  --end
   else 
     -- if JY.Status ~= GAME_WMAP then
      local mxx = false 
	  if page == 1 then 
	     if ktype == 3 then 
		    page = 2
		 end
	  elseif page == 2 then 
	     if #lb[1] > 0 then 
		    for ii = 1,#lb[1] do 
			    if mx >= bx*420 and mx <= bx*420 + bx*160 and 
				   my >= by*60+(ii-1)*h and my <= by*60+(ii-1)*h + size1 then 
				   cx = ii
				   cx1 = lb2[1]
				   mxx = true 
				   break
				end
			end
		 end	
		 if #lb[2] > 0 then 
		    for ii = 1,#lb[2] do 
			    if mx >= bx*660 and mx <= bx*660 +size1*4 and 
				   my >= by*60+(ii-1)*h and my <= by*60+(ii-1)*h + size1 then 
				   cx = ii 
				   cx1 = lb2[2]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[3] > 0 and mxx == false then 
		    for ii = 1,#lb[3] do 
			    if mx >= bx*900 and mx <= bx*900 +size1*4 and 
				   my >= by*60+(ii-1)*h and my <= by*60+(ii-1)*h + size1 then 
				   cx = ii 
				   cx1 = lb2[3]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[4] > 0 then 
		    for ii = 1,#lb[4] do 
			    if mx >= bx*1142 and mx <= bx*1345 and 
				   my >= by*78+(ii-1)*by*48-by*18 and my <= by*78+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[4]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[5] > 0 then 
		    for ii = 1,#lb[5] do 
			    if mx >= bx*422 and mx <= bx*622 and 
				   my >= by*488+(ii-1)*by*48-by*18 and my <= by*488+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[5]
				   mxx = true 
				   break
				end
			end
		 end
		 if mxx == true and ktype == 3 then 
	        if lb1[cx1] == 5 then
		    --   Personzb(id,cx)
		    elseif lb1[cx1] == 4 then	
		       if cx == #lb[4] then 
			    
				--Menu_Gongti(id,yg[cx][2])
			   else 
			     -- Menu_Gongti(id,yg[cx][2])
			   end
		    elseif lb1[cx1] == 2 then
		    
		    end
		 end
	  end
	  --end
   end
   
   
   end
end 

--????????
function psx(id,str) 
	if str ~= nil then
		if str == '???????¨¦' then 
			return CC.SZJY[id]
		elseif str == '???¡ì????' then
		    return CC.WXQN[id]
		else
		    return JY.Person[id][str]
		end
	end
end

--????????
function rwnlxz(id,xz)
	local nl = JY.Person[id]['????????']
	if xz ~= nil then
		if nl == 3 then
			return true
		end	
		if xz == nl then
			return true
		end	
		if match_ID(id,9757+xz) then
			return true
		end
		return false
	else
		return nl
	end		
end

function ztd(i,str,t)
	local id = WAR.Person[i]["????????"]
	if i == nil or str == nil then
		do return end
	end	
	if JY.Status ~= GAME_WMAP then
		do return end
	end	
	if t == nil then
		t = 0
	else
		t = math.modf(t)	
	end	
	if WAR.TXXS[id] == nil then
		WAR.TXXS[id] = 1
	end	 
	if str == "?¨²?¨¹????" then
		if t < 0 then
			local hurt = math.abs(t)
			--?????????????????¨¢?????????????????????¡Â¡¦?????
			if hurt > 500 then
			    hurt = 500 + math.modf((hurt - 500)^0.95)
			    if hurt > 700 then
				    hurt = 700 + math.modf((hurt - 700)^0.9)
				    if hurt > 1500 then
				    	hurt = 1500 + math.modf((hurt - 1500 )^0.85)
					    if hurt > 3000 then
					        hurt = 3000 + math.modf((hurt - 3000)^0.8)
					    end
					end  
				end
			end
			t = -hurt	
			if (match_ID(id, 601) or match_ID(id,9808)) and WAR.SXTJ <= 50 then
				if t < -50 then
					t = -50
				end	
			end
			if NGQH(id,144) and WAR.PD['????????'][id] ~= nil and DWPD(WAR.CurID,i) then
				t = math.modf(t*0.5)
			end
			if match_ID(id,114) and WAR.PD['????????'][id] ~= nil and DWPD(WAR.CurID,i) then
				t = math.modf(t*0.3)
			end
			if WAR.PD['????????'][id] ~= nil then
				local yyxt = 10 - (WAR.PD['????????'][id] or 0)
				t = t + JY.Person[id]["?¡¦??"]*yyxt*(WAR.SPIRIT[id] or 0)/100
			end
		end
		if WAR.ZDDSSF == 1 then
			WAR.Person[i]["Realhurt"] = (WAR.Person[i]["Realhurt"] or 0) + t
			--WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"?¨²?¨¹",t)
		end	
	elseif str == "????????" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"????",t)
		end
	elseif str == "????????" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"????",t)
		end
	elseif str == "????????" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"????????",t)
		end
	elseif str == WAR.BFXS then
		if WAR.ZDDSSF == 1 then
			WAR.BFXS[id] = (WAR.BFXS[id] or 0) + t
		else
			WAR.BFXS[id] = 1
			AddPersonAttrib(id,"??¡¦?????",t)
		end	
	elseif str == WAR.ZSXS then
		if WAR.ZDDSSF == 1 then
			WAR.ZSXS[id] = (WAR.ZSXS[id] or 0) + t
		else
			WAR.ZSXS[id] = 1
			AddPersonAttrib(id,"¡Á???????",t)
		end
	elseif str == WAR.FXXS then
		if WAR.ZDDSSF == 1 then
			WAR.FXXS[id] = 1
			WAR.FXDS[id] = (WAR.FXDS[id] or 0) + t
		else
			WAR.FXXS[id] = 1
			AddPersonAttrib(id,"¡¦??¡§????",t)
		end
	elseif str == WAR.LXXS then
		if WAR.ZDDSSF == 1 then
			WAR.LXXS[id] = (WAR.LXXS[id] or 0) + t
		else
			WAR.LXXS[id] = 1
			AddPersonAttrib(id,"?¡Â??????",t)
		end
	elseif str == "????????" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"????????",t)
		end
	elseif str == "????????" then
		if t >= 0 then
			if WAR.PD['???¨¢????'][id] == 1 then
				t = 0
			end
			--WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-500,999)
			WAR.Person[i].TimeAdd = (WAR.Person[i].TimeAdd or 0 ) + t
			if WAR.Person[i].TimeAdd > 1000 then WAR.Person[i].TimeAdd = 1000 end
		else
			if WGZH(id,36,46) then
				WAR.Person[i]["?¨²?¨¹????"] = (WAR.Person[i]["?¨²?¨¹????"] or 0) + AddPersonAttrib(id,"?¨²?¨¹",-t)
			end
			if nokillspeed(i) == false then
				local jcqf = 0
				if t < -100 then
					if JY.Person[id]['?¡Â??????'] ~= nil and JY.Person[id]['?¡Â??????'] > 0 then
						--jcqf = jcqf + get_skill_power(id,JY.Person[id]['?¡Â??????'],11)
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['?¡Â??????'],11) * 0.5)
						if JY.Person[id]['?¡Â??????'] == JY.Person[id]['?¨§??????'] then
							jcqf = math.modf(jcqf * 1.2)
						end
					end 	
					if JY.Person[id]['?¡Â??????'] ~= nil and JY.Person[id]['????????1'] > 1 then
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['?¡Â??????'],11) * 0.25)
						if JY.Person[id]['?¡Â??????'] == JY.Person[id]['????????1'] then
							jcqf = math.modf(jcqf * 1.1)
						end
					end 
					jcqf = math.modf(jcqf*0.06)
					t = math.modf(t+jcqf)
					if WAR.PD['????¡¦?'][id] ~= nil then
						t = math.modf(t*0.9)
					end
					if NGQH(id,203) and WAR.PD['?¡è?¨²????'][id] ~= nil then
						t = math.modf(t*0.7)
					end
				end	
				if t >= 0 then t = 0 end
				--if t < -250 then t = -250 end
				WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-1500,1500)
			end
		end	
	else
	
	end	
	--Cat('????????')
	--return WAR.Person[i][str]
end

--[[function ztd1(i,str,t)
	local id = WAR.Person[i]["????????"]
	if i == nil or str == nil then
		do return end
	end	
	if t == nil then
		t = 0
	else
		t = math.modf(t)	
	end	
	if WAR.TXXS[id] == nil then
		WAR.TXXS[id] = 1
	end	 
	if str == "?¨²?¨¹????" then
		if NGQH(id,144) and WAR.PD['????????'][id] ~= nil and DWPD(WAR.CurID,i) and t < 0 then
			t = math.modf(t*0.5)
		end	
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"?¨²?¨¹",t)
	elseif str == "????????" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"????",t)
	elseif str == "????????" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"????",t)
	elseif str == "????????" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"????????",t)
	elseif str == WAR.BFXS then
		WAR.BFXS[id] = (WAR.BFXS[id] or 0) + t --1
		--AddPersonAttrib(id,"??¡¦?????",t)
	elseif str == WAR.ZSXS then
		WAR.ZSXS[id] = (WAR.ZSXS[id] or 0) + t --1
		--AddPersonAttrib(id,"¡Á???????",t)
	elseif str == WAR.FXXS then
		WAR.FXXS[id] = (WAR.FXXS[id] or 0) + t --1
		--AddPersonAttrib(id,"¡¦??¡§????",t)
	elseif str == WAR.LXXS then
		WAR.LXXS[id] = (WAR.LXXS[id] or 0) + t --1
		--AddPersonAttrib(id,"?¡Â??????",t)
	elseif str == "????????" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"????????",t)
	elseif str == "????????" then
		if t >= 0 then
			--WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-500,999)
			WAR.Person[i].TimeAdd = (WAR.Person[i].TimeAdd or 0 ) + t
			if WAR.Person[i].TimeAdd > 1000 then WAR.Person[i].TimeAdd = 1000 end
		else
			if nokillspeed(i) == false then
				local jcqf = 0
				if t < -100 then
					if JY.Person[id]['?¡Â??????'] ~= nil and JY.Person[id]['?¡Â??????'] > 0 then
						--jcqf = jcqf + get_skill_power(id,JY.Person[id]['?¡Â??????'],11)
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['?¡Â??????'],11) * 0.5)
						if JY.Person[id]['?¡Â??????'] == JY.Person[id]['?¨§??????'] then
							jcqf = math.modf(jcqf * 1.2)
						end
					end 	
					if JY.Person[id]['?¡Â??????'] ~= nil and JY.Person[id]['????????1'] > 1 then
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['?¡Â??????'],11) * 0.25)
						if JY.Person[id]['?¡Â??????'] == JY.Person[id]['????????1'] then
							jcqf = math.modf(jcqf * 1.1)
						end
					end 
					jcqf = math.modf(jcqf*0.067)
					t = math.modf(t+jcqf)
					if NGQH(id,203) and WAR.PD['?¡è?¨²????'][id] ~= nil then
						t = math.modf(t*0.7)
					end
				end	
				if t >= 0 then t = 0 end
				--if t < -250 then t = -250 end
				WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-1500,1500)
			end
		end	
	else
	
	end	
	--Cat('????????')
	--return WAR.Person[i][str]
end
]]

--png????????
function pngxy(id,pngid,x,y,z)
lib.LoadPNG(id,pngid,x,y,z)
end 

--pic????????
function picxy(id,picid,x,y,z,t)
lib.PicLoadCache(id,picid,x,y,z,t)
end 

--????????
function name(id) 
   return JY.Person[id]['????']
end
-- function Menu_Jiali(pid)
   -- if psx(pid,'?????¡Á?¡¦') <= 0 then 
      -- return 0
   -- end
   -- local wg = psx(pid,'?????¡Á?¡¦')
   -- local dj = tjm.tjmhs1.tjm5(pid,wg)
   -- local nl = psx(pid,'????¡Á??¨®??')
   -- local dqjl = psx(pid,'????')
   -- local jlmax = math.floor(nl/80*dj/100) --¡Á??¨®????/80*????????/100
   
   -- --?¨§??39?¨§??????
   -- if ptf(pid,39) then 
      -- jlmax = jlmax*2
   -- end  
   
   -- local x2 = CC.ScreenW*0.5
   -- local y = CC.ScreenH*0.2 + CC.ScreenH/768*5
   -- local size = CC.DefaultFont*0.8
   -- local h = (CC.ScreenH-y-CC.ScreenH/768*30)/16
   -- local jl = InputNum("???¡ã????????",0,jlmax,1,dqjl);
   -- if jl ~= nil then
      -- JY.Person[pid]['????'] = jl
   -- end
-- end

function tjm9(x,y,str,color,size,xnum,hnum,first,last)
if xnum == nil then 
   xnum = #str
end  
 
if x==-1 then
   local ll=#str;
   local w=size*ll/2+2*CC.MenuBorderPixel;
   x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
end

if y == -1 then
   y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
end
	
local ynum=size
local T2={{"??",C_RED},{"??",M_Green},{"??",C_BLACK},{"?¡Á",C_WHITE},{"??",C_ORANGE},{"??",M_Gray},{"??",M_Yellow},{"??",M_Orange}};

local cx,cy=0,0;
local sid=lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH);
while string.len(str)>=1 do
 local try=string.sub(str,1,1)
 local control=false;

 local hs = size+CC.RowPixel
 if hnum ~= nil then 
    hs = hnum
 end
 if string.byte(try)>127 then --????
    local s=string.sub(str,1,2);
    str=string.sub(str,3,-1);

    for i,v in pairs(T2) do
        if s==v[1] then
           color=v[2];
           control=true;
        break;
        end
    end

    if not control then
	   if first ~= nil then
	      if last ~= nil then
	         if cy >= first and cy < last then
                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
	         if cy >= first then
                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end	  
		  end
	   else 
          if last ~= nil then
	         if cy < last then
                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
		     lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
          end		  
	   end
       cx=cx+1;
    end

 else
    local s=try
    str=string.sub(str,2,-1);
	   if first ~= nil then
	      if last ~= nil then
	         if cy >= first and cy < last then
				lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
	         if cy >= first then
				lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end	  
		  end
	   else 
          if last ~= nil then
	         if cy < last then
				lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
			 lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
          end		  
	   end
    cx=cx+0.5;
 end

 if not control then

    if cx > xnum then
       cx = 0;
	   --¡Á????¨¢????????????????
	   if string.len(str) >= 1 then 
          cy = cy + 1;
	   end
       if cy >= ynum then
          cy = 0;
          WaitKey();
          lib.LoadSur(sid,0,0);
       end
    end
 end

 end

 lib.FreeSur(sid);
 return cy+1
end


function tjm30(id,wg,x,y)
   if x == nil or y == nil then 
      x,y = CC.ScreenW/2,CC.ScreenH/2
   end
   
   --???????????????¡ã????????????
   local level = math.modf(tjm5(id,wg)/100)+1
   --?¨½????????¡¦??¡ì
   --say("????????"..level,0,1)
   if level == 10 then
	level = 11
   end
   if wg == 153 then
   	do return end
   end	
   local m1, m2, a1, a2, a3, a4, a5 = refw1(wg, level,id)-- refw(wg, level,id)
   local movefanwei = {m1, m2}   --????????¡¦??¡ì
   local atkfanwei = {a1, a2, a3, a4, a5}   --???¡Â¡¦??¡ì
   local xx,yy = 6,6 
   local px,py = xx,yy

   if a1 >= 10 and a1 <= 12 then
      yy = 6 + math.ceil(a2/2)-1
	  py = yy + 1
   end
   
  	tjm31(x,y,xx,yy,atkfanwei,px,py)
end
function tjm5(id,wgid)
   if wgid == '?¡¦¡Á?' then 
	  return psx(id,'?¡¦¡Á?????')
   elseif wgid == '¡Á¨®??????' then 
      return psx(id,'¡Á¨®??????')
   end
   for i = 1,JY.Base["????????"] do 
      if JY.Person[id]["????"..i] == wgid and JY.Person[id]["????????"..i] > 0 then
	     return JY.Person[id]["????????"..i]  
      end 
   end
   return 0
end
function tjm31(zx,zy,x, y, fanwei, cx, cy)

  local x0, y0 = cx, cy

  local kind = fanwei[1]			--???¡Â¡¦??¡ì
  local len1 = fanwei[2]
  local len2 = fanwei[3]
  local len3 = fanwei[4]
  local len4 = fanwei[5]
  local xy = {}
  local num = 0
  if kind == 0 then
    num = 1
    xy[1] = {x, y}

  elseif kind == 1 then
    if not len1 then
      len1 = 0
    end
    if not len2 then
      len2 = 0
    end
    num = num + 1
    xy[num] = {x, y}
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      num = num + 4
    end
    for i = 1, len2 do
      xy[num + 1] = {x + i, y + i}
      xy[num + 2] = {x - i, y - i}
      xy[num + 3] = {x - i, y + i}
      xy[num + 4] = {x + i, y - i}
      num = num + 4
    end

  elseif kind == 2 then
    for tx = x - len1, x + len1 do
      for ty = y - len1, y + len1 do
        if len1 < math.abs(tx - x) + math.abs(ty - y) then
          
        else
        	num = num + 1
        	xy[num] = {tx, ty}
        end
        
      end
    end
	
	
  elseif kind == 3 then
    if not len2 then
      len2 = len1
    end
    local dx, dy = math.abs(x - x0), math.abs(y - y0)
    if dy < dx then
      len1, len2 = len2, len1
    end
    for tx = x - len1, x + len1 do
      for ty = y - len2, y + len2 do
        num = num + 1
        xy[num] = {tx, ty}
      end
    end
  elseif kind == 5 then
    if not len1 then
      len1 = 0
    end
    if not len2 then
      len2 = 0
    end
    num = num + 1
    xy[num] = {x, y}
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      num = num + 4
    end
    if len2 > 0 then
      xy[num + 1] = {x + 1, y + 1}
      xy[num + 2] = {x + 1, y - 1}
      xy[num + 3] = {x - 1, y + 1}
      xy[num + 4] = {x - 1, y - 1}
      num = num + 4
    end
    for i = 2, len2 do
      xy[num + 1] = {x + i, y + 1}
      xy[num + 2] = {x - i, y - 1}
      xy[num + 3] = {x - i, y + 1}
      xy[num + 4] = {x + i, y - 1}
      xy[num + 5] = {x + 1, y + i}
      xy[num + 6] = {x - 1, y - i}
      xy[num + 7] = {x - 1, y + i}
      xy[num + 8] = {x + 1, y - i}
      num = num + 8
    end
  elseif kind == 6 then
    if not len2 then
      len2 = len1
    end
    xy[1] = {x + 1, y}
    xy[2] = {x - 1, y}
    xy[3] = {x, y + 1}
    xy[4] = {x, y - 1}
    num = num + 4
    if len1 > 0 or len2 > 0 then
      xy[5] = {x + 1, y + 1}
      xy[6] = {x + 1, y - 1}
      xy[7] = {x - 1, y + 1}
      xy[8] = {x - 1, y - 1}
      num = num + 4
      for i = 2, len1 do
        xy[num + 1] = {x + i, y + 1}
        xy[num + 2] = {x - i, y + 1}
        xy[num + 3] = {x + i, y - 1}
        xy[num + 4] = {x - i, y - 1}
        num = num + 4
      end
      for i = 2, len2 do
        xy[num + 1] = {x + 1, y + i}
        xy[num + 2] = {x + 1, y - i}
        xy[num + 3] = {x - 1, y + i}
        xy[num + 4] = {x - 1, y - i}
        num = num + 4
      end
    end
  elseif kind == 7 then
    if not len2 then
      len2 = len1
    end
    if len1 == 0 then
      for i = y - len2, y + len2 do
        num = num + 1
        xy[num] = {x, i}
      end
    elseif len2 == 0 then
      for i = x - len1, x + len1 do
        num = num + 1
        xy[num] = {i, y}
      end
    else
      for i = x - len1, x + len1 do
        num = num + 1
        xy[num] = {i, y}
        num = num + 1
        xy[num] = {i, y + len2}
        num = num + 1
        xy[num] = {i, y - len2}
      end
      for i = 1, len2 - 1 do
        xy[num + 1] = {x, y + i}
        xy[num + 2] = {x, y - i}
        xy[num + 3] = {x - len1, y + i}
        xy[num + 4] = {x - len1, y - i}
        xy[num + 5] = {x + len1, y + i}
        xy[num + 6] = {x + len1, y - i}
        num = num + 6
      end
    end
  elseif kind == 8 then
    xy[1] = {x, y}
    num = 1
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      xy[num + 5] = {x + i, y + len1}
      xy[num + 6] = {x - i, y - len1}
      xy[num + 7] = {x + len1, y - i}
      xy[num + 8] = {x - len1, y + i}
      num = num + 8
    end
  elseif kind == 9 then
    xy[1] = {x, y}
    num = 1
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      xy[num + 5] = {x - i, y + len1}
      xy[num + 6] = {x + i, y - len1}
      xy[num + 7] = {x + len1, y + i}
      xy[num + 8] = {x - len1, y - i}
      num = num + 8
    end
  --elseif x == x0 and y == y0 then
  --  return 0
  elseif kind == 10 then
    if not len2 then
      len2 = 0
    end
    if not len3 then
      len3 = 0
    end
    if not len4 then
      len4 = 0
    end
    local fx, fy = x - x0, y - y0
    if fx > 0 then
      fx = 1
    elseif fx < 0 then
      fx = -1
    end
    if fy > 0 then
      fy = 1
    elseif fy < 0 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    dx1 = -(dx1 + fx) / 2
    dx2 = -(dx2 + fx) / 2
    dy1 = -(dy1 + fy) / 2
    dy2 = -(dy2 + fy) / 2
    if dx1 > 0 then
      dx1 = 1
    elseif dx1 < 0 then
      dx1 = -1
    end
    if dx2 > 0 then
      dx2 = 1
    elseif dx2 < 0 then
      dx2 = -1
    end
    if dy1 > 0 then
      dy1 = 1
    elseif dy1 < 0 then
      dy1 = -1
    end
    if dy2 > 0 then
      dy2 = 1
    elseif dy2 < 0 then
      dy2 = -1
    end
    for i = 0, len1 - 1 do
      num = num + 1
      xy[num] = {x + i * fx, y + i * fy}
    end
    for i = 0, len2 - 1 do
      num = num + 1
      xy[num] = {x + dx1 + i * fx, y + dy1 + i * fy}
      num = num + 1
      xy[num] = {x + dx2 + i * fx, y + dy2 + i * fy}
    end
    for i = 0, len3 - 1 do
      num = num + 1
      xy[num] = {x + 2 * dx1 + i * fx, y + 2 * dy1 + i * fy}
      num = num + 1
      xy[num] = {x + 2 * dx2 + i * fx, y + 2 * dy2 + i * fy}
    end
    for i = 0, len4 - 1 do
      num = num + 1
      xy[num] = {x + 3 * dx1 + i * fx, y + 3 * dy1 + i * fy}
      num = num + 1
      xy[num] = {x + 3 * dx2 + i * fx, y + 3 * dy2 + i * fy}
    end
  elseif kind == 11 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    if fx ~= 0 and fy ~= 0 then
      dx1 = -(dx1 + fx) / 2
      dx2 = -(dx2 + fx) / 2
      dy1 = -(dy1 + fy) / 2
      dy2 = -(dy2 + fy) / 2
      len1 = math.modf(len1 * 0.7071)
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, 2 * i + 1 do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    else
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, len1 - i do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    end
  elseif kind == 12 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    if fx ~= 0 and fy ~= 0 then
      dx1 = (dx1 + fx) / 2
      dx2 = (dx2 + fx) / 2
      dy1 = (dy1 + fy) / 2
      dy2 = (dy2 + fy) / 2
      len1 = math.modf(len1 * 1.41421)
      for i = 0, len1 do
        if i <= len1 / 2 then
          num = num + 1
          xy[num] = {x + i * fx, y + i * fy}
        end
        for j = 1, len1 - i * 2 do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    else
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, i do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    end
  elseif kind == 13 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local xx = x + fx * len1
    local yy = y + fy * len1
    for tx = xx - len1, xx + len1 do
      for ty = yy - len1, yy + len1 do
        if len1 < math.abs(tx - xx) + math.abs(ty - yy) then
          break;
        end
        num = num + 1
        xy[num] = {tx, ty}
      end
    end
  else
    return 0
  end

  local w = CC.ScreenW/1360*12
  local zx1 = zx + w
  local zy1 = zy + w
   
  local menu = {}
  -- for i = 1,11 do 
      -- menu[i] = {}
  -- end
  for i = 1,19 do 
      menu[i] = {}
  end
  
  --say("????"..num,0,1)
  for i = 1,num do 
      menu[xy[i][1]+4][xy[i][2]+4] = 1
  end
  
  for i = 1,19 do 
      for j = 1,19 do
	      local color = 0
		  if menu[i][j] == 1 then
		     color = M_YellowGreen
		  end
		  if i == cx+4 and j == cy+4 then
		     if menu[i][j] == 1 then
				color = C_ORANGE
			 else 	
			    color = C_RED
			 end
		  end
		  lib.Background(zx+(i-1)*(w+1), zy+(j-1)*(w+1),zx1+(i-1)*(w+1),zy1+(j-1)*(w+1),128,color)
	  end
  end
   
end

function Menu_Gongti(pid,num) --???????¨½ 1??????2????????3??????4?¨¢????5????
    local tl = {'????????','?¡Â??????','????????1','?¡Â???¨¢??'} 
    local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
	local size = CC.DefaultFont*0.7
	local size1 = CC.DefaultFont*0.6
	local menu = {};
	local menu1 = {};
	local xz = {'????','????','????'}
	--lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h,1)
    -- lib.LoadPNG(91,163*2,CC.ScreenW/2,CC.ScreenH/2-by*80,2,200,nil,bx*680)
    -- lib.LoadPNG(91,164*2,CC.ScreenW/2,CC.ScreenH/2-by*127.5+by*47.5,2,200,nil,bx*200)
    -- lib.LoadPNG(91,164*2,CC.ScreenW/2,CC.ScreenH/2-by*127.5+by*95,2,200,nil,bx*200)
    -- lib.LoadPNG(91,164*2,CC.ScreenW/2,CC.ScreenH/2-by*127.5,2,200,nil,bx*200)
	--local r = tjm13(xz,#xz,CC.ScreenW/2,CC.ScreenH/2-by*127.5,C_WHITE,size,nil,by*47.5)
	
	lib.LoadPNG(91,163*2,CC.ScreenW/2-by*350,CC.ScreenH/2-by*160,1)
    lib.LoadPNG(91,164*2,CC.ScreenW/2-by*100,CC.ScreenH/2-by*127.5+by*47.5-by*15,1)
    lib.LoadPNG(91,164*2,CC.ScreenW/2-by*100,CC.ScreenH/2-by*127.5+by*95-by*15,1)
    lib.LoadPNG(91,164*2,CC.ScreenW/2-by*100,CC.ScreenH/2-by*127.5-by*15,1)
    local r = tjm13(xz,#xz,CC.ScreenW/2,CC.ScreenH/2-by*127.5,C_WHITE,size,nil,by*47.5)
    if r == 3 or r <= 0 then 
       return 0;
    end
	--??¡¦¡§????¡¦?????????
    if r == 2 then 
		if inteam(pid) == false then
			return 0;
		end
	   JY.Person[pid][tl[num]] = 0
	   if tl[num] == '?¡Â??????' then 
	   --????????¡Á??¨®?¨²?¨¹?????????¡ã?¨²?¨¹????
	   --¡Á??¨®?¨²?¨¹??????¡¦¡§??????????
	   --???¡ã?¨²?¨¹??????¡¦¡§????¡Á??¨®?¨²?¨¹????
       --   tjm0(pid)
	   Hp_Max(pid)
	   end
	   return 0;
    end
	local WGid
	-- for i = 1, JY.Base["????????"] do
	    -- WGid = JY.Person[pid]["????"..i];
		-- if WGid > 0 then
           -- if num < 3 then 
		      -- if JY.Wugong[WGid]['????????'] < 5 then 
		         -- menu[#menu+1] = JY.Wugong[WGid]['????']
			     -- menu1[#menu1+1] = WGid
		      -- end
		   -- else
		      -- if wglx(WGid,num+2) then 
		         -- menu[#menu+1] = JY.Wugong[WGid]['????']
			     -- menu1[#menu1+1] = WGid
		      -- end
		   -- end
		-- end
	-- end
	for i = 1, JY.Base["????????"] do
	    WGid = JY.Person[pid]["????"..i];
		if WGid > 0 then
           if num == 1 then 
		      if JY.Wugong[WGid]['????????'] < 6 then 
		         menu[#menu+1] = JY.Wugong[WGid]['????']
			     menu1[#menu1+1] = WGid
		      end
		   elseif num == 2 then
			 if JY.Wugong[WGid]['????????'] == 6 then 
		         menu[#menu+1] = JY.Wugong[WGid]['????']
			     menu1[#menu1+1] = WGid
		     end
		   elseif num == 3 then
			if JY.Wugong[WGid]['????????'] == 6 then 
		         menu[#menu+1] = JY.Wugong[WGid]['????']
			     menu1[#menu1+1] = WGid
		     end
		   elseif num == 4 then
		     if JY.Wugong[WGid]['????????'] == 7 then 
		         menu[#menu+1] = JY.Wugong[WGid]['????']
			     menu1[#menu1+1] = WGid
		     end
		   end
		end
	end
	
	--lib.LoadPNG(91,126*2,bx*745,by*46,1,nil,nil,bx*380)
	lib.LoadPNG(91,165*2,bx*745,by*46,1)
	if #menu <= 0 or (num == 3 and JY.Person[pid][tl[num]] < 1) or inteam(pid) == false then
		if num == 3 and JY.Person[pid][tl[num]] < 1 then
			DrawString(bx*935-string.len('??????????????')/4*size,by*136-size/2,'??????????????',C_WHITE,size)
		else
		    DrawString(bx*935-string.len('????????????')/4*size,by*136-size/2,'????????????',C_WHITE,size)
		end
		ShowScreen()
		WaitKey()
		return 0;
	end
    local r = tjm13(menu,#menu,bx*935,by*56+size1,C_WHITE,size1,5,nil)
	if r <= 0 then 
	   return 0 
	end
	JY.Person[pid][tl[num]] = menu1[r] --????????	
	
	--?????¡Á?¡¦???????¡ã?????¡Â???¨²?¨¹????
	--???????????¡Â?¡Â
	if tl[num] == '?¡Â??????' then 
	   --????????¡Á??¨®?¨²?¨¹?????????¡ã?¨²?¨¹????
	   --¡Á??¨®?¨²?¨¹??????¡¦¡§??????????
	   --???¡ã?¨²?¨¹??????¡¦¡§????¡Á??¨®?¨²?¨¹????
    --   tjm0(pid)
		Hp_Max(pid)
	end
end

function wglx(wugong,a)
   if JY.Wugong[wugong]["????????"] == a then 
   return true
   end
   return false
end
function tjm0(id,flag)
   AddPersonAttrib(id,'????¡Á??¨®??',math.huge)
   AddPersonAttrib(id,'?¨²?¨¹¡Á??¨®??',math.huge)
   AddPersonAttrib(id,'?¨²?¨¹',0)
   AddPersonAttrib(id,'????',0)
   if flag == 1 then 
      AddPersonAttrib(id,'?¨²?¨¹',math.huge)
      AddPersonAttrib(id,'????',math.huge)
   end	  
end
function tjm13(menu,menu1,x,y,color,size,num,high,flag)
   local bx = CC.ScreenW/1360
   local by = CC.ScreenH/768
   local p1x,p1y = bx*200,by*30
   local cont = 1
   local cont1 = 0
   local page = 1
   
   --????????????
   local h = size*1.2
   
   --¡Á??¡§??????
   if high ~= nil then 
      h = high
   end
   
   --¡Á??¡§???????????¨ª????
   if num == nil then
      num = menu1
   else 
      if num > menu1 then 
         num = menu1
      end	  
   end  
   
   local tru = 0
   local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
   while true do 
      Cls() 
	  lib.LoadSur(surid,0,0)
	  for ii = 1,num do
	      local color = C_WHITE
		  if ii + cont1 == cont +cont1 then
		     color = C_RED
		  end 
		  if flag == nil then
		     DrawString(x-string.len(menu[ii+cont1])/4*size,y+(ii-1)*h-size/2, menu[ii+cont1], color, size)
		  else 
             DrawString(x,y+(ii-1)*h, menu[ii+cont1], color, size)
          end		  
	  end
	  
	  ShowScreen()
	  lib.Delay(20)
	    local X,ktype,mx,my = lib.GetKey()
	    if X == VK_SPACE or X == VK_RETURN then 
           tru = cont + cont1 
		   break
		elseif X == VK_ESCAPE or ktype == 4 then
          break
		elseif X == VK_UP then
		  if cont1 > 0 then 
		     if cont > 1 then 
		        cont = cont - 1
			 else 
                cont1 = cont1 - 1	  
			 end	
		  else
             cont = cont - 1		
		  if cont < 1 then 
		     cont = num
			 cont1 = menu1 - cont
		  end
		  end
		elseif X == VK_DOWN then
          cont = cont + 1		
		  if cont > num then 
		     cont = num
			 cont1 = cont1 + 1
		  end
		  if cont1 + cont > menu1 then 
		     cont1 = 0
			 cont = 1
		  end
		elseif X == VK_LEFT or ktype == 6 then
		        cont1 = cont1 - num
				cont = 1
				if cont1 < 0 then 
				   cont1 = 0 
				end
		elseif X == VK_RIGHT or ktype == 7 then
		        cont1 = cont1 + num
				cont = num
				if cont1 + cont > menu1 then 
				   cont1 = menu1-cont
				end	
	    else 
		    local mxx = false
            for ii = 1,num do 

		
            end		
            if ktype == 3 and mxx == true then 
		       tru = cont+cont1
		       break
            end	
	    end
   end
   lib.FreeSur(surid)
   return tru 
end
function QUANZHANGQX1()
	local teamid = Team()
	local id = -1
	if teamid ~= nil and teamid > 0 then
		id = JY.Base["???¨¦" .. teamid]
	else
		do return end
	end	
	if id ~= nil  then	
		QUANZHANGQX(id)
	end
	
	
	
	
end

--function QUANZHANGQX(teamid)
function QUANZHANGQX(teamid)
	--?¡§??
	--???¡§????
	-- local bx = CC.WX
	-- local by = CC.HY
	
	
	local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
	local lb = 2
	local tb = 1
	local tb1 = 1
	local pg = 1
	local ZUOBIAO1 = {{458,479},{559,479}}
	local WZ1 = {"?¡è??","¡¦???"}
	local WZ2 = {"????","¡¦???"}
	local WZ3 = {"?¨²??","¡¦???"}	

	--local teamid = Team()
	--local id = JY.Base["???¨¦" .. teamid]
	local id = teamid
	local size = CC.DefaultFont*0.7
	local tfstr
	local size1= CC.DefaultFont*0.9
	local SHUOMING = 0
	local JIANGE = 29
	local tb1x = 35 + bx*212
	local tb1y = 15 + by*33
	local tb2 = 1
	local p = JY.Person[id]
	--???????¡§
	local QZZB = {{159,351},					
				{247,260},{347,260},{448,260},{572,302},{785,260},								
				{247,351},{347,351},{448,351},{705,351},
				{247,449},{347,449},{545,449},{648,449},{785,449},
				{247,543},{448,543},{545,543},{648,543},{785,543},}
	
	local QZWZ = {"?????¨§??",
				"¡ã??????¡Á","????????","¡¦???????","????????","????????",
				"?????¨§??","¡ã??????¨²","????????","?¡Â?¨®???¨²",
				"????????","?????¨§??","¡Á??¨¢????","?¨§?¨²???¡ã","?¡Â?¡Á???¨½",
				"????????","?¡ã??????","???¨ª?¨¦??","????????","????????"}
	local QZQX1 ={}
	local QZQX2 ={}
	local QZQX3 ={}
	local QZQX4 ={}
	local QZQX5 ={}
	local QZQX6 ={}	
	--??¡¦¡§
	local ZFZB = {
				{160,349},	{250,256},{347,256},{450,256},{554,256},{764,256},
							{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
							{250,446},{347,446},{554,446},{648,446},{764,446},
							{347,547},{450,547},{648,547},{764,547},
		}	
	local ZFQX0 ={}
	local ZFQX1 ={}
	local ZFQX2 ={}
	local ZFQX3 ={}
	local ZFQX4 ={}
	local ZFQX5 ={}
	local ZFQX6 ={}				
	--????			
	local NGZB = {
					{357,256},{479,256},{597,256},{719,256},
					{164,349},{286,349},{412,349},{536,349},{662,349},{786,349},
					{164,442},{286,442},{536,442},{662,442},{786,442},
					{164,534},{286,534},{412,534},{536,534},{662,534},
					}			
	local NGQX0 ={}				
	local NGQX1 ={}
	local NGQX2 ={}
	local NGQX3 ={}
	local NGQX4 ={}
	local NGQX5 ={}
	local NGQX6 ={}	
	--??¡¦¡§
	local JFZB = {
				{160,349},	{250,256},{347,256},{450,256},{554,256},{764,256},
							{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
							{250,446},{347,446},{554,446},{648,446},{764,446},
							{347,547},{450,547},{648,547},{764,547},
		}
	local JFQX0 ={}				
	local JFQX1 ={}
	local JFQX2 ={}
	local JFQX3 ={}
	local JFQX4 ={}
	local JFQX5 ={}
	local JFQX6 ={}		
	--????
	local SDZB = {
				{160,349},	
				{250,256},{347,256},{450,256},{554,256},{764,256},
				{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
				{250,446},{347,446},{554,446},{648,446},{764,446},
				{347,547},{450,547},{648,547},{764,547},
		}
	local SDQX0 ={}				
	local SDQX1 ={}
	local SDQX2 ={}
	local SDQX3 ={}
	local SDQX4 ={}
	local SDQX5 ={}
	local SDQX6 ={}		
	--????
	local QMZB = {
				{160,349},	{250,256},{347,256},{450,256},{554,256},{764,256},
							{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
							{250,446},{347,446},{554,446},{648,446},{764,446},
							{347,547},{450,547},{648,547},{764,547},
		}
	local QMQX0 ={}				
	local QMQX1 ={}
	local QMQX2 ={}
	local QMQX3 ={}
	local QMQX4 ={}
	local QMQX5 ={}
	local QMQX6 ={}		
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cls()	
		local dianshu = 0	
		local wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]
		local wxds1=JY.Person[523]["????"]
		local wxds2=JY.Person[524]["????"]
		local wxds3=JY.Person[525]["????"]	
		local wxds4=JY.Person[id]["???¡ì????"]
		--???????¡§
		--lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
		--lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w-num*w+sx+aa,y-CC.ScreenH/768*30,2,240,nil,CC.ScreenW/1360*85)
		if pg == 1 then	
			--lib.PicLoadCache(92,67*2,bx*212,by*33,1)
			lib.PicLoadCache(92,67*2,-1,-1,1)
			--lib.PicLoadCache(92,67*2,bx*212,by*33,2,240,nil,CC.ScreenW/1360*85)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["????"])/2*size1,by*33+ by*73, JY.Person[id]["????"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
					
			for i = 1,#QZWZ do
				local cl = C_CYGOLD
				local level = JY.Person[id]["???????¡§????"..i]
				if CC.QUAHZQX[i] ~= nil then
					QZQX1[#QZQX1+1] = '??'..CC.QUAHZQX[i][1] --???¡§??¡Á?
					QZQX2[#QZQX2+1] = '??'..CC.QUAHZQX[i][2] --???¡§?¡è??????	
					QZQX3[#QZQX3+1] = '?¡Á'..CC.QUAHZQX[i][3] --???¡§???¡Â
					QZQX4[#QZQX4+1] = CC.QUAHZQX[i][4] --???¡§????????
					QZQX5[#QZQX5+1] = CC.QUAHZQX[i][5] --???¡§¡Á??¨®????	
					QZQX6[#QZQX6+1] = CC.QUAHZQX[i][6] --???¡§???¨®????														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["???????¡§????"..i] > 0  then
					lib.PicLoadCache(92,(70+i-1)*2,bx*212+bx*QZZB[i][1]-bx*22.5,by*33+by*QZZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(91+i-1)*2,bx*212+bx*QZZB[i][1]-bx*22.5,by*33+by*QZZB[i][2]-by*22.5,1)
				end	
				DrawString(bx*212+bx*QZZB[i][1]-string.len(QZWZ[i])/4*size*0.9,by*33+by*QZZB[i][2]-by*40,QZWZ[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0
										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),QZQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
					--if QZQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 then
					--	local XIAODIAN = math.modf(QZQX4[tb] + (QZQX4[tb] * JY.Person[id]["???????¡§????"..tb] - 1)*0.2)+1
					--	h = tjm(bx*212+bx*360+string.len(QZQX1[tb])/4*size*1.4,by*33+  by*233+size* (hs-FY), "["..JY.Person[id]["???????¡§????"..tb].."/" .. QZQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
				--	else
					--	h = tjm(bx*212+bx*360+string.len(QZQX1[tb])/4*size*1.4,by*33+  by*233+size* (hs-FY), "["..JY.Person[id]["???????¡§????"..tb].."/" .. QZQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					--end	
					hs = hs + h
					if QZQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 then
						local XIAODIAN = math.modf(QZQX4[tb] + (QZQX4[tb] * JY.Person[id]["???????¡§????"..tb] - 1)*0.2)+1
						h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. QZQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. QZQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end	
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),QZQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),QZQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["???????¡§????"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["???????¡§????"..tb] - QZQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = QZQX4[tb]
					if QZQX5[tb] - JY.Person[id]["???????¡§????"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"????????¡Á??¨®????",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"???????¡è??????",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"????????????",C_RED,size*1.4)
					end	
				end	
			end
		--??¡¦¡§
		elseif pg == 2 then
			lib.PicLoadCache(92,111*2,-1,-1,1)	
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["????"])/2*size1,by*33+ by*73, JY.Person[id]["????"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end			
			for i = 1,#ZFZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["??¡¦¡§???¡§????"..i]
				if CC.ZHIFQX[i] ~= nil then
					ZFQX0[#ZFQX0+1] = CC.ZHIFQX[i][1] --???¡§??¡Á?
					ZFQX1[#ZFQX1+1] = '??'..CC.ZHIFQX[i][1] --???¡§??¡Á?
					ZFQX2[#ZFQX2+1] = '??'..CC.ZHIFQX[i][2] --???¡§?¡è??????	
					ZFQX3[#ZFQX3+1] = '?¡Á'..CC.ZHIFQX[i][3] --???¡§???¡Â
					ZFQX4[#ZFQX4+1] = CC.ZHIFQX[i][4] --???¡§????????
					ZFQX5[#ZFQX5+1] = CC.ZHIFQX[i][5] --???¡§¡Á??¨®????	
					ZFQX6[#ZFQX6+1] = CC.ZHIFQX[i][6] --???¡§???¨®????														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["??¡¦¡§???¡§????"..i] > 0  then
					lib.PicLoadCache(92,(207+i-1)*2,bx*212+bx*ZFZB[i][1]-bx*22.5,by*33+by*ZFZB[i][2]-by*22.5,1)
					--lib.PicLoadCache(92,(165+i-1)*2,0,0,1)				 	
				else	
					lib.PicLoadCache(92,(228+i-1)*2,bx*212+bx*ZFZB[i][1]-bx*22.5,by*33+by*ZFZB[i][2]-by*22.5,1)
					--lib.PicLoadCache(92,(165+i-1)*2,0,0,1)
				end	
				--???¡§??¡Á?
				DrawString(bx*212+bx*ZFZB[i][1]-string.len(ZFQX0[i])/4*size*0.9,by*33+by*ZFZB[i][2]-by*40,ZFQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),ZFQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
						
					hs = hs + h
					if ZFQX5[tb] - JY.Person[id]["??¡¦¡§???¡§????"..tb] > 0 then
						local XIAODIAN = ZFQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["??¡¦¡§???¡§????"..tb].."/" .. ZFQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["??¡¦¡§???¡§????"..tb].."/" .. ZFQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),ZFQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),ZFQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["??¡¦¡§???¡§????"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["??¡¦¡§???¡§????"..tb] - ZFQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = ZFQX4[tb]
					if ZFQX5[tb] - JY.Person[id]["??¡¦¡§???¡§????"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"????????¡Á??¨®????",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"???????¡è??????",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"????????????",C_RED,size*1.4)
					end	
				end	
			end	
		--??¡¦¡§
		elseif pg == 3 then
			lib.PicLoadCache(92,112*2,-1,-1,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["????"])/2*size1, by*33+by*73, JY.Person[id]["????"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end			
			for i = 1,#JFZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["???????¡§????"..i]
				if CC.JIANFQX[i] ~= nil then
					JFQX0[#JFQX0+1] = CC.JIANFQX[i][1] --???¡§??¡Á?
					JFQX1[#JFQX1+1] = '??'..CC.JIANFQX[i][1] --???¡§??¡Á?
					JFQX2[#JFQX2+1] = '??'..CC.JIANFQX[i][2] --???¡§?¡è??????	
					JFQX3[#JFQX3+1] = '?¡Á'..CC.JIANFQX[i][3] --???¡§???¡Â
					JFQX4[#JFQX4+1] = CC.JIANFQX[i][4] --???¡§????????
					JFQX5[#JFQX5+1] = CC.JIANFQX[i][5] --???¡§¡Á??¨®????	
					JFQX6[#JFQX6+1] = CC.JIANFQX[i][6] --???¡§???¨®????														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["???????¡§????"..i] > 0  then
					lib.PicLoadCache(92,(165+i-1)*2,bx*212+bx*JFZB[i][1]-bx*22.5,by*33+by*JFZB[i][2]-by*22.5,1)	
					
				else	
					lib.PicLoadCache(92,(186+i-1)*2,bx*212+bx*JFZB[i][1]-bx*22.5,by*33+by*JFZB[i][2]-by*22.5,1)
					
				end	
				--???¡§??¡Á?
				DrawString(bx*212+bx*JFZB[i][1]-string.len(JFQX0[i])/4*size*0.9,by*33+by*JFZB[i][2]-by*40,JFQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0										
					h = tjm(bx*212+bx*328, by*33+by*230+size*1.4* (hs-FY),JFQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
						
					hs = hs + h
					if JFQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 then
						local XIAODIAN = JFQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. JFQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. JFQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),JFQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),JFQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["???????¡§????"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["???????¡§????"..tb] - JFQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = JFQX4[tb]
					if JFQX5[tb] - JY.Person[id]["???????¡§????"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"????????¡Á??¨®????",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"???????¡è??????",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"????????????",C_RED,size*1.4)
					end	
				end	
			end		
		--????
		elseif pg == 4 then
			lib.PicLoadCache(92,113*2,-1,-1,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["????"])/2*size1,by*33+ by*73, JY.Person[id]["????"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
			--1???? ?? 2 ?????? 3?¡ì????4??????5??????6????????
			for i = 1,#SDZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["???????¡§????"..i]
				if CC.SHUADQX[i] ~= nil then
					SDQX0[#SDQX0+1] = CC.SHUADQX[i][1] --???¡§??¡Á?
					SDQX1[#SDQX1+1] = '??'..CC.SHUADQX[i][1] --???¡§??¡Á?
					SDQX2[#SDQX2+1] = '??'..CC.SHUADQX[i][2] --???¡§?¡è??????	
					SDQX3[#SDQX3+1] = '?¡Á'..CC.SHUADQX[i][3] --???¡§???¡Â
					SDQX4[#SDQX4+1] = CC.SHUADQX[i][4] --???¡§????????
					SDQX5[#SDQX5+1] = CC.SHUADQX[i][5] --???¡§¡Á??¨®????	
					SDQX6[#SDQX6+1] = CC.SHUADQX[i][6] --???¡§???¨®????														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["???????¡§????"..i] > 0  then
					lib.PicLoadCache(92,(249+i-1)*2,bx*212+bx*SDZB[i][1]-bx*22.5,by*33+by*SDZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(270+i-1)*2,bx*212+bx*SDZB[i][1]-bx*22.5,by*33+by*SDZB[i][2]-by*22.5,1)
				end	
				--???¡§??¡Á?
				DrawString(bx*212+bx*SDZB[i][1]-string.len(SDQX0[i])/4*size*0.9,by*33+by*SDZB[i][2]-by*40,SDQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0
										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),SDQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
					--if SDQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 then
						--local XIAODIAN = SDQX4[tb]
						--h = tjm(bx*212+bx*360+string.len(SDQX1[tb])/4*size*1.4,by*33+ by*33+by*233+size* (hs-FY), "["..JY.Person[id]["???????¡§????"..tb].."/" .. SDQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					--else
						--h = tjm(bx*212+bx*360+string.len(SDQX1[tb])/4*size*1.4,by*33+ by*233+size* (hs-FY), "["..JY.Person[id]["???????¡§????"..tb].."/" .. SDQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					--end	
					
					hs = hs + h
					if SDQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 then
						local XIAODIAN = SDQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. SDQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. SDQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end	
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),SDQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),SDQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["???????¡§????"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["???????¡§????"..tb] - SDQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = SDQX4[tb]
					if SDQX5[tb] - JY.Person[id]["???????¡§????"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"????????¡Á??¨®????",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"???????¡è??????",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"????????????",C_RED,size*1.4)
					end	
				end	
			end	
		--????
		elseif pg == 5 then
			lib.PicLoadCache(92,114*2,0-1,-1,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["????"])/2*size1, by*33+by*73, JY.Person[id]["????"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
			
			for i = 1,#QMZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["???????¡§????"..i]
				if CC.QIMQX[i] ~= nil then
					QMQX0[#QMQX0+1] = CC.QIMQX[i][1] --???¡§??¡Á?
					QMQX1[#QMQX1+1] = '??'..CC.QIMQX[i][1] --???¡§??¡Á?
					QMQX2[#QMQX2+1] = '??'..CC.QIMQX[i][2] --???¡§?¡è??????	
					QMQX3[#QMQX3+1] = '?¡Á'..CC.QIMQX[i][3] --???¡§???¡Â
					QMQX4[#QMQX4+1] = CC.QIMQX[i][4] --???¡§????????
					QMQX5[#QMQX5+1] = CC.QIMQX[i][5] --???¡§¡Á??¨®????	
					QMQX6[#QMQX6+1] = CC.QIMQX[i][6] --???¡§???¨®????														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["???????¡§????"..i] > 0  then
					lib.PicLoadCache(92,(291+i-1)*2,bx*212+bx*QMZB[i][1]-bx*22.5,by*33+by*QMZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(312+i-1)*2,bx*212+bx*QMZB[i][1]-bx*22.5,by*33+by*QMZB[i][2]-by*22.5,1)
				end	
				--???¡§??¡Á?
				DrawString(bx*212+bx*QMZB[i][1]-string.len(QMQX0[i])/4*size*0.9,by*33+by*QMZB[i][2]-by*40,QMQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0
										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),QMQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
						
					hs = hs + h
					if QMQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 then
						local XIAODIAN = QMQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. QMQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["???????¡§????"..tb].."/" .. QMQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),QMQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),QMQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["???????¡§????"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["???????¡§????"..tb] - QMQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = QMQX4[tb]
					if QMQX5[tb] - JY.Person[id]["???????¡§????"..tb] == 0 then
						DrawString(bx*212+bx*382, by*33+by*359,"????????¡Á??¨®????",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"???????¡è??????",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"????????????",C_RED,size*1.4)
					end	
				end	
			end	
		--????
		--[[elseif pg == 6 then
			lib.PicLoadCache(92,115*2,0,0,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["????"])/2*size1,by*33+ by*73, JY.Person[id]["????"], C_CYGOLD, size1)
			if wxds3>0 then
				DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
				DrawString(bx*212+bx*380,by*33+by*125,"???¡ì???? "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
			for i = 1,#NGZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["???????¡§????"..i]
				if CC.NEIGQX[i] ~= nil then
					NGQX0[#NGQX0+1] = CC.NEIGQX[i][1] --???¡§??¡Á?
					NGQX1[#NGQX1+1] = '??'..CC.NEIGQX[i][1] --???¡§??¡Á?
					NGQX2[#NGQX2+1] = '??'..CC.NEIGQX[i][2] --???¡§?¡è??????	
					NGQX3[#NGQX3+1] = '?¡Á'..CC.NEIGQX[i][3] --???¡§???¡Â
					NGQX4[#NGQX4+1] = CC.NEIGQX[i][4] --???¡§????????
					NGQX5[#NGQX5+1] = CC.NEIGQX[i][5] --???¡§¡Á??¨®????	
					NGQX6[#NGQX6+1] = CC.NEIGQX[i][6] --???¡§???¨®????														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["???????¡§????"..i] > 0  then
					lib.PicLoadCache(92,(125+i-1)*2,bx*212+bx*NGZB[i][1]-bx*22.5,by*33+by*NGZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(145+i-1)*2,bx*212+bx*NGZB[i][1]-bx*22.5,by*33+by*NGZB[i][2]-by*22.5,1)
				end	
				DrawString(bx*212+bx*NGZB[i][1]-string.len(NGQX0[i])/4*size*0.9,by*33+by*NGZB[i][2]-by*40,NGQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0										
					h = tjm(bx*212+bx*328, by*33+by*230+size*1.4* (hs-FY),NGQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
					
					hs = hs + h
					if NGQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 then
						local XIAODIAN = NGQX4[tb]
						h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX2[tb],"["..JY.Person[id]["???????¡§????"..tb].."/" .. NGQX5[tb].."]" .. "???????¡ì????" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX2[tb],"["..JY.Person[id]["???????¡§????"..tb].."/" .. NGQX5[tb].."]" .. "??????¡Á??¨®????", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end	
					hs = hs + h
					h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["???????¡§????"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["???????¡§????"..tb] - NGQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = NGQX4[tb]
					if NGQX5[tb] - JY.Person[id]["???????¡§????"..tb] == 0 then
						DrawString(bx*212+bx*382, by*33+by*359,"????????¡Á??¨®????",C_RED,size*1.4)
					elseif wxds - XIAODIAN >= 0  then
						DrawString(bx*212+bx*382, by*33+by*359,"???????¡è??????",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382, by*33+by*359,"????????????",C_RED,size*1.4)
					end	
				end	
			end	]]	
		end		
		lib.PicLoadCache(92,121*2,bx*212+bx*826, by*33+by*78,1)
		if SHUOMING == 1 then
			local size1 = CC.DefaultFont
			lib.PicLoadCache(92,122*2,bx*212+bx*300, by*33+by*226,1)			
			local hs = 0
			local FY = 0
			local ZUIDHS = 15
			local h = 0
			local CAOZSM = {}  
			for z = 1,#CC.QXCZSM do
				CAOZSM[#CAOZSM+1] = CC.QXCZSM[z]
			end	
			h = tjm(bx*212+bx*454,  by*33+by*227,CAOZSM[1], C_CYGOLD, size1*0.9,15,size1*0.9,FY-hs,ZUIDHS+1-hs+FY)	
			hs = hs + h							
			h = tjm(bx*212+bx*328,  by*33+by*260,CAOZSM[2], C_WHITE, size1*0.7,15,size1*0.7,FY-hs,ZUIDHS+1-hs+FY)
			hs = hs + h			
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			if SHUOMING ==  1 then
				SHUOMING = 0
			elseif lb == 1 then
				lb = 2 
			elseif lb == 2 then
				lb = 3
			elseif lb == 3 then
				lb = 4
			elseif lb == 4  then
				if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then
					--???????¡§
					if pg == 1  then
						local PANDING = 0
						local XIAODIAN = QZQX4[tb]
						if wxds - XIAODIAN >= 0 and QZQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and TrueQZ(id) - QZQX6[tb] >= 0 then										
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 then
								PANDING = 1	
							elseif tb == 2 and 	JY.Person[id]["???????¡§????1"] >= 3  then
								PANDING = 1										
							elseif tb == 7 and 	JY.Person[id]["???????¡§????1"] >= 3  then
								PANDING = 1
							elseif tb == 11 and JY.Person[id]["???????¡§????1"] >= 3  then
								PANDING = 1
							elseif tb == 16 and JY.Person[id]["???????¡§????1"] >= 3  then
								PANDING = 1
							elseif tb == 5 and JY.Person[id]["???????¡§????9"] >= 2 or JY.Person[id]["???????¡§????4"] >= 2 then
								PANDING = 1	
							end
							local m = {2,7,11,16,5}
							local pd = true 
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false 
								end
							end
							if  pd == true and JY.Person[id]["???????¡§????"..n] >= 2   then
								PANDING = 1	
							end							
							if PANDING ==  0 then
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
								JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN	
								wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]	
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if QZQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
							JY.Person[id]["???????¡§????"..tb] = QZQX5[tb]						
						end
					--??¡¦¡§
					elseif pg == 2 then
						local PANDING = 0
						local XIAODIAN = ZFQX4[tb]
						if wxds - XIAODIAN >= 0 and ZFQX5[tb] - JY.Person[id]["??¡¦¡§???¡§????"..tb] > 0 and TrueZF(id) - ZFQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 then
								PANDING = 1	
							end	
							if tb == 2 and 	JY.Person[id]["??¡¦¡§???¡§????1"] >= 3 then
								PANDING = 1
							end									
							if tb == 7 and 	JY.Person[id]["??¡¦¡§???¡§????1"] >= 3 then
								PANDING = 1
							end	
							if tb == 12 and JY.Person[id]["??¡¦¡§???¡§????10"] >= 2  then
								PANDING = 1
							end										
							if tb == 13 and JY.Person[id]["??¡¦¡§???¡§????1"] >= 3  then
								PANDING = 1
							end	
							if tb == 14 and JY.Person[id]["??¡¦¡§???¡§????13"] >= 2  then
								PANDING = 1	
							end							
							if tb == 19 and JY.Person[id]["??¡¦¡§???¡§????15"] >= 2   then
								PANDING = 1	
							end	
							if tb == 18 and JY.Person[id]["??¡¦¡§???¡§????19"] >= 5 then
								PANDING = 1	
							end	
							if tb == 20 and JY.Person[id]["??¡¦¡§???¡§????15"] >= 2  then
								PANDING = 1	
							end
							local m = {2,7,12,13,14,18,19,20}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["??¡¦¡§???¡§????"..n] >= 2 then
								PANDING = 1	
							end											
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["??¡¦¡§???¡§????"..tb] = JY.Person[id]["??¡¦¡§???¡§????"..tb] + 1
								JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN	
								wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]		
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if ZFQX5[tb] - JY.Person[id]["??¡¦¡§???¡§????"..tb] < 1 then
							JY.Person[id]["??¡¦¡§???¡§????"..tb] = ZFQX5[tb]						
						end
					
					--????
					elseif pg == 3 then
						local PANDING = 0
						local XIAODIAN = JFQX4[tb]
						if wxds - XIAODIAN >= 0 and JFQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and TrueYJ(id)+(WuyueJFSL(id)*20) - JFQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end	
								if tb == 11 and JY.Person[id]["???????¡§????10"] >= 1  then
									PANDING = 1
								end			
								if tb == 12 and JY.Person[id]["???????¡§????10"] >= 1  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["???????¡§????13"] >= 2 then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["???????¡§????15"] >= 2 then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["???????¡§????19"] >= 5 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["???????¡§????15"] >= 2 then
									PANDING = 1	
								end
							local m = {2,7,11,12,13,14,18,19,20}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["???????¡§????"..n] >= 2 then
								PANDING = 1	
							end									
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
								JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN	
								wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]		
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if JFQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
							JY.Person[id]["???????¡§????"..tb] = JFQX5[tb]						
						end
					--????
					elseif pg == 4  then
						local PANDING = 0
						local XIAODIAN = SDQX4[tb]
						if wxds - XIAODIAN >= 0 and SDQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and TrueSD(id) - SDQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 then
								PANDING = 1	
							end	
							if tb == 2 and 	JY.Person[id]["???????¡§????1"] >= 3 then
								PANDING = 1
							end									
							if tb == 7 and 	JY.Person[id]["???????¡§????1"] >= 3 then
								PANDING = 1
							end										
							if tb == 13 and JY.Person[id]["???????¡§????1"] >= 3  then
								PANDING = 1
							end							
							if tb == 18 and JY.Person[id]["???????¡§????1"] >= 5  then
								PANDING = 1	
							end	
							if tb == 19 and JY.Person[id]["???????¡§????18"] >= 1 then
								PANDING = 1	
							end	
							if tb == 20 and JY.Person[id]["???????¡§????19"] >= 1  then
								PANDING = 1	
							end
							if tb == 21 and JY.Person[id]["???????¡§????20"] >= 1  then
								PANDING = 1	
							end
							local m = {2,7,13,18,19,20,21}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["???????¡§????"..n] >= 2 then
								PANDING = 1	
							end											
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
								JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN
								wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]			
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if SDQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
							JY.Person[id]["???????¡§????"..tb] = SDQX5[tb]						
						end
					--????
					elseif pg == 5  then
						local PANDING = 0
						local XIAODIAN = QMQX4[tb]
						if wxds - XIAODIAN >= 0 and QMQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and TrueTS(id) - QMQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 and JY.Person[id]['???????¡Â'] >= 100 then
								PANDING = 1	
							end	
							if tb == 5 and JY.Person[id]["???????¡§????4"] >= 2 then
								PANDING = 1
							end
							if tb == 6 and JY.Person[id]["???????¡§????5"] >= 2 then
								PANDING = 1
							end
							if tb == 7 and JY.Person[id]["???????¡§????1"] >= 3 then
								PANDING = 1
							end
							if tb == 10 and JY.Person[id]["???????¡§????9"] >= 2 then
								PANDING = 1
							end
							if tb == 11 and JY.Person[id]["???????¡§????10"] >= 2 then
								PANDING = 1
							end
							if tb == 12 and JY.Person[id]["???????¡§????11"] >= 1 then
								PANDING = 1
							end
							if tb == 13 and JY.Person[id]["???????¡§????1"] >= 4 then
								PANDING = 1
							end
							if tb == 14 and JY.Person[id]["???????¡§????1"] >= 4 then
								PANDING = 1
							end
							if tb == 15 and JY.Person[id]["???????¡§????1"] >= 4 then
								PANDING = 1
							end
							if tb == 16 and JY.Person[id]["???????¡§????1"] >= 4 then
								PANDING = 1
							end
							if tb == 17 and JY.Person[id]["???????¡§????1"] >= 4 then
								PANDING = 1
							end
							if tb == 18 and JY.Person[id]["???????¡§????1"] >= 5 then
								PANDING = 1
							end
							if tb == 19 and JY.Person[id]["???????¡§????18"] >= 1 then
								PANDING = 1
							end
							if tb == 20 and JY.Person[id]["???????¡§????19"] >= 1 then
								PANDING = 1
							end
							if tb == 21 and JY.Person[id]["???????¡§????20"] >= 1 then
								PANDING = 1
							end
							local m = {5,6,7,10,11,12,13,14,15,16,17,18,19,20,21}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["???????¡§????"..n] >= 3 then
								PANDING = 1	
							end											
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
								JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN	
								wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]		
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if QMQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
							JY.Person[id]["???????¡§????"..tb] = QMQX5[tb]						
						end
					--????
					--[[elseif pg == 6  then
						local PANDING = 0
						local XIAODIAN = NGQX4[tb]
						if wxds - XIAODIAN >= 0 and NGQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0  then
							local n = 0
							for ii =0,CC.MyThingNum - 1 do
								local thid = JY.Base["???¡¦" .. ii + 1]									
								if thid == 187 or thid == 188 or thid == 189 or thid == 190 or thid == 191 or thid == 193 then
									n = n + 1
								end				
							end		
							if tb == 1 and PersonKFJ(id,108)  then
								PANDING = 1										
							elseif tb == 2 and (PersonKFJ(id,160) or PersonKFJ(id,163)) and PersonKFJ(id,87) then
								PANDING = 1
								--JY.Person[pid]["¡Á???"]
							elseif tb == 3 and PersonKFJ(id,105) and PersonKFJ(id,88) and PersonKFJ(id,93) and PersonKFJ(id,97) then
								PANDING = 1
							elseif tb == 4 and (PersonKFJ(id,91) or PersonKFJ(id,92)) and JY.Person[id]["????"] >= 100 then
								PANDING = 1
							elseif tb == 5 and PersonKFJ(id,106) then
								PANDING = 1
							elseif tb == 6 and PersonKFJ(id,96) and PersonKFJ(id,144) then
								PANDING = 1		
							elseif tb == 7 and PersonKFJ(id,100) and  (PersonKFJ(id,94) or PersonKFJ(id,203))   then --615????
								PANDING = 1
							elseif tb == 8 and JY.Person[id]["????"] >= 50 and PersonKFJ(id,207) and (PersonKFJ(id,227) or PersonKFJ(id,183))  then
								PANDING = 1
							elseif tb == 9 and PersonKFJ(id,107) then
								PANDING = 1			
							elseif tb == 10 and JY.Person[id]["????"] >= 50 and PersonKFJ(id,317)  then
								PANDING = 1	
							elseif tb == 11 and PersonKFJ(id,103) and PersonKFJ(id,196) and rwnlxz(id,1) then
								PANDING = 1	
								JY.Person[id]["?¨²?¨¹???¡è"] = JY.Person[id]["?¨²?¨¹???¡è"] + 1
							elseif tb == 12 and p["¡¦?????"] >= 200 and (PersonKFJ(id,215) or PersonKFJ(id,204)) then
								PANDING = 1	
							elseif tb == 13 and PersonKFJ(id,102) then
								PANDING = 1	
							elseif tb == 14 and ((p["????????"]+(WuyueJFSL(id)*20)) >= 200 or p["??????¡¦¨¾"] >= 200 or p["??¡¦¡§????"] >= 200 or p["????????"] >= 200 or p["???????¡Â"] >= 200) and (PersonKFJ(id,95) or PersonKFJ(id,180)) and PersonKFJ(id,90) then
								PANDING = 1	
							elseif tb == 15 and PersonKFJ(id,85) and PersonKFJ(id,98) and PersonKFJ(id,101) and PersonKFJ(id,190)  then
								PANDING = 1	
							elseif tb == 16 and PersonKF(id,233) and ((p["????????"]+(WuyueJFSL(id)*20)) >= 300 or p["??????¡¦¨¾"] >= 300 or p["??¡¦¡§????"] >= 300 or p["????????"] >= 300 or p["???????¡Â"] >= 300) then
								PANDING = 1	
							elseif tb == 17  and (PersonKFJ(id,216) or PersonKFJ(id,213)) and rwnlxz(id,0) then
								PANDING = 1	
							elseif tb == 18  and PersonKFJ(id,199) and p["???¡ì????"] >= 100 then
								PANDING = 1
							elseif tb == 19  and ((p["????????"]+(WuyueJFSL(id)*20)) >= 100 or p["??????¡¦¨¾"] >= 100 or p["??¡¦¡§????"] >= 100 or p["????????"] >= 100 or p["???????¡Â"] >= 100) and PersonKFJ(id,154)  then
								PANDING = 1	
							elseif tb == 20  and PersonKFJ(id,171) and (PersonKFJ(id,356) or PersonKFJ(id,177)) and JY.Person[id]["?¨§??????"]==171 then
								PANDING = 1																																																																																																																												
							else 
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then				
								PlayWavE(84)
								JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
								JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN
								wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]			
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if NGQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
							JY.Person[id]["???????¡§????"..tb] = NGQX5[tb]			
						end
						PlayWavE(79)	]]				
					end
				else
					PlayWavE(77)
					lb = 3	
				end
			elseif lb == 5 then
				lb = 3		
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			if SHUOMING == 1 then
				SHUOMING =  0
			elseif lb == 4 or lb == 5 then
				lb = 3
			elseif lb == 3 then
				lb = 2
			elseif lb == 2 then	
				--lb = 1
			--elseif lb == 1 then
				return false			
			end
		elseif X == VK_UP  then
			PlayWavE(77)
			if lb == 2 then
				pg = pg - 1
				if pg < 1 then
					pg = 5
				end	
			elseif lb == 3 then
				if pg == 1 then 					
					if tb > 6 and tb < 11  then
						tb = tb - 5					
					elseif tb == 15  then
						tb = 6
					elseif tb > 15  then
						tb = tb - 5	
					else
						tb = tb - 4	
					end														
					if tb < 1 then
						tb = #QZZB
					end
				--??¡¦¡§
				elseif pg == 2 then	
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #ZFZB
					end
					if tb < 1 then
						tb = #ZFZB
					end	
				elseif pg == 3 then
					
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #JFZB
					end
					if tb < 1 then
						tb = #JFZB
					end	
				elseif pg == 4 then	
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #SDZB
					end
					if tb < 1 then
						tb = #SDZB
					end
				elseif pg == 5 then
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #QMZB
					end
					if tb < 1 then
						tb = #QMZB
					end
				--[[elseif pg == 6 then
					if tb < 5 then
						tb = tb - 4
					elseif tb < 9 and tb > 4 then
						tb = tb - 4
					elseif tb == 9 or tb == 10 then
						tb = tb - 6
					elseif tb == 11 or tb == 12 then
						tb = tb - 6
					elseif tb == 13 or tb == 14 or tb == 15 then
						tb = tb - 5
					elseif tb > 15 then
						tb = tb - 5
						if tb < 1 then
							tb = #NGZB
						end	
					end]]
				end		
			elseif lb == 4 then
				tb1 = tb1 - 1 						
				if tb1 < 1 then
					tb1 = #ZUOBIAO1
				end		
			end	
		elseif X == VK_DOWN then
			PlayWavE(77)
			if lb == 2 then
				pg = pg + 1
				if pg > 5  then
					pg = 1
				end
			elseif lb == 3  then
				if pg == 1 then
					if tb > 6 and tb < 11  then
						tb = tb + 4
					elseif tb == 1 then
						tb = 16
					elseif tb < 6 and tb > 1 then
						tb = tb + 5
					elseif tb == 6 then
						tb = 15	
					elseif tb > 15  then
						tb = tb + 7	
					else
						tb = tb + 5	
					end									
					if tb > #QZZB then
						tb = 1
					end	
				--??¡¦¡§
				elseif pg == 2 then
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end		
				elseif pg == 3 then
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end		
				elseif pg == 4 then
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end	
				elseif pg == 5 then	
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end	
				--[[elseif pg == 6 then
					if tb < 4 then
						tb = tb + 4
						if tb < 1 then
							tb = 1
						end
					elseif tb == 7 then
						tb = 18
					elseif tb == 5 or tb == 6 then
						tb = tb + 6
					elseif tb == 8 or tb == 9 or tb == 10 then
						tb = tb + 5
					elseif tb == 11 or tb == 12 then
						tb = tb + 5
					elseif tb == 13 or tb == 14 then
						tb = tb + 6
					elseif tb == 15 then
						tb = 10
					end]]
				end
			end	
			if lb == 4 then
				tb1 = tb1 + 1
				if tb1 > #ZUOBIAO1 then
					tb1 = 1
				end	
			end
		elseif  X == VK_LEFT then
			PlayWavE(77)
			if lb == 1 then
			--	return Tianfujm(id)
			elseif lb == 2 then
				pg = pg - 1
				if pg < 1 then
					pg = 5
				end		
			elseif lb == 3  then
				tb = tb - 1
				if pg == 1 then
					if tb < 1 then
						tb = #QZZB
					end
				elseif pg == 2 then
					if tb < 1 then
						tb = #ZFZB
					end	
				elseif pg == 3 then
					if tb < 1 then
						tb = #JFZB
					end		
				elseif pg == 4 then
					if tb < 1 then
						tb = #SDZB
					end	
				elseif pg == 5 then
					if tb < 1 then
						tb = #QMZB
					end	
				--[[elseif pg == 6 then
					if tb < 1 then
						tb = #NGZB
					end	]]	
				end	
			elseif lb == 4 then
				tb2 = tb2 - 1
				if tb2 < 1 then
					tb2 = #ZUOBIAO1
				end	
			end
		elseif  X == VK_RIGHT then
			PlayWavE(77)
			if lb == 1 then
			--	return Shezhijm(id)
			elseif lb == 2 then	
				pg = pg + 1
				if pg > 5 then
					pg = 1
				end	
			elseif lb == 3 then
				tb = tb + 1
				if pg == 1 then
					if tb > #QZZB then 
						tb = 1
					end	
				elseif pg == 2 then
					if tb > #ZFZB then
						tb = 1
					end	
				elseif pg == 3 then
					if tb > #JFZB then
						tb = 1
					end		
				elseif pg == 4 then
					if tb > #SDZB then
						tb = 1
					end	
				elseif pg == 5 then
					if tb > #QMZB then
						tb = 1
					end	
				--[[elseif pg == 6 then
					if tb > #NGZB then
						tb = 1
					end	]]	
				end
			elseif lb == 4  then
				tb2 = tb2 + 1
				if tb2 > #ZUOBIAO1 then
					tb2 = 1
				end	
			end
		else
			-- local bx,by = CC.WX,CC.HY
			local bx = CC.ScreenW/1360
			local by = CC.ScreenH/768
			local mx0 = false
			local mx1 = false
			local tb0 = 1
			local tb1 = 1
			local mxxx = false
			local bugao = 34 + by*33
			local bukuan = 22+bx*212
			
			--local ???? = 0		
			if lb < 3 then
				local zhuzb = {{147,614},{222,614},{307,614},{392,614},{476,614}}
				local zhuzbH = 43
				local zhuzbW = 84							
				for i = 1,#zhuzb do
					if mx >= bx*zhuzb[i][1] and mx <= bx*zhuzb[i][1]+zhuzbW and my >= by*zhuzb[i][2] and my <= by*zhuzb[i][2] +zhuzbH then
						tb0 = i
						mx1 = true
						break	
					end
				end	
				if mx1 == true and ktype == 3 then
					PlayWavE(77)
					if tb0 == 1 then
						return Mianban(id)
					elseif tb0 == 2 then
					--	return Wugongjm(id)
					elseif tb0 == 3 then
					--	return Tianfujm(id)
					elseif tb0 == 4 then
						return QUANZHANGQX(id)
					elseif tb0 == 5 then
					--	return Shezhijm(id)	
					end	
				elseif mx1 == false and ktype == 3 then
					lb = 2
				end	
				local zb = {{123,157},
							{202,157},
							{281,157},
							{359,157},
							{437,157},
							{515,157},
							
							}
				local kx = 78
				local ky = 37	
				for i = 1,#zb do
					if mx > bx*zb[i][1] and mx < bx*zb[i][1] + bx*kx and my > zb[i][2] and my < by*zb[i][2]+by*ky then
						tb1 = i 
						mx0 = true
						break
					end	
				end
				if mx0 == true and ktype == 3 then
					PlayWavE(77)
					if tb1 == 1 then
						pg = 1
					elseif tb1 == 2	then
						pg  = 2
					elseif tb1 == 3 then
						pg = 3
					elseif tb1 == 4 then
						pg = 4
					elseif tb1 == 5 then
						pg = 5
					--[[elseif tb1 == 6 then
						pg = 6]]
					end
				elseif 	mx0 == false and ktype == 3 then
					lb = 3
				end
			elseif (lb == 1 or lb == 2) and mx1 == false and mx0 == false and ktype == 3 then
				lb = 3				
			elseif lb == 3  then
				if pg == 1 then
					for i = 1,#QZZB do
						if mx > bx*QZZB[i][1] - bx*bukuan and mx < bx*QZZB[i][1] + bx*bukuan and my > by*QZZB[i][2] - by*bugao and my < by*QZZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end
				elseif pg == 2 then	
					for i = 1,#ZFZB do
						if mx > bx*ZFZB[i][1] - bx*bukuan and mx < bx*ZFZB[i][1] + bx*bukuan and my > by*ZFZB[i][2] - by*bugao and my < by*ZFZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				elseif pg == 3 then
					for i = 1,#JFZB do
						if mx > bx*JFZB[i][1] - bx*bukuan and mx < bx*JFZB[i][1] + bx*bukuan and my > by*JFZB[i][2] - by*bugao and my < by*JFZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				elseif pg == 4 then
					for i = 1,#SDZB do
						if mx > bx*SDZB[i][1] - bx*bukuan and mx < bx*SDZB[i][1] + bx*bukuan and my > by*SDZB[i][2] - by*bugao and my < by*SDZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				elseif pg == 5 then	
					for i = 1,#QMZB do
						if mx > bx*QMZB[i][1] - bx*bukuan and mx < bx*QMZB[i][1] + bx*bukuan and my > by*QMZB[i][2] - by*bugao and my < by*QMZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				--[[elseif pg == 6 then
					for i = 1,#NGZB do
						if mx > bx*NGZB[i][1] - bx*bukuan and mx < bx*NGZB[i][1] + bx*bukuan and my > by*NGZB[i][2] - by*bugao and my < by*NGZB[i][2] + by*bugao  then
							tb = i					
							mxxx = true						
							break
						end 
					end	]]
				end		
				if mxxx == true and ktype == 3  then
					lb = 4
				end					
			elseif lb == 4  then
				if pg == 1 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = QZQX4[tb]
							if wxds - XIAODIAN >= 0 and QZQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and JY.Person[id]["??????¡¦¨¾"] - QZQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								elseif tb == 2 and 	JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1										
								elseif tb == 7 and 	JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1
								elseif tb == 11 and JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1
								elseif tb == 16 and JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1
								elseif tb == 5 and (JY.Person[id]["???????¡§????9"] >= 2  or JY.Person[id]["???????¡§????4"] >= 2) then
									PANDING = 1	
								end
								local m = {2,7,11,16,5}
								local pd = true 
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false 
									end
								end
								if  pd == true and JY.Person[id]["???????¡§????"..n] >= 2   then
									PANDING = 1	
								end							
								if PANDING ==  0 then
									PlayWavE(77)
									lb = 5
								end								
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
									JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN
									wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]				
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if QZQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
								JY.Person[id]["???????¡§????"..tb] = QZQX5[tb]						
							end	
							PlayWavE(79)					
						else
							PlayWavE(77)
							lb = 3
						end	
					end
				elseif pg == 2 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = ZFQX4[tb]
							if wxds - XIAODIAN >= 0 and ZFQX5[tb] - JY.Person[id]["??¡¦¡§???¡§????"..tb] > 0 and JY.Person[id]["??¡¦¡§????"] - ZFQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["??¡¦¡§???¡§????1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["??¡¦¡§???¡§????1"] >= 3 then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["??¡¦¡§???¡§????10"] >= 2  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["??¡¦¡§???¡§????1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["??¡¦¡§???¡§????13"] >= 2  then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["??¡¦¡§???¡§????15"] >= 2  then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["??¡¦¡§???¡§????19"] >= 2 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["??¡¦¡§???¡§????15"] >= 2  then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["??¡¦¡§???¡§????"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["??¡¦¡§???¡§????"..tb] = JY.Person[id]["??¡¦¡§???¡§????"..tb] + 1
									JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN
									wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if ZFQX5[tb] - JY.Person[id]["??¡¦¡§???¡§????"..tb] < 1 then
								JY.Person[id]["??¡¦¡§???¡§????"..tb] = ZFQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				elseif pg == 3 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = JFQX4[tb]
							if wxds - XIAODIAN >= 0 and JFQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and JY.Person[id]["????????"]+(WuyueJFSL(id)*20) - JFQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end	
								if tb == 11 and JY.Person[id]["???????¡§????10"] >= 1  then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["???????¡§????10"] >= 1  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["???????¡§????13"] >= 2 then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["???????¡§????15"] >= 2 then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["???????¡§????19"] >= 5 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["???????¡§????15"] >= 2 then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["???????¡§????"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
									JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN
									wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if JFQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
								JY.Person[id]["???????¡§????"..tb] = JFQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				elseif pg == 4 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = SDQX4[tb]
							if wxds - XIAODIAN >= 0 and SDQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and JY.Person[id]["????????"] - SDQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["???????¡§????10"] >= 2  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["???????¡§????13"] >= 2  then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["???????¡§????15"] >= 2  then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["???????¡§????19"] >= 2 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["???????¡§????15"] >= 2  then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["???????¡§????"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
									JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN	
									wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if SDQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
								JY.Person[id]["???????¡§????"..tb] = SDQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				elseif pg == 5 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = QMQX4[tb]
							if wxds - XIAODIAN >= 0 and QMQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0 and JY.Person[id]["???????¡Â"] - QMQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["???????¡§????1"] >= 3 then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["???????¡§????10"] >= 2  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["???????¡§????1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["???????¡§????13"] >= 2  then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["???????¡§????15"] >= 2  then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["???????¡§????19"] >= 2 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["???????¡§????15"] >= 2  then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["???????¡§????"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
									JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN
									wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if QMQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
								JY.Person[id]["???????¡§????"..tb] = QMQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				--[[elseif pg == 6 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then
						local PANDING = 0
						local XIAODIAN = NGQX4[tb]
						if wxds - XIAODIAN >= 0 and NGQX5[tb] - JY.Person[id]["???????¡§????"..tb] > 0  then
							local n = 0
							for ii =0,CC.MyThingNum - 1 do
								local thid = JY.Base["???¡¦" .. ii + 1]									
								if thid == 187 or thid == 188 or thid == 189 or thid == 190 or thid == 191 or thid == 193 then
									n = n + 1
								end				
							end								
							if tb == 1 and PersonKFJ(id,108)   then
								PANDING = 1										
							elseif tb == 2 and PersonKFJ(id,160) and PersonKFJ(id,87) then
								PANDING = 1
							elseif tb == 3 and PersonKFJ(id,105) and PersonKFJ(id,88) and PersonKFJ(id,93) and PersonKFJ(id,97) then
								PANDING = 1
							elseif tb == 4 and (PersonKFJ(id,91) or PersonKFJ(id,92)) and JY.Person[id]["????"] >= 100 then
								PANDING = 1
							elseif tb == 5 and PersonKFJ(id,106)  then
								PANDING = 1
							elseif tb == 6 and PersonKFJ(id,96) and PersonKFJ(id,144) then
								PANDING = 1		
							elseif tb == 7 and PersonKFJ(id,100) and  (PersonKFJ(id,94) or PersonKFJ(id,203))   then	--615????
								PANDING = 1
							elseif tb == 8 and JY.Person[id]["????"] >= 50 and (PersonKFJ(id,227) or PersonKFJ(id,183)) then
								PANDING = 1
							elseif tb == 9 and PersonKFJ(id,107)  then
								PANDING = 1			
							elseif tb == 10 and JY.Person[id]["????"] >= 50 and PersonKFJ(id,317)  then
								PANDING = 1	
							elseif tb == 11 and PersonKFJ(id,103) and PersonKFJ(id,91) and PersonKFJ(id,196) and rwnlxz(id,1) then
								PANDING = 1	
								JY.Person[id]["?¨²?¨¹???¡è"] = JY.Person[id]["?¨²?¨¹???¡è"] + 1
							elseif tb == 12 and p["¡¦?????"] >= 200 and (PersonKFJ(id,215) or PersonKFJ(id,204)) then
								PANDING = 1	
							elseif tb == 13 and PersonKFJ(id,102)  then
								PANDING = 1	
							elseif tb == 14 and ((p["????????"]+(WuyueJFSL(id)*20)) >= 200 or p["??????¡¦¨¾"] >= 200 or p["??¡¦¡§????"] >= 200 or p["????????"] >= 200 or p["???????¡Â"] >= 200) and (PersonKFJ(id,95) or PersonKFJ(id,180)) and PersonKFJ(id,90) then
								PANDING = 1	
							elseif tb == 15 and PersonKFJ(id,85) and PersonKFJ(id,98) and PersonKFJ(id,101) and PersonKFJ(id,190)  then
								PANDING = 1	
							elseif tb == 16 and PersonKF(id,233) and ((p["????????"]+(WuyueJFSL(id)*20)) >= 300 or p["??????¡¦¨¾"] >= 300 or p["??¡¦¡§????"] >= 300 or p["????????"] >= 300 or p["???????¡Â"] >= 300) then
								PANDING = 1	
							elseif tb == 17  and (PersonKFJ(id,216) or PersonKFJ(id,213)) and rwnlxz(id,0) then
								PANDING = 1	
							elseif tb == 18  and PersonKFJ(id,199) and p["???¡ì????"] >= 100 then
								PANDING = 1
							elseif tb == 19  and ((p["????????"]+(WuyueJFSL(id)*20)) >= 100 or p["??????¡¦¨¾"] >= 100 or p["??¡¦¡§????"] >= 100 or p["????????"] >= 100 or p["???????¡Â"] >= 100) and (PersonKFJ(id,154) or PersonKFJ(id,211))  then
								PANDING = 1	
							elseif tb == 20  and PersonKFJ(id,171) and (PersonKFJ(id,356) or PersonKFJ(id,177)) and JY.Person[id]["?¨§??????"]==171 then
								PANDING = 1																																																																																																																		
								else 
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["???????¡§????"..tb] = JY.Person[id]["???????¡§????"..tb] + 1
									JY.Person[id]["???¡ì????"] = JY.Person[id]["???¡ì????"] + XIAODIAN
									wxds=JY.Person[523]["????"]+JY.Person[524]["????"]+JY.Person[525]["????"]-JY.Person[id]["???¡ì????"]		
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if NGQX5[tb] - JY.Person[id]["???????¡§????"..tb] < 1 then
								JY.Person[id]["???????¡§????"..tb] = NGQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end	]]	
				end		
			elseif lb == 5 and ktype == 3 then
				lb = 3
			end
			local mxx3 = false
			if mx >= bx*829 and mx <=bx*849 and my >= by*76 and my <= by*102 then
				mxx3 = true
			end
			if mxx3 == true and ktype == 3 then
				SHUOMING = 1
			end				
		end	
	end	
end



function NGnum(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if JY.Wugong[kfid]["????????"] == 6 then
			num = num + 1
		end
	end
	return num
end
function JFnum(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if JY.Wugong[kfid]["????????"] == 3 then
			num = num + 1
		end
	end
	return num
end
function DFnum(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if JY.Wugong[kfid]["????????"] == 4 then
			num = num + 1
		end
	end
	return num
end
function QZnum(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if JY.Wugong[kfid]["????????"] == 1 then
			num = num + 1
		end
	end
	return num
end
function ZFnum(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if JY.Wugong[kfid]["????????"] == 2 then
			num = num + 1
		end
	end
	return num
end
function QMnum(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if JY.Wugong[kfid]["????????"] == 5 then
			num = num + 1
		end
	end
	return num
end
function QGnum(id)
	local num = 0
	for i = 1, JY.Base["????????"] do
		local kfid = JY.Person[id]["????"..i]
		if JY.Wugong[kfid]["????????"] == 7 then
			num = num + 1
		end
	end
	return num
end
function QUANQX(id,str)
	local a = -1
	for i = 1, #CC.QUAHZQX do
		if str == CC.QUAHZQX[i][1] then
			a = JY.Person[id]['???????¡§????'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function ZHIQX(id,str)
	local a = -1
	for i = 1, #CC.ZHIFQX do
		if str == CC.ZHIFQX[i][1] then
			a = JY.Person[id]['??¡¦¡§???¡§????'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function JIANQX(id,str)
	local a = -1
	for i = 1, #CC.JIANFQX do
		if str == CC.JIANFQX[i][1] then
			a = JY.Person[id]['???????¡§????'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end	
	return a
end
function DAOQX(id,str)
	local a = -1
	for i = 1, #CC.SHUADQX do
		if str == CC.SHUADQX[i][1] then
			a = JY.Person[id]['???????¡§????'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function QIQX(id,str)
	local a = -1
	for i = 1, #CC.QIMQX do
		if str == CC.QIMQX[i][1] then
			a = JY.Person[id]['???????¡§????'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function NEIQX(id,str)
	local a = -1
	for i = 1, #CC.NEIGQX do
		if str == CC.NEIGQX[i][1] then
			a = JY.Person[id]['???????¡§????'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end

--????????
function zssdz(pid) ----
    local a = JY.Person[pid]["?¡¦?¨½?¨²??"] * 2
    local dx = 0
    local dr = 0
    if pid == 65 then
        dx = 200
	    dr = 150
    end
    if  pid == 0 and JY.Base["??¡Á?"] > 0 then

    end
   
    for i = 1,121,60 do 
        lib.LoadPNG(90, a, CC.ScreenW/2+dx, CC.ScreenH/2+dr)
   	    ShowScreen()
    end
	ShowScreen()
	lib.Delay(100)
end

function zssdz2(pid)
    local dx = 0
    local dr = 200
    if pid == 65 then
        dx = 200
	    dr = 150
    end
    for i = 1,121,60 do 
        lib.LoadPNG(90, pid*2, CC.ScreenW/2+dx, CC.ScreenH/2+dr)
	    ShowScreen()
	    --lib.Delay(200)
    end
	ShowScreen()
	lib.Delay(100)
end

--?¨½????????????¡¦?????
function FZMS(pid)
    if match_ID(pid,520) then
		return true
	elseif match_ID(pid,517) then
	    return true
	end
	return false
end

Ct['?????¨¢??'] = function (id)
	local k = JY.Person[id]
	--local menuwai = {}
	local menu  = {}
	local ng = 0
	for i = 1, JY.Base['????????'] do
		if JY.Person[id]["????"..i] > 0 then
			local kfname = JY.Wugong[k['????'..i]]["????"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["????"..i] > 0 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['????'..i]]["????????"] == 7 then
					ng =ng + 1
					menu[i][3] = 1
				end
			end	
		end	
	end
	if ng < 2 then
		QZXS('???¨¢?¨¢????????¡Á?????')
		do return end
	end	
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng1 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"???¨½????????")
    if ng1 == 0 then
		return
	end
	menu  = {}
	for i = 1, JY.Base['????????'] do
		if JY.Person[id]["????"..i] > 0 then
			local kfname = JY.Wugong[k['????'..i]]["????"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["????"..i] > 0 and i ~= ng1 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['????'..i]]["????????"] == 7  then
					menu[i][3] = 1
				end
			end	
		end	
	end
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng2 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"???¨½????????")
    if ng2 == 0 then
		return
	end
	if ng1 > 0 and ng2 > 0 then
		JY.Wugong[380]['????'] = CONFIG.WoQGName
		JY.Wugong[380]['??¡¦?????'] = JY.Person[id]['????'..ng1]
		JY.Wugong[380]['¡Á???????'] = JY.Person[id]['????'..ng2]
		JY.Person[id]["????"..ng1] = 380
		JY.Person[id]["????????"..ng1] = 999
		JY.Person[id]['?¡Â???p??'] = 380
		for i = ng2, JY.Base['????????'] - 1 do
			if JY.Person[id]["????"..i] > 0  then
				JY.Person[id]["????"..i] = JY.Person[id]["????"..i+1]
				JY.Person[id]["????????"..i] = JY.Person[id]["????????"..i+1]
			end	
		end
		--JY.Person[0]["????" .. JY.Base["????????"]] = 0
		--JY.Person[0]["????????" .. JY.Base["????????"]] = 0
	end
end