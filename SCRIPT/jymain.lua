function IncludeFile()
	package.path=CONFIG.ScriptLuaPath;  --ÉèÖÃ¼ÓÔØÂ·¾¶
	require("jyconst")					--¼ÓÔØÆäËûÎÄ¼ş£¬Ê¹ÓÃrequire±ÜÃâÖØ¸´¼ÓÔØ
	--require("MP")
	require("jywar")
	require("jyacvmts")
	require("kdef")
	require("ItemInfo")
	require("Random mission")
	require("nino_gambling_event")
end
OEVENTLUA = {}		 --ÆæÓö×Ü»ã
function SetGlobal()  	 --ÉèÖÃÓÎÏ·ÄÚ²¿Ê¹ÓÃµÄÈ«³Ì±äÁ¿
	JY={};

	JY.Status=GAME_INIT; --ÓÎÏ·µ±Ç°×´Ì¬
	--±£´æR¡ÁÊı¾İ
	JY.Base={};          --»ù±¾Êı¾İ
	JY.PersonNum=0;      --ÈËÎï¸öÊı
	JY.Person={};        --ÈËÎïÊı¾İ
	JY.ThingNum=0        --ÎïÆ·ÊıÁ¿
	JY.Thing={};         --ÎïÆ·Êı¾İ
	JY.SceneNum=0        --³¡¾°ÊıÁ¿
	JY.Scene={};         --³¡¾°Êı¾İ
	JY.WugongNum=0       --ÎïÆ·ÊıÁ¿
	JY.Wugong={};        --ÎïÆ·Êı¾İ
	JY.ShopNum=0 		 --ÉÌµêÊıÁ¿
	JY.Shop={};    		 --ÉÌµêÊı¾İ
   
	JY.MyCurrentPic = 0		--Ö÷½Çµ±Ç°×ßÂ·ÌùÍ¼ÔÚÌùÍ¼ÎÄ¼şÖĞÆ«ÒÆ
	JY.MyPic = 0     		--Ö÷½Çµ±Ç°ÌùÍ¼
	JY.Mytick = 0			--Ö÷½ÇÃ»ÓĞ×ßÂ·µÄ³ÖĞøÖ¡Êı
	JY.MyTick2 = 0			--ÏÔÊ¾ÊÂ¼ş¶¯»­µÄ½ÚÅÄ
	JY.LOADTIME = 0
	JY.SAVETIME = 0
	JY.GTIME = 0			--ÓÎÏ·Ê±¼ä
	JY.GOLD = 0				--ÓÎÏ·ÒøÁ½
	JY.YEAR = 1
	JY.MONTH = 1
	JY.DAY = 1
	
	JY.ZLXF = 0	             --ÕæÁúĞÄ·¨¿ª¹Ø
	JY.CLXF = 0	             --²ÔÁúĞÄ·¨¿ª¹Ø
	
	JY.DIFF = 1

	JY.SubScene=-1;         --µ±Ç°×Ó³¡¾°±àºÅ
	JY.SubSceneX=0;         --×Ó³¡¾°ÏÔÊ¾Î»ÖÃÆ«ÒÆ£¬³¡¾°ÒÆ¶¯Ö¸ÁîÊ¹ÓÃ
	JY.SubSceneY=0;
	JY.ThingUse = -1;
	JY.Darkness=0;          --=0 ÆÁÄ»Õı³£ÏÔÊ¾£¬=1 ²»ÏÔÊ¾£¬ÆÁÄ»È«ºÚ

	JY.CurrentD=-1;         --µ±Ç°µ÷ÓÃD*µÄ±àºÅ
	JY.OldDPass=-1;         --ÉÏ´Î´¥·¢Â·¹ıÊÂ¼şµÄD*±àºÅ, ±ÜÃâ¶à´Î´¥·¢
	JY.CurrentEventType=-1  --µ±Ç°´¥·¢ÊÂ¼şµÄ·½Ê½ 1 ¿Õ¸ñ 2 ÎïÆ· 3 Â·¹ı

	JY.CurrentThing=-1;     --µ±Ç°Ñ¡ÔñÎïÆ·£¬´¥·¢ÊÂ¼şÊ¹ÓÃ

	JY.MmapMusic=-1;        --ÇĞ»»´óµØÍ¼ÒôÀÖ£¬·µ»ØÖ÷µØÍ¼Ê±£¬Èç¹ûÉèÖÃ£¬Ôò²¥·Å´ËÒôÀÖ

	JY.CurrentMIDI=-1;      --µ±Ç°²¥·ÅµÄÒôÀÖid£¬ÓÃÀ´ÔÚ¹Ø±ÕÒôÀÖÊ±±£´æÒôÀÖid¡£
	JY.EnableMusic=1;       --ÊÇ·ñ²¥·ÅÒôÀÖ 1 ²¥·Å£¬0 ²»²¥·Å
	JY.EnableSound=1;       --ÊÇ·ñ²¥·ÅÒôĞ§ 1 ²¥·Å£¬0 ²»²¥·Å

	WAR={};					--Õ½¶·Ê¹ÓÃµÄÈ«³Ì±äÁ¿ ÕâÀïÕ¼¸öÎ»ÖÃ£¬ÒòÎª³ÌĞòºóÃæ²»ÔÊĞí¶¨ÒåÈ«¾Ö±äÁ¿ÁË¡£¾ßÌåÄÚÈİÔÚWarSetGlobalº¯ÊıÖĞ

	AutoMoveTab = {[0] = 0}
	
	JY.Restart = 0			--·µ»ØÓÎÏ·³õÊ¼½çÃæ
	JY.WalkCount = 0		--×ßÂ·¼Æ²½
	
	
	IsViewingKungfuScrolls = 0
	
	Achievements = {}
	Achievements.pChar = {}
	
	YC={}
	YC.ZJH = 0				--Òş²ØÖ÷½ÇÕÅ¼Ò»Ô
end

function JY_Main()        --Ö÷³ÌĞòÈë¿Ú
	os.remove("debug.txt");      	  --Çå³ıÒÔÇ°µÄdebugÊä³ö
    xpcall(JY_Main_sub,myErrFun);     --²¶»ñµ÷ÓÃ´íÎó
end

function myErrFun(err)      --´íÎó´¦Àí£¬´òÓ¡´íÎóĞÅÏ¢
    lib.Debug(err);                 --Êä³ö´íÎóĞÅÏ¢
    lib.Debug(debug.traceback());   --Êä³öµ÷ÓÃ¶ÑÕ»ĞÅÏ¢
end

function JY_Main_sub()		--ÕæÕıµÄÓÎÏ·Ö÷³ÌĞòÈë¿Ú
	Ct = {};
    IncludeFile();			--µ¼ÈëÆäËûÄ£¿é
    SetGlobalConst2();		--ÉèÖÃÈ«³Ì±äÁ¿CC, ³ÌĞòÊ¹ÓÃµÄ³£Á¿
    SetGlobal();			--ÉèÖÃÈ«³Ì±äÁ¿JY

    --½ûÖ¹·ÃÎÊÈ«³Ì±äÁ¿
    setmetatable(_G,{ __newindex =function (_,n)
                       error("attempt read write to undeclared variable " .. n,2);
                       end,
                       __index =function (_,n)
                       error("attempt read read to undeclared variable " .. n,2);
                       end,
                     }  );
					
	
    lib.Debug("JY_Main start.");

	math.randomseed(os.time());			--³õÊ¼»¯Ëæ»úÊı·¢ÉúÆ÷

    JY.Status=GAME_START;				--¸Ä±äÓÎÏ·×´Ì¬

    lib.PicInit(CC.PaletteFile);		--¼ÓÔØÔ­À´µÄ256É«µ÷É«°å
	
	lib.FillColor(0,0,0,0,0);
	--¼ÓÔØ
	lib.LoadPNGPath(CC.ThingPath, 2, CC.ThingNum, limitX(CC.ScreenW/1360*100,0,100))	--ÉèÖÃ¶ÁÈ¡PNGÍ¼Æ¬µÄÂ·¾¶
	--lib.LoadPNGPath(CC.Head1Path, 2, CC.Head1Num, limitX(CC.ScreenW/1360*100,0,100))	--ÉèÖÃ¶ÁÈ¡PNGÍ¼Æ¬µÄÂ·¾¶
	-- lib.PicLoadFile(CC.WMAPPicFile[1], CC.WMAPPicFile[2], 0)
	-- lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,100))	--ÉèÖÃ¶ÁÈ¡PNGÍ¼Æ¬µÄÂ·¾¶
	-- lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)			--ÎïÆ·ÌùÍ¼£¬ÄÚ´æÇøÓò2
	-- lib.PicLoadFile(CC.EFTFile[1], CC.EFTFile[2], 3)								--ÌØĞ§ÌùÍ¼£¬ÄÚ´æÇøÓò3
	-- lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	--°ëÉíÏó
	-- lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI	
	-- lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92) 
	lib.LoadPNGPath(CC.BJPath, 92, CC.BJNum, limitX(CC.ScreenW/1360*100,0,100))	--ÉèÖÃ¶ÁÈ¡PNGÍ¼Æ¬µÄÂ·¾¶
	-- lib.LoadPNGPath('./data/mmap',93,-1,100)
	-- lib.LoadPNGPath('./data/smap',94,-1,100)
	-- lib.LoadPNGPath(CC.PTPath, 95, CC.PTNum, limitX(CC.ScreenW/1360*100,0,100))
	-- lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.LoadPNGPath('./data/thing',0,-1,100)
	-- --97ÊÇÔÆ¶ä£¬ÇĞÎğÊ¹ÓÃ
	-- lib.LoadPNGPath(CC.IconPath, 98, CC.IconNum, limitX(CC.ScreenW/1360*100,0,100))	--×´Ì¬Í¼±ê£¬ÄÚ´æÇøÓò98
	-- lib.LoadPNGPath(CC.HeadPath, 99, CC.HeadNum, 26.923076923)						--ÈËÎïĞ¡Í·Ïñ£¬ÓÃÓÚ¼¯ÆøÌõ£¬ÄÚ´æÇøÓò99
	--
	
	local pic = {"1000.png","1001.png","1002.png","1003.png"}
	
	CC.FirstFile=CONFIG.PicturePath..pic[math.random(4)];
	
	while true do
		if JY.Restart == 1 then
			JY.Restart = 0
			JY.Status=GAME_START;
		end
		if JY.Status == GAME_END then
			break;
		end
		
		PlayMIDI(75);
		Cls();
		lib.ShowSlow(20,0);
		
		local r = StartMenu();
		if r ~= nil then
			return;
		end

		lib.LoadPicture("",0,0);
		lib.GetKey();
		
		Game_Cycle();
		
	end
end

function TitleSelection()
	local choice = 1
	local pyx = 150
	local pyy = 50
	local buttons ={
	{3,6,151+pyx,460+pyy,613+pyx,507+pyy},
	{4,7,351+pyx,460+pyy,613+pyx,507+pyy},
	{5,8,551+pyx,460+pyy,613+pyx,507+pyy}
	}
	local buttons2 ={
	{3,6,226+pyx,466+pyy,345+pyx,500+pyy},
	{4,7,425+pyx,466+pyy,550+pyx,500+pyy},
	{5,8,625+pyx,466+pyy,747+pyx,500+pyy}
	}
	--[[
	local choice = 1  Ñ¡Ôñ1
	local buttons ={
	{961,964,351,340,613,387}, --{Í¼1±àºÅ£¬Í¼1µ×²ã±àºÅ,XÖá£¬Í¼1YÖá£¬£¿£¬£¿£©
	{962,965,351,400,613,447},
	{963,966,351,460,613,507}
	}
	]]
	local function on_button(mx, my)
		local r = 0
			for i = 1, #buttons2 do
				if mx >= buttons2[i][3] and mx <= buttons2[i][5] and my >= buttons2[i][4] and my <= buttons2[i][6] then
					r = i
					break
				end
			end
		return r
	end
	while true do
		if JY.Restart == 1 then
			return
		end
		local keypress, ktype, mx, my = lib.GetKey()
		if keypress == VK_DOWN or keypress == VK_RIGHT then
			choice = choice + 1
			if choice > #buttons then
				choice = 1
			end
		elseif keypress == VK_UP or keypress == VK_LEFT then
			choice = choice - 1
			if choice < 1 then
				choice = #buttons
			end
		else
			if (ktype == 2 or ktype == 3) then
				local r = on_button(mx, my)
				if r > 0 then
					choice = r
				end
			end
			if keypress == VK_RETURN or (ktype == 3 and on_button(mx, my)>0) then
				break
			end
		end
		Cls()
		for i = 1, #buttons do
			local picid = buttons[i][1]
			if i == choice then
				picid = buttons[i][2]
			end
			
			lib.LoadPNG(91, picid * 2 , buttons[i][3], buttons[i][4], 1)
		end
		--°æ±¾ºÅ
		DrawString(CC.ScreenW-115-810,CC.ScreenH-30-670,CC.Version,C_WHITE,CC.Fontsmall)
		ShowScreen()
		lib.Delay(CC.Frame)

	end
	return choice
end

function StartMenu()
	Cls()
	local menuReturn = TitleSelection()
    if menuReturn == 1 then        --ÖØĞÂ¿ªÊ¼ÓÎÏ·
    Cls()

		NewGame();   		       --ÉèÖÃĞÂÓÎÏ·Êı¾İ
		
		if JY.Restart == 1 then
			do return end
		end
		
		--³©ÏëÑî¹ı³õÊ¼³¡¾°
		if JY.Base["³©Ïë"] == 58 then
			JY.SubScene = 18
			JY.Base["ÈËX"] = 144
			JY.Base["ÈËY"] = 218
			JY.Base["ÈËX1"] = 30
			JY.Base["ÈËY1"] = 32
		else
			JY.SubScene = CC.NewGameSceneID
			JY.Base["ÈËX1"] = CC.NewGameSceneX
			JY.Base["ÈËY1"] = CC.NewGameSceneY
		end
		--ÎŞ¾Æ²»»¶£ºÄĞÅ®Ö÷½ÇÅĞ¶¨
		if JY.Person[0]["ĞÔ±ğ"] == 0 then
			JY.MyPic = CC.NewPersonPicM
		else
			JY.MyPic = CC.NewPersonPicF
		end
		JY.Status = GAME_SMAP
		JY.MmapMusic = -1
		CleanMemory()
		Init_SMap(0)
        lib.ShowSlow(20,0)
        
		--if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñ¹Û¿´ĞòÕÂ¾çÇé£¿", C_GOLD, CC.DefaultFont, LimeGreen) == true then 
			--oldCallEvent(CC.NewGameEvent)
		--end
		if DrawStrBoxYesNo(-1,-1,"ÇëÑ¡ÔñÊÇ·ñ¿ªÆô¼«ÏŞÌôÕ½£¬¼«ÏŞÌôÕ½¿ªÆôºónpc»á¸úËæÖÜÄ¿ÔöÇ¿£¬²¢Ôö¼ÓÌØÊâbuff(Y/N)?",C_WHITE,CC.DefaultFont) == true then
			Cls();
			JY.Person[456]["ÂÛ½£½±Àø"] = 1
			instruct_2(14, 1)
			instruct_2(15, 5)
			instruct_2(16, 5)
			instruct_2(348, 1)
			--±ê×¼»ñµÃ1ÍòÁ½
			if JY.Base["±ê×¼"] > 0 then
				instruct_2(174, 10000)
			end
			--ÌìÄÚµ¤ Ìì¸³ÄÚ¹¦
			if JY.Person[0]["Ìì¸³ÄÚ¹¦"] == 0 then
				instruct_2(343, 1)
			end
			--ÌìÍâµ¤ Ìì¸³Íâ¹¦
			if JY.Person[0]["Ìì¸³Íâ¹¦1"] == 0 or JY.Person[0]["Ìì¸³Íâ¹¦2"] == 0  then
				instruct_2(345, 1)
			end
			for p = 0, JY.PersonNum -1 do
				if CC.PersonExit[p] == nil and p ~= 0 and p ~= 591 then
					local tt = math.modf(1500/(JY.Person[p]['³©Ïë·Ö½×']+1))
					local xs = math.modf(1000/(JY.Person[p]['³©Ïë·Ö½×']+1))
					local wc = math.modf(500/(JY.Person[p]['³©Ïë·Ö½×']+1))
					local sz = 150+limitX(math.modf(40*(80-JY.Person[p]['³©Ïë·Ö½×'])),0,320)
					if JY.Person[p]['³©Ïë·Ö½×'] >= 0 and JY.Person[p]['³©Ïë·Ö½×'] < 3 then
						tt = tt + 480
					end	
					JY.Person[p]["¹¥»÷Á¦"] = JY.Person[p]["¹¥»÷Á¦"] + tt 
					JY.Person[p]["·ÀÓùÁ¦"] = JY.Person[p]["·ÀÓùÁ¦"] + tt 
					JY.Person[p]["Çá¹¦"] = JY.Person[p]["Çá¹¦"] + tt 
					JY.Person[p]["È­ÕÆ¹¦·ò"] = JY.Person[p]["È­ÕÆ¹¦·ò"] + xs
					JY.Person[p]["Ö¸·¨¼¼ÇÉ"] = JY.Person[p]["Ö¸·¨¼¼ÇÉ"] + xs
					JY.Person[p]["Óù½£ÄÜÁ¦"] = JY.Person[p]["Óù½£ÄÜÁ¦"] + xs
					JY.Person[p]["Ë£µ¶¼¼ÇÉ"] = JY.Person[p]["Ë£µ¶¼¼ÇÉ"] + xs
					JY.Person[p]["ÌØÊâ±øÆ÷"] = JY.Person[p]["ÌØÊâ±øÆ÷"] + xs
					if JY.Person[p]['³©Ïë·Ö½×'] <= 3 then
						JY.Person[p]["ÎäÑ§³£Ê¶"] = JY.Person[p]["ÎäÑ§³£Ê¶"] + wc
						JY.Person[p]["ÊµÕ½"] = JY.Person[p]["ÊµÕ½"] + sz
					else
						JY.Person[p]["ÎäÑ§³£Ê¶"] = JY.Person[p]["ÎäÑ§³£Ê¶"] + 100
						JY.Person[p]["ÊµÕ½"] = JY.Person[p]["ÊµÕ½"] + 100
					end		
				end
			end
		else
			Cls();
			instruct_2(14, 1)
			instruct_2(15, 5)
			instruct_2(16, 5)
			instruct_2(348, 1)
		end
		if MPPD(0) > 0 then
			MPAttrib(0)
			if MPTX(0,5,4) then
				local r = JYMsgBox(rwwh(0,1), "»¹ÇëÑ¡ÔñÒª½ÓÈÎÄÄÒ»ÔºÌÃ°É£¬    *Òª½ÓÕÆÄÄÒ»Ö°Î»£¿£¿",  {"½ğ¸ÕµîÖ÷", "ÂŞººÌÃÖ÷","´ïÄ¦ÔºÖ÷"},3 , 1055, 1)
				local str = {"½ğ¸ÕµîÖ÷", "ÂŞººÌÃÖ÷","´ïÄ¦ÔºÖ÷"}
				QZXS('½ÓÈÎ'..str[r]..'£¡')
				CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ'] = r 
			end	
		end	
		--¿ª¾ÖÊÂ¼ş
		if JY.Base["³©Ïë"] == 58 then		--³©ÏëÑî¹ı
			CallCEvent(4187)
		else								--ÆäËûÈË
			CallCEvent(691)
		end
		
		--³©Ïë¿ª¾Ö»ñµÃ×ÔÉíµÄ×°±¸
		if JY.Base["³©Ïë"] > 0 then
			if JY.Person[0]["ÎäÆ÷"] ~= - 1 and JY.Base["³©Ïë"]~= 27 then
				instruct_2(JY.Person[0]["ÎäÆ÷"], 1)
				JY.Person[0]["ÎäÆ÷"] = - 1
			end
			if JY.Person[0]["·À¾ß"] ~= - 1 then
				instruct_2(JY.Person[0]["·À¾ß"], 1)
				JY.Person[0]["·À¾ß"] = - 1
			end
			if JY.Person[0]["×øÆï"] ~= - 1 then
				instruct_2(JY.Person[0]["×øÆï"], 1)
				JY.Person[0]["×øÆï"] = - 1
			end			
		end
		--³©ÏëÒü¿ËÎ÷»ñµÃÒ»ÍòÁ½
		if JY.Base["³©Ïë"] == 158 then
			instruct_2(174, 10000)
		end	
        if JY.Base["³©Ïë"] == 721 then
            instruct_2(174, 20000)
        end
		--³©ÏëÔÆå°»ñµÃÁ½¸öÉÌ»áÁîÅÆ
		if JY.Base["³©Ïë"] == 748 then
			instruct_2(281, 3)
		end
		--³©ÏëÀîÑ°»¶»ñµÃĞ¡Àî·Éµ¶
		if JY.Base["³©Ïë"] == 498 then
			instruct_2(309, 1)
		end
		--³©ÏëÀîÑ°»¶»ñµÃĞ¡Àî·Éµ¶
		if JY.Base["³©Ïë"] == 498 then
			instruct_2(29, 99)
		end			
         --±êÖ÷¿ÉÒÔÔÚÔÆÁë¶´»¨Ç®Ñ§Ï°ÃÔ×Ù²½
		if JY.Base["±ê×¼"] > 0 then
			addevent(41, 0, 1, 4144, 1, 8694)
		end
		--ÕÅ¼Ò»ÔµÄ×¨Êô×°±¸
		if JY.Base["³©Ïë"] == 651 then
			for i = 301, 304 do
				instruct_2(i, 1)
			end
		end
		
			instruct_10(104)
			instruct_10(105)
		--ÖÜÄ¿½±Àø

        os.remove(CONFIG.DataPath..'TgJl')
        for i = 1, #CC.commodity do
            if CC.commodity[i][5] > 0 then 
                instruct_2(CC.commodity[i][1],CC.commodity[i][5])
                CC.commodity[i][5] = 0
            end
        end
        tgsave(1)
        
        CC.TGJL = {}
	elseif menuReturn == 2 then         --ÔØÈë¾ÉµÄ½ø¶È
		lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
    	DrawStrBox(-1,CC.ScreenH*1/6-20,"¶ÁÈ¡½ø¶È",LimeGreen,CC.Fontbig,C_GOLD);
		--DrawStrBox(104,CC.ScreenH*1/6+26,string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"),C_ORANGE,CC.DefaultFont,C_GOLD);
		--DrawString(200,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"), C_ORANGE, CC.DefaultFont)
    	local r = SaveList();
    	--ESC ÖØĞÂ·µ»ØÑ¡Ïî
    	if r < 1 then
    		local s = StartMenu();
    		return s;
    	end
    	
    	Cls();
		DrawStrBox(-1,CC.StartMenuY,"ÇëÉÔºò...",C_GOLD,CC.DefaultFont);
		ShowScreen();
    	local result = LoadRecord(r);
    	if result ~= nil then
    		return StartMenu();
    	end

		if JY.Base["ÎŞÓÃ"] ~= -1 then
			if JY.SubScene < 0 then
				CleanMemory()
				--lib.UnloadMMap()
			end
			--lib.PicInit()
			lib.ShowSlow(20, 1)
			JY.Status = GAME_SMAP
			JY.SubScene = JY.Base["ÎŞÓÃ"]
			JY.MmapMusic = -1
			JY.MyPic = GetMyPic()
			Init_SMap(1)
		else
			JY.SubScene = -1
			JY.Status = GAME_FIRSTMMAP
		end
	elseif menuReturn == 3 then
        return -1;
	end
end

function CleanMemory()            --ÇåÀíluaÄÚ´æ
    if CONFIG.CleanMemory==1 then
		collectgarbage("collect");
    end
end

--ÏÔÊ¾Æ´Òô
--x,yÎªÆ´ÒôÏÔÊ¾µÄ×ø±ê
function Shurufa(x, y)
	local pinyin = ""
	local word = ""
	while 1 do
	  local tmp = nil
	  pinyin, tmp = GetPinyin(x, y, word)
	  if tmp ~= nil then
		word = tmp
	  end
	  if pinyin == "finish" then
		break;
		elseif pinyin ~= -1 and pinyin ~= "" then
		  word = word .. (SeleteHanzi(x, y, word, pinyin) or "")
	  end
	end
	return word
  end
  
  --¿ÉÑ¡ÔñµÄºº×Ö
  --x,yÎªÎÄ×ÖÏÔÊ¾µÄ×ø±ê
  --wordÎªÒÑ¾­ÊäÈëºÃµÄÎÄ×Ö
  --pinyinÎªÊäÈëµÄÆ´Òô
  function SeleteHanzi(x, y, word, pinyin)
	local T1 = {
	  de = {"µÄ", "µØ", "µÃ", "µÂ", "µ×", "ï½"}, 
	  di = {"µÄ", "µØ", "µÚ", "Ìá", "µÍ", "µ×", "µÖ", "µÜ", "µÏ", "µİ", "µÛ", "µĞ", "µÌ", "µÙ", "µŞ", "µÎ", "µÓ", "µÔ", "æ·", "µÑ", "é¦", "İ¶", "ÚĞ", "µÒ", "Û¡", "àÖ", "íÆ", "Ûæ", "Ú®", "µÕ", "ïá", "íÚ", "÷¾", "Øµ", "èÜ", "ç°", "Ùá", "ôÆ", "íû", "êë"}, 
	  yi = {"Ò»", "ÒÔ", "ÒÑ", "Òâ", "Òé", "Òå", "Òæ", "ÒÚ", "Ò×", "Ò½", "ÒÕ", "ÒÀ", "ÒÆ", "ÒÂ", "Òì", "ÒÁ", "ÒÇ", "ÒË", "ÒÅ", "ÒÉ", "Òã", "Òê", "Òà", "Òß", "ÒÛ", "Òä", "ÒÖ", "ÒÒ", "Òë", "Òí", "Òç", "ÒÎ", "ÒÊ", "Òİ", "ÒÏ", "ÒÄ", "ÒØ", "âù", "Òï", "ÒÍ", "Òá", "ÒÌ", "ìÚ", "êİ", "ÒÓ", "ÒÙ", "ÒÃ", "ÒĞ", "Òè", "ÒÈ", "ŞÈ", "Òî", "ŞÄ", "éó", "æä", "Ò¼", "â¢", "ÒÜ", "ß®", "Ò¿", "ì½", "äô", "åÆ", "Øı", "ñ´", "Ú±", "âø", "ğê", "Ü²", "âÂ", "á»", "Ò¾", "íô", "ï×", "Øî", "÷ğ", "ÒŞ", "ßŞ", "ôè", "ŞÚ", "çË", "ß½", "Ø×", "ß×", "áÚ", "ôà", "îÆ", "éì", "Üè", "Ş²", "òæ", "ïî", "àæ", "ñ¯", "ÜÓ", "ã¨", "àÉ", "ğù", "ì¥", "Ù«", "Ûü", "Ûİ", "ô¯", "ôı", "Øæ"}, 
	  guo = {"¹ú", "¹ı", "¹û", "¹ù", "¹ø", "¹ü", "àş", "ÎĞ", "é¤", "òå", "ë½", "ñø", "Ûö", "Şâ", "â£", "áÆ", "òä", "ßÃ", "Ùå"}, 
	  zai = {"ÔÚ", "ÔÙ", "ÔÖ", "ÔØ", "ÔÔ", "×Ğ", "Ô×", "ÔÕ", "áÌ", "çŞ"}, 
	  ren = {"ÈË", "ÈÎ", "ÈÏ", "ÈÊ", "ÈÌ", "ÈÍ", "ÈĞ", "ÈÒ", "â¿", "ÈÑ", "Üó", "ïş", "ÈÉ", "Øğ", "éí", "ñÅ", "İØ"}, 
	  le = {"ÁË", "ÀÖ", "ÀÕ", "Àß", "ß·", "÷¦", "Øì", "ãî"}, 
	  liao = {"ÁË", "ÁÏ", "ÁÆ", "ÁÉ", "ÁÎ", "ÁÄ", "ÁÈ", "ÁÅ", "ÁÇ", "çÔ", "ÁÌ", "ÁÃ", "àÚ", "ÁÊ", "ÁÍ", "å¼", "Ş¤", "â²", "îÉ", "ŞÍ", "ğÓ"}, 
	  you = {"ÓĞ", "ÓÉ", "ÓÖ", "ÓÅ", "ÓÎ", "ÓÍ", "ÓÑ", "ÓÒ", "ÓÊ", "ÓÈ", "ÓÇ", "Ó×", "ÓÌ", "ÓÕ", "ÓÆ", "ÓÄ", "ÓÓ", "ÓÔ", "èÖ", "ÓË", "öÏ", "àó", "ÓÏ", "Øü", "÷î", "İ¬", "éà", "òö", "ğà", "ßÏ", "òÊ", "İµ", "İ¯", "îğ", "å¶", "ôí", "ØÕ", "ë»", "÷ø", "òø", "ŞÌ", "òÄ", "Ù§"}, 
	  zhong = {"ÖĞ", "ÖØ", "ÖÖ", "ÖÚ", "ÖÕ", "ÖÓ", "ÖÒ", "ÖÙ", "ÖÔ", "Ö×", "õà", "Ú£", "ÖÑ", "âì", "ïñ", "ô±", "ó®"}, 
	  shi = {"ÊÇ", "ÊĞ", "Ê±", "Êµ", "ÊÂ", "Ê®", "Ê¹", "ÊÀ", "Ê©", "Ê½", "ÊÆ", "ÊÓ", "Ê¶", "Ê¦", "Ê·", "Ê¾", "Ê¯", "Ê³", "Ê¼", "Ê¿", "Ê§", "ÊÊ", "ÊÔ", "Ê²", "ÊÒ", "ËÆ", "Ê«", "ÊÎ", "Ö³", "ÊÍ", "Ê»", "ÊÏ", "ÊÅ", "Êª", "Ê´", "Ê¨", "ÊÄ", "Ê°", "Ê¬", "³×", "ÊË", "ÊÁ", "Ê¸", "ÖÅ", "ÊÌ", "ÊÉ", "ÊÈ", "ÊÃ", "Ğê", "Êº", "ÊÑ", "éø", "Ê­", "óÂ", "İª", "îæ", "ÚÖ", "ìÂ", "õ¹", "öå", "ó§", "õ§", "óß", "Ûõ", "ß±", "İé", "öõ", "êÛ"}, 
	  nian = {"Äê", "Äî", "Äğ", "Õ³", "Äë", "Ø¥", "Äí", "Äì", "Äé", "Äè", "öó", "Ûş", "öÓ", "éı", "ğ¤"}, 
	  he = {"ºÍ", "ºÏ", "ºÓ", "ºÎ", "ºË", "ºØ", "ºÈ", "ºÕ", "ºÉ", "ºĞ", "º×", "ÏÅ", "ºÇ", "ºÌ", "ºÊ", "ÛÖ", "ºÖ", "ºÔ", "ºÒ", "ãØ", "ÛÀ", "Ú­", "ò¢", "àÀ", "ºÑ", "êÂ", "ôç", "æü", "òÂ", "îÁ"}, 
	  hu = {"ºÍ", "»¤", "»§", "ºË", "ºş", "»¥", "ºõ", "ºô", "ºú", "Ï·", "ºö", "»¢", "»¦", "ºı", "ºø", "ºù", "ºü", "ºû", "»¡", "º÷", "ä°", "ğÀ", "çú", "ìè", "»£", "äï", "ã±", "ìï", "àñ", "õú", "óË", "õ­", "â©", "âï", "ßü", "ìæ", "éÎ", "ì²", "ìÎ", "ğÉ", "Ùü", "ğ­", "á²", "ğ×", "ìÃ", "éõ"}, 
	  huo = {"ºÍ", "»î", "»ò", "»õ", "»ñ", "»ğ", "»ï", "»ó", "»ô", "»ö", "»í", "àë", "Ş½", "ïÁ", "ó¶", "îØ", "ñë", "ïì", "â·", "Øå", "ß«"}, 
	  da = {"´ó", "´ï", "´ò", "´ğ", "Ëş", "´î", "í³", "´ñ", "àª", "ßÕ", "ŞÇ", "÷²", "ğã", "÷°", "ñ×", "óÎ", "âò", "æ§"}, 
	  dai = {"´ó", "´ú", "´ø", "´ı", "´û", "´÷", "´ü", "´õ", "´ô", "´ş", "á·", "´ö", "µ¡", "´ù", "÷ì", "ß°", "Ü¤", "çª", "çé", "ß¾", "åÊ", "ææ"}, 
	  ye = {"Òµ", "Ò²", "Ò¹", "Ò¶", "Ò°", "Òº", "Ò±", "Ò³", "Ò¯", "Ò®", "Ğ°", "ÑÊ", "Ò¬", "»©", "ìÇ", "Ò´", "×§", "Ò·", "êÊ", "ÚË", "Ò¸", "Ò­", "ŞŞ", "ØÌ", "Úş", "îô"}, 
	  bu = {"²»", "²¿", "²½", "²¼", "²¹", "²¶", "±¤", "ÆÒ", "²·", "²º", "²¾", "²¸", "²À", "îĞ", "ß²", "ê³", "åÍ", "êÎ", "õ³", "îß"}, 
	  wei = {"Îª", "Î»", "Î¯", "Î´", "Î¬", "ÎÀ", "Î§", "Î¥", "Íş", "Î°", "Î£", "Î¶", "Î¢", "ÒÅ", "Î¨", "Î½", "Î±", "Î¿", "Î²", "Îº", "Î¤", "Î¸", "Î·", "á¡", "Î¹", "Î¡", "Î®", "Îµ", "Î³", "Î«", "Î¾", "Î¼", "Î©", "Ş±", "Î­", "ì¿", "Û×", "æ¸", "ÚÃ", "çâ", "áË", "Î¦", "ÙË", "åÔ", "â«", "àí", "İÚ", "Úó", "ğô", "â¬", "ä¶", "áÍ", "è¸", "ìĞ", "ôº", "àø", "ãÇ", "ä¢", "ãí", "Úñ", "öÛ", "ê¦"}, 
	  fa = {"·¢", "·¨", "·£", "·¦", "·¥", "·§", "·¤", "íÀ", "ÛÒ", "·©"}, 
	  hui = {"»á", "»Ø", "»Ó", "»ã", "»İ", "»Ô", "»Ö", "»Õ", "»æ", "»Ù", "»Û", "»Ò", "»ß", "»Ü", "»Ú", "»²", "»à", "À£", "Üö", "êÍ", "åç", "»ä", "»å", "çõ", "¶é", "Ú¶", "Ş¥", "»Ş", "÷â", "»â", "Üî", "à¹", "èí", "»×", "ä§", "ä«", "ò³", "í£", "ó³", "ßÔ", "ãÄ", "çÀ", "ßÜ"}, 
	  kuai = {"»á", "¿ì", "¿é", "¿ê", "ëÚ", "Øá", "¿ë", "ä«", "Û¦", "áö", "ßà"}, 
	  gong = {"¹¤", "¹«", "¹²", "¹©", "¹¦", "ºì", "¹±", "¹¥", "¹¬", "¹®", "¹¨", "¹§", "¹°", "¹ª", "¹­", "¹¯", "ò¼", "çî", "ö¡", "ëÅ"}, 
	  jing = {"¾µ", "¾©", "¾«", "¾³", "¾º", "¾°", "¾¯", "¾¹", "¾®", "¾ª", "¾¶", "¾­","¾²", "¾¢", "¾´", "¾»", "¾µ", "¾¦", "¾§", "¾£", "¾¤", "¾¸", "ãş", "ã½", "¾¨", "¾¥", "ëæ", "İ¼", "ëÖ", "Úå", "ìº", "¾¬", "ö¦", "¾·", "ÙÓ", "åÉ", "æº", "ëÂ", "ØÙ", "åò", "â°"}, 
	  shang = {"ÉÏ", "ÉÌ", "ÉĞ", "ÉË", "ÉÍ", "ÌÀ", "ÉÑ", "ÉÊ", "ÉÎ", "Ûğ", "õü", "éä", "ìØ", "ç´"}, 
	  yao = {"Òª", "Ô¼", "Ò©", "Ñû", "ÌÕ", "Ò¡", "Ò«", "Ñü", "Ò£", "Ò¦", "Ò¤", "Ñş", "Ò§", "Ò¢", "Ô¿", "Ò¥", "ëÈ", "Ø²", "½Ä", "ßº", "Å±", "Ñı", "çÛ", "èÃ", "Ò¨", "ñº", "ê×", "ğÎ", "Ø³", "ôí", "áæ", "é÷", "ï¢", "÷¥", "áÊ", "çò"}, 
	  ge = {"¸ö", "ºÏ", "¸÷", "¸ï", "¸ñ", "¸è", "¸ç", "¸Ç", "¸ô", "¸î", "¸ó", "¸ê", "¸ğ", "¸ë", "¸é", "ÒÙ", "¸ì", "ô´", "¸í", "¸õ", "÷À", "¸ò", "¿©", "ÛÙ", "ïÓ", "ò¢", "Øî", "íÑ", "àÃ", "Øª", "ëõ", "æü", "ñË", "ë¡", "Üª", "ÛÁ", "ò´"}, 
	  chan = {"²ú", "µ¥", "²û", "²ø", "²ô", "ìø", "²ü", "²ù", "²õ", "²ó", "äı", "ó¸", "²ö", "âã", "æ¿", "åî", "êè", "âÜ", "ÚÆ", "²÷", "å¤", "æö", "åñ", "ïâ", "õğ", "İÛ", "Ùæ"}, 
	  zhe = {"Õâ", "Õß", "×Å", "Õã", "ÕÛ", "ÕÜ", "Õá", "ÕÚ", "ÕŞ", "éü", "èÏ", "Õà", "ñŞ", "òØ", "Õİ", "ğÑ", "ÚØ", "ô÷", "ß¡", "íİ"}, 
	  chu = {"³ö", "´¦", "´¡", "³õ", "³ı", "´¢", "Ğó", "´¥", "³ş", "³ø", "³û", "´£", "³÷", "³ú", "ñÒ", "³ü", "³ù", "âğ", "ç©", "´¤", "Û»", "òÜ", "÷í", "èÆ", "õé", "Ø¡", "éË", "ãÀ", "èú"}, 
	  xing = {"ĞĞ", "Ê¡", "ĞÔ", "ĞÎ", "ĞÍ", "ĞË", "ĞÇ", "ĞÌ", "ĞÒ", "ĞÕ", "ĞÑ", "ĞÏ", "ĞÓ", "ĞÈ", "ĞÉ", "ã¬", "Üş", "Úê", "ĞÊ", "â¼", "ß©", "íÊ", "Üô"}, 
	  hang = {"ĞĞ", "º½", "º¼", "Ïï", "º»", "¿Ô", "çñ", "ãì", "ç¬", "ñş"}, 
	  heng = {"ĞĞ", "ºâ", "ºá", "ºã", "ºà", "ºß", "çñ", "èì", "Ş¿"}, 
	  zuo = {"×÷", "×ö", "×ù", "×ó", "×ø", "×ò", "×ô", "×Á", "Ôä", "´ê", "´é", "ìñ", "×õ", "ßò", "àÜ", "âô", "óĞ", "Úè", "ëÑ"}, 
	  sheng = {"Éú", "Ê¡", "Éù", "Éı", "Ê¤", "Ê¢", "³Ë", "Ê¥", "Ê£", "Éü", "Éş", "óÏ", "Éû", "áÓ", "êÉ", "äÅ", "íò"}, 
	  jia = {"¼Ò", "¼Ó", "¼Û", "¼Ù", "¼Ñ", "¼Ü", "¼×", "¼Î", "¼Ö", "¼İ", "¼Ş", "¼Ğ", "¼Ú", "¼Ø", "ÇÑ", "Ğ®", "åÈ", "Ù¤", "¼Õ", "ä¤", "¼Ï", "ê©", "¼Ô", "ğè", "ïØ", "óÕ", "çì", "áµ", "ëÎ", "ØÅ", "ôÂ", "Û£", "İç", "ñÊ", "ğı", "îò", "õÊ", "òÌ", "í¢"}, 
	  jie = {"¼Ò", "½á", "½â", "¼Û", "½ç", "½Ó", "½Ú", "½ì", "½é", "½×", "½Ö", "½è", "½Ü", "½à", "½Ø", "½ã", "½Ò", "½İ", "½Ù", "½ä", "½Ô", "½ß", "½Û", "½ë", "¿¬", "½Õ", "½Ş", "½å", "Ş×", "½æ", "Úµ", "íÙ", "àµ", "ò¡", "ò»", "æİ", "æ¼", "ğÜ", "èî", "Ú¦", "½ê", "ÙÊ", "ôÉ", "à®", "öÚ", "÷º"}, 
	  cheng = {"³É", "³Ì", "³Ç", "³Ğ", "³Æ", "Ê¢", "³Ë", "³Ï", "³Ê", "³Í", "³Å", "³Î", "³Ó", "³È", "³Ò", "³Ñ", "îª", "Ø©", "îõ", "Ûô", "ëó", "àá", "òÉ", "èß", "îñ", "õ¨", "ñÎ", "èÇ"}, 
	  dao = {"µ½", "µÀ", "µ¼", "µº", "µ¹", "µ¶", "µÁ", "µ¾", "µ¸", "µ¿", "µ·", "ß¶", "µ»", "ìâ", "ë®", "ôî", "àü", "âá"}, 
	  ri = {"ÈÕ"}, 
	  min = {"Ãñ", "Ãô", "Ãö", "ãÉ", "Ãó", "ãı", "áº", "Ãõ", "çë", "Ãò", "ö¼", "çÅ", "çä", "íª", "Üå", "÷ª"}, 
	  lai = {"À´", "À³", "Àµ", "íù", "áâ", "ô¥", "äµ", "êã", "äş", "ñ®", "áÁ", "ïª"}, 
	  wo = {"ÎÒ", "ÎÕ", "ÎÑ", "ÎÖ", "ÎÔ", "ÎÎ", "ÎĞ", "ÎÓ", "ä×", "á¢", "ÎÏ", "à¸", "ÙÁ", "İ«", "ö»", "ë¿", "íÒ"}, 
	  dui = {"¶Ô", "¶Ó", "¶Ø", "¶Ò", "¶Ñ", "íÔ", "í¡", "í­"}, 
	  jin = {"½ø", "½ğ", "½ñ", "½ü", "½ö", "½ô", "¾¡", "½ò", "½ï", "½û", "½õ", "¾¢", "½ú", "½÷", "½î", "½í", "½ş", "½ó", "½ù", "èª", "½ı", "çÆ", "êî", "İÀ", "âË", "İ£", "àä", "âÛ", "æ¡", "éÈ", "êá", "ñÆ", "Úá"}, 
	  duo = {"¶à", "¶È", "¶á", "¶ä", "¶ã", "îì", "ßÍ", "¶é", "¶æ", "ÍÔ", "¶â", "¶è", "¶ß", "õâ", "¶å", "¶Ş", "¶ç", "èŞ", "ç¶", "ãõ", "ñÖ", "ßá"}, 
	  quan = {"È«", "È¨", "È¯", "Èª", "È¦", "È­", "È°", "È®", "îı", "È¬", "Ú¹", "Üõ", "È©", "òé", "È§", "ç¹", "óÜ", "÷Ü", "ãª", "éú", "î°"}, 
	  jian = {"½¨", "¼ä", "¼ş", "¼û", "¼á", "¼ì", "½¡", "¼à", "¼õ", "¼ò", "¼è", "¼ù", "¼æ", "¼ø", "¼ü", "½¥", "¼í", "½£", "¼â", "¼ç", "½¢", "¼ö", "¼ı", "Ç³", "¼ô", "¼ó", "¼î", "¼ë", "¼é", "¼ß", "¼ğ", "¼ñ", "¼å", "¼ú", "½¦", "¼÷", "½§", "¼ã", "ÚÉ", "½¤", "ïµ", "¼ê", "íú", "åÀ", "å¿", "ëì", "İÑ", "ôå", "ê¯", "ë¦", "óÈ", "êù", "¼ï", "÷µ", "êğ", "èÅ", "äÕ", "öä", "àî", "ñĞ", "õİ", "Şö", "çÌ", "ğÏ", "İó", "ÚÙ", "ÙÔ", "ê§", "õÂ", "é¥"}, 
	  ta = {"Ëû", "Ëü", "Ëı", "ÍØ", "Ëş", "Ì¤", "Ëú", "é½", "í³", "äğ", "Ì¡", "àª", "Ì¢", "Ì£", "õÁ", "åİ", "îè", "÷£", "äâ", "ãË"}, 
	  kai = {"¿ª", "¿­", "¿®", "¿¬", "âı", "¿«", "ïÇ", "îø", "âé", "Ûî", "ØÜ", "ï´", "İÜ"}, 
	  men = {"ÃÇ", "ÃÅ", "ÃÆ", "ŞÑ", "ìË", "í¯", "îÍ"}, 
	  chang = {"³¡", "³¤", "³§", "³£", "³¥", "²ı", "³ª", "³©", "³«", "³¢", "³¦", "³¨", "ÌÈ", "²ş", "æ½", "ÉÑ", "áä", "êÆ", "âê", "æÏ", "İÅ", "öğ", "ãÑ", "Øö", "ÜÉ", "ë©", "ã®", "ÛË"}, 
	  zhan = {"Õ¹", "Õ½", "Õ¼", "Õ¾", "Õ¸", "Õ³", "Õ¿", "Õ´", "Õ°", "²ü", "Õ²", "Õ¶", "Õµ", "Õ·", "ÕÀ", "Õ±", "Õ»", "Õº", "ì¹", "ÚŞ", "Şø"}, 
	  li = {"Àí", "Á¦", "Àû", "Á¢", "Àï", "Àî", "Àú", "Àı", "Àë", "Àø", "Àñ", "Àö", "Àè", "Á§", "À÷", "Àå", "Á£", "Àò", "Àæ", "Á¥", "Àõ", "Àó", "Á¤", "Àç", "Àì", "Á¨", "Àê", "Ş¼", "î¾", "Àé", "Àğ", "íÂ", "Àô", "å¢", "Àş", "æê", "äà", "Àù", "İ°", "ï®", "óÒ", "ó»", "òÃ", "Á¡", "ö¨", "Ù³", "Àü", "õ·", "èİ", "Ûª", "Ùµ", "èÀ", "à¬", "åÎ", "æ²", "ğ¿", "ìå", "à¦", "ÛŞ", "ğİ", "òÛ", "÷ó", "áû", "Øª", "ôÏ", "İñ", "ß¿", "õÈ", "ğß", "çÊ", "öâ", "÷¯", "æË", "îº", "ã¦", "ÜÂ", "óö", "éö"}, 
	  xin = {"ĞÂ", "ĞÄ", "ĞÅ", "Ñ°", "ĞÁ", "ĞÀ", "Ğ½", "Ü°", "öÎ", "Ğ¾", "Ğ¿", "ĞÃ", "ê¿", "ĞÆ", "ì§", "Ø¶", "ïâ"}, 
	  fang = {"·½", "·Å", "·¿", "·À", "·Ã", "·Ä", "·¼", "·Â", "·»", "·Á", "·¾", "Úú", "ô³", "áİ", "èÊ", "öĞ", "îÕ"}, 
	  zhu = {"Ö÷", "Êõ", "×¡", "×¢", "Öú", "Êô", "Öğ", "Öø", "Öş", "×¤", "Öì", "Öé", "×£", "Öí", "Öî", "Öù", "Öñ", "Öı", "Öê", "Öõ", "Öö", "Öü", "Öó", "Öò", "ñÒ", "Öë", "Öô", "îù", "ä¨", "óÃ", "Öû", "ä¾", "Øù", "èÌ", "Ùª", "Öï", "Üï", "óç", "ìÄ", "õî", "ôã", "äó", "Û¥", "éÆ", "ô¶", "éÍ", "ğñ", "÷æ", "ğæ"}, 
	  qi = {"Ææ", "Æä", "Æğ", "ÆÚ", "Æø", "Æß", "Æ÷", "Æû", "Ææ", "Æë", "Æô", "Æì", "Æå", "ÆŞ", "Æú", "Æç", "ÆÛ", "Æï", "Æõ", "Æù", "Ø½", "Æá", "Æİ", "Æñ", "»ü", "áª", "çù", "ÆÜ", "¼©", "ç÷", "Æü", "Æò", "Æö", "Æî", "Æé", "ç²", "ì÷", "õè", "Æí", "Æà", "ä¿", "è½", "Æê", "÷è", "Ûß", "á«", "í¬", "ÜÎ", "Ù¹", "Æè", "Üù", "êÈ", "İİ", "Æã", "İÂ", "æë", "÷¢", "ôë", "Æı", "Ş­", "á¨", "ñı", "ØÁ", "íÓ", "Æâ", "ãà", "ôì", "İ½", "àÒ", "òÓ", "éÊ", "ì¥", "Ü»", "èç", "òà"}, 
	  zi = {"×Ê", "×Ô", "×Ó", "×Ö", "×É", "×Ì", "×Ğ", "×Ë", "×Ï", "×È", "×Î", "×Í", "×Ñ", "è÷", "öö", "×Õ", "æ¢", "Ö¨", "ïö", "í§", "æÜ", "ö¤", "×Ò", "ïÅ", "ê¢", "ôô", "ö·", "êß", "íö", "ç»", "ßÚ", "óÊ", "ÚÑ", "áÑ", "÷Ú", "Üë", "ôÒ", "õş", "ñè"}, 
	  xue = {"Ñ§", "Ñª", "Ñ©", "Ï÷", "Ñ¦", "Ñ¨", "Ñ¥", "ÚÊ", "àå", "÷¨", "õ½", "í´"}, 
	  bao = {"±¨", "±£", "°ü", "±¦", "±©", "°û", "±¡", "±¬", "ÅÚ", "±¥", "±§", "±¤", "°ş", "±«", "ÆØ", "İá", "ÆÙ", "±ª", "ÅÙ", "°ı", "±¢", "æß", "°ú", "ìÒ", "ñÙ", "õÀ", "ğ±", "öµ"}, 
	  zhi = {"ÖÆ", "Ö®", "ÖÎ", "ÖÊ", "Ö°", "Ö»", "Ö¾", "ÖÁ", "Ö¸", "Ö¯", "Ö§", "Öµ", "Öª", "Ê¶", "Ö±", "ÖÂ", "Ö´", "ÖÃ", "Ö¹", "Ö²", "Ö½", "ÖÇ", "Ö³", "ÖÈ", "Ö¼", "Ö·", "ÖÍ", "ÊÏ", "Ö¦", "Ö¥", "Ö¬", "ÖÄ", "Ö­", "Ö«", "Ö¿", "ÖÉ", "õ¥", "ÖÀ", "ÖÅ", "ÖË", "èÎ", "Ö¶", "ÜÆ", "ÖÏ", "åë", "Ö¨", "Öº", "ÖÌ", "Ö©", "Û¤", "èä", "ïô", "ìí", "Úì", "ğë", "òÎ", "àù", "è×", "õÜ", "áç", "ëÕ", "èÙ", "êŞ", "ìó", "õô", "ğº", "Şı", "éò", "Ø´", "éù", "åé", "ö£", "ôê", "õÅ", "Ûú", "íé", "âå", "æï", "ëù", "õÙ"}, 
	  zheng = {"Õş", "Õı", "Ö¤", "Õù", "Õû", "Õ÷", "Ö£", "¶¡", "Ö¢", "Õõ", "Õô", "Õö", "ï£", "óİ", "Õü", "Ö¡", "á¿", "Õú", "Úº", "Õø", "áç", "îÛ"}, 
	  ji = {"¼Ã", "»ú", "Æä", "¼¼", "»ù", "¼Ç", "¼Æ", "Ïµ", "¸ï", "ÆÚ", "¼Ê", "¼°", "¼¯", "¼¶", "¼¸", "¸ø", "»ı", "¼«", "¼º", "¼Í", "¼´", "¼Ì", "»÷", "¼È", "¼¤", "¼¨", "¼±", "Ææ", "¼ª", "¼¾", "Æë", "¼²", "¼£", "¼¦", "¼Á", "¼­", "¼®", "¼Ä", "¼·", "»ø", "¼½", "Ø½", "¼Å", "ôß", "¼¹", "õÒ", "¼¡", "»ü", "¼É", "¼¢", "¼À", "¼©", "¼¬", "í¶", "¼³", "»û", "¼§", "½å", "ñ¤", "æ÷", "î¿", "¼Ë", "¼¥", "ğ¢", "¼»", "¼Â", "¼µ", "á§", "ß´", "¼¿", "öê", "Úµ", "é®", "Üù", "êª", "»ş", "ö«", "ïú", "êé", "÷ä", "çÜ", "çá", "óÅ", "ê÷", "Ü¸", "ßó", "åì", "÷Ù", "ê«", "Ù¥", "ÙÊ", "óÇ", "õÕ", "İğ", "ØÀ", "ßÒ", "êå", "áÕ", "ò±", "Şá", "ì´", "éê", "öİ", "ØŞ", "ä©", "Ø¢", "ÛÔ", "Şª", "ÜÁ", "ßâ"}, 
	  yong = {"ÓÃ", "ÓÀ", "Óµ", "ÓÂ", "Ó¿", "Ó¾", "Ó¹", "Ù¸", "Ó»", "Ó¶", "Ó½", "Óº", "ğ®", "ïŞ", "Ó·", "çß", "Ó¼", "ÓÁ", "ã¼", "ÛÕ", "Ó¸", "÷«", "Ü­", "÷Ó", "à¯"}, 
	  tong = {"Í¬", "Í¨", "Í³", "Í¯", "Í´", "Í­", "Í°", "Í©", "Í²", "Í®", "¶±", "Ù¡", "äü", "Í±", "Íª", "íÅ", "Í«", "âú", "á¼", "ÙÚ", "¶²", "àÌ", "Ûí", "Üí"}, 
	  yu = {"ÓÚ", "Óë", "Óı", "Óà", "Ô¤", "Óò", "Óè", "Óö", "Óï", "Óş", "Óñ", "Óã", "Óê", "Óæ", "Ô£", "¹È", "Óú", "Óé", "Óû", "Óõ", "Óß", "Óî", "Óğ", "Óâ", "Ô¥", "Óô", "Ô¢", "Óü", "Ó÷", "Óù", "Ô¡", "Óä", "Óí", "Óá", "Îµ", "ÓÜ", "ÓŞ", "Óå", "Î¾", "ÓÙ", "Óİ", "Óì", "Óø", "Öà", "Ô¦", "è¤", "Ø®", "Ø¹", "îÚ", "Óç", "Óó", "ìÙ", "ğö", "ÓØ", "ìÏ", "êÅ", "ì¶", "ô§", "ÓÛ", "í²", "óÄ", "İÇ", "åı", "ëé", "àô", "ÚÍ", "êì", "Şí", "ö¹", "ÚÄ", "Ù¶", "âÅ", "â×", "æ¥", "ğõ", "å÷", "ì£", "ëò", "ğÖ", "ãĞ", "áÎ", "ö§", "ğÁ", "İÒ", "àö", "òâ", "Øñ", "æú", "ñ¾", "ñÁ", "âÀ", "İ÷", "áü", "ô¨", "òõ", "ìÛ"}, 
	  gao = {"¸ß", "¸æ", "¸ã", "¸å", "¸à", "¸â", "¸ä", "¸Ş", "¸á", "ï¯", "ê½", "Û¬", "Øº", "Ú¾", "Ş»", "¸İ", "çÉ", "éÂ", "éÀ"}, 
	  zhang = {"³¤", "ÕÅ", "ÕÂ", "ÕÏ", "ÕÇ", "ÕÆ", "ÕÊ", "ÕÍ", "ÕÃ", "ÕÉ", "ÕÌ", "ÕÄ", "ÕÁ", "ÕË", "ÕÈ", "è°", "áÖ", "Øë", "ÕÎ", "ó¯", "â¯", "á¤", "Ûµ", "æÑ"}, 
	  xian = {"ÏÖ", "ÏÈ", "ÏØ", "¼û", "Ïß", "ÏŞ", "ÏÔ", "ÏÕ", "Ï×", "ÏÊ", "Ï´", "ÏÜ", "ÏË", "Ïİ", "ÏĞ", "ÏÍ", "ÏÉ", "ÏÎ", "ÏÆ", "ÏÌ", "ÏÓ", "ÏÛ", "ÏÒ", "ÏÙ", "ğï", "æµ", "ÏÏ", "ÏÚ", "õ£", "Ï³", "Ùş", "ÏÑ", "åß", "ôÌ", "ÏÇ", "ÜÈ", "ò¹", "õÑ", "á­", "Şº", "ìŞ", "ğÂ", "ë¯", "İ²", "ö±", "õĞ", "áı", "ìì", "óÚ"}, 
	  ben = {"±¾", "±¼", "±½", "±¿", "º»", "êÚ", "ï¼", "ÛÎ", "ÛĞ"}, 
	  yue = {"ÔÂ", "Ëµ", "Ô¼", "Ô½", "ÀÖ", "Ô¾", "ÔÄ", "ÔÀ", "ÔÁ", "ÔÃ", "Ô»", "Ô¿", "èİ", "îá", "éĞ", "å®", "Ùß", "ë¾"}, 
	  ding = {"¶¨", "¶©", "¶¥", "¶¡", "¶¦", "¶¢", "¶¤", "¶§", "¶£", "Øê", "îú", "î®", "ôú", "à¤", "íÖ", "ëë", "ğÛ", "çà", "ñô"}, 
	  hua = {"»¯", "»ª", "»®", "»°", "»¨", "»­", "»¬", "»©", "»í", "æè", "èë", "»«", "îü", "í¹"}, 
	  dong = {"¶¯", "¶«", "¶­", "¶¬", "¶´", "¶®", "¶³", "¶°", "¶±", "ßË", "á¼", "ë±", "¶²", "ëØ", "íÏ", "Ûí", "ğ´", "á´", "ëË"}, 
	  pin = {"Æ·", "Æ¶", "Æ¸", "Æµ", "Æ´", "Æ»", "ŞÕ", "ò­", "æ°", "æÉ", "é¯", "êò"}, 
	  chong = {"ÖØ", "ÖÖ", "³ä", "³å", "Ó¿", "³ç", "³æ", "³è", "âç", "ã¿", "ô©", "Üû", "ï¥", "ô¾"}, 
	  guan = {"¹Ø", "¹Ü", "¹Û", "¹İ", "¹Ù", "¹á", "¹Ú", "¹ß", "¹à", "¹Ş", "İ¸", "ÂÚ", "¹×", "ñæ", "ÙÄ", "ğÙ", "÷¤", "îÂ", "Şè", "äÊ"}, 
	  fen = {"·Ö", "·İ", "·×", "·Ü", "·Û", "·Õ", "·Ò", "·ß", "·à", "·Ø", "·Ú", "·Ù", "·Ó", "·Ô", "·Ş", "èû", "çã", "÷÷", "å¯", "ÙÇ", "ö÷"}, 
	  wai = {"Íâ", "Íá"}, 
	  qu = {"Çø", "È¥", "È¡", "ÇÒ", "Çú", "Ç÷", "Çş", "È¤", "Çı", "Çü", "Çû", "áé", "È¢", "ìî", "öÄ", "Ğç", "á«", "È£", "êï", "ëÔ", "òĞ", "ñ³", "Çù", "ÜÄ", "ãÖ", "Ú°", "Û¾", "Ş¡", "Ş¾", "ë¬", "÷ñ", "ó½", "è³", "ôğ", "ğ¶", "íá"}, 
	  ou = {"Çø", "Å·", "Å¼", "Å¹", "Å»", "Åº", "Ú©", "Å¸", "ê±", "Å½", "ñî", "âæ"}, 
	  neng = {"ÄÜ"}, 
	  she = {"Éè", "Éç", "Éã", "Éæ", "Éä", "ÕÛ", "Éá", "Éß", "Éà", "Éİ", "Éå", "Éâ", "ÉŞ", "ÙÜ", "÷ê", "ì¨", "î´", "ØÇ", "ß¡", "â¦", "äÜ"}, 
	  hou = {"ºó", "ºò", "ºñ", "ºî", "ºï", "ºí", "ºğ", "åË", "óó", "ô×", "÷¿", "áá", "ö×", "ğú", "Ü©"}, 
	  jiu = {"¾Í", "¾¿", "¾Å", "¾Æ", "¾Ã", "¾È", "¾É", "¾À", "¾Ë", "¾Ä", "¾Î", "¾¾", "¾Ì", "¾Â", "¾Á", "¾Ê", "èÑ", "ôñ", "ğ¯", "ğÕ", "¾Ç", "à±", "ãÎ", "èê", "ÙÖ", "÷İ"}, 
	  deng = {"µÈ", "µÇ", "µË", "µÆ", "³Î", "µÊ", "µÉ", "µÅ", "àâ", "íã", "áØ", "ïë", "ô£", "ê­"}, 
	  ti = {"Ìå", "Ìá", "Ìâ", "Ìæ", "Ìİ", "Ìß", "Ìè", "ÌŞ", "Ìã", "Ìä", "Ìë", "Ìê", "Ìé", "Ìà", "ÙÃ", "ã©", "åÑ", "Ìç", "Üè", "õ®", "ç°", "ğÃ", "ç¾", "ñÓ"}, 
	  xia = {"ÏÂ", "ÏÄ", "Ï¿", "ÏÃ", "Ï½", "Ï¼", "Ïº", "ÏÁ", "ÏÅ", "ÏÀ", "Ï¾", "åÚ", "Ï¹", "Ï»", "è¦", "»£", "ßÈ", "÷ï", "íÌ", "óÁ", "áò", "ğı", "èÔ"}, 
	  wan = {"Íò", "Íê", "Íí", "Íå", "Íæ", "Íë", "Íç", "Íì", "Íä", "Âû", "Íè", "İ¸", "Íî", "Íğ", "Íñ", "Íó", "òê", "Íï", "Íé", "Ãä", "çş", "îµ", "Íã", "Øà", "æı", "çº", "ëä", "İÒ", "Ü¹"}, 
	  mo = {"Íò", "ÎŞ", "Ã»", "Ä£", "Ä©", "Ã°", "Äª", "Ä¦", "Ä«", "Ä¬", "Ä¥", "Ãş", "Ä®", "Âö", "Ä¤", "Ä§", "Ä­", "Ä°", "Ä¨", "Ä¯", "Ä¢", "Ä¡", "İë", "âÉ", "ÜÔ", "ºÙ", "ÚÓ", "ï÷", "ºÑ", "æÆ", "ïÒ", "éâ", "ñò", "ñ¢", "õö", "õø"}, 
	  yuan = {"Ôª", "Ô±", "Ôº", "Ô­", "Ô´", "Ô¶", "Ô¸", "Ô°", "Ô®", "Ô²", "Ôµ", "Ô¬", "Ô¹", "Ô¨", "Ô·", "Ô©", "æÂ", "Ô³", "Ô«", "ãä", "Ü«", "Ûù", "Ô§", "Ô¯", "ğ°", "è¥", "à÷", "ë¼", "Ü¾", "ö½", "éÚ", "ó¢", "íó", "óî", "Şò"}, 
	  qian = {"Ç°", "Ç§", "Ç®", "Ç©", "Ç±", "Ç¨", "Ç·", "ÏË", "Ç£", "Ç³", "Ç²", "Ç«", "Ç¬", "Ç¦", "Ç¸", "Ç­", "Ç´", "Ç¶", "Ù»", "Ç¯", "Üç", "ò¯", "Çµ", "Ç¥", "å¹", "Úä", "Şç", "îÔ", "Ç¤", "Ü·", "êù", "óè", "İ¡", "Çª", "ÜÍ", "ã¥", "ç×", "Ùİ", "í©", "å½", "ëÉ", "á©", "åº", "óé", "ã»", "èı"}, 
	  mian = {"Ãæ", "ÃŞ", "Ãâ", "Ãà", "Ãå", "Ãã", "Ãß", "Ãá", "Ãä", "ëï", "äÅ", "äÏ", "ãæ", "íí"}, 
	  nong = {"Å©", "Å¨", "Åª", "Å§", "Ù¯", "ßæ"}, 
	  shuo = {"Ëµ", "Êı", "Ë¶", "Ë¸", "Ë·", "îå", "åù", "éÃ", "İô", "Ş÷"}, 
	  shui = {"Ëµ", "Ë®", "Ë°", "Ë­", "Ë¯"}, 
	  yun = {"Ô±", "ÔË", "¾ù", "ÔÆ", "ÔÊ", "ÔĞ", "ÔÌ", "ÔÏ", "ÔÍ", "ÔÅ", "ÔÎ", "ÔÈ", "Ü¿", "ÔÉ", "ç¡", "ìÙ", "ÔÇ", "ã¢", "è¹", "Û©", "ëµ", "éæ", "ã³", "êÀ", "áñ"}, 
	  er = {"¶ø", "¶ş", "¶û", "¶ù", "¶ú", "åÇ", "¶ü", "¶ı", "·¡", "îï", "çí", "Ù¦", "ğ¹", "öÜ"}, 
	  wu = {"Îñ", "Îï", "ÎŞ", "Îå", "Îä", "Îç", "Îâ", "Îè", "Îé", "ÎÛ", "ÎÚ", "Îó", "Íö", "¶ñ", "Îİ", "Îî", "Îò", "Îá", "Îí", "Îß", "Îà", "Îğ", "Î×", "Îê", "Îë", "Îã", "ÎÜ", "ÎØ", "ÎÙ", "Úù", "Îæ", "ğÍ", "Ø£", "æÄ", "åü", "ì¶", "Îì", "ğÄ", "ä´", "òÚ", "ßí", "æğ", "Øõ", "ìÉ", "ÜÌ", "öÈ", "âĞ", "÷ù", "êõ", "âä", "ÛØ", "âè", "ğí", "åÃ", "è»", "å»", "Úã"}, 
	  dian = {"µç", "µã", "µê", "µä", "µì", "µé", "µâ", "µí", "µî", "µæ", "µß", "µá", "ñ²", "áÛ", "µë", "µà", "ñ°", "çè", "µè", "õÚ", "µå", "îä", "ô¡", "Ûã", "Úç"}, 
	  wen = {"ÎÄ", "ÎÊ", "ÎÅ", "ÎÈ", "ÎÂ", "ÎÆ", "ÎÇ", "ÎÃ", "ö©", "ÎÉ", "ÎÁ", "ãë", "ØØ", "è·", "ãÓ"}, 
	  ke = {"¿É", "¿Æ", "¿Ë", "¿Í", "¿Ì", "¿Î", "¿Å", "¿Ê", "¿Ç", "¿Â", "¿Ã", "ºÇ", "¿À", "ã¡", "¿Á", "¿È", "¿Ä", "çæ", "ïı", "î§", "äÛ", "éğ", "ñ½", "à¾", "ğâ", "òò", "á³", "ò¤", "÷Á", "ç¼", "ë´", "æì", "îİ", "ï¾"}, 
	  zong = {"×Ü", "×Û", "×Ú", "×İ", "×Ù", "×Ø", "ôÕ", "××", "ÙÌ", "èÈ", "ëê"}, 
	  xmjc = {"Áã", "¾µ", "Ææ", "¶ş", "ËÄ", "Æß", "Ë®"}, 
	  gai = {"¸Ä", "¸Ã", "¸Ç", "¸Å", "¸È", "¸Æ", "Ø¤", "½æ", "êà", "Ûò", "Úë", "ê®"}, 
	  san = {"Èı", "É¢", "É¡", "Èş", "ôÖ", "âÌ", "ë§"}, 
	  hao = {"ºÃ", "ºÅ", "ºÁ", "ºÀ", "ºÄ", "ºÆ", "ºÂ", "ğ©", "ê»", "¸ä", "İï", "º¾", "å°", "º¿", "å©", "òº", "ºÑ", "ò«", "àÆ", "Ş¶", "àã"}, 
	  si = {"Ë¾", "ËÄ", "Ë¼", "Ë¹", "Ê³", "Ë½", "ËÀ", "ËÆ", "Ë¿", "ËÇ", "ËÂ", "²Ş", "ËÁ", "Ëº", "ãô", "ËÅ", "ËÃ", "ìë", "ØË", "æá", "Ë»", "ïÈ", "Ù¹", "ËÈ", "òÏ", "ßĞ", "ñê", "óÓ", "ğ¸", "çÁ", "äù", "æ¦", "ãá", "ÛÌ", "Ùî"}, 
	  cong = {"´Ó", "´Ô", "´Ò", "´Ï", "´Ğ", "´Ñ", "çı", "äÈ", "æõ", "ÜÊ", "è®"}, 
	  ping = {"Æ½", "ÆÀ", "Æ¾", "Æ¿", "·ë", "ÆÁ", "Æ¼", "Æ»", "Æ¹", "Æº", "èÒ", "æ³", "Ù·", "öÒ"}, 
	  dang = {"µ±", "µ³", "µµ", "µ´", "µ²", "å´", "í¸", "ñÉ", "ÛÊ", "İĞ", "ÚÔ"}, 
	  tian = {"Ìì", "Ìï", "Ìí", "Ìî", "Ìğ", "Ìñ", "Ìó", "µè", "Ìò", "ãÙ", "ãÃ", "éå", "î±", "Şİ"}, 
	  nei = {"ÄÚ", "ÄÇ", "ÄÄ", "ÄÙ"}, 
	  xiao = {"Ğ¡", "Ğ§", "Ïú", "Ïû", "Ğ£", "Ïş", "Ğ¦", "Ğ¤", "Ï÷", "Ğ¢", "Ïô", "äì", "Ïõ", "Ïü", "Ğ¥", "Ïù", "Ïö", "Ïı", "Ïø", "óã", "åĞ", "óï", "æç", "èÉ", "ßØ", "ç¯", "òÙ", "áÅ", "èÕ", "÷Ì"}, 
	  mu = {"Ä¿", "Ä£", "Ä¾", "Ä¶", "Ä»", "Ä¸", "ÄÁ", "ÄÂ", "Ä·", "Ä¹", "Ä½", "Ä²", "Äµ", "Ä¼", "ÄÀ", "ãå", "Äº", "Ä´", "ÀÑ", "îâ", "ÜÙ", "Øï", "ë¤", "Ûé"}, 
	  hai = {"º£", "»¹", "º¦", "º¢", "º¥", "¿È", "º¡", "ºÙ", "º§", "º¤", "àË", "ëÜ", "õ°"}, 
	  suo = {"Ëù", "Ë÷", "Ëõ", "Ëø", "É¯", "Ëó", "Ëö", "àÂ", "Ëô", "ßï", "æ¶", "Ëò", "ôÈ", "êı", "èø", "àÊ", "íü"}, 
	  ru = {"Èë", "Èç", "Èé", "Èå", "Èè", "Èê", "Èã", "Èì", "Èæ", "å¦", "Èä", "àé", "çÈ", "äá", "ï¨", "ä²", "Ş¸", "ñà", "ò¬", "İê"}, 
	  liang = {"Á¿", "Á½", "Á¸", "Á¼", "Á¾", "ÁÁ", "Áº", "Á¹", "ÁÂ", "Á»", "ÁÀ", "ö¦", "õÔ", "İ¹", "é£", "÷Ë", "Ü®"}, 
	  du = {"¶È", "¶¼", "¶À", "¶½", "¶Á", "¶Ù", "¶¾", "¶É", "¶Å", "¶Â", "¶Ä", "¶Ã", "¶Ç", "¶Æ", "äÂ", "óÆ", "à½", "¶¿", "¶Ê", "ë¹", "ó¼", "èü", "÷ò", "Ü¶", "÷Ç"}, 
	  bei = {"±±", "±»", "±¸", "±¶", "±³", "±­", "±´", "±²", "±¯", "±®", "±Û", "±°", "ã£", "±¹", "İí", "Úé", "±µ", "±·", "ßÂ", "±º", "íÕ", "ñØ", "Ûı", "÷¹", "ØÃ", "ğÇ", "İÉ", "Úı", "öÍ"}, 
	  huan = {"»¹", "»·", "»»", "»¶", "»¼", "»º", "»½", "»À", "»Ã", "»¾", "»¸", "å¾", "»Á", "»Â", "ä¡", "ä½", "»¿", "Û¼", "Û¨", "à÷", "âµ", "öé", "÷ß", "İÈ", "åÕ", "äñ", "ïÌ", "çÙ", "ß§"}, 
	  dou = {"¶¼", "¶·", "¶Á", "¶¹", "¶¶", "¶µ", "¶¸", "¶º", "ñ¼", "ò½", "¶»", "İú", "óû"}, 
	  shu = {"Êõ", "Êé", "Êı", "Êô", "Ê÷", "Êä", "Êø", "Êö", "Êğ", "Êì", "Êâ", "Êß", "Êæ", "Êè", "Êó", "Êç", "Êå", "Êî", "Êà", "Êû", "Óá", "Êï", "Êã", "Êú", "Êñ", "Êí", "Êá", "Êù", "Ë¡", "Êë", "ãğ", "Êê", "Êü", "Êş", "ÛÓ", "Ù¿", "äø", "ç£", "æ­", "İÄ", "Êò", "ëò", "ïø", "ë¨", "ì¯", "Şó", "Ø­"}, 
	  ming = {"Ã÷", "Ãû", "Ãü", "ÃË", "Ãù", "Ãú", "Ú¤", "Üø", "äé", "õ¤", "î¨", "Ãø", "êÔ"}, 
	  zhao = {"×Å", "ÕÕ", "ÕĞ", "ÕÒ", "ÕÙ", "³¯", "ÕÔ", "Õ×", "ÕÑ", "ÕØ", "ÕÖ", "îÈ", "ÕÓ", "³°", "×¦", "Ú¯", "ßú", "èş", "óÉ"}, 
	  zhuo = {"×Å", "Öø", "½É", "×À", "×¿", "×½", "×Á", "×Æ", "×Ç", "×Ã", "×¾", "×Â", "äÃ", "ïí", "×Ä", "åª", "ìÌ", "Ù¾", "ßª", "í½", "èş", "ÚÂ", "ä·", "ìú"}, 
	  ci = {"´Î", "´Ë", "´Ê", "´Ç", "´Ì", "´É", "´Å", "×È", "´È", "´Ä", "´Í", "ìô", "ËÅ", "´Æ", "´Ã", "ğË", "ôÙ", "ßÚ", "Üë"}, 
	  jiang = {"½«", "Ç¿", "½­", "½±", "½²", "½µ", "½®", "½¯", "½ª", "½¬", "½³", "½´", "½©", "½°", "ç­", "çÖ", "êñ", "ôø", "íä", "ä®", "Üü", "ôİ", "ñğ"}, 
	  qiang = {"½«", "Ç¿", "ÇÀ", "Ç½", "Ç¹", "Ç»", "ïÏ", "Çº", "Ç¼", "Ç¾", "ñß", "ôÇ", "õÄ", "éÉ", "ãŞ", "æÍ", "ê¨", "ìÁ", "ïê", "ïº", "òŞ"}, 
	  zeng = {"Ôö", "Ôø", "×Û", "Ôù", "Ô÷", "ï­", "êµ", "îÀ", "çÕ"}, 
	  xiang = {"Ïò", "Ïî", "Ïà", "Ïë", "Ïç", "Ïó", "Ïì", "Ïã", "½µ", "Ïñ", "Ïí", "Ïä", "Ïé", "Ïæ", "Ïê", "Ïğ", "Ïï", "Ïè", "Ïå", "Ïá", "Ïâ", "÷Ï", "âÃ", "ç½", "æø", "Ü¼", "âÔ", "öß", "İÙ", "ó­"}, 
	  ying = {"Ó¦", "Óª", "Ó°", "Ó¢", "Ó­", "Ó³", "Ó²", "Ó¯", "Ó®", "Ó±", "Ó¤", "Ó¥", "Ó«", "Ó¨", "Ó£", "çø", "Ó¬", "İÓ", "İº", "ò£", "âß", "Ó§", "å­", "éº", "ó¿", "Üş", "Ó©", "ğĞ", "äŞ", "İö", "Û«", "Üã", "àÓ", "è¬", "Ùø", "ñ¨", "ëô", "Şü", "äë"}, 
	  mei = {"ÃÀ", "Ã»", "Ã¿", "Ãº", "Ã·", "Ã½", "Ã¶", "ÃÃ", "Ã¼", "÷È", "Ã¹", "ÃÕ", "ÃÁ", "ÃÄ", "Ãµ", "Ã¸", "Ã¾", "äØ", "ÃÂ", "İ®", "ñÇ", "é¹", "ÃÓ", "áÒ", "ïÑ", "ä¼", "â­", "ğÌ"}, 
	  gui = {"¹æ", "¹ó", "¹é", "¹ì", "¹ğ", "¹ñ", "¹ç", "¹í", "¹è", "¹å", "¹ò", "¹ê", "¹ë", "¹î", "¹ï", "È²", "÷¬", "èí", "ğ§", "öÙ", "¹ô", "êĞ", "¿ş", "æ£", "êÁ", "âÑ", "óş", "ØÛ", "å³", "ØĞ"}, 
	  xie = {"Ğ©", "½â", "Ğ­", "Ğ´", "Ñª", "Ò¶", "Ğ»", "Ğµ", "Ğ¬", "Ğ²", "Ğ±", "Ğ¯", "Ğ¸", "Æõ", "Ğ¶", "Ğ³", "Ğ¹", "Ğ·", "Ğ°", "Ğª", "Ğº", "Ğ¼", "Ğ®", "ÛÆ", "é¿", "Ğ«", "ß¢", "ÙÉ", "Ùô", "Ğ¨", "ò¡", "çÓ", "åâ", "å¬", "ÛÄ", "éÇ", "Ş¯", "ç¥", "äÍ", "âİ", "â³", "õó"}, 
	  biao = {"±í", "±ê", "±ë", "É×", "ïÚ", "ñÑ", "±ì", "ì­", "ïğ", "æ»", "æô", "ì©", "è¼", "÷Ô", "÷§", "ñ¦"}, 
	  xi = {"Ïµ", "Î÷", "Ï¯", "Ï¢", "Ï£", "Ï°", "Îü", "Ï²", "Ï¸", "Îö", "Ï·", "Ï´", "Ï¤", "Îı", "Ïª", "Ï§", "Ï¡", "Ï®", "Ï¦", "Îú", "Îô", "Îş", "À°", "Ï©", "Îõ", "Ï±", "ÆÜ", "Ï¥", "Ï¶", "Ï¬", "õè", "Îø", "Ùâ", "Ï¨", "êØ", "ìû", "Üç", "æÒ", "çô", "ŞÉ", "Ï«", "áã", "ôË", "Ï³", "äÀ", "Îû", "ì¨", "ìä", "Îù", "ó¬", "Û­", "ßñ", "ğª", "Úô", "éØ", "ä»", "òá", "Ï­", "ôâ", "ãÒ", "ô¸", "åï", "İß", "ó£", "ôÑ", "êê", "ì¤", "ÙÒ", "õµ", "÷û", "ñÓ", "ñ¶", "â¾", "ôª", "ìù", "İ¾", "İû"}, 
	  ban = {"°ì", "°æ", "°ë", "°à", "°ã", "°å", "°ä", "°é", "°á", "°ß", "°ç", "°è", "°â", "°ê", "Ûà", "Úæ", "°í", "îÓ", "ñ£", "ô²", "ñ­"}, 
	  jiao = {"½Ì", "½»", "½Ï", "Ğ£", "½Ç", "¾õ", "½Ğ", "½Å", "½É", "½º", "½Î", "½¼", "½¹", "½¾", "½½", "½·", "½¸", "Ù®", "½¿", "½Ã", "½Á", "½Ê", "½Í", "½Ë", "½À", "½È", "½Ñ", "õÓ", "òÔ", "½Ä", "½Æ", "æ¯", "ğ¨", "Üú", "á½", "½Â", "õ´", "öŞ", "äĞ", "áè", "ğÔ", "ÙÕ", "àİ", "Ü´", "ŞØ", "ë¸"}, 
	  tiao = {"Ìõ", "µ÷", "Ìô", "Ìø", "Ìö", "Ì÷", "Üæ", "ñ»", "óÔ", "Ù¬", "ôĞ", "÷Ø", "ìö", "ö¶", "òè", "öæ"}, 
	  zui = {"×î", "×ï", "¶Ñ", "×ì", "×í", "¾×", "Ş©"}, 
	  te = {"ÌØ", "ìı", "ß¯", "ï«", "í«"}, 
	  shou = {"ÊÕ", "ÊÖ", "ÊÜ", "Ê×", "ÊÛ", "ÊÚ", "ÊØ", "Êì", "ÊÙ", "Êİ", "ÊŞ", "á÷", "ç·", "ô¼"}, 
	  bing = {"²¢", "²¡", "±ø", "±ù", "ÆÁ", "±ı", "±ş", "±ü", "±û", "Şğ", "±ú", "éÄ", "Ù÷", "Úû"}, 
	  an = {"³§", "¹ã", "°²", "°¸", "°´", "°¶", "°µ", "°°", "°±", "°³", "°·", "ï§", "ÚÏ", "âÖ", "÷ö", "ğÆ", "èñ", "Ûû", "áí", "Şî"}, 
	  kou = {"¿Ú", "¿Û", "¿Ü", "ßµ", "¿Ù", "Ş¢", "ÜÒ", "íî", "óØ"}, 
	  diao = {"µ÷", "µô", "µñ", "Äñ", "µõ", "µö", "µó", "õõ", "µò", "µï", "öô", "µğ", "ï¢", "îö"}, 
	  zu = {"×é", "×å", "×ã", "×æ", "×â", "×è", "×ä", "ÙŞ", "×ç", "ïß", "İÏ"}, 
	  lu = {"Â·", "ÂÊ", "ÂÉ", "ÂÃ", "Áù", "Â½", "Â¼", "ÂÌ", "ÂÇ", "Â¶", "Â³", "Â¬", "Â¯", "ÂÄ", "ÂÀ", "ÂÁ", "ÂÅ", "Â¹", "Â»", "Â¸", "Â«", "Â®", "Âµ", "ÂÈ", "ÂÆ", "ÂË", "Â´", "ÂÂ", "Â­", "Â¿", "ãò", "Â±", "Âº", "ğØ", "ê¤", "éµ", "Â²", "è´", "äõ", "àà", "ãÌ", "ñÚ", "Â¾", "öÔ", "Â°", "éÖ", "éñ", "åÖ", "äË", "Ş¤", "ß£", "ğµ", "èÓ", "ëª", "ëÍ", "ïå", "óü", "ëö", "ôµ", "éû", "ïù", "Ûä"}, 
	  guang = {"¹ã", "¹â", "¹ä", "áî", "ë×", "ßÛ", "èæ"}, 
	  bi = {"±È", "±Ø", "±Ò", "±Ê", "±Ï", "ÃØ", "±Ü", "±Õ", "±Ù", "±Ú", "±×", "±Ë", "±Æ", "±Ì", "±Ç", "±Û", "±Î", "·÷", "ÃÚ", "èµ", "±Ó", "±Ô", "±Ğ", "åö", "Ø°", "±É", "±İ", "ñÔ", "êÚ", "±Ö", "±Í", "ßÁ", "ó÷", "ÙÂ", "îé", "±Ñ", "óÙ", "İ©", "Şµ", "æ¾", "ßÙ", "õÏ", "Ûı", "å¨", "ïõ", "Üê", "ã¹", "î¢", "åş", "ÜÅ", "óë", "âØ", "÷Â", "î¯", "ää", "áù", "İÉ", "æÔ", "ôÅ", "ô°"}, 
	  tou = {"Í¶", "Í·", "Í¸", "Íµ", "î×", "÷»"}, 
	  jue = {"¾ö", "¾ø", "½Ç", "¾õ", "½Å", "¾ò", "áÈ", "¾÷", "â±", "¾ñ", "¾ô", "½À", "¾ó", "ØÊ", "Ş§", "¾ğ", "çå", "ÛÇ", "õê", "ÚÜ", "ïã", "àµ", "àå", "èö", "àÙ", "¾ï", "éÓ", "æŞ", "õû", "Øã", "ìß"}, 
	  nan = {"ÄÏ", "ÄÑ", "ÄĞ", "éª", "à«", "àï", "ôö", "ëî", "àî", "òï"}, 
	  na = {"ÄÏ", "ÄÇ", "ÄÉ", "ÄÃ", "ÄØ", "ÄÄ", "ÄÈ", "ÄÆ", "ÄÅ", "Şà", "ñÄ", "ïÕ", "ëÇ"}, 
	  ling = {"Áì", "Áî", "Áí", "Áã", "Áé", "Áä", "Áê", "Áë", "Áè", "Áá", "Áå", "Áâ", "Àâ", "Áæ", "Áà", "Áç", "Üß", "ñö", "ôá", "ãö", "ê²", "àò", "ç±", "ßÊ", "èù", "òÈ", "Û¹", "öì", "èÚ"}, 
	  qing = {"Çé", "Çà", "Çå", "Çë", "Ç×", "Çá", "Çì", "Çã", "Çê", "Çä", "Çç", "Çâ", "Çæ", "Çè", "óÀ", "íà", "òß", "óä", "öë", "ôì", "ÜÜ", "÷ô", "àõ", "éÑ", "ö¥"}, 
	  shan = {"É½", "µ¥", "ÉÆ", "ÉÂ", "ÉÁ", "ÉÀ", "ÉÃ", "ÉÇ", "ÉÈ", "É¼", "Éº", "ìø", "É¾", "ÉÅ", "ÉÉ", "ÉÄ", "Û·", "Õ¤", "É¿", "æ©", "õÇ", "÷­", "æÓ", "äú", "Ú¨", "ô®", "É»", "ğŞ", "µ§", "ëş", "îÌ", "Øß", "óµ", "ÜÏ", "Ûï", "æó"}, 
	  che = {"³µ", "³¹", "³·", "³ß", "³¶", "³º", "³¸", "Ûå", "íº"}, 
	  ju = {"³µ", "¾Ö", "¾İ", "¾ß", "¾Ù", "¾Ó", "¾ç", "¾Ş", "¾Û", "¾à", "¾ä", "¾Ü", "¾ã", "¹ñ", "¾Õ", "¾Ğ", "¾æ", "½Û", "¾å", "¾Ø", "¾Ï", "¾Ô", "¾â", "¾á", "¾×", "öÄ", "èÛ", "Şä", "¾Ú", "Üì", "éÙ", "ì«", "¾Ò", "îÒ", "ôò", "õá", "åá", "è¢", "ö´", "é§", "ÜÄ", "ñÕ", "é°", "¾Ñ", "ÙÆ", "é·", "ÜÚ", "Úª", "öÂ", "ï¸", "ñÀ", "÷¶", "êø", "åğ", "õ¶"}, 
	  ran = {"È»", "È¾", "È¼", "È½", "ÜÛ", "÷×", "òÅ"}, 
	  yin = {"Òò", "Òı", "Òø", "Ó¡", "Òô", "ÑÌ", "Òû", "Òõ", "Òş", "Òö", "Òó", "Òù", "Òü", "Òñ", "Ò÷", "ñ«", "Òú", "Òğ", "Ûß", "Ûó", "Û´", "äÎ", "ò¾", "ë³", "Ø·", "ö¸", "ñ¿", "à³", "î÷", "ä¦", "áş", "â¹", "ßÅ", "ö¯", "Üá", "Ü§"}, 
	  ba = {"°Ñ", "°Ë", "°Í", "°Î", "°É", "°Ó", "°Ö", "°Ô", "°Õ", "°Å", "°Ï", "°Ç", "°È", "°Ğ", "°Ì", "°Ê", "°Ò", "öÑ", "ôÎ", "á±", "å±", "îÙ", "°Æ", "İÃ", "÷É", "ÜØ"}, 
	  chi = {"³Ö", "³Ô", "³Ø", "³Ù", "³à", "³Û", "³ß", "³â", "³İ", "³á", "³×", "³Õ", "³Ü", "³ã", "³Ş", "³Ú", "ß³", "à´", "Ûæ", "àÍ", "Ü¯", "ßê", "Üİ", "ôù", "ë·", "ó×", "âÁ", "õØ", "ò¿", "æÊ", "÷Î", "óø", "ñİ", "áÜ", "ğ·", "ó¤", "ñ¡", "í÷", "ÙÑ"}, 
	  dan = {"µ«", "µ¥", "Ê¯", "µ£", "µ¤", "µ¨", "µ©", "µ¯", "µ°", "µ­", "µ®", "µª", "µ¦", "µ¢", "éé", "µ¬", "ÙÙ", "íñ", "ğã", "å£", "µ§", "à¢", "óì", "ñõ", "İÌ", "ğ÷", "êæ"}, 
	  cun = {"´å", "´æ", "´ç", "¶×", "ââ", "ñå"}, 
	  qiu = {"Çó", "Çò", "Çï", "Çğ", "Çñ", "³ğ", "Çõ", "ôÃ", "¹ê", "Çô", "åÙ", "öú", "ò°", "òÇ", "Çö", "é±", "äĞ", "áì", "åÏ", "ÛÏ", "Ù´", "òø", "êä", "÷ü", "ôÜ"}, 
	  fu = {"¸®", "·ş", "¸±", "¸º", "¸»", "¸´", "¸£", "·ò", "¸¾", "·ù", "¸¶", "·ö", "¸¸", "·û", "¸½", "¸¯", "¸°", "·ğ", "¸¡", "¸²", "¸¨", "¸µ", "·ü", "¸§", "¸³", "·ø", "¸¹", "¸¥", "·ô", "¸·", "¸¤", "¸¿", "¸¦", "·ú", "¸«", "æÚ", "·ó", "¸©", "·÷", "·ı", "¸À", "¸­", "·õ", "Ü½", "¸¢", "¸ª", "¸¬", "Üò", "ğ¥", "ç¦", "¸¼", "ß»", "î·", "ôï", "òğ", "Ùë", "ÜÀ", "òİ", "õÆ", "Ùì", "äæ", "òó", "æâ", "ç¨", "ò¶", "íÉ", "èõ", "êç", "İÊ", "õÃ", "ÜŞ", "ŞÔ", "öÖ", "âö", "ïû", "Û®", "İ³", "á¥", "ìğ", "åõ", "íê", "íë", "öû"}, 
	  yan = {"ÑĞ", "ÑÏ", "Ñé", "Ñİ", "ÑÔ", "ÑÛ", "ÑÌ", "ÑØ", "ÑÓ", "ÑÎ", "Ñ×", "Ñà", "ÑÒ", "Ñç", "ÑŞ", "ÑÕ", "Òó", "Ñå", "ÑÚ", "ÑÍ", "ÑÖ", "ÑÜ", "Ç¦", "Ñã", "ÑÊ", "Ñá", "Ñæ", "Ñß", "Ñâ", "Ñä", "ÑÉ", "êÌ", "éÜ", "ÑÑ", "ÑÙ", "Ù²", "ëç", "åû", "Ñè", "Ùğ", "óÛ", "ìÍ", "ÙÈ", "ãÆ", "æÌ", "Û³", "äÎ", "ØÍ", "ëÙ", "çü", "äÙ", "ÑË", "÷Ê", "õ¦", "Û±", "âû", "áÃ", "Ü¾", "ãÕ", "Øß", "÷ú", "İÎ", "÷Ğ", "Úİ", "ØÉ", "î»", "Úç"}, 
	  jun = {"¾ü", "¾ù", "¿¡", "¾ı", "¾ş", "¾ú", "¿¢", "¾û", "¿¥", "¹ê", "¿£", "¿¤", "óŞ", "ñä", "÷å", "ŞÜ"}, 
	  yo = {"Óı", "Ó´", "à¡"}, 
	  gan = {"¸É", "¸Ğ", "¸Ï", "¸Ò", "¸Ê", "¸Î", "¸Ë", "¸Ó", "Ç¬", "¸Ì", "ŞÏ", "¸Í", "¸Ñ", "éÏ", "í·", "äÆ", "ÜÕ", "ß¦", "ôû", "ç¤", "ãï", "Ûá", "êº", "ğá", "ä÷"}, 
	  tuan = {"ÍÅ", "ÍÄ", "î¶", "ŞÒ", "åè"}, 
	  zao = {"Ôì", "Ôç", "Ôâ", "Ôæ", "Ôë", "Ôî", "Ôï", "Ôã", "Ôä", "Ôê", "Ôå", "Ôí", "Ôè", "Ôé", "ßğ"}, 
	  lian = {"Áª", "Á¬", "Á·", "Á®", "Á¶", "Á³", "Á«", "Áµ", "Á´", "Á±", "Á¯", "Á°", "Á²", "çö", "Á­", "å¥", "é¬", "öã", "éç", "äò", "ñÍ", "ñÏ", "ì¡", "ŞÆ", "ó¹", "İü"}, 
	  zhuan = {"×¨", "×ª", "´«", "×¬", "×©", "×«", "×­", "ãç", "âÍ", "ßù", "ò§"}, 
	  shao = {"ÉÙ", "ÉÜ", "ÕÙ", "ÉÕ", "ÉÔ", "ÉÛ", "ÉÚ", "ÉØ", "ÉÓ", "É×", "ÉÒ", "ÇÊ", "ÉÖ", "Üæ", "Û¿", "ô¹", "óâ", "è¼", "òÙ", "äû"}, 
	  fei = {"·Ñ", "·Ç", "·É", "·Ê", "·Ï", "·Æ", "·Î", "·È", "·Ğ", "·Ë", "ì³", "òã", "åú", "·Ì", "ìé", "ôä", "ö­", "·Í", "ç³", "ëè", "ğò", "ÜÀ", "äÇ", "ã­", "áô", "é¼", "öî", "óõ", "ïĞ"}, 
	  shen = {"Éî", "²Î", "Éí", "Éñ", "Ê²", "Éó", "Éê", "Éõ", "Éò", "Éì", "É÷", "Éø", "Éö", "Éğ", "İ·", "Éë", "Éô", "Éï", "Éé", "ò×", "ßÓ", "é©", "İØ", "äÉ", "Ú·", "ÚÅ", "ïò", "ëÏ"}, 
	  geng = {"¸ü", "¸û", "¾±", "¸ı", "¹¢", "¹£", "¹¡", "¸ş", "ßì", "âÙ", "ç®", "öá"}, 
	  kan = {"¿´", "¿¯", "¿±", "¿°", "¿²", "¿³", "Ù©", "Ç¶", "¼÷", "î«", "ãÛ", "íè", "ê¬", "İ¨"}, 
	  tai = {"Ì¨", "Ì«", "Ì¬", "Ì©", "Ì§", "Ì¥", "Ì­", "îÑ", "Ì¦", "Ş·", "ëÄ", "õÌ", "Û¢", "öØ", "ß¾", "Ìª", "ææ", "ìÆ"}, 
	  yang = {"Ñù", "Ñø", "Ñë", "Ñô", "Ñó", "Ñï", "Ñî", "Ñò", "Ñõ", "Ñö", "Ñí", "Ñ÷", "Ñú", "Ññ", "ãó", "Ñê", "í¦", "Ñì", "áà", "Ñğ", "âó", "ì¾", "ìÈ", "÷±", "òÕ"}, 
	  lao = {"ÀÏ", "ÀÍ", "Âä", "Âç", "ÀÎ", "ÀÌ", "ÀÔ", "ÀÓ", "ÀÑ", "ÀĞ", "áÀ", "ßë", "ÀÒ", "ÁÊ", "ğì", "õ²", "îî", "ï©", "èá", "ñì"}, 
	  liu = {"Á÷", "Áõ", "Áù", "Áô", "Â½", "Áø", "Áö", "Áò", "Áï", "Âµ", "ä¯", "Áñ", "Áğ", "Áó", "åŞ", "öÌ", "æò", "ç¸", "ïÖ", "ì¼", "ìÖ", "ğÒ", "ï³"}, 
	  hen = {"ºÜ", "ºİ", "ºŞ", "ºÛ"}, 
	  gei = {"¸ø"}, 
	  chuang = {"´´", "´²", "´°", "´³", "´±", "´¯", "âë"}, 
	  lun = {"ÂÛ", "ÂÖ", "Â×", "ÂØ", "ÂÚ", "ÂÙ", "ÂÕ", "àğ"}, 
	  bie = {"±ğ", "±î", "±ï", "±ñ", "õ¿"}, 
	  bian = {"±ä", "±ã", "±ß", "±à", "±é", "±ç", "±Ş", "±æ", "±á", "ØÒ", "±â", "±å", "ãê", "±è", "ì®", "í¾", "ÜĞ", "òù", "öı", "ÛÍ", "ñ¹", "óÖ", "ìÔ", "ñÛ", "íÜ", "âí", "çÂ"}, 
	  feng = {"·ç", "·á", "·â", "·å", "·î", "·ï", "·æ", "·ë", "·ê", "·ì", "·ä", "·ã", "·è", "·í", "·é", "Ùº", "ãã", "Ûº", "í¿", "İ×", "ßô"}, 
	  pi = {"Åú", "·ñ", "Æ¤", "»µ", "±Ù", "Æ¡", "Æ¥", "Åû", "Æ£", "Æ§", "Åş", "Å÷", "Æ¢", "Æ©", "Åü", "æÇ", "Æ¨", "Åı", "Úü", "ñÔ", "Æ¦", "ñ±", "Úé", "Ø§", "èÁ", "àè", "Åù", "ßÁ", "ç¢", "Åø", "îë", "äÄ", "Û¯", "Ûı", "î¢", "ÜÅ", "ò·", "ÛÜ", "Ü±", "î¼", "òç", "ñâ", "õù", "Øò", "âÏ", "ß¨", "ê¶", "Úğ"}, 
	  cha = {"²é", "²ì", "²î", "²è", "²å", "²æ", "É²", "²ç", "é«", "²í", "²ï", "²ê", "àê", "Ôû", "æ±", "è¾", "ãâ", "ñÃ", "²ë", "é¶", "ïï", "éß", "âÇ", "ïÊ", "âª"}, 
	  zha = {"²é", "Ôú", "Õ¨", "Õ©", "Ôş", "Õ¢", "Ôü", "À¯", "Õ¦", "Õ§", "Õ¥", "é«", "Ôı", "Õ¤", "Õ£", "ßå", "×õ", "Ôû", "à©", "Õ¡", "òÆ", "ß¸", "íÄ", "Şê", "ğä", "ßî", "÷ş"}, 
	  lin = {"ÁÖ", "ÁÙ", "ÁÚ", "ÁŞ", "ÁÕ", "Á×", "ÁÜ", "÷ë", "ÁØ", "ÁÛ", "Áİ", "åà", "İş", "Áß", "ôÔ", "á×", "õï", "âŞ", "éİ", "ßø", "ê¥", "ì¢", "î¬", "ãÁ"}, 
	  zhuai = {"×ª", "×§", "Ò·"}, 
	  huai = {"»®", "»³", "»µ", "»´", "»²", "»±", "õ×"}, 
	  zhun = {"×¼", "ÍÍ", "×»", "ëÆ", "ñ¸"}, 
	  xu = {"Ğè", "Ğí", "Ğø", "Ğë", "Ğò", "Ğì", "Ğî", "Ğó", "Ğé", "Óõ", "Ğ÷", "Ğğ", "Ğñ", "Ğô", "Ğæ", "èò", "Ğõ", "Û×", "Ğö", "Ğç", "ñã", "Ğê", "ä°", "ìã", "Ğï", "Ú¼", "íì", "Ş£", "äÓ", "äª", "çï", "ÛÃ", "ôÚ", "í¹", "õ¯"}, 
	  chuan = {"´«", "´¨", "´¬", "´©", "´®", "´­", "´ª", "â¶", "îË", "å×", "ë°", "çİ", "ô­"}, 
	  gou = {"¹¹", "¹º", "¹»", "¾ä", "¹µ", "¹·", "¹³", "¹´", "¹¶", "¹¸", "èÛ", "óô", "Øş", "æÅ", "Ú¸", "á¸", "ì°", "çÃ", "óÑ", "÷¸", "êí", "åÜ"}, 
	  bai = {"°Ù", "°×", "°Ü", "°Ú", "²®", "°İ", "°Ø", "°Û", "êş", "Şã", "°Ş"}, 
	  cai = {"²Å", "²É", "²Æ", "²Ä", "²Ë", "²Ê", "²Ã", "²Ì", "²Â", "²È", "²Ç"}, 
	  can = {"²Î", "²Ğ", "²Í", "²Ó", "²Ò", "²Ï", "è²", "²Ñ", "ôÓ", "åî", "æî", "÷õ"}, 
	  cen = {"²Î", "á¯", "ä¹"}, 
	  zhen = {"Õò", "Õæ", "Õë", "ÛÚ", "Õñ", "Õğ", "Õä", "Õó", "Õï", "Õì", "Õé", "Õê", "Õí", "èå", "êâ", "ìõ", "Õç", "Õå", "çÇ", "óğ", "Õî", "Õè", "é»", "ğ²", "éô", "ğ¡", "äÚ", "İè", "ëÓ", "é©", "ëŞ", "î³", "ä¥"}, 
	  tui = {"ÍÆ", "ÍË", "ÍÈ", "ÍÊ", "ÍÇ", "ÍÉ", "ß¯", "ìÕ"}, 
	  sai = {"Ë¼", "Èü", "Èû", "Èù", "àç", "Èú"}, 
	  zou = {"×ß", "×Ş", "×à", "×á", "ÚÁ", "æã", "Úî", "Û¸", "öí"}, 
	  zhuang = {"×°", "×´", "×¯", "×³", "×²", "×±", "´±", "×®", "ŞÊ", "Ù×"}, 
	  ze = {"Ôğ", "Ôò", "Ôó", "Ôñ", "²à", "Õ¦", "ßõ", "ØÆ", "óå", "ØÓ", "óĞ", "ô·", "ê¾", "åÅ", "àı"}, 
	  zhou = {"Öİ", "ÖÜ", "ÖŞ", "ÖÛ", "Öè", "Öá", "Öç", "Öæ", "Öà", "Öå", "Öâ", "Öä", "Öã", "ëĞ", "ç§", "æû", "æ¨", "ßú", "Öß", "ôí", "íØ", "ô¦", "ôü", "İ§"}, 
	  que = {"È·", "È´", "È±", "È¸", "Èµ", "ãÚ", "È³", "È¶", "È²", "ã×", "í¨"}, 
	  mao = {"Ã³", "Ã«", "Ã¬", "Ã°", "Ã²", "Ã¯", "Ã©", "Ã±", "Ã¨", "÷Ö", "Ãª", "í®", "Ùó", "êó", "Ã®", "Ã­", "ë£", "á¹", "è£", "ó±", "Üâ", "ì¸", "ã÷", "êÄ", "î¦"}, 
	  fan = {"·´", "·¶", "·¸", "·±", "·¹", "·º", "·­", "·²", "·µ", "·¬", "··", "·³", "·«", "·®", "·ª", "·¯", "èó", "Ş¬", "·°", "á¦", "î²", "ŞÀ", "õì", "ìÜ"}, 
	  xuan = {"Ñ¡", "Ğû", "È¯", "Ğı", "Ğü", "Ğù", "Ğú", "Ğş", "Ñ¤", "äÖ", "è¯", "ìÅ", "İæ", "Ñ¢", "äö", "Ñ£", "êÑ", "ìÓ", "îç", "é¸", "ãù", "ÚÎ", "ğç", "íÛ", "Şï", "ïà", "ÙØ"}, 
	  ya = {"ÑÇ", "Ñ¹", "ÑÅ", "ÑÀ", "Ñº", "Æ¥", "Ñ¼", "Ñ½", "ÑÄ", "ÑÂ", "Ñ¿", "ÑÆ", "ÑÈ", "Ñ»", "æ«", "ÑÃ", "Ñ¾", "ÑÁ", "Ûë", "Øó", "ë²", "èâ", "çğ", "Şë", "íı", "ğé", "åÂ", "á¬", "í¼"}, 
	  me = {"Ã´", "÷á"}, 
	  ma = {"Ã´", "Âí", "Âğ", "Ä¦", "Âé", "Âë", "Âè", "Âê", "Âï", "Âî", "Ä¨", "Âì", "ßé", "ó¡", "áï", "è¿", "æÖ"}, 
	  wang = {"Íõ", "Íû", "Íù", "Íø", "Íü", "Íö", "Íú", "Íô", "Ã¢", "Í÷", "Íı", "ã¯", "Øè", "éş", "÷Í", "ŞÌ"}, 
	  ce = {"²ß", "²â", "²á", "²à", "²Ş", "âü"}, 
	  nu = {"Å®", "Å¬", "Å­", "Å«", "åó", "îÏ", "æå", "ô¬", "æÛ", "æÀ", "í¤"}, 
	  tan = {"Ì¸", "Ì½", "Ì¹", "Ì¯", "µ¯", "Ì¿", "Ì³", "Ì²", "Ì°", "Ì¾", "Ì·", "Ì¶", "Ì¼", "Ìº", "Ì±", "Ì´", "Ìµ", "Ì»", "Ì®", "ìş", "ê¼", "Û°", "å£", "îã", "ïÄ", "ïâ"}, 
	  kuang = {"¿ö", "¿ó", "¿ò", "¿ñ", "¿õ", "¿ô", "¿ï", "¿ğ", "Ú÷", "ÛÛ", "ßÑ", "êÜ", "ŞÅ", "Ú¿", "Ú²", "æş"}, 
	  se = {"É«", "Èû", "Éª", "É¬", "ØÄ", "ğ£", "ï¤"}, 
	  shai = {"É«", "É¸", "É¹"}, 
	  tsmz = {"ÖĞµºÃÀÑ©", "SYP", "Ë®¾µËÄÆæ", "Áã¶şÆß"}, 
	  lie = {"ÁĞ", "ÁÒ", "ÁÓ", "ÁÑ", "ÁÔ", "Ùı", "ßÖ", "ôó", "ä£", "÷à", "Ûø", "Şæ", "õñ"}, 
	  gang = {"¸Û", "¸Ö", "¸Õ", "¸Ú", "¸Ù", "¸Ô", "¸Ü", "¸×", "¿¸", "¸Ø", "î¸", "í°", "óà"}, 
	  kuan = {"¿î", "¿í", "÷Å"}, 
	  la = {"À­", "Âä", "À¶", "À¬", "À°", "À²", "À±", "À¯", "À®", "Øİ", "ê¹", "íÇ", "åå", "ğø"}, 
	  gu = {"¹É", "¹Å", "¹Ë", "¹Ê", "¹Ì", "¹Ä", "¹Ç", "¹À", "¹È", "¼Ö", "¹Ã", "¹Â", "¹Í", "¹¼", "¹½", "¹Á", "¹¾", "ßÉ", "ïÀ", "îÜ", "ğÀ", "¹¿", "ãé", "èô", "ğó", "áÄ", "éï", "ğ³", "êô", "¹Æ", "Ú¬", "ì±", "÷½", "İÔ", "î¹", "ØÅ", "ëû", "õı", "î­", "òÁ", "ôş", "êö", "öñ"}, 
	  gen = {"¸ù", "¸ú", "Ø¨", "ôŞ", "ßç", "İ¢"}, 
	  tu = {"ÍÁ", "Í»", "Í¼", "Í¾", "Í½", "Í¿", "ÍÂ", "ÍÀ", "ÍÃ", "Íº", "Í¹", "İ±", "îÊ", "İË", "Ü¢", "õ©"}, 
	  qun = {"Èº", "È¹", "åÒ"}, 
	  su = {"ËÙ", "ËØ", "ËÕ", "Ëß", "Ëõ", "ËÜ", "Ëà", "Ë×", "ËŞ", "ËÚ", "Ëİ", "ËÖ", "Ùí", "ãº", "óù", "öÕ", "ËÛ", "ÚÕ", "ä³", "İø", "à¼", "ö¢"}, 
	  lei = {"Àà", "ÀÛ", "À×", "ÀÕ", "Àá", "ÀÙ", "Àİ", "ÀÚ", "ÀŞ", "ÀØ", "Àß", "Ùú", "ñç", "ÀÜ", "æĞ", "çĞ", "õª", "àÏ", "Ú³", "éÛ"}, 
	  xun = {"Ñ¶", "Ñµ", "Ñ¸", "Ñ°", "Ñ¯", "Ñ­", "Ñ®", "Ñ²", "Ñ´", "Ñ«", "Ñ·", "Ñ¬", "áß", "¿£", "Ñ³", "Ñ±", "öà", "»ç", "Ş¹", "Ü÷", "ä±", "ä­", "á¾", "Û÷", "Ùã", "Û¨", "õ¸", "âş", "ñ¿", "Ş¦", "êÖ", "â´"}, 
	  zhua = {"×¥", "ÎÎ"}, 
	  re = {"ÈÈ", "Èô", "ÈÇ"}, 
	  mi = {"Ã×", "ÃÜ", "ÃØ", "ÃÔ", "ÃÖ", "ÃÛ", "ÃÕ", "ÃÙ", "ÃÒ", "ÃÚ", "ÃĞ", "÷ç", "â¨", "Ú×", "ßä", "ÃÓ", "åµ", "ãè", "ÃÑ", "à×", "åô", "ëß", "Ãİ", "ìò", "÷ã", "ŞÂ", "ØÂ", "ôé", "ôÍ"}, 
	  pei = {"Åä", "Åà", "Åâ", "Åå", "Åã", "Åæ", "Åá", "Åß", "ö¬", "ì·", "àú", "ÅŞ", "õ¬", "àÎ", "ïÂ"}, 
	  kao = {"¿¼", "¿¿", "¿¾", "¿½", "îí", "èà", "åê", "êû"}, 
	  duan = {"¶Ï", "¶Î", "¶Ì", "¶Ë", "¶Í", "¶Ğ", "ìÑ", "é²", "óı"}, 
	  luo = {"Âä", "ÂŞ", "Âç", "Âå", "Âß", "Âİ", "Âà", "Âæ", "ÂÜ", "Âã", "äğ", "ÀÓ", "Şû", "Ââ", "¿©", "Âá", "çó", "ŞÛ", "Üı", "íÑ", "öÃ", "é¡", "ïİ", "ñ§", "ãø", "ëá", "â¤", "ÙÀ", "Ùù"}, 
	  e = {"¶î", "¶í", "¶ñ", "¶ì", "¶ô", "¶õ", "¶ò", "¶ö", "¶ë", "¶ó", "¶ğ", "öù", "¶ê", "Ø¬", "ãµ", "¶ï", "ïÉ", "ÛÑ", "æ¹", "ğÊ", "İà", "ÚÌ", "İ­", "ëñ", "ï°", "ò¦", "ßÀ", "åí", "ÜÃ", "éî"}, 
	  shuang = {"Ë«", "Ë¬", "Ëª", "æ×", "ãñ"}, 
	  rang = {"ÈÃ", "ÈÀ", "ÈÁ", "ÈÂ", "È¿", "ğ¦", "ìü"}, 
	  qie = {"ÇĞ", "ÇÒ", "ÇÔ", "ÇÑ", "Æö", "ïÆ", "ÇÓ", "Ù¤", "ã«", "æª", "êü", "Û§", "óæ", "ã»"}, 
	  pian = {"±ã", "Æ¬", "Æª", "Æ«", "Æ­", "ôæ", "±â", "æé", "ëİ", "õä", "ÚÒ", "êú", "çÂ"}, 
	  kong = {"¿Õ", "¿Ø", "¿×", "¿Ö", "ÙÅ", "áÇ", "óí"}, 
	  ni = {"Äã", "Äá", "ÄØ", "Äà", "Äâ", "Äò", "Äæ", "Äß", "Äİ", "Äå", "Ää", "ÄŞ", "Äç", "ì»", "êÇ", "Ûè", "îê", "öò", "Ù£", "âõ", "íş", "ìò", "â¥", "í«"}, 
	  ceng = {"²ã", "Ôø", "²ä"}, 
	  huang = {"»Æ", "»Ä", "»Í", "»Ê", "»Ë", "»Å", "»Î", "äê", "»Ñ", "»Ì", "»É", "è«", "»Ğ", "»Ï", "äÒ", "»È", "»Ç", "Úò", "áå", "åØ", "ëÁ", "óò", "öü", "ó¨", "ñ¥"}, 
	  suan = {"Ëã", "Ëá", "Ëâ", "â¡"}, 
	  po = {"ÆÆ", "·±", "ÆÂ", "ÆÈ", "ÆÄ", "ÆÓ", "²´", "ÆÅ", "ÆÃ", "ÆÇ", "ÆÉ", "Û¶", "çê", "Úé", "îà", "ØÏ", "óÍ", "ãø", "ğ«", "îÇ", "îŞ", "ê·"}, 
	  tie = {"Ìú", "Ìù", "Ìû", "÷Ñ", "İÆ"}, 
	  man = {"Âú", "Âı", "Âü", "Âş", "Âû", "Â÷", "Âù", "÷©", "Âø", "á£", "Ã¡", "òı", "ì×", "çÏ", "ïÜ", "ò©", "Ü¬", "÷´"}, 
	  ai = {"°®", "°£", "°¬", "°­", "°©", "´ô", "°§", "°¤", "°«", "°¯", "°ª", "°¦", "°¨", "°¥", "ö°", "Şß", "êÓ", "æÈ", "àÈ", "è¨", "àÉ", "ïÍ", "íÁ"}, 
	  rong = {"Èİ", "ÈÙ", "ÈÚ", "ÈŞ", "ÈÜ", "ÈØ", "ÈÛ", "ÈÖ", "éÅ", "È×", "Èß", "áÉ", "ëÀ", "áõ", "òî"}, 
	  chen = {"³Æ", "³Â", "Éò", "³Á", "³¿", "è¡", "³¼", "³¾", "³½", "³Ä", "³Ã", "³À", "³»", "å·", "ÚÈ", "í×", "àÁ", "ŞÓ", "é´", "Ø÷", "Úß", "ö³"}, 
	  pai = {"ÅÆ", "ÅÅ", "ÅÉ", "ÅÄ", "ÆÈ", "ÅÇ", "ÅÈ", "Ù½", "ßß", "İå"}, 
	  cu = {"´Ù", "´Ö", "´Ø", "´×", "×ä", "õí", "â§", "õ¾", "õ¡", "İı", "éã", "áŞ"}, 
	  kun = {"À§", "À¥", "À¤", "À¦", "çû", "ï¿", "öï", "õ«", "÷Õ", "ã§", "ãÍ"}, 
	  chao = {"³¬", "³¯", "³±", "³´", "³®", "³­", "³²", "³³", "½Ë", "´Â", "³°", "êË", "ìÌ", "ñé", "â÷"}, 
	  sui = {"Ëæ", "Ëê", "Ëä", "Ëé", "Äò", "Ëí", "Ëì", "Ëè", "Ëë", "Ëç", "Ëå", "åä", "î¡", "Ëî", "å¡", "ìİ", "ÚÇ", "íõ", "İ´"}, 
	  chun = {"´º", "´¿", "´¼", "´¾", "´½", "´»", "´À", "ğÈ", "İ»", "òí"}, 
	  kuo = {"ÊÊ", "À©", "À¨", "À«", "Àª", "èé", "òÒ"}, 
	  hong = {"ºì", "ºê", "ºé", "ºä", "ºç", "ºè", "ºë", "ºå", "ºæ", "ãü", "Ùê", "Ş®", "ãÈ", "Ú§", "İ¦", "Ùä", "Ş°"}, 
	  mai = {"Âò", "Âô", "Âó", "Âõ", "Âö", "Âñ", "ö²", "İ¤", "Û½"}, 
	  xiu = {"ĞŞ", "Ğã", "Ğİ", "ËŞ", "Ğä", "Ğå", "³ô", "Ğà", "Ğâ", "Ğß", "Ğá", "á¶", "äå", "âÓ", "âÊ", "ßİ", "÷Û", "ğ¼", "õ÷"}, 
	  qin = {"Ç×", "ÇÚ", "ÇÖ", "ÇØ", "ÇÕ", "ÇÙ", "Çİ", "ÇÛ", "Çß", "ÇŞ", "ÇÜ", "ñû", "àß", "ñæ", "àº", "Şì", "äÚ", "ÜË", "ôÀ", "âÛ", "ï·", "ßÄ", "éÕ", "òû"}, 
	  cuo = {"´ë", "´í", "´è", "´ì", "´ê", "´é", "õã", "ï±", "ØÈ", "áÏ", "ğî", "ïó", "ğû", "ëâ", "õº"}, 
	  long = {"Áú", "Â¡", "Åª", "Â¢", "Áı", "Â£", "Áû", "Â¤", "ëÊ", "çç", "Áş", "Ü×", "Áü", "íÃ", "Ûâ", "ãñ", "èĞ", "ñª"}, 
	  dun = {"¶Ö", "¶Ù", "¶Ü", "¶Ø", "¶×", "¶Õ", "¶Ú", "ãç", "¶Û", "ìÀ", "íï", "¶İ", "õ»", "í»", "ïæ", "íâ"}, 
	  kang = {"¿µ", "¿¹", "¿¸", "¿¶", "¿»", "¿º", "¿·", "Øø", "îÖ", "ãÊ"}, 
	  pu = {"ÆÕ", "±©", "ÆÌ", "ÆÖ", "ÆÓ", "±¤", "ÆÏ", "Æ×", "ÆÒ", "ÆË", "ÆÍ", "ÆÑ", "ÆØ", "ÆÙ", "äß", "ÆÎ", "ÆÔ", "è±", "å§", "ÆĞ", "¸¬", "õë", "Ùé", "àÛ", "ë«", "ïè", "ïä"}, 
	  reng = {"ÈÔ", "ÈÓ"}, 
	  bo = {"²¨", "²©", "²¥", "²ª", "²¦", "±¡", "²®", "²£", "²«", "°Ø", "²´", "²°", "°ş", "²³", "ÆÇ", "²·", "²µ", "²±", "²²", "ô¤", "²¤", "íç", "²­", "êş", "²¬", "Ùñ", "²§", "²¯", "ë¢", "âÄ", "õË", "îà", "õÀ", "éŞ", "à£", "ğ¾", "ØÃ", "õÛ"}, 
	  lan = {"À¼", "ÀÀ", "À¶", "Àº", "À¸", "á°", "ÀÃ", "ÀÄ", "ÀÂ", "À¿", "À½", "À¹", "ÀÁ", "é­", "ìµ", "À·", "À»", "ñÜ", "î½", "À¾", "ïç", "äí"}, 
	  piao = {"Æ±", "ÆÓ", "Æ¯", "Æ®", "æÎ", "Æ°", "Øâ", "çÎ", "éè", "î©", "æô", "àÑ", "İ³", "óª"}, 
	  sun = {"Ëğ", "Ëï", "Ëñ", "İ¥", "é¾", "öÀ", "áø", "â¸"}, 
	  ning = {"Äş", "Äı", "ÜÑ", "Å¡", "Å¢", "Äû", "ßÌ", "Äü", "Øú", "ñ÷", "å¸"}, 
	  ku = {"¿à", "¿â", "¿Ş", "¿á", "¿ã", "¿İ", "¿ß", "÷¼", "Ü¥", "ç«", "ØÚ", "à·"}, 
	  nao = {"Å¬", "ÄÔ", "ÄÖ", "ÄÕ", "ÄÓ", "è§", "Ä×", "Ø«", "Ûñ", "îó", "ßÎ", "íĞ", "â®", "òÍ"}, 
	  tao = {"Ì×", "ÌÖ", "ÌÕ", "ÌÎ", "ÌÓ", "ÌÒ", "ÌÑ", "ÌÔ", "ÌÍ", "ÌÏ", "èº", "ß¶", "ìâ", "ä¬", "ßû", "ÌĞ", "÷Ò", "Ø»"}, 
	  song = {"ËÍ", "ËÉ", "ËÎ", "ËÏ", "ËÌ", "ËÊ", "ËĞ", "áÔ", "äÁ", "ËË", "ã¤", "áÂ", "Ú¡", "âì", "ñµ", "İ¿"}, 
	  mou = {"Ä³", "Ä±", "Ä²", "çÑ", "íø", "ßè", "òú", "öÊ", "òÖ", "Ù°"}, 
	  pa = {"ÅÉ", "ÅÂ", "ÅÁ", "ÅÀ", "°Ç", "Å¿", "ÅÃ", "Å¾", "İâ", "°Ò", "èË", "îÙ", "óá"}, 
	  lue = {"ÂÔ", "ÂÓ", "ï²"}, 
	  hei = {"ºÚ", "ºÙ"}, 
	  chai = {"²î", "²ğ", "²ñ", "îÎ", "²ò", "Ù­", "ò²", "ğû"}, 
	  a = {"°¢", "°¡", "ºÇ", "ëç", "àÄ", "ß¹", "ï¹"}, 
	  ting = {"Ìı", "Í¥", "Í£", "Ìü", "Í¢", "Í¦", "Í¤", "Í§", "æÃ", "Í¡", "îú", "Ìş", "öª", "î®", "òÑ", "İã", "èè", "Üğ"}, 
	  sha = {"É³", "ÏÃ", "É±", "É´", "É°", "É¶", "É¯", "É²", "É¼", "Éµ", "É·", "öè", "ö®", "àÄ", "ğğ", "ôÄ", "êı", "ï¡", "ßş", "ì¦"}, 
	  tuo = {"ÍĞ", "ÍÑ", "ÍØ", "ÍÏ", "Í×", "ÆÇ", "ÍÕ", "ÍÓ", "ãû", "ÍÒ", "¶æ", "ÍÔ", "ÍÙ", "ÍÖ", "Ûç", "Ù¢", "íÈ", "õÉ", "âÕ", "èŞ", "éÒ", "Ø±", "îè", "õ¢", "ö¾", "óê", "èØ"}, 
	  pan = {"ÅĞ", "ÅÌ", "·¬", "ÅË", "ÅÊ", "ÅÎ", "ŞÕ", "ÅÏ", "ÅÖ", "ÅÑ", "õç", "ÅÍ", "ãİ", "ó´", "ãú", "ñÈ", "ñá"}, 
	  gua = {"À¨", "¹Ò", "¹Ï", "¹Î", "¹Ñ", "ØÔ", "ßÉ", "¹Ó", "¹Ğ", "ëÒ", "Ú´", "ğ»", "èé"}, 
	  lou = {"Â¥", "Â¶", "Â©", "Âª", "Â¦", "Â§", "Â¨", "à¶", "ïÎ", "ÙÍ", "ğü", "÷Ã", "ñï", "ò÷", "áĞ", "İä"}, 
	  han = {"ºº", "º«", "º¬", "ºµ", "º®", "º¹", "º­", "º¯", "º°", "º¶", "º±", "º¸", "º²", "ºª", "º³", "å«", "º©", "º´", "º¨", "º·", "ãÛ", "÷ı", "Úõ", "ò¥", "òÀ", "êÏ", "İÕ", "ñü", "ìÊ", "Şş"}, 
	  cao = {"²İ", "²Ù", "²Ü", "²Û", "²Ú", "àĞ", "äî", "ó©", "ô½"}, 
	  cang = {"²Ø", "²Ö", "²Ô", "²×", "²Õ"}, 
	  zang = {"²Ø", "Ôà", "Ôá", "Ôß", "ê°", "ŞÊ", "æà"}, 
	  shun = {"Ë³", "Ë²", "Ë´", "Ë±"}, 
	  ka = {"¿¨", "¿¦", "¿§", "ßÇ", "¿©", "Øû", "ëÌ"}, 
	  qia = {"¿¨", "Ç¡", "Ç¢", "Ù¤", "Æş", "÷Ä", "ñÊ", "İÖ"}, 
	  qiao = {"ÇÅ", "ÇÇ", "ÇÈ", "ÇÉ", "ÇÄ", "ÇÃ", "ÇÎ", "¿Ç", "È¸", "½¶", "ÇÆ", "ÇÌ", "ÇÏ", "ÇÍ", "ÇÂ", "ÇË", "Üñ", "õÎ", "éÔ", "ã¾", "ÇÊ", "ÇÁ", "á½", "Ú½", "ÚÛ", "ã¸", "÷³", "íÍ", "Øä", "çØ"}, 
	  fou = {"·ñ", "ó¾"}, 
	  bang = {"°ï", "°î", "°ñ", "°ô", "°ò", "°÷", "°ó", "°ø", "°õ", "°ö", "°ù", "°ğ", "äº", "İò"}, 
	  ao = {"°Â", "°Ä", "°Á", "°¾", "°¼", "Ïù", "÷¡", "°½", "åÛ", "÷é", "°À", "Ûê", "°¿", "à»", "ŞÖ", "°Ã", "á®", "òü", "æñ", "éá", "öË", "æÁ", "âÚ", "ñú"}, 
	  zhai = {"Õ®", "Ôñ", "Õ¬", "Õ¯", "²à", "Õª", "Õ­", "Õ«", "¼À", "µÔ", "íÎ", "ñ©"}, 
	  zhui = {"×·", "×¹", "×º", "×µ", "×¶", "×¸", "ã·", "æí", "çÄ"}, 
	  chou = {"³ï", "³é", "³ñ", "³ê", "³î", "³ó", "³ô", "³ğ", "³ë", "³í", "³ò", "³ì", "ã°", "Ù±", "ñ¬", "öÅ", "àü"}, 
	  zen = {"Ôõ", "ÚÚ"}, 
	  kui = {"¿÷", "¿ü", "À¢", "¿ı", "À¡", "À£", "ØÑ", "¿û", "¿ú", "¿ø", "åÓ", "î¥", "Ø¸", "ñù", "à°", "Ùç", "óñ", "¿ù", "à­", "Şñ", "Úó", "¿ş", "êÒ", "õÍ", "İŞ", "ã´", "ã¦", "òñ"}, 
	  ha = {"¹ş", "Ïº", "¸ò", "îş"}, 
	  za = {"ÔÓ", "Ôú", "ÔÛ", "ÔÒ", "Õ¦", "ÔÑ", "ßÆ"}, 
	  luan = {"ÂÒ", "ÂÑ", "ÂĞ", "ÂÍ", "ğ½", "èï", "öÇ", "ÂÎ", "ÂÏ", "Ùõ", "æ®"}, 
	  xiong = {"ĞÛ", "ĞÖ", "ĞÜ", "ĞØ", "Ğ×", "ĞÙ", "ĞÚ", "Üº"}, 
	  ne = {"ÄØ", "ÄÄ", "ÄÅ", "Ú«"}, 
	  zan = {"ÔŞ", "Ôİ", "ÔÛ", "ÔÜ", "êÃ", "ô¢", "ôØ", "è¶", "öÉ", "ôõ", "ŞÙ"}, 
	  rui = {"Èğ", "Èñ", "î£", "ÜÇ", "Èï", "Ş¨", "ò¸", "èÄ"}, 
	  tang = {"ÌÃ", "ÌÆ", "ÌÇ", "ÌÀ", "ÌÁ", "ÌÉ", "ÌË", "ÌÈ", "ÌÄ", "ÌÌ", "ÌÊ", "ÌÅ", "ÌÂ", "ïÛ", "ÙÎ", "ó«", "äç", "àû", "ôÊ", "éÌ", "õ±", "ó¥", "ñí", "ï¦", "è©"}, 
	  run = {"Èó", "Èò"}, 
	  kua = {"¿ç", "¿ä", "¿å", "¿æ", "¿è", "Ù¨"}, 
	  wa = {"Íß", "ÍÚ", "ÍŞ", "Íİ", "Íà", "ÍÜ", "°¼", "ÍÛ", "Øô", "æ´", "ëğ"}, 
	  meng = {"ÃÉ", "ÃË", "ÃÎ", "ÃÍ", "ÃÏ", "ÃÈ", "Ã¥", "ëü", "ÃÌ", "ÃÊ", "ÛÂ", "ãÂ", "òì", "òµ", "ó·", "ô¿", "İù", "ô»", "Ş«", "íæ"}, 
	  bin = {"±ö", "±õ", "±ó", "±ò", "±ô", "éë", "çÍ", "÷Ş", "éÄ", "±÷", "ë÷", "çã", "ïÙ", "áÙ", "÷Æ", "ÙÏ"}, 
	  leng = {"Àä", "ã¶", "Àâ", "Àã", "Ü¨"}, 
	  peng = {"Åô", "Åó", "Åí", "Åò", "Åî", "Åö", "Åï", "Åõ", "Åë", "Åñ", "Åì", "Åê", "Åğ", "âñ", "Åé", "àØ", "ó²", "Ü¡"}, 
	  niu = {"Å£", "Å¦", "Å¤", "Å¥", "ŞÖ", "æ¤", "âî", "áğ"}, 
	  rou = {"Èâ", "Èá", "Èà", "ôÛ", "÷·", "õå"}, 
	  ruo = {"Èô", "Èõ", "Ù¼"}, 
	  sen = {"É­"}, 
	  sa = {"Èø", "È÷", "Èö", "ìª", "Ø¦", "Øí", "êı", "ëÛ"}, 
	  juan = {"¾í", "¾è", "¿¡", "¾ì", "¾ê", "¾ë", "¾î", "öÁ", "ïÔ", "ä¸", "¾é", "Û²", "îÃ", "áú", "ïÃ", "èğ"}, 
	  pao = {"ÅÜ", "ÅÚ", "Åİ", "Å×", "ÅÙ", "ÅÛ", "ÅØ", "ğå", "âÒ", "áó", "ŞË", "ëã"}, 
	  ruan = {"Èí", "Èî", "ëÃ"}, 
	  lang = {"ÀË", "ÀÊ", "ÀÉ", "ÀÈ", "ÀÇ", "ÀÅ", "ÀÆ", "òë", "ãÏ", "ï¶", "İ¹", "à¥", "İõ", "ïü"}, 
	  zun = {"×ğ", "×ñ", "÷®", "é×", "ß¤"}, 
	  ken = {"¿Ï", "¿Ñ", "¿Ò", "¿Ğ", "ñÌ"}, 
	  hun = {"»é", "»ì", "»ê", "»ë", "»è", "»ç", "âÆ", "Ú»", "äã", "ãÔ"}, 
	  en = {"¶÷", "àÅ", "Şô", "İì"}, 
	  qiong = {"Çî", "Çí", "ñ·", "Úö", "Üä", "óÌ", "õ¼", "òË", "öÆ"}, 
	  rao = {"ÈÆ", "ÈÅ", "ÈÄ", "æ¬", "èã", "Üé"}, 
	  mang = {"Ã¦", "Ã¤", "Ã£", "Ã¢", "Ã¥", "Ã§", "òş", "Úø", "íË", "äİ"}, 
	  nuo = {"Åµ", "Å²", "ÄÈ", "Å´", "Å³", "ÙĞ", "ßö", "Şù", "ï»"}, 
	  teng = {"ÌÚ", "ÌÛ", "ÌÙ", "ëø", "ÌÜ"}, 
	  nin = {"Äú"}, 
	  miao = {"Ãç", "Ãë", "Ãî", "Ãè", "Ãí", "Ãé", "çÑ", "Ãì", "íµ", "Ãê", "ç¿", "åã", "ğÅ", "èÂ", "íğ", "ß÷"}, 
	  mie = {"Ãğ", "Ãï", "óú", "Ø¿", "ßã", "óº"}, 
	  niang = {"Äï"}, 
	  nai = {"ÄË", "ÄÌ", "ÄÍ", "ÄÎ", "Ø¾", "İÁ", "ÄÊ", "èÍ", "Üµ"}, 
	  sang = {"É£", "É¥", "É¤", "Şú", "òª", "íß"}, 
	  ca = {"²ğ", "²Á", "àê", "íå"}, 
	  sao = {"É¨", "É§", "É©", "ÉÒ", "çÒ", "É¦", "ğş", "ëı", "Ü£", "çØ", "öş"}, 
	  zuan = {"×ê", "×¬", "×ë", "ß¬", "çÚ", "õò"}, 
	  shua = {"Ë¢", "Ë£", "à§"}, 
	  gun = {"¹ö", "¹÷", "¹õ", "Ùò", "íŞ", "öç", "çµ"}, 
	  guai = {"¹Ö", "¹Õ", "¹Ô"}, 
	  pang = {"ÅÔ", "ÅÓ", "ÅÒ", "°ò", "ÅÖ", "°õ", "ó¦", "áİ", "äè", "åÌ", "ÅÕ"}, 
	  nuan = {"Å¯"}, 
	  shuai = {"Ë¥", "Ë§", "Ë¤", "Ë¦", "ó°"}, 
	  cui = {"Ë¥", "´ß", "´Ş", "´à", "´ä", "İÍ", "´â", "´İ", "è­", "´á", "ã²", "´ã", "ßı", "ö¿", "ë¥", "éÁ"}, 
	  niao = {"Äñ", "Äò", "Äç", "ôÁ", "ëå", "Üà", "æÕ"}, 
	  die = {"µø", "µş", "µû", "µü", "µú", "µù", "µı", "ëº", "ñó", "à©", "õÚ", "Ü¦", "ğ¬", "öø", "Ûì", "Şé", "õŞ"}, 
	  pen = {"Åç", "Åè", "äÔ"}, 
	  chui = {"´µ", "´¹", "´¸", "´¶", "×µ", "Úï", "é³", "´·", "é¢"}, 
	  ang = {"°º", "°»", "°¹"}, 
	  keng = {"¿Ó", "ï¬", "¿Ô"}, 
	  tun = {"ÍÌ", "ÍÍ", "¶Ú", "ÍÊ", "ëà", "ÍÎ", "â½", "êÕ", "ÙÛ"}, 
	  diu = {"¶ª", "îû"}, 
	  weng = {"ÎÌ", "ÎË", "ÎÍ", "İî", "Ş³"}, 
	  sou = {"ËÒ", "ËÑ", "ËÓ", "ËÔ", "à²", "ÛÅ", "âÈ", "Ş´", "ì¬", "àÕ", "äÑ", "ïË", "òô", "î¤"}, 
	  ga = {"¼Ğ", "¸Â", "ŞÎ", "¸ì", "¸Á", "ê¸", "æØ", "îÅ", "æÙ"}, 
	  lia = {"Á©"}, 
	  nen = {"ÄÛ", "í¥"}, 
	  nang = {"ÄÒ", "âÎ", "àì", "êÙ", "ß­"}, 
	  nie = {"Äô", "Äó", "Äù", "Äø", "Äõ", "ŞÁ", "Äö", "õæ", "à¿", "ô«", "Ä÷", "ò¨", "Ø¿", "Úí"}, 
	  beng = {"±Ã", "±À", "°ö", "±Ä", "±Å", "±Á", "±Â", "àÔ", "ê´"}, 
	  cou = {"´Õ", "ê£", "ëí", "é¨"}, 
	  pou = {"ÆÊ", "Şå", "Ùö"}, 
	  seng = {"É®"}, 
	  nue = {"Å°"}, 
	  cuan = {"´Ü", "ÔÜ", "´Û", "´Ú", "ß¥", "ìà", "Ùà", "ïé"}, 
	  chuo = {"ê¡", "´Â", "´Á", "à¨", "öº", "õÖ"}, 
	  chuai = {"´§", "õß", "à¨", "àÜ", "Şõ", "ëú"}, 
	  jiong = {"¾½", "¾¼", "åÄ", "êÁ", "ìç"}, 
	  shuan = {"Ë¨", "Ë©", "äÌ", "ãÅ"}, 
	  zei = {"Ôô"}, 
	  pie = {"Æ³", "Æ²", "ÜÖ", "ë­", "Ø¯"}, 
	  miu = {"Ãı"}, 
	  o = {"Å¶", "àŞ", "à¸"}, 
	  dia = {"àÇ"}, 
	  nou = {"ññ"}, 
	  ei = {"ÚÀ"}, 
	  s = {"S"}, 
	  y = {"Y"}, 
	  p = {"P"}, 
	  sz = {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9"}}
	local T2 = T1[pinyin]
	if T2 == nil then
	  Cls()
	  DrawStrBox(x, y, "²éÎŞ´Ë×Ö£¬ÇëÖØĞÂÊäÈë", C_GOLD, 24)
	  lib.ShowSurface(0)
	  lib.Delay(2000)
	  return ""
	end
	local page = 0
	local str = ""
	while true do
	  str = ""
	  for i = 1, 9 do
		if T2[i + 9 * page] == nil then
		  break;
		else
			str = str .. i .. "." .. T2[i + 9 * page] .. " "
		end
	  end
	  ShowPinyin(x, y, word, pinyin, str)
	  local keypress = WaitKey()
	  lib.Delay(100)
	  if keypress == VK_DOWN and T2[9 * (page + 1) + 1] ~= nil then
		page = page + 1
	  elseif keypress == VK_UP and 0 < page then
		page = page - 1
	  elseif keypress == 27 then
		return ""
	  elseif 48 >= keypress or keypress < 58 then
		return T2[(page) * 9 + keypress - 48]
	  end
	end
  end
  
  --ÊäÈëÆ´Òô£¬Êı×ÖÈ«½Ç
  function GetPinyin(x, y, word)
	local T3 = {"a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"}
	local T4 = {"£°", "£±", "£²", "£³", "£´", "£µ", "£¶", "£·", "£¸", "£¹"}
	local str = ""
	while true do
	  ShowPinyin(x, y, word, str)
	  local keypress = WaitKey()
	  lib.Delay(100)
	  if keypress > 96 and keypress < 123 then
		str = str .. T3[keypress - 96]
	  elseif keypress == 8 then
		if string.len(str) == 0 then
		  word = string.sub(word, 1, -3)
		else
			str = string.sub(str, 1, -2)
		end
	  elseif keypress > 47 and keypress < 58 then
		return -1, word .. T4[keypress - 47]
	  
	  elseif keypress == VK_RETURN and str == "" then
		return "finish"
	  
	  elseif keypress == VK_SPACE or keypress == VK_RETURN then
		return str, word
	  
	  elseif keypress == VK_ESCAPE then
		return -1
	  end
	end
  end
  
  --ÊäÈëÆ´Òô£¬Êı×Ö°ë½Ç
  function GetPinyin1(x, y)
	local T3 = {"a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"}
	local T4 = {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9"}
	local str = ""
	while true do
	  ShowPinyin1(x, y, str)
	  local keypress = WaitKey()
	  lib.Delay(100)
	  if keypress > 96 and keypress < 123 then
		str = str .. T3[keypress - 96]
	  elseif keypress == 8 then
		str = string.sub(str, 1, -2)
	  elseif keypress > 47 and keypress < 58 then
		str = str .. T4[keypress - 47]
	  elseif keypress == VK_SPACE then
		str = str .. " "
	  elseif keypress == VK_RETURN then
		return str
	  end
	end
  end
  
  --ÏÔÊ¾Æ´Òô
  function ShowPinyin(x, y, str1, str2, str3)
	Cls()
	local size = 24
	DrawBox(x, y + size, CC.ScreenW - x, y + 5 * size, C_ORANGE)
	if str3 == nil then
	  DrawStrBox(x, y - size / 2, "ÇëÊäÈë(Æ´)", C_WHITE, size)
	else
	  DrawStrBox(x, y - size / 2, "ÇëÑ¡Ôñ", C_WHITE, size)
	  DrawString(x + 15, y + size * 3.5, str3, C_WHITE, size)
	end
	lib.DrawRect(x + 10, y + size * 3, CC.ScreenW - 10 - x, y + size * 3 + 2, C_WHITE)
	DrawString(x + 20, y + size * 1.6, str1, C_RED, size)
	DrawString(x + 20 + size * string.len(str1) / 2, y + size * 1.6, str2, C_GOLD, size)
	lib.ShowSurface(0)
  end
  
  --ÏÔÊ¾Æ´Òô
  function ShowPinyin1(x, y, str2, str3)
	Cls()
	local size = 24
	DrawBox(x, y + size, 640 - x, y + 5 * size, C_ORANGE)
	if str3 == nil then
	  DrawStrBox(x, y - size / 2, "ÇëÊäÈë(Æ´)", C_WHITE, size)
	else
	  DrawStrBox(x, y - size / 2, "ÇëÑ¡Ôñ", C_WHITE, size)
	  DrawString(x + 15, y + size * 3.5, str3, C_WHITE, size)
	end
	lib.DrawRect(x + 10, y + size * 3, 630 - x, y + size * 3 + 2, C_WHITE)
	DrawString(x + 20, y + size * 1.6, str2, C_GOLD, size)
	lib.ShowSurface(0)
  end







function NewGame()     --Ñ¡ÔñĞÂÓÎÏ·£¬ÉèÖÃÖ÷½Ç³õÊ¼ÊôĞÔ
	Cls();
	ShowScreen();
	LoadRecord(0); --  ÔØÈëĞÂÓÎÏ·Êı¾İ
	rest()
	--PlayMIDI(77);
	CC.Week = 1
	CC.Gold = 0
	CC.Sp = 0
	if existFile(CONFIG.DataPath..'TgJl') then
		tgload()
	end
    
	--Ö´ĞĞ³É¾ÍÎÄ¼ş
	if existFile(CC.Acvmts) then
		dofile(CC.Acvmts)
	--Ò»ÖÜÄ¿
	else
		Achievements.Round = 1
		Achievements.pChar = {}
		Achievements.rdsCpltd = {}
		for i = 1, JY.PersonNum do
			Achievements.rdsCpltd[i] = {}
			Achievements.rdsCpltd[i].n = 0
			Achievements.rdsCpltd[i].lvlReached1 = 0
			Achievements.rdsCpltd[i].lvlReached2 = 0
		end
		Achievements.sp = 0
		Achievements.bonus = {}
		for i = 1, 7 do
			Achievements.bonus[i] = 0
		end
		--ÒÔ±í¸ñĞÎÊ½±£´æĞÂÎÄ¼ş
		SaveTable(Achievements)
	end
    if CC.Week < 200 then 
        CC.Week = 200
    end
	JY.Base["ÖÜÄ¿"] = CC.Week
	JY.Base["ËéÆ¬"] = CC.Sp
	JY.Status = GAME_NEWNAME
	lib.PlayMPEG(CONFIG.DataPath .. "/avi/1.mp4",VK_ESCAPE) --ÊÓÆµÎÄ¼ş
    Cls()
	
	--Ñ¡Ôñ±êÖ÷»¹ÊÇ³©Ïë
	lib.LoadPicture(CC.BG01File,-1,-1)	
	local xz = Moshixz()
	--local player_type = JYMsgBox("Ö÷½ÇÑ¡Ôñ", "Ñ¡ÔñÄãÏëÒªµÄÖ÷½ÇÄ£Ê½*", {"±ê×¼Ö÷½Ç","³©ÏëÖ÷½Ç"}, 2, 903)
	
	if JY.Base["±¸ÓÃ5"] == 0 then
		bzzjmenu()
	elseif JY.Base["±¸ÓÃ5"] == 1 then
		local player_type = 0
		--local cx,zj,ts,xb = firstmenu()
		local cx,zj,ts,xb = firstmenu1()
		
		if ts > 0 then 
			player_type = 3
		elseif cx > 0 then
			player_type = 2
		else 
			player_type = 1
		end


		Cls()
		JY.Person[0]["ĞÕÃû"]=CC.NewPersonName; 
		JY.Person[0]["ÉúÃü×î´óÖµ"] = 500
		JY.Person[0]["ÄÚÁ¦×î´óÖµ"] = 500
		JY.Person[0]["ÉúÃü"] = JY.Person[0]["ÉúÃü×î´óÖµ"]
		JY.Person[0]["ÄÚÁ¦"] = JY.Person[0]["ÄÚÁ¦×î´óÖµ"]
		JY.Person[0]["¹¥»÷Á¦"] = 80
		JY.Person[0]["·ÀÓùÁ¦"] = 80
		JY.Person[0]["Çá¹¦"] = 80
		JY.Person[0]["Ò½ÁÆÄÜÁ¦"] = 30
		JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"] = 30
		--JY.Person[0]["½â¶¾ÄÜÁ¦"] = 30
		JY.Person[0]["¿¹¶¾ÄÜÁ¦"] = 0
		JY.Person[0]["È­ÕÆ¹¦·ò"] = 40
		JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 40
		JY.Person[0]["Óù½£ÄÜÁ¦"] = 40
		JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 40
		JY.Person[0]["ÌØÊâ±øÆ÷"] = 40
		JY.Person[0]["°µÆ÷¼¼ÇÉ"] = 40

		local zm = JY.Base["ÖÜÄ¿"]
		local nd = JY.Base["ÄÑ¶È"] 
		local addkfnum  
		if nd < 4 then 
			addkfnum = 12 + math.modf(zm/2)
		else
			addkfnum = 12 + math.modf(zm/1)
		end 
		JY.Base["Îä¹¦ÊıÁ¿"] = JY.Base["Îä¹¦ÊıÁ¿"] + addkfnum + 3
		if JY.Base["Îä¹¦ÊıÁ¿"] > 15 then 
			JY.Base["Îä¹¦ÊıÁ¿"] = 15
		end	
		--±ê×¼Ö÷½Ç+ÌØÊâÖ÷½Ç
		lib.LoadPicture(CC.BG01File,-1,-1)
		if player_type == 3 then
			if ts == 1 then 
				JY.Base["ÌØÊâ"] = 1
				--ÌØÊâÖ÷½ÇµÄÌùÍ¼
				JY.Person[0]["ĞÕÃû"] = "ÎŞ¾Æ²»»¶"
				JY.Person[0]["Í·Ïñ´úºÅ"] = 355
				JY.Person[0]["°ëÉíÏñ"] = 355
				local T_ani = {
					{0, 0, 0}, 
					{0, 0, 0}, 
					{10, 8, 6}, 
					{0, 0, 0}, 
					{0, 0, 0}}
				for i = 1, 5 do
					JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i] = T_ani[i][1]
					JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i] = T_ani[i][3]
					JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i] = T_ani[i][2]
				end
			elseif ts == 2 then
				JY.Base["ÌØÊâ"] = 2
				JY.Person[0]["ĞÕÃû"] = "·²Ğ¾¶ù"
				JY.Person[0]["ĞÔ±ğ"] = 1
				JY.Person[0]["ÍâºÅ"] = "¹ÃÄï"
				JY.Person[0]["ÍâºÅ2"] = "Ñ¾Í·"
				JY.Person[0]["Í·Ïñ´úºÅ"] = 368
				JY.Person[0]["°ëÉíÏñ"] = 580
				local f_ani = {
						{0, 0, 0}, 
						{0, 0, 0}, 
						{17, 15, 13}, 
						{0, 0, 0}, 
						{0, 0, 0}}
				for i = 1, 5 do
					JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i] = f_ani[i][1]
					JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i] = f_ani[i][3]
					JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i] = f_ani[i][2]
				end
			end
			
			--if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñ×Ô´øÎä¹¦", C_WHITE, CC.DefaultFont) == true then

				for i=1,JY.Base["Îä¹¦ÊıÁ¿"] do
					JY.Person[0]["Îä¹¦" .. i]=JY.Person[clone_choice]["Îä¹¦" .. i]
					JY.Person[0]["Îä¹¦µÈ¼¶" .. i]=JY.Person[clone_choice]["Îä¹¦µÈ¼¶" .. i]
					if i > 2 then
						JY.Person[0]["Îä¹¦" .. i] = 0
					   JY.Person[0]["Îä¹¦µÈ¼¶" .. i] = 0	
					end
				end
			--else
				--[[for i=1,JY.Base["Îä¹¦ÊıÁ¿"] do
					JY.Person[0]["Îä¹¦" .. i]=JY.Person[clone_choice]["Îä¹¦" .. i]
					JY.Person[0]["Îä¹¦µÈ¼¶" .. i]=JY.Person[clone_choice]["Îä¹¦µÈ¼¶" .. i]
					if i > 0 then
						JY.Person[0]["Îä¹¦" .. i] = 0
					   JY.Person[0]["Îä¹¦µÈ¼¶" .. i] = 0	
					end
				end		
			end]]
		elseif player_type == 2 then
				
			local clone_choice = cx
			JY.Base["³©Ïë"] = cx
			
			JY.Person[0]["´úºÅ"]=JY.Person[clone_choice]["´úºÅ"]
			JY.Person[0]["Í·Ïñ´úºÅ"]=JY.Person[clone_choice]["Í·Ïñ´úºÅ"]
			JY.Person[0]["°ëÉíÏñ"]=JY.Person[clone_choice]["°ëÉíÏñ"]
			JY.Person[0]["ÉúÃüÔö³¤"]=JY.Person[clone_choice]["ÉúÃüÔö³¤"]
			if JY.Person[0]["ÉúÃüÔö³¤"] < 6 then
				JY.Person[0]["ÉúÃüÔö³¤"] = 6
			end
			if JY.Person[0]["ÉúÃüÔö³¤"] > 12 then
				JY.Person[0]["ÉúÃüÔö³¤"] = 12
			end
			JY.Person[0]["ÎŞÓÃ"]=JY.Person[clone_choice]["ÎŞÓÃ"]
			if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñÒªÎª³©ÏëÖ÷½ÇÃüÃû£¿", C_WHITE, CC.DefaultFont) then
				JY.Person[0]["ĞÕÃû"] = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
			else
				JY.Person[0]["ĞÕÃû"]=JY.Person[clone_choice]["ĞÕÃû"]
			end
			JY.Person[0]["ÍâºÅ"]=JY.Person[clone_choice]["ÍâºÅ"]
			JY.Person[0]["ĞÔ±ğ"]=JY.Person[clone_choice]["ĞÔ±ğ"]

			JY.Person[0]["ÎäÆ÷"]=-1
			JY.Person[0]["·À¾ß"]=-1
			JY.Person[0]["×øÆï"]=-1
			for i=1,5 do
				JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i]=JY.Person[clone_choice]["³öÕĞ¶¯»­Ö¡Êı" .. i]
				JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i]=JY.Person[clone_choice]["³öÕĞ¶¯»­ÑÓ³Ù" .. i]
				JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i]=JY.Person[clone_choice]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i]
			end
			
			--³©Ïë¹¥·ÀÇá×îµÍ55
			JY.Person[0]["¹¥»÷Á¦"]=limitX(JY.Person[clone_choice]["¹¥»÷Á¦"]/4,55,75)
			JY.Person[0]["·ÀÓùÁ¦"]=limitX(JY.Person[clone_choice]["·ÀÓùÁ¦"]/4,55,75)
			JY.Person[0]["Çá¹¦"]=limitX(JY.Person[clone_choice]["Çá¹¦"]/4,55,75)
			--Ò½ÁÆÓÃ¶¾½â¶¾×îµÍ30
			JY.Person[0]["Ò½ÁÆÄÜÁ¦"]=limitX(JY.Person[clone_choice]["Ò½ÁÆÄÜÁ¦"],30)
			JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["ÓÃ¶¾ÄÜÁ¦"],30)
			--JY.Person[0]["½â¶¾ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["½â¶¾ÄÜÁ¦"],30)
			JY.Person[0]["°µÆ÷¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["°µÆ÷¼¼ÇÉ"],30)
			JY.Person[0]["¿¹¶¾ÄÜÁ¦"]=JY.Person[clone_choice]["¿¹¶¾ÄÜÁ¦"]
			JY.Person[0]["Ö÷ÔËÄÚ¹¦"]=nil
			JY.Person[0]["Ö÷ÔËÇá¹¦"]=nil	
			JY.Person[0]["¸öÈË¾õĞÑ"]= 0
			JY.Person[0]["ÓÅÏÈÊ¹ÓÃ"]= 0

			if CC.PersonExit[clone_choice] ~= nil  then
			
			JY.Person[0]["È­ÕÆ¹¦·ò"]=limitX(JY.Person[clone_choice]["È­ÕÆ¹¦·ò"],40,70)
			JY.Person[0]["Ö¸·¨¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ö¸·¨¼¼ÇÉ"],40,70)
			JY.Person[0]["Óù½£ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["Óù½£ÄÜÁ¦"],40,70)	
			JY.Person[0]["Ë£µ¶¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ë£µ¶¼¼ÇÉ"],40,70)
			JY.Person[0]["ÌØÊâ±øÆ÷"]=limitX(JY.Person[clone_choice]["ÌØÊâ±øÆ÷"],40,70)
			else
			
			JY.Person[0]["È­ÕÆ¹¦·ò"]=limitX(JY.Person[clone_choice]["È­ÕÆ¹¦·ò"]/3,40,70)
			JY.Person[0]["Ö¸·¨¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ö¸·¨¼¼ÇÉ"]/3,40,70)
			JY.Person[0]["Óù½£ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["Óù½£ÄÜÁ¦"]/3,40,70)		
			JY.Person[0]["Ë£µ¶¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ë£µ¶¼¼ÇÉ"]/3,40,70)	
			JY.Person[0]["ÌØÊâ±øÆ÷"]=limitX(JY.Person[clone_choice]["ÌØÊâ±øÆ÷"]/3,40,70)	
			end
			
			JY.Person[0]["ÎäÑ§³£Ê¶"]=JY.Person[clone_choice]["ÎäÑ§³£Ê¶"]
			JY.Person[0]["¹¥»÷´ø¶¾"]=JY.Person[clone_choice]["¹¥»÷´ø¶¾"]
			JY.Person[0]["×óÓÒ»¥²«"]=JY.Person[clone_choice]["×óÓÒ»¥²«"]
			JY.Person[0]["ÖĞÓ¹"]=JY.Person[clone_choice]["ÖĞÓ¹"]
			-- if JY.Base["³©Ïë"] == 514 then
					-- JY.Person[0]["È­ÕÆ¹¦·ò"]= 50 + zm
					-- JY.Person[0]["Ö¸·¨¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["Óù½£ÄÜÁ¦"]= 50 + zm
					-- JY.Person[0]["Ë£µ¶¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["ÌØÊâ±øÆ÷"]= 50 + zm
			-- end
			
			-- if JY.Base["³©Ïë"] == 515 then
					-- JY.Person[0]["È­ÕÆ¹¦·ò"]= 50 + zm
					-- JY.Person[0]["Ö¸·¨¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["Óù½£ÄÜÁ¦"]= 50 + zm
					-- JY.Person[0]["Ë£µ¶¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["ÌØÊâ±øÆ÷"]= 50 + zm
			-- end
			if JY.Base["³©Ïë"] ~= 52 then	--±ê¼ÇĞŞ¸Ä
				Cls();	
				--if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñ×Ô´øÎä¹¦", C_WHITE, CC.DefaultFont) == true then

				for i=1,JY.Base["Îä¹¦ÊıÁ¿"] do
					JY.Person[0]["Îä¹¦" .. i]=JY.Person[clone_choice]["Îä¹¦" .. i]
					JY.Person[0]["Îä¹¦µÈ¼¶" .. i]=JY.Person[clone_choice]["Îä¹¦µÈ¼¶" .. i]
					if i > 2 then
						JY.Person[0]["Îä¹¦" .. i] = 0
					   JY.Person[0]["Îä¹¦µÈ¼¶" .. i] = 0	
					end
				end
				--else
					--[[for i=1,JY.Base["Îä¹¦ÊıÁ¿"] do
						JY.Person[0]["Îä¹¦" .. i]=JY.Person[clone_choice]["Îä¹¦" .. i]
						JY.Person[0]["Îä¹¦µÈ¼¶" .. i]=JY.Person[clone_choice]["Îä¹¦µÈ¼¶" .. i]
						if i > 0 then
							JY.Person[0]["Îä¹¦" .. i] = 0
						   JY.Person[0]["Îä¹¦µÈ¼¶" .. i] = 0	
						end
					end		
				end]]
			end
			
			--µ¥Í¨¸£Àû
			--[[if JY.Base['µ¥Í¨'] == 1 then
				local id = JY.Base['³©Ïë']
				if MPPD(id) > 0 then
					local mptype, mpdj = MPDISPLAY(id)
					if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñ×Ô´øÃÅÅÉ£¿ÃÅÅÉ£º"..mptype.."£¯".."Î»½×£º"..mpdj, C_WHITE, CC.DefaultFont) == true then
						JoinMP(0,MPPD(id),MPDJ(id))
						MPAttrib(0)
					else
					end
				end
			end]]	
			for i=1,4 do
				JY.Person[0]["Ğ¯´øÎïÆ·" .. i]=JY.Person[clone_choice]["Ğ¯´øÎïÆ·" .. i]
				JY.Person[0]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i]=JY.Person[clone_choice]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i]
			end
			
			for i=1,4 do
				JY.Person[0]["Ìì¸³Íâ¹¦"..i]=JY.Person[clone_choice]["Ìì¸³Íâ¹¦"..i]
			end
			
			JY.Person[0]["Ìì¸³ÄÚ¹¦"]=JY.Person[clone_choice]["Ìì¸³ÄÚ¹¦"]
			JY.Person[0]["Ìì¸³Çá¹¦"]=JY.Person[clone_choice]["Ìì¸³Çá¹¦"]
			--JY.Person[0]["³©Ïë·Ö½×"]=JY.Person[clone_choice]["³©Ïë·Ö½×"]
			JY.Person[0]["ÍâºÅ2"]=JY.Person[clone_choice]["ÍâºÅ2"]
			JY.Person[0]["ÌØÉ«Ö¸Áî"] = JY.Person[clone_choice]["ÌØÉ«Ö¸Áî"]
				
			--ÁÙÊ±ĞŞÕı½áÊø£¬ÕûºÏ°æÇë¼ÇµÃ½«´Ë´¦ĞŞÕıÖÁupedit-------------		
			--ß÷Ì«¼«ÁÙÊ±ĞŞÕı
			JY.Person[92]['ÃÅÅÉ¼¼ÄÜ1'] = 171
			--ÁÙÊ±Ìæ»»Ä£ĞÍ
			
			--Ïô·åĞŞÕı
			JY.Person[539]["ĞÕÃû"] = "Ïô·å"
			JY.Person[539]["³öÕĞ¶¯»­Ö¡Êı2"]= JY.Person[50]["³öÕĞ¶¯»­Ö¡Êı2"]
			JY.Person[539]["³öÕĞ¶¯»­ÑÓ³Ù2"]= JY.Person[50]["³öÕĞ¶¯»­ÑÓ³Ù2"]
			JY.Person[539]["Îä¹¦ÒôĞ§ÑÓ³Ù2"]= JY.Person[50]["Îä¹¦ÒôĞ§ÑÓ³Ù2"]
			JY.Person[539]["³öÕĞ¶¯»­Ö¡Êı4"]= 0
			JY.Person[539]["³öÕĞ¶¯»­ÑÓ³Ù4"]= 0
			JY.Person[539]["Îä¹¦ÒôĞ§ÑÓ³Ù4"]= 0
			--³©ÏëôÃÇ§³ßÍ·Ïñ±äÃÀ
			if JY.Base["³©Ïë"] == 617 then
				JY.Person[0]["Í·Ïñ´úºÅ"]=848
				JY.Person[0]["°ëÉíÏñ"]=353
				JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı3"]=10
				JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù3"]=8
				JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù3"]=8
			end
			--³©ÏëÎŞÑÄ×Ó
			if JY.Base["³©Ïë"] == 116 then
				JY.Person[0]["Í·Ïñ´úºÅ"]=882
				JY.Person[0]["°ëÉíÏñ"]=1089
				JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı2"]=17
				JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù2"]=15
				JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù2"]=15
			end
			--¶«·½²»°Ü³õææ
			if JY.Base["³©Ïë"] == 27 then
			   --instruct_32(349,-1)
			end		
			
			--³©ÏëÇÇ·å¿ª¾ÖÑ¡ÔñÍâ¹¦
			if JY.Base["³©Ïë"] == 50 then
				--[[
				local wcywg = JYMsgBox("ÇëÑ¡Ôñ", "ÇëÑ¡ÔñÄãµÄ³õÊ¼Íâ¹¦", {"½µÁúÊ®°ËÕÆ","´ò¹·°ô·¨"}, 2, 50)
				if wcywg == 1 then
					JY.Person[0]["Îä¹¦1"] = 26
					JY.Person[0]["Îä¹¦µÈ¼¶1"] = 999
				elseif wcywg == 2 then
					JY.Person[0]["Îä¹¦1"] = 80
					JY.Person[0]["Îä¹¦µÈ¼¶1"] = 999
				end
				]]
				JY.Person[0]["Îä¹¦1"] = 26
				JY.Person[0]["Îä¹¦µÈ¼¶1"] = 999
				JY.Person[0]["Îä¹¦2"] = 80
				JY.Person[0]["Îä¹¦µÈ¼¶2"] = 999
				--JY.Person[0]["Îä¹¦3"] = 204
				--JY.Person[0]["Îä¹¦µÈ¼¶3"] = 999
				ClsN()
			end
			
			--³©ÏëÑî¹ı³õÊ¼»¯
			if JY.Base["³©Ïë"] == 58 then
				JY.Scene[19]["½øÈëÌõ¼ş"] = 1
				JY.Scene[101]["½øÈëÌõ¼ş"] = 1
				JY.Scene[36]["½øÈëÌõ¼ş"] = 1
				JY.Scene[28]["½øÈëÌõ¼ş"] = 1
				JY.Scene[93]["½øÈëÌõ¼ş"] = 1
				JY.Scene[105]["½øÈëÌõ¼ş"] = 1
				null(18, 6)
				null(70, 87)
				addevent(70, 95, 0, 4188, 3, 0)
			end
			--³õÊ¼¶À¹Â
			if JY.Base["³©Ïë"] == 592 then
				JY.Person[0]["Îä¹¦2"]= 0
				JY.Person[0]["Îä¹¦µÈ¼¶2"]= 0
				JY.Person[0]["Ë£µ¶¼¼ÇÉ"]=30
				JY.Person[0]["ÌØÊâ±øÆ÷"]=30
				JY.Person[0]["Ö¸·¨¼¼ÇÉ"]=30
				JY.Person[0]["È­ÕÆ¹¦·ò"]=30
			end
			local menu = {}
			for k,v in pairs(CC.PTFSM) do
				if CC.PTFSM[k][1] ~= nil and CC.PTF[clone_choice][k] == 1 then
					CC.PTF[0][k] = 1
				end	
			end
			Hp_Max(0)	
			--SetJX(626,1)
		elseif player_type == 1 then 
			if xb == 1 then 
				JY.Person[0]["ĞÔ±ğ"] = 1
				JY.Person[0]["ÍâºÅ"] = "¹ÃÄï"
				JY.Person[0]["ÍâºÅ2"] = "Ñ¾Í·"				
				local f_ani = {
				{0, 0, 0}, 
				{9, 9, 7}, 
				{8, 8, 6}, 
				{8, 8, 6}, 
				{9, 7, 7}}
				for i = 1, 5 do
					JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i] = f_ani[i][1]
					JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i] = f_ani[i][3]
					JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i] = f_ani[i][2]
				end
			end
			
			--ÊÇ±êÖ÷
			if zj == 1 then         --È­
				JY.Base["±ê×¼"] = 1
				JY.Person[0]["È­ÕÆ¹¦·ò"] = 60
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end
				SetTF(0,9960,1)
			elseif zj == 2 then     --Ö¸
				JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 60
				JY.Base["±ê×¼"] = 2
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end
				SetTF(0,9959,1)
			elseif zj == 3 then     --½£
				JY.Person[0]["Óù½£ÄÜÁ¦"] = 60
				JY.Base["±ê×¼"] = 3	
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547--228
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end
				SetTF(0,9958,1)
			elseif zj == 4 then     --µ¶
				JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 60
				JY.Base["±ê×¼"] = 4
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end
				SetTF(0,9957,1)
			elseif zj == 5 then		 --ÌØ 
				JY.Person[0]["ÌØÊâ±øÆ÷"] = 60
				JY.Base["±ê×¼"] = 5
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end
				SetTF(0,9956,1)
			elseif zj == 6 then		 --Ììî¸
				JY.Person[0]["ÄÚÁ¦×î´óÖµ"] = 5000
				JY.Person[0]["ÄÚÁ¦"] = 5000
				JY.Person[0]["ÉúÃüÔö³¤"] = 7
				JY.Base["±ê×¼"] = 6
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end
				--SetTF(0,9947,1)
				SetTF(0,9946,1)
			elseif zj == 7 then		 --ÈÊÕß
				JY.Person[0]["Æ·µÂ"] = 100
				JY.Person[0]["È­ÕÆ¹¦·ò"] = 50
				JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 50
				JY.Person[0]["Óù½£ÄÜÁ¦"] = 50
				JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 50
				JY.Person[0]["ÌØÊâ±øÆ÷"] = 50
				JY.Base["±ê×¼"] = 7
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end				
			elseif zj == 8 then		 --Ò½Éú
				JY.Base["±ê×¼"] = 8
				JY.Person[0]["Ò½ÁÆÄÜÁ¦"] = 200
				JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"] = 200
				JY.Person[0]["ÉúÃüÔö³¤"] = 7
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end				
			elseif zj == 9 then		 --¶¾Íõ
				JY.Base["±ê×¼"] = 9
				JY.Person[0]["ÉúÃüÔö³¤"] = 7
				JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"] = 300
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end		
			elseif zj == 10 then		 --æÎÖ÷
				JY.Base["±ê×¼"] = 10
				JY.Person[0]["È­ÕÆ¹¦·ò"] = 50
				JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 50
				JY.Person[0]["Óù½£ÄÜÁ¦"] = 50
				JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 50
				JY.Person[0]["ÌØÊâ±øÆ÷"] = 50
				JY.Person[0]["ÉúÃüÔö³¤"] = 7
				if xb == 1 then
					JY.Person[0]["Í·Ïñ´úºÅ"] = 547
				else
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
				end			
			end            	
		end
    else
		local player_type = 0
		--local cx,zj,ts,xb = firstmenu()
		local cx,zj,ts,xb = firstmenu2()
		
		if ts > 0 then 
			player_type = 3
		elseif cx > 0 then
			player_type = 2
		else 
			player_type = 1
		end


		Cls()
		JY.Person[0]["ĞÕÃû"]=CC.NewPersonName; 
		JY.Person[0]["ÉúÃü×î´óÖµ"] = 500
		JY.Person[0]["ÄÚÁ¦×î´óÖµ"] = 500
		JY.Person[0]["ÉúÃü"] = JY.Person[0]["ÉúÃü×î´óÖµ"]
		JY.Person[0]["ÄÚÁ¦"] = JY.Person[0]["ÄÚÁ¦×î´óÖµ"]
		JY.Person[0]["¹¥»÷Á¦"] = 80
		JY.Person[0]["·ÀÓùÁ¦"] = 80
		JY.Person[0]["Çá¹¦"] = 80
		JY.Person[0]["Ò½ÁÆÄÜÁ¦"] = 30
		JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"] = 30
		--JY.Person[0]["½â¶¾ÄÜÁ¦"] = 30
		JY.Person[0]["¿¹¶¾ÄÜÁ¦"] = 0
		JY.Person[0]["È­ÕÆ¹¦·ò"] = 40
		JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 40
		JY.Person[0]["Óù½£ÄÜÁ¦"] = 40
		JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 40
		JY.Person[0]["ÌØÊâ±øÆ÷"] = 40
		JY.Person[0]["°µÆ÷¼¼ÇÉ"] = 40

		local zm = JY.Base["ÖÜÄ¿"]
		local nd = JY.Base["ÄÑ¶È"] 
		local addkfnum  
		if nd < 4 then 
			addkfnum = 12 + math.modf(zm/2)
		else
			addkfnum = 12 + math.modf(zm/1)
		end 
		JY.Base["Îä¹¦ÊıÁ¿"] = JY.Base["Îä¹¦ÊıÁ¿"] + addkfnum + 3
		if JY.Base["Îä¹¦ÊıÁ¿"] > 15 then 
			JY.Base["Îä¹¦ÊıÁ¿"] = 15
		end	
		--±ê×¼Ö÷½Ç+ÌØÊâÖ÷½Ç
		lib.LoadPicture(CC.BG01File,-1,-1)
		if player_type == 2 then
				
			local clone_choice = cx
			JY.Base["³©Ïë"] = cx
			
			JY.Person[0]["´úºÅ"]=JY.Person[clone_choice]["´úºÅ"]
			JY.Person[0]["Í·Ïñ´úºÅ"]=JY.Person[clone_choice]["Í·Ïñ´úºÅ"]
			JY.Person[0]["°ëÉíÏñ"]=JY.Person[clone_choice]["°ëÉíÏñ"]
			JY.Person[0]["ÉúÃüÔö³¤"]=JY.Person[clone_choice]["ÉúÃüÔö³¤"]
			if JY.Person[0]["ÉúÃüÔö³¤"] < 6 then
				JY.Person[0]["ÉúÃüÔö³¤"] = 6
			end
			if JY.Person[0]["ÉúÃüÔö³¤"] > 12 then
				JY.Person[0]["ÉúÃüÔö³¤"] = 12
			end
			JY.Person[0]["ÎŞÓÃ"]=JY.Person[clone_choice]["ÎŞÓÃ"]
			if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñÒªÎª³©ÏëÖ÷½ÇÃüÃû£¿", C_WHITE, CC.DefaultFont) then
				JY.Person[0]["ĞÕÃû"] = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
			else
				JY.Person[0]["ĞÕÃû"]=JY.Person[clone_choice]["ĞÕÃû"]
			end
			JY.Person[0]["ÍâºÅ"]=JY.Person[clone_choice]["ÍâºÅ"]
			JY.Person[0]["ĞÔ±ğ"]=JY.Person[clone_choice]["ĞÔ±ğ"]

			JY.Person[0]["ÎäÆ÷"]=-1
			JY.Person[0]["·À¾ß"]=-1
			JY.Person[0]["×øÆï"]=-1
			for i=1,5 do
				JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i]=JY.Person[clone_choice]["³öÕĞ¶¯»­Ö¡Êı" .. i]
				JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i]=JY.Person[clone_choice]["³öÕĞ¶¯»­ÑÓ³Ù" .. i]
				JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i]=JY.Person[clone_choice]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i]
			end
			
			--³©Ïë¹¥·ÀÇá×îµÍ55
			JY.Person[0]["¹¥»÷Á¦"]=limitX(JY.Person[clone_choice]["¹¥»÷Á¦"]/4,55,75)
			JY.Person[0]["·ÀÓùÁ¦"]=limitX(JY.Person[clone_choice]["·ÀÓùÁ¦"]/4,55,75)
			JY.Person[0]["Çá¹¦"]=limitX(JY.Person[clone_choice]["Çá¹¦"]/4,55,75)
			--Ò½ÁÆÓÃ¶¾½â¶¾×îµÍ30
			JY.Person[0]["Ò½ÁÆÄÜÁ¦"]=limitX(JY.Person[clone_choice]["Ò½ÁÆÄÜÁ¦"],30)
			JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["ÓÃ¶¾ÄÜÁ¦"],30)
			--JY.Person[0]["½â¶¾ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["½â¶¾ÄÜÁ¦"],30)
			JY.Person[0]["°µÆ÷¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["°µÆ÷¼¼ÇÉ"],30)
			JY.Person[0]["¿¹¶¾ÄÜÁ¦"]=JY.Person[clone_choice]["¿¹¶¾ÄÜÁ¦"]
			JY.Person[0]["Ö÷ÔËÄÚ¹¦"]=nil
			JY.Person[0]["Ö÷ÔËÇá¹¦"]=nil	
			JY.Person[0]["¸öÈË¾õĞÑ"]= 0
			JY.Person[0]["ÓÅÏÈÊ¹ÓÃ"]= 0

			if CC.PersonExit[clone_choice] ~= nil  then
			
			JY.Person[0]["È­ÕÆ¹¦·ò"]=limitX(JY.Person[clone_choice]["È­ÕÆ¹¦·ò"],40,70)
			JY.Person[0]["Ö¸·¨¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ö¸·¨¼¼ÇÉ"],40,70)
			JY.Person[0]["Óù½£ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["Óù½£ÄÜÁ¦"],40,70)	
			JY.Person[0]["Ë£µ¶¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ë£µ¶¼¼ÇÉ"],40,70)
			JY.Person[0]["ÌØÊâ±øÆ÷"]=limitX(JY.Person[clone_choice]["ÌØÊâ±øÆ÷"],40,70)
			else
			
			JY.Person[0]["È­ÕÆ¹¦·ò"]=limitX(JY.Person[clone_choice]["È­ÕÆ¹¦·ò"]/3,40,70)
			JY.Person[0]["Ö¸·¨¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ö¸·¨¼¼ÇÉ"]/3,40,70)
			JY.Person[0]["Óù½£ÄÜÁ¦"]=limitX(JY.Person[clone_choice]["Óù½£ÄÜÁ¦"]/3,40,70)		
			JY.Person[0]["Ë£µ¶¼¼ÇÉ"]=limitX(JY.Person[clone_choice]["Ë£µ¶¼¼ÇÉ"]/3,40,70)	
			JY.Person[0]["ÌØÊâ±øÆ÷"]=limitX(JY.Person[clone_choice]["ÌØÊâ±øÆ÷"]/3,40,70)	
			end
			
			JY.Person[0]["ÎäÑ§³£Ê¶"]=JY.Person[clone_choice]["ÎäÑ§³£Ê¶"]
			JY.Person[0]["¹¥»÷´ø¶¾"]=JY.Person[clone_choice]["¹¥»÷´ø¶¾"]
			JY.Person[0]["×óÓÒ»¥²«"]=JY.Person[clone_choice]["×óÓÒ»¥²«"]
			JY.Person[0]["ÖĞÓ¹"]=JY.Person[clone_choice]["ÖĞÓ¹"]
			-- if JY.Base["³©Ïë"] == 514 then
					-- JY.Person[0]["È­ÕÆ¹¦·ò"]= 50 + zm
					-- JY.Person[0]["Ö¸·¨¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["Óù½£ÄÜÁ¦"]= 50 + zm
					-- JY.Person[0]["Ë£µ¶¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["ÌØÊâ±øÆ÷"]= 50 + zm
			-- end
			
			-- if JY.Base["³©Ïë"] == 515 then
					-- JY.Person[0]["È­ÕÆ¹¦·ò"]= 50 + zm
					-- JY.Person[0]["Ö¸·¨¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["Óù½£ÄÜÁ¦"]= 50 + zm
					-- JY.Person[0]["Ë£µ¶¼¼ÇÉ"]= 50 + zm
					-- JY.Person[0]["ÌØÊâ±øÆ÷"]= 50 + zm
			-- end
			if JY.Base["³©Ïë"] ~= 52 then	--±ê¼ÇĞŞ¸Ä
				Cls();	
				--if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñ×Ô´øÎä¹¦", C_WHITE, CC.DefaultFont) == true then

				for i=1,JY.Base["Îä¹¦ÊıÁ¿"] do
					JY.Person[0]["Îä¹¦" .. i]=JY.Person[clone_choice]["Îä¹¦" .. i]
					JY.Person[0]["Îä¹¦µÈ¼¶" .. i]=JY.Person[clone_choice]["Îä¹¦µÈ¼¶" .. i]
					if i > 2 then
						JY.Person[0]["Îä¹¦" .. i] = 0
					   JY.Person[0]["Îä¹¦µÈ¼¶" .. i] = 0	
					end
				end
				--else
					--[[for i=1,JY.Base["Îä¹¦ÊıÁ¿"] do
						JY.Person[0]["Îä¹¦" .. i]=JY.Person[clone_choice]["Îä¹¦" .. i]
						JY.Person[0]["Îä¹¦µÈ¼¶" .. i]=JY.Person[clone_choice]["Îä¹¦µÈ¼¶" .. i]
						if i > 0 then
							JY.Person[0]["Îä¹¦" .. i] = 0
						   JY.Person[0]["Îä¹¦µÈ¼¶" .. i] = 0	
						end
					end		
				end]]
			end
			
			--µ¥Í¨¸£Àû
			--[[if JY.Base['µ¥Í¨'] == 1 then
				local id = JY.Base['³©Ïë']
				if MPPD(id) > 0 then
					local mptype, mpdj = MPDISPLAY(id)
					if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñ×Ô´øÃÅÅÉ£¿ÃÅÅÉ£º"..mptype.."£¯".."Î»½×£º"..mpdj, C_WHITE, CC.DefaultFont) == true then
						JoinMP(0,MPPD(id),MPDJ(id))
						MPAttrib(0)
					else
					end
				end
			end]]	
			for i=1,4 do
				JY.Person[0]["Ğ¯´øÎïÆ·" .. i]=JY.Person[clone_choice]["Ğ¯´øÎïÆ·" .. i]
				JY.Person[0]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i]=JY.Person[clone_choice]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i]
			end
			
			for i=1,4 do
				JY.Person[0]["Ìì¸³Íâ¹¦"..i]=JY.Person[clone_choice]["Ìì¸³Íâ¹¦"..i]
			end
			
			JY.Person[0]["Ìì¸³ÄÚ¹¦"]=JY.Person[clone_choice]["Ìì¸³ÄÚ¹¦"]
			JY.Person[0]["Ìì¸³Çá¹¦"]=JY.Person[clone_choice]["Ìì¸³Çá¹¦"]
			--JY.Person[0]["³©Ïë·Ö½×"]=JY.Person[clone_choice]["³©Ïë·Ö½×"]
			JY.Person[0]["ÍâºÅ2"]=JY.Person[clone_choice]["ÍâºÅ2"]
			JY.Person[0]["ÌØÉ«Ö¸Áî"] = JY.Person[clone_choice]["ÌØÉ«Ö¸Áî"]
				
			--ÁÙÊ±ĞŞÕı½áÊø£¬ÕûºÏ°æÇë¼ÇµÃ½«´Ë´¦ĞŞÕıÖÁupedit-------------		
			--ß÷Ì«¼«ÁÙÊ±ĞŞÕı
			JY.Person[92]['ÃÅÅÉ¼¼ÄÜ1'] = 171
			--ÁÙÊ±Ìæ»»Ä£ĞÍ
			
			--Ïô·åĞŞÕı
			JY.Person[539]["ĞÕÃû"] = "Ïô·å"
			JY.Person[539]["³öÕĞ¶¯»­Ö¡Êı2"]= JY.Person[50]["³öÕĞ¶¯»­Ö¡Êı2"]
			JY.Person[539]["³öÕĞ¶¯»­ÑÓ³Ù2"]= JY.Person[50]["³öÕĞ¶¯»­ÑÓ³Ù2"]
			JY.Person[539]["Îä¹¦ÒôĞ§ÑÓ³Ù2"]= JY.Person[50]["Îä¹¦ÒôĞ§ÑÓ³Ù2"]
			JY.Person[539]["³öÕĞ¶¯»­Ö¡Êı4"]= 0
			JY.Person[539]["³öÕĞ¶¯»­ÑÓ³Ù4"]= 0
			JY.Person[539]["Îä¹¦ÒôĞ§ÑÓ³Ù4"]= 0
			--¶«·½²»°Ü³õææ
			if JY.Base["³©Ïë"] == 27 then
			   --instruct_32(349,-1)
			end		
			
			--³©ÏëÇÇ·å¿ª¾ÖÑ¡ÔñÍâ¹¦
			if JY.Base["³©Ïë"] == 50 then
				--[[
				local wcywg = JYMsgBox("ÇëÑ¡Ôñ", "ÇëÑ¡ÔñÄãµÄ³õÊ¼Íâ¹¦", {"½µÁúÊ®°ËÕÆ","´ò¹·°ô·¨"}, 2, 50)
				if wcywg == 1 then
					JY.Person[0]["Îä¹¦1"] = 26
					JY.Person[0]["Îä¹¦µÈ¼¶1"] = 999
				elseif wcywg == 2 then
					JY.Person[0]["Îä¹¦1"] = 80
					JY.Person[0]["Îä¹¦µÈ¼¶1"] = 999
				end
				]]
				JY.Person[0]["Îä¹¦1"] = 26
				JY.Person[0]["Îä¹¦µÈ¼¶1"] = 999
				JY.Person[0]["Îä¹¦2"] = 80
				JY.Person[0]["Îä¹¦µÈ¼¶2"] = 999
				JY.Person[0]["Îä¹¦3"] = 204
				JY.Person[0]["Îä¹¦µÈ¼¶3"] = 999
				ClsN()
			end
			
			--³©ÏëÑî¹ı³õÊ¼»¯
			if JY.Base["³©Ïë"] == 58 then
				JY.Scene[19]["½øÈëÌõ¼ş"] = 1
				JY.Scene[101]["½øÈëÌõ¼ş"] = 1
				JY.Scene[36]["½øÈëÌõ¼ş"] = 1
				JY.Scene[28]["½øÈëÌõ¼ş"] = 1
				JY.Scene[93]["½øÈëÌõ¼ş"] = 1
				JY.Scene[105]["½øÈëÌõ¼ş"] = 1
				null(18, 6)
				null(70, 87)
				addevent(70, 95, 0, 4188, 3, 0)
			end
			--³õÊ¼¶À¹Â
			if JY.Base["³©Ïë"] == 592 then
				JY.Person[0]["Îä¹¦2"]= 0
				JY.Person[0]["Îä¹¦µÈ¼¶2"]= 0
				JY.Person[0]["Ë£µ¶¼¼ÇÉ"]=30
				JY.Person[0]["ÌØÊâ±øÆ÷"]=30
				JY.Person[0]["Ö¸·¨¼¼ÇÉ"]=30
				JY.Person[0]["È­ÕÆ¹¦·ò"]=30
			end
			local menu = {}
			for k,v in pairs(CC.PTFSM) do
				if CC.PTFSM[k][1] ~= nil and CC.PTF[clone_choice][k] == 1 then
					CC.PTF[0][k] = 1
				end	
			end
			Hp_Max(0)	
			--SetJX(626,1)
		end
    end
    GAME_START1()
	GAME_START2()	

	ClsN()
	lib.LoadPicture(CC.BG01File,-1,-1)	
	TGTF1()
    TGTF()
	
	
	
	--TGTF2()
	--TGTF3()

	ClsN()
	ShowScreen()

    if JY.Base["±ê×¼"] == 6 then 
        JY.Person[0]["ÄÚÁ¦ĞÔÖÊ"] = 3
    end
    if JY.Restart ~= 1 then
		local zhidaiwg = {}
		local zhidaiwgdj = {}
		for pid = 0, JY.PersonNum -1 do
			local p = JY.Person[pid]
			for wg = 1, JY.Base['Îä¹¦ÊıÁ¿'] do
				if JY.Person[pid]['Îä¹¦'..wg] > 0 then
					zhidaiwg[#zhidaiwg+1] = JY.Person[pid]['Îä¹¦'..wg]
					zhidaiwgdj[#zhidaiwgdj+1] = JY.Person[pid]['Îä¹¦µÈ¼¶'..wg]
				end
			end
			if zhidaiwg ~= nil and #zhidaiwg > 0 then
				for k = 1, #zhidaiwg do
					for thingid = 0, JY.ThingNum -1 do
						if JY.Thing[thingid]['Á·³öÎä¹¦'] > 0 and JY.Thing[thingid]['Á·³öÎä¹¦'] == zhidaiwg[k] then
							local cs = 0
							local wgdj = zhidaiwgdj[k]
							if wgdj >= 900 then
								wgdj = 1000
							end	
							while cs < math.modf(wgdj*0.01) do
								if match_ID(pid, 588)  or match_ID(pid, 9862) or match_ID(pid, 9928) or (MPTX(pid,10)) then		--·ëºâ Ë«±¶ÊôĞÔÖµ
									AddPersonAttrib(pid, "ÄÚÁ¦×î´óÖµ", JY.Thing[thingid]["¼ÓÄÚÁ¦×î´óÖµ"])
									AddPersonAttrib(pid, "¹¥»÷Á¦", JY.Thing[thingid]["¼Ó¹¥»÷Á¦"] * 4)
									AddPersonAttrib(pid, "Çá¹¦", JY.Thing[thingid]["¼ÓÇá¹¦"] * 4)
									AddPersonAttrib(pid, "·ÀÓùÁ¦", JY.Thing[thingid]["¼Ó·ÀÓùÁ¦"] * 4)
									AddPersonAttrib(pid, "Ò½ÁÆÄÜÁ¦", JY.Thing[thingid]["¼ÓÒ½ÁÆÄÜÁ¦"])
									AddPersonAttrib(pid, "ÓÃ¶¾ÄÜÁ¦", JY.Thing[thingid]["¼ÓÓÃ¶¾ÄÜÁ¦"])
									--AddPersonAttrib(pid, "½â¶¾ÄÜÁ¦", JY.Thing[thingid]["¼Ó½â¶¾ÄÜÁ¦"])
									AddPersonAttrib(pid, "¿¹¶¾ÄÜÁ¦", JY.Thing[thingid]["¼Ó¿¹¶¾ÄÜÁ¦"])
								else 
									AddPersonAttrib(pid, "ÄÚÁ¦×î´óÖµ", JY.Thing[thingid]["¼ÓÄÚÁ¦×î´óÖµ"])
									AddPersonAttrib(pid, "¹¥»÷Á¦", JY.Thing[thingid]["¼Ó¹¥»÷Á¦"] * 2)
									AddPersonAttrib(pid, "Çá¹¦", JY.Thing[thingid]["¼ÓÇá¹¦"] * 2)
									AddPersonAttrib(pid, "·ÀÓùÁ¦", JY.Thing[thingid]["¼Ó·ÀÓùÁ¦"] * 2)
									AddPersonAttrib(pid, "Ò½ÁÆÄÜÁ¦", JY.Thing[thingid]["¼ÓÒ½ÁÆÄÜÁ¦"])
									AddPersonAttrib(pid, "ÓÃ¶¾ÄÜÁ¦", JY.Thing[thingid]["¼ÓÓÃ¶¾ÄÜÁ¦"])
									AddPersonAttrib(pid, "¿¹¶¾ÄÜÁ¦", JY.Thing[thingid]["¼Ó¿¹¶¾ÄÜÁ¦"])
								end
								
								local mp = 1
								local tf = 1
								if match_ID(pid, 56) or match_ID(pid, 77)  or match_ID(pid, 9862) or match_ID(pid, 9863) or match_ID(pid, 9928) then
									tf = 2
								end
								if JY.Thing[thingid]["¼ÓÈ­ÕÆ¹¦·ò"] > 0 then	
									--ÌÒ»¨µºÈ­ÏµÔö¼Ó
									if MPTX(pid,10) then
										mp = MPDJ(pid) + 1
									end
									--¶ëÃ¼È­ÏµÔö¼Ó
									if MPTX(pid,17) then
										mp = 3
									end
									--áÇá¼È­ÏµÔö¼Ó
									if MPTX(pid,18) then
										mp = 3
									end	
									--Ø¤°ïÈ­ÏµÔö¼Ó
									if MPTX(pid,2) then
										mp = 2
									end
									--¹ÅÄ¹È­ÏµÔö
									if MPTX(pid,3) then  
										mp = 1.5
									end	
									if MPTX(pid,20) or match_ID(pid,514) then
										AddPersonAttrib(pid, "Ë£µ¶¼¼ÇÉ", JY.Thing[thingid]["¼ÓÈ­ÕÆ¹¦·ò"])
									end	
									if mp == 1 and tf == 1 then
										AddPersonAttrib(pid, "È­ÕÆ¹¦·ò", JY.Thing[thingid]["¼ÓÈ­ÕÆ¹¦·ò"])
									else
										if mp >= tf then
											AddPersonAttrib(pid, "È­ÕÆ¹¦·ò", JY.Thing[thingid]["¼ÓÈ­ÕÆ¹¦·ò"]*mp)
										else
											AddPersonAttrib(pid, "È­ÕÆ¹¦·ò", JY.Thing[thingid]["¼ÓÈ­ÕÆ¹¦·ò"]*tf)
										end
									end
								end	
								if JY.Thing[thingid]["¼ÓÖ¸·¨¼¼ÇÉ"] > 0 then
									--ÌÒ»¨µºÖ¸ÏµÔö¼Ó
									if MPTX(pid,10) then
										mp = 3
									end
									--´óÀíÖ¸ÏµÔö¼Ó
									if MPTX(pid,15) then
										mp = 2.5
									end
									
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "Ö¸·¨¼¼ÇÉ", JY.Thing[thingid]["¼ÓÖ¸·¨¼¼ÇÉ"])
									else
										
										if mp >= tf then
											AddPersonAttrib(pid, "Ö¸·¨¼¼ÇÉ", JY.Thing[thingid]["¼ÓÖ¸·¨¼¼ÇÉ"]*mp)
										else
											AddPersonAttrib(pid, "Ö¸·¨¼¼ÇÉ", JY.Thing[thingid]["¼ÓÖ¸·¨¼¼ÇÉ"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["¼ÓÓù½£ÄÜÁ¦"] > 0 then
									--ÌÒ»¨µº½£ÏµÔö¼Ó
									if MPTX(pid,10) then
										mp = 3
									end
									--¶ëÃ¼½£ÏµÔö¼Ó
									if MPTX(pid,17) then
										mp = 3
									end
									--È«Õæ½£ÏµÔö¼Ó
									if MPTX(pid,16) then
										mp = 1.5
									end
									--¹ÅÄ¹½£ÏµÔö¼Ó
									if MPTX(pid,3) then  
										mp = 2
									end
									if mp == 1 and tf == 1 then
										AddPersonAttrib(pid, "Óù½£ÄÜÁ¦", JY.Thing[thingid]["¼ÓÓù½£ÄÜÁ¦"])
										
									else
										
										if mp >= tf then
											AddPersonAttrib(pid, "Óù½£ÄÜÁ¦", JY.Thing[thingid]["¼ÓÓù½£ÄÜÁ¦"]*mp)
										else
											AddPersonAttrib(pid, "Óù½£ÄÜÁ¦", JY.Thing[thingid]["¼ÓÓù½£ÄÜÁ¦"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["¼ÓË£µ¶¼¼ÇÉ"] > 0 then
									--ÌÒ»¨µºµ¶ÏµÔö¼Ó
									if MPTX(pid,10) then
										mp = 3
									end
									--ÃÜ×Úµ¶ÏµÔö¼Ó
									if MPTX(pid,6) then
										mp = 1.5
									end	
									--Ñ©Óğµ¶ÏµÔö¼Ó
									if MPTX(pid,20) or match_ID(pid,514) then
										--mp = 1.5
										AddPersonAttrib(pid, "È­ÕÆ¹¦·ò", JY.Thing[thingid]["¼ÓË£µ¶¼¼ÇÉ"])
									end	
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "Ë£µ¶¼¼ÇÉ", JY.Thing[thingid]["¼ÓË£µ¶¼¼ÇÉ"])
									else
										
										if mp >= tf then
											AddPersonAttrib(pid, "Ë£µ¶¼¼ÇÉ", JY.Thing[thingid]["¼ÓË£µ¶¼¼ÇÉ"]*mp)
										else
											AddPersonAttrib(pid, "Ë£µ¶¼¼ÇÉ", JY.Thing[thingid]["¼ÓË£µ¶¼¼ÇÉ"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["¼ÓÌØÊâ±øÆ÷"] > 0 then
									--ÌÒ»¨µºÌØÏµÔö¼Ó
									if MPTX(pid,10) then
										mp = 3
									end
									--ÉÙÁÖÌØÏµÔö¼Ó
									if MPTX(pid,5) then
										mp = 1.5
									end
									--Ø¤°ïÏµÔö¼Ó
									if MPTX(pid,2) then
										mp = 2
									end		
									--¹ÅÄ¹ÌØÏµÔö¼Ó	
									if MPTX(pid,3) then  
										mp = 1.5 
									end
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "ÌØÊâ±øÆ÷", JY.Thing[thingid]["¼ÓÌØÊâ±øÆ÷"])
									else
										if JY.Base['ÄÑ¶È'] > 2 then
											AddPersonAttrib(pid, "ÌØÊâ±øÆ÷", JY.Thing[thingid]["¼ÓÌØÊâ±øÆ÷"])
										end
										if mp >= tf then
											AddPersonAttrib(pid, "ÌØÊâ±øÆ÷", JY.Thing[thingid]["¼ÓÌØÊâ±øÆ÷"]*mp)
										else
											AddPersonAttrib(pid, "ÌØÊâ±øÆ÷", JY.Thing[thingid]["¼ÓÌØÊâ±øÆ÷"]*tf)
										end
									end
								end
								if JY.Thing[thingid]["¼Ó°µÆ÷¼¼ÇÉ"] > 0 then
									--ÌÒ»¨µº°µÆ÷Ôö¼Ó
									if MPTX(pid,10) then
										mp = 3
									end
									--¹ÅÄ¹°µÆ÷Ôö¼Ó	
									if MPTX(pid,3) then  
										mp = 1.5 
									end
									if mp == 1 and tf == 1 then
										
										AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", JY.Thing[thingid]["¼Ó°µÆ÷¼¼ÇÉ"])
									else
										if JY.Base['ÄÑ¶È'] > 2 then
											AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", JY.Thing[thingid]["¼Ó°µÆ÷¼¼ÇÉ"])
										end
										if mp >= tf then
											AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", JY.Thing[thingid]["¼Ó°µÆ÷¼¼ÇÉ"]*mp)
										else
											AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", JY.Thing[thingid]["¼Ó°µÆ÷¼¼ÇÉ"]*tf)
										end
									end
								end
								AddPersonAttrib(pid, "ÎäÑ§³£Ê¶", JY.Thing[thingid]["¼ÓÎäÑ§³£Ê¶"])
								AddPersonAttrib(pid, "Æ·µÂ", JY.Thing[thingid]["¼ÓÆ·µÂ"])
								AddPersonAttrib(pid, "¹¥»÷´ø¶¾", JY.Thing[thingid]["¼Ó¹¥»÷´ø¶¾"])
								if JY.Thing[thingid]["¼Ó¹¥»÷´ÎÊı"] == 1 then
									if JY.Base["³©Ïë"] == 152 and JY.Person[pid] == JY.Person[0] then
									else
										p["×óÓÒ»¥²«"] = 1
									end
								end
								--ĞŞÁ¶ÌØÊâÒ½ÊõÃØ¼®
								if  p["ÃÅÅÉ¼¼ÄÜ6"] < 1 then
									if thingid >= 187 and thingid <= 193 then
										p["ÃÅÅÉ¼¼ÄÜ6"] = thingid
									end
								end
								--ĞŞÁ¶ÌØÊâ°µÆ÷ÃØ¼®
								if JY.Thing[thingid]["Î´Öª6"] == 1 and p["ÃÅÅÉ¼¼ÄÜ2"] < 1 then
									p["ÃÅÅÉ¼¼ÄÜ2"] = thingid
									if thingid == 458 then
										AddPersonAttrib(pid, "·ÀÓùÁ¦", 20)
										AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", 70)
										AddPersonAttrib(pid, "ÓÃ¶¾ÄÜÁ¦", 20)
									end	
									if thingid == 457 then
										AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", 50)
										AddPersonAttrib(pid, "Çá¹¦", 20)
										--AddPersonAttrib(pid, "·ÀÓùÁ¦", JY.Thing[thingid]["¼Ó·ÀÓùÁ¦"] * 2)
									end
									if thingid == 469 then
										AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", 60)
										AddPersonAttrib(pid, "Çá¹¦", 10)
										AddPersonAttrib(pid, "ÓÃ¶¾ÄÜÁ¦", 30)
									end
									if thingid == 489 then
										AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", 60)
										AddPersonAttrib(pid, "¹¥»÷´ø¶¾", 50)
									end
									if thingid == 469 then
										AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", 70)
										AddPersonAttrib(pid, "Çá¹¦", 20)
									end
									if thingid == 486 then
										AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", 120)
										AddPersonAttrib(pid, "Çá¹¦", 100)
										AddPersonAttrib(pid, "ÓÃ¶¾ÄÜÁ¦", 100)
									end	
								end	
								cs = cs + 1
							end	
						end
					end
				end
				zhidaiwg = {}
				zhidaiwgdj = {}
			end
		end		
		--ÆäËûÈËÎï³õÊ¼»¯
		for p = 0, JY.PersonNum-1 do
			--µĞ·½µÄ³õÊ¼»¯
			if CC.PersonExit[p] == nil and p ~= 0 then
				for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
					if JY.Person[p]["Îä¹¦" .. i] > 0 then
						if p < 191 then
							--JY.Person[p]["Îä¹¦µÈ¼¶" .. i] = 999    --BOSSÎä¹¦ÊÇÎª¼«
						else
							--²»µ½10¼¶µÄ¼Óµ½10¼¶
							if JY.Person[p]["Îä¹¦µÈ¼¶" .. i] < 900 then
								JY.Person[p]["Îä¹¦µÈ¼¶" .. i] = 900
							end
						end
					else
						break;
					end
				end
			
				--ÉúÃü²»×ã200µÄ¼Óµ½200
				if JY.Person[p]["ÉúÃü×î´óÖµ"] < 200 then
					JY.Person[p]["ÉúÃü×î´óÖµ"] = 200
					JY.Person[p]["ÉúÃü"] = JY.Person[p]["ÉúÃü×î´óÖµ"]
				end
				
				--ÄÚÁ¦²»×ã200µÄ¼Óµ½200
				if JY.Person[p]["ÄÚÁ¦×î´óÖµ"] < 200 then
					JY.Person[p]["ÄÚÁ¦×î´óÖµ"] = 200
					JY.Person[p]["ÄÚÁ¦"] = JY.Person[p]["ÄÚÁ¦×î´óÖµ"]
				end
				
				--ÉèÖÃÑªÁ¿·­±¶£¬¸ù¾İÄÑ¶ÈÏµÊıÌá¸ß
				local dif_factor;
				--ÄÑ1£¬ÄÑ2
				if JY.Base["ÄÑ¶È"] < 3 then
					dif_factor = 2;
				--ÄÑ3£¬
				elseif JY.Base["ÄÑ¶È"] == 3 then
					dif_factor = 3;
				--ÄÑ4
				else
					dif_factor = 4;
				end			
				JY.Person[p]["ÑªÁ¿·­±¶"] = dif_factor
				
				--Ä¾×®ÑªÁ¿²»·­±¶
				if p == 591 then
					JY.Person[p]["ÑªÁ¿·­±¶"] = 1
				end
				
				--ÀîÇïË®µÄÎŞÏà·ÖÉíÎª1Ñª
				if p == 600 then
					JY.Person[p]["ÉúÃü×î´óÖµ"] = 1
					JY.Person[p]["ÉúÃü"] = JY.Person[p]["ÉúÃü×î´óÖµ"]
					JY.Person[p]["ÑªÁ¿·­±¶"] = 1
				end
				if JY.Person[p]["ÑªÁ¿·­±¶"]>1 then
		        	JY.Person[p]["ÉúÃü×î´óÖµ"] = JY.Person[p]["ÉúÃü×î´óÖµ"]*JY.Person[p]["ÑªÁ¿·­±¶"]+JY.Base["ÖÜÄ¿"]*(7-JY.Person[p]["³©Ïë·Ö½×"])*10
				end
				if JY.Person[p]["³©Ïë·Ö½×"] == 0 then
					JY.Person[p]["ÉúÃü×î´óÖµ"] = JY.Person[p]["ÉúÃü×î´óÖµ"] + 1000
				end	
	  
				--if p==684 or p==683 or p ==681 then
				if p > 0 then
					JY.Person[p]["Îä¹¦µÈ¼¶1"] = 999
					JY.Person[p]["Îä¹¦µÈ¼¶2"] = 999
					JY.Person[p]["Îä¹¦µÈ¼¶3"] = 999
					JY.Person[p]["Îä¹¦µÈ¼¶4"] = 999
					JY.Person[p]["Îä¹¦µÈ¼¶5"] = 999
					JY.Person[p]["µÈ¼¶"] = 30
				end
				
				--Ëæ»ú´©×°±¸
				--local nn=0
				if JY.Person[p]["³©Ïë·Ö½×"] <3 then
					local n = 548+3*math.random(0,129)			
					NPC_CZB(p,n)
					-- if JY.Person[p]["Ö÷ÔËÇá¹¦"] == 0 then
						-- --JY.Person[p]["Ö÷ÔËÇá¹¦"] = 223
					-- end
					
					-- if JY.Person[p]["³©Ïë·Ö½×"] == 2 then
						-- nn=math.random(100,200)
					-- elseif JY.Person[p]["³©Ïë·Ö½×"] == 1 then
						-- nn=math.random(200,400)
					-- elseif JY.Person[p]["³©Ïë·Ö½×"] == 0 then
						-- nn=math.random(300,500)
					-- end
				end
				if p > 0 and JY.Person[p]["³©Ïë·Ö½×"] >= 3  then
					if JY.Person[p]["ÓÅÏÈÊ¹ÓÃ"] == nil or JY.Person[p]["ÓÅÏÈÊ¹ÓÃ"] < 1 then
					 JY.Person[p]["ÓÅÏÈÊ¹ÓÃ"] = JY.Person[p]["Îä¹¦1"]
					end 
				end
				local nd = JY.Base["ÄÑ¶È"]
		    	local zm = limitX(JY.Base["ÖÜÄ¿"],1,125)
		   	 	local xs = 0
		   	 	local wc = 0
	 	   		local sw = 0
				
				--npcËæÖÜÄ¿Ôö¼Ó×ÔÉíÇ¿¶È
				if nd > 1 and  p ~= 591 then 
					xs = math.modf(zm*2)
					sw = math.modf(zm*2)
					--wc = math.modf(zm*2)
				end
				--µØÓüÄÑ¶ÈnpcËæÖÜÄ¿Ôö¼Ó×ÔÉíÇ¿¶È
				if nd > 3 and p ~= 591 then
					local zj = math.modf(zm*1.5)
					xs = xs + zj
					sw = sw + zj 
				end
				
				--ĞŞ¸Ä±ê¼Ç
				local fj = limitX(8-JY.Person[p]["³©Ïë·Ö½×"],1,8)
				local wj = limitX(JY.Person[p]["³©Ïë·Ö½×"],0,7)
				local sz = math.modf(sw*fj)
				local wx = math.modf(xs/(wj+1))
	            --local fx = math.random(4)
				while sz > 0 do
					--[[local n = math.random(3)           
	                if fx == 1 and n == 1 then 
	                    tt = tt * 2
	                end
	                if fx == 2 and n == 2 then 
	                    tt = tt * 2
	                end  
	                if fx == 3 and n == 3 then 
	                    tt = tt * 2
	                end
					if sz < tt then 
						tt = sz
					end
					if n == 1 then 
						JY.Person[p]["¹¥»÷Á¦"] = JY.Person[p]["¹¥»÷Á¦"] + tt
					elseif n == 2 then 
						JY.Person[p]["·ÀÓùÁ¦"] = JY.Person[p]["·ÀÓùÁ¦"] + tt
					else
						JY.Person[p]["Çá¹¦"] = JY.Person[p]["Çá¹¦"] + tt
					end]]
					fj = fj*1.1
					sz = sz/fj		
					local n = math.random(1,4)
					sz = math.modf(sz*n)
				end
				--fj = math.modf(fj)
				---say('ÔöÇ¿ÊıÖµ'..tt,0,1)
				JY.Person[p]["¹¥»÷Á¦"] = JY.Person[p]["¹¥»÷Á¦"] + sz 
				JY.Person[p]["·ÀÓùÁ¦"] = JY.Person[p]["·ÀÓùÁ¦"] + sz 
				JY.Person[p]["Çá¹¦"] = JY.Person[p]["Çá¹¦"] + sz 
				JY.Person[p]["È­ÕÆ¹¦·ò"] = JY.Person[p]["È­ÕÆ¹¦·ò"] + wx
				JY.Person[p]["Ö¸·¨¼¼ÇÉ"] = JY.Person[p]["Ö¸·¨¼¼ÇÉ"] + wx
				JY.Person[p]["Óù½£ÄÜÁ¦"] = JY.Person[p]["Óù½£ÄÜÁ¦"] + wx
				JY.Person[p]["Ë£µ¶¼¼ÇÉ"] = JY.Person[p]["Ë£µ¶¼¼ÇÉ"] + wx
				JY.Person[p]["ÌØÊâ±øÆ÷"] = JY.Person[p]["ÌØÊâ±øÆ÷"] + wx
				JY.Person[p]['ÎäÑ§³£Ê¶'] = JY.Person[p]['ÎäÑ§³£Ê¶'] + math.modf((zm/7)+(10-JY.Person[p]["³©Ïë·Ö½×"]))			
				JY.Person[p]['ÊµÕ½'] = JY.Person[p]['ÊµÕ½'] + math.modf((zm/5)+(10-JY.Person[p]["³©Ïë·Ö½×"]))
				AddPersonAttrib(p,'ÉúÃü',math.huge)
	        else 
	            JY.Person[p]["³©Ïë·Ö½×"] = 7
	            JY.Person[p]["¹¥»÷Á¦"] = 40
	            JY.Person[p]["·ÀÓùÁ¦"] = 40
	            JY.Person[p]["Çá¹¦"] = 40
	            JY.Person[p]["µÈ¼¶"] = 1
			end
		end		
	end		
	--ÎŞ¾Æ²»»¶£ºÔö¼ÓÒ»Ğ©³õÊ¼»¯Éè¶¨
	JY.Wugong[169]['Îä¹¦ÀàĞÍ'] = 8
	JY.Wugong[378]['Îä¹¦ÀàĞÍ'] = 8
	for j = 1, JY.WugongNum - 1 do
		if JY.Wugong[j]['Îä¹¦ÀàĞÍ'] < 6 then
			JY.Wugong[j]["¹¥»÷Á¦10"] = math.modf(JY.Wugong[j]["¹¥»÷Á¦10"]*0.5)
		end	
	end	 
	--ÁÙÊ±ÎïÆ·µ÷Õû
	JY.Thing[470]["ÎïÆ·ËµÃ÷"] = "¿û»¨±¦µäµÄÇ¿´óÕë·¨"
	
	JY.Thing[249]["ÎïÆ·ËµÃ÷"] = "´óÀíÖ¸·¨£¬ºóÁ÷ÂäÖÁ»ªÉ½ÅÉÊÖÖĞ"
	
	
	--»ªÉ½ºóÉ½Ğ»ÎŞÓÆ
	instruct_3(80, 17, 1, 0, 4105, 0, 0, 4133*2, 4133*2, 4133*2, 0, -2, -2)
	
	--ğ¯Ä¦ÖÇÌùÍ¼
	instruct_3(16, 10, -2,-2,-2,-2,-2,4153*2,4153*2,4153*2,-2,-2,-2)
	
	--ÀîÎÄĞãÌùÍ¼
	instruct_3(62,4,0,0,0,0,0,9238,9238,9238,0,0,0); 
	--ĞÂ»ªÉ½ÂÛ½£ÊÂ¼ş
	addevent(80, 19, 1, 4141, 1, 4335*2)	--Ñò
	
	instruct_3(-2, -2,0,0,0,0,0,0,0,0,0,0,0)  --ĞŞ¸Ä³¡¾°ÊÂ¼ş
	instruct_3(70, 45,1,0,847,848,0,7022,7022,7022,-2,-2,-2)  --ĞŞ¸Ä³¡¾°ÊÂ¼ş
	
end

--ÎŞ¾Æ²»»¶£º»úÂÊÅĞ¶¨º¯Êı
function JLSD(s1, s2, dw)
	local s = math.random(100)
	local chance_up = 0;
	--ÂÛ½£´òÓ®°¢·²Ìá½±Àø£¬¼¸ÂÊ+6
	--[[
	if dw == 0 and JY.Person[606]["ÂÛ½£½±Àø"] == 1 then
		chance_up = 3
	end]]
	--Èç¹û²»ÔÚ¶ÓÎéÖĞ£¬¼¸ÂÊ+20
	--if inteam(dw) == false then
	--	chance_up = 10
	--end
    if JY.Base["±ê×¼"] == 7 and dw == 0 and  WAR.SEYB == 0 then
       	chance_up = chance_up + 8 + math.modf((psx(dw,'Æ·µÂ'))*0.067)
	end	
	if JY.Base["±ê×¼"] == 11 and dw == 0 then
       	chance_up = chance_up + 5 + math.modf((120-psx(dw,'Æ·µÂ'))*0.067)
	end	
	--·ëºâÔö¼ÓÌØĞ§
	if match_ID(dw,588) then
        chance_up =	chance_up + 10
    end 
	--ÎòµÀÇ¬À¤
    if match_ID(dw,9735) then
        chance_up =	chance_up + 10
    end
	--è¤Ù¤ÃØÊõ
	if match_ID(dw,9721) then
        chance_up =	chance_up + 18
    end
	--°ÙÀïÇàËª
	if match_ID(dw,762) then
		chance_up = chance_up + 25
	end 	
	--Ïô°ëºÍ 
	if match_ID(dw,189) then
		chance_up =	chance_up + 15
    end
	--»¨½§ÅÉ
	if MPTX(dw,21,2) then
		chance_up =	chance_up + 5
	end
	--ÌìÄ§½Ì
	if MPTX(dw,31) then
		chance_up = chance_up + 8 + math.modf((120-psx(dw,'Æ·µÂ'))/8)
	end 	
	if JY.Status == GAME_WMAP then
		if WAR.PD['Éñ¾­Éß¶¾'][dw] ~= nil or WAR.PD['Äı½áÊ±¿Õ'][dw] ~= nil then
			return false
		end
		if JY.Person[dw]["ÎäÑ§³£Ê¶"] > 100 then
			local wc = JY.Person[dw]["ÎäÑ§³£Ê¶"] / 100
			if wc > 10 then
				wc = 10
			end
			chance_up = chance_up + wc
		end 
		if WAR.PD['Ç¿ÔË'][dw] ~= nil and WAR.PD['Ç¿ÔË'][dw] == 1 then
			local zm = JY.Base["ÖÜÄ¿"]/5
			chance_up = chance_up + zm
		end 
		if WAR.PD['½£µ´Ê®·½'][dw] ~= nil and WAR.PD['½£µ´Ê®·½'][dw] == 10 and match_ID(dw,592) then
			return true
		end
		if WAR.PD["×ß»ğ×´Ì¬"][dw] == 1 and match_ID(dw,60) then
			chance_up = chance_up + 30
		end
		if QGQH(dw,280,1) then
			chance_up = chance_up + math.modf((WAR.SPIRIT[dw] or 0)*0.1)
		end
		if Curr_NG(dw,102) then
           chance_up =	 chance_up + 5
	    end
		if NGQH(dw,102) then
			chance_up = chance_up + 8
		end	
		if MPTX(dw,8,3) and Curr_NG(dw,104) then
			local zd = JY.Person[dw]["ÖĞ¶¾³Ì¶È"] or 0
			local ns = JY.Person[dw]["ÊÜÉË³Ì¶È"] or 0
			local zs = JY.Person[dw]["×ÆÉÕ³Ì¶È"] or 0
			local bf = JY.Person[dw]["±ù·â³Ì¶È"] or 0
			local lx = JY.Person[dw]["Á÷Ñª³Ì¶È"] or 0
			local fx = JY.Person[dw]["·âÑ¨³Ì¶È"] or 0
			local sh = math.modf((zd + ns + bf + lx + fx) / 50)
			chance_up = chance_up + sh
		end
		if WAR.PD['½£µ´Ê®·½'][dw] ~= nil then
			local jd = WAR.PD['½£µ´Ê®·½'][dw] or 0
			chance_up = chance_up + jd
		end
		if NGQH(dw,108) and JY.Person[dw]['Æ·µÂ'] >= 100 then
			chance_up = chance_up + 5
		end
		if NGQH(dw,203) and psx(dw,'ÉúÃü') > math.modf((psx(dw,'ÉúÃü×î´óÖµ'))*0.7) then
			chance_up = chance_up + 10
		end
		if WAR.PD['Ò×Ë®ËÄº®2'][dw] == 5 then
			chance_up = chance_up + 20
		end	
		if WAR.PD['ÎŞÎÒÖ®¾³'][dw] ~= nil and WAR.PD['ÎŞÎÒÖ®¾³'][dw] > 0 then
			for j = 0, WAR.PersonNum - 1 do
		        local zid = WAR.Person[j]["ÈËÎï±àºÅ"]
		        if WAR.Person[j]["ËÀÍö"] == false then
					if WAR.Person[j]["ÎÒ·½"] == WAR.Person[WAR.CurID]["ÎÒ·½"] then
						chance_up = chance_up + 99
					else
					    chance_up = chance_up - 29
					end
		        end
	        end
		end 
		if MPTX(dw,23,4) and Curr_NG(dw,199) then --³¯Í¢½«¾üÎäÄÂ
			for j = 0, WAR.PersonNum - 1 do
		        local zid = WAR.Person[j]["ÈËÎï±àºÅ"]
				local sz  = math.modf(JY.Person[dw]["ÊµÕ½"]/100)
				if sz > 20 then sz = 20 end
		        if WAR.Person[j]["ËÀÍö"] == false then
					if WAR.Person[j]["ÎÒ·½"] == WAR.Person[WAR.CurID]["ÎÒ·½"] then
						chance_up = chance_up + sz
					else
					    chance_up = chance_up - sz
					end
		        end
	        end
		end
		if WAR.PD['º¬°ú'][dw] ~= nil then
			chance_up = chance_up - 5
		end
		if WAR.PD['»úÂÊÏÂ½µ'][dw] ~= nil then
			chance_up = chance_up - 10
		end
		if WAR.PD['ÑôÆøÇÖÊ´'][dw] ~= nil and psx(dw,'ÉúÃü') <= math.modf((psx(dw,'ÉúÃü×î´óÖµ'))*0.5) then
			chance_up = chance_up - 10
		end
		if WAR.PD['ÒõÆøÎÛÈ¾'][dw] ~= nil and psx(dw,'ÉúÃü') >= math.modf((psx(dw,'ÉúÃü×î´óÖµ'))*0.5) then
			chance_up = chance_up - 10
		end
		if WAR.PD['Ò×Ë®ËÄº®'][dw] == 3 or WAR.PD['Ò×Ë®ËÄº®'][dw] == 5 then
			chance_up = chance_up - 10
		end
		if WAR.PD['ÃüÎŞ³£'][dw] ~= nil then
			chance_up = 0
			s2 = math.modf(s2*0.5)
			s1 = math.modf(s1*1.5)
		end
		if WAR.PD['ĞéĞ°¶ÏÊ±'][dw] ~= nil then
			chance_up = limitX(math.modf(chance_up*0.5),0,10)
		end	
	end
	s2 = s2 + chance_up
	if s1 < 0 then s1 = 0 end
	if s2 < 0 then s2 = 0 end
	--ÅĞ¶¨ÊÇ·ñ³É¹¦
	if s1 < s and s <= s2 then
		return true
	else
		return false
	end
end

--ÓÎÏ·Ö÷Ñ­»·
function Game_Cycle()
    lib.Debug("Start game cycle");

    while JY.Status ~=GAME_END and JY.Status ~=GAME_START do
		if JY.Restart == 1 then
			break
		end
        local t1=lib.GetTime();

	    JY.Mytick=JY.Mytick+1;    --20¸ö½ÚÅÄÎŞ»÷¼ü£¬ÔòÖ÷½Ç±äÎªÕ¾Á¢×´Ì¬
		if JY.Mytick%20==0 then
            JY.MyCurrentPic=0;
		end

        if JY.Mytick%1000==0 then
            JY.MYtick=0;
        end

        if JY.Status==GAME_FIRSTMMAP then  --Ê×´ÎÏÔÊ¾Ö÷³¡¾°£¬ÖØĞÂµ÷ÓÃÖ÷³¡¾°ÌùÍ¼£¬½¥±äÏÔÊ¾¡£È»ºó×ªµ½Õı³£ÏÔÊ¾
			CleanMemory()
			lib.ShowSlow(20, 1)
			JY.MmapMusic = 57
			JY.Status = GAME_MMAP
			Init_MMap()
			lib.DrawMMap(JY.Base["ÈËX"], JY.Base["ÈËY"], GetMyPic())
			lib.ShowSlow(20, 0)
        elseif JY.Status==GAME_MMAP then
            Game_MMap();
 		elseif JY.Status==GAME_SMAP then
            Game_SMap();
		end
		collectgarbage("step", 0)
        local t2=lib.GetTime();
	    if t2-t1<CC.Frame then
            lib.Delay(CC.Frame-(t2-t1));
	    end
	end
end

function Game_MMap()      --Ö÷µØÍ¼
	if JY.Restart == 1 then
		return
	end

    local direct = -1;
    local keypress, ktype, mx, my = lib.GetKey();
	--ÏÈ¼ì²â¸úÉÏ´Î²»Í¬µÄ·½ÏòÊÇ·ñ±»°´ÏÂ
    for i = VK_RIGHT,VK_UP do
        if i ~= CC.PrevKeypress and lib.GetKeyState(i) ~=0 then
			keypress = i
		end
	end 
    --Èç¹ûÓëÉÏ´Î²»Í¬µÄ·½ÏòÎ´±»°´ÏÂ£¬Ôò¼ì²âÓëÉÏ´ÎÏàÍ¬µÄ·½ÏòÊÇ·ñ±»°´ÏÂ
	if keypress==-1 and	lib.GetKeyState(CC.PrevKeypress) ~=0 then
		keypress = CC.PrevKeypress
	end
    CC.PrevKeypress = keypress
    if keypress==VK_UP then
		direct=0;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_DOWN then
		direct=3;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_LEFT then
		direct=2;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_RIGHT then
		direct=1;
		JY.WalkCount = JY.WalkCount + 1
	else
		JY.WalkCount = 0
	end
    
	if keypress == VK_UP or keypress == VK_DOWN or keypress == VK_LEFT or keypress == VK_RIGHT then
		OEVENTLUA[30050]()
	end
	
	
    if ktype == 1 then
	    JY.Mytick=0;
		if keypress==VK_ESCAPE then
			Cls()
			--ĞÂ²Ëµ¥
			tjm_menu()
			if JY.Status ~= GAME_MMAP  then
				return ;
			end
		elseif keypress == VK_H then		--°´hÖ±½Ó»Ø¼Ò
			My_Enter_SubScene(70, 35, 31, 2);
			return;
		--ÎŞ¾Æ²»»¶£ºÈ«Ì×¿ì½İ¼ü 7-30
		elseif keypress == VK_S then	--´æµµ
			Menu_SaveRecord()
			if JY.Status ~= GAME_MMAP  then
				return ;
			end
		elseif keypress == VK_L then	--¶Áµµ
			Menu_ReadRecord()
			if JY.Status ~= GAME_MMAP  then
				return ;
			end
		elseif keypress == VK_Z then	--×´Ì¬
			Cls()
			local a = Team()
			
			if a ~= nil and a > 0 then
				PersonStatus(a)
			else
				do return end
			end	 
		
		elseif keypress == VK_Q then	--Ò»½£ ¾­ÂöÆæÑ¨
			Cls()
			QUANZHANGQX1()
		elseif keypress == VK_W then	--Ò»½£ ÎäÑ§ÃØ¼®
			Cls()
			MJMenu()		
		elseif keypress == VK_E then	--ÎïÆ·
			Cls()
			Menu_Thing()
		elseif keypress == VK_R then	--Ò»½£ È«²¿ÎïÆ·
			Cls()
			ThingMenu()	
		elseif keypress == VK_F1 then	--Âí³µ	
			Cls()
			My_ChuangSong_Ex()
			if JY.Status ~= GAME_MMAP then
				return;
			end
		elseif keypress == VK_T then	--Ò»½£´ò¿ªÈÎÎñÆÁ·ç¿ì½İ¼ü				
		    CallCEvent(3220)			
		elseif keypress == VK_Y then	--Ò»½£´ò¿ªÈÎÎñ½±Àø¿ì½İ¼ü				
		    CallCEvent(3221)				
		--elseif keypress == VK_F2 then	--Ë«¶ù				
		--    CallCEvent(690)				
		elseif keypress == VK_F2 then	--Ò»½£´ò¿ªË«¶ù¿ì½İ¼ü				
		    CallCEvent(690)				
		elseif keypress == VK_F3 then	--¶ÓÓÑÅÅÎ»
			Cls()
			Menu_TZDY()
		elseif keypress == VK_F4 then	--ÕûÀí
			Cls()		
			Menu_WPZL()
		end
	elseif ktype == 2 or ktype == 3 then
		local tmpx,tmpy = mx, my
		mx = mx - CC.ScreenW / 2
		my = my - CC.ScreenH / 2
		mx = (mx) / CC.XScale
		my = (my) / CC.YScale
		mx, my = (mx + my) / 2, (my - mx) / 2
		if mx > 0 then
			mx = mx + 0.99
		else
			mx = mx - 0.01
		end
		if my > 0 then
			my = my + 0.99
		else
			mx = mx - 0.01
		end
		mx = math.modf(mx)+JY.Base["ÈËX"];
		my = math.modf(my)+ JY.Base["ÈËY"]
				
		--Êó±êÒÆ¶¯
		if ktype == 2 then
			if lib.GetMMap(mx, my, 3) > 0 then				--Èç¹ûÓĞ½¨Öş£¬ÅĞ¶ÏÊÇ·ñ¿É½øÈë
				for i=0, 4 do
		    		for j=0, 4 do
		    			local xx, yy = mx-i, my-j;
				    	local sid=CanEnterScene(xx,xx);
				    	if sid < 0 then
				    		xx, yy = mx+i, my+j;
				    		sid=CanEnterScene(xx,yy);
				    	end
						if sid>=0 then
							CC.MMapAdress[0] = sid;
							CC.MMapAdress[1] = tmpx;
							CC.MMapAdress[2] = tmpy;
							CC.MMapAdress[3] = xx;
							CC.MMapAdress[4] = yy;
		
							i=5;		--ÍË³öÑ­»·
							break;
						end
					end
				end
			else
				CC.MMapAdress[0]= nil;
			end
		--Êó±ê×ó¼ü
		elseif ktype == 3 then
			if tmpx >= 0 and tmpx <= CC.ScreenW/1360*63 and 
			   tmpy >= CC.ScreenH/768*110 and tmpy <= CC.ScreenH/768*160 then
			   tjm_menu()
			   --CMenu()
			else   
				if CC.MMapAdress[0] ~= nil then
					mx = CC.MMapAdress[3] - JY.Base["ÈËX"];
					my = CC.MMapAdress[4] - JY.Base["ÈËY"];
					CC.MMapAdress[0]= nil;
				else
					AutoMoveTab = {[0] = 0}
					mx = mx - JY.Base["ÈËX"]
					my = my - JY.Base["ÈËY"]
				end
				walkto(mx, my)
			end
		end
	elseif ktype == 4 then
		JY.Mytick=0;
		Cls()
		--MMenu();
		tjm_menu()
		--CMenu() 
		if JY.Status ~= GAME_MMAP then
			return ;
		end
	end
    
    if AutoMoveTab[0] ~= 0 then
	    if direct == -1 then
			direct = AutoMoveTab[AutoMoveTab[0]]
			AutoMoveTab[AutoMoveTab[0]] = nil
			AutoMoveTab[0] = AutoMoveTab[0] - 1
	    end
	else
	    AutoMoveTab = {[0] = 0}
	end


    local x,y;              --°´ÕÕ·½Ïò¼üÒªµ½´ïµÄ×ø±ê
	local CanMove = function(nd, nnd)
		local nx, ny = JY.Base["ÈËX"] + CC.DirectX[nd + 1], JY.Base["ÈËY"] + CC.DirectY[nd + 1]
		if nnd ~= nil then
			nx, ny = nx + CC.DirectX[nnd + 1], ny + CC.DirectY[nnd + 1]
		end
		if CC.hx == nil and ((lib.GetMMap(nx, ny, 3) == 0 and lib.GetMMap(nx, ny, 4) == 0) or CanEnterScene(nx, ny) ~= -1) then
			return true
		else
			return false
		end
	end
    if direct ~= -1 then   --°´ÏÂÁË¹â±ê¼ü
        AddMyCurrentPic();         --Ôö¼ÓÖ÷½ÇÌùÍ¼±àºÅ£¬²úÉú×ßÂ·Ğ§¹û
        x=JY.Base["ÈËX"]+CC.DirectX[direct+1];
        y=JY.Base["ÈËY"]+CC.DirectY[direct+1];
        JY.Base["ÈË·½Ïò"]=direct;
		if JY.WalkCount == 1 then
			lib.Delay(90)
		end
    else
        x=JY.Base["ÈËX"];
        y=JY.Base["ÈËY"];

    end

	if direct~=-1 then
		JY.SubScene=CanEnterScene(x,y);   --ÅĞ¶ÏÊÇ·ñ½øÈë×Ó³¡¾°
	end

    if lib.GetMMap(x,y,3)==0 and lib.GetMMap(x,y,4)==0 then     --Ã»ÓĞ½¨Öş£¬¿ÉÒÔµ½´ï
        JY.Base["ÈËX"]=x;
        JY.Base["ÈËY"]=y;
    end
    JY.Base["ÈËX"]=limitX(JY.Base["ÈËX"],10,CC.MWidth-10);           --ÏŞÖÆ×ø±ê²»ÄÜ³¬³ö·¶Î§
    JY.Base["ÈËY"]=limitX(JY.Base["ÈËY"],10,CC.MHeight-10);

    if CC.MMapBoat[lib.GetMMap(JY.Base["ÈËX"],JY.Base["ÈËY"],0)]==1 then
	    JY.Base["³Ë´¬"]=1;
	else
	    JY.Base["³Ë´¬"]=0;
	end

    lib.DrawMMap(JY.Base["ÈËX"],JY.Base["ÈËY"],GetMyPic());             --»æ»­Ö÷µØÍ¼

	--µ±Ç°XY×ø±êÏÔÊ¾
    if CC.ShowXY==1 then
		lib.LoadPNG(91,43*2,CC.ScreenW/1360*136,CC.ScreenH/768*142,2)
	    DrawString(CC.ScreenW/1360*70,CC.ScreenH/768*129,string.format("%s %d %d","",JY.Base["ÈËX"],JY.Base["ÈËY"]) ,C_GOLD,CC.Fontsmall*0.9);
	end
	DrawTimerA();
	--DrawTimer();		--×îÏÂ·½¶¯Ì¬ÌáÊ¾
	JYZTB();			--×óÉÏ½Ç¼òÒ×ĞÅÏ¢
		--JYZTB1();	
	lib.PicLoadCache(92,29*2,CC.ScreenW/1360*40,CC.ScreenH/768*615+70,2,256,nil,CC.ScreenW/1360*60)	
	--ÏÔÊ¾Êó±êÖ¸ÖĞµÄ³¡¾°Ãû³Æ
	if CC.MMapAdress[0] ~= nil then
		DrawStrBox(CC.MMapAdress[1]+10,CC.MMapAdress[2],JY.Scene[CC.MMapAdress[0]]["Ãû³Æ"],C_GOLD,CC.DefaultFont);
	end
		
    ShowScreen();

    if JY.SubScene >= 0 then          --½øÈë×Ó³¡¾°
        CleanMemory();
		--lib.UnloadMMap();
        --lib.PicInit();
        lib.ShowSlow(20,1)

		JY.Status=GAME_SMAP;
        JY.MmapMusic=-1;

        JY.MyPic=GetMyPic();
        JY.Base["ÈËX1"]=JY.Scene[JY.SubScene]["Èë¿ÚX"]
        JY.Base["ÈËY1"]=JY.Scene[JY.SubScene]["Èë¿ÚY"]

        Init_SMap(1);
		return
    end
end

--Ö÷½Ç×ßÂ·
function walkto(xx,yy,x,y,flag)
	local x,y
	AutoMoveTab={[0]=0}
	if JY.Status==GAME_SMAP  then
		x=x or JY.Base["ÈËX1"]
		y=y or JY.Base["ÈËY1"]
	elseif JY.Status==GAME_MMAP then
		x=x or JY.Base["ÈËX"]
		y=y or JY.Base["ÈËY"]
	end
	xx,yy=xx+x,yy+y
	if JY.Status==GAME_SMAP then
		CC.AutoMoveEvent[0] = 0;
		CC.AutoMoveEvent[1] = 0;
		CC.AutoMoveEvent[2] = 0;

		if SceneCanPass(xx, yy) == false then
			if GetS(JY.SubScene, xx, yy, 3) > 0 and GetD(JY.SubScene, GetS(JY.SubScene, xx, yy, 3), 2) > 0 then
				CC.AutoMoveEvent[1] = xx;
				CC.AutoMoveEvent[2] = yy;
				--ÎŞ¾Æ²»»¶£ºÒ»´¦µ°ÌÛµÄÏ¸½ÚĞŞ¸Ä£¬×Ô¶¯´¥·¢ÊÂ¼şµÄÕ¾Î»ÓÅÏÈ¼¶
				if x < xx then
					if SceneCanPass(xx-1,yy) then
						xx = xx-1;
					elseif SceneCanPass(xx,yy+1) then
						yy = yy+1;
					elseif SceneCanPass(xx,yy-1) then
						yy = yy-1;
					elseif SceneCanPass(xx+1,yy) then
						xx = xx+1;
					else
						return;
					end
				else
					if SceneCanPass(xx+1,yy) then
						xx = xx+1;
					elseif SceneCanPass(xx,yy+1) then
						yy = yy+1;
					elseif SceneCanPass(xx,yy-1) then
						yy = yy-1;
					elseif SceneCanPass(xx-1,yy) then
						xx = xx-1;
					else
						return;
					end
				end
			else
				return;
			end
		end

	end
	if xx == nil or yy == nil then
		return
	end	
	if JY.Status==GAME_MMAP and ((lib.GetMMap(xx,yy,3)==0 and lib.GetMMap(xx,yy,4)==0) or CanEnterScene(xx,yy)~=-1)==false then
		return
	end
	local steparray={};
	local stepmax;
	local xy={}
	if JY.Status==GAME_SMAP then
		for i=0,CC.SWidth-1 do
			xy[i]={}
		end
	elseif JY.Status==GAME_MMAP then
		for i=0,479 do
			xy[i]={}
		end
	end
	if flag~=nil then
		stepmax=640
	else
		stepmax=240
	end
	for i=0,stepmax do
	    steparray[i]={};
        steparray[i].x={};
        steparray[i].y={};
	end
	local function canpass(nx,ny)
		if JY.Status==GAME_SMAP and (nx>CC.SWidth-1 or ny>CC.SWidth-1 or nx<0 or ny<0) then
			return false
		end
		if JY.Status==GAME_MMAP and (nx>479 or ny>479 or nx<1 or ny<1) then
			return false
		end
		if xy[nx][ny]==nil then
			if JY.Status==GAME_SMAP then
				if  SceneCanPass(nx,ny) then
					return true
				end
			elseif JY.Status==GAME_MMAP then
				if (lib.GetMMap(nx,ny,3)==0 and lib.GetMMap(nx,ny,4)==0) or CanEnterScene(nx,ny)~=-1 then
					return true
				end
			end
		end
		return false
	end

	local function FindNextStep(step)
		if step==stepmax then
			return
		end
		local step1=step+1
		local num=0
		for i=1,steparray[step].num do

			if steparray[step].x[i]==xx and steparray[step].y[i]==yy then
				return
			end

			if canpass(steparray[step].x[i]+1,steparray[step].y[i]) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]+1
				steparray[step1].y[num]=steparray[step].y[i]
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
			if canpass(steparray[step].x[i]-1,steparray[step].y[i]) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]-1
				steparray[step1].y[num]=steparray[step].y[i]
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
			if canpass(steparray[step].x[i],steparray[step].y[i]+1) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]
				steparray[step1].y[num]=steparray[step].y[i]+1
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
			if canpass(steparray[step].x[i],steparray[step].y[i]-1) then
				num=num+1
				steparray[step1].x[num]=steparray[step].x[i]
				steparray[step1].y[num]=steparray[step].y[i]-1
				xy[steparray[step1].x[num]][steparray[step1].y[num]]=step1
			end
		end
		if num>0 then
			steparray[step1].num=num
			FindNextStep(step1)
		end
	end

	steparray[0].num=1;
	steparray[0].x[1]=x;
	steparray[0].y[1]=y;
	xy[x][y]=0
	FindNextStep(0);
  
  xx = math.floor(xx + 0.5)
  yy = math.floor(yy + 0.5)

  local movenum=xy[xx][yy];

	if movenum==nil then
		return
	end
	AutoMoveTab[0]=movenum
	for i=movenum,1,-1 do
        if xy[xx-1][yy]==i-1 then
            xx=xx-1;
            AutoMoveTab[1+movenum-i]=1;
        elseif xy[xx+1][yy]==i-1 then
            xx=xx+1;
            AutoMoveTab[1+movenum-i]=2;
        elseif xy[xx][yy-1]==i-1 then
            yy=yy-1;
            AutoMoveTab[1+movenum-i]=3;
        elseif xy[xx][yy+1]==i-1 then
            yy=yy+1;
            AutoMoveTab[1+movenum-i]=0;
        end
	end
end

function GetMyPic()      --¼ÆËãÖ÷½Çµ±Ç°ÌùÍ¼
    local n;
	if JY.Status==GAME_MMAP and JY.Base["³Ë´¬"]==1 then
		if JY.MyCurrentPic >=4 then
			JY.MyCurrentPic=0
		end
	else
		if JY.MyCurrentPic >6 then
			JY.MyCurrentPic=1
		end
	end

	if JY.Base["³Ë´¬"]==0 then
		if JY.Person[0]["ĞÔ±ğ"] == 0 then
			n=CC.MyStartPicM+JY.Base["ÈË·½Ïò"]*7+JY.MyCurrentPic;
		else
			n=CC.MyStartPicF+JY.Base["ÈË·½Ïò"]*7+JY.MyCurrentPic;
		end
	else
	    n=CC.BoatStartPic+JY.Base["ÈË·½Ïò"]*4+JY.MyCurrentPic;
	end
	return n;
end

--Ôö¼Óµ±Ç°Ö÷½Ç×ßÂ·¶¯»­Ö¡, Ö÷µØÍ¼ºÍ³¡¾°µØÍ¼¶¼Ê¹ÓÃ
function AddMyCurrentPic()
    JY.MyCurrentPic=JY.MyCurrentPic+1;
end

--³¡¾°ÊÇ·ñ¿É½ø
--id ³¡¾°´úºÅ
--x,y µ±Ç°Ö÷µØÍ¼×ø±ê
--·µ»Ø£º³¡¾°id£¬-1±íÊ¾Ã»ÓĞ³¡¾°¿É½ø
function CanEnterScene(x,y)         --³¡¾°ÊÇ·ñ¿É½ø
    for id = 0,JY.SceneNum-1 do
		local scene=JY.Scene[id];
		if (x==scene["Íâ¾°Èë¿ÚX1"] and y==scene["Íâ¾°Èë¿ÚY1"]) or
		   (x==scene["Íâ¾°Èë¿ÚX2"] and y==scene["Íâ¾°Èë¿ÚY2"]) then
			local e=scene["½øÈëÌõ¼ş"];
			if e==0 then        --¿É½ø
				return id;
			elseif e==1 then    --²»¿É½ø
				return -1
			end
		end
	end
    return -1;
end

--ÏµÍ³×Ó²Ëµ¥
function Menu_System()
	local menu = {
	{"¶ÁÈ¡½ø¶È", Menu_ReadRecord, 1}, 
	{"±£´æ½ø¶È", Menu_SaveRecord, 1}, 
	{"¹Ø±ÕÒôÀÖ", Menu_SetMusic, 1}, 
	{"¹Ø±ÕÒôĞ§", Menu_SetSound, 1}, 
	{"ÎïÆ·ÕûÀí", Menu_WPZL, 1}, 
	--{"ÏµÍ³¹¥ÂÔ", Menu_Help, 1},
	{"Í¨¹Ø¼ÇÂ¼", pastReview, 1},
	{"ÎÒµÄ´úÂë", Menu_MYDIY, 1},
	{"Àë¿ªÓÎÏ·", Menu_Exit2, 1}
	}
	if JY.EnableMusic == 0 then
		menu[3][1] = "´ò¿ªÒôÀÖ"
	end
	if JY.EnableSound == 0 then
		menu[4][1] = "´ò¿ªÒôĞ§"
	end
	local r = ShowMenu(menu, #menu, 0, CC.MainSubMenuX, CC.MainSubMenuY, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
	if r == 0 then
		return 0
	elseif r < 0 then
		return 1
	end
end

function Menu_MYDIY()
	local r = JYMsgBox("ÎÒµÄ´úÂë","Ö´ĞĞ×Ô¶¨Òå´úÂë*Ö¸¶¨ÔÚscript/DIY.luaÎÄ¼ş",{"È·¶¨","È¡Ïû"},2,nil,1);
	--local r = JYMsgBox("ÎÒµÄ´úÂë","Èç´Ë¼òµ¥µÄÓÎÏ·Ñ¹¸ùÓÃ²»µ½´úÂë");
	if r == 1 then
		--TalkEx("½ğÊéÈºÏÀ´«ÈººÅ198045761", 592, 1)  --¶Ô»°
		dofile(CONFIG.ScriptPath.."DIY.lua");
	else
		do return end
	end
end

function Menu_Help()
	--ÔİÊ±È¡Ïû
	
	local title = "ÏµÍ³¹¥ÂÔ";
	local str ="×°±¸ËµÃ÷£º²é¿´¸÷ÖÖ×°±¸µÄËµÃ÷¡£"
						.."*Îä¹¦ËµÃ÷£º²é¿´¸÷ÖÖÎä¹¦µÄËµÃ÷¡£"
						.."*ÌìÊé¹¥ÂÔ£º¸÷ÖÖÌìÊéµÄÄÃ·¨£¬ÒÔ¼°ÓÎÏ·¼¼¹¥ÂÔ¡£"
	local btn = {"×°±¸ËµÃ÷","Îä¹¦ËµÃ÷","ÌìÊé¹¥ÂÔ"};
	local num = #btn;
	local r = JYMsgBox(title,str,btn,num,nil,1);

	if r == 1 then
		ZBInstruce();
	elseif r == 2 then
		WuGongIntruce();
	elseif r == 3 then
		TSInstruce();
	end
	return 1;
end

--ÒôÀÖ¿ª¹Ø
function Menu_SetMusic()
	if JY.EnableMusic == 0 then
		JY.EnableMusic = 1
		PlayMIDI(JY.CurrentMIDI)
	else
		JY.EnableMusic = 0
		lib.PlayMIDI("")
	end
	return 1
end

--ÒôĞ§¿ª¹Ø
function Menu_SetSound()
	if JY.EnableSound == 0 then
		JY.EnableSound = 1
	else
		JY.EnableSound = 0
	end
	return 1
end

function Menu_Thing()
	local menu3 = {nil,0,1,3,4,2}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	
	while true do
		Cls()
		if JY.Restart == 1 then
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu3 do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 7 then
				
				if tb == i then 
					lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			if tb < 6 then
				ThingMenu(menu3[tb])
			else
				MJMenu()
			end
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu3
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu3 then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu3 do 
				if mx >= CC.ScreenW/2-((#menu3-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu3-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				if tb < 6 then
					ThingMenu(menu3[tb])
				else
					MJMenu()
				end
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
			end
		end
	end
end	




function New_Team()
	--local menu3 = {nil,0,1,3,4,2}
	local menu = {'×´Ì¬','ÅÅĞò','Àë¶Ó'}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	
	while true do
		Cls()
		if JY.Restart == 1 then
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 4 then
				
				if tb == i then 
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			-- if tb < 6 then
				-- ThingMenu(menu3[tb])
			-- else
				-- MJMenu()
			-- end
			
			if tb < 4 then
				Team({menu[tb]})
			--	say("²âÊÔ"..menu[tb],0,1)
			end
			
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu do 
				if mx >= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				-- if tb < 6 then
					-- ThingMenu(menu3[tb])
				-- else
					-- MJMenu()
				-- end
				if tb < 4 then
					Team({menu[tb]})
				--	say("²âÊÔ"..menu[tb],0,1)
				end
				
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
			end
		end
	end
end


function New_Team1()
	--local menu3 = {nil,0,1,3,4,2}
	local menu = {'×´Ì¬','ÅÅĞò','Àë¶Ó'}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	pd = 1
	while true do
		Cls()
		if JY.Restart == 1 then
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 4 then
				
				if tb == i then 
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			-- if tb < 6 then
				-- ThingMenu(menu3[tb])
			-- else
				-- MJMenu()
			-- end
			
			if tb < 4 then
				Team({menu[tb]})
			--	say("²âÊÔ"..menu[tb],0,1)
			end
			
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu do 
				if mx >= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				-- if tb < 6 then
					-- ThingMenu(menu3[tb])
				-- else
					-- MJMenu()
				-- end
				if tb < 4 then
					Team({menu[tb]})
				--	say("²âÊÔ"..menu[tb],0,1)
				end
				
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
			end
		end
	end
end


function New_Ssystem()
	--local menu3 = {nil,0,1,3,4,2}
	local menu = {1,2,3,4,5,6,7,8}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local cont2 = 1
	local tb = 1
	local py = 0
    local pd = 0
	
	while true do
		Cls()
		if JY.Restart == 1 then
			Cls()
			break
		end	
		
		-- for cont2 = 1,#menu3 do
		    -- lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(cont2-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
	    -- end
		
		for i = 1,#menu do 
			-- if i < 6 then
				-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,(15+i)*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- else
				-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,256,nil,bx*100)
				-- if tb == i then 
					-- lib.PicLoadCache(92,4*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				-- --	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				-- end
			-- end	
			if i < 9 then
				
				if tb == i then 
					lib.PicLoadCache(92,(29+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
				--	lib.PicLoadCache(92,181*2,CC.ScreenW/2-((#menu3-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,2,150,nil,bx*100)
				else
					lib.PicLoadCache(92,(29+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60,6,150,nil,bx*100)
				end
			end
		end
		
		if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
		
		
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			PlayWavE(77)
			-- if tb < 6 then
				-- ThingMenu(menu3[tb])
			-- else
				-- MJMenu()
			-- end
			local leave = 0
			local ReadRecord = 0
			if tb < 9 then
				--Team({menu[tb]})
			--	say("²âÊÔ"..menu[tb],0,1)
				if tb == 1 then
					ReadRecord = Menu_ReadRecord()
				elseif tb == 2 then
					Menu_SaveRecord()
				elseif tb == 3 then
					Menu_SetMusic()
				elseif tb == 4 then
					Menu_SetSound()
				elseif tb == 5 then
					Menu_WPZL()
				elseif tb == 6 then
					pastReview()
				elseif tb == 7 then
					Menu_MYDIY()
				elseif tb == 8 then
					leave = Menu_Exit2()
				end
			--Menu_ReadRecord,Menu_SaveRecord,Menu_SetMusic,Menu_SetSound,Menu_WPZL,pastReview,Menu_MYDIY,Menu_Exit2
			end
			
			if JY.ThingUse >= 0 then 
				JY.ThingUse = 0
				return 1
			end
			if JY.Status == GAME_WMAP then
				return 1
			end
			if tb == 1 and ReadRecord == 1 then
				return 1
			end	
			if tb == 8 and leave == 1 then
				return 1
			end	
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77) 
			break
			tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
			tb = tb - 1 
			if tb < 1 then 
				tb = #menu
			end
			py = 0
            pd = 0
		elseif X == VK_RIGHT then
			PlayWavE(77) 
			PlayWavE(77)
			tb = tb + 1 
			if tb > #menu then 
				tb = 1
			end
			py = 0
            pd = 0
		else
			local mxx = false
			for i = 1,#menu do 
				if mx >= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 - bx*50 and mx <= CC.ScreenW/2-((#menu-1)*bx*140)/2+(i-1)*bx*140 + bx*50
					and my >= CC.ScreenH/2+bx*10 and my <= CC.ScreenH/2+bx*110 then 
					tb = i 
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then 
				local leave = 0
				local ReadRecord = 0
				-- if tb < 6 then
					-- ThingMenu(menu3[tb])
				-- else
					-- MJMenu()
				-- end
				if tb < 9 then
				--Team({menu[tb]})
			--	say("²âÊÔ"..menu[tb],0,1)
				if tb == 1 then
					ReadRecord = Menu_ReadRecord()
				elseif tb == 2 then
					Menu_SaveRecord()
				elseif tb == 3 then
					Menu_SetMusic()
				elseif tb == 4 then
					Menu_SetSound()
				elseif tb == 5 then
					Menu_WPZL()
				elseif tb == 6 then
					pastReview()
				elseif tb == 7 then
					Menu_MYDIY()
				elseif tb == 8 then
					leave = Menu_Exit2()
				end
			--Menu_ReadRecord,Menu_SaveRecord,Menu_SetMusic,Menu_SetSound,Menu_WPZL,pastReview,Menu_MYDIY,Menu_Exit2
			end
				if JY.ThingUse >= 0 then 
					JY.ThingUse = 0
					return 1
				end
				if JY.Status == GAME_WMAP then
					return 1
				end
				if tb == 1 and ReadRecord == 1 then
					return 1
				end	
				if tb == 8 and leave == 1 then
					return 1
				end
			end
		end
	end
end







function Menu_Thing1()
   local bx = CC.ScreenW/1360
   local by = CC.ScreenH/768
   local size = CC.DefaultFont*0.7
   local size1 = CC.DefaultFont*0.6
   local size2 = CC.DefaultFont*0.55
   local cont = 1 
   local cont1 = 0
   local cxt = 1
   local page = 1
   local lx = {{'ÖØÒª',0},{'×°±¸',1},{'ÃØ¼®',2},{'Ò©Æ·',3},{'°µÆ÷',4}}
   if JY.Status == GAME_WMAP then 
	  table.remove(lx,1)
	  table.remove(lx,2)
   end
   while true do 
      Cls()
	  lib.PicLoadCache(92,130*2,0,0,1,nil,nil,bx*1360)
	  lib.PicLoadCache(92,136*2,bx*250+(cxt-1)*bx*100,by*30,2,256,nil,bx*42)
	  DrawString(bx*50,by*30-size*1.2/2,lx[cxt][1],C_ORANGE,size*1.2)
	  DrawString(bx*780,by*30-size*1.2/2,'ËµÃ÷',C_ORANGE,size*1.2)
	  DrawString(bx*50,by*768-size/2,string.format('%11s',C_GOLD),C_WHITE,size)
      for ii = 1,#lx do
	      lib.PicLoadCache(92,(lx[ii][2]+131)*2,bx*250+(ii-1)*bx*100,by*30,2,256,nil,bx*42)
	  end
	  
      local thing = {}
      local maxn = 14
      for ii = 1,CC.MyThingNum do 
	      local tid = JY.Base['ÎïÆ·'..ii]
		  local tidnum = JY.Base['ÎïÆ·ÊıÁ¿'..ii]
	      if tid >= 0 and tidnum > 0 and JY.Thing[tid]['ÀàĞÍ'] == lx[cxt][2] then 
		     thing[#thing+1] = {JY.Thing[tid]['Ãû³Æ'],tid,tidnum} --,JY.Thing[tid]['¼Û¸ñ']
		  end
	  end
	  
	  if maxn > #thing then 
	     maxn = #thing
	  end 
	  if #thing > 0 then
	     for ii = 1,maxn do
	         local tid = thing[ii+cont1]
			 local cl = C_WHITE
			 if page == 2 then
				if ii == cont then 
				   DrawString(bx*1360-string.len(thing[ii+cont1][1])/4*size-150,by*72-size/2-5,thing[ii+cont1][1],C_WHITE,size)
		          -- lib.PicLoadCache(2,thing[ii+cont1][2]*2,bx*760,by*200,2,256,nil,bx*120)
				   lib.PicLoadCache(2,thing[ii+cont1][2]*2,bx*760,by*200,1)
				   --lib.PicLoadCache(2, thing[id] * 2, boxx + 1, boxy + 1, 1)
				   --cl = C_RED
				   lib.PicLoadCache(92,137*2,bx*480,by*101+(ii-1)*by*40+size/2-20,2,256,nil,bx*600)
				   -- if CC.Thing[thing[ii+cont1][2]] ~= nil then
				      -- tjm(bx*1360,by*345,CC.ThingSm[thing[ii+cont1][2]],C_WHITE,size1,math.floor(bx*400/size1)-1)
				   -- end  
				end
			 end
			 DrawString(bx*48,by*100+(ii-1)*by*40-20,thing[ii+cont1][1],cl,size)
			-- DrawString(bx*588,by*98+(ii-1)*by*40,thing[ii+cont1][4],cl,size)
			 DrawString(bx*580,by*98+(ii-1)*by*40-20,thing[ii+cont1][3],cl,size)
	     end
		 -- local thing = {}
		-- local thingnum = {}
		-- for i = 0, CC.MyThingNum - 1 do
			-- thing[i] = -1
			-- thingnum[i] = 0
		-- end
		-- local num = 0
		-- for i = 0, CC.MyThingNum - 1 do
			-- local id = JY.Base["ÎïÆ·" .. i + 1]
			-- if id >= 0 then
				-- if flag == nil then 
					-- thing[num] = id
					-- thingnum[num] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]
					-- num = num + 1
				-- else 	
					-- if JY.Thing[id]["ÀàĞÍ"] == flag then
						-- thing[num] = id
						-- thingnum[num] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]
						-- num = num + 1
					-- end
				-- end
			-- end 
		-- end
		 
		 
		 
		 
	  end	 
	  
	  if page == 1 then 
	  
	  end
	  
	  ShowScreen()
	  lib.Delay(20)
	  local X,ktype,mx,my = lib.GetKey()
	  if X == VK_SPACE or X == VK_RETURN then 
         if page == 1 then 
		    if #thing > 0 then 
			   page = 2
			end
		 elseif page == 2 then
		    if #thing > 0 then 
		       UseThing(thing[cont+cont1][2])
			   if JY.Status == GAME_WMAP then
			      return 1
			   end
			end
		 end
	  elseif X == VK_ESCAPE or ktype == 4 then
	     if page > 1 then 
		    page = page - 1 
			cont = 1
			cont1 = 0
		 else 	
            break
		 end	
	  elseif X == VK_UP then
	     if page == 1 then 
		 
		 else
            if cont1 > 0 then 
               if cont > 1 then 
                  cont = cont - 1
               else 
                  cont1 = cont1 - 1	  
               end	
            else
               cont = cont - 1		
               if cont < 1 then 
		          cont = maxn
                  cont1 = #thing - cont
               end
            end
		 end	
	  elseif X == VK_DOWN then
	     if page == 1 then 
		 
		 else
            cont = cont + 1		
            if cont > maxn then 
               cont = maxn
               cont1 = cont1 + 1
            end
            if cont1 + cont > #thing then 
               cont1 = 0
               cont = 1
            end
		 end	
	  elseif X == VK_LEFT or ktype == 6 then
	     if page == 1 then 
		    cxt = cxt - 1 
			if cxt < 1 then 
			   cxt = #lx
			end
		 else 
            cont1 = cont1 - maxn
            cont = 1
            if cont1 < 0 then 
               cont1 = 0 
            end
		 end	
	  elseif X == VK_RIGHT or ktype == 7 then
	     if page == 1 then 
		    cxt = cxt + 1 
			if cxt > #lx then 
			   cxt = 1
			end
		 else
            cont1 = cont1 + maxn
            cont = maxn
            if cont1 + cont > #thing then
               cont1 = #thing-cont
            end	
		 end	
	  else 
         local mxx = false
         for ii = 1,maxn do 

		
         end		
         if ktype == 3 and mxx == true then 

         end	
	  end
   end
end	



--ÎïÆ·ÕûÀí
function Menu_WPZL()
	local function swap(a, b) 
		JY.Base["ÎïÆ·" .. a], JY.Base["ÎïÆ·" .. b] = JY.Base["ÎïÆ·" .. b], JY.Base["ÎïÆ·" .. a]
		JY.Base["ÎïÆ·ÊıÁ¿" .. a], JY.Base["ÎïÆ·ÊıÁ¿" .. b] = JY.Base["ÎïÆ·ÊıÁ¿" .. b], JY.Base["ÎïÆ·ÊıÁ¿" .. a]
	end
	
	local flag = 0;
	for i=1, CC.MyThingNum do
        flag = 0;
        for j=1, CC.MyThingNum-i+1 do
             if JY.Base["ÎïÆ·"..j] > -1 and JY.Base["ÎïÆ·" .. j+1] > -1 then				--Èç¹ûÁ½¸öÎïÆ·ÓĞĞ§
				local wg1 = JY.Thing[JY.Base["ÎïÆ·"..j]]["Á·³öÎä¹¦"];
				local wg2 = JY.Thing[JY.Base["ÎïÆ·"..j+1]]["Á·³öÎä¹¦"];                           
				if wg2 < 0 then								--²»¿ÉÁ·³öÎä¹¦µÄ¸ù¾İ±àºÅÅÅĞò
					if wg1 > 0 or  (wg1 < 0 and JY.Base["ÎïÆ·"..j] > JY.Base["ÎïÆ·"..j+1])  then                
						swap(j, j+1);
						flag = 1;
					end   
                elseif wg1 > 0 then							--¿ÉÁ·³öÎä¹¦µÄ¸ù¾İÀàĞÍÅÅĞò£¬Èç¹ûÀàĞÍÏàÍ¬£¬ÔÙ¸ù¾İÎä¹¦10¼¶ÍşÁ¦ÅÅĞò                         
					if JY.Wugong[wg1]["Îä¹¦ÀàĞÍ"] > JY.Wugong[wg2]["Îä¹¦ÀàĞÍ"] or (JY.Wugong[wg1]["Îä¹¦ÀàĞÍ"] == JY.Wugong[wg2]["Îä¹¦ÀàĞÍ"] 
					and JY.Wugong[wg1]["¹¥»÷Á¦10"] > JY.Wugong[wg2]["¹¥»÷Á¦10"]) then
						swap(j, j+1);
						flag = 1;
					end
				end
			end
		end
		if flag == 0 then									--Èç¹ûÒ»ÂÖÏÂÀ´Ã»ÓĞÈÎºÎµÄ½»»»£¬¿Ï¶¨¾ÍÊÇÒÑ¾­ÅÅºÃĞòÁË£¬Ö±½ÓÍË³ö
			break;
		end
	end
	Cls()
	DrawStrBoxWaitKey("ĞĞÄÒÕûÀíÍê±Ï", C_WHITE, CC.DefaultFont)
end

--´óÉÌ¼ÒÂôÎïÆ·²Ëµ¥
function MenuDSJ()
	local menu = {
	{"È«²¿ÎïÆ·", nil, 0}, 
	{"¾çÇéÎïÆ·", nil, 0}, 
	{"Éñ±ø±¦¼×", nil, 1}, 
	{"Îä¹¦ÃØóÅ", nil, 1}, 
	{"Áéµ¤ÃîÒ©", nil, 1}, 
	{"ÉËÈË°µÆ÷", nil, 1}}
	local r = ShowMenu(menu, 6, 0, CC.ScreenW/2-CC.DefaultFont*2-10, CC.ScreenH/2-CC.DefaultFont*3, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
	if r > 0 then
		local thing = {}
		local thingnum = {}
		for i = 0, CC.MyThingNum - 1 do
			thing[i] = -1
			thingnum[i] = 0
		end
		local num = 0
		for i = 0, CC.MyThingNum - 1 do
			local id = JY.Base["ÎïÆ·" .. i + 1]
			if id >= 0 then
				if r == 1 then
					thing[i] = id
					thingnum[i] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]  
				else
					if JY.Thing[id]["ÀàĞÍ"] == r - 2 then
						thing[num] = id
						thingnum[num] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]
						num = num + 1
					end
				end
			end
		end
		--ÎŞ¾Æ²»»¶£ºÃØóÅÏÔÊ¾Çø·Ö
		if r == 4 then
			IsViewingKungfuScrolls = 1
		end
		local r = SelectThing(thing, thingnum)
		if r >= 0 then
			return r
		end
	end
	return -1
end

--Ìú½³Ç¿»¯ÎïÆ·²Ëµ¥
function MenuTJQH()
	local thing = {}
	local thingnum = {}
	for i = 0, CC.MyThingNum - 1 do
		thing[i] = -1
		thingnum[i] = 0
	end
	local num = 0
	for i = 0, CC.MyThingNum - 1 do
		local id = JY.Base["ÎïÆ·" .. i + 1]
		if id >= 0 then
			if JY.Thing[id]["ÀàĞÍ"] == 1 then
				thing[num] = id
				thingnum[num] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]
				num = num + 1
			end	
		end
	end
	local r = SelectThing(thing, thingnum)
	if r >= 0 then
		return r
	end
	return -1
end

--»ØÓªÕû±¸
function Menu_HYZB()
	if JY.SubScene ~= 25 then
		JY.SubScene = 70
		JY.Base["ÈËX1"] = 8
		JY.Base["ÈËY1"] = 28
		JY.Base["ÈËX"] = 358
		JY.Base["ÈËY"] = 235
	end
end

--ÎŞ¾Æ²»»¶£ºĞÂ°æX²Ëµ¥
function Menu_Exit()      --Àë¿ª²Ëµ¥
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	lib.SetClip(0,0,0,0)
	local t = 0
	for i = 0, (CC.ScreenH/2), 3 do
		lib.Background(0,i,CC.ScreenW,i + 3,t)
		t = t + 1
	end
	for i = (CC.ScreenH/2)+1, CC.ScreenH-3, 3 do
		lib.Background(0,i,CC.ScreenW,i + 3,t)
		t = t - 1
	end
	lib.GetKey()
	local menu = {
	{"Àë¿ªÓÎÏ·", nil, 1}, 
	{"·µ»Ø±êÌâ", nil, 1},
	{"¼ÌĞøÓÎÏ·", nil, 2}}
	local r = ShowMenu(menu, 3, 0, CC.ScreenW/2-105, CC.ScreenH/2-89, 0, 0, 0, 0, 50, C_GOLD, C_WHITE)
	if r == 1 then
        JY.Status =GAME_END;
		lib.FreeSur(surid)
        return 1;
	elseif r == 2 then
		JY.Restart = 1
        JY.Status =GAME_START;
		lib.FreeSur(surid)
        return 0;
	end
	lib.LoadSur(surid, 0, 0)
	ShowScreen();
	lib.FreeSur(surid)
    return 0;
end

--Àë¿ª²Ëµ¥
function Menu_Exit2()
    Cls();
    if DrawStrBoxYesNo(-1,-1,"ÊÇ·ñÕæµÄÒªÀë¿ªÓÎÏ·(Y/N)?",C_WHITE,CC.DefaultFont) == true then
        Cls();
		JY.Status = GAME_END;
		return 1;
    end
end

--±£´æ½ø¶È
function Menu_SaveRecord()
	Cls();
	lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
	DrawStrBox(-1,CC.ScreenH*1/6-20,"±£´æ½ø¶È",LimeGreen,CC.Fontbig,C_GOLD);
	--DrawStrBox(104,CC.ScreenH*1/6+26,string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"),C_ORANGE,CC.DefaultFont,C_GOLD);
	--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"), C_ORANGE, CC.DefaultFont)
	local r = SaveList();
    if r>0 then
        DrawStrBox(CC.MainSubMenuX2,CC.MainSubMenuY,"ÇëÉÔºò......",C_WHITE,CC.DefaultFont);
        ShowScreen();
        SaveRecord(r);
        Cls();
	end
    return 0;
end

--¶ÁÈ¡½ø¶È
function Menu_ReadRecord()
	Cls();
	lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
	DrawStrBox(-1,CC.ScreenH*1/6-20,"¶ÁÈ¡½ø¶È",LimeGreen,CC.Fontbig,C_GOLD);
	--DrawStrBox(104,CC.ScreenH*1/6+26,string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"),C_ORANGE,CC.DefaultFont,C_GOLD);
	-- DrawString(500,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"), C_ORANGE, CC.DefaultFont)
	local r = SaveList();
	if r < 1 then
		return 0;
	end
    	
	Cls();
	DrawStrBox(-1,CC.StartMenuY,"ÇëÉÔºò...",C_GOLD,CC.DefaultFont);
	ShowScreen();
	local result = LoadRecord(r);
	--if result ~= nil then
		--return 0;
	--end
	--×Ó³¡¾°
	if JY.Base["ÎŞÓÃ"] ~= -1 then
		if JY.SubScene < 0 then
			CleanMemory()
			--lib.UnloadMMap()
		end
		--lib.PicInit()
		lib.ShowSlow(20, 1)
		JY.Status = GAME_SMAP
		JY.SubScene = JY.Base["ÎŞÓÃ"]
		JY.MmapMusic = -1
		JY.MyPic = GetMyPic()
		Init_SMap(1)
	--´óµØÍ¼
	else
		JY.SubScene = -1
		JY.Status = GAME_FIRSTMMAP
	end
    return 1;
end

--×´Ì¬×Ó²Ëµ¥


--Àë¶Ó²Ëµ¥
function Menu_PersonExit()
	DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, "ÒªÇóË­Àë¶Ó", C_WHITE, CC.DefaultFont)
	local nexty = CC.MainSubMenuY + CC.SingleLineHeight
	local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
	if r == 1 then
		DrawStrBoxWaitKey("±§Ç¸£¡Ã»ÓĞÄãÓÎÏ·½øĞĞ²»ÏÂÈ¥", C_GOLD, CC.DefaultFont, nil, LimeGreen)
	else
		if JY.SubScene == 82 then
			do return end
		end
	end
	if r > 0 and JY.SubScene == 55 and JY.Base["¶ÓÎé" .. r] == 35 then
		do return end
	end
	if r > 1 then
		local personid = JY.Base["¶ÓÎé" .. r]
		if CC.PersonExit[personid] ~= nil then 
			local v = CC.PersonExit[personid]
			CallCEvent(v)
		end
		if JY.Base["³©Ïë"]==514 then	--615ĞŞ¸Ä
			instruct_21(personid)
			TalkEx(""..JY.Person[personid]["ĞÕÃû"].."£¬ÄãÏÈ»ØÑ©Óğ×Ú¡£ÓĞĞè*ÒªÊ±£¬ÎÒÔÙÈ¥ÕÒÄã°ïÃ¦¡£", 0, 2)  --¶Ô»°
		end
	end
	Cls()
	return 0
end

--¶ÓÎéÑ¡ÔñÈËÎï²Ëµ¥
function SelectTeamMenu(x,y)
	local menu={};
	for i=1,CC.TeamNum do
        menu[i]={"",nil,0};
		local id=JY.Base["¶ÓÎé" .. i]
		if id>=0 then
            if JY.Person[id]["ÉúÃü"]>0 then
                menu[i][1]=JY.Person[id]["ĞÕÃû"];
                menu[i][3]=1;
            end
		end
	end
    return ShowMenu(menu,CC.TeamNum,0,x,y,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
end

--¼ÆËãµ±Ç°¶ÓÓÑ¸öÊı
function GetTeamNum()
    local r=CC.TeamNum;
	for i=1,CC.TeamNum do
	    if JY.Base["¶ÓÎé" .. i]<0 then
		    r=i-1;
		    break;
		end
    end
	return r;
end

---ÏÔÊ¾¶ÓÎé×´Ì¬
-- ×óÓÒ¼ü·­Ò³£¬ÉÏÏÂ¼ü»»¶ÓÓÑ
function ShowPersonStatusA()
	local r = New_Team()
	--local r = Team()
	if r == 1 then
       PersonStatus(r)
	end

end

--¼ÆËãÈËÎïĞŞÁ¶³É¹¦ĞèÒªµÄµãÊı
--id ÈËÎïid
function TrainNeedExp(id)         --¼ÆËãÈËÎïĞŞÁ¶ÎïÆ·³É¹¦ĞèÒªµÄµãÊı
    local thingid=JY.Person[id]["ĞŞÁ¶ÎïÆ·"];
	local r =0;
	if thingid >= 0 then
        if JY.Thing[thingid]["Á·³öÎä¹¦"] >=0 then
            local level=0;          --´Ë´¦µÄlevelÊÇÊµ¼Êlevel-1¡£ÕâÑùÃ»ÓĞÎä¹¦rºÍÁ¶³ÉÒ»¼¶ÊÇÒ»ÑùµÄ¡£
			for i =1,JY.Base["Îä¹¦ÊıÁ¿"] do               -- ²éÕÒµ±Ç°ÒÑ¾­Á¶³ÉÎä¹¦µÈ¼¶
			    if JY.Person[id]["Îä¹¦" .. i]==JY.Thing[thingid]["Á·³öÎä¹¦"] then
                    level=math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. i] /100);
					break;
                end
            end
			if level <9 then
                r=math.modf((5-math.modf(JY.Person[id]["×ÊÖÊ"]/25))*JY.Thing[thingid]["Ğè¾­Ñé"]*(level+1)*0.5);
			else
                r=math.huge;
			end
		else
            r=(5-math.modf(JY.Person[id]["×ÊÖÊ"]/25))*JY.Thing[thingid]["Ğè¾­Ñé"];
		end
	end
    return r;
end

--Ò½ÁÆ²Ëµ¥
function Menu_Doctor()       --Ò½ÁÆ²Ëµ¥
	Cls()
    DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"Ë­ÒªÊ¹ÓÃÒ½Êõ",C_WHITE,CC.DefaultFont);
	local nexty=CC.MainSubMenuY+CC.SingleLineHeight;
    DrawStrBox(CC.MainSubMenuX,nexty,"Ò½ÁÆÄÜÁ¦",C_ORANGE,CC.DefaultFont);

	local menu1={};
	for i=1,CC.TeamNum do
        menu1[i]={"",nil,0};
		local id=JY.Base["¶ÓÎé" .. i]
        if id >=0 then
            if JY.Person[id]["Ò½ÁÆÄÜÁ¦"]>=20 then
                 menu1[i][1]=string.format("%-10s%4d",JY.Person[id]["ĞÕÃû"],JY.Person[id]["Ò½ÁÆÄÜÁ¦"]);
                 menu1[i][3]=1;
            end
        end
	end

    local id1,id2;
	nexty=nexty+CC.SingleLineHeight;
    local r=ShowMenu(menu1,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);

    if r >0 then
	    id1=JY.Base["¶ÓÎé" .. r];
        Cls(CC.MainSubMenuX,CC.MainSubMenuY,CC.ScreenW,CC.ScreenH);
        DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"ÒªÒ½ÖÎË­",C_WHITE,CC.DefaultFont);
        nexty=CC.MainSubMenuY+CC.SingleLineHeight;

		local menu2={};
		for i=1,CC.TeamNum do
			menu2[i]={"",nil,0};
			local id=JY.Base["¶ÓÎé" .. i]
			if id>=0 then
				 menu2[i][1]=string.format("%-10s%4d/%4d",JY.Person[id]["ĞÕÃû"],JY.Person[id]["ÉúÃü"],JY.Person[id]["ÉúÃü×î´óÖµ"]);
				 menu2[i][3]=1;
			end
		end

		local r2=ShowMenu(menu2,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE,C_WHITE);

		if r2 >0 then
	        id2=JY.Base["¶ÓÎé" .. r2];
            local num=ExecDoctor(id1,id2);
			if num>0 then
                AddPersonAttrib(id1,"ÌåÁ¦",-2);
			end
            DrawStrBoxWaitKey(string.format("%s ÉúÃüÔö¼Ó %d",JY.Person[id2]["ĞÕÃû"],num),C_ORANGE,CC.DefaultFont);
		end
	end

	Cls();
    return 0;
end

--½â¶¾
function Menu_DecPoison()         --½â¶¾
    DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"Ë­Òª°ïÈË½â¶¾",C_WHITE,CC.DefaultFont);
	local nexty=CC.MainSubMenuY+CC.SingleLineHeight;
    DrawStrBox(CC.MainSubMenuX,nexty,"¶¾ÊõÔìÒè",C_ORANGE,CC.DefaultFont);

	local menu1={};
	for i=1,CC.TeamNum do
        menu1[i]={"",nil,0};
		local id=JY.Base["¶ÓÎé" .. i]
        if id>=0 then
            if JY.Person[id]["ÓÃ¶¾ÄÜÁ¦"]>=20 then
                 menu1[i][1]=string.format("%-10s%4d",JY.Person[id]["ĞÕÃû"],JY.Person[id]["ÓÃ¶¾ÄÜÁ¦"]);
                 menu1[i][3]=1;
            end
        end
	end

    local id1,id2;
 	nexty=nexty+CC.SingleLineHeight;
    local r=ShowMenu(menu1,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);

    if r >0 then
	    id1=JY.Base["¶ÓÎé" .. r];
         Cls(CC.MainSubMenuX,CC.MainSubMenuY,CC.ScreenW,CC.ScreenH);
        DrawStrBox(CC.MainSubMenuX,CC.MainSubMenuY,"ÌæË­½â¶¾",C_WHITE,CC.DefaultFont);
		nexty=CC.MainSubMenuY+CC.SingleLineHeight;

        DrawStrBox(CC.MainSubMenuX,nexty,"ÖĞ¶¾³Ì¶È",C_WHITE,CC.DefaultFont);
	    nexty=nexty+CC.SingleLineHeight;

		local menu2={};
		for i=1,CC.TeamNum do
			menu2[i]={"",nil,0};
			local id=JY.Base["¶ÓÎé" .. i]
			if id>=0 then
				 menu2[i][1]=string.format("%-10s%5d",JY.Person[id]["ĞÕÃû"],JY.Person[id]["ÖĞ¶¾³Ì¶È"]);
				 menu2[i][3]=1;
			end
		end

		local r2=ShowMenu(menu2,CC.TeamNum,0,CC.MainSubMenuX,nexty,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
		if r2 >0 then
	        id2=JY.Base["¶ÓÎé" .. r2];
            local num=ExecDecPoison(id1,id2);
            DrawStrBoxWaitKey(string.format("%s ÖĞ¶¾³Ì¶È¼õÉÙ %d",JY.Person[id2]["ĞÕÃû"],num),C_ORANGE,CC.DefaultFont);
		end
	end
    Cls();
    ShowScreen();
    return 0;
end

--½â¶¾
--id1 ½â¶¾id2, ·µ»Øid2ÖĞ¶¾¼õÉÙµãÊı
function ExecDecPoison(id1,id2)     --Ö´ĞĞ½â¶¾
    local add=JY.Person[id1]["ÓÃ¶¾ÄÜÁ¦"];
    local value=JY.Person[id2]["ÖĞ¶¾³Ì¶È"];

    if value > add+20 then
        return 0;
	end

 	add=limitX(math.modf(add/3)+Rnd(10)-Rnd(10),0,value);
    return -AddPersonAttrib(id2,"ÖĞ¶¾³Ì¶È",-add);
end


--ÏÔÊ¾ÎïÆ·²Ëµ¥
function SelectThing(thing,thingnum)    

	local xnum=CC.MenuThingXnum;
	local ynum=CC.MenuThingYnum;

	local w=CC.ThingPicWidth*xnum+(xnum-1)*CC.ThingGapIn+2*CC.ThingGapOut;  --×ÜÌå¿í¶È
	local h=CC.ThingPicHeight*ynum+(ynum-1)*CC.ThingGapIn+2*CC.ThingGapOut; --ÎïÆ·À¸¸ß¶È

	local dx=(CC.ScreenW-w)/2;
	local dy=(CC.ScreenH-h-2*(CC.ThingFontSize+2*CC.MenuBorderPixel+8))/2-CC.ThingFontSize-11;

	local y1_1,y1_2,y2_1,y2_2,y3_1,y3_2;                  --Ãû³Æ£¬ËµÃ÷ºÍÍ¼Æ¬µÄY×ø±ê

	local cur_line=0;
	local cur_x=0;
	local cur_y=0;
	local cur_thing=-1;
	
	--ÎŞ¾Æ²»»¶£º¼ÇÂ¼×î³õµÄÎïÆ·
	local original_thing = {}
	local original_thingnum = {}
	if IsViewingKungfuScrolls == 1 then
		original_thing = thing
		original_thingnum = thingnum
	end
	
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		y1_1=dy;
		y1_2=y1_1+CC.ThingFontSize+2*CC.MenuBorderPixel;
		y2_1=y1_2+5
		y2_2=y2_1+CC.ThingFontSize+2*CC.MenuBorderPixel
		y3_1=y2_2+5;
		y3_2=y3_1+h;
		lib.LoadPNG(91, 9 * 2 , 0 , 0, 1)
		for y=0,ynum-1 do
			for x=0,xnum-1 do
				local id=y*xnum+x+xnum*cur_line
				local boxcolor;
				--Ñ¡ÖĞÎïÆ·ÑÕÉ«
				if x==cur_x and y==cur_y then
					boxcolor=S_Yellow;
					if thing[id]>=0 then
						cur_thing=thing[id];
						local str=JY.Thing[thing[id]]["Ãû³Æ"];
						--×°±¸µÈ¼¶ÏÔÊ¾
						if JY.Thing[thing[id]]["×°±¸ÀàĞÍ"] > -1 then
							str = str .." LV."..JY.Thing[thing[id]]["×°±¸µÈ¼¶"]
						end
						if JY.Thing[thing[id]]["ÀàĞÍ"]==1 or JY.Thing[thing[id]]["ÀàĞÍ"]==2 then
							if JY.Thing[thing[id]]["Ê¹ÓÃÈË"] >=0 then
								str=str .. "(" .. JY.Person[JY.Thing[thing[id]]["Ê¹ÓÃÈË"]]["ĞÕÃû"] .. ")";
							end
						end
						if thing[id] == 174 then 
							str=string.format("%s X %d",str,CC.Gold);
						else
						    str=string.format("%s X %d",str,thingnum[id]);
						end
						local str2=JY.Thing[thing[id]]["ÎïÆ·ËµÃ÷"];
						if thing[id]==182 then
							str2=str2..string.format('(ÈË%3d,%3d)',JY.Base['ÈËX'],JY.Base['ÈËY'])
						end
						DrawString(dx+CC.ThingGapOut+20,y1_1+CC.MenuBorderPixel+10,str,C_GOLD,CC.ThingFontSize);
						DrawString(dx+CC.ThingGapOut+20,y2_1+CC.MenuBorderPixel+10,str2,C_ORANGE,CC.ThingFontSize*0.9);
						local myfont=CC.FontSmall
						local mx, my = dx + 4 * myfont, y3_2 + 2
						local myflag=0
						local myThing=JY.Thing[thing[id]]
								
						--ÎïÆ·ËµÃ÷ÏÔÊ¾
						local function drawitem(ss,str,news)
							local color = C_GOLD
							local mys
							if str==nil then
								mys=ss
							elseif str == 'ÌåÖÊ' then
								mys = string.format(str..':%d',ss)
							elseif  myThing[ss]~=0  then
								if news==nil then
									if myflag==0 then
										--ÎŞ¾Æ²»»¶£º×°±¸µÄÊıÖµËæµÈ¼¶±ä»¯
										if myThing["×°±¸ÀàĞÍ"] > -1 then
											local attr_gain = 0;
											if myThing[ss] > 0 then
												attr_gain = myThing[ss]*10 + myThing[ss]*(myThing["×°±¸µÈ¼¶"]-1)*2
											elseif myThing[ss] < 0 then
												attr_gain = myThing[ss]*10 - myThing[ss]*(myThing["×°±¸µÈ¼¶"]-1)*2
											end
											if attr_gain ~= 0 then
												mys=string.format(str..':%+d',attr_gain)
											end
										else
											mys=string.format(str..':%+d',myThing[ss])
										end
									elseif myflag==1 then	
											mys=string.format(str..':%d',myThing[ss])
									end
								else
									if myThing[ss]<0 then
										return
									end
									mys=string.format(str..':%s',news[myThing[ss]])
								end
								--ÄÚÊôÑÕÉ«
								if myThing[ss]==1 and ss=="ĞèÄÚÁ¦ĞÔÖÊ" then
									color = RGB(236, 200, 40)
								elseif myThing[ss]==2 and ss=="ĞèÄÚÁ¦ĞÔÖÊ" then
									color = RGB(236, 236, 236)
								end
							elseif myThing[ss]==0 and ss=="ĞèÄÚÁ¦ĞÔÖÊ" then
								mys=string.format(str..':%s',news[myThing[ss]])
								color = RGB(208, 152, 208)
							else
								return
							end
							
							if mys ~= nil then
								local mylen = myfont * string.len(mys) / 2 + 12
								if CC.ScreenW - dx < mx + mylen then
									my = my + myfont + 10
									mx = dx + 4 * myfont
								end
								DrawString(mx+CC.MenuBorderPixel,my+CC.MenuBorderPixel,mys,color,myfont)
								mx=mx+mylen
							end
						end
					  
						--²ÔÌìÌ©Ì¹£ºÍ¬ÑùÊÇÀÏ¶ş
						if myThing["Á·³öÎä¹¦"] > 0 then
							local kfname = "Ï°µÃ:" .. JY.Wugong[myThing["Á·³öÎä¹¦"]]["Ãû³Æ"]
							DrawString(mx+CC.MenuBorderPixel, my+CC.MenuBorderPixel, kfname, C_GOLD, myfont)
							mx = mx + myfont * string.len(kfname) / 2 + 12
						end
								
						if myThing['ÀàĞÍ'] > 0 then
							drawitem('¼ÓÉúÃü','ÉúÃü')
							drawitem('¼ÓÉúÃü×î´óÖµ','ÉúÃü×î´óÖµ')
							drawitem('¼ÓÖĞ¶¾½â¶¾','ÖĞ¶¾')
							drawitem('¼ÓÌåÁ¦','ÌåÁ¦')
							if myThing['¸Ä±äÄÚÁ¦ĞÔÖÊ']==2 then
								drawitem('ÄÚÁ¦ÊôĞÔ±äÎªµ÷ºÍ')
							elseif myThing['¸Ä±äÄÚÁ¦ĞÔÖÊ']==3 then
								drawitem('ÄÚÁ¦ÃÅÂ·×ªÎªÒõĞÔ')
							elseif myThing['¸Ä±äÄÚÁ¦ĞÔÖÊ']==4 then
								drawitem('ÄÚÁ¦ÃÅÂ·×ªÎªÑôĞÔ')	
							end
							drawitem('¼ÓÄÚÁ¦','ÄÚÁ¦')
							drawitem('¼ÓÄÚÁ¦×î´óÖµ','ÄÚÁ¦×î´óÖµ')
							drawitem('¼Ó¹¥»÷Á¦','¹¥»÷')
							drawitem('¼ÓÇá¹¦','Çá¹¦')
							drawitem('¼Ó·ÀÓùÁ¦','·ÀÓù')
							drawitem('¼ÓÒ½ÁÆÄÜÁ¦','Ò½ÁÆ')
							drawitem('¼ÓÓÃ¶¾ÄÜÁ¦','¶¾Êõ')
							--drawitem('¼Ó½â¶¾ÄÜÁ¦','½â¶¾')
							drawitem('¼Ó¿¹¶¾ÄÜÁ¦','¿¹¶¾')
							drawitem('¼ÓÈ­ÕÆ¹¦·ò','È­ÕÆ')
							drawitem('¼ÓÖ¸·¨¼¼ÇÉ','Ö¸·¨')
							drawitem('¼ÓÓù½£ÄÜÁ¦','Óù½£')
							drawitem('¼ÓË£µ¶¼¼ÇÉ','Ë£µ¶')
							drawitem('¼ÓÌØÊâ±øÆ÷','ÌØÊâ')
							drawitem('¼Ó°µÆ÷¼¼ÇÉ','°µÆ÷')
							drawitem('¼ÓÎäÑ§³£Ê¶','Îä³£')
							drawitem('¼ÓÆ·µÂ','Æ·µÂ')
							drawitem('¼Ó¹¥»÷´ÎÊı','×óÓÒ',{[0]='·ñ','ÊÇ'})
							drawitem('¼Ó¹¥»÷´ø¶¾','´ø¶¾')
							if myThing['Î´Öª7']==1 then
                                drawitem('Ôö¼ÓÈËÎïÌåÖÊ')
							end
                            if thing[id] == 372 then 
                                drawitem('ÁìÎòÖĞÓ¹Ö®µÀ')
                            end
							if thing[id] == 450 then
								drawitem('Ñ§»á°µÆ÷ÌØ¼¼£ºÅùö¨À×»ğ')
							end
							if thing[id] == 458 then
								drawitem('Ñ§»á°µÆ÷ÌØ¼¼£º±ùÆÇº®ĞÄ')
							end		
							if thing[id] == 459 then
								drawitem('Ñ§»á°µÆ÷ÌØ¼¼£ºÉúËÀ·û')
							end		
							if thing[id] == 460 then
								drawitem('Ñ§»á°µÆ÷ÌØ¼¼£ºÍ¸¹ÇÕë')
							end
							if thing[id] == 469 then
								drawitem('Ñ§»á°µÆ÷ÌØ¼¼£ººÚÑªÉñÕë')
							end
							--ÎäÆ÷×°±¸ÍşÁ¦¼Ó³É
							for i,v in ipairs(CC.ExtraOffense) do
								if v[1] == thing[id] then
									DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,"ÍşÁ¦Ç¿»¯:"..JY.Wugong[v[2]]["Ãû³Æ"].."+"..v[3],PinkRed,myfont)
								end
							end
							
							if mx~=dx or my~=y3_2+2 then
								if thing[id] > 348 or thing[id] < 343 then	--ÌØÊâÒ©Æ·²»ÏÔÊ¾
									DrawString(dx+CC.MenuBorderPixel+20, y3_2 + 2+CC.MenuBorderPixel, " Ğ§¹û:", LimeGreen, myfont)
								end						
							end
						end
						
						--×°±¸ÀàºÍÃØ¼®Àà
						if myThing['ÀàĞÍ']==1 or myThing['ÀàĞÍ']==2 then
							if mx~=dx then
								mx=dx+4*myfont
								my=my+myfont+3
							end
							myflag=1
							local my2=my
							if myThing['½öĞŞÁ¶ÈËÎï']>-1 then
								drawitem('½öÏŞ:'..JY.Person[myThing['½öĞŞÁ¶ÈËÎï']]['ĞÕÃû'])
							end
							drawitem('ĞèÄÚÁ¦ĞÔÖÊ','ÄÚÊô',{[0]='Òõ','Ñô','²»ÏŞ'})
							drawitem('ĞèÄÚÁ¦','ÄÚÁ¦')
							drawitem('Ğè¹¥»÷Á¦','¹¥»÷')
							drawitem('ĞèÇá¹¦','Çá¹¦')
							drawitem('ĞèÓÃ¶¾ÄÜÁ¦','¶¾Êõ')
							drawitem('ĞèÒ½ÁÆÄÜÁ¦','Ò½ÁÆ')
							--drawitem('Ğè½â¶¾ÄÜÁ¦','½â¶¾')
							drawitem('ĞèÈ­ÕÆ¹¦·ò','È­ÕÆ')
							drawitem('ĞèÖ¸·¨¼¼ÇÉ','Ö¸·¨')
							drawitem('ĞèÓù½£ÄÜÁ¦','Óù½£')
							drawitem('ĞèË£µ¶¼¼ÇÉ','Ë£µ¶')
							drawitem('ĞèÌØÊâ±øÆ÷','ÌØÊâ')
							drawitem('Ğè°µÆ÷¼¼ÇÉ','°µÆ÷')
                            if thing[id] == 372 then 
                                drawitem('Ğè80>×ÊÖÊ>30')
                            end
							 if thing[id] == 327 then 
                                drawitem('Ğè80>×ÊÖÊ>30')
                            end
							--¶·×ªµÄÏÔÊ¾
							if thing[id] == 118 then
								local exstr = "ÎåÏµ±øÆ÷ÖµÖ®ºÍ>=120 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end
							--ÒõÑôµÄÏÔÊ¾
							if thing[id] == 176 then
								local exstr = "Óù½£/Ë£µ¶/ÌØÊâÈÎÒ»Ïî>=70 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end
							--½ğË¿ÊÖÌ×µÄÏÔÊ¾
							if thing[id] == 239 then
								local exstr = "È­ÕÆ»òÖ¸·¨>=70 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end
							--Æß±¦Ö¸»·µÄÏÔÊ¾
							if thing[id] == 200 then
								local exstr = "È­ÕÆ»òÖ¸·¨>=200 "
								local mylen = myfont * string.len(exstr) / 2 + 12
								DrawString(mx+CC.MenuBorderPixel+20,my+CC.MenuBorderPixel,exstr,C_GOLD,myfont)
								mx=mx+mylen
							end							
							drawitem('Ğè×ÊÖÊ','×ÊÖÊ')
							drawitem('Ğè¾­Ñé','ĞŞÁ¶¾­Ñé')
							if thing[id] == 81 then
								drawitem(10,'ÌåÖÊ')
							end	
							if mx~=dx or my~=my2 then
								DrawString(dx+CC.MenuBorderPixel+20,my2+CC.MenuBorderPixel,' ĞèÇó:',LimeGreen,myfont)
							end
						end
						--ÌØĞ§ËµÃ÷
						if WPTX2[thing[id]] ~= nil then
							if mx~=dx then
								mx=dx+4*myfont
								my=my+myfont+3
							end
							local my2=my
							if mx~=dx or my~=my2 then
								DrawString(dx+CC.MenuBorderPixel+20,my2+CC.MenuBorderPixel,' Ğ§¹û:',C_RED,myfont)
							end

							DrawString(dx+CC.MenuBorderPixel+myfont*3+20,my2+CC.MenuBorderPixel,WPTX2[thing[id]], M_DeepSkyBlue,myfont)
						end
						--ÌØĞ§ËµÃ÷
						if myThing['ÊÇ·ñÌØĞ§'] == 1 and (WPTX[thing[id]][myThing['×°±¸µÈ¼¶']] ~= nil or myThing['×°±¸ÀàĞÍ'] == -1) then
							if mx~=dx then
								mx=dx+4*myfont
								my=my+myfont+3
							end
							local my2=my
							if mx~=dx or my~=my2 then
								DrawString(dx+CC.MenuBorderPixel+20,my2+CC.MenuBorderPixel,' ÌØĞ§:',C_RED,myfont)
							end
							if myThing['×°±¸ÀàĞÍ'] > -1 then
								local TXstr = WPTX[thing[id]][myThing['×°±¸µÈ¼¶']]
								--¸´»î½äÖ¸µÄÄÍ¾Ã¶È
								if thing[id] == 303 then
									TXstr = TXstr.."£¨Ê£Óà"..JY.Person[651]["Æ·µÂ"].."´Î£©"
								end
								DrawString(dx+CC.MenuBorderPixel+myfont*3+20,my2+CC.MenuBorderPixel, TXstr, M_DeepSkyBlue,myfont)
							else
								DrawString(dx+CC.MenuBorderPixel+myfont*3+20,my2+CC.MenuBorderPixel, WPTX[thing[id]], M_DeepSkyBlue,myfont)
							end
						end
					else
						cur_thing=-1;
					end
				else
					boxcolor=C_BLACK;
				end
		  
				local boxx = dx + CC.ThingGapOut + x * (CC.ThingPicWidth + CC.ThingGapIn)
				local boxy = y3_1 + CC.ThingGapOut + y * (CC.ThingPicHeight + CC.ThingGapIn)

				if thing[id] >= 0 then
					lib.PicLoadCache(2, thing[id] * 2, boxx + 1, boxy + 1, 1)
				end
				--ÎŞ¾Æ²»»¶£ºĞŞ¸ÄÑ¡Ôñ¿ò
				if boxcolor == S_Yellow then
					DrawSingleLine(boxx+2, boxy+1, boxx + CC.ThingPicWidth/4, boxy+1, boxcolor)
					DrawSingleLine(boxx+2+ CC.ThingPicWidth*3/4, boxy+1, boxx + CC.ThingPicWidth, boxy+1, boxcolor)
					DrawSingleLine(boxx+2, boxy+1, boxx+2, boxy + CC.ThingPicHeight/4 - 1, boxcolor)
					DrawSingleLine(boxx + CC.ThingPicWidth-1, boxy+2, boxx + CC.ThingPicWidth-1, boxy + CC.ThingPicHeight/4 - 1, boxcolor)
					DrawSingleLine(boxx+2, boxy+2+CC.ThingPicHeight*3/4, boxx+2, boxy + CC.ThingPicHeight - 1, boxcolor)
					DrawSingleLine(boxx + CC.ThingPicWidth-1, boxy+2+CC.ThingPicHeight*3/4, boxx + CC.ThingPicWidth-1, boxy + CC.ThingPicHeight - 1, boxcolor)
					DrawSingleLine(boxx+1, boxy + CC.ThingPicHeight - 1, boxx + CC.ThingPicWidth/4, boxy + CC.ThingPicHeight - 1, boxcolor)
					DrawSingleLine(boxx+2+ CC.ThingPicWidth*3/4, boxy + CC.ThingPicHeight - 1, boxx + CC.ThingPicWidth-1, boxy + CC.ThingPicHeight - 1, boxcolor)
				end
			end
		end
		
		DrawString(CC.ScreenW-240,CC.ScreenH-CC.Fontsmall-8	, "°´F1²é¿´ÏêÏ¸ËµÃ÷", C_CYGOLD,CC.Fontsmall)
		DrawString(CC.ScreenW-220, CC.ScreenH-CC.Fontsmall*2-8, "ÒøÁ½:", C_GOLD, CC.Fontsmall)
	    DrawString(CC.ScreenW-220+CC.FontSmall*3, CC.ScreenH-CC.Fontsmall*2-8, CC.Gold, C_CYGOLD, CC.Fontsmall)
		if IsViewingKungfuScrolls > 0 then
			local list = {"1:È«²¿","2:È­·¨","3:Ö¸·¨","4:½£·¨","5:µ¶·¨","6:ÆæÃÅ","7:ÄÚÇá","8:ÔÓÑ§"}
			local space = 0
			local h = 0
			for i = 1, 8 do
				local color = C_GOLD
				if i == IsViewingKungfuScrolls then
					color = C_RED
				end
				if i == 5 then
					space = 0
					h = 35
				end
				space = space + 81
				DrawString(CC.ScreenW-405 + space-20 ,50+h, list[i], color,CC.Fontsmall)
			end
		end

		ShowScreen();
  	
		local keypress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame);
		if keypress==VK_ESCAPE or ktype == 4 then
			cur_thing=-1;
			break;
		elseif keypress==VK_RETURN or keypress==VK_SPACE then
			break;
		--Ôö¼ÓÎïÆ·µÄÄÚÖÃËµÃ÷
		elseif keypress==VK_F1 and cur_thing ~= -1 then
			detailed_info(cur_thing)
		--Êı×Ö1 È«²¿
		elseif IsViewingKungfuScrolls > 0 and keypress==49 then
			thing = original_thing
			thingnum = original_thingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 1
		--Êı×Ö2 È­·¨
		elseif IsViewingKungfuScrolls > 0 and keypress==50 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["Á·³öÎä¹¦"]
				if TSkill > -1 and JY.Wugong[TSkill]["Îä¹¦ÀàĞÍ"] == 1 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 2
		--Êı×Ö3 Ö¸·¨
		elseif IsViewingKungfuScrolls > 0 and keypress==51 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["Á·³öÎä¹¦"]
				if TSkill > -1 and JY.Wugong[TSkill]["Îä¹¦ÀàĞÍ"] == 2 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 3
		--Êı×Ö4 ½£·¨
		elseif IsViewingKungfuScrolls > 0 and keypress==52 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["Á·³öÎä¹¦"]
				if TSkill > -1 and JY.Wugong[TSkill]["Îä¹¦ÀàĞÍ"] == 3 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 4
		--Êı×Ö5 µ¶·¨
		elseif IsViewingKungfuScrolls > 0 and keypress==53 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["Á·³öÎä¹¦"]
				if TSkill > -1 and JY.Wugong[TSkill]["Îä¹¦ÀàĞÍ"] == 4 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 5
		--Êı×Ö6 ÆæÃÅ
		elseif IsViewingKungfuScrolls > 0 and keypress==54 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["Á·³öÎä¹¦"]
				if TSkill > -1 and JY.Wugong[TSkill]["Îä¹¦ÀàĞÍ"] == 5 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 6
		--Êı×Ö7 ÄÚÇá
		elseif IsViewingKungfuScrolls > 0 and keypress==55 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["Á·³öÎä¹¦"]
				if TSkill > -1 and (JY.Wugong[TSkill]["Îä¹¦ÀàĞÍ"] == 6 or JY.Wugong[TSkill]["Îä¹¦ÀàĞÍ"] == 7) then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 7
		--Êı×Ö8 ÔÓÑ§
		elseif IsViewingKungfuScrolls > 0 and keypress==56 then
			local newThing = {}
			local newThingnum = {}
			for i = 0, CC.MyThingNum - 1 do
				newThing[i] = -1
				newThingnum[i] = 0
			end
			local c = -1
			for i = 0, #original_thing do
				if original_thing[i] == -1 then
					break
				end
				local TSkill = JY.Thing[original_thing[i]]["Á·³öÎä¹¦"]
				if TSkill == -1 then
					c = c + 1
					newThing[c] = original_thing[i]
					newThingnum[c] = original_thingnum[i]
				end
			end
			thing = newThing
			thingnum = newThingnum
			cur_line=0
			cur_x=0
			cur_y=0
			cur_thing=-1
			IsViewingKungfuScrolls = 8
		elseif keypress==VK_UP or ktype == 6 then
			if  cur_y == 0 then
				if  cur_line > 0 then
					cur_line = cur_line - 1;
				end
			else
				cur_y = cur_y - 1;
			end
		elseif keypress==VK_DOWN or ktype == 7 then
			if  cur_y ==ynum-1 then
				if  cur_line < (math.modf(CC.MyThingNum/xnum)-ynum) then
					cur_line = cur_line + 1;
				end
			else
				cur_y = cur_y + 1;
			end
		elseif keypress==VK_LEFT then
			if  cur_x > 0 then
				cur_x=cur_x-1;
			else
				cur_x=xnum-1;
			end
		elseif keypress==VK_RIGHT then
			if  cur_x ==xnum-1 then
				cur_x=0;
			else
				cur_x=cur_x+1;
			end
		elseif ktype == 2 or ktype == 3 then
			if mx>dx and my>dy and mx<CC.ScreenW-dx and my<CC.ScreenH-dy then
				cur_x=math.modf((mx-dx-CC.ThingGapOut/2)/(CC.ThingPicWidth+CC.ThingGapIn))
				cur_y=math.modf((my-y3_1-CC.ThingGapOut/2)/(CC.ThingPicHeight+CC.ThingGapIn))
				if ktype==3 then
					break
				end
			end
		end
	end

	Cls();
	--ÎŞ¾Æ²»»¶£ºÃØóÅÏÔÊ¾Çø·Ö
	if IsViewingKungfuScrolls > 0 then
		IsViewingKungfuScrolls = 0
	end
	return cur_thing;
end


--³¡¾°´¦ÀíÖ÷º¯Êı
function Game_SMap()         --³¡¾°´¦ÀíÖ÷º¯Êı
	if JY.Restart == 1 then
		return
	end
	
    DrawSMap();	
	--ÎŞ¾Æ²»»¶£ºÏÂ·½ÏÔÊ¾
	if CC.ShowXY==1 then
		lib.LoadPNG(91,43*2,CC.ScreenW/1360*136,CC.ScreenH/768*142,2)
        DrawString(CC.ScreenW/1360*70,CC.ScreenH/768*129,string.format("%s %d %d",JY.Scene[JY.SubScene]["Ãû³Æ"],JY.Base["ÈËX1"],JY.Base["ÈËY1"]) ,C_GOLD,CC.Fontsmall*0.9);
	end
		
	--DrawTimer();
	DrawTimerA();
	JYZTB();
	--JYZTB1();
    ShowScreen();
    lib.SetClip(0, 0, 0, 0)
  
	local d_pass=GetS(JY.SubScene,JY.Base["ÈËX1"],JY.Base["ÈËY1"],3);   --µ±Ç°Â·¹ıÊÂ¼ş
	if d_pass>=0 then
		if d_pass ~=JY.OldDPass then     --±ÜÃâÖØ¸´´¥·¢
			EventExecute(d_pass,3);       --Â·¹ı´¥·¢ÊÂ¼ş
			JY.OldDPass=d_pass;
			JY.oldSMapX=-1;
			JY.oldSMapY=-1;
			JY.D_Valid=nil;
		end
		if JY.Status~=GAME_SMAP then
			return ;
		else
		   JY.OldDPass=-1;
		end
	end
	local isout=0;                --ÊÇ·ñÅöµ½³ö¿Ú
	if (JY.Scene[JY.SubScene]["³ö¿ÚX1"] ==JY.Base["ÈËX1"] and JY.Scene[JY.SubScene]["³ö¿ÚY1"] ==JY.Base["ÈËY1"]) or
		(JY.Scene[JY.SubScene]["³ö¿ÚX2"] ==JY.Base["ÈËX1"] and JY.Scene[JY.SubScene]["³ö¿ÚY2"] ==JY.Base["ÈËY1"]) or
		(JY.Scene[JY.SubScene]["³ö¿ÚX3"] ==JY.Base["ÈËX1"] and JY.Scene[JY.SubScene]["³ö¿ÚY3"] ==JY.Base["ÈËY1"]) then
		isout=1;
	end
	--³öµ½´óµØÍ¼
	if isout == 1 then
		--ÎŞ¾Æ²»»¶£ºĞŞ¸´Âí³µÖ±½Ó·É½ø³¡¾°ºó³öÀ´»áÕÚµ²½¨ÖşÎïµÄÎÊÌâ
		if JY.Base["ÈËX"] == JY.Scene[JY.SubScene]["Íâ¾°Èë¿ÚX1"] and JY.Base["ÈËY"] == JY.Scene[JY.SubScene]["Íâ¾°Èë¿ÚY1"] then
			--Ñ©É½Òªµ¥¶À´¦Àí
			if JY.SubScene == 2 then
				JY.Base["ÈËY"] = JY.Base["ÈËY"] + 1
			--Öì¸®Òªµ¥¶À´¦Àí
			elseif JY.SubScene == 92 then
				JY.Base["ÈËX"] = JY.Base["ÈËX"] + 1
			else
				if JY.Base["ÈË·½Ïò"] == 0 then
					JY.Base["ÈËY"] = JY.Base["ÈËY"] - 1
				elseif JY.Base["ÈË·½Ïò"] == 1 then
					JY.Base["ÈËX"] = JY.Base["ÈËX"] + 1
				elseif JY.Base["ÈË·½Ïò"] == 2 then
					JY.Base["ÈËX"] = JY.Base["ÈËX"] - 1
				elseif JY.Base["ÈË·½Ïò"] == 3 then
					JY.Base["ÈËY"] = JY.Base["ÈËY"] + 1
				end
			end
		end
		--Ã÷½ÌµØµÀÒªµ¥¶À´¦Àí
		if JY.SubScene == 13 then
			JY.Base["ÈËX"] = 68
			JY.Base["ÈËY"] = 397
		end
		--ÃÉ¹Å°üÒªµ¥¶À´¦Àí
		if JY.SubScene == 6 then
			JY.Base["ÈËX"] = 49
			JY.Base["ÈËY"] = 111
		end
		JY.Status = GAME_MMAP
		--lib.PicInit()
		CleanMemory()
		JY.MmapMusic = JY.Scene[JY.SubScene]["³öÃÅÒôÀÖ"]
		MMapName()
		--Èç¹ûÃ»ÓĞÉèÖÃ³öÃÅÒôÀÖµÄ»°
		if JY.MmapMusic < 0 then
			JY.MmapMusic = 0
		end
		Init_MMap()
		JY.SubScene = -1
		JY.oldSMapX = -1
		JY.oldSMapY = -1
		lib.DrawMMap(JY.Base["ÈËX"], JY.Base["ÈËY"], GetMyPic())
		lib.GetKey()
		lib.ShowSlow(20,0)
		return
	end
    --ÊÇ·ñÌø×ªµ½ÆäËû³¡¾°
    if JY.Scene[JY.SubScene]["Ìø×ª³¡¾°"] >= 0 and JY.Base["ÈËX1"] == JY.Scene[JY.SubScene]["Ìø×ª¿ÚX1"] and JY.Base["ÈËY1"] == JY.Scene[JY.SubScene]["Ìø×ª¿ÚY1"] then
		local OldScene = JY.SubScene
		JY.SubScene = JY.Scene[JY.SubScene]["Ìø×ª³¡¾°"]
		lib.ShowSlow(20, 1)
		if JY.Scene[OldScene]["Íâ¾°Èë¿ÚX1"] ~= 0 then
			JY.Base["ÈËX1"] = JY.Scene[JY.SubScene]["Èë¿ÚX"]
			JY.Base["ÈËY1"] = JY.Scene[JY.SubScene]["Èë¿ÚY"]
		else
			JY.Base["ÈËX1"] = JY.Scene[JY.SubScene]["Ìø×ª¿ÚX2"]
			JY.Base["ÈËY1"] = JY.Scene[JY.SubScene]["Ìø×ª¿ÚY2"]
		end
		Init_SMap(1)
		return 
	end

    local x,y;
    local direct = -1;
    local keypress, ktype, mx, my = lib.GetKey();
	--ÏÈ¼ì²â¸úÉÏ´Î²»Í¬µÄ·½ÏòÊÇ·ñ±»°´ÏÂ
    for i = VK_RIGHT,VK_UP do
        if i ~= CC.PrevKeypress and lib.GetKeyState(i) ~=0 then
			keypress = i
		end
	end 
    --Èç¹ûÓëÉÏ´Î²»Í¬µÄ·½ÏòÎ´±»°´ÏÂ£¬Ôò¼ì²âÓëÉÏ´ÎÏàÍ¬µÄ·½ÏòÊÇ·ñ±»°´ÏÂ
	if keypress==-1 and	lib.GetKeyState(CC.PrevKeypress) ~=0 then
		keypress = CC.PrevKeypress
	end
    CC.PrevKeypress = keypress
    if keypress==VK_UP then
		direct=0;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_DOWN then
		direct=3;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_LEFT then
		direct=2;
		JY.WalkCount = JY.WalkCount + 1
	elseif keypress==VK_RIGHT then
		direct=1;
		JY.WalkCount = JY.WalkCount + 1
	else
		JY.WalkCount = 0
	end
	
	if ktype == 1 then
		JY.Mytick=0;
		if keypress==VK_ESCAPE then
			Cls()
			--MMenu();
			--CMenu() 
			tjm_menu()
		elseif keypress==VK_SPACE or keypress==VK_RETURN then       --¿Õ¸ñ´¥·¢ÊÂ¼ş
			if JY.Base["ÈË·½Ïò"]>=0 then
				local d_num=GetS(JY.SubScene,JY.Base["ÈËX1"]+CC.DirectX[JY.Base["ÈË·½Ïò"]+1],JY.Base["ÈËY1"]+CC.DirectY[JY.Base["ÈË·½Ïò"]+1],3);
				if d_num>=0 then
					EventExecute(d_num,1);
				end
			end
		--ÎŞ¾Æ²»»¶£ºÈ«Ì×¿ì½İ¼ü 7-30
	    elseif keypress == VK_S then	--´æµµ
			Menu_SaveRecord()
	    elseif keypress == VK_L then	--¶Áµµ
			Menu_ReadRecord()
 
		elseif keypress == VK_Z then	--×´Ì¬
			Cls()
			local a = Team()
			
			if a ~= nil and a > 0 then
				PersonStatus(a)
			else
				do return end
			end	
		
		elseif keypress == VK_Q then	--Ò»½£ ¾­ÂöÆæÑ¨
			Cls()
			QUANZHANGQX1()
		elseif keypress == VK_W then	--Ò»½£ ÎäÑ§ÃØ¼®
			Cls()
			MJMenu()		
		elseif keypress == VK_E then	--ÎïÆ·
			Cls()
			Menu_Thing()
		elseif keypress == VK_R then	--Ò»½£ È«²¿ÎïÆ·
			Cls()
			ThingMenu()	
		elseif keypress == VK_T then	--Ò»½£´ò¿ªÈÎÎñÆÁ·ç¿ì½İ¼ü				
		    CallCEvent(3220)			
		elseif keypress == VK_Y then	--Ò»½£´ò¿ªÈÎÎñ½±Àø¿ì½İ¼ü				
		    CallCEvent(3221)				
		elseif keypress == VK_F2 then	--Ò»½£´ò¿ªË«¶ù¿ì½İ¼ü				
		    CallCEvent(690)			
		elseif keypress == VK_F3 then	--¶ÓÓÑÅÅÎ»
			Cls()
			Menu_TZDY()
		elseif keypress == VK_F4 then	--ÕûÀí
			Cls()		
			Menu_WPZL()
		end
	elseif ktype == 3 then
		if mx >= 0 and mx <= CC.ScreenW/1360*63 and 
		   my >= CC.ScreenH/768*110 and my <= CC.ScreenH/768*160 then
		   tjm_menu()
		   --CMenu()
		else  
			AutoMoveTab = {[0]=0}
			local x0 = JY.Base["ÈËX1"]
			local y0 = JY.Base["ÈËY1"]
			
			local px=x0
			local py=y0
			if CONFIG.Zoom == 100 then
				--ÎŞ¾Æ²»»¶£ºĞŞÕıÔÚµØÍ¼±ß½ç×Ô¶¯Ñ°Â·´íÎóµÄÎÊÌâ
				px=limitX(x0,13,46)
				py=limitX(y0,13,46)
			else
				px=x0
				py=y0
			end
		
			mx = mx + (px-py)*CC.XScale - CC.ScreenW/2
			my = my + (px+py)*CC.YScale - CC.ScreenH/2
				
			local xx = (mx/CC.XScale + my/CC.YScale)/2;
			local yy = (my/CC.YScale - mx/CC.XScale)/2;
				
			if xx - math.modf(xx) > 0 then
				xx = math.modf(xx);
			end
				
			if yy - math.modf(yy) > 0 then
				yy = math.modf(yy);
			end	
			
			if CONFIG.Zoom ~= 100 then		--ÎŞ¾Æ²»»¶£º²»ÖªµÀÊ²Ã´Ã«²¡£¬·´Õı²»¼Ó¾ÍÊÇÓĞÃ«²¡
				xx = xx + 1
				yy = yy + 1
			end

			if xx > 0 and xx < CC.SWidth and yy > 0 and yy < CC.SHeight then
				walkto(xx - x0,yy - y0)
			end
		end
	elseif ktype == 4 then
		JY.Mytick=0;
		Cls()
		--MMenu();
		--CMenu() 
		tjm_menu()
    end

    if JY.Status~=GAME_SMAP then
        return ;
    end
	
	--ÎŞ¾Æ²»»¶£ºÓĞ±ê¼ÇÊÂ¼ş×ø±ê£¬ÇÒ×Ô¶¯×ßµ½Ç°ÃæÒ»¸ñ²Å»á´¥·¢ÊÂ¼ş
	if CC.AutoMoveEvent[1] ~= 0 and 
	(JY.Base["ÈËX1"] == CC.AutoMoveEvent[1] or JY.Base["ÈËX1"] - 1 == CC.AutoMoveEvent[1] or JY.Base["ÈËX1"] + 1 == CC.AutoMoveEvent[1]) and 
	(JY.Base["ÈËY1"] == CC.AutoMoveEvent[2] or JY.Base["ÈËY1"] - 1 == CC.AutoMoveEvent[2] or JY.Base["ÈËY1"] + 1 == CC.AutoMoveEvent[2]) then
		CC.AutoMoveEvent[0] = 1			--Êó±ê²Ù×÷´¥·¢ÊÂ¼ş
	end
    
    if AutoMoveTab[0] ~= 0 then			--Êó±ê×Ô¶¯×ß¶¯
		if direct == -1 then
			direct = AutoMoveTab[AutoMoveTab[0]]
			AutoMoveTab[AutoMoveTab[0]] = nil
			AutoMoveTab[0] = AutoMoveTab[0] - 1
	    end
	else
	    AutoMoveTab = {[0] = 0}
		if CC.AutoMoveEvent[0] == 1 then
			EventExecute(GetS(JY.SubScene,CC.AutoMoveEvent[1],CC.AutoMoveEvent[2],3),1);
			CC.AutoMoveEvent[0] = 0;
			CC.AutoMoveEvent[1] = 0;
			CC.AutoMoveEvent[2] = 0;
		end
	end
	
    if direct ~= -1 then
        AddMyCurrentPic();
        x=JY.Base["ÈËX1"]+CC.DirectX[direct+1];
        y=JY.Base["ÈËY1"]+CC.DirectY[direct+1];
        JY.Base["ÈË·½Ïò"]=direct;
		if JY.WalkCount == 1 then
			lib.Delay(90)
		end
    else
        x=JY.Base["ÈËX1"];
        y=JY.Base["ÈËY1"];
    end

    JY.MyPic=GetMyPic();
    DtoSMap();
    if SceneCanPass(x,y)==true then          --ĞÂµÄ×ø±ê¿ÉÒÔ×ß¹ıÈ¥
        JY.Base["ÈËX1"]=x;
        JY.Base["ÈËY1"]=y;
    end

    JY.Base["ÈËX1"]=limitX(JY.Base["ÈËX1"],1,CC.SWidth-2);
    JY.Base["ÈËY1"]=limitX(JY.Base["ÈËY1"],1,CC.SHeight-2);
    
	--Ò»Ğ©ĞÂµÄÊÂ¼ş
	NEvent(keypress)
end

--³¡¾°×ø±ê(x,y)ÊÇ·ñ¿ÉÒÔÍ¨¹ı
--·µ»Øtrue,¿ÉÒÔ£¬false²»ÄÜ
function SceneCanPass(x,y)  --³¡¾°×ø±ê(x,y)ÊÇ·ñ¿ÉÒÔÍ¨¹ı
    local ispass=true;        --ÊÇ·ñ¿ÉÒÔÍ¨¹ı

    if GetS(JY.SubScene,x,y,1)>0 then     --³¡¾°²ã1ÓĞÎïÆ·£¬²»¿ÉÍ¨¹ı
        ispass=false;
    end

    local d_data=GetS(JY.SubScene,x,y,3);     --ÊÂ¼ş²ã4
    if d_data>=0 then
        if GetD(JY.SubScene,d_data,0)~=0 then  --d*Êı¾İÎª²»ÄÜÍ¨¹ı
            ispass=false;
        end
    end

    if CC.SceneWater[GetS(JY.SubScene,x,y,0)] ~= nil then   --Ë®Ãæ£¬²»¿É½øÈë
        ispass=false;
    end
    return ispass;
end

function DtoSMap()          ---D*ÖĞµÄÊÂ¼şÊı¾İ¸´ÖÆµ½S*ÖĞ£¬Í¬Ê±´¦Àí¶¯»­Ğ§¹û¡£
    for i=0,CC.DNum-1 do
        local x=GetD(JY.SubScene,i,9);
        local y=GetD(JY.SubScene,i,10);
        if x>0 and y>0 then
            SetS(JY.SubScene,x,y,3,i);

			local p1=GetD(JY.SubScene,i,5);
			if p1>=0 then
				local p2=GetD(JY.SubScene,i,6);
				local p3=GetD(JY.SubScene,i,7);
				local delay=GetD(JY.SubScene,i,8);
				if p3<=p1 then     --¶¯»­ÒÑÍ£Ö¹
					if JY.Mytick %100 > delay then
						p3=p3+1;
					end
				else
					if JY.Mytick % 4 ==0 then      --4¸ö½ÚÅÄ¶¯»­Ôö¼ÓÒ»´Î
						p3=p3+1;
					end
				end
				if p3>p2 then
					 p3=p1;
				end
				SetD(JY.SubScene,i,7,p3);
			end
        end
    end
end


function DrawSMap()         --»æ³¡¾°µØÍ¼
	local x0=JY.SubSceneX+JY.Base["ÈËX1"]-1;    --»æÍ¼ÖĞĞÄµã
    local y0=JY.SubSceneY+JY.Base["ÈËY1"]-1;

    local x=limitX(x0,12,45)-JY.Base["ÈËX1"];
    local y=limitX(y0,12,45)-JY.Base["ÈËY1"];
	
	if CONFIG.Zoom == 100 then
		lib.DrawSMap(JY.SubScene,JY.Base["ÈËX1"],JY.Base["ÈËY1"],x,y,JY.MyPic)
	else
		lib.DrawSMap(JY.SubScene,JY.Base["ÈËX1"],JY.Base["ÈËY1"],JY.SubSceneX,JY.SubSceneY,JY.MyPic)
	end
end


-- ¶ÁÈ¡ÓÎÏ·½ø¶È
-- id=0 ĞÂ½ø¶È£¬=1/2/3 ½ø¶È
--ÕâÀïÊÇÏÈ°ÑÊı¾İ¶ÁÈëByteÊı×éÖĞ¡£È»ºó¶¨Òå·ÃÎÊÏàÓ¦±íµÄ·½·¨£¬ÔÚ·ÃÎÊ±íÊ±Ö±½Ó´ÓÊı×é·ÃÎÊ¡£
--ÓëÒÔÇ°µÄÊµÏÖÏà±È£¬´ÓÎÄ¼şÖĞ¶ÁÈ¡ºÍ±£´æµ½ÎÄ¼şµÄÊ±¼äÏÔÖø¼Ó¿ì¡£¶øÇÒÄÚ´æÕ¼ÓÃÉÙÁË
function LoadRecord(id)       -- ¶ÁÈ¡ÓÎÏ·½ø¶È
    local zipfile=string.format('data/save/Save_%d',id)
	
	if CC.BBH~=198045761 then
		QZXS("´Ë´æµµ°æ±¾²»¶Ô£¬²»ÄÜ¶ÁÈ¡¡£ÇëÖÁÈººÅ198045761½øĞĞ¸üĞÂ");
		return -1;
	end
    
    if id ~= 0 and ( existFile(zipfile) == false) then
		QZXS("´Ë´æµµÊı¾İ²»È«£¬²»ÄÜ¶ÁÈ¡¡£ÇëÑ¡ÔñÆäËü´æµµ»òÖØĞÂ¿ªÊ¼");
		return -1;
	end
    
    Byte.unzip(zipfile, 'r.grp','d.grp','s.grp','tjm')

    local t1=lib.GetTime();

    --¶ÁÈ¡R*.idxÎÄ¼ş
    local data=Byte.create(6*4);
    Byte.loadfile(data,CC.R_IDXFilename[0],0,6*4);

	local idx={};
	idx[0]=0;
	for i =1,6 do
	    idx[i]=Byte.get32(data,4*(i-1));
	end
	
	local grpFile = 'r.grp';
	local sFile = 's.grp';
	local dFile = 'd.grp';
	if id == 0 then
		grpFile = CC.R_GRPFilename[id];
		sFile = CC.S_Filename[id];
		dFile = CC.D_Filename[id];
	end
	
    --¶ÁÈ¡R*.grpÎÄ¼ş
    JY.Data_Base=Byte.create(idx[1]-idx[0]);              --»ù±¾Êı¾İ
    Byte.loadfile(JY.Data_Base,grpFile,idx[0],idx[1]-idx[0]);

    --ÉèÖÃ·ÃÎÊ»ù±¾Êı¾İµÄ·½·¨£¬ÕâÑù¾Í¿ÉÒÔÓÃ·ÃÎÊ±íµÄ·½Ê½·ÃÎÊÁË¡£¶ø²»ÓÃ°Ñ¶ş½øÖÆÊı¾İ×ª»¯Îª±í¡£½ÚÔ¼¼ÓÔØÊ±¼äºÍ¿Õ¼ä
	local meta_t={
	    __index=function(t,k)
	        return GetDataFromStruct(JY.Data_Base,0,CC.Base_S,k);
		end,

		__newindex=function(t,k,v)
	        SetDataFromStruct(JY.Data_Base,0,CC.Base_S,k,v);
	 	end
	}
    setmetatable(JY.Base,meta_t);


    JY.PersonNum=math.floor((idx[2]-idx[1])/CC.PersonSize);   --ÈËÎï

	JY.Data_Person=Byte.create(CC.PersonSize*JY.PersonNum);
	Byte.loadfile(JY.Data_Person,grpFile,idx[1],CC.PersonSize*JY.PersonNum);

	for i=0,JY.PersonNum-1 do
		JY.Person[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Person,i*CC.PersonSize,CC.Person_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Person,i*CC.PersonSize,CC.Person_S,k,v);
			end
		}
        setmetatable(JY.Person[i],meta_t);
	end

    JY.ThingNum=math.floor((idx[3]-idx[2])/CC.ThingSize);     --ÎïÆ·
	JY.Data_Thing=Byte.create(CC.ThingSize*JY.ThingNum);
	Byte.loadfile(JY.Data_Thing,grpFile,idx[2],CC.ThingSize*JY.ThingNum);
	for i=0,JY.ThingNum-1 do
		JY.Thing[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Thing,i*CC.ThingSize,CC.Thing_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Thing,i*CC.ThingSize,CC.Thing_S,k,v);
			end
		}
        setmetatable(JY.Thing[i],meta_t);
	end

    JY.SceneNum=math.floor((idx[4]-idx[3])/CC.SceneSize);     --³¡¾°
	JY.Data_Scene=Byte.create(CC.SceneSize*JY.SceneNum);
	Byte.loadfile(JY.Data_Scene,grpFile,idx[3],CC.SceneSize*JY.SceneNum);
	for i=0,JY.SceneNum-1 do
		JY.Scene[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Scene,i*CC.SceneSize,CC.Scene_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Scene,i*CC.SceneSize,CC.Scene_S,k,v);
			end
		}
        setmetatable(JY.Scene[i],meta_t);
	end

    JY.WugongNum=math.floor((idx[5]-idx[4])/CC.WugongSize);     --Îä¹¦
	JY.Data_Wugong=Byte.create(CC.WugongSize*JY.WugongNum);
	Byte.loadfile(JY.Data_Wugong,grpFile,idx[4],CC.WugongSize*JY.WugongNum);
	for i=0,JY.WugongNum-1 do
		JY.Wugong[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Wugong,i*CC.WugongSize,CC.Wugong_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Wugong,i*CC.WugongSize,CC.Wugong_S,k,v);
			end
		}
        setmetatable(JY.Wugong[i],meta_t);
	end

    JY.ShopNum=math.floor((idx[6]-idx[5])/CC.ShopSize);     --³ÇÕòÉÌµê
	JY.Data_Shop=Byte.create(CC.ShopSize*JY.ShopNum);
	Byte.loadfile(JY.Data_Shop,grpFile,idx[5],CC.ShopSize*JY.ShopNum);
	for i=0,JY.ShopNum-1 do
		JY.Shop[i]={};
		local meta_t={
			__index=function(t,k)
				return GetDataFromStruct(JY.Data_Shop,i*CC.ShopSize,CC.Shop_S,k);
			end,

			__newindex=function(t,k,v)
				SetDataFromStruct(JY.Data_Shop,i*CC.ShopSize,CC.Shop_S,k,v);
			end
		}
        setmetatable(JY.Shop[i],meta_t);

    end

    lib.LoadSMap(sFile,CC.TempS_Filename,JY.SceneNum,CC.SWidth,CC.SHeight,dFile,CC.DNum,11);
	collectgarbage();

	lib.Debug(string.format("Loadrecord time=%d",lib.GetTime()-t1));
	
	JY.LOADTIME = lib.GetTime()
	
	rest()
	
	if id > 0 then 
	   tjmload(id)
	end
   
	os.remove('r.grp')
	os.remove('d.grp')
	os.remove('s.grp')
	os.remove('tjm');
end


-- Ğ´ÓÎÏ·½ø¶È
-- id=0 ĞÂ½ø¶È£¬=1/2/3 ½ø¶È
function SaveRecord(id)         -- Ğ´ÓÎÏ·½ø¶È
	
	if CC.BBH~=198045761 then
	return
	end

	--ÅĞ¶ÏÊÇ·ñÔÚ×Ó³¡¾°±£´æ
	if JY.Status == GAME_SMAP then
      JY.Base["ÎŞÓÃ"] = JY.SubScene
    else
      JY.Base["ÎŞÓÃ"] = -1
    end
	
    --¶ÁÈ¡R*.idxÎÄ¼ş
    local t1 = lib.GetTime()
	JY.SAVETIME = lib.GetTime()
	JY.GTIME = math.modf((JY.SAVETIME - JY.LOADTIME) / 60000)
	SetS(14, 2, 1, 4, GetS(14, 2, 1, 4) + JY.GTIME)
	JY.LOADTIME = lib.GetTime()

    local data=Byte.create(6*4);
    Byte.loadfile(data,CC.R_IDXFilename[0],0,6*4);

	local idx={};
	idx[0]=0;
	for i =1,6 do
	    idx[i]=Byte.get32(data,4*(i-1));
	end

	--os.remove('r.grp');
    --Ğ´R*.grpÎÄ¼ş
	Byte.savefile(JY.Data_Base,'r.grp',idx[0],idx[1]-idx[0]);

	Byte.savefile(JY.Data_Person,'r.grp',idx[1],CC.PersonSize*JY.PersonNum);

	Byte.savefile(JY.Data_Thing,'r.grp',idx[2],CC.ThingSize*JY.ThingNum);

	Byte.savefile(JY.Data_Scene,'r.grp',idx[3],CC.SceneSize*JY.SceneNum);

	Byte.savefile(JY.Data_Wugong,'r.grp',idx[4],CC.WugongSize*JY.WugongNum);

	Byte.savefile(JY.Data_Shop,'r.grp',idx[5],CC.ShopSize*JY.ShopNum);

    lib.SaveSMap('s.grp','d.grp');
	
    tjmsave(id)
	
    local zipfile=string.format('data/save/Save_%d',id)
    Byte.zip(zipfile, 'r.grp','d.grp','s.grp','tjm')
    os.remove('r.grp')
    os.remove('d.grp')
    os.remove('s.grp')
	os.remove('tjm');
    lib.Debug(string.format("SaveRecord time=%d",lib.GetTime()-t1));
end

-------------------------------------------------------------------------------------
-----------------------------------Í¨ÓÃº¯Êı-------------------------------------------

function filelength(filename)         --µÃµ½ÎÄ¼ş³¤¶È
	SetS(40, 11, 33, 3, 58)
	instruct_3(40, 58, 1, 0, 10086, 0, 0, 7266, 7266, 7266, 0, 0, 0)
    local inp=io.open(filename,"rb");
	if inp == nil then
        return -1
    end
    local l= inp:seek("end");
	inp:close();
    return l;
end

--¶ÁS¡ÁÊı¾İ, (x,y) ×ø±ê£¬level ²ã 0-5
function GetS(id,x,y,level)       --¶ÁS¡ÁÊı¾İ
	return lib.GetS(id,x,y,level);
end

--Ğ´S¡Á
function SetS(id,x,y,level,v)       --Ğ´S¡Á
	lib.SetS(id,x,y,level,v);
end

--¶ÁD*
--sceneid ³¡¾°±àºÅ£¬
--id D*±àºÅ
--Òª¶ÁµÚ¼¸¸öÊı¾İ, 0-10
function GetD(Sceneid,id,i)          --¶ÁD*
    return lib.GetD(Sceneid,id,i);
end

--Ğ´D¡Á
function SetD(Sceneid,id,i,v)         --Ğ´D¡Á
	lib.SetD(Sceneid,id,i,v);
end

--´ÓÊı¾İµÄ½á¹¹ÖĞ·­ÒëÊı¾İ
--data ¶ş½øÖÆÊı×é
--offset dataÖĞµÄÆ«ÒÆ
--t_struct Êı¾İµÄ½á¹¹£¬ÔÚjyconstÖĞÓĞºÜ¶à¶¨Òå
--key  ·ÃÎÊµÄkey
function GetDataFromStruct(data,offset,t_struct,key)  --´ÓÊı¾İµÄ½á¹¹ÖĞ·­ÒëÊı¾İ£¬ÓÃÀ´È¡Êı¾İ
    local t=t_struct[key];
	local r;
	if t[2]==0 then
		r=Byte.get16(data,t[1]+offset);
	elseif t[2]==1 then
		r=Byte.getu16(data,t[1]+offset);
	elseif t[2]==2 then
		if CC.SrcCharSet==0 then
			r=lib.CharSet(Byte.getstr(data,t[1]+offset,t[3]),0);
		else
			r=Byte.getstr(data,t[1]+offset,t[3]);
		end
	end
	return r;
end

function SetDataFromStruct(data,offset,t_struct,key,v)  --´ÓÊı¾İµÄ½á¹¹ÖĞ·­ÒëÊı¾İ£¬±£´æÊı¾İ
    local t=t_struct[key];
	if t[2]==0 then
		Byte.set16(data,t[1]+offset,v);
	elseif t[2]==1 then
		Byte.setu16(data,t[1]+offset,v);
	elseif t[2]==2 then
		local s;
		if CC.SrcCharSet==0 then
			s=lib.CharSet(v,1);
		else
			s=v;
		end
		Byte.setstr(data,t[1]+offset,t[3],s);
	end
end

--°´ÕÕt_struct ¶¨ÒåµÄ½á¹¹°ÑÊı¾İ´Ódata¶ş½øÖÆ´®ÖĞ¶Áµ½±ítÖĞ
function LoadData(t,t_struct,data)        --data¶ş½øÖÆ´®ÖĞ¶Áµ½±ítÖĞ
    for k,v in pairs(t_struct) do
        if v[2]==0 then
            t[k]=Byte.get16(data,v[1]);
        elseif v[2]==1 then
            t[k]=Byte.getu16(data,v[1]);
		elseif v[2]==2 then
            if CC.SrcCharSet==0 then
                t[k]=lib.CharSet(Byte.getstr(data,v[1],v[3]),0);
		    else
		        t[k]=Byte.getstr(data,v[1],v[3]);
		    end
		end
	end
end

--°´ÕÕt_struct ¶¨ÒåµÄ½á¹¹°ÑÊı¾İĞ´Èëdata ByteÊı×éÖĞ¡£
function SaveData(t,t_struct,data)      --Êı¾İĞ´Èëdata ByteÊı×éÖĞ¡£
    for k,v in pairs(t_struct) do
        if v[2]==0 then
            Byte.set16(data,v[1],t[k]);
		elseif v[2]==1 then
            Byte.setu16(data,v[1],t[k]);
		elseif v[2]==2 then
		    local s;
			if CC.SrcCharSet==0 then
			    s=lib.CharSet(t[k],1);
            else
			    s=t[k];
		    end
            Byte.setstr(data,v[1],v[3],s);
		end
	end
end

--ÏŞÖÆxµÄ·¶Î§
function limitX(x,minv,maxv)
	if maxv == nil then
		if x < minv then
		    x = minv;
		end
	else
		if x < minv then
		    x = minv;
		end		
		if maxv ~= nil and x > maxv then
		    x = maxv;
		end
	end	
	return x
end

function RGB(r,g,b)          --ÉèÖÃÑÕÉ«RGB
	return r*65536+g*256+b;
end

function GetRGB(color)      --·ÖÀëÑÕÉ«µÄRGB·ÖÁ¿
    color=color%(65536*256);
    local r=math.floor(color/65536);
    color=color%65536;
    local g=math.floor(color/256);
    local b=color%256;
    return r,g,b
end

--µÈ´ı¼üÅÌÊäÈë
function WaitKey(flag)
	--ktype  1£º¼üÅÌ£¬2£ºÊó±êÒÆ¶¯£¬3:Êó±ê×ó¼ü£¬4£ºÊó±êÓÒ¼ü£¬5£ºÊó±êÖĞ¼ü£¬6£º¹ö¶¯ÉÏ£¬7£º¹ö¶¯ÏÂ
	local key, ktype, mx, my=-1,-1,-1,-1;
	while true do
		if JY.Restart == 1 then
			break
		end
		key, ktype, mx, my=lib.GetKey();
		if ktype == nil then
			ktype, mx, my=-1,-1,-1;
		end
		if ktype ~=-1 or key ~= -1 then
			if (flag == nil or flag == 0) and ktype ~= 2 then
				break;
			elseif flag ~= nil and flag ~= 0 then
				break;
			end
		end
		lib.Delay(CC.Frame/2);
	end
	return key, ktype, mx, my;
end

--»æÖÆÒ»¸ö´ø±³¾°µÄ°×É«·½¿ò£¬ËÄ½Ç°¼½ø
function DrawBox(x1, y1, x2, y2, color)
	local s = 4
	lib.Background(x1 + 4, y1, x2 - 4, y1 + s, 88)
	lib.Background(x1 + 1, y1 + 1, x1 + s, y1 + s, 88)
	lib.Background(x2 - s, y1 + 1, x2 - 1, y1 + s, 88)
	lib.Background(x1, y1 + 4, x2, y2 - 4, 88)
	lib.Background(x1 + 1, y2 - s, x1 + s, y2 - 1, 88)
	lib.Background(x2 - s, y2 - s, x2 - 1, y2 - 1, 88)
	lib.Background(x1 + 4, y2 - s, x2 - 4, y2, 88)
	local r, g, b = GetRGB(color)
	DrawBox_1(x1 + 1, y1 + 1, x2, y2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
	DrawBox_1(x1, y1, x2 - 1, y2 - 1, color)
end

--»æÖÆÒ»¸ö´ø±³¾°µÄ°×É«·½¿ò£¬ËÄ½Ç°¼½ø
function DrawBox_1(x1, y1, x2, y2, color)
	local s = 4
	lib.DrawRect(x1 + s, y1, x2 - s, y1, color)
	lib.DrawRect(x1 + s, y2, x2 - s, y2, color)
	lib.DrawRect(x1, y1 + s, x1, y2 - s, color)
	lib.DrawRect(x2, y1 + s, x2, y2 - s, color)
	lib.DrawRect(x1 + 2, y1 + 1, x1 + s - 1, y1 + 1, color)
	lib.DrawRect(x1 + 1, y1 + 2, x1 + 1, y1 + s - 1, color)
	lib.DrawRect(x2 - s + 1, y1 + 1, x2 - 2, y1 + 1, color)
	lib.DrawRect(x2 - 1, y1 + 2, x2 - 1, y1 + s - 1, color)
	lib.DrawRect(x1 + 2, y2 - 1, x1 + s - 1, y2 - 1, color)
	lib.DrawRect(x1 + 1, y2 - s + 1, x1 + 1, y2 - 2, color)
	lib.DrawRect(x2 - s + 1, y2 - 1, x2 - 2, y2 - 1, color)
	lib.DrawRect(x2 - 1, y2 - s + 1, x2 - 1, y2 - 2, color)
end

--ÏÔÊ¾ÒõÓ°×Ö·û´®
function DrawString(x,y,str,color,size)         --ÏÔÊ¾ÒõÓ°×Ö·û´®
	if x==-1 and str ~= nil then
		local ll=#str;
		local w=size*ll/2+2*CC.MenuBorderPixel;
		x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end
	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
    if x ~= -1 and y ~= -1 then
		lib.DrawStr(x,y,str,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
	else
		do return end
	end	
end

--ÏÔÊ¾´ø¿òµÄ×Ö·û´®
--(x,y) ×ø±ê£¬Èç¹û¶¼Îª-1,ÔòÔÚÆÁÄ»ÖĞ¼äÏÔÊ¾
function DrawStrBox(x,y,str,color,size,boxcolor)         --ÏÔÊ¾´ø¿òµÄ×Ö·û´®
    local ll=#str;
    local w=size*ll/2+2*CC.MenuBorderPixel;
	local h=size+2*CC.MenuBorderPixel;
	if boxcolor == nil then
		boxcolor = C_WHITE
	end
	if x==-1 then
        x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end
	if y==-1 then
        y=(CC.ScreenH-size-2*CC.MenuBorderPixel)/2;
	end
    
   DrawBox(x,y,x+w-1,y+h-1,boxcolor);
    DrawString(x+CC.MenuBorderPixel,y+CC.MenuBorderPixel,str,color,size);
end

--ÎŞ¾Æ²»»¶£ºÔö¼Ó¶ÔÑÕÉ«×ª»»µÄÖ§³Ö
function DrawStrBox3(x, y, s, color, size, flag)         --ÏÔÊ¾´ø¿òµÄ×Ö·û´®
    local ll=#s -flag*2;
    local w=size*ll/2+2*CC.MenuBorderPixel;
	local h=size+2*CC.MenuBorderPixel;
	local function strcolor_switch(s)
		local Color_Switch={{"£Ò",C_RED},{"£Ç",C_GOLD},{"£Â",C_BLACK},{"£×",C_WHITE},{"£Ï",C_ORANGE}}
		local Numbers = {{"1",10},{"2",15},{"3",15},{"4",15},{"5",15},{"6",15},{"7",15},{"8",15},{"9",15},{"0",15}}
		for i = 1, 5 do
			if Color_Switch[i][1] == s then
				return 1, Color_Switch[i][2]
			end
		end
		for i = 1, 10 do
			if Numbers[i][1] == s then
				return 2, Numbers[i][2]
			end
		end
		return 0
	end
	
	if x==-1 then
        x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end
	if y==-1 then
        y=(CC.ScreenH-size-2*CC.MenuBorderPixel)/2;
	end
	
	--ÎŞ¾Æ²»»¶£º·½¿òÑÕÉ« 7-31
    DrawBox(x,y,x+w-1,y+h-1,LimeGreen);
	local space = 0;
	while string.len(s) >= 1 do
		local str
		str=string.sub(s,1,1)
		if string.byte(s,1,1) > 127 then		--ÅĞ¶Ïµ¥Ë«×Ö·û
			str=string.sub(s,1,2)
			s=string.sub(s,3,-1)
		else
			str=string.sub(s,1,1)
			s=string.sub(s,2,-1)
		end
		local cs,cs2 = strcolor_switch(str)
		if cs == 1 then
			color = cs2
		elseif cs == 2 then
			DrawString(x+CC.MenuBorderPixel+space,y+CC.MenuBorderPixel,str,color,size);
			space = space + cs2;
		else
			DrawString(x+CC.MenuBorderPixel+space,y+CC.MenuBorderPixel,str,color,size);
			space = space + size;
		end
	end
end

--ÏÔÊ¾²¢Ñ¯ÎÊY/N£¬Èç¹ûµã»÷Y£¬Ôò·µ»Øtrue, NÔò·µ»Øfalse
--(x,y) ×ø±ê£¬Èç¹û¶¼Îª-1,ÔòÔÚÆÁÄ»ÖĞ¼äÏÔÊ¾
--¸ÄÎªÓÃ²Ëµ¥Ñ¯ÎÊÊÇ·ñ
function DrawStrBoxYesNo(x, y, str, color, size, boxcolor)
	if JY.Restart == 1 then
		return
	end
	lib.GetKey()
	local ll = #str
	local w = size * ll / 2 + 2 * CC.MenuBorderPixel
	local h = size + 2 * CC.MenuBorderPixel
	if x == -1 then
		x = (CC.ScreenW - size / 2 * ll - 2 * CC.MenuBorderPixel) / 2
	end
	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
	Cls();
	DrawStrBox(x, y, str, color, size, boxcolor)
	local menu = {
	{"È·¶¨/ÊÇ", nil, 1}, 
	{"È¡Ïû/·ñ", nil, 2}}
	local r = ShowMenu(menu, 2, 0, x + w - 4 * size - 2 * CC.MenuBorderPixel, y + h + CC.MenuBorderPixel, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE)
	if r == 1 then
		return true
	else
		return false
	end
end

--ÏÔÊ¾×Ö·û´®²¢µÈ´ı»÷¼ü£¬×Ö·û´®´ø¿ò£¬ÏÔÊ¾ÔÚÆÁÄ»ÖĞ¼ä
function DrawStrBoxWaitKey(s,color,size,flag,boxcolor)
	if JY.Restart == 1 then
		return
	end
    lib.GetKey();
    Cls();
	--ÎŞ¾Æ²»»¶£º·Ö¿ª¶àÖÖ
	if flag == nil then
		if boxcolor == nil then
			DrawStrBox(-1,-1,s,color,size);
		else
			DrawStrBox(-1,-1,s,color,size,boxcolor);
		end
	else
		DrawStrBox3(-1,-1,s,color,size,flag);
	end
    ShowScreen();
    WaitKey();
end

--·µ»Ø [0 , i-1] µÄÕûĞÎËæ»úÊı
function Rnd(i)           --Ëæ»úÊı
    local r=math.random(i);
    return r-1;
end

--Ôö¼ÓÈËÎïÊôĞÔ£¬Èç¹ûÓĞ×î´óÖµÏŞÖÆ£¬ÔòÓ¦ÓÃ×î´óÖµÏŞÖÆ¡£×îĞ¡ÖµÔòÏŞÖÆÎª0
--id ÈËÎïid
--strÊôĞÔ×Ö·û´®
--value ÒªÔö¼ÓµÄÖµ£¬¸ºÊı±íÊ¾¼õÉÙ
--·µ»Ø1,Êµ¼ÊÔö¼ÓµÄÖµ
--·µ»Ø2£¬×Ö·û´®£ºxxx Ôö¼Ó/¼õÉÙ xxxx£¬ÓÃÓÚÏÔÊ¾Ò©Æ·Ğ§¹û
function AddPersonAttrib(id, str, value)
	local oldvalue = JY.Person[id][str]
	local attribmax = math.huge
	if str == "ÉúÃü" then
		attribmax = JY.Person[id]["ÉúÃü×î´óÖµ"]
	elseif str == "ÄÚÁ¦" then
		attribmax = JY.Person[id]["ÄÚÁ¦×î´óÖµ"]
	elseif CC.PersonAttribMax[str] ~= nil then
		attribmax = CC.PersonAttribMax[str]
	end
	
	value = math.modf(value)
	
	if str == "ÄÚÁ¦×î´óÖµ" then
		local p_zz = JY.Person[id]["×ÊÖÊ"];
        local zz = 101 - JY.Person[id]["×ÊÖÊ"]
		local sz = {0.5,0.4,0.3,0.25,0.2,0.15,0.1}
		local jssz = sz[JY.Person[id]['³©Ïë·Ö½×']+1]
		local nd = JY.Base["ÄÑ¶È"]
		local mptype = (MPPD(id) or 0)
		if isteam(id) then
            attribmax = 1000
            attribmax = attribmax + zz * 40
        else
            attribmax = JY.Person[id]["ÄÚÁ¦×î´óÖµ"] + JY.Base["ÖÜÄ¿"]*5*nd
        end
		
		--¶ÎÓş¡¢É¨µØ¡¢Ê¯ÆÆÌì¡¢ÎŞÑÂ×Ó¡¢¶·¾ÆÉ®
		if match_ID(id, 53) or match_ID(id, 114) or match_ID(id, 38) or match_ID(id, 116) 
		or match_ID(id, 638) or match_ID(id, 499) or match_ID(id, 529) or match_ID(id, 514) or match_ID(id, 520) then
			attribmax = 9999
		end
		--ÕÅÈı·á
		if match_ID(id, 5) then
			attribmax = 8000
		end
		--¶«·½²»°Ü
		if match_ID(id, 27) then
			attribmax = 7000
		end
		--½£Ì«Ò»
		if match_ID(id, 774) then
			attribmax = 9999
		end
		if match_ID(id,9893) then --Ìì¸³Àà
			attribmax = attribmax + 1500
		end	
		if match_ID(id,9999) or match_ID(id,9740) or match_ID(id,9929) then --Ìì¸³Àà
			attribmax = attribmax + 1000
		end
		if match_ID(id,9725) then
			attribmax = attribmax + 2000
		end
		if match_ID(id,9722) then --Ìì¸³Àà
			attribmax = 9999
		end	
		--åĞÒ£ÅÉ¼ÓÄÚÁ¦ÉÏÏŞ3000
		if MPTX(id,7) then
			attribmax = attribmax + 3000
		end 
		
		--ÖĞ»ª¸ó¼ÓÄÚÁ¦ÉÏÏŞ2500
		if MPTX(id,22) then
			attribmax = attribmax + 2500
		end 	
		
		--»¤ÁúÉ½×¯¾üÊ¦ÄÚÁ¦ÉÏÏŞÔö¼Ó2000
		if MPTX(id,25,4) then
			attribmax = attribmax + 2000
		end 	 
		
		--Çà³Ç¼ÓÄÚÁ¦ÉÏÏŞ1000
		if MPTX(id,28) then
			attribmax = attribmax + 1000
		end 	
		
		--Ìì»ú¹¬ÄÚÁ¦ÉÏÏŞÔö¼Ó2000
		if MPTX(id,30) then
			attribmax = attribmax + 2000
		end 	
		
		--Éñ×ãè¤Ù¤
		if NGQH(id,233) then
			attribmax = attribmax + 2000
		end 	
		
		--Ñ§Ò»¸öÄÚ¹¦¿ª·¢800ÄÚÁ¦ÉÏÏŞ
		if Num_of_Neigong(id) == 1 then
			attribmax = attribmax + 800	
		--Ñ§Á½¸öÄÚ¹¦¿ª·¢1600ÄÚÁ¦ÉÏÏŞ
		elseif Num_of_Neigong(id) == 2 then
			attribmax = attribmax + 1600
		--Ñ§Èı¸öÄÚ¹¦¿ª·¢2400ÄÚÁ¦ÉÏÏŞ
		elseif Num_of_Neigong(id) == 3 then
			attribmax = attribmax + 2400
		--Ñ§ËÄ¸öÄÚ¹¦¿ª·¢3200ÄÚÁ¦ÉÏÏŞ
		elseif Num_of_Neigong(id) == 4 then
			attribmax = attribmax + 3200
		--Ñ§ËÄ¸öÒÔÉÏÄÚ¹¦¿ª·¢4000ÄÚÁ¦ÉÏÏŞ
		elseif Num_of_Neigong(id) > 4 then
			attribmax = attribmax + 4000
		end
		--Ñ§ÓĞ±±Ú¤»òÎüĞÇ£¬+500
		for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
			if JY.Person[id]["Îä¹¦" .. i] == 85 or JY.Person[id]["Îä¹¦" .. i] == 88 then
				attribmax = attribmax + 500
				break
			end
		end
		--Ñî¹ıºğ¹ıµÄÄÚÁ¦
		if match_ID(id, 58) then
			attribmax = attribmax - JY.Person[300]["ÉùÍû"] * 1000
		end
		if MPPD(id) > 0 then
			attribmax = math.modf((CC.MPAttrib[mptype][9])* attribmax)
		end
		
		--ÄÚÁ¦ÏÂÏŞ2999£¬ÉÏÏŞ9999
		if attribmax < 2999 then
			attribmax = 2999
		end
		if actor(id,6) then
			if attribmax < 4999 then
				attribmax = 4999
			end
		end
		if attribmax > 10000 then
			attribmax = 10000
		end
    end	
    
	--³ÌÁéËØ£¬ºÎÌúÊÖ£¬ÍõÄÑ¹Ã£¬ÓÃ¶¾600
	if str == "ÓÃ¶¾ÄÜÁ¦" and (match_ID(id, 2) or match_ID(id, 83) or match_ID(id, 17)) then
		attribmax = 600
	end
	--À¶·ï»Ë£¬ÓÃ¶¾500
	if str == "ÓÃ¶¾ÄÜÁ¦" and match_ID(id, 25) then
		attribmax = 500
	end
	--ºúÇàÅ££¬Æ½Ò»Ö¸£¬Ñ¦Ä½»ªÒ½ÁÆ600
	if str == "Ò½ÁÆÄÜÁ¦" and (match_ID(id, 16) or match_ID(id, 28) or match_ID(id, 45)) then
		attribmax = 600
	end
	--±´º£Ê¯£¬³ÌÁéËØÒ½ÁÆ500
	if str == "Ò½ÁÆÄÜÁ¦" and (match_ID(id, 85) or match_ID(id, 2)) then
		attribmax = 500
	end
	--±êÖ÷Ò½Éú£¬Ò½ÁÆÓÃ¶¾¶¼ÊÇ500
	if (str == "Ò½ÁÆÄÜÁ¦" or str == "ÓÃ¶¾ÄÜÁ¦") and id == 0 and JY.Base["±ê×¼"] == 8 then
		attribmax = 500
	end
	--±êÖ÷¶¾Íõ£¬ÓÃ¶¾600
	if str == "ÓÃ¶¾ÄÜÁ¦" and id == 0 and JY.Base["±ê×¼"] == 9 then
		attribmax = 600
	end
	--ÑÖ»ù£¬Ò½ÁÆÓÃ¶¾¶¼ÊÇ400
	if (str == "Ò½ÁÆÄÜÁ¦" or str == "ÓÃ¶¾ÄÜÁ¦") and match_ID(id, 4) then
		attribmax = 400
	end
	--³Â¼ÒÂå¾õĞÑºó±øÆ÷ÖµÎŞÉÏÏŞ
	if JXPD(id,75,1)  and (str == "È­ÕÆ¹¦·ò" or str == "Ö¸·¨¼¼ÇÉ" or str == "Óù½£ÄÜÁ¦" or str == "Ë£µ¶¼¼ÇÉ" or str == "ÌØÊâ±øÆ÷") then
		attribmax = 9999
	end	
		 
    --Õ½¶·ÖĞ½ûÁÆÎŞ·¨»Ö¸´ÈÎºÎ×´Ì¬
    if JY.Status == GAME_WMAP then 
	    if str == 'ÉúÃü' then
			if value > 0 then
				if NGQH(id,203) and (WAR.PD['³¤ÉúÕæÆø'][id] or 0) > 0 then
					value = value * 2
					if psx(id,'ÉúÃü') + value >= psx(id,'ÉúÃü×î´óÖµ') then
						WAR.QSZQ = WAR.QSZQ + 0.2
					end	
				end	
				if WAR.PD['ĞşÌú½£´´'][id] ~= nil and WAR.PD['ĞşÌú½£´´'][id] > 0 then
					local sm = psx(id,'ÉúÃü×î´óÖµ') - (WAR.PD['ĞşÌú½£´´'][id] or 0) * 10
					if psx(id,'ÉúÃü') + value > sm then
						value = psx(id,'ÉúÃü') - sm
					end
				end
				--³µÉñ
				if match_ID(id,524) then
					local tl = (200-JY.Person[id]["ÌåÁ¦"])/80
					value = math.modf(value*tl)
				end
				--ÕÅÈı·á¾õĞÑ
				if JXPD(id,5,1) and JY.Person[id]["ÉúÃü"] <= (JY.Person[id]["ÉúÃü×î´óÖµ"]/2) then
					if value < math.modf(JY.Person[id]["ÉúÃü×î´óÖµ"]/50) then
						value = math.modf(JY.Person[id]["ÉúÃü×î´óÖµ"]/50)
					end
				end
				if WAR.PD['¾ÅÃüÃ¨'][id] ~= nil and WAR.PD['¾ÅÃüÃ¨'][id] > 0 then
					local jm = 10 - (WAR.PD['¾ÅÃüÃ¨'][id] or 0)
					value =  math.modf(value*jm)
				end
				if WAR.LXQJ[200+id] ~= nil then
					WAR.LXQJ[200+id] = (WAR.LXQJ[200+id] or 0) + value
					if WAR.LXQJ[200+id] > 2000 then
						WAR.LXQJ[200+id] = 2000
					end
				end
				if WAR.HYDJ[200+id] ~= nil then
					WAR.HYDJ[200+id] = (WAR.HYDJ[200+id] or 0) + value
					if WAR.HYDJ[200+id] > 2000 then
						WAR.HYDJ[200+id] = 2000
					end
				end
				--ÖÜ¹«½£Òâ
				if WAR.PD['Ê³ĞÄ¹Æ'][id] ~= nil then
					local zd = (300-JY.Person[id]["ÖĞ¶¾³Ì¶È"])/400
					value = math.modf(value*zd)
				end
				if WAR.PD['ĞéĞ°ÂÒÆÇ2'][id] ~= nil then
					if JY.Base['³©Ïë'] == 457 then
						JY.Person[0]['ÉúÃü'] = limitX(JY.Person[0]['ÉúÃü'] + value,0,JY.Person[0]['ÉúÃü×î´óÖµ'])
					else
						JY.Person[457]['ÉúÃü'] = limitX(JY.Person[457]['ÉúÃü'] + value,0,JY.Person[457]['ÉúÃü×î´óÖµ'])	
					end
				end		
				if value >= 250 and WAR.PD['½ğ¸ÕÖ¸¶ÏÖ«'][id] ~= nil then
					WAR.PD['½ğ¸ÕÖ¸¶ÏÖ«'][id] = WAR.PD['½ğ¸ÕÖ¸¶ÏÖ«'][id] -1
					if WAR.PD['½ğ¸ÕÖ¸¶ÏÖ«'][id] < 1 then
						WAR.PD['½ğ¸ÕÖ¸¶ÏÖ«'][id] = nil
					end
				end	
				if NGQH(id,203) == false then
					if WAR.PD['Éñ½ÌÄæÉ±'][id] ~= nil then
						value = 0
					end
					if (WAR.PD['½ûÁÆ'][id] ~= nil or WAR.PD['ÉúÃü»Ö¸´Í£Ö¹'][id] ~= nil or JY.Person[id]["ÉúÃü"] <= 0) then 
						value = 0
					end
					if WAR.PD['ÖïÏÉ×´Ì¬'][id] ~= nil and JY.Person[id]["ÉúÃü"] >= math.modf(JY.Person[id]["ÉúÃü×î´óÖµ"]*0.5) then
						value = 0
					end	
				end	
				if WAR.ZZTM == 1 then
					value = 0
				end
				if WAR.PD['¶À¹ÂÇó°Ü'][id] == 2 and JY.Person[id]["ÉúÃü"] > (JY.Person[id]["ÉúÃü×î´óÖµ"]/3*2) then
					value = 0
				end
				if WAR.PD['¶À¹ÂÇó°Ü'][id] == 3 and JY.Person[id]["ÉúÃü"] > (JY.Person[id]["ÉúÃü×î´óÖµ"]/3) then
					value = 0
				end
				if WAR.PD['Äı½áÊ±¿Õ'][id] ~= nil then
					value = 0
				end
				if WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
					value = 0
				end
				value = limitX(value,0,math.abs(value))
			elseif value < 0 then
				if WAR.PD['ÏÉÏ¢»¤Ìå'][id] ~= nil and Curr_NG(id,184) and PersonKF(id,184) then
					WAR.PD['ÏÉÏ¢»¤Ìå'][id] = (WAR.PD['ÏÉÏ¢»¤Ìå'][id] or 0) - math.modf(value*0.25)
				end
				if WAR.PD['Ç¿ÖÆÔöÉË'][id] ~= nil and WAR.PD['Ç¿ÖÆÔöÉË'][id] > 0 then
					local qz = WAR.PD['Ç¿ÖÆÔöÉË'][id]/5
					value = math.modf((1+qz)*value)
				end
				if WAR.PD['ÎŞÊ¼ÎŞÃ÷'][id] == 1 and JY.Person[id]['ÉúÃü'] < 2000 then
					if match_ID(id,517) then
						value = 0
					else
					    value = math.modf(value/10)
					end
				end
				if NGQH(id,160) and WAR.PD['ÌìÄ§½ğÉí'][id] ~= nil and WAR.PD['ÌìÄ§½ğÉí'][id] > 50 then
					value = 0
				end
				if MPTX(id,16) and WAR.PD['ÏÈÌì»¤¶Ü'][id] ~= nil and WAR.PD['ÏÈÌì»¤¶Ü'][id] > 0 and NGQH(id,100) then
					local a = math.abs(value)
					local b = WAR.PD['ÏÈÌì»¤¶Ü'][id]
					value = value + WAR.PD['ÏÈÌì»¤¶Ü'][id]
					if a >= b then
						WAR.PD['ÏÈÌì»¤¶Ü'][id] = nil
					else
						WAR.PD['ÏÈÌì»¤¶Ü'][id] = b-a
					end		
				end	
				if  WAR.PD['ÎŞÃ÷Ò¹'][id] ~= nil and (MPTX(id,24,4) or match_ID(id,525)) then
					local dj = MPDJ(id)
					if MPDJ(id) == nil or MPDJ(id) < 1 then
						dj = 4
					end	
					if JLSD(0,dj*15,id) then
						value = 0
					end	
				end	
				if match_ID(id,501) and (WAR.JBMY[id] or 0) > 15 and WAR.JBMY[id] ~= nil then
					value = 0
				end
				--ÈâÈçÅÍÊ¯
				if (match_ID(id,760) or match_ID(id,771) or match_ID(id,772) or match_ID(id,774) or match_ID(id,780) or match_ID(id,784)or match_ID(id,785)) and (JLSD(20,55,id) or WAR.SXTJ <= 3) then
					value = 0
				end	
				--¶·Æø
				if (match_ID(id,767) or match_ID(id,768) or match_ID(id,769) or match_ID(id,770)) and (JLSD(20,55,id) or WAR.SXTJ <= 50) then
					value = 0
				end	
				if WAR.PD['ÁøÈçĞõ'][id] ~= nil and WAR.PD['ÁøÈçĞõ'][id] > 0 then
					value = 0
				end
				if WAR.PD['»¢±Ù'][id] ~= nil and WAR.PD['»¢±Ù'][id] > 0 then
					value = 0
				end
				if WAR.PD['ÎŞÎÒÖ®¾³'][id] ~= nil and WAR.PD['ÎŞÎÒÖ®¾³'][id] > 0 then
					value = 0
				end
				if NGQHB(id,180) and WAR.PD['¾¨¹ê³ÁÃß'][id] ~= nil and WAR.PD['¾¨¹ê³ÁÃß'][id] == 1 then
					value = 0
				end
				--³¯Í¢Âú½­ºì
				if MPTX(id,23,4) and ZYJQ(id) then
					value = 0
				end
				if MPTX(id,23,4) and JY.Person[id]["ÉúÃü"] < JY.Person[id]["ÉúÃü×î´óÖµ"]*0.3 and WAR.PD['Âú½­ºì'][id] ~= 1 then
					value = 0
				end
				if match_ID(id,520) and WAR.PD['ÏÈÌìÌ«¼«'][id] ~= nil and WAR.PD['ÏÈÌìÌ«¼«'][id] > 0 then
					if value <= -30 then
						value = -30
					end	
				end
				if (match_ID(id,754) or MPTX(id,26,3)) and WAR.PD['Çã¹úÇã³Ç'][id] ~= nil and WAR.PD['Çã¹úÇã³Ç'][id] > 0 then
					if value <= -50 then
						value = -50
					end	
				end
				if NGQH(id,233) and WAR.PD['Éñ×ãÇ¬À¤'][id] ~= nil and WAR.PD['Éñ×ãÇ¬À¤'][id] > 0 then
					if value <= -300 then
						value = -300
					end	
				end
				if WAR.PD['Ç¿ÖÆ¼õÉË'][id] ~= nil and WAR.PD['Ç¿ÖÆ¼õÉË'][id] > 0 then
					local qz = WAR.PD['Ç¿ÖÆ¼õÉË'][id]
					if value < -qz then
						value = -qz
					end
				end
				if match_ID(id,92) and WAR.PD['ÒõÑô¶şÆø'][id] ~= nil and WAR.PD['ÒõÑô¶şÆø'][id] > 0 then
					value = math.modf(value/((WAR.PD['ÒõÑô¶şÆø'][id] or 0)*2+2))
				end	
				if NGQH(id,106) and (WAR.PD['¾ÅÑô»¤¶Ü'][id] or 0) > 0 then
					local a = WAR.PD['¾ÅÑô»¤¶Ü'][id]
					value = math.modf(value/a)
				end
				if WAR.PD['¾ÅÃüÃ¨'][id] ~= nil and WAR.PD['¾ÅÃüÃ¨'][id] == 1 and match_ID(id,456) then
					if value < -math.modf(JY.Person[id]["ÉúÃü×î´óÖµ"]/9) then
						value = -99
					end	
				end
				if WAR.PD['¾ÅÃüÃ¨'][id] ~= nil and WAR.PD['¾ÅÃüÃ¨'][id] > 0 then
					local jm = 10 - (WAR.PD['¾ÅÃüÃ¨'][id] or 0)
					value =  math.modf(value/jm)
				end
				if WAR.PD['ÁÒ»ğÕó'][id] == 1 then
					value = math.modf(value*1.5)
					WAR.PD['ÁÒ×çÖä'][id] = (WAR.PD['ÁÒ×çÖä'][id] or 0) - math.modf(value*0.5)
					if WAR.PD['ÁÒ×çÖä'][id] > 10000 then
						WAR.PD['ÁÒ×çÖä'][id] = 10000
					end
				end
				
				if WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and match_ID(id,456) then
					value = math.modf(value * (-0.2))
				end
				--ÕÅÈı·á¾õĞÑ
				if JXPD(id,5,1) and JY.Person[id]["ÉúÃü"] > (JY.Person[id]["ÉúÃü×î´óÖµ"]/2) then
					local sm = math.modf(JY.Person[id]["ÉúÃü"]/8)
					if value <= -sm then
						value = -sm
					end	
				end
				--ÕÅÈı·á¾õĞÑ
				if JXPD(id,5,1) and JY.Person[id]["ÉúÃü"] <= (JY.Person[id]["ÉúÃü×î´óÖµ"]/2) then
					if value < -math.modf(JY.Person[id]["ÉúÃü×î´óÖµ"]/10) then
						value = -math.modf(JY.Person[id]["ÉúÃü×î´óÖµ"]/10)
					end
				end
				if WAR.PD['ÑªÕ½µ½µ×'][id] ~= nil and WAR.PD['ÑªÕ½µ½µ×'][id] == 1 then
					local aa = (5 - JY.Person[id]['³©Ïë·Ö½×'])*2
					value = math.modf(value/aa)
				end
				if WAR.PD['¶À¹ÂÇó°Ü'][id] == 2 then
					value = math.modf(value/2)
				end
				if WAR.PD['¶À¹ÂÇó°Ü'][id] == 3 then
					value = math.modf(value/10)
				end
				--³µÉñ
				if match_ID(id,524) then
					local tl = JY.Person[id]["ÌåÁ¦"]/100
					value = math.modf(value*tl)
				end
				if NGQHB(id,180) and WAR.PD['¾¨¹ê³ÁÃß'][id] ~= nil and WAR.PD['¾¨¹ê³ÁÃß'][id] == 2 then
					value = math.modf(value*0.7)
				end
				value = limitX(value,value,0)
				if PersonKF(id,360) and Curr_NG(id,93) then
					local a = math.abs(value)
					WAR.PD['Ê¥»ğÎŞÖĞÉúÓĞ'][id] = (WAR.PD['Ê¥»ğÎŞÖĞÉúÓĞ'][id] or 0) + a
				end	
				if WAR.PD['ÕÚ±Î'][id] ~= nil and WAR.PD['ÕÚ±Î'][id] == 1 then
					value = 100
				end
				
 			end	
        end
		if str == 'ÄÚÁ¦' then
			if value > 0 then
				if WAR.PD['½ûÁÆ'][id] ~= nil or WAR.PD['¼«ÒõÎŞÏà5'][id] ~= nil or WAR.PD['ÄÚÁ¦»Ö¸´Í£Ö¹'][id] ~= nil or (WAR.PD['ÖïÏÉ×´Ì¬'][id] ~= nil and JY.Person[id]["ÄÚÁ¦"] >= math.modf(JY.Person[id]["ÄÚÁ¦×î´óÖµ"]*0.5)) then
					if NGQH(id,203) == false then
						value = 0
					else
					    value = math.modf(value/3)
					end
				end
				--ÖÜ¹«½£Òâ
				if WAR.PD['Ê³ĞÄ¹Æ'][id] ~= nil then
					local zd = (300-JY.Person[id]["ÖĞ¶¾³Ì¶È"])/400
					value = math.modf(value*zd)
				end
				if WAR.PD['ĞşÌú½£´´'][id] ~= nil and WAR.PD['ĞşÌú½£´´'][id] > 0 then
					local nl = psx(id,'ÄÚÁ¦×î´óÖµ') - (WAR.PD['ĞşÌú½£´´'][id] or 0) * 10
					if psx(id,'ÄÚÁ¦') + value > nl then
						value = psx(id,'ÄÚÁ¦') - nl
					end
				end
				if WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
					value = math.modf(value * (-0.2))
				end
				
				if WAR.PD['ĞéĞ°ÂÒÆÇ2'][id] ~= nil then
					if JY.Base['³©Ïë'] == 457 then
						JY.Person[0]['ÄÚÁ¦'] = limitX(JY.Person[0]['ÄÚÁ¦'] + value,0,JY.Person[0]['ÄÚÁ¦×î´óÖµ'])
					else
						JY.Person[457]['ÄÚÁ¦'] = limitX(JY.Person[457]['ÄÚÁ¦'] + value,0,JY.Person[457]['ÄÚÁ¦×î´óÖµ'])	
					end
				end	
				if NGQH(id,227) and psx(id,'ÄÚÁ¦') >= math.modf(psx(id,'ÄÚÁ¦×î´óÖµ')*0.5) then
					WAR.PD['¸òó¡ĞîÁ¦'][id] = (WAR.PD['¸òó¡ĞîÁ¦'][id] or 0) + math.modf(value*0.5)
				end	
			elseif value < 0 then
				if NGQH(id,108) and JY.Person[id]['ÉúÃü'] > 1 then
					local a = math.abs(math.modf(value*0.5))
					local b = math.modf(JY.Person[id]["ÉúÃü×î´óÖµ"]*0.7)
					value = value + a
					WAR.PD['Ò×½î»Ö¸´'][id] = limitX((WAR.PD['Ò×½î»Ö¸´'][id] or 0) + a,0,b)
				end
				if WAR.PD['ÎŞÊ¼ÎŞÃ÷'][id] == 1 and JY.Person[id]['ÄÚÁ¦'] < 2000 then
					if match_ID(id,517) then
						value = 0
					else
					    value = math.modf(value/10)
					end
				end
				if WAR.PD['Ñ©ÓğÕ½Éñ'][id] == 1 and psx(id,'ÉúÃü') > 0 then
					value = 0
				end
				if WAR.PD['ÎŞÎÒÖ®¾³'][id] ~= nil and WAR.PD['ÎŞÎÒÖ®¾³'][id] > 0 then
					value = 0
				end
				if WAR.PD['ÑªÕ½µ½µ×'][id] ~= nil and WAR.PD['ÑªÕ½µ½µ×'][id] == 1 then
					local aa = 5 - JY.Person[id]['³©Ïë·Ö½×']
					value = math.modf(value/aa)
				end
				if match_ID(id,501) and (WAR.JBMY[id] or 0) > 15 and WAR.JBMY[id] ~= nil then
					value = 0
				end	
			end	
		end
		if str == 'ÌåÁ¦' then
			if value > 0 then
				if WAR.PD['½ûÁÆ'][id] ~= nil or WAR.PD['Á¦½ß'][id] ~= nil or (WAR.PD['ÖïÏÉ×´Ì¬'][id] ~= nil and JY.Person[id]["ÌåÁ¦"] >= 50) then
					if NGQH(id,203) == false then
						value = 0
					else
					    value = math.modf(value/2)
					end
				end
				if WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
					value = math.modf(value * (-0.2))
				end
				if WAR.PD['ĞşÌú½£´´'][id] ~= nil and WAR.PD['ĞşÌú½£´´'][id] > 0 then
					local sm = 100 - (WAR.PD['ĞşÌú½£´´'][id] or 0)
					if JY.Person[id]['ÌåÁ¦'] + value > sm then
						value = JY.Person[id]['ÌåÁ¦'] - sm
					end
				end
			elseif value < 0 then
				if match_ID(id,9849) then
					if value <= -9 then
						value = -9
					else
						value = -1
					end
				end
				if WAR.PD['Ñ©ÓğÕ½Éñ'][id] == 1 and psx(id,'ÉúÃü') > 0 then
					value = 0
				end
				if match_ID(id,501) and (WAR.JBMY[id] or 0) > 15 and WAR.JBMY[id] ~= nil then
					value = 0
				end
				if WAR.PD['ÎŞÎÒÖ®¾³'][id] ~= nil and WAR.PD['ÎŞÎÒÖ®¾³'][id] > 0 then
					value = 0
				end
				if WAR.PD['ÎŞÊ¼ÎŞÃ÷'][id] == 1 and JY.Person[id]['ÌåÁ¦'] < 20 then
					if match_ID(id,517) then
						value = 0
					else
					    value = math.modf(value/10)
					end
				end
				if WAR.PD['ÑªÕ½µ½µ×'][id] ~= nil and WAR.PD['ÑªÕ½µ½µ×'][id] == 1 then
					local aa = 5 - JY.Person[id]['³©Ïë·Ö½×']
					value = math.modf(value/aa)
				end
				if WAR.PD['ĞéĞ°ÂÒÆÇ2'][id] ~= nil or WAR.PD['Á¦½ß'][id] ~= nil then
					value = math.modf(value*2)
				end
			end	
		end
        --ÖĞ¶¾
		if str == 'ÖĞ¶¾³Ì¶È' then	
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['Áú×¦¶¾'][id] ~= nil then
				attribmax = 300
			end	
			if (id == 0 and JY.Base['±ê×¼'] == 9) or MPTX(id,1) or MPTX(id,8) or WAR.PD['ÖĞ¶¾²»½â'][id] ~= nil then 
				if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['ÄÏ×ÓÔàÑæ'][id] ~= nil then
					value = value * 2
				end	
				value = zdkx(id,value)
				if myzd(id) then
					value = 0
				end	
			end	
		end	
		--ÄÚÉË
		if str == 'ÊÜÉË³Ì¶È' then
			if PersonKF(id,91) then
				attribmax = 50
			end
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.YJZD1[id] ~= nil then
		        attribmax = 300
	        end	
			if (MPTX(id,8) and PersonKF(id,150)) or WAR.PD['ÉËÖØ²»ÖÎ'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['ÄÏ×ÓÔàÑæ'][id] ~= nil then
					value = value * 2
				end
				value = nskx(id,value)
				if myns(id) then
					value = 0
				end	
			end	
		end	
		--×ÆÉÕ
		if str == '×ÆÉÕ³Ì¶È' then
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['·ÙÑ×²»¾¡'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if PersonKF(id,13) and PersonKF(id,196) and WAR.PD['Á¶Ìú¾¢'][id] ~= nil then
					WAR.PD['Á¶Ìú¾¢'][id] = limitX(WAR.PD['Á¶Ìú¾¢'][id] + math.modf(value*0.5),0,3000)
				end	
				if WAR.PD['ÄÏ×ÓÔàÑæ'][id] ~= nil then
					value = value * 2
				end
				value = zskx(id,value)
				if myzs(id) then
					value = 0
				end
			else
				if PersonKF(id,13) and PersonKF(id,196) and WAR.PD['Á¶Ìú¾¢'][id] ~= nil then
					WAR.PD['Á¶Ìú¾¢'][id] = limitX(WAR.PD['Á¶Ìú¾¢'][id] + math.abs(math.modf(value*0.5)),0,3000)
				end
				if match_ID(id,525) then
					value = 0
				end
				if JY.Status == GAME_WMAP and WAR.CHLY == 1 then--²Ğ»ğÁìÓò
					value = 0
				end		
			end
		end
		--±ù·â
		if str == '±ù·â³Ì¶È' then
			--Ñ©Óğ×Ú±ù·âÍ»ÆÆÉÏÏŞ
			if WAR.PD['Ñ©Óğ±ù·â'][id] ~= nil then
				attribmax = 500
			end
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if MPTX(id,20) or WAR.PD['Ğş±ù²»»¯'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['ÄÏ×ÓÔàÑæ'][id] ~= nil then
					value = value * 2
				end
				value = bfkx(id,value)
				if mybf(id) then
					value = 0
				end
				if JY.Status == GAME_WMAP then
					if WAR.PD['Ò×Ë®ËÄº®'][id] == 2 or WAR.PD['Ò×Ë®ËÄº®'][id] == 5 then
						AddPersonAttrib(id,'ÊÜÉË³Ì¶È',value)
						AddPersonAttrib(id,'×ÆÉÕ³Ì¶È',value)
					end	
					if WAR.PD['Ò×Ë®ËÄº®'][id] == 3 or WAR.PD['Ò×Ë®ËÄº®'][id] == 5 then
						AddPersonAttrib(id,'Á÷Ñª³Ì¶È',value)
						local ws = {'²Ğ¾¢Ï®ÆÇ','°ÜÑªÆÆÃü','»ğ¶¾¹¥ĞÄ','º®¶¾ÈëÌå','ÎåÔÌ³ãÊ¢','·âÆø¾øÂö'}
						WAR.PD[ws[math.random(6)]][id] = 1
					end	
					if WAR.PD['Ò×Ë®ËÄº®'][id] == 4 or WAR.PD['Ò×Ë®ËÄº®'][id] == 5 then
						AddPersonAttrib(id,'ÖĞ¶¾³Ì¶È',value)
						AddPersonAttrib(id,'·âÑ¨³Ì¶È',value)
					end	
				end	
			end
			if value < 0 then
				if WAR.PD['ĞşÚ¤Í¸¹Ç'][id] ~= nil or WAR.PD['ĞşÚ¤Í¸¹Ç1'][id] ~= nil then
					value = value*0.5
				end
			end
		end	
		--·âÑ¨
		if str == "·âÑ¨³Ì¶È" then
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['µãÑ¨´óÊ¦1'][id] ~= nil or WAR.PD['µãÑ¨´óÊ¦2'][id] ~= nil then
				attribmax = 70
			end
			if WAR.PD['µãÑ¨´óÊ¦3'][id] ~= nil then
				attribmax = 100
			end	
			if value > 0 then
				if WAR.PD['µãÑ¨´óÊ¦1'][id] ~= nil or WAR.PD['µãÑ¨´óÊ¦2'][id] ~= nil then
					value = math.modf(value * 1.5)
				end
				if WAR.PD['µãÑ¨´óÊ¦3'][id] ~= nil then
					value = value * 2
				end
				if WAR.PD['ÄÏ×ÓÔàÑæ'][id] ~= nil then
					value = value * 2
				end
				value = fxkx(id,value)
				if JY.Status == GAME_WMAP and myfx(id) then
					if MPTX(id,8,3) and Curr_NG(id,104) then
					else
					    value = 0
					end
				end
			end
			if value < 0 then
				if WAR.PD['µãÑ¨´óÊ¦1'][id] ~= nil then
					if math.random(10) > 5 then
						value = 0
					else
						local a = math.abs(value)
						if myns(id) == false then
							a = nskx(id,a)
							JY.Person[id]["ÊÜÉË³Ì¶È"] = limitX(JY.Person[id]["ÊÜÉË³Ì¶È"] + a,0,100)
						end	
					end
				end	
				if WAR.PD['µãÑ¨´óÊ¦2'][id] ~= nil then
					if math.random(10) > 5 then
						value = value*0.5
					else
						value = value*0.75
					end
				end
				if JY.Status == GAME_WMAP and MPTX(id,8,3) and Curr_NG(id,104) then
					value = - value
				end
				if JY.Status == GAME_WMAP and WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
					value = math.modf(value * (-0.2))
				end
			end		
		end
		--Á÷Ñª
		if str == "Á÷Ñª³Ì¶È" then
			if WAR.PD['¼«ÀÖÑªº£'][id] ~= nil then
				attribmax = 300
			end
			if match_ID(id,456) then
			    attribmax = 30
		    end
			if WAR.PD['ÑªÁ÷²»Ö¹'][id] ~= nil then
			    if value < 0 then 
					value = 0
				end
			end
			if JY.Status == GAME_WMAP and WAR.PD["µßµ¹µÄÊÀ½ç"][id] ~= nil and WAR.PD["µßµ¹µÄÊÀ½ç"][id] == 1 and (not match_ID(id,456)) then
				if value < 0 then 
					value = math.modf(value * (-0.2))
				end
			end
			if value > 0 then
				if WAR.PD['ÄÏ×ÓÔàÑæ'][id] ~= nil then
					value = value * 2
				end
				value = lxkx(id,value)
				if mylx(id) then
					value = 0
				end
			end
		end		
	end
	
	local newvalue = limitX(oldvalue + value, 0, attribmax)
    JY.Person[id][str] = newvalue

    local tf = {9960,9959,9958,9957,9956}
    local jc = {"È­ÕÆ¹¦·ò","Ö¸·¨¼¼ÇÉ","Óù½£ÄÜÁ¦","Ë£µ¶¼¼ÇÉ","ÌØÊâ±øÆ÷"}

    if str == 'ÊµÕ½' then 
		if CC.PTF[id][9919] ~= nil then
			attribmax = 9999
		end
        if newvalue >= 500 then
            if id == 0 then
				for j = 1,#tf do 
					if CC.PTF[id][tf[j]] == 1 then 
						if JY.Person[id][jc[j]] >= 300 then 
							--CC.TG[tf[j]] = nil
							SetTF(id,tf[j],nil)
							SetTF(id,tf[j]-5,1)
						end
					end
				end
			else
				if CC.PTF[id] ~= nil then 
					for j = 1,#tf do 
						if CC.PTF[id][tf[j]] == 1 then 
							if JY.Person[id][jc[j]] >= 300 then 
								SetTF(id,tf[j],nil)
								SetTF(id,tf[j]-5,1)
							end
						end
					end
				end
			end	
        end
    end

    for j = 1,#jc do 
        if str == jc[j] then 
            if newvalue >= 300 and JY.Person[id]['ÊµÕ½'] >= 500 then 
                if id == 0 then
					if CC.PTF[id][tf[j]] == 1 then 
						SetTF(id,tf[j],nil)
						SetTF(id,tf[j]-5,1)
					end
				else
					if CC.PTF[id] ~= nil then
						if CC.PTF[id][tf[j]] == 1 then 
							SetTF(id,tf[j],nil)
							SetTF(id,tf[j]-5,1)
						end
					end
				end	
            end
        end
    end

	local add = newvalue - oldvalue
	local showstr = ""
	if add > 0 then
		showstr = string.format("%s Ôö¼Ó %d", str, add)
	elseif add < 0 then
		showstr = string.format("%s ¼õÉÙ %d", str, -add)
	end
	return add, showstr
end

--²¥·Åmidi
function PlayMIDI(id)             --²¥·Åmidi
    JY.CurrentMIDI=id;
    if JY.EnableMusic==0 then
        return ;
    end
    if id>=0 then
        lib.PlayMIDI(string.format(CC.MIDIFile,id+1));
    end
end

--²¥·ÅÒôĞ§atk***
function PlayWavAtk(id)             --²¥·ÅÒôĞ§atk***
    if JY.EnableSound==0 then
        return ;
    end
    if id>=0 then
        lib.PlayWAV(string.format(CC.ATKFile,id));
    end
end

--²¥·ÅÒôĞ§e**
function PlayWavE(id)              --²¥·ÅÒôĞ§e**
    if JY.EnableSound==0 then
        return ;
    end
    if id>=0 then
        lib.PlayWAV(string.format(CC.EFile,id));
    end
end

--flag =0 or nil È«²¿Ë¢ĞÂÆÁÄ»
--1 ¿¼ÂÇÔà¾ØĞÎµÄ¿ìËÙË¢ĞÂ
function ShowScreen(flag)
	if JY.Darkness == 0 then
		if flag == nil then
			flag = 0
		end
		lib.ShowSurface(flag)
	end
end

--Í¨ÓÃ²Ëµ¥º¯Êı
-- menuItem ±í£¬Ã¿Ïî±£´æÒ»¸ö×Ó±í£¬ÄÚÈİÎªÒ»¸ö²Ëµ¥ÏîµÄ¶¨Òå
--          ²Ëµ¥Ïî¶¨ÒåÎª  {   ItemName,     ²Ëµ¥ÏîÃû³Æ×Ö·û´®
--                          ItemFunction, ²Ëµ¥µ÷ÓÃº¯Êı£¬Èç¹ûÃ»ÓĞÔòÎªnil
--                          Visible       ÊÇ·ñ¿É¼û  0 ²»¿É¼û 1 ¿É¼û, 2 ¿É¼û£¬×÷Îªµ±Ç°Ñ¡ÔñÏî¡£Ö»ÄÜÓĞÒ»¸öÎª2£¬
--                                        ¶àÁËÔòÖ»È¡µÚÒ»¸öÎª2µÄ£¬Ã»ÓĞÔòµÚÒ»¸ö²Ëµ¥ÏîÎªµ±Ç°Ñ¡ÔñÏî¡£
--                                        ÔÚÖ»ÏÔÊ¾²¿·Ö²Ëµ¥µÄÇé¿öÏÂ´ËÖµÎŞĞ§¡£
--                                        ´ËÖµÄ¿Ç°Ö»ÓÃÓÚÊÇ·ñ²Ëµ¥È±Ê¡ÏÔÊ¾·ñµÄÇé¿ö
--                       }
--          ²Ëµ¥µ÷ÓÃº¯ÊıËµÃ÷£º         itemfunction(newmenu,id)
--
--       ·µ»ØÖµ
--              0 Õı³£·µ»Ø£¬¼ÌĞø²Ëµ¥Ñ­»· 1 µ÷ÓÃº¯ÊıÒªÇóÍË³ö²Ëµ¥£¬²»½øĞĞ²Ëµ¥Ñ­»·
--
-- numItem      ×Ü²Ëµ¥Ïî¸öÊı
-- numShow      ÏÔÊ¾²Ëµ¥ÏîÄ¿£¬Èç¹û×Ü²Ëµ¥ÏîºÜ¶à£¬Ò»ÆÁÏÔÊ¾²»ÏÂ£¬Ôò¿ÉÒÔ¶¨Òå´ËÖµ
--                =0±íÊ¾ÏÔÊ¾È«²¿²Ëµ¥Ïî

-- (x1,y1),(x2,y2)  ²Ëµ¥ÇøÓòµÄ×óÉÏ½ÇºÍÓÒÏÂ½Ç×ø±ê£¬Èç¹ûx2,y2=0,Ôò¸ù¾İ×Ö·û´®³¤¶ÈºÍÏÔÊ¾²Ëµ¥Ïî×Ô¶¯¼ÆËãx2,y2
-- isBox        ÊÇ·ñ»æÖÆ±ß¿ò£¬0 ²»»æÖÆ£¬1 »æÖÆ¡£Èô»æÖÆ£¬Ôò°´ÕÕ(x1,y1,x2,y2)µÄ¾ØĞÎ»æÖÆ°×É«·½¿ò£¬²¢Ê¹·½¿òÄÚ±³¾°±ä°µ
-- isEsc        Esc¼üÊÇ·ñÆğ×÷ÓÃ 0 ²»Æğ×÷ÓÃ£¬1Æğ×÷ÓÃ
-- Size         ²Ëµ¥Ïî×ÖÌå´óĞ¡
-- color        Õı³£²Ëµ¥ÏîÑÕÉ«£¬¾ùÎªRGB
-- selectColor  Ñ¡ÖĞ²Ëµ¥ÏîÑÕÉ«,
--;
-- ·µ»ØÖµ  0 Esc·µ»Ø
--         >0 Ñ¡ÖĞµÄ²Ëµ¥Ïî(1±íÊ¾µÚÒ»Ïî)
--         <0 Ñ¡ÖĞµÄ²Ëµ¥Ïî£¬µ÷ÓÃº¯ÊıÒªÇóÍË³ö¸¸²Ëµ¥£¬Õâ¸öÓÃÓÚÍË³ö¶à²ã²Ëµ¥

function ShowMenu(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼üÊ±»úÅĞ¶¨
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "×Ô¶¯" then
		In_Battle = true
	end
	--ÎŞ¾Æ²»»¶£ºÕ½Êõ²Ëµ¥ÅĞ¶¨
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "µÈ´ı" then
		In_Tactics = true
	end
	--ÆäËü²Ëµ¥ÅĞ¶¨
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "Ò½ÁÆ" then
		In_Other = true
	end	
	--ĞŞ¸ÄÕ½¶·²Ëµ¥¿í¶ÈÒÔ±ãÏÔÊ¾¿ì½İ¼ü
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
  
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    if isBox == 1 then
	      DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    end
  	end
	for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--¿ì½İ¼üÌáÊ¾ÏÔÊ¾
		if In_Battle == true then
			if newMenu[i][1] == "¹¥»÷" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÔË¹¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "Õ½Êõ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÆäËü" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "ĞîÁ¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "·ÀÓù" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "µÈ´ı" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¼¯ÖĞ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "ĞİÏ¢" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
			if newMenu[i][1] == "ÓÃ¶¾" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "½â¶¾" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
			    elseif newMenu[i][1] == "Ò½ÁÆ" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "ÎïÆ·" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
			    elseif newMenu[i][1] == "×´Ì¬" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
				end
			end
		  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc »ò ÍË³ö
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				start = 1
			end
		--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼ü
		--¹¥»÷
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9Ö±½Ó¹¥»÷
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÔË¹¦
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Õ½Êõ
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÆäËü
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--ÓÃ¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--½â¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Ò½ÁÆ
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÎïÆ·
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--×´Ì¬
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
				returnValue= -9;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞİÏ¢
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÌØÉ«Ö¸Áî
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C²é¿´
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞîÁ¦
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--·ÀÓù
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--µÈ´ı
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¼¯ÖĞ
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--Ñ¡ÖĞ
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--Ñ¡ÖĞÈ·ÈÏ
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÄÚÁ¦²»×ã
					if JY.Person[id]["ÄÚÁ¦"] < 2000 then
						DrawStrBoxWaitKey("ÄÚÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					--ÔË¹¦ÌåÁ¦²»×ã
					elseif JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÌåÁ¦²»×ã
					if JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
			
					--ÎŞ¾Æ²»»¶£ºÖØĞ´Ò»ÏÂÕâÀïµÄ·µ»ØÂß¼­ÒÔÊÊÓ¦ÔË¹¦
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end

--»ù±¾²ÎÊıºÍShowMenuÒ»Ñù£¬ÓĞÒ»Ğ©ÌØ±ğµÄ½øĞĞ×ÅÖØËµÃ÷
--menu Ã¿¸öÊı¾İÈı¸öÖµ£¬1Ãû³Æ£¬2Ö´ĞĞº¯Êı£¬3ÏÔÊ¾·½Ê½(0»ÒÉ«¿ÉÑ¡Ôñ£¬1Õı³£ÏÔÊ¾£¬2²»ÏÔÊ¾, 3»ÒÉ«²»¿ÉÑ¡Ôñ)
--itemNum ²Ëµ¥µÄ¸öÊı£¬Í¨³£ÔÚµ÷ÓÃµÄÊ±ºò #menu¾Í¿ÉÒÔÁË
--numShow Ã¿ĞĞÏÔÊ¾µÄ²Ëµ¥¸öÊı
--showRow Ò»¸ö°æÃæÏÔÊ¾µÄ×î´óĞĞÊı£¬Èç¹û¿ÉÏÔÊ¾²Ëµ¥¸öÊı´ï²»µ½Ò»¸ö°æÃæµÄÊı£¬º¯Êı»á×Ô¶¯ÊÊÓ¦Õâ¸öÖµ
--str ÊÇ±êÌâµÄÎÄ×Ö£¬´«nil²»ÏÔÊ¾
--Ñ¡ÖĞÏî
function ShowMenu2(menu,itemNum,numShow,showRow,x1,y1,x2,y2,isBox,isEsc,size,color,selectColor, str, selIndex)     --Í¨ÓÃ²Ëµ¥º¯Êı
    local w=0;
    local h=0;   --±ß¿òµÄ¿í¸ß
    local i,j=0,0;
    local col=0;     --Êµ¼ÊµÄÏÔÊ¾²Ëµ¥Ïî
    local row=0;
    
    lib.GetKey();
    Cls();
    
    --½¨Ò»¸öĞÂµÄtable
    local menuItem = {};
    local numItem = 0;                --ÏÔÊ¾µÄ×ÜÊı
    
    --°Ñ¿ÉÏÔÊ¾µÄ²¿·Ö·Åµ½ĞÂtable
    for i,v in pairs(menu) do
		if v[3] ~= 2 then
			numItem = numItem + 1;
			menuItem[numItem] = {v[1],v[2],v[3],i};                --×¢ÒâµÚ4¸öÎ»ÖÃ£¬±£´æiµÄÖµ
		end
    end
    
    --¼ÆËãÊµ¼ÊÏÔÊ¾µÄ²Ëµ¥ÏîÊı
    if numShow==0 or numShow > numItem then
        col=numItem;
        row = 1;
    else
        col=numShow;
        row = math.modf((numItem-1)/col);
    end
    
    if showRow > row + 1 then
		showRow = row + 1;
    end

    --¼ÆËã±ß¿òÊµ¼Ê¿í¸ß
    local maxlength=0;
    if x2==0 and y2==0 then
        for i=1,numItem do
            if string.len(menuItem[i][1])>maxlength then
                maxlength=string.len(menuItem[i][1]);
            end
        end
		w=(size*maxlength/2+CC.RowPixel)*col+2*CC.MenuBorderPixel;
		h=showRow*(size+CC.RowPixel) + 2*CC.MenuBorderPixel;
    else
        w=x2-x1;
        h=y2-y1;
    end
    
    if x1 == -1 then
    	x1 = (CC.ScreenW-w)/2;
    end
    if y1 == -1 then
    	y1 = (CC.ScreenH-h+size)/2;
    end

    local start=0;             --ÏÔÊ¾µÄµÚÒ»Ïî

    local curx = 1;          --µ±Ç°Ñ¡ÔñÏî
    local cury = 0;
    local current = curx + cury*numShow;
    
    --Ä¬ÈÏÓĞÑ¡ÖĞ
    if selIndex ~= nil and selIndex > 0 then
    	current = selIndex;
    	curx = math.fmod((selIndex-1),numShow) + 1;
    	cury = (selIndex - curx)/numShow;
    	if cury >= showRow/2 then
			start = limitX(cury-showRow/2,0,row-showRow+1);
		end
    end
    
    local returnValue =0;
    if str ~= nil then
		DrawStrBox(-1, y1 - size - 2*CC.MenuBorderPixel, str, color, size)
    end
    local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	if isBox==1 then
		DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
	end
	while true do
		lib.GetKey()
		if JY.Restart == 1 then
			break
		end
		if col ~= 0 then
			lib.LoadSur(surid, 0, 0)
			if isBox == 1 then
				DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
			end
		end
        for i=start,showRow+start-1 do
			for j=1, col do
				local n = i*col+j;
				if n > numItem then
					break;
				end
				local drawColor=color;           --ÉèÖÃ²»Í¬µÄ»æÖÆÑÕÉ«
				if menuItem[n][3] == 0 or menuItem[n][3] == 3 then
					drawColor = M_DimGray
				end
				local xx = x1+(j-1)*(size*maxlength/2+CC.RowPixel) + CC.MenuBorderPixel
				local yy = y1+(i-start)*(size+CC.RowPixel) + CC.MenuBorderPixel
				if n==current then
					drawColor=selectColor;
					lib.Background(xx, yy, xx + size*maxlength/2, yy + size, 128, color)
				end
				DrawString(xx,yy,menuItem[n][1],drawColor,size);
			end
		end
		ShowScreen();
		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame);

		if keyPress==VK_ESCAPE or ktype == 4 then                  --Esc ÍË³ö
			if isEsc==1 then
				--break;
				do return end
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			if curx + (cury+1)*col <= numItem then
				cury = cury + 1;
				if cury > row then
					cury = row;
				elseif cury >= showRow/2 and cury <= row - showRow/2 + 1 and start <= row-showRow  then
					start = start + 1;
				end
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			cury = cury -1;
			if cury < 0 then
				cury = 0;
			elseif cury >= showRow/2-1 and cury < row - showRow/2 and start > 0 then
				start = start - 1;
			end
		elseif keyPress==VK_RIGHT then                --RIGHT
			curx = curx +1;
			if curx > col then
				curx = 1;
			elseif curx + cury*col > numItem then
				curx = 1;
			end
		elseif keyPress==VK_LEFT then                  --LEFT
			curx = curx -1;
			if curx < 1 then
				curx = col;
				if curx + cury*col > numItem then
					curx = numItem - cury*col;
				end
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--Ñ¡ÖĞ
				--ÎŞ¾Æ²»»¶£º¼Ó¸öÂß¼­ÅĞ¶¨·ÀÖ¹Ìø³ö
				local re1, re2 = curx, cury;
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					curx = math.modf((mx-x1-CC.MenuBorderPixel)/(size*maxlength/2+CC.RowPixel)) + 1
					cury = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
				if (curx + cury*col) > #menuItem then
					curx = re1
					cury = re2
					mk = false;
				end
			end
		
			if keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				current = curx + cury*col;
				if menuItem[current][3]==3 then
                              
				elseif menuItem[current][2]==nil then
					returnValue=current;
					break;
				else
					local r=menuItem[current][2](menuItem,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
					if r==1 then
						returnValue= -current;
						break;
					else
						lib.LoadSur(surid, 0, 0)
						if isBox==1 then
							DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
						end
					end
				end
			end
		end 
		current = curx + cury*col;
    end
	lib.FreeSur(surid)
        
	--·µ»ØÖµ£¬Õâ¸öÊÇÈ¡µÚ4¸öÎ»ÖÃµÄÖµ
	if returnValue > 0 then
		return menuItem[returnValue][4]
	else
		return returnValue
	end
end

function ShowMenu4(menuItem,numItem,rownum,x1,y1,x2,y2,isBox,isEsc,size,color,selectColor,Title1,color2,color3,linenum, flag)
  local w = 0
  local h = 0
  local i = 0
  local newNumItem = 0
  lib.GetKey()
  local newMenu = {}
  for i = 1, numItem do
    if menuItem[i][3] > 0 then
      newNumItem = newNumItem + 1
      newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
    end
  end
  if newNumItem == 0 then
    return 0
  end
  local maxlength = 0
  for i = 1, newNumItem do
	if maxlength < string.len(newMenu[i][1]) then
		maxlength = string.len(newMenu[i][1])
	end
  end
  if linenum == nil then
  	linenum = math.modf((newNumItem-1)/rownum+1)
  end
  if x1 == -2 and y1 == -2 or x2 == -2 and y2 == -2 then
    w = (size * maxlength / 2 + CC.MenuBorderPixel) * rownum + CC.MenuBorderPixel
	if w < size*string.len(Title1 or "")/2 + size + 2 * CC.MenuBorderPixel then
		w = size*string.len(Title1 or "")/2 + size + 2 * CC.MenuBorderPixel
	end
	if Title1 == nil then
		h = (size + CC.MenuBorderPixel*2 + 5) * linenum + CC.MenuBorderPixel
	else
		h = (size + CC.MenuBorderPixel*2 + 5) * (linenum + 1) + CC.MenuBorderPixel + 10
	end
  else
    w = x2 - x1
    h = y2 - y1
  end
  if x1 == -2 and y1 == -2 and x2 == -2 and y2 == -2 then
  	x1 = math.modf(CC.ScreenW/2 - w/2)
	y1 = math.modf(CC.ScreenH/2 - h/2)
  elseif x1 == -2 and y1 == -2 then
	x1 = x2 - w
	y1 = y2 - h
  end
  local xx = x1 + w/rownum/2 - size * maxlength / 4
  local start = 1
  local current = 1
  local keyPress = -1
  local returnValue = 0
  if isBox == 1 then
	DrawBox(x1,y1,x1+w,y1+h,C_WHITE)
  end
  local surid = lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH)
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
	if flag ~= nil then
		Cls(x1,y1,x1+w,y1+h)
	else
		Cls()
	end
	lib.LoadSur(surid, 0, 0)
	if Title1 ~= nil then
		DrawString(-1,y1 + CC.MenuBorderPixel,Title1,selectColor,size)
	end

	local over = limitX(start + rownum * linenum - 1,start,newNumItem)
	local yy = y1 + size + 2 * CC.MenuBorderPixel + 15
	if Title1 == nil then
		yy = y1 + 10
	end
	for i = start, over do
		local colorS = color
		local row = rownum - 1
		if math.fmod(i,rownum) ~= 0 then
			row = math.fmod(i,rownum) - 1
		end
		if i == current then
			colorS = selectColor
			lib.Background(xx+row*w/rownum-3,yy-3,xx+row*w/rownum+maxlength*size/2+3,yy+size+8, 128, color)
		end
		if newMenu[i][3] == 2 and color2 ~= nil then
			colorS = color2
		end
		if newMenu[i][3] == 3 and color3 ~= nil then
			colorS = color3
		end
		DrawString(xx+row*w/rownum,yy,newMenu[i][1],colorS,size)
		if math.fmod(i,rownum) == 0 then
			yy = yy + size + CC.MenuBorderPixel * 2 + 5
		end
	end
	ShowScreen()
	keyPress = WaitKey(1)
	local moda = math.fmod(newNumItem,rownum)
	if moda == 0 then
		moda = rownum
	end
	local modc = math.fmod(current,rownum)
	if modc == 0 then
		modc = rownum
	end
	if isEsc == 1 and keyPress==VK_ESCAPE then                  --Esc ÍË³ö
		break;
	elseif keyPress==VK_DOWN then                --Down
		current = current + rownum
		if current > over and over < newNumItem then
			start = start + rownum
		elseif current > newNumItem then
			start = 1
			current = modc
		end
	elseif keyPress==VK_UP then                  --Up
		current = current - rownum
		if current < start and start > 1 then
			start = start - rownum
		elseif current < 1 then
			start = limitX(newNumItem-(linenum-1)*rownum-moda+1,1,newNumItem)
			if moda >= modc then
				current = newNumItem + modc - moda
			else
				current = newNumItem - moda - rownum + modc
			end
		end
	elseif keyPress == VK_RIGHT then
		current = current + 1
		if current > over and over < newNumItem then
			start = start + rownum
		elseif current > newNumItem then
			start = 1
			current = 1
		end
	elseif keyPress == VK_LEFT then
		current = current - 1
		if current < start and start > 1 then
			start = start - rownum
		elseif current < 1 then
			start = limitX(newNumItem-(linenum-1)*rownum-moda+1,1,newNumItem)
			current = newNumItem
		end
	elseif  keyPress==VK_SPACE or keyPress==VK_RETURN  then
		if newMenu[current][2]== nil and newMenu[current][3] == 1 then
			returnValue=newMenu[current][4];
			break;
		elseif newMenu[current][3] == 1 then
			local r=newMenu[current][2](newMenu,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
			if r==1 then
				returnValue= -newMenu[current][4];
				break;
			else
				Cls(x1,y1,x1+w,y1+h);
				if isBox==1 then
					DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
				end
			end
		end
	--[[	
	elseif keyPress==888 and start>1 then
		start=start-rownum
	elseif keyPress==999 and start<newNumItem-(linenum-1)*rownum-moda+1 then
		start=start+rownum
	elseif keyPress>999999 then
		local kind, mx, my = nil, nil, nil
		if keyPress>1999999 then
			kind=1
			keyPress=keyPress-2000000
		else
			kind=0
			keyPress=keyPress-1000000
		end
		mx=math.modf(keyPress/1000)
		my=math.fmod(keyPress,1000)

		if mx>x1 and mx<x1+w and my>y1 and my<y1+h then
			if Title1 == nil and Title2 == nil then
				current = start-1+math.modf((mx-xx)/(w/rownum)+1) + rownum*math.modf((my-y1-10)/(size+CC.MenuBorderPixel*2+5))
			else
				current = start-1+math.modf((mx-xx)/(w/rownum)+1) + rownum*math.modf((my-y1-size-2*CC.MenuBorderPixel-15)/(size+CC.MenuBorderPixel*2+5))
			end
			current = limitX(current,1,newNumItem)
			if kind==1 then
				if newMenu[current][2]==nil and newMenu[current][3] == 1 then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][3] == 1 then
					local r=newMenu[current][2](newMenu,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					else
						Cls(x1,y1,x1+w,y1+h);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				end
			end
		end
	end]]
	end
  end
  lib.FreeSur(surid)
  return returnValue
end
------------------------------------------------------------------------------------
--------------------------------------ÎïÆ·Ê¹ÓÃ---------------------------------------
--ÎïÆ·Ê¹ÓÃÄ£¿é
--µ±Ç°ÎïÆ·id
--·µ»Ø1 Ê¹ÓÃÁËÎïÆ·£¬ 0 Ã»ÓĞÊ¹ÓÃÎïÆ·¡£¿ÉÄÜÊÇÄ³Ğ©Ô­Òò²»ÄÜÊ¹ÓÃ
function UseThing(id)
	return DefaultUseThing(id);
end

--È±Ê¡ÎïÆ·Ê¹ÓÃº¯Êı£¬ÊµÏÖÔ­Ê¼ÓÎÏ·Ğ§¹û
--id ÎïÆ·id
function DefaultUseThing(id)                --È±Ê¡ÎïÆ·Ê¹ÓÃº¯Êı
    if JY.Thing[id]["ÀàĞÍ"]==0 then
        return UseThing_Type0(id);
    elseif JY.Thing[id]["ÀàĞÍ"]==1 then
        return UseThing_Type1(id);
    elseif JY.Thing[id]["ÀàĞÍ"]==2 then
        return UseThing_Type2(id);
    elseif JY.Thing[id]["ÀàĞÍ"]==3 then
        return UseThing_Type3(id);
    elseif JY.Thing[id]["ÀàĞÍ"]==4 then
        return UseThing_Type4(id);
    end
end

--¾çÇéÎïÆ·£¬´¥·¢ÊÂ¼ş
function UseThing_Type0(id)
    if id == 286 then
		local jyzj = 0
		for j=1, CC.MyThingNum do
			if JY.Base["ÎïÆ·" .. j] == 287 then
				jyzj = 1;
				break;
			end
		end
		if jyzj == 1 then
			say('ÌıÎÅ¾ÅÒõÕæ¾­µÄ×Ü¸Ù¾ÍÔÚºóÃæÄÇ¶ÎèóÎÄ£¬ÎÒÏÈÀ´¶Á¿´¿´',0,1)
			say('ºÃÄÑ¶®...¶øÇÒÔõÃ´Í»È»Í·ºÃ»è...',0,1)
			My_Enter_SubScene(70, 35, 31, 2)
			if WarMain(436) == false then
				Cls()
				instruct_15()
				Cls()
				do return end
			end
			light()
			say('ÎÒ¸Õ¸Õ...ÊÇË¯ÖøÁË£¿',0,1)
			instruct_2(286,-1)
			instruct_2(287,-1)
			instruct_2(84,1)
			Cls()  --ÇåÆÁ
		end
		return 0;
	end
		
	if id == 287 then
		local jyzj = 0
		for j=1, CC.MyThingNum do
			if JY.Base["ÎïÆ·" .. j] == 286 then
				jyzj = 1;
				break;
			end
		end
		if jyzj == 1 then
			say('ÌıÎÅ¾ÅÒõÕæ¾­µÄ×Ü¸Ù¾ÍÔÚºóÃæÄÇ¶ÎèóÎÄ£¬ÎÒÏÈÀ´¶Á¿´¿´',0,1)
			say('ºÃÄÑ¶®...¶øÇÒÔõÃ´Í»È»Í·ºÃ»è...',0,1)
			My_Enter_SubScene(70, 35, 31, 2)
			if WarMain(436) == false then
				Cls()
				instruct_15()
				Cls()
				do return end
			end
			light()
			say('ÎÒ¸Õ¸Õ...ÊÇË¯ÖøÁË£¿',0,1)
			instruct_2(286,-1)
			instruct_2(287,-1)
			instruct_2(84,1)
			Cls()  --ÇåÆÁ
		end
		return 0;
	end
	

	
    if JY.SubScene>=0 then
		local x=JY.Base["ÈËX1"]+CC.DirectX[JY.Base["ÈË·½Ïò"]+1];
		local y=JY.Base["ÈËY1"]+CC.DirectY[JY.Base["ÈË·½Ïò"]+1];
        local d_num=GetS(JY.SubScene,x,y,3)
        if d_num>=0 then
            JY.CurrentThing=id;
            EventExecute(d_num,2);       --ÎïÆ·´¥·¢ÊÂ¼ş
            JY.CurrentThing=-1;
			return 1;
		else
		    return 0;
        end
    end
	--ºÏµØÁéµ¤ÊÂ¼ş
	if id == 315 then
		local dld = 0
		for j=1, CC.MyThingNum do
			if JY.Base["ÎïÆ·" .. j] == 314 and JY.Base["ÎïÆ·" .. j] == 231 and JY.Base["ÎïÆ·" .. j] == 	26 then
				dld = 1;
				break;
			end
		end
		if dld == 1 then
			instruct_2(314,-1)
			instruct_2(231,-1)
			instruct_2(26,-1)			
			instruct_2(316,1)
		end
		return 0;
	end	

end


--ÅĞ¶ÏÒ»¸öÈËÊÇ·ñ¿ÉÒÔ×°±¸»òĞŞÁ¶Ò»¸öÎïÆ·
--·µ»Ø true¿ÉÒÔĞŞÁ¶£¬false²»¿É
function CanUseThing(id, personid)
	local str = ""
		
	--ÕÅ¼Ò»ÔµÄ×¨Êô×°±¸
	if JY.Thing[id]["½öĞŞÁ¶ÈËÎï"] == 651 then
		if personid == 0 and JY.Base["³©Ïë"] == 651 then
			return true
		else
			return false
		end
	end

    --if ZhongYongZD(personid) and (id == 118 or id == 235) then 
        --return true
   -- end
		--·ğÃÅÎŞË«
	if match_ID(personid, 9993) and (id == 72 or id == 69 or id == 83 or id == 85 or id == 88 or id == 90 or  id == 92 or id == 112 or id ==137 
      or id == 168 or id == 171 or id  == 245 or id ==250 or id == 253 or id == 260 or id == 265 or id == 268 or id == 269 or id == 274 
     or id == 277 or  id == 291 or id == 319 or id == 324 or id == 332)  then
		return true
	--ÍõÓïæÌ£¬Ëæ±ãĞŞÁ¶ÃØ¼®
	elseif (match_ID(personid, 76) or match_ID(personid, 637) or match_ID(personid, 774) or match_ID(personid, 9723)) and JY.Thing[id]["ÀàĞÍ"] == 2 then
		return true	
	--Ö÷½ÇÑ§Ê¥»ğ
	elseif id == 70 and personid == 0 then
		return true		
	--°¢Öì´©×°±¸
	elseif match_ID(personid, 104) and JY.Thing[id]["×°±¸ÀàĞÍ"] >= 0 then
		return true
	--°×Ô³×°±¸°×Ô³
	elseif match_ID(personid, 9997) and id == 326 then
		return true	
    --ÎŞÁÄ×°±¸Ğå»¨Õë
    elseif (match_ID(personid, 721) and id == 349) or (match_ID(personid, 27) and JY.Base["³©Ïë"]==52) then
        Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
		if DrawStrBoxYesNo(-1, -1, "×°±¸´ËÎïÆ·ĞèÒª×Ô¹¬£¬ÊÇ·ñ¼ÌĞø×°±¸?", C_WHITE, CC.DefaultFont) == false  then
			return 0
		else
			lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_RED, 128)
			ShowScreen()
			lib.Delay(80)
			lib.ShowSlow(15, 1)
			Cls()
			lib.ShowSlow(50, 0)
			JY.Person[personid]["ĞÔ±ğ"] = 2
			JY.Person[personid]["°ëÉíÏñ"] = 721
			JY.Person[personid]["Í·Ïñ´úºÅ"]=322
			JY.Person[personid]["³öÕĞ¶¯»­Ö¡Êı2"]=16
			JY.Person[personid]["³öÕĞ¶¯»­ÑÓ³Ù2"]=14
			JY.Person[personid]["Îä¹¦ÒôĞ§ÑÓ³Ù2"]=14
			local add, str = AddPersonAttrib(personid, "¹¥»÷Á¦", -20)
			DrawStrBoxWaitKey(JY.Person[personid]["ĞÕÃû"] .. str, C_ORANGE, CC.DefaultFont)
			add, str = AddPersonAttrib(personid, "·ÀÓùÁ¦", -30)
			DrawStrBoxWaitKey(JY.Person[personid]["ĞÕÃû"] .. str, C_ORANGE, CC.DefaultFont)
			return true
		end
	--·½Ö¤Ñ§½ğ¸Õ²»»µÌå
	elseif match_ID(personid, 149) and id == 265 then
		return true
	--ÌìÄ§½ÌÑ§ÌìÄ§²ß
	elseif MPTX(personid, 31) and id == 327 then
		return true	
	else
		if JY.Thing[id]["½öĞŞÁ¶ÈËÎï"] >= 0 and JY.Thing[id]["½öĞŞÁ¶ÈËÎï"] ~= personid and (personid == 0 and JY.Thing[id]["½öĞŞÁ¶ÈËÎï"]==JY.Base["³©Ïë"])==false then
			return false
		end
		if JY.Thing[id]["ĞèÄÚÁ¦ĞÔÖÊ"] ~= 2 and JY.Person[personid]["ÄÚÁ¦ĞÔÖÊ"] ~= 2 and JY.Person[personid]["ÄÚÁ¦ĞÔÖÊ"] ~= 3 and JY.Thing[id]["ĞèÄÚÁ¦ĞÔÖÊ"] ~= JY.Person[personid]["ÄÚÁ¦ĞÔÖÊ"] then
			local cond = 1
			--ÌìÍâ¿ÉÒÔÎŞÊÓÒõÑôÑ§Ï°
			--[[for i = 1, 4 do
				if JY.Thing[id]["Á·³öÎä¹¦"] == JY.Person[personid]["Ìì¸³Íâ¹¦"..i] then
					cond = 2
					break
				end
			end
			--ÌìÄÚ¿ÉÒÔÎŞÊÓÒõÑôÑ§Ï° ²©Í¨°Ù¼Ò ´óÌÆË«ÁúÖ®±ù
			if JY.Thing[id]["Á·³öÎä¹¦"] == JY.Person[personid]["Ìì¸³ÄÚ¹¦"]  or match_ID(personid, 578)or match_ID(personid, 9987)
               or match_ID(personid,9978) then
				cond = 2--]]
			--ÌìÄÚ¿ÉÒÔÎŞÊÓÒõÑôÑ§Ï° ²©Í¨°Ù¼Ò ´óÌÆË«ÁúÖ®±ù
			if match_ID(personid, 514) or match_ID(personid, 9987) or match_ID(personid,9978) or match_ID(personid, 9740) then
				cond = 2
			--Ö÷½ÇÑ§½µÁúÎŞÊÓÄÚÁ¦
			elseif (match_ID(personid, 578) and yongdao(JY.Thing[id]['Á·³öÎä¹¦'])) or  (match_ID(personid, 505) and yongquan(JY.Thing[id]['Á·³öÎä¹¦'])) then
				cond = 2
			elseif id == 86 and personid == 0 then
				cond = 2
			end
			if cond == 1 then
				return false
			end
		end
		if JY.Person[personid]["ÄÚÁ¦×î´óÖµ"] < JY.Thing[id]["ĞèÄÚÁ¦"] then
			return false
		end
		if JY.Person[personid]["¹¥»÷Á¦"] < JY.Thing[id]["Ğè¹¥»÷Á¦"] then
			return false
		end
		if JY.Person[personid]["Çá¹¦"] < JY.Thing[id]["ĞèÇá¹¦"] then
			return false
		end
		if JY.Person[personid]["ÓÃ¶¾ÄÜÁ¦"] < JY.Thing[id]["ĞèÓÃ¶¾ÄÜÁ¦"] then
			return false
		end
		if JY.Person[personid]["Ò½ÁÆÄÜÁ¦"] < JY.Thing[id]["ĞèÒ½ÁÆÄÜÁ¦"] then
			return false
		end
		--if JY.Person[personid]["½â¶¾ÄÜÁ¦"] < JY.Thing[id]["Ğè½â¶¾ÄÜÁ¦"] then
			--return false
		--end

		--Ñ§ÓĞĞ¡ÎŞÏà¹¦£¬±øÆ÷ÖµÊÓ×÷+10µã
		local lv = 0;
		if PersonKF(personid, 98) then
			lv = 10
		end
		--²©Í¨°Ù¼Ò
		if match_ID(personid, 9987)  then
		 lv = lv + 20
		end
		--ÓĞºúµ¶£¬Ñ§Ãç½££¬ĞèÇó-40
		if id == 117 and PersonKF(personid, 67) then
			lv = lv + 40
		end
		--ÓĞÃç½££¬Ñ§ºúµ¶£¬ĞèÇó-40
		if id == 136 and PersonKF(personid, 44) then
			lv = lv + 40
		end
		
		--ÌÒ»¨¾ø¼¼£¬Ñ§Ï°ÆäÖĞÖ®Ò»ºó£¬Ê£ÏÂÁ½¸öµÄĞèÇó¼õÉÙ-10£¬¿Éµş¼Ó
		if id == 95 or id == 101 or id == 123 then
			for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
				if JY.Person[personid]["Îä¹¦" .. i] == 12 or JY.Person[personid]["Îä¹¦" .. i] == 18 or JY.Person[personid]["Îä¹¦" .. i] == 38 then
					lv = lv + 10
				end
			end
		end
		--Ì«¼«°ÂÒå£¬Ñ§Ï°ÆäÖĞÖ®Ò»ºó£¬Ê£ÏÂĞèÇó¼õÉÙ-10
		if id == 97 or id == 115  then
			for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
				if JY.Person[personid]["Îä¹¦" .. i] == 46 or JY.Person[personid]["Îä¹¦" .. i] == 16  then
					lv = lv + 10
				end
			end
		end		
		--½ğ¸Õ°ãÈô-40
		if id == 291 or id == 90 or id == 324  then
			for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
				if JY.Person[personid]["Îä¹¦" .. i] == 46 or JY.Person[personid]["Îä¹¦" .. i] == 16  then
					lv = lv + 10
				end
			end
		end			
		--ÓĞ´ò¹·£¬Ñ§½µÁú-40
		if id == 86 and PersonKF(personid, 80) then
			if PersonKF(personid,204) then
			  lv = lv + 60
			  else
				lv = lv + 40
			end
		end	
		--ÓĞ½µÁú£¬Ñ§´ò¹·-40
		if id == 167 and PersonKF(personid, 26) then
			if PersonKF(personid,204) then
			  lv = lv + 60
			  else
				lv = lv + 40
			end
		end	
		--ÓĞÔÀ¼ÒÇ¹£¬Ñ§ÔÀ¼ÒÉ¢ÊÖ-40
		if id == 337 and PersonKF(personid, 200) then
			lv = lv + 40
		end
		--ÓĞÔÀ¼ÒÉ¢ÊÖ£¬Ñ§ÔÀ¼ÒÇ¹-40
		if id == 386 and PersonKF(personid, 198) then
			lv = lv + 40
		end
		--ÓĞÁéÉßÈ­£¬Ñ§ÁéÉßÕÈ·¨ĞèÇó-40
		--ÓĞ¾Å½££¬Ñ§³ÖÑşÇÙ-40
		if id == 180 and PersonKF(personid, 47) then
			lv = lv + 40
		end
		--ÓĞ³ÖÑşÇÙ£¬Ñ§¾Å½£-40
		if id == 114 and PersonKF(personid, 73) then
			lv = lv + 40
		end
		
		if JY.Person[personid]["È­ÕÆ¹¦·ò"] + lv < JY.Thing[id]["ĞèÈ­ÕÆ¹¦·ò"] then
			return false
		end
		if JY.Person[personid]["Ö¸·¨¼¼ÇÉ"] + lv < JY.Thing[id]["ĞèÖ¸·¨¼¼ÇÉ"] then
			return false
		end
		if JY.Person[personid]["Óù½£ÄÜÁ¦"] + lv < JY.Thing[id]["ĞèÓù½£ÄÜÁ¦"] then
			return false
		end
		if JY.Person[personid]["Ë£µ¶¼¼ÇÉ"] + lv < JY.Thing[id]["ĞèË£µ¶¼¼ÇÉ"] then
			return false
		end
		if JY.Person[personid]["ÌØÊâ±øÆ÷"] + lv < JY.Thing[id]["ĞèÌØÊâ±øÆ÷"] then
			return false
		end
		
		if JY.Person[personid]["°µÆ÷¼¼ÇÉ"] < JY.Thing[id]["Ğè°µÆ÷¼¼ÇÉ"] then
			return false
		end
    
        if id == 372 then  --ÖĞÓ¹
            if JY.Person[personid]["×ÊÖÊ"] < 31 or JY.Person[personid]["×ÊÖÊ"] > 79 then 
                return false
            end
        end
		
		
        if id == 327 then --ÌìÄ§¹¦
            if JY.Person[personid]["×ÊÖÊ"] < 31 or JY.Person[personid]["×ÊÖÊ"] > 79 then 
                if personid == 0 and JY.Base['±ê×¼'] == 11 then
					say('¹ş£¬´Ë¹¦¼«ºÏÎáÖ®ÌìĞÔ£¬¶ÔÌì×ÊËùÉèÏÂµÄĞ¡Ğ¡ÃÔÕÏ¶ÔÎá¶øÑÔ²»¹ı¶ùÏ·£¡',0,1)
					return true
				end	
				return false
            end
        end
		
		if id == 81 then
			if (JY.Person[personid]['ÉúÃüÔö³¤'] + JY.Person[personid]['ÃÅÅÉ¼¼ÄÜ5']) < 10 then
				return false
			end
		end		

 	
		if JY.Thing[id]["Ğè×ÊÖÊ"] >= 0 then
			if JY.Thing[id]["Ğè×ÊÖÊ"] > JY.Person[personid]["×ÊÖÊ"] then
				return false;
			end
		else
			if -JY.Thing[id]["Ğè×ÊÖÊ"] < JY.Person[personid]["×ÊÖÊ"] then
				return false;
			end 
		end
        
	end
	  
	--¶·×ªÏŞÖÆ
	if id == 118 then
		local R = JY.Person[personid]
		local wp = R["È­ÕÆ¹¦·ò"] + R["Ö¸·¨¼¼ÇÉ"] + R["Óù½£ÄÜÁ¦"] + R["Ë£µ¶¼¼ÇÉ"] + R["ÌØÊâ±øÆ÷"] +JY.Base["ÖÜÄ¿"]
		if wp < 120 then
			return false
		end
	end
	--ÒõÑôÏŞÖÆ
	if id == 176 then
		local R = JY.Person[personid]
		if R["Óù½£ÄÜÁ¦"]+JY.Base["ÖÜÄ¿"] >= 50 then
			return true
		elseif R["Ë£µ¶¼¼ÇÉ"]+JY.Base["ÖÜÄ¿"] >= 50 then
			return true
		elseif R["ÌØÊâ±øÆ÷"]+JY.Base["ÖÜÄ¿"] >= 50 then
			return true
		else
			return false
		end
	end
    --Ğå»¨Õë
	if id == 349 then
		--local R = JY.Person[personid]
		if match_ID(personid, 27) then
			return true
		else 
			return false
		end
	end
    --Ô§Ñìµ¶
	if id == 217  then
		local R = JY.Person[personid]
		if R["ĞÔ±ğ"]== 0 then
			return true
		else return false
		end
	end	
    	--Ô§Ñìµ¶
	if id == 218  then
		local R = JY.Person[personid]
		if R["ĞÔ±ğ"]== 1 then
			return true
		else return false
		end
	end		
	--½ğË¿ÊÖÌ×ÏŞÖÆ
	if id == 239 then
		local R = JY.Person[personid]
		if R["È­ÕÆ¹¦·ò"]+JY.Base["ÖÜÄ¿"] >= 50 then
			return true
		elseif R["Ö¸·¨¼¼ÇÉ"]+JY.Base["ÖÜÄ¿"] >= 50 then
			return true
		else
			return false
		end
	end
	--Æß±¦Ö¸»·ÏŞÖÆ
	if id == 200 then
		local R = JY.Person[personid]
		if R["È­ÕÆ¹¦·ò"]+JY.Base["ÖÜÄ¿"] >= 50 then
			return true
		elseif R["Ö¸·¨¼¼ÇÉ"]+JY.Base["ÖÜÄ¿"] >= 50 then
			return true
		else
			return false
		end
	end	
	return true
end

--Ò©Æ·Ê¹ÓÃÊµ¼ÊĞ§¹û
--id ÎïÆ·id£¬
--personid Ê¹ÓÃÈËid
--·µ»ØÖµ£º0 Ê¹ÓÃÃ»ÓĞĞ§¹û£¬ÎïÆ·ÊıÁ¿Ó¦¸Ã²»±ä¡£1 Ê¹ÓÃÓĞĞ§¹û£¬ÔòÊ¹ÓÃºóÎïÆ·ÊıÁ¿Ó¦¸Ã-1
function UseThingEffect(id, personid, amount)
	--ÎŞÊ¹ÓÃÊıÁ¿ÔòÄ¬ÈÏÎªÊ¹ÓÃ1¸ö
	if amount == nil then
		amount = 1
	end

	--ÌØÊâÒ©Æ·
	if id == 343 then
		Cls()  --ÇåÆÁ
		local k = JY.Wugong;
		local menu = {}
	
		local kftype = JYMsgBox("ÇëÑ¡Ôñ", "ÇëÑ¡ÔñÏ²»¶µÄÌì¸³ÄÚ¹¦ÀàĞÍ", {"ÄÚ¹¦",}, 1, 347)
	
		for i = 1, JY.WugongNum - 1 do
			local kfname = k[i]["Ãû³Æ"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			menu[i] = {kfname,nil,2}
			if k[i]["Îä¹¦ÀàĞÍ"] == 6 then
				menu[i][3] = 1
			end
		end
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"ÁìÎòÌì¸³ÄÚ¹¦")
	
		if r > 0 then
			SetTianNei(personid, r)
		end
			return 2
	elseif id == 344 then
		Cls()  --ÇåÆÁ
		local k = JY.Wugong;
		local menu = {}
	
		local kftype = JYMsgBox("ÇëÑ¡Ôñ", "ÇëÑ¡ÔñÏ²»¶µÄÌì¸³Çá¹¦ÀàĞÍ", {"Çá¹¦",}, 1, 347)
	
		for i = 1, JY.WugongNum - 1 do
			local kfname = k[i]["Ãû³Æ"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			menu[i] = {kfname,nil,2}
			if k[i]["Îä¹¦ÀàĞÍ"] == 7 then
				menu[i][3] = 1
			end
		end
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"ÁìÎòÌì¸³Çá¹¦")
	
		if r > 0 then
			SetTianQing(personid, r)
		end
		return 2
	elseif id == 345 then
		Cls()  --ÇåÆÁ
		local k = JY.Wugong;
		local menu = {}
		local kftype = JYMsgBox("ÇëÑ¡Ôñ", "ÇëÑ¡ÔñÏ²»¶µÄÌì¸³Íâ¹¦ÀàĞÍ", {"È­·¨","Ö¸·¨","½£·¨","µ¶·¨","ÆæÃÅ"}, 5, 347)
	
		for i = 1, JY.WugongNum - 1 do
			local kfname = k[i]["Ãû³Æ"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			menu[i] = {kfname,nil,2}
			if k[i]["Îä¹¦ÀàĞÍ"] == kftype then
				menu[i][3] = 1
			end
		end
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"ÁìÎòÌì¸³Íâ¹¦")
	
		if r > 0 then
			local R = JYMsgBox("ÇëÑ¡Ôñ", "Çë½÷É÷Ñ¡ÔñÁìÎòµÄÌì¸³Íâ¹¦Î»ÖÃ¡£", {"Ìì¸³Íâ¹¦Ò»","Ìì¸³Íâ¹¦¶ş"}, 2, 596)
			if R == 1 then
				SetTianWai(personid, 1, r)
			else	
				SetTianWai(personid, 2, r)
			end
		end
		return 2
	elseif id == 346 then
		Cls()  --ÇåÆÁ
		JY.Person[0]["Í·Ïñ´úºÅ"]=JY.Person[642]["Í·Ïñ´úºÅ"]
		JY.Person[0]["°ëÉíÏñ"]=JY.Person[642]["°ëÉíÏñ"]
		JY.Person[0]["ĞÕÃû"]=JY.Person[642]["ĞÕÃû"]
		for i=1,5 do
			JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i]=JY.Person[642]["³öÕĞ¶¯»­Ö¡Êı" .. i]
			JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i]=JY.Person[642]["³öÕĞ¶¯»­ÑÓ³Ù" .. i]
			JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i]=JY.Person[642]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i]
		end
		return 2
	elseif id == 348 then
		Cls()  --ÇåÆÁ
		local nexty = CC.MainSubMenuY + CC.SingleLineHeight
        local p = SelectTeamMenu(CC.MainSubMenuX, nexty)
        if p > 0 then
            local pid = JY.Base["¶ÓÎé" .. p]
            local menu = {}
            for i = 1, CC.Kungfunum do
                if JY.Person[pid]["Îä¹¦"..i] > 0 then
                    local wg = JY.Person[pid]["Îä¹¦"..i]
                    menu[#menu+1] = {JY.Wugong[wg]["Ãû³Æ"], nil, 1, wg, i}
                end
            end        
            Cls()
            local r = ShowMenu2(menu, #menu, 3,10, CC.MainSubMenuX, CC.MainSubMenuY, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
			local jjj = 1
			if match_ID(pid,56) or match_ID(pid,77) then
				jjj = 2
			end 
            if r > 0 then
                local thingid = -1
                for i = 0, JY.ThingNum - 1 do
                    if JY.Thing[i]["Á·³öÎä¹¦"] > 0 and JY.Thing[i]["Á·³öÎä¹¦"] == menu[r][4] then
                        thingid = i
                        local level = math.modf(JY.Person[pid]["Îä¹¦µÈ¼¶" .. menu[r][5]] / 100) + 1
                        AddPersonAttrib(pid, "ÉúÃü×î´óÖµ", -JY.Thing[thingid]["¼ÓÉúÃü×î´óÖµ"] * level)
                        AddPersonAttrib(pid, "ÄÚÁ¦×î´óÖµ", -JY.Thing[thingid]["¼ÓÄÚÁ¦×î´óÖµ"] * level)
                        AddPersonAttrib(pid, "¹¥»÷Á¦", -JY.Thing[thingid]["¼Ó¹¥»÷Á¦"] * level)
                        AddPersonAttrib(pid, "Çá¹¦", -JY.Thing[thingid]["¼ÓÇá¹¦"] * level)
                        AddPersonAttrib(pid, "·ÀÓùÁ¦", -JY.Thing[thingid]["¼Ó·ÀÓùÁ¦"] * level)        
                        AddPersonAttrib(pid, "Ò½ÁÆÄÜÁ¦", -JY.Thing[thingid]["¼ÓÒ½ÁÆÄÜÁ¦"] * jjj * level)
                        AddPersonAttrib(pid, "ÓÃ¶¾ÄÜÁ¦", -JY.Thing[thingid]["¼ÓÓÃ¶¾ÄÜÁ¦"] * jjj * level)
                        --AddPersonAttrib(pid, "½â¶¾ÄÜÁ¦", -JY.Thing[thingid]["¼Ó½â¶¾ÄÜÁ¦"] * jjj * level)
                        AddPersonAttrib(pid, "¿¹¶¾ÄÜÁ¦", -JY.Thing[thingid]["¼Ó¿¹¶¾ÄÜÁ¦"] * jjj * level)
                        AddPersonAttrib(pid, "È­ÕÆ¹¦·ò", -JY.Thing[thingid]["¼ÓÈ­ÕÆ¹¦·ò"] * jjj * level)
						AddPersonAttrib(pid, "Ö¸·¨¼¼ÇÉ", -JY.Thing[thingid]["¼ÓÖ¸·¨¼¼ÇÉ"] * jjj * level)
                        AddPersonAttrib(pid, "Óù½£ÄÜÁ¦", -JY.Thing[thingid]["¼ÓÓù½£ÄÜÁ¦"] * jjj * level)
                        AddPersonAttrib(pid, "Ë£µ¶¼¼ÇÉ", -JY.Thing[thingid]["¼ÓË£µ¶¼¼ÇÉ"] * jjj * level)
                        AddPersonAttrib(pid, "ÌØÊâ±øÆ÷", -JY.Thing[thingid]["¼ÓÌØÊâ±øÆ÷"] * jjj * level)
						AddPersonAttrib(pid, "°µÆ÷¼¼ÇÉ", -JY.Thing[thingid]["¼Ó°µÆ÷¼¼ÇÉ"] * jjj * level)
                        AddPersonAttrib(pid, "ÎäÑ§³£Ê¶", -JY.Thing[thingid]["¼ÓÎäÑ§³£Ê¶"] * jjj * level)     										
                        break
                    end
                end
                for i = menu[r][5], #menu - 1 do
                    JY.Person[pid]["Îä¹¦"..i] = JY.Person[pid]["Îä¹¦"..i+1]
                    JY.Person[pid]["Îä¹¦µÈ¼¶"..i] = JY.Person[pid]["Îä¹¦µÈ¼¶"..i+1]
                end
                JY.Person[pid]["Îä¹¦"..#menu] = 0
                JY.Person[pid]["Îä¹¦µÈ¼¶"..#menu] = 0
                QZXS(JY.Person[pid]["ĞÕÃû"].."ÒÑ¾­ÒÅÍü"..menu[r][1])
            end
        end
		return 2
	else
		local str = {}
		str[0] = string.format("Ê¹ÓÃ %s ¡Á %d", JY.Thing[id]["Ãû³Æ"], amount)
		local strnum = 1
		local addvalue = nil
		if JY.Thing[id]["¼ÓÉúÃü"] > 0 then
			local add = JY.Thing[id]["¼ÓÉúÃü"] - math.modf(JY.Thing[id]["¼ÓÉúÃü"] * JY.Person[personid]["ÊÜÉË³Ì¶È"] / 200) + Rnd(5)
			--ºúÇàÅ£ÔÚ¶Ó£¬³ÔÒ©Ğ§¹ûÎª2±¶
			if JY.Status == GAME_WMAP and inteam(personid) and (inteam(16) or JY.Base["³©Ïë"] == 16) then
				for w = 0, WAR.PersonNum - 1 do
					if match_ID(WAR.Person[w]["ÈËÎï±àºÅ"], 16) and WAR.Person[w]["ËÀÍö"] == false and WAR.Person[w]["ÎÒ·½"] then
						add = math.modf(add * 2)
						break;
					end
				end
			end
			if add <= 0 then
				add = 5 + Rnd(5)
			end
			add = math.modf(add)
			
			--ºé°²Í¨£¬µĞÈË³ÔÒ©²»¼ÓÑª·´¶ø¼õÑª
			if JY.Status == GAME_WMAP then
				for w = 0, WAR.PersonNum - 1 do
					if (match_ID(WAR.Person[w]["ÈËÎï±àºÅ"], 71) or match_ID(WAR.Person[w]["ÈËÎï±àºÅ"], 9846)) and WAR.Person[w]["ËÀÍö"] == false and WAR.Person[w]["ÎÒ·½"] ~= WAR.Person[WAR.CurID]["ÎÒ·½"] then
						add = -add
						break;
					end
				end
			end
			--Ø¤°ï³ÔÒ©
			if MPPD(personid) == 2 and Curr_QG(personid,2) then
			    add = add * 2;
		    end	
			--ÃîÊÖÈÊĞÄ			
			if match_ID(personid,9943) then
				add = add * JY.Base["ÄÑ¶È"];
			end
			--µĞÈË³ÔÒ©Ğ§¹ûËæÄÑ¶ÈÌáÉı
			if not inteam(personid) then
				add = add * JY.Base["ÄÑ¶È"];
				if JY.Person[456]["ÂÛ½£½±Àø"] == 1 then
					add = add + JY.Base["ÖÜÄ¿"]*JY.Base["ÄÑ¶È"]*10
				end
			end
			--ÊµÕ½ºó³ÔÒ©Ğ§¹û¼Ó±¶
			if inteam(personid) then
				add = add + JY.Base["ÖÜÄ¿"]*5
				if JY.Person[0]["ÊµÕ½"] >= 800 then
					add = add * JY.Base["ÄÑ¶È"];
				end
			end	
			if JY.Status == GAME_WMAP then
				WAR.Person[WAR.CurID]["ÄÚÉËµãÊı"] = AddPersonAttrib(personid, "ÊÜÉË³Ì¶È", -math.modf(add/8))
			end

			addvalue, str[strnum] = AddPersonAttrib(personid, "ÉúÃü", add)
			
			--À¶ÑÌÇå£ºÏÔÊ¾ÉúÃüµãÊı
			if JY.Status == GAME_WMAP then
				WAR.Person[WAR.CurID]["ÉúÃüµãÊı"] = addvalue;
			end
			if addvalue ~= 0 then
				strnum = strnum + 1
			end
		end
		
		if id==15 then
			War_DAPANTAO(personid,amount)
		end
	  
		if id==16 then
			War_DARENSHEN(personid,amount)
		end
		
		if id==17 then
			JY.Person[personid]["ÊµÕ½"]=JY.Person[personid]["ÊµÕ½"]+amount*10
		    if JY.Person[personid]["ÊµÕ½"] > 1000 and CC.PTF[personid][9919] == nil then
			JY.Person[personid]["ÊµÕ½"] = 1000
			elseif CC.PTF[personid][9919] ~= nil then
				JY.Person[personid]["ÊµÕ½"] = JY.Person[personid]["ÊµÕ½"]
				if JY.Person[personid]["ÊµÕ½"] > 9999 then
					JY.Person[personid]["ÊµÕ½"] = 9999
				end
			end
			--[[if JY.Person[personid]["ÊµÕ½"] > 1000 then
			    if MPPD(personid) == 23 and MPDJ(personid) >= 3 and PersonKF(personid,199) then
					JY.Person[personid]["ÊµÕ½"]=800
				else
				    JY.Person[personid]["ÊµÕ½"]=500
				end
				JY.Person[personid]["ÊµÕ½"]=1000
			end]]
		end
	  
		local function ThingAddAttrib(s)
			if JY.Thing[id]["¼Ó" .. s] ~= 0 then	
				addvalue, str[strnum] = AddPersonAttrib(personid, s, JY.Thing[id]["¼Ó" .. s]*amount)
				
				if addvalue ~= 0 then
				strnum = strnum + 1
				end
				--À¶ÑÌÇå£ºÏÔÊ¾ÌåÁ¦£¬ÄÚÁ¦µãÊı
				if JY.Status == GAME_WMAP then
					if s == "ÌåÁ¦" then
						WAR.Person[WAR.CurID]["ÌåÁ¦µãÊı"] = addvalue;
					elseif s == "ÄÚÁ¦" then
						WAR.Person[WAR.CurID]["ÄÚÁ¦µãÊı"] = addvalue;
					end
				end
			end

		end
		
		ThingAddAttrib("ÉúÃü×î´óÖµ")
	  
		if JY.Thing[id]["¼ÓÖĞ¶¾½â¶¾"] < 0 then
			addvalue, str[strnum] = AddPersonAttrib(personid, "ÖĞ¶¾³Ì¶È", math.modf(JY.Thing[id]["¼ÓÖĞ¶¾½â¶¾"] / 2)*amount)
			if addvalue ~= 0 then
				strnum = strnum + 1
			end
			--À¶ÑÌÇå£ºÏÔÊ¾ÖĞ½â¶¾µãÊı
			if JY.Status == GAME_WMAP then
				if addvalue < 0 then
					WAR.Person[WAR.CurID]["½â¶¾µãÊı"] = -addvalue;
				elseif addvalue > 0 then
					WAR.Person[WAR.CurID]["ÖĞ¶¾µãÊı"] = addvalue;
				end
			end
		end
		  
		ThingAddAttrib("ÌåÁ¦")
	  
		if JY.Thing[id]["¸Ä±äÄÚÁ¦ĞÔÖÊ"] == 2 then
			str[strnum] = "ÄÚÁ¦ÃÅÂ·¸ÄÎªÒõÑôºÏÒ»"
			strnum = strnum + 1
		end
		---
        if JY.Status == GAME_WMAP then 
            if id == 25 then 
                JY.Person[personid]['ÊÜÉË³Ì¶È'] = 0
                JY.Person[personid]['ÖĞ¶¾³Ì¶È'] = 0
                JY.Person[personid]['×ÆÉÕ³Ì¶È'] = 0
                JY.Person[personid]['±ù·â³Ì¶È'] = 0
                WAR.FXDS[personid] = nil
				WAR.LXZT[personid] = nil
				WAR.PD['Îå±¦»¨ÃÛ¾Æ'][personid] = 100               
            end
            if id == 24 then
                if WAR.LXZT[personid] ~= nil then 
                    WAR.LXZT[personid] = WAR.LXZT[personid] - 50
                    if WAR.LXZT[personid] < 1 then 
                        WAR.LXZT[personid] = nil
                    end
                end
                WAR.PD['¼´Ä«ÀÏ¾Æ'][personid] = 100
            end
            
            if id == 23 then 
                AddPersonAttrib(personid,'×ÆÉÕ³Ì¶È',-20)
                WAR.PD['ÓñÂ¶¾Æ'][personid] = 50
            end    
            
            if id == 22 then 
                AddPersonAttrib(personid,'±ù·â³Ì¶È',-50)
                WAR.PD['Àæ»¨¾Æ'][personid] = 50
            end
            
            if id == 11 then 
                WAR.PD['ÁùÑôÕıÆø'][personid] = 100
            end
            
            if id == 10 then 
                WAR.PD['Å£»ÆÑªĞ«'][personid] = 50
            end
            
            if id == 9 then 
                WAR.PD['»ÆÁ¬½â¶¾'][personid] = 50
            end
            
            if id == 3 then 
                WAR.PD['°×ÔÆĞÜµ¨'][personid] = 200
            end
            
            if id == 1 then 
                WAR.PD['ÌìÏãĞøÃü'][personid] = 100
            end
            
            if id == 0 then 
                WAR.PD['Ğ¡»¹µ¤'][personid] = 50
            end
        else    
            if id == 25 then 
                JY.Person[personid]['ÊÜÉË³Ì¶È'] = 0
                JY.Person[personid]['ÖĞ¶¾³Ì¶È'] = 0
                JY.Person[personid]['×ÆÉÕ³Ì¶È'] = 0
				JY.Person[personid]['±ù·â³Ì¶È'] = 0				
            end
        end
        
	    if JY.Person[id]["ÉúÃüÔö³¤"] > 12 then
            JY.Person[id]["ÉúÃüÔö³¤"] = 12 	   
	    end	
		ThingAddAttrib("ÄÚÁ¦")
		ThingAddAttrib("ÄÚÁ¦×î´óÖµ")
		ThingAddAttrib("¹¥»÷Á¦")
		ThingAddAttrib("·ÀÓùÁ¦")
		ThingAddAttrib("Çá¹¦")
		ThingAddAttrib("Ò½ÁÆÄÜÁ¦")
		ThingAddAttrib("ÓÃ¶¾ÄÜÁ¦")
		--ThingAddAttrib("½â¶¾ÄÜÁ¦")
		ThingAddAttrib("¿¹¶¾ÄÜÁ¦")
		ThingAddAttrib("È­ÕÆ¹¦·ò")
		ThingAddAttrib("Óù½£ÄÜÁ¦")
		ThingAddAttrib("Ë£µ¶¼¼ÇÉ")
		ThingAddAttrib("ÌØÊâ±øÆ÷")
		ThingAddAttrib("°µÆ÷¼¼ÇÉ")
		ThingAddAttrib("ÎäÑ§³£Ê¶")
		ThingAddAttrib("¹¥»÷´ø¶¾")
		
		
		Cls()
		
		if strnum > 1 then
			local maxlength = 0
			for i = 0, strnum-1 do
				if maxlength < #str[i] then
					maxlength = #str[i]
				end
			end
			
			if JY.Status ~= GAME_WMAP then
				local ww = maxlength * CC.DefaultFont / 2 + CC.MenuBorderPixel * 2
				local hh = (strnum) * CC.DefaultFont + (strnum - 1) * CC.RowPixel + 2 * CC.MenuBorderPixel
				local x = (CC.ScreenW - ww) / 2
				local y = (CC.ScreenH - hh) / 2
				DrawBox(x, y, x + ww, y + hh, C_WHITE)
				DrawString(x + CC.MenuBorderPixel, y + CC.MenuBorderPixel, str[0], C_WHITE, CC.DefaultFont)
				for i = 1, strnum - 1 do
				  DrawString(x + CC.MenuBorderPixel, y + CC.MenuBorderPixel + (CC.DefaultFont + CC.RowPixel) * i, str[i], C_ORANGE, CC.DefaultFont)
				end

				ShowScreen()
			else
				--ÏÔÊ¾Ê¹ÓÃÎïÆ·ÎÄ×Ö
				DrawString(CC.MainMenuX, CC.ScreenH-(strnum+2)*CC.Fontsmall, JY.Person[WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]]["ĞÕÃû"].." "..str[0], C_WHITE, CC.Fontsmall);
				for i=1, strnum-1 do 
					DrawString(CC.MainMenuX, CC.ScreenH + (i-strnum-2)*CC.Fontsmall, str[i], C_WHITE, CC.Fontsmall);
				end
				
				ShowScreen()
				--ÏÔÊ¾µãÊı
				War_Show_Count(WAR.CurID);
				return 1;
			end
			return 1
		else
			DrawStrBox(-1, -1, str[0], C_WHITE, CC.DefaultFont)
			ShowScreen()
			return 1
		end
	end
end

--×°±¸ÎïÆ·
function UseThing_Type1(id)
	DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, string.format("Ë­ÒªÅä±¸%s?", JY.Thing[id]["Ãû³Æ"]), C_WHITE, CC.DefaultFont)
	local nexty = CC.MainSubMenuY + CC.SingleLineHeight
	local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
	local pp1, pp2 = 0, 0
	if r > 0 then
		local personid = JY.Base["¶ÓÎé" .. r]
		--Ìï¹éÅ©×°´³Íõ¾üµ¶
		if id == 202 and match_ID(personid, 72) then
			say("ºÙºÙ£¬Õâ¿Ú±¦µ¶±¾À´¾ÍÊÇÌïÕÆÃÅµÄ±øÆ÷£¬Ë­ËµË£µ¶²»¹»¾Í×°²»ÁË£¿",72,0)
			if JY.Thing[id]["Ê¹ÓÃÈË"] >= 0 then
								
				JY.Person[JY.Thing[id]["Ê¹ÓÃÈË"]]["ÎäÆ÷"] = -1
			end
			if JY.Person[personid]["ÎäÆ÷"] >= 0 then
				JY.Thing[JY.Person[personid]["ÎäÆ÷"]]["Ê¹ÓÃÈË"] = -1
			end
			JY.Person[personid]["ÎäÆ÷"] = id
			JY.Thing[id]["Ê¹ÓÃÈË"] = personid
			return 1
		end
		
		if CanUseThing(id, personid) then
			if Setmeal[id] ~= nil then
				--local a,b,c = id,id+1,id+2
				if JY.Thing[id]["×°±¸ÀàĞÍ"] == 0 then
					local a,b,c = id,id+1,id+2
					if JY.Thing[a]["Ê¹ÓÃÈË"] >= 0 then
						JY.Person[JY.Thing[a]["Ê¹ÓÃÈË"]]["ÎäÆ÷"] = -1
					end
					if JY.Person[personid]["ÎäÆ÷"] >= 0 then
						JY.Thing[JY.Person[personid]["ÎäÆ÷"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["ÎäÆ÷"] = a
					JY.Thing[a]["Ê¹ÓÃÈË"] = personid
					if JY.Thing[b]["Ê¹ÓÃÈË"] >= 0 then
						JY.Person[JY.Thing[b]["Ê¹ÓÃÈË"]]["·À¾ß"] = -1
					end
					if JY.Person[personid]["·À¾ß"] >= 0 then
						JY.Thing[JY.Person[personid]["·À¾ß"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["·À¾ß"] = b
					JY.Thing[b]["Ê¹ÓÃÈË"] = personid
					if JY.Thing[c]["Ê¹ÓÃÈË"] >= 0 then
						
						JY.Person[JY.Thing[c]["Ê¹ÓÃÈË"]]["×øÆï"] = -1
					end
					if JY.Person[personid]["×øÆï"] >= 0 then
						JY.Thing[JY.Person[personid]["×øÆï"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["×øÆï"] = c
					JY.Thing[c]["Ê¹ÓÃÈË"] = personid
				elseif JY.Thing[id]["×°±¸ÀàĞÍ"] == 1 then
					local a,b,c = id-1,id,id+1
					if JY.Thing[a]["Ê¹ÓÃÈË"] >= 0 then
						JY.Person[JY.Thing[a]["Ê¹ÓÃÈË"]]["ÎäÆ÷"] = -1
					end
					if JY.Person[personid]["ÎäÆ÷"] >= 0 then
						JY.Thing[JY.Person[personid]["ÎäÆ÷"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["ÎäÆ÷"] = a
					JY.Thing[a]["Ê¹ÓÃÈË"] = personid
					if JY.Thing[b]["Ê¹ÓÃÈË"] >= 0 then
						JY.Person[JY.Thing[b]["Ê¹ÓÃÈË"]]["·À¾ß"] = -1
					end
					if JY.Person[personid]["·À¾ß"] >= 0 then
						JY.Thing[JY.Person[personid]["·À¾ß"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["·À¾ß"] = b
					JY.Thing[b]["Ê¹ÓÃÈË"] = personid
					if JY.Thing[c]["Ê¹ÓÃÈË"] >= 0 then
						
						JY.Person[JY.Thing[c]["Ê¹ÓÃÈË"]]["×øÆï"] = -1
					end
					if JY.Person[personid]["×øÆï"] >= 0 then
						JY.Thing[JY.Person[personid]["×øÆï"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["×øÆï"] = c
					JY.Thing[c]["Ê¹ÓÃÈË"] = personid
				elseif JY.Thing[id]["×°±¸ÀàĞÍ"] == 2 then
					local a,b,c = id-2,id-1,id
					if JY.Thing[a]["Ê¹ÓÃÈË"] >= 0 then
						JY.Person[JY.Thing[a]["Ê¹ÓÃÈË"]]["ÎäÆ÷"] = -1
					end
					if JY.Person[personid]["ÎäÆ÷"] >= 0 then
						JY.Thing[JY.Person[personid]["ÎäÆ÷"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["ÎäÆ÷"] = a
					JY.Thing[a]["Ê¹ÓÃÈË"] = personid
					if JY.Thing[b]["Ê¹ÓÃÈË"] >= 0 then
						JY.Person[JY.Thing[b]["Ê¹ÓÃÈË"]]["·À¾ß"] = -1
					end
					if JY.Person[personid]["·À¾ß"] >= 0 then
						JY.Thing[JY.Person[personid]["·À¾ß"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["·À¾ß"] = b
					JY.Thing[b]["Ê¹ÓÃÈË"] = personid
					if JY.Thing[c]["Ê¹ÓÃÈË"] >= 0 then
						
						JY.Person[JY.Thing[c]["Ê¹ÓÃÈË"]]["×øÆï"] = -1
					end
					if JY.Person[personid]["×øÆï"] >= 0 then
						JY.Thing[JY.Person[personid]["×øÆï"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["×øÆï"] = c
					JY.Thing[c]["Ê¹ÓÃÈË"] = personid
				end	
			else
				if JY.Thing[id]["×°±¸ÀàĞÍ"] == 0 then
					if JY.Thing[id]["Ê¹ÓÃÈË"] >= 0 then
						JY.Person[JY.Thing[id]["Ê¹ÓÃÈË"]]["ÎäÆ÷"] = -1
					end
					if JY.Person[personid]["ÎäÆ÷"] >= 0 then
						JY.Thing[JY.Person[personid]["ÎäÆ÷"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["ÎäÆ÷"] = id
				
				elseif JY.Thing[id]["×°±¸ÀàĞÍ"] == 1 then
					if JY.Thing[id]["Ê¹ÓÃÈË"] >= 0 then
						
						JY.Person[JY.Thing[id]["Ê¹ÓÃÈË"]]["·À¾ß"] = -1
					end
					if JY.Person[personid]["·À¾ß"] >= 0 then
						JY.Thing[JY.Person[personid]["·À¾ß"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["·À¾ß"] = id
				elseif JY.Thing[id]["×°±¸ÀàĞÍ"] == 2 then
					if JY.Thing[id]["Ê¹ÓÃÈË"] >= 0 then
						
						JY.Person[JY.Thing[id]["Ê¹ÓÃÈË"]]["×øÆï"] = -1
					end
					if JY.Person[personid]["×øÆï"] >= 0 then
						JY.Thing[JY.Person[personid]["×øÆï"]]["Ê¹ÓÃÈË"] = -1
					end
					JY.Person[personid]["×øÆï"] = id				
				end
				JY.Thing[id]["Ê¹ÓÃÈË"] = personid
			end	
		else
			DrawStrBoxWaitKey("´ËÈË²»ÊÊºÏÅä±¸´ËÎïÆ·", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	return 1
end
--ÃØ¼®ÎïÆ·Ê¹ÓÃ
function UseThing_Type2(id)
	if JY.Thing[id]["Ê¹ÓÃÈË"] >= 0 and DrawStrBoxYesNo(-1, -1, "´ËÎïÆ·ÒÑ¾­ÓĞÈËĞŞÁ¶£¬ÊÇ·ñ»»ÈËĞŞÁ¶?", C_WHITE, CC.DefaultFont) == false then
		Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
		ShowScreen()
		return 0
	end
	Cls()
	DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, string.format("Ë­ÒªĞŞÁ¶%s?", JY.Thing[id]["Ãû³Æ"]), C_WHITE, CC.DefaultFont)
	local nexty = CC.MainSubMenuY + CC.SingleLineHeight
	local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
	if r > 0 then
		local personid = JY.Base["¶ÓÎé" .. r]
		local yes, full = nil, nil
		if JY.Thing[id]["Á·³öÎä¹¦"] >= 0 then
			yes = 0
			full = 1
			for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
				if JY.Person[personid]["Îä¹¦" .. i] == JY.Thing[id]["Á·³öÎä¹¦"] then
					yes = 1
				else
					if JY.Person[personid]["Îä¹¦" .. i] == 0 then
						full = 0
					end
				end
			end
		end
		
        if CanUseThing(id, personid) then
			--ÉÙÁÖ¡¢Îäµ±¡¢¶ëÃ¼¾ÅÑô¹¦Ò»ÂöÏà³Ğ¾ÅÑô£¬
			local jy = 0
			--[[if id == 83 then
				local n = {
                            {241,"Îäµ±¾ÅÑô¹¦"},
							{242,"¶ëÃ¼¾ÅÑô¹¦"},
							{243,"ÉÙÁÖ¾ÅÑô¹¦"}
						  }
				local k;
				local d;
				for i = 1,JY.Base["Îä¹¦ÊıÁ¿"] do
					for j = 1,#n do
						if JY.Person[personid]["Îä¹¦"..i] == n[j][1] then
							k = n[j][1]
							d = n[j][2]
							jy = 1
							break
						end						
					end
					if jy == 1 then
						break
					end
				end
                if PersonKF(personid,k) and PersonKF(personid, 106) == false then
                    if DrawStrBoxYesNo(-1, -1, "¾ÅÑôÉñ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«"..d.."Ï´Îª¾ÅÑôÉñ¹¦?", C_WHITE, CC.DefaultFont) then
                        for x = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. x] == k then
                                JY.Person[personid]["Îä¹¦" .. x] = 106
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. x] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == k then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 106
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
			end	--]]
			--×ÏÏ¼Ò»ÂöÏà³ĞÎåÔÀ£¬Ãæ°åÓĞ×ÏÏ¼µÄ¿ÉÒÔÎŞÌõ¼şÑ§ÎåÔÀ½£¾÷
            if id == 299 then
				if WYXF(personid) then
					if PersonKF(personid, 175) == false and MPPD(personid) == 14 then
						if DrawStrBoxYesNo(-1, -1, "ÎåÔÀ½£¾÷Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ÎåÔÀĞÄ·¨Ï´ÎªÎåÔÀ½£¾÷?", C_WHITE, CC.DefaultFont) then
							AddPersonAttrib(personid,"Óù½£ÄÜÁ¦",250)
							if MPDJ(personid) < 6 then
								JoinMP(personid,14,6)
							end	
							for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
								if JY.Person[personid]["Îä¹¦" .. i] == 89 then
									JY.Person[personid]["Îä¹¦" .. i] = 175
									JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
									if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 89 or JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 216 or JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 259 or JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 263 or JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 264 then
										JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 175
									end
									yes = 2
									--break
								end
							end
							local a = 0
							for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
								local wg = JY.Person[personid]["Îä¹¦"..j]
								if wg == 264 then--Ï´æÔÀ
									a = j
								end				
							end	
							for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
								JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
								JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
							end
							local a = 0
							for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
								local wg = JY.Person[personid]["Îä¹¦"..j]
								if wg == 263 then--Ï´ÅÍÊ¯
									a = j
								end				
							end	
							for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
								JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
								JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
							end
							local a = 0
							for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
								local wg = JY.Person[personid]["Îä¹¦"..j]
								if wg == 259 then--Ï´¹Åá
									a = j
								end				
							end	
							for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
								JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
								JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
							end
							local a = 0
							for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
								local wg = JY.Person[personid]["Îä¹¦"..j]
								if wg == 216 then--Ï´º®±ù
									a = j
								end				
							end	
							for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
								JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
								JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
							end
							JY.Person[personid]["Îä¹¦" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
							JY.Person[personid]["Îä¹¦µÈ¼¶" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
						end
						if PersonKF(personid, 30) or PersonKF(personid, 31) or PersonKF(personid, 32) or PersonKF(personid, 33) or PersonKF(personid, 34)  then
							if PersonKF(personid,377) == false then
								if DrawStrBoxYesNo(-1, -1, "ÎåÔÀ½£·¨Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ÎåÔÀ½£·¨Ï´ÎªÎåÔÀÉñ½£?", C_WHITE, CC.DefaultFont) then
									for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
										if JY.Person[personid]["Îä¹¦" .. i] >= 30 and JY.Person[personid]["Îä¹¦" .. i] <= 34 then
											JY.Person[personid]["Îä¹¦" .. i] = 377
											JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 999
											
											if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 34 or JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 33 or JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 32 or JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 31 or JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 30 then
												JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 377
											end
											yes = 2
											break
										end
									end
									local a = 0
									for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
										local wg = JY.Person[personid]["Îä¹¦"..j]
										if wg == 34 then--Ï´Ì«ÔÂ
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
											JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
											JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
										end
									end	
									local a = 0
									for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
										local wg = JY.Person[personid]["Îä¹¦"..j]
										if wg == 33 then--Ï´æÔÀ
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
											JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
											JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
										end
									end
									local a = 0
									for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
										local wg = JY.Person[personid]["Îä¹¦"..j]
										if wg == 32 then--Ï´ÅÍÊ¯
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
											JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
											JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
										end
									end
									local a = 0
									for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
										local wg = JY.Person[personid]["Îä¹¦"..j]
										if wg == 30 then--Ï´¹Åá
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
											JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
											JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
										end
									end
									local a = 0
									for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
										local wg = JY.Person[personid]["Îä¹¦"..j]
										if wg == 31 then--Ï´º®±ù
											a = j
										end				
									end	
									if a > 0 then
										for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
											JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
											JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
										end
									end
									JY.Person[personid]["Îä¹¦" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
									JY.Person[personid]["Îä¹¦µÈ¼¶" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
								end	
							else
								local a = 0
								for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
									local wg = JY.Person[personid]["Îä¹¦"..j]
									if wg == 34 then--Ï´æÔÀ
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
										JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
										JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
									local wg = JY.Person[personid]["Îä¹¦"..j]
									if wg == 33 then--Ï´æÔÀ
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
										JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
										JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
									local wg = JY.Person[personid]["Îä¹¦"..j]
									if wg == 32 then--Ï´ÅÍÊ¯
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
										JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
										JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
									local wg = JY.Person[personid]["Îä¹¦"..j]
									if wg == 30 then--Ï´¹Åá
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
										JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
										JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
									end
								end
								local a = 0
								for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
									local wg = JY.Person[personid]["Îä¹¦"..j]
									if wg == 31 then--Ï´º®±ù
										a = j
									end				
								end	
								if a > 0 then
									for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
										JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
										JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
									end
								end
								JY.Person[personid]["Îä¹¦" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
								JY.Person[personid]["Îä¹¦µÈ¼¶" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
							end
						end	
					end	
				else
					if PersonKF(personid, 89) and PersonKF(personid, 175) == false  then
						if DrawStrBoxYesNo(-1, -1, "ÎåÔÀ½£¾÷Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦×ÏÏ¼Éñ¹¦Ï´ÎªÎåÔÀ½£¾÷?", C_WHITE, CC.DefaultFont) then
							for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
								if JY.Person[personid]["Îä¹¦" .. i] == 89 then
									JY.Person[personid]["Îä¹¦" .. i] = 175
									JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
									if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 89 then
										JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 175
									end
									yes = 2
									break
								end
							end
						end
					end
				end	
            end
			--ÉÙÁÖ¾ÅÑôÒ»ÂöÏà³Ğ
            if id == 83 then
            	Cat('Ò»Âö»úÖÆ',personid,243,106)
            end
			--Îäµ±´¿ÑôÒ»ÂöÏà³Ğ
            if id == 76 then
                Cat('Ò»Âö»úÖÆ',personid,241,99)
            end
			--¶ëÃ¼ÁÙ¼ÃÒ»ÂöÏà³ĞÁÙ¼Ã
            if id == 403 then
                Cat('Ò»Âö»úÖÆ',personid,242,247)
            end
            
			--ÑªºÓÌìÄ§¹¦Ò»ÂöÏà³Ğ
            if id == 327 then
                Cat('Ò»Âö»úÖÆ',personid,163,160)
            end
			--Ğ¡ÖÜÌì¹¦´óÖÜÌì¹¦Ò»ÂöÏà³Ğ
            if id == 328 then
                Cat('Ò»Âö»úÖÆ',personid,225,190)
            end
			--Ğ¡ĞÇÂŞ¹¦ ÎüĞÇ´ó·¨Ò»ÂöÏà³Ğ
            if id == 65 then
                Cat('Ò»Âö»úÖÆ',personid,219,88)
            end
            --Ò»×Öµç½£ÖÜ¹«½£·¨Ò»ÂöÏà³Ğ
            if id == 428 then
                Cat('Ò»Âö»úÖÆ',personid,321,271)
            end
			--°ÙÊ¤Ò»ÂöÌìµ¶
			if JY.Thing[id]["Á·³öÎä¹¦"] == 335 then
				Cat('Ò»Âö»úÖÆ',personid,141,335)
            end
			--Ê¨×Óºğ½ğ¸ÕÊ¨×ÓºğÒ»ÂöÏà³Ğ
            if id == 385 then
                Cat('Ò»Âö»úÖÆ',personid,92,91)
            end	
			--Ò»Ö¸ìøÒ»ÂöÄé»¨
			if JY.Thing[id]["Á·³öÎä¹¦"] == 137 then
				Cat('Ò»Âö»úÖÆ',personid,128,137)
            end
			--È¥·³ÄÕÒ»Âö´óÖÇÎŞ¶¨
			if JY.Thing[id]["Á·³öÎä¹¦"] == 133 then
				Cat('Ò»Âö»úÖÆ',personid,124,133)
            end
			--ÌìóÃ·ğÖ¸ÎŞÏà½ÙÖ¸Ò»ÂöÏà³Ğ
            if id == 269 then
                Cat('Ò»Âö»úÖÆ',personid,122,136)
            end	
            --ÂŞººÈ­Ï´Î¤ÍÓÕÆ
            if id == 515 then
            	Cat('Ò»Âö»úÖÆ',personid,1,347)
            end
            --Î¤ÍÓÕÆÏ´½ğ¸ÕÕÆ
            if id == 90 then
            	Cat('Ò»Âö»úÖÆ',personid,347,22)
            end
            --°¢ÄÑÆÆ½äÏ´½µÄ§µ¶
            if 	id == 518 then
            	Cat('Ò»Âö»úÖÆ',personid,350,267)
            end
            --´È±¯µ¶Ï´È¼Ä¾µ¶
            if id == 137 then
            	Cat('Ò»Âö»úÖÆ',personid,57,65)
            end			
			--ĞäÖĞÖ¸Ï´²ÎºÏÖ¸
			if JY.Thing[id]["Á·³öÎä¹¦"] == 138 then
				if PersonKF(personid,125) and PersonKF(personid,138) == false then
					if DrawStrBoxYesNo(-1, -1, "Ä½ÈİÖ¸·¨Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦ĞäÖĞÖ¸Ï´Îª²ÎºÏÖ¸·¨?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 125 then
                                JY.Person[personid]["Îä¹¦" .. i] = 138
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
								if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 125 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 138
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 125 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 138
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--ºÚ·çÖ¸Ï´»ÃÒõÖ¸
			if JY.Thing[id]["Á·³öÎä¹¦"] == 19 then
				if PersonKF(personid,131) and PersonKF(personid,19) == false then
					if DrawStrBoxYesNo(-1, -1, "Òõº®Ö¸·¨Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦ºÚ·çÖ¸·¨Ï´Îª»ÃÒõÖ¸·¨?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 131 then
                                JY.Person[personid]["Îä¹¦" .. i] = 19
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
								if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 131 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 19
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 131 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 19
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--ÌúÖ¸Ï´Ò»ÑôÖ¸
			if JY.Thing[id]["Á·³öÎä¹¦"] == 17 then
				if PersonKF(personid,121) and PersonKF(personid,17) == false then
					if DrawStrBoxYesNo(-1, -1, "´óÀíÖ¸·¨Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦ÌúÖ¸¾÷Ï´ÎªÒ»ÑôÖ¸·¨?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 121 then
                                JY.Person[personid]["Îä¹¦" .. i] = 17
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
								if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 121 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 17
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 121 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 17
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--Ñî¼ÒÇ¹ÔÀ¼ÒÇ¹·¨Ò»ÂöÏà³Ğ
            if id == 386 then
                if PersonKF(personid, 68) and PersonKF(personid, 200) == false then
                    if DrawStrBoxYesNo(-1, -1, "×íÎÔÉ³³¡Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦Ñî¼ÒÇ¹·¨Ï´ÎªÔÀ¼ÒÇ¹·¨?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 68 then
                                JY.Person[personid]["Îä¹¦" .. i] = 200
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
								if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 68 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 200
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 68 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 200
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end		
			--Ñî¼ÒÇ¹ ¿ñ·çÑ¸À×ÉÈ Ò»ÂöÏà³Ğ
            if id == 498 then
                if PersonKF(personid, 68) and PersonKF(personid, 341) == false then
                    if DrawStrBoxYesNo(-1, -1, "×íÎÔÉ³³¡Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦Ñî¼ÒÇ¹·¨Ï´Îª¿ñ·çÑ¸À×¹¦?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 68 then
                                JY.Person[personid]["Îä¹¦" .. i] = 341
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
								if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 68 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 341
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 68 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 341
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--¶áÆÇÖ¸ ¾ÅÒõ°×¹Ç×¦ Ò»ÂöÏà³Ğ
			if id == 102 then
                if PersonKF(personid, 123) and PersonKF(personid, 11) == false then
                    if DrawStrBoxYesNo(-1, -1, "Ö¸·¨Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦¶áÆÇÖ¸Ï´Îª¾ÅÒõ°×¹Ç×¦?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 123 then
                                JY.Person[personid]["Îä¹¦" .. i] = 11
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
								if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 123 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 11
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 123 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 11
                                end	
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
            --¸òó¡¹¦¾¨Ï¢¹¦Ò»ÂöÏà³Ğ
            if id == 308 then
                if PersonKF(personid, 95) and PersonKF(personid, 180) == false then
                    if DrawStrBoxYesNo(-1, -1, "ÍòÎïÓĞÁéÒ»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦¸òó¡¹¦Ï´Îª¾¨Ï¢¹¦?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 95 then
                                JY.Person[personid]["Îä¹¦" .. i] = 180
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 95 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 180
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
            --ÉñÕÕ³¤ÉúÒ»ÂöÏà³Ğ
            if id == 342 then
                if PersonKF(personid, 94) and PersonKF(personid, 203) == false then
                    if DrawStrBoxYesNo(-1, -1, "ÌìÕÕ³¤ÉúÒ»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦ÉñÕÕ¹¦Ï´Îª³¤Éú¾÷?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 94 then
                                JY.Person[personid]["Îä¹¦" .. i] = 203
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 94 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 203
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
            --ÓñÅ®½£·¨ ÓñÅ®ËØĞÄ½£ Ò»ÂöÏà³Ğ
            if id == 350 then
                if PersonKF(personid, 42) and PersonKF(personid,39) and PersonKF(personid, 139) == false then
                    if DrawStrBoxYesNo(-1, -1, "Ë«½£ºÏèµÈÚ»á¹áÍ¨£¬ÊÇ·ñ½«Îä¹¦È«Õæ½£·¨¡¢ÓñÅ®½£·¨Ï´ÎªÓñÅ®ËØĞÄ½£·¨?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 42 then
                                JY.Person[personid]["Îä¹¦" .. i] = 139
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                local a = 0
								for j = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
									local wg = JY.Person[personid]["Îä¹¦"..j]
									if wg == 39 then--Ï´æÔÀ
										a = j
									end				
								end	
								for i = a, JY.Base["Îä¹¦ÊıÁ¿"] - 1 do
									JY.Person[personid]["Îä¹¦" .. i] = JY.Person[personid]["Îä¹¦" .. i+1]
									JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = JY.Person[personid]["Îä¹¦µÈ¼¶" .. i+1]
								end
								JY.Person[personid]["Îä¹¦" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
								JY.Person[personid]["Îä¹¦µÈ¼¶" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
								if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 42 or JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 39 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 139
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 42 or JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 39 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 139
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--²ñµ¶Ê®°ËÂ· âÒ¶¡½âÅ£µ¶ Ò»ÂöÏà³Ğ
            if id == 331 then
                if PersonKF(personid, 50) and PersonKF(personid, 193) == false then
                    if DrawStrBoxYesNo(-1, -1, "ãÙ|µ¶µÀÒ»ÂöÏà³Ğ£¬ÊÇ·ñ½«²ñµ¶Ê®°ËÂ·Ï´ÎªâÒ¶¡½âÅ£µ¶?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 50 then
                                JY.Person[personid]["Îä¹¦" .. i] = 193
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 50 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 193
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 50 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 193
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--Íò½Ù ĞŞÂŞµ¶·¨ Ò»ÂöÏà³Ğ
			if id == 158 then
				if PersonKF(personid, 51) and PersonKF(personid, 58) == false then
                    if DrawStrBoxYesNo(-1, -1, "ĞŞÂŞÉ±½ÙÒ»ÂöÏà³Ğ£¬ÊÇ·ñ½«Íò½Ùµ¶·¨Â·Ï´ÎªĞŞÂŞµ¶·¨?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 51 then
                                JY.Person[personid]["Îä¹¦" .. i] = 58
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 51 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 58
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 51 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 58
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
            --Îäµ±ĞÄ·¨ Ì«¼«Éñ¹¦Ò»ÂöÏà³Ğ
            if id == 295 then
                if PersonKF(personid, 209) and PersonKF(personid, 171) == false then
                    if DrawStrBoxYesNo(-1, -1, "Îäµ±ÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îäµ±ĞÄ·¨Ï´ÎªÌ«¼«Éñ¹¦?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 209 then
                                JY.Person[personid]["Îä¹¦" .. i] = 171
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 209 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 171
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end 
            --ÉÙÁÖĞÄ·¨ Ò×½î¾­Ò»ÂöÏà³Ğ
            if id == 85 then
                if PersonKF(personid, 208) and PersonKF(personid, 108) == false then
                    if DrawStrBoxYesNo(-1, -1, "ÉÙÁÖÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ÉÙÁÖĞÄ·¨Ï´ÎªÒ×½î¾­£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 208 then
                                JY.Person[personid]["Îä¹¦" .. i] = 108
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 208 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 108
                                end
                                yes = 2							
                                break
                            end
                        end
                    end
                end
            end    
            --È«ÕæĞÄ·¨ ÏÈÌì¹¦Ò»ÂöÏà³Ğ
            if id == 77 then
                if PersonKF(personid, 210) and PersonKF(personid, 100) == false then
                    if DrawStrBoxYesNo(-1, -1, "È«Õæ½ÌÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«È«ÕæĞÄ·¨Ï´ÎªÏÈÌì¹¦£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 210 then
                                JY.Person[personid]["Îä¹¦" .. i] = 100
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 200 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 100
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  
            --¹ÅÄ¹ĞÄ·¨ ÓñÅ®ĞÄ¾­ Ò»ÂöÏà³Ğ
            if id == 280 then
                if PersonKF(personid, 211) and PersonKF(personid, 154) == false then
                    if DrawStrBoxYesNo(-1, -1, "¹ÅÄ¹ÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«¹ÅÄ¹ĞÄ·¨Ï´ÎªÓñÅ®ĞÄ¾­£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 211 then
                                JY.Person[personid]["Îä¹¦" .. i] = 154
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 211 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 154
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
            --»ªÉ½ĞÄ·¨ ×ÏÏ¼Éñ¹¦ Ò»ÂöÏà³Ğ
            if id == 67 then
                if PersonKF(personid, 212) and PersonKF(personid, 89) == false then
                    if DrawStrBoxYesNo(-1, -1, "»ªÉ½ÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«»ªÉ½ĞÄ·¨Ï´Îª×ÏÏ¼Éñ¹¦£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 212 then
                                JY.Person[personid]["Îä¹¦" .. i] = 89
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 212 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 89
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  	
            --±ù»ğÒõÑô¾÷ ÌìÄÏÒ×Ñô¾ö Ò»ÂöÏà³Ğ
            if id == 471 then
                if PersonKF(personid, 250) and PersonKF(personid, 314) == false then
                    if DrawStrBoxYesNo(-1, -1, "´óÀíÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«±ù»ğÒõÑô¾÷Ï´ÎªÌìÄÏÒ×Ñô¾ö£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 250 then
                                JY.Person[personid]["Îä¹¦" .. i] = 314
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 250 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 314
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end			
            --áÔÉ½ĞÄ·¨ º®±ùÕæÆø Ò»ÂöÏà³Ğ
            if id == 366 then
                if PersonKF(personid, 213) and PersonKF(personid, 216) == false then
                    if DrawStrBoxYesNo(-1, -1, "áÔÉ½ÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«áÔÉ½ĞÄ·¨Ï´Îªº®±ùÕæÆø£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 213 then
                                JY.Person[personid]["Îä¹¦" .. i] = 216
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 213 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 216
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  
			--ºâÉ½ĞÄ·¨ ÕòÔÀ¾÷ Ò»ÂöÏà³Ğ
            if id == 420 then
                if PersonKF(personid, 355) and PersonKF(personid, 263) == false then
                    if DrawStrBoxYesNo(-1, -1, "ºâÉ½ÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ºâÉ½ĞÄ·¨Ï´ÎªÕòÔÀ¾÷£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 355 then
                                JY.Person[personid]["Îä¹¦" .. i] = 263
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 355 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 263
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
		    --ºãÉ½ĞÄ·¨ ¹ÅÕëìø¹¦ Ò»ÂöÏà³Ğ
            if id == 416 then
                if PersonKF(personid, 255) and PersonKF(personid, 259) == false then
                    if DrawStrBoxYesNo(-1, -1, "ºãÉ½ÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ºãÉ½ĞÄ·¨Ï´Îª¹ÅÕëìø¹¦£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 255 then
                                JY.Person[personid]["Îä¹¦" .. i] = 259
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 255 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 259
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--Ì©É½ĞÄ·¨ ÅÍÊ¯·¨¾ö Ò»ÂöÏà³Ğ
            if id == 421 then
                if PersonKF(personid, 353) and PersonKF(personid, 264) == false then
                    if DrawStrBoxYesNo(-1, -1, "Ì©É½ÅÉÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Ì©É½ĞÄ·¨Ï´ÎªÅÍÊ¯·¨¾ö£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 353 then
                                JY.Person[personid]["Îä¹¦" .. i] = 264
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 353 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 264
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
            --Ñªµ¶ĞÄ·¨ Ñªº£Ä§¹¦ Ò»ÂöÏà³Ğ
            if id == 285 then
                if PersonKF(personid, 214) and PersonKF(personid, 163) == false then
                    if DrawStrBoxYesNo(-1, -1, "Ñªµ¶ÃÅÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Ñªµ¶ĞÄ·¨Ï´ÎªÑªºÓÉñÇ©£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 214 then
                                JY.Person[personid]["Îä¹¦" .. i] = 163
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 214 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 163
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end  		
            --Ø¤°ïÁ«»¨¹¦ ÇÜÁú¹¦ Ò»ÂöÏà³Ğ
            if id == 351 then
                if PersonKF(personid, 215) and PersonKF(personid, 204) == false then
                    if DrawStrBoxYesNo(-1, -1, "Ø¤°ïÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Á«»¨¹¦Ï´ÎªÇÜÁú¹¦£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 215 then
                                JY.Person[personid]["Îä¹¦" .. i] = 204
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 215 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 204
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end 
            --µØ»ğ¹¦ Ê¥»ğÉñ¹¦ Ò»ÂöÏà³Ğ
            if id == 70 then
                if PersonKF(personid, 217) and PersonKF(personid, 93) == false then
                    if DrawStrBoxYesNo(-1, -1, "Ã÷½ÌÄÚ¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«µØ»ğ¹¦Ï´ÎªÊ¥»ğÉñ¹¦£¿", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 217 then
                                JY.Person[personid]["Îä¹¦" .. i] = 93
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 217 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 93
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end 
			--±ù»ğ
            --ÂŞººÈ­ ´ó½ğ¸ÕÕÆ Ò»ÂöÏà³Ğ
            if id == 90 then
                if PersonKF(personid, 1) and PersonKF(personid, 22) == false then
                    if DrawStrBoxYesNo(-1, -1, "ÉÙÁÖÂŞººÌÃÎä¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦ÂŞººÈ­·¨Ï´Îª´ó½ğ¸ÕÕÆ?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 1 then
                                JY.Person[personid]["Îä¹¦" .. i] = 22
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 1 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 22
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 1 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 22
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--º®±ùÃàÕÆ ĞşÚ¤ÉñÕÆ Ò»ÂöÏà³Ğ
			if id == 91 then
				if PersonKF(personid, 5) and PersonKF(personid, 21) == false then
                    if DrawStrBoxYesNo(-1, -1, "º®ÏµÕÆ·¨Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦º®±ùÃàÕÆÏ´ÎªĞşÚ¤ÉñÕÆ?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 5 then
                                JY.Person[personid]["Îä¹¦" .. i] = 21
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 5 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 21
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 5 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 21
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--ËÉ·ç½£·¨ ¿ñ·ç¿ì½£ Ò»ÂöÏà³Ğ
			if id == 505 then
				if PersonKF(personid, 27) and PersonKF(personid, 162) == false then
                    if DrawStrBoxYesNo(-1, -1, "½£µÀÒâ¾³Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦ËÉ·ç½£·¨Ï´Îª¿ñ·ç¿ì½£?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 27 then
                                JY.Person[personid]["Îä¹¦" .. i] = 162
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 27 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 162
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 27 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 162
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
			--¢ºÏ½£Æø ±±¶·½£·¨ Ò»ÂöÏà³Ğ
            if id == 422 then
                if PersonKF(personid, 266) and PersonKF(personid, 265) == false then
                    if DrawStrBoxYesNo(-1, -1, "¹ÃËÕÄ½ÈİÎä¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦±±¶·½£·¨Ï´Îª¢ºÏ½£Æø?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 266 then
                                JY.Person[personid]["Îä¹¦" .. i] = 265
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 266 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 265
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 266 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 265
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--ÈÆÖ¸Èá½£ ÈáÔÆ½£·¨ Ò»ÂöÏà³Ğ
            if id == 125 then
                if PersonKF(personid, 245) and PersonKF(personid, 36) == false then
                    if DrawStrBoxYesNo(-1, -1, "Îäµ±ÅÉÎä¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«Îä¹¦ÈÆÖ¸Èá½£Ï´ÎªÈáÔÆ½£·¨?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 245 then
                                JY.Person[personid]["Îä¹¦" .. i] = 36
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³Íâ¹¦1"] == 245 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦1"] = 36
                                end
                                if JY.Person[personid]["Ìì¸³Íâ¹¦2"] == 245 then
                                    JY.Person[personid]["Ìì¸³Íâ¹¦2"] = 36
                                end							
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--¹êÏ¢¹¦ ²»ÀÏ³¤´º Ò»ÂöÏà³Ğ	±ê¼ÇĞŞ¸Ä
			if id == 317 then
                if PersonKF(personid, 227) and PersonKF(personid, 183) == false then
                    if DrawStrBoxYesNo(-1, -1, "¹êÏ¢¹¦²»ÀÏ³¤´º¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ÄÚ¹¦¹êÏ¢¹¦Ï´Îª²»ÀÏ³¤´º¹¦?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 227 then
                                JY.Person[personid]["Îä¹¦" .. i] = 183
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 227 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 183
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--»ìÔª¹¦Ò»Âö»ìãçÆø¾ö
			if id == 545 then
                if PersonKF(personid, 90) and PersonKF(personid, 375) == false then
                    if DrawStrBoxYesNo(-1, -1, "»ìÔª¹¦»ìãçÆø¾÷Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ÄÚ¹¦»ìÔª¹¦Ï´Îª»ìãçÆø¾÷?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 90 then
                                JY.Person[personid]["Îä¹¦" .. i] = 375
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 90 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 375
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end	
			--Ğ¡ÎŞÏà¼«ÒõÎŞÏà¹¦
			if id == 537 then
                if PersonKF(personid, 98) and PersonKF(personid, 367) == false then
                    if DrawStrBoxYesNo(-1, -1, "Ğ¡ÎŞÏà¹¦Óë¼«ÒõÎŞÏà¹¦Ò»ÂöÏà³Ğ£¬ÊÇ·ñ½«ÄÚ¹¦Ğ¡ÎŞÏà¹¦Ï´Îª¼«ÒõÎŞÏà¹¦?", C_WHITE, CC.DefaultFont) then
                        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                            if JY.Person[personid]["Îä¹¦" .. i] == 98 then
                                JY.Person[personid]["Îä¹¦" .. i] = 367
                                JY.Person[personid]["Îä¹¦µÈ¼¶" .. i] = 50
                                if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == 98 then
                                    JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = 367
                                end
                                yes = 2
                                break
                            end
                        end
                    end
                end
            end
        end
		--Èç¹ûÒÑ¾­ÂúÎä¹¦²¢ÇÒÑ¡ÔñµÄÎä¹¦Ã»ÓĞÑ§»á£¬Ôò²»¿É×°±¸ĞŞÁ¶
		if yes == 0 and full == 1 then
			DrawStrBoxWaitKey("ĞŞÁ¶Îä¹¦ÊıÒÑ´ï±¾ÖÜÄ¿ÉÏÏŞ", C_WHITE, CC.DefaultFont)
			return 0
		end
    
		--¿û»¨±¦µä
		if CC.Shemale[id] == 1 then
			--½£Éñ¿ÉÒÔÖ±½ÓÑ§
			if (personid == 0 and JY.Base["±ê×¼"] == 3) or (personid == 0 and JY.Base["³©Ïë"] == 652 ) or (personid == 0 and JY.Base["³©Ïë"] == 189 ) then
				say("àÅ¡­¡­ÎÒ¿´¿´£¬ÕâÌ×Îä¹¦µÄ¾«ÃîÖ®´¦ÆäÊµ²»ÔÚÓÚÊÇ·ñ×Ô¹¬¡£¿´ÎÒÈçºÎÒÔ½£ÈëµÀ¿Ë·şÕâ¸öÎÊÌâ£¡",0,1)
				yes = 1
			elseif (personid == 0 and JY.Base["±ê×¼"] == 5) or (personid == 0 and JY.Base["±ê×¼"] == 7) or (personid == 0 and JY.Base["±ê×¼"] == 8) then 
				say("Îä¹¦±¾ÉíÎŞÓÅÊÆÖ®·Ö£¬µ«¸úÒª¿´Ê¹ÓÃÕß£¡",0,1)
				yes = 1
			--Ö÷½Ç´òÓ®¿û»¨×ğÕß£¬¿ÉÒÔÖ±½ÓÑ§
			--elseif personid == 0 and CC.TX["Ğ¦°ÁĞ°Ïß"] == 2 then
				--yes = 1
			elseif personid == 0 and JY.Base["³©Ïë"] == 457 then	
			    say("ÎÒ¶«·½Òà¼¯°Ù¼ÒËù³¤£¬ÇøÇø¿û»¨»¹²»ÓÃ×Ô²ĞÉíÌåÀ´ĞŞÁ¶£¡",457,1)
			    yes = 1	
			elseif personid == 92 then
				say("¡­¡­ÎÒ»¹ĞèÒªÇĞÂğ£¿",92,1)
				return 0
			elseif personid == 0 and JY.Base['±ê×¼'] == 10 then
				say("ÎáÓĞ´óµÜÖ®×Ê£¬ÆñÄÜÑ§´ËµÈĞ°ÃÅÎäÑ§¡£",0,1)
				return 0
			elseif personid == 520 then
				say("Õâ²»ÊÇ¿û»¨±¦µäÄÇÎŞÁÄµÄ°ÑÏ·Âğ£¿",520,1)
				return 0	
			elseif JY.Person[personid]["ĞÔ±ğ"] == 0 and CanUseThing(id, personid) then
				Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
				if DrawStrBoxYesNo(-1, -1, "ĞŞÁ¶´ËÊé±ØĞëÏÈ»Óµ¶×Ô¹¬£¬ÊÇ·ñÈÔÒªĞŞÁ¶?", C_WHITE, CC.DefaultFont) == false then
					return 0
				else
					lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_RED, 128)
					ShowScreen()
					lib.Delay(80)
					lib.ShowSlow(15, 1)
					Cls()
					lib.ShowSlow(50, 0)
					JY.Person[personid]["ĞÔ±ğ"] = 2
					local add, str = AddPersonAttrib(personid, "¹¥»÷Á¦", -20)
					DrawStrBoxWaitKey(JY.Person[personid]["ĞÕÃû"] .. str, C_ORANGE, CC.DefaultFont)
					add, str = AddPersonAttrib(personid, "·ÀÓùÁ¦", -30)
					DrawStrBoxWaitKey(JY.Person[personid]["ĞÕÃû"] .. str, C_ORANGE, CC.DefaultFont)
					--[[
					if JY.Base["±ê×¼"] > 0 then
						JY.Person[0]["ÍâºÅ"] = "¹ÃÄï"
						JY.Person[0]["ÍâºÅ2"] = "Ñ¾Í·"
						local zddh = 227
						local js = JY.Base["±ê×¼"]
						local jsdz = JY.Person[0]["Í·Ïñ´úºÅ"]
						if js == 3 then
						jsdz = 228
						elseif js == 4 then
						jsdz = 229
						elseif js == 5 then
						jsdz = 230
						else
						jsdz = 227
						   end
						JY.Person[0]["°ëÉíÏñ"] = 555+JY.Base["±ê×¼"]
						local f_ani = {
                         {0, 0, 0}, 
				         {9, 9, 7}, 
			            {8, 8, 6}, 
				        {8, 8, 6}, 
				        {9, 7, 7}}
						for i = 1, 5 do
							JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i] = f_ani[i][1]
							JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i] = f_ani[i][3]
							JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i] = f_ani[i][2]
						end
					end
					]]
				end
	
			elseif JY.Person[personid]["ĞÔ±ğ"] == 1 then
				DrawStrBoxWaitKey("´ËÈË²»ÊÊºÏĞŞÁ¶´ËÎïÆ·", C_WHITE, CC.DefaultFont)
				return 0
			end
		end


		if yes == 1 or CanUseThing(id, personid) then
			if JY.Thing[id]["Ê¹ÓÃÈË"] == personid then
				return 0
			end
			if JY.Person[personid]["ĞŞÁ¶ÎïÆ·"] >= 0 then
				JY.Thing[JY.Person[personid]["ĞŞÁ¶ÎïÆ·"]]["Ê¹ÓÃÈË"] = -1
			end
			if JY.Thing[id]["Ê¹ÓÃÈË"] >= 0 then
				JY.Person[JY.Thing[id]["Ê¹ÓÃÈË"]]["ĞŞÁ¶ÎïÆ·"] = -1
				JY.Person[JY.Thing[id]["Ê¹ÓÃÈË"]]["ÎïÆ·ĞŞÁ¶µãÊı"] = 0
			end
			JY.Thing[id]["Ê¹ÓÃÈË"] = personid
			JY.Person[personid]["ĞŞÁ¶ÎïÆ·"] = id
			JY.Person[personid]["ÎïÆ·ĞŞÁ¶µãÊı"] = 0
		else
			DrawStrBoxWaitKey("´ËÈË²»ÊÊºÏĞŞÁ¶´ËÎïÆ·", C_WHITE, CC.DefaultFont)
			return 0
		end
	end
	return 1
end

--ÎŞ¾Æ²»»¶£»Ê¹ÓÃÒ©Æ·ºÍÊ³Æ·
function UseThing_Type3(id)
	local usepersonid = -1
	local amount_use = 0
	Cls()
	if JY.Status == GAME_MMAP or JY.Status == GAME_SMAP then
		--Cls(CC.MainSubMenuX, CC.MainSubMenuY, CC.ScreenW, CC.ScreenH)
		DrawStrBox(CC.MainSubMenuX, CC.MainSubMenuY, string.format("Ë­ÒªÊ¹ÓÃ%s?", JY.Thing[id]["Ãû³Æ"]), C_WHITE, CC.DefaultFont)
		local nexty = CC.MainSubMenuY + CC.SingleLineHeight
		local r = SelectTeamMenu(CC.MainSubMenuX, nexty)
		if r > 0 then
			usepersonid = JY.Base["¶ÓÎé" .. r]

	
			--·ÇÕ½¶·ÖĞ¿ÉÒÔÅúÁ¿Ê¹ÓÃ
			local max_amount = 0
			for i = 1, CC.MyThingNum do
				if JY.Base["ÎïÆ·" .. i] == id then
					max_amount = JY.Base["ÎïÆ·ÊıÁ¿" .. i]
					break;
				end
			end
			amount_use = InputNum("Ê¹ÓÃÊıÁ¿", 1, max_amount)
		end
	
	--Õ½¶·ÖĞ
	elseif JY.Status == GAME_WMAP then
		--ºúÇàÅ£¿ÉÒÔÏò¶ÓÓÑÓÃÒ©
		if match_ID(WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"], 16) then
			War_CalMoveStep(WAR.CurID, 8, 1)
			local x, y = War_SelectMove()
			if x ~= nil then
				local emeny = GetWarMap(x, y, 2)
				if emeny >= 0 and WAR.Person[WAR.CurID]["ÎÒ·½"] == WAR.Person[emeny]["ÎÒ·½"] then
					usepersonid = WAR.Person[emeny]["ÈËÎï±àºÅ"]
				end
			end
		else
			usepersonid = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
		end
	end

	--Õ½¶·ÖĞ²»¿ÉÊ¹ÓÃ¼ÓÑªÄÚÉÏÏŞµÄÎïÆ·
	if JY.Status == GAME_WMAP and (id >=14 and id <= 21) then
		return 0
	end
	
	if usepersonid >= 0 then
		--·ÇÕ½¶·ÏÂÊ¹ÓÃÎïÆ·
		if JY.Status == GAME_MMAP or JY.Status == GAME_SMAP then

			local r = UseThingEffect(id, usepersonid, amount_use)
			if r == 1 then
				instruct_32(id, -amount_use)
				WaitKey()
			elseif r == 2 then
				instruct_32(id, -amount_use)
			end
			if id == 14 then
                JY.Person[usepersonid]["ÉúÃüÔö³¤"] = JY.Person[usepersonid]["ÉúÃüÔö³¤"]+amount_use
                if JY.Person[usepersonid]["ÉúÃüÔö³¤"] > 12 then
                    JY.Person[usepersonid]["ÉúÃüÔö³¤"] = 12
                end
                Hp_Max(usepersonid)
            end
		--Õ½¶·ÖĞÊ¹ÓÃÎïÆ·
		elseif JY.Status == GAME_WMAP then
			if UseThingEffect(id, usepersonid) == 1 then
				instruct_32(id, -1)
                if id >= 22 and id <= 25 and match_ID(usepersonid, 9965) then 
                    WAR.PD['°Ë¾Æ±­'][usepersonid] = (WAR.PD['°Ë¾Æ±­'][usepersonid] or 0) + 1
                    WAR.PD['»ØÆø'][usepersonid] = (WAR.PD['»ØÆø'][usepersonid] or 0) + 500
                    CurIDTXDH(WAR.CurID, 79,1,"¾ÆÉñ¡¤°Ë¾Æ±­",C_ORANGE);
                end
			end
		end
	else
		return 0
	end
	return 1
end

--°µÆ÷ÎïÆ·
function UseThing_Type4(id)
	if JY.Status == GAME_WMAP then
		return War_UseAnqi(id)
	end
	return 0
end

--------------------------------------------------------------------------------
--------------------------------------ÊÂ¼şµ÷ÓÃ-----------------------------------

--ÊÂ¼şµ÷ÓÃÖ÷Èë¿Ú
--id£¬d*ÖĞµÄ±àºÅ
--flag 1 ¿Õ¸ñ´¥·¢£¬2£¬ÎïÆ·´¥·¢£¬3£¬Â·¹ı´¥·¢
function EventExecute(id,flag)
    JY.CurrentD=id;

    oldEventExecute(flag)

    JY.CurrentD=-1;
end

--µ÷ÓÃÔ­ÓĞµÄÖ¸¶¨Î»ÖÃµÄº¯Êı
--¾ÉµÄº¯ÊıÃû×Ö¸ñÊ½Îª  oldevent_xxx();  xxxÎªÊÂ¼ş±àºÅ
function oldEventExecute(flag)
	local eventnum = nil
	if flag == 1 then
		eventnum = GetD(JY.SubScene, JY.CurrentD, 2)
	elseif flag == 2 then
		eventnum = GetD(JY.SubScene, JY.CurrentD, 3)
	elseif flag == 3 then
		eventnum = GetD(JY.SubScene, JY.CurrentD, 4)
	end
	if eventnum > 0 then
			lib.Debug(eventnum.."");
		end
	if eventnum > 0 then
		CallCEvent(eventnum)  
	end
end

function existFile(filename)
    local f = io.open(filename)
    if f == nil then
        return false
    end
    io.close(f)
    return true
end
--[[
function CallCEvent(eventnum)
	local eventfilename = string.format("%s%d.lua", CONFIG.CEventPath,eventnum)
	if existFile(eventfilename) then
		dofile(eventfilename)
		return true
	else
		return false
	end
end
]]
function CallCEvent(eventnum)
	if newkdef[eventnum]~=nil then--Ê×ÏÈÅĞ¶ÏÕâ¸öÊÂ¼ş±àºÅÊÇ·ñ´æÔÚ
		lib.Debug("new kdef "..eventnum)--Èç¹û´æÔÚ£¬ÔÚÖ´ĞĞÊÂ¼şÇ°£¬ÔÚdebugÎÄ±¾Àï´òÓ¡³ö  new kdef +ÊÂ¼ş±êºÅ£¬ÒÔ±ãµ÷ÊÔÊ±Ê¹ÓÃ
		if eventnum>0 then--Èç¹ûÊÂ¼ş±àºÅ´óÓÚ0
			newkdef[eventnum]()--Ö´ĞĞ¸ÃÊÂ¼ş
		end
	end
end

--¸Ä±ä´óµØÍ¼×ø±ê£¬´Ó³¡¾°³öÈ¥ºóÒÆ¶¯µ½ÏàÓ¦×ø±ê
function ChangeMMap(x,y,direct)          --¸Ä±ä´óµØÍ¼×ø±ê
	JY.Base["ÈËX"]=x;
	JY.Base["ÈËY"]=y;
	JY.Base["ÈË·½Ïò"]=direct;
end

--¸Ä±äµ±Ç°³¡¾°
function ChangeSMap(sceneid,x,y,direct)       --¸Ä±äµ±Ç°³¡¾°
    JY.SubScene=sceneid;
	JY.Base["ÈËX1"]=x;
	JY.Base["ÈËY1"]=y;
	JY.Base["ÈË·½Ïò"]=direct;
end


--Çå³ı(x1,y1)-(x2,y2)¾ØĞÎÄÚµÄÎÄ×ÖµÈ¡£
--Èç¹ûÃ»ÓĞ²ÎÊı£¬ÔòÇå³ıÕû¸öÆÁÄ»±íÃæ
--×¢Òâ¸Ãº¯Êı²¢²»Ö±½ÓË¢ĞÂÏÔÊ¾ÆÁÄ»
function Cls(x1,y1,x2,y2)                    --Çå³ıÆÁÄ»
    if x1==nil then        --µÚÒ»¸ö²ÎÊıÎªnil,±íÊ¾Ã»ÓĞ²ÎÊı£¬ÓÃÈ±Ê¡
	    x1=0;
		y1=0;
		x2=CC.ScreenW;
		y2=CC.ScreenH;
	end

	lib.SetClip(x1,y1,x2,y2);

	if JY.Status==GAME_START then
	    lib.FillColor(0,0,0,0,0);
        lib.LoadPicture(CC.FirstFile,-1,-1);
	elseif JY.Status==GAME_MMAP then
        lib.DrawMMap(JY.Base["ÈËX"],JY.Base["ÈËY"],GetMyPic());             --ÏÔÊ¾Ö÷µØÍ¼
	elseif JY.Status==GAME_SMAP then
        DrawSMap();
	elseif JY.Status==GAME_WMAP then
        WarDrawMap(0);
	elseif JY.Status==GAME_DEAD then
	    lib.FillColor(0,0,0,0,0);
        lib.LoadPicture(CC.DeadFile,-1,-1);
    else 
        lib.FillColor(0, 0, 0, 0, 0)
	end
	lib.SetClip(0,0,CC.ScreenW,CC.ScreenH);
end


--²úÉú¶Ô»°ÏÔÊ¾ĞèÒªµÄ×Ö·û´®£¬¼´Ã¿¸ôn¸öÖĞÎÄ×Ö·û¼ÓÒ»¸öĞÇºÅ
function GenTalkString(str,n)             					 --²úÉú¶Ô»°ÏÔÊ¾ĞèÒªµÄ×Ö·û´®
    local tmpstr="";
    for s in string.gmatch(str .. "*","(.-)%*") do           --È¥µô¶Ô»°ÖĞµÄËùÓĞ*. ×Ö·û´®Î²²¿¼ÓÒ»¸öĞÇºÅ£¬±ÜÃâÎŞ·¨Æ¥Åä
        tmpstr=tmpstr .. s;
    end

    local newstr="";
    while #tmpstr>0 do
		local w=0;
		while w<#tmpstr do
		    local v=string.byte(tmpstr,w+1);	--µ±Ç°×Ö·ûµÄÖµ
			if v>=128 then
			    w=w+2;
			else
			    w=w+1;
			end
			if w >= 2*n-1 then					--ÎªÁË±ÜÃâ¿ç¶ÎÖĞÎÄ×Ö·û
			    break;
			end
		end

        if w<#tmpstr then
		    if w==2*n-1 and string.byte(tmpstr,w+1)<128 then
				newstr=newstr .. string.sub(tmpstr,1,w+1) .. "*";
				tmpstr=string.sub(tmpstr,w+2,-1);
			else
				newstr=newstr .. string.sub(tmpstr,1,w)  .. "*";
				tmpstr=string.sub(tmpstr,w+1,-1);
			end
		else
		    newstr=newstr .. tmpstr;
			break;
		end
	end
    return newstr;
end

--¸öÈËĞÂ¶Ô»°
function TalkEx(s,pid,flag,name)
	say(s,pid,flag,name)
end

--²âÊÔÖ¸Áî£¬Õ¼Î»ÖÃÓÃ
function instruct_test(s)
    DrawStrBoxWaitKey(s,C_ORANGE,24);
end

--ÇåÆÁ
function instruct_0()         --ÇåÆÁ
    Cls();
end

function ReadTalk(id, flag)
	local tidx = Byte.create(id * 4 + 4)
	Byte.loadfile(tidx, CC.TDX, 0, id * 4 + 4)
	local idx1, idx2 = nil, nil
	if id < 1 then
		idx1 = 0
	else
		idx1 = Byte.get32(tidx, (id - 1) * 4)
	end
	idx2 = Byte.get32(tidx, id * 4)
	local len = idx2 - idx1
	local talk = Byte.create(len)
	Byte.loadfile(talk, CC.TRP, idx1, len)
	local str = ""
	for i = 0, len - 2 do
		local byte = Byte.getu16(talk, i)
		byte = 255 - math.fmod(byte, 256)
		str = str .. string.char(byte)
	end
	if flag == nil then
		str = lib.CharSet(str, 0)
		str = GenTalkString(str, 12)
	end
	return str
end

	
--¶Ô»°
--talkid: ÎªÊı×Ö£¬ÔòÎª¶Ô»°±àºÅ£»Îª×Ö·û´®£¬ÔòÎª¶Ô»°±¾Éí¡£
--headid: Í·Ïñid
--flag :¶Ô»°¿òÎ»ÖÃ£º0 ÆÁÄ»ÉÏ·½ÏÔÊ¾, ×ó±ßÍ·Ïñ£¬ÓÒ±ß¶Ô»°
--            1 ÆÁÄ»ÏÂ·½ÏÔÊ¾, ×ó±ß¶Ô»°£¬ÓÒ±ßÍ·Ïñ
--            2 ÆÁÄ»ÉÏ·½ÏÔÊ¾, ×ó±ß¿Õ£¬ÓÒ±ß¶Ô»°
--            3 ÆÁÄ»ÏÂ·½ÏÔÊ¾, ×ó±ß¶Ô»°£¬ÓÒ±ß¿Õ
--            4 ÆÁÄ»ÉÏ·½ÏÔÊ¾, ×ó±ß¶Ô»°£¬ÓÒ±ßÍ·Ïñ
--            5 ÆÁÄ»ÏÂ·½ÏÔÊ¾, ×ó±ßÍ·Ïñ£¬ÓÒ±ß¶Ô»°
function instruct_1(talkid, headid, flag)
	local s = ReadTalk(talkid)
	if s == nil then
		return 
	end
	TalkEx(s, headid, flag)
end

--µÃµ½ÎïÆ·
function instruct_2(thingid, num)
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	if JY.Thing[thingid] == nil then
		return 
	end
	instruct_32(thingid, num)
	if num > 0 then
		--DrawStrBoxWaitKey(string.format("µÃµ½ÎïÆ·%sX%d", "¡¾£Ç"..JY.Thing[thingid]["Ãû³Æ"].."£Ï¡¿", num), C_ORANGE, CC.DefaultFont, 1)
		Cls()
		local name = "£Ç"..JY.Thing[thingid]["Ãû³Æ"].."X"..num
		lib.LoadPNG(91,121*2,CC.ScreenW/1360*355+bx*212,CC.ScreenH/768*373+by*33.5,1)
		tjm(CC.ScreenW/1360*425+bx*212,CC.ScreenH/768*386+by*33.5,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
		ShowScreen()
		WaitKey()
		Cls()
	else
		-- DrawStrBoxWaitKey(string.format("Ê§È¥ÎïÆ·%sX%d", "¡¾£Ç"..JY.Thing[thingid]["Ãû³Æ"].."£Ï¡¿", -num), C_ORANGE, CC.DefaultFont, 1)
		Cls()
		local name =  "£Ç"..JY.Thing[thingid]["Ãû³Æ"].."X"..-num
		lib.LoadPNG(91,122*2,CC.ScreenW/1360*355+bx*212,CC.ScreenH/768*373+by*33.5,1)
		tjm(CC.ScreenW/1360*425+bx*212,CC.ScreenH/768*386+by*33.5,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
		ShowScreen()
		WaitKey()
		Cls()
	end
	if thingid >= CC.BookStart and thingid < CC.BookStart + CC.BookNum then
		instruct_2(174, 2000)
		JY.Person[512]["ÎŞÓÃ"] = JY.Person[512]["ÎŞÓÃ"] + 1
	end
	--[[if 0 < num then
        DrawStrBoxWaitKey(string.format("µÃµ½ÎïÆ·:%s %d", JY.Thing[thingid]["Ãû³Æ"], num), C_ORANGE, CC.DefaultFont)
    else
        DrawStrBoxWaitKey(string.format("Ê§È¥ÎïÆ·:%s %d", JY.Thing[thingid]["Ãû³Æ"], -num), C_ORANGE, CC.DefaultFont)
    end]]
    for i = 144, 157 do
        local str = ""
		if thingid == i and num == 1 then
            if JY.Base["ÄÑ¶È"] >= 1 then
                local hd = math.random(3)
                if hd == 1 then
					str = "µÃµ½ÃâÉË¿¨Ò»¸ö"
                    JY.Person[318]["ÊÜÉË³Ì¶È"] = JY.Person[318]["ÊÜÉË³Ì¶È"] + 1
                elseif hd == 2 then
                    str = "µÃµ½Ò£¿ØÉ«×ÓÒ»¸ö"
                    JY.Person[318]["Ò½ÁÆÄÜÁ¦"] = JY.Person[318]["Ò½ÁÆÄÜÁ¦"] + 1
                else
                    str = "µÃµ½¸£Éñ¿¨Ò»¸ö"
                    JY.Person[318]["¿¹¶¾ÄÜÁ¦"] = JY.Person[318]["¿¹¶¾ÄÜÁ¦"] + 1
                end
            else
                str = "µÃµ½Ò£¿ØÉ«×Ó¡¢ÃâÉË¿¨ºÍ¸£Éñ¿¨¸÷Ò»¸ö"
                JY.Person[318]["ÊÜÉË³Ì¶È"] = JY.Person[318]["ÊÜÉË³Ì¶È"] + 1
                JY.Person[318]["Ò½ÁÆÄÜÁ¦"] = JY.Person[318]["Ò½ÁÆÄÜÁ¦"] + 1
                JY.Person[318]["¿¹¶¾ÄÜÁ¦"] = JY.Person[318]["¿¹¶¾ÄÜÁ¦"] + 1
            end
			Cls()
			local name = "£Ç"..str
			lib.LoadPNG(91,121*2,CC.ScreenW/1360*355+bx*212,CC.ScreenH/768*373+by*33.5,1)
			tjm(CC.ScreenW/1360*425+bx*212,CC.ScreenH/768*386+by*33.5,name,C_CYGOLD,CC.DefaultFont,11,CC.DefaultFont)		
			ShowScreen()
			WaitKey()
			Cls()
        end
    end
    instruct_2_sub()
end

--ĞŞ¸ÄÖ¸¶¨³¡¾°×ø±êµÄÊÂ¼ş
function instruct_3(sceneid, id, v0, v1, v2, v3, v4, v5, v6, v7, v8, v9, v10)
	if JY.Restart == 1 then
		return
	end
  if sceneid == -2 then
    sceneid = JY.SubScene
  end
  if id == -2 then
    id = JY.CurrentD
  end
  if v0 ~= -2 then
    SetD(sceneid, id, 0, v0)
  end
  if v1 ~= -2 then
    SetD(sceneid, id, 1, v1)
  end
  if v2 ~= -2 then
    SetD(sceneid, id, 2, v2)
  end
  if v3 ~= -2 then
    SetD(sceneid, id, 3, v3)
  end
  if v4 ~= -2 then
    SetD(sceneid, id, 4, v4)
  end
  if v5 ~= -2 then
    SetD(sceneid, id, 5, v5)
  end
  if v6 ~= -2 then
    SetD(sceneid, id, 6, v6)
  end
  if v7 ~= -2 then
    SetD(sceneid, id, 7, v7)
  end
  if v8 ~= -2 then
    SetD(sceneid, id, 8, v8)
  end
  if v9 ~= -2 and v10 ~= -2 and v9 > 0 and v10 > 0 then
    SetS(sceneid, GetD(sceneid, id, 9), GetD(sceneid, id, 10), 3, -1)
    SetD(sceneid, id, 9, v9)
    SetD(sceneid, id, 10, v10)
    SetS(sceneid, GetD(sceneid, id, 9), GetD(sceneid, id, 10), 3, id)
  end
end

function instruct_4(thingid)
	if JY.CurrentThing == thingid then
		JY.ThingUse = thingid
		return true
	else
		return false
	end
end

function instruct_5()
	return DrawStrBoxYesNo(-1, -1, "ÊÇ·ñÓëÖ®¹ıÕĞ(Y/N)?", C_ORANGE, CC.DefaultFont)
end

function instruct_6(warid, tmp, tmp, flag)
	return WarMain(warid, flag)
end

function instruct_7()
	instruct_test("Ö¸Áî7²âÊÔ")
end

function instruct_8(musicid)
	JY.MmapMusic = musicid
end

function instruct_9()
	return DrawStrBoxYesNo(-1, -1, "ÊÇ·ñÒªÇó¼ÓÈë(Y/N)?", C_ORANGE, CC.DefaultFont)
end

--Èë¶Óº¯Êı
function instruct_10(personid)
	if JY.Person[personid] == nil then
		lib.Debug("instruct_10 error: person id not exist")
		return 
	end
	local add = 0
	--ÎŞ¾Æ²»»¶£º³©Ïë²»ÄÜÊÕ×Ô¼º
	if personid ~= JY.Base["³©Ïë"] then
		for i = 2, CC.TeamNum do
			if JY.Base["¶ÓÎé" .. i] < 0 then
			  JY.Base["¶ÓÎé" .. i] = personid
			  add = 1
			  break;
			end
		end
	end	
	for i = 1, 4 do
		local id = JY.Person[personid]["Ğ¯´øÎïÆ·" .. i]
		local n = JY.Person[personid]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i]
		if n < 0 then
			n = 0
		end
		if id >= 0 and n > 0 then
			instruct_2(id, n)
			JY.Person[personid]["Ğ¯´øÎïÆ·" .. i] = -1
			JY.Person[personid]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i] = 0
		end
	end
	if add == 0 then
		lib.Debug("instruct_10 error: ¼ÓÈë¶ÓÎéÒÑÂú")
		return
	end
end

function instruct_11()
	return DrawStrBoxYesNo(-1, -1, "ÊÇ·ñ(Y/N)?", C_ORANGE, CC.DefaultFont)
end

--ĞİÏ¢
function instruct_12(flag)
	for i = 1, CC.TeamNum do
		local id = JY.Base["¶ÓÎé" .. i]
		if id >= 0 then
			JY.Person[id]["ÊÜÉË³Ì¶È"] = 0
			JY.Person[id]["ÖĞ¶¾³Ì¶È"] = 0
			JY.Person[id]["±ù·â³Ì¶È"] = 0
			JY.Person[id]["×ÆÉÕ³Ì¶È"] = 0
			AddPersonAttrib(id, "ÌåÁ¦", math.huge)
			AddPersonAttrib(id, "ÉúÃü", math.huge)
			AddPersonAttrib(id, "ÄÚÁ¦", math.huge)
		end
	end
end

--dark
function instruct_13()
	if JY.Restart == 1 then
		return
	end
	Cls()
	JY.Darkness = 0
	lib.ShowSlow(20, 0)
	lib.GetKey()
end

--light
function instruct_14()
	if JY.Restart == 1 then
		return
	end
	lib.ShowSlow(20, 1)
	JY.Darkness = 1
end

function instruct_15()
	JY.Status = GAME_DEAD
	dark()
	light()
	Cls()
	DrawString(CC.GameOverX, CC.GameOverY, JY.Person[0]["ĞÕÃû"], RGB(0, 0, 0), CC.DefaultFont)
	local x = CC.ScreenW - 9 * CC.DefaultFont
	DrawString(x, 10, os.date("%Y-%m-%d %H:%M"), RGB(216, 20, 24), CC.DefaultFont)
	DrawString(x, 10 + CC.DefaultFont + CC.RowPixel, "ÔÚµØÇòµÄÄ³´¦", RGB(216, 20, 24), CC.DefaultFont)
	DrawString(x, 10 + (CC.DefaultFont + CC.RowPixel) * 2, "µ±µØÈË¿ÚµÄÊ§×ÙÊı", RGB(216, 20, 24), CC.DefaultFont)
	DrawString(x, 10 + (CC.DefaultFont + CC.RowPixel) * 3, "ÓÖ¶àÁËÒ»±Ê¡£¡£¡£", RGB(216, 20, 24), CC.DefaultFont)
	local loadMenu = {
	{"Ñ¡Ôñ¶Áµµ", nil, 1},  
	{"»Ø¼ÒË¯¾õÈ¥", nil, 1}}
	local y = CC.ScreenH - 4 * (CC.DefaultFont + CC.RowPixel) - 10
	local sl = ShowMenu(loadMenu, #loadMenu, 0, x, y, 0, 0, 0, 0, CC.DefaultFont, C_ORANGE, C_WHITE)
	if sl ==1 then
		local r = SaveList();
			if r < 1 then
				JY.Status = GAME_END
				return 0;
			end
			
			Cls();
			DrawStrBox(-1,CC.StartMenuY,"ÇëÉÔºò...",C_GOLD,CC.DefaultFont);
			ShowScreen();
			local result = LoadRecord(r);
			if result ~= nil then
				instruct_15();
				return 0;
			end
		if JY.Base["ÎŞÓÃ"] ~= -1 then
			JY.Status = GAME_SMAP
			JY.SubScene = JY.Base["ÎŞÓÃ"]
			JY.MmapMusic = -1
			JY.MyPic = GetMyPic()
			Init_SMap(1)
		else
			JY.SubScene = -1
			JY.Status = GAME_FIRSTMMAP
		end
		ShowScreen()
		lib.LoadPicture("", 0, 0)
		lib.GetKey()
		Game_Cycle()
	else
		JY.Status = GAME_END
	end
end

function inteam(pid)
	local r = false
	local xwperson;	--ÅĞ¶¨ÈËÎï
	--·ÇÕ½¶·ÖĞ²ÅÉúĞ§£¬ÓÃÓÚ´¥·¢¾çÇéµÈÅĞ¶¨
	if pid == JY.Base["³©Ïë"] and JY.Status ~= GAME_WMAP then
		xwperson = 0
	else
		xwperson = pid
	end
	for i = 1, CC.TeamNum do
		if xwperson == JY.Base["¶ÓÎé" .. i] then
			r = true
			break;
		end
	end
	return r
end

function instruct_16(personid)
	local r = false
	local xwperson;	--ÅĞ¶¨ÈËÎï
	--·ÇÕ½¶·ÖĞ²ÅÉúĞ§£¬ÓÃÓÚ´¥·¢¾çÇéµÈÅĞ¶¨
	if personid == JY.Base["³©Ïë"] and JY.Status ~= GAME_WMAP then
		xwperson = 0
	else
		xwperson = personid
	end
	for i = 1, CC.TeamNum do
		if xwperson == JY.Base["¶ÓÎé" .. i] then
			r = true
			break;
		end
	end
	return r
end

function instruct_17(sceneid, level, x, y, v)
	if sceneid == -2 then
		sceneid = JY.SubScene
	end
	SetS(sceneid, x, y, level, v)
end

function instruct_18(thingid,sl)
	if sl == nil then
		for i = 1, CC.MyThingNum do
			if JY.Base["ÎïÆ·" .. i] == thingid then
				return true
			end
		end
	else
		for i = 1, CC.MyThingNum do
			if JY.Base["ÎïÆ·" .. i] == thingid and JY.Base["ÎïÆ·ÊıÁ¿" .. i] >= sl then
				return true
			end
		end
	end	
	return false
end

function instruct_19(x, y)
	JY.Base["ÈËX1"] = x
	JY.Base["ÈËY1"] = y
	JY.SubSceneX = 0
	JY.SubSceneY = 0
end

function instruct_20()
	if JY.Base["¶ÓÎé" .. CC.TeamNum] >= 0 then
		return true
	end
	return false
end

--Àë¶Óº¯Êı
function instruct_21(personid)
	if JY.Person[personid] == nil then
		lib.Debug("instruct_21 error: personid not exist")
		return 
	end
	local j = 0
	for i = 1, CC.TeamNum do
		if personid == JY.Base["¶ÓÎé" .. i] then
		  j = i
		end
	end
	if j == 0 then
		return 
	end
	for i = j + 1, CC.TeamNum do
		JY.Base["¶ÓÎé" .. i - 1] = JY.Base["¶ÓÎé" .. i]
	end
	JY.Base["¶ÓÎé" .. CC.TeamNum] = -1
	if JY.Person[personid]["ÎäÆ÷"] >= 0 then
		JY.Thing[JY.Person[personid]["ÎäÆ÷"]]["Ê¹ÓÃÈË"] = -1
		JY.Person[personid]["ÎäÆ÷"] = -1
	end
	if JY.Person[personid]["·À¾ß"] >= 0 then
		JY.Thing[JY.Person[personid]["·À¾ß"]]["Ê¹ÓÃÈË"] = -1
		JY.Person[personid]["·À¾ß"] = -1
	end
	if JY.Person[personid]["×øÆï"] >= 0 then
		JY.Thing[JY.Person[personid]["×øÆï"]]["Ê¹ÓÃÈË"] = -1
		JY.Person[personid]["×øÆï"] = -1
	end	
	if JY.Person[personid]["ĞŞÁ¶ÎïÆ·"] >= 0 then
		JY.Thing[JY.Person[personid]["ĞŞÁ¶ÎïÆ·"]]["Ê¹ÓÃÈË"] = -1
		JY.Person[personid]["ĞŞÁ¶ÎïÆ·"] = -1
	end
	JY.Person[personid]["ÎïÆ·ĞŞÁ¶µãÊı"] = 0
end

function instruct_22()
	for i = 1, CC.TeamNum do
		if JY.Base["¶ÓÎé" .. i] >= 0 then
			JY.Person[JY.Base["¶ÓÎé" .. i]]["ÄÚÁ¦"] = 0
		end
	end
end

function instruct_23(personid, value)
	JY.Person[personid]["ÓÃ¶¾ÄÜÁ¦"] = value
	AddPersonAttrib(personid, "ÓÃ¶¾ÄÜÁ¦", 0)
end

function instruct_24()
	instruct_test("Ö¸Áî24²âÊÔ")
end

--¾µÍ·ÒÆ¶¯
function instruct_25(x1, y1, x2, y2)
	if JY.Restart == 1 then
		return
	end
	local sign = nil
	if y1 ~= y2 then
		if y2 < y1 then
			sign = -1
		else
			sign = 1
		end
		for i = y1 + sign, y2, sign do
			lib.GetKey()
			local t1 = lib.GetTime()
			JY.SubSceneY = JY.SubSceneY + sign
			DrawSMap()
			ShowScreen()
			local t2 = lib.GetTime()
			if t2 - t1 < CC.SceneMoveFrame then
				lib.Delay(CC.SceneMoveFrame - (t2 - t1))
			end
		end
	end
	if x1 ~= x2 then
		if x2 < x1 then
			sign = -1
		else
			sign = 1
		end
		for i = x1 + sign, x2, sign do
			lib.GetKey()
			local t1 = lib.GetTime()
			JY.SubSceneX = JY.SubSceneX + sign
			DrawSMap()
			ShowScreen()
			local t2 = lib.GetTime()
			if t2 - t1 < CC.SceneMoveFrame then
				lib.Delay(CC.SceneMoveFrame - (t2 - t1))
			end
		end
	end
end

function instruct_26(sceneid, id, v1, v2, v3)
	if sceneid == -2 then
		sceneid = JY.SubScene
	end
	local v = GetD(sceneid, id, 2)
	SetD(sceneid, id, 2, v + v1)
	v = GetD(sceneid, id, 3)
	SetD(sceneid, id, 3, v + v2)
	v = GetD(sceneid, id, 4)
	SetD(sceneid, id, 4, v + v3)
end

function instruct_27(id, startpic, endpic)
	local old1, old2, old3 = nil
	if id ~= -1 then
		old1 = GetD(JY.SubScene, id, 5)
		old2 = GetD(JY.SubScene, id, 6)
		old3 = GetD(JY.SubScene, id, 7)
	end
	for i = startpic, endpic, 2 do
		lib.GetKey()
		local t1 = lib.GetTime()
		if id == -1 then
			JY.MyPic = i / 2
		else
			SetD(JY.SubScene, id, 5, i)
			SetD(JY.SubScene, id, 6, i)
			SetD(JY.SubScene, id, 7, i)
		end
		DtoSMap()
		DrawSMap()
		ShowScreen()
		local t2 = lib.GetTime()
		if t2 - t1 < CC.AnimationFrame then
			lib.Delay(CC.AnimationFrame - (t2 - t1))
		end
	end
	if id ~= -1 then
		SetD(JY.SubScene, id, 5, old1)
		SetD(JY.SubScene, id, 6, old2)
		SetD(JY.SubScene, id, 7, old3)
	end
end

function instruct_28(personid, vmin, vmax)
	local v = JY.Person[personid]["Æ·µÂ"]
	if vmin <= v and v <= vmax then
		return true
	else
		return false
	end
end

function instruct_29(personid, vmin, vmax)
	local v = JY.Person[personid]["¹¥»÷Á¦"]
	if vmin <= v and v <= vmax then
		return true
	else
		return false
	end
end

--ÈËÎï×Ô¶¯ÒÆ¶¯
function instruct_30(x1, y1, x2, y2)
	if JY.Restart == 1 then
		return
	end
  if x1 < x2 then
    for i = x1 + 1, x2 do
      local t1 = lib.GetTime()
      instruct_30_sub1(1)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  elseif x2 < x1 then
    for i = x2 + 1, x1 do
      local t1 = lib.GetTime()
      instruct_30_sub1(2)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  end
  if y1 < y2 then
    for i = y1 + 1, y2 do
      local t1 = lib.GetTime()
      instruct_30_sub1(3)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  elseif y2 < y1 then
    for i = y2 + 1, y1 do
      local t1 = lib.GetTime()
      instruct_30_sub1(0)
      local t2 = lib.GetTime()
      if t2 - t1 < CC.PersonMoveFrame then
        lib.Delay(CC.PersonMoveFrame - (t2 - t1))
      end
    end
  end
end

function instruct_30_sub1(direct)
  local x, y = nil, nil
  AddMyCurrentPic()
  x = JY.Base["ÈËX1"] + CC.DirectX[direct + 1]
  y = JY.Base["ÈËY1"] + CC.DirectY[direct + 1]
  JY.Base["ÈË·½Ïò"] = direct
  JY.MyPic = GetMyPic()
  DtoSMap()
  if SceneCanPass(x, y) == true then
    JY.Base["ÈËX1"] = x
    JY.Base["ÈËY1"] = y
  end
  JY.Base["ÈËX1"] = limitX(JY.Base["ÈËX1"], 1, CC.SWidth - 2)
  JY.Base["ÈËY1"] = limitX(JY.Base["ÈËY1"], 1, CC.SHeight - 2)
  DrawSMap()
  ShowScreen()
  return 1
end

function instruct_30_sub(direct)
  local x, y = nil, nil
  local d_pass = GetS(JY.SubScene, JY.Base["ÈËX1"], JY.Base["ÈËY1"], 3)

  if d_pass >= 0 and d_pass ~= JY.OldDPass then
    EventExecute(d_pass, 3)
    JY.OldDPass = d_pass
    JY.oldSMapX = -1
    JY.oldSMapY = -1
    JY.D_Valid = nil
  end

  JY.OldDPass = -1
  local isout = 0
  if (((JY.Scene[JY.SubScene]["³ö¿ÚX1"] == JY.Base["ÈËX1"] and JY.Scene[JY.SubScene]["³ö¿ÚY1"] == JY.Base["ÈËY1"]) or JY.Scene[JY.SubScene]["³ö¿ÚX2"] ~= JY.Base["ÈËX1"] or JY.Scene[JY.SubScene]["³ö¿ÚY2"] == JY.Base["ÈËY1"] or JY.Scene[JY.SubScene]["³ö¿ÚX3"] == JY.Base["ÈËX1"] and JY.Scene[JY.SubScene]["³ö¿ÚY3"] == JY.Base["ÈËY1"])) then
    isout = 1
  end
  if isout == 1 then
    JY.Status = GAME_MMAP
    --lib.PicInit()
    CleanMemory()
    lib.ShowSlow(20, 1)
    if JY.MmapMusic < 0 then
      JY.MmapMusic = JY.Scene[JY.SubScene]["³öÃÅÒôÀÖ"]
    end
    Init_MMap()
    JY.SubScene = -1
    JY.oldSMapX = -1
    JY.oldSMapY = -1
    lib.DrawMMap(JY.Base["ÈËX"], JY.Base["ÈËY"], GetMyPic())
    lib.ShowSlow(20, 0)
    lib.GetKey()
    return 
  end
  if JY.Scene[JY.SubScene]["Ìø×ª³¡¾°"] >= 0 and JY.Base["ÈËX1"] == JY.Scene[JY.SubScene]["Ìø×ª¿ÚX1"] and JY.Base["ÈËY1"] == JY.Scene[JY.SubScene]["Ìø×ª¿ÚY1"] then
    JY.SubScene = JY.Scene[JY.SubScene]["Ìø×ª³¡¾°"]
    lib.ShowSlow(20, 1)
    if JY.Scene[JY.SubScene]["Íâ¾°Èë¿ÚX1"] == 0 and JY.Scene[JY.SubScene]["Íâ¾°Èë¿ÚY1"] == 0 then
      JY.Base["ÈËX1"] = JY.Scene[JY.SubScene]["Èë¿ÚX"]
      JY.Base["ÈËY1"] = JY.Scene[JY.SubScene]["Èë¿ÚY"]
    else
      JY.Base["ÈËX1"] = JY.Scene[JY.SubScene]["Ìø×ª¿ÚX2"]
      JY.Base["ÈËY1"] = JY.Scene[JY.SubScene]["Ìø×ª¿ÚY2"]
    end
    Init_SMap(1)
    return 
  end
  AddMyCurrentPic()
  x = JY.Base["ÈËX1"] + CC.DirectX[direct + 1]
  y = JY.Base["ÈËY1"] + CC.DirectY[direct + 1]
  JY.Base["ÈË·½Ïò"] = direct
  JY.MyPic = GetMyPic()
  DtoSMap()
  if SceneCanPass(x, y) == true then
    JY.Base["ÈËX1"] = x
    JY.Base["ÈËY1"] = y
  end
  JY.Base["ÈËX1"] = limitX(JY.Base["ÈËX1"], 1, CC.SWidth - 2)
  JY.Base["ÈËY1"] = limitX(JY.Base["ÈËY1"], 1, CC.SHeight - 2)
  DrawSMap()
  ShowScreen()
  return 1
end

--¼ÆËãÇ®ÊÇ·ñ×ã¹»
function instruct_31(num)
	local r = false
    if num <= CC.Gold then 
        return true    
    end
	return r
end

--Ôö¼Ó£¬¼õÉÙÎïÆ·µÄº¯Êı
function instruct_32(thingid, num)
	local p = 1
	--Ê×ÏÈ¿ØÖÆ»ñÈ¡ÊıÁ¿£¬³¬¹ı30000×Ô¶¯Ëã30000
	for i = 1, CC.MyThingNum do
		if JY.Base["ÎïÆ·" .. i] == thingid then
			if thingid == 174 then 
				--JY.Base["ÎïÆ·ÊıÁ¿" .. i] = 0
				p = i
				break;
			else
			    --ÒÑ¾­ÓĞÒ»¶¨ÊıÁ¿µÄÎïÆ·£¬Èç¹ûÏà¼ÓÖ®ºó³¬¹ı30000£¬°´30000Ëã
			    if (JY.Base["ÎïÆ·ÊıÁ¿" .. i] + num) > 30000 then
				    JY.Base["ÎïÆ·ÊıÁ¿" .. i] = 30000
			    else
				    JY.Base["ÎïÆ·ÊıÁ¿" .. i] = JY.Base["ÎïÆ·ÊıÁ¿" .. i] + num
			    end
			    p = i
			    break;
			end	
		elseif JY.Base["ÎïÆ·" .. i] == -1 then
			if thingid == 174 then 
				JY.Base["ÎïÆ·" .. i] = thingid
				--JY.Base["ÎïÆ·ÊıÁ¿" .. i] = 0
				p = i
				break;
			else	
			    JY.Base["ÎïÆ·" .. i] = thingid
			    JY.Base["ÎïÆ·ÊıÁ¿" .. i] = num
			    p = i
			    break;
			end
		end
	end
	
	--»ñÈ¡ÒøÁ½µÄÊ±ºòË¢ĞÂÒøÁ½ÏÔÊ¾
	if thingid == CC.MoneyID then
		CC.Gold = CC.Gold + num--JY.Base["ÎïÆ·ÊıÁ¿" .. p]
		if CC.Gold < 0 then 
			CC.Gold = 0
		end
	end
  
  
	--»ñµÃÌìÊé£¬Ôö¼Ó15µãÉùÍû
	--»ñµÃµÄÊ±ºò²ÅÔö¼Ó
	if num > 0 and thingid >= CC.BookStart and thingid < CC.BookStart + CC.BookNum then
		JY.Person[0]["ÉùÍû"] = JY.Person[0]["ÉùÍû"] + 15;
		JY.Base["ÌìÊéÊıÁ¿"] = JY.Base["ÌìÊéÊıÁ¿"] + 1
		--ÎŞ¾Æ²»»¶£ºÓÃ520ºÅÈËÎïµÄÆ·µÂÅĞ¶¨¿ÉÒÔÕªÈ¡µÄó´ÌÒÊıÁ¿
		--Ìæ»»ó´ÌÒÊ÷ÌùÍ¼
		JY.Person[520]["Æ·µÂ"] = JY.Person[520]["Æ·µÂ"] + 1
		--ÔÚÒÑ¾­ÖÖ¹ıÊ÷µÄÇé¿öÏÂ£¬Ê÷»á½á¹û£¬ÓÃ521ºÅÈËÎïµÄÆ·µÂÅĞ¶¨ÊÇ·ñÒÑ´¥·¢ÖÖÊ÷ÊÂ¼ş
		if JY.Person[521]["Æ·µÂ"] == 1 then
			addevent(70, 65, 1, 4119, 1, 2366*2)
		end

	end
	
	if JY.Base["ÎïÆ·ÊıÁ¿" .. p] <= 0 then
        if thingid == 174 then
            if CC.Gold <= 0 then
                for i = p + 1, CC.MyThingNum do
                    JY.Base["ÎïÆ·" .. i - 1] = JY.Base["ÎïÆ·" .. i]
                    JY.Base["ÎïÆ·ÊıÁ¿" .. i - 1] = JY.Base["ÎïÆ·ÊıÁ¿" .. i]
                end
                JY.Base["ÎïÆ·" .. CC.MyThingNum] = -1
                JY.Base["ÎïÆ·ÊıÁ¿" .. CC.MyThingNum] = 0
            end    
		else
		    for i = p + 1, CC.MyThingNum do
		        JY.Base["ÎïÆ·" .. i - 1] = JY.Base["ÎïÆ·" .. i]
		        JY.Base["ÎïÆ·ÊıÁ¿" .. i - 1] = JY.Base["ÎïÆ·ÊıÁ¿" .. i]
		    end
			JY.Base["ÎïÆ·" .. CC.MyThingNum] = -1
			JY.Base["ÎïÆ·ÊıÁ¿" .. CC.MyThingNum] = 0
		end
	end
end

--ÈËÎïÑ§»áÎä¹¦
function instruct_33(personid, wugongid, flag)
	local xwperson;	--ÅĞ¶¨ÒªÏ´Îä¹¦µÄÈË
	xwperson = personid

	local add = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		if JY.Person[xwperson]["Îä¹¦" .. i] == 0 then
			JY.Person[xwperson]["Îä¹¦" .. i] = wugongid
			JY.Person[xwperson]["Îä¹¦µÈ¼¶" .. i] = 0
			add = 1		
			break;
		end
	end
	if add == 0 then
		JY.Person[xwperson]["Îä¹¦"..JY.Base["Îä¹¦ÊıÁ¿"]] = wugongid
		JY.Person[xwperson]["Îä¹¦µÈ¼¶"..JY.Base["Îä¹¦ÊıÁ¿"]] = 0
	end
    if isteam(xwperson) then 
        Hp_Max(xwperson)
    end
	if xwperson ~= 0 and (personid == JY.Base["³©Ïë"] or personid == 0) then
		xwperson = 0
		local add = 0
		for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
			if JY.Person[xwperson]["Îä¹¦" .. i] == 0 then
				JY.Person[xwperson]["Îä¹¦" .. i] = wugongid
				JY.Person[xwperson]["Îä¹¦µÈ¼¶" .. i] = 0
				add = 1		
				break;
			end
		end
		if add == 0 then
			JY.Person[xwperson]["Îä¹¦"..JY.Base["Îä¹¦ÊıÁ¿"]] = wugongid
			JY.Person[xwperson]["Îä¹¦µÈ¼¶"..JY.Base["Îä¹¦ÊıÁ¿"]] = 0
		end
        Hp_Max(xwperson)
	end
	
	for i,v in pairs(CC.Copy) do 
		if v == personid then
			xwperson = i
            local add = 0
            for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                if JY.Person[xwperson]["Îä¹¦" .. i] == 0 then
                    JY.Person[xwperson]["Îä¹¦" .. i] = wugongid
                    JY.Person[xwperson]["Îä¹¦µÈ¼¶" .. i] = 0
                    add = 1		
                    break;
                end
            end
            if add == 0 then
                JY.Person[xwperson]["Îä¹¦"..JY.Base["Îä¹¦ÊıÁ¿"]] = wugongid
                JY.Person[xwperson]["Îä¹¦µÈ¼¶"..JY.Base["Îä¹¦ÊıÁ¿"]] = 0
            end
			break
		end
	end
	
	if flag == 0 then
		DrawStrBoxWaitKey(string.format("%s Ñ§»áÎä¹¦ %s", JY.Person[xwperson]["ĞÕÃû"], JY.Wugong[wugongid]["Ãû³Æ"]), C_ORANGE, CC.DefaultFont)
	end
	
end

--¸Ä±ä×ÊÖÊ
function instruct_34(id, value)
	local xwperson;	--ÅĞ¶¨ÈËÎï
	if id == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "×ÊÖÊ", value)
	DrawStrBoxWaitKey(JY.Person[xwperson]["ĞÕÃû"] .. str, C_ORANGE, CC.DefaultFont)
end

--Ï´Îä¹¦º¯Êı
function instruct_35(personid, id, wugongid, wugonglevel)
	local xwperson;	--ÅĞ¶¨ÒªÏ´Îä¹¦µÄÈË
	xwperson = personid
	local r = 0
	local gz = {'µÚÒ»¸ñ','µÚ¶ş¸ñ','µÚÈı¸ñ','µÚËÄ¸ñ','µÚÎå¸ñ','µÚÁù¸ñ','µÚÆß¸ñ','µÚ°Ë¸ñ','µÚ¾Å¸ñ','µÚÊ®¸ñ','µÚÊ®Ò»¸ñ','µÚÊ®¶ş¸ñ','µÚÊ®Èı¸ñ','µÚÊ®ËÄ¸ñ','µÚÊ®Îå¸ñ'}
	if inteam(personid) then
		r = JYMsgBox("Ï´Îä¹¦",JY.Person[personid]["ĞÕÃû"].."ÊÇ·ñÒª"..gz[id+1].."Ï´"..JY.Wugong[wugongid]["Ãû³Æ"].."£¿", {"ÊÇ","·ñ"}, 2, 189)
	else
		r = 1
	end	
	if r == 1  then
		--±»Ï´µôµÄÎä¹¦´Ó×Ô¶¯ÁĞ±íÇå³ı
		if JY.Person[xwperson]["Îä¹¦" .. id + 1] > 0 and JY.Person[xwperson]["Îä¹¦" .. id + 1] ~= wugongid then
			if JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["ÓÅÏÈÊ¹ÓÃ"] then
				JY.Person[xwperson]["ÓÅÏÈÊ¹ÓÃ"] = 0
			end	
			if JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["Ö÷ÔËÄÚ¹¦"] then
				JY.Person[xwperson]["Ö÷ÔËÄÚ¹¦"] = 0
			end	
			if JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["Ö÷ÔËÇá¹¦"] then
				JY.Person[xwperson]["Ö÷ÔËÇá¹¦"] = 0
			end
		end
		if isteam(xwperson) then 
			Hp_Max(xwperson)
		end
		local pd = 0
		for k = 1, JY.Base['Îä¹¦ÊıÁ¿'] do
			if JY.Person[xwperson]["Îä¹¦"..k] == wugongid then
				JY.Person[xwperson]["Îä¹¦µÈ¼¶"..k] = wugonglevel
				pd = 1
				break
			end
		end		
		if pd == 0 then
			JY.Person[xwperson]["Îä¹¦" .. id + 1] = wugongid
			JY.Person[xwperson]["Îä¹¦µÈ¼¶" .. id + 1] = wugonglevel
		end	
		

		if personid == JY.Base["³©Ïë"] then
			if DrawStrBoxYesNo(-1,-1,"³©Ïë"..JY.Person[personid]["ĞÕÃû"].."ÊÇ·ñÒª"..gz[id+1].."Ï´"..JY.Wugong[wugongid]["Ãû³Æ"].."£¿",C_WHITE,CC.DefaultFont) == true then
				xwperson = 0
				--±»Ï´µôµÄÎä¹¦´Ó×Ô¶¯ÁĞ±íÇå³ı
				if JY.Person[xwperson]["Îä¹¦" .. id + 1] > 0 then
					if JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["ÓÅÏÈÊ¹ÓÃ"] then
						JY.Person[xwperson]["ÓÅÏÈÊ¹ÓÃ"] = 0
					elseif JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["Ö÷ÔËÄÚ¹¦"] then
						JY.Person[xwperson]["Ö÷ÔËÄÚ¹¦"] = 0
					elseif JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["Ö÷ÔËÇá¹¦"] then
						JY.Person[xwperson]["Ö÷ÔËÇá¹¦"] = 0
					end
				end
				local pd = 0
				for k = 1, JY.Base['Îä¹¦ÊıÁ¿'] do
					if JY.Person[xwperson]["Îä¹¦"..k] == wugongid  then
						JY.Person[xwperson]["Îä¹¦µÈ¼¶"..k] = wugonglevel
						pd = 1
						break
					end
				end		
				if pd == 0 then
					JY.Person[xwperson]["Îä¹¦" .. id + 1] = wugongid
					JY.Person[xwperson]["Îä¹¦µÈ¼¶" .. id + 1] = wugonglevel
				end	
				Hp_Max(xwperson)
			else
			end	
		end
		


		for i,v in pairs(CC.Copy) do 
			if v == personid then
			--if CC.Copy[personid] ~= nil then 
				xwperson = i
				--±»Ï´µôµÄÎä¹¦´Ó×Ô¶¯ÁĞ±íÇå³ı
				if JY.Person[xwperson]["Îä¹¦" .. id + 1] > 0 then
					if JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["ÓÅÏÈÊ¹ÓÃ"] then
						JY.Person[xwperson]["ÓÅÏÈÊ¹ÓÃ"] = 0
					elseif JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["Ö÷ÔËÄÚ¹¦"] then
						JY.Person[xwperson]["Ö÷ÔËÄÚ¹¦"] = 0
					elseif JY.Person[xwperson]["Îä¹¦" .. id + 1] == JY.Person[xwperson]["Ö÷ÔËÇá¹¦"] then
						JY.Person[xwperson]["Ö÷ÔËÇá¹¦"] = 0
					end
				end
				JY.Person[xwperson]["Îä¹¦" .. id + 1] = wugongid
				JY.Person[xwperson]["Îä¹¦µÈ¼¶" .. id + 1] = wugonglevel
				break
			end
		end
    else
		do return end
	end
end

function instruct_36(sex)
	if JY.Person[0]["ĞÔ±ğ"] == sex then
		return true
	else
		return false
	end
end

--ÎŞ¾Æ²»»¶£º¼Ó¼õµÀµÂÏÔÊ¾
function instruct_37(v)
	AddPersonAttrib(0, "Æ·µÂ", v)
	if v < 0 then
		for i = 1, 15 do
			if JY.Restart == 1 then
				break
			end
			local y_off = i * 2 + CC.DefaultFont + CC.RowPixel
			DrawString(CC.ScreenW/2-CC.DefaultFont*5, CC.ScreenH/4 - CC.DefaultFont - CC.RowPixel + y_off, "ÄãµÄµÀµÂÖ¸ÊıÏÂ½µÁË"..-v.."µã", M_DeepSkyBlue, CC.DefaultFont)
			ShowScreen()		  
			lib.Delay(50)
			Cls()
		end
	else
		for i = 1, 15 do
			if JY.Restart == 1 then
				break
			end
			local y_off = i * 2 + CC.DefaultFont + CC.RowPixel
			DrawString(CC.ScreenW/2-CC.DefaultFont*5, CC.ScreenH/4 + 30 + CC.DefaultFont + CC.RowPixel - y_off, "ÄãµÄµÀµÂÖ¸ÊıÌáÉıÁË"..v.."µã", PinkRed, CC.DefaultFont)
			ShowScreen()		  
			lib.Delay(50)
			Cls()
		end
	end
end

function instruct_38(sceneid, level, oldpic, newpic)
	if sceneid == -2 then
		sceneid = JY.SubScene
	end
	for i = 0, CC.SWidth - 1 do
		for j = 1, CC.SHeight - 1 do
			if GetS(sceneid, i, j, level) == oldpic then
				SetS(sceneid, i, j, level, newpic)
			end
		end
	end
end

function instruct_39(sceneid)
	JY.Scene[sceneid]["½øÈëÌõ¼ş"] = 0
end

function instruct_40(v)
	
	if v == '±±' then
		v = 0
	elseif v == '¶«' then
		v = 1
	elseif v == 'Î÷' then
		v = 2
	elseif v == 'ÄÏ' then
		v = 3
	end				
	JY.Base["ÈË·½Ïò"] = v
	JY.MyPic = GetMyPic()
	stands()
end

function instruct_41(personid, thingid, num)
	local k = 0
	for i = 1, 4 do
		if JY.Person[personid]["Ğ¯´øÎïÆ·" .. i] == thingid then
			JY.Person[personid]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i] = JY.Person[personid]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i] + num
			k = i
			break;
		end
	end
	if k > 0 and JY.Person[personid]["Ğ¯´øÎïÆ·ÊıÁ¿" .. k] <= 0 then
		JY.Person[personid]["Ğ¯´øÎïÆ·" .. k] = -1
	end
	if k == 0 then
		for i = 1, 4 do
			if JY.Person[personid]["Ğ¯´øÎïÆ·" .. i] == -1 then
				JY.Person[personid]["Ğ¯´øÎïÆ·" .. i] = thingid
				JY.Person[personid]["Ğ¯´øÎïÆ·ÊıÁ¿" .. i] = num
				break;
			end
		end
	end
end

function instruct_42()
	local r = false
	for i = 1, CC.TeamNum do
		if JY.Base["¶ÓÎé" .. i] >= 0 and JY.Person[JY.Base["¶ÓÎé" .. i]]["ĞÔ±ğ"] == 1 then
			r = true
		end
	end
	return r
end

function instruct_43(thingid)
	return instruct_18(thingid)
end

function instruct_44(id1, startpic1, endpic1, id2, startpic2, endpic2)
  local old1 = GetD(JY.SubScene, id1, 5)
  local old2 = GetD(JY.SubScene, id1, 6)
  local old3 = GetD(JY.SubScene, id1, 7)
  local old4 = GetD(JY.SubScene, id2, 5)
  local old5 = GetD(JY.SubScene, id2, 6)
  local old6 = GetD(JY.SubScene, id2, 7)
  for i = startpic1, endpic1, 2 do
	lib.GetKey()
    local t1 = lib.GetTime()
    if id1 == -1 then
      JY.MyPic = i / 2
    else
      SetD(JY.SubScene, id1, 5, i)
      SetD(JY.SubScene, id1, 6, i)
      SetD(JY.SubScene, id1, 7, i)
    end
    if id2 == -1 then
      JY.MyPic = i / 2
    else
      SetD(JY.SubScene, id2, 5, i - startpic1 + startpic2)
      SetD(JY.SubScene, id2, 6, i - startpic1 + startpic2)
      SetD(JY.SubScene, id2, 7, i - startpic1 + startpic2)
    end
    DtoSMap()
    DrawSMap()
    ShowScreen()
    local t2 = lib.GetTime()
    if t2 - t1 < CC.AnimationFrame then
      lib.Delay(CC.AnimationFrame - (t2 - t1))
    end
  end
  SetD(JY.SubScene, id1, 5, old1)
  SetD(JY.SubScene, id1, 6, old2)
  SetD(JY.SubScene, id1, 7, old3)
  SetD(JY.SubScene, id2, 5, old4)
  SetD(JY.SubScene, id2, 6, old5)
  SetD(JY.SubScene, id2, 7, old6)
end

--¼ÓÇá
function instruct_45(id, value)
	local xwperson;	--ÅĞ¶¨ÒªÏ´Îä¹¦µÄÈË
	if id == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "Çá¹¦", value)
end

--¼ÓÄÚ
function instruct_46(id, value)
	local xwperson;	--ÅĞ¶¨ÒªÏ´Îä¹¦µÄÈË
	if id == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "ÄÚÁ¦×î´óÖµ", value)
	AddPersonAttrib(xwperson, "ÄÚÁ¦", 0)
end

--¼Ó¹¥
function instruct_47(id, value)
	local xwperson;	--ÅĞ¶¨ÒªÏ´Îä¹¦µÄÈË
	if id == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "¹¥»÷Á¦", value)
end

--¼Ó·À
function add_deffense(id, value)
	local xwperson;	--ÅĞ¶¨ÒªÏ´Îä¹¦µÄÈË
	if id == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "·ÀÓùÁ¦", value)
end

--¼ÓÑª
function instruct_48(id, value)
	local xwperson;	--ÅĞ¶¨ÒªÏ´Îä¹¦µÄÈË
	if id == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = id
	end
	local add, str = AddPersonAttrib(xwperson, "ÉúÃü×î´óÖµ", value)
	AddPersonAttrib(xwperson, "ÉúÃü", value)
end

--Ï´ÄÚÊô
function instruct_49(personid, value)
	local xwperson;	--ÅĞ¶¨ÒªÏ´ÄÚÊôµÄÈË
	if personid == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = personid
	end
	JY.Person[xwperson]["ÄÚÁ¦ĞÔÖÊ"] = value
    JY.Person[personid]["ÄÚÁ¦ĞÔÖÊ"] = value
end

function instruct_50(id1, id2, id3, id4, id5)
  local num = 0
  if instruct_18(id1) == true then
    num = num + 1
  end
  if instruct_18(id2) == true then
    num = num + 1
  end
  if instruct_18(id3) == true then
    num = num + 1
  end
  if instruct_18(id4) == true then
    num = num + 1
  end
  if instruct_18(id5) == true then
    num = num + 1
  end
  if num == 5 then
    return true
  else
    return false
  end
end

function instruct_51()
	instruct_1(2547 + Rnd(18), 114, 0)
end

function instruct_52()
	DrawStrBoxWaitKey(string.format("ÄãÏÖÔÚµÄÆ·µÂÖ¸ÊıÎª: %d", JY.Person[0]["Æ·µÂ"]), C_ORANGE, CC.DefaultFont)
end

function instruct_53()
	DrawStrBoxWaitKey(string.format("ÄãÏÖÔÚµÄÉùÍûÖ¸ÊıÎª: %d", JY.Person[0]["ÉùÍû"]), C_ORANGE, CC.DefaultFont)
end

function instruct_54()
	for i = 0, JY.SceneNum - 1 do
		JY.Scene[i]["½øÈëÌõ¼ş"] = 0
	end
	JY.Scene[2]["½øÈëÌõ¼ş"] = 2
	JY.Scene[38]["½øÈëÌõ¼ş"] = 2
	JY.Scene[75]["½øÈëÌõ¼ş"] = 1
	JY.Scene[80]["½øÈëÌõ¼ş"] = 1
end

function instruct_55(id, num)
	if GetD(JY.SubScene, id, 2) == num then
		return true
	else
		return false
	end
end

function instruct_56(v)
	--JY.Person[0]["ÉùÍû"] = JY.Person[0]["ÉùÍû"] + v
	--instruct_2_sub()
end

function instruct_57()
  instruct_27(-1, 7664, 7674)
  for i = 0, 56, 2 do
    local t1 = lib.GetTime()
    if JY.MyPic < 3844 then
      JY.MyPic = (7676 + i) / 2
    end
    SetD(JY.SubScene, 2, 5, i + 7690)
    SetD(JY.SubScene, 2, 6, i + 7690)
    SetD(JY.SubScene, 2, 7, i + 7690)
    SetD(JY.SubScene, 3, 5, i + 7748)
    SetD(JY.SubScene, 3, 6, i + 7748)
    SetD(JY.SubScene, 3, 7, i + 7748)
    SetD(JY.SubScene, 4, 5, i + 7806)
    SetD(JY.SubScene, 4, 6, i + 7806)
    SetD(JY.SubScene, 4, 7, i + 7806)
    DtoSMap()
    DrawSMap()
    ShowScreen()
    local t2 = lib.GetTime()
    if t2 - t1 < CC.AnimationFrame then
      lib.Delay(CC.AnimationFrame - (t2 - t1))
    end
  end
end

function instruct_58()
  local group = 5
  local num1 = 6
  local num2 = 3
  local startwar = 102
  local flag = {}
  for i = 0, group - 1 do
    for j = 0, num1 - 1 do
      flag[j] = 0
    end
    for j = 1, num2 do
      local r = nil
      while 1 do
        r = Rnd(num1)
        if flag[r] == 0 then
          flag[r] = 1
          do break end
        end
      end
      local warnum = r + i * num1
      WarLoad(warnum + startwar)
      instruct_1(2854 + warnum, WAR.Data["µĞÈË1"], 0)
      instruct_0()
      if WarMain(warnum + startwar, 0) == true then
        instruct_0()
        instruct_13()
        TalkEx("»¹ÓĞÄÇÎ»Ç°±²¿Ï´Í½Ì£¿", 0, 1)
        instruct_0()
      else
        instruct_15()
        return 
      end
    end
    if i < group - 1 then
      TalkEx(JY.Person[0]["ÍâºÅ"].."ÒÑÁ¬Õ½Èı³¡£¬*¿ÉÏÈĞİÏ¢ÔÙÕ½£®", 70, 0)
      instruct_0()
      instruct_14()
      lib.Delay(300)
      if JY.Person[0]["ÊÜÉË³Ì¶È"] < 50 and JY.Person[0]["ÖĞ¶¾³Ì¶È"] <= 0 then
        JY.Person[0]["ÊÜÉË³Ì¶È"] = 0
        AddPersonAttrib(0, "ÌåÁ¦", math.huge)
        AddPersonAttrib(0, "ÄÚÁ¦", math.huge)
        AddPersonAttrib(0, "ÉúÃü", math.huge)
      end
      instruct_13()
      TalkEx("ÎÒÒÑ¾­ĞİÏ¢¹»ÁË£¬*ÓĞË­ÒªÔÙÉÏ£¿", 0, 1)
      instruct_0()
    end
  end
  TalkEx("½ÓÏÂÀ´»»Ë­£¿**£®£®£®£®*£®£®£®£®***Ã»ÓĞÈËÁËÂğ£¿", 0, 1)
  instruct_0()
  TalkEx("Èç¹û»¹Ã»ÓĞÈËÒª³öÀ´ÏòÕâÎ»*"..JY.Person[0]["ÍâºÅ"].."ÌôÕ½£¬ÄÇ÷áÕâÎä¹¦ÌìÏÂ*µÚÒ»Ö®Ãû£¬ÎäÁÖÃËÖ÷Ö®Î»£¬*¾ÍÓÉÕâÎ»"..JY.Person[0]["ÍâºÅ"].."¶áµÃ£®***£®£®£®£®£®£®*£®£®£®£®£®£®*£®£®£®£®£®£®*ºÃ£¬¹§Ï²"..JY.Person[0]["ÍâºÅ"].."£¬ÕâÎäÁÖÃËÖ÷*Ö®Î»¾ÍÓÉ"..JY.Person[0]["ÍâºÅ"].."»ñµÃ£¬¶øÕâ°Ñ*¡±ÎäÁÖÉñÕÈ¡±Ò²ÓÉÄã±£¹Ü£®", 70, 0)
  instruct_0()
  TalkEx("¹§Ï²"..JY.Person[0]["ÍâºÅ"].."£¡", 12, 0)
  instruct_0()
  TalkEx("Ğ¡ĞÖµÜ£¬¹§Ï²Äã£¡", 64, 4)
  instruct_0()
  TalkEx("ºÃ£¬½ñÄêµÄÎäÁÖ´ó»áµ½´ËÒÑ*Ô²Âú½áÊø£¬Ï£ÍûÃ÷Äê¸÷Î»Îä*ÁÖÍ¬µÀÄÜÔÙµ½ÎÒ»ªÉ½Ò»ÓÎ£®", 19, 0)
  instruct_0()
  instruct_14()
  for i = 24, 72 do
    instruct_3(-2, i, 0, 0, -1, -1, -1, -1, -1, -1, -2, -2, -2)
  end
  instruct_0()
  instruct_13()
  TalkEx("Àú¾­Ç§ĞÁÍò¿à£¬ÎÒÖÕì¶´ò°Ü*ÈºĞÛ£¬µÃµ½ÕâÎäÁÖÃËÖ÷Ö®Î»*¼°ÉñÕÈ£®*µ«ÊÇ¡±Ê¥ÌÃ¡±ÔÚÄÇÄØ£¿*ÎªÊ²÷áÃ»ÈË¸æËßÎÒ£¬ÄÑµÀ´ó*¼Ò¶¼²»ÖªµÀ£®*Õâ»á¶ùÓÖÓĞµÄÕÒÁË£®", 0, 1)
  instruct_0()
  instruct_2(143, 1)
end

--È«²¿¶ÓÓÑÀë¶Ó
function instruct_59()
	for i = CC.TeamNum, 2, -1 do
		if JY.Base["¶ÓÎé" .. i] >= 0 then
			instruct_21(JY.Base["¶ÓÎé" .. i])
		end
	end
	for i,v in ipairs(CC.AllPersonExit) do
		instruct_3(v[1], v[2], 0, 0, -1, -1, -1, -1, -1, -1, 0, -2, -2)
	end
end

function instruct_60(sceneid, id, num)
  if sceneid == -2 then
    sceneid = JY.SubScene
  end
  if id == -2 then
    id = JY.CurrentD
  end
  if GetD(sceneid, id, 5) == num then
    return true
  else
    return false
  end
end

function instruct_61()
  for i = 11, 24 do
    if GetD(JY.SubScene, i, 5) ~= 4664 then
      return false
    end
  end
  return true
end

--Í¨¹Øº¯Êı
function instruct_62(id1, startnum1, endnum1, id2, startnum2, endnum2)
	--JY.MyPic = -1
	--instruct_44(id1, startnum1, endnum1, id2, startnum2, endnum2)
	--ShowScreen()
	lib.Delay(200)
	say("±¾´ÎÓÎÏ·¾Íµ½ÕâÀïÁË£¬Ñ¡ÔñÖØĞÂ¿ªÊ¼¿É½øĞĞÏÂÒ»ÖÜÄ¿µÄÓÎÏ·£¡", 260, 5, "ÎŞ¾Æ²»»¶")
	lib.PlayMPEG("ending.mp4",VK_ESCAPE)	
    os.remove(CONFIG.DataPath..'TgJl')
	--tgsave()
    
	--Ôö¼ÓÖÜÄ¿
	local x = AddZM()
	if JY.Base["ÖÜÄ¿"] == CC.Week and CC.Jl == 0 then		
		CC.Jl = 1
		CC.Sp = JY.Base["ËéÆ¬"] + x	
		DrawStrBoxWaitKey("»ñµÃ¡¾£ÇÃØÎä²ĞÕÂ£Ï¡¿¡Á"..x, C_ORANGE, CC.DefaultFont, 2)
	end
	tgsave()
	Cls()
	lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_BLACK)
	DrawString(350, 200, "Æ¬Î²Çú¡¶ËÄ´óÉ½¡·", C_WHITE, CC.DefaultFont)
	DrawString(375, 300, "Ñİ³ª£ºÀÏ·²×Ü", C_WHITE, CC.DefaultFont)
	ShowScreen()
  
	PlayMIDI(116)
	local stime = 0
	local a = 1
	local lyrics = {
	{530,"ÏÅ ½üÍò¸öĞ¡Ê± ¾«ĞÄ´òÄ¥"},
	{560,"×öÓÎÏ·ÎªÁËÊ²Ã´ÀäĞ¦×Å"},
	{590,"Ç°±²ÔªÀÏ¹¦¸ßÓÖÈçºÎ"},
	{610,"¿ªÔ´ÂëÎÒËæÊÖ¿ÉµÃ"},
	{640,"ÎÒµÄ ¼ÓÃÜÁËµÃ È´ÄÎºÎ ÔŞÖú»¹²»¹»¶à"},
	{680,"½­ºşÄÑ²â ÈËÉµÇ®¶à Ë­ÕùÁù¼¶»áÔ±µÄ×Ê¸ñ"},
	{730,"ÂÛÌ³Àï ·¢ÌûÒªÍ³Ò» ·ñÔòÇëÀëÈ¥"},
	{810,"³ä¹ıÇ®µÄ** ÎÒ¼ÇµÃÄã ÄãÔÙÀ´³äÒ»±Ê"},
	{920,"³­³­ ³­³­ ³­³­³­³­"},
	{940,"³­Ï®À´µÄ´úÂëÕæµÄ²»´í"},
	{970,"ÎÒÎÒ ÎÒÎÒ ÎÒÎÒÎÒÎÒ"},
	{1000,"Ö»Òª¼ÓÃÜËüÃÇ¾ÍÊÇÎÒµÄ"},
	{1030,"×÷×÷ ×÷×÷ ×÷×÷×÷×÷"},
	{1050,"¹ú²úÂÌÉ«ÒæÖÇµ¥»ú´ó×÷"},
	{1070,"ÄãÄã ÄãÄã ÄãÄãÄãÄã"},
	{1100,"ÄãµÄÇ®°üÖÕ¾¿ÒªÊôÓÚÎÒ"},
	{1220,"ÏÅ ÒõÄ±ÆÆ»µÕß ÔÚÂÛÌ³µÈ×Å"},
	{1250,"½²µÀÀí Ó®ÁËÊ²Ã´ É¾·â³Á"},
	{1280,"ÌìÏÂË­µÄ Ô­´´ÓÖÈçºÎ"},
	{1300,"¿ªÔ´Âë ÎÒ±²ÉÆ³­Ï®"},
	{1320,"ÎÒµÄÓÎÏ·ÈÈÃÅ È´ÄÎºÎ"},
	{1350,"Í½ÔöĞéÃûÒ»¸ö"},
	{1370,"Ã»ÓĞÔŞÖú ¶¼ÊÇÀ±¼¦"},
	{1390,"Ë­ÕùÈÈĞÄÍæ¼ÒµÄ×Ê¸ñ"},
	{1410,"Ğ¡³ÇÀï ËêÔÂÁ÷¹ıÈ¥ Çå³ºÇ®°üÀï"},
	{1510,"³ä¹ıÇ®µÄ** ÎÒ¼ÇµÃÄã ½¾°ÁµÄ»îÏÂÈ¥"},
	{1610,"³­³­ ³­³­ ³­³­³­³­"},
	{1630,"³­¹ıÀ´µÄ´úÂëÕæµÄÊµÓÃ"},
	{1660,"·¢·¢ ·¢·¢ ·¢·¢·¢·¢"},
	{1680,"²»·¢ÌûËµ¾ÍÃ»ÔŞÖúÊÕÈë"},
	{1710,"¹ı¹ı ¹ı¹ı ¹ı¹ı¹ı¹ı"},
	{1730,"¹ı´íÈíÈõ´ÓÀ´²»ÊôÓÚÎÒ"},
	{1760,"ÄãÄã ÄãÄã ÄãÄãÄãÄã"},
	{1780,"ÄãµÄÇ®°üÖÕ¾¿ÒªÊôÓÚÎÒ"},
	{2100,"³­³­ ³­³­ ³­³­³­³­"},
	{2120,"³­Ï®À´µÄ´úÂëÕæµÄ²»´í"},
	{2140,"ÎÒÎÒ ÎÒÎÒ ÎÒÎÒÎÒÎÒ"},
	{2170,"Ö»Òª¼ÓÃÜËüÃÇ¾ÍÊÇÎÒµÄ"},
	{2190,"×÷×÷ ×÷×÷ ×÷×÷×÷×÷"},
	{2210,"¹ú²úÂÌÉ«ÒæÖÇµ¥»ú´ó×÷"},
	{2240,"ÄãÄã ÄãÄã ÄãÄãÄãÄã"},
	{2260,"ÄãµÄÇ®°üÖÕ¾¿ÒªÊôÓÚÎÒ"},
	{2310,"ÂÛÌ³Àï ·¢ÌûÒªÍ³Ò» ·ñÔòÇëÀëÈ¥"},
	{2390,"³ä¹ıÇ®µÄ** ÎÒ¼ÇµÃÄã ÄãÔÙÀ´³äÒ»±Ê"},
	{2700,"È«¾çÖÕ ¸ĞĞ»Ö§³Ö"},
	{2750," "}
	}
	while true do
		if JY.Restart == 1 then
			break
		end
		local key = lib.GetKey()
		lib.Delay(100)
		stime = stime + 1
		if stime == lyrics[a][1] then
			local size = CC.DefaultFont
			Cls()
			lib.FillColor(0, 0, CC.ScreenW, CC.ScreenH, C_BLACK)
			DrawString(350, 200, "Æ¬Î²Çú¡¶ËÄ´óÉ½¡·", C_WHITE, size)
			DrawString(375, 300, "Ñİ³ª£ºÀÏ·²×Ü", C_WHITE, size)
			local align = CC.ScreenW/2 - (string.len(lyrics[a][2])/2*size)/2
			DrawString(align, 500, lyrics[a][2], C_WHITE, size)
			ShowScreen()
			a = a + 1
		end
		if a > #lyrics then
			break
		end
		if key == VK_ESCAPE then
			break
		end
	end
	
	Cls()

	JY.Status=GAME_END;
end

function instruct_63(personid, sex)
	JY.Person[personid]["ĞÔ±ğ"] = sex
end

function yxshop()
    local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*1.5
	local size1 = CC.DefaultFont*0.7
	local size2 = CC.DefaultFont*0.8
	local cont = 1 
	local cont1 = 0
	local cont2 = 0
	local jg = bx*4
    local page = 1
    local pc = 50
    local pc1 = 50
    local pc2 = 60
    local m_left = JY.Base["ËéÆ¬"]
	local t_price = 0
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cls()
        lib.LoadPNG(91, 61 * 2 , 0, 0, 1)
		for i = 1,5 do
			for j = 1,5 do
				local cl = 6
				local col = C_GOLD
				local p = i + (j-1+cont2)*14
				local zx = bx*419+(i-1)*(bx*100+jg)-50
				local zy = by*142+(j-1)*(by*100+jg)-50
				if cont+cont1*5 == p then
					cl = 2
					col = C_WHITE
                end
                if page == 1 then 
                    cl = 2
                end
				if CC.commodity[p] ~= nil then
					local plx = CC.commodity[p]
					local pic = plx[1]
                    lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
                    if page == 1 and cont+cont1*5 == p then 
                        lib.LoadPNG(91, pc * 2 , zx+50,zy+50, 2)
                        pc = pc + 1
                        if pc > pc2 then 
                            pc = pc1
                        end
					end
							
                    --DrawString(zx+bx*30-string.len(plx[5])*size1+size1,zy-by*45,plx[5], C_WHITE, size1)
                    --if page == 2 and cont+cont1*5 == p then
                        --DrawString(zx+bx*30-string.len(plx[3])*size1+size1,zy+by*25,plx[3], C_WHITE, size1)
                    --end
				end	
			end
		end

        if CC.commodity[cont+cont1*5] ~= nil then
            local plx = CC.commodity[cont+cont1*5]
            local pic = plx[1]
            --
            --DrawString(bx*405,by*640-size2,JY.Thing[pic]['ÎïÆ·ËµÃ÷'], C_ORANGE, size2)
            DrawString(bx*405,by*638-size1,plx[4], C_WHITE, size1)
            DrawString(bx*405,by*663-size1,'µ±Ç°ÊıÁ¿£º'..plx[5], C_WHITE, size1)
            DrawString(bx*405,by*688-size1,'¹ºÂòÊıÁ¿£º'..plx[3], C_WHITE, size1)
        end
        lib.Background(bx*70, by*520, bx*300,by*650, 150)
        DrawString(bx*80,by*550-size2,'¼Û¸ñ:'..CC.commodity[cont+cont1*5][2], C_WHITE, size2)
        DrawString(bx*80,by*580-size2,'×Ü¶î:'..JY.Base["ËéÆ¬"], C_WHITE, size2)
        DrawString(bx*80,by*610-size2,'»¨·Ñ:'..t_price, C_WHITE, size2)
        DrawString(bx*80,by*640-size2,'Óà¶î:'..m_left, C_WHITE, size2)


		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
            if page == 1 then 
                page = 2
            else 
                JY.Base["ËéÆ¬"] = m_left
                CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                CC.commodity[cont+cont1*5][3] = 0
				page = 1
				if CC.commodity[cont+cont1*5][5] > 0 then
				instruct_2(CC.commodity[cont+cont1*5][1],CC.commodity[cont+cont1*5][5])
				CC.commodity[cont+cont1*5][5] = 0
				--CC.Sp = CC.Sp - t_price
				m_left = JY.Base["ËéÆ¬"] - t_price 
				end
            end
        elseif X == VK_ESCAPE or ktype == 4 then
            CC.commodity[cont+cont1*5][3] = 0
            if page == 2 then 
                page = 1 
            else     
                break
            end
		elseif X == VK_UP then
			if cont1 > 0 then
				if cont1 == cont2 then
					cont2 = limitX(cont2 - 1,0)
				end
				cont1 = cont1 - 1
			else 
				cont = 1
			end
		elseif X == VK_DOWN then
			if cont + cont1*5 < #CC.commodity then
				if cont1 < math.ceil(#CC.commodity/5) - 1 then 
					cont1 = cont1 + 1 
					if cont + cont1*5 > #CC.commodity then
						cont = #CC.commodity - cont1*5
					end
				else 
					cont = #CC.commodity - cont1*5
				end
				if cont1 - cont2 > 4 then
					cont2 = cont2 + 1
				end
			end
        elseif X == VK_LEFT or ktype == 6 then
            if page == 1 then 
                cont = cont - 1 
                if cont1 > 0 then 
                    if cont < 1 then
                        if cont1 == cont2 then
                            cont2 = limitX(cont2 - 1,0)
                        end
                        cont1 = cont1 - 1
                        cont = 5
                    end
                elseif cont < 1 then 
                    cont = 1
                end
            else 
                if CC.commodity[cont+cont1*5][3] > 0 then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] - 1
                    m_left = m_left + CC.commodity[cont+cont1*5][2]
                    t_price = t_price - CC.commodity[cont+cont1*5][2]
                end
            end
        elseif X == VK_RIGHT or ktype == 7 then
            if page == 1 then 
                if cont + cont1*5 < #CC.commodity then
                    cont = cont + 1
                    if cont > 5 then
                        if cont1 < math.ceil(#CC.commodity/5) - 1 then 
                            cont = 1 
                            cont1 = cont1 + 1
                        end	
                    end
                    if cont1 - cont2 > 4 then
                        cont2 = cont2 + 1
                    end
                end
            else 
                if m_left >= CC.commodity[cont+cont1*5][2] then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] + 1
                    m_left = m_left - CC.commodity[cont+cont1*5][2]
                    t_price = t_price + CC.commodity[cont+cont1*5][2]
                end
            end
		else 
			local mxx = false
			for i = 1,5 do 
				for j = 1,5 do
                    if mx >= bx*405+(i-1)*(bx*100+jg) and mx <= bx*505+(i-1)*(bx*100+jg) and 
                        my >= by*94+(j-1)*(by*100+jg) and my <= by*194+(j-1)*(by*100+jg) then 
                        local p = i + (j-1+cont2)*14
                        if CC.commodity[p] ~= nil then
							cont = i 
							cont1 = j - 1 + cont2
							mxx = true 
							break
                        end	
                    end
				end
			end	
			if ktype == 3 and mxx == true then 
                if page == 1 then 
                    page = 2
                else 
                    JY.Base["ËéÆ¬"] = m_left
                    CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                    CC.commodity[cont+cont1*5][3] = 0
                    page = 1
                end
			end
		end
	end
end



--ÎŞ¾Æ²»»¶£ºÉÌµêÊı¾İ
function instruct_64()
	local headid = 223
	local id = -1
	
	for i = 0, JY.ShopNum - 1 do
		if CC.ShopScene[i].sceneid == JY.SubScene then
		  id = i
		end
	end
	if id < 0 then
		return 
	end
	if id == 5 then
		--say('àËàË£¡ÄãÀ´À²£¬½ñÌìÏëÂò¸öÉ¶£¿',899,0,'Ğ¡Óê')
	else
		TalkEx("ÕâÎ»Ğ¡¸ç£¬¿´¿´ÓĞÊ²Ã´ĞèÒªµÄ£¬Ğ¡µêÂôµÄ¶«Î÷¼ÛÇ®¾ø¶Ô¹«µÀ¡£", headid, 0,"ÉÌ¼Ò")
	end	
	--lib.LoadPNG(91, 10 * 2 , 0, 0, 1)
	local menu = {}
	-- for i = 1, 6 do
		-- local thingid = JY.Shop[id]["ÎïÆ·" .. i]
		-- if thingid ~= -1 then
			-- menu[i] = {}
			-- menu[i][1] = string.format("%-12s %5d", JY.Thing[thingid]["Ãû³Æ"], JY.Shop[id]["ÎïÆ·¼Û¸ñ" .. i])
			-- menu[i][2] = nil
			-- if JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. i] > 0 then
			  -- menu[i][3] = 1
			-- else
			  -- menu[i][3] = 0
			-- end
		-- end
	-- end
	
	for i = 1, 6 do
		local thingid = JY.Shop[id]["ÎïÆ·" .. i]
		if thingid ~= -1 then
			menu[#menu+1] = {thingid,JY.Shop[id]["ÎïÆ·¼Û¸ñ" .. i],0,JY.Thing[thingid]["ÎïÆ·ËµÃ÷"],0}--JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. i]
		end
	end
	
	--3ÊéÒÔÇ°Ã»ÓĞ»ìÔª
	-- if JY.Base["ÌìÊéÊıÁ¿"] < 3 and id == 0 then
		-- menu[5][3] = 0
	-- end
	--{343,600,0,'¿ÉÖØĞÂÑ¡ÔñÌì¸³È¹¦',0}


	--ĞÂÉÌµê
	--say("ĞÂÉÌµê"..menu[6][1],0,1)

	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*1.5
	local size1 = CC.DefaultFont*0.7
	local size2 = CC.DefaultFont*0.8
	local cont = 1 
	local cont1 = 0
	local cont2 = 0
	local jg = bx*4
    local page = 1
    local pc = 50
    local pc1 = 50
    local pc2 = 60
    local m_left = CC.Gold
	local t_price = 0
	local commodity = {}
	commodity = menu
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cls()
        lib.LoadPNG(91, 61 * 2 , 0, 0, 1)
		
		
		for i = 1,6 do
			for j = 1,6 do
				local cl = 6
				local col = C_GOLD
				local p = i + (j-1+cont2)*14
				local zx = bx*419+(i-1)*(bx*100+jg)-50
				local zy = by*142+(j-1)*(by*100+jg)-50
				
				-- local zx = bx*370 + (i-1)*(bx*100 + jg)
				-- local zy = by*90  + (j-1)*(by*100 + jg)
				-- if #ommodity > 5 then
					
				-- end
				--say("ĞÂÉÌµê"..p,0,1)
				if cont+cont1*5 == p then
					cl = 2
					col = C_WHITE
                end
                if page == 1 then 
                    cl = 2
                end
				
				if commodity[p] ~= nil then
					local plx = commodity[p]
					local pic = plx[1]
					--say("ĞÂÉÌµê"..p,0,1)
					if p == 6  then --and page == 1
						local zx = bx*370 + (bx*100 + jg) - (100 + jg)
						local zy = by*90  + (by*100 + jg)
						lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
						if page == 1 and cont+cont1*5 == p then 
							lib.LoadPNG(91, 50 * 2 , zx+50,zy+50, 2)
							--pc = pc + 1
							--if pc > pc2 then 
								--pc = pc1
							--end
						end
						if page == 2 and cont+cont1*5 == p then 
							lib.LoadPNG(91, pc*2 , zx+50,zy+50, 2)
							pc = pc + 1
							if pc > pc2 then 
								pc = pc1
							end
						end 
					else
						lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
						if page == 1 and cont+cont1*5 == p then 
							lib.LoadPNG(91, 50 * 2 , zx+50,zy+50, 2)
							pc = pc + 1
							if pc > pc2 then 
								pc = pc1
							end
						end
						if page == 2 and cont+cont1*5 == p then 
							lib.LoadPNG(91, pc*2 , zx+50,zy+50, 2)
							pc = pc + 1
							if pc > pc2 then 
								pc = pc1
							end
						end
					end
					
					-- lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
					-- if page == 1 and cont+cont1*5 == p then 
						-- lib.LoadPNG(91, pc * 2 , zx+50,zy+50, 2)
						-- pc = pc + 1
						-- if pc > pc2 then 
							-- pc = pc1
						-- end
					-- end
							
					--DrawString(zx+bx*30-string.len(plx[5])*size1+size1,zy-by*45,plx[5], C_WHITE, size1)
					--if page == 2 and cont+cont1*5 == p then
						--DrawString(zx+bx*30-string.len(plx[3])*size1+size1,zy+by*25,plx[3], C_WHITE, size1)
					--end
				end	
				
				
				
				
			end
			
		end
		
		-- if #commodity == 6 then
			-- local zx = bx*370 + (bx*100 + jg) - (100 + jg)
			-- local zy = by*90  + (by*100 + jg)
			-- lib.PicLoadCache(2, commodity[6][1] * 2, zx,zy, 2,256)
		-- end
		
		
		
        if commodity[cont+cont1*5] ~= nil then
            local plx = commodity[cont+cont1*5]
            local pic = plx[1]
            --
            --DrawString(bx*405,by*640-size2,JY.Thing[pic]['ÎïÆ·ËµÃ÷'], C_ORANGE, size2)
            DrawString(bx*405,by*638-size1,plx[4], C_WHITE, size1)
            DrawString(bx*405,by*663-size1,'µ±Ç°ÊıÁ¿£º'..JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. (cont+cont1*5)], C_WHITE, size1)
            DrawString(bx*405,by*688-size1,'¹ºÂòÊıÁ¿£º'..plx[3], C_WHITE, size1)
			
        end
        lib.Background(bx*70, by*520, bx*300,by*650, 150)
        DrawString(bx*80,by*550-size2,'ÎïÆ·µ¥¼Û:', C_WHITE, size2)
        DrawString(bx*80,by*580-size2,'ÓµÓĞ½ğÇ®:', C_WHITE, size2)
        DrawString(bx*80,by*610-size2,'×Ü¹²»¨·Ñ:', C_WHITE, size2)
        DrawString(bx*80,by*640-size2,'Ïû·ÑÓà¶î:', C_WHITE, size2)
        DrawString(bx*80+size2*5,by*550-size2,commodity[cont+cont1*5][2], C_GOLD, size2)
        DrawString(bx*80+size2*5,by*580-size2,CC.Gold, C_GOLD, size2)
        DrawString(bx*80+size2*5,by*610-size2,t_price, C_GOLD, size2)
        DrawString(bx*80+size2*5,by*640-size2,m_left, C_GOLD, size2)


		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
            if page == 1 then 
                page = 2
            else 
                CC.Gold = m_left
                commodity[cont+cont1*5][5] = commodity[cont+cont1*5][5] + commodity[cont+cont1*5][3]
                commodity[cont+cont1*5][3] = 0
				page = 1
				if commodity[cont+cont1*5][5] > 0 then
				instruct_2(commodity[cont+cont1*5][1],commodity[cont+cont1*5][5])
				commodity[cont+cont1*5][5] = 0
				--CC.Sp = CC.Sp - t_price
				-- if instruct_31(t_price) == false then  --ÅĞ¶ÏÒøÁ½ÊıÁ¿
					-- --say("¿Í¹ÙÄúÀï±ßÇë£¡", 511, 2) --¶Ô»°
					-- TalkEx("ÕâÎ»Ğ¡¸ç£¬ÄãµÄÇ®ÒÔºõ²»¹»¡£", headid, 0,"ÉÌ¼Ò")
					-- return
				-- end
				say("×Ü¼Û£º"..t_price,0,1)
				m_left = CC.Gold - t_price 
				t_price= 0
				--t_price = m_left
				end
            end
        elseif X == VK_ESCAPE or ktype == 4 then
            local sysl = cont+cont1*5
			JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. sysl] = JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. sysl] + commodity[cont+cont1*5][3]
            commodity[cont+cont1*5][3] = 0
            if page == 2 then 
                page = 1 
            else     
                break
            end
		elseif X == VK_UP then
			if page == 1 then
				if cont1 > 0 then
					if cont1 == cont2 then
						cont2 = limitX(cont2 - 1,0)
					end
					cont1 = cont1 - 1
				else 
					cont = 1
				end
			end	
		elseif X == VK_DOWN then
			if page == 1 then
				if cont + cont1*5 < #commodity then
					if cont1 < math.ceil(#commodity/5) - 1 then 
						cont1 = cont1 + 1 
						if cont + cont1*5 > #commodity then
							cont = #commodity - cont1*5
						end
					else 
						cont = #commodity - cont1*5
					end
					if cont1 - cont2 > 4 then
						cont2 = cont2 + 1
					end
				end
			end	
        elseif X == VK_LEFT or ktype == 6 then
            if page == 1 then 
                cont = cont - 1 
                if cont1 > 0 then 
                    if cont < 1 then
                        if cont1 == cont2 then
                            cont2 = limitX(cont2 - 1,0)
                        end
                        cont1 = cont1 - 1
                        cont = 5
                    end
                elseif cont < 1 then 
                    cont = 1
                end
            else 
				local sysl = cont+cont1*5
                if commodity[cont+cont1*5][3] > 0   then
                    commodity[cont+cont1*5][3] = commodity[cont+cont1*5][3] - 1
					
					JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. sysl] = JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. sysl] + 1
                	
                	m_left = m_left + commodity[cont+cont1*5][2]
				
					t_price = t_price - commodity[cont+cont1*5][2]
                end
            end
        elseif X == VK_RIGHT or ktype == 7 then
            if page == 1 then 
                if cont + cont1*5 < #commodity then
                    cont = cont + 1
                    if cont > 5 then
                        if cont1 < math.ceil(#commodity/5) - 1 then 
                            cont = 1 
                            cont1 = cont1 + 1
                        end	
                    end
                    if cont1 - cont2 > 4 then
                        cont2 = cont2 + 1
                    end
                end
            else 
				local sysl = cont+cont1*5
                if m_left >= commodity[cont+cont1*5][2] and JY.Shop[id]["ÎïÆ·ÊıÁ¿" ..sysl] > 0  then
                    commodity[cont+cont1*5][3] = commodity[cont+cont1*5][3] + 1
					
					if JY.Shop[id]["ÎïÆ·ÊıÁ¿" ..sysl] > 0 then
						
						JY.Shop[id]["ÎïÆ·ÊıÁ¿" ..sysl] = JY.Shop[id]["ÎïÆ·ÊıÁ¿" ..sysl] - 1
							
							m_left = m_left - commodity[cont+cont1*5][2]
					
							t_price = t_price + commodity[cont+cont1*5][2]

						
						
						
					end
					
					
                    
                end
            end
		else 
			local mxx = false
			for i = 1,5 do 
				for j = 1,5 do
                    if mx >= bx*405+(i-1)*(bx*100+jg) and mx <= bx*505+(i-1)*(bx*100+jg) and 
                        my >= by*94+(j-1)*(by*100+jg) and my <= by*194+(j-1)*(by*100+jg) then 
                        local p = i + (j-1+cont2)*14
                        if commodity[p] ~= nil then
							cont = i 
							cont1 = j - 1 + cont2
							mxx = true 
							break
                        end	
                    end
				end
			end	
			if ktype == 3 and mxx == true then 
                if page == 1 then 
                    page = 2
                else 
                    CC.Gold = m_left
                    commodity[cont+cont1*5][5] = commodity[cont+cont1*5][5] + commodity[cont+cont1*5][3]
                    commodity[cont+cont1*5][3] = 0
                    page = 1
                end
			end
		end
	end





	--ĞÂÉÌµê


	-- local x1 = (CC.ScreenW - 9 * CC.DefaultFont - 2 * CC.MenuBorderPixel) / 2
	-- local y1 = (CC.ScreenH - 5 * CC.DefaultFont - 4 * CC.RowPixel - 2 * CC.MenuBorderPixel) / 2
	-- local r = ShowMenu(menu, #menu, 0, x1, y1, 0, 0, 1, 1, CC.DefaultFont, C_ORANGE, C_WHITE)
	-- --[[
	-- local itemJC = {}
	-- itemJC[0] = {38, 12, 28, 14, 68, -1, 400, 100, 80, 500, 6000, -1}
	-- itemJC[1] = {48, 0, 29, 15, 90, -1, 400, 100, 100, 500, 1000, -1}
	-- itemJC[2] = {54, 3, 32, 16, 159, -1, 400, 100, 100, 600, 600, -1}
	-- itemJC[3] = {63, 7, 33, 17, 175, -1, 400, 200, 120, 600, 800, -1}
	-- itemJC[4] = {27, 9, 34, 22, 69, -1, 2000, 50, 130, 400, 8000, -1}]]
	-- if r > 0 then
		-- if instruct_31(JY.Shop[id]["ÎïÆ·¼Û¸ñ" .. r]) == false then
			-- TalkEx("·Ç³£±§Ç¸£¬ÄãÉíÉÏµÄÇ®ËÆºõ²»¹»¡£", headid, 0,"ÉÌ¼Ò")
		-- else
			-- JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. r] = JY.Shop[id]["ÎïÆ·ÊıÁ¿" .. r] - 1
			-- instruct_32(CC.MoneyID, -JY.Shop[id]["ÎïÆ·¼Û¸ñ" .. r])
			-- instruct_32(JY.Shop[id]["ÎïÆ·" .. r], 1)
			-- TalkEx(JY.Person[0]["ÍâºÅ"].."ÂòÁËĞ¡µêµÄ¶«Î÷£¬±£Ö¤¾ø²»ºó»Ú¡£", headid, 0,"ÉÌ¼Ò")
		-- end
	-- end
	for i,v in ipairs(CC.ShopScene[id].d_leave) do
		instruct_3(-2, v, 0, -2, -1, -1, 939, -1, -1, -1, -2, -2, -2)
	end
end

function instruct_65()
  local id = -1
  for i = 0, JY.ShopNum - 1 do
    if CC.ShopScene[i].sceneid == JY.SubScene then
      id = i
    end
  end
  if id < 0 then
    return 
  end
  instruct_3(-2, CC.ShopScene[id].d_shop, 0, -2, -1, -1, -1, -1, -1, -1, -2, -2, -2)
  for i,v in ipairs(CC.ShopScene[id].d_leave) do
    instruct_3(-2, v, 0, -2, -1, -1, -1, -1, -1, -1, -2, -2, -2)
  end
  local newid = id + 1
  if newid >= 5 then
    newid = 0
  end
  instruct_3(CC.ShopScene[newid].sceneid, CC.ShopScene[newid].d_shop, 1, -2, 938, -1, -1, 8256, 8256, 8256, -2, -2, -2)
end

function instruct_66(id)
  PlayMIDI(id)
end

function instruct_67(id)
  PlayWavAtk(id)
end


--Ñ¡Ôñ¿ò£¬Ã¿¸öÑ¡Ïî¶¼´ø±ß¿ò
--title ±êÌâ
--str ÄÚÈİ *»»ĞĞ
--button Ñ¡Ïî
--num Ñ¡ÏîµÄ¸öÊı£¬Ò»¶¨ÒªºÍÑ¡Ïî¶ÔÓ¦ÆğÀ´
--headid ÏÔÊ¾ÔÚÄÚÈİ×ó±ßµÄÌùÍ¼£¬Èç¹û²»´«ÖµÔò²»ÏÔÊ¾ÌùÍ¼
function JYMsgBox(title, str, button, num, headid, isEsc)
	if JY.Restart == 1 then
		return 1
	end
	local strArray = {}
	local xnum, ynum, width, height = nil, nil, nil, nil
	local picw, pich = 0, 0
	local x1, x2, y1, y2 = nil, nil, nil, nil
	local size = CC.DefaultFont;
	local xarr = {};

	local function between(x, select)
		for i=1, num do
			if xarr[i] < x and x < xarr[i] + string.len(button[i])*size/2 then
				return i
			end
		end
		return select
	end
  
	if headid ~= nil then
		headid = headid*2;
		--picw, pich = lib.PicGetXY(1, headid)
		picw, pich = lib.GetPNGXY(1, headid)
		picw = picw + CC.MenuBorderPixel * 2
		pich = pich + CC.MenuBorderPixel * 2
	end
	ynum, strArray = Split(str, "*")
	xnum = 0
	for i = 1, ynum do
		local len = string.len(strArray[i])
		if xnum < len then
			xnum = len
		end
	end
	if xnum < 12 then
		xnum = 12
	end
	width = CC.MenuBorderPixel * 2 + math.modf(size * xnum / 2) + (picw)
	height = CC.MenuBorderPixel * 2 + (size + CC.MenuBorderPixel) * ynum
	if height < pich then
		height = pich
	end
	y2 = height
	height = height + CC.MenuBorderPixel * 2 + size * 2
	x1 = (CC.ScreenW - (width)) / 2 + CC.MenuBorderPixel
	x2 = x1 + (picw)
	y1 = (CC.ScreenH - (height)) / 2 + CC.MenuBorderPixel + 2 + size * 0.7
	y2 = y2 + (y1) - 5
	local select = 1

	Cls();
  
	DrawBoxTitle(width, height, title, C_GOLD)
	if headid ~= nil then
		--lib.PicLoadCache(1, headid, x1, y1, 1, 0)
		lib.LoadPNG(1, headid, x1, y1,1)
	end
	for i = 1, ynum do
		DrawString(x2, y1 + (CC.MenuBorderPixel + size) * (i - 1), strArray[i], C_WHITE, size)
	end
	
	local yczj = 0	--Òş²ØÖ÷½ÇÕÅ¼Ò»Ô
	
	if title == "Ö÷½ÇÑ¡Ôñ" then
		yczj = 1
	end
	
	local surid = lib.SaveSur((CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size, (CC.ScreenW + (width)) / 2 + 4, (CC.ScreenH + (height)) / 2 + 4)
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		lib.LoadSur(surid, (CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size)
		
		for i = 1, num do
			local color, bjcolor = nil, nil
			if i == select then
				color = M_Yellow
				bjcolor = M_DarkOliveGreen
			else
				color = M_DarkOliveGreen
			end
			xarr[i] = (CC.ScreenW - (width)) / 2 + (width) * i / (num + 1) - string.len(button[i]) * size / 4;
			DrawStrBox2(xarr[i], y2, button[i], color, size, bjcolor)
		end
		ShowScreen()
		  
		local key, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
		if key == VK_ESCAPE or ktype == 4 then
			if isEsc ~= nil and isEsc == 1 then
				select = -2
				break
			end
		elseif key == VK_LEFT or ktype == 6 then
			select = select - 1
			if select < 1 then
				select = num
			end
			if yczj == 1 and key == VK_LEFT then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_RIGHT or ktype == 7 then
			select = select + 1
			if num < select then
				select = 1
			end
			if yczj == 1 and key == VK_RIGHT then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_UP then
			if yczj == 1 then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_DOWN then
			if yczj == 1 then
				YC_ZhangJiaHui(key)
			end
		elseif key >= VK_A and key <= VK_Z then
			if yczj == 1 then
				YC_ZhangJiaHui(key)
			end
		elseif key == VK_RETURN or key == VK_SPACE or ktype == 5 then
			break
		elseif ktype == 2 or ktype == 3 then
			if mx >= x1 and mx <= x1 + width and my >= y2 and my <= y2 + 2*CC.MenuBorderPixel + size then
				--ÎŞ¾Æ²»»¶£ºÕâÀïpass in select£¬±ÜÃâÔÚÑ¡Ôñ²»µ½µÄÇé¿öÏÂ·µ»Ø²»´æÔÚµÄÑ¡Ïî
				select = between(mx, select);
				if select > 0 and select <= num and ktype==3 then
					break
				end
			end
		end
		--Òş²ØÖ÷½ÇÕÅ¼Ò»Ô
		if yczj == 1 and YC.ZJH == 12 then
			YC.ZJH = 0
			lib.FreeSur(surid)
			return 3
		end
	end
	select = limitX(select, -2, num)
	lib.FreeSur(surid)
	
	Cls()
	return select
end

function JYMsgBox2(title, str, button, num, headid, isEsc)
	if JY.Restart == 1 then
		return 1
	end
	local strArray = {}
	local xnum, ynum, width, height = nil, nil, nil, nil
	local picw, pich = 0, 0
	local x1, x2, y1, y2 = nil, nil, nil, nil
	local size = CC.DefaultFont;
	local xarr = {};

	local function between(x, select)
		for i=1, num do
			if xarr[i] < x and x < xarr[i] + string.len(button[i])*size/2 then
				return i
			end
		end
		return select
	end
  
	if headid ~= nil then
		headid = headid*2;
		picw, pich = lib.GetPNGXY(1, headid)
		picw = picw + CC.MenuBorderPixel * 2
		pich = pich + CC.MenuBorderPixel * 2
	end
	ynum, strArray = Split(str, "*")
	xnum = 0
	for i = 1, ynum do
		local len = string.len(strArray[i])
		if xnum < len then
			xnum = len
		end
	end
	if xnum < 12 then
		xnum = 12
	end
	width = CC.MenuBorderPixel * 2 + math.modf(size * xnum / 2) + (picw)
	height = CC.MenuBorderPixel * 2 + (size + CC.MenuBorderPixel) * ynum
	if height < pich then
		height = pich
	end
	y2 = height
	height = height + CC.MenuBorderPixel * 2 + size * 2
	x1 = (CC.ScreenW - (width)) / 2 + CC.MenuBorderPixel
	x2 = x1 + (picw)
	y1 = (CC.ScreenH - (height)) / 2 + CC.MenuBorderPixel + 2 + size * 0.7
	y2 = y2 + (y1) - 5
	local select = 1

	Cls()
  
	DrawBoxTitle(width, height, title, C_GOLD)
	if headid ~= nil then
		lib.LoadPNG(1, headid, x1, y1,1)
	end
	for i = 1, ynum do
		DrawString(x2, y1 + (CC.MenuBorderPixel + size) * (i - 1), strArray[i], C_WHITE, size)
	end
	
	local surid = lib.SaveSur((CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size, (CC.ScreenW + (width)) / 2 + 4, (CC.ScreenH + (height)) / 2 + 4)
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls();
		lib.LoadSur(surid, (CC.ScreenW - (width)) / 2 - 4, (CC.ScreenH - (height)) / 2 - size)
		
		for i = 1, num do
			local color, bjcolor = nil, nil
			if i == select then
				color = M_Yellow
				bjcolor = M_DarkOliveGreen
			else
				color = M_DarkOliveGreen
			end
			xarr[i] = (CC.ScreenW - (width)) / 2 + (width) * i / (num + 1) - string.len(button[i]) * size / 4;
			DrawStrBox2(xarr[i], y2, button[i], color, size, bjcolor)
		end
		ShowScreen()
		  
		local key, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
		if key == VK_ESCAPE or ktype == 4 then
			if isEsc ~= nil and isEsc == 1 then
				select = -2
				break
			end
		elseif key == VK_LEFT or ktype == 6 then
			select = select - 1
			if select < 1 then
				select = num
			end
		elseif key == VK_RIGHT or ktype == 7 then
			select = select + 1
			if num < select then
				select = 1
			end
		elseif key == VK_RETURN or key == VK_SPACE or ktype == 5 then
			break
		elseif ktype == 2 or ktype == 3 then
			if mx >= x1 and mx <= x1 + width and my >= y2 and my <= y2 + 2*CC.MenuBorderPixel + size then
				--ÎŞ¾Æ²»»¶£ºÕâÀïpass in select£¬±ÜÃâÔÚÑ¡Ôñ²»µ½µÄÇé¿öÏÂ·µ»Ø²»´æÔÚµÄÑ¡Ïî
				select = between(mx, select);
				if select > 0 and select <= num and ktype==3 then
					break
				end
			end
		end
	end
	select = limitX(select, -2, num)
	lib.FreeSur(surid)
	
	Cls()
	return button[select]
end

--ÏÔÊ¾´ø±ß¿òµÄÎÄ×Ö
function DrawBoxTitle(width, height, str, color)
  local s = 4
  local x1, y1, x2, y2, tx1, tx2 = nil, nil, nil, nil, nil, nil
  local fontsize = s + CC.DefaultFont
  local len = string.len(str) * fontsize / 2
  x1 = (CC.ScreenW - width) / 2
  x2 = (CC.ScreenW + width) / 2
  y1 = (CC.ScreenH - height) / 2
  y2 = (CC.ScreenH + height) / 2
  tx1 = (CC.ScreenW - len) / 2
  tx2 = (CC.ScreenW + len) / 2
  lib.Background(x1, y1 + s, x1 + s, y2 - s, 128)
  lib.Background(x1 + s, y1, x2 - s, y2, 128)
  lib.Background(x2 - s, y1 + s, x2, y2 - s, 128)
  lib.Background(tx1, y1 - fontsize / 2 + s, tx2, y1, 128)
  lib.Background(tx1 + s, y1 - fontsize / 2, tx2 - s, y1 - fontsize / 2 + s, 128)
  local r, g, b = GetRGB(color)
  DrawBoxTitle_sub(x1 + 1, y1 + 1, x2, y2, tx1 + 1, y1 - fontsize / 2 + 1, tx2, y1 + fontsize / 2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
  DrawBoxTitle_sub(x1, y1, x2 - 1, y2 - 1, tx1, y1 - fontsize / 2, tx2 - 1, y1 + fontsize / 2 - 1, color)
  DrawString(tx1 + 2 * s, y1 - (fontsize - s) / 2, str, color, CC.DefaultFont)
end

function DrawBoxTitle_sub(x1, y1, x2, y2, tx1, ty1, tx2, ty2, color)
  local s = 4
  lib.DrawRect(x1 + s, y1, tx1, y1, color)
  lib.DrawRect(tx2, y1, x2 - s, y1, color)
  lib.DrawRect(x2 - s, y1, x2 - s, y1 + s, color)
  lib.DrawRect(x2 - s, y1 + s, x2, y1 + s, color)
  lib.DrawRect(x2, y1 + s, x2, y2 - s, color)
  lib.DrawRect(x2, y2 - s, x2 - s, y2 - s, color)
  lib.DrawRect(x2 - s, y2 - s, x2 - s, y2, color)
  lib.DrawRect(x2 - s, y2, x1 + s, y2, color)
  lib.DrawRect(x1 + s, y2, x1 + s, y2 - s, color)
  lib.DrawRect(x1 + s, y2 - s, x1, y2 - s, color)
  lib.DrawRect(x1, y2 - s, x1, y1 + s, color)
  lib.DrawRect(x1, y1 + s, x1 + s, y1 + s, color)
  lib.DrawRect(x1 + s, y1 + s, x1 + s, y1, color)
  DrawBox_1(tx1, ty1, tx2, ty2, color)
end

function Init_SMap(showname)
	-- --lib.PicInit()
	-- ----¼ÓÔØ³¡¾°ÌùÍ¼ÎÄ¼ş
	-- lib.PicLoadFile(CC.SMAPPicFile[1], CC.SMAPPicFile[2], 0)
	-- lib.LoadPNGPath('./data/smap',0,-1,100)
	-- lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92)
	-- lib.LoadPNGPath('./data/bj',0,-1,100)
	-- lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,80))
	-- lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.LoadPNGPath(CC.PTPath, 95, CC.PTNum, limitX(CC.ScreenW/1360*100,0,100))
	-- lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI				
	-- lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)
    -- lib.LoadPNGPath('./data/thing',0,-1,100)
	--¼ÓÔØ
	PlayMIDI(JY.Scene[JY.SubScene]["½øÃÅÒôÀÖ"])
	JY.oldSMapX = -1
	JY.oldSMapY = -1
	JY.SubSceneX = 0
	JY.SubSceneY = 0
	JY.OldDPass = -1
	JY.D_Valid = nil
	DrawSMap()
	lib.GetKey()
	if showname == 1 then
		DrawStrBox(-1, 10, JY.Scene[JY.SubScene]["Ãû³Æ"], C_WHITE, CC.DefaultFont)
		ShowScreen()
		WaitKey()
	end
  
	AutoMoveTab = {[0] = 0}
end

--ĞÂ¶Ô»°·½Ê½
--¼ÓÈë¿ØÖÆ×Ö·û
--ÔİÍ££¬ÈÎÒâ¼üºó¼ÌĞø£¬£ğ
--¿ØÖÆÑÕÉ«£Ò=red£Ç=gold£Â=black£×=white£Ï=orange
--¿ØÖÆ×Ö·ûÏÔÊ¾ËÙ¶È£°,£±,£²,£³,£´,£µ,£¶,£·,£¸,£¹
--¿ØÖÆ×ÖÌå£Á£Ó£Ä£Æ
--¿ØÖÆ»»ĞĞ£È   ·ÖÒ³£Ğ
--£Î´ú±í×Ô¼º£î´ú±íÖ÷½Ç

function say(s,pid,flag,name)          --¸öÈËĞÂ¶Ô»°
	if JY.Restart == 1 then
		return
	end
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
    local picw=130;       --×î´óÍ·ÏñÍ¼Æ¬¿í¸ß
	local pich=130;
	local talkxnum=30;         --¶Ô»°Ò»ĞĞ×ÖÊı
	local talkynum=3;          --¶Ô»°ĞĞÊı
	local dx=2;
	local dy=2;
    local boxpicw=picw+10;
	local boxpich=pich+10;
	local boxtalkw=talkxnum*CC.DefaultFont+10;
	local boxtalkh=boxpich-27;
	local headid = pid;
	if name == nil then 
		headid = JY.Person[pid]["°ëÉíÏñ"]
	end
	name=name or JY.Person[pid]["ĞÕÃû"]
    local talkBorder=(pich-talkynum*CC.DefaultFont)/(talkynum+1)-5;

	--ÏÔÊ¾Í·ÏñºÍ¶Ô»°µÄ×ø±ê
    local xy={ [0]={headx=dx,heady=dy,
	                talkx=dx+boxpicw+2,talky=dy+27,
					namex=dx+boxpicw+2,namey=dy,
					showhead=1},--×óÉÏ
                   {headx=CC.ScreenW-1-dx-boxpicw-80,heady=CC.ScreenH-dy-boxpich+40,
				    talkx=CC.ScreenW-1-dx-boxpicw-boxtalkw-2-150,talky= CC.ScreenH-dy-boxpich+27,
					namex=CC.ScreenW-1-dx-boxpicw-26,namey=CC.ScreenH-dy-boxpich+100,
					showhead=1},--ÓÒÏÂ
                   {headx=dx,heady=dy,
				   talkx=dx+boxpicw-43,talky=dy+27,
					namex=dx+boxpicw+2,namey=dy,
				   showhead=0},--ÉÏÖĞ
                   {headx=CC.ScreenW-1-dx-boxpicw,heady=CC.ScreenH-dy-boxpich,
				   talkx=CC.ScreenW-1-dx-boxpicw-boxtalkw-2,talky= CC.ScreenH-dy-boxpich+27,
					namex=CC.ScreenW-1-dx-boxpicw-96,namey=CC.ScreenH-dy-boxpich,
					showhead=1},
                   {headx=CC.ScreenW-1-dx-boxpicw,heady=dy,
				    talkx=CC.ScreenW-1-dx-boxpicw-boxtalkw-2,talky=dy+27,
					namex=CC.ScreenW-1-dx-boxpicw-96,namey=dy,
					showhead=1},--ÓÒÉÏ
                   {headx=dx+68,heady=CC.ScreenH-dy-boxpich+40,
				   talkx=dx+boxpicw+2+160,talky=CC.ScreenH-dy-boxpich+27,
					namex=dx+boxpicw-50,namey=CC.ScreenH-dy-boxpich+100,
				   showhead=1}, --×óÏÂ
			}

	if pid==0 then
	   if name ~= JY.Person[pid]["ĞÕÃû"] then 
	      flag=1
	   else 
	      flag=5
	   end 
	else
	   flag=1
	end
	
	

  if xy[flag].showhead == 0 then
    headid = -1
  end

    lib.GetKey();

	local function readstr(str)
		local T1={"£°","£±","£²","£³","£´","£µ","£¶","£·","£¸","£¹"}
		local T2={{"£Ò",M_DarkRed},{"£Ç",C_GOLD},{"£Â",C_BLACK},{"£×",C_WHITE},{"£Ï",C_ORANGE},{"£Ì",M_DarkOliveGreen},{"£Ä",M_Blue},{"£Ú",LightPurple}}
		local T3={{"£È",CC.FontNameSong},{"£Ó",CC.FontNameHei},{"£Æ",CC.FontName}}
		--ÃÀ¹ÛÆğ¼û£¬Õë¶Ô²»Í¬×ÖÌåÍ¬Ò»ĞĞÏÔÊ¾£¬ĞèÒªÎ¢µ÷£ù×ø±ê£¬ÒÔ¼°×ÖºÅ
		--ÒÔÄ¬ÈÏµÄ×ÖÌåÎª±ê×¼£¬ÆôÌåĞèÏÂÒÆ£¬Ï¸ºÚĞèÉÏÒÆ
		for i=0,9 do
			if T1[i+1]==str then return 1,i*50 end
		end
		for i=1,8 do
			if T2[i][1]==str then return 2,T2[i][2] end
		end
		for i=1,3 do
			if T3[i][1]==str then return 3,T3[i][2] end
		end
		return 0
	end

	local function mydelay(t)
		if t<=0 then return end
		lib.ShowSurface(0)
		lib.Delay(t)
	end

	local page, cy, cx = 0, 0, 0
  	local color, t, font = C_BLACK, 0, CC.FontName
  	while string.len(s) >= 1 do
		lib.GetKey();
		if JY.Restart == 1 then
			break
		end
    	if page == 0 then
      		Cls()
			if headid >= 0 then
				local w, h = lib.GetPNGXY(1, headid*2)
				local x = (picw - w) / 2
				local y = (pich - h) / 2
				lib.LoadPicture(CC.SayBoxFile,-1,-1);
				lib.LoadPNG(90, headid*2, xy[flag].headx + 5 + x-76, xy[flag].heady + 5 + y-by*220, 1)
				lib.LoadPicture(CC.SayBoxNMFile,xy[flag].namex-35,xy[flag].namey-10,1);	
				MyDrawString(xy[flag].namex, xy[flag].namex + 96, xy[flag].namey + 1, name, C_CYGOLD, 24)				
			end
			page = 1
		end
		local str
		str=string.sub(s,1,1)
		if str=='*' then
			--str='£È'
			s=string.sub(s,2,-1)
		else
			if string.byte(s,1,1) > 127 then		--ÅĞ¶Ïµ¥Ë«×Ö·û
				str=string.sub(s,1,2)
				s=string.sub(s,3,-1)
			else
				str=string.sub(s,1,1)
				s=string.sub(s,2,-1)
			end
		end
		--¿ªÊ¼¿ØÖÆÂß¼­
		if str=='*' then
		elseif str=="£È" then
			cx=0
			cy=cy+1
			if cy==3 then
				cy=0
				page=0
			end
		elseif str=="£Ğ" then
			cx=0
			cy=0
			page=0
		elseif str=="£ğ" then
			ShowScreen();
			--WaitKey();
			lib.Delay(50)
		elseif str=="£÷" then
			ShowScreen();
			WaitKey();
			--lib.Delay(50)
		elseif str=="£Î" then
			s=JY.Person[pid]["ĞÕÃû"]..s
		elseif str=="£î" then
			s=JY.Person[0]["ĞÕÃû"]..s
		else
			local kz1,kz2=readstr(str)
			if kz1==1 then
				t=kz2
			elseif kz1==2 then
				color=kz2
			elseif kz1==3 then
				font=kz2
			else
				lib.DrawStr(xy[flag].talkx+CC.DefaultFont*cx+5,
							xy[flag].talky+(CC.DefaultFont+talkBorder)*cy+talkBorder-by*28,
							str,color,CC.DefaultFont,font,0,0, 305)
				mydelay(t)
				cx=cx+string.len(str)/2
				if cx==talkxnum then
					cx=0
					cy=cy+1
					if cy==talkynum then
						cy=0
						page=0
					end
				end
			end
		end
		--Èç¹û»»Ò³£¬ÔòÏÔÊ¾£¬µÈ´ı°´¼ü
		if page==0 or string.len(s)<1 then
			ShowScreen();
			WaitKey();
			lib.Delay(100)
		end

	end


	if JY.Restart == 1 then
		do return end
	end

	Cls();
end

function MyDrawString(x1, x2, y, str, color, size)
	local len = math.modf(string.len(str) * size / 4)
	local x = math.modf((x1 + x2) / 2) - len
	DrawString(x, y, str, color, size)
end

--·Ö¸î×Ö·û´®
--szFullString×Ö·û´®
--szSeparator·Ö¸î·û
--·µ»Ø×ÜÊı,·Ö¸îºóÊı×é
function Split(szFullString, szSeparator)
  local nFindStartIndex = 1
  local nSplitIndex = 1
  local nSplitArray = {}
  while true do
    local nFindLastIndex = string.find(szFullString, szSeparator, nFindStartIndex)
    if not nFindLastIndex then
      nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, string.len(szFullString))
      break;
    else
	    nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, nFindLastIndex - 1)
	    nFindStartIndex = nFindLastIndex + string.len(szSeparator)
	    nSplitIndex = nSplitIndex + 1
	  end
  end
  return nSplitIndex, nSplitArray
end

function DrawStrBox2(x, y, str, color, size, bjcolor)
  local strarray = {}
  local num, maxlen = nil, nil
  maxlen = 0
  num, strarray = Split(str, "*")
  for i = 1, num do
    local len = string.len(strarray[i])
    if maxlen < len then
      maxlen = len
    end
  end
  local w = size * maxlen / 2 + 2 * CC.MenuBorderPixel
  local h = 2 * CC.MenuBorderPixel + size * num
  if x == -1 then
    x = (CC.ScreenW - size / 2 * maxlen - 2 * CC.MenuBorderPixel) / 2
  end
  if y == -1 then
    y = (CC.ScreenH - size * num - 2 * CC.MenuBorderPixel) / 2
  end
  DrawBox2(x, y, x + w - 1, y + h - 1, C_WHITE, bjcolor)
  for i = 1, num do
    DrawString(x + CC.MenuBorderPixel, y + CC.MenuBorderPixel + size * (i - 1), strarray[i], color, size)
  end
end

--»æÖÆÒ»¸ö´ø±³¾°µÄ°×É«·½¿ò£¬ËÄ½Ç°¼½ø
function DrawBox2(x1, y1, x2, y2, color, bjcolor)
  local s = 4
  if not bjcolor then
    bjcolor = 0
  end
  if bjcolor >= 0 then
    lib.Background(x1, y1 + s, x1 + s, y2 - s, 128, bjcolor)
    lib.Background(x1 + s, y1, x2 - s, y2, 128, bjcolor)
    lib.Background(x2 - s, y1 + s, x2, y2 - s, 128, bjcolor)
  end
  if color >= 0 then
    local r, g, b = GetRGB(color)
    DrawBox_2(x1 + 1, y1, x2, y2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
    DrawBox_2(x1, y1, x2 - 1, y2 - 1, color)
  end
end

--»æÖÆËÄ½Ç°¼½øµÄ·½¿ò
function DrawBox_2(x1, y1, x2, y2, color)
  local s = 4
  lib.DrawRect(x1 + s, y1, x2 - s, y1, color)
  lib.DrawRect(x2 - s, y1, x2 - s, y1 + s, color)
  lib.DrawRect(x2 - s, y1 + s, x2, y1 + s, color)
  lib.DrawRect(x2, y1 + s, x2, y2 - s, color)
  lib.DrawRect(x2, y2 - s, x2 - s, y2 - s, color)
  lib.DrawRect(x2 - s, y2 - s, x2 - s, y2, color)
  lib.DrawRect(x2 - s, y2, x1 + s, y2, color)
  lib.DrawRect(x1 + s, y2, x1 + s, y2 - s, color)
  lib.DrawRect(x1 + s, y2 - s, x1, y2 - s, color)
  lib.DrawRect(x1, y2 - s, x1, y1 + s, color)
  lib.DrawRect(x1, y1 + s, x1 + s, y1 + s, color)
  lib.DrawRect(x1 + s, y1 + s, x1 + s, y1, color)
end

--³õÊ¼»¯Ö÷µØÍ¼
function Init_MMap()
	--lib.PicInit()
	lib.LoadMMap(CC.MMapFile[1], CC.MMapFile[2], CC.MMapFile[3], CC.MMapFile[4], CC.MMapFile[5], CC.MWidth, CC.MHeight, JY.Base["ÈËX"], JY.Base["ÈËY"])
  
    -- lib.PicLoadFile(CC.MMAPPicFile[1], CC.MMAPPicFile[2], 0)
	-- lib.LoadPNGPath('./data/mmap',0,-1,100)
    -- lib.PicLoadFile(CC.BJ[1], CC.BJ[2], 92)
	-- lib.LoadPNGPath('./data/BJ',0,-1,100)
	-- lib.LoadPNGPath(CC.HeadPath, 1, CC.HeadNum, limitX(CC.ScreenW/1360*100,0,80))
	-- lib.LoadPNGPath(CC.BodyPath, 90, CC.BodyNum, limitX(CC.ScreenW/1360*100,0,100))	
	-- lib.LoadPNGPath(CC.PTPath, 95, CC.PTNum, limitX(CC.ScreenW/1360*100,0,100))
	-- lib.LoadPNGPath(CC.XTPath, 91, CC.XTNum, limitX(CC.ScreenW/1360*100,0,100))	--UI		
	-- lib.LoadPNGPath(CC.UIPath, 96, CC.UINum, limitX(CC.ScreenW/1360*100,0,100))
  
	-- lib.PicLoadFile(CC.ThingPicFile[1], CC.ThingPicFile[2], 2, 100, 100)
    -- lib.LoadPNGPath('./data/thing',0,-1,100)
	
	JY.EnterSceneXY = nil
	JY.oldMMapX = -1
	JY.oldMMapY = -1
	PlayMIDI(JY.MmapMusic)
  
	AutoMoveTab = {[0] = 0}
end

--×Ô¶¨ÒåµÄ½øÈë×Ó³¡¾°µÄº¯Êı
--ĞèÒª½øÈëµÄ×Ó³¡¾°±àºÅ
--x½øÈë×Ó³¡¾°ºóÈËÎïµÄX×ø±ê£¬´«Èë-1ÔòÄ¬ÈÏÎªÈë¿ÚX
--y½øÈë×Ó³¡¾°ºóÈËÎïµÄY×ø±ê£¬´«Èë-1ÔòÄ¬ÈÏÎªÈë¿ÚY
--directÈËÎïÃæ¶ÔµÄ·½Ïò
function My_Enter_SubScene(sceneid,x,y,direct)
	--´Ó´óµØÍ¼½øÈë×Ó³¡¾°Ç°×Ô¶¯±£´æµ½10ºÅµµ
	if JY.Status == GAME_MMAP then
		SaveRecord(10)
	end
	JY.SubScene = sceneid;
	local flag = 1;   --ÊÇ·ñ×Ô¶¨ÒåµÄxy×ø±ê, 0ÊÇ£¬1·ñ
	if x == -1 and y == -1 then
		JY.Base["ÈËX1"]=JY.Scene[sceneid]["Èë¿ÚX"];
		JY.Base["ÈËY1"]=JY.Scene[sceneid]["Èë¿ÚY"];
	else
		JY.Base["ÈËX1"] = x;
		JY.Base["ÈËY1"] = y;
		flag = 0;
	end
	
	if direct > -1 then
		JY.Base["ÈË·½Ïò"] = direct;
	end
 			
	
	if JY.Status == GAME_MMAP then
		CleanMemory();
		--lib.UnloadMMap();
	end
	lib.ShowSlow(20,1)

	JY.Status=GAME_SMAP;  --¸Ä±ä×´Ì¬
	JY.MmapMusic=-1;

	JY.Base["³Ë´¬"]=0;
	JY.MyPic=GetMyPic(); 
  
	--Íâ¾°Èë¿ÚÊÇ¸öÄÑµã£¬ÓĞĞ©×Ó³¡¾°ÊÇÍ¨¹ıÌø×ªµÄ·½Ê½½øÈëµÄ£¬ĞèÒªÅĞ¶Ï
	--ÓÉÓÚÄ¿Ç°×î¶àÖ»ÄÜÓĞÒ»¸ö×Ó³¡¾°Ìø×ª£¬ËùÒÔ²»ĞèÒª½øĞĞÑ­»·ÅĞ¶Ï
	local sid = JY.Scene[sceneid]["Ìø×ª³¡¾°"];
  
	if sid < 0 or (JY.Scene[sid]["Íâ¾°Èë¿ÚX1"] <= 0 and JY.Scene[sid]["Íâ¾°Èë¿ÚY1"] <= 0) then
		JY.Base["ÈËX"] = JY.Scene[sceneid]["Íâ¾°Èë¿ÚX1"];  --¸Ä±ä³ö×Ó³¡¾°ºóµÄXY×ø±ê
		JY.Base["ÈËY"] = JY.Scene[sceneid]["Íâ¾°Èë¿ÚY1"];
	else
		JY.Base["ÈËX"] = JY.Scene[sid]["Íâ¾°Èë¿ÚX1"];  --¸Ä±ä³ö×Ó³¡¾°ºóµÄXY×ø±ê
		JY.Base["ÈËY"] = JY.Scene[sid]["Íâ¾°Èë¿ÚY1"];
	end

    
	Init_SMap(flag);  --ÖØĞÂ³õÊ¼»¯µØÍ¼
   -- lib.LoadPNGPath('./data/smap',0,-1,100)
	if flag == 0 then    --Èç¹ûÊÇ×Ô¶¨ÒåÎ»ÖÃ£¬ÏÈ´«ËÍµ½ÄÇ¸öÎ»ÖÃ£¬ÔÙÏÔÊ¾³¡¾°Ãû³Æ
		DrawStrBox(-1,10,JY.Scene[JY.SubScene]["Ãû³Æ"],C_WHITE,CC.DefaultFont);
		ShowScreen();
		WaitKey();
	end
  
	Cls();	
end

--¼òÒ×ĞÅÏ¢
function JYZTB(id,pid)
	ShowStatus() 
end

function QZXS(s)
	DrawStrBoxWaitKey(s, C_GOLD, CC.DefaultFont)
end

--ÏÔÊ¾Îä¹¦µÄÎÄ×Ö
function KungfuString(str, x, y, color, size, font, place)
  if str == nil then
    return 
  end
  local w, h = size, size + 5
  local len = string.len(str) / 2
  x = x - len * w / 2
  y = y - h * place
  lib.DrawStr(x, y, str, color, size, font, 0, 0)
end

--Çå³ıÌùÍ¼ÎÄ×Ö
function ClsN(x1, y1, x2, y2)
  if x1 == nil then
    x1 = 0
    y1 = 0
    x2 = 0
    y2 = 0
  end
  lib.SetClip(x1, y1, x2, y2)
  lib.FillColor(0, 0, 0, 0, 0)
  lib.SetClip(0, 0, 0, 0)
end


---¶Ô¾ØĞÎ½øĞĞÆÁÄ»¼ô²Ã
--·µ»Ø¼ô²ÃºóµÄ¾ØĞÎ£¬Èç¹û³¬³öÆÁÄ»£¬·µ»Ø¿Õ
function ClipRect(r)
  if CC.ScreenW <= r.x1 or r.x2 <= 0 or CC.ScreenH <= r.y1 or r.y2 <= 0 then
    return nil
  else
    local res = {}
    res.x1 = limitX(r.x1, 0, CC.ScreenW)
    res.x2 = limitX(r.x2, 0, CC.ScreenW)
    res.y1 = limitX(r.y1, 0, CC.ScreenH)
    res.y2 = limitX(r.y2, 0, CC.ScreenH)
    return res
  end
end

--¼ÆËãÌùÍ¼¸Ä±äĞÎ³ÉµÄClip²Ã¼ô
--(dx1,dy1) ĞÂÌùÍ¼ºÍ»æÍ¼ÖĞĞÄµãµÄ×ø±êÆ«ÒÆ¡£ÔÚ³¡¾°ÖĞ£¬ÊÓ½Ç²»Í¬¶øÖ÷½Ç¶¯Ê±ÓÃµ½
--pic1 ¾ÉµÄÌùÍ¼±àºÅ
--id1 ÌùÍ¼ÎÄ¼ş¼ÓÔØ±àºÅ
--(dx2,dy2) ĞÂÌùÍ¼ºÍ»æÍ¼ÖĞĞÄµãµÄÆ«ÒÆ
--pic2 ¾ÉµÄÌùÍ¼±àºÅ
--id2 ÌùÍ¼ÎÄ¼ş¼ÓÔØ±àºÅ
--·µ»Ø£¬²Ã¼ô¾ØĞÎ {x1,y1,x2,y2}
function Cal_PicClip(dx1, dy1, pic1, id1, dx2, dy2, pic2, id2)
  local w1, h1, x1_off, y1_off = lib.PicGetXY(id1, pic1 * 2)
  local old_r = {}
  old_r.x1 = CC.XScale * (dx1 - dy1) + CC.ScreenW / 2 - x1_off
  old_r.y1 = CC.YScale * (dx1 + dy1) + CC.ScreenH / 2 - y1_off
  old_r.x2 = old_r.x1 + w1
  old_r.y2 = old_r.y1 + h1
  local w2, h2, x2_off, y2_off = lib.PicGetXY(id2, pic2 * 2)
  local new_r = {}
  new_r.x1 = CC.XScale * (dx2 - dy2) + CC.ScreenW / 2 - x2_off
  new_r.y1 = CC.YScale * (dx2 + dy2) + CC.ScreenH / 2 - y2_off
  new_r.x2 = new_r.x1 + w2
  new_r.y2 = new_r.y1 + h2
  return MergeRect(old_r, new_r)
end

--ºÏ²¢¾ØĞÎ
function MergeRect(r1, r2)
  local res = {}
  res.x1 = math.min(r1.x1, r2.x1)
  res.y1 = math.min(r1.y1, r2.y1)
  res.x2 = math.max(r1.x2, r2.x2)
  res.y2 = math.max(r1.y2, r2.y2)
  return res
end



--ÏÔÊ¾ÒõÓ°×Ö·û´®
--Èç¹ûx,y´«-1£¬ÄÇÃ´ÏÔÊ¾ÔÚÆÁÄ»ÖĞ¼ä
function NewDrawString(x, y, str, color, size)
	local ll = #str
	local w = size * ll / 2 + 2 * CC.MenuBorderPixel
	local h = size + 2 * CC.MenuBorderPixel
	if x == -1 then
		x = (CC.ScreenW - size / 2 * ll - 2 * CC.MenuBorderPixel) / 2
	else
		x = (x - size / 2 * ll - 2 * CC.MenuBorderPixel) / 2
	end
	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	else
		y = (y - size - 2 * CC.MenuBorderPixel) / 2
	end
	lib.DrawStr(x, y, str, color, size, CC.FontName, CC.SrcCharSet, CC.OSCharSet)
end

--ÎŞ¾Æ²»»¶£º·ÂÔìÌá¿î»úATM»­µÄÊı×ÖÊäÈëUI
function InputNum(str, minNum, maxNum, isEsc)
	local size = CC.DefaultFont;
	local b_space = size+CC.RowPixel
	local x=(CC.ScreenW-size*9-2*CC.MenuBorderPixel)/2;
	local y=(CC.ScreenH-size*9-2*CC.MenuBorderPixel)/2;
	local w=size*9+2*CC.MenuBorderPixel;
	local h=(b_space+CC.RowPixel*2)*6;
	local functional_button = {{name="È·ÈÏ"},{name="×î´ó"},{name="Çå¿Õ"},{name="É¾³ı"},{name=0},{name=1},{name=2},{name=3},{name=4},{name=5},{name=6},{name=7},{name=8},{name=9}};
	local starting_y = 5;
	local starting_x = 1;

	for i = 1, #functional_button do
		functional_button[i].x1 = CC.ScreenW/2+(b_space+CC.RowPixel*2)*starting_x-11
		functional_button[i].y1 = y+(b_space+CC.RowPixel*2)*starting_y
		if i <= 4 then
			functional_button[i].x2 = CC.ScreenW/2+(b_space+CC.RowPixel*2)*starting_x-11+b_space*2
			functional_button[i].y2 = y+(b_space+CC.RowPixel*2)*starting_y+b_space
		else
			functional_button[i].x2 = CC.ScreenW/2+(b_space+CC.RowPixel*2)*starting_x-11+b_space
			functional_button[i].y2 = y+(b_space+CC.RowPixel*2)*starting_y+b_space
		end
		if i < 4 then
			starting_y = starting_y - 1
		elseif i == 4 then
			starting_y = 5
			starting_x = -1
		elseif i == 5 or i == 8 or i == 11 then
			starting_x = -2
			starting_y = starting_y - 1
		elseif i > 5 then
			starting_x = starting_x + 1
		end
	end

	local num = 0;
	if minNum ~= nil then
		num = minNum;
	end
	
	local selected_content = 0
	
	DrawBox(x,y,x+w-1,y+h-1,C_WHITE);
	DrawString(x+CC.MenuBorderPixel*2,y+CC.MenuBorderPixel,str.." "..minNum.." - "..maxNum,C_WHITE,size);
  
	local sid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH);
  
	while true do
		if JY.Restart == 1 then
			break
		end
		DrawShades(CC.ScreenW/2-b_space*3,y+b_space+CC.RowPixel*2,CC.ScreenW/2+b_space*3,y+b_space+CC.RowPixel*2+b_space)
		DrawString(CC.ScreenW/2,y+b_space+CC.RowPixel*2,string.format("%d",num),C_WHITE,size);
		
		for i = 1, #functional_button do
			local x_indent = 7
			local y_indent = 2
			if i > 4 then
				x_indent = 11
				y_indent = 0
			end
			local shade_color = nil;
			if i == selected_content then
				shade_color = C_GOLD
			end
			DrawShades(functional_button[i].x1,functional_button[i].y1,functional_button[i].x2,functional_button[i].y2,shade_color)
			DrawString(functional_button[i].x1+x_indent,functional_button[i].y1+y_indent,functional_button[i].name,C_GOLD,size);
		end
		
		ShowScreen()
		local key, ktype, mx, my = lib.GetKey();
		lib.Delay(CC.Frame)
        if (key == VK_ESCAPE or ktype == 4) and isEsc ~= nil then
			num = nil;
			break;
		elseif key >= 49 and key <= 57 then
			num = num * 10
			num = num + key - 48
			if num > maxNum then
				num = maxNum
			end
		elseif key >= 1073741913 and key <= 1073741921 then
			num = num * 10
			num = num + key - 1073741912
			if num > maxNum then
				num = maxNum
			end
		elseif key == 48 or key == 1073741922 then
			num = num * 10
			if num > maxNum then
				num = maxNum
			end
		elseif key == VK_BACKSPACE then
			num = math.modf(num/10)
		elseif key == VK_SPACE or key == VK_RETURN then
			if num >= minNum and num <= maxNum then
				break;
			end
		elseif ktype == 2 or ktype == 3 then
			selected_content = 0
			if mx >= x and mx <= x + w-1 and my >= y and my <= y + h-1 then
				for k = 1, #functional_button do 
					if mx >= functional_button[k].x1 and mx <= functional_button[k].x2 and my >= functional_button[k].y1 and my <= functional_button[k].y2 then
						selected_content = k;
						break;
					end
				end
			end
			if ktype == 3 then
				if selected_content == 1 then
					if num >= minNum and num <= maxNum then
						break;
					end
				elseif selected_content == 2 then
					num = maxNum
				elseif selected_content == 3 then
					num = 0
				elseif selected_content == 4 then
					num = math.modf(num/10)
				elseif selected_content > 4 then
					num = num * 10
					num = num + functional_button[selected_content].name
					if num > maxNum then
						num = maxNum
					end
				end
			end
		end
		ClsN();
		lib.LoadSur(sid,0,0)
	end
	lib.FreeSur(sid);
	return num;
end

--·ÖÎö×Ö·û´®ÖĞÊÇ·ñÓĞÑÕÉ«±êÖ¾
--±»DrawTxtº¯Êıµ÷ÓÃ
function AnalyString(str)
	local tlen = 0;
	local strcolor = {}
	--¼ì²éÊÇ·ñÓĞÑÕÉ«±êÖ¾
	local f1, f2 = string.find(str, "<[A-R]>");
	if f1 ~= nil then
		while 1 do
			if f1 > 1 then
				local s1 = string.sub(str, 1, f1-1)
				table.insert(strcolor, {s1, nil});
				tlen = tlen + #s1;
			end
			local match = string.match(str, "<([A-R])>");
			local f3, f4 = string.find(str, "</"..match..">"); 
			if f3 ~= nil then
				local s2 = string.sub(str, f2+1, f3-1);
				table.insert(strcolor, {s2, CC.Color[match]});
				tlen = tlen + #s2;
				if f4+1 >= #str then
					break;
				end
				str = string.sub(str, f4+1, #str);
				f1, f2 = string.find(str, "<[A-R]>");
				--Èç¹ûÒÑ¾­Ã»ÓĞÆäËüÑÕÉ«±êÖ¾£¬Ö±½ÓÊäÈëÍË³öÑ­»·
				if f1 == nil then
					table.insert(strcolor, {str, nil});
					break;
				end
			else		--Èç¹ûÕÒ²»µ½½áÊø±êÖ¾£¬Ö±½ÓÊäÈëÍË³öÑ­»·
				str = string.sub(str, f2+1, #str);
				table.insert(strcolor, {str, CC.Color[match]});
				break;
			end
		end
	else
		table.insert(strcolor, {str, nil});
	end
	return strcolor;
end

--´æµµÁĞ±í
function SaveList()
	--¶ÁÈ¡R*.idxÎÄ¼ş
	local idxData = Byte.create(24)
	Byte.loadfile(idxData, CC.R_IDXFilename[0], 0, 24)
	local idx = {}
	idx[0] = 0
	for i = 1, 6 do
		idx[i] = Byte.get32(idxData, 4 * (i - 1))
	end

	local table_struct = {}
	table_struct["ĞÕÃû"]={idx[1]+8,2,10}
	table_struct["×ÊÖÊ"]={idx[1]+122,0,2}
  
	table_struct["ÎŞÓÃ"]={idx[0]+2,0,2}
	table_struct["ÄÑ¶È"]={idx[0]+24,0,2}
	
	table_struct["±ê×¼"]={idx[0]+26,0,2}
	table_struct["³©Ïë"]={idx[0]+28,0,2}
	table_struct["ÌØÊâ"]={idx[0]+30,0,2}
	
	table_struct["ÌìÊéÊıÁ¿"]={idx[0]+36,0,2}
	table_struct["Îä¹¦ÊıÁ¿"]={idx[0]+38,0,2}
	table_struct["³¡¾°Ãû³Æ"]={idx[3]+2,2,10}
	table_struct["ËéÆ¬"]={idx[0]+40,0,2}
	--Ö÷½Ç±àºÅ
	table_struct["¶ÓÎé1"]={idx[0]+52,0,2}
  
	--table_struct[WZ7]={idx[2]+88,0,2}
  
	--Ê±¼ä±£´æÔÚ³¡¾°Êı¾İÀï
	--table_struct["ÓÎÏ·Ê±¼ä"]={(CC.SWidth*CC.SHeight*(14*6+4) + CC.SWidth + 2)*2, 0, 2}
	--S_XMax*S_YMax*(id*6+level)+y*S_XMax+x
	--14, 2, 1, 4
	--sFile,CC.TempS_Filename,JY.SceneNum,CC.SWidth,CC.SHeight

	--¶ÁÈ¡R*.grpÎÄ¼ş

	local len = filelength(CC.R_GRPFilename[0]);
	local data = Byte.create(len);
	
	--¶ÁÈ¡SMAP.grp
	local slen  = filelength(CC.S_Filename[0]);
	local sdata = Byte.create(slen);
	
	local menu = {};

	for i=1, CC.SaveNum do
	
		local name = "";
		--local lv = "";
		local sname = "";
		local nd = "";
		local time = "";
		--ÌìÊéÊıÁ¿
		local tssl = "";
		--Ö÷½ÇÀàĞÍ
		local zjlx = "";	
		--×ÊÖÊ
		local zz = "";
		
		if existFile(string.format('data/save/Save_%d',i)) then
			Byte.loadfilefromzip(data, string.format('data/save/Save_%d',i),'r.grp', 0, len);
			
			local pid = GetDataFromStruct(data,0,table_struct,"¶ÓÎé1");
			
			name = GetDataFromStruct(data,pid*CC.PersonSize,table_struct,"ĞÕÃû");
			zz = GetDataFromStruct(data,pid*CC.PersonSize,table_struct,"×ÊÖÊ");
			
			local wy = GetDataFromStruct(data,0,table_struct,"ÎŞÓÃ");
			if wy == -1 then
				sname = "´óµØÍ¼";
			else
				sname = GetDataFromStruct(data,wy*CC.SceneSize,table_struct,"³¡¾°Ãû³Æ").."";
			end
			
			local lxid1 = GetDataFromStruct(data,0,table_struct,"±ê×¼");
			local lxid2 = GetDataFromStruct(data,0,table_struct,"³©Ïë");
			local lxid3 = GetDataFromStruct(data,0,table_struct,"ÌØÊâ");
			
			if lxid1 > 0 then
				zjlx = "±ê×¼"
			elseif lxid2 > 0 then
				zjlx = "³©Ïë"
			elseif lxid3 > 0 then
				zjlx = "ÌØÊâ"
			end
			
			local wz = GetDataFromStruct(data,0,table_struct,"ÄÑ¶È");
			tssl = GetDataFromStruct(data,0,table_struct,"ÌìÊéÊıÁ¿").."±¾";

			nd = MODEXZ2[wz]
			
			--ÓÎÏ·Ê±¼ä
			--[[
			Byte.loadfile(sdata, string.format(CC.S_GRP,i), 0, slen);
			
			local t = GetDataFromStruct(sdata, 0, table_struct, "ÓÎÏ·Ê±¼ä")
			local t1, t2 = 0, 0
			while t >= 60 do
				t = t - 60
				t1 = t1 + 1
			end
			t2 = t
		  
			time = string.format("%2dÊ±%2dÃë", t1, t2)]]
		end
		
		if i < 10 then
			menu[i] = {string.format("´æµµ%02d %-4s %-10s %-4s %4s %4s %-10s", i, zjlx, name, nd, zz, tssl, sname), nil, 1};
		else
			menu[i] = {string.format("×Ô¶¯µµ %-4s %-10s %-4s %4s %4s %-10s", zjlx, name, nd, zz, tssl, sname), nil, 1};
		end
	end

	local menux=(CC.ScreenW-24*CC.DefaultFont-2*CC.MenuBorderPixel)/2
	local menuy=(CC.ScreenH - 9*(CC.DefaultFont+CC.RowPixel))/2

	local r=saveShowMenu(menu,CC.SaveNum,10,menux,menuy,0,0,1,1,CC.DefaultFont,C_WHITE,C_GOLD)
	lib.Debug("SaveList")
	CleanMemory()
	return r;
end

--¶¯Ì¬ÌáÊ¾ÏÔÊ¾
function DrawTimer()
	if CC.OpenTimmerRemind ~= 1 then
		return;
	end
	local t2 = lib.GetTime();
	if CC.Timer.status==0 then
		if t2-CC.Timer.stime > 30000 or CC.Timer.stime == 0 then
			CC.Timer.stime=t2;
			CC.Timer.status=1;
			CC.Timer.str=CC.RUNSTR[math.random(#CC.RUNSTR)];
			CC.Timer.len=string.len(CC.Timer.str)/2+3;
		end
	else
		CC.Timer.fun(t2);
	end
end

function demostr(t)
	local tt=t-CC.Timer.stime;
	tt=math.modf(tt/25)%(CC.ScreenW+CC.Timer.len*CC.Fontsmall);
	if runword(CC.Timer.str,M_Orange,CC.Fontsmall,1,tt)==1 then
		CC.Timer.status=0;
		CC.Timer.stime=t;
	end
end

function runword(str,color,size,place,offset)
	offset=CC.ScreenW-offset;
	local y1,y2
	if place==0 then
		y1=0;
		y2=size;
	elseif place==1 then
		y1=CC.ScreenH-size;
		y2=CC.ScreenH;
	end
	lib.Background(0,y1,CC.ScreenW,y2,128);
	if -offset>(CC.Timer.len-1)*size then
		return 1;
	end
	DrawString(offset,y1,str,color,size);
	return 0;
end

function dark()
	instruct_14()
end

function light()
	instruct_13()
end

--ÎŞ¾Æ²»»¶£ºÌí¼ÓÊÂ¼şº¯Êı
function addevent(sid, pid, pass, event, etype, pic, x, y)
	if JY.Restart == 1 then
		return
	end
	if x == nil then x = -2 end
	if y == nil then y = -2 end
	if pic == nil then pic = -2 end
	if etype == nil then etype = 1 end
	if event == nil then event = -2 end
	if pass == nil then pass = -2 end
	if etype == 1 then
		instruct_3(sid, pid, pass, 0, event, 0, 0, pic, pic, pic, -2, x, y)
	elseif etype == 2 then
		instruct_3(sid, pid, pass, 0, 0, event, 0, pic, pic, pic, -2, x, y)
	else
		instruct_3(sid, pid, pass, 0, 0, 0, event, pic, pic, pic, -2, x, y)
	end	
end

--ÎŞ¾Æ²»»¶£ºÉ¾³ıÊÂ¼şº¯Êı
function null(sid, pid,x,y)
	if pid ~= -2 then
		addevent(sid, pid, 0, 0, 0, 0)
	else
		addevent(sid,pid,0,0,0,0,x,y)
	end		
end

--ÎŞ¾Æ²»»¶£º³©ÏëµÄÑ¡Ôñ²Ëµ¥
function ShowMenu3(menu,itemNum,numShow,showRow,x1,y1,size,color,selectColor)
    local w=0;
    local h=0;   --±ß¿òµÄ¿í¸ß
    local i,j=0,0;
    local col=0;     --Êµ¼ÊµÄÏÔÊ¾²Ëµ¥Ïî
    local row=0;
    lib.GetKey();
    Cls();

    --½¨Ò»¸öĞÂµÄtable
    local menuItem = {};
    local numItem = 0;                --ÏÔÊ¾µÄ×ÜÊı
    
    --°Ñ¿ÉÑ¡Îª³©ÏëµÄÈËÎï±£´æµ½ĞÂµÄtable
    for i,v in pairs(menu) do
        if v[3] ~= 0 then
            numItem = numItem + 1;
			menuItem[numItem] = {v[1],v[2],v[3],i};                --×¢ÒâµÚ4¸öÎ»ÖÃ£¬±£´æiµÄÖµ
        end
    end
    
    --¼ÆËãÊµ¼ÊÏÔÊ¾µÄ²Ëµ¥ÏîÊı
    if numShow==0 or numShow > numItem then
        col=numItem;
        row = 1;
    else
		--ÁĞÊı
        col=numShow;
		--(ÏîÄ¿×ÜÊı-1)/ÁĞÊı=ĞĞÊı
        row = math.modf((numItem-1)/col);
    end
    
    if showRow > row + 1 then
        showRow = row + 1;
    end

    --¼ÆËã±ß¿òÊµ¼Ê¿í¸ß
    local maxlength=0;

	for i=1,numItem do
		if string.len(menuItem[i][1])>maxlength then
			maxlength=string.len(menuItem[i][1]);
		end
	end
	w=(size*maxlength/2+CC.RowPixel*2)*col+2*CC.MenuBorderPixel;
	h=showRow*(size+CC.RowPixel*2) + 2*CC.MenuBorderPixel;

    local start=0;             --ÏÔÊ¾µÄµÚÒ»Ïî

    local curx = 1;          --µ±Ç°Ñ¡ÔñÏî
    local cury = 0;
    local current = curx + cury*numShow;

    local returnValue =0;

    local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)

    while true do
		lib.GetKey()
		if JY.Restart == 1 then
			break
		end
        if col ~= 0 then
            lib.LoadSur(surid, 0, 0)
        end
		--ËµÃ÷ĞĞÔÚ´Ë
		--DrawString(x1+(size+CC.RowPixel)*9-3,y1-(size+CC.RowPixel)*2-CC.RowPixel,"PgUp/PgDn/Êó±ê¹öÂÖ·­Ò³",LimeGreen,size);
		--DrawString(x1+(size+CC.RowPixel)*8-50,y1-(size+CC.RowPixel)*1,"Ãû³Æ»ÆÉ«ÎªÒ»½× Ãû³ÆÀ¶É«Îª¸ß½× ºìÉ«Îª¶¥½×",LimeGreen,size);
		for i=start,showRow+start-1 do
			for j=1, col do
				local n = i*col+j;
				if n > numItem then
					break;
				end
                
				--ÉèÖÃ²»Í¬µÄ»æÖÆÑÕÉ«
                local drawColor=color; 
                if menuItem[n][3] == 2 then
					drawColor = M_DeepSkyBlue
				end
				if menuItem[n][1] == "¶À¹ÂÇó°Ü"  or menuItem[n][1] == "É¨µØÀÏÉ®"
				 or menuItem[n][1] == "ÕÅÈı·á" 
				  then  
					drawColor = C_RED
                end
				if menuItem[n][1] == "ÏôÁá" or menuItem[n][1] == "ÁºÏô" or menuItem[n][1] == "ÀîÑ°»¶" 
				or menuItem[n][1] == "Àî°×"or menuItem[n][1] == "¶·¾ÆÉ®"  or menuItem[n][1] == "»ÆÉÑ" 
				or menuItem[n][1] == "åĞÒ£×Ó" or menuItem[n][1] == "´ïÄ¦" or menuItem[n][1] == "Â½½¥" 
				or menuItem[n][1] == "¿ÜÖÙ" or menuItem[n][1] == "Ë¾¿ÕÕªĞÇ" or menuItem[n][1] == "²½¾ªÔÆ"
				or menuItem[n][1] == "·ëŞ¿" or menuItem[n][1] == "ÕÅ¼Ò»Ô" or menuItem[n][1] == "ÏôÇïË®"then
				   drawColor = M_Plum
				   end
                local xx = x1+(j-1)*(size*maxlength/2+CC.RowPixel*2) + CC.MenuBorderPixel
                local yy = y1+(i-start)*(size+CC.RowPixel*2) + CC.MenuBorderPixel
                if n==current then
                    drawColor=selectColor;
                    lib.Background(xx-5, yy-5, xx + size*maxlength/2, yy + size+5, 128, color)
                end
                DrawString(xx,yy,menuItem[n][1],drawColor,size);

            end
        end
		ShowScreen();
		local keyPress, ktype, mx, my = WaitKey(1)
		local mk = false;
		lib.Delay(CC.Frame);

		if keyPress==VK_DOWN then                --Down
			cury = cury + 1;
					if cury == showRow then
						cury = 0
					elseif curx + cury*col > numItem then
						cury = 15
					end
		elseif keyPress==VK_UP then                  --Up
					if cury ~= 15 then
						cury = cury -1;
						if cury < 0 then
							cury = showRow-1;
						end
					else
						if curx + row*col > numItem then
							cury = row - 1
						else
							cury = row
						end
					end
		elseif keyPress==VK_RIGHT then                --RIGHT
                    curx = curx +1;
                    if curx > col then
                        curx = 1;
                    elseif curx + cury*col > numItem then
                        curx = 1;
                    end
		elseif keyPress==VK_LEFT then                  --LEFT
                    curx = curx -1;
                    if curx < 1 then
                        curx = col;
                        if curx + cury*col > numItem then
							curx = numItem - cury*col;
                        end
                    end
		elseif keyPress==VK_PGUP or ktype == 6 then    --PgUp »ò Êó±ê¹öÂÖÉÏ
					if start == 15 then
						start = start - 15;
						curx = 1
						cury = 0
						mk = true;
					end
		elseif keyPress==VK_PGDN or ktype == 7 then    --PgDn »ò Êó±ê¹öÂÖÏÂ	
			if start == 0 then
				start = start + 15;
				curx = 1
				cury = 15
				mk = true;
			end
		else
			if ktype == 2 or ktype == 3 then			--Ñ¡ÖĞ
				--ÎŞ¾Æ²»»¶£º¼Ó¸öÂß¼­ÅĞ¶¨·ÀÖ¹Ìø³ö
				local re1, re2 = curx, cury;
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					curx = math.modf((mx-x1-CC.MenuBorderPixel)/(size*maxlength/2+CC.RowPixel*2)) + 1
					cury = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel*2))
					mk = true;
				end
				if (curx + cury*col) > #menuItem then
					curx = re1
					cury = re2
					mk = false;
				end
			end
			--¿Õ¸ñ£¬»Ø³µ£¬
			if keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				current = curx + cury*col;
				if menuItem[current][3]==3 then
				
				elseif menuItem[current][2]==nil then
					local ys = showCXStatic(menuItem[current][4])
					if ys then
						returnValue=current
						break
					end
				else
					local r=menuItem[current][2](menuItem,current)
					if r==1 then
						returnValue= -current;
						break;
					else
						lib.LoadSur(surid, 0, 0)
					end
				end
            end
		end 
		current = curx + cury*col;
    end
	lib.FreeSur(surid)
        
	--·µ»ØÖµ£¬Õâ¸öÊÇÈ¡µÚ4¸öÎ»ÖÃµÄÖµ
	if returnValue > 0 then
		return menuItem[returnValue][4]
	else
		return returnValue
	end
end

function showCXStatic(id)
	if existFile(CC.Acvmts) then
		dofile(CC.Acvmts)
		local r = false
		local ndChn = {"¼òµ¥","ÆÕÍ¨","À§ÄÑ","µØÓü"}
		local highLvl
		if Achievements.rdsCpltd[id].lvlReached2 > 0 then
			highLvl = Achievements.rdsCpltd[id].lvlReached1.."ÖÜ"..ndChn[Achievements.rdsCpltd[id].lvlReached2]
		else
			highLvl = "ÔİÎŞ"
		end
		while true do
			if JY.Restart == 1 then
				return
			end
			Cls()
			
			lib.LoadPNG(91, 30 * 2 , 0, 0, 1)
			
			DrawString(390,50-40,JY.Person[id]["ĞÕÃû"],C_GOLD,CC.FontBig*0.9)
			
			DrawString(80,130,"Í¨¹Ø´ÎÊı£º"..Achievements.rdsCpltd[id].n.."´Î",C_WHITE,CC.DefaultFont)
			DrawString(80,200,"×î¸ßÍ¨¹ØÄÑ¶È£º"..highLvl,C_WHITE,CC.DefaultFont)
			
			DrawString(CC.ScreenW/2 - 160,CC.ScreenH - 40,"»Ø³µ¼üÈ·ÈÏÑ¡Ôñ ESCÍË³ö",LimeGreen,CC.DefaultFont*0.98)
			
			local keypress, ktype, mx, my = lib.GetKey()
			
			if keypress == VK_RETURN then
				r = true
				break
			elseif keypress == VK_ESCAPE or ktype == 4 then
				break
			end
			ShowScreen()
			lib.Delay(CC.Frame)
		end
		return r
	end
end

--ÎŞ¾Æ²»»¶£º»ñÈ¡Îä¹¦ÍşÁ¦
function get_skill_power(personid,wugongid, wugonglvl)
	local power;
	local p = JY.Person[personid]
	--µ½¼«µÄÎä¹¦°´10¼¶ÍşÁ¦Ëã
	if wugonglvl == 11 then
		wugonglvl = 10
	end
	local spower = 0 	
	power = JY.Wugong[wugongid]["¹¥»÷Á¦"..wugonglvl] 
	if wugongid == 354 then	
		local pw1 = JY.Wugong[354]['±ù·âÏµÊı']
		local pw2 = JY.Wugong[354]['×ÆÉÕÏµÊı']
		power = math.modf((JY.Wugong[pw1]["¹¥»÷Á¦"..wugonglvl] + JY.Wugong[pw2]["¹¥»÷Á¦"..wugonglvl])*0.7)
	end	
	if wugongid == 381 then	
		local pw1 = JY.Wugong[381]['±ù·âÏµÊı']
		local pw2 = JY.Wugong[381]['×ÆÉÕÏµÊı']
		power = math.modf((JY.Wugong[pw1]["¹¥»÷Á¦"..wugonglvl] + JY.Wugong[pw2]["¹¥»÷Á¦"..wugonglvl])*0.7)
	end	
	if wugongid == 379 then
		power = power + math.modf(wugonglvl*90)
	end	
	spower = power
	--Íâ¹¦µ½¼«£¬ÍşÁ¦+ 50
	for i = 1,JY.Base['Îä¹¦ÊıÁ¿'] do
		local level = math.modf(p["Îä¹¦µÈ¼¶" .. i] / 100) + 1
		if p["Îä¹¦µÈ¼¶" .. i] == 999  and JY.Wugong[wugongid]['Îä¹¦ÀàĞÍ'] ~= 6 and wugongid == p['Îä¹¦'..i] then
			power = power + 50
			break
		end
	end
    if wugongid >= 109 and wugongid <= 112 then
        local xs = 0
        local lx = JY.Wugong[wugongid]['Îä¹¦ÀàĞÍ']
        if lx == 1 then 
            xs = TrueQZ(personid)--JY.Person[personid]["È­ÕÆ¹¦·ò"]
        elseif lx == 2 then 
            xs = TrueZF(personid)--JY.Person[personid]["Ö¸·¨¼¼ÇÉ"]
        elseif lx == 3 then 
            xs = TrueYJ(personid)--JY.Person[personid]["Óù½£ÄÜÁ¦"]    
        elseif lx == 4 then 
            xs = TrueSD(personid)--JY.Person[personid]["Ë£µ¶¼¼ÇÉ"]
        elseif lx == 5 then 
            xs = TrueTS(personid)--JY.Person[personid]["ÌØÊâ±øÆ÷"]
        end
        if isteam(personid) then
            power = limitX(power + xs*3,300,1000)
        else 
            power = 1000
        end
	end
	--Ìá¸ßÌì¸³Íâ¹¦µÄÍşÁ¦
	if Given_WG(personid, wugongid) then
		power = power + 100
	end
	--Ìá¸ßÌì¸³ÄÚ¹¦µÄÍşÁ¦
	if Given_NG(personid, wugongid) then
		if power < 600 then
			power = 600
		else
		    power = math.modf(power*1.05)
		end
	end

	--Ñ§ÁË¿û»¨Ö®ºó£¬±ÙĞ°µÄÍşÁ¦
	if wugongid == 48 and PersonKF(personid, 105) then
		power = 1200
	end
	
	if wugongid == 313 and PersonKF(personid, 105) then
		power = power + 300
		if Curr_NG(personid,105) or match_ID(personid,27) then
			power = power + 200
		end	
	end
	--ËÉ·ç½£Ê¥µãµã
	if wugongid == 27 and match_ID(personid,457) then
		power = power + 2000
	end
    --Ò»Ö¸Õò½­ÄÏ
	if match_ID(personid, 138) or match_ID(personid, 9897) then
		if yongzhi(wugongid) and JY.Base["ÌìÊéÊıÁ¿"] > 0 then
		    power = power+ (100 * JY.Base["ÌìÊéÊıÁ¿"])
		end
	end
	--¾õĞÑºó·­±¶µÄÖÚÈË
	--ÍõÖØÑô+È«ÕæÆß×Ó£¬È«Õæ½£·¨
	if wugongid == 39  then
		for i = 123,129 do
			if JXPD(personid,i,1) then
				power = power * 2
				break
			end
		end
		if JXPD(personid,68,1) then
			power = power * 2
		end			
	end
	--Ã·³¬·ç£¬»ÆÉÀÅ®¾ÅÒõ°×¹Ç×¦
	if wugongid == 11 and (JXPD(personid,78,1) or JXPD(personid,640,1)) then
		power = power * 1.5
	end
	--±¯Ìì·ğÁ¯
	if wugongid == 189 and (match_ID(personid,9983) or JinGangBR(personid)) then
		power = power * 1.5
	end
	--°ËØÔÌ×
	if (wugongid == 230 or wugongid == 231) and PersonKF(personid,235) then
		power = power + 200
	end
	--ÏÄÑ©ÒË ½ğÉß½£·¨
	if wugongid == 40  and match_ID(personid, 639) then
		power = power * 1.5
	end	
	--°¢Ğã Ñ©É½½£·¨
	if wugongid == 35 and JXPD(personid, 582,1) then
		power = power * 2
	end	
	--Î¤Ò»Ğ¦£¬º®±ùÃàÕÆ
	if wugongid == 5 and JXPD(personid,14,1) then
		power = power * 1.5
	end
	--ÒóÌìÕı£¬Ó¥×¦¹¦
	if wugongid == 4 and JXPD(personid,12,1) then
		power = power * 1.5
	end
	--Öì´Ï£¬·Ö½î´í¹ÇÊÖ
	if wugongid == 117 and JXPD(personid,131,1) then
		power = power * 1.5
	end
	--äìÏæ×Ó£¬º×Éß°Ë´ò
	if wugongid == 74 and JXPD(personid,157,1) then
		power = power * 2
	end
	--Îå¶¾Éñ¹¦ Îå¶¾ÉñÕÆ ÍşÁ¦·­±¶ ±ê¼ÇĞŞ¸Ä
	if wugongid==3 and Curr_NG(personid,220) then
		power = power * 2
	end 
    --Çú·ÇÑÌ³ÖÑşÇÙÍşÁ¦·­±¶
	if match_ID(personid, 510) and wugongid == 73 then
		power = power * 2
	end	
	--ÁÖ³¯Ó¢£¬¾ª²Å¾øÑŞ
	if match_ID(personid, 605) then
		power = power * 1.1
	end
	if match_ID(personid,9749) and wugongid == 52 then
		power = power * 2
	end
	
	if match_ID(personid, 9744) and wugongid == 19 then
		power = power * 1.5
	end
	--ÆæÃÅÎå×ª
	if PersonKF(personid, 317) then
		power = power * 1.05
	end
	--ĞşÌú¼«Òâ
    if wugongid == 45 and (match_ID(personid, 58) or match_ID(personid, 592) or match_ID(personid, 628) or actor(personid,3)) then
		power = power + 300
	end
	--Ô¬¹ÚÄÏ ·òÆŞµ¶·¨ 1.5±¶
	if wugongid == 62 and match_ID(personid, 566) then
		power = power * 1.5
	end	
    if match_ID(personid,9748) and wugongid == 141 then
		power = power + 300
	end
	
	if match_ID(personid,9747) and (wugongid == 59 or wugongid == 232) then
		power = power + 200
	end
	--Ô¬×ÏÒÂÍşÁ¦·­±¶
	if match_ID(personid, 587) and (wugongid == 78 or wugongid == 164) then
		power = power + 300
	end
	--±ÙĞ°½£¿Í
	if match_ID(personid, 9888)  and wugongid == 48 then
		power = power + 500
	end
	--÷¡°İÍşÁ¦·­±¶ ±ê¼ÇĞŞ¸Ä
	if match_ID(personid,603) and wugongid == 119 then
		power = power + 600
	end
    
	--Ìì³Ø¹ÖÏÀ
	if match_ID(personid,9988) and wugongid == 10 then
		power = power + 600
	end
	if PersonKF(personid, 85) then
		if wugongid == 8 or wugongid == 14 or wugongid == 185 or wugongid == 202 or wugongid == 201 then
           power = power + 100
        end
    end 
    --Æß±¦Ö¸»· åĞÒ£Îä¹¦
    if (wugongid ==8 or wugongid == 14 or wugongid == 98 or wugongid == 101 or wugongid ==185 ) and PersonKF(personid,98) then
	    power = power + 100
	end	
	--Ì«¼«Ì×
	if (wugongid == 16 or wugongid == 46) and Curr_NG(personid, 171) then
	   power = power + 100
	end
    
	--¿İÈÙìø¹¦ Ò»ÑôÖ¸
	if wugongid ==17 and PersonKF(personid, 207) then
	   power = power + 100
	end
	-- °×Ô³
    if (match_ID(personid, 9997) or PersonKF(personid,247)) and wugongid == 188 then
       power = power + 500
	end	
	--ÌìÉ½ÕÛÃ·ÊÖ£¬ĞéÖñ£¬Í¯ÀÑ£¬ÎŞÑÂ×Ó£¬ÀîÇïË®£¬ÍşÁ¦Ìá¸ß
	if wugongid == 14 then
		if match_ID(personid, 49) or match_ID(personid, 116) or match_ID(personid, 117) or match_ID(personid, 118) or match_ID(personid, 9754)  then
			for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
				if JY.Person[personid]["Îä¹¦"..i] ~= 14 and JY.Person[personid]["Îä¹¦µÈ¼¶"..i] == 999 then
					power = power + 50
				end
			end
		end
	end
    -- ·üÄ§ìøÕÈ ·üÄ§ÕÈ·¨
	if wugongid == 86 and PersonKF(personid,96) then
	   power = power + 100
	   end	
    -- °×Ô³ Ô³¹«½£·¨
	if (wugongid == 188 or wugongid ==156) and PersonKF(personid,180) then
	   power = power + 100
	end		   
    
	if wugongid == 110 and JY.Person[personid]["ÎäÆ÷"] == 55 then
	   power = power + 100
	end	
	if wugongid == 111 and JY.Person[personid]["ÎäÆ÷"] == 56 then
	   power = power + 100
	end	
	if wugongid == 112 and JY.Person[personid]["ÎäÆ÷"] == 57 then
	   power = power + 100
    end	
    
	--°×ĞãÑ©É½½£·¨
	if wugongid == 35 then
		if JXPD(personid, 582,1) then
			for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
				if JY.Person[personid]["Îä¹¦"..i] ~= 35 and JY.Person[personid]["Îä¹¦µÈ¼¶"..i] == 999 then
					power = power + 100
				end
			end
		end
    end
    
    -- ¶¡µ±½ğÎÚµ¶·¨
    if wugongid == 61 and JXPD(personid, 581,1) then
	    power = power + 300
	end
	
	--ÎåÔÀ½£·¨ÍşÁ¦Ìá¸ß
	if wugongid >= 30 and wugongid <= 34 then
		power = power + WuyueJFSL(personid)*100
		if wugongid == 30 and PersonKF(personid,259) then --Íò»¨Åä¹ÅÕë
			power = power + 100
		end	
		if wugongid == 31 and PersonKF(personid,264) then --Ê®°ËÅÌÅäÅÍÊ¯
			power = power + 100
		end
		if wugongid == 32 and PersonKF(personid,263) then --ÔÆÎíÅäÕòÔÀ
			power = power + 100
		end
		if wugongid == 33 and PersonKF(personid,216) then --ÍòÔÀÅäº®±ù
			power = power + 100
		end
		if wugongid == 34 and PersonKF(personid,89) then --Ì«ÔÀÅä×ÏÏ¼
			power = power + 100
		end
	end
	--ÎåÔÀ½£·¨+ÎåÔÀ½£¾÷£¬ÍşÁ¦Ìá¸ß
	if wugongid >= 30 and wugongid <= 34 and PersonKF(personid,175) then
		if MPTX(personid,14) then 
			power = power + 300
		else	
			power = power + 100
		end	
	end
	if wugongid == 377 and PersonKF(personid,175) then
		power = power + 300
	end	
	--Ë«½£ºÏ±Ú£¬ÍşÁ¦Ìá¸ß
	if (wugongid == 39 or wugongid == 42 or wugongid == 139) and WGZH(personid,39,42) then
		power = power + 100
	end
	--ÇÙÆåÊé»­ÍşÁ¦Ìá¸ß
	if (wugongid == 73 or wugongid == 72 or wugongid == 84 or wugongid == 142) and WGZH(personid,72,73) then
		power = power + 100
	end
	--ÌÒ»¨¾ø¼¼ÍşÁ¦Ìá¸ß
	if (wugongid == 12 or wugongid == 18 or wugongid == 38) and WGZH(personid,12,18) then
		power = power + 100
	end
	--×ÏÆøÌìÂŞÍşÁ¦Ìá¸ß
	if (wugongid == 5 or wugongid == 9 or wugongid == 21 or wugongid == 118) and WGZH(personid,21,118) then
		power = power + 300
	end
	--¶¾²¼ÎäÁÖÍşÁ¦Ìá¸ß ±ê¼ÇĞŞ¸Ä
    if (wugongid==3 or wugongid==120 or wugongid==220  or wugongid==295  or wugongid==334) and DubuWL(personid) then
		power = power + 300
	end
	--Ììµ¶ÍşÁ¦Ìá¸ß	±ê¼ÇĞŞ¸Ä
	if wugongid == 335 then
		power = power +JY.Base["ÌìÊéÊıÁ¿"] * 50
	end
	
	if PersonKF(personid,107) then
		--´İĞÄÕÆÍşÁ¦Ìá¸ß ±ê¼ÇĞŞ¸Ä
		if wugongid == 328 then
			power = power + 900
		--¾ÅÒõÉñ¹¦¶Ô°×¹Ç×¦ÍşÁ¦Ìá¸ß
		elseif wugongid == 11 then
		    power = power + 100
		end
	end
	
	--ÎäÄÂÒÅÊé	±ê¼ÇĞŞ¸Ä
	if wugongid == 199 then
		local sz=math.modf(JY.Person[personid]["ÊµÕ½"])
		if not inteam(personid) then
			sz = 1000
		end
	   power = power + 750 + sz
    end	
	--³¯Í¢ÔÀÍõÉ¢ÊÖ
	if MPTX(personid,5,4) and wugongid == 198 then
		local sz = JY.Person[personid]["ÊµÕ½"]
		power = power + sz
	end
	--Ò×½î¼ÓÇ¿ÉÙÁÖÎäÑ§
	if (wugongid == 1  or wugongid == 22 or wugongid == 24 or wugongid == 189 or wugongid == 86 or wugongid == 124 or wugongid == 132 
	or wugongid == 133 or wugongid == 135  or wugongid == 136   or wugongid == 137 or wugongid == 65 or wugongid == 140 or wugongid == 144 or wugongid== 194) and Curr_NG(personid,108) then
        power = power + 100
	end
	if MPTX(personid,5) and PersonKF(personid,208) then
		if wugongid == 1 then
			power = power + 300
		end
		if wugongid == 347 then
			power = power + TrueQZ(personid)
		end
	end			
	
	--Ò×¾­Ï´ËèÍşÁ¦Ìá¸ß
	if match_ID(personid, 9928) and (Curr_NG(personid, 108) or JY.Person[personid]["ÃÅÅÉ¼¼ÄÜ4"] == 1001) and wugongid > 0 then
		power = power + 200 + JY.Base["ÌìÊéÊıÁ¿"] * 50
	end
	
	if NGQH(personid,108) and wugongid == 108 then
		power = power + 400
	end
	
	--ÎäÆ÷×°±¸ÍşÁ¦¼Ó³É
	for i,v in ipairs(CC.ExtraOffense) do
		if v[1] == JY.Person[personid]["ÎäÆ÷"] and v[2] == wugongid then
			power = power + v[3]
		end
	end
	
	if wugongid == 155 and (match_ID(personid, 606) or match_ID(personid, 9761) or PDTZ(personid,JY.Person[personid]["ÎäÆ÷"])) then
		power = power + 3000
	end
	
	--ÎŞÎÒÎŞ½£
	if wugongid > 0 and match_ID(personid,9982) then
		if match_ID(personid,592) then
			power = power + 1000
		else
		    power = power + 100
		end
	end
	--Ö»ÓĞÕ½¶·ÖĞ²ÅÓĞµÄ¼Ó³É
	if JY.Status == GAME_WMAP then
        --°×ĞåÑ©É½½£·¨
		if WAR.PD['Ñ©»¨Áù³ö'][personid] ~= nil and wugongid == 35 then 
            power = power + spower * WAR.PD['Ñ©»¨Áù³ö'][personid]
        end
		--ÖÜÍşĞÅºôÑÓÊ®°Ë±ŞÍşÁ¦·­±¶
		if match_ID(personid, 612) and wugongid == 206 and WAR.ZWX > 0 then
			power = power *  WAR.ZWX
		end
		--×¿ÌìĞÛºôÑÓÊ®°Ë±Ş¡¢ÕğÌìÌúÕÆÍşÁ¦·­±¶
		if match_ID(personid, 613) and (wugongid == 205 or wugongid == 206) and WAR.ZWX > 0 then
			power = power *  WAR.ZWX
		end	
		--ºÎÌúÊÖÕ½¶·ÖĞÎå¶¾ÍşÁ¦·­±¶	±ê¼ÇĞŞ¸Ä
		if match_ID(personid, 83) and wugongid == 3 and WAR.HTS > 0 then
			power = power * WAR.HTS
		end
		--¿û»¨µãÑ¨ÊÖ
		if wugongid == 226 and Curr_NG(personid,105) and PersonKF(personid,105) and WAR.KHZF > 0 then
			power = power * WAR.KHZF
		end
		if wugongid == 226 or wugongid == 126 or wugongid == 127 or wugongid == 201 then
			if PersonKF(personid,226) and PersonKF(personid,201) and (PersonKF(personid,126) or PersonKF(personid,127)) then
				power = power + 300
			end
		end
		--Ì«¼«Éñ¹¦ĞîÁ¦ÌáÉıÎä¹¦ÍşÁ¦
        if Curr_NG(personid, 171) and (wugongid ==16 or wugongid == 46) and WAR.tmp[3000 + personid] ~= nil and WAR.tmp[3000 + personid] > 0 then
            if wugongid == 16 then
                power = power + WAR.tmp[3000 + personid]
            else			 
                power = power + math.modf(WAR.tmp[3000 + personid] / 2)
            end
        end	
		--ÉÙÁÖ½ğ¸Õ
		if MPTX(personid,5,2) and WAR.PD['½ğ¸ÕÊÖ'][personid] ~= nil and (yongquan(wugongid) or yongzhi(wugongid)) then
			power = power + limitX(math.modf(WAR.PD['½ğ¸ÕÊÖ'][personid]*0.2),0,5000)
		end
		--ÉÙÁÖÂŞºº
		if MPTX(personid,5,2) and WAR.PD['ÂŞººµ¶Ææ'][personid] ~= nil and (yongdao(wugongid) or yongte(wugongid)) then
			power = math.modf(power*WAR.PD['ÂŞººµ¶Ææ'][personid]*0.01)
		end
		--¶·×ªĞÇÒÆ
		if MuRongDZ(personid) and WAR.DZXY > 0 and WAR.DZXYLV[personid] ~= nil and WAR.DZXYLV[personid] > 0 then
			power = math.modf(power*WAR.DZXYLV[personid]*0.8)
		end
	end		
	--ÖÜÜÆÈô£¬Ë­ÓëÕù·æ
	if PersonKF(personid,41) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 3 then
		if match_ID(personid, 631) or match_ID(personid,6) then
            power = power + 200
        else
            power = power + 100
        end
    end
 	--È­·¨¾«Í¨
	 if match_ID(personid,9960) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 1 then
            power = power + 100
	end 
 	--Ö¸·¨¾«Í¨
	 if match_ID(personid,9959) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 2 then
		power = power + 100
	 end
 	--½£·¨¾«Í¨
	 if match_ID(personid,9958) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 3 then
		power = power + 100
	 end	 
 	--µ¶·¨¾«Í¨
	 if match_ID(personid,9957) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 4 then
		power = power + 100
	 end	
 	--ÆæÃÅ¾«Í¨
	 if match_ID(personid,9956) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 5 then
		power = power + 100
	 end
 	--ÉñÈ­ÎŞµĞ
	 if match_ID(personid,9955) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 1 then
            power = power + 200
	end 
 	--Ç§ÊÖÉñÍ¨
	 if match_ID(personid,9954) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 2 then
		power = power + 200
	 end
 	--½£ÊõÍ¨Éñ
	 if match_ID(personid,9953) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 3 then
		power = power + 200
	 end	 
 	--°ÁÊÀ¿ñµ¶
	 if match_ID(personid,9952) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 4 then
		power = power + 200
	 end	
 	--ÆæÃÅÎŞË«
	 if (match_ID(personid,9951) or match_ID(personid,69)) and JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 5 then
		power = power + 200
     end	 	  	  
	--ºúÒ»µ¶ ÁÉ¶«´óÏÀ
	if match_ID(personid, 633) and PersonKF(personid,44) and wugongid == 67 then
		power = power + 200
	end	
	--·ëŞ¿
	if match_ID(personid, 588)  and (wugongid == 18 or wugongid == 38 or wugongid == 12 or wugongid == 126) then
		power = power + 200
	end	
	if match_ID(personid,9919) and wgnlxz(wugongid) == 0 then
		power = power + limitX(math.modf(psx(personid,'ÊµÕ½')*0.3),0,3000)
	end	
	
	power = math.modf(power)
	return power
end


--ÈËÎï»Ö¸´Õ¾¶¨
function stands()
	JY.MyCurrentPic=0
	if JY.Person[0]["ĞÔ±ğ"] == 0 then
		JY.MyPic=CC.MyStartPicM+JY.Base["ÈË·½Ïò"]*7+JY.MyCurrentPic;
	else
		JY.MyPic=CC.MyStartPicF+JY.Base["ÈË·½Ïò"]*7+JY.MyCurrentPic;
	end
end

--ÎŞ¾Æ²»»¶£ºÂí³µµÄÑ¡Ôñ²Ëµ¥
function TeleportMenu(menu, color, selectColor)
	local x1	--²Ëµ¥ÆğÊ¼X×ø±ê
    local y1	--²Ëµ¥ÆğÊ¼Y×ø±ê
    local w		--²Ëµ¥¿í¶È
    local h		--²Ëµ¥¸ß¶È
	local maxlength		--µ¥Î»×î´ó³¤¶È
	local size = CC.Fontsmall	--×ÖÌå´óĞ¡
	--local size1 = CC.Fontsmall*0.9	--×ÖÌå´óĞ¡
	local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
	x1 = CC.MainMenuX+3
    y1 = CC.MainMenuY+CC.Fontsmall*2 +9

	maxlength = 8
	
	w = (size*maxlength/2+CC.RowPixel*4+5)*7 + CC.MenuBorderPixel	--7ÎªÁĞÊı
    h = (size+CC.RowPixel*2-1)*16 + CC.MenuBorderPixel				--16Îª×î´óĞĞÊı
	
    lib.GetKey();
    Cls();
	
	lib.LoadPNG(91, 13 * 2 , bx*212 , by*33.5, 1)		--±³¾°Í¼
    
	--½¨Á¢Æß¸ö±í¸ñÀ´´æ´¢²»Í¬ÀàĞÍµÄ³¡¾°
    local PType_1 = {};
    local PNum_1 = 0;
	local PType_2 = {};
    local PNum_2 = 0;
	local PType_3 = {};
    local PNum_3 = 0;
	local PType_4 = {};
    local PNum_4 = 0;
	local PType_5 = {};
    local PNum_5 = 0;
	local PType_6 = {};
    local PNum_6 = 0;
	local PType_7 = {};
    local PNum_7 = 0;
    
	--v123·Ö±ğÎª³¡¾°Ãû³Æ£¬¿É·ñ½øÈë£¬³¡¾°±àºÅ
	--v2Îª0´ú±í¿É½øÈë£¬1´ú±í²»¿É½øÈë
    for i,v in pairs(menu) do
        if v[4] == 1 then
			PNum_1 = PNum_1 +1
			PType_1[PNum_1] = {v[1],v[2],v[3]}
		elseif v[4] == 2 then
			PNum_2 = PNum_2 +1
			PType_2[PNum_2] = {v[1],v[2],v[3]}	
		elseif v[4] == 3 then
			PNum_3 = PNum_3 +1
			PType_3[PNum_3] = {v[1],v[2],v[3]}
		elseif v[4] == 4 then
			PNum_4 = PNum_4 +1
			PType_4[PNum_4] = {v[1],v[2],v[3]}	
		elseif v[4] == 5 then
			PNum_5 = PNum_5 +1
			PType_5[PNum_5] = {v[1],v[2],v[3]}
		elseif v[4] == 6 then
			PNum_6 = PNum_6 +1
			PType_6[PNum_6] = {v[1],v[2],v[3]}
		elseif v[4] == 7 then
			PNum_7 = PNum_7 +1
			PType_7[PNum_7] = {v[1],v[2],v[3]}
		end
    end
	
	--³¡¾°ĞÅÏ¢
	local P_inf = {{PType_1,PNum_1},{PType_2,PNum_2},{PType_3,PNum_3},{PType_4,PNum_4},{PType_5,PNum_5},{PType_6,PNum_6},{PType_7,PNum_7},[0]={0,0}}
	local PType_name = {"¿ÍÕ»³ÇÕò","½­ºş°ïÅÉ","½­ºş°ï»á","ÈËÎï¾ÓËù","ÃûÉ½´ó´¨","É½¶´µºÓì","ÔÓÀà³¡Ëù"}

	--¹â±êµÄ³õÊ¼Î»ÖÃ
	local cursor_x = 1-- bx*212
	local cursor_y = 1-- by*33.5
	local current = 1

	--·µ»ØÖµ
    local returnValue =-1;
  
    local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)

    while true do
		if JY.Restart == 1 then
			break
		end
        lib.LoadSur(surid, 0, 0)
		--DrawString(x1+10,y1-CC.RowPixel*4-7,"X:"..cursor_x.."£¬Y:"..cursor_y.."£¬Current:"..current,LimeGreen,size);	--Êä³ö²âÊÔĞÅÏ¢
		for i = 1, 7 do
			--´óÀàÃû³Æ
		--	DrawString(x1+(i-1)*(size*maxlength/2+CC.RowPixel*4+5)+CC.MenuBorderPixel,y1-CC.RowPixel*6+1,PType_name[i],LimeGreen,size);
			for j = 1, 16 do
				if j > P_inf[i][2] then
					break;
				end
				--È·¶¨µ±Ç°µ¥Î»±àºÅ
				local id = 0
				for jj = 1, i do
					id = id + P_inf[jj-1][2]
				end
				id = id + j
				--ÎŞ·¨½øÈëµÄ³¡¾°Ãû³ÆÎª»ÒÉ«
				local drawColor = color; 
				if P_inf[i][1][j][2] == 1 then
					drawColor = M_DimGray
				end
				local xx = x1+(i-1)*(size*maxlength/2+CC.RowPixel*4+5) + CC.MenuBorderPixel+ bx*212
				local yy = y1+(j-1)*(size+CC.RowPixel*2-1)+ by*33.5
				--Çø±ğµ±Ç°Ñ¡ÖĞµÄµ¥Î»ÑÕÉ«
				if id == current then
					drawColor = selectColor;
					lib.Background(xx-5, yy-5, xx + size*maxlength/2+5, yy + size + 5, 128, color)
				end
				--ÏÔÊ¾³¡¾°Ãû³Æ
				DrawString(xx,yy,P_inf[i][1][j][1],drawColor,size*0.9);
			end
		end
  
        ShowScreen();
        local keyPress, ktype, mx, my = WaitKey(1)
		
		lib.Delay(CC.Frame);
				
		--ktype  1£º¼üÅÌ£¬2£ºÊó±êÒÆ¶¯£¬3:Êó±ê×ó¼ü£¬4£ºÊó±êÓÒ¼ü£¬5£ºÊó±êÖĞ¼ü£¬6£º¹ö¶¯ÉÏ£¬7£º¹ö¶¯ÏÂ
        if keyPress==VK_ESCAPE or ktype == 4 then
            break;
        elseif keyPress==VK_DOWN then
			cursor_y = cursor_y + 1
			if cursor_y > P_inf[cursor_x][2] then
				cursor_y = 1
			end
		elseif keyPress==VK_UP then
			cursor_y = cursor_y - 1
			if cursor_y < 1 then
				cursor_y = P_inf[cursor_x][2]
			end
		elseif keyPress==VK_RIGHT then
			cursor_x = cursor_x + 1
			if cursor_x > 7 then
				cursor_x = 1
			end
			if cursor_y > P_inf[cursor_x][2] then
				cursor_y = 1
			end
		elseif keyPress==VK_LEFT then
			cursor_x = cursor_x - 1
			if cursor_x < 1 then
				cursor_x = 7
			end
			if cursor_y > P_inf[cursor_x][2] then
				cursor_y = 1
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then
				if mx >= x1  and mx <= x1 + w +bx*212 and my >= y1 and my <= y1 + h then
					cursor_x = math.modf((mx -bx*212- x1 - CC.MenuBorderPixel)/(size*maxlength/2+CC.RowPixel*4+5)) + 1
					cursor_y = math.modf((my-by*33 - y1 - CC.MenuBorderPixel) / (size+CC.RowPixel*2-1)) + 1 
					mk = true;
				end
				if cursor_y > P_inf[cursor_x][2] then
					cursor_y = P_inf[cursor_x][2]+1
					mk = false;
				end
			end				
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or (ktype == 3 and mk) then
				if P_inf[cursor_x][1][cursor_y][2] == 0 then
					returnValue=P_inf[cursor_x][1][cursor_y][3];
					break;
				end
			end
		end
		current = 0
		for i = 1, cursor_x do 
			current = current + P_inf[i-1][2]
		end
		current = current + cursor_y
    end
    lib.FreeSur(surid)
    --·µ»ØÖµ
	return returnValue
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶Ï¶ÓÎéÊÇ²»ÊÇÓĞÁ½¸ö¿ÕÎ»
function More_than_2_vacant_slot()
	if JY.Base["¶ÓÎé14"] == -1 and JY.Base["¶ÓÎé15"] == -1 then
		return true
	end
	return false
end

--ÎŞ¾Æ²»»¶£º¸öÈË¾õĞÑ
function SetJX(id, value)
	--local xwperson;	--ÅĞ¶¨Òª¾õĞÑµÄÈË
	if id == 0 then
		if JY.Base['³©Ïë'] > 0 then
			JY.Person[0]["¸öÈË¾õĞÑ"] = JY.Person[0]["¸öÈË¾õĞÑ"] + value
		end	
		if JY.Base['±ê×¼'] > 0 then
			JY.Person[0]["ÁùÈç¾õĞÑ"] = JY.Person[0]["ÁùÈç¾õĞÑ"] + value
		end
		--[[if (JY.Person[0]["¸öÈË¾õĞÑ"] >= 2 or JY.Person[0]["ÁùÈç¾õĞÑ"] >= 2) and JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] < 1 then
			JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] = 1
		end--]]
	else	
		JY.Person[id]["¸öÈË¾õĞÑ"] = JY.Person[id]["¸öÈË¾õĞÑ"] + value	
		if match_ID(0,id) then
			JY.Person[0]["¸öÈË¾õĞÑ"] = JY.Person[0]["¸öÈË¾õĞÑ"] + value
		end
		if inteam(id) and JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] < 1 then
			JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] = 1
		end
	end	
end	

--ÎŞ¾Æ²»»¶£ºÔö¼ÓÎä³£
function kungfu_knowledge(id, value)
	local xwperson;	--ÅĞ¶¨ÒªÔö¼ÓÎä³£µÄÈË
	if id == JY.Base["³©Ïë"] then
		xwperson = 0
	else
		xwperson = id
	end
	JY.Person[xwperson]["ÎäÑ§³£Ê¶"] = JY.Person[xwperson]["ÎäÑ§³£Ê¶"] + value
end

--Ö±½ÓÉè¶¨Ö¸¶¨ÈËÎïµÄ×ÊÖÊ
function set_potential(id, value)
	local xwperson;	--ÅĞ¶¨ÒªÖ¸¶¨×ÊÖÊµÄÈË
	if id == JY.Base["³©Ïë"] or (JY.Base["µ¥Í¨"]==2 and instruct_16(id)) then
		xwperson = 0		
	else
		xwperson = id
	end
	JY.Person[xwperson]["×ÊÖÊ"] = value
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨ÊÇ²»ÊÇÏÔÊ¾ÌØ¼¼
function secondary_wugong(wugongid)
	--Çá¹¦
	if JY.Wugong[wugongid]["Îä¹¦ÀàĞÍ"] == 7 then
		return true
	--Îü¹¦£¬½ğ¸Õ²»»µ£¬ÎåÔÀ½£¾÷ Àî·Éµ¶ ±ê¼ÇĞŞ¸Ä
	elseif wugongid == 85 or wugongid == 87 or wugongid == 88 or wugongid == 144 or wugongid == 175  or wugongid == 182 or wugongid == 43 or wugongid == 77 then
		return true
	end
	return false
end

function WGZHAOSHI(wugongid)
	if wugongid == 26 or wugongid == 25  or wugongid == 21 
		or wugongid == 45 or wugongid == 46  or wugongid == 48 
		or wugongid == 67 or wugongid == 66  or wugongid == 153 
		or wugongid == 80 or wugongid == 82  or wugongid == 81
		or wugongid == 49 or wugongid == 138 or wugongid == 11 then
		return true
	end
	return false
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ö÷ÔËÄÚ¹¦µÄº¯Êı
function Curr_NG(personid, NGid)
	if JY.Status == GAME_WMAP and WAR.PJTX1 ~= 0 and (not match_ID(personid,592)) then
		return false
	elseif JY.Status == GAME_WMAP and WAR.PD['ÖØ¶ÈÄÚÉË'][personid] ~= nil and math.random(10) > 7 then
		return false
	elseif JY.Status == GAME_WMAP and WAR.PD['×ß»ğÈëÄ§'][personid] ~= nil and math.random(100) > 85 and ((not match_ID(personid,60)) or (not PersonKF(personid,104))) then
		return false
	elseif JY.Status == GAME_WMAP and WAR.PD['ÆÆ¾ü'][personid] ~= nil then
	    return false
	elseif JY.Status == GAME_WMAP and WAR.PD['Äı½áÊ±¿Õ'][personid] ~= nil then
	    return false
	elseif JY.Status == GAME_WMAP and WAR.PD['ĞéĞ°¶Ï¿Õ'][personid] == 3  then
	    return false    
	else	
		if JY.Person[personid]["Ö÷ÔËÄÚ¹¦"] == NGid then	--±ê¼ÇĞŞ¸Ä
			if not inteam(personid) then
				return true 
			elseif PersonKF(personid,NGid) then
				return true
			end
		end	
		if JY.Person[personid]['Ö÷ÔËÄÚ¹¦'] == 354 then
			if NGid == JY.Wugong[354]['×ÆÉÕÏµÊı'] or NGid == JY.Wugong[354]['±ù·âÏµÊı'] then
				return true
			end
		end		
		--µÚ¶ş´ÎÈÚºÏÄÚ¹¦ÎŞĞèÖ÷ÔË¼´¿ÉÏíÊÜÖ÷ÔËĞ§¹û
		if PersonKF(personid,381) then
			if NGid == JY.Wugong[381]['×ÆÉÕÏµÊı'] or NGid == JY.Wugong[381]['±ù·âÏµÊı'] then
				return true
			end
		end		
		--Ììî¸µÄÅĞ¶¨
		if personid == 0 and JY.Base["±ê×¼"] == 6 then
			--Èç¹ûÊÇÌìÄÚ£¬²¢ÇÒÒÑ¾­Ñ§»á£¬Ôò×Ô¶¯Ö÷ÔË
			if JY.Person[personid]["Ìì¸³ÄÚ¹¦"] == NGid and PersonKF(personid, NGid) then
				--Hp_Max(personid)
				return true
			end
		end	
		--»ÆÉÑ
		if match_ID(personid,637) or match_ID(personid,781) then
			if NGid == 107 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		--É¨µØ
		if match_ID(personid,114) then
			if NGid == 108 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		--¾ÅÑôÈÊÑô
		if match_ID(personid,638) or JXPD(personid,9,1) or match_ID(personid,781) then
			if NGid == 106 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		--Ì«Ğş
		if JXPD(personid,38, 1) or match_ID(personid,673) or match_ID(personid,636) then
			if NGid == 102 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end
		--Ñî±ùÓğ
		if match_ID(personid,514) or match_ID(personid,9740) then
			if NGid == 43 and PersonKF(personid, NGid) then
				return true
			end
		end
		--×ÚÖ÷NPC
		if match_ID(personid,514) then
			if NGid == 95 and inteam(personid) == false then 
				return true
			end
		end	
		--ÌìÏÂÎŞµĞ
		if match_ID(personid,9938) and personid == 0 then
			if NGid > 0 and PersonKF(personid, NGid) then
				return true
			end
	    end
		--¶«·½µãµãÊÔÁ¶
		if match_ID(personid,457) then
			if NGid == 105 and (inteam(personid) == false or JY.Person[457]['ÂÛ½£½±Àø'] == 100) then 
			    return true
			end
		end
		--·½Ö¤
		if JXPD(personid,149,1) and match_ID(personid,149) then
			if NGid == 108 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		--Ïô°ëºÓ
		if match_ID(personid,189) or match_ID(personid,9849) then
			if NGid == 90 and (PersonKF(personid, NGid) or inteam(personid) == false) then
			    return true
			end
		end	
		--³µÉñ
		if match_ID(personid,524) or match_ID(personid,586) or match_ID(personid,9849) then
			if NGid == 375 and (PersonKF(personid, NGid) or inteam(personid) == false) then
				return true
			end
		end	
		--µÁÊ¥
		if match_ID(personid,511) then
			if NGid == 227 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end	
		
		--ÕÅÎŞ¼É
		if match_ID(personid,9) then
			if NGid == 97 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end
				

		--ÁºÏô
		if match_ID(personid,635) then
			if NGid == 180 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
				return true
			end
		end
		
		--Ñî¹ı
		if match_ID(personid,58) then
			if NGid == 252 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
			    return true
			end
		end
		--ÆæÃÅÎå×ª
		if match_ID(personid,9848) then
			if NGid == 317 and PersonKF(personid, NGid) then
				return true
			end			
		end
		--Ê®ÁúÊ®Ïó
		if match_ID(personid,9931) then
			if NGid == 103 and PersonKF(personid,NGid) then
				return true
			end
		end		
		--¿ÕÃ÷Ö®ÎäµÀ ½ğ¹Ø
		if match_ID(personid,9854) then
			if NGid == 249 and PersonKF(personid, NGid) then
				return true
			end			
		end
		--ÎåÔÀÕæ´«
		if MPPD(personid) == 14 and MPDJ(personid) == 6 and PersonKF(personid,175) then
			if NGid == 89 or NGid == 259 or NGid == 264 or NGid == 263 or NGid == 216 then
				return true
			end			
		end
		--ÁùÂö
	    if match_ID(personid,9893) then
			if NGid == 314 and (PersonKF(personid, NGid) or inteam(personid) == false) then
				return true
			end			
		end
		--»ô¶¼ÁúÏó°ãÈô¹¦
		if match_ID(personid,84) and JXPD(personid,84,1) then
			if NGid == 103 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
				return true
			end
		end
		--¶À¹ÂÇó°Ü¡¢°¢Çà
		if match_ID(personid,592) or match_ID(personid,604) or match_ID(personid,636) then
			if NGid == 184 and (PersonKF(personid, NGid) or inteam(personid) == false) then 
				return true
			end
		end
		--åĞÒ£×Ó
		--if match_ID(personid,634) and JXPD(personid,634,1) then
			--if NGid > 0 and (NGid ~= 315 or NGid ~= 354 or NGid ~= 359 or NGid ~= 367) then
				--return true
			--end
		--end
		--Õ½¶·ÖĞĞ­Í¬Ö÷ÔË
		if JY.Status == GAME_WMAP then
			--»ìãçÌ«Ğş
			if personid == 0 and JY.Person[191]["Æ·µÂ"] == 60 and JY.Person[0]["×ÊÖÊ"] <= 30 then
				if NGid == 102 and PersonKF(personid, NGid) then
					return true
				end
			end
			--°×ÍÕÄæÔË
			if personid == 0 and MPTX(personid,8,3) and JY.Person[60]['ÂÛ½£½±Àø'] == 1 and WAR.PD['°×ÍÕÄæÔËÅĞ¶¨'][0] == 1 then
				if NGid == 107 and PersonKF(personid, NGid) then
					return true
				end
			end
			--Îäµ±´¿Ñô
			if MPPD(personid) == 4 and MPDJ(personid) == 4 and PersonKF(personid,171) and JY.Base["ÌìÊéÊıÁ¿"] > 7 then
				if NGid == 99 and PersonKF(personid, NGid) and Curr_NG(personid,171) and (JY.Person[personid]["ÄÚÁ¦ĞÔÖÊ"] ~= 0 ) then
					return true
				end
			end
		end	
		--¸±ÔËÄÚ¹¦
		if JY.Person[personid]["ÃÅÅÉ¼¼ÄÜ1"] > 1 then
			if JY.Person[personid]["ÃÅÅÉ¼¼ÄÜ1"] == NGid and PersonKF(personid,NGid) then
				return true
			else
				return false
			end
		end	
		--------------ÃÅÅÉ´óÀÏ×ÔÖ÷ÔË¹¦-----------------------
		if inteam(personid) == false or JXPD(personid,personid,1) or (personid == 0 and JXPD(personid,JY.Base['³©Ïë'],1)) then
			local id = personid
			local ng = NGid
			if match_ID(id,46) and ng == 87 then
				return true
			end
			if (match_ID(id,50) or match_ID(id,69)) and (ng == 204 or ng == 215) then
				return true
			end
			if match_ID(id,605) and (ng == 211 or ng == 154) then
				return true
			end
			if match_ID(id,5) and (ng == 99 or ng == 227 or ng == 171 or ng == 241) then
				return true
			end	
			if match_ID(id,577) and (ng == 108 or ng == 92 or ng ==91 or ng == 106 or ng == 144 or ng ==243 or ng == 208) then
				return true
			end	
			if match_ID(id,62) and ng == 103 then
				return true
			end
			if match_ID(id,97) and (ng == 163 or ng == 214) then
				return true
			end	
			if match_ID(id,116) and ng == 85 then
 				return true
 			end
 			if match_ID(id,117) and ng == 101 then
 				return true
 			end
 			if match_ID(id,118) and ng == 98 then
 				return true
 			end
 			if match_ID(id,60) and ng == 95 then
 				return true
 			end
 			if match_ID(id,57) and (ng == 317 or ng == 248 or ng == 251) then
	 			return true
	 		end	
	 		if (match_ID(id,501) or match_ID(id,596)) and ng == 152 then
	 			return true
	 		end
	 		if match_ID(id,26) and (ng == 88 or ng == 219) then
	 			return true
	 		end
	 		if (match_ID(id,27) or match_ID(id,26)) and ng == 105 then
	 			return true
	 		end	
	 		if match_ID(id,641) and ng == 93 then
	 			return true
	 		end
			if match_ID(id,456) and (ng == 88 or ng == 93 or ng == 94 or ng == 97 or ng == 203) then
	 			return true
	 		end
			if match_ID(id,748) and (ng == 365 or ng == 366) then
	 			return true
	 		end
	 		if match_ID(id,499) and (ng == 314 or ng == 207 or ng == 250) then
	 			return true
	 		end
	 		if match_ID(id,65) and (ng == 314) then
	 			return true
	 		end
	 		if match_ID(id,129) and (ng == 100 or ng == 249 or ng == 210) then
	 			return true
	 		end
	 		if match_ID(id,64) and (ng == 249 or ng == 210) then
	 			return true
	 		end
	 		if match_ID(id,626) and (ng == 242 or ng == 247 ) then
	 			return true
	 		end
			if match_ID(id,634) then
				if ng == 85 or ng == 98 or ng == 101 or ng == 183 or ng == 227 then
					return true
				end
			end
	 		if ng == 375 and (match_ID(id,586) or match_ID(id,604)) then
	 			return true
	 		end
	 		if match_ID(id,568) and ng == 199 then
	 			return true
	 		end	
			if match_ID(id,517) and ng == 367 then
	 			return true
	 		end					
		end	
		-------------ÃÅÅÉ¸ß½××Ô¶¯Ö÷ÔË-----------------------	
		if personid == 0 and MPTX(personid,5,4) and CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ'] > 0 then
			local ng = {144,96,108}
			if NGid == ng[CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ']] then
				return true
			else
				return false	
			end	
		end	
		-------------ÌØÊâ×´¿öÖ÷ÔË----------------------------
		if personid == 638 and CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ'] == 5 then
			if NGid == 108 then
				return true
			end
		end		
	end	
	return false
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ö÷ÔËÇá¹¦µÄº¯Êı
function Curr_QG(personid, QGid)
	if JY.Status == GAME_WMAP and WAR.PD['Äı½áÊ±¿Õ'][personid] ~= nil then
	    return false
	end
	if JY.Person[personid]["Ö÷ÔËÇá¹¦"] == QGid then	--±ê¼ÇĞŞ¸Ä
		if not inteam(personid) then
			return true 
		elseif PersonKF(personid,QGid) then
			return true
		end
	end
	if JY.Person[personid]["Ö÷ÔËÇá¹¦"] == 380 then
		if JY.Wugong[380]['×ÆÉÕÏµÊı'] == QGid or JY.Wugong[380]['±ù·âÏµÊı'] == QGid then
			return true
		end	
	end
	--ÉÌÓùÒş
	if match_ID(personid,517) and QGid > 0 and yongqin(QGid) then
		return true
	end
	--´ïÄ¦
	if match_ID(personid,577) and QGid == 186 then
		return true
	end
	--¿ÂÕò¶ñ
	if match_ID(personid,130) and QGid == 145 then
		return true
	end
	--Î¤Ò»Ğ¦
	if match_ID(personid,14) and QGid == 145 then
		return true
	end
	--ß÷Ì«¼«
	if match_ID(personid,92) and QGid == 149 then
		return true
	end
	--¹ÛÖ¹
	if match_ID(personid,456) and QGid == 195 then
		return true
	end
	--»ÆÒ©Ê¦
	if match_ID(personid,57) and QGid == 237 then
		return true
	end
	--ºúÒ»µ¶
	if match_ID(personid,633) and QGid == JY.Person[personid]["Ìì¸³Çá¹¦"] then
		return true
	end
	if MPPD(personid) == 24 and MPDJ(personid) > 2 and QGid == JY.Person[personid]["Ìì¸³Çá¹¦"] then
		return true
	end
	if MPPD(personid) == 24 and MPDJ(personid) > 4 and QGid > 0 and PersonKF(personid,QGid) then
		return true
	end	
	if match_ID(personid,9938) and personid == 0 and QGid > 0 and PersonKF(personid,QGid) then
		return true
	end
	return false
end

--tony Çá¹¦Ç¿»¯
function QGQH(id,QGid,level)
	if match_ID(id,517) then
		return true
	end	
	if match_ID(id,526) and QGid == 304 then
		return true
	end
	if Curr_QG(id,QGid) == true then
		if level == 1 then --½ø½×Ğ§¹ûºÀÏÀ
			if MPTX(id,24) and JY.Person[id]["Çá¹¦"] > 300 then
				return true
			elseif JY.Person[id]["Çá¹¦"] > 300 and JY.Person[id]["³©Ïë·Ö½×"] < 4 then --
				return true
			elseif match_ID(id,517) then
				return true
			elseif (WAR.ZDDH == 289 or WAR.ZDDH == 290 or WAR.ZDDH == 337) and inteam(id) == false then
			    return true
			else
				return false
			end
		end
		if level == 2 then --¸ß½×Ğ§¹û
			if MPTX(id,24) and JY.Person[id]["Çá¹¦"] > 500 and (inteam(id) or match_ID(id,525)) then
				return true
			elseif inteam(id) and JY.Person[id]["Çá¹¦"] > 500 and JY.Person[id]["³©Ïë·Ö½×"] < 2 then -- 
				return true
			elseif match_ID(id,517) then
				return true
			elseif (WAR.ZDDH == 289 or WAR.ZDDH == 290 or WAR.ZDDH == 337) and inteam(id) == false then
			    return true
			else
				return false
			end
		end	
	else
		return false
	end	
	
	return false
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ìì¸³Íâ¹¦µÄº¯Êı
function Given_WG(id, WGid)
	local tw = false;
	for i = 1, 2 do
		if JY.Person[id]["Ìì¸³Íâ¹¦"..i] == WGid then
			tw = true;
			break;
		end
	end
	return tw;
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ìì¸³ÄÚ¹¦µÄº¯Êı
function Given_NG(id, NGid)
	local tw = false;
	if JY.Person[id]["Ìì¸³ÄÚ¹¦"] == NGid then
		tw = true;
	elseif actor(id,6) and JXPD(id,0,2) then --Ììî¸
		return true
	elseif match_ID(id,9991) and actor(id,11) and JY.Person[0]["ÁùÈç¾õĞÑ"] >=1 and NGid == 160 then
		return true
	end
	return tw;
end

function TFQG(id,QGid)
	if JY.Person[id]["Ìì¸³Çá¹¦"] == QGid then
		return true
	elseif match_ID(id,517) then
		return true
	elseif (WAR.ZDDH == 289 or WAR.ZDDH == 290 or WAR.ZDDH == 337) and JY.Person[id]["Ö÷ÔËÇá¹¦"] == QGid and inteam(id) == false then
		return true
	else
		return false
	end	
end
--ÆæÃÅÍâ¹¦+ÄÚ¹¦×éºÏ ÆæÃÅ×éºÏ
function TSZH(id,WGid,NGid)
	if JY.Status == GAME_WMAP then
		if match_ID(id,577) and WGid > 0 then  --ÌìÏÂÎä¹¦³öÉÙÁÖ
			return true
		end
	end
	-----------------------------ÆæÃÅ×éºÏ-------------------------------------------------
	--ÌìµØĞş»Æ
	if WGid == 78 and NGid == 315 then
		if PersonKF(id,78) and PersonKF(id,315) and PersonKF(id,148) then 
            return true
		elseif match_ID(id,456) then
			return true
		end
	end
	return false
end
--µ¶·¨Íâ¹¦+ÄÚ¹¦×éºÏ
function DFZH(id,WGid,NGid)
	if JY.Status == GAME_WMAP then
		if match_ID(id,577) and WGid > 0 then  --ÌìÏÂÎä¹¦³öÉÙÁÖ
			return true
		end
	end
	-----------------------------µ¶·¨×éºÏ-------------------------------------------------
	--¿ñ·ç»ìÔª
	if WGid == 55 and NGid == 90 then
		if PersonKF(id,55) and PersonKF(id,90) then 
			return true
		elseif PersonKF(id,55) and match_ID(id,29) then
			return true
		end
	end
	--ĞŞÂŞ×ÏÏ¼
	if WGid == 58 and NGid == 89 then
		if PersonKF(id,58) and PersonKF(id,89) then 
			return true
		end
	end
	--ĞŞÂŞÌìÄ§
	if WGid == 58 and NGid == 160 then
		if PersonKF(id,58) and PersonKF(id,160) then 
			return true
		end
	end
	--½ğÎÚÂŞºº
	if WGid == 61 and NGid == 102 then
		if PersonKF(id,61) and PersonKF(id,102) then 
			return true
		elseif PersonKF(id,61) and Curr_NG(id,96) then 
			return true
		end
	end
	--·òÆŞ±ù»ğ
	if WGid == 62 and NGid == 250 then
		if PersonKF(id,62) and PersonKF(id,250) then 
			return true
		end
	end
	--Ñªµ¶ÑªºÓ
	if WGid == 63 and NGid == 163 then
		if PersonKF(id,63) and PersonKF(id,163) then 
			return true
		elseif match_ID(id,97) then
			return true
		end
	end
	--ĞşĞé´¿Ñô
	if WGid == 64 and NGid == 99 then
		if PersonKF(id,64) and PersonKF(id,99) then 
			return true
		end
	end
	--ºúµ¶·ÉÌì
	if WGid == 65 and NGid == 145 then
		if PersonKF(id,65) and PersonKF(id,145) and TrueSD(id) >= 350 then 
			return true
		elseif PersonKF(id,65) and Curr_QG(pid,145) then
			return true
		elseif match_ID(id,633) then
			return true
		elseif JXPD(id,1,1) then
			return true
		end
	end
	--»ğµ¶Ğ¡ÎŞ
	if WGid == 66 and NGid == 98 then
		if PersonKF(id,66) and PersonKF(id,98) then 
			return true
		elseif match_ID(id,103) then
			return true
		end
	end
	--»ğµ¶ÁúÏó
	if WGid == 66 and NGid == 103 then
		if PersonKF(id,66) and PersonKF(id,103) then 
			return true
		elseif match_ID(id,103) then
			return true
		end
	end
	--°ÙÊ¤ÉñĞĞ
	if WGid == 141 and NGid == 146 then
		if PersonKF(id,141) and PersonKF(id,146) then 
			return true
		end
	end
	--²×äéº®±ùorÒ×Ë®º®
	if WGid == 153 and NGid == 216 then
		if PersonKF(id,153) and PersonKF(id,216) then 
			return true
		elseif PersonKF(id,153) and PersonKF(id,43) then
			return true
		end
	end
	--Òõ·çÊ¥»ğ
	if WGid == 174 and NGid == 93 then
		if PersonKF(id,174) and PersonKF(id,93) then 
			return true
		end
	end
	--¾®ÔÂ³¤Éú
	if WGid == 181 and NGid == 203 then
		if PersonKF(id,181) and PersonKF(id,203) then 
			return true
		elseif match_ID(id,578) then
			return true
		end
	end
	--âÒ¶¡ÖÜÌì
	if WGid == 193 and NGid == 190 then
		if PersonKF(id,190) and PersonKF(id,193) then 
			return true
		end
	end
	--Ë«°ËØÔ
	if WGid == 231 and NGid == 235 then
		if PersonKF(id,231) and PersonKF(id,235) then 
			return true
		end
	end
	--Ììµ¶¾ÅÎÊ
	if WGid == 335 and NGid == 203 then
		if PersonKF(id,181) and PersonKF(id,203) and PersonKF(id,335) then 
			return true
		end
	end
	--Åùö¨µ¶·¨
	if WGid == 371 and NGid == 372 then
		if PersonKF(id,371) and Curr_NG(id,372) then 
			return true
		end
	end
	return false
end
--½£·¨Íâ¹¦+ÄÚ¹¦×éºÏ
function JFZH(id,WGid,NGid)
	if JY.Status == GAME_WMAP then
		if match_ID(id,577) and WGid > 0 then  --ÌìÏÂÎä¹¦³öÉÙÁÖ
			return true
		end
	end
	-----------------------------½£·¨×éºÏ-------------------------------------------------
	--Óñóï±Ìº£
	if WGid == 38 and NGid == 248 then
		if PersonKF(id,38) and PersonKF(id,248) then 
			return true
		elseif match_ID(id,57) then 
			return true
		end
	end
	--Ë«È«Õæ
	if WGid == 39 and NGid == 210 then
		if PersonKF(id,39) and PersonKF(id,210) then 
			return true
		elseif match_ID(id,129) or match_ID(id,605) or JXPD(id,68,1) then
			return true
		elseif match_ID(id,526) or MPTX(id,16) then
			return true
		elseif PersonKF(id,39) and PersonKF(id,100) then 
			return true
		elseif PersonKF(id,139) and PersonKF(id,100) and PersonKF(id,154) then 
			return true
		end
	end	
	--È«ÕæÏÈÌì
	if WGid == 39 and NGid == 100 then
		if PersonKF(id,39) and PersonKF(id,200) then 
			return true
		elseif match_ID(id,526) or match_ID(id,129) or JXPD(id,68,1) then
			return true
		end
	end	
	--Ë«ÓñÅ®
	if WGid == 42 and NGid == 154 then
		if PersonKF(id,42) and PersonKF(id,154) then 
			return true
		elseif PersonKF(id,139) and PersonKF(id,154) then 
			return true
		elseif match_ID(id,139) and match_ID(id,59) then
			return true
		elseif match_ID(id,526) or match_ID(id,605) then
			return true
		end
	end
	--ĞşÌúÅ­ÌÎ
	if WGid == 45 and NGid == 252 then
		if PersonKF(id,45) and Curr_NG(id,252) then 
			return true
		elseif match_ID(id,58) and PersonKF(id,252) then
			return true
		elseif match_ID(id,530) and PersonKF(id,252) then
			return true
		elseif match_ID(id,592) then
			return true
		end
	end
	--¾Å½£ĞşÌúÅ­ÌÎ
	if WGid == 47 and NGid == 252 then
		if PersonKF(id,47) and PersonKF(id,45) and PersonKF(id,252) then 
			return true
		elseif match_ID(id,592) then
			return true
		end
	end
	--±ÙĞ°¿û»¨
	if WGid == 48 and NGid == 105 then
		if PersonKF(id,48) and Curr_NG(id,105) then 
			return true
		elseif (match_ID(id,36) or match_ID(id,9888)) and PersonKF(id,48) then
			return true
		end
	end	
	--ÓñÅ®ËØĞÄÏÈÌì
	if WGid == 139 and NGid == 100 then
		if PersonKF(id,139) and PersonKF(id,154) and PersonKF(id,100) then 
			return true
		elseif match_ID(id,526) or match_ID(id,605) then
			return true
		elseif match_ID(id,139) and match_ID(id,59) then
			return true
		end
	end
	--´ïÄ¦¾ÅÑô
	if WGid == 140 and NGid == 243 then
		if PersonKF(id,140) and PersonKF(id,243) then 
			return true
		elseif match_ID(id,577) then
			return true
		end
	end
	--ÉñÃÅ´¿Ñô
	if WGid == 236 and NGid == 99 then
		if PersonKF(id,236) and PersonKF(id,99) then 
			return true
		elseif match_ID(id,5) then
			return true
		elseif MPTX(id,4,3) then
			return true
		end
	end
	--Íò½£¾Å¾Å
	if WGid == 374 and NGid == 107 then
		if PersonKF(id,374) and PersonKF(id,107) and PersonKF(id,106) then 
			return true
		elseif match_ID(id,520) then
			return true
		end
	end
	--Ãç½£·ÉÌì
	if WGid == 44 and NGid == 99 then
		if PersonKF(id,44) and PersonKF(id,99) then
			return true
		elseif match_ID(id,3) then
		    return true				
		end
	end
	return false
end
--Ö¸·¨Íâ¹¦+ÄÚ¹¦×éºÏ
function ZFZH(id,WGid,NGid)
	if JY.Status == GAME_WMAP then
		if match_ID(id,577) and WGid > 0 then  --ÌìÏÂÎä¹¦³öÉÙÁÖ
			return true
		end
	end
	-----------------------------Ö¸·¨×éºÏ-------------------------------------------------
	--Ó¥×¦Ç¬À¤
	if WGid == 4 and NGid == 97 then
		if PersonKF(id,3) and PersonKF(id,97) then 
			return true
		elseif match_ID(id,12) then
			return true
		end
	end
	--Ë«¾ÅÒõ
	if WGid == 11 and NGid == 107 then
		if PersonKF(id,11) and PersonKF(id,107) and Curr_NG(id,107) then 
			return true
		elseif match_ID(id,637) then
			return true
		end
	end	
	--Ò»Ñô¿İÈÙ
	if WGid == 17 and NGid == 207 then
		if PersonKF(id,17) and PersonKF(id,207) then 
			return true
		elseif match_ID(id,65) or match_ID(id,499) or match_ID(id,102) then
			return true
		end
	end	
	--µ¯Ö¸ÆæÃÅ
	if WGid == 18 and NGid == 251 then
		if PersonKF(id,18) and PersonKF(id,251) then 
			return true
		elseif match_ID(id,57) then
			return true
		end
	end	
	--»ÃÒõ»ìÔª
	if WGid == 19 and NGid == 90 then
		if PersonKF(id,19) and PersonKF(id,90) then 
			return true
		elseif match_ID(id,18) or match_ID(id,9744) then
			return true
		end
	end
	--ÁùÂöÒ»ÑôÌìÄÏ
	if WGid == 49 and NGid == 314 then
		if PersonKF(id,17) and PersonKF(id,49) and PersonKF(id,314) then 
			return true
		elseif match_ID(id,499) or JXPD(id,53,1) then
			return true
		end
	end	
	--Í¸¹Ç¸òó¡
	if WGid == 127 and NGid == 95 then
		if PersonKF(id,127) and PersonKF(id,95) then 
			return true
		elseif PersonKF(id,127) and match_ID(id,61) then
			return true
		elseif match_ID(id,60) then
			return true
		end
	end
	--¶àÂŞÒ¶ÂŞºº
	if WGid == 132 and NGid == 96 then
		if PersonKF(id,132) and PersonKF(id,96) then 
			return true
		elseif match_ID(id,103) then
			return true
		end
	end	
	--²ÎºÏ¶·×ª
	if WGid == 138 and NGid == 43 then
		if PersonKF(id,138) and MuRongDZ(id) then 
			return true
		elseif match_ID(id,113) then
			return true
		end
	end	
	--ÔÀÍõÎäÄÂ
	if WGid == 198 and NGid == 199 then
		if PersonKF(id,198) and PersonKF(id,199) then 
			return true
		elseif match_ID(id,568) then
			return true
		end
	end	
	--º®ĞäĞ¡ÎŞ
	if WGid == 201 and NGid == 98 then
		if PersonKF(id,201) and PersonKF(id,98) then 
			return true
		elseif match_ID(id,634) or match_ID(id,118) then
			return true
		end
	end
	--¿û»¨º®Ğä¿û»¨
	if WGid == 226 and NGid == 105 then
		if PersonKF(id,226) and (PersonKF(id,126) or PersonKF(id,127)) and PersonKF(id,201) and Curr_NG(id,105) then 
			return true
		elseif JXPD(id,27,2) then
			return true
		end
	end
	--Á¬»·¸¯Ê¬¶¾¡¢Ç§ÖëÍò¶¾ÊÖ¡¢Îå¶¾Éñ¹¦
	if WGid == 295 and NGid == 220 then
		if PersonKF(id,3) and PersonKF(id,120) and PersonKF(id,220) then 
			return true
		elseif PersonKF(id,295) and PersonKF(id,334) and PersonKF(id,220) then 
			return true
		elseif match_ID(id,83) or match_ID(id,46) then
			return true
		end
	end
	--½ğ¸Õ²»»µ+½ğ¸ÕÖ¸
	if WGid == 135 and NGid == 144 then
		if PersonKF(id,135) and PersonKF(id,144) then
		   return true 
		elseif match_ID(id,170) then 
		   return true 
		end 
	end
	return false
end
--È­·¨Íâ¹¦+ÄÚ¹¦×éºÏ
function QFZH(id,WGid,NGid)
	if JY.Status == GAME_WMAP then
		if match_ID(id,577) and WGid > 0 then  --ÌìÏÂÎä¹¦³öÉÙÁÖ
			return true
		end
	end
	-----------------------------È­·¨×éºÏ-------------------------------------------------
	--Ë«Îå¶¾
	if WGid == 3 and NGid == 220 then
		if PersonKF(id,3) and PersonKF(id,220) then 
			return true
		elseif match_ID(id,161) or match_ID(id,83) or match_ID(id,746) then
			return true
		end
	end
	--Ë«º®±ù
	if WGid == 5 and NGid == 216 then
		if PersonKF(id,5) and PersonKF(id,216) then 
			return true
		elseif PersonKF(id,5) and PersonKF(id,43) then
			return true
		elseif match_ID(id,14) or match_ID(id,429) then
			return true
		end
	end	
	--ÃàÕÆ´¿Ñô
	if WGid == 7 and NGid == 99 then
		if PersonKF(id,7) and PersonKF(id,99) then 
			return true
		elseif match_ID(id,5) or match_ID(id,658) then
			return true
		end
	end
	--ÌìÉ½±±Ú¤
	if WGid == 8 and NGid == 85 then
		if PersonKF(id,8) and Curr_NG(id,85) then 
			return true
		elseif match_ID(id,116) or match_ID(id,117) or match_ID(id,634) then
			return true
		end
	end	
	--ÌìÉ½°Ë»Ä1
	if WGid == 8 and NGid == 101 then
		if PersonKF(id,8) and PersonKF(id,101) then 
			return true
		elseif match_ID(id,117) or match_ID(id,634) then
			return true
		end
	end	
	--ÌìÉ½°Ë»Ä2
	if WGid == 8 and NGid == 102 then
		if PersonKF(id,8) and Curr_NG(id,101) then 
			return true
		elseif match_ID(id,117) or match_ID(id,634) then
			return true
		end
	end	
	--ÌúÕÆÌú²¼ÉÀ
	if WGid == 13 and NGid == 196 then
		if PersonKF(id,13) and PersonKF(id,196) then 
			return true
		elseif match_ID(id,67) or match_ID(id,567) then
			return true
		end
	end
	--ÂäÓ¢±Ìº£
	if WGid == 12 and NGid == 248 then
		if PersonKF(id,12) and PersonKF(id,248) then 
			return true
		elseif match_ID(id,56) or match_ID(id,57) then
			return true
		end
	end	
	--¿ÕÃ÷½ğ¹Ø
	if WGid == 15 and NGid == 249 then
		if PersonKF(id,15) and PersonKF(id,249) then 
			return true
		elseif match_ID(id,64) then
			return true
		end
	end	
	--Ì«¼«´¿Ñô
	if WGid == 16 and NGid == 99 then
		if PersonKF(id,16) and PersonKF(id,99) then 
			return true
		elseif match_ID(id,5) then
			return true
		end
	end	
	--ĞşÚ¤º®±ù
	if WGid == 21 and NGid == 216 then
		if PersonKF(id,21) and PersonKF(id,216) then 
			return true
		elseif PersonKF(id,21) and PersonKF(id,43) then
			return true
		elseif match_ID(id,648) or match_ID(id,523) then
			return true
		end
	end	
	--ĞşÚ¤Îå¶¾
	if WGid == 21 and NGid == 220 then
		if PersonKF(id,21) and PersonKF(id,220) then 
			return true
		elseif match_ID(id,647) or match_ID(id,523) then
			return true
		end
	end
	--°ãÈô½ğ¸ÕÊ¨×Óºğ
	if NGid == 91 then
		if WGid == 189 then
			if PersonKF(id,189) and PersonKF(id,91) then 
				return true
			elseif match_ID(id,149) or match_ID(id,114) then
				return true
			end
		end
	end
	--Ë«½ğ¸Õ×éºÏ
	if NGid == 144 then
		if WGid == 22 or WGid == 135 then
			if (PersonKF(id,22) or PersonKF(id,135)) and PersonKF(id,144) then
				return true
			end
		end		 	
	end
		
	--ÆßÉËÒõÑô
	if WGid == 23 and NGid == 221 then
		if PersonKF(id,23) and PersonKF(id,221) then 
			return true
		elseif match_ID(id,357) or match_ID(id,8) or match_ID(id,13) or match_ID(id,167) or match_ID(id,168) then
			return true
		end
	end	
	--ĞëÃÖÉ½Ò×½î
	if WGid == 24 and NGid == 108 then
		if PersonKF(id,24) and PersonKF(id,108) then 
			return true
		elseif match_ID(id,114) then
			return true
		end
	end	
	--÷öÈ»Å­ÌÎÄæÔË
	if WGid == 25 and NGid == 104 then
		if PersonKF(id,25) and Curr_NG(id,252) and PersonKF(id,104) then 
			return true
		elseif JXPD(id,58,1) and PersonKF(id,25) then
			return true
		end
	end	
	--÷öÈ»Å­ÌÎ1
	if WGid == 25 and NGid == 252 then
		if PersonKF(id,25) and PersonKF(id,252) then 
			return true
		elseif JXPD(id,58,1) and PersonKF(id,25) then
			return true
		end
	end	
	--÷öÈ»Å­ÌÎ2
	if WGid == 25 and NGid == 252 then
		if PersonKF(id,25) and Curr_NG(id,252) and PersonKF(id,252) then 
			return true
		elseif JXPD(id,58,1) and PersonKF(id,25) then
			return true
		end
	end		
	--½µÁúÇÜÁú
	if WGid == 26 and NGid == 204 then
		if PersonKF(id,26) and Curr_NG(id,204) then 
			return true
		elseif match_ID(id,69) and PersonKF(id,204) then
			return true
		elseif match_ID(id,50) then
			return true
		end
	end
	--½µÁú¾ÅÒõ
	if WGid == 26 and NGid == 107 then
		if match_ID(id,527) and MPTX(id,24) and Curr_NG(id,367) then
			return true
		elseif match_ID(id,69) then
			return true
		elseif JXPD(id,55,1) then
			return true
		elseif PersonKF(id,107) and PersonKF(id,26) then
			return true
		end
	end					
	--Èı»¨½ğ¹Ø
	if WGid == 115 and NGid == 249 then
		if PersonKF(id,115) and PersonKF(id,249) then 
			return true
		elseif match_ID(id,64) or match_ID(id,129) then
			return true
		end
	end	
	--±Ìº£¾ªÌÎ
	if WGid == 179 and NGid == 180 then
		if PersonKF(id,179) and PersonKF(id,180) then 
			return true
		elseif match_ID(id,635) then
			return true
		end
	end
	--°Ù»¨´óÖÜÌì
	if WGid == 10 and NGid == 190 then 
		if PersonKF(id,10) and PersonKF(id,190) then
		   return true 
		elseif match_ID(id,658) then 
		   return true 
		end 
	end
	return false
end

--ÕâÀïÖ»Ğ´ÓĞÍâ¹¦+Íâ¹¦×éºÏ
function WGZH(id,WGid1,WGid2)
	--Õ½¶·ÖĞ
	if JY.Status == GAME_WMAP then
		if match_ID(id,577) and WGid1 > 0 and WGid2 > 0 then  --ÌìÏÂÎä¹¦³öÉÙÁÖ
			return true
		end
	end
	--º®±ù»¯¹Ç
	if WGid1 == 5 and WGid2 == 118 then
		if PersonKF(id,5) and PersonKF(id,118) then 
			return true
		elseif match_ID(id,602) or match_ID(id,14) or match_ID(id,514) then
			return true
		end
	end
	--¾ÅÒõ×¦»ğÑæµ¶
	if WGid1 == 11 and WGid2 == 66 then
		if PersonKF(id,11) and PersonKF(id,66) then 
			return true
		elseif match_ID(id, 637) or match_ID(id, 103) or match_ID(id, 771) then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÌÒ»¨¾ø¼¼µÄÌõ¼ş
	if WGid1 == 12 and WGid2 == 18 then
		if PersonKF(id,12) and PersonKF(id,18) and PersonKF(id,38) then 
			return true
		elseif match_ID(id, 626) or match_ID(id, 57) or match_ID(id, 9746) then 
			return true
		elseif MPTX(id,10) and PersonKF(id,251) then 
			return true
		end
	end
	--Ìú¼×ÒÀÈ»ÔÚ¡¤¡¤
	if WGid1 == 13 and WGid2 == 143 then
		if PersonKF(id,13) and PersonKF(id,196) then 
			return true
		elseif PersonKF(id,143) and PersonKF(id,196) then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÌ«¿ÕĞ¶¾¢
	if WGid1 == 15 and WGid2 == 16 then
		if PersonKF(id,15) and PersonKF(id,16) then 
			return true
		elseif match_ID(id,5) or match_ID(id, 64) then 
			return true
		end
	end
	--¿ÕÃ÷È«Õæ
	if WGid1 == 15 and WGid2 == 39 then
		if PersonKF(id,15) and PersonKF(id,39) then 
			return true
		elseif match_ID(id,129) or match_ID(id, 64) then 
			return true
		end
	end
	--Ò»ÑôÃî±Ê
	if WGid1 == 17 and WGid2 == 142 then
		if PersonKF(id,17) and PersonKF(id,142) then 
			return true
		elseif match_ID(id,122) or match_ID(id,65) then
			return true
		end
	end	
	--Ò»ÑôÁùÂö
	if WGid1 == 17 and WGid2 == 49 then
		if PersonKF(id,17) and PersonKF(id,49) then 
			return true
		elseif PersonKF(id,17) and match_ID(id,65) then
			return true
		elseif match_ID(id,499) or JXPD(id,53,1) then
			return true
		end
	end	
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ã×ÏÆøÌìÂŞµÄÌõ¼ş
	if WGid1 == 21 and WGid2 == 118 then
		if PersonKF(id,5) and PersonKF(id,21) then 
			return true
		elseif PersonKF(id,9) and PersonKF(id,118) then
			return true
		elseif match_ID(id, 523) or match_ID(id, 514) then
			return true
		end
	end
	--´óÁ¦½ğ¸ÕÕÆ+ĞëÃÖÉ½
	if WGid1 == 22 and WGid2 == 24 then
		if PersonKF(id,22) and PersonKF(id,24) then 
			return true
		elseif match_ID(id,169) and PersonKF(id,22) then
			return true
		elseif match_ID(id, 114) or match_ID(id, 577) then
			return true
		end
	end
	--÷öÈ»ÃÀÅ®
	if WGid1 == 25 and WGid2 == 6 then
		if PersonKF(id,25) and PersonKF(id,6) then 
			return true
		elseif JXPD(id,58,1) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£º¸ÇÊÀÎŞË«
	if WGid1 == 26 and WGid2 == 80 then
		if PersonKF(id,26) and PersonKF(id,80) then 
			return true
		elseif match_ID(id,50) or match_ID(id,69) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÎå»¢ÄÖ¶«¾©µÄÌõ¼ş
	if WGid1 == 29 and WGid2 == 114 then
		if PersonKF(id,29) and PersonKF(id,114) then 
			return true
		elseif match_ID(id,311) or match_ID(id,594) then
			return true
		end
	end
	--½ğÎÚÓ³Ñ©£ºÑ©É½½ğÎÚ
	if WGid1 == 35 and WGid2 == 61 then
		if PersonKF(id,35) and PersonKF(id,61) then 
			return true
		elseif match_ID(id,38) then
			return true		
		end
	end
	--ÎŞ¾Æ²»»¶£ºÌ«¼«+ÈáÔÆ£¬ÒÔÈá¿Ë¸Õ
	if WGid1 == 36 and WGid2 == 46 then
		if PersonKF(id,36) and PersonKF(id,46) then 
			return true
		elseif match_ID(id,5) or match_ID(id,95) or match_ID(id,456) or match_ID(id,9878) then 
			return true
		elseif MPTX(id,4,3) then 
			return true
		end
	end
	--Á½ÒÇÊØ»¤
	if WGid1 == 37 and WGid2 == 60 then
		if PersonKF(id,37) and PersonKF(id,60) then 
			return true
		elseif match_ID(id,9877) or match_ID(id,96) then 
			return true
		elseif MPTX(id,19,2) then 
			return true
		end
	end
	--ÓñóïÑşÇÙ
	if WGid1 == 38 and WGid2 == 73 then
		if PersonKF(id,38) and PersonKF(id,73) then 
			return true
		elseif match_ID(id,63) or match_ID(id,73) then 
			return true
		end
	end
	--Ë«½£ºÏ±Ú È«Õæ½£·¨ + ÓñÅ®½£
	if WGid1 == 39 and WGid2 == 42 then
		if PersonKF(id,39) and PersonKF(id,42) and (ZYHBPD(id) > 0 or not isteam(id)) then 
			return true
		elseif PersonKF(id,139)	and Curr_NG(id,154) then
			return true
		elseif match_ID(id,455) or match_ID(id,605) then
			return true
		end
	end
	--È«Õæ¿ÕÃ÷
	if WGid1 == 39 and WGid2 == 15 then
		if PersonKF(id,39) and PersonKF(id,15) then 
			return true
		elseif match_ID(id,129) or match_ID(id,64) then
			return true
		end
	end
	--ĞşÌú¾Å½£
	if WGid1 == 45 and WGid2 == 47 then
		if PersonKF(id,47) and PersonKF(id,45) then 
			return true
		elseif match_ID(id,592) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ã½£µ¨ÇÙĞÄµÄÌõ¼ş
	if WGid1 == 47 and WGid2 == 73 then
		if PersonKF(id,47) and PersonKF(id,73) then 
			return true
		elseif match_ID(id,35) or match_ID(id,73) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÍò½Ù²»¸´
	if WGid1 == 51 and WGid2 == 56 then
		if PersonKF(id,51) and PersonKF(id,56) then 
			return true
		elseif match_ID(id,90) or match_ID(id,89) then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÄÏÉ½»ÆÉ³
	if WGid1 == 53 and WGid2 == 78 then
		if PersonKF(id,53) and PersonKF(id,78) then 
			return true
		elseif match_ID(id,133) or match_ID(id,456) or match_ID(id,25) then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÌìÒÂÎŞ·ìµÄÌõ¼ş
	if WGid1 == 54 and WGid2 == 62 then
		if PersonKF(id,54) and PersonKF(id,62) then 
			return true
		elseif match_ID(id, 77) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ã´È±¯Îª»³µÄÌõ¼ş
	if WGid1 == 57 and WGid2 == 346 then
		if PersonKF(id,57) and PersonKF(id,346) then 
			return true
		elseif match_ID(id, 114) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÀûÈĞº®·æ£¬ĞŞÂŞorÒõ·ç+²×äé
	if WGid1 == 58 and WGid2 == 174 then
		if PersonKF(id,153) and (PersonKF(id,58) or PersonKF(id,174)) then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÎå»¢ÄÖ¶«¾©µÄÌõ¼ş
	if WGid1 == 59 and WGid2 == 232 then
		if PersonKF(id,59) and PersonKF(id,232) then 
			return true
		elseif match_ID(id, 511) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£º¾Ù»ğÁÇÔ­£¬½ğÎÚorÈ¼Ä¾+»ğÑæµ¶
	if WGid1 == 61 and WGid2 == 65 then
		if PersonKF(id,61) and PersonKF(id,66) then 
			return true
		elseif PersonKF(id,66) and PersonKF(id,65) then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£º´¹µö×éºÏ
	if WGid1 == 69 and WGid2 == 76 then
		if PersonKF(id,69) and PersonKF(id,76) then 
			return true
		elseif PersonKF(id,119)  then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãµÀ¿ÉµÀµÄÌõ¼ş
	if WGid1 == 64 and WGid2 == 236 then
		if PersonKF(id,64) and PersonKF(id,236) then 
			return true
		elseif match_ID(id, 5) then 
			return true
		elseif MPTX(id,4,2) then 
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÇÙÆåÊé»­µÄÌõ¼ş
	if WGid1 == 72 and WGid2 == 73 then
		if PersonKF(id,73) and PersonKF(id,72) and PersonKF(id,84) and PersonKF(id,142) then 
			return true
		elseif match_ID(id, 31) or match_ID(id, 32) or match_ID(id, 33) or match_ID(id, 34) then 
			return true
		elseif  match_ID(id, 115) then 
			return true
		end
	end
	--ÌúËøºá½­
	if WGid1 == 76 and WGid2 == 79 then
		if PersonKF(id,76) and PersonKF(id,79) then 
			return true
		elseif match_ID(id,594) or match_ID(id,9892) then
			return true
		end
	end
	--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÄãÊÇ·ç¶ùÎÒÊÇÉ³µÄÌõ¼ş
	if WGid1 == 78 and WGid2 == 55 then
		if PersonKF(id,78) and PersonKF(id,55) then 
			return true
		elseif match_ID(id,99) or match_ID(id,29) then
			return true
		end
	end
	--»¯¹ÇÒ»Ñô¡¤¡¤
	if WGid1 == 118 and WGid2 == 121 then
		if PersonKF(id,118) and PersonKF(id,121) then 
			return true
		elseif PersonKF(id,118) and PersonKF(id,17) then 
			return true
		elseif match_ID(id,602) or match_ID(id,65) then
			return true
		end
	end	
	--Ô½Å®Ô³¹«
	if WGid1 == 156 and WGid2 == 188 then
		if PersonKF(id,188) and PersonKF(id,156) then 
			return true
		elseif match_ID(id,604) then
			return true
		end
	end	
	--´ç³¤´çÇ¿
	if WGid1 == 165 and WGid2 == 206 then
		if PersonKF(id,165) and PersonKF(id,206) then 
			return true
		elseif PersonKF(id,155) then
			return true
		end
	end
	--ĞëÃÖÉ½Áú×¦¡¤¡¤
	if WGid1 == 20 and WGid2 == 24 then
		if PersonKF(id,20) and PersonKF(id,24) then
			return true
		elseif match_ID(id,170) or match_ID(id,114) or match_ID(id,577) then
			return true
		end 
	end 
	--½µÄ§¸½Ä§
	if WGid1 == 86 and WGid2 == 267 then
		if PersonKF(id,86) and PersonKF(id,267) then
			return true
		elseif match_ID(id,576) or match_ID(id,70) or match_ID(id,577) then
			return true
		end 
	end 		 
	--ÑªÕ½É³³¡
	if WGid1 == 198 and WGid2 == 200 then
		if PersonKF(id,198) and PersonKF(id,199) and PersonKF(id,200) then 
			return true
		elseif match_ID(id,567) or match_ID(id,568) then
			return true
		end
	end	
	--¿û»¨À¼»¨¡¤¡¤
	if WGid1 == 226 and WGid2 == 126 then
		if PersonKF(id,226) and PersonKF(id,126) then 
			return true
		elseif JXPD(id,27,2) or match_ID(id,511) then
			return true
		end
	end	
	--¿û»¨Í¸¹Ç¡¤¡¤
	if WGid1 == 226 and WGid2 == 126 then
		if PersonKF(id,226) and PersonKF(id,127) then 
			return true
		elseif JXPD(id,27,2) or match_ID(id,511) then
			return true
		end
	end	
	--¿û»¨º®Ğä¡¤¡¤
	if WGid1 == 226 and WGid2 == 201 then
		if PersonKF(id,226) and (PersonKF(id,126) or PersonKF(id,127)) and PersonKF(id,201) then 
			return true
		elseif JXPD(id,27,2) or match_ID(id,511) then
			return true
		end
	end	
	--»ìÔªÒ»Æø
	if WGid1 == 306 and WGid2 == 90 then
		if PersonKF(id,306) and PersonKF(id,90) then 
			return true
		elseif PersonKF(id,306) and PersonKF(id,375) then
			return true
		elseif match_ID(id,189) or match_ID(id,9795) then
			return true
		end
	end
	--À¼»¨ÂäÓ¢
	if WGid1 == 12 and WGid2 == 126 then
		if PersonKF(id,12) and PersonKF(id,126) then
			return true
		elseif match_ID(id,57) then
			return true	
		end
	end
	--ÆæÃÅ¼ôµ¶
	if WGid1 == 56 and WGid2 == 75 then
		if PersonKF(id,56) and PersonKF(id,75) then
			return true	
		elseif match_ID(id,89) or match_ID(id,44) then
			return true	
		end 	
	end
	--´È±¯
	if WGid1 == 57 and WGid2 == 133 then
		if PersonKF(id,57) and PersonKF(id,133) then
			return true	
		elseif match_ID(id,103) or match_ID(id,577) then
			return true
		elseif id > 460 and id < 479 then
			return true
		end 
	end
	--ÓñóïÂäÓ¢
	if WGid1 == 38 and WGid2 == 12 then
		if PersonKF(id,38) and PersonKF(id,12) then
			return true 
		elseif match_ID(id,57) then
		    return true	
		end
	end
	return false
end

--ÎåÔÀĞÄ·¨¡¢ÎåÔÀ½£¾÷ÅĞ¶Ï
function WYXF(id)
	local pd = false
	if PersonKF(id,89) and PersonKF(id,216) and PersonKF(id,259) and PersonKF(id,263) and PersonKF(id,264) then
		pd = true
	end
	for i = 19, 23 do
		if JXPD(id,i,1) then
			pd = true 
			break
		end
	end			
	if PersonKF(id,175) then
	    pd = true
	end	
	return pd
end
--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÎåÔÀ½£·¨µÄÌõ¼ş
function WuyueJFSL(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if kfid == 30 or kfid == 31 or kfid == 32 or kfid == 33 or kfid == 34 then
			num = num + 1
		end
	end
	for i = 19, 23 do
		if JXPD(id,i,1) then
			num = 7
			break
		end
	end
	if PersonKF(id,377) and PersonKF(id,175) then
		num = 7
	end
	return num
end
--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ã¶¾²¼ÎäÁÖµÄÌõ¼ş
function DubuWL(id)
    if PersonKF(id,295) and PersonKF(id,334) and PersonKF(id,220) then
        return true
	elseif PersonKF(id,3) and PersonKF(id,120) and PersonKF(id,220) then
	    return true
	elseif match_ID(id,46) or match_ID(id,83) or match_ID(id,746) then
	    return true
    end
    return false
end
--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãĞşº®¶¾±¬µÄÌõ¼ş
function XHDB(id)
    if PersonKF(id,3) and PersonKF(id,21) and (PersonKF(id,216) or PersonKF(id,43)) then
        return true
	elseif match_ID(id, 523) then
	    return true
    end
    return false
end
--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ãÌú¼×ÒÀÈ»ÔÚµÄÌõ¼ş
function Tjyrz(id)
    if (PersonKF(id,13) or PersonKF(id,143)) and PersonKF(id,196) then 
        return true
	elseif match_ID(id, 112) or match_ID(id, 627) then
	    return true
    end
    return false
end
--ÊÀ×ğ½µÄ§£ºôÂôÄ·üÄ§¹¦or½ğ¸Õ·üÄ§È¦or·üÄ§ÕÈ·¨+ÂŞºº·üÄ§¹¦
function ShiZunXM(id)
    if (PersonKF(id,82) or PersonKF(id,194) or PersonKF(id,86)) and PersonKF(id,96) then
        return true
    elseif match_ID(id, 577) or match_ID(id,576) or match_ID(id,160) then 
        return true
    end	
    return false
end
--½ğ¸Õ°ãÈô
function JinGangBR(id)
    if PersonKF(id,22) and PersonKF(id,189) and PersonKF(id,108) then 
		return true
	elseif (match_ID(id,505) or match_ID(id,9979)) and (PersonKF(id,22) or PersonKF(id,189)) then
        return true
	elseif match_ID(id,577) or match_ID(id,114) or match_ID(id,149) then
        return true
    end
    return false
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Ò»¸öÈËÎïÊÇ·ñÂú×ã³ıÈ´ËÄÏàµÄÌõ¼ş
--Í¬Ê±ĞŞÁ¶¶àÂŞÒ¶Ö¸/´óÖÇÎŞ¶¨Ö¸/ÎŞÏà½ÙÖ¸/Äé»¨Ö¸µ½¼«
function ChuQueSX(id)
	local sixiangnum = 0;
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		local klvl = JY.Person[id]["Îä¹¦µÈ¼¶"..i]
		if (kfid == 132 or kfid == 133 or kfid == 136 or kfid == 137) and klvl == 999 then
			sixiangnum = sixiangnum + 1
		end
		if match_ID(id,577) then 
            sixiangnum = 4
        end
        if match_ID(id,638) and WAR.ZDDH == 287 and CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ'] == 5 then
        	sixiangnum = 4
        end	
	end
	return sixiangnum
end
--åĞÒ£Óù·ç
function XiaoYaoYF(id)
	if PersonKF(id,85) and PersonKF(id,98) and PersonKF(id,101) and (JY.Person[240]["Æ·µÂ"] == 80 or (isteam(id) == false)) then	
		return true
	elseif JXPD(id,634,1) and (JY.Person[240]["Æ·µÂ"] == 80 or (isteam(id) == false)) then
		return true
	end
	return false
end
--Ñı·ç»öÊÀ
function YaoFengHuoShi(id)
	if PersonKF(id,55) and (PersonKF(id,90) or PersonKF(id,375)) and PersonKF(id,148) and PersonKF(id,78) and Curr_QG(id,148) then
		return true
	elseif match_ID(id,456) then
        return true
	end
	return false
end


function NGQH(id,NGid)--ÕâÀïÖ»Ğ´ÓĞ¡¸Ö÷ÔË¡¹µÄ×éºÏ
	if WAR.PJTX1 ~= 0 and match_ID(id,592) == false then
		return false
	else
		if match_ID(id,634) and NGid ~= nil and NGid > 0 and NGid ~= 315 and NGid ~= 359 and NGid ~= 184 and NGid ~= 180 and NGid ~= 43 then
			return true
		elseif match_ID(id,520) and (NGid == 315) then 
			return true
		elseif match_ID(id,520) and (NGid == 359) then 
			return true	
		elseif (match_ID(id,592) or match_ID(id,604) or match_ID(id,636)) and (NGid == 184) then
			return true 	
		elseif match_ID(id,771) and (NGid == 233) then
			    return true		
		elseif match_ID(id,524) and (NGid == 372) then 
			return true
		elseif match_ID(id,641) and (NGid == 93 or NGid == 97) then  --Ä¦Äá£ºÃ÷½ÌÅĞ¶¨±Ø³É¹¦
			return true
		elseif match_ID(id,5) and (NGid == 99 or NGid == 171) then  --ÀÏÕÅ£ºÎäµ±Ì×ÅĞ¶¨±Ø³É¹¦
			return true
		elseif match_ID(id,577) and (NGid == 96 or NGid == 108 or NGid == 144 or NGid == 106) then  --´ïÄ¦£ºÉÙÁÖÌ×ÅĞ¶¨±Ø³É¹¦
			return true
		elseif match_ID(id,592) and (NGid == 177 or NGid == 252) then  --¶À¹Â£ºÍüÇé¡¢Å­ÌÎÅĞ¶¨±Ø³É¹¦
			return true
		elseif match_ID(id,638) and NGid == 106 then  --¶·¾Æ£º¾ÅÑôÅĞ¶¨±Ø³É¹¦
			return true
		elseif (match_ID(id,637) or (match_ID(id,526) and match_ID(id,9757))) and NGid == 107 then  --»ÆÉÑ£º¾ÅÒõÅĞ¶¨±Ø³É¹¦
			return true
		elseif match_ID(id,456) and (NGid == 203 or NGid == 97) then
			return true
		elseif match_ID(id,50) and  NGid == 204 and PersonKF(id,204) then
			return true
		elseif match_ID(id,635) and (NGid == 180) then 
		    return true 	
		elseif match_ID(id,27) and (NGid == 105) then
		    return true 	
		elseif match_ID(id,514) and (NGid == 43) then
		    return true	
		elseif match_ID(id,636) and (NGid == 102) then  --Àî°×£ºÌ«ĞşÅĞ¶¨±Ø³É¹¦
		    return true		
		end	
		local pd = false
		if JY.Status == GAME_WMAP then
			if WAR.PD['½ğ¸ÕÖ¸¾øÂö'][id] ~= nil and math.random(10) > 7 then
				pd = false
			else
			    if Given_NG(id,NGid) then
					pd = true
				elseif JY.Base["±ê×¼"] == 6 and id == 0 and JY.Base['ÌìÊéÊıÁ¿'] >= 7 and JXPD(0,6,1) 
				and (JY.Person[id]['Ö÷ÔËÄÚ¹¦'] == NGid or JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] == NGid) then
				    pd = true
				elseif JY.Person[id]['Ìì¸³ÄÚ¹¦'] ~= NGid and JY.Person[id]['³©Ïë·Ö½×'] ~= nil then
				    local jjl = {65,45,30,20,15,10,5,0}
					local num = 0
					if JXPD(id,11,1) then
						num = 5 + math.modf((120-psx(id,'Æ·µÂ'))*0.067)
					end
					if JXPD(id,7,1) and  WAR.SEYB == 0 then
						num = 8 + math.modf((psx(id,'Æ·µÂ'))*0.067)
					end
					if JXPD(id,6,1) then
						num = 15
					end
					if match_ID(id,9987) then
						num = 10
					end
				    local ng = 20 + jjl[JY.Person[id]['³©Ïë·Ö½×']+1] + num
					if math.random(100) <= (ng) then
						pd = true
					end
				end
			end
		else
			pd = true
		end
	--Ê¥»ğÇ¬À¤
	    if NGid == 93 and pd == true then
			if Curr_NG(id,93) and PersonKF(id,97) then
			    return true
			else 
			    return false	
			end
		end	
		
	--¸òó¡Îå¶¾
		if NGid == 95 and pd == true then
			if Curr_NG(id,95) and PersonKF(id,220) then
				return true
			elseif (match_ID(id,60) and PersonKF(id,95)) or (match_ID(id,61) and Curr_NG(id,95)) then
				return true	
			else
				return false
			end	
		end	
		
	--Ç¬À¤¹êÏ¢
	    if NGid == 97 and pd == true then
			if Curr_NG(id,97) and PersonKF(id,227) then
				return true
			elseif match_ID(id,456) then
				return true
			elseif match_ID(id,9) and PersonKF(id,97) then	
				return true
			else 
			    return false	
			end
		end	
		
	--´¿ÑôÌİÔÆ
		if NGid == 99 and pd == true then
			if Curr_NG(id,99) and PersonKF(id,149) then
				return true
			elseif match_ID(id,9) and PersonKF(id,99) then	
				return true
			elseif MPTX(id,4,2) and PersonKF(id,99) and PersonKF(id,171) then	
				return true
			elseif match_ID(id,521) or match_ID(id,747) then
			    return true		
			elseif match_ID(id,778) and PersonKF(id,99) then 
			    return true	
			else 
				return false
			end		
		end
		
	--ÏÈÌìÉñÕÕ
		if NGid == 100 and pd == true then
			if Curr_NG(id,100) and (PersonKF(id,94) or PersonKF(id,203)) then
				return true
			elseif (match_ID(id,129) or match_ID(id,64)) and PersonKF(id,100) then
				return true
			elseif Curr_NG(id,100) and match_ID(id,9729) then
				return true	
			elseif match_ID(id,776) and PersonKF(id,100) then
			    return true 	
			elseif match_ID(id,782) and PersonKF(id,100) then
			    return true 		
			else
				return false
			end 
		end 
		
	--°Ë»Ä±±Ú¤
		if NGid == 101 and pd == true then
			if Curr_NG(id,101) and PersonKF(id,85) then 
				return true
			elseif match_ID(id,117) and PersonKF(id,101) then
				return true
			else
				return false
			end
		end
		
	--Ì«ĞşÇ¬À¤ÎäÄÂ
		if NGid == 102 and pd == true then
			if Curr_NG(id,102) and PersonKF(id,97) and PersonKF(id,199) then
				return true
			elseif Curr_NG(id,102) and match_ID(id,604) then
				return true	
			elseif JXPD(id,38,1) then
				return true
			elseif Curr_NG(id,102) and match_ID(id,9927) then
				return true
			elseif Curr_NG(id,102) and match_ID(id,779) then
				return true	
			else
				return false
			end
		end
		
	--ÁúÏóÉñ×ã
		if NGid == 103 and pd == true then
			if Curr_NG(id,103) and PersonKF(id,233) then
				return true
			elseif match_ID(id,62) or match_ID(id,524) or match_ID(id,759) then
				return true
			elseif match_ID(id,745) and PersonKF(id,103) then
			    return 	true
			elseif JXPD(id,84,1) and PersonKF(id,103) then
			    return 	true    
			elseif Curr_NG(id,103) and match_ID(id,9727) then
				return true		
			elseif match_ID(id,771) and Curr_NG(id,103) then
			    return true		
			else
				return false
			end
		end
		
	--ÄæÔËË²Ï¢
		if NGid == 104 and pd == true then
			if Curr_NG(id,104) and PersonKF(id,150) then
				return true
			elseif Curr_NG(id,104) and JXPD(id,60,1) then 
				return true
			else
				return false
			end
		end
		
	--¿û»¨×ÏÏ¼
		if NGid == 105 and pd == true then
			if Curr_NG(id,105) and PersonKF(id,89) then
				return true
			elseif (match_ID(id,457) or match_ID(id,531)) and Curr_NG(id,105) then
			    return true	
			elseif match_ID(id,762) and Curr_NG(id,105) then
			    return true 	
			elseif match_ID(id,27) or match_ID(id,92) or match_ID(id,773) then
   			    return true	
			elseif match_ID(id,769) and Curr_NG(id,105) then 
			    return true 	
			else
				return false
			end
		end
	--¾ÅÑôÈıÑô
		if NGid == 106 and pd == true then
			if match_ID(id,9) then
				return true
			elseif JY.Status == GAME_WMAP and WAR.ZDDH == 393 and match_ID(id,637) then
				return true
			elseif Curr_NG(id,106) and match_ID(id,9999) then
				return true
			elseif Curr_NG(id,106) and match_ID(id,778) then
			    return true	 	
			elseif match_ID(id,525) and PersonKF(id,106) then
			    return true 		
			elseif Curr_NG(id,106) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['¾ÅÑô×éºÏÅĞ¶¨'][id] == 1 then
						return true
					end
				end	
			else
				return false
			end
		end
	--¾ÅÒõÈıÒõ
		if NGid == 107 and pd == true then
			if JY.Status == GAME_WMAP and WAR.ZDDH == 393 and match_ID(id,638) then
				return true
			elseif Curr_NG(id,107) and match_ID(id,9929) then
				return true
			elseif match_ID(id,754) and PersonKF(id,107) then
			    return true 	
			elseif match_ID(id,774) and Curr_NG(id,107) then
			    return true 		
			elseif Curr_NG(id,107) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['¾ÅÒõ×éºÏÅĞ¶¨'][id] == 1 then
						return true
					end
				end
			else
				return false
			end
		end
	--Ò×½îÂŞºº½ğ¸Õ	
		if NGid == 108 and pd == true then
			if Curr_NG(id,108) and match_ID(id,9930) then
				return true
			elseif Curr_NG(id,108) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['Ò×½î×éºÏÅĞ¶¨'][id] == 1 then
						return true
					end
				end
			elseif PersonKF(id,108) and match_ID(id,744) then
			    return true	
			elseif match_ID(id,770) and Curr_NG(id,108) then
			    return true	
			elseif match_ID(id,772) and Curr_NG(id,108) then
			    return true	
			elseif match_ID(id,781) and PersonKF(id,108) then
			    return true 
			elseif match_ID(id,782) and PersonKF(id,108) then
			    return true 							
			else	
				return false		
			end
		end
	--½ğ¸ÕÌú²¼
		if NGid == 144 and pd == true then
			if Curr_NG(id,144) and (PersonKF(id,243) or PersonKF(id,196)) then
				return true
			elseif match_ID(id,743) or match_ID(id,778) then
			    return true 	
			else
				return false
			end
		end
	--ÓñÅ®ÏÈÌì
		if NGid == 154 and pd == true then
			if Curr_NG(id,154) and PersonKF(id,100) then
				return true
			elseif match_ID(id,605) and PersonKF(id,154) then
				return true
			else
				return false
			end 
		end
	--ÌìÄ§Ò×½îÍüÇé
		if NGid == 160 and pd == true then
			if Curr_NG(id,160) and PersonKF(id,108) and PersonKF(id,177) then
				return true
			elseif match_ID(id,9991) and Curr_NG(id,160) then
				return true
			elseif MPTX(id,31,4) and Curr_NG(id,160) then
				return true	
			else
				return false
			end
		end	
		--½ğ¸ÕÊ¨×Ó+½ğ¸Õ²»»µ
		if NGid == 91 and pd == true then	
			if Curr_NG(id,91) and PersonKF(id,144) then 
				return true
			else
				return false
			end
		end
		--Ì«¼«´¿Ñô
		if NGid == 171 and pd == true then
			if Curr_NG(id,171) then
				if JY.Status == GAME_WMAP then
					if WAR.PD['Ì«¼«×éºÏÅĞ¶¨'][id] == 1 then
						return true
					end
				end
			elseif match_ID(id,9) and Curr_NG(id,171) then
			   return true
			elseif Curr_NG(id,171) and match_ID(id,9820) then
				return true
			elseif match_ID(id,747) and Curr_NG(id,171) then
			   return true	
			else
				return false
			end
		end
		--ÍüÇéÁúÏó
	    if NGid == 177 and pd == true then
			if Curr_NG(id,177) and PersonKF(id,103) then
				return true
			elseif match_ID(id,652) and PersonKF(id,177) then
				return true
			elseif match_ID(id,758) or match_ID(id,775) then
			    return true 	
			else 
			    return false	
			end
		end	
		--³¤´º±±Ú¤
		if NGid == 183 and pd == true then
			if Curr_NG(id,183) and PersonKF(id,85) then 
				return true
			elseif match_ID(id,117) and PersonKF(id,183) then
				return true
			elseif match_ID(id,499) then
			    return true	
			elseif match_ID(id,784) then
			    return true	
			elseif Curr_NG(id,183) and match_ID(id,780) then
			    return true			
			else
				return false
			end
		end
		--ÖÜÌìÎüĞÇ	
		if NGid == 190 and pd == true then
			if Curr_NG(id,190) and PersonKF(id,88) then
				return true
			elseif match_ID(id,26) and PersonKF(id,88) then
				return true
			elseif MPTX(id,12,4) and Curr_NG(id,88) then
			    return true
			else 
				return false
			end
		end
		--³¤Éú±Ìº£´¿Ñô
		if NGid == 203 and pd == true then
			if Curr_NG(id,203) and PersonKF(id,248) and PersonKF(id,99) then
				return true
			elseif (JXPD(id,578,1) or JXPD(id,505,1)) and PersonKF(id,203) then
				return true
			elseif Curr_NG(id,203) and match_ID(id,9725) then	
			    return true 
			else
				return false
			end
		end
		--ÇÜÁúÂŞºº
		if NGid == 204 and pd == true then
			if Curr_NG(id,204) and PersonKF(id,96) then 
				return true
			elseif match_ID(id,69) and Curr_NG(id,204) then
				return true
			elseif match_ID(id,764) and Curr_NG(id,204) then
			    return true	
			elseif (match_ID(id,767) and Curr_NG(id,204)) or match_ID(id,539) then	
			    return true
			elseif Curr_NG(id,204) and match_ID(id,9728) then
				return true		
			elseif match_ID(id,772) and Curr_NG(id,108) then
			    return true			
			else
				return false
			end
		end
		--ÒõÑôÎŞ¼«+±ù»ğÒõÑô
		if NGid == 221 and pd == true then
			if Curr_NG(id,221) and PersonKF(id,250) then
				return true
			else
				return false
			end
		end	
		--ÁÙ¼Ã12+¶ëÃ¼¾ÅÑô
		if NGid == 247 and pd == true then
			if Curr_NG(id,247) and PersonKF(id,242) then
				return true
			elseif JXPD(id,626,1) and PersonKF(id,247) then
				return true
			else
				return false	
			end	
		end
		--½ğ¹ØÖÜÌì
		if NGid == 249 and pd == true then
			if Curr_NG(id,249) and (PersonKF(id,225) or PersonKF(id,190)) then
				return true
			elseif JXPD(id,30,1) or JXPD(id,55,1) or match_ID(id,64) then
				return true
			elseif match_ID(id,764) or match_ID(id,776) then
			    return true	
			else 
				return false	
			end
		end
		--Å­ÌÎ³¤Éú
	    if NGid == 252 and pd == true then
			if Curr_NG(id,252) and (PersonKF(id,203) or PersonKF(id,94)) then
				return true
			elseif Curr_NG(id,252) and match_ID(id,9726) then
				return true			
			elseif match_ID(id,783) and PersonKF(id,252) then
			    return true 	
			else
			    return false		
			end
		end	
		--ÌìÄÏ¿İìø
	    if NGid == 314 and pd == true then
			if Curr_NG(id,314) and PersonKF(id,207) then
				return true
			elseif match_ID(id,499) then 
			    return true
			elseif Curr_NG(id,314) and (match_ID(id,681) or match_ID(id,53)) then 
			    return true
			else
			    return false		
			end
		end	
		--ĞşÎäÕæ¹¦
	    if NGid == 315 and pd == true then
			if Curr_NG(id,315) and (PersonKF(id,203) or PersonKF(id,94)) and PersonKF(id,100) and PersonKF(id,107) then
				return true
			elseif Curr_NG(id,315) and match_ID(id,9724) then	
			    return true 
			else
				return false
			end
		end
		--¹êÏ¢¸òó¡
	    if NGid == 227 and pd == true then	
			if Curr_NG(id,227) and PersonKF(id,95) then
				return true
			else
			    return false	
			end
		end
		--ÂŞººÊ¨×Ó×éºÏ
		if NGid == 96 and pd == true then
			if Curr_NG(id,96) and (PersonKF(id,91) or PersonKF(id,92)) then
				return true
			elseif match_ID(id,517) or match_ID(id,38) then
				return true
			end
		end			
		--Åùö¨¾¨Ï¢
	    if NGid == 	372 and pd == true then
			if Curr_NG(id,372) and PersonKF(id,180) then
			    return true
			elseif match_ID(id,524) then 
			    return true	
			else	
			    return false
			end 	
		end	
		--¾ÅÏöÅ­ÌÎ
		if NGid == 184 and pd == true then 
			if Curr_NG(id,184) and PersonKF(id,252) then
				return true	
			elseif Curr_NG(id,184) and match_ID(id,780) then
				return true
			else 
			    return false	
			end
		end
		--ÖĞ»ªÁúĞ¥
		if NGid == 359 and pd == true then
			if Curr_NG(id,359) and PersonKF(id,369) then
				return true 
			else 
			    return false		
			end
		end
		--Éñ×ãÇ¬À¤
		if NGid == 233 and pd == true then
			if Curr_NG(id,233) and PersonKF(id,97) then
				return true
			elseif Curr_NG(id,233) and match_ID(id,9721) then
			    return true 	
			elseif match_ID(id,48) and PersonKF(id,233) then
			    return true 	
			else 
			    return false	
			end
		end		
		--¾¨Ï¢¾ÅÒõ
		if NGid == 180 and pd == true then
			if Curr_NG(id,180) and PersonKF(id,107) then
				return true 
			elseif match_ID(id,774) and PersonKF(id,180) then
			    return true		
			else 
			    return false	
			end
		end
		--ÉñÕÕ¹êÏ¢
		if NGid == 94 and pd == true then
			if Curr_NG(id,94) and PersonKF(id,227) then
				return true 
			elseif Curr_NG(id,94) and match_ID(id,37) then
			    return true
			elseif match_ID(id,775) and PersonKF(id,94) then
			    return true	
			else 
			    return false		
			end
		end
		--Ò×Ë®º®±ù
		if NGid == 43 and pd == true then 
			if match_ID(id,514) then
				return true	
			elseif Curr_NG(id,43) and match_ID(id,9740) then 
			    return true 	
			elseif Curr_NG(id,43) and PersonKF(id,216) then
			    return true 
			else 
			    return false 		
			end
		end
	end
	return false
end


function NGQHB(id,NGid)--ÕâÀïÖ»Ğ´ÓĞ¡¸·ÇÖ÷ÔË¡¹µÄ×éºÏ
	--if WAR.PJTX1 ~= 0 and (not match_ID(id,592)) then
		--return false
	--else
	    if match_ID(id,577) and NGid ~= nil and NGid > 0 then
			return true
		end
		--»¯¹¦Îå¶¾
		if NGid == 87 then
			if PersonKF(id,87) and	PersonKF(id,220) then
				return true	
			elseif match_ID(id,46) and PersonKF(id,87) then
				return true
			elseif match_ID(id,634) then
				return true
			else
				return false
			end
		end
		--»ìÔª×ÏÏ¼
		if NGid == 90 then
			if PersonKF(id,90) and PersonKF(id,89) then
				return true
			elseif PersonKF(id,375) and PersonKF(id,89) then
				return true
			elseif match_ID(id,524) or JXPD(id,189,1) or match_ID(id,783) or match_ID(id,785) then
				return true		
			elseif JXPD(id,58,1) then
				return true	
			else 
				return false
			end
		end
		--½ğ¸ÕÊ¨Íõºğ
	    if NGid == 91 then
			if PersonKF(id,91) and PersonKF(id,180) then
				return true
			elseif match_ID(id,13) or match_ID(id,149) or match_ID(id,781) then
				return true
			elseif match_ID(id,758) or match_ID(id,635) or match_ID(id,775) then
			    return true	
			else 
				return false	
			end
		end
		--Ê¥»ğÊ¨×Ó
		if NGid == 93 then
			if PersonKF(id,93) and PersonKF(id,92) then
				return true
			else 
			    return false
			end 
		end
		--¸òó¡»ìÔª
		if NGid == 95 then
			if (PersonKF(id,90) or PersonKF(id,375)) and (PersonKF(id,95) or PersonKF(id,180)) then
				return true
			elseif JXPD(id,60,1) then
				return true
			else
				return false
			end
		end
		--ÂŞººÖÜÌì
		if NGid == 96 then
			if PersonKF(id,96) and (PersonKF(id,190) or PersonKF(id,225)) then
				return true
			elseif match_ID(id,577) or match_ID(id,576) then
				return true
			else 
				return false		
			end
		end	
		--´¿Ñô»ìÔª
	    if NGid == 99 then
			if PersonKF(id,99) and PersonKF(id,90) then
				return true
			elseif PersonKF(id,99) and PersonKF(id,375) then
				return true
			elseif JXPD(id,5,1) then
				return true
			else 
				return false	
			end
		end
		--ÏÈÌì¾ÅÒõ
		if NGid == 100 then
			if PersonKF(id, 100) and PersonKF(id,107) then
				return true
			elseif match_ID(id,65) or match_ID(id,129) then
				return true
			elseif match_ID(id,758) or match_ID(id,782) or match_ID(id,786) then	
			    return true
			else 
				return false		
			end
		end
		--ÄæÔË¾ÅÒõ
		if NGid == 104 then
			if PersonKF(id, 104) and PersonKF(id,107) then
				return true
			elseif JXPD(id,60,1) then
				return true
			elseif match_ID(id,783) then
			    return true 	
			else 
				return false		
			end
		end
		--¾ÅÑôÇ¬À¤
		if NGid == 106 then
			if PersonKF(id, 106) and PersonKF(id,97) then
				return true
			elseif match_ID(id,9) or match_ID(id,785) then
				return true
			else 
				return false		
			end
		end
		--ÂŞºº½ğ¸Õ
		if NGid == 144 then
			if PersonKF(id,96) and PersonKF(id,144) then
				return true
			elseif match_ID(id,577) or match_ID(id,758) or match_ID(id,743) then
				return true
			else 
				return false		
			end
		end
		--×¯×ÓÌìÄ§
		if NGid == 160 then
			if PersonKF(id, 160) and PersonKF(id,190) then
				return true
			elseif match_ID(id,112) or match_ID(id,627) then
				return true
			else 
				return false		
			end
		end
		--ÍüÇéÅ­ÌÎ
		if NGid == 177 then
			if PersonKF(id,177) and PersonKF(id,252) then
				return true
			elseif match_ID(id,652) and PersonKF(id,177) then
				return true
			elseif match_ID(id,772) and Curr_NG(id,108) then
			    return true			
			else
				return false
			end
		end 			
		--¾¨Óã¹êÏ¢
		if NGid == 180 then
			if PersonKF(id,227) and PersonKF(id,180) then
				return true
			elseif match_ID(id,759) or match_ID(id,776) or match_ID(id,781) or match_ID(id,782) then
			    return true 	
			elseif match_ID(id,773) then
			    return true			
			else
				return false
			end
		end
		--¹êÏ¢ÖÜÌì
	    if NGid ==	190 then
			if PersonKF(id,190) and PersonKF(id,227) then
				return true
			elseif match_ID(id,5) or match_ID(id,524) or match_ID(id,786) then
			    return true
			else 
			    return false		
			end
		end
		--Ê®ÈıÌ«±£ºáÁ·£¨Ìú²¼ÉÀ+½ğ¸Õ²»»µ+ÁúÏó£©
		if NGid == 196 then
			if PersonKF(id,196) and PersonKF(id,144) and PersonKF(id,103) then
				return true
			elseif match_ID(id,603) or match_ID(id,9807) then
				return true
			elseif match_ID(id,771) or match_ID(id,743) then 
			    return true	
			else 
				return false	
			end
		end
		--´şÏº»¢£¨ÎäÄÂ³¤ÉúorÉñÕÕ£©
		if NGid == 199 then
			if PersonKF(id,199) and (PersonKF(id,203) or PersonKF(id,94)) then
				return true
			elseif (JXPD(id,578,1) or JXPD(id,505,1)) and PersonKF(id,203) then
				return true
			elseif match_ID(id,771) and PersonKF(id,94) then 
				return true
			elseif match_ID(id,781) then 
				return true
			else
				return false
			end
		end
		--¿İìø±ù»ğ
		if NGid == 207 then
			if PersonKF(id,207) and (PersonKF(id,250) or PersonKF(id,314)) then
				return true
			elseif match_ID(id,499) or match_ID(id,65) then
				return true
			elseif match_ID(id,102) and PersonKF(id,207) then
				return true
			else 
				return false		
			end
		end
		--º®±ùorÒ×Ë®º®£¬×ÏÏ¼
	    if NGid ==	216 then
			if (PersonKF(id,216) or PersonKF(id,43)) and PersonKF(id,89) then
				return true
			elseif match_ID(id,22) then
			    return true
			else 
			    return false		
			end
		end
		--Ğ¡ĞÇ³½ÖÜÌì
		if NGid == 219 then
			if PersonKF(id,219) and PersonKF(id,225) then
				return true
			elseif match_ID(id,26) or match_ID(id,782) then
			    return true
			else 
				return false		
			end
		end
		--±Ìº£Îå×ª
	    if NGid == 248 then
			if PersonKF(id,248) and PersonKF(id,317) then
				return true
			elseif match_ID(id,56) or match_ID(id,57) or match_ID(id,588) or match_ID(id,785) then
			    return true
			else 
			    return false		
			end
		end
		--Å­ÌÎÎäÄÂ
		if NGid == 252 then
			if PersonKF(id,252) and PersonKF(id,199) then
				return true
			elseif match_ID(id,568) and PersonKF(id,199) then
			    return true
			elseif match_ID(id,782) then 	
			    return true
			else 
			    return false		
			end
			
		end
		--ÁúĞ¥»ìÔª
		if NGid == 369 then
			if PersonKF(id,369) and PersonKF(id,90) then
				return true
			elseif match_ID(id,524) or match_ID(id,758) then
			    return true
			else
			    return false		
			end
		end
	--end
	return false
end

function NGQHC(id,NGid)--¡¸·ÇÖ÷ÔË¡¹+ ¡¸Çá¹¦¡¹
	--if WAR.PJTX1 ~= 0 and (not match_ID(id,592)) then
		--return false
	--else
	    --ÌìÄ§½Ì
		if MPTX(id,31,3) and NGid == 160 then
			return true
		end 	
	    --±Ìº£ÆæÃÅÁé÷¡
		if NGid == 248 then
			if PersonKF(id,248) and PersonKF(id,317) and PersonKF(id,237) then
				return true
			elseif match_ID(id,57) then 
			    return true 
			else 
			    return false		
			end
		end 
		--¸òó¡ÄæÔËË²Ï¢
		if NGid == 95 then 
			if PersonKF(id,95) and PersonKF(id,104) and PersonKF(id,150) then
				return true
			elseif match_ID(id,60) then 
			    return true 
			else 
			    return false		
			end
		end 
		--»¯¹¤Ğ¡ÎŞÏàÕªĞÇ
		if NGid == 87 then 
			if PersonKF(id,87) and PersonKF(id,98) and PersonKF(id,296) then
				return true
			elseif match_ID(id,46) then 
			    return true 
			else 
			    return false		
			end
		end 
        --ÉñÕÕ´¿Ñô¾ı×Ó
		if NGid == 94 then
			if PersonKF(id,94) and PersonKF(id,99) and PersonKF(id,262) then
				return true
			elseif match_ID(id,37) or match_ID(id,775) then 
			    return true 
			else 
			    return false		
			end
		end 
		--¿İÈÙÂŞººÁúĞĞ
		if NGid == 207 then
			if PersonKF(id,207) and PersonKF(id,96) and PersonKF(id,280) then
				return true
			elseif match_ID(id,499) or match_ID(id,774) then 
			    return true 
			else 
			    return false		
			end
		end 
		--´¿Ñô¹êÏ¢ÌİÔÆ
		if NGid == 99 then
			if PersonKF(id,99) and PersonKF(id,227) and PersonKF(id,149) then
				return true
			elseif match_ID(id,5) or match_ID(id,524) then 
			    return true 
			else 
			    return false		
			end
		end
		--×ÏÏ¼Ğ¡ÎŞÏàÉñĞĞ
		if NGid == 89 then 
			if PersonKF(id,89) and PersonKF(id,98) and PersonKF(id,146) then 
				return true
			elseif match_ID(id,140) or match_ID(id,779) or match_ID(id,780) then
			    return true 
			else 
				return false	
			end
		end
		--Ç¬À¤»ìÔª°µÏã
		if NGid == 97 then 
			if PersonKF(id,97) and PersonKF(id,90) and PersonKF(id,316) then 
				return true 
			elseif match_ID(id,456) or match_ID(id,606) or match_ID(id,641) or match_ID(id,776) then 
			    return true
			else  
			    return false 		
			end
		end
		--ÁúÏóÊ¨×ÓÌ¤Ñ©
		if NGid == 103 then
			if PersonKF(id,103) and PersonKF(id,92) and PersonKF(id,227) then 
				return true
			elseif match_ID(id,62) or match_ID(id,103) or match_ID(id,771) then
			    return true 
			else 
			    return false 		
			end
		end
		--Ì«¼«ÏÈÌìÁè²¨
		if NGid == 171 then
			if PersonKF(id,171) and PersonKF(id,100) and PersonKF(id,147) then
				return true
			elseif match_ID(id,5) or match_ID(id,129) or match_ID(id,116) or match_ID(id,117) or match_ID(id,118) or match_ID(id,522) or match_ID(id,634) then
			    return true 
			else 
			    return false 		
			end
		end
		--ÏÈÌìÊ¥»ğÌìÂŞ
		if NGid == 100 then
			if PersonKF(id,100) and PersonKF(id,93) and PersonKF(id,148) then
				return true 
			elseif match_ID(id,605) or match_ID(id,685) or match_ID(id,686) then
			    return true
			else 
			    return false		
			end
		end
		--½ğ¸ÕÅ­ÌÎÒ»Î­
		if NGid == 144 then
			if PersonKF(id,144) and PersonKF(id,252) and PersonKF(id,186) then
				return true 
			elseif match_ID(id,743) or match_ID(id,772) or match_ID(id,782) then
			    return true	
			else 
			    return false
			end 		
		end
		--ÓñÅ®¹êÏ¢½ğÑã
		if NGid == 154 then
			if PersonKF(id,154) and PersonKF(id,227) and PersonKF(id,223) then
				return true 
			elseif match_ID(id,605) or match_ID(id,685) or match_ID(id,686) then
			    return true
			else 
			    return false
			end 			
		end
		--ÍüÇéÎäÄÂåĞÒ£
		if NGid == 177 then
			if PersonKF(id,177) and PersonKF(id,199) and PersonKF(id,2) then
				return true 
			elseif match_ID(id,50) or match_ID(id,69) or match_ID(id,525) or match_ID(id,527) then
			    return true	
			else 
			    return false
			end 		
		end
		--Å­ÌÎ³¤´º»¨¼ä
		if NGid == 252 then
			if PersonKF(id,252) and PersonKF(id,183) and PersonKF(id,286) then 
				return true	
			else 
			    return false		
			end
		end
	return false
end	

--Îä¹¦ÄÚÁ¦ĞÔÖÊÅĞ¶Ï
function wgnlxz(wugong)
	local xz
	for i = 0, JY.ThingNum - 1 do
		if JY.Thing[i]['Á·³öÎä¹¦'] >= 0 and wugong == JY.Thing[i]['Á·³öÎä¹¦'] then
			xz = JY.Thing[i]["ĞèÄÚÁ¦ĞÔÖÊ"]
			break
		end		
	end
	return xz
end	
-----Èı²ÅÉíÅĞ¶Ï
function Sancai(id)
	local yin,yang,tiao = 0,0,0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local wid = JY.Person[id]["Îä¹¦"..i]
		if wgnlxz(wid) == 0 and yongnei(wid) then
			yin = 1
			break
		end
	end	
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local wid = JY.Person[id]["Îä¹¦"..i]
		if wgnlxz(wid) == 1 and yongnei(wid) then
			yang = 1
			break
		end
	end
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local wid = JY.Person[id]["Îä¹¦"..i]
		if wgnlxz(wid) == 2 and yongnei(wid) then
			tiao = 1
			break
		end
	end
	if yin > 0 and yang > 0 and tiao > 0 then
		return true
	elseif match_ID(id,3) then
		return true
	else
		return false
	end
	--return false	
end

--Ì«¼«·´»÷
function tjqfj(eid)
	if JY.Status == GAME_WMAP then
		if (Curr_NG(eid,171) or Curr_NG(eid,99)) and PersonKF(eid,16) and JY.Person[eid]['È­ÕÆ¹¦·ò'] >= 350 then
			return true
		elseif MPTX(eid,4,3) and PersonKF(eid,16) and (Curr_NG(eid,171) or Curr_NG(eid,99)) then
			return true
		end
	end
	return false
end	

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨ÈËÎïÃæ°åÉÏ¼«µÄ¸öÊı
function calc_mas_num(id)
	local mas_num = 0;
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		if JY.Person[id]["Îä¹¦µÈ¼¶" .. i] == 999 then
			mas_num = mas_num + 1;
		end
	end
	return mas_num
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨ÊÇ·ñÎªÖ¸¶¨IDµÄÈËÎï£¬ÓÃ×÷Ìì¸³µÈÅĞ¶¨
function match_ID(personid, id)
	if JY.Status == GAME_WMAP then
		if WAR.PD['¼«ÒõÎŞÏà6'][personid] ~= nil then
			return false
		end
	end	
	--end	
	if personid == 0 then 
		if CC.TG[id] == 1 then 
			return true
        end
    end
	if id > 9700 then
		if PDTZ(personid,JY.Person[personid]["ÎäÆ÷"]) then
			local n = JY.Person[personid]["ÎäÆ÷"]
			if Setmeal[n][7] == id then
				if JY.Status == GAME_WMAP then
					if WAR.TMYJ > 0 then
						return false
					else
						return true
					end
				else	
					return true
				end	
			end
			
		end
	end
	
	--[[if personid == 0 and JY.Base["³©Ïë"] > 0 then
		personid = JY.Base["³©Ïë"]

	end]]
	
	
	-- if personid == 0 then 
	
		-- if PDTZ(personid,JY.Person[personid]["ÎäÆ÷"])  then
			-- local n = JY.Person[personid]["ÎäÆ÷"]
			-- if Setmeal[n][7] == id then
				-- say("µ±Ç°Ìì¸³"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	
	-- end
	
	-- if personid == 0 and JY.Base["³©Ïë"] > 0 then
		-- personid = JY.Base["³©Ïë"]
		-- if PDTZ(personid,JY.Person[personid]["ÎäÆ÷"])  then
			-- local n = JY.Person[personid]["ÎäÆ÷"]
			-- if Setmeal[n][7] == id then
			-- --	say("µ±Ç°Ìì¸³"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	-- end	
	if CC.Copy[personid] ~= nil then 
		personid = CC.Copy[personid]
	end
	if JY.Status == GAME_WMAP then
		--æÎÖ÷ÁÙÊ±Ìì¸³
		if actor(personid,10) then 
			if WAR.LSTF[personid] == nil then 
				WAR.LSTF[personid] = {}
			end
			if WAR.LSTF[personid][id] ~= nil then 
				return true
			end
		end
		--ĞŞ¸´¶ÓÓÑÌì¸³²»ÉúĞ§
		if personid == 539 and id == 50 then
			return true
		end	
		if personid == 628 and id == 530 then
			return true
		end
		if personid == 681 and id == 53 then
			return true
		end
		if personid == 678 and id == 49 then
			return true
		end
		if personid == 528 and id == 523 then
			return true
		end
		if personid == 709 and (id == 92 or (id > 9700 and id ~= 9895)) then
			return true
		end
		if personid == 741 and id == 501 then
			return true
		end	
		if personid == 742 and id == 596 then
			return true
		end	
		--¶ÓÓÑ¶«·½
		if personid == 777 and id == 27 then
			return true
		end	 
		--Â¥Ö÷Ä¬²ÔÀë
		--if personid == 750 and id == 517 then
			--return true
		--end	 
	end	
	
	if personid == 512 and JY.Person[512]["ÔİÊ±ÎŞÓÃ"] > 0 then
		personid = JY.Person[512]["ÔİÊ±ÎŞÓÃ"]
	end	
	
	if (personid==512 or personid == JY.Person[512]["ÔİÊ±ÎŞÓÃ"]) then
		if id==JY.Person[512]["ÔİÊ±ÎŞÓÃ"] then
			return true
		end
	end

	-- if id > 9940  then

		-- if PDTZ(personid,JY.Person[personid]["ÎäÆ÷"])  then
			-- local n = JY.Person[personid]["ÎäÆ÷"]
			-- if Setmeal[n][7] == id then
				-- --say("µ±Ç°Ìì¸³"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	-- end

  
	--say("±äÁ¿"..id,0,1)	
	-- if id > 9940 then
		-- if PDTZ(personid,JY.Person[personid]["ÎäÆ÷"])  then
			-- local n = JY.Person[personid]["ÎäÆ÷"]
			-- if Setmeal[n][7] == id then
				-- say("µ±Ç°Ìì¸³"..id.." | "..Setmeal[n][7],0,1)
				-- return true
			-- end
		-- end
	-- end
	--if id > 9940 then
		
	--end
	--[[if (personid==0 or personid == JY.Base["³©Ïë"]) and JY.Base["µ¥Í¨"]==2 and instruct_16(29) and id==9962 then  
		return true
	end	]]
	
	if CC.PTF[personid] == nil then
		CC.PTF[personid] = {}
	end
	--for i = 1, #CC.PTF[personid] do
	if CC.PTF[personid][id] ~= nil then 
		if id == 9919 and psx(personid,'Æ·µÂ') > 5 then
			return false
		end	
		return true
		--[[if personid == 0 then
			
			if JY.Base["µ¥Í¨"]==2 and instruct_16(id) then
				return true
			end
			if JY.Base["µ¥Í¨"]==2 and instruct_16(29) and id == 9962 then
				return true
			end
			--if (personid==0 or personid == JY.Base["³©Ïë"]) then
				if id==JY.Person[0]["´úºÅ"] then
					return true
				end
			--end
			return true
		else
			return true
		end	]]	
	end
	if personid == 0 and JY.Base['³©Ïë'] > 0 and JY.Base['³©Ïë'] == id then 
		return true
	end	
	if personid == 0 and JY.Base["µ¥Í¨"] == 2 and instruct_16(id) then
		return true
	end
	if personid == 0 and JY.Base["µ¥Í¨"] == 2 and instruct_16(29) and id == 9962 then
		return true
	end	 
	if personid == 0 and id == JY.Person[0]["´úºÅ"] then
		return true
	end	
	--ÁùÂö½£Õó
	if WAR.ZDDH == 376 then
		if personid == 50 and (id == 55 or id == 527 or id == 69) then
			return true
		end
		if personid == 681 and (id == 65 or id == 499 or id == 114) then
			return true
		end
		if personid == 678 and (id == 116 or id == 117 or id == 118 or id == 115) then
			return true
		end
		if (personid == 540 or personid == 541 or personid == 542 or personid == 543 or personid == 544) and (id == 102 or id == 122) then
			return true
		end
	end
	--É±ÆÆÀÇ
	if WAR.ZDDH == 430 and (personid == 759 or personid == 743) and (id == 759 or id == 743) and JY.Person[id]["ÉúÃü"] > 0 then
		return true
	end
	--É­ÂŞÁùºÏ
	if WAR.ZDDH == 453 and (personid == 520 or personid == 524 or personid == 743 or personid == 747 or personid == 758 or personid == 759 or personid == 760)  
	    and (id == 520 or id == 524 or id == 743 or id == 747 or id == 758 or id == 759 or id == 760) and JY.Person[id]["ÉúÃü"] > 0 then
		return true
	end
	--ËÄÉñ·â¾øÕó
	if WAR.ZDDH == 468 and (personid == 5 or personid == 27 or personid == 50 or personid == 114) and (id == 5 or id == 27 or id == 50 or id == 114) and JY.Person[id]["ÉúÃü"] > 0 then
		return true
	end
	return false
end
--ÎŞ¾Æ²»»¶£ºÅĞ¶¨ÊÇ·ñÎªÖ¸¶¨IDµÄÈËÎï£¬²¢ÇÒÅĞ¶¨ÊÇ·ñ´ïµ½Ö¸¶¨¾õĞÑ´ÎÊı
function JXPD(personid, id, awkntimes)
    --personid ĞĞ¶¯½ÇÉ«
    --id ÌØĞ§½ÇÉ«
    --awkntimes ¾õĞÑ´ÎÊı
	if CC.Copy[personid] ~= nil then 
		personid = CC.Copy[personid]
	end
    local pd = false

    if personid == 0 and JY.Base['±ê×¼'] > 0 and id == JY.Base['±ê×¼'] then
    	if JY.Person[personid]['ÁùÈç¾õĞÑ'] >= awkntimes then
			pd = true
		end
	elseif personid == 0 and JY.Base['³©Ïë'] == id and match_ID(personid,id) then	
		if JY.Person[personid]['¸öÈË¾õĞÑ'] >= awkntimes then
			pd = true
		end
	elseif personid == 0 and JY.Base["µ¥Í¨"] == 2 and instruct_16(id) then
        if JY.Person[0]["¸öÈË¾õĞÑ"] >= awkntimes then
            pd = true
		elseif JY.Person[0]["ÁùÈç¾õĞÑ"] >= awkntimes then
		    pd = true
        end 	
	end 

	if personid ~= 0 and match_ID(personid,id) then
		if JY.Person[personid]['¸öÈË¾õĞÑ'] >= awkntimes then
			pd = true
		end
	end	

	if id > 9000 and match_ID(personid,id) then
		if JY.Person[personid]["¸öÈË¾õĞÑ"] >= awkntimes then
            pd = true
		elseif JY.Person[0]["ÁùÈç¾õĞÑ"] >= awkntimes then
		    pd = true
        end 	
	end 
	return pd
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨Á¬»÷ÂÊ
function Person_LJ(pid)
	--¸ù¾İÄÚÇá×ÊÖÊ¼ÆËã»ù´¡Á¬»÷ÂÊ
	local LJ1 = math.modf(JY.Person[pid]["Çá¹¦"] / 80)
	local LJ2 = math.modf((JY.Person[pid]["ÄÚÁ¦×î´óÖµ"] + JY.Person[pid]["ÄÚÁ¦"] * 2) / 3000)
	local LJ3 = math.modf(JY.Person[pid]["×ÊÖÊ"] / 8)
	local LJ = 0
	LJ = (LJ1 + LJ2 + LJ3) / 2
	
	--Ãğ¾ø¡¢ôÃÇ§Øğ¡¢ºé½ÌÖ÷¡¢³ÉÀ¥¡¢Ïô°ëºÍ¡¢Æİ³¤·¢¡¢Áîºü³å¶ş¾õÖ®ºó£¬Á¬»÷ÂÊ+70%
	if match_ID(pid, 6) or match_ID(pid, 67) or match_ID(pid, 71) or match_ID(pid, 18)  or match_ID(pid, 594) or JXPD(pid, 35, 2) then
		LJ = LJ + (100 - LJ) * 0.7
	end
	--ºÎ×ãµÀ£¬100%ÑªÎŞ¼Ó³É£¬0Ñª100%¼Ó³É
	if match_ID(pid, 586) or match_ID(pid, 9792) then
	local HZDLJ = 0
	HZDLJ = (1-JY.Person[pid]["ÉúÃü"] / JY.Person[pid]["ÉúÃü×î´óÖµ"])*100
	LJ = LJ + HZDLJ
	end		
	
	if (match_ID(pid, 152) or match_ID(pid, 9837)) and JY.Person[pid]["ÉúÃü"] < JY.Person[pid]["ÉúÃü×î´óÖµ"] / 4 then
		LJ = LJ * 3
    elseif (match_ID(pid, 152) or match_ID(pid, 9837)) and JY.Person[pid]["ÉúÃü"] < JY.Person[pid]["ÉúÃü×î´óÖµ"] / 2 then
		LJ = LJ * 2
    end	
	--Ïô°ëºÍÁ¬»÷+50% ÉÁµç¾ªºè
    if match_ID(pid, 189) or match_ID(pid, 9996) then
	   LJ = LJ +(100-LJ)*0.5
	end
	--ÌìÒÂÎŞ·ì
	if WGZH(pid,54,62) then
		LJ = LJ +(100-LJ)*0.3
	end
	--Á¬»÷Îä¹¦£¬Ã¿¸öÁ¬»÷+2.5%
	--°Ù»¨£¬¿ÕÃ÷£¬ÓñÅ®£¬Ì©É½£¬Ô§Ñì£¬·´Á½ÒÇ£¬Ñî¼ÒÇ¹£¬º£ÛÅ£¬ÒøËø£¬Á¬³Ç£¬È¥·³ÄÕ£¬ºÚ·ç, ËØĞÄ
	local ljup = {10, 15, 42, 31, 54, 60, 68, 76, 79, 114, 124, 131, 139}
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		if JY.Person[pid]["Îä¹¦" .. i] > 0 then
			for ii = 1, #ljup do
				if JY.Person[pid]["Îä¹¦" .. i] == ljup[ii] then
					LJ = LJ + (100 - LJ) * 0.025
				end
			end
		else
			break;
		end
	end
	
	--¶À¹Â¾Å½£Á¬»÷+5%   
    if PersonKF(pid,47) then 
        LJ = LJ + (100 - LJ) * 0.05
    end

	--ÂÛ½£´òÓ®ÁÖ³¯Ó¢½±Àø+50%
	if pid == 0 and JY.Person[605]["ÂÛ½£½±Àø"] == 1 then
		LJ = LJ + (100 - LJ) * 0.5
	end
	
	--ÊµÕ½£¬Ã¿80µã+1%
	local jp = JY.Person[pid]["ÊµÕ½"] / 8000
	LJ = LJ + (100 - LJ) * jp
	
	
	--Ö÷ÔË¾ÅÒõ+50% 
	if  Curr_NG(pid, 107) and (JY.Person[pid]["ÄÚÁ¦ĞÔÖÊ"] == 0 or JY.Person[pid]["ÄÚÁ¦ĞÔÖÊ"] == 3 ) then
		LJ = LJ + (100 - LJ) * 0.5
    end
    
	--Ë«½£ºÏ±Ú Á¬»÷ÂÊ+30%
	if WGZH(pid,39,42) == true then
		LJ = LJ + (100 - LJ) * 0.3
	end
	--Á÷ĞÇ½£ Á¬»÷ÂÊ+10%
	if JY.Person[pid]["ÎäÆ÷"]  == 38 then
		LJ = LJ + (100 - LJ) * (JY.Thing[38]["×°±¸µÈ¼¶"]/10 -0.1)
	end	 

	--ÄşÖĞÔò ÓñÅ®Ê®¾Å½£Á¬»÷ÂÊ+30%
	if match_ID(pid,649) and WAR.YLSJJ == 1 and JY.Status == GAME_WMAP then
		LJ = LJ + (100 - LJ) * 0.3
    end

	--±ê¼ÇĞŞ¸Ä ½ğÑã¹¦Á¬»÷ÂÊ+20%
	 if Curr_QG(pid,223) then
		LJ = LJ + (100 - LJ) * 0.2
    end		
    
	--½¹Íğ¶ùÔÚ³¡£¬È«Ìå¼Ó10%
    if JY.Status == GAME_WMAP then
		for wid = 0, WAR.PersonNum - 1 do
			if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], 607) and WAR.Person[wid]["ËÀÍö"] == false and WAR.Person[wid]["ÎÒ·½"] then
				LJ = LJ + (100 - LJ) * 0.1
				break
			end
		end
	end
	
	--ÎŞ³¾£¬ÑªÁ¿ÉÙÓÚËÄ·ÖÖ®Ò»Ê±£¬»ù´¡Á¬»÷ÂÊ3±¶
    if match_ID(pid, 152) and JY.Person[pid]["ÉúÃü"] < JY.Person[pid]["ÉúÃü×î´óÖµ"] / 4 then
		LJ = LJ * 3
    --ÎŞ³¾£¬ÑªÁ¿ÉÙÓÚ¶ş·ÖÖ®Ò»£¬»ù´¡Á¬»÷ÂÊ2±¶
    elseif match_ID(pid, 152) and JY.Person[pid]["ÉúÃü"] < JY.Person[pid]["ÉúÃü×î´óÖµ"] / 2 then
		LJ = LJ * 2
    end

	--¶«·½²»°Ü¡¢ÏôÔ¶É½ ±ØÁ¬»÷
	if match_ID(pid, 27) or match_ID(pid, 112)  then
		LJ = 100
	end
	--¾®ÔÂ°Ë·¨
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
	    if JY.Person[pid]["Îä¹¦" .. i] == 181 then
		    local dfjc = 0
		    for i = 1,JY.Base['Îä¹¦ÊıÁ¿'] do
			    if JY.Wugong[JY.Person[pid]['Îä¹¦'.. i]]['Îä¹¦ÀàĞÍ'] == 4 and JY.Person[pid]["Îä¹¦µÈ¼¶" .. i] == 999 then
					dfjc = dfjc + 1
			    end
			    if dfjc >= 8 then				
			       LJ = LJ + (100 - LJ) *dfjc*0.01
			      break
			    end
		    end
		end  
	end 	
    if match_ID(pid, 9965) then 
        LJ = LJ * 0.2
        if JY.Status == GAME_WMAP then 
            if WAR.LQZ[pid] == 100 then 
                LJ = 100
            end
        end
    end
    --Ø¤°ï»ù´¡Á¬»÷
	if MPTX(pid,2) then
		LJ = LJ + (100 - LJ) * 0.15
	end
	--Ø¤°ïÁ¬»÷
	if MPPD(pid) == 2 and Curr_NG(pid,204) then
		local gblj = 0
		for j = 1 ,JY.Base['Îä¹¦ÊıÁ¿'] do
			if JY.Person[pid]["Îä¹¦"..j] == 26 or JY.Person[pid]["Îä¹¦"..j] == 80 then
				gblj = gblj + 10
			end
		end
		LJ = LJ + gblj 
	end	
	 
	--Á¬»÷ÂÊÏÂÏŞ1
    if LJ < 1 then
		LJ = 1
    end
	
	--È¡Õû
	LJ = math.modf(LJ)
	
	return LJ
end

--ÎŞ¾Æ²»»¶£ºÅĞ¶¨±©»÷ÂÊ
function Person_BJ(pid)
    --¸ù¾İÄÚ¹¥ÌåÁ¦¼ÆËã»ù´¡±©»÷ÂÊ
    local BJ1 = math.modf(JY.Person[pid]["¹¥»÷Á¦"] / 80)
    local BJ2 = math.modf((JY.Person[pid]["ÄÚÁ¦×î´óÖµ"] + JY.Person[pid]["ÄÚÁ¦"] * 2) / 3000)
    local BJ3 = math.modf(JY.Person[pid]["ÌåÁ¦"] / 10)
    local BJ = 0
    BJ = (BJ1 + BJ2 + BJ3) / 2

    --±©»÷Îä¹¦£¬Ã¿¸ö±©»÷+2.5%
	--µ¯Ö¸£¬´óÁ¦£¬È«Õæ£¬½ğÉß£¬ÆæÃÅÈı²Å£¬È¼Ä¾£¬Åá½«¾ü£¬»ÆÉ³£¬º×Éß£¬½ğÎÚ£¬ĞşÚ¤£¬ÌúÖ¸¾÷£¬Ò»ÑôÖ¸
    local bjup = {18, 22, 39, 40, 56, 65, 71, 78, 74, 61, 21, 121, 17}
    for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		if JY.Person[pid]["Îä¹¦" .. i] > 0 then
			for ii = 1, #bjup do
				if JY.Person[pid]["Îä¹¦" .. i] == bjup[ii] then
					BJ = BJ + (100 - BJ) * 0.025
				end
			end
		else
			break;
		end
    end

	  
	--ÊµÕ½£¬Ã¿80µã+1%
	local jp = JY.Person[pid]["ÊµÕ½"] / 8000
	BJ = BJ + (100 - BJ) * jp

    --Ñªµ¶ÀÏ×æ¡¢ôÃÇ§Øğ¡¢ºé½ÌÖ÷¡¢ÈÎÎÒĞĞ¡¢ÓñÕæ×Ó¡¢£¬±©»÷ÂÊ+70%
    if match_ID(pid, 97) or match_ID(pid, 67) or match_ID(pid, 71) or match_ID(pid, 26) or match_ID(pid, 184) then
		BJ = BJ + (100 - BJ) * 0.7
    end
	--¾®ÔÂ°Ë·¨±©»÷ÂÊ+5%   
    if PersonKF(pid,181) then 
        local dfjc = 0
        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
            if JY.Wugong[JY.Person[pid]['Îä¹¦'.. i]]['Îä¹¦ÀàĞÍ'] == 4  and JY.Person[pid]['Îä¹¦µÈ¼¶'.. i] == 999 then
				dfjc = dfjc + 1
            end
        end	
        if dfjc >= 8  then
            BJ = BJ + (100 - BJ) * dfjc*0.01
        end
    end
    if MPPD(pid) == 6 then
		if Curr_NG(pid,103) then
			BJ = BJ + (100 - BJ) * 0.4
		else
			BJ = BJ + (100 - BJ) * 0.2
		end
	end	
	--Ô¬³ĞÖ¾£¬Ïô°ëºÍ ±©»÷ÂÊ+50%
    if match_ID(pid, 54) or match_ID(pid, 189)then
		BJ = BJ + (100 - BJ) * 0.5
    end
    --ÊÀ×ğ½µÄ§±©»÷Ìá¸ß
	if ShiZunXM(pid) == true then
		BJ = BJ + (100 - BJ) * 0.5
	end
	--Â½ÎŞË« ±©»÷ÂÊ+30%
    if match_ID(pid, 580) then
		BJ = BJ + (100 - BJ) * 0.3
    end	
    if PersonKF(pid,247) then
    	if Curr_NG(pid,247) then
    		if PersonKF(pid,242) then
    			BJ = BJ + (BJ*0.7)
    		else
    			BJ = BJ + (100 - BJ) * 0.4	
    		end	
    	else
    		BJ = BJ + (100 - BJ) * 0.2
    	end
    end			
	-- --Â½ÎŞË« ±©»÷ÂÊ+30%
    -- if match_ID(pid, 580) then
		-- BJ = BJ + (100 - BJ) * 0.3
    -- end		
	--½ğÑã¹¦ ±ê¼ÇĞŞ¸Ä
       if Curr_QG(pid,223) then
		BJ = BJ + (100 - BJ) * 0.2
       end
	--ºÎ×ãµÀ£¬100%ÑªÎŞ¼Ó³É£¬0Ñª100%¼Ó³É
	if match_ID(pid, 586) or match_ID(pid,9793) then
		local HZDBJ = 0
		HZDBJ = (1-JY.Person[pid]["ÉúÃü"] / JY.Person[pid]["ÉúÃü×î´óÖµ"])*100
		BJ = BJ + HZDBJ
	end	
    --Ñî¹ı£¬ÑªÁ¿ÉÙÓÚËÄ·ÖÖ®Ò»Ê±£¬»ù´¡±©»÷ÂÊ3±¶
    if (match_ID(pid, 58) or match_ID(pid, 9791)) and JY.Person[pid]["ÉúÃü"] < JY.Person[pid]["ÉúÃü×î´óÖµ"] / 4 then
		BJ = BJ * 3
    --Ñî¹ı£¬ÑªÁ¿ÉÙÓÚ¶ş·ÖÖ®Ò»£¬»ù´¡±©»÷ÂÊ2±¶
    elseif (match_ID(pid, 58) or match_ID(pid, 9791)) and JY.Person[pid]["ÉúÃü"] < JY.Person[pid]["ÉúÃü×î´óÖµ"] / 2 then
		BJ = BJ * 2
    end
	--Ö÷ÔËÄæÔË+50%
	if Curr_NG(pid, 104) then
	    BJ = BJ + (100 - BJ) * 0.5
    elseif PersonKF(pid,107) then
		BJ = BJ + (100 - BJ) * 0.3
	end
	--¿ÜÖÙ
	if match_ID(pid, 578) then
        local df = 0
        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
            if JY.Wugong[JY.Person[0]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"] == 4 and JY.Person[0]["Îä¹¦µÈ¼¶" .. i] == 999 then
                df = df + 1
                if df > 8 then
                    df = 8
                end
            end
            BJ = BJ + (100 - BJ) *df*0.05
        end
    end
	--Ïô·å¡¢Ãğ¾ø¡¢ÏôÔ¶É½£¬±Ø±©»÷
    if match_ID(pid, 50) or match_ID(pid, 6) or match_ID(pid, 112) then
		BJ = 100
    end
	--Ò»µ¶Á÷
	if MPPD(pid) == 11 then
		BJ = BJ + (100 - BJ) * 0.5
		if match_ID(pid,741) or match_ID(pid,742) then --Ø¬ÃÎ
		    BJ = 100
	    end	 
	end
	--ÌÆÃÅÄ£Ê½1
	if MPPD(pid) == 9 then 
	    BJ = BJ + (100 - BJ) * 0.4
    end
	--Ö»ÓĞÕ½¶·ÖĞ²ÅÓĞµÄ¼Ó³É
	if JY.Status == GAME_WMAP then
		--Å·Ñô·æ ÄæÔË×´Ì¬ÏÂ±Ø±©»÷
		if match_ID(pid, 60) and WAR.tmp[1000+pid] == 1 then
			BJ = 100
		end
		if PersonKF(pid, 180) and WAR.PD["¾¨Ï¢ĞîÁ¦"][pid] ~= nil and WAR.PD["¾¨Ï¢ĞîÁ¦"][pid] > 500 then
        	BJ = BJ + 100
    	end	
		--½ğÑã¹¦ÌìÇáĞ§¹û
		if Curr_QG(pid,223) and TFQG(pid,223) then
			BJ = BJ + math.modf(WAR.YDBS*2)
		end	
	end
	
	--±©»÷ÂÊÏÂÏŞ1
    if BJ < 1 then
		BJ = 1
    end
	
	--È¡Õû
	BJ = math.modf(BJ)
	
	return BJ
end

--ÎŞ¾Æ²»»¶£º·µ»ØÈËÎïËùÑ§ÄÚ¹¦µÄÊıÁ¿
function Num_of_Neigong(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if kfid > 0 and JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 6 then
			num = num + 1
		end
	end
	return num
end

--ÎŞ¾Æ²»»¶£ºÕæÊµÈ­ÕÆÄÜÁ¦µÄÅĞ¶¨
function TrueQZ(id)
    local qz = JY.Person[id]["È­ÕÆ¹¦·ò"]
    if JY.Status == GAME_WMAP and match_ID(9947,id) then 
        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
            if JY.Wugong[JY.Person[id]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"] == 6 then
                qz = qz + 30
            end
        end
    end
	--½ğË¿ÊÖÌ×
	if JY.Status == GAME_WMAP and JY.Person[id]["ÎäÆ÷"] == 239 then
		local add = 10
		if JY.Thing[239]["×°±¸µÈ¼¶"] >= 5 then
			add = 30
		elseif JY.Thing[239]["×°±¸µÈ¼¶"] >= 4 then
			add = 25
		elseif JY.Thing[239]["×°±¸µÈ¼¶"] >= 3 then
			add = 20
		elseif JY.Thing[239]["×°±¸µÈ¼¶"] >= 2 then
			add = 15
		end
		qz = qz + add
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["ÎäÆ÷"] > 0 and JY.Person[id]["ÎäÆ÷"] ~= 239 then
		local n = JY.Person[id]["ÎäÆ÷"]
		local m = JY.Thing[n]["×°±¸µÈ¼¶"]
		local o = 20
		if NGQH(id,203) then
			o = 40
		end	
		if m >= 2 then
			qz = qz + JY.Thing[n]["¼ÓÈ­ÕÆ¹¦·ò"]*o
		end
	end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['ËÀÍö'] == false then
				local jid = WAR.Person[j]["ÈËÎï±àºÅ"]
				if psx(jid,"È­ÕÆ¹¦·ò") > a then
					a = psx(jid,"È­ÕÆ¹¦·ò")
				end
			end
		end
	    qz = a + JY.Base["ÖÜÄ¿"]*3
	end	
	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == false  then
				df = df +1
			end          
	    end	
		 qz = qz + df * 5		
	end
	
	if JY.Status == GAME_WMAP and JY.Base["ÖÜÄ¿"]>0 then
		qz=qz+JY.Base["ÖÜÄ¿"]*2
	end		
	--Ì«Ğş£¬Õ½³¡ÏµÊı*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		qz = qz + math.modf(qz*0.4)
	end
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'Æ·µÂ')*0.01
		qz = qz + math.modf(qz*dd)
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÉıÁúÌìÍş'][id] ~= nil then
		qz = qz - 500
	end
	if JY.Status == GAME_WMAP and (WAR.PD['Ò×Ë®ËÄº®'][id] == 1 or WAR.PD['Ò×Ë®ËÄº®'][id] == 5)  then
		qz = qz - psx(id,'±ù·â³Ì¶È')
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÃüÎŞ³£'][id] ~= nil then
		qz = math.modf(qz*0.05)
	end
	if JY.Status == GAME_WMAP and WAR.PD['¾Å½£ÆÆ¾¡'][id] ~= nil and WAR.PD['¾Å½£ÆÆ¾¡'][id] > 0 then
		qz = qz - (WAR.PD['¾Å½£ÆÆ¾¡'][id] or 0) * 9
	end
	if qz < 0 then qz = 0 end
	return qz
end

--ÎŞ¾Æ²»»¶£ºÕæÊµÖ¸·¨ÄÜÁ¦µÄÅĞ¶¨
function TrueZF(id)
    local zf = JY.Person[id]["Ö¸·¨¼¼ÇÉ"]
    
	if JY.Status == GAME_WMAP and JY.Person[id]["ÎäÆ÷"] > 0 and JY.Person[id]["ÎäÆ÷"] ~= 239 then
		local n = JY.Person[id]["ÎäÆ÷"]
		local m = JY.Thing[n]["×°±¸µÈ¼¶"]
		local o = 20
		if NGQH(id,203) then
			o = 40
		end	
		if m >= 2 then
			zf = zf + JY.Thing[n]["¼ÓÖ¸·¨¼¼ÇÉ"]*o
		end
	end
	
    if JY.Status == GAME_WMAP and match_ID(9947,id) then 
        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
            if JY.Wugong[JY.Person[id]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"] == 6 then
                zf = zf + 30
            end
        end
    end
	--½ğË¿ÊÖÌ×
	if JY.Status == GAME_WMAP and JY.Person[id]["ÎäÆ÷"] == 239 then
		local add = 10
		if JY.Thing[239]["×°±¸µÈ¼¶"] >= 5 then
			add = 30
		elseif JY.Thing[239]["×°±¸µÈ¼¶"] >= 4 then
			add = 25
		elseif JY.Thing[239]["×°±¸µÈ¼¶"] >= 3 then
			add = 20
		elseif JY.Thing[239]["×°±¸µÈ¼¶"] >= 2 then
			add = 15
		end
		zf = zf + add
	end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['ËÀÍö'] == false then
				local jid = WAR.Person[j]["ÈËÎï±àºÅ"]
				if psx(jid,"Ö¸·¨¼¼ÇÉ") > a then
					a = psx(jid,"Ö¸·¨¼¼ÇÉ")
				end
			end
		end
		zf = a + JY.Base["ÖÜÄ¿"]*3
	end	
	
	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
			if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == false  then
				df = df +1
			end         	
	    end	
		 zf = zf + df * 5	
	end
	if JY.Status == GAME_WMAP and JY.Base["ÖÜÄ¿"]>0 then
		zf=zf+JY.Base["ÖÜÄ¿"]*2
	end	
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'Æ·µÂ')*0.01
		zf = zf + math.modf(zf*dd)
	end	
	
	--Ì«Ğş£¬Õ½³¡ÏµÊı*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		zf = zf + math.modf(zf*0.4)
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÉıÁúÌìÍş'][id] ~= nil then
		zf = zf - 500
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÃüÎŞ³£'][id] ~= nil then
		zf = math.modf(zf*0.05)
	end
	if JY.Status == GAME_WMAP and WAR.PD['¾Å½£ÆÆ¾¡'][id] ~= nil and WAR.PD['¾Å½£ÆÆ¾¡'][id] > 0 then
		zf = zf - (WAR.PD['¾Å½£ÆÆ¾¡'][id] or 0) * 9
	end
	if zf < 0 then zf = 0 end
	return zf
end

--ÎŞ¾Æ²»»¶£ºÕæÊµÓù½£ÄÜÁ¦µÄÅĞ¶¨
function TrueYJ(id)
	local yj = JY.Person[id]["Óù½£ÄÜÁ¦"]
	
	local o = 20
	if NGQH(id,203) then
		o = 40
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["ÎäÆ÷"] > 0 then
		local n = JY.Person[id]["ÎäÆ÷"]
		local m = JY.Thing[n]["×°±¸µÈ¼¶"]
		if m >= 2 then
			yj = yj + JY.Thing[n]["¼ÓÓù½£ÄÜÁ¦"] * o
		end
	end
	
	--ÎåÔÀ½£·¨
	if JY.Status == GAME_WMAP and WuyueJFSL(id)>0 then
		yj = yj + WuyueJFSL(id)*20
    end
	
	if JY.Status == GAME_WMAP and match_ID(9947,id) then 
        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
            if JY.Wugong[JY.Person[id]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"] == 6 then
                yj = yj + 30
            end
        end
    end
	if JY.Status == GAME_WMAP and JY.Base["ÖÜÄ¿"]>0 then
		yj=yj+JY.Base["ÖÜÄ¿"]*2
	end
	
	
	--Õ½¶·ÖĞµÄ¼Ó³É
	if JY.Status == GAME_WMAP then
		--½£µ¨ÇÙĞÄ
		if WAR.JDYJ[id] then
			yj = yj + WAR.JDYJ[id]
		end
	   	if match_ID(id, 508) then
		   	local df = 0
		   	for j = 0, WAR.PersonNum - 1 do
			   	if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == false  then
				   df = df +1
			   	end           	
	       	end	
			yj = yj + df * 5	
	   	end		
		--²½¾ªÔÆ
        if match_ID(id, 584)  then
		    local JF = 0
		    for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
			    if JY.Wugong[JY.Person[id]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"] == 3 then
				    JF = JF + 1
			    end
		    end
		    yj =yj + JF * 10
	    end
		if YaoFengHuoShi(id) then
			local a = 0
			for j = 0, WAR.PersonNum-1 do
				if WAR.Person[j]['ËÀÍö'] == false then
					local jid = WAR.Person[j]["ÈËÎï±àºÅ"]
					if psx(jid,"Óù½£ÄÜÁ¦") > a then
						a = psx(jid,"Óù½£ÄÜÁ¦")
					end
				end
			end
			yj = a + JY.Base["ÖÜÄ¿"]*3
		end	
		
		--Ì«Ğş£¬Õ½³¡ÏµÊı*140%
		if PersonKF(id, 102) then
			yj = yj + math.modf(yj*0.4)
		end
		if ((PersonKF(id,139) and PersonKF(id,100) and PersonKF(id,154)) or match_ID(id,605)) and WAR.YNSX1 > 0 then
			yj = math.modf(yj*WAR.YNSX1)
		end	
		if ((PersonKF(id,39) and PersonKF(id,100)) or match_ID(id,129) or (match_ID(id,68) and MPPD(id) == 16)) and WAR.QZ_QXJF == 1 then
			yj = math.modf(yj*1.5)
		end
		if  Curr_NG(id,247) and PersonKF(id,242) then
			local dd = psx(id,'Æ·µÂ')*0.01
			yj = yj + math.modf(yj*dd)
		end
		if WAR.PD['ÉıÁúÌìÍş'][id] ~= nil then
			yj = yj - 500
		end
		if WAR.PD['¾Å½£ÆÆ¾¡'][id] ~= nil and WAR.PD['¾Å½£ÆÆ¾¡'][id] > 0 then
			yj = yj - (WAR.PD['¾Å½£ÆÆ¾¡'][id] or 0) * 9
		end
		if WAR.PD['ÃüÎŞ³£'][id] ~= nil then
			yj = math.modf(yj*0.05)
		end
	end
	if yj < 0 then yj = 0 end
	return yj
end

--ÎŞ¾Æ²»»¶£ºÕæÊµË£µ¶ÄÜÁ¦µÄÅĞ¶¨
function TrueSD(id)
	local sd = JY.Person[id]["Ë£µ¶¼¼ÇÉ"]
	local o = 20
	if NGQH(id,203) then
		o = 40
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["ÎäÆ÷"] > 0 then
		local n = JY.Person[id]["ÎäÆ÷"]
		local m = JY.Thing[n]["×°±¸µÈ¼¶"]
		if m >= 2 then
			sd = sd + JY.Thing[n]["¼ÓË£µ¶¼¼ÇÉ"] * o
		end
	end
	
	
    if JY.Status == GAME_WMAP and match_ID(9947,id) then  
        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
            if JY.Wugong[JY.Person[id]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"] == 6 then
                sd = sd + 30
            end
        end
    end
	
	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
		    if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == false  then
				df = df +1
			end         
		end	
		sd = sd + df * 5	
	end	
	if JY.Status == GAME_WMAP and JY.Base["ÖÜÄ¿"]>0 then
		sd=sd+JY.Base["ÖÜÄ¿"]*2
	end
	--Ì«Ğş£¬Õ½³¡ÏµÊı*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		sd = sd + math.modf(sd*0.4)
    end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['ËÀÍö'] == false then
				local jid = WAR.Person[j]["ÈËÎï±àºÅ"]
				if psx(jid,"Ë£µ¶¼¼ÇÉ") > a then
					a = psx(jid,"Ë£µ¶¼¼ÇÉ")
				end
			end
		end
		sd = a + JY.Base["ÖÜÄ¿"]*3
	end	
	if JY.Status == GAME_WMAP and PersonKF(id,335) and PersonKF(id,203) and PersonKF(id,181) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['ËÀÍö'] == false then
				local jid = WAR.Person[j]["ÈËÎï±àºÅ"]
				if psx(jid,"Ë£µ¶¼¼ÇÉ") > a then
					a = psx(jid,"Ë£µ¶¼¼ÇÉ")
				end
			end
		end
		sd = sd + a + JY.Base["ÖÜÄ¿"]*2
	end
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'Æ·µÂ')*0.01
		sd = sd + math.modf(sd*dd)
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÉıÁúÌìÍş'][id] ~= nil then
		sd = sd - 500
	end
	if JY.Status == GAME_WMAP and WAR.PD['±ÙºèÃÉ'][id] ~= nil and WAR.PD['±ÙºèÃÉ'][id] > 0 then
		sd = sd - (WAR.PD['±ÙºèÃÉ'][id] or 0) * 100
	end
	if JY.Status == GAME_WMAP and (WAR.PD['Ò×Ë®ËÄº®'][id] == 1 or WAR.PD['Ò×Ë®ËÄº®'][id] == 5)  then
		sd = sd - psx(id,'±ù·â³Ì¶È')
	end	
	if JY.Status == GAME_WMAP and WAR.PD['¾Å½£ÆÆ¾¡'][id] ~= nil and WAR.PD['¾Å½£ÆÆ¾¡'][id] > 0 then
		sd = sd - (WAR.PD['¾Å½£ÆÆ¾¡'][id] or 0) * 9
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÃüÎŞ³£'][id] ~= nil then
		sd = math.modf(sd*0.05)
	end
	if sd < 0 then sd = 0 end
	return sd
end

--ÎŞ¾Æ²»»¶£ºÕæÊµÌØÊâÄÜÁ¦µÄÅĞ¶¨
function TrueTS(id)
	local ts = JY.Person[id]["ÌØÊâ±øÆ÷"]
	local o = 20
	if NGQH(id,203) then
		o = 40
	end
	if JY.Status == GAME_WMAP and JY.Person[id]["ÎäÆ÷"] > 0 then
		local n = JY.Person[id]["ÎäÆ÷"]
		local m = JY.Thing[n]["×°±¸µÈ¼¶"]
		if m >= 2 then
			ts = ts + JY.Thing[n]["¼ÓÌØÊâ±øÆ÷"]*o
		end
	end
	
    if JY.Status == GAME_WMAP and match_ID(9947,id) then
        for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
            if JY.Wugong[JY.Person[id]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"] == 6 then
                ts = ts + 30
            end
        end
    end
	if JY.Status == GAME_WMAP and YaoFengHuoShi(id) then
		local a = 0
		for j = 0, WAR.PersonNum-1 do
			if WAR.Person[j]['ËÀÍö'] == false then
				local jid = WAR.Person[j]["ÈËÎï±àºÅ"]
				if psx(jid,"ÌØÊâ±øÆ÷") > a then
					a = psx(jid,"ÌØÊâ±øÆ÷")
				end
			end
		end
		ts = a + JY.Base["ÖÜÄ¿"]*3
	end	
	if JY.Status == GAME_WMAP and match_ID(id, 508) then
		local df = 0
		for j = 0, WAR.PersonNum - 1 do
		    if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == false then
				   df = df +1
			   end          	
	       end
        ts = ts + df * 5		
	end
	if JY.Status == GAME_WMAP and JY.Base["ÖÜÄ¿"]>0 then
		ts=ts+JY.Base["ÖÜÄ¿"]*2
	end	
	if JY.Status == GAME_WMAP and Curr_NG(id,247) and PersonKF(id,242) then
		local dd = psx(id,'Æ·µÂ')*0.01
		ts = ts + math.modf(ts*dd)
	end
	--Ì«Ğş£¬Õ½³¡ÏµÊı*140%
	if JY.Status == GAME_WMAP and PersonKF(id, 102) then
		ts = ts + math.modf(ts*0.4)
    end
	if JY.Status == GAME_WMAP and WAR.PD['ÉıÁúÌìÍş'][id] ~= nil then
		ts = ts - 500
	end
	if JY.Status == GAME_WMAP and WAR.PD['¾Å½£ÆÆ¾¡'][id] ~= nil and WAR.PD['¾Å½£ÆÆ¾¡'][id] > 0 then
		ts = ts - (WAR.PD['¾Å½£ÆÆ¾¡'][id] or 0) * 9
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÃüÎŞ³£'][id] ~= nil then
		ts = math.modf(ts*0.05)
	end
	if JY.Status == GAME_WMAP and WAR.PD['ÄÏ×ÓÁÇÔ­Ç¹'][id] == 3 then
		ts = 6666
	end	
	if ts < 0 then ts = 0 end
	return ts
end

--Ëæ·çÆ®Ò¶ µ÷Õû¶ÓÓÑË³Ğò
function Menu_TZDY()
   local menu = {}
   local px={}
   local m=0
   --¶ÓÓÑ³¬¹ı2ÈË²Å»áÉúĞ§
   if JY.Base["¶ÓÎé" .. 3]>0 then
		Cls()
		DrawStrBox(CC.MainMenuX,CC.MainSubMenuY,"ĞèÒªµ÷ÕûË­µÄÎ»ÖÃ",LimeGreen,CC.DefaultFont,C_GOLD);
		local nexty=CC.MainSubMenuY+CC.SingleLineHeight;
		for i=1,CC.TeamNum do
			menu[i]={"",nil,0};
			local id=JY.Base["¶ÓÎé" .. i]
			if id>0 then
				menu[i]={"",nil,0};
				if JY.Person[id]["ÉúÃü"]>0 then
					menu[i][1]=JY.Person[id]["ĞÕÃû"];
					menu[i][3]=1;
				end
			end
		end  
   
		local r = -1;
		while true do
			r = ShowMenu(menu,#menu,0,CC.MainMenuX,CC.MainSubMenuY+CC.SingleLineHeight,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE)
			if px["½»»»ÈË"]==nil and r>1 then
				px["½»»»ÈË"]=r
				menu[r]={"",nil,0}
				Cls()
				DrawStrBox(CC.MainMenuX,CC.MainSubMenuY,JY.Person[JY.Base["¶ÓÎé" .. r]]["ĞÕÃû"].."ºÍË­½»»»Î»ÖÃ",LimeGreen,CC.DefaultFont,C_GOLD);
			elseif r>1 and px["½»»»ÈË"]~=nil and r ~=px["½»»»ÈË"] then	
				local m1=JY.Base["¶ÓÎé" .. r]
				local m2=JY.Base["¶ÓÎé" .. px["½»»»ÈË"]]
				JY.Base["¶ÓÎé" .. r]=m2
				JY.Base["¶ÓÎé" .. px["½»»»ÈË"]]=m1
				say("£Ç"..JY.Person[m2]["ĞÕÃû"].."£× ºÍ £Ç"..JY.Person[m1]["ĞÕÃû"].."£× ½»»»ÁËÎ»ÖÃ¡£",m2,1)
				Cls()
				--return
				break
			--ÎŞ¾Æ²»»¶£ºÔö¼ÓESCÍË³ö¹¦ÄÜ
			else
				break
			end
		end
	end
end

--ÎŞ¾Æ²»»¶£º»­Ò»ÌõÏß
function DrawSingleLine(x1, y1, x2, y2, color)
	lib.DrawRect(x1 + 1, y1 + 1, x2, y2, color)
	lib.DrawRect(x1, y1, x2 - 1, y2 - 1, color)
end

--¸Ä±äÌìÍâ
function SetTianWai(personid, x, wugongid)
	--local r = JYMsgBox("Ï´Ìì¸³Íâ¹¦","ÊÇ·ñÒªÏ´Ìì¸³Íâ¹¦"..x.."Îª"..JY.Wugong[wugongid]["Ãû³Æ"].."£¿", {"ÊÇ","·ñ"}, 2, 189)				
	--if r == 1 then
		JY.Person[personid]["Ìì¸³Íâ¹¦"..x] = wugongid
		if personid == JY.Base["³©Ïë"] then
			JY.Person[0]["Ìì¸³Íâ¹¦"..x] = wugongid
		end	
	--elseif r == 2 then
	--end
end

--¸Ä±äÌìÄÚ
function SetTianNei(personid, wugongid)
	JY.Person[personid]["Ìì¸³ÄÚ¹¦"] = wugongid
	if personid == JY.Base["³©Ïë"] then
		JY.Person[0]["Ìì¸³ÄÚ¹¦"] = wugongid
	end	
end

--¸Ä±äÌìÇá
function SetTianQing(personid, wugongid)
	JY.Person[personid]["Ìì¸³Çá¹¦"] = wugongid
	if personid == JY.Base["³©Ïë"] then
		JY.Person[0]["Ìì¸³Çá¹¦"] = wugongid
	end	
end

--Ñ§»á»¥²«
function SetHuBo(personid)
	JY.Person[personid]["×óÓÒ»¥²«"] = 1
	if personid == JY.Base["³©Ïë"] and personid~=152 then
		JY.Person[0]["×óÓÒ»¥²«"] = 1
	end
end

--¼ÆËãÈËÎïÈıÎ§Ö®ºÍ£¨³¯Í¢ÅĞ¶¨£©
function Sanwei_sum(id)
	local sum = 0
	sum = sum + JY.Person[id]["Çá¹¦"]
	sum = sum + JY.Person[id]["·ÀÓùÁ¦"]
	sum = sum + JY.Person[id]["¹¥»÷Á¦"]
	return sum
end

--¼ÆËãÈËÎïÎåÏµ±øÆ÷ÖµÖ®ºÍ
function Xishu_sum(id)
	local sum = 0
	sum = sum + TrueQZ(id)
	sum = sum + TrueZF(id)
	sum = sum + TrueYJ(id)
	sum = sum + TrueSD(id)
	sum = sum + TrueTS(id)
	return sum
end

--ÇóÈËÎïÎåÏµ±øÆ÷Öµ×î¸ßµÄÒ»Ïî
function Xishu_max(id)
	local m = 0
	local xishu = {TrueQZ,TrueZF,TrueYJ,TrueSD,TrueTS}
	for i = 1, #xishu do
		local x = xishu[i](id)
		if x > m then
			m = x
		end
	end
	return m
end

--¼ô²Ã°æ±³¾°Í¼
function Clipped_BgImg(x1,y1,x2,y2,picnum)
	lib.SetClip(x1 + 2, y1 + 2, x2 - 1, y2 - 1)
	lib.LoadPNG(1, picnum * 2 , 0 , 0, 1)
	lib.SetClip(0,0,0,0)
end

--ÏÔÊ¾´ø±ß¿òµÄÎÄ×Ö
function DrawBoxTitle(width, height, str, color)
	local s = 4
	local x1, y1, x2, y2, tx1, tx2 = nil, nil, nil, nil, nil, nil
	local fontsize = s + CC.DefaultFont
	local len = string.len(str) * fontsize / 2
	x1 = (CC.ScreenW - width) / 2
	x2 = (CC.ScreenW + width) / 2
	y1 = (CC.ScreenH - height) / 2
	y2 = (CC.ScreenH + height) / 2
	tx1 = (CC.ScreenW - len) / 2
	tx2 = (CC.ScreenW + len) / 2
	lib.Background(x1, y1 + s, x1 + s, y2 - s, 128)
	lib.Background(x1 + s, y1, x2 - s, y2, 128)
	lib.Background(x2 - s, y1 + s, x2, y2 - s, 128)
	lib.Background(tx1, y1 - fontsize / 2 + s, tx2, y1, 128)
	lib.Background(tx1 + s, y1 - fontsize / 2, tx2 - s, y1 - fontsize / 2 + s, 128)
	local r, g, b = GetRGB(color)
	DrawBoxTitle_sub(x1 + 1, y1 + 1, x2, y2, tx1 + 1, y1 - fontsize / 2 + 1, tx2, y1 + fontsize / 2, RGB(math.modf(r / 2), math.modf(g / 2), math.modf(b / 2)))
	DrawBoxTitle_sub(x1, y1, x2 - 1, y2 - 1, tx1, y1 - fontsize / 2, tx2 - 1, y1 + fontsize / 2 - 1, color)
	DrawString(tx1 + 2 * s, y1 - (fontsize - s) / 2, str, color, CC.DefaultFont)
end

--»æÖÆÒ»Æ¬ËÄ½Ç°¼½øµÄ±³¾°
function DrawShades(x1,y1,x2,y2,color)
	local s=4;
	lib.Background(x1+4,y1,x2-4,y1+s,128,color);
	lib.Background(x1+1,y1+1,x1+s,y1+s,128,color);
	lib.Background(x2-s,y1+1,x2-1,y1+s,128,color);
	lib.Background(x1,y1+4,x2,y2-4,128,color);
	lib.Background(x1+1,y2-s,x1+s,y2-1,128,color);
	lib.Background(x2-s,y2-s,x2-1,y2-1,128,color);
	lib.Background(x1+4,y2-s,x2-4,y2,128,color);
end

--ÎïÆ·ÏêÏ¸ËµÃ÷
function detailed_info(thingID)
	local str=JY.Thing[thingID]["´úºÅ"] .. JY.Thing[thingID]["Ãû³Æ"]
	local str2=JY.Thing[thingID]["ÎïÆ·ËµÃ÷"]
	local str3=JY.Thing[thingID]["Ãû³Æ"]	
	if ItemInfo[thingID]==nil then
		return
	end
	local info = {}
	info = ItemInfo[thingID]
	local function strcolor_switch(s)
		local Color_Switch={{"£Ò",PinkRed},{"£Ç",C_GOLD},{"£Â",C_BLACK},{"£×",C_WHITE},{"£Ï",C_ORANGE},{"£Ì",LimeGreen},{"£Ä",M_DeepSkyBlue},{"£Ú",Violet}}
		for i = 1, 8 do
			if Color_Switch[i][1] == s then
				return Color_Switch[i][2]
			end
		end
	end
	local maxRowExisting = #info		--µ±Ç°ËµÃ÷×ÜĞĞÊı
	local maxRowDisplayable = 7		--µ±ÃæÒ³Ãæ¿ÉÒÔÏÔÊ¾µÄ×î´óĞĞÊı
	if maxRowDisplayable > maxRowExisting-1 then
		maxRowDisplayable = maxRowExisting -1 
	end
	local startingRow = 1
	local size = CC.Fontsmall
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls()
		lib.LoadPNG(91, 30 * 2 , 0 , 0, 1)
		DrawString(CC.ScreenW/2,14.5,str3,C_GOLD,CC.ThingFontSize)
		DrawString(22,64.5,str2,C_ORANGE,CC.ThingFontSize)
		local row = 1
		for i = startingRow, startingRow+maxRowDisplayable do
			local tfstr = info[i]
			if string.sub(tfstr,1,2) == "£Î"  then
				row = row + 0.5
			else
				if string.sub(tfstr,1,2) == "£×" then
					row = row +0.5
				end	
				local color;
				color = strcolor_switch(string.sub(tfstr,1,2))
				tfstr = string.sub(tfstr,3,-1)
				--DrawString(22, 80 + (size+CC.RowPixel*2) * (row), tfstr, color, size)
				tjm(22,80 + ((size*1)+CC.RowPixel*2) * (row),tfstr,color, size,45,size+3)
				--F1
				row = row + 1
			end
		end
		
		--²é¿´Ì××°
		if thingID > 547 then
			local n = (thingID - 547)%3
			--say("nµÄÖµÎª"..n,0,1)
			if n == 1 then
				n = 0
			elseif n==2 then
				n=1
			else
				n=2
			end
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+1), Xguo[Setmeal[thingID-n][4]], M_YellowGreen, size)
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+2), FJXguo[Setmeal[thingID-n][5]], M_YellowGreen, size)
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+3), ZqXguo[Setmeal[thingID-n][6]], M_YellowGreen, size)	
			DrawString(22, 80 + (size+CC.RowPixel*2) * (row+4), CC.PTFSM[Setmeal[thingID-n][7]][2], C_RED, size)	

			
		end
		
		
		--ÉÏÏÂ·­µÄ¼ıÍ·ÏÔÊ¾
		if startingRow > 1 then
			DrawString(CC.ScreenW-40, 110, "¡ü", C_GOLD, size)
		end
		if startingRow+maxRowDisplayable < maxRowExisting then
			DrawString(CC.ScreenW-40, CC.ScreenH-140, "¡ı", C_GOLD, size)
		end
		DrawString(CC.ScreenW-220,CC.ScreenH-40, "°´F1·µ»ØÎïÆ·²Ëµ¥", C_ORANGE,size)
		ShowScreen()
		local keypress, ktype, mx, my = WaitKey(1)
		if keypress==VK_ESCAPE or keypress==VK_RETURN or keypress==VK_F1 or ktype == 4 then
			return
		elseif keypress==VK_UP and startingRow > 1 then
			startingRow = startingRow - 1
		elseif keypress==VK_DOWN and startingRow+maxRowDisplayable < maxRowExisting then
			startingRow = startingRow + 1
		end
	end
end

--ÃÅÅÉËµÃ÷
function mp_info(MPID)
	-- local str=JY.Thing[thingID]["´úºÅ"] .. JY.Thing[thingID]["Ãû³Æ"]
	-- local str2=JY.Thing[thingID]["ÎïÆ·ËµÃ÷"]
	-- local str3=JY.Thing[thingID]["Ãû³Æ"]	
	-- if ItemInfo[thingID]==nil then
		-- return
	-- end
	--local info = {}
	--info = ItemInfo[thingID]
	-- local function strcolor_switch(s)
		-- local Color_Switch={{"£Ò",PinkRed},{"£Ç",C_GOLD},{"£Â",C_BLACK},{"£×",C_WHITE},{"£Ï",C_ORANGE},{"£Ì",LimeGreen},{"£Ä",M_DeepSkyBlue},{"£Ú",Violet}}
		-- for i = 1, 8 do
			-- if Color_Switch[i][1] == s then
				-- return Color_Switch[i][2]
			-- end
		-- end
	-- end
	-- local maxRowExisting = #info		--µ±Ç°ËµÃ÷×ÜĞĞÊı
	-- local maxRowDisplayable = 11		--µ±ÃæÒ³Ãæ¿ÉÒÔÏÔÊ¾µÄ×î´óĞĞÊı
	-- if maxRowDisplayable > maxRowExisting-1 then
		-- maxRowDisplayable = maxRowExisting-1
	-- end
	-- local startingRow = 1
	--local Color_Switch={{"£Ò",PinkRed},{"£Ç",C_GOLD},{"£Â",C_BLACK},{"£×",C_WHITE},{"£Ï",C_ORANGE},{"£Ì",LimeGreen},{"£Ä",M_DeepSkyBlue},{"£Ú",Violet}}
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768 
	local size = CC.Fontsmall
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls()
		lib.LoadPNG(91, 30 * 2 , 0 , 0, 1)
		DrawString(CC.ScreenW/2,14.5,"ÃÅÅÉËµÃ÷",C_GOLD,CC.ThingFontSize)
		--DrawString(22,64.5,"ÃÅÅÉÏÔÊ¾",C_ORANGE,CC.ThingFontSize)
		DrawString(22,64.5,CC.MP[MPID][1],C_ORANGE,CC.ThingFontSize)
		DrawString(22,64.5+25,"ÃÅÅÉ½éÉÜ",C_ORANGE,CC.ThingFontSize)
		
		local zsqg = "£Ç"..CC.MPINFO[MPID]		
		tjm(22,64.5+50,zsqg,C_WHITE,size,33,size)
		
		DrawString(22,64.5+50+80,"ÃÅÅÉÎ»½×",C_ORANGE,CC.ThingFontSize)
		-- DrawString(22,64.5+50+200,CC.MPDJ[MPID][1],C_ORANGE,CC.ThingFontSize)
		-- DrawString(22+120,64.5+50+200,CC.MPDJ[MPID][2],C_ORANGE,CC.ThingFontSize)
		-- DrawString(22+240,64.5+50+200,CC.MPDJ[MPID][3],C_ORANGE,CC.ThingFontSize)
		for i=1,#CC.MPDJ[MPID] do 
			DrawString(22+(i-1)*120,64.5+50+110,CC.MPDJ[MPID][i],M_DeepSkyBlue,CC.ThingFontSize)
		end
		
		--DrawString(22,64.5+50+250,"ÈëÃÅÌõ¼ş",C_ORANGE,CC.ThingFontSize)
		DrawString(22,64.5+50+140,CC.MPSUBMENU[MPID],PinkRed,CC.ThingFontSize*0.8)
		--tjm(22,64.5+50+140,CC.MPSUBMENU[MPID],C_WHITE,size,45,size)
		--DrawString(22,64.5+50+150,"ÈëÃÅÌõ¼ş",C_ORANGE,CC.ThingFontSize)
		
		--CC.MPDJ
		--DrawString(22,64.5+50+380,"¼ÓÈëÃÅÅÉÊôĞÔ £º"..CC.MPINFO2[MPID],C_ORANGE,CC.ThingFontSize)
		local zsqg = "£ÌÃÅÅÉÊôĞÔ £º"..CC.MPINFO2[MPID]
		tjm(22,64.5+50+170,zsqg,C_WHITE,size*0.8,45,size)
		DrawString(22,64.5+50+210,"¼¼ÄÜ½éÉÜ",C_ORANGE,CC.ThingFontSize)
		for i = 1,#CC.SKILLNAME[MPID] do
			local zsqg = "£Ç"..CC.SKILLNAME[MPID][i].." "..CC.SKILLINFO[MPID][i]
			tjm(22,64.5+50+250+(i-1)*50,zsqg,C_WHITE,size*0.8,45,size)
		end
		-- CC.MP
		-- local row = 1
		-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row+1), Xguo[Setmeal[thingID-n][4]], M_YellowGreen, size)
		-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row+2), FJXguo[Setmeal[thingID-n][5]], M_YellowGreen, size)
		-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row+3), ZqXguo[Setmeal[thingID-n][6]], M_YellowGreen, size)	
		
		-- local row = 1
		-- for i = startingRow, startingRow+maxRowDisplayable do
			-- local tfstr = info[i]
			-- if string.sub(tfstr,1,2) == "£Î" then
				-- row = row + 1
			-- else
				-- local color;
				-- color = strcolor_switch(string.sub(tfstr,1,2))
				-- tfstr = string.sub(tfstr,3,-1)
				-- DrawString(22, 80 + (size+CC.RowPixel*2) * (row), tfstr, color, size)
				-- row = row + 1
			-- end
		-- end
		
		--²é¿´Ì××°
		 --if thingID > 547 then
			-- local n = (thingID - 547)%3
			-- --say("nµÄÖµÎª"..n,0,1)
			 --if n == 1 then
				-- n = 0
			 --elseif n==2 then
				-- n=1
			 --else
				-- n=2
			 --end
			 --DrawString(22, 80 + (size+CC.RowPixel*2) * (row+1), Xguo[Setmeal[thingID-n][4]], M_YellowGreen, size)
			 --DrawString(22, 80 + (size+CC.RowPixel*2) * (row+2), FJXguo[Setmeal[thingID-n][5]], M_YellowGreen, size)
			 --DrawString(22, 80 + (size+CC.RowPixel*2) * (row+3), ZqXguo[Setmeal[thingID-n][6]], M_YellowGreen, size)			
		 --end
		
		
		--ÉÏÏÂ·­µÄ¼ıÍ·ÏÔÊ¾
		-- if startingRow > 1 then
			-- DrawString(CC.ScreenW-40, 110, "¡ü", C_GOLD, size)
		-- end
		-- if startingRow+maxRowDisplayable < maxRowExisting then
			-- DrawString(CC.ScreenW-40, CC.ScreenH-140, "¡ı", C_GOLD, size)
		-- end
		-- DrawString(CC.ScreenW-220,CC.ScreenH-40, "°´F1·µ»ØÎïÆ·²Ëµ¥", C_ORANGE,size)
		ShowScreen()
		local keypress, ktype, mx, my = WaitKey(1)
		if keypress==VK_ESCAPE or keypress==VK_RETURN or keypress==VK_F1 or ktype == 4 then
			return
		elseif keypress==VK_UP and MPID > 1 then
			MPID = MPID - 1
		elseif keypress==VK_DOWN and MPID+1 <= #CC.MP then
			MPID = MPID + 1
		end
	end
end

--»»×°
function Avatar_Switch(id)
	--ÅĞ¶ÏÊÇ·ñ³©Ïë
	local Ani_id = id
	if id == 0 and JY.Base["³©Ïë"] > 0 then
		Ani_id = JY.Base["³©Ïë"]
	end
	if Avatar[Ani_id] == nil then
		return
	end
	local r = JYMsgBox("Ò»¼ü»»×°", "ÇëÑ¡Ôñ"..JY.Person[id]["ĞÕÃû"].."µÄÔìĞÍ", {Avatar[Ani_id][1].name,Avatar[Ani_id][2].name}, #Avatar[Ani_id], JY.Person[104]["Í·Ïñ´úºÅ"])
	JY.Person[id]["Í·Ïñ´úºÅ"] = Avatar[Ani_id][r].num
	JY.Person[id]["°ëÉíÏñ"] = Avatar[Ani_id][r].num2
	for i = 1, 5 do
		JY.Person[id]["³öÕĞ¶¯»­Ö¡Êı" .. i] = Avatar[Ani_id][r].frameNum[i]
		JY.Person[id]["³öÕĞ¶¯»­ÑÓ³Ù" .. i] = Avatar[Ani_id][r].frameDelay[i]
		JY.Person[id]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i] = Avatar[Ani_id][r].soundDelay[i]
	end
end

function Teammember_View()

	local choice = 1

	while true do
		if JY.Restart == 1 then
			return
		end
		Cls()
		
		lib.LoadPNG(96, 1 * 2 , 0, 0, 1)
		
		local x = 8
		for i = 1, 5 do
			if choice ~= i then
				lib.SetClip(x + 10, CC.ScreenH-579 + 13, x + 184 -10, CC.ScreenH-579 + 575)
				lib.LoadPNG(95, i * 2 , x - 90, CC.ScreenH-579, 1)
				
				local h = 494
				local space = 35
				local color = C_WHITE
				
				local indent = 0
				
				if string.len(JY.Person[i]["ĞÕÃû"]) == 8 then
					indent = 29
				elseif string.len(JY.Person[i]["ĞÕÃû"]) == 6 then
					indent = 14
				end
				
				DrawString(x + 61 - indent, h, JY.Person[i]["ĞÕÃû"],color,CC.DefaultFont)
				h = h + space
				
				DrawString(x + 58, h, "LV."..JY.Person[i]["µÈ¼¶"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "¹¥»÷ "..JY.Person[i]["¹¥»÷Á¦"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "·ÀÓù "..JY.Person[i]["·ÀÓùÁ¦"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "Çá¹¦ "..JY.Person[i]["Çá¹¦"],color,CC.Fontsmall)
				h = h + space
			end
			x = x + 184
		end
		
		lib.SetClip(0,0,0,0)
		
		x = 8
		for i = 1, 5 do
			if choice == i then
				lib.LoadPNG(96, 3 * 2 , x, CC.ScreenH-579, 1)
			else
				lib.LoadPNG(96, 2 * 2 , x, CC.ScreenH-579, 1)
			end
			x = x + 184
		end
		
		x = 8
		for i = 1, 5 do
			if choice == i then
				lib.SetClip(x + 10, CC.ScreenH-579 + 13, x + 184 -10, CC.ScreenH-579 + 575)
				lib.LoadPNG(95, i * 2 , x - 90, CC.ScreenH-579, 1)
				
				local h = 494
				local space = 35
				local color = LightYellow2
				
				local indent = 0
				
				if string.len(JY.Person[i]["ĞÕÃû"]) == 8 then
					indent = 29
				elseif string.len(JY.Person[i]["ĞÕÃû"]) == 6 then
					indent = 14
				end
				
				DrawString(x + 61 - indent, h, JY.Person[i]["ĞÕÃû"],color,CC.DefaultFont)
				h = h + space
				
				DrawString(x + 58, h, "LV."..JY.Person[i]["µÈ¼¶"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "¹¥»÷ "..JY.Person[i]["¹¥»÷Á¦"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "·ÀÓù "..JY.Person[i]["·ÀÓùÁ¦"],color,CC.Fontsmall)
				h = h + space
				
				DrawString(x + 41, h, "Çá¹¦ "..JY.Person[i]["Çá¹¦"],color,CC.Fontsmall)
				h = h + space
			end
			x = x + 184
		end
		
		local keypress, ktype, mx, my = lib.GetKey()
		
		if keypress == VK_LEFT then
			choice = choice - 1
		elseif keypress == VK_RIGHT then
			choice = choice + 1
		end
		
		ShowScreen()
		lib.Delay(CC.Frame)

	end
	
end

--ÖĞÓ¹Ö®µÀ
function ZhongYongZD1(id)
    if JY.Person[id]["ÖĞÓ¹"] == 1 then
		return true
	end
	if JY.Person[id]["ÖĞÓ¹"] == 3 then
		return true
	end
	--[[if match_ID(id,524) then
		return true
	end]]
	if match_ID(id,189) then
		return true
	end
	return false
end
function ZhongYongZD2(id)
    if JY.Person[id]["ÖĞÓ¹"] == 2 then
		return true
	end
	--[[if match_ID(id,524) then
		return true
	end]]
	if JY.Person[id]["ÖĞÓ¹"] == 3 then
		return true
	end
	return false
end
--¶·×ª
function MuRongDZ(id)
    if JY.Person[id]["ÃÅÅÉ¼¼ÄÜ3"] > 0 then
        return true
    end
	if match_ID(id,51) or match_ID(id,113) or match_ID(id,529) or match_ID(id,679) or match_ID(id,783) then
		return true
	end
    return false
end
--×óÓÒ
function ZYHBPD(id)
	local s = 0
	if JY.Person[id]['×óÓÒ»¥²«'] == 2 or match_ID(id,64) then
		s = 2
	elseif JY.Person[id]['×óÓÒ»¥²«'] == 1 then
		s = 1
	end	
	return s
end
--Ñ¡ÔñÕÅ¼Ò»ÔµÄÃØ¼®
--ÉÏÉÏÏÂÏÂ×óÓÒ×óÓÒBABA
function YC_ZhangJiaHui(key)
	local up,down,left,right = VK_UP, VK_DOWN, VK_LEFT, VK_RIGHT
	local A,B = VK_A, VK_B
	local sequence = {up,up,down,down,left,right,left,right,B,A,B,A}
	if key == sequence[YC.ZJH + 1] then
		YC.ZJH = YC.ZJH + 1
	else
		YC.ZJH = 0
	end
end

function ZmShop()
    local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*1.5
	local size1 = CC.DefaultFont*0.7
	local size2 = CC.DefaultFont*0.8
	local cont = 1 
	local cont1 = 0
	local cont2 = 0
	local jg = bx*4
    local page = 1
    local pc = 50
    local pc1 = 50
    local pc2 = 60
    local m_left = JY.Base["ËéÆ¬"]
	local t_price = 0
	while true do 
		Cls()
        lib.LoadPNG(91, 10 * 2 , 0, 0, 1)
		for i = 1,5 do  -- ºá¸ñ
			for j = 1,5 do  --Êú¸ñ
				local cl = 6  -- £¿
				local col = C_GOLD --ÑÕÉ«
				local p = i + (j-1+cont2)*14 
				local zx = bx*455+(i-1)*(bx*100+jg)-50
				local zy = by*144+(j-1)*(by*100+jg)-50
				if cont+cont1*5 == p then
					cl = 2
					col = C_WHITE
                end
                if page == 1 then 
                    cl = 2
                end
				if CC.commodity[p] ~= nil then
					local plx = CC.commodity[p]
					local pic = plx[1]
                    lib.PicLoadCache(2, pic * 2, zx,zy, cl,256)
                    if page == 1 and cont+cont1*5 == p then 
                        lib.LoadPNG(91, pc * 2 , zx+50,zy+50, 2)
                        pc = pc + 1
                        if pc > pc2 then 
                            pc = pc1
                        end
					end
							
                    --DrawString(zx+bx*30-string.len(plx[5])*size1+size1,zy-by*45,plx[5], C_WHITE, size1)
                    --if page == 2 and cont+cont1*5 == p then
                        --DrawString(zx+bx*30-string.len(plx[3])*size1+size1,zy+by*25,plx[3], C_WHITE, size1)
                    --end
				end	
			end
		end

        if CC.commodity[cont+cont1*5] ~= nil then
            local plx = CC.commodity[cont+cont1*5]
            local pic = plx[1]
            --
            --DrawString(bx*405,by*640-size2,JY.Thing[pic]['ÎïÆ·ËµÃ÷'], C_ORANGE, size2)
            DrawString(bx*405,by*638-size1,plx[4], C_WHITE, size1)
            DrawString(bx*405,by*663-size1,'µ±Ç°ÊıÁ¿£º'..plx[5], C_WHITE, size1)
            DrawString(bx*405,by*688-size1,'¹ºÂòÊıÁ¿£º'..plx[3], C_WHITE, size1)
        end
        lib.Background(bx*70, by*520, bx*300,by*650, 150)
        DrawString(bx*80,by*550-size2,'¼Û¸ñ:'..CC.commodity[cont+cont1*5][2], C_WHITE, size2)
        DrawString(bx*80,by*580-size2,'×Ü¶î:'..JY.Base["ËéÆ¬"], C_WHITE, size2)
        DrawString(bx*80,by*610-size2,'»¨·Ñ:'..t_price, C_WHITE, size2)
        DrawString(bx*80,by*640-size2,'Óà¶î:'..m_left, C_WHITE, size2)


		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
            if page == 1 then 
                page = 2
            else 
                JY.Base["ËéÆ¬"] = m_left
                CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                CC.commodity[cont+cont1*5][3] = 0
                page = 1
            end
        elseif X == VK_ESCAPE or ktype == 4 then
            CC.commodity[cont+cont1*5][3] = 0
            if page == 2 then 
                page = 1 
            else     
                break
            end
		elseif X == VK_UP then
			if cont1 > 0 then
				if cont1 == cont2 then
					cont2 = limitX(cont2 - 1,0)
				end
				cont1 = cont1 - 1
			else 
				cont = 1
			end
		elseif X == VK_DOWN then
			if cont + cont1*5 < #CC.commodity then
				if cont1 < math.ceil(#CC.commodity/5) - 1 then 
					cont1 = cont1 + 1 
					if cont + cont1*5 > #CC.commodity then
						cont = #CC.commodity - cont1*5
					end
				else 
					cont = #CC.commodity - cont1*5
				end
				if cont1 - cont2 > 4 then
					cont2 = cont2 + 1
				end
			end
        elseif X == VK_LEFT or ktype == 6 then
            if page == 1 then 
                cont = cont - 1 
                if cont1 > 0 then 
                    if cont < 1 then
                        if cont1 == cont2 then
                            cont2 = limitX(cont2 - 1,0)
                        end
                        cont1 = cont1 - 1
                        cont = 5
                    end
                elseif cont < 1 then 
                    cont = 1
                end
            else 
                if CC.commodity[cont+cont1*5][3] > 0 then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] - 1
                    m_left = m_left + CC.commodity[cont+cont1*5][2]
                    t_price = t_price - CC.commodity[cont+cont1*5][2]
                end
            end
        elseif X == VK_RIGHT or ktype == 7 then
            if page == 1 then 
                if cont + cont1*5 < #CC.commodity then
                    cont = cont + 1
                    if cont > 5 then
                        if cont1 < math.ceil(#CC.commodity/5) - 1 then 
                            cont = 1 
                            cont1 = cont1 + 1
                        end	
                    end
                    if cont1 - cont2 > 4 then
                        cont2 = cont2 + 1
                    end
                end
            else 
                if m_left >= CC.commodity[cont+cont1*5][2] then
                    CC.commodity[cont+cont1*5][3] = CC.commodity[cont+cont1*5][3] + 1
                    m_left = m_left - CC.commodity[cont+cont1*5][2]
                    t_price = t_price + CC.commodity[cont+cont1*5][2]
                end
            end
		else 
			local mxx = false
			for i = 1,5 do 
				for j = 1,5 do
                    if mx >= bx*405+(i-1)*(bx*100+jg) and mx <= bx*505+(i-1)*(bx*100+jg) and 
                        my >= by*94+(j-1)*(by*100+jg) and my <= by*194+(j-1)*(by*100+jg) then 
                        local p = i + (j-1+cont2)*14
                        if CC.commodity[p] ~= nil then
							cont = i 
							cont1 = j - 1 + cont2
							mxx = true 
							break
                        end	
                    end
				end
			end	
			if ktype == 3 and mxx == true then 
                if page == 1 then 
                    page = 2
                else 
                    JY.Base["ËéÆ¬"] = m_left
                    CC.commodity[cont+cont1*5][5] = CC.commodity[cont+cont1*5][5] + CC.commodity[cont+cont1*5][3]
                    CC.commodity[cont+cont1*5][3] = 0
                    page = 1
                end
			end
		end
	end
end

--ÖÜÄ¿ÉÌµê
function zmStore()
	dofile(CC.Acvmts)
	local mrchds = {}
	for i = 1, 4 do
		mrchds[i] = {}
		mrchds[i].num = 0
	end
	mrchds[1].name = "ÌìÄÚµ¤"
	mrchds[1].price = 600
	mrchds[2].name = "ÌìÇáµ¤"
	mrchds[2].price = 900
	mrchds[3].name = "ÌìÍâµ¤"
	mrchds[3].price = 600
	mrchds[4].name = "ËÄ´óÉ½Æ¤·ô"
	mrchds[4].price = 500
	--mrchds[5].name = "ĞşÔªµ¤"
	--mrchds[5].price = 300
	--mrchds[6].name = "ÎŞ¼«µ¤"
	--mrchds[6].price = 500
	local choice = 1
	local t_price = 0
	local m_left = CC.Sp

	while true do
		if JY.Restart == 1 then
			return
		end
		Cls()
		lib.LoadPNG(91, 10 * 2 , 0, 0, 1)
		for i = 1, #CC.commodity do
			local th = CC.commodity[i]
			local thname = JY.Thing[th[1]]['Ãû³Æ']
			local price = th[2]
			local num = th[3]
			local sm = th[4]
			local t_color = C_WHITE
			if i == choice then
				t_color = C_GOLD
			end
			lib.LoadPNG(91, 24 * 2 , 65, 115+40*(i-1), 1)
			DrawString(80,122+40*(i-1),string.format("%-14s %-8s %-6s %-6s %-6s",thname, price, th[5], num,sm),t_color,CC.DefaultFont*0.9)
		end
		
		DrawString(80,CC.ScreenH - 107,string.format("%-6s %-6s %-6s %-6s","×Ü¼Û£º",t_price,"Óà¶î£º",m_left), C_GOLD,CC.DefaultFont)
		
		DrawString(80,CC.ScreenH - 57,"ÃØÎä²ĞÕÂ£º".. CC.Sp, C_ORANGE, CC.DefaultFont)
		DrawString(40,CC.ScreenH - 50,"ÉÏÏÂ¼üÑ¡Ôñ ×óÓÒ¼üµ÷ÕûÊıÁ¿ »Ø³µ¼üÈ·ÈÏ ESCÍË³ö",LimeGreen,CC.FontSmall)

		local keypress, ktype, mx, my = lib.GetKey()
		if keypress == VK_UP then
			choice = choice - 1
			if choice < 1 then
				choice = #CC.commodity
			end
		elseif keypress == VK_DOWN then
			choice = choice + 1
			if choice > #CC.commodity then
				choice = 1
			end
		elseif keypress == VK_LEFT then
            if CC.commodity[choice][3] > 0 then
                CC.commodity[choice][3] = CC.commodity[choice][3] - 1
			    m_left = m_left + CC.commodity[choice][2]
			    t_price = t_price - CC.commodity[choice][2]
			end
		elseif keypress == VK_RIGHT then
			if m_left >= CC.commodity[choice][2] then
				CC.commodity[choice][3] = CC.commodity[choice][3] + 1
				m_left = m_left - CC.commodity[choice][2]
				t_price = t_price + CC.commodity[choice][2]
			else
				DrawString(500,520,"ÄúµÄÓà¶î²»×ã£¡", C_RED, CC.FontBig)
				ShowScreen()
				lib.Delay(300)
			end
		elseif keypress == VK_RETURN then
            CC.Sp = m_left
            CC.commodity[choice][5] = CC.commodity[choice][5] + CC.commodity[choice][3]
            CC.commodity[choice][3] = 0
        elseif keypress == VK_ESCAPE then
            CC.commodity[choice][3] = 0
			break
		end
		ShowScreen()
		lib.Delay(CC.Frame)
	end
end

--¸ù¾İ¶¯»­ÌùÍ¼¼ÆËã¶¯»­±àºÅ
function tjmdh(num)
local a = 0

for i = 0,#CC.Effect do
	a = CC.Effect[i] + a
	if num <= a then
	   say(i,0,1)
	   break
	end
	if i == #CC.Effect and num > a then  
	   say('³¬³ö·¶Î§',0,1)
	   break
	end
end
end
function firstmenu1()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local tsmenu = {'·É','Ñ©','Á¬','Ìì','Éä','°×','Â¹','Ğ¦','Êé','Éñ','ÏÀ','ÒĞ','±Ì','Ô§',}
	local tsmenu1 = {'·ÉºüÍâ´«','Ñ©É½·Éºü','Á¬³Ç¾÷','ÌìÁú°Ë²¿','ÉäµñÓ¢ĞÛ´«','°×ÂíĞ¥Î÷·ç','Â¹¶¦¼Ç','Ğ¦°Á½­ºş','Êé½£¶÷³ğÂ¼','ÉñµñÏÀÂÂ','ÏÀ¿ÍĞĞ','ÒĞÌìÍÀÁú¼Ç','±ÌÑª½£','Ô§Ñìµ¶'}
	local menu2 = {	{1,2,3,4,72,587}, --·É
					{633,738,545,722}, --Ñ©
					{37,94,95,96,97,589,52,594,595}, --Á¬
					{49,50,53,51,76,46,47,48,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,70,529,634,45,574,44,565,576,499,577},--Ìì
					{55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604,637,753}, --Éä
					{590,138,137}, --°×
					{601,86,87,602,603,150,71}, --Â¹
					{19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583}, --Ğ¦
					{74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606}, --Êé
					{58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,530,592,627}, --Éñ
					{38,581,582,39,40,41,42,43,85,164,162,163,636}, --ÏÀ
					{9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,523}, --ÒĞ
					{54,91,629,183,184,185,186,607,83,176,639}, --±Ì
					{77,566,189,615,614,613,612}, --Ô§
					
					-- local bsx = {400,500,550,547,548,613,610,551,360,555}
					-- local bsx1 = {556,558,559,560,15,47,545,510,564,617}
					
					--,497,578,579,584,652,500,498,637,577,635,501,596,504,505,507,721,546,610,514,515 --ÌØÊâ
					
					-- ['·É'] = {1,2,3,4,72,587},
					-- ['Ñ©'] = {633,738,545,722},
					-- ['Á¬'] = {37,94,95,96,97,589,52,594,595},
					-- ['Ìì'] = {49,50,53,51,76,46,47,48,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,70,634,45,574,44,565,576,499},
					-- ['Éä'] = {55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604},
					-- ['°×'] = {590,138,137},
					-- ['Â¹'] = {601,86,87,602,603,150,71,},
					-- ['±ê×¼Ö÷½Ç'] = {'¸ÇÊÀÉñÈ­','ÁéÏ¬Ò»Ö¸','½£ÉñÒ»Ğ¦','°ÁÊÀ¿ñµ¶','ÆæÃÅÎŞË«','¾øÊÀÌìî¸','ÈÊÕßÎŞµĞ','»ØÌìÊ¥ÊÖ','¶¾ÊÖÒ©Íõ'},
					-- ['Ğ¦'] = {19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583},
					-- ['Êé'] = {74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606},
					-- ['Éñ'] = {58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,592,628,627},
					-- ['ÏÀ'] = {38,581,582,39,40,41,42,43,85,164,162,163,636},
					-- ['ÒĞ'] = {9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,},
					-- ['±Ì'] = {54,91,629,183,184,185,186,607,83,176,639},
					-- ['Ô§'] = {77,566,189,615,614,613,612},
	}
	local tb = 1
	local lb = 1
	local rw,rw1 = 1,0
	local dh = 0
	local fy ,fymax,star = 0 ,0 , 1
	local zs = 0
	local dl = 0
	local dh = 0
	--³©Ïë
	local cx,ts,zj,xb = 0,0,0,0
	local tbx,tby = bx*1225,by*195
	local tsw,tsh = bx*54,by*45
	while true do 
		if JY.Restart == 1 then
			break
		end
		--Çå³ı»­Ãæ£¬ÒòÎª²Ëµ¥ÊÇÎŞÏŞÑ­»·µÄ×´Ì¬£¬ËùÒÔÏÔÊ¾»­ÃæÇ°£¬ĞèÒªÇå³ıÖ®Ç°µÄ»­Ãæ£¬·ñÔòÌùÍ¼ÎŞÏŞµş¼Ó
		ClsN()
		---------------
		lib.LoadPNG(91, 24 * 2 , 0,0, 1)
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		lib.LoadPNG(91, 26 * 2 , 0,0, 1)
		for i = 1,#tsmenu do
			local cl = C_BLACK
			local tsbx,tsby = bx*1225,by*195 --³õÊ¼×ø±ê
			if i > 7 then
				tsbx,tsby = bx*75,by*195 --³õÊ¼×ø±ê
			end
			local tsk = by*68*(i-1)
			if tb == i then
				cl = C_RED				
				if tb > 7 then
					lib.LoadPNG(91,22*2,tsbx-bx*10,by*68+by*68*(tb-6),1,0,40)
				else
					lib.LoadPNG(91,22*2,tsbx-bx*10,tsby+tsk,1,0,40)
				end
			end
			if i > 7 then
				tsk = by*68*(i-8)
			end
			lib.DrawStr(tsbx,tsby+tsk,tsmenu[i], cl,size*2, "./FONT/6.ttf",  0, 0)
			lib.DrawStr(bx*644-string.len(tsmenu1[tb])*size/4,by*70,tsmenu1[tb], C_WHITE,size*1.6, "./FONT/6.ttf",  0, 0)
		end	
		if lb == 1 or lb == 2 then
			for i = 1, 6 do
				local cl = C_WHITE	
				local ii = rw1 + i
				if menu2[tb][ii] ~= nil then
					local id = menu2[tb][ii]
					local pic = JY.Person[id]["°ëÉíÏñ"]
					local name = JY.Person[id]["ĞÕÃû"]
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*140,by*110 
					if rw == i then
						lib.LoadPNG(90, pic * 2 , bx*276,by*410, 1,0,90)
						if lb == 2 then
							lib.LoadPNG(91,12*2,rwx+(rw-1)*rww-bx*5,rwy-by*10,1,0,116)
						end	
						if lb == 2 then
							cl = C_RED
						end	
						local zs = 0
						local dl = 0
						for j=1,5 do
							if JY.Person[id]['³öÕĞ¶¯»­Ö¡Êı'..j]>0 then
								if j>1 then
									zs = JY.Person[id]['³öÕĞ¶¯»­Ö¡Êı'..j]
									break;
								end
								dl = dl+JY.Person[id]['³öÕĞ¶¯»­Ö¡Êı'..j]*4
							end
						end					
						lib.PicLoadCache(JY.Person[id]["Í·Ïñ´úºÅ"]+101,(dl+dh+zs*3)*2,bx*290,by*700)					
						dh = dh + 1
						if dh == zs then
							dh = 0
						end
						local me = {}
						local row = 0
						local maxh = 9
						if TFJS[id] ~= nil then
							local row = 0
							local maxh = 15
							for i = 1, #TFJS[id] do
								me[#me+1] = TFJS[id][i]
								if i == #TFJS[id] then 
									me[#me+1] = "£Î"
								end
							end
						end
						if CC.PTF[id] ~= nil then 
							for i,v in pairs(CC.PTF[id]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '£Ì'..CC.PTFSM[i][1]
										me[#me+1] = '£×'..CC.PTFSM[i][2]
										me[#me+1] = "£Î"
									end
								end
							end
						end
						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "£Î"
							end
						end
						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "£Î" then
								row = row + 1
							else
								h = tjm(bx*550, by*420 + size*0.8 * (row-fy), tfstr, C_WHITE, size*0.8,math.modf((bx*554)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					end
					lib.LoadPNG(91,39*2,rwx+(i-1)*rww-bx*5,rwy,1,0,113)
					lib.LoadPNG(1,pic*2,rwx+(i-1)*rww,rwy,1,0,90)

					lib.DrawStr(rwx+size*1.8+(i-1)*rww-string.len(name)*size/4,rwy+size*3.8,name, cl,size, "./FONT/0.ttf",  0, 0)
				end
			end
		end
		--ÏÔÊ¾»­Ãæ
		ShowScreen()
		--Ñ­»·µÄ¼ä¸ô£¨ÊıÖµËæÒâ£©
		lib.Delay(40)
		--XÊÇ¼üÅÌ²Ù×÷£¬ktypeÊÇÊó±ê²Ù×÷£¬ktype = 3 ´ú±í×ó¼ü£¬4´ú±íÓÒ¼ü£¬6¹öÂÖÉÏ£¬7¹öÂÖÏÂ
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_ESCAPE or ktype == 4 then
			if lb == 2 then
				lb = 1
				if fy > 0 then
					fy = 0
				end
			end
		elseif X == VK_SPACE or X == VK_RETURN then
			if lb == 1 then
				lb = 2 
			elseif lb == 2 then
				cx = menu2[tb][rw+rw1]
				break
			end
		elseif X == VK_DOWN  then	
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb +1 
				if tb > 14 then
					tb = 1
				end
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
		elseif X == VK_UP  then
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb - 1 
				if tb < 1  then
					tb = 14
				end	
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X == VK_LEFT then
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb < 8 then
					tb = tb + 7 
				else
					tb = tb - 7	
				end
			elseif lb == 2 then
				fy = 0
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end
		elseif X == VK_RIGHT then	
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb > 7 then
					tb  = tb - 7
				else
					tb = tb + 7	
				end
			elseif lb == 2 then
				fy = 0
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end 
		elseif X == VK_PGUP or ktype == 6 then
			PlayWavE(77)
			if lb == 2 then
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end				
		elseif X == VK_PGDN or ktype == 7 then
			PlayWavE(77)
			if lb == 2 then
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end
		elseif X >= VK_A and X <= VK_Z then
			YC_ZhangJiaHui(X)
			--YC_GUXIZHAOWSC(X)
		else
			local cot = false
			local cot1 = false
			for i = 1,#tsmenu do
				local tsbx,tsby = bx*1225,by*195 --³õÊ¼×ø±ê
				if i > 7 then
					tsbx,tsby = bx*75,by*195 --³õÊ¼×ø±ê
				end
				local tsk = by*68*(i-1)
				if i > 7 then
					tsk = by*68*(i-8)
				end
				if mx >= tsbx and mx <= tsbx + tsw and my >= tsby + tsk and my <= tsby + tsk + tsh then
					rw = 1
					rw1 = 0
					tb = i
					zs,dl,dh = 0,0,0
					cot = true
					break
				end
			end   
			if  ktype == 3 and lb == 1  then
				lb = 2
			end
			if  lb == 2 then
				for i = 1,6 do
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*126,by*172 
					local rwk = bx*(i-1)*140
					local ii = rw1 + i
					if menu2[tb][ii] ~= nil then
						if mx >= rwx + rwk and mx < rwx +rwk + rww and my >= rwy and my <= rwy + rwh then					
							rw = i 
							zs,dl,dh = 0,0,0
							cot1 = true
							break
						end

					end
				end
				if cot1 == true and ktype == 3 then
					cx = menu2[tb][rw+rw1]
					break
				end
			end
		end		
	end
	return cx,zj,ts,xb
end
function firstmenu2()--ÌØÊâ½ÇÉ«
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local tsmenu = {'Ñ©','Ò¹','ÖĞ','Î¡','»¤','ÔÆ','»¨','ÊŞ','Èº'}
	local tsmenu1 = {'Ñ©Óğ×Ú','Ò¹ÓêÂ¥','ÖĞ»ª¸ó','±³Î¡¾ü','»¤ÁúÉ½×¯','ÔÆÃÎ½§','»¨½§ÅÉ','ÊÀ¼ä°ÙÊŞ','ÖîÏµÈºÏÀ'}
	local menu2 = {	{514,745,744,781}, --Ñ©
					{526,525,527,761,457}, --Ò¹
					{524,743,747,758,759,760,764,771,772,774,775,776,778,779,780,782,783,784,785,786}, --ÖĞ
					{568},--Î¡
					{749,750,751,752,748,773}, --»¤
					{754,455,762}, --ÔÆ
					{515,763}, --»¨
					{419,429,439},--°ÙÊŞ
					{511,578,579,584,652,500,498,497,635,501,596,505,507,721,546}, --Èº
					--{74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606}, --Êé
					--{58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,530,592,627}, --Éñ
					--{38,581,582,39,40,41,42,43,85,164,162,163,636}, --ÏÀ
					--{9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,523}, --ÒĞ
					--{54,91,629,183,184,185,186,607,83,176,639}, --±Ì
					--{77,566,189,615,614,613,612}, --Ô§
					
					
					-- local bsx = {400,500,550,547,548,613,610,551,360,555}
					-- local bsx1 = {556,558,559,560,15,47,545,510,564,617}
					
					--,497,578,579,584,652,500,498,637,577,635,501,596,504,505,507,721,546,610,514,515 --ÌØÊâ
					
					-- ['·É'] = {1,2,3,4,72,587},
					-- ['Ñ©'] = {633,738,545,722},
					-- ['Á¬'] = {37,94,95,96,97,589,52,594,595},
					-- ['Ìì'] = {49,50,53,51,76,46,47,48,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,70,634,45,574,44,565,576,499},
					-- ['Éä'] = {55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604},
					-- ['°×'] = {590,138,137},
					-- ['Â¹'] = {601,86,87,602,603,150,71,},
					-- ['±ê×¼Ö÷½Ç'] = {'¸ÇÊÀÉñÈ­','ÁéÏ¬Ò»Ö¸','½£ÉñÒ»Ğ¦','°ÁÊÀ¿ñµ¶','ÆæÃÅÎŞË«','¾øÊÀÌìî¸','ÈÊÕßÎŞµĞ','»ØÌìÊ¥ÊÖ','¶¾ÊÖÒ©Íõ'},
					-- ['Ğ¦'] = {19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583},
					-- ['Êé'] = {74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606},
					-- ['Éñ'] = {58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,592,628,627},
					-- ['ÏÀ'] = {38,581,582,39,40,41,42,43,85,164,162,163,636},
					-- ['ÒĞ'] = {9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641,},
					-- ['±Ì'] = {54,91,629,183,184,185,186,607,83,176,639},
					-- ['Ô§'] = {77,566,189,615,614,613,612},
	}
	local tb = 1
	local lb = 1
	local rw,rw1 = 1,0
	local dh = 0
	local fy ,fymax,star = 0 ,0 , 1
	local zs = 0
	local dl = 0
	local dh = 0
	--³©Ïë
	local cx,ts,zj,xb = 0,0,0,0
	local tbx,tby = bx*1225,by*195
	local tsw,tsh = bx*54,by*45
	while true do 
		if JY.Restart == 1 then
			break
		end
		--Çå³ı»­Ãæ£¬ÒòÎª²Ëµ¥ÊÇÎŞÏŞÑ­»·µÄ×´Ì¬£¬ËùÒÔÏÔÊ¾»­ÃæÇ°£¬ĞèÒªÇå³ıÖ®Ç°µÄ»­Ãæ£¬·ñÔòÌùÍ¼ÎŞÏŞµş¼Ó
		ClsN()
		---------------
		lib.LoadPNG(91, 24 * 2 , 0,0, 1)
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		lib.LoadPNG(91, 26 * 2 , 0,0, 1)
		for i = 1,#tsmenu do
			local cl = C_BLACK
			local tsbx,tsby = bx*1225,by*195 --³õÊ¼×ø±ê
			if i > 7 then
				tsbx,tsby = bx*75,by*195 --³õÊ¼×ø±ê
			end
			local tsk = by*68*(i-1)
			if tb == i then
				cl = C_RED				
				if tb > 7 then
					lib.LoadPNG(91,22*2,tsbx-bx*10,by*68+by*68*(tb-6),1,0,40)
				else
					lib.LoadPNG(91,22*2,tsbx-bx*10,tsby+tsk,1,0,40)
				end
			end
			if i > 7 then
				tsk = by*68*(i-8)
			end
			lib.DrawStr(tsbx,tsby+tsk,tsmenu[i], cl,size*2, "./FONT/6.ttf",  0, 0)
			lib.DrawStr(bx*644-string.len(tsmenu1[tb])*size/4,by*70,tsmenu1[tb], C_WHITE,size*1.6, "./FONT/6.ttf",  0, 0)
		end	
		if lb == 1 or lb == 2 then
			for i = 1, 6 do
				local cl = C_WHITE	
				local ii = rw1 + i
				if menu2[tb][ii] ~= nil then
					local id = menu2[tb][ii]
					local pic = JY.Person[id]["°ëÉíÏñ"]
					local name = JY.Person[id]["ĞÕÃû"]
					if id == 429 then
						name = 'Ñ©¾ŞÈËÍõ'
					elseif id == 439 then
						name = 'ÍòÄêÖ©Öë'
					end		
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*140,by*110 
					if rw == i then
						lib.LoadPNG(90, pic * 2 , bx*276,by*410, 1,0,90)
						if lb == 2 then
							lib.LoadPNG(91,12*2,rwx+(rw-1)*rww-bx*5,rwy-by*10,1,0,116)
						end	
						if lb == 2 then
							cl = C_RED
						end	
						local zs = 0
						local dl = 0
						for j=1,5 do
							if JY.Person[id]['³öÕĞ¶¯»­Ö¡Êı'..j]>0 then
								zs = JY.Person[id]['³öÕĞ¶¯»­Ö¡Êı'..j]
								break;
								dl = dl+JY.Person[id]['³öÕĞ¶¯»­Ö¡Êı'..j]*4
							end
						end					
						lib.PicLoadCache(JY.Person[id]["Í·Ïñ´úºÅ"]+101,(dl+dh+zs*3)*2,bx*290,by*700)					
						dh = dh + 1
						--say(zs..'£¬'..dl..'£¬'..dh,0,1)
						if dh == zs then
							dh = 0
						end
						local me = {}
						local row = 0
						local maxh = 9
						if TFJS[id] ~= nil then
							local row = 0
							local maxh = 15
							for i = 1, #TFJS[id] do
								me[#me+1] = TFJS[id][i]
								if i == #TFJS[id] then 
									me[#me+1] = "£Î"
								end
							end
						end
						if CC.PTF[id] ~= nil then 
							for i,v in pairs(CC.PTF[id]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '£Ì'..CC.PTFSM[i][1]
										me[#me+1] = '£×'..CC.PTFSM[i][2]
										me[#me+1] = "£Î"
									end
								end
							end
						end
						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "£Î"
							end
						end
						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "£Î" then
								row = row + 1
							else
								h = tjm(bx*550, by*420 + size*0.8 * (row-fy), tfstr, C_WHITE, size*0.8,math.modf((bx*554)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					end
					lib.LoadPNG(91,39*2,rwx+(i-1)*rww-bx*5,rwy,1,0,113)
					lib.LoadPNG(1,pic*2,rwx+(i-1)*rww,rwy,1,0,90)

					lib.DrawStr(rwx+size*1.8+(i-1)*rww-string.len(name)*size/4,rwy+size*3.8,name, cl,size, "./FONT/0.ttf",  0, 0)
				end
			end
		end
		--ÏÔÊ¾»­Ãæ
		ShowScreen()
		--Ñ­»·µÄ¼ä¸ô£¨ÊıÖµËæÒâ£©
		lib.Delay(40)
		--XÊÇ¼üÅÌ²Ù×÷£¬ktypeÊÇÊó±ê²Ù×÷£¬ktype = 3 ´ú±í×ó¼ü£¬4´ú±íÓÒ¼ü£¬6¹öÂÖÉÏ£¬7¹öÂÖÏÂ
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_ESCAPE or ktype == 4 then
			if lb == 2 then
				lb = 1
				if fy > 0 then
					fy = 0
				end	
			end
		elseif X == VK_SPACE or X == VK_RETURN then
			if lb == 1 then
				lb = 2 
			elseif lb == 2 then
				cx = menu2[tb][rw+rw1]
				break
			end
		elseif X == VK_DOWN  then	
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb +1 
				if tb > 9 then
					tb = 1
				end
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
		elseif X == VK_UP  then
			if lb == 1 then
				rw = 1
				rw1 = 0
				tb = tb - 1 
				if tb < 1  then
					tb = 9
				end	
				zs,dl,dh = 0,0,0
			elseif lb == 2 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X == VK_LEFT then
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb < 8 then
					tb = tb+7
				else
					tb = tb-7	
				end	
				if tb > 9 then
					tb = 8
				end	
			elseif lb == 2 then
				fy = 0
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end
		elseif X == VK_RIGHT then	
			zs,dl,dh = 0,0,0
			if lb == 1 then
				if tb < 8 then
					tb = tb + 7
				else
					tb = tb - 7
				end
				if tb > 9 then
					tb = 8
				end	
			elseif lb == 2 then
				fy = 0
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end 
		elseif X == VK_PGUP or ktype == 6 then
			PlayWavE(77)
			if lb == 2 then
				if rw > 1 then
					rw = rw - 1
				elseif rw1 > 0 then
					rw1 = rw1 - 1
				end
			end				
		elseif X == VK_PGDN or ktype == 7 then
			PlayWavE(77)
			if lb == 2 then
				if #menu2[tb] <= 6 then
					if rw < #menu2[tb] then
						rw = rw + 1
					end
				else
					if rw + rw1 < #menu2[tb] then
						if rw < 6 then
							rw = rw + 1
						else
							rw1 = rw1 + 1
						end
					end
				end
			end
		elseif X >= VK_A and X <= VK_Z then
			YC_ZhangJiaHui(X)
			--YC_GUXIZHAOWSC(X)
		else
			local cot = false
			local cot1 = false
				for i = 1,#tsmenu do
					local tsbx,tsby = bx*1225,by*195 --³õÊ¼×ø±ê
					if i > 7 then
						tsbx,tsby = bx*75,by*195 --³õÊ¼×ø±ê
					end
					local tsk = by*68*(i-1)
					if i > 7 then
						tsk = by*68*(i-8)
					end
					if mx >= tsbx and mx <= tsbx + tsw and my >= tsby + tsk and my <= tsby + tsk + tsh then
						rw = 1
						rw1 = 0
						tb = i
						zs,dl,dh = 0,0,0
						cot = true
						break
					end
				end   
				if  ktype == 3 and lb == 1  then
					lb = 2
				end
			if  lb == 2 then
				for i = 1,6 do
					local rwx,rwy = bx*276,by*165
					local rww,rwh = bx*126,by*172 
					local rwk = bx*(i-1)*140
					local ii = rw1 + i
					if menu2[tb][ii] ~= nil then
						if mx >= rwx + rwk and mx < rwx +rwk + rww and my >= rwy and my <= rwy + rwh then					
							rw = i 
							zs,dl,dh = 0,0,0
							cot1 = true
							break
						end

					end
				end
				if cot1 == true and ktype == 3 then
					cx = menu2[tb][rw+rw1]
					break
				end
			end
		end		
	end
	return cx,zj,ts,xb
end
function bzzjmenu()  --ß÷Ì«¼±¸ü¸Ä
	local bx,by =CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont	
	local mpwz = {"¸ÇÊÀÉñÈ­","½£ÉñÒ»Ğ¦","°ÁÊÀ¿ñµ¶","ÆæÃÅÎŞË«","ÁéÏ¬Ò»Ö¸","ÓûÌìÄ¦ÂŞ","»ØÌìÊ¥ÊÖ","¾øÊÀÌìî¸","ÈÊÕßÎŞµĞ","·çÔÂÎŞ¼ä","´óÇ§ÌìÄ§","±¸ÓÃ"} --ß÷Ì«¼±¸ü¸Ä
	local ax,ay = bx*430,by*30
	local mp = {5,14,6,2,15,1,8,13,4,9,9,9}
	local mpzb =  {
					{1015,85},{1065,196},{1115,306},{1115,417},{1065,529},
					{1015,640},{315,85},{265,196},{216,306},{216,417},{265,529},{315,640}
				}
	local bsx = {547,500,550,551,548,613,610,553,555,572,1067,0}  --ß÷Ì«¼±¸ü¸Ä
	local bsx1 = {556,558,559,560,15,47,545,510,564,1061,617,0}
	local tb = 1
	local lb = 1
	local tb1 = 1
	local fkx,fky = 29,15		
	local fy = 0
	local fymax = 0
	local star = 1		
	local pg = 1
	local xb = JY.Person[0]["ĞÔ±ğ"]
	local zm = JY.Base["ÖÜÄ¿"]
	--lib.PicLoadCache(92,(91+i-1)*2,bx*QZZB[i][1]-bx*22.5,by*QZZB[i][2]-by*22.5,1)
	while true do 
		if JY.Restart == 1 then
			break
		end
		ClsN()
		lib.LoadPNG(91, 110 * 2 , 0,0, 1)

		for i = 1,#mpwz do
			local cl = C_WHITE
			if i < 7 then
				if JY.Person[0]["ĞÔ±ğ"] == 0 then
					lib.LoadPNG(99,bsx[i]*2,bx*mpzb[i][1]+bx*fkx*2.4,by*mpzb[i][2]-by*fky,1,0,300)
				else
					lib.LoadPNG(99,bsx1[i]*2,bx*mpzb[i][1]+bx*fkx*2.4,by*mpzb[i][2]-by*fky,1,0,300)
				end
			else
				if JY.Person[0]["ĞÔ±ğ"] == 0 then
					lib.LoadPNG(99,bsx[i]*2,bx*mpzb[i][1]-bx*fkx*4,by*mpzb[i][2]-by*fky,1,0,300)
				else
					lib.LoadPNG(99,bsx1[i]*2,bx*mpzb[i][1]-bx*fkx*4,by*mpzb[i][2]-by*fky,1,0,300)
				end
			end

			if tb == i then
				cl = C_RED
				if i < 7 then
					lib.LoadPNG(91,112*2,bx*mpzb[i][1]-bx*fkx,by*mpzb[i][2]-by*fky,1)
				else
					lib.LoadPNG(91,112*2,bx*mpzb[i][1]-bx*fkx*6.4,by*mpzb[i][2]-by*fky,1)
				end
			end
			local mpnm = mpwz[i]
			local znm = {}
			local namelen  = string.len(mpnm) / 2
			for j = 1,namelen do
				znm[j] = string.sub(mpnm, j * 2 - 1, j * 2)								
				DrawString(bx*mpzb[i][1],by*mpzb[i][2]+(j-1)*by*size*0.7,znm[j],cl,size*0.8)
			end
		end
		if lb == 2 then			
			--for p = 1,#mpzw do
			if JY.Person[0]["ĞÔ±ğ"] == 0 then	
				lib.LoadPNG(90,bsx[tb]*2,bx*1360/2-bx*150*1.5,by*211,1,0,150)
			elseif JY.Person[0]["ĞÔ±ğ"] == 1 then
				lib.LoadPNG(90,bsx1[tb]*2,bx*1360/2-bx*150*1.5,by*211,1,0,150)
			end
			--end
			local tid = 0+tb
			local me = {}
			local row = 0
			local maxh = 20
			local bz = {'È­','½£','µ¶','Ææ','Ö¸','¶¾','Ò½','î¸','ÈÊ','æÎ','Ä§','ÎŞ'}
			local md = bz[tid]   
			if TFJS[md] ~= nil then
				for i = 1, #TFJS[md] do
					me[#me+1] = TFJS[md][i]
					if i == #TFJS[md] then 
						me[#me+1] = "£Î"
					end
				end
			end
			if CC.PTF[tid] ~= nil then 
				for i,v in pairs(CC.PTF[tid]) do 
					if v == 1 then 
						if CC.PTFSM[i] ~= nil then
							me[#me+1] = '£Ì'..CC.PTFSM[i][1]
							me[#me+1] = '£×'..CC.PTFSM[i][2]
							me[#me+1] = "£Î"
						end
					end
				end
			end			
			for i = 1, #ZJZSJS do
				me[#me+1] = ZJZSJS[i]
				if i == #ZJZSJS then 
					me[#me+1] = "£Î"
				end
			end
			if tb < 7 then	
				lib.LoadPNG(91,111*2,bx*30,by*70,1)
			else
				lib.LoadPNG(91,111*2,bx*930,by*70,1)
			end

			lib.LoadPNG(91,113*2,bx*375,by*61,1)
			for i = star, #me do
				local tfstr = me[i]
				local h = 0
						
				if string.sub(tfstr,1,2) == "£Î" then
					--row = row + 1
				else
					if tb < 7 then
						h = tjm(bx*37, by*95 + size*0.7 * (row-fy), tfstr, C_WHITE, size*0.6,15,size*0.7,fy-row,maxh+1-row+fy)
					else
						h = tjm(bx*937, by*95 + size*0.7 * (row-fy), tfstr, C_WHITE, size*0.6,15,size*0.7,fy-row,maxh+1-row+fy)
					end
				end
				row = row + h
			end
			
			if row > maxh then
				fymax = limitX(row-maxh-1,0)
			else
				fymax = 0
			end
			local xbwz = {"ÉÙÏÀ","Å®ÏÀ","ÏÂÒ»²½"}
			--local xbzb = {{398,67},{470,67},{425,617}}	
			local xbzb = {{550,600},{750,600},{705,683}}
			--{425,617}
			lib.LoadPNG(91,700*2,bx*462,by*552,1)	
			for x = 1,#xbzb do
				local cl = C_WHITE
				if tb1 == x then
					cl = C_RED
				end
				DrawString(bx*xbzb[x][1],by*xbzb[x][2],xbwz[x],cl,size*0.9)
			end	
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			if lb == 2 then
				lb = 1
				tb1 = 1
				JY.Person[0]["ĞÔ±ğ"] = 0
			end
		elseif X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
			if lb == 1 then
				if tb <= 11 then		
					lb = 2
				end
			elseif lb == 2 and tb1 == 3 then
				Cls()
				if DrawStrBoxYesNo(-1, -1, "ÊÇ·ñÒªÎªÖ÷½ÇÃüÃû£¿¡¾Ñ¡·ñÔòÎªÔ¤ÉèĞÕÃû£ºÌÆĞ¡»¢¡¿", C_WHITE, CC.DefaultFont) then
					JY.Person[0]["ĞÕÃû"] = Shurufa(32, CC.ScreenH - 6 * CC.Fontbig)
				else
					JY.Person[0]["ĞÕÃû"]=CC.NewPersonName;
				end	
				JY.Person[0]["ÉúÃüÔö³¤"] = 6	  
				JY.Person[0]["ÉúÃü×î´óÖµ"] = 500
				JY.Person[0]["ÄÚÁ¦×î´óÖµ"] = 500
				JY.Person[0]["ÉúÃü"] = JY.Person[0]["ÉúÃü×î´óÖµ"]
				JY.Person[0]["ÄÚÁ¦"] = JY.Person[0]["ÄÚÁ¦×î´óÖµ"]
				JY.Person[0]["¹¥»÷Á¦"] = 80
				JY.Person[0]["·ÀÓùÁ¦"] = 80
				JY.Person[0]["Çá¹¦"] = 80
				JY.Person[0]["Ò½ÁÆÄÜÁ¦"] = 30
				JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"] = 30
				--JY.Person[0]["½â¶¾ÄÜÁ¦"] = 30
				JY.Person[0]["¿¹¶¾ÄÜÁ¦"] = 0
				JY.Person[0]["È­ÕÆ¹¦·ò"] = 40
				JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 40
				JY.Person[0]["Óù½£ÄÜÁ¦"] = 40
				JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 40
				JY.Person[0]["ÌØÊâ±øÆ÷"] = 40
				JY.Person[0]["°µÆ÷¼¼ÇÉ"] = 40
			
				local zm = JY.Base["ÖÜÄ¿"]
				local nd = JY.Base["ÄÑ¶È"] 
				local addkfnum  
				if nd < 4 then 
					addkfnum = 12+math.modf(zm/2)
				else
					addkfnum = 12+math.modf(zm/1)
				end 
				JY.Base["Îä¹¦ÊıÁ¿"] = JY.Base["Îä¹¦ÊıÁ¿"] + addkfnum
				if JY.Base["Îä¹¦ÊıÁ¿"]>15 then 
					JY.Base["Îä¹¦ÊıÁ¿"]=15
				end	
				if JY.Person[0]["ĞÔ±ğ"] == 1 then 
					JY.Person[0]["ÍâºÅ"] = "¹ÃÄï"
					JY.Person[0]["ÍâºÅ2"] = "Ñ¾Í·"				
					local f_ani = {
					{0, 0, 0}, 
					{9, 9, 7}, 
					{8, 8, 6}, 
					{8, 8, 6}, 
					{9, 7, 7}}
					for i = 1, 5 do
						JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i] = f_ani[i][1]
						JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i] = f_ani[i][3]
						JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i] = f_ani[i][2]
					end
				end			
				--ÃÅÅÉÖ÷½Ç
				if tb == 1 then         --ÉÙÁÖ
					JY.Base["±ê×¼"] = 1
					JY.Person[0]["È­ÕÆ¹¦·ò"] = 60
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end				
					--SetTF(0,9960,1)
					--CC.TG[9960] = 1
					CC.PTF[0][9960] = 1
					-- for i = 1, 5 do
						-- JY.Person[0]["³öÕĞ¶¯»­Ö¡Êı" .. i] = JY.Person[405]["³öÕĞ¶¯»­Ö¡Êı" .. i]
						-- JY.Person[0]["³öÕĞ¶¯»­ÑÓ³Ù" .. i] = JY.Person[405]["³öÕĞ¶¯»­ÑÓ³Ù" .. i]
						-- JY.Person[0]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i] = JY.Person[405]["Îä¹¦ÒôĞ§ÑÓ³Ù" .. i]
					-- end
				elseif tb == 5 then     --Ö¸
					JY.Base["±ê×¼"] = 2
					JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 60
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end	
					--SetTF(0,9959,1)
					--CC.TG[9959] = 1
					CC.PTF[0][9959] = 1
				elseif tb == 2 then     --½£
					JY.Base["±ê×¼"] = 3	
					JY.Person[0]["Óù½£ÄÜÁ¦"] = 60
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end	
					--SetTF(0,9958,1)
					--CC.TG[9958] = 1
					CC.PTF[0][9958] = 1
				elseif tb == 3 then     --µ¶
					JY.Base["±ê×¼"] = 4
					JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 60
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end	
					--SetTF(0,9957,1)
					--CC.TG[9957] = 1
					CC.PTF[0][9957] = 1
				elseif tb == 4 then		 --ÌØ 
				    JY.Base["±ê×¼"] = 5
					JY.Person[0]["ÌØÊâ±øÆ÷"] = 60
					--JY.Person[0]["ÌØÊâ±øÆ÷"] = 40+zm
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end	
					--SetTF(0,9956,1)
					--CC.TG[9956] = 1
					CC.PTF[0][9956] = 1
				elseif tb == 8 then		 --Ììî¸
					JY.Person[0]["ÄÚÁ¦×î´óÖµ"] = 5000
					JY.Person[0]["ÄÚÁ¦"] = 5000
					JY.Person[0]["ÉúÃüÔö³¤"] = 7
					JY.Base["±ê×¼"] = 6
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end	
					--SetTF(0,9947,1)
					--SetTF(0,9946,1)
					--CC.TG[9946] = 1
					CC.PTF[0][9946] = 1
				elseif tb == 9 then		 --ÈÊÕß
					JY.Person[0]["Æ·µÂ"] = 100
					JY.Person[0]["È­ÕÆ¹¦·ò"] = 50
					JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 50
					JY.Person[0]["Óù½£ÄÜÁ¦"] = 50
					JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 50
					JY.Person[0]["ÌØÊâ±øÆ÷"] = 50
					JY.Base["±ê×¼"] = 7
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end			
				elseif tb == 7 then		 --Ò½Éú
					JY.Person[0]["Ò½ÁÆÄÜÁ¦"] = 200
					JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"] = 200
					JY.Person[0]["ÉúÃüÔö³¤"] = 7
					--JY.Person[0]["½â¶¾ÄÜÁ¦"] = 200
					JY.Base["±ê×¼"] = 8
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end				
				elseif tb == 6 then		 --¶¾Íõ
					JY.Base["±ê×¼"] = 9
					JY.Person[0]["ÉúÃüÔö³¤"] = 7
					JY.Person[0]["ÓÃ¶¾ÄÜÁ¦"] = 300
					--JY.Person[0]["½â¶¾ÄÜÁ¦"] = 300
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end	
				elseif tb == 10 then		 --æÎÖ÷
					JY.Base["±ê×¼"] = 10
					JY.Person[512]["ÎŞÓÃ"] = 2
					JY.Person[0]["ĞÔ±ğ"] = 0
					JY.Person[0]["È­ÕÆ¹¦·ò"] = 50
					JY.Person[0]["Ö¸·¨¼¼ÇÉ"] = 50
					JY.Person[0]["Óù½£ÄÜÁ¦"] = 50
					JY.Person[0]["Ë£µ¶¼¼ÇÉ"] = 50
					JY.Person[0]["ÌØÊâ±øÆ÷"] = 50
					JY.Person[0]["ÉúÃüÔö³¤"] = 7
					JY.Person[0]["Í·Ïñ´úºÅ"] = 880
					JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
				elseif tb == 11 then    --Ä§Ö÷
					JY.Base["±ê×¼"] = 11
					JY.Person[0]["ÉúÃüÔö³¤"] = 7
					if JY.Person[0]["ĞÔ±ğ"] == 1 then
						JY.Person[0]["Í·Ïñ´úºÅ"] = 547
						JY.Person[0]["°ëÉíÏñ"] = bsx1[tb]
					else
						JY.Person[0]["Í·Ïñ´úºÅ"] = 880
						JY.Person[0]["°ëÉíÏñ"] = bsx[tb]
					end
					JY.Person[0]["Æ·µÂ"] = 0
				end	
				--Ä§Ö÷Éè¼Æ£º
				
				-- JY.Person[0]["ÃÅÅÉ"] = mp[tb]
				-- JY.Person[0]["ÃÅÅÉÎ»½×"] = 1
				--return GAME_START2()					
				--say("±êÖ÷ÊÇ"..JY.Base["±ê×¼"],0)
				--say("ĞÔ ±ğÊÇ"..JY.Person[0]["ĞÔ±ğ"],0)		
				break
			end
		elseif X == VK_UP  then
			PlayWavE(77)
			if lb == 1 then
				tb = tb - 1 
				if tb < 1 then
					tb = #mpwz
				end
			elseif lb == 2 then
				if tb1 == 3 then
					tb1 = 1 
				elseif tb < 3 then
					tb1 = 3
				end
			end
		elseif X == VK_DOWN  then
			PlayWavE(77)
			if lb == 1 then
				tb = tb + 1
				if tb > #mpwz then
					tb = 1 
				end
			elseif lb == 2 then
				if tb1 < 3 then
					tb1 = 3
				elseif tb1 ==3 then
					tb1 = 1				
				end
			end		
		elseif X == VK_LEFT then
			PlayWavE(77)
			if lb == 1 then
				tb = tb + 6 
				if tb > #mpwz then
					tb = 1
				end
			elseif lb == 2 then
				if tb1 < 3 then
					tb1 = tb1 - 1 
					if tb1 < 1 then
						tb1 = 2
					end
					JY.Person[0]["ĞÔ±ğ"] = tb1 - 1
					if tb == 10 then 
						tb1 = 1
						JY.Person[0]["ĞÔ±ğ"] = 0
					end
				end
			end	

		elseif X == VK_RIGHT then
			PlayWavE(77)
			if lb == 1 then
				tb = tb - 6 
				if tb < 1 then
					tb = #mpwz
				end
			elseif lb == 2 then
				if tb1 < 3 then
					tb1 = tb1 + 1
					if tb1 > 2 then
						tb1 = 1
					end
					JY.Person[0]["ĞÔ±ğ"] = tb1 - 1
					if tb == 10 then 
						tb1 = 1
						JY.Person[0]["ĞÔ±ğ"] = 0
					end
				end
			end	

		elseif X==VK_PGUP or ktype == 6 then
			PlayWavE(77)
			if lb == 2 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X==VK_PGDN or ktype == 7 then
			PlayWavE(77)
			if lb == 2 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
		end
	end
end	

--´óÄñÈËÎïÑ¡Ôñ²Ëµ¥
function firstmenu()
	--Éè¶¨´°¿Ú°Ù·Ö°Ù,·ÀÖ¹»­Ãæ·Å´ó£¬ËõĞ¡£¬µ¼ÖÂ»­ÃæÖĞµÄÎÄ×Ö£¬ÌùÍ¼²»ÔÚ¹æ¶¨Î»ÖÃ
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	--bx*212 by*33.5
	--ÎÄ×Ö´óĞ¡
	local size = CC.DefaultFont
	
	--ÁĞ±í1£¬ÏÔÊ¾ÌìÊé
	local menu1 = {'·É','Ñ©','Á¬','Ìì','Éä','°×','Â¹','±ê×¼Ö÷½Ç','Ğ¦','Êé','Éñ','ÏÀ','ÒĞ','±Ì','Ô§','ÌØÊâÖ÷½Ç'}
	
	--ÁĞ±í1³õÊ¼×ø±êÎ»ÖÃ
	local x1,y1 = bx*147,by*74
	
	local x2,y2 = bx*70,by*165
	--ÁĞ±í1µÄ¼ä¸ô
	local jg = bx*80
	
	--ÁĞ±í2µÄ¼ä¸ô
	local n = 15
	
	local menu2 = {	['·É'] = {1,2,3,4,72,587},
					['Ñ©'] = {633,738,545,722},
					['Á¬'] = {37,94,95,96,97,589,52,594,595},
					['Ìì'] = {44,45,46,47,48,49,50,51,53,70,76,103,113,112,114,115,116,117,118,98,99,100,104,90,105,102,529,634,574,565,576,499},
					['Éä'] = {55,56,57,60,61,64,65,67,68,69,78,123,128,567,568,588,130,129,605,650,604},
					['°×'] = {590,138,137},
					['Â¹'] = {601,86,87,602,603,150,71,},
					['±ê×¼Ö÷½Ç'] = {'¸ÇÊÀÉñÈ­','ÁéÏ¬Ò»Ö¸','½£ÉñÒ»Ğ¦','°ÁÊÀ¿ñµ¶','ÆæÃÅÎŞË«','¾øÊÀÌìî¸','ÈÊÕßÎŞµĞ','»ØÌìÊ¥ÊÖ','¶¾ÊÖÒ©Íõ'},
					['Ğ¦'] = {19,20,21,22,23,24,25,26,27,28,29,31,32,33,34,35,36,73,79,88,140,141,142,149,458,510,593,649,583},
					['Êé'] = {74,75,80,151,152,153,154,155,156,311,313,570,571,569,657,658,656,655,606},
					['Éñ'] = {58,59,63,626,62,84,89,580,161,616,617,160,157,158,159,530,592,627},
					['ÏÀ'] = {38,581,582,39,40,41,42,43,85,164,162,163,636},
					['ÒĞ'] = {9,609,631,66,646,5,6,7,8,10,11,12,13,14,15,16,17,18,169,170,171,174,81,82,640,647,648,638,586,573,575,597,641},
					['±Ì'] = {54,91,629,183,184,185,186,607,83,176,639},
					['Ô§'] = {77,566,189,615,614,613,612},
					['ÌØÊâÖ÷½Ç'] = {'Â½½¥','°×Õ¹ÌÃ','¶«·½Òà','¿ÜÖÙ','Ë¾¿ÕÕªĞÇ','²½¾ªÔÆ','ÏôÇïË®','Î÷ÃÅ´µÑ©','ÀîÑ°»¶','»ÆÉÑ','´ïÄ¦','ÁºÏô','Ğ»ÔÆÁ÷','¹î½£','Ğì×ÓÁê','Ã·³¤ËÕ','¾ÆÉñ','Äô·ç','»¨ÂúÂ¥','Ñî±ùÓğ','·çÁ÷ºÍÉĞ'},
	}

	--ÌØÊâÈËÎïÈËÎïid
	local tsrw = {	--['ÕÅ¼Ò»Ô'] = 651,
                    ['Â½½¥'] = 497,
					['°×Õ¹ÌÃ'] = 511,
					--['¹ÛÖ¹'] = 456,
					['¶«·½Òà'] = 457,
	                ['¿ÜÖÙ'] = 578,
			 		['Ë¾¿ÕÕªĞÇ'] = 579,
					['²½¾ªÔÆ'] = 584,					
					['ÏôÇïË®'] = 652,
					['Î÷ÃÅ´µÑ©'] = 500,
					['ÀîÑ°»¶'] = 498,
					['»ÆÉÑ'] = 637,
					['´ïÄ¦'] = 577,
					['ÁºÏô'] = 635,
					--['ß÷Ì«¼«'] = 92,
					['Ğ»ÔÆÁ÷'] = 501,
					--['Ğ»ÎŞÓÆ'] = 596,
					--['ËÄ´óÉ½'] = 642,
                    ['¹î½£'] = 504,	
                    ['Ğì×ÓÁê'] = 505,
                    ['Ã·³¤ËÕ'] = 507,
                    ['ÎÀÆÜÎà'] = 513,
					['¾ÆÉñ'] = 721, 
					['Äô·ç'] = 546, 
					['»¨ÂúÂ¥'] = 610,
					['Ñî±ùÓğ'] = 514,
					['·çÁ÷ºÍÉĞ'] = 515,
	}	
	--,497,578,579,584,652,500,498,637,577,635,501,596,504,505,507,721,546,610,514,515,
	--ÁĞ±í0°´¼ü¼ÇÂ¼
	local cot = 1 
	
	local cont = 1 
	local cont1 = 0
	
	--ÁĞ±í2°´¼ü¼ÇÂ¼
	local coxt = 1
	--ÁĞ±í2°´¼ü·­Ò³¼ÇÂ¼
	local coxt1 = 0
	local coxt2 = 0
	--¼ÇÂ¼µ±Ç°²Ëµ¥ÊÇÔÚÌìÊé²Ëµ¥»¹ÊÇÈËÎï²Ëµ¥
	local lb = 2
	local xb = 0
	
	--³©Ïë
	local cx = 0
	--Ö÷½Ç
	local zj = 0
	--ÌØÊâ
	local ts = 0
	
	local dh = 0
	local fy = 0
	local fymax = 0
	local star = 1

		
	while true do 
		if JY.Restart == 1 then
			break
		end
		--Çå³ı»­Ãæ£¬ÒòÎª²Ëµ¥ÊÇÎŞÏŞÑ­»·µÄ×´Ì¬£¬ËùÒÔÏÔÊ¾»­ÃæÇ°£¬ĞèÒªÇå³ıÖ®Ç°µÄ»­Ãæ£¬·ñÔòÌùÍ¼ÎŞÏŞµş¼Ó
		ClsN()
		---------------
		
		--×Ô¼ºÕÒÒ»ÕÅ±³¾°Í¼·ÅÕâÀï--bx*212 by*33.5
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		
			local m = menu1[cont+cont1*8]
			
			if lb == 3 or lb == 4 then
				local id = coxt + coxt1*6
				local mid = menu2[m][id]
				--lib.LoadPNGPath(string.format('./data/fight/fight%03d',JY.Person[id]["Í·Ïñ´úºÅ"]), 89, -1, 100)   --Õ½¶·ÌùÍ¼
				if mid ~= nil then
					if m == '±ê×¼Ö÷½Ç' then 
						--ÄĞÖ÷½Ç°ëÉíÏñÆğÊ¼
						local tt = 546
						
						
						--Å®Ö÷½Ç°ëÉíÏñÆğÊ¼ 
						if xb == 1 then 
							tt = 555
						end

						lib.LoadPNG(90, (tt+id)* 2 , bx*160+bx*212,by*370+by*33.5, 2)
						lib.LoadPNG(91, 26 * 2 , 0,0, 1)
						--
						--Ìì¸³ÏÔÊ¾´¦
						--
							local pic = 0
							local zs = 10
							local dl = 0
							if xb == 1 then 
								pic = 547
								zs = 10
								else
								pic = 880
								zs = 14
							end
							
							--×´Ì¬½çÃæ¶¯»­ÏÔÊ¾£¬89ºÅ
							--lib.PicLoadFile(string.format(CC.FightPicFile[1],pic),
						--	string.format(CC.FightPicFile[2],pic), 89)
							
							lib.PicLoadCache(pic+101,(dl+dh+zs*3)*2,bx*890+bx*212,by*670+by*33.5)
							
							dh = dh + 1
							if dh == zs then
								dh = 1
							end
							
						local tid = 0+id
						local me = {}
						local row = 0
                        local maxh = 15
                        local bz = {'È­','Ö¸','½£','µ¶','Ææ','î¸','ÈÊ','Ò½','¶¾','æÎ','Ä§','ÎŞ'}
                        local md = bz[tid]   
						if TFJS[md] ~= nil then
							for i = 1, #TFJS[md] do
								me[#me+1] = TFJS[md][i]
								if i == #TFJS[md] then 
									me[#me+1] = "£Î"
								end
							end
						end

						if CC.PTF[tid] ~= nil then 
							for i,v in pairs(CC.PTF[tid]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '£Ì'..CC.PTFSM[i][1]
										me[#me+1] = '£×'..CC.PTFSM[i][2]
										me[#me+1] = "£Î"
									end
								end
							end
						end
						
						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "£Î"
							end
						end	

						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "£Î" then
								row = row + 1
							else
								h = tjm(bx*300+bx*212, by*280 + size*0.8 * (row-fy)+by*33.5, tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					elseif m == 'ÌØÊâÖ÷½Ç' then 
						--local tt = {290,580}
						if tsrw[mid] ~= nil then
							local pic = JY.Person[tsrw[mid]]['°ëÉíÏñ']
							lib.LoadPNG(90, pic* 2 , bx*160+bx*212,by*370+by*33.5, 2)
						end				
					        lib.LoadPNG(91, 26 * 2 , 0,0, 1)																			
							if tsrw[mid] ~= nil then 
								local tid = tsrw[mid]
								local pic = JY.Person[tid]['Í·Ïñ´úºÅ']
								
								local hh = 0
								for k = 1,2 do 
									if JY.Person[tid]['Îä¹¦'..k] > 0 then 
										local kf = JY.Person[tid]['Îä¹¦'..k]
										DrawString(x2+bx*212,by*528+(hh)*by*41+by*33.5,JY.Wugong[kf]['Ãû³Æ'],C_WHITE,size*0.9);
										hh = hh + 1
									end
								end
								
							--	lib.PicLoadFile(string.format(CC.FightPicFile[1],pic),
							--	string.format(CC.FightPicFile[2],pic), 89)
								
								local zs = 0
								local dl = 0
								for j=1,5 do
									if JY.Person[tid]['³öÕĞ¶¯»­Ö¡Êı'..j]>0 then
										if j>1 then
											zs = JY.Person[tid]['³öÕĞ¶¯»­Ö¡Êı'..j]
											break;
										end
										dl = dl+JY.Person[tid]['³öÕĞ¶¯»­Ö¡Êı'..j]*4
									end
								end
								
								lib.PicLoadCache(pic+101,(dl+dh+zs*3)*2,bx*890+bx*212,by*670+by*33.5)
								
								dh = dh + 1
								if dh == zs then
									dh = 1
								end
								local me = {}
								local row = 0
								local maxh = 15
								if TFJS[tid] ~= nil then
									local row = 0
									local maxh = 15
									for i = 1, #TFJS[tid] do
										me[#me+1] = TFJS[tid][i]
										if i == #TFJS[tid] then 
											me[#me+1] = "£Î"
										end
									end
								end
		
								if CC.PTF[tid] ~= nil then 
									for i,v in pairs(CC.PTF[tid]) do 
										if v == 1 then 
											if CC.PTFSM[i] ~= nil then
												me[#me+1] = '£Ì'..CC.PTFSM[i][1]
												me[#me+1] = '£×'..CC.PTFSM[i][2]
												me[#me+1] = "£Î"
											end
										end
									end
								end
								
								for i = 1, #ZJZSJS do
									me[#me+1] = ZJZSJS[i]
									if i == #ZJZSJS then 
										me[#me+1] = "£Î"
									end
								end

								for i = star, #me do
									local tfstr = me[i]
									local h = 0
											
									if string.sub(tfstr,1,2) == "£Î" then
										row = row + 1
									else
										h = tjm(bx*300+bx*212, by*280 + size*0.8 * (row-fy)+by*33.5, tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
									end
									row = row + h
								end
		
								if row > maxh then
									fymax = limitX(row-maxh-1,0)
								else
									fymax = 0
								end
							end
						
					else
						lib.LoadPNG(90, JY.Person[mid]['°ëÉíÏñ'] * 2 , bx*160+bx*212,by*370+by*33.5, 2)
						lib.LoadPNG(91, 26 * 2 , 0,0, 1)
						--
						--Ìì¸³ÏÔÊ¾´¦
						--
								
						local hh = 0
							for k = 1,2 do 
								if JY.Person[mid]['Îä¹¦'..k] > 0 then 
									local kf = JY.Person[mid]['Îä¹¦'..k]	
									DrawString(x2+bx*212,by*528+(hh)*by*41+by*33.5,JY.Wugong[kf]['Ãû³Æ'],C_WHITE,size*0.9);
									hh = hh + 1
								end
							end
						local zs = 0
						local dl = 0
						for j=1,5 do
							if JY.Person[mid]['³öÕĞ¶¯»­Ö¡Êı'..j]>0 then
								if j>1 then
									zs = JY.Person[mid]['³öÕĞ¶¯»­Ö¡Êı'..j]
									break;
								end
								dl = dl+JY.Person[mid]['³öÕĞ¶¯»­Ö¡Êı'..j]*4
							end
						end
						
						lib.PicLoadCache(JY.Person[mid]["Í·Ïñ´úºÅ"]+101,(dl+dh+zs*3)*2,bx*890+bx*212,by*670+by*33.5)
						
						dh = dh + 1
						if dh == zs then
							dh = 0
						end
						
						local me = {}
						local row = 0
						local maxh = 15
						if TFJS[mid] ~= nil then
							local row = 0
							local maxh = 15
							for i = 1, #TFJS[mid] do
								me[#me+1] = TFJS[mid][i]
								if i == #TFJS[mid] then 
									me[#me+1] = "£Î"
								end
							end
						end
						if CC.PTF[mid] ~= nil then 
							for i,v in pairs(CC.PTF[mid]) do 
								if v == 1 then 
									if CC.PTFSM[i] ~= nil then
										me[#me+1] = '£Ì'..CC.PTFSM[i][1]
										me[#me+1] = '£×'..CC.PTFSM[i][2]
										me[#me+1] = "£Î"
									end
								end
							end
						end

						for i = 1, #ZJZSJS do
							me[#me+1] = ZJZSJS[i]
							if i == #ZJZSJS then 
								me[#me+1] = "£Î"
							end
						end
						for i = star, #me do
							local tfstr = me[i]
							local h = 0
									
							if string.sub(tfstr,1,2) == "£Î" then
								row = row + 1
							else
								h = tjm(bx*300+bx*212, by*280 + size*0.8 * (row-fy)+by*33.5, tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
							end
							row = row + h
						end

						if row > maxh then
							fymax = limitX(row-maxh-1,0)
						else
							fymax = 0
						end
					
					end
				end
				
				DrawString(-1,by*660+by*33.5,'PageUp ÉÏ·­Ò³  PageDown ÏÂ·­Ò³',C_GOLD,size*0.7);
			end

		--if lb == 2 or lb == 3 then
			--ÏÔÊ¾ÌìÊéÁĞ±í
			for i = 1,8 do
				for j = 1,2 do
					local id = i + (j-1)*8
					local cl = C_WHITE
					if cont == i and cont1 == j-1 and lb == 2 then
						cl = C_RED
					end	
					
					DrawString(x1+(i-1)*jg+bx*212,y1+(j-1)*by*40+by*33.5,menu1[id],cl,size);
				end
			end
		--end
		--ÏÔÊ¾ÈËÎïÁĞ±í
		--if lb == 3 or lb == 2 then 
			for i = 1,6 do
				for j = 1,2 do
					local id = i + (j-1+coxt2)*6
					local cl = C_WHITE
					local mid = menu2[m][id]
					if mid ~= nil then
						if coxt + coxt1*6 == id and lb == 3 then
							cl = C_RED
						end	
						if m == '±ê×¼Ö÷½Ç' then
							DrawString(x2+(i-1)*bx*140+bx*212,y2+(j-1)*size+by*33.5,mid,cl,size*0.8);
						elseif m == 'ÌØÊâÖ÷½Ç' then
							DrawString(x2+(i-1)*bx*140+bx*212,y2+(j-1)*size+by*33.5,mid,cl,size*0.8);
						
						else
							DrawString(x2+(i-1)*bx*140+bx*212,y2+(j-1)*size+by*33.5,JY.Person[mid]['ĞÕÃû'],cl,size*0.8);
						end
						
					end
				end
				
			end
			
		----------------
		--ÏÔÊ¾»­Ãæ
		ShowScreen()
		--Ñ­»·µÄ¼ä¸ô£¨ÊıÖµËæÒâ£©
		lib.Delay(40)
		--XÊÇ¼üÅÌ²Ù×÷£¬ktypeÊÇÊó±ê²Ù×÷£¬ktype = 3 ´ú±í×ó¼ü£¬4´ú±íÓÒ¼ü£¬6¹öÂÖÉÏ£¬7¹öÂÖÏÂ
		local X,ktype,mx,my = lib.GetKey()
		
		--¿Õ¸ñ¼üºÍenter¼üÄ¬ÈÏÈ·¶¨
		if X == VK_SPACE or X == VK_RETURN then 
			if lb == 2 then 
				lb = 3
			elseif lb == 3 then 
				if menu1[cont+cont1*8] == '±ê×¼Ö÷½Ç' then 
					lb = 4
				elseif menu1[cont+cont1*8] == 'ÌØÊâÖ÷½Ç' then 
						cx = tsrw[menu2[m][coxt + coxt1*6]]					
					break
				else
					cx = menu2[m][coxt + coxt1*6]
					break
				end
			elseif lb == 4 then 
				zj = coxt + coxt1*6
				local tt = 546 
				if xb == 1 then 
					tt = 555
				end
				JY.Person[0]['°ëÉíÏñ'] = zj+tt
				break
			end	
		--escºÍÊó±êÓÒ¼üÄ¬ÈÏ·µ»Ø
		elseif X == VK_ESCAPE or ktype == 4 then
			--Ñ­»·½áÊø£¬ÍË³ö
			if lb == 3 then
				lb = 2
				coxt = 1 
				coxt1 = 0 
				coxt2 = 0
				dh = 0
				fy = 0
				--return 0
			elseif lb == 4 or lb == 5 then 
				lb = 3
				--return 0
			end
		elseif X == VK_UP then
			if lb == 2 then 
				if cont1 == 1 then 
					cont1 = 0
				else
					cont1 = 1
				end
			elseif lb == 3 then
				if coxt1 > 0 then
					if coxt1 == coxt2 then
						coxt2 = limitX(coxt2 - 1,0)
					end
					coxt1 = coxt1 - 1
				else 
					coxt = 1
				end
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end

		elseif X == VK_DOWN then
			if lb == 2 then 
				if cont1 == 1 then 
					cont1 = 0
				else
					cont1 = 1
				end
			elseif lb == 3 then
				if coxt + coxt1*6 < #menu2[menu1[cont+cont1*8]] then
					if coxt1 < math.ceil(#menu2[menu1[cont+cont1*8]]/6) - 1 then 
						coxt1 = coxt1 + 1 
						if coxt + coxt1*6 > #menu2[menu1[cont+cont1*8]] then
							coxt = #menu2[menu1[cont+cont1*8]] - coxt1*6
						end
					else 
						coxt = #menu2[menu1[cont+cont1*8]] - coxt1*6
					end
					if coxt1 - coxt2 > 1 then
						coxt2 = coxt2 + 1
					end
				end
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end
		elseif X == VK_LEFT or ktype == 6 then
			if lb == 2 then 
				if cont1 > 0 then
					if cont > 1 then
						cont = cont - 1 
					else 
						cont = 8
						cont1 = 0					
					end
				else 
					if cont > 1 then
						cont = cont - 1 	
					else 
						cont = 8
						cont1 = 1
					end
				end
			elseif lb == 3 then 
				if coxt > 1 then 
					coxt = coxt - 1
				else
					if coxt1 > 0 then 
						if coxt1 == coxt2 then
							coxt2 = limitX(coxt2 - 1,0)
						end
						coxt1 = coxt1 - 1
						coxt = 6
					end
				end	
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end			
		elseif X == VK_RIGHT or ktype == 7 then
			if lb == 2 then 
				if cont1 < 1 then 
					if cont < 8 then 
						cont = cont + 1 
					else 
						cont = 1
						cont1 = 1
					end
				else 
					if cont < 8 then 
						cont = cont + 1 
					else 
						cont = 1
						cont1 = 0
					end
				end
			elseif lb == 3 then 
				if coxt + coxt1*6 < #menu2[menu1[cont+cont1*8]] then
					if coxt < 6 then 
						coxt = coxt + 1
					else
						if coxt1 < math.ceil(#menu2[menu1[cont+cont1*8]]/6) - 1 then 
							coxt = 1 
							coxt1 = coxt1 + 1
						end	
					end	
					if coxt1 - coxt2 > 1 then
						coxt2 = coxt2 + 1
					end
				end
				dh = 0
				fy = 0
			elseif lb == 4 then 
				if xb == 1 then 
					xb = 0 
				else 
					xb = 1
				end	
			end	
		elseif X == VK_PGUP then
			if lb == 3 then
				fy = fy - 1
				if fy < 0 then 
					fy = 0
				end	
			end
		elseif X == VK_PGDN then
			if lb == 3 then
				fy = fy + 1
				if fy > fymax then
					fy = fymax 
				end
			end
			
		else 
			local mxx = false
			if lb == 2 then 
				for i = 1,8 do
					for j = 1,2 do
						local id = i + (j-1)*8
						if mx >= x1+(i-1)*jg+bx*212 and mx <= x1+(i-1)*jg + size*#menu1[id]/2+bx*212 and 
							my >= y1+(j-1)*by*40+by*33.5 and my <= y1+(j-1)*by*40 + size+by*33.5 then
							cont = i 
							cont1 = j-1
							mxx = true
							break
						end
					end
					if mxx == true then 
						break
					end
				end
			elseif lb == 3 then 
				for i = 1,6 do 
					for j = 1,2 do
						local s = i + (j-1+coxt2)*6
						local mid = menu2[m][s]
						local s = 0
						if mid ~= nil then
							if m == '±ê×¼Ö÷½Ç' or m == 'ÌØÊâÖ÷½Ç' then
								s = #mid*(size*0.8)/2
							else 
								local name = JY.Person[mid]['ĞÕÃû']
								s = #name*(size*0.8)/2
							end
						end
						if mx >= x2+(i-1)*bx*140+bx*212 and mx <= x2+(i-1)*bx*140 + s+bx*212 and 
							my >= y2+(j-1)*size*0.8+by*33.5 and my <= y2+(j-1)*size + size*0.8+by*33.5 then 
							if mid ~= nil then 
								coxt = i
								coxt1 = j - 1 + coxt2
								mxx = true
								dh = 0
								break
							end
						end	
					end
					if mxx == true then 
						break
					end
				end	
			elseif lb == 4 then 
				mxx = true
			end--0,0
			if mxx == true and ktype == 3 then 
				if lb == 2 then 
					lb = 3
				elseif lb == 3 then 
					if menu1[cont+cont1*8] == '±ê×¼Ö÷½Ç' then 
						lb = 4
					elseif menu1[cont+cont1*8] == 'ÌØÊâÖ÷½Ç' then 
							cx = tsrw[menu2[m][coxt + coxt1*6]]
						break
					else
						cx = menu2[m][coxt + coxt1*6]
						if showCXStatic(cx) then						
						break
					end
                end
				elseif lb == 4 then 
				zj = coxt + coxt1*6
				local tt = 546 
				if xb == 1 then 
					tt = 555
				end
				JY.Person[0]['°ëÉíÏñ'] = zj+tt
				break
				end	
			end
		end
		
	end
	return cx,zj,ts,xb
end

function tjm(x,y,str,color,size,xnum,hnum,first,last)
	if xnum == nil then 
		xnum = #str
	end  
 
	if x==-1 then
		local ll=#str;
		local w=size*ll/2+2*CC.MenuBorderPixel;
		x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end

	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
	
	local ynum=size
	local T2={};
	T2["£Ò"] = PinkRed
	T2["£Ì"] = LimeGreen
	T2["£Â"] = C_BLACK
	T2["£×"] = C_WHITE
	T2["£Ï"] = C_ORANGE
	T2["£Ä"] = M_DeepSkyBlue
	T2["£Ú"] = Violet
	T2['£Ç'] = C_GOLD
	local cx,cy=0,0;
	--local sid=lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH);
	while string.len(str)>=1 do
		if JY.Restart == 1 then
			break
		end
		local try=string.sub(str,1,1)
		local control=false;

		local hs = size+CC.RowPixel
		if hnum ~= nil then 
			hs = hnum
		end
		if string.byte(try)>127 then --ÖĞÎÄ
			local s=string.sub(str,1,2);
			str=string.sub(str,3,-1);

			if T2[s] ~= nil then 
				--if s ~= "£×" then
					color = T2[s]
				--else
					--color = C_BLACK
				--end	
				control = true;
			end
            
			if not control then
                if s == '*' then 
                   -- cy = cy + 1 
                  --  cx = 0
                else
                    if first ~= nil then
                        if last ~= nil then
                            if cy >= first and cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            if cy >= first then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end	  
                        end
                    else 
                        if last ~= nil then
                            if cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end		  
                    end
                    cx=cx+1;
                end
			end
		else
			local s=try
			str=string.sub(str,2,-1);
            if s == '£Î' or s == '*' then 
                cy = cy + 1 
                cx = 0
            else
                if first ~= nil then
                    if last ~= nil then
                        if cy >= first and cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        if cy >= first then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end	  
                    end
                else 
                    if last ~= nil then
                        if cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                    end		  
                end
                cx=cx+1;
            end
			
		end

		if not control then

			if cx > xnum then
				cx = 0;
				--×ÖÌå½áÊø²»ÔÙ½øÈëÏÂÒ»ĞĞ
				if string.len(str) >= 1 then 
					cy = cy + 1;
				end
			end
		end

	end

	--lib.FreeSur(sid);
	return cy+1
end

function tjm1(x,y,str,color,size,xnum,hnum,first,last)
	if xnum == nil then 
		xnum = #str
	end  
 
	if x==-1 then
		local ll=#str;
		local w=size*ll/2+2*CC.MenuBorderPixel;
		x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
	end

	if y == -1 then
		y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
	end
	
	local ynum=size
	local T2={};
	T2["£Ò"] = PinkRed
	T2["£Ì"] = LimeGreen
	T2["£Â"] = C_BLACK
	T2["£×"] = C_WHITE
	T2["£Ï"] = C_ORANGE
	T2["£Ä"] = M_DeepSkyBlue
	T2["£Ú"] = Violet
	T2['£Ç'] = C_GOLD
	local cx,cy=0,0;
	--local sid=lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH);
	while string.len(str)>=1 do
		if JY.Restart == 1 then
			break
		end
		local try=string.sub(str,1,1)
		local control=false;

		local hs = size+CC.RowPixel
		if hnum ~= nil then 
			hs = hnum
		end
		if string.byte(try)>127 then --ÖĞÎÄ
			local s=string.sub(str,1,2);
			str=string.sub(str,3,-1);

			if T2[s] ~= nil  then 
				if T2[s] == C_WHITE then
					color = C_BLACK
				elseif T2[s] == Violet then
					color = M_Red
				else
					color = T2[s]
				end	
				
				--else
					--color = C_BLACK
				--end	
				control = true;
			end
            
			if not control then
                if s == '*' then 
                   -- cy = cy + 1 
                  --  cx = 0
                else
                    if first ~= nil then
                        if last ~= nil then
                            if cy >= first and cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            if cy >= first then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end	  
                        end
                    else 
                        if last ~= nil then
                            if cy < last then
                                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                            end
                        else 
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end		  
                    end
                    cx=cx+1;
                end
			end
		else
			local s=try
			str=string.sub(str,2,-1);
            if s == '£Î' or s == '*' then 
                cy = cy + 1 
                cx = 0
            else
                if first ~= nil then
                    if last ~= nil then
                        if cy >= first and cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        if cy >= first then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end	  
                    end
                else 
                    if last ~= nil then
                        if cy < last then
                            lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                        end
                    else 
                        lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
                    end		  
                end
                cx=cx+1;
            end
			
		end

		if not control then

			if cx > xnum then
				cx = 0;
				--×ÖÌå½áÊø²»ÔÙ½øÈëÏÂÒ»ĞĞ
				if string.len(str) >= 1 then 
					cy = cy + 1;
				end
			end
		end

	end

	--lib.FreeSur(sid);
	return cy+1
end

function tjm2(str,xnum)
	if xnum == nil then 
		xnum = #str
	end  
 
	local T2={};

	T2["£Ò"] = PinkRed
	T2["£Ì"] = LimeGreen
	T2["£Â"] = C_BLACK
	T2["£×"] = C_WHITE
	T2["£Ï"] = C_ORANGE
	T2["£Ä"] = M_DeepSkyBlue
	T2["£Ú"] = Violet
	T2['£Ç'] = C_GOLD

	local cx,cy=0,0;
    --local color 
	while string.len(str)>=1 do
		if JY.Restart == 1 then
			break
		end
		local try=string.sub(str,1,1)
		local control=false;

		if string.byte(try)>127 then --ÖĞÎÄ
			local s=string.sub(str,1,2);
			str=string.sub(str,3,-1);

			if T2[s] ~= nil then 
				--color = T2[s]
				control = true;
			end
            
			if not control then
                if s == '£Î' then 

                else
                    cx=cx+1;
                end
			end

		else
			local s=try
			str=string.sub(str,2,-1);
            if s == '£Î' or s == '*' then 
                cy = cy + 1 
                cx = 0
            else

                cx=cx+1;
            end
			
		end

		if not control then

			if cx > xnum then
				cx = 0;
				--×ÖÌå½áÊø²»ÔÙ½øÈëÏÂÒ»ĞĞ
				if string.len(str) >= 1 then 
					cy = cy + 1;
				end
			end
		end

	end

	return cy+1
end

function tjmsave(id)
	CC.TJMSJ = {} 
	CC.TJM = 0

	for i = 1,#CC.TXM do
		CC.TJMSJ[#CC.TJMSJ+1] = CC.TX[CC.TXM[i]]
		CC.TJM = CC.TJM + 1
	end
	
	local tg = 0
	for i,v in pairs(CC.TG) do 
		tg = tg + 1
	end 
	
	CC.TJMSJ[#CC.TJMSJ+1] = tg
	CC.TJM = CC.TJM + 1
	
	for i,v in pairs(CC.TG) do 
		CC.TJMSJ[#CC.TJMSJ+1] = i
		CC.TJM = CC.TJM + 1
	end
	
	CC.TJMSJ[#CC.TJMSJ+1] = #CC.TGJL
	CC.TJM = CC.TJM + 1
	
	for i = 1,#CC.TGJL do
		CC.TJMSJ[#CC.TJMSJ+1] = CC.TGJL[i]
		CC.TJM = CC.TJM + 1
	end

	CC.TJMSJ[#CC.TJMSJ+1] = CC.Gold
	CC.TJM = CC.TJM + 1

	--CC.SP = JY.Base["ËéÆ¬"]
	CC.TJMSJ[#CC.TJMSJ+1] = CC.Sp
	CC.TJM = CC.TJM + 1

	CC.TJMSJ[#CC.TJMSJ+1] = CC.Jl
	CC.TJM = CC.TJM + 1

    for i = 0,CC.PerNum do 
        if CC.PTF[i] ~= nil then
            local n = CC.TJM + 1
            local m = 0
            CC.TJMSJ[#CC.TJMSJ+1] = 0
            CC.TJM = CC.TJM + 1
            for j,k in pairs(CC.PTF[i]) do 
                CC.TJMSJ[#CC.TJMSJ+1] = j
                CC.TJM = CC.TJM + 1
                m = m + 1
            end
            CC.TJMSJ[n] = m
        else 
            CC.TJMSJ[#CC.TJMSJ+1] = 0
            CC.TJM = CC.TJM + 1
        end
    end

	local fp_tmp=io.open('tjm',"w");
	
	if fp_tmp then
		fp_tmp:close();
		local data_header=Byte.create(4);
		Byte.set32(data_header,0, CC.TJM);
		Byte.savefile(data_header,'tjm', 0, 4);
		local data_keys=Byte.create(4*CC.TJM);
		for i=0,CC.TJM-1 do
			Byte.set32(data_keys, i*4, CC.TJMSJ[i+1]);
		end
		Byte.savefile(data_keys, 'tjm', 4, 4*CC.TJM);
	end
	CC.TJMSJ = {} 
	CC.TJM = 0
end

function tjmload(id)
	CC.TJMSJ = {} 
	CC.TJM = 0
	local fp_tmp=io.open('tjm',"r");
	if fp_tmp then
		fp_tmp:close();
   
		local data_header=Byte.create(4);
   
		Byte.loadfile(data_header,'tjm', 0, 4);
   
		CC.TJM=Byte.get32(data_header,0);
   
		local data_keys=Byte.create(4*CC.TJM);
   
		Byte.loadfile(data_keys,'tjm', 4, 4*CC.TJM);
		
		for i=0,CC.TJM-1 do
			CC.TJMSJ[i+1]=Byte.get32(data_keys, i*4);
		end
		
		CC.TJM = 1
		
		for i = 1,#CC.TXM do
			CC.TX[CC.TXM[i]] = CC.TJMSJ[CC.TJM]
			CC.TJM = CC.TJM + 1
		end
		
		local tg = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
		for i = 1,tg do
			local v = CC.TJMSJ[CC.TJM]
			CC.TG[v] = 1
			CC.TJM = CC.TJM + 1
		end
		
		local tgjl = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
		for i = 1,tgjl do
			CC.TGJL[i] = CC.TJMSJ[CC.TJM]
			CC.TJM = CC.TJM + 1
		end
        
        CC.Gold = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1

        CC.Jl = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
		--CC.Sp = JY.Base["ËéÆ¬"]
		CC.Sp = CC.TJMSJ[CC.TJM]
		CC.TJM = CC.TJM + 1
		
        for i = 0,CC.PerNum do
            local n = CC.TJMSJ[CC.TJM]
            CC.TJM = CC.TJM + 1
            CC.PTF[i] = {}
            for j = 1,n do
                local tf = CC.TJMSJ[CC.TJM]
                CC.TJM = CC.TJM + 1
                CC.PTF[i][tf] = 1
            end
        end
	end
	Weekload()
	CC.TJMSJ = {} 
	CC.TJM = 0
end

--ÉèÖÃÌì¸³£¬n == 1±íÊ¾ÓĞ£¬nil±íÊ¾ÎŞ
function SetTF(i,tf,n)
    local zjtf = false
	local npctf = false
	local limit = 0
	local limit1 = 0
	if CC.PTFSM[tf][1] == nil then
		do return end
	end	
	if n ~= nil then
		for k, v in pairs(CC.PTF[i]) do
			if v == 1 then
				limit = limit + 1
			end	
		end
		if limit < 10 then
			if i == 0 then
				if DrawStrBoxYesNo(-1, -1,JY.Person[i]['ĞÕÃû'].."ÊÇ·ñÒªÑ§Ï°"..CC.PTFSM[tf][1].."Ìì¸³£¿", C_WHITE, CC.DefaultFont) then
					CC.PTF[i][tf] = n
					QZXS(JY.Person[i]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")
				end
			else
				CC.PTF[i][tf] = n
				QZXS(JY.Person[i]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")
				if JY.Base['³©Ïë'] == i then
					if DrawStrBoxYesNo(-1, -1,'³©Ïë'..JY.Person[0]['ĞÕÃû'].."ÊÇ·ñÒªÑ§Ï°"..CC.PTFSM[tf][1].."Ìì¸³£¿", C_WHITE, CC.DefaultFont) then
						CC.PTF[0][tf] = n
						QZXS('³©Ïë'..JY.Person[0]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")
					end
				end			
			end	
		else
			if DrawStrBoxYesNo(-1, -1,JY.Person[i]['ĞÕÃû'].."Ìì¸³ÒÑÂú£¬ÊÇ·ñÒÅÍüÌì¸³£¿", C_WHITE, CC.DefaultFont) then
				Cls();
				Cat('ÒÅÍüÌì¸³')
				for k, v in pairs(CC.PTF[i]) do
					if v == 1 then
						limit1 = limit1 + 1
					end	
				end
				if limit1 < 10 then
					CC.PTF[i][tf] = n
					QZXS(JY.Person[i]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")
					if JY.Base['³©Ïë'] == i then
						if DrawStrBoxYesNo(-1, -1,'³©Ïë'..JY.Person[0]['ĞÕÃû'].."ÊÇ·ñÒªÑ§Ï°"..CC.PTFSM[tf][1].."Ìì¸³£¿", C_WHITE, CC.DefaultFont) then
							CC.PTF[0][tf] = n
							QZXS('³©Ïë'..JY.Person[0]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")
						end
					end
				end
			end
		end		
	else
		CC.PTF[i][tf] = nil
		QZXS(JY.Person[i]['ĞÕÃû'].."ÒÅÍü"..CC.PTFSM[tf][1].."Ìì¸³")
		if JY.Base['³©Ïë'] == i then
			CC.PTF[i][tf] = nil
			QZXS('³©Ïë'..JY.Person[i]['ĞÕÃû'].."ÒÅÍü"..CC.PTFSM[tf][1].."Ìì¸³")
		end
	end	
	--[[if i == 0 and CC.TG[tf] == nil then	
		for k, v in pairs(CC.TG) do
			limit = limit + 1
		end
		if TFJS[i] ~=nil then
			limit = limit + 1
		end	
		if limit < 9 then
			if DrawStrBoxYesNo(-1, -1,JY.Person[0]['ĞÕÃû'].."ÊÇ·ñÒªÑ§Ï°"..CC.PTFSM[tf][1].."Ìì¸³£¿", C_WHITE, CC.DefaultFont) then  --ÊÇ/·ñ
				CC.TG[tf] = n
				QZXS(JY.Person[0]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")
			end	
		end
	elseif i ~= 0 then
		if CC.PTF[i] == nil then 
			CC.PTF[i] = {}
		end
		CC.PTF[i][tf] = n
		QZXS(JY.Person[i]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")	
		if JY.Base['³©Ïë'] == i and CC.TG[tf] == nil then
			for k, v in pairs(CC.TG) do
				limit = limit + 1
			end
			if TFJS[i] ~=nil then
				limit = limit + 1
			end	
			if limit < 9 then
				if DrawStrBoxYesNo(-1, -1,JY.Person[0]['ĞÕÃû'].."ÊÇ·ñÒªÑ§Ï°"..CC.PTFSM[tf][1].."Ìì¸³£¿", C_WHITE, CC.DefaultFont) then  --ÊÇ/·ñ
					CC.TG[tf] = n
					QZXS('³©Ïë'..JY.Person[0]['ĞÕÃû'].."»ñµÃ"..CC.PTFSM[tf][1].."Ìì¸³")
				end
			end	
		end	
	else	
	end]]
end

function ShowStatus()
	local day = {
	{1, "³õÒ»"},
	{2, "³õ¶ş"},
	{3, "³õÈı"},
	{4, "³õËÄ"},
	{5, "³õÎå"},
	{6, "³õÁù"},
	{7, "³õÆß"},
	{8, "³õ°Ë"},
	{9, "³õ¾Å"},
	{10, "³õÊ®"},
	{11, "Ê®Ò»"},
	{12, "Ê®¶ş"},
	{13, "Ê®Èı"},
	{14, "Ê®ËÄ"},
	{15, "Ê®Îå"},
	{16, "Ê®Áù"},
	{17, "Ê®Æß"},
	{18, "Ê®°Ë"},
	{19, "Ê®¾Å"},
	{20, "Ø¥Ê®"},
	{21, "Ø¥Ò»"},
	{22, "Ø¥¶ş"},
	{23, "Ø¥Èı"},
	{24, "Ø¥ËÄ"},
	{25, "Ø¥Îå"},
	{26, "Ø¥Áù"},
	{27, "Ø¥Æß"},
	{28, "Ø¥°Ë"},
	{29, "Ø¥¾Å"},
	{30, "ÈıÊ®"},  
  }
  
  local month = {
	{1, "ÒúÔÂ"},
	{2, "Ã®ÔÂ"},
	{3, "³½ÔÂ"},
	{4, "ËÈÔÂ"},
	{5, "ÎçÔÂ"},
	{6, "Î´ÔÂ"},
	{7, "ÉêÔÂ"},
	{8, "ÓÏÔÂ"},
	{9, "ĞçÔÂ"},
	{10, "º¥ÔÂ"},
	{11, "×ÓÔÂ"},
	{12, "³óÔÂ"}, 
  }
  
  local year = {
	{1, "¼××Ó"},
	{2, "ÒÒ³ó"},
	{3, "±ûÒú"},
	{4, "¶¡Ã®"},
	{5, "Îì³½"},
	{6, "¼ºËÈ"},
	{7, "¸ıÎç"},
	{8, "ĞÁÎ´"},
	{9, "ÈÉÉê"},
	{10, "¹ïÓÏ"},
	{11, "¼×Ğç"},
	{12, "ÒÒº¥"},
	{13, "±û×Ó"},
	{14, "¶¡³ó"},
	{15, "ÎìÒú"},
	{16, "¼ºÃ®"},
	{17, "¸ı³½"},
	{18, "ĞÁ¼º"},
	{19, "ÈÉÎç"},
	{20, "¹ïÎ´"},
	{21, "¼×Éê"},
	{22, "ÒÒÓÏ"},
	{23, "±ûĞç"},
	{24, "¶¡º¥"},
	{25, "Îì×Ó"},
	{26, "¼º³ó"},
	{27, "¸ıÒú"},
	{28, "ĞÁÃ®"},
	{29, "ÈÉ³½"},
	{30, "¹ïËÈ"},
	{31, "¼×Îç"},
	{32, "ÒÒÎ´"},
	{33, "±ûÉê"},
	{34, "¶¡ÓÏ"},
	{35, "ÎìĞç"},
	{36, "¼ºº¥"},
	{37, "¸ı×Ó"},
	{38, "ĞÁ³ó"},
	{39, "ÈÉÒú"},
	{40, "¹ï³ó"},
	{41, "¼×³½"},
	{42, "ÒÒËÈ"},
	{43, "±ûÎç"},
	{44, "¶¡Î´"},
	{45, "ÎìÉê"},
	{46, "¼ºÓÏ"},
	{47, "¸ıĞç"},
	{48, "ĞÁº¥"},
	{49, "ÈÉ×Ó"},
	{50, "¹ï³ó"},
	{51, "¼×Òú"},
	{52, "ÒÒÃ®"},
	{53, "±û³½"},
	{54, "¶¡ËÈ"},
	{55, "ÎìÎç"},
	{56, "¼ºÎ´"},
	{57, "¸ıÉê"},
	{58, "ĞÁÓÏ"},
	{59, "ÈÉĞç"},
	{60, "¹ïº¥"},
  }

	--±ÈÀû
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	--ÎÄ×Ö´óĞ¡
	local size = CC.DefaultFont*0.6
	--ÎÄ×Ö´óĞ¡2
	local size2 = CC.DefaultFont*0.55
	--ÉúÃü×ø±ê
	local x1,y1 = bx*183,bx*41
	--ÄÚÁ¦×ø±ê
	local x2,y2 = bx*183,bx*59
	--Í·Ïñ×ø±ê
	local x3,y3 = bx*56,bx*51
	--ĞÕÃû×ø±ê
	local x4,y4 = bx*152,bx*20
	--ÖÜÄ¿×ø±ê
	local x5,y5 = bx*235,bx*20
	--ÒøÁ½×ø±ê
	local x6,y6 = bx*135,bx*82
	--ÌìÊé×ø±ê
	local x7,y7 = bx*215,bx*82
	--ÄÑ¶È×ø±ê
	local x8,y8 = bx*40,bx*110
	--ÉúÃüÄÚÁ¦´óĞ¡
	local w = bx*78
	local h = bx*7
	--ÉúÃü
	local sm = JY.Person[0]['ÉúÃü']
	--ÄÚÁ¦
	local nl = JY.Person[0]['ÄÚÁ¦']
	--×î´óÉúÃü
	local smmax = JY.Person[0]['ÉúÃü×î´óÖµ']
	--×î´óÄÚÁ¦
	local nlmax = JY.Person[0]['ÄÚÁ¦×î´óÖµ']
	--Í·Ïñ±êºÅ
	local hid = JY.Person[0]['°ëÉíÏñ']
	--ĞÕÃû
	local name = JY.Person[0]['ĞÕÃû']
	--ÖÜÄ¿
	local zm = JY.Base["ÖÜÄ¿"]..'ÖÜÄ¿'
	--ÄÚÁ¦ÊôĞÔ
	local sx = {'Òõ','Ñô','µ÷ºÍ','Ììî¸'}
	local sxcl = {LightPurple,C_CYGOLD,M_Gray,M_Red}
	--ÄÚÁ¦ÊôĞÔ
	local nlsx = sx[JY.Person[0]['ÄÚÁ¦ĞÔÖÊ']+1]
	local nlcl = sxcl[JY.Person[0]['ÄÚÁ¦ĞÔÖÊ']+1]
	--ÉúÃüÊı×Ö
	local smwz = sm..'/'..smmax
	--ÄÚÁ¦Êı×Ö
	local nlwz = nl..'/'..nlmax..'£¨'..nlsx..'£©'
	--ÒøÁ½
	local yl = CC.Gold
	--ÌìÊé
	local ts = JY.Base["ÌìÊéÊıÁ¿"]..'±¾'
	
	--ÄÑ¶È
	local tnd = math.fmod(JY.Base["ÄÑ¶È"],#MODEXZ2);
	if tnd == 0 then
		tnd = #MODEXZ2
	end
	tnd = MODEXZ2[tnd]
	
	--µ¥Í¨
	local yxms
	if JY.Base["µ¥Í¨"] == 0 then
		yxms = "ÆÕÍ¨"
	elseif JY.Base["µ¥Í¨"]==1 then
		yxms = "µ¥Í¨"
	else
		yxms = "ÓéÀÖ"
	end
	
	--Ê±¼ä
	local t = math.modf((lib.GetTime() - JY.LOADTIME) / 60000 + GetS(14, 2, 1, 4))
	local t1, t2 = 0, 0
	while t >= 60 do
		t = t - 60
		t1 = t1 + 1
	end
	
	t2 = t
	
	  --¹ö¶¯¼ÆÊ±×¨ÓÃ
	local t3 = math.modf((lib.GetTime() - JY.LOADTIME) / 60000 + GetS(14, 2, 1, 4))
	local t4, t5 = 0, 0
	while t3 >= 60 do
	t3 = t3 - 60
	t4 = t4 + 1
	end
	t5 = t3
	SetS(92,60,21,5,t4)
	SetS(92,60,22,5,t5)
	if GetS(92,60,23,5)==1 then
	SetS(92,60,24,5,t4)
	SetS(92,60,25,5,t5)
	SetS(92,60,23,5,0) 
	end
	if GetS(92,60,13,5)==0 and GetS(92,60,12,5)==1 then 
	local boss=JY.Person[GetS(92,60,16,5)]["ĞÕÃû"]
	local DD=JY.Scene[GetS(92,60,14,5)]["Ãû³Æ"]
	--lib.PicLoadCache(0,76*2,40, 110, 2, 256); 
	lib.LoadPNG(91,129*2,x8-40,y8-size2/2+115, 1);
	lib.LoadPNG(91,130*2,x8-15,y8-size2/2+110, 1);
	DrawString(x8,y8-size2/2+115, boss, C_RED, 20)
	DrawString(x8+85,y8-size2/2+115, "ÔÚ"..DD.."³öÏÖ£¡", M_YellowGreen, 20)

	end

	
	--Ê±¼äµ¥Í¨ÄÑ¶ÈĞÅÏ¢
	local xx1 = string.format("%2dÊ±%2d·Ö", t1, t2)
	local xx = tnd..'/'..yxms..'/'.."µÀµÂ"..JY.Person[0]['Æ·µÂ']
	if JY.Person[456]['ÂÛ½£½±Àø'] > 0 then
		xx = xx..'/'..'¼«ÏŞ'
	else
		xx = xx..'/'..'ÓÆÏĞ'
	end		
	lib.LoadPNG(91, 39*2, 0, 0, 1)
	--Í·ÏñÌùÍ¼
	lib.LoadPNG(1, hid*2, x3, y3, 2)
		
	--±³¾°Í¼
	lib.LoadPNG(91, 40*2, 0, 0, 1)
	--ÉúÃüÌõ
	lib.SetClip(x1-w,y1-h,(x1-w)+(w*2)*(sm/smmax),y1+h)
	lib.LoadPNG(91, 41*2, x1, y1, 2)
	lib.SetClip(0,0,0,0)
	--ÄÚÁ¦Ìõ
	lib.SetClip(x2-w,y2-h,(x2-w)+(w*2)*(nl/nlmax),y2+h)
	lib.LoadPNG(91, 42*2, x2, y2, 2)
	lib.SetClip(0,0,0,0)
	
	--ĞÕÃû
	DrawString(x4-string.len(name)/4*size-10,y4-size/2,name,C_BLACK,size)
	--ÖÜÄ¿
	DrawString(x5-string.len(zm)/4*size2-10,y5-size/2,zm,LightYellow2,size2)
	--ÉúÃü
	DrawString(x1-string.len(smwz)/4*size2,y1-size2/2,smwz,C_WHITE,size2)
	--ÄÚÁ¦
	DrawString(x2-string.len(nlwz)/4*size2,y2-size2/2,nlwz,nlcl,size2)
	--ÒøÁ½
	DrawString(x6,y6-size2/2,yl,C_WHITE,size2)
	--ÌìÊé
	DrawString(x7,y7-size2/2,ts,C_WHITE,size2)
	--Ê±¼äµ¥Í¨ÄÑ¶ÈĞÅÏ¢
	DrawString(x8+42,(y8-size2/2)-2,xx,C_WHITE,size2*0.95)
	--Ê±¼ä
	--[[local t =CC.weekday[os.date("%A", os.time())][1]
	DrawString(x8-40,y8-size2/2+55,os.date("%YÄê%mÔÂ%dÈÕ %H:%M ", os.time())..t,C_GOLD,size2*1.1)
	DrawString(x8-40,y8-size2/2+70,"ÓÎÏ·Ê±¼ä"..xx1,C_GOLD,size2*1.1)
	
	local t = math.modf((lib.GetTime() - JY.LOADTIME) / 60000 + GetS(14, 2, 1, 4))
	local dd, mm, yy = 1, 1, 1
	while t >= 360 do
	t = t - 360
	yy = yy + 1
	end

	while t >= 30 do
	t = t - 30
	mm = mm + 1
	end 
	dd = dd + t
	JY.YEAR = yy
	JY.MONTH = mm
	JY.DAY = dd
	--DrawBox(x8-40,y8-size2/2+90, 255, 95, C_GOLD)
	
	
	DrawString(bx,y8-size2/2+90, year[yy][2].."Äê "..month[mm][2].." "..day[dd][2], M_Orange, 20)]]
	
	MMapName()
end

function Cat(s,...)
	if not Ct[s] then 
		lib.Debug('´íÎó£ºÎ´Öªº¯Êı')
	end
	return Ct[s](...)
end

function MJMenu() 
	local thing = {}
	local thingnum = {}
	for i = 0, CC.MyThingNum - 1 do
		thing[i] = -1
		thingnum[i] = 0
	end
	local num = 0
	for i = 0, CC.MyThingNum - 1 do
		local id = JY.Base["ÎïÆ·" .. i + 1]
		if id >= 0 then
			if JY.Thing[id]["ÀàĞÍ"] == 2 then
				thing[num] = id
				thingnum[num] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]
				num = num + 1
			end
		end 
	end

	IsViewingKungfuScrolls = 1

	local r = SelectThing(thing, thingnum)
	if r >= 0 then
		UseThing(r)
		return 1
	end
	return 0
end

function ThingMenu(flag)

		local thing = {}
		local thingnum = {}
		for i = 0, CC.MyThingNum - 1 do
			thing[i] = -1
			thingnum[i] = 0
		end
		local num = 0
		for i = 0, CC.MyThingNum - 1 do
			local id = JY.Base["ÎïÆ·" .. i + 1]
			if id >= 0 then
				if flag == nil then 
					thing[num] = id
					thingnum[num] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]
					num = num + 1
				else 	
					if JY.Thing[id]["ÀàĞÍ"] == flag then
						thing[num] = id
						thingnum[num] = JY.Base["ÎïÆ·ÊıÁ¿" .. i + 1]
						num = num + 1
					end
				end
			end 
		end

		--IsViewingKungfuScrolls = 1

		local r = SelectThing(thing, thingnum)
		if r >= 0 then
			UseThing(r)	
			return 1
		end
		return 0
end

function Team(tab)
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont*0.7
	local size1 = CC.DefaultFont*0.6
	local size2 = CC.DefaultFont*0.55
	local cont = 1 
	local cont1 = 0
	local tru = 0
	local p = JY.Person
	local px = 0
	while true do 
		Cls()
		if JY.Restart == 1 then
			break
		end
		local menu = {} 
		local maxn = 6
		local i = 0
		for ii = 1,CC.TeamNum do 
			if JY.Base['¶ÓÎé'..ii] >= 0 then 
				menu[#menu+1] = {p[JY.Base['¶ÓÎé'..ii]]['ĞÕÃû'],JY.Base['¶ÓÎé'..ii]}
			end
		end
		if maxn > #menu then 
			maxn = #menu 
		end	 
		lib.PicLoadCache(92,9*2,0,0,1,nil,nil,bx*1360)

		for ii = 1,maxn do 
			local h = 0
			local pyx = 0
			if CC.Png[p[menu[ii+cont1][2]]['°ëÉíÏñ']] ~= nil then 
				pyx = CC.Png[p[menu[ii+cont1][2]]['°ëÉíÏñ']]
			end
			
			local sm = p[menu[ii+cont1][2]]['ÉúÃü']
			local smmax = p[menu[ii+cont1][2]]['ÉúÃü×î´óÖµ']
			local nl = p[menu[ii+cont1][2]]['ÄÚÁ¦']
			local nlmax = p[menu[ii+cont1][2]]['ÄÚÁ¦×î´óÖµ']
			local tl = p[menu[ii+cont1][2]]['ÌåÁ¦']
			local tlmax = 100
			
			lib.SetClip(bx*42+(ii-1)*bx*220, 0, bx*38+(ii-1)*bx*220+bx*197,by*768) --²Ëµ¥±³¾°Í¼
			lib.LoadPNG(90,p[menu[ii+cont1][2]]['°ëÉíÏñ']*2,bx*138+(ii-1)*bx*220-bx*pyx,by*250,2)
			lib.SetClip(0,0,0,0)
			
			lib.PicLoadCache(92,15*2,bx*138+(ii-1)*bx*220,by*425,2,256,nil,bx*170)
			
			DrawString(bx*138+(ii-1)*bx*220-string.len(menu[ii+cont1][1])*size/4,by*440,menu[ii+cont1][1],C_WHITE,size)
			if ii == cont or px == ii then 
				lib.PicLoadCache(92,10*2,bx*138+(ii-1)*bx*220, CC.ScreenH/2,2,256,nil,bx*200) --²Ëµ¥±³¾°Í¼
			end

			h = h + 1
			
			local tfid = menu[ii+cont1][2]
			if JY.Base['³©Ïë'] > 0 and tfid == 0 then 
				tfid = JY.Base['³©Ïë']
			end	
			if RWWH[tfid] ~= nil then 
				DrawString(bx*60+(ii-1)*bx*220,by*440+h*by*30,'³ÆºÅ£º'..RWWH[tfid],LimeGreen,size)
			end
			
			h = h + 1
			
			if RWTFLB[tfid] ~= nil then 
				DrawString(bx*60+(ii-1)*bx*220,by*440+h*by*30,'Ìì¸³£º'..RWTFLB[tfid],LimeGreen,size)
			end
			
			h = h + 1
			
			lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,256,nil,bx*160)
			
			lib.SetClip(bx*138+(ii-1)*bx*220-bx*71, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(sm/smmax),by*450+h*by*30+size1/2+by*12)
			lib.PicLoadCache(92,12*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,150,nil,bx*160)
			lib.SetClip(0,0,0,0)

			DrawString(bx*70+(ii-1)*bx*220,by*450+h*by*30,'Ãü  '..p[menu[ii+cont1][2]]['ÉúÃü'],C_WHITE,size1)
			h = h + 1
			
			lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,256,nil,bx*160)
			lib.SetClip(bx*138+(ii-1)*bx*220-bx*71, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(nl/nlmax),by*450+h*by*30+size1/2+by*12)
			lib.PicLoadCache(92,13*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,150,nil,bx*160)
			lib.SetClip(0,0,0,0)

			DrawString(bx*70+(ii-1)*bx*220,by*450+h*by*30,'ÄÚ  '..p[menu[ii+cont1][2]]['ÄÚÁ¦'],C_WHITE,size1)
			h = h + 1
			
			lib.PicLoadCache(92,11*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,256,nil,bx*160)
			lib.SetClip(bx*138+(ii-1)*bx*220-bx*71, by*450+h*by*30+size1/2-by*12, bx*138+(ii-1)*bx*220-bx*71+bx*142*(tl/tlmax),by*450+h*by*30+size1/2+by*12)
			lib.PicLoadCache(92,14*2,bx*138+(ii-1)*bx*220,by*450+h*by*30+size1/2,2,150,nil,bx*160)
			lib.SetClip(0,0,0,0)

			DrawString(bx*70+(ii-1)*bx*220,by*450+h*by*30,'Ìå  '..p[menu[ii+cont1][2]]['ÌåÁ¦'],C_WHITE,size1)
		end
	  
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_SPACE or X == VK_RETURN then 
			tru = cont + cont1
			local id = JY.Base['¶ÓÎé'..tru]
			if tab ~= nil then
				if tab[1] == 'Àë¶Ó' then
					if tru > 1 then
						if JY.SubScene == 55 and JY.Base["¶ÓÎé" .. tru] == 35 then
						elseif JY.SubScene == 82 then	
						else
							local personid = JY.Base["¶ÓÎé" .. tru]
							if CC.PersonExit[personid] ~= nil then 
								local v = CC.PersonExit[personid]
								CallCEvent(v)
							end
							if JY.Base["³©Ïë"]==514 then		--615ĞŞ¸Ä
								instruct_21(personid)
								TalkEx(""..JY.Person[personid]["ĞÕÃû"].."£¬ÄãÏÈ»ØÑ©Óğ×Ú¡£ÓĞĞè*ÒªÊ±£¬ÎÒÔÙÈ¥ÕÒÄã°ïÃ¦¡£", 0, 2)  --¶Ô»°
							end
							cont = 1
							cont1 = 0
						end
					end
				elseif tab[1] == '×´Ì¬' then 
					--ShowPersonStatus(tru)
					PersonStatus(tru)
				elseif tab[1] == 'ÅÅĞò' then
					if px == 0 then
						if tru > 1 then 
							px = cont
						end
					else 
						if tru > 1 then
							JY.Base['¶ÓÎé'..tru] = JY.Base['¶ÓÎé'..px+cont1]
							JY.Base['¶ÓÎé'..px+cont1] = id
							px = 0
						end
					end
				end
			else 
				break
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			if tab ~= nil then
				if tab[1] == 'Àë¶Ó' then 
					
					return nil
				end
			end
			if px > 0 then 
				px = 0 
			else 
				break
			end
		elseif X == VK_LEFT then
			if cont1 > 0 then 
				if cont > 1 then 
					cont = cont - 1
				else 
					cont1 = cont1 - 1	  
				end	
			else
				cont = cont - 1		
				if cont < 1 then 
					cont = maxn
					cont1 = #menu - cont
				end
			end
		elseif X == VK_RIGHT then
			cont = cont + 1		
			if cont > maxn then 
				cont = maxn
				cont1 = cont1 + 1
			end
			if cont1 + cont > #menu then 
				cont1 = 0
				cont = 1
			end
		elseif X == VK_UP or ktype == 6 then
			cont1 = cont1 - maxn
			cont = 1
			if cont1 < 0 then 
				cont1 = 0 
			end
		elseif X == VK_DOWN or ktype == 7 then
			cont1 = cont1 + maxn
			cont = maxn
			if cont1 + cont > #menu then 
				cont1 = #menu-cont
			end	
		else 
			local mxx = false
			for ii = 1,maxn do 
				if mx >= bx*33+(ii-1)*bx*220 and mx <= bx*30+(ii-1)*bx*220+bx*197 and 
					my >= by*55 and my <= by*710 then 
					cont = ii
					mxx = true
					break
				end
			end		
			if ktype == 3 and mxx == true then 
				tru = cont + cont1
				local id = JY.Base['¶ÓÎé'..tru]
				if tab ~= nil then
			if tab[1] == 'Àë¶Ó' then
					if tru > 1 then
						if JY.SubScene == 55 and JY.Base["¶ÓÎé" .. tru] == 35 then
						elseif JY.SubScene == 82 then	
						else
							local personid = JY.Base["¶ÓÎé" .. tru]
							if CC.PersonExit[personid] ~= nil then 
								local v = CC.PersonExit[personid]
								CallCEvent(v)
							end
							if JY.Base["³©Ïë"]==514 then		--615ĞŞ¸Ä
								instruct_21(personid)
								TalkEx(""..JY.Person[personid]["ĞÕÃû"].."£¬ÄãÏÈ»ØÑ©Óğ×Ú¡£ÓĞĞè*ÒªÊ±£¬ÎÒÔÙÈ¥ÕÒÄã°ïÃ¦¡£", 0, 2)  --¶Ô»°
							end
							cont = 1
							cont1 = 0
						end
					end
					elseif tab[1] == '×´Ì¬' then 
						--ShowPersonStatus(tru)
						PersonStatus(tru)
					elseif tab[1] == 'ÅÅĞò' then
						if px == 0 then
							if tru > 1 then 
								px = cont
							end
						else 
							if tru > 1 then
								JY.Base['¶ÓÎé'..tru] = JY.Base['¶ÓÎé'..px+cont1]
								JY.Base['¶ÓÎé'..px+cont1] = id
								px = 0
							end
						end
					end
				else 
					break
				end
			end	
		end
	end  
	return tru
end

--±È½ÏÈËÎïµ±Ç°µÄÊıÖµ°Ù·Ö±È
function psxper(i,str,sz,flag) --flag 1´óÓÚ2Ğ¡ÓÚ3µÈÓÚ
	if i == nil or str == nil or sz == nil or flag == nil then
		return false
	end
	
	if JY.Status == GAME_WMAP then
		local id = WAR.Person[i]['ÈËÎï±àºÅ']
		if str == 'ÉúÃü' then
			if flag == 1 and psx(id,'ÉúÃü') > math.modf(psx(id,'ÉúÃü×î´óÖµ')*sz) then
				return true
			elseif flag == 2 and psx(id,'ÉúÃü') < math.modf(psx(id,'ÉúÃü×î´óÖµ')*sz) then
				return true
			elseif flag == 3 and psx(id,'ÉúÃü') == math.modf(psx(id,'ÉúÃü×î´óÖµ')*sz) then
				return true
			end
		end
		if str == 'ÄÚÁ¦' then
			if flag == 1 and psx(id,'ÄÚÁ¦') > math.modf(psx(id,'ÄÚÁ¦×î´óÖµ')*sz) then
				return true
			elseif flag == 2 and psx(id,'ÄÚÁ¦') < math.modf(psx(id,'ÄÚÁ¦×î´óÖµ')*sz) then
				return true
			elseif flag == 3 and psx(id,'ÄÚÁ¦') == math.modf(psx(id,'ÄÚÁ¦×î´óÖµ')*sz) then
				return true
			end
		end	
		if str == 'ÌåÁ¦' then
			if flag == 1 and psx(id,'ÌåÁ¦') > math.modf(100*sz) then
				return true
			elseif flag == 2 and psx(id,'ÌåÁ¦') < math.modf(100*sz) then
				return true
			elseif flag == 3 and psx(id,'ÌåÁ¦') == math.modf(100*sz) then
				return true
			end
		end
	else
		return false
	end	
	return false
end


function Hp_Max(id)
	local p = JY.Person[id]
	local kflvl = 0
	local wgwl = 0
	local wgwl1 = 0
	local wgwl2 = 0
	local tz = 0
	tz = p["ÉúÃüÔö³¤"] + limitX(math.modf(p['ÃÅÅÉ¼¼ÄÜ5'] *0.005),0,4)
	local xl = 8 - p["³©Ïë·Ö½×"]+1
	if tz < 1 then
		tz = 1
	end	
	if p["Ö÷ÔËÄÚ¹¦"] > 0 then
        local zy = p["Ö÷ÔËÄÚ¹¦"] 
		for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
			if p["Îä¹¦" .. i]== p["Ö÷ÔËÄÚ¹¦"] then
				kflvl = p["Îä¹¦µÈ¼¶" .. i]
				break
			end
		end
		if kflvl >= 1000 then
			kflvl = 11
		else
			kflvl = math.modf(kflvl/100)+1
		end
		wgwl2 = get_skill_power(id, p["Ö÷ÔËÄÚ¹¦"], kflvl)	
        if (id == 0 and (JY.Base["±ê×¼"] == 6  or  JY.Base["³©Ïë"] == 637 or  JY.Base["³©Ïë"] == 27 or JY.Base["³©Ïë"] == 189)) then
		    for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
				if p["Îä¹¦" .. i]== p["Ìì¸³ÄÚ¹¦"] then
					wgwl1 = get_skill_power(id, p["Ìì¸³ÄÚ¹¦"], kflvl)
				end
			end	
		end
		if wgwl1 < wgwl2 then
           wgwl = wgwl2
		else
           wgwl = wgwl1
		end		
        if wgwl < 500 then 
            wgwl = 500
        end
		if Curr_NG(id,160) and (match_ID(id,9991) or (PersonKF(id,108) and PersonKF(id,177))) then
			wgwl = wgwl + 500
		end
		if Curr_NG(id,102) and (match_ID(id,9927) or (PersonKF(id,97) and PersonKF(id,199))) then
			wgwl = wgwl + 500
		end
		if PersonKF(id,203) then
			if (Curr_NG(id,203) and PersonKF(id,248) and PersonKF(id,99)) or JXPD(id,505,1) or JXPD(id,578,1) then
				wgwl = wgwl + 500
			else
				wgwl = wgwl + 200
			end
		end	
		if MPTX(id,19) and Curr_NG(id,375) then
			wgwl = wgwl + math.modf(MPDJ(id) * 200)
		end	
		if inteam(id) == false then
			p["ÉúÃü×î´óÖµ"] = tz * p["µÈ¼¶"] * 7 + tz*(wgwl/7) + JY.Base["ÖÜÄ¿"]*JY.Base["ÄÑ¶È"]*xl
		else
			p["ÉúÃü×î´óÖµ"] = tz * p["µÈ¼¶"] * 7 + tz*(wgwl/7)
		end
		if MPPD(id) > 0 then
			local mptype = MPPD(id)
			p["ÉúÃü×î´óÖµ"] = math.modf(p["ÉúÃü×î´óÖµ"]*(CC.MPAttrib[mptype][8]))
		end
		if match_ID(id,9929) then
			p['ÉúÃü×î´óÖµ']  = p['ÉúÃü×î´óÖµ'] + 500
		end	
		p['ÉúÃü×î´óÖµ'] = math.modf(p['ÉúÃü×î´óÖµ'])	

		if p["ÉúÃü×î´óÖµ"] > 12000 then p["ÉúÃü×î´óÖµ"] = 12000 end 
		if p["ÉúÃü×î´óÖµ"] < 10 then p["ÉúÃü×î´óÖµ"] = 10 end
		if p["ÉúÃü"] >  p["ÉúÃü×î´óÖµ"] then
         	p["ÉúÃü"] =  p["ÉúÃü×î´óÖµ"]
		end
		if JY.Status ~= GAME_WMAP then
			AddPersonAttrib(id,'ÉúÃü',math.huge)
		else 
			p["ÉúÃü"] = limitX(p["ÉúÃü"],10,p["ÉúÃü×î´óÖµ"])
		end	
	else	
		if inteam(id) == false then
			p["ÉúÃü×î´óÖµ"] = tz * p["µÈ¼¶"] * 3 + JY.Base["ÖÜÄ¿"]*JY.Base["ÄÑ¶È"]*3
		else
			p["ÉúÃü×î´óÖµ"] = tz * p["µÈ¼¶"] * 3 
		end
		if id == 0 and JY.Base["±ê×¼"] == 6 then
            for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
                if p["Îä¹¦" .. i]== p["Ìì¸³ÄÚ¹¦"] then
                    kflvl = p["Îä¹¦µÈ¼¶" .. i]
                    break
                end
            end
            if kflvl >= 1000 then
                kflvl = 11
            else
                kflvl = math.modf(kflvl/100)+1
            end
		    wgwl = get_skill_power(id, p["Ìì¸³ÄÚ¹¦"], kflvl)
            if wgwl < 500 then 
                wgwl = 500
            end
            p["ÉúÃü×î´óÖµ"] = tz  * p["µÈ¼¶"]*5+tz*(wgwl/5)
		end
        if MPPD(id) > 0 then
			local mptype = MPPD(id)
			p["ÉúÃü×î´óÖµ"] = math.modf(p["ÉúÃü×î´óÖµ"]*(CC.MPAttrib[mptype][8]))
		end
		p['ÉúÃü×î´óÖµ'] = math.modf(p['ÉúÃü×î´óÖµ'])
		if p["ÉúÃü×î´óÖµ"] > 12000 then p["ÉúÃü×î´óÖµ"] = 12000 end	
		if p["ÉúÃü×î´óÖµ"] < 100 then p["ÉúÃü×î´óÖµ"] = 100 end
		if p["ÉúÃü"] >  p["ÉúÃü×î´óÖµ"] then
         	p["ÉúÃü"] =  p["ÉúÃü×î´óÖµ"]
		end
		if JY.Status ~= GAME_WMAP then
			AddPersonAttrib(id,'ÉúÃü',math.huge)
		else 
			p["ÉúÃü"] = limitX(p["ÉúÃü"],10,p["ÉúÃü×î´óÖµ"])
		end		
	end
end

function tgsave(flag)
	
	local tgjl = 0
	local tg = 0
	local tgsize = 0
	if flag == nil then
		if CC.Week < 101 then
			if JY.Base["ÖÜÄ¿"] == CC.Week then
				CC.Week = CC.Week + 100				
			end
		end
	end
	
	--CC.TGJL = {9973,9970,9972,9971,9996,9998,9987,9984,9968,9992}
	tg = #CC.TGJL
    
	tgjl = tgjl + tg

	tgjl = tgjl + #CC.commodity

	tgjl = tgjl + 4

	local size = (tgjl) * 4
	local data = Byte.create(size * 4)
	
	Byte.set32(data, 0, tgjl)
	--CC.Sp = JY.Base["ËéÆ¬"]
	Byte.set32(data, 4, CC.Sp)
	Byte.set32(data, 8, CC.Week)
	Byte.set32(data, 12, tg)
	tgsize = 16
	for i = 0,tg-1 do
		Byte.set32(data, tgsize, CC.TGJL[i+1]);
		tgsize = tgsize + 4
	end
	for i = 1,#CC.commodity do
		Byte.set32(data, tgsize, CC.commodity[i][3]);
        tgsize = tgsize + 4
		Byte.set32(data, tgsize, CC.commodity[i][5]);
        tgsize = tgsize + 4
	end
	Byte.savefile(data, CONFIG.DataPath..'TgJl', 0, size);

	CC.TJMSJ = {} 
	CC.TJM = 0
end

function tgload()

	local tgjl = 0
	local tg = 0
	local size = 0
	local tgsize = 0
	local fp_tmp=io.open(CONFIG.DataPath..'TgJl',"r");
	if fp_tmp then
		fp_tmp:close();
		
		local data_tgjl = Byte.create(4);
		Byte.loadfile(data_tgjl,CONFIG.DataPath..'TgJl', 0, 4);
		tgjl = Byte.get32(data_tgjl,0);
		size = (tgjl) * 4

		local data = Byte.create(size*4);
		Byte.loadfile(data,CONFIG.DataPath..'TgJl', 0, size);
		CC.Sp = Byte.get32(data,4);
		CC.Week = Byte.get32(data,8);
		tg = Byte.get32(data,12);
		tgsize = 16
		for i=1,tg do
			CC.TGJL[i]=Byte.get32(data, tgsize);
			tgsize = tgsize + 4
		end

		for i = 1,#CC.commodity do
			CC.commodity[i][3]=Byte.get32(data, tgsize);
            tgsize = tgsize + 4
			CC.commodity[i][5]=Byte.get32(data, tgsize);
			tgsize = tgsize + 4
		end

	end

end


function Weekload()
	local fp_tmp=io.open(CONFIG.DataPath..'TgJl',"r");
	if fp_tmp then
		fp_tmp:close();

		local data_Sp = Byte.create(4);
		Byte.loadfile(data_Sp,CONFIG.DataPath..'TgJl', 4, 4);
		CC.Sp = Byte.get32(data_Sp,0);

		local data_Week = Byte.create(4);
		Byte.loadfile(data_Week,CONFIG.DataPath..'TgJl', 8, 4);
		CC.Week = Byte.get32(data_Week,0);

	end
end



-- function GAME_START1()
	-- local bx = CC.ScreenW/1360
	-- local by = CC.ScreenH/768
    -- local tb = 1
    -- local page = 1
    -- local size = CC.DefaultFont*0.7
    -- JY.Base["ÄÑ¶È"] = 1
	-- local m = { {'ÖÜÄ¿Ñ¡Ôñ','ÖÜÄ¿ÉÌµê'},
                -- {'ÆÕÍ¨','µ¥Í¨','ÓéÀÖ'},
                -- {'¼òµ¥','ÆÕÍ¨','À§ÄÑ','µØÓü'},
                -- {'ÏÂÒ»²½'},
                -- }
    -- local sz = {{582,161,180},
                -- {556,328,120},
                -- {518,489,105},
                -- {818,656,0},
                -- }        

    -- local sm = {'£×ÎÒ·½¶ÓÓÑ¿ÉÒÔ²Î¼ÓÕ½¶·£¬ÎÒ·½Õ½³¡ÉÏ³¡ÈËÎïÎª6ÈË£Ò¡¾ÌáÊ¾£º´ËÄ£Ê½ÎªÕı³£Ä£Ê½£¬Ò»ÇĞÒÔ´ËÄ£Ê½Îª»ù×¼¡¿',
                -- '£×ËùÓĞÕ½¶·Ö»ÓĞÖ÷½Ç¿ÉÒÔ²ÎÕ½£Ò¡¾Ö£ÖØÌáÊ¾£º´ËÄ£Ê½Îª×ÔÅ°Ä£Ê½£¬ÈôÊÇÔì³ÉÎŞ·¨ÓÎÏ·µÄºó¹û£¬Çë×ÔĞĞµ÷ÕûÄ£Ê½¡£¸½£º¡°´ËÄ£Ê½¶ûµÈÎŞÈËÈ¨£¬ÇëÎñBB¡±¡¿',
                -- '£×ËùÓĞÕ½¶·Ö»ÓĞÖ÷½Ç¿ÉÒÔ²ÎÕ½£¬µ«ÊÇÖ÷½ÇÏíÓĞ¶ÓÎéÀï¶ÓÓÑµÄËùÓĞÌì¸³£Ò¡¾ÌáÊ¾£º´ËÄ£Ê½ÎªÓéÀÖÄ£Ê½£¬ÇëÎğìÅÒ«¡¿'
				-- }
    -- local zmmax = CC.Week
    -- local w = math.modf(bx*350/size/0.96)
	-- while true do 
        -- if JY.Restart == 1 then
            -- break
        -- end	
		-- ClsN()
        -- local zm = JY.Base["ÖÜÄ¿"]
        -- if page ==2 then 
            -- lib.LoadPNG(91,48*2,0,0,1)
            -- tjm(bx*52+bx*212,by*108+by*33.5,sm[tb],C_WHITE,size*0.96,w,size*1.6)
        -- else
            -- lib.LoadPNG(91,44*2,0,0,1)
            -- DrawString(bx*159-string.len(zm)/4*size+bx*212,by*433-size/2+by*33.5,zm,C_RED,size)
            -- DrawString(bx*159-string.len(zmmax)/4*size+bx*212,by*468-size/2+by*33.5,zmmax,C_RED,size)
            -- DrawString(bx*150+bx*212,by*504-size/2+by*33.5,m[3][JY.Base["ÄÑ¶È"]],C_RED,size)
            -- DrawString(bx*150+bx*212,by*538-size/2+by*33.5,m[2][JY.Base["µ¥Í¨"]+1],C_RED,size)
        -- end
        
        -- for i = 1,#m do 
            -- for j = 1,#m[i] do
                -- local cl = M_Wheat
                -- local s = m[i][j]
                -- if page == i then
                    -- if tb == j then 
                        -- cl = C_RED
                    -- end
                -- end
                -- DrawString(bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3]+bx*212,by*sz[i][2]-size/2+by*33.5,s,cl,size)
            -- end
        -- end
        

        -- ShowScreen()
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if page == 1 then 
                -- if tb == 1 then 
                    -- JY.Base["ÖÜÄ¿"] = InputNum("Ñ¡ÔñÖÜÄ¿",1,zmmax);
                -- else
                 -- --   ZmShop()--zmStore()
                -- end
            -- elseif page == 2 then 
                -- JY.Base["µ¥Í¨"] = tb - 1
            -- elseif page == 3 then 
                -- JY.Base["ÄÑ¶È"] = tb
            -- elseif page == 4 then 
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then

		-- elseif X == VK_UP then
            -- page = page - 1 
            -- if page < 1 then 
                -- page = #m
            -- end
            -- tb = 1
        -- elseif X == VK_DOWN then
            -- page = page + 1 
            -- if page > #m then 
                -- page = 1
            -- end
            -- tb = 1
        -- elseif X == VK_LEFT then
            -- tb = tb - 1 
            -- if tb < 1 then 
                -- tb = #m[page]
            -- end
		-- elseif X == VK_RIGHT then
            -- tb = tb + 1 
            -- if tb > #m[page] then 
                -- tb = 1
            -- end
        -- else 
            -- local mxx = false
            
            -- if mx >= bx*530 and mx <= bx*638 and my >= by*145 and my <= by*180 then 
                -- page = 1 
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*708 and mx <= bx*816 and my >= by*145 and my <= by*180 then 
                -- page = 1 
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*512 and mx <= bx*600 and my >= by*312 and my <= by*345 then 
                -- page = 2
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*632 and mx <= bx*720 and my >= by*312 and my <= by*345 then 
                -- page = 2
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*753 and mx <= bx*841 and my >= by*312 and my <= by*345 then 
                -- page = 2
                -- tb = 3
                -- mxx = true
            -- end
            -- if mx >= bx*474 and mx <= bx*562 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*580 and mx <= bx*668 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*685 and mx <= bx*773 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 3
                -- mxx = true
            -- end
            -- if mx >= bx*790 and mx <= bx*878 and my >= by*473 and my <= by*506 then
                -- page = 3
                -- tb = 4
                -- mxx = true
            -- end
            -- if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                -- page = 4
                -- tb = 1
                -- mxx = true
            -- end
            -- if mxx == true and ktype == 3 then
                -- if page == 1 then 
                    -- if tb == 1 then 
                        -- JY.Base["ÖÜÄ¿"] = InputNum("Ñ¡ÔñÖÜÄ¿",1,zmmax);
                    -- else
                    -- --    ZmShop()--zmStore()
                    -- end
                -- elseif page == 2 then 
                    -- JY.Base["µ¥Í¨"] = tb - 1
                -- elseif page == 3 then 
                    -- JY.Base["ÄÑ¶È"] = tb
                -- elseif page == 4 then 
                    -- break
                -- end
            -- end
		-- end
	-- end

-- end

-- function GAME_START2()
	-- local bx = CC.ScreenW/1360
	-- local by = CC.ScreenH/768
	-- --local size = CC.DefaultFont
    -- local tb = 1
    -- local page = 1
    -- local size = CC.DefaultFont*0.7
	-- local p = JY.Person[0]
	-- local m = { {'ÒõĞÔ','ÑôĞÔ','µ÷ºÍ'},
                -- {'1-30','31-50','51-79','80-100'},
                -- {'ÏÂÒ»²½'},
                -- }
    -- local sz ={{520,327,155},
               -- {520,488,105},
		       -- {818,656,0},
                -- }  
    -- local nlsm = {
                    -- 'ÒõĞÔÄÚÁ¦ÔÚ¹¥»÷·½ÃæµÃÌì¶Àºñ£¬Ê±Ğò»ØÑª¡¢»ØÌåÄÜÁ¦Í»³ö¡£*½­ºşÖĞ´«ËµµÄÒõĞÔÄÚ¹¦Ö®×îÄªÊô¾ÅÒõÉñ¹¦£¬¸ßÁ¬»÷£¬¸ß±©»÷£¬¸ß±©»÷ÉËº¦£¬Ö»Òª³öÊÖ±ØÈÃ¶ÔÊÖÃ»ÓĞ»¹ÊÖÖ®Á¦£¬´îÅäÉÏÄæÔËÕæ¾­£¬ÏÈÌì¹¦£¬·ÉÌìÉñĞĞµÈÎä¹¦ÈÃµĞÈËÎŞ´Ó·ÀÓù¡£*ÍÆ¼öÄÚ¹¦£º¾ÅÒõÉñ¹¦£¯ÄæÔËÉñ¹¦£¯ÏÈÌì¹¦£¯¾¨Ï¢¹¦£¯³¤Éú¾÷¡£*ÍÆ¼öÇá¹¦:ÉßĞĞÀê·­£¯ÌİÔÆ×İ£¯·ÉÌìÉñĞĞ',
                    -- 'ÑôĞÔÄÚÁ¦ÔÚ·ÀÓù·½Ãæ¸üÊ¤Ò»³ï£¬Ê±Ğò»ØÄÚ¡¢»Ø¸´³åÑ¨¡¢ÃâÒßÆÆÕÀ¡¢Á¬»÷¼õÉËµÈÄÜÁ¦Í»³ö¡£*½­ºşÖĞ´«ËµµÄÑôĞÔÄÚ¹¦Ö®×îÄªÊô¾ÅÑôÉñ¹¦£¬´îÅäÉÏè¤Ù¤Éñ¹¦£¬ÁúÏó°ãÈô¹¦£¬½ğÑã¹¦£¬Ç¬À¤´óÅ²ÒÆµÈÈÃ·ÀÓù¹ÌÈô½ğÌÀ¡£',               
                    -- 'µ÷ºÍÄÚÁ¦ÊÇĞĞ×ß½­ºşµÄÍò½ğÓÍ£¬ÉÙÁÖËÂ¾øÑ§ÄÚ¹¦¡¶Ò×½î¾­¡·Ò×½îìÑ¹Ç£¬²»µ«ÄÜÔö¼ÓÈËÎïÈıÎ§ÊôĞÔ£¬ÓëÂŞºº·üÄ§¹¦¡¢½ğ¸Õ²»»µÉñ¹¦Ò»ÆğĞŞÁ¶¸üÓĞÌØ¶ÀÃî´¦¡£¹¥»÷Óë·ÀÓù¶¼ÓĞ²»Ë×±íÏÖ¡£',  
                    -- }

    -- local zzsm = {'ÌØÊâÎä¹¦£ºÌ«ĞşÉñ¹¦£¬×óÓÒ»¥²«',
                 -- 'ÌØÊâÎä¹¦£º×óÓÒ»¥²«',
                 -- 'ÌØÊâÎäÑ§£ºÖĞÓ¹Ö®µÀ',
                 -- 'ÌØÊâÎäÑ§£ºÌ«¼«Éñ¹¦¡¢¶·×ªĞÇÒÆ',
                 -- }
    -- p["ÄÚÁ¦ĞÔÖÊ"] = 0
    -- local w = math.modf(bx*333/size)
	-- while true do 
        -- if JY.Restart == 1 then
            -- break
        -- end	
		-- ClsN()
        -- local zz = JY.Person[0]["×ÊÖÊ"]
	 
        -- lib.LoadPNG(91,45*2,0,0,1)
        -- for i = 1,#m do 
            -- for j = 1,#m[i] do
                -- local cl = M_Wheat
                -- local s = m[i][j]
                -- if page == i then
                    -- if tb == j then 
                        -- cl = C_RED
                    -- end
                -- end
                -- DrawString(bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3]+bx*212,by*sz[i][2]-size/2+by*33.5,s,cl,size)
            -- end
        -- end
        -- DrawString(bx*70+bx*212,by*99+by*33.5,"ÄÚÁ¦ĞÔÖÊ",M_Wheat,size)
        -- DrawString(bx*70+size*5+bx*212,by*99+by*33.5,m[1][p["ÄÚÁ¦ĞÔÖÊ"]+1],C_RED,size)
        
        -- DrawString(bx*260+bx*212,by*97+by*33.5,'×ÊÖÊ',M_Wheat,size)
		-- DrawString(bx*260+size*3+bx*212,by*97+by*33.5,zz,C_RED,size)
        
        -- local n = 0
        -- if page == 1  then
            -- n = tjm(bx*68+bx*212,by*130+by*33.5,nlsm[tb],C_WHITE,size,w,size)
        -- else 
            -- n = tjm(bx*68+bx*212,by*130+by*33.5,nlsm[p["ÄÚÁ¦ĞÔÖÊ"]+1],C_WHITE,size,w,size)
        -- end
        -- n = n + 1
        -- for i = 1,#zzsm do 
            -- DrawString(bx*68+bx*212,by*130+(n+i-1)*size+by*33.5,zzsm[i],M_Wheat,size)
        -- end
        -- ShowScreen()
       
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if page == 1 then   
                 -- p["ÄÚÁ¦ĞÔÖÊ"] = tb - 1
            -- elseif page == 2 then 
				-- if tb == 1 then
					-- JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",1,30)					
				-- elseif tb == 2 then
					-- JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",31,50)
				-- elseif tb == 3 then
					-- JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",51,79)  
				-- elseif tb == 4 then
					-- JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",80,100)					
				-- end
            -- elseif page == 3 then 
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then

		-- elseif X == VK_UP then
            -- page = page - 1 
            -- if page < 1 then 
                -- page = #m
            -- end
            -- tb = 1
        -- elseif X == VK_DOWN then
            -- page = page + 1 
            -- if page > #m then 
                -- page = 1
            -- end
            -- tb = 1	
        -- elseif X == VK_LEFT then
            -- tb = tb - 1 
            -- if tb < 1 then 
                -- tb = #m[page]
            -- end
		-- elseif X == VK_RIGHT then
            -- tb = tb + 1 
            -- if tb > #m[page] then 
                -- tb = 1
            -- end
        -- else 
            -- local mxx = false
            
            -- if mx >= bx*475+bx*212 and mx <= bx*565+bx*212 and my >= by*313+by*33.5 and my <= by*345+by*33.5 then 
                -- page = 1 
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*630+bx*212 and mx <= bx*720+bx*212 and my >= by*313+by*33.5 and my <= by*345+by*33.5 then 
                -- page = 1 
                -- tb = 2
                -- mxx = true
            -- end
            -- if mx >= bx*785+bx*212 and mx <= bx*875+bx*212 and my >= by*313+by*33.5 and my <= by*345+by*33.5 then 
                -- page = 1
                -- tb = 3
                -- mxx = true
            -- end		
            -- if mx >= bx*477+bx*212 and mx <= bx*567+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then 
                -- page = 2
                -- tb = 1
                -- mxx = true
            -- end
            -- if mx >= bx*581+bx*212 and mx <= bx*671+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then
                -- page = 2
                -- tb = 2
                -- mxx = true
            -- end			
            -- if mx >= bx*688+bx*212 and mx <= bx*778+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then
                -- page = 2
                -- tb = 3
                -- mxx = true
            -- end
            -- if mx >= bx*788+bx*212 and mx <= bx*878+bx*212 and my >= by*473+by*33.5 and my <= by*505+by*33.5 then
                -- page = 2
                -- tb = 4
                -- mxx = true
            -- end
            -- if mx >= bx*742+bx*212 and mx <= bx*896+bx*212 and my >= by*638+by*33.5 and my <= by*673+by*33.5 then
                -- page = 3
                -- tb = 1
                -- mxx = true
            -- end
            -- if mxx == true and ktype == 3 then
               -- if page == 1 then 
                    -- if tb == 1 then
                       -- p["ÄÚÁ¦ĞÔÖÊ"] = 0
					-- elseif tb == 2 then
						   -- p["ÄÚÁ¦ĞÔÖÊ"] = 1				
					-- elseif tb == 3 then
                        -- p["ÄÚÁ¦ĞÔÖÊ"] = 2
				    -- end
               -- elseif page == 2 then 
				   -- if tb == 1 then
					   -- p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",1,30)
				   -- elseif tb == 2 then
					  -- p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",31,50)
				   -- elseif tb == 3 then
					   -- p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",51,79)  
				   -- elseif tb == 4 then
					   -- p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",80,100)					
				   -- end
               -- elseif page == 3 then 
                   -- break
               -- end
            -- end
		-- end
	-- end
-- end
--Ä£Ê½Ñ¡Ôñ
function Moshixz()
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	local zb  = {{187+100,373+50},{462+100,373+50},{737+100,373+50}}
	local tb = 1
	while true do 
		if JY.Restart == 1 then
			break
		end
		ClsN()
		lib.LoadPNG(91,1000*2,0,0,1)
		for i = 1,3 do
			lib.LoadPNG(91,(171+i-1)*2,zb[i][1],zb[i][2],1)
			if tb == i then
				lib.LoadPNG(91,(174+i-1)*2,zb[i][1],zb[i][2],1)
				lib.LoadPNG(91,112*2,zb[i][1]-5,zb[i][2]-3,1)
			end
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X, ktype, mx, my = lib.GetKey();	
		if X == VK_ESCAPE or ktype == 4 then
			break
		elseif X == VK_SPACE or X == VK_RETURN then
			break
		elseif X == VK_LEFT or X == VK_UP then
			tb = tb - 1
			if tb < 1 then
				tb = 3
			end
			JY.Base["±¸ÓÃ5"] = tb - 1
		elseif X== VK_RIGHT or X == VK_DOWN then
			tb = tb + 1
			if tb > 3 then
				tb = 1
			end
			JY.Base["±¸ÓÃ5"] = tb - 1
		else
			local mxx = false
			local x1 = 236
			local y1 = 112	
			local sb = 0							
			for i = 1,3 do
				sb = i
				if mx >= bx*zb[i][1] and mx <= bx*zb[i][1] + bx*x1 and my >= by*zb[i][2] and my <= by*zb[i][2]+by*y1 then	
					tb = sb
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then
				JY.Base["±¸ÓÃ5"] = tb - 1
				break
			end
		end
	end
end	

function GAME_START1()
	-- local bx = CC.WX
	-- local by = CC.HY
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
    local tb = 1
    local page = 1
    local size = CC.DefaultFont*0.7
    JY.Base["ÄÑ¶È"] = 1
	local m = { {'ÖÜÄ¿','ÉÌµê'},
                {'ÆÕÍ¨','µ¥Í¨','ÓéÀÖ'},
                {'¼òµ¥','ÆÕÍ¨','À§ÄÑ','µØÓü'},
                {'ÏÂÒ»²½'},
				}
	local ax,ay = 210,35
    local sz = {{582+ax,161+ay,180},
                {556+ax,328+ay,120},
                {518+ax,489+ay,105},
                {818+ax,656+ay,0},
                }        
    local sm1 = "ÔÚ¿ªÊ¼ÓÎÏ·Ö®Ç°£¬¿ÉÑ¡Ôñ±¾´ÎÓÎÏ·µÄÖÜÄ¿£¬µØÓü±ê×¼ÖÜÄ¿Îª10ÖÜÄ¿¡£¡ñ×¢Òâ£ºµØÓüÄÑ¶È10ÖÜÄ¿ÒÔÉÏ£¬Ã¿ÖÜÄ¿NPCÔöÇ¿ÌØÊâĞ§¹û¡£".."*".."¡ñÎä¹¦×î´óÉÏÏŞ15¸ö"
    local sm2 = "µ±Ç°ÖÜÄ¿£º".."*".."×î´óÖÜÄ¿£º".."*".."µ±Ç°ÄÑ¶È£º".."*".."µ±Ç°Ä£Ê½£º"
    local sm = {'£×ÎÒ·½¶ÓÓÑ¿ÉÒÔ²Î¼ÓÕ½¶·£¬ÎÒ·½Õ½³¡ÉÏ³¡ÈËÎïÎª6ÈË',
                '£×È«Õ½¶·½öÖ÷½Ç¿ÉÒÔ²ÎÕ½¡±',
                '£×È«Õ½¶·½öÖ÷½Ç¿ÉÒÔ²ÎÕ½£¬µ«¿ÉÏíÓĞ¶ÓÎéÀï¶ÓÓÑµÄËùÓĞÌì¸³'
				}
    local zmmax = CC.Week
    --local sm3 = zm.."*"..zmmax.."*"..m[3][JY.Base["ÄÑ¶È"]].."*"..m[2][JY.Base["µ¥Í¨"]+1]
	local w = math.modf(bx*350/size/0.96)
	
	while true do 
        if JY.Restart == 1 then
            break
        end	
		ClsN()
		local zm = JY.Base["ÖÜÄ¿"]  --267 443
		local cx,cy = bx*sz[1][1] - bx*520,by*sz[1][2]+by*203
		local sm3 = zm.."*"..zmmax.."*"..m[3][JY.Base["ÄÑ¶È"]].."*"..m[2][JY.Base["µ¥Í¨"]+1]
		lib.LoadPNG(91,48*2,0,0,1)
		tjm(bx*166,by*150,sm1,C_GOLD,size*0.9,w,size*1.65)
		tjm(bx*166,by*350,sm2,C_WHITE,size*0.9,w,size*1.65)
		tjm(bx*166,by*500,"Ä£Ê½ËµÃ÷£º"..sm[JY.Base["µ¥Í¨"]+1],C_WHITE,size*0.9,w,size*1.65)
		tjm(bx*280,by*350,sm3,C_RED,size*0.9,w,size*1.65)
		--DrawString(cx-string.len(zm)/4*size,cy,zm,C_RED,size)
		--DrawString(cx-string.len(zmmax)/4*size,cy+size*1.6,zmmax,C_RED,size)
		--DrawString(cx-size*0.9,cy+size*3.1,m[3][JY.Base["ÄÑ¶È"]],C_RED,size)
		--DrawString(cx-size*0.9,cy+size*4.6,m[2][JY.Base["µ¥Í¨"]+1],C_RED,size)
		for i = 1,#m do 
			
			for j = 1,#m[i] do
				
                local cl = M_Wheat
                local s = m[i][j]
                if page == i then
                    if tb == j then 
                        cl = C_RED
                    end
				end
				lib.LoadPNG(91,21*2,bx*sz[i][1]+ (j-1)*bx*sz[i][3]-bx*44,by*sz[i][2]-size/2-by*5,1)
                DrawString(bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3],by*sz[i][2]-size/2,s,cl,size)
            end
        end
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if page == 1 then 
                if tb == 1 then 
                    JY.Base["ÖÜÄ¿"] = InputNum("Ñ¡ÔñÖÜÄ¿",1,zmmax);
                else
                    ZmShop()--zmStore()
                end
            elseif page == 2 then 
                JY.Base["µ¥Í¨"] = tb - 1
            elseif page == 3 then 
                JY.Base["ÄÑ¶È"] = tb
            elseif page == 4 then 
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)

		elseif X == VK_UP then
			PlayWavE(77)
            page = page - 1 
            if page < 1 then 
                page = #m
            end
            tb = 1
		elseif X == VK_DOWN then
			PlayWavE(77)
            page = page + 1 
            if page > #m then 
                page = 1
            end
            tb = 1
		elseif X == VK_LEFT then
			PlayWavE(77)
            tb = tb - 1 
            if tb < 1 then 
                tb = #m[page]
            end
		elseif X == VK_RIGHT then
			PlayWavE(77)
            tb = tb + 1 
            if tb > #m[page] then 
                tb = 1
            end
        else 
			local mxx = false --55 8
			local jh = 15
			for i = 1,2 do
				if mx >= bx*sz[1][1] - bx*55 + (i-1)*sz[1][3] and mx <= bx*sz[1][1]+bx*55  + (i-1)*sz[1][3]  and my >= by*sz[1][2] - by*jh and my <= by*sz[1][2]+by*jh then 
					page = 1 
					tb = i
					mxx = true
					break
				end
			end
			for i = 1,3 do
				if mx >= bx*sz[2][1] - bx*55 + (i-1)*sz[2][3] and mx <= bx*sz[2][1]+bx*55  + (i-1)*sz[2][3]  and my >= by*sz[2][2] - by*jh and my <= by*sz[2][2]+by*jh then 
					page = 2 
					tb = i
					mxx = true
					break
				end
			end	
			for i = 1,4 do
				if mx >= bx*sz[3][1] - bx*55 + (i-1)*sz[3][3] and mx <= bx*sz[3][1]+bx*55  + (i-1)*sz[3][3]  and my >= by*sz[3][2] - by*jh and my <= by*sz[3][2]+by*jh then 
					page = 3 
					tb = i
					mxx = true
					break
				end
			end
			if mx >= bx*sz[4][1] - bx*55 and mx <= bx*sz[4][1]+bx*55  and my >= by*sz[4][2] - by*jh and my <= by*sz[4][2]+by*jh then 
                page = 4
                tb = 1
                mxx = true
            end
			if mxx == true and ktype == 3 then
				PlayWavE(77)
                if page == 1 then 
                    if tb == 1 then 
                        JY.Base["ÖÜÄ¿"] = InputNum("Ñ¡ÔñÖÜÄ¿",1,zmmax);
                    else
                        ZmShop()--zmStore()
                    end
                elseif page == 2 then 
                    JY.Base["µ¥Í¨"] = tb - 1
                elseif page == 3 then 
                    JY.Base["ÄÑ¶È"] = tb
                elseif page == 4 then 
                    break
                end
            end
		end
	end

end

function GAME_START2()
	-- local bx = CC.WX
	-- local by = CC.HY
	local id = JY.Base["³©Ïë"]
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	--local size = CC.DefaultFont
    local tb = 1
    local page = 1
    local size = CC.DefaultFont*0.7
	local p = JY.Person[0]
	local m = { {'ÒõĞÔ','ÑôĞÔ','µ÷ºÍ'},
				{'1-30','31-50','51-79','80-100'},
				{'´øÎä¹¦',"ÎŞÎä¹¦"},
				{'´øÃÅÅÉ',"ÎŞÃÅÅÉ"},
                {'ÏÂÒ»²½'},
                }
    local sz ={ {536,170,140}, -- {}
			   {512,325,105},
			   {584,473,178},
			   {584,616,178},
			   {818,648,0},
				}
	JY.Person[0]['ÃÅÅÉ'] = MPPD(id)
	JY.Person[0]['ÃÅÅÉÎ»½×'] = MPDJ(id)
	--local bbzb = {{590,591},{762,591}}			
    local nlsm = {
                    'ÒõĞÔÄÚÁ¦ÔÚ¹¥»÷·½ÃæµÃÌì¶Àºñ£¬Ê±Ğò»ØÑª¡¢»ØÌåÄÜÁ¦Í»³ö¡£*½­ºşÖĞ´«ËµµÄÒõĞÔÄÚ¹¦Ö®×îÄªÊô¾ÅÒõÉñ¹¦£¬¸ßÁ¬»÷£¬¸ß±©»÷£¬¸ß±©»÷ÉËº¦£¬Ö»Òª³öÊÖ±ØÈÃ¶ÔÊÖÃ»ÓĞ»¹ÊÖÖ®Á¦£¬´îÅäÉÏÄæÔËÕæ¾­£¬ÏÈÌì¹¦£¬·ÉÌìÉñĞĞµÈÎä¹¦ÈÃµĞÈËÎŞ´Ó·ÀÓù¡£',
                    'ÑôĞÔÄÚÁ¦ÔÚ·ÀÓù·½Ãæ¸üÊ¤Ò»³ï£¬Ê±Ğò»ØÄÚ¡¢»Ø¸´³åÑ¨¡¢ÃâÒßÆÆÕÀ¡¢Á¬»÷¼õÉËµÈÄÜÁ¦Í»³ö¡£*½­ºşÖĞ´«ËµµÄÑôĞÔÄÚ¹¦Ö®×îÄªÊô¾ÅÑôÉñ¹¦£¬´îÅäÉÏè¤Ù¤Éñ¹¦£¬ÁúÏó°ãÈô¹¦£¬½ğÑã¹¦£¬Ç¬À¤´óÅ²ÒÆµÈÈÃ·ÀÓù¹ÌÈô½ğÌÀ¡£',               
                    'µ÷ºÍÄÚÁ¦ÊÇĞĞ×ß½­ºşµÄÍò½ğÓÍ£¬ÉÙÁÖËÂ¾øÑ§ÄÚ¹¦¡¶Ò×½î¾­¡·Ò×½îìÑ¹Ç£¬²»µ«ÄÜÔö¼ÓÈËÎïÈıÎ§ÊôĞÔ£¬ÓëÂŞºº·üÄ§¹¦¡¢½ğ¸Õ²»»µÉñ¹¦Ò»ÆğĞŞÁ¶¸üÓĞÌØ¶ÀÃî´¦¡£¹¥»÷Óë·ÀÓù¶¼ÓĞ²»Ë×±íÏÖ¡£',  
                    }

    local zzsm = {'ÌØÊâÎä¹¦£ºÌ«ĞşÉñ¹¦£¬×óÓÒ»¥²«',
                 'ÌØÊâÎä¹¦£º×óÓÒ»¥²«',
                 'ÌØÊâÎäÑ§£ºÖĞÓ¹Ö®µÀ',
                 'ÌØÊâÎäÑ§£ºÌ«¼«Éñ¹¦¡¢¶·×ªĞÇÒÆ',
				 }
    --local bbsm = {'ÓĞ¿ì½İÁ·¹¦£¬¿ìËÙĞŞÁ¶Îä¹¦£¬Âí³µ´«ËÍ¡£',
     --            'ÎŞ¿ì½İÁ·¹¦£¬ÎŞËÙĞŞÁ¶Îä¹¦£¬ÎŞÂí³µ´«ËÍ£¬ÍêÈ«ÌåÑéÌ½Ë÷Ã°ÏÕµÄÀÖÈ¤Óë³É¾Í¡£',
      --           }				 
	p["ÄÚÁ¦ĞÔÖÊ"] = 0
	
    local w = math.modf(bx*333/size)
	local wg1 = JY.Person[0]["Îä¹¦" .. 1]
	local wg2 = JY.Person[0]["Îä¹¦" .. 2]
	
	
	
	while true do 
        
        if JY.Restart == 1 then
            break
        end	
		ClsN()
        local zz = JY.Person[0]["×ÊÖÊ"]
		
		--JY.Wugong[wugong]["Ãû³Æ"]
		--for wg = 1,JY.Base["Îä¹¦ÊıÁ¿"] do
			--wg1 = JY.Wugong[JY.Person[0]["Îä¹¦" .. 1]]["Ãû³Æ"]
			--wg2 = JY.Wugong[JY.Person[0]["Îä¹¦" .. 2]]["Ãû³Æ"]			
		--end	

        lib.LoadPNG(91,45*2,0,0,1)
        for i = 1,#m do 
            for j = 1,#m[i] do
                local cl = M_Wheat
                local s = m[i][j]
                if page == i then
                    if tb == j then 
                        cl = C_RED
                    end
				end
				if s == "ÏÂÒ»²½" then
					lib.LoadPNG(91,21*2,bx*212+bx*sz[i][1]+(j-1)*bx*sz[i][3],by*sz[i][2]*1.1,2)
	                DrawString(bx*212+bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3],(by*sz[i][2]-size/2)*1.1,s,cl,size)
				else	
					lib.LoadPNG(91,21*2,bx*212+bx*sz[i][1]+(j-1)*bx*sz[i][3],by*sz[i][2],2)
	                DrawString(bx*212+bx*sz[i][1]-string.len(s)/4*size + (j-1)*bx*sz[i][3],by*sz[i][2]-size/2,s,cl,size)
	            end 
            end
		end
		local n = 1
		DrawString(bx*74+size*3,by*99+size,"ÄÚÁ¦ĞÔÖÊ£º",C_WHITE,size)
        DrawString(bx*70+size*5,by*99+size,"      "..m[1][p["ÄÚÁ¦ĞÔÖÊ"]+1],C_RED,size)
        DrawString(bx*260+size*3,by*97+size,"×ÊÖÊ:",C_WHITE,size)
		DrawString(bx*260+size*3,by*97+size,"      "..zz,C_RED,size)
		n = n + 1
   
        if page == 1  then
            n = tjm(bx*148,by*130+(n)*size,nlsm[tb],C_WHITE,size,w,size)
        else 
            n = tjm(bx*148,by*130+(n)*size,nlsm[p["ÄÚÁ¦ĞÔÖÊ"]+1],C_WHITE,size,w,size)
        end
        n = n + 1
        for i = 1,#zzsm do 
            DrawString(bx*148,by*150+(n+i-1)*size,zzsm[i],M_Wheat,size)
		end
		n = n + 1
		DrawString(bx*148,by*150+(n+3)*size,"³õÊ¼Îä¹¦£º",C_RED,size)
		n = n + 1
		DrawString(bx*148,by*150+(n+3)*size,JY.Wugong[JY.Person[0]["Îä¹¦" .. 1]]["Ãû³Æ"],M_Wheat,size)
		n = n + 1
		DrawString(bx*148,by*150+(n+3)*size,JY.Wugong[JY.Person[0]["Îä¹¦" .. 2]]["Ãû³Æ"],M_Wheat,size)	
		--n = n + 1
		--if JY.Base["µ¥Í¨"] == 1 and JY.Base["³©Ïë"] > 0  then
			local mptype,mpdj = "",""
			if MPPD(0) == nil or MPPD(0) < 1 then
				mptype = "½­ºşÈËÊ¿"
				mpdj = "ÎŞ"
			else
				mptype,mpdj = MPDISPLAY(id)
			end	
			n = n + 1
			DrawString(bx*148,by*150+(n+3)*size,"³õÊ¼ÃÅÅÉ£º",C_RED,size)
			n = n + 1
			DrawString(bx*148,by*150+(n+3)*size,"ÃÅÅÉÃû³Æ£º"..mptype,M_Wheat,size)
			n = n + 1
			DrawString(bx*148,by*150+(n+3)*size,"ÃÅÅÉÎ»½×£º"..mpdj,M_Wheat,size)	
			n = n + 1
		--end	
		ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if page == 1 then   
                 p["ÄÚÁ¦ĞÔÖÊ"] = tb - 1
            elseif page == 2 then 
				if tb == 1 then
					JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",1,30)					
				elseif tb == 2 then
					JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",31,50)
				elseif tb == 3 then
					JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",51,79)  
				elseif tb == 4 then
					JY.Person[0]["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",80,100)					
				end
			elseif page == 3 then
				if tb == 1 then									
					JY.Person[0]["Îä¹¦1"]=wg1
					JY.Person[0]["Îä¹¦2"]=wg2
					--JY.Person[0]["Îä¹¦µÈ¼¶1"]=999
					--JY.Person[0]["Îä¹¦µÈ¼¶2"]=999
				elseif tb == 2 then
					JY.Person[0]["Îä¹¦1"]=0
					JY.Person[0]["Îä¹¦2"]=0
				end	
			elseif page == 4 then 
					if tb == 1 then
						JY.Person[0]['ÃÅÅÉ'] = MPPD(id)
						JY.Person[0]['ÃÅÅÉÎ»½×'] = MPDJ(id)
					elseif tb == 2 then
						JY.Person[0]['ÃÅÅÉ'] = 0
						JY.Person[0]['ÃÅÅÉÎ»½×'] = 0
					end	
			elseif page == 5 then 
			   break
			end  
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)

		elseif X == VK_UP then
			PlayWavE(77)
            page = page - 1 
            if page < 1 then 
                page = #m
            end
            tb = 1
		elseif X == VK_DOWN then
			PlayWavE(77)
            page = page + 1 
            if page > #m then 
                page = 1
            end
            tb = 1	
		elseif X == VK_LEFT then
			PlayWavE(77)
            tb = tb - 1 
            if tb < 1 then 
                tb = #m[page]
            end
		elseif X == VK_RIGHT then
			PlayWavE(77)
            tb = tb + 1 
            if tb > #m[page] then 
                tb = 1
            end
        else 
			local mxx = false
			local cx = bx*90 
			local cy = by*34
			for i = 1,3 do
				local tx = bx*142*(i-1)				
				if mx >= bx*704 + tx  and mx <= bx*cx + bx*704 + tx and my >= by*153 and my <= by*185 then 
					page = 1 
					tb = i
					mxx = true
					break
				end
			end
			for i = 1,4 do
				local tx = bx*107*(i-1)	
				if mx >= bx*705 + tx and mx <= bx*705  + tx + cx and my >= by*308 and my <= by*308 + cy then
					page = 2
					tb = i
					mxx = true
					break
				end
			end
			for i = 1,2 do
				local tx = bx*179*(i-1)	
				if mx >= bx*753 + tx and mx <= bx*753 + tx + cx and my >= by*456 and my <= by*456 + cy then
					page = 3
					tb = i
					mxx = true
					break
				end
			end	
			for i = 1,2 do
				local tx = bx*179*(i-1)	
				if mx >= bx*753 + tx and mx <= bx*753 + tx + cx and my >= by*604 and my <= by*604 + cy then
					page = 4
					tb = i
					mxx = true
					break
				end
			end			
            if mx >= bx*986 and mx <= bx*986 + cx and my >= by*694 and my <= by*694 + cy then
                page = 5
                tb = 1
                mxx = true
            end		
            if 	ktype == 3 then
            	--
            end	
			if mxx == true and ktype == 3 then
				PlayWavE(77)
               if page == 1 then 
                    if tb == 1 then
                       p["ÄÚÁ¦ĞÔÖÊ"] = 0
					elseif tb == 2 then
						p["ÄÚÁ¦ĞÔÖÊ"] = 1				
					elseif tb == 3 then
                        p["ÄÚÁ¦ĞÔÖÊ"] = 2
				    end
               	elseif page == 2 then 
				   if tb == 1 then
					   p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",1,30)
				   elseif tb == 2 then
					  p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",31,50)
				   elseif tb == 3 then
					   p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",51,79)  
				   elseif tb == 4 then
					   p["×ÊÖÊ"] = InputNum("ÊäÈë×ÊÖÊ",80,100)					
				   end
				elseif page == 3 then
					if tb == 1 then
						JY.Person[0]["Îä¹¦1"]=wg1
						JY.Person[0]["Îä¹¦2"]=wg2
						--JY.Person[0]["Îä¹¦µÈ¼¶1"]=999
						--JY.Person[0]["Îä¹¦µÈ¼¶2"]=999
					elseif tb == 2 then
						JY.Person[0]["Îä¹¦1"]=0
						JY.Person[0]["Îä¹¦2"]=0
					end
               	elseif page == 4 then 
					
						if tb == 1 then
							JY.Person[0]['ÃÅÅÉ'] = MPPD(id)
							JY.Person[0]['ÃÅÅÉÎ»½×'] = MPDJ(id)
						elseif tb == 2 then
							JY.Person[0]['ÃÅÅÉ'] = 0
							JY.Person[0]['ÃÅÅÉÎ»½×'] = 0
						end	
				elseif page == 5 then 
			   		break
				end
            end
		end
	end
end
-- function TGTF()
    -- local bx = CC.ScreenW/1360
    -- local by = CC.ScreenH/768
    -- local cot = 1
    -- local cot1 = 0
    -- local cot2 = 0
    -- local size = CC.DefaultFont*0.7
    -- local maxn = 7
    -- local page = 1
    -- local jl = 0
    -- local menu = {}
    -- local w = math.modf(bx*218/size)
	-- --if existFile(CONFIG.DataPath..'TgJl') then
	-- --	tgload()
			
    -- -- for i = 1,#CC.TGJL do
        -- -- menu[#menu+1] = CC.TGJL[i]
    -- -- end
		
    -- -- if #menu <= 0  then
        -- -- return   
    -- -- end
	-- --end
    -- --menu = {9999,9998,9997,9996,9995,9994,9993,9992,9991,9990,9988,9987,9986,9985,9984}
	-- menu = {9970,9971,9972,9973,9955,9954,9953,9952,9951}
    -- menu[#menu+1] = -1
    -- local max = math.ceil((#menu-1)/4)
    -- if maxn > max then 
        -- maxn = max
    -- end
   
    -- while true do
	   -- if JY.Restart == 1 then
            -- break
       -- end	
        -- ClsN()
        -- lib.LoadPNG(91,46*2,0,0,1)
        -- for i = 1,4 do 
            -- for j = 1,maxn do
                -- local tf = i + (j-1+cot2)*4
                -- local sm = CC.PTFSM[menu[tf]]
                -- local cl = M_Wheat
                -- if tf == cot + cot1*4 then 
                    -- cl = C_RED
                -- end 
                -- if sm ~= nil then
                    -- lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150+bx*212,by*100+(j-1)*by*63+by*33.5,2)
                    -- DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size+bx*212,by*99+(j-1)*by*63-size/2+by*33.5,sm[1],cl,size)
                -- end
            -- end
        -- end
        
        -- local n = 0
        -- local dtf = 'ÎŞ'
        -- local xtf = 'ÎŞ'
        
        -- DrawString(bx*63+bx*212,by*100-size/2+by*33.5,'ÒÑÑ¡Ìì¸³',M_Wheat,size)
        
        -- if jl > 0 then 
            -- if CC.PTFSM[jl] ~= nil then 
                -- local ptf = CC.PTFSM[jl][2]
                -- dtf = CC.PTFSM[jl][1]
                -- if ptf ~= nil then 
                    -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,ptf,C_WHITE,size,w,size)
                -- end   
            -- end
        -- else 
            -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,'Ã»ÓĞÌì¸³',C_WHITE,size,w,size)
        -- end
        -- n = n + 2
        -- DrawString(bx*190+bx*212,by*100-size/2+by*33.5,dtf,C_RED,size)
        
        -- if cot + cot1*4 == #menu then 
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'ÏÂÒ»²½',C_RED,size)
        -- else    
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'ÏÂÒ»²½',M_Wheat,size)
        -- end
        
        -- DrawString(bx*63+bx*212,by*100-size/2+ size + n*size+by*33.5,'µ±Ç°Ìì¸³',M_Wheat,size)
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        -- end    
        -- DrawString(bx*190+bx*212,by*100-size/2+ size + n*size+by*33.5,xtf,C_RED,size)
        -- n = n + 1
        
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            -- if ptf ~= nil then
                -- n = tjm(bx*63+bx*212,by*100-size/2 + size+n*size+by*33.5,ptf,C_WHITE,size,w,size)
            -- end
        -- end

        
        -- --È±Ê§±³¾°Í¼£¬ÎŞ·¨¼ÌĞø×ö
        -- ShowScreen()
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if cot + cot1*4 < #menu then 
                -- jl = menu[cot+cot1*4]
            -- else
                -- if jl > 0 then
                -- CC.TG[jl] = 1
				-- end
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then
			
		-- elseif X == VK_UP then
			-- if cot1 > 0 then
				-- if cot1 == cot2 then
					-- cot2 = limitX(cot2 - 1,0)
				-- end
				-- cot1 = cot1 - 1
			-- else 
				-- cot = 1
			-- end
        -- elseif X == VK_DOWN then
			-- if cot + cot1*4 < #menu then
				-- if cot1 < math.ceil((#menu)/4) - 1 then 
					-- cot1 = cot1 + 1 
					-- if cot + cot1*4 > (#menu) then
						-- cot = (#menu) - cot1*4
					-- end
				-- else 
					-- cot = (#menu) - cot1*4
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- elseif X == VK_LEFT then
			-- cot = cot - 1 
			-- if cot1 > 0 then 
				-- if cot < 1 then
					-- if cot1 == cot2 then
						-- cot2 = limitX(cot2 - 1,0)
					-- end
					-- cot1 = cot1 - 1
					-- cot = 4
				-- end
			-- elseif cot < 1 then 
				-- cot = 1
			-- end
		-- elseif X == VK_RIGHT then
			-- if cot + cot1*4 < (#menu) then
				-- cot = cot + 1
				-- if cot > 4 then
					-- if cot1 < math.ceil((#menu)/4) - 1 then 
						-- cot = 1 
						-- cot1 = cot1 + 1
					-- end	
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- else--0,0
			-- local mxx = false
            -- if mx >= bx*742+bx*212 and mx <= bx*896+bx*212 and my >= by*638+by*33.5 and my <= by*673+by*33.5 then
                -- cot1 = maxn-1
                -- cot = (#menu) - cot1*4
                -- mxx = true
            -- else
                -- for i = 1,4 do 
                    -- for j = 1,maxn do
                        -- --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        -- if mx >= bx*396+(i-1)*bx*150-bx*67+bx*212 and mx <= bx*396+(i-1)*bx*150+bx*67+bx*212 and 
                            -- my >= by*100+(j-1)*by*63-by*17+by*33.5 and my <= by*100+(j-1)*by*63+by*17+by*33.5 then 
                            -- local p = i+(j - 1 + cot2)*4
                            -- if CC.PTFSM[menu[p]] ~= nil then 
                                -- cot = i 
                                -- cot1 = j - 1 + cot2
                                -- mxx = true 
                                -- break
                            -- end
                        -- end	
                    -- end
                -- end	 
            -- end  
            -- if mxx == true and ktype == 3 then 
                -- if cot + cot1*4 < #menu then 
                    -- jl = menu[cot+cot1*4]
                -- else
                    -- if jl > 0 then
                    -- CC.TG[jl] = 1
					-- end
                    -- break
                -- end
            -- end
        -- end
    -- end
    -- --CC.TGJL = {}
-- end

function TGTF3()
    local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxn = 9
    local page = 1
    local jl = 0
    local menu = {}
    local w = math.modf(bx*218/size)
	--if existFile(CONFIG.DataPath..'TgJl') then
	--	tgload()
			
    -- for i = 1,#CC.TGJL do
        -- menu[#menu+1] = CC.TGJL[i]
    -- end
		
    -- if #menu <= 0  then
        -- return   
    -- end
	--end
    --menu = {9999,9998,9997,9996,9995,9994,9993,9992,9991,9990,9989,9988,9987,9986,9985,9984,9983,9982,9981,9980,9979,9978,9977,9976,9975,9974,9973,9972,9971}
	-- for i, v in pairs(#CC.PTFSM) do
		-- menu[#menu+1]=CC.PTFSM[i]
	-- end 
	for k,v in pairs(CC.PTFSM) do
		menu[#menu+1]=k
	end
	--menu = {9998,9991,9962,9980,9987,9999,9929,9928,9927,9974,9975}
    menu[#menu+1] = -1
    local max = math.ceil((#menu-1)/4)
    if maxn > max then 
        maxn = max
    end
    
    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,4 do 
            for j = 1,maxn do
                local tf = i + (j-1+cot2)*4
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*4 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = 'ÎŞ'
        local xtf = 'ÎŞ'
        
        DrawString(bx*63,by*100-size/2,'ÒÑÑ¡Ìì¸³',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'Ã»ÓĞÌì¸³',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*4 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'µ±Ç°Ìì¸³',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --È±Ê§±³¾°Í¼£¬ÎŞ·¨¼ÌĞø×ö
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
        if X == VK_SPACE or X == VK_RETURN then
            if cot + cot1*4 < #menu then 
                jl = menu[cot+cot1*4]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			
		elseif X == VK_UP then
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
        elseif X == VK_DOWN then
			if cot + cot1*4 < #menu then
				if cot1 < math.ceil((#menu)/4) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*4 > (#menu) then
						cot = (#menu) - cot1*4
					end
				else 
					cot = (#menu) - cot1*4
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        elseif X == VK_LEFT then
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 4
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			if cot + cot1*4 < (#menu) then
				cot = cot + 1
				if cot > 4 then
					if cot1 < math.ceil((#menu)/4) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxn-1
                cot = (#menu) - cot1*4
                mxx = true
            else
                for i = 1,4 do 
                    for j = 1,maxn do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*4
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
            if mxx == true and ktype == 3 then 
                if cot + cot1*4 < #menu then 
                    jl = menu[cot+cot1*4]
                else
                    if jl > 0 then
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end

function TGTF3()
    local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxn = 9
    local page = 1
    local jl = 0
    local menu = {}
    local w = math.modf(bx*218/size)
	--if existFile(CONFIG.DataPath..'TgJl') then
	--	tgload()
			
			
    -- for i = 1,#CC.TGJL do
        -- menu[#menu+1] = CC.TGJL[i]
    -- end
		
    -- if #menu <= 0  then
        -- return   
    -- end
	
	
	--end
    --menu = {9999,9998,9997,9996,9995,9994,9993,9992,9991,9990,9988,9987,9986,9985,9984}
	--menu = {9995,9984,9981,9901,9900,9999,9929,9928,9927,9979,9989}
	for k,v in ipairs(CC.PTFSM) do
		menu[#menu+1]=k
	end
    menu[#menu+1] = -1
    local max = math.ceil((#menu-1)/4)
    if maxn > max then 
        maxn = max
    end
    
    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,4 do 
            for j = 1,maxn do
                local tf = i + (j-1+cot2)*4
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*4 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = 'ÎŞ'
        local xtf = 'ÎŞ'
        
        DrawString(bx*63,by*100-size/2,'ÒÑÑ¡Ìì¸³',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'Ã»ÓĞÌì¸³',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*4 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'µ±Ç°Ìì¸³',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --È±Ê§±³¾°Í¼£¬ÎŞ·¨¼ÌĞø×ö
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
        if X == VK_SPACE or X == VK_RETURN then
            if cot + cot1*4 < #menu then 
                jl = menu[cot+cot1*4]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			
		elseif X == VK_UP then
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
        elseif X == VK_DOWN then
			if cot + cot1*4 < #menu then
				if cot1 < math.ceil((#menu)/4) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*4 > (#menu) then
						cot = (#menu) - cot1*4
					end
				else 
					cot = (#menu) - cot1*4
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        elseif X == VK_LEFT then
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 4
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			if cot + cot1*4 < (#menu) then
				cot = cot + 1
				if cot > 4 then
					if cot1 < math.ceil((#menu)/4) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 4 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxn-1
                cot = (#menu) - cot1*4
                mxx = true
            else
                for i = 1,4 do 
                    for j = 1,maxn do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*4
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
            if mxx == true and ktype == 3 then 
                if cot + cot1*4 < #menu then 
                    jl = menu[cot+cot1*4]
                else
                    if jl > 0 then
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end

function NpcWar()
local menu = {}
local n = 0
for i = 1,JY.PersonNum-1 do
    if CC.PersonExit[i] == nil and JY.Person[i]["³©Ïë·Ö½×"] < 3 then 
        n = n + 1
        menu[n] = {JY.Person[i]['ĞÕÃû'],nil,1,i}
    end
end

CC.HSLJ = {}
while #CC.HSLJ < 50 do 
	   if JY.Restart == 1 then
            break
       end	
    Cls()
    local r = ShowMenu4(menu,#menu,5,-2,-2,-2,-2,1,1,CC.DefaultFont,C_GOLD,C_WHITE,"ÇëÑ¡ÔñÏëÒªÉÏ³¡ÈËÎï£¬×î¶à50ÈË£º"..#CC.HSLJ,C_ORANGE, C_WHITE,10)
    if r <= 0 then 
        break
    else
        CC.HSLJ[#CC.HSLJ + 1] = menu[r][4]
        table.remove(menu,r)
    end
    Cls()
end

if #CC.HSLJ == 0 then 
    return    
end

CC.HSLJ2 = {}
while #CC.HSLJ2 < 50 do 
	   if JY.Restart == 1 then
            break
       end	
    Cls()
    local r = ShowMenu4(menu,#menu,5,-2,-2,-2,-2,1,1,CC.DefaultFont,C_GOLD,C_WHITE,"ÇëÑ¡ÔñÏëÒªÉÏ³¡ÈËÎï£¬×î¶à50ÈË£º"..#CC.HSLJ2,C_ORANGE, C_WHITE,10)
    if r <= 0 then 
        break
    else
        CC.HSLJ2[#CC.HSLJ2 + 1] = menu[r][4]
        table.remove(menu,r)
    end
    Cls()
    
end

if #CC.HSLJ2 == 0 then 
    return    
end

WarMain(354)
end
--´«ËÍµØÖ·ÁĞ±í
function My_ChuangSong_List()
	local menu = {};
	for i = 0, JY.SceneNum-1 do
		--²»ÏÔÊ¾µÄ³¡¾°£º´³Íõ±¦²Ø1 3 Ã÷½ÌµØµÀ£¬¸ß²ıÃÔ¹¬+É³Ä®·ÏĞæ3×é ÉÙÁÖËÂ Ë¼¹ıÑÂ Ã·×¯µØÀÎ ´ó¹¦·»µØ½Ñ ÎŞÁ¿É½¶´ Â¹¶¦É½1 3 ÉÙÁÖºóÉ½ »Ê¹¬ ±±¾©½¼Íâ ÷¡¸®ÃÜÊÒ »ªÉ½¾ø¶¥ ¾øÇé¹Èµ× ¹ÅÄ¹ÃÜµÀ ¶ëÃ¼½ğ¶¥ ÈµÇÅ ºÚÉ½´ó»á
		if i == 0 or i == 5  or i == 13 or i == 14 or i == 15 or i == 28  or i == 38 or i == 42 or i == 44 or i == 46  or i == 49 or i == 55 or i == 57 or i == 58 or i == 67 or i == 69 or i == 70
		or (i >= 80 and i <= 83) or i == 84 or i == 85 or i == 86 or i == 88 or i == 89 or i == 91 or i == 102 or i == 104  
		or i == 106 or i == 108 or i == 109 or i == 110 or i == 111 or i == 113 or i == 114 or i == 115 or i == 174 or i == 173
		or i == 116 or i == 117 or i == 118 or i == 119 or i == 122 or i == 123 or i == 126 or i == 178 or i == 177 or i == 176  or i == 175
		or i == 131 or i == 132 or i == 134 or i == 137 or i == 138 or i == 140 or i == 141 or i == 184 or i == 181 or i == 180  or i == 179
		or i == 162 or i == 164 or i == 195 or i == 193 or i == 192 or i == 191 or i == 190 or i == 189 or i == 187 or i == 186
		or i == 174 or i == 173 or i == 172 or i == 170 or i == 169 or i == 168 or i == 167 or i == 166 or i == 165
		or i == 164 or i == 163 or i == 162 or i == 171 or i == 185 or i == 182 or i == 197 or i == 198 or i == 199 
		or i == 142 or i == 143 or i == 144 or i == 145 or i == 146 or i == 147 or i == 148 or i == 149 or i == 150 or i == 200 or i == 201 or i == 202
		or i == 203 or i == 204 or i == 205 or i == 206 or i == 207 or i == 208 or i == 209 then
		else
			--ÎŞ¾Æ²»»¶£ºÕâÀïi¼´Îª³¡¾°±àºÅ
			menu[i+1] = {JY.Scene[i]["Ãû³Æ"], JY.Scene[i]["½øÈëÌõ¼ş"], i, JY.Scene[i]["³¡¾°ÀàĞÍ"]};	
		end
	end
	--ÑÕÉ«ÒÀ´ÎÎª³£¹æÑÕÉ«ºÍÑ¡ÖĞÑÕÉ«
	local r = TeleportMenu(menu, C_GOLD, C_WHITE);

	--·µ»ØÖµĞ¡ÓÚ0£¨ESC£©£¬Ö±½Ó·µ»Ø
	if r < 0 then
		return 0;
	end
	--·µ»ØÖµ´óÓÚµÈÓÚ0£¬·µ»ØÖµ¼´Îª³¡¾°±àºÅ
	if r >= 0 then	
		local sid = r;
		My_Enter_SubScene(sid,-1,-1,-1);
	end
	return 1;
end

--¼ÓÇ¿°æ´«ËÍµØÖ·²Ëµ¥
function My_ChuangSong_Ex()     
	local title = "¹ÍÓ¶Âí³µ";
	local str = JY.Person[0]["ÍâºÅ"].."ÏëÈ¥Ê²Ã´µØ·½£¿*ÔÙÔ¶Ò²¸øÄúËÍµ½";
	local btn = {"Ö¸µã½­É½", "¼¤ÑïÎÄ×Ö"};
	local num = #btn;
	local r = JYMsgBox(title,str,btn,num,119,1);
	if r == 1 then
		return My_ChuangSong_List();
	elseif r == 2 then
		Cls();
		local sid = InputNum("³¡¾°´úÂë",0,JY.SceneNum-1,1);
		if sid ~= nil then			
			--±ê×¢¼¸¸ö²»ÏÔÊ¾µÄ£º´³Íõ±¦²Ø1 3 Ã÷½ÌµØµÀ£¬¸ß²ıÃÔ¹¬+É³Ä®·ÏĞæ3×é ÉÙÁÖËÂ Ë¼¹ıÑÂ Ã·×¯µØÀÎ ´ó¹¦·»µØ½Ñ ÎŞÁ¿É½¶´ Â¹¶¦É½1 3 ÈµÇÅ ²»ÀÏ³¤´º¹È
			if sid == 0 or sid == 5 or sid == 13 or sid == 14 or sid == 15 or sid == 28 or sid == 38 or sid == 42 or sid == 44 
			or sid == 46 or sid == 49 or sid == 55 or sid == 57 or sid == 58 or sid == 67 or sid == 69 or sid == 70 or (sid >= 80 and sid <= 83) 
			or sid == 84 or sid == 85 or sid == 86 or sid == 88 or sid == 89 or sid == 91 or sid == 102 or sid == 104 or sid == 106 or sid == 108 
			or sid == 109 or sid == 110 or sid == 111 or sid == 113 or sid == 114   or sid == 115 or sid == 116 or sid == 117 or sid == 118 or sid == 119 
			or sid == 122 or sid == 123   or sid == 126 or sid == 131 or sid == 132 or sid == 134  or sid == 137 or sid == 138 or sid == 140 or sid == 141 
			or sid == 142 or sid == 143 or sid == 144 or sid == 145 or sid== 146 or sid== 147 or sid== 148 or sid== 149 or sid== 150 or sid== 161 
			or sid == 205 or sid == 207 or sid == 208 or sid == 209
			or JY.Scene[sid]["½øÈëÌõ¼ş"] == 1 then
				say("£±£ÒÄúÄ¿Ç°²»ÄÜ½øÈë´Ë³¡¾°¡£", 119, 5, "³µ·ò");
				return 1;
			else
				My_Enter_SubScene(sid,-1,-1,-1);
			end
		end
	end
end

--½øÁ·¹¦·¿
function LianGong(lx)
	JY.Person[591]["ĞÕÃû"] = "º£µ×ÀÌÔÂ"
	JY.Person[591]["µÈ¼¶"] = 1
	JY.Person[591]["ÄÚÁ¦ĞÔÖÊ"] = lx
	local id = math.random(190)
	JY.Person[591]["Í·Ïñ´úºÅ"] = JY.Person[id]["Í·Ïñ´úºÅ"]
	for i = 1,5 do 
		JY.Person[591]["³öÕĞ¶¯»­Ö¡Êı"..i] = JY.Person[id]["³öÕĞ¶¯»­Ö¡Êı"..i]
		JY.Person[591]["³öÕĞ¶¯»­ÑÓ³Ù"..i] = JY.Person[id]["³öÕĞ¶¯»­ÑÓ³Ù"..i]
		JY.Person[591]["Îä¹¦ÒôĞ§ÑÓ³Ù"..i] = JY.Person[id]["Îä¹¦ÒôĞ§ÑÓ³Ù"..i]
	end
	JY.Person[591]["ĞÕÃû"] = "º£µ×ÀÌÔÂ"
	JY.Person[591]["°ëÉíÏñ"] = JY.Person[id]["°ëÉíÏñ"]
	JY.Person[591]["ÉúÃü×î´óÖµ"] = 100
	JY.Person[591]["ÉúÃü"] = JY.Person[591]["ÉúÃü×î´óÖµ"]
    JY.Person[591]["³©Ïë·Ö½×"] = 7
	instruct_6(226, 8, 0, 1)
	JY.Person[591]["ÄÚÁ¦ĞÔÖÊ"] = 0
	light()
	--return 1;
end

--Îä¹¦ÌØĞ§ËµÃ÷
function WuGongIntruce()
	local menu = {};
	
	for i = 1, JY.WugongNum-1 do
		menu[i] = {i..JY.Wugong[i]["Ãû³Æ"], nil, 0}
	end
	
	--ÓµÓĞµÄÃØ¼®
	for i = 1, CC.MyThingNum do
    if JY.Base["ÎïÆ·" .. i] > -1 and JY.Base["ÎïÆ·ÊıÁ¿" .. i] > 0 then
    	local wg = JY.Thing[JY.Base["ÎïÆ·" .. i]]["Á·³öÎä¹¦"];
    	if wg > 0 then
    		menu[wg][3] = 1;
    	end
    else
    	break;
    end
  end
  
  --Ñ§»áµÄÎä¹¦
  for i=1, CC.TeamNum do
  	if JY.Base["¶ÓÎé"..i] >= 0 then
  		for j=1, 10 do
  			if JY.Person[JY.Base["¶ÓÎé"..i]]["Îä¹¦"..j] > 0 then
  				menu[JY.Person[JY.Base["¶ÓÎé"..i]]["Îä¹¦"..j]][3] = 1;
  			else
  				break;
  			end
  		end
  	else
  		break;
  	end
  end
	
	local r = -1;
	while true do
		Cls();
		
		r = ShowMenu2(menu,JY.WugongNum-1,4,12,10,(CC.ScreenH-12*(CC.DefaultFont+CC.RowPixel))/2+20,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE, "ÇëÑ¡Ôñ²é¿´µÄÎä¹¦", r);
		--local r = ShowMenu(menu,n,15,CC.ScreenW/4,20,0,0,1,1,CC.DefaultFont,C_ORANGE, C_WHITE);
		
		if r > 0 and r < JY.WugongNum then	
			InstruceWuGong(r);
		else
			break;
		end
	end
	
end
--ËõĞ¡°æÈËÎïÍ·Ïñ
--[[function smallhead(id)
	if id < 0 or id > JY.PersonNum then
		id = 0
	end
	local filename = string.format("%s%d.png", CONFIG.Head1Path,id)
	if existFile(filename) == false then
		return;
	end
	
end	]]
--ÏÔÊ¾Îä¹¦»òÄÚ¹¦ÌØĞ§
function InstruceWuGong(id)
	if id < 0 or id >= JY.WugongNum then
		QZXS("Îä¹¦Î´Öª´íÎó£¬ÎŞ·¨²é¿´");
		return;
	end
	local filename = string.format("%s%d.txt", CONFIG.WuGongPath,id)
	if existFile(filename) == false then
		QZXS("´ËÎä¹¦Î´°üº¬ÈÎºÎËµÃ÷£¬Çë×ÔĞĞ×ÁÄ¥");
		return;
	end
	DrawTxt(filename);
end

function TSInstruce()
	local filemenu = {};
	local n = 0;
	for i=1, math.huge do
		if existFile(string.format("%s%d.txt",CONFIG.HelpPath, i)) then
			filemenu[i] = string.format("%s%d.txt",CONFIG.HelpPath, i);
			n = n + 1;
		else
			break;
		end
	end
	
	local menu = {}
	local maxlen = 0;
	for i=1, n do
		local file = io.open(filemenu[i],"r")
		local str = file:read("*l")
		
		if str == nil then
			str = " ";
		end
		
		if #str > maxlen then
			maxlen = #str;
		end
		
		menu[i] = {i..str, nil, 1};
		
		file:close()
	end
	
	local size = CC.DefaultFont;
	
	while true do
		Cls();
		local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
		local r = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"ÈÎÎñ¹¥ÂÔ")
		--local r = ShowMenu2(menu,#menu,2,12,20,(CC.ScreenH-12*(size+CC.RowPixel))/2+20,0,0,1,1,size,C_ORANGE,C_WHITE);
		if r > 0 then
			InstruceTS(r);
		else
			do return end  --ÎŞÌõ¼ş½áÊøÊÂ¼ş;
		end
		do return end  --ÎŞÌõ¼ş½áÊøÊÂ¼ş
	end
end

--ÏÔÊ¾Îä¹¦»òÄÚ¹¦ÌØĞ§
function InstruceTS(id)
		
	local filename = string.format("%s%d.txt", CONFIG.HelpPath,id)
	if existFile(filename) == false then
		QZXS("Î´ÕÒµ½Ïà¹ØµÄ¹¥ÂÔÎÄ¼ş");
		return;
	end
	
	DrawTxt(filename);
end

function DrawTxt(filename)
	Cls();
	
	--¶ÁÈ¡ÎÄ¼şËµÃ÷
	local file = io.open(filename,"r")
	local str = file:read("*a")
	file:close()
	
	local size = CC.DefaultFont;
	local color = C_WHITE;
	
	local linenum = 50;		--ÏÔÊ¾³¤¶È
	local maxlen = 14;
	local w = linenum*size/2 + size;
	local h = maxlen*(size+CC.RowPixel) + 2*CC.RowPixel;
	
	local bx = (CC.ScreenW-w)/2;
	local by = (CC.ScreenH-h)/2;
	DrawBox(bx,by,bx+w,by+h,C_WHITE);		--µ×±ß¿ò
	local x = bx + CC.RowPixel;
	local y = by + CC.RowPixel;
	
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	
	local strcolor = AnalyString(str)
	local l = 0
	local row = 0;


	for i,v in pairs(strcolor) do
		while 1 do
			if v[1] == nil then
				break;
			end
			local index = string.find(v[1], "\n")
			
			if l+#v[1] < linenum and index == nil then		--Èç¹ûÎ´µ½»»ĞĞ£¬Ã»ÓĞÕÒµ½»»ĞĞ
				DrawString(x + l*size/2, y + row*(size+CC.RowPixel), v[1], v[2] or color, size);
				l = l + #v[1]

				if i == #strcolor then
					--ÏÔÊ¾ÎÄ×Ö	ALungky:j ¸Ä³É j+1½â¾öÁËÄ©Î²ÎÄ×ÖÓĞÊ±ºòÎŞ·¨ÏÔÊ¾µÄÎÊÌâ¡£
					for j=0, l do
						lib.SetClip(x,y,x+(j+1)*size/2,y+size+row*(size+CC.RowPixel));
						ShowScreen(1);
					end
					lib.SetClip(0,0,0,0);
				end
				break;
			else	--Èç¹û´ïµ½»»ĞĞ
				local tmp, pos1, pos2;
				if index == nil then
					pos1 = linenum-l;
					pos2 = pos1+1;
				else
					pos1 = index-1;
					pos2 = pos1+2;
					
					if pos1 > linenum-l then
						index = nil;
						pos1 = linenum-l;
						pos2 = pos1+1;
					end
				end
				
				--Õâ¸öÓÃÓÚÅĞ¶ÏÊÇ·ñÒÑ¾­µ½´ïv[1]µÄ×îºóÄÚÈİ²¿·Ö
				if pos1 > #v[1] then
					tmp = v[1];
					v[1] = nil;
				else
					tmp = string.sub(v[1], 1, pos1)
					local flag = 0
					for i=1, pos1 do
						if string.byte(tmp, i) <= 127 then
							flag = flag + 1;
						end
					end
					
	
					if math.fmod(flag,2) == 1 and index == nil  then		--Èç¹û°üº¬ÓĞµ¥×Ö·û
							if string.byte(tmp, -1) > 127 then
								tmp = string.sub(v[1], 1, pos1-1);
								pos2 = pos2 - 1
							end
					end
	
					v[1] = string.sub(v[1], pos2);
				end
					
	
					DrawString(x + l*size/2, y + row*(size+CC.RowPixel), tmp, v[2] or color, size);
	
	
					l = l + #tmp
					--ÏÔÊ¾ÎÄ×Ö
					for j=0, l do
						lib.SetClip(x,y,x+j*size/2,y+size+row*(size+CC.RowPixel));
						ShowScreen(1);
					end
					
					--ĞĞÊı+1
					row = row + 1
					l = 0

				
			end

			lib.SetClip(0,0,0,0);
			
			if row == maxlen then
				WaitKey();
				row = 0;
				Cls();
				lib.LoadSur(surid, 0, 0)
				
			end
		end
	end
	lib.SetClip(0,0,0,0);
	WaitKey();
	lib.FreeSur(surid)
end

--Áîºü³å±äÉí
function NEvent4(keypress)
	if JY.SubScene == 7 and JY.Base["ÈËX1"] == 34 and JY.Base["ÈËY1"] == 11 and JY.Base["ÈË·½Ïò"] == 2 then
		--Áîºü³åÔÚ¶Ó£¬ÓĞ¾Å½£ÃØ¼®
		if instruct_16(35) and instruct_18(114) and GetS(10, 1, 1, 0) ~= 1 and (keypress == VK_SPACE or keypress == VK_RETURN) then
			SetS(7, 34, 12, 3, 102)
			instruct_3(7, 102, 1, 0, 0, 0, 0, 7148, 7148, 7148, 0, 34, 12)
			say("£±µñĞÖ£­£­£¬ÕæÏë¼ûÊ¶Ò»ÏÂ¶À¹ÂÇ°±²µÄ·ç²É°¡£¡×î½ü×Ü¸Ğ¾õµ½¶Ô¾Å½£ÓĞÁËĞÂµÄÁìÎò£¬µ«ÓÖºÜÄ£ºı£¬²»ÄÜ¾ßÌå×Ü½á³öÀ´£¡", 35, 1)
			say("£±¹ş¹ş£­£­£­£­£¬ÊÇÊ±ºòÁË£¡", 140, 0)
			say("£±·çÌ«Ê¦Êå£¡£¡£¡", 35,1)
			instruct_14()
			SetS(7, 33, 12, 3, 101)
			instruct_3(7, 101, 1, 0, 0, 0, 0, 5896, 5896, 5896, 0, 33, 12)
			instruct_13()
			PlayMIDI(24)
			lib.Delay(500)
			say("£±³å¶ù£¬¸úÎÒÒ»Æğ³ª£º²×º£Ò»ÉùĞ¦¡¡ÌÏÌÏÁ½°¶³±¡¡¸¡³ÁËæÀËÖ»¼Ç½ñ³¯¡¡²ÔÌìĞ¦¡¡·×·×ÊÀÉÏ³±¡¡Ë­¸ºË­Ê¤³öÌìÖªÏş¡¡½­É½Ğ¦¡¡ÑÌÓêÒ£¡¡ÌÎÀËÌÔ¾¡ºì³¾Ë×ÊÂÖª¶àÉÙ¡¡Çå·çĞ¦¾¹ÈÇ¼ÅÁÈ¡¡ºÀÇé»¹Ê£Ò»½óÍíÕÕ¡¡²ÔÉúĞ¦¡¡²»ÔÙ¼ÅÁÈ¡¡ºÀÇéÈÔÔÚ³Õ³ÕĞ¦Ğ¦", 140, 0)
			say("£±³å¶ù£¬¾Å½£µÄ¼«Òâ¾ÍÒş²ØÔÚÕâÊ×¸èÖĞ£¬×ÔÒÑºÃºÃÈ¥Ìå»á°É£¡ÀÏ·òĞÄÔ¸ÒÑÁË£¬´Ó´ËÔÙÎŞÇ£¹Ò£¬¾Í´ËÈ¥Ò²£¬¹ş¹ş£­£­£­£­", 140, 0)
			say("£±¶àĞ»Ì«Ê¦Êå´«½££¬ÄãÀÏÈË¼Ò¶à±£ÖØ£¡àÅ£¬¾ÍÔÚÕâÀï²ÎÎò¾Å½£µÄ°ÂÒå°É£­£­£­£­", 35, 1)
			instruct_14()
			instruct_3(7, 101, 0, 0, 0, 0, 0, -1, -1, -1, 0, 33, 12)
			instruct_13()
			DrawStrBox(-1, -1, "ÈıÈÕºó", C_ORANGE, CC.DefaultFont)
			ShowScreen()
			lib.Delay(500)
			say("£±³ÉÁË£¡Õâ²ÅÊÇÕæÕıµÄ¶À¹Â¾Å½£°¡£¡´ËÉúÓĞĞÒÄÜÑ§µ½¶À¹ÂÇ°±²Ö®Éñ¼¼£¬·ò¸´ºÎº¶£¡", 35, 1)
			DrawStrBox(-1, -1, "Áîºü³åÁìÎò¾Å½£Ö®ÃØ´«", C_ORANGE, CC.DefaultFont)
			ShowScreen()
			lib.Delay(500)
			Cls()
			SetJX(35,1)	--Áîºü³åµÚ¶ş´Î¾õĞÑ
			JY.Person[35]['ÂÛ½£½±Àø'] = 2
			DrawStrBox(-1, -1, "Áîºü³å³ÆºÅ±ä¸Ä", C_ORANGE, CC.DefaultFont)
			ShowScreen()
			lib.Delay(500)
			Cls()
			SetS(10, 1, 1, 0, 1)
			instruct_3(7, 102, 0, 0, 0, 0, 0, -1, -1, -1, 0, 34, 12)
		end
	end
end

--É½¶´ÊÂ¼ş
function NEvent6(keypress)
	if JY.SubScene == 10 then
		SetD(10, 28, 4, -1)
		SetS(10, 23, 22, 1, 2)
		SetS(10, 22, 22, 1, 2)
	end
	if JY.SubScene == 59 then
		JY.SubSceneX = 0
		JY.SubSceneY = 0
	end
end

--ÎäµÀ´ó»áºó£¬SYP×Ô¶¯·ÅÊé
function NEvent10(keypress)
  if JY.SubScene == 25 and GetS(10, 0, 9, 0) ~= 1 then
    SetS(25, 9, 44, 3, 103)
    instruct_3(25, 103, 1, 0, 0, 0, 0, 4133*2, 4133*2, 4133*2, 0, -2, -2)
    if JY.Base["ÈËX1"] == 10 and JY.Base["ÈËY1"] == 44 and JY.Base["ÈË·½Ïò"] == 2 and (keypress == VK_SPACE or keypress == VK_RETURN) and GetD(25, 82, 5) == 4662 then
      say("£±Ò»Â·À´µ½ÕâÀï£¬ÕæÊÇĞÁ¿àÁË£¡ÎÒÀ´°ïÄã·ÅÊé°É¡£",596,0);
      instruct_14()
      for i = 79, 92 do
          instruct_3(25, i, 1, 0, 0, 0, 0, 4664, 4664, 4664, 0, -2, -2)
      end
      for ii = CC.BookStart, CC.BookStart + CC.BookNum -1 do
          instruct_32(ii, -10)
      end
	  JY.Base["ÌìÊéÊıÁ¿"] = 15
      instruct_3(25, 75, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2, -2)
      instruct_3(25, 76, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2, -2)
      instruct_13()
      say("£±ÊéÒÑ¾­·ÅºÃÁË£¬´ÓÉÏÃæµÄÃÅ³öÈ¥°É¡£", 596,0);
      SetS(10, 0, 9, 0, 1)
      instruct_3(25, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2, -2)
      
    end
  end
end

--´ó¹¦·» ºÍÔ¬³ĞÖ¾¶Ô»°ºó£¬½ğÉß½£¹é»¹
function NEvent12(keypress)
	if JY.SubScene == 95 and GetD(95, 4, 5) ~= 0 and JY.Thing[40]["Ê¹ÓÃÈË"] ~= -1 then
		JY.Person[JY.Thing[40]["Ê¹ÓÃÈË"]]["ÎäÆ÷"] = -1
		JY.Thing[40]["Ê¹ÓÃÈË"] = -1
	end
end

--É½¶´Å®Ö÷½ÇµÄ¾çÇé
function mm4R()
	local r = JYMsgBox("ÇëÑ¡Ôñ", "ÄÚÁ¦ĞÔÖÊÄØ£¿", {"ÒõÄÚ","ÑôÄÚ","µ÷ºÍ"}, 3, JY.Person[92]["°ëÉíÏñ"])
	if r == 1 then
		JY.Person[92]["ÄÚÁ¦ĞÔÖÊ"] = 0
		Cls()  --ÇåÆÁ
	elseif r == 2 then
		JY.Person[92]["ÄÚÁ¦ĞÔÖÊ"] = 1
		Cls()  --ÇåÆÁ
	elseif r == 3 then
		JY.Person[92]["ÄÚÁ¦ĞÔÖÊ"] = 2
		Cls()  --ÇåÆÁ
	end
	if JY.Person[0]["×ÊÖÊ"] == 50 then
		JY.Person[92]["×ÊÖÊ"] = 50
	else
		JY.Person[92]["×ÊÖÊ"] = 101 - JY.Person[0]["×ÊÖÊ"]
	end
end

--×Ô¶¨ÒåÊÂ¼ş
function NEvent(keypress)
	--NEvent2(keypress)		--Ê®ËÄ±¾ÌìÊéÖ®ºóµÃµ½5000Á½£¬Ï´ËÄÉñ¼¼
	--NEvent3(keypress)		--ºúì³ ÃçÈË·ï½ÌÃç¼Ò½£·¨
	NEvent4(keypress)		--Áîºü³å±äÉí
	NEvent6(keypress)		--Ö©Öë¶´ ½ğÁú°ï
	NEvent10(keypress)	--ÎäµÀ´ó»á·ÅÊé
	NEvent12(keypress)	--¹é»¹½ğÉß½£
end

function fzdy()
	lib.Debug("fzdy");
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local x1,y1 = bx*84,by*163
	local jg = bx*30 
	local h = 20
	local cont = 1
	local cont1 = 0
	local cot = 1
	local cot1 = 0
	local cot2  = 0
	local fy = 0
	local maxh = 0
	local fymax = 0
	local menu = {
		{1,0},
		{2,0},
		{4,0},
		{9,0},
		{16,0},
		{17,0},
		{25,0},
		{28,0},
		{29,0}
	}
	while true do
		if JY.Restart == 1 then
			break
		end
		Cls()
		lib.LoadPNG(91, 25 * 2 , 0,0, 1)
		local m = menu[cont+cont1*4][1]
		local id = cot + cot1*4
		local mid = menu[m][id]
		
		if mid ~= nil then
			local me = {}
			local row = 0
			local maxh = 15
			if TFJS[mid] ~= nil then
				local row = 0
				local maxh = 15
				for i = 1, #TFJS[mid] do
					me[#me+1] = TFJS[mid][i]
					if i == #TFJS[mid] then 
						me[#me+1] = "£Î"
					end
				end
			end
			if CC.PTF[mid] ~= nil then 
				for i,v in pairs(CC.PTF[mid]) do 
					if v == 1 then 
						if CC.PTFSM[i] ~= nil then
							me[#me+1] = '£Ì'..CC.PTFSM[i][1]
							me[#me+1] = '£×'..CC.PTFSM[i][2]
							me[#me+1] = "£Î"
						end
					end
				end
			end			
			for i = 1, #me do
				local tfstr = me[i]
				local h = 0
						
				if string.sub(tfstr,1,2) == "£Î" then
					row = row + 1
				else
					h = tjm(bx*300, by*280 + size*0.8 * (row-fy), tfstr, C_WHITE, size*0.8,math.modf((bx*600)/size/0.8)-1,size*0.8,fy-row,maxh+1-row+fy)
				end
				row = row + h
			end

			if row > maxh then
				fymax = limitX(row-maxh-1,0)
			else
				fymax = 0
			end
		end	
		for i = 1,4 do
			for j = 1,5 do
				local id = i + (j-1+cot2)*4
				local mid = menu[m][id]
				if mid ~= nil then
					local zx = (i-1)*bx*140
					local zy = (j-1)*size
					local headid = JY.Person[mid]["°ëÉíÏñ"]
					lib.LoadPNG(91, headid * 2 ,zx,zy, 2)
				end					
			end
		end			
	end
	--ÏÔÊ¾»­Ãæ
	ShowScreen()
	--Ñ­»·µÄ¼ä¸ô£¨ÊıÖµËæÒâ£©
	--lib.Delay(40)
	--XÊÇ¼üÅÌ²Ù×÷£¬ktypeÊÇÊó±ê²Ù×÷£¬ktype = 3 ´ú±í×ó¼ü£¬4´ú±íÓÒ¼ü£¬6¹öÂÖÉÏ£¬7¹öÂÖÏÂ
	local X,ktype,mx,my = lib.GetKey()
end


function fzdy1()
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	local size = CC.DefaultFont
	local xs = 0
	local id = 0
	local menu = {
					{1,1},
					{2,0},
					{4,0},
					{9,0},
					{16,0},
					{17,0},
					{25,0},
					{28,0},
					{29,0}
				}	
	while true do
		lib.LoadPNG(91, 63 * 2 ,0, 0, 1)
		if JY.Restart == 1 then
			return
		end
		Cls()	
		for i = 1,#menu do
			if menu[i][1] ~= nil  then
				id = menu[i][1]
			end
		end	
		local hd = JY.Person[id]["°ëÉíÏñ"]
		lib.LoadPNG(1, hd * 2 ,bx*40,by*40, 2)
		ShowScreen();
	end
end	

function MMapName() --ÏÔÊ¾´óµØÍ¼½¨Öş
	if JY.Status == GAME_MMAP then --ÓÎÏ·×´Ì¬ÔÚ´óµØÍ¼Ê±
		for i = 0,JY.SceneNum - 1 do --Ñ­»·ËùÓĞ³¡¾°
	 		if JY.Scene[i]["Íâ¾°Èë¿ÚX1"] ~= 0 then --ÅÅ³ı²»ÔÚ´óµØÍ¼ÉÏµÄ£¬ĞèÒªÌø×ªµÄÄÚ³¡¾°
	 			if JY.Scene[i]["½øÈëÌõ¼ş"] == 0 then --ÅÅ³ı²»ÄÜ½øµÄ³¡¾°
	 				local sid = i
	 				if sid>=0 then
	 					local dx = JY.Scene[sid]["Íâ¾°Èë¿ÚX1"] - JY.Base["ÈËX"]
	 					local dy = JY.Scene[sid]["Íâ¾°Èë¿ÚY1"] - JY.Base["ÈËY"]
	 					local rx = CC.XScale * (dx - dy) + CC.ScreenW / 2
	 					local ry = CC.YScale * (dx + dy) + CC.ScreenH / 2	
						if math.abs(dx) <= 15 and math.abs(dy) <= 15 then --ÅÅ³ıÖ÷½Ç°ë¾¶15²½Ö®ÍâµÄ³¡¾°--Ê£ÏÂµÄÃ»ÓĞ±»¹ıÂËµôµÄ¾ÍÊÇÎÒÃÇĞèÒªÏÔÊ¾µÄ£¬Ö÷½Ç°ë¾¶15²½ÄÚµÄ³¡¾°	
	 						local str = JY.Scene[sid]["Ãû³Æ"]
	 						local size = CC.FontSmall*2
	 						local color = C_GOLD;
							DrawStrBox(rx - #str*size/4, ry - CC.YScale*8, str, color, size*0.6)
	 					end
	 				end
				end
			end
		end
	end
end	
function Duiwumb()
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	local zuobiao = {10,312}			
	local tb = 1 
	local lieshu = 8
	local pg = 0
	local jg = 20
	local liebiao = {}
	local cl = C_CYGOLD
	local size = CC.DefaultFont
	local id = - 1
	local TB = 0
	while true do 
		Cls()
		if JY.Restart == 1 then
			break
		end	
		local i = 0
		lib.Background(0,CC.ScreenH/2-50,CC.ScreenW,CC.ScreenH/2+150,98)

		for ii = 1,CC.TeamNum do 
			if JY.Base['¶ÓÎé'..ii] >= 0 then 
				liebiao[ii] = {JY.Person[JY.Base['¶ÓÎé'..ii]]['ĞÕÃû'],JY.Base['¶ÓÎé'..ii]}				
			end	
		end		
		if lieshu > #liebiao then
			lieshu = #liebiao
		end
		for ai = 1,lieshu do
			local tw = 0
			if CC.Png[JY.Person[liebiao[ai+pg][2]]['°ëÉíÏñ']] ~= nil then 
				tw = CC.Png[JY.Person[liebiao[ai+pg][2]]['°ëÉíÏñ']]
			end
			local cl1 = C_CYGOLD
			local pc = 72
			local pc1 = 74
			local pc2 = 72
			if tb == ai then
				cl1 = C_RED				
			end					
			DrawString(bx*zuobiao[1]+bx*62-string.len(liebiao[ai+pg][1])/4*size+(ai-1)*bx*152,by*zuobiao[2]+by*150,liebiao[ai+pg][1],cl1,size)
			local headid = JY.Person[liebiao[ai+pg][2]]["°ëÉíÏñ"]
			lib.PicLoadCache(92,116*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
			lib.LoadPNG(1,headid*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
			lib.PicLoadCache(92,117*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
			if tb == ai then
				TB = ai + pg
				lib.LoadPNG(91,pc*2,bx*zuobiao[1]+(ai-1)*bx*152,by*zuobiao[2],1)
				pc = pc + 1
				if pc > pc1 then
					pc = pc2
				end
			end		
		end		
		ShowScreen()
		lib.Delay(40)
		local X,ktype,mx,my = lib.GetKey()
		if X == VK_ESCAPE or ktype == 4 then
			return pg
		elseif X == VK_SPACE or X == VK_RETURN then 
			--ShowPersonStatus(TB)
			--PersonStatus(TB)
			return TB
		elseif  X == VK_RIGHT then
			tb = tb + 1
			if tb > lieshu then
				pg = pg + 1
				tb = lieshu
			end	
			if tb + pg > #liebiao then
				tb = 1
				pg = 0
			end	
		elseif  X == VK_LEFT then
			if pg > 0 then
				if tb > 1 then
					tb = tb - 1
				else
					pg = pg - 1
				end	
			else
				tb = tb - 1
				if tb < 1 then
					tb = lieshu
				end	
			end	
		elseif X == VK_UP or ktype == 6 then
			pg = pg - lieshu
			tb = 1
			if pg < 0 then 
				pg = 0 
			end
		elseif X == VK_DOWN or ktype == 7 then
			pg = pg + lieshu
			if pg + lieshu > #liebiao then 
				pg = #liebiao-lieshu
				tb = 1
			end
		else
			local mxx = false
			for j = 1,lieshu do
				if mx > bx*10+(j-1)*bx*152 and mx < bx*152+(j-1)*bx*152 and my > by*300 and my < by*500 then
					tb = j
					mxx = true
					break
				end
			end
			if mxx == true and ktype == 3 then
				--ShowPersonStatus(TB)
				--PersonStatus(TB)
				return TB				
			end						
		end
	end
end


	
--ÅĞ¶ÏÌ××° ÈËÎïid,Ì××°id
function PDTZ(id,Tid)
	-- JY.Person[id]["ÎäÆ÷"] = - 1
	-- JY.Person[id]["·À¾ß"] = - 1
	-- JY.Person[id]["×øÆï"] = - 1
	if Tid <= 547 then
		return false
	
	end
	
	
	if Setmeal[Tid][1] ~= JY.Person[id]["ÎäÆ÷"] then
		return false
	end
	
	if Setmeal[Tid][2] ~= JY.Person[id]["·À¾ß"] then
		return false
	end
	
	if Setmeal[Tid][3] ~= JY.Person[id]["×øÆï"] then
		return false
	end
	
	return true
	--return false
end


function NPC_CZB(id,Tid)
	if Tid <= 547 then
		return false
	
	end
	JY.Person[id]["ÎäÆ÷"] = Setmeal[Tid][1]--½ğË¿ÊÖÌ×
	JY.Person[id]["·À¾ß"] = Setmeal[Tid][2]--·ğĞÄ¼×
	JY.Person[id]["×øÆï"] = Setmeal[Tid][3]--°×Âí
	JY.Thing[JY.Person[id]["ÎäÆ÷"]]["×°±¸µÈ¼¶"] = 6
	JY.Thing[JY.Person[id]["·À¾ß"]]["×°±¸µÈ¼¶"] = 6
	JY.Thing[JY.Person[id]["×øÆï"]]["×°±¸µÈ¼¶"] = 6
	
	
end

function MPTX(id,mp,dj)	
	if match_ID(id,46) and mp == 1 then
		return true
	end
	if (match_ID(id,50) or match_ID(id,69)) and mp == 2 then
		return true
	end
	if match_ID(id,605) and mp == 3 then
		return true
	end
	if (match_ID(id,5) or match_ID(id,524)) and mp == 4 then
		return true
	end	
	if match_ID(id,577) and mp == 5 then
		return true
	end	
	
	if (match_ID(id,62) or match_ID(id,97)) and mp == 6 then
		return true
	end
	if (match_ID(id,116) or match_ID(id,117) or match_ID(id,118)) and mp == 7 then
		return true
	end
	if match_ID(id,60) and mp == 8 then
		return true
	end
	if match_ID(id,92) and mp == 9 then
		return true
	end
	if match_ID(id,57) and mp == 10 then
		return true
	end	
	if (match_ID(id,501) or match_ID(id,596)) and mp == 11 then
		return true
	end
	if (match_ID(id,27) or match_ID(id,26) or match_ID(id,456)) and mp == 12 then
		return true
	end
	if (match_ID(id,641) or match_ID(id,456)) and mp == 13 then
		return true
	end
	if match_ID(id,140) and mp == 14 then
		return true
	end
	if (match_ID(id,499) or match_ID(id,65)) and mp == 15 then
		return true
	end
	if (match_ID(id,129) or match_ID(id,64)) and mp == 16 then
		return true
	end
	if match_ID(id,626) and mp == 17 then
		return true
	end
	if (match_ID(id,586) or match_ID(id,604)) and mp == 19 then
		return true
	end	
	if match_ID(id,514) and mp == 20 then
		return true
	end
	if match_ID(id,515) and mp == 21 then
		return true
	end	
	if match_ID(id,520) and mp == 22 then
		return true
	end
	if (match_ID(id,568) or match_ID(id,760)) and mp == 23 then
		return true
	end
	if (match_ID(id,517) or match_ID(id,526)) and mp == 24 then
		return true
	end
	if match_ID(id,749) and mp == 25 then
		return true
	end
	if match_ID(id,765) and mp == 27 then
		return true
	end
	if match_ID(id,635) and mp == 30 then
		return true
	end
	if MPPD(id) > 0 then
		if dj ~= nil then
			if MPPD(id) == mp and MPDJ(id) >= dj then
				return true
			else
				return false
			end		
		else
			if MPPD(id) == mp then
				return true
			else
				return false
			end
		end			
	else
		return false
	end	
	return false	
end	

function MPPD(tmppid)
    -- local xwperson
	-- if tmppid == JY.Base["³©Ïë"] then
		-- xwperson = 0
	-- else
		-- xwperson = tmppid
	-- end	
	-- if JY.Person[xwperson]["ÃÅÅÉ"] == nil or JY.Person[xwperson]["ÃÅÅÉ"] < 101 then
		-- return 0
	-- end
	--return tmppid
	local xwperson = (JY.Person[tmppid]["ÃÅÅÉ"] or 0)
	
	return xwperson
end


function MPDISPLAY(tmppid) --ÃÅÅÉÏÔÊ¾
	local aa = MPPD(tmppid)
	local bb = MPDJ(tmppid)

	if aa == 63 then
		local name = ownMPstat(1)
		local level = ownMPstat(2)
		local mptype = name[1]
		local mpdj = level[bb]
		return mptype, mpdj
	end
	if CC.MP[aa][1] == nil or CC.MPDJ[aa][bb] == nil then
		return nil, nil
	end
	local mptype = CC.MP[aa][1]
	local mpdj = CC.MPDJ[aa][bb]
	return mptype, mpdj
end


function MPDJ(tmppid)
    -- local xwperson
	-- if tmppid == JY.Base["³©Ïë"] then
		-- xwperson = 0
	-- else
		-- xwperson = tmppid
	-- end	
	-- local mpdj
	-- if MPPD(xwperson) == 0 then
		-- return 0
	-- end
	-- mpdj = math.fmod(JY.Person[xwperson]["ÎŞÓÃ"], 100)
	local xwperson = JY.Person[tmppid]["ÃÅÅÉÎ»½×"]
	
	return xwperson
end


function ownMPstat(flag)
	local wugong = 122
	local name = {JY.Wugong[wugong]["Ãû³Æ"], nil, 1, "×ÚÊ¦"}
	local level = {"ÈëÃÅµÜ×Ó", "¸ß¼¶µÜ×Ó", "ÕÆÃÅ"}
	local attrib = {} 
	for i = 1, 9 do
		attrib[i] = JY.Wugong[wugong][i.."¼¶É±ÉËÄÚÁ¦"] * 0.1
	end
	local askill = {GRTS[JY.Wugong[wugong]["Î´Öª4"]], GRTS[JY.Wugong[wugong]["Î´Öª5"]]}
	if flag == 1 then
		return name
	elseif flag == 2 then
		return level
	elseif flag == 3 then
		return attrib
	else
		return askill
	end
end
function ownMP()
	if GetS(106, 0, 0, 0) == 1 then
		return true
	end
	return false
end

--Öí½ÅÅĞ¶Ï
--[[function zj()
	--if GetS(103, 0, 0, 1) < 0 then
		--return 0
	--end
	--return GetS(103, 0, 0, 1)
	return 0
end]]

function JoinMP(tmppid, mptype, mpdj)
	
	if tmppid == JY.Base["³©Ïë"] then
		tmppid = 0
	end
	local personid = tmppid
	local r = -1
	if inteam(personid) then
		r = JYMsgBox("¼ÓÈëÃÅÅÉ",JY.Person[personid]["ĞÕÃû"].."ÊÇ·ñÒª¼ÓÈë"..CC.MP[mptype][1].."£¬³ÉÎª"..CC.MPDJ[mptype][mpdj].."£¿", {"ÊÇ","·ñ"}, 2, 189)
	else
		r = 1
	end	
	if r == 1 then
		if tmppid == 0 and mptype == 5 and mpdj == 4 then
			local r = JYMsgBox(rwwh(0,1), "»¹ÇëÑ¡ÔñÒª½ÓÈÎÄÄÒ»ÔºÌÃ°É£¬    *Òª½ÓÕÆÄÄÒ»Ö°Î»£¿£¿",  {"½ğ¸ÕµîÖ÷", "ÂŞººÌÃÖ÷","´ïÄ¦ÔºÖ÷"},3 , 1055, 1)
			local str = {"½ğ¸ÕµîÖ÷", "ÂŞººÌÃÖ÷","´ïÄ¦ÔºÖ÷"}
			QZXS('½ÓÈÎ'..str[r]..'£¡')
			CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ'] = r 
		end	
		if JY.Person[tmppid]['ÃÅÅÉ'] == 0 or JY.Person[tmppid]['ÃÅÅÉ'] ~= mptype then
			JY.Person[tmppid]["ÃÅÅÉ"] = mptype
			JY.Person[tmppid]["ÃÅÅÉÎ»½×"] = mpdj
		else
			if JY.Person[tmppid]["ÃÅÅÉÎ»½×"] < mpdj then
				JY.Person[tmppid]["ÃÅÅÉÎ»½×"] = mpdj
			end
		end	
	end			
end

function MPReq(tmppid, mptype) --¶ÓÓÑÌõ¼ş
	if MPPD(tmppid) == MPPD(0) and MPDJ(tmppid) == MPDJ(0) - 1 then
		return false
	end
	if mptype == 1 then
        return true
	elseif mptype == 2 or mptype == 3 then
		if JY.Person[tmppid]["Æ·µÂ"] >= 50 then
			return true
		end	
	elseif mptype == 4 then
		if JY.Person[tmppid]["ÄÚÁ¦×î´óÖµ"] >= 2000 then
			return true
		end		
	elseif mptype == 5 then
		if JY.Person[tmppid]["ÄÚÁ¦×î´óÖµ"] >= 3000 then
			return true
		end
	elseif mptype == 6 then
		if JY.Person[tmppid]["Óù½£ÄÜÁ¦"] >= 100 then
			return true
		end	
	elseif mptype == 7 then
		if JY.Person[tmppid]["ÓÃ¶¾ÄÜÁ¦"] >= 75 then
			return true
		end	
	elseif mptype == 8 then
		if JY.Person[tmppid]["×ÊÖÊ"] >= 75 then
			return true
		end	
	elseif mptype == 11 then
		if JY.Person[tmppid]["Óù½£ÄÜÁ¦"] >= 300 then
			return true
		end	
	elseif mptype == 12 then
		if JY.Person[tmppid]["Æ·µÂ"] > 50 then
			return true
		end	
	elseif mptype == 13 then
		if JY.Person[tmppid]["ÄÚÁ¦×î´óÖµ"] >= 3000 then
			return true
		end
	elseif mptype == 13 then
		if JY.Person[tmppid]["Óù½£ÄÜÁ¦"] >= 100 then
			return true
		end				
	elseif mptype == 63 then
		return true
	end
	return false
end

function MPAttrib(pid,f)	
	local mptype = MPPD(pid)
	--local mpdj = MPDJ(pid)
	if f == nil then
		f = 0
	end	
	--1¹¥ 2·À 3Çá 4Ò½ 5¶¾ 6½â 7°µ 8Ãü 9ÄÚ 10 11 12 13ËÄÏµ CC.MPAttrib
	if mptype > 0 and f == 0 then
		local n = JY.Person[pid]["¹¥»÷Á¦"]
		JY.Person[pid]["¹¥»÷Á¦"] = math.modf(n + (CC.MPAttrib[mptype][1]-1) * n)
		
		n = JY.Person[pid]["·ÀÓùÁ¦"]
		JY.Person[pid]["·ÀÓùÁ¦"] = math.modf(n + (CC.MPAttrib[mptype][2]-1) * n)
		
		n = JY.Person[pid]["Çá¹¦"]
		JY.Person[pid]["Çá¹¦"] = math.modf(n + (CC.MPAttrib[mptype][3]-1) * n)
		
		n = JY.Person[pid]["Ò½ÁÆÄÜÁ¦"]
		JY.Person[pid]["Ò½ÁÆÄÜÁ¦"] = math.modf(n + CC.MPAttrib[mptype][4])
		
		n = JY.Person[pid]["ÓÃ¶¾ÄÜÁ¦"]
		JY.Person[pid]["ÓÃ¶¾ÄÜÁ¦"] = math.modf(n + CC.MPAttrib[mptype][5])
		
		--n = JY.Person[pid]["½â¶¾ÄÜÁ¦"]
		--JY.Person[pid]["½â¶¾ÄÜÁ¦"] = math.modf(n + CC.MPAttrib[mptype][6])
		
		n = JY.Person[pid]["°µÆ÷¼¼ÇÉ"]
		JY.Person[pid]["°µÆ÷¼¼ÇÉ"] = math.modf(n + CC.MPAttrib[mptype][7])
		
		n = JY.Person[pid]["ÉúÃü×î´óÖµ"]
		JY.Person[pid]["ÉúÃü×î´óÖµ"] = math.modf(n + (CC.MPAttrib[mptype][8]-1)* n)
		
		n = JY.Person[pid]["ÄÚÁ¦×î´óÖµ"]
		JY.Person[pid]["ÄÚÁ¦×î´óÖµ"] = math.modf(n + (CC.MPAttrib[mptype][9]-1)* n)
	end
	if mptype > 0 and f == -1 then
		local n = JY.Person[pid]["¹¥»÷Á¦"]
		JY.Person[pid]["¹¥»÷Á¦"] = math.modf(n - (CC.MPAttrib[mptype][1]-1) * n)
		
		n = JY.Person[pid]["·ÀÓùÁ¦"]
		JY.Person[pid]["·ÀÓùÁ¦"] = math.modf(n - (CC.MPAttrib[mptype][2]-1) * n)
		
		n = JY.Person[pid]["Çá¹¦"]
		JY.Person[pid]["Çá¹¦"] = math.modf(n - (CC.MPAttrib[mptype][3]-1) * n)
		
		n = JY.Person[pid]["Ò½ÁÆÄÜÁ¦"]
		JY.Person[pid]["Ò½ÁÆÄÜÁ¦"] = math.modf(n - CC.MPAttrib[mptype][4])
		
		n = JY.Person[pid]["ÓÃ¶¾ÄÜÁ¦"]
		JY.Person[pid]["ÓÃ¶¾ÄÜÁ¦"] = math.modf(n - CC.MPAttrib[mptype][5])
		
		--n = JY.Person[pid]["½â¶¾ÄÜÁ¦"]
		--JY.Person[pid]["½â¶¾ÄÜÁ¦"] = math.modf(n - CC.MPAttrib[mptype][6])
		
		n = JY.Person[pid]["°µÆ÷¼¼ÇÉ"]
		JY.Person[pid]["°µÆ÷¼¼ÇÉ"] = math.modf(n - CC.MPAttrib[mptype][7])
		
		n = JY.Person[pid]["ÉúÃü×î´óÖµ"]
		JY.Person[pid]["ÉúÃü×î´óÖµ"] = math.modf(n - (CC.MPAttrib[mptype][8]-1)* n)
		
		n = JY.Person[pid]["ÄÚÁ¦×î´óÖµ"]
		JY.Person[pid]["ÄÚÁ¦×î´óÖµ"] = math.modf(n + (CC.MPAttrib[mptype][9]-1)* n)
	end
	Hp_Max(pid)
end

--Ò½Êõ×¨¾«
function YishuZJ(id,ys)
	if id == nil or id < 0 then
		return false
	end
	if id ~= nil and (ys == nil or ys < 0 ) then
		if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ6'] > 0 then
			return true
		else
			return false
		end
	end
	if ys == 187 and (JXPD(id,28,1) or (match_ID(id,28) and inteam(id) == false)) then --×ÓÎçÕë¾Ä¾­
		return true
	end
	if ys == 188 and (JXPD(id,45,1) or (match_ID(id,45) and inteam(id) == false)) then --»ªÙ¢ÄÚÕÑÍ¼
		return true
	end
	if ys == 189 and (JXPD(id,16,1) or (match_ID(id,16) and inteam(id) == false)) then --ºúÇàÅ£Ò½Êé
		return true
	end
	if ys == 190 and (JXPD(id,4,1) or (match_ID(id,4) and inteam(id) == false)) then --Ç§½ğ·½
		return true
	end
	if ys == 191 and (JXPD(id,85,1) or (match_ID(id,85) and inteam(id) == false)) then --»ÆµÛÄÚ¾­
		return true
	end
	if ys == 192 and (JXPD(id,17,1) or (match_ID(id,17) and inteam(id) == false)) then --¶¾¾­
		return true
	end
	--[[ if ys == 193 and (JXPD(id,2,1) or (match_ID(id,2) and inteam(id) == false)) then --Ò©ÍõÉñÆª
		return true
	end ]]
	if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ6'] > 0 then
		if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ6'] == ys then
			return true
		else
			return false
		end		
	else
		return false
	end
end

--°µÆ÷ÎäÑ§
function AnqiWG(id,aq)
	if id == nil or id < 0 then
		return false
	end
	if id ~= nil and (aq == nil or aq < 0 ) then
		if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ2'] > 0 then
			return true
		else
			return false
		end
	end			
	-----------×Ô´ø°µÆ÷Îä¹¦ÅĞ¶¨---------
	if aq == 450 and (JXPD(id,626,1) or match_ID(id,456)) then--Åùö¨À×»ğµ¯
		return true
	end
	if aq == 458 and (JXPD(id,161,1) or match_ID(id,760) or match_ID(id,773)) then--±ùÆÇÒøÕë	
		return true
	end	
	if aq == 459 and (JXPD(id,117,1) or JXPD(id,634,1)) then--ÉúËÀ·û
		return true
	end	
	if aq == 460 and (JXPD(id,57,1) or (match_ID(id,57) and inteam(id) == false)) then--Í¸¹ÇÕë
		return true
	end	
	if aq == 469 and (match_ID(id,456) or JXPD(id,27,1) or (match_ID(id,27) and inteam(id) == false) or match_ID(id,27)) then --ºÚÑªÉñÕë
		return true
	end
	if aq == 486 and ((match_ID(id,161) and MPTX(id,24)) or match_ID(id,517)) then--Ï¸Óê»¨
		return true
	end
	if aq == 489 and (JXPD(id,54,1) or match_ID(id,83)) then--ÈıòÚÎåó¡ÑÌ
		return true
	end	
	if aq == 490 and (JXPD(id,2,1) or (match_ID(id,2) and inteam(id) == false)) then--½ğÉß×¶
		return true
	end	
	if aq > 0 and match_ID(id,92) then
		return true
	end	
	if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ2'] > 0 then
		if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ2'] == aq then
			return true
		else
			return false
		end		
	else
		return false
	end		
end

function PJPD(pp)
	if GetS(106, pp, 0, 0) ~= 0 then
		return true
	else
		return false
	end
end

function PDReq(pid, str, aa, bb)
	if JY.Person[pid][str] >= aa and JY.Person[pid][str] <= bb then
		return true
	else
		return false
	end
end

-- function TGTF2()
    -- local bx = CC.ScreenW/1360
    -- local by = CC.ScreenH/768
    -- local cot = 1
    -- local cot1 = 0
    -- local cot2 = 0
    -- local size = CC.DefaultFont*0.7
    -- local maxn = 7
    -- local page = 1
    -- local jl = 0
    -- local menu = {}
    -- local w = math.modf(bx*218/size)
	-- local zm = JY.Base["ÖÜÄ¿"]
	-- local zmtf = math.ceil(zm/4)
	-- local zmtf = 10
	-- local tftable = {}
	-- local sj = JY.Base["ÖÜÄ¿"]+100
	-- -- zmtf = zmtf + zm
	-- -- if zmtf > 32 then
		-- -- zmtf = 32
	-- -- end
	-- -- if sj > #CC.TGJL then
		-- -- sj = #CC.TGJL
	-- -- end	
	-- -- RandFetch(tftable,sj,#CC.TGJL)
	-- -- --table:DeleteEqualElement(Ìì¸³±í)

	-- -- for i = 0,#CC.TGJL do
		-- -- menu[i] = CC.TGJL[tftable[i]]
	-- -- end	

    -- -- if #menu <= 0  then
        -- -- return   
    -- -- end
	-- for k,v in pairs(CC.PTFSM) do
		-- menu[#menu+1]=k
	-- end
	
    -- menu[#menu+1] = -1
    -- local hs = math.ceil((#menu-1)/4)
	-- if hs > 9 then
		-- hs = 9
	-- end
    -- if hs > maxn then 
        -- maxn = hs
	-- end

    -- while true do
	   -- if JY.Restart == 1 then
            -- break
       -- end	
        -- ClsN()
        -- lib.LoadPNG(91,46*2,0,0,1)
        -- for i = 1,4 do 
            -- for j = 1,maxn do
                -- local tf = i + (j-1+cot2)*4
                -- local sm = CC.PTFSM[menu[tf]]
                -- local cl = M_Wheat
                -- if tf == cot + cot1*4 then 
                    -- cl = C_RED
                -- end 
                -- if sm ~= nil then
                    -- lib.LoadPNG(91,47*2,bx*396+(i-1)*bx*150+bx*212,by*100+(j-1)*by*63+by*33.5,2)
                    -- DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size+bx*212,by*99+(j-1)*by*63-size/2+by*33.5,sm[1],cl,size)
                -- end
            -- end
        -- end
        
        -- local n = 0
        -- local dtf = 'ÎŞ'
        -- local xtf = 'ÎŞ'
        
        -- DrawString(bx*63+bx*212,by*100-size/2+by*33.5,'ÒÑÑ¡Ìì¸³',M_Wheat,size)
        
        -- if jl > 0 then 
            -- if CC.PTFSM[jl] ~= nil then 
                -- local ptf = CC.PTFSM[jl][2]
                -- dtf = CC.PTFSM[jl][1]
                -- if ptf ~= nil then 
                    -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,ptf,C_WHITE,size,w,size)
                -- end   
            -- end
        -- else 
            -- n = tjm(bx*63+bx*212,by*100-size/2 + size+by*33.5,'Ã»ÓĞÌì¸³',C_WHITE,size,w,size)
        -- end
        -- n = n + 2
        -- DrawString(bx*190+bx*212,by*100-size/2+by*33.5,dtf,C_RED,size)
        
        -- if cot + cot1*4 == #menu then 
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'ÏÂÒ»²½',C_RED,size)
        -- else    
            -- DrawString(bx*818-1.5*size+bx*212,by*656-size/2+by*33.5,'ÏÂÒ»²½',M_Wheat,size)
        -- end
        
        -- DrawString(bx*63+bx*212,by*100-size/2+ size + n*size+by*33.5,'µ±Ç°Ìì¸³',M_Wheat,size)
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- xtf = CC.PTFSM[menu[cot+cot1*4]][1]
        -- end    
        -- DrawString(bx*190+bx*212,by*100-size/2+ size + n*size+by*33.5,xtf,C_RED,size)
        -- n = n + 1
        
        -- if CC.PTFSM[menu[cot+cot1*4]]~= nil then
            -- local ptf = CC.PTFSM[menu[cot+cot1*4]][2]
            -- if ptf ~= nil then
                -- n = tjm(bx*63+bx*212,by*100-size/2 + size+n*size+by*33.5,ptf,C_WHITE,size,w,size)
            -- end
        -- end

        
        -- --È±Ê§±³¾°Í¼£¬ÎŞ·¨¼ÌĞø×ö
        -- ShowScreen()
        -- lib.Delay(CC.BattleDelay)
        -- local X, ktype, mx, my = lib.GetKey();
        -- if X == VK_SPACE or X == VK_RETURN then
            -- if cot + cot1*4 < #menu then 
                -- jl = menu[cot+cot1*4]
            -- else
                -- if jl > 0 then
                -- CC.TG[jl] = 1
				-- end
                -- break
            -- end
		-- elseif X == VK_ESCAPE or ktype == 4 then
			
		-- elseif X == VK_UP then
			-- if cot1 > 0 then
				-- if cot1 == cot2 then
					-- cot2 = limitX(cot2 - 1,0)
				-- end
				-- cot1 = cot1 - 1
			-- else 
				-- cot = 1
			-- end
        -- elseif X == VK_DOWN then
			-- if cot + cot1*4 < #menu then
				-- if cot1 < math.ceil((#menu)/4) - 1 then 
					-- cot1 = cot1 + 1 
					-- if cot + cot1*4 > (#menu) then
						-- cot = (#menu) - cot1*4
					-- end
				-- else 
					-- cot = (#menu) - cot1*4
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- elseif X == VK_LEFT then
			-- cot = cot - 1 
			-- if cot1 > 0 then 
				-- if cot < 1 then
					-- if cot1 == cot2 then
						-- cot2 = limitX(cot2 - 1,0)
					-- end
					-- cot1 = cot1 - 1
					-- cot = 4
				-- end
			-- elseif cot < 1 then 
				-- cot = 1
			-- end
		-- elseif X == VK_RIGHT then
			-- if cot + cot1*4 < (#menu) then
				-- cot = cot + 1
				-- if cot > 4 then
					-- if cot1 < math.ceil((#menu)/4) - 1 then 
						-- cot = 1 
						-- cot1 = cot1 + 1
					-- end	
				-- end
				-- if cot1 - cot2 > 4 then
					-- cot2 = cot2 + 1
				-- end
			-- end
        -- else--0,0
			-- local mxx = false
            -- if mx >= bx*742+bx*212 and mx <= bx*896+bx*212 and my >= by*638+by*33.5 and my <= by*673+by*33.5 then
                -- cot1 = maxn-1
                -- cot = (#menu) - cot1*4
                -- mxx = true
            -- else
                -- for i = 1,4 do 
                    -- for j = 1,maxn do
                        -- --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        -- if mx >= bx*396+(i-1)*bx*150-bx*67+bx*212 and mx <= bx*396+(i-1)*bx*150+bx*67+bx*212 and 
                            -- my >= by*100+(j-1)*by*63-by*17+by*33.5 and my <= by*100+(j-1)*by*63+by*17+by*33.5 then 
                            -- local p = i+(j - 1 + cot2)*4
                            -- if CC.PTFSM[menu[p]] ~= nil then 
                                -- cot = i 
                                -- cot1 = j - 1 + cot2
                                -- mxx = true 
                                -- break
                            -- end
                        -- end	
                    -- end
                -- end	 
            -- end  
            -- if mxx == true and ktype == 3 then 
                -- if cot + cot1*4 < #menu then 
                    -- jl = menu[cot+cot1*4]
                -- else
                    -- if jl > 0 then
                    -- CC.TG[jl] = 1
					-- end
                    -- break
                -- end
            -- end
        -- end
    -- end
    -- --CC.TGJL = {}
-- end

function TGTF()
    -- local bx = CC.WX
    -- local by = CC.HY
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxh = 7
    local page = 1
    local jl = 0
    local menu = {}
    local w = math.modf(bx*218/size)
	local zm = JY.Base["ÖÜÄ¿"]
	local zmtf = math.ceil(zm/4)
	local zmtf = 10
	local tftable = {}
	local sj = JY.Base["ÖÜÄ¿"]+100
	zmtf = zmtf + zm
	if zmtf > 32 then
		zmtf = 32
	end
	-- if sj > #CC.TGJL then
		-- sj = #CC.TGJL
	-- end	
	-- RandFetch(tftable,sj,#CC.TGJL)
	-- --table:DeleteEqualElement(Ìì¸³±í)

	-- for i = 0,#CC.TGJL do
		-- menu[i] = CC.TGJL[tftable[i]]
	-- end	

    -- if #menu <= 0  then
        -- return   
    -- end
	for k,v in pairs(CC.PTFSM) do
		if CC.PTFSM[k][3] < 3 then
			menu[#menu+1]=k
		end	
	end
	
    menu[#menu+1] = -1
    local hs = math.ceil((#menu-1)/6)
	if hs > 9 then
		hs = 9
	end
    if hs > maxh then 
        maxh = hs
	end

    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,6 do 
            for j = 1,maxh do
                local tf = i + (j-1+cot2)*6
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*6 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,168*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = 'ÎŞ'
        local xtf = 'ÎŞ'
        
        DrawString(bx*63,by*100-size/2,'ÒÑÑ¡Ìì¸³',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3] > 2 then 
				local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
					n = tjm(bx*63,by*100-size/2 + size,'ÒÑ±»½ûÓÃ',M_Gray,size,w,size)
                end   	
			elseif CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3]<3 then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'Ã»ÓĞÌì¸³',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*6 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'µ±Ç°Ìì¸³',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*6]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*6]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --È±Ê§±³¾°Í¼£¬ÎŞ·¨¼ÌĞø×ö
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if cot + cot1*6 < #menu then 
                jl = menu[cot+cot1*6]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			
		elseif X == VK_UP then
			PlayWavE(77)
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
		elseif X == VK_DOWN then
			PlayWavE(77)
			if cot + cot1*6 < #menu then
				if cot1 < math.ceil((#menu)/6) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*6 > (#menu) then
						cot = (#menu) - cot1*6
					end
				else 
					cot = (#menu) - cot1*6
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
		elseif X == VK_LEFT then
			PlayWavE(77)
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 6
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			PlayWavE(77)
			if cot + cot1*6 < (#menu) then
				cot = cot + 1
				if cot > 6 then
					if cot1 < math.ceil((#menu)/6) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxh-1
                cot = (#menu) - cot1*6
                mxx = true
            else
                for i = 1,6 do 
                    for j = 1,maxh do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*6
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
			if mxx == true and ktype == 3 then 
				PlayWavE(77)
                if cot + cot1*6 < #menu then 
                    jl = menu[cot+cot1*6]
                else
                    if jl > 0 and CC.PTFSM[jl][3]<3 then
                    	--SetTF(0,jl,1)
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end
function TGTF1()
    -- local bx = CC.WX
    -- local by = CC.HY
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
    local cot = 1
    local cot1 = 0
    local cot2 = 0
    local size = CC.DefaultFont*0.7
    local maxh = 7
    local page = 1
    local jl = 0
	local maxn = 9
    local menu = {}
    local w = math.modf(bx*218/size)
	local zm = JY.Base["ÖÜÄ¿"]
	local zmtf = math.ceil(zm/4)
	local zmtf = 10
	local tftable = {}
	local sj = JY.Base["ÖÜÄ¿"] + 100
	zmtf = zmtf + zm
	if zmtf > 32 then
		zmtf = 32
	end
	-- if sj > #CC.TGJL then
		-- sj = #CC.TGJL
	-- end	
	-- RandFetch(tftable,sj,#CC.TGJL)
	-- --table:DeleteEqualElement(Ìì¸³±í)

	-- for i = 0,#CC.TGJL do
		-- menu[i] = CC.TGJL[tftable[i]]
	-- end	

    -- if #menu <= 0  then
        -- return   
    -- end
	menu = {9988,9984,9981,9980,9973,9972,
	        9971,9970,9955,9954,9953,9952,
			9951,9949,9947,9934,9924,9923,
			9922,9916,9911,9903,9901,9897,
			9890,9880,9878,9877,9875,9874,
			9872,9871,9870,9867,9864,9859,
			9852,9850,9840,9839,9825,9824,
			9804,9802,9798,9793,9769,9768,
			9767,9766,9765,9762,9755,9737}
    menu[#menu+1] = -1
    local max = math.ceil((#menu-1)/6)
    if maxn > max then 
        maxn = max
    end
	
    menu[#menu+1] = -1
    local hs = math.ceil((#menu-1)/6)
	if hs > 9 then
		hs = 9
	end
    if hs > maxh then 
        maxh = hs
	end

    while true do
	   if JY.Restart == 1 then
            break
       end	
        ClsN()
        lib.LoadPNG(91,46*2,0,0,1)
        for i = 1,6 do 
            for j = 1,maxh do
                local tf = i + (j-1+cot2)*6
                local sm = CC.PTFSM[menu[tf]]
                local cl = M_Wheat
                if tf == cot + cot1*6 then 
                    cl = C_RED
                end
                if sm ~= nil then
                    lib.LoadPNG(91,168*2,bx*396+(i-1)*bx*150,by*100+(j-1)*by*63,2)
                    DrawString(bx*396+(i-1)*bx*150-string.len(sm[1])/4*size,by*99+(j-1)*by*63-size/2,sm[1],cl,size)
                end
            end
        end
        
        local n = 0
        local dtf = 'ÎŞ'
        local xtf = 'ÎŞ'
        
        DrawString(bx*63,by*100-size/2,'ÒÑÑ¡Ìì¸³',M_Wheat,size)
        
        if jl > 0 then 
            if CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3]>2 then 
			   local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
            n = tjm(bx*63,by*100-size/2 + size,'ÒÑ±»½ûÓÃ',M_Gray,size,w,size)
                end   	
			elseif CC.PTFSM[jl] ~= nil and CC.PTFSM[jl][3] < 3 then 
                local ptf = CC.PTFSM[jl][2]
                dtf = CC.PTFSM[jl][1]
                if ptf ~= nil then 
                    n = tjm(bx*63,by*100-size/2 + size,ptf,C_WHITE,size,w,size)
                end   
            end
        else 
            n = tjm(bx*63,by*100-size/2 + size,'Ã»ÓĞÌì¸³',C_WHITE,size,w,size)
        end
        n = n + 2
        DrawString(bx*190,by*100-size/2,dtf,C_RED,size)
        
        if cot + cot1*6 == #menu then 
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',C_RED,size)
        else    
            DrawString(bx*818-1.5*size,by*656-size/2,'ÏÂÒ»²½',M_Wheat,size)
        end
        
        DrawString(bx*63,by*100-size/2+ size + n*size,'µ±Ç°Ìì¸³',M_Wheat,size)
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            xtf = CC.PTFSM[menu[cot+cot1*6]][1]
        end    
        DrawString(bx*190,by*100-size/2+ size + n*size,xtf,C_RED,size)
        n = n + 1
        
        if CC.PTFSM[menu[cot+cot1*6]]~= nil then
            local ptf = CC.PTFSM[menu[cot+cot1*6]][2]
            if ptf ~= nil then
                n = tjm(bx*63,by*100-size/2 + size+n*size,ptf,C_WHITE,size,w,size)
            end
        end

        
        --È±Ê§±³¾°Í¼£¬ÎŞ·¨¼ÌĞø×ö
        ShowScreen()
        lib.Delay(CC.BattleDelay)
        local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			PlayWavE(77)
            if cot + cot1*6 < #menu then 
                jl = menu[cot+cot1*6]
            else
                if jl > 0 then
					--CC.TG[jl] = 1
					CC.PTF[0][jl] = 1
				end
                break
            end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			
		elseif X == VK_UP then
			PlayWavE(77)
			if cot1 > 0 then
				if cot1 == cot2 then
					cot2 = limitX(cot2 - 1,0)
				end
				cot1 = cot1 - 1
			else 
				cot = 1
			end
		elseif X == VK_DOWN then
			PlayWavE(77)
			if cot + cot1*6 < #menu then
				if cot1 < math.ceil((#menu)/6) - 1 then 
					cot1 = cot1 + 1 
					if cot + cot1*6 > (#menu) then
						cot = (#menu) - cot1*6
					end
				else 
					cot = (#menu) - cot1*6
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
		elseif X == VK_LEFT then
			PlayWavE(77)
			cot = cot - 1 
			if cot1 > 0 then 
				if cot < 1 then
					if cot1 == cot2 then
						cot2 = limitX(cot2 - 1,0)
					end
					cot1 = cot1 - 1
					cot = 6
				end
			elseif cot < 1 then 
				cot = 1
			end
		elseif X == VK_RIGHT then
			PlayWavE(77)
			if cot + cot1*6 < (#menu) then
				cot = cot + 1
				if cot > 6 then
					if cot1 < math.ceil((#menu)/6) - 1 then 
						cot = 1 
						cot1 = cot1 + 1
					end	
				end
				if cot1 - cot2 > 6 then
					cot2 = cot2 + 1
				end
			end
        else
			local mxx = false
            if mx >= bx*742 and mx <= bx*896 and my >= by*638 and my <= by*673 then
                cot1 = maxh-1
                cot = (#menu) - cot1*6
                mxx = true
            else
                for i = 1,6 do 
                    for j = 1,maxh do
                        --bx*396+(i-1)*bx*150,by*100+(j-1)*by*63
                        if mx >= bx*396+(i-1)*bx*150-bx*67 and mx <= bx*396+(i-1)*bx*150+bx*67 and 
                            my >= by*100+(j-1)*by*63-by*17 and my <= by*100+(j-1)*by*63+by*17 then 
                            local p = i+(j - 1 + cot2)*6
                            if CC.PTFSM[menu[p]] ~= nil then 
                                cot = i 
                                cot1 = j - 1 + cot2
                                mxx = true 
                                break
                            end
                        end	
                    end
                end	 
            end  
			if mxx == true and ktype == 3 then 
				PlayWavE(77)
                if cot + cot1*6 < #menu then 
                    jl = menu[cot+cot1*6]
                else
                    if jl > 0 and CC.PTFSM[jl][3] < 3 then
                    	--SetTF(0,jl,1)
						--CC.TG[jl] = 1
						CC.PTF[0][jl] = 1
					end
                    break
                end
            end
        end
    end
    --CC.TGJL = {}
end
function RandFetch(list,num,poolSize,pool) -- list ´æ·ÅÉ¸Ñ¡½á¹û£¬num É¸È¡¸öÊı£¬poolSize É¸È¡Ô´´óĞ¡£¬pool É¸È¡Ô´
    pool = pool or {}
    math.randomseed( tonumber(tostring(os.time()):reverse():sub(1,6)))
    for i=1,num do
        local rand = math.random(i,10)
        local tmp = pool[rand] or rand -- ¶ÔÓÚµÚ¶ş¸ö³Ø×Ó£¬ĞòºÅ¸úidºÅÊÇÒ»ÖÂµÄ
        pool[rand] = pool[i] or i
        pool[i] = tmp
        table.insert(list, tmp)
		--math.random()
    end
end
function removebyvalue(array, value, removeadll)
	--    tableÖĞÉ¾³ıÖ¸¶¨ÔªËØ(·Ç¸ù¾İË÷Òı)
	--    @param    array Òª²Ù×÷µÄÈİÆ÷
	--    @param     value É¾³ıvalueÖµ
	--     @param    removeadll ÊÇ·ñÉ¾³ıËùÓĞÏàÍ¬µÄÖµ
	--    @return ·µ»ØÉ¾³ıÖµµÄ¸öÊı
    --    deleteNumÓÃÓÚ½ÓÊÕ/·µ»ØÉ¾³ı¸öÊı; i/max ¹¹³É¿ØÖÆwhileÑ­»·
    local deleteNum,i,max=0,1,#array
    while i<=max do
        if array[i] == value then
            --    Í¨¹ıË÷Òı²Ù×÷±íµÄÉ¾³ıÔªËØ
            table.remove(array,i)
            --    ±ê¼ÇÉ¾³ı´ÎÊı
            deleteNum = deleteNum+1 
            i = i-1
            --    ¿ØÖÆwhileÑ­»·²Ù×÷
            max = max-1
            --    ÅĞ¶ÏÊÇ·ñÉ¾³ıËùÓĞÏàÍ¬µÄvalueÖµ
			if not removeadll then 
				break 
			end
        end
        i= i+1
    end
    --    ·µ»ØÉ¾³ı´ÎÊı
    return deleteNum
end

function saveShowMenu(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
	--	lib.LoadPNG(91, 501 * 2 , 0 , 0, 1)
		DrawString(280,CC.ScreenH*1/6+40,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"), C_ORANGE, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼üÊ±»úÅĞ¶¨
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "×Ô¶¯" then
		In_Battle = true
	end
	--ÎŞ¾Æ²»»¶£ºÕ½Êõ²Ëµ¥ÅĞ¶¨
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "µÈ´ı" then
		In_Tactics = true
	end
	--ÆäËü²Ëµ¥ÅĞ¶¨
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "Ò½ÁÆ" then
		In_Other = true
	end	
	--ĞŞ¸ÄÕ½¶·²Ëµ¥¿í¶ÈÒÔ±ãÏÔÊ¾¿ì½İ¼ü
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--¿ì½İ¼üÌáÊ¾ÏÔÊ¾
		if In_Battle == true then
			if newMenu[i][1] == "¹¥»÷" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÔË¹¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "Õ½Êõ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÆäËü" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "ĞîÁ¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "·ÀÓù" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "µÈ´ı" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¼¯ÖĞ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "ĞİÏ¢" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
			if newMenu[i][1] == "ÓÃ¶¾" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "½â¶¾" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "Ò½ÁÆ" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "ÎïÆ·" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
				elseif newMenu[i][1] == "×´Ì¬" then
					DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
				end
			end
		 end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc »ò ÍË³ö
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				start = 1
			end
		--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼ü
		--¹¥»÷
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9Ö±½Ó¹¥»÷
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÔË¹¦
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Õ½Êõ
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÆäËü
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--ÓÃ¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--½â¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Ò½ÁÆ
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÎïÆ·
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--×´Ì¬
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞİÏ¢
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÌØÉ«Ö¸Áî
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C²é¿´
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞîÁ¦
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--·ÀÓù
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--µÈ´ı
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¼¯ÖĞ
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--Ñ¡ÖĞ
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--Ñ¡ÖĞÈ·ÈÏ
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÄÚÁ¦²»×ã
					if JY.Person[id]["ÄÚÁ¦"] < 2000 then
						DrawStrBoxWaitKey("ÄÚÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					--ÔË¹¦ÌåÁ¦²»×ã
					elseif JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÌåÁ¦²»×ã
					if JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
			
					--ÎŞ¾Æ²»»¶£ºÖØĞ´Ò»ÏÂÕâÀïµÄ·µ»ØÂß¼­ÒÔÊÊÓ¦ÔË¹¦
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end



function selectShowMenu2(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
		lib.LoadPNG(91, 502 * 2 , bx*190+bx*212 , by*145+by*33.5, 1)
		--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"), C_ORANGE, CC.DefaultFont)
		DrawString(CC.ScreenW/2-CC.DefaultFont*3-25, CC.ScreenH/2-CC.DefaultFont*7+by*25, "ÇëÑ¡Ôñ¾öÈü¶ÔÊÖ", C_RED, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼üÊ±»úÅĞ¶¨
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "×Ô¶¯" then
		In_Battle = true
	end
	--ÎŞ¾Æ²»»¶£ºÕ½Êõ²Ëµ¥ÅĞ¶¨
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "µÈ´ı" then
		In_Tactics = true
	end
	--ÆäËü²Ëµ¥ÅĞ¶¨
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "Ò½ÁÆ" then
		In_Other = true
	end	
	--ĞŞ¸ÄÕ½¶·²Ëµ¥¿í¶ÈÒÔ±ãÏÔÊ¾¿ì½İ¼ü
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--¿ì½İ¼üÌáÊ¾ÏÔÊ¾
		if In_Battle == true then
			if newMenu[i][1] == "¹¥»÷" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÔË¹¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "Õ½Êõ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÆäËü" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "ĞîÁ¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "·ÀÓù" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "µÈ´ı" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¼¯ÖĞ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "ĞİÏ¢" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
		if newMenu[i][1] == "ÓÃ¶¾" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "½â¶¾" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "Ò½ÁÆ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÎïÆ·" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "×´Ì¬" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
			end
		end
	  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc »ò ÍË³ö
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				start = 1
			end
		--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼ü
		--¹¥»÷
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9Ö±½Ó¹¥»÷
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÔË¹¦
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Õ½Êõ
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÆäËü
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--ÓÃ¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--½â¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Ò½ÁÆ
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÎïÆ·
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--×´Ì¬
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞİÏ¢
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÌØÉ«Ö¸Áî
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C²é¿´
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞîÁ¦
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--·ÀÓù
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--µÈ´ı
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¼¯ÖĞ
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--Ñ¡ÖĞ
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--Ñ¡ÖĞÈ·ÈÏ
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÄÚÁ¦²»×ã
					if JY.Person[id]["ÄÚÁ¦"] < 2000 then
						DrawStrBoxWaitKey("ÄÚÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					--ÔË¹¦ÌåÁ¦²»×ã
					elseif JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÌåÁ¦²»×ã
					if JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
			
					--ÎŞ¾Æ²»»¶£ºÖØĞ´Ò»ÏÂÕâÀïµÄ·µ»ØÂß¼­ÒÔÊÊÓ¦ÔË¹¦
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end


function selectShowMenu1(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
		lib.LoadPNG(91, 502 * 2 , bx*190+bx*212 , by*145+by*33.5, 1)
		--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"), C_ORANGE, CC.DefaultFont)
		DrawString(CC.ScreenW/2-CC.DefaultFont*3-25, CC.ScreenH/2-CC.DefaultFont*7+by*25, "ÇëÑ¡Ôñ¸´Èü¶ÔÊÖ", C_RED, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼üÊ±»úÅĞ¶¨
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "×Ô¶¯" then
		In_Battle = true
	end
	--ÎŞ¾Æ²»»¶£ºÕ½Êõ²Ëµ¥ÅĞ¶¨
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "µÈ´ı" then
		In_Tactics = true
	end
	--ÆäËü²Ëµ¥ÅĞ¶¨
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "Ò½ÁÆ" then
		In_Other = true
	end	
	--ĞŞ¸ÄÕ½¶·²Ëµ¥¿í¶ÈÒÔ±ãÏÔÊ¾¿ì½İ¼ü
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--¿ì½İ¼üÌáÊ¾ÏÔÊ¾
		if In_Battle == true then
			if newMenu[i][1] == "¹¥»÷" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÔË¹¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "Õ½Êõ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÆäËü" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "ĞîÁ¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "·ÀÓù" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "µÈ´ı" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¼¯ÖĞ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "ĞİÏ¢" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
		if newMenu[i][1] == "ÓÃ¶¾" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "½â¶¾" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "Ò½ÁÆ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÎïÆ·" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "×´Ì¬" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
			end
		end
	  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc »ò ÍË³ö
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				start = 1
			end
		--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼ü
		--¹¥»÷
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9Ö±½Ó¹¥»÷
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÔË¹¦
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Õ½Êõ
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÆäËü
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--ÓÃ¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--½â¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Ò½ÁÆ
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÎïÆ·
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--×´Ì¬
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞİÏ¢
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÌØÉ«Ö¸Áî
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C²é¿´
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞîÁ¦
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--·ÀÓù
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--µÈ´ı
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¼¯ÖĞ
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--Ñ¡ÖĞ
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--Ñ¡ÖĞÈ·ÈÏ
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÄÚÁ¦²»×ã
					if JY.Person[id]["ÄÚÁ¦"] < 2000 then
						DrawStrBoxWaitKey("ÄÚÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					--ÔË¹¦ÌåÁ¦²»×ã
					elseif JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÌåÁ¦²»×ã
					if JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
			
					--ÎŞ¾Æ²»»¶£ºÖØĞ´Ò»ÏÂÕâÀïµÄ·µ»ØÂß¼­ÒÔÊÊÓ¦ÔË¹¦
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end
function selectShowMenu(menuItem, numItem, numShow, x1, y1, x2, y2, isBox, isEsc, size, color, selectColor)
	local w = 0
	local h = 0
	local i = 0
	local num = 0
	local newNumItem = 0
	local bx,by = CC.ScreenW/1360,CC.ScreenH/768
	lib.GetKey()
	local newMenu = {}
	for i = 1, numItem do
		if menuItem[i][3] > 0 then
			newNumItem = newNumItem + 1
			newMenu[newNumItem] = {menuItem[i][1], menuItem[i][2], menuItem[i][3], i}
		end
	end
	if newNumItem == 0 then
		return 0
	end
	if numShow == 0 or newNumItem < numShow then
		num = newNumItem
	else
		num = numShow
	end
	local maxlength = 0
	if x2 == 0 and y2 == 0 then
		for i = 1, newNumItem do
		  if maxlength < string.len(newMenu[i][1]) then
			maxlength = string.len(newMenu[i][1])
		  end
		end
		w = size * maxlength / 2 + 2 * CC.MenuBorderPixel
		h = (size + CC.RowPixel) * num + CC.MenuBorderPixel
		lib.LoadPNG(91, 502 * 2 , bx*190+bx*212 , by*145+by*33.5, 1)
		--DrawString(104,CC.ScreenH*1/6+26,  string.format("%-6s %-4s %-10s %-4s %-4s %-4s %-10s","´æµµÃû", "Ö÷½Ç", "ĞÕÃû", "ÄÑ¶È", "×ÊÖÊ", "ÌìÊé", "Î»ÖÃ"), C_ORANGE, CC.DefaultFont)
		DrawString(CC.ScreenW/2-CC.DefaultFont*3-25, CC.ScreenH/2-CC.DefaultFont*7+by*25, "ÇëÑ¡Ôñ³õÈü¶ÔÊÖ", C_RED, CC.DefaultFont)
	else
		w = x2 - x1
		h = y2 - y1
	end
	local start = 1
	local current = 1
	for i = 1, newNumItem do
		if newMenu[i][3] == 2 then
		  current = i
		end
	end
	if numShow ~= 0 then
		current = 1
	end
	--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼üÊ±»úÅĞ¶¨
	local In_Battle = false;
	if JY.Status == GAME_WMAP and numItem >= 8 and menuItem[8][1] == "×Ô¶¯" then
		In_Battle = true
	end
	--ÎŞ¾Æ²»»¶£ºÕ½Êõ²Ëµ¥ÅĞ¶¨
	local In_Tactics = false;
	if JY.Status == GAME_WMAP and numItem >= 3 and menuItem[3][1] == "µÈ´ı" then
		In_Tactics = true
	end
	--ÆäËü²Ëµ¥ÅĞ¶¨
	local In_Other = false;
	if JY.Status == GAME_WMAP and numItem >= 5 and menuItem[3][1] == "Ò½ÁÆ" then
		In_Other = true
	end	
	--ĞŞ¸ÄÕ½¶·²Ëµ¥¿í¶ÈÒÔ±ãÏÔÊ¾¿ì½İ¼ü
	if In_Battle == true or In_Tactics == true  or In_Other == true then
		w = w + 15
	end
	local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
	local returnValue = 0
	if isBox == 1 then
		DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	end
  
 
  while true do
	lib.GetKey()
	if JY.Restart == 1 then
		break
	end
    if num ~= 0 then
		ClsN();
		lib.LoadSur(surid, 0, 0)
	    -- if isBox == 1 then
	      -- DrawBox(x1, y1, x1 + (w), y1 + (h), C_WHITE)
	    -- end
  	end
	  for i = start, start + num - 1 do
	    local drawColor = color
	    if i == current then
			drawColor = selectColor
			lib.Background(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), x1 - CC.MenuBorderPixel + (w), y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) + size, 128, color)
	    end
	    DrawString(x1 + CC.MenuBorderPixel, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel), newMenu[i][1], drawColor, size)
		--¿ì½İ¼üÌáÊ¾ÏÔÊ¾
		if In_Battle == true then
			if newMenu[i][1] == "¹¥»÷" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "A", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÔË¹¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "G", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "Õ½Êõ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "S", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÆäËü" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "H", LimeGreen, CC.FontSmall)
			elseif newMenu[i][2] == War_TgrtsMenu then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "T", LimeGreen, CC.FontSmall)
			end
		end
		if In_Tactics == true then
			if newMenu[i][1] == "ĞîÁ¦" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "P", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "·ÀÓù" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "D", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "µÈ´ı" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "W", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "¼¯ÖĞ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "J", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "ĞİÏ¢" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "R", LimeGreen, CC.FontSmall)			
			end
		end 
		if In_Other == true then
		if newMenu[i][1] == "ÓÃ¶¾" then
			DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "V", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "½â¶¾" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Q", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "Ò½ÁÆ" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "F", LimeGreen, CC.FontSmall)
			elseif newMenu[i][1] == "ÎïÆ·" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "E", LimeGreen, CC.FontSmall)
		    elseif newMenu[i][1] == "×´Ì¬" then
				DrawString(x1 + CC.MenuBorderPixel + size*2, y1 + CC.MenuBorderPixel + (i - start) * (size + CC.RowPixel) +2, "Z", LimeGreen, CC.FontSmall)	
			end
		end
	  end
		ShowScreen()

		local keyPress, ktype, mx, my = WaitKey(1)
		lib.Delay(CC.Frame)
	  
		if keyPress==VK_ESCAPE or ktype == 4 then
			--Esc »ò ÍË³ö
			if isEsc==1 then
				break
				--return 0
			end
		elseif keyPress==VK_DOWN or ktype == 7 then                --Down
			current = current +1;
			if current > (start + num-1) then
				start=start+1;
			end
			if current > newNumItem then
				start=1;
				current =1;
			end
		elseif keyPress==VK_UP or ktype == 6 then                  --Up
			current = current -1;
			if current < start then
				start=start-1;
			end
			if current < 1 then
				current = newNumItem;
				start =current-num+1;
			end
		elseif keyPress == VK_RIGHT then
			current = current + 10
			if start + num - 1 < current then
				start = start + 10
			end
			if newNumItem < current +start then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				current = newNumItem
				start = current - num + 1
			end
		elseif keyPress == VK_LEFT then
			current = current - 10
			if current < start then
				start = start - 10
			end
			if current < 1 then
				start = 1
				current = 1
			elseif current < num then                --Alungky ĞŞ¸´¿´¹¥ÂÔÊ±»áÌø³öµÄBUG
				start = 1
			end
		--ÎŞ¾Æ²»»¶£ºÕ½¶·¿ì½İ¼ü
		--¹¥»÷
		elseif In_Battle == true and keyPress == VK_A and menuItem[2][3] == 1 then
			local r=War_FightMenu();
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--1-9Ö±½Ó¹¥»÷
		elseif In_Battle == true and (keyPress >= 49 and keyPress <= 57) and menuItem[2][3] == 1 then
			local r=War_FightMenu(nil, nil, keyPress-48);
			if r==1 then
			returnValue= -2;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÔË¹¦
		elseif In_Battle == true and keyPress == VK_G then
			local r=War_YunGongMenu();
			if r==20 then
				returnValue= 20;
				break;
			elseif r==10 then
				returnValue= 10;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Õ½Êõ
		elseif In_Battle == true and keyPress == VK_S then
			local r=War_TacticsMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÆäËü
		elseif In_Battle == true and keyPress == VK_H then
			local r=War_OtherMenu();
			if r==1 then
				returnValue= -4;
				break;
			elseif r == 20 then
				returnValue= 20;
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end			
		--ÓÃ¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_V and menuItem[5][3] == 1 then
			local r=War_PoisonMenu();
			if r==1 then
			returnValue= -5;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--½â¶¾
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Q and menuItem[5][3] == 1 then
			local r=War_DecPoisonMenu();
			if r==1 then
			returnValue= -6;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--Ò½ÁÆ
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_F and menuItem[5][3] == 1 then
			local r=War_DoctorMenu();
			if r==1 then
			returnValue= -7;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÎïÆ·
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_E and menuItem[5][3] == 1 then
			local r=War_ThingMenu();
			if r==1 then
			returnValue= -8;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--×´Ì¬
		elseif (In_Battle == true or In_Other == true) and keyPress == VK_Z then
			local r=War_StatusMenu();
			if r==1 then
			returnValue= -9;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞİÏ¢
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_R then
			local r=War_RestMenu();
			if r==1 then
			returnValue= -10;
			break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ÌØÉ«Ö¸Áî
		elseif In_Battle == true and keyPress == VK_T and menuItem[6][3] == 1 then
			local r=War_TgrtsMenu();
			if r==1 then
				returnValue= -11;
				break;
			elseif r==20 then
				returnValue= 20
				break;
			end
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--C²é¿´
		elseif In_Battle == true and keyPress == VK_C then
			local r=MapWatch();
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--ĞîÁ¦
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_P then
			local r=War_ActupMenu();
			if In_Battle == true then
				returnValue = -4;
			else	
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--·ÀÓù
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_D then
			local r=War_DefupMenu();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--µÈ´ı
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_W then
			local r=War_Wait();
			if In_Battle == true then
				returnValue = -4;
			else
				returnValue = 5;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		--¼¯ÖĞ
		elseif (In_Battle == true or In_Tactics == true) and keyPress == VK_J then
			War_Focus()
			if In_Battle == true then
				returnValue = 20;
			else
				returnValue = 6;
			end
			break;
			ClsN();
			lib.LoadSur(surid,0,0);
			if isBox==1 then
				DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
			end
		else
			local mk = false;
			if ktype == 2 or ktype == 3 then			--Ñ¡ÖĞ
				if mx >= x1 and mx <= x1 + w and my >= y1 and my <= y1 + h then
					current = start + math.modf((my - y1 - CC.MenuBorderPixel) / (size + CC.RowPixel))
					mk = true;
				end
			end
			--Ñ¡ÖĞÈ·ÈÏ
			if  keyPress==VK_SPACE or keyPress==VK_RETURN or ktype == 5 or (ktype == 3 and mk) then
				if newMenu[current][2]==nil then
					returnValue=newMenu[current][4];
					break;
				elseif newMenu[current][2] == SelectNeiGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÄÚÁ¦²»×ã
					if JY.Person[id]["ÄÚÁ¦"] < 2000 then
						DrawStrBoxWaitKey("ÄÚÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					--ÔË¹¦ÌåÁ¦²»×ã
					elseif JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",C_RED,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
						if r == 20 then
							returnValue= 20; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				elseif newMenu[current][2] == SelectQingGongMenu then
					local id = WAR.Person[WAR.CurID]["ÈËÎï±àºÅ"]
					--ÔË¹¦ÌåÁ¦²»×ã
					if JY.Person[id]["ÌåÁ¦"] < 20 then
						DrawStrBoxWaitKey("ÌåÁ¦²»×ã£¬ÎŞ·¨ÔË¹¦",M_DeepSkyBlue,CC.DefaultFont,nil,LimeGreen)
					else
						local r=newMenu[current][2](newMenu,current); 
						if r == 10 then
							returnValue= 10; 
							break;
						end
						ClsN();
						lib.LoadSur(surid,0,0);
						if isBox==1 then
							DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
						end
					end
				else
					local r=newMenu[current][2](newMenu,current);               --µ÷ÓÃ²Ëµ¥º¯Êı
			
					--ÎŞ¾Æ²»»¶£ºÖØĞ´Ò»ÏÂÕâÀïµÄ·µ»ØÂß¼­ÒÔÊÊÓ¦ÔË¹¦
					if r==1 then
						returnValue= -newMenu[current][4];
						break;
					--Á¬ĞøÁ½¼¶²Ëµ¥È«²¿·µ»Ø20×÷ÎªÅĞ¶¨²ÎÊı
					elseif In_Battle == true and r == 20 then	
						returnValue= 20;
						break;
					elseif In_Battle == true and r == 10 then	
						returnValue= 10;
						break;
					end			
					ClsN();
					lib.LoadSur(surid,0,0);
					if isBox==1 then
						DrawBox(x1,y1,x1+w,y1+h,C_WHITE);
					end
				end
			end		
		end
	end
	lib.FreeSur(surid)
	return returnValue
end


function tjm_menu()
   local cont = 1
   local cont1 = 0
   local page = 1
   local x = CC.ScreenW/2-CC.ScreenW/1360*400
   --local w = (CC.ScreenW-x*2)/10
   local y = CC.ScreenH-CC.ScreenH/768*50
   local sx = CC.ScreenW/1360*40
   local py = 0
   local pd = 0
   local size1 = CC.DefaultFont*0.8
    
   -- local jm = {--{'²Ëµ¥',378},
			   -- {'×´Ì¬',145,ShowPersonStatus},
			   -- {'ÎïÆ·',146,tjm.tjmhs2.SelectThing},
			   -- --{'×°±¸',372},
			   -- --{'ÎäÑ§',373,tjm.tjmhs1.tjm29},
			   -- --{'ÃÅÅÉ',374},
			   -- {'¾­Âö',147,Menu_Jingmai},
			   -- {'ÈÎÎñ',148,nil},
			   -- --{'´æµµ',377},
			  --  {'ÉèÖÃ',149,Menu_System},
   -- }
   
   local jm = {--{'²Ëµ¥',378},
			   {'×´Ì¬',400,ShowPersonStatusA},--ShowPersonStatus--New_Team
			   {'ÎïÆ·',401,Menu_Thing},--SelectThing Menu_Thing1
			   --{'×°±¸',372},
			   {'ÎäÑ§',406,MJMenu},
			   --{'ÃÅÅÉ',374},
			   --{'Ó¡ĞÅ',410,QUANZHANGQX1},
			   {'¾­Âö',402,QUANZHANGQX1},
			   {'ÈÎÎñ',403,TSInstruce},
			   --{'´æµµ',377},
			   {'ÉèÖÃ',404,New_Ssystem},
   }
   
   local num = 10
   
   if num > #jm then 
      num = #jm 
   end	  
   local w = CC.ScreenW/1360*85
   local aa = 0
   while aa < num*w-CC.ScreenW/1360*20 do
       if JY.Restart == 1 then
		 break
		end	
	   lib.GetKey()
	   lib.SetClip(CC.ScreenW/1360*70, CC.ScreenH/768*658, CC.ScreenW) --²Ëµ¥±³¾°Í¼
       for i = 1,num do 
	       lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w-num*w+sx+aa,y-CC.ScreenH/768*30,2,240,nil,CC.ScreenW/1360*85)
       end
	   lib.SetClip(0,0,0,0)
	   lib.PicLoadCache(92,29*2,CC.ScreenW/1360*40,CC.ScreenH/768*615+70,2,256,nil,CC.ScreenW/1360*60)
	   ShowScreen()
	   lib.Delay(20)
	   Cls()
	   aa = aa + CC.ScreenW/1360*20
   end 
   
   while true do 
      Cls()
	  if JY.Restart == 1 then
		 break
		end	
	  lib.PicLoadCache(92,29*2,CC.ScreenW/1360*40,CC.ScreenH/768*615+70,2,256,nil,CC.ScreenW/1360*60)
	  for i = 1,num do 
	      if cont == i then 
		     lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w+sx,y-CC.ScreenH/768*30+py,2,240,nil,CC.ScreenW/1360*85)
		  else 
		     lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w+sx,y-CC.ScreenH/768*30,2,240,nil,CC.ScreenW/1360*85)
		  end
	  end
	  if pd == 1 then
	     py = py - CC.ScreenH/768*1
		 if py <= -CC.ScreenH/768*20 then 
		    pd = 0 
		 end 
      elseif pd == 0 then 
         py = py + CC.ScreenH/768*1
         if py >= CC.ScreenH/768*10 then 
            pd = 1
         end		 
	  end
	  ShowScreen()
	  lib.Delay(20)
	    local X,ktype,mx,my = lib.GetKey()
	    if X == VK_SPACE or X == VK_RETURN then 
			if jm[cont+cont1][3] ~= nil then
			  -- local n = cont+cont1
			 
			  -- local rr 
			  -- if n == 1  then
				 -- local te = Team()
				 -- if te > 0 then
					-- rr = jm[cont+cont1][3](te)
				-- else
					-- break
				-- end
				 
				 
			  -- else
				 -- rr = jm[cont+cont1][3]()
			  -- end
				local rr = jm[cont+cont1][3]()
				if rr ~= nil and rr > 0 then
					break
				end
			end	  
		elseif X == VK_ESCAPE or ktype == 4 then
          break
		elseif X == VK_LEFT then
		  if cont1 > 0 then 
		     if cont > 1 then 
		        cont = cont - 1
			 else 
                cont1 = cont1 - 1	  
			 end	
		  else
             cont = cont - 1		
		  if cont < 1 then 
		     cont = num
			 cont1 = #jm - cont
		  end
		  end
		  py = 0
          pd = 0
		elseif X == VK_RIGHT then
          cont = cont + 1		
		  if cont > num then 
		     cont = num
			 cont1 = cont1 + 1
		  end
		  if cont1 + cont > #jm then 
		     cont1 = 0
			 cont = 1
		  end
		  py = 0
          pd = 0
		elseif X == VK_UP or ktype == 6 then
		        cont1 = cont1 - num
				cont = 1
				if cont1 < 0 then 
				   cont1 = 0 
				end
		  py = 0
          pd = 0
		elseif X == VK_DOWN or ktype == 7 then
		        cont1 = cont1 + num
				cont = num
				if cont1 + cont > #jm then 
				   cont1 = #jm-cont
				end	
		  py = 0
          pd = 0
	    else 
		    local mxx = false
            for i = 1,num do
			    if mx >= (i)*w+sx - CC.ScreenW/1360*40 and mx <= (i)*w+sx + CC.ScreenW/1360*40 and 
				   my >= y-CC.ScreenH/768*72 and my <= y+CC.ScreenH/768*12 then 
				   cont = i
                   mxx = true
				   break
				end
			end
			if mxx == true and ktype == 3 then 
				if jm[cont+cont1][3] ~= nil then
			    --  local rr = jm[cont+cont1][3]()
				
				-- local n = cont+cont1
			    -- local rr 
				  -- if n == 1  then
					-- -- local te = Team()
					-- -- if te > 0 then
						-- -- rr = jm[cont+cont1][3](te)
					-- -- else
						-- -- break
					-- -- end
					 
				  -- else
					 -- rr = jm[cont+cont1][3]()
				  -- end
					local rr = jm[cont+cont1][3]()
				  
					if rr ~= nil and rr > 0 then
						break
					end
				end	 
			end
	    end
   end
end

function PersonStatus(t,page)
	local bx = CC.ScreenW/1360
	local by = CC.ScreenH/768
	local size = CC.DefaultFont*0.7
	local size1 = CC.DefaultFont*0.6
	local size2 = CC.DefaultFont*0.55
	local h = by*size1*1.2
	local cx = 1 
	local cx1 = 1
	local cot = {0,0,0,0,0}
	local fy = 0 --ÊôĞÔËµÃ÷·­Ò³
	local fymax = 0 --×î´ó·­Ò³
	local team = {}
	if JY.Restart == 1 then
		do return end
	end
	if t < 0 then
		do return end
	end	
	for tt = 1,CC.TeamNum do 
		if JY.Base['¶ÓÎé'..tt] >= 0 then 
			team[#team+1] = JY.Base['¶ÓÎé'..tt]
		end
	end 
	if page == nil then 
		page = 1 
	end
	
   local id = -1
   if JY.Status == GAME_WMAP then
	--say("ÊıÖµ²âÊÔ"..t,0,1)
		id = WAR.Person[t]["ÈËÎï±àºÅ"]
	  --id=t
   else 
      id = JY.Base['¶ÓÎé'..t]
   end
   -- if JY.Status == GAME_WMAP then
	    -- if WAR.Person[teamid]["ÎÒ·½"] == false then
	        -- pagenum = 2
	    -- end
	-- end
local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
   if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
   if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
   while true do
    
   if JY.Restart == 1 then
		do return end
	end
   Cls()
   
   local p = JY.Person[id]
   local picx,picy = lib.GetPNGXY(1,psx(id,'°ëÉíÏñ')*2)
   local lb = {{},{},{},{},{}}
   local lb1 = {}
   local lb2 = {nil,nil,nil,nil,nil}
   local function DrawAttrib(str, x,y,color1,size)
		local i = 0
		--DrawString(x1, y1 + h * i, string.sub(4), color1, size)
		--¶îÍâÏµÊıÏÔÊ¾
		--local str;
		if str == "È­ÕÆ¹¦·ò" then
			local bonus = 0
			bonus = TrueQZ(id) - JY.Person[id]["È­ÕÆ¹¦·ò"] 
			if bonus > 0 then
				DrawString(x,y,  string.format("¡ü %s",bonus), color1, size)
			end
		end
		
		if str == "Ö¸·¨¼¼ÇÉ" then
			local bonus = 0
			
			bonus = TrueZF(id) - JY.Person[id]["Ö¸·¨¼¼ÇÉ"] 
			if bonus > 0 then
				DrawString(x, y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		
		if str == "Óù½£ÄÜÁ¦" then
			local bonus = 0
			bonus = TrueYJ(id) - JY.Person[id]["Óù½£ÄÜÁ¦"] 
			if bonus > 0 then
				DrawString(x, y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		
        if str == "Ë£µ¶¼¼ÇÉ" then
            local bonus = 0
			bonus = TrueSD(id) - JY.Person[id]["Ë£µ¶¼¼ÇÉ"] 		
			if bonus > 0 then
				DrawString(x, y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		
        if str == "ÌØÊâ±øÆ÷" then
            local bonus = 0
			bonus = TrueTS(id) - JY.Person[id]["ÌØÊâ±øÆ÷"]
			if bonus > 0 then
				DrawString(x,y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		--Õ½³¡ÇéÂÂ¼Ó³É°µÆ÷¼¼ÇÉ
		if JY.Status == GAME_WMAP then
				if str == "Ò½ÁÆÄÜÁ¦" then
					for k,v in pairs(CC.AddDoc) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
									DrawString(x,y, "¡ü "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				if str == "ÓÃ¶¾ÄÜÁ¦" then
					for k,v in pairs(CC.AddPoi) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
									DrawString(x,y, "¡ü "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				
			i = i + 1
		end
	end

	-- if case == nil then
		-- if JY.Status ~= GAME_WMAP then
			-- DrawString(x1-size*5, y1 + h * (i)+2, "ÉÏÏÂ¼ü»»ÈË ¡ú¼üÏÔÊ¾ÈËÎïÌì¸³ ESCÍË³ö", M_PaleTurquoise, size*0.7)
		-- else
			-- DrawString(x1-size*5, y1 + h * (i)+2, "ÉÏÏÂ¼ü»»ÈË ¡ú¼üÏÔÊ¾ÈËÎïÌì¸³ ESCÍË³ö", Snow3, size*0.7)
		-- end
	-- else
		-- DrawString(x1-size*5, y1 + h * (i)+2, "ÉÏÏÂ¼üÑ¡ÔñÊôĞÔ ×óÓÒ¼ü¼õÉÙ/Ôö¼Ó »Ø³µ¼üÈ·ÈÏ¼Óµã", Snow3, size*0.7)
	-- end


  --[[ if psx(id,'Ìì¸³Íâ¹¦1') > 0 or psx(id,'Ìì¸³Íâ¹¦2') > 0 or psx(id,'Ìì¸³ÄÚ¹¦') > 0 or psx(id,'Ìì¸³Çá¹¦') > 0  then 
      lb1[#lb1+1] = 1
	  lb2[1] = #lb1
	  lb2[2] = lb2[1]
   end]]
   local i = 0
   --±³¾°Í¼
   --lib.PicLoadCache(99,121*2,CC.ScreenW/2,CC.ScreenH/2,2,256,nil,bx*1360)
   lib.LoadPNG(91, 149 * 2 ,0 , 0, 1)
   --ÈËÎï°ëÉíÏñ
   pngxy(90,psx(id,'°ëÉíÏñ')*2,bx*200,CC.ScreenH-by*300,2)
   --ÃÅÅÉ
   -- if MPPD(id) ~= nil and MPPD(id) > 0 then 
	  -- DrawString(bx*30,by*70,CC.MP[MPPD(id)][1]..CC.MPDJ[MPPD(id)][MPDJ(id)],C_ORANGE,size)
   -- else 
	  -- DrawString(bx*30,by*70,'½­ºşÈËÊ¿',C_WHITE,size)
   -- end
	if MPPD(id) ~= 0 then
		local mptype, mpdj = MPDISPLAY(id)
		local str = ""
		local str1 = ""
		local color = ""
		if mptype ~= nil then
			if MPPD(id) == 13 and match_ID(id,66) then
				str = "¡¾".."²¨Ë¹Ã÷½Ì".."¡¿"
				str1 = "¡¾".."Ê¥Å®".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, , M_Red, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 4 then
				str = "¡¾".."Ã÷½Ì".."¡¿"
				str1 = "¡¾".."´úĞĞÊ¹Õß".."¡¿"
				color = C_GOLD
				--DrawString(bx*30,by*70, "¡¾".."Ã÷½Ì´úĞĞÊ¹Õß".."¡¿", C_GOLD, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["Æ·µÂ"] == 1 then
				str = "¡¾".."Ã÷½Ì".."¡¿"
				str1 = "¡¾".."ĞşĞÄÀÇÍõ".."¡¿"
				color = C_GOLD
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["Æ·µÂ"] == 100 then
				str = "¡¾".."Ã÷½Ì".."¡¿"
				str1 = "¡¾".."³àÑª÷ëÍõ".."¡¿"
				color = C_GOLD
			elseif MPPD(id) == 12 and match_ID(id,73) then
				str = "¡¾".."ÈÕÔÂÉñ½Ì".."¡¿"
				str1 = "¡¾".."Ê¥¹Ã".."¡¿"
				color = M_Red
			elseif MPPD(id) == 12 and match_ID(id,26) then	
				str = "¡¾".."ÈÕÔÂÉñ½Ì".."¡¿"
				str1 = "¡¾".."Ç°½ÌÖ÷".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÈÕÔÂÉñ½ÌÇ°½ÌÖ÷".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 14 and match_ID(id,140) then	
				str = "¡¾".."ÎåÔÀ½£ÅÉ".."¡¿"
				str1 = "¡¾".."Ì«ÉÏ³¤ÀÏ".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÎåÔÀ½£ÅÉÌ«ÉÏ³¤ÀÏ".."¡¿", M_Red, size*0.8)		
			elseif MPPD(id) == 10 and match_ID(id,588) then	
				str = "¡¾".."ÌÒ»¨µº".."¡¿"
				str1 = "¡¾".."µºÖ÷·òÈË".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÌÒ»¨µºÖ÷·òÈË".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,577) then	
				str = "¡¾".."ÉÙÁÖÅÉ".."¡¿"
				str1 = "¡¾".."é_ÅÉ×æÊ¦".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÉÙÁÖ×æÊ¦".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,114) then	
				str = "¡¾".."ÉÙÁÖÅÉ".."¡¿"
				str1 = "¡¾".."ÒşÊÀ¸ßÉ®".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÒşÊÀ¸ßÉ®".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,38) then	
				str = "¡¾".."·ğµÀ".."¡¿"
				str1 = "¡¾".."ĞÜ¶ú×ªÉú".."¡¿"
				color = M_Red
			elseif MPTX(id,5,4) and id == 0 and CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ'] > 0 then	
				str = "¡¾".."ÉÙÁÖÅÉ".."¡¿"
				local str = {'½ğ¸ÕµîÖ÷','ÂŞººÌÃÖ÷','´ïÄ¦ÔºÖ÷'}
				str1 = "¡¾"..str[CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ']].."¡¿"
				color = M_DeepSkyBlue	
				--DrawString(bx*30,by*70, "¡¾".."ÒşÊÀ¸ßÉ®".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 2 and match_ID(id,50) then	
				str = "¡¾".."Ø¤°ï".."¡¿"
				str1 = "¡¾".."Ç°°ïÖ÷".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."Ø¤°ïÇ°°ïÖ÷".."¡¿", M_Red, size*0.8)
			elseif MPPD(id) == 15 and match_ID(id,499) then	
				str = "¡¾".."´óÀí".."¡¿"
				str1 = "¡¾".."×Ú×åÏÈ×æ".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."´óÀíÏÈ×æ".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 11 and match_ID(id,596) then	
				str = "¡¾".."Ò»µ¶Á÷".."¡¿"
				str1 = "¡¾".."ÉÙÖ÷".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."Ò»µ¶Á÷ÉÙÖ÷".."¡¿", M_Red, size*0.8)			
			elseif MPPD(id) == 20 and match_ID(id,523) then	
				str = "¡¾".."Ñ©Óğ×Ú".."¡¿"
				str1 = "¡¾".."×ÚÖ÷·òÈË".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."×ÚÖ÷·òÈË".."¡¿", M_Red, size*0.8)										
			elseif MPPD(id) == 24 and match_ID(id,525) then	
				str = "¡¾".."Ò¹ÓêÂ¥".."¡¿"
				str1 = "¡¾".."É±ÊÖ½ÌÍ·".."¡¿"
				color = M_Red
			elseif MPPD(id) == 23 and match_ID(id,637) then	
				str = "¡¾".."±³áÍ¾ü".."¡¿"
				str1 = "¡¾".."¾üÊ¦".."¡¿"
				color = M_Red	
			elseif MPPD(id) == 20 and match_ID(id,745) then	
				str = "¡¾".."Ñ©Óğ×Ú".."¡¿"
				str1 = "¡¾".."Ì«ÉÏÊ¦×ğ".."¡¿"
				color = M_Red		
			elseif MPPD(id) == 26 and match_ID(id,754) then	
				str = "¡¾".."ÔÆÃÎ½§".."¡¿"
				str1 = "¡¾".."Íò»¨Ö®Ö÷".."¡¿"
				color = M_Red			
			else
				str = "¡¾"..mptype.."¡¿"
				str1 = "¡¾"..mpdj.."¡¿"
				color =  M_DeepSkyBlue
				--DrawString(bx*30,by*70, "¡¾"..mptype..mpdj.."¡¿", M_DeepSkyBlue, size*0.8)
			end
		else
			str = "¡¾½­ºşÈËÊ¿¡¿"
			str1 = "¡¾ÎŞ¡¿"
			color = C_ORANGE
		end
		DrawString(bx*55,by*70, "ËùÊôÃÅÅÉ£º"..str, color, size)
		DrawString(bx*55,by*70+size+5, "ÃÅÅÉÎ»½×£º"..str1, color, size)
	else
		local str = "¡¾½­ºşÈËÊ¿¡¿"
		local str1 = "¡¾ÎŞ¡¿"
		local color = C_ORANGE
		DrawString(bx*55,by*70, "ËùÊôÃÅÅÉ£º"..str, color, size)
		DrawString(bx*55,by*70+size+5, "ÃÅÅÉÎ»½×£º"..str1, color, size)
	end
		local ch = nil
		local chcl = C_CYGOLD
		--local fj = {[0] = {"´«Ëµ",C_ORANGE},{"×ÚÊ¦",M_DarkRed},{"ºÀÏÀ",C_RED},{"Ò»Á÷",M_Pink},{"¶şÁ÷",M_Pink},{"ÈıÁ÷",M_Blue},{"µÜ×Ó",M_LightBlue},{"²ËÄñ",C_CYGOLD}}

        --local fjstr = "¡¾"..fj[p["³©Ïë·Ö½×"]][1].."¡¿"
        local nametre = p["ĞÕÃû"]
        local djstr = p["µÈ¼¶"].."¼¶"
        if id == 0 and (JY.Base['±ê×¼'] == nil or JY.Base['±ê×¼'] < 1 ) and JXPD(id,JY.Base['³©Ïë'],1) then
        	djstr = p["µÈ¼¶"].."¼¶"..'¡¾¾õĞÑ¡¿'
        elseif id ~= 0 and JXPD(id,id,1) then
        	djstr = p["µÈ¼¶"].."¼¶"..'¡¾¾õĞÑ¡¿'	
        end	
        --local namex = CC.ScreenW/2-string.len(fjstr..nametre..djstr)/4*size
        --local fjx = namex + string.len(nametre)/2*size
       -- local djx = fjx + string.len(fjstr)/2*size
		-- DrawString(fjx, dx*24, fjstr, fj[JY.Person[id]["³©Ïë·Ö½×"]][2], size*0.8)
		-- DrawString(namex, dx*20, nametre, C_CYGOLD, size)		
		-- DrawString(djx, dx*24, djstr, C_CYGOLD, size*0.8)
   --ÈËÎïĞÕÃû
   --DrawString(bx*280,by*70,name(id),C_WHITE,size)
	   DrawString(bx*150,by*10,name(id)..""..djstr,M_Yellow,size*1.3)--..fjstr
	   local tfx1 = bx*55
	   local fty1 = by*79+50
	   local fty2 = 0
	   local fty3 = 0
	   --Ö÷½Ç
	   if id == 0 then
			local main_tf;
			--±êÖ÷
			if JY.Base["±ê×¼"] > 0 then
				main_tf = ZJTF[JY.Base["±ê×¼"]]
			--ÌØÊâ
			elseif JY.Base["ÌØÊâ"] > 0 then
				main_tf = " "
			--³©Ïë
			elseif JY.Base["³©Ïë"] > 0 then
				if RWTFLB[p["´úºÅ"]] ~= nil then
					main_tf = RWTFLB[p["´úºÅ"]]
				end
			end
			if main_tf ~= nil then
				DrawString(tfx1, fty1,"Ò»°ã³ÆºÅ£º".."¡¾"..main_tf.."¡¿", C_ORANGE, size)
			--else
				--main_tf = "ÎÔÁú·ü·ï"
				--DrawString(tfx1 -string.len(main_tf)/4*size*0.8, fty1,"Ò»°ã³ÆºÅ£º"..main_tf , C_ORANGE, size)
			fty2 = size + 5
			end
			
		end

		--ÆÕÍ¨½ÇÉ«Ìì¸³
		if id ~= 0 and RWTFLB[id] ~= nil then
			--DrawString(x1-7, y1 + h * (i)-142,RWTFLB[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"Ò»°ã³ÆºÅ£º".."¡¾".. RWTFLB[id].."¡¿", C_ORANGE, size)
			fty2 = size	+5	
		end
	  
		fty1 = fty1+fty2
		--Ö÷½Ç³ÆºÅ
		if id == 0 then
			local main_ch;
			--±êÖ÷
			if JY.Base["±ê×¼"] > 0 then
				if p["ÁùÈç¾õĞÑ"] == 0 then
					main_ch = "½­ºşĞ¡ÏºÃ×"
				else
					main_ch = "¾õĞÑÖ®²ÔÁú"
				end
			--ÌØÊâ
			elseif JY.Base["ÌØÊâ"] > 0 then
				main_ch = ''--TSTF[JY.Base["ÌØÊâ"]]
			--³©Ïë
			elseif JY.Base["³©Ïë"] > 0 then
				if RWWH[JY.Base["³©Ïë"]] ~= nil and JY.Base["³©Ïë"] ~= 35 and JY.Base["³©Ïë"] ~= 38 and JY.Base["³©Ïë"] ~= 49 
				and JY.Base["³©Ïë"] ~= 626 then
					main_ch = RWWH[JY.Base["³©Ïë"]]
				elseif JY.Base["³©Ïë"] == 35 then
					if JXPD(id,35,2) then
						main_ch = RWWH["35"]
						--DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)	
					elseif JXPD(id,35,1) then
						main_ch = RWWH[35]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
						 --DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)		
					end
				elseif JY.Base["³©Ïë"] == 38 then
					if JXPD(id,38,1) then
						main_ch =  RWWH["38"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
					    --DrawString(tfx1 -string.len(RWWH["38"])/4*size*0.8, by*122,  RWWH["38"], C_ORANGE, size)		
					end
				elseif JY.Base["³©Ïë"] == 49 then
					if JXPD(id,49,1) then
						main_ch = RWWH["49"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH["49"])/4*size*0.8, by*122,  RWWH["49"], C_ORANGE, size)	
					else
						main_ch = RWWH[49]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH[49])/4*size*0.8, by*122,  RWWH[49], C_ORANGE, size)	
					end
				elseif JY.Base["³©Ïë"] == 626 then
					if JXPD(id,626,1) then
						main_ch = RWWH["626"]
						--DrawString(tfx1 -string.len(RWWH["626"])/4*size*0.8, by*122,  RWWH["626"], C_ORANGE, size)
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
					else
					main_ch = RWWH[626]
					--	DrawString(x1-7, y1 + h * (i)-100, RWWH[626], C_CYGOLD, size*0.8)
					 --DrawString(tfx1 -string.len(RWWH[626])/4*size*0.8, by*122,  RWWH[626], C_ORANGE, size)		
					end
			
				end
			end
			if main_ch ~= nil then
				--DrawString(x1-7, y1 + h * (i)-100, main_ch, C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..main_ch.."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--ÆäËûÈË³ÆºÅ
		if RWWH[id] ~= nil and id ~= 35 and id ~= 38 and id ~= 49 then
			--DrawString(x1-7, y1 + h * (i)-100, RWWH[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[id].."¡¿", C_ORANGE, size)	
			fty3 = size+5
		end

		--Áîºü³å
		if id == 35 then
			if JXPD(id,35,2) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["35"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["35"].."¡¿", C_ORANGE, size)
				fty3 = size
			elseif JXPD(id,35,1) then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[35].."¡¿", C_ORANGE, size)
				fty3 = size+5
			end
		end

		--ĞéÖñ
		if id == 49 then
			if JXPD(id,49,1) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["49"].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			else
				--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[49].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	  
		--Ê¯ÆÆÌì
		if id == 38 then
			if JXPD(id,38,1) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["38"].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--¹ùÏå
		if id == 626 then
			if JXPD(id,626,1) then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["626"].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		--Ïô°ëºÍ
		if id == 189 then
			if JXPD(id,189,1) then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["189"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[189].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end	 
		--ÃçÈË·ï
		if id == 633 then
			if JXPD(id,633,1) then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["633"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[633].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	fty1 = fty1 + fty3
	local fj = {[0] = {"´«Ëµ",C_ORANGE},{"×ÚÊ¦",M_DarkRed},{"ºÀÏÀ",C_RED},{"Ò»Á÷",M_Pink},{"¶şÁ÷",M_Pink},{"ÈıÁ÷",M_Blue},{"µÜ×Ó",M_LightBlue},{"²ËÄñ",C_CYGOLD}}
    local fjstr = "¡¾"..fj[p["³©Ïë·Ö½×"]][1].."¡¿"
	DrawString(tfx1, fty1,"ĞŞÎª³ÆºÅ£º"..fjstr, fj[p["³©Ïë·Ö½×"]][2], size)
   --ÈËÎïËµÃ÷
    -- --ÈËÎïÌì¸³2
   if psx(id,'Ìì¸³Íâ¹¦1') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then 
         DrawString(bx*420,by*50+0*h,"Ìì¸³Íâ¹¦£º"..JY.Wugong[psx(id,'Ìì¸³Íâ¹¦1')]['Ãû³Æ'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+0*h,"Ìì¸³Íâ¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   
   if psx(id,'Ìì¸³Íâ¹¦2') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then JY.Wugong[psx(id,'Ìì¸³Íâ¹¦2')]['Ãû³Æ']
         DrawString(bx*420,by*50+1*h,"Ìì¸³Íâ¹¦£º"..JY.Wugong[psx(id,'Ìì¸³Íâ¹¦2')]['Ãû³Æ'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+1*h,"Ìì¸³Íâ¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'Ìì¸³ÄÚ¹¦') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then 
         DrawString(bx*420,by*50+2*h,"Ìì¸³ÄÚ¹¦£º"..JY.Wugong[psx(id,'Ìì¸³ÄÚ¹¦')]['Ãû³Æ'],M_Red,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+2*h,"Ìì¸³ÄÚ¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'Ìì¸³Çá¹¦') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then 
         DrawString(bx*420,by*50+3*h,"Ìì¸³Çá¹¦£º"..JY.Wugong[psx(id,'Ìì¸³Çá¹¦')]['Ãû³Æ'],M_Yellow,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*50+3*h,"Ìì¸³Çá¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   
   local tfid;
		--Ö÷½Ç
	if id == 0 then
		--±êÖ÷
		if JY.Base["±ê×¼"] > 0 then
			tfid = 0--546 + JY.Base["±ê×¼"]
		--ÌØÊâ
		elseif JY.Base["ÌØÊâ"] > 0 then
			tfid = ''
		--³©Ïë
		else
			tfid = JY.Base["³©Ïë"]
			--³©ÏëÔ¬³ĞÖ¾
			--[[if tfid == 54 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "54-1"
			--³©ÏëÊ¯ÆÆÌì
			elseif tfid == 38 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "38-1"
			--³©Ïë¹ùÏå
			elseif tfid == 626 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "626-1"				
			end]]
		end
	--¶ÓÓÑ
	else
		tfid = id
		--³©ÏëÔ¬³ĞÖ¾
		--[[if tfid == 54 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
			tfid = "54-1"
		--³©ÏëÊ¯ÆÆÌì
		elseif tfid == 38 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
			tfid = "38-1"
		--³©Ïë¹ùÏå
		elseif tfid == 626 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
			tfid = "626-1"				
		end]]
	end
	if psx(id,'Ìì¸³Íâ¹¦1') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³Íâ¹¦1'
	end	 
	if psx(id,'Ìì¸³Íâ¹¦2') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³Íâ¹¦2'
	end
	if psx(id,'Ìì¸³ÄÚ¹¦') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³ÄÚ¹¦'
	end	 
	if psx(id,'Ìì¸³Çá¹¦') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³Çá¹¦'
	end
	local me = {}
	local me1 = {}
	local me2 = {}
	local me3 = {}
	local me4 = {}
	local mid = tfid 
	local bz = {'È­','Ö¸','½£','µ¶','Ææ','î¸','ÈÊ','Ò½','¶¾','æÎ','Ä§','ÎŞ'}
	if JY.Base["±ê×¼"] > 0 and id == 0 then 
		mid = bz[JY.Base["±ê×¼"]]
	end
	
	local row = 0
	if TFJS[mid] ~= nil then
		for i = 1, #TFJS[mid] do
			me1[#me1+1] = TFJS[mid][i]
			if i == #TFJS[mid] then 
				me1[#me1+1] = "£Î"
				
			end
		end
	else
		me1[#me1+1] = '£ÄÎŞ¸öÈËÌì¸³'
	end

	if CC.PTF[tfid] ~= nil and id ~= 0 then -- 
		for i,v in pairs(CC.PTF[tfid]) do 
			if v == 1 then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
			elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
			end
		end
	end
	
	if id == 0  then 
		if actor(id,10) then 
			for i,v in pairs(CC.PTF[id]) do
				if TFJS[i] ~= nil then 
					me[#me+1] = '£Ì'..string.sub(TFJS[i][1],3)
					local str = ''
					for k = 2, #TFJS[i]-1 do
						str = str..'*'..string.sub(TFJS[i][k],3)
					end
					me[#me+1] = '£×'..str
					me[#me+1] = "£Î"
				end
			end
			if JY.Status == GAME_WMAP then
				if WAR.LSTF[id] ~= nil then
					for i,v in pairs(WAR.LSTF[id]) do
						if TFJS[i] ~= nil then 
							me[#me+1] = '£Ì'..string.sub(TFJS[i][1],3)
							local str = ''
							for k = 2, #TFJS[i]-1 do
								str = str..'*'..string.sub(TFJS[i][k],3)
							end
							me[#me+1] = '£×'..str
							me[#me+1] = "£Î"
						end
					end
				end
			end
		end
		for i,v in pairs(CC.PTF[id]) do
			if v == 1 then
				if CC.PTFSM[i] ~= nil then 
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
		   elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end	
			end
		end

		if JY.Status == GAME_WMAP then
			--æÎÖ÷ÁÙÊ±Ìì¸³
			if actor(id,10) then 
				if WAR.LSTF[id] == nil then 
					WAR.LSTF[id] = {}
				else
					for i,v in pairs(WAR.LSTF[id]) do
						if CC.PTFSM[i] ~= nil then
							me[#me+1] = '£Ì'..CC.PTFSM[i][1]
							me[#me+1] = '£×'..CC.PTFSM[i][2]
							me[#me+1] = "£Î"
						end
					end
				end
			end
		end	

	end
	
	if id == 0 and JY.Base["³©Ïë"] ==52 then
		me1[#me1+1] = "£Ò".."ÆßÊ®¶ş±ä£º"
		if TFJS[JY.Person[0]["´úºÅ"]] ~= nil then
			for i = 1, #TFJS[JY.Person[0]["´úºÅ"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["´úºÅ"]][i]
				if i == #TFJS[JY.Person[0]["´úºÅ"]] then 
				me1[#me1+1] = "£Î"
				
				end
			end
		end
		if CC.PTF[JY.Person[0]["´úºÅ"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[0]["´úºÅ"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
						end
				end
			end
		end
	end
	
	if id == 512 then
		me1[#me1+1] = "£Ò".."ĞÄÄ§£º"
		if TFJS[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] ~= nil then
			for i = 1, #TFJS[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["´úºÅ"]][i]
				if i == #TFJS[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] then 
				me1[#me1+1] = "£Î"
				
				end
			end
		end
		if CC.PTF[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
						end
				end
			end
		end
	end
	if BOSSZT[mid] ~= nil then
		for i = 1, #BOSSZT[mid] do 
			me2[#me2+1] = BOSSZT[mid][i]
			--if i == #BOSSZT[mid] then
			--me2[#me2+1] = "£Î"
			--end
		end
	end
	if ZL[mid] ~= nil then
		for i = 1, #ZL[mid] do 
			me3[#me3+1] = ZL[mid][i]
			--if i == #ZL[mid] then
			--me3[#me3+1] = "£Î"
			--end
		end
	end
	if FY[mid] ~= nil then
		for i = 1, #FY[mid] do 
			me4[#me4+1] = FY[mid][i]
			--if i == #FY[mid] then
			--me4[#me4+1] = "£Î"
			--end
		end
	end
	local size = CC.DefaultFont
	local tfjsbh = 0
	local tfjswz = {}
	local tfjsbh1 = 0
	local tfjswz1 = {}
	local bossztwz = {}
	local rwzlwz = {}
	local fyjywz = {}
	local pdl = true
	i = 4 - cot[1]
	for k = 1, #me1 do
		--local tfstr = me[k]
		local tfstr1 = me1[k]
		local h1 = 0
		-- if #tfstr > math.floor(bx*345/size2)+5 then
			-- --	i = i + 1
				-- row = row + 1
		-- end		
		--if string.sub(tfstr,1,2) == "£Î" then
			--row = row + 1
		--else
		if string.sub(tfstr1,1,2) == '£Ä' and pdl then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr1,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr1
			
			pdl = false
			i = i + 1
		end
		if string.sub(tfstr1,1,2) == '£×' or string.sub(tfstr1,1,2) == '£Ú' then

			if string.sub(tfstr1,1,2) == '£Ú' then
				--string.sub(tfstr1,1,2) = '£Ò'
			end	
			if tfjswz1[mid] == nil then
				tfjswz1[mid] = tfstr1
			else
				tfjswz1[mid] = tfjswz1[mid] .."*".. tfstr1
			end	
			--h1=--tfstr = tfstr .. "£Î"
		--	i = i + 1
			--lb[1][#lb[1]+1] = tfstr
		end

	end
	for k = 1, #me2 do
		local tfstr = me2[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '£Ç' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr
			i = i + 1
		end
		if string.sub(tfstr,1,2) == '£×' then

			tfjswz[#tfjswz+1] = tfstr

		end

	end
	for k = 1, #me3 do
		local tfstr = me3[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '£Ò' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr
			i = i + 1
		end
		if string.sub(tfstr,1,2) == '£×' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--rwzlwz[#rwzlwz+1] = tfstr
		end

	end
	for k = 1, #me4 do
		local tfstr = me4[k]
		local h1 = 0

		if string.sub(tfstr,1,2) == '£Ç' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			lb[1][#lb[1]+1] = tfstr
			i = i + 1
		end
		if string.sub(tfstr,1,2) == '£×' then

			tfjswz[#tfjswz+1] = tfstr

		end

	end
	for k = 1, #me do
		local tfstr = me[k]
		--local tfstr1 = me1[k]
		local h1 = 0

		
		if string.sub(tfstr,1,2) == '£Ì' then
			if #lb[1]+1 > cot[1]+4 and #lb[1]+1 - cot[1] <= 14 then
				tjm(bx*420,by*50+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			end
			i = i + 1
			lb[1][#lb[1]+1] = tfstr
		end
		if string.sub(tfstr,1,2) == '£×' then

			tfjswz[#tfjswz+1] = tfstr

		end
		row = row + 1

	end
   --if psx(id,'Ìì¸³Íâ¹¦1') > 0 or psx(id,'Ìì¸³Íâ¹¦2') > 0 or psx(id,'Ìì¸³ÄÚ¹¦') > 0 or psx(id,'Ìì¸³Çá¹¦') > 0  then 
	lb1[#lb1+1] = 1
	lb2[1] = #lb1
	--lb2[2] = lb2[1]
   --end
   -- if TFJS[id] ~= nil then 
	  -- for i = 1,#TFJS[id]  do
		-- tjm9(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
	-- --	DrawString(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size)
	  -- end
   
      
   -- end
   
   --tjm9(bx*30,by*80+h,'¡¡¡¡ÆÆÏşËÄ´ó»¤·¨Ö®Ò»£¬ÉÃ³¤Ê¹ÓÃ½£·¨£¬³£ÄêÓÎµ´ÔÚ½­ºş£¬ÉÙÓĞÈËÖªÏşÆäÕæÃæÄ¿',C_WHITE,size2,math.floor(bx*345/size2)-1,h)
   
   -- --ÈËÎïÌì¸³1
   -- if CC.TG[id] ~= nil then 
    -- --  if CC.TF[psx(id,'Ìì¸³')] ~= nil then 
         
	-- --  end
	-- --	say("ÈËÎïÌì¸³1",0,1)
		-- for k,v in pairs(CC.TG[id]) do 
			-- if v == 1 then 
			-- --	say("ÈËÎïÌì¸³"..k,0,1)
				-- if CC.PTFSM[k] ~= nil then
					-- -- me[#me+1] = '£Ì'..CC.PTFSM[k][1]
					-- -- me[#me+1] = '£×'..CC.PTFSM[k][2]
					-- -- me[#me+1] = "£Î"
					
					-- DrawString(bx*420,by*60+i*h,CC.PTFSM[k][1],C_WHITE,size1)
					-- i = i + 1
					
				-- end
			-- end
		-- end
		
   -- end
	
   
   --×°±¸Ôö¼ÓµÄÊôĞÔ
		local str_gain, def_gain, agi_gain = 0, 0, 0
		local fb = 1
		if match_ID(id,546) or match_ID(id, 9911) then
			fb = 2
		end
		if p["ÎäÆ÷"] > -1 then
			if JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"] > 0 then
				str_gain = str_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*10 + JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"] < 0 then
				str_gain = str_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*10 - JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"] > 0 then
				def_gain = def_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*10 + JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"] < 0 then
				def_gain = def_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*10 - JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*10*fb + JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2*fb
			elseif JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*10*fb - JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2*fb
			end
		end
		if p["×øÆï"] > -1 then
			if JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"] > 0 then
				str_gain = str_gain + JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*10 + JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"] < 0 then
				str_gain = str_gain + JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*10 - JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"] > 0 then
				def_gain = def_gain + JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*10 + JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"] < 0 then
				def_gain = def_gain + JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*10 - JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*10*fb + JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2*fb
			elseif JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*10*fb - JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2*fb
			end
		end
		if p["·À¾ß"] > -1 then
			local n = 2
			if MPPD(id) == 2 then
				n=4
			end	
			if JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"] > 0 then
				str_gain = str_gain + JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*10 + JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"] < 0 then
				str_gain = str_gain + JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*10 - JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"] > 0 then
				def_gain = def_gain + JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*10 + JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*n
			elseif JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"] < 0 then
				def_gain = def_gain + JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*10 - JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*10*fb + JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2*fb
			elseif JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*10*fb - JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2*fb
			end
		end
		--Ò×½î¾­¼Ó³É
		local level = 0
		local gj = 0
		local qg = 0
		local fy = 0
		local str1_gain, def1_gain, agi1_gain = psx(id,"¹¥»÷Á¦"), psx(id,"·ÀÓùÁ¦"), psx(id,"Çá¹¦")
		local str2_gain, def2_gain, agi2_gain = psx(id,"¹¥»÷Á¦"), psx(id,"·ÀÓùÁ¦"), psx(id,"Çá¹¦")
        --Õ½³¡¸÷ÖÖ¼Ó³É 
        if JY.Status == GAME_WMAP then
			--for i = 0, WAR.PersonNum-1 do
				--if WAR.Person[i]["ÈËÎï±àºÅ"] == id then
					str2_gain, def2_gain, agi2_gain = Atk(t)-str_gain,Def(t)-def_gain,Qg(t)-agi_gain
				--end
			--end
			------------×ÊÖÊ¼Ó³É---------------
			gj = limitX((JY.Person[id]['ÄÚÁ¦'] - JY.Person[id]['×ÊÖÊ']*10)/60,0)
			str1_gain = str1_gain + gj
			fy = limitX((JY.Person[id]['ÄÚÁ¦'] - JY.Person[id]['×ÊÖÊ']*10)/60,0)
			def1_gain = def1_gain + fy
			qg = limitX((JY.Person[id]['ÄÚÁ¦'] - JY.Person[id]['×ÊÖÊ']*10)/60,0)
			agi1_gain = agi1_gain + qg
			------------×ÛºÏ¼Ó³É---------------
			for i =1,JY.Base["Îä¹¦ÊıÁ¿"] do               -- ²éÕÒµ±Ç°ÒÑ¾­Á¶³ÉÎä¹¦µÈ¼¶
				 if JY.Person[id]["Îä¹¦" .. i]==108 then
					if JY.Person[id]["Îä¹¦µÈ¼¶" .. i] > 900 then
						level = 10
					else	
						level=math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. i] /100)+1;	
					end	
					if level >= 1 then
						gj = math.modf (JY.Person[id]["¹¥»÷Á¦"]*0.03*(level))
						str1_gain = str1_gain +gj
						fy = math.modf(JY.Person[id]["·ÀÓùÁ¦"]*0.03*(level))
						def1_gain = def1_gain +fy
						qg = math.modf(JY.Person[id]["Çá¹¦"]*0.03*(level))
						agi1_gain = agi1_gain +qg
						break
					end	
				end		
			end
			if match_ID(id, 9930) or match_ID(id,9738) then				--ºÚ¼¶¸¡ÍÀ
				gj = math.modf (JY.Person[id]["¹¥»÷Á¦"]*0.6)
				str1_gain = str1_gain +gj
				fy = math.modf(JY.Person[id]["·ÀÓùÁ¦"]*0.6)
				def1_gain = def1_gain +fy
				qg = math.modf(JY.Person[id]["Çá¹¦"]*0.6)
				agi1_gain = agi1_gain +qg	
			end
			if match_ID(id, 604) or match_ID(id, 9805) then
				str1_gain = str1_gain + TrueYJ(id)
				def1_gain = def1_gain +TrueYJ(id)
			end
			--ÎäÄÂÒÅÊé ±ê¼ÇĞŞ¸Ä
			if Curr_NG(id,199) then
				local sz = math.modf(JY.Person[id]["ÊµÕ½"]/2)
				if not inteam(id) then
					sz = 1000
				end
				str1_gain = str1_gain +sz
				def1_gain = def1_gain +sz
			end
			--»ôÇàÍ©£¬ÎÒ·½ÈËÊıÈËÔ½¶à£¬·ÀÓùÔ½¸ß    
            if match_ID(id, 74) then
				local hqtgj= 0
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == WAR.Person[i]["ÎÒ·½"] then
                     str1_gain =  str1_gain +10
					 def1_gain =  def1_gain+10
                    end		
                end	
            end		 
            --ÁÖÊâµĞ·½ÈËÊıÈËÔ½¶à£¬·ÀÓùÔ½¸ß    
            if match_ID(id, 508) then
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == false  then
                    def1_gain =  def1_gain+10
                    str1_gain =  str1_gain +10
                    end		
                end	
            end
			-----------¹¥»÷¼Ó³É-----------
			--¶ÓÓÑ¹¥»÷Á¦¼Ó³É
			for i,v in pairs(CC.AddAtk) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
							str1_gain = str1_gain + v[3]
						end
					end
				end
			end
			if WAR.PD['Ñª´ã'][id] ~= nil then
				str1_gain = str1_gain + WAR.PD['Ñª´ã'][id]
			end
			if PersonKF(id,263) then
				if Curr_NG(id,263) then
					str1_gain = math.modf(str1_gain*1.1)
				else
					str1_gain = math.modf(str1_gain*1.05)
				end
			end	
			if match_ID(id, 112) and WAR.XYS > 0 then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡¹¥»÷*1.5
				str1_gain = math.modf(str1_gain*1.5)
			end
			if WAR.PD['Î÷¹Ïµ¶¡¤ÌìÈË'][id] ~= nil then 
				str1_gain = str1_gain*1.5
			end
			---------------·ÀÓù¼Ó³É--------------
			--¶ÓÓÑ·ÀÓùÁ¦¼Ó³É
			for i,v in pairs(CC.AddDef) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
							def1_gain = def1_gain + v[3]
						end
					end
				end
			end
			if PersonKF(id,264) then
				if Curr_NG(id,264) then
					def1_gain = math.modf(def1_gain*1.1)
				else
					def1_gain = math.modf(def1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡·ÀÓù*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end	
			if  WAR.PD['Î÷¹Ïµ¶¡¤ÌìÈË'][id] ~= nil then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡·ÀÓù*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end
			-------------Çá¹¦¼Ó³É--------------
			--¶ÓÓÑÇá¹¦¼Ó³É
			for i,v in pairs(CC.AddSpd) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
							agi1_gain = agi1_gain + v[3] 
						end
					end
				end
			end	
			if WAR.YWDJ[id]~=nil and Curr_QG(id, 186) then    --Ò»Î­¶É½­Ôö¼ÓÇá¹¦
			   agi1_gain = agi1_gain + WAR.YWDJ[id]	
			end
			--Çá¹¦Ç¿»¯¼Ó³É
			if JY.Person[id]["Ö÷ÔËÇá¹¦"] > 0 and JY.Person[id]["³©Ïë·Ö½×"] < 2 then
				qg = math.modf(JY.Person[id]["Çá¹¦"]*0.3)
				agi1_gain = agi1_gain +qg
			elseif JY.Person[id]["Ö÷ÔËÇá¹¦"] > 0 and JY.Person[id]["³©Ïë·Ö½×"] < 4 then
				qg = math.modf(JY.Person[id]["Çá¹¦"]*0.15)
				agi1_gain = agi1_gain +qg
			end
			if PersonKF(id,259) or NGQH(id,175) then
				if Curr_NG(id,259) then
					agi1_gain = math.modf(agi1_gain*1.1)
				else
					agi1_gain = math.modf(agi1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡Çá¹¦*1.5
				agi1_gain = math.modf(agi1_gain*1.5)
			end
			if WAR.PD['Î÷¹Ïµ¶¡¤ÌìÈË'][id] ~= nil then 
				agi1_gain = agi1_gain * 1.5
			end
			if MPPD(id) == 20 or match_ID(id,514) then
				agi1_gain = math.modf(agi1_gain*2)
			end
		end
	if str1_gain ~= nil and str1_gain > 0 then
		str1_gain = limitX(str1_gain,0,999+JY.Base["ÖÜÄ¿"])
	end	
    if def1_gain ~= nil and def1_gain > 0 then
		def1_gain = limitX(def1_gain,0,999+JY.Base["ÖÜÄ¿"])
	end	
    if agi1_gain ~= nil and agi1_gain > 0 then
		agi1_gain = limitX(agi1_gain,0,999+JY.Base["ÖÜÄ¿"])
	end
   --×°±¸ÏÔÊ¾
	local pyl = -40
	lib.LoadPNG(91,166*2,bx*450+pyl,by*470,1)
   
	if p["ÎäÆ÷"] > -1 then
		lib.PicLoadCache(2,p["ÎäÆ÷"] * 2,bx*450+pyl,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl,by*470,1)
		DrawString(bx*450+pyl,by*470, "LV"..JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl,by*470+75, JY.Thing[p["ÎäÆ÷"]]["Ãû³Æ"],C_RED , size*0.5)

	end
	if p["·À¾ß"] > -1 then
		lib.PicLoadCache(2,p["·À¾ß"] * 2,bx*450+pyl+75,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+75,by*470,1)
		DrawString( bx*450+pyl+78,by*470, "LV"..JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+78,by*470+75, JY.Thing[p["·À¾ß"]]["Ãû³Æ"], C_ORANGE, size*0.5)
	end		
	if p["×øÆï"] > -1 then
		lib.PicLoadCache(2,p["×øÆï"] * 2,bx*450+pyl+150,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+150,by*470,1)
		DrawString( bx*450+pyl+154,by*470, "LV"..JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+154,by*470+75, JY.Thing[p["×øÆï"]]["Ãû³Æ"], M_Yellow, size*0.5)
	end
	--Ì××°ÏÔÊ¾
	if (p["ÎäÆ÷"] > -1 and p["·À¾ß"] > -1 and p["×øÆï"] > -1) then
		if p["·À¾ß"]==p["ÎäÆ÷"]+1 and p["×øÆï"]==p["ÎäÆ÷"]+2 then
			local color = C_RED
			local n = Setmeal[p["ÎäÆ÷"]][4]
			if  n==4 or n==7 or n==15 or n==16 or n==2 then
				color = C_ORANGE
			elseif n==21 or n==22 or n==24 or n==26 then
				color = M_DeepSkyBlue
			elseif n==1 or n==3 then
				color = M_Green
			end
			--local n= #ItemInfo[p["ÎäÆ÷"]]
			--say("Êı×é³¤¶È"..#ItemInfo[p["ÎäÆ÷"]],0,1)
			DrawString( bx*450+pyl,by*470+90, string.sub(ItemInfo[p["ÎäÆ÷"]][3], 3 , 12), C_GOLD, size*0.7)
			--tjm(bx*450+pyl,by*470+20+100,"¡ôÌØĞ§£º"..Xguo[Setmeal[p["ÎäÆ÷"]][4]]..'*'.."¡ôÌØĞ§£º"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]].."*".."¡ôÌØĞ§£º"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]].."*".."¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_GOLD,size*0.5,14,size*0.5)
			if n < 5 and n ~= 0 then
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n >= 5 then
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 7 then
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 9 then
				--DrawString( diyx/5+ax*8-240, diyy/4+ax*3+200+40-20,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2], C_RED, size*0.5)
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2, string.sub(ItemInfo[p["ÎäÆ÷"]][5], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+20,string.sub(ItemInfo[p["ÎäÆ÷"]][7], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+40, string.sub(ItemInfo[p["ÎäÆ÷"]][9], 5 , -1), M_YellowGreen, size*0.5)
		end
	end
   
   
   
   i = 0 - cot[2]

   --local wgbh = {'¢ñ','¢ò','¢ó','¢ô','¢õ','¢ö','¢÷','¢ø','¢ù','¢ú','¢û','¢ü','¢ú¢ó','¢ú¢ô','¢ú¢õ'}
   --ÈËÎïÎäÑ§
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,2,180,nil,bx*180)
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,1)
   for k = 1,JY.Base["Îä¹¦ÊıÁ¿"] do
       if psx(id,'Îä¹¦'..k) > 0 and JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ'] < 6 then
		----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
			if #lb[2]+1 > cot[2] and #lb[2]+1 - cot[2] <= 14 then
				local lv = limitX(math.modf(psx(id,'Îä¹¦µÈ¼¶'..k)/100),1)
				local lx = JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ']
				local color = C_WHITE
				-- lib.LoadPNG(91,(lv+74)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
				-- lib.LoadPNG(91,(lx+149)*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
				if wgnlxz(psx(id,'Îä¹¦'..k)) == 0 then
					color = LightPurple
				elseif wgnlxz(psx(id,'Îä¹¦'..k)) == 1 then
					color = C_GOLD
				end
				if psx(id,'Îä¹¦µÈ¼¶'..k) > 900 then
					lib.LoadPNG(91,167*2,bx*660+size1*7,by*50+i*h,1)
				else	
					lib.LoadPNG(91,(lv+149)*2,bx*663+size1*7,by*50+i*h,1)
				end 
				lib.LoadPNG(91,(lx+74)*2,bx*660+size1*7+bx*50,by*50+i*h,1)
				DrawString(bx*660,by*50+i*h,k,C_WHITE,size1)
				DrawString(bx*665+size1,by*50+i*h,JY.Wugong[psx(id,'Îä¹¦'..k)]['Ãû³Æ'],color,size1)
			end
			i = i + 1
			lb[2][#lb[2]+1] ={ psx(id,'Îä¹¦'..k),k}
	   end
   end
   -- if psx(id,'×óÓÒ»¥²«') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'×óÓÒµÈ¼¶')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'×óÓÒ»¥²«',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '×óÓÒ»¥²«'
	  
   -- end 
   -- if psx(id,'¶·×ª') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'¶·×ªµÈ¼¶')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'¶·×ªĞÇÒÆ',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '¶·×ª'
   -- end 
   
   if #lb[2] > 0 then 
      lb1[#lb1+1] = 2
	  --lb2[2] = lb2[1] + 1
	  lb2[2] = #lb1
   end
   
   i = 0
   local lscot = cot[2]
   if lb2[2] ~= nil then 
	lscot = cot[3]
   end
   i = 0 - lscot
   --ÈËÎï»ù´¡Îä¹¦
   for k = 1,JY.Base["Îä¹¦ÊıÁ¿"] do 
        if psx(id,'Îä¹¦'..k) > 0 and JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ'] > 5 then 
			if #lb[3]+1 > lscot and #lb[3]+1 - lscot <= 14 then
				local lv = limitX(math.modf(psx(id,'Îä¹¦µÈ¼¶'..k)/100),1)+1
				local lx = JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ']
				local color = C_WHITE

				if psx(id,'Îä¹¦µÈ¼¶'..k) > 900 then
					lib.LoadPNG(91,167*2,bx*900+size1*7,by*50+i*h,1)
				else	
				lib.LoadPNG(91,(lv+149)*2,bx*900+size1*7,by*50+i*h,1)
				end

				lib.LoadPNG(91,(lx+74)*2,bx*900+size1*7+bx*50,by*50+i*h,1)

				if wgnlxz(psx(id,'Îä¹¦'..k)) == 0 then
					color = LightPurple
				elseif wgnlxz(psx(id,'Îä¹¦'..k)) == 1 then
					color = C_GOLD
				end	
				DrawString(bx*900,by*50+i*h,k,C_WHITE,size1)
				DrawString(bx*905+size1,by*50+i*h,JY.Wugong[psx(id,'Îä¹¦'..k)]['Ãû³Æ'],color,size1)
			end
		i = i + 1
		lb[3][#lb[3]+1] ={ psx(id,'Îä¹¦'..k),k}
	  	end
   end

   if lb[3]~=nil and #lb[3] > 0 then
      lb1[#lb1+1] = 3
	  --lb2[3] = lb2[2] + 1
	  lb2[3] = #lb1
   end
   
   lb1[#lb1+1] = 4
   --lb2[4] = lb2[3] + 1
   lb2[4] = #lb1
   lb1[#lb1+1] = 5
   lb2[5] = #lb1
   --lb2[5] = lb2[4] + 1
   --ÈËÎïÔË¹¦
   i = 0
   local yg = {{'ÓÅÏÈÊ¹ÓÃ',1,'Íâ¹¦'},{'Ö÷ÔËÄÚ¹¦',2,'ÄÚ¹¦'},{'ÃÅÅÉ¼¼ÄÜ1',3,'ÄÚ¹¦'},{'Ö÷ÔËÇá¹¦',4,'Çá¹¦'},}
   -- if psx(id,'×óÓÒ»¥²«') == 0 then 
	  -- table.remove(yg,2)
   -- end
   for k = 1,#yg do 
	   local cl =C_GOLD
	   local str = ''
       --if yg[k][2] == 1 then
	   ----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
	    --  lib.LoadPNG(91,160*2,bx*1242,by*60+i*by*48+by*18,1)
		  lib.LoadPNG(91,160*2,bx*1125+size1,by*60+i*bx*48+bx*18-size1,1)
		  if k ~= 3 and psx(id,yg[k][1]) > 0 then 
		     str = JY.Wugong[psx(id,yg[k][1])]['Ãû³Æ']
		  elseif k == 3 and psx(id,yg[k][1]) > 1 then
			str = JY.Wugong[psx(id,yg[k][1])]['Ãû³Æ']
		  else 
		     str = 'ÎŞ'..yg[k][3]
			 cl =  C_WHITE
		  end
	      if lb1[cx1] == 4 and page == 2 then 
	         if cx == k then 
		        cl = C_RED
		     end
	      end
		  --DrawString(bx*935-string.len('Î´¿ªÆôµÚ¶şÔË¹¦')/4*size,by*136-size/2,'Î´¿ªÆôµÚ¶şÔË¹¦',C_WHITE,size)
		  DrawString(bx*1233+size1-string.len(str)/4*size1,by*60+i*bx*48+bx*18-size1/2-bx*3,str,cl,size1)
		  i = i + 1
		  lb[4][#lb[4]+1] = yg[k][1]
	   --end
   end
   -- lb[4][#lb[4]+1] = '¼ÓÁ¦'
   -- lib.LoadPNG(91,160*2,bx*1242,by*60+i*bx*48+bx*18,2,240,nil,bx*200)
   -- -- if lb1[cx1] == 4 and cx == #lb[4] and page == 2 then
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'ÄÚÁ¦ÔËÆø£º'..psx(id,'¼ÓÁ¦'),C_RED,size1)
   -- -- else 
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'ÄÚÁ¦ÔËÆø£º'..psx(id,'¼ÓÁ¦'),C_WHITE,size1)
   -- -- end
   
   -- lb[5] = {'ÎäÆ÷','·À¾ß','Í·ÊÎ','ÊÎÆ·','Ğ¬×Ó'}
   -- --ÈËÎï×°±¸
   -- i = 0
   -- for k = 1,#lb[5] do 
       -- lib.LoadPNG(91,160*2,bx*522,by*470+i*by*48+by*18,2,240,nil,bx*200)
	   -- local cl = C_WHITE
	   -- local str = ''
	   -- if psx(id,lb[5][k]) > 0 then 
	      -- str = JY.Thing[psx(id,lb[5][k])]['Ãû³Æ']
	   -- else 
	      -- str = 'ÎŞ'..lb[5][k]
		  -- cl = C_GOLD
	   -- end
	   -- if lb1[cx1] == 5 then 
	      -- if cx == k then 
		     -- cl = C_RED
		  -- end
	   -- end
	   -- DrawString(bx*420+size1,by*470+i*bx*48+bx*18-size1/2,str,cl,size1)
	   -- i = i + 1
   -- end
	local bonus_q,bonus_z,bonus_j,bonus_d,bonus_t = psx(id,"È­ÕÆ¹¦·ò"),psx(id,"Ö¸·¨¼¼ÇÉ"),psx(id,"Óù½£ÄÜÁ¦"),psx(id,"Ë£µ¶¼¼ÇÉ"),psx(id,"ÌØÊâ±øÆ÷")
		
   --Îä³£ ÊµÕ½ ¼¯Æø
	local jqz = 0
	local jqz0 = 8
	local jqz1 = 0
	local jqz3 = 0
	local x = JY.Person[id]["Çá¹¦"]
	local jqz2 = 0
    local y = JY.Person[id]["ÄÚÁ¦"]	
	--local x3 = dx*427
	--local y3 = y1
	-- DrawString(x3 , y3,p["ÎäÑ§³£Ê¶"], C_CYGOLD, size*0.7)
     -- if p["ÊµÕ½"] >= 500 then
			-- DrawString(x3, y3+dh, string.format("%s", "¼«"), C_RED, size*0.7)
		-- else
			-- DrawString(x3, y3+dh, string.format("%s", p["ÊµÕ½"]), C_CYGOLD, size*0.7)
		-- end	
	--¼¯ÆøÌõ
	
	local function getnewmove(x)
		if x <= 0 then 
			return 0
		end
		return math.sqrt(x)
	end
	--ÎŞ¾Æ²»»¶£ºÄÚÁ¦¶ÔÓÚÈËÎï¼¯ÆøµÄÓ°Ïìº¯Êı
	local function getnewmove1(a, b)
		local x = (a*2+b)/3
		if x > 6000 then
			return 8 + math.min((x-6000)/1500, 2)
		elseif x > 4000 then
			return 6 + (x-4000)/1200
		elseif x > 2000 then
			return 4 + (x-2000)/1000
		elseif x > 1000 then
			return 2 + (x-1000)/800
		else
			return x/400
		end
	end

	--Õ½³¡Çá¹¦
	local function Qg1(i)

		id = i
		
		local qg = 0 
		
		qg = qg + JY.Person[id]['Çá¹¦']
		
		for i =1,JY.Base["Îä¹¦ÊıÁ¿"] do  
			local level = 0            
			if JY.Person[id]["Îä¹¦" .. i]==108 then
				level = math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. i]/100)+1;
				level = limitX(level/10,0,1)
				qg = qg + math.modf(JY.Person[id]["Çá¹¦"]*0.3*level)	
				break
			end
		end
		
		return qg
	end
	
	jqz = (getnewmove(Qg1(id)) + getnewmove1(JY.Person[id]["ÄÚÁ¦"], JY.Person[id]["ÄÚÁ¦×î´óÖµ"]) + JY.Person[id]["ÌåÁ¦"] / 30)
	
	if JY.Status == GAME_WMAP then
		jqz = (WAR.JQSDXS[id] or 0)
	else	
		jqz = math.modf(jqz)
	end	
   
   
   local cl = M_DeepSkyBlue
   local strcl = '(ÒõÄÚ)'
   if JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 0 then
		cl = M_DeepSkyBlue
		strcl = '(ÒõÄÚ)'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 1 then
		cl = C_ORANGE
		strcl = '(ÑôÄÚ)'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 2 then
		cl = C_CYGOLD
		strcl = '(µ÷ºÍ)'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 3 then
		cl = C_RED
		strcl = '(Ììî¸)'
   end
  -- local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
   --if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
   --if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
 
   i = 0 
   DrawString(bx*660,by*475,'ÉúÃüÏÖÖµ¡¡ '..psx(id,'ÉúÃü'),M_PaleGreen,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÁ¦ÏÖÖµ¡¡ '..psx(id,'ÄÚÁ¦')..strcl,cl,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÊµÕ½¾­Ñé¡¡ '..p["ÊµÕ½"],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÎäÑ§³£Ê¶¡¡ '..p['ÎäÑ§³£Ê¶'],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÉË¿¹ĞÔ¡¡ '..nk.."%",C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÖĞ¶¾¿¹ĞÔ¡¡ '..dk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'×ÆÉÕ¿¹ĞÔ¡¡ '..hk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'±ù·â¿¹ĞÔ¡¡ '..bk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'Á÷Ñª¿¹ĞÔ¡¡ '..xk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'·âÑ¨¿¹ĞÔ¡¡ '..fk.."%",C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'¾­Ñé¡¡¡¡'..string.format('%9s',psx(id,'ÊµÕ½¾­Ñé')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'Ç±ÄÜ¡¡¡¡'..string.format('%9s',psx(id,'ÎäÑ§Ç±ÄÜ')),C_WHITE,size1)
   -- i = i + 1
   --ÈËÎïÊôĞÔ1
   --[[ÈËÎïÊôĞÔ1
   i = 0 
   DrawString(bx*660,by*475,'ÉúÃü¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÉúÃü')),M_PaleGreen,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÁ¦¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÄÚÁ¦'))..strcl,cl,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÉË¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÊÜÉË³Ì¶È')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÖĞ¶¾¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÖĞ¶¾³Ì¶È')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'´ø¶¾¡¡¡¡¡¡'..string.format('%5s',psx(id,'¹¥»÷´ø¶¾')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¿¹¶¾¡¡¡¡¡¡'..string.format('%5s',psx(id,'¿¹¶¾ÄÜÁ¦')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'Îä³£¡¡¡¡¡¡'..string.format('%5s',p["ÎäÑ§³£Ê¶"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÊµÕ½¡¡¡¡¡¡'..string.format('%5s',p["ÊµÕ½"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¼¯Æø¡¡¡¡¡¡'..string.format('%5s',jqz),C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'¾­Ñé¡¡¡¡'..string.format('%9s',psx(id,'ÊµÕ½¾­Ñé')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'Ç±ÄÜ¡¡¡¡'..string.format('%9s',psx(id,'ÎäÑ§Ç±ÄÜ')),C_WHITE,size1)
   -- i = i + 1
   --ÈËÎïÊôĞÔ1]]
   
	i = 0 
	DrawString(bx*900,by*475,'×î´óÉúÃü¡¡ '..psx(id,'ÉúÃü×î´óÖµ'),M_PaleGreen,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'×î´óÄÚÁ¦¡¡ '..psx(id,'ÄÚÁ¦×î´óÖµ')..strcl,cl,size1)--string.format('%5s',)
	--i = i + 1--p["È­ÕÆ¹¦·ò"]+
	--DrawString(bx*900,by*475+i*h,'È­ÕÆ¹¦·ò¡¡'..bonus_q,M_YellowGreen,size1)--string.format('%5s',)   ¡ü
	if JY.Status == GAME_WMAP then
		--DrawAttrib("È­ÕÆ¹¦·ò", bx*890+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["È­ÕÆ¹¦·ò"]+
		DrawString(bx*900,by*475+i*h,'È­ÕÆ¹¦·ò¡¡ '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)--..' ¡ü '..TrueQZ(id)-bonus_q
		DrawAttrib("È­ÕÆ¹¦·ò", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["Ö¸·¨¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ö¸·¨¼¼ÇÉ¡¡ '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("Ö¸·¨¼¼ÇÉ", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["Óù½£ÄÜÁ¦"]+
		DrawString(bx*900,by*475+i*h,'Óù½£ÄÜÁ¦¡¡ '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("Óù½£ÄÜÁ¦", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["Ë£µ¶¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ë£µ¶¼¼ÇÉ¡¡ '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("Ë£µ¶¼¼ÇÉ", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["ÌØÊâ±øÆ÷"]+
		DrawString(bx*900,by*475+i*h,'ÆæÃÅ±øÆ÷¡¡ '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("ÌØÊâ±øÆ÷", bx*900+150,by*475+i*h,M_YellowGreen,size1)
	else
		i = i + 1--p["È­ÕÆ¹¦·ò"]+
		DrawString(bx*900,by*475+i*h,'È­ÕÆ¹¦·ò¡¡ '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["Ö¸·¨¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ö¸·¨¼¼ÇÉ¡¡ '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["Óù½£ÄÜÁ¦"]+
		DrawString(bx*900,by*475+i*h,'Óù½£ÄÜÁ¦¡¡ '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["Ë£µ¶¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ë£µ¶¼¼ÇÉ¡¡ '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["ÌØÊâ±øÆ÷"]+
		DrawString(bx*900,by*475+i*h,'ÆæÃÅ±øÆ÷¡¡ '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
	end	
	--[[i = i + 1--p["Ö¸·¨¼¼ÇÉ"]+
	DrawString(bx*900,by*475+i*h,'Ö¸·¨¼¼ÇÉ¡¡'..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		 DrawAttrib("Ö¸·¨¼¼ÇÉ", bx*880+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["Óù½£ÄÜÁ¦"]+
	DrawString(bx*900,by*475+i*h,'Óù½£ÄÜÁ¦¡¡'..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("Óù½£ÄÜÁ¦", bx*870+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["Ë£µ¶¼¼ÇÉ"]+
	DrawString(bx*900,by*475+i*h,'Ë£µ¶¼¼ÇÉ¡¡'..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("Ë£µ¶¼¼ÇÉ", bx*860+150,by*475+i*h,M_YellowGreen,size1)
	end
   
	i = i + 1--p["ÌØÊâ±øÆ÷"]+
	DrawString(bx*900,by*475+i*h,'ÆæÃÅ±øÆ÷¡¡'..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
    if JY.Status == GAME_WMAP then
		DrawAttrib("ÌØÊâ±øÆ÷", bx*850+150,by*475+i*h,M_YellowGreen,size1)
	end]]
  
	i = i + 1
 -- DrawString(bx*900,by*475+i*h,'°µÆ÷¡¡¡¡¡¡'..string.format('%5s',p["°µÆ÷¼¼ÇÉ"]),C_WHITE,size1)
	if p["ÃÅÅÉ¼¼ÄÜ2"] > 0 then
		local str = ""
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 458 then
			str = "(±ùÆÇ)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 450 then
			str = "(Åùö¨)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 459 then
			str = "(ÉúËÀ·û)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 460 then
			str = "(Í¸¹Ç)"
		end
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 469 then
			str = "(ºÚÑª)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 486 then
			str = "(Ï¸Óê)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 489 then
			str = "(Îå¶¾)"
		end
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 490 then
			str = "(½ğÉß)"
		end
		DrawString(bx*900,by*475+i*h,'°µÆ÷ÊÖ·¨¡¡ '..p["°µÆ÷¼¼ÇÉ"]..str,M_Orange,size1)--string.format('%5s',)
	else
		DrawString(bx*900,by*475+i*h,'°µÆ÷ÊÖ·¨¡¡ '..p["°µÆ÷¼¼ÇÉ"],M_Orange,size1)--string.format('%5s',)
	end
  
	i = i + 1
	DrawString(bx*900,by*475+i*h,'ÈËÎï×ÊÖÊ¡¡ '..p["×ÊÖÊ"],M_Red,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'ÈËÎïÌåÖÊ¡¡ '..p["ÉúÃüÔö³¤"] + limitX(math.modf(p['ÃÅÅÉ¼¼ÄÜ5'] *0.01),0,8),M_Red,size1)--string.format('%5s',)
	i = i + 1
   
   -- DrawString(bx*900,by*475+i*h,'Îä³£¡¡¡¡¡¡'..string.format('%5s',p["ÎäÑ§³£Ê¶"]),C_WHITE,size1)
   -- i = i + 1
	local zyhb = nil
	if ZYHBPD(id) >= 1 then
		if ZYHBPD(id) == 2 then
			zyhb  = "ÕæÚĞ"
		else
			zyhb  = "¡ò"
		end	
	else
		zyhb  = "¡ù"
	end
	
      local zyzd = nil	
	if ZhongYongZD1(id) or ZhongYongZD2(id) then
		if JY.Person[id]["ÖĞÓ¹"] == 3 then
			zyzd  = "ÌìÈË"
		else
			zyzd  = "¡ò"
		end	
	else
		zyzd  = "¡ù"
	end		
	
    local mrdz = nil	
	if MuRongDZ(id) == true then
		if JY.Person[id]["ÃÅÅÉ¼¼ÄÜ3"] == 2 then
			mrdz  = "ÃØ´«"
		else
			mrdz  = "¡ò"
		end
	else
		mrdz  = "¡ù"
	end	
	
   	local xshm = nil	
	if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ4'] > 0 then
		if JY.Person[id]["ÃÅÅÉ¼¼ÄÜ4"] == 1001 then
			xshm  = "Ö¤¹û"
		else
			xshm  = JY.Person[id]['ÃÅÅÉ¼¼ÄÜ4']
		end
	else
		xshm  = "¡ù"
	end	
	
	local yjmc = nil
	if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] > 0 then
		if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] == 801 then
			yjmc = 'ÎŞÉÏ'
		elseif JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] > 400 and JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] < 801 then
			yjmc = 'ÎŞ±È'
		else
			yjmc = '³õÑ§'
		end
	else
		yjmc = "¡ù"	
	end			


	i = 0
	DrawString(bx*1140,by*475,'¹¥»÷ÄÜÁ¦¡¡ '..str2_gain,M_Yellow,size1)
	if str_gain > 0 then
		DrawString(bx*1140+120,by*475,"¡¡ ¡ü "..str_gain,M_Yellow,size1)
	end	
	i = i + 1
	--DrawString(bx*1140,by*475+i*h,'·ÀÓùÁ¦¡¡¡¡¡¡'..string.format('%5s %2s %2s',def2_gain,"¡ü",def_gain),M_Yellow,size1)
	DrawString(bx*1140,by*475+i*h,'·ÀÓùÄÜÁ¦¡¡ '..def2_gain,M_Yellow,size1)
	if def_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"¡¡ ¡ü "..def_gain,M_Yellow,size1)
	end	
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'Çá¹¦Éí·¨¡¡ '..agi2_gain,M_Yellow,size1)
	if agi_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"¡¡ ¡ü "..agi_gain,M_Yellow,size1)
	end	
  --DrawString(bx*1140,by*475+i*h,'Çá¹¦¡¡¡¡¡¡'..string.format('%5s %2s %2s',p["Çá¹¦"],"¡ü",agi1_gain),M_Yellow,size1)
	--[[if agi_gain > -1 then
		DrawString(bx*1140,by*475+i*h,'Çá¹¦Öµ¡¡¡¡¡¡'..string.format('%5s %2s %2s',agi2_gain,"¡ü",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	else
		agi_gain = -(agi_gain)
		DrawString(bx*1140,by*475+i*h,'Çá¹¦¡¡¡¡¡¡'..string.format('%5s %2s %2s',agi2_gain,"¡ı",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	end]]

	i = i + 1
	if p["ÃÅÅÉ¼¼ÄÜ6"] > 0 then
		local str = ""
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 187 then
			str = "(×ÓÎç)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 188 then
			str = "(»ªÙ¢)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 189 then
			str = "(ÇàÅ£)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 190 then
			str = "(Ç§½ğ)"
		end
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 191 then
			str = "(»ÆµÛ)"
		end
		DrawString(bx*1140,by*475+i*h,'Ò½ÁÆÄÜÁ¦¡¡ '..psx(id,'Ò½ÁÆÄÜÁ¦')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'Ò½ÁÆÄÜÁ¦¡¡ '..psx(id,'Ò½ÁÆÄÜÁ¦'),M_PaleGreen,size1)
	end
	i = i + 1
	if p["ÃÅÅÉ¼¼ÄÜ6"] > 0 then
		local str = ""
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 192 then
			str = "(¶¾¾­)"
		end	
		DrawString(bx*1140,by*475+i*h,'¶¾ÊõÔìÒè¡¡ '..psx(id,'ÓÃ¶¾ÄÜÁ¦')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'¶¾ÊõÔìÒè¡¡ '..psx(id,'ÓÃ¶¾ÄÜÁ¦'),M_PaleGreen,size1)
	end
	i = i + 1
	--[[DrawString(bx*1140,by*475+i*h,'Á¬»÷»úÂÊ¡¡ '..Person_LJ(id)..'%',M_DeepSkyBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'±©»÷»úÂÊ¡¡ '..Person_BJ(id)..'%',C_RED,size1)
	i = i + 1]]
	DrawString(bx*1140,by*475+i*h,'×óÓÒ»¥²«¡¡ '..zyhb,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'ÖĞÓ¹Ö®µÀ¡¡ '..zyzd,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'¶·×ªĞÇÒÆ¡¡ '..mrdz,M_LightBlue,size1)
	i = i + 1
   	DrawString(bx*1140,by*475+i*h,'Ï´Ëè»»Âö¡¡ '..xshm,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'è¤Ù¤ÃÜ³Ë¡¡ '..yjmc,M_LightBlue,size1)
	
   
   
   DrawString(bx*1140,by*475-160, "ĞŞÁ¶", C_CYGOLD, size*0.7)
	local thingid = p["ĞŞÁ¶ÎïÆ·"]
		if thingid > 0 then
			--lib.PicLoadCache(2, p["ĞŞÁ¶ÎïÆ·"] * 2, x1 + size*4, y1*19+96-100, 1)
            DrawString(bx*1140,by*475-140, JY.Thing[thingid]["Ãû³Æ"], M_DeepSkyBlue, size*0.7)			
			i = i + 1
			local n = TrainNeedExp(id)
			if n < math.huge then
				DrawString(bx*1140,by*475-120, string.format("%5d/%5d", p["ĞŞÁ¶µãÊı"], n), C_CYGOLD, size*0.7)
			else
				DrawString(bx*1140,by*475-120, string.format("%5d/===", p["ĞŞÁ¶µãÊı"]), C_CYGOLD, size*0.7)
			end
		else


	  --¾­ÑéÖµ
	  ---i = i + 1
		--DrawString(x1-130, y1 + 12*h * (i)-40, "Éı¼¶", C_CYGOLD, size*0.8)
		local kk = nil
		if p["µÈ¼¶"] >= 30 then
			kk = "   ="
		else
			p["µÈ¼¶"] = limitX(p["µÈ¼¶"],1,30)
			kk = 2 * (p["¾­Ñé"] - CC.Exp[p["µÈ¼¶"] - 1])
			if kk < 0 then
				kk = "  0"
			elseif kk < 10 then
				kk = "   " .. kk
			elseif kk < 100 then
				kk = "  " .. kk
			elseif kk < 1000 then
				kk = " " .. kk
			end
		end		
		
		
		
		--µÈ¼¶
	--	DrawString(dx*189, dy*390, kk, C_CYGOLD, size*0.8)
	--	local tmp = nil
	--	if CC.Level <= p["µÈ¼¶"] then
	--		tmp = "="
	--	else
	--		tmp = 2 * (CC.Exp[p["µÈ¼¶"]] - CC.Exp[p["µÈ¼¶"] - 1])
	--	end
	--	DrawString(dx*209, dy*390, "/" .. tmp, C_CYGOLD, size*0.8)
	end
   
   --ÉúÃüÄÚÁ¦´óĞ¡
	local ww = bx*78
	--local h = bx*7
	--ÉúÃü×ø±ê
	local x1,y1 = bx*200,bx*640
	--ÄÚÁ¦×ø±ê
	local x2,y2 = bx*200,bx*658
	--ÉúÃü
	local sm = JY.Person[id]['ÉúÃü']
	--ÄÚÁ¦
	local nl = JY.Person[id]['ÄÚÁ¦']
	--×î´óÉúÃü
	local smmax = JY.Person[id]['ÉúÃü×î´óÖµ']
	--×î´óÄÚÁ¦
	local nlmax = JY.Person[id]['ÄÚÁ¦×î´óÖµ']
	lib.LoadPNG(91, 35*2, x1, y1, 2)
	lib.LoadPNG(91, 35*2, x2, y2, 2)
	--ÉúÃüÌõ
	lib.SetClip(x1-ww,y1-bx*7,(x1-ww)+(ww*2)*(sm/smmax),y1+bx*7)
	lib.LoadPNG(91, 31*2, x1, y1, 2)
	
	lib.SetClip(0,0,0,0)
	--ÄÚÁ¦Ìõ
	lib.SetClip(x2-ww,y2-bx*7,(x2-ww)+(ww*2)*(nl/nlmax),y2+bx*7)
	lib.LoadPNG(91, 32*2, x2, y2, 2)
	
	lib.SetClip(0,0,0,0)
	-- --ÄÚÁ¦ÊôĞÔ
	-- local sx = {'Òõ','Ñô','µ÷ºÍ','Ììî¸'}
	-- --ÄÚÁ¦ÊôĞÔ
	-- local nlsx = sx[JY.Person[0]['ÄÚÁ¦ĞÔÖÊ']+1]
	local cl = M_DeepSkyBlue
   local strcl = 'ÒõÄÚ'
   if JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 0 then
		cl = M_DeepSkyBlue
		strcl = 'ÒõÄÚ'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 1 then
		cl = C_ORANGE
		strcl = 'ÑôÄÚ'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 2 then
		cl = C_CYGOLD
		strcl = 'µ÷ºÍ'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 3 then
		cl = C_RED
		strcl = 'Ììî¸'
   end
	
	--ÉúÃüÊı×Ö
	local smwz = sm..'/'..smmax
	--ÄÚÁ¦Êı×Ö
	local nlwz = nl..'/'..nlmax--..'£¨'..strcl..'£©'
	
	--ÉúÃü
	DrawString(x1-string.len(smwz)/4*size2,y1-size2/2,smwz,C_WHITE,size2)
	--ÄÚÁ¦
	DrawString(x2-string.len(nlwz)/4*size2,y2-size2/2,nlwz,cl,size2)
   
   
   i = 0
   local hh = 50
   local wh = lb1[cx1]
   if lb1[cx1] ~=nil and lb1[cx1] > 4 then 
      hh = 475
	  wh = 1
   end
   if page == 2 then
	if lb1[cx1] < 4 then
		--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
	    lib.LoadPNG(91,162*2,bx*420+bx*240*(wh-1)+bx*70-bx*70,by*hh+by*25/2+cx*h-h-by*15,1)
		if lb1[cx1] == 2 then
			local li = cx + cot[2]
			local wz = 100
			local jg = 0
			local lv = math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. lb[2][li][2]]/100)+1;
			local kungfuatk = get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[2][li][2]], lv)
			lib.LoadPNG(91,161*2,0,0,1)
			--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
			--say("²âÊÔÎ»ÖÃ"..lb[lb1[cx1]][cx][1],0,1)
			local name = JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[2][li][2]]]['Ãû³Æ']
	        DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'±àºÅ'..lb[2][li][2],M_YellowGreen,size2)
			--Îä¹¦¹¥»÷·¶Î§ÏÔÊ¾
		    DrawString(bx*50,by*80,'¹¥»÷·¶Î§',C_BLACK,size)
			
			--DrawString(bx*200,by*80,'±àºÅ:'..lb[2][cx][2],M_YellowGreen,size)
			
		    tjm30(id,lb[lb1[cx1]][li][1],bx*50,by*90+size)
			
			DrawString(bx*50,by*270+wz*by,'Îä¹¦ÍşÁ¦',C_BLACK,size*0.9)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
		     DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[2][li][2]], 11).."(×î´óÍşÁ¦)",C_ORANGE,size*0.9)
			
			
			DrawString(bx*50,by*270+wz*by+(by*40+size),'Îä¹¦ÕĞÊ½',C_RED,size)
		    local wgid = JY.Person[id]["Îä¹¦" .. lb[2][li][2]]
			if CC.KFMove[wgid] ~= nil then
				for i=1 ,#CC.KFMove[wgid] do 
					DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   Æø¹¥: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
				end
			--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
			end
			
			--JY.Person[id]["Îä¹¦µÈ¼¶" .. i]
			--JY.Person[pid]["Îä¹¦" .. lb[2][cx][2]]
			-- lb[2][#lb[2]+1] ={ psx(id,'Îä¹¦'..k),k}
			--lb[2][cx][1]
			--ÏÔÊ¾Îä¹¦ÏêÏ¸
		elseif lb1[cx1] == 3 then
			lib.LoadPNG(91,161*2,0,0,1)
			local li = cx + lscot
			local name = JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[3][cx][2]]]['Ãû³Æ']
			DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'±àºÅ'..lb[3][li][2],M_YellowGreen,size2)
			--DrawString(bx*200,by*80,'±àºÅ:'..lb[3][cx][2],M_YellowGreen,size)
			if JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[3][li][2]]]['Îä¹¦ÀàĞÍ'] == 6 then
				local wz = 100
				local jg = 0
				local lv = math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. lb[3][li][2]]/100)+1;
				local kungfuatk = get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[3][li][2]], lv)
				--lib.LoadPNG(91,161*2,0,0,1)
				--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
				--say("²âÊÔÎ»ÖÃ"..lb[lb1[cx1]][cx][1],0,1)
				
				
				--Îä¹¦¹¥»÷·¶Î§ÏÔÊ¾
				DrawString(bx*50,by*80,'¹¥»÷·¶Î§',C_BLACK,size)
				
				tjm30(id,lb[lb1[cx1]][li][1],bx*50,by*90+size)
				DrawString(bx*50,by*270+wz*by,'Îä¹¦ÍşÁ¦',C_BLACK,size*0.9)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
				DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[3][li][2]], 11).."(×î´óÍşÁ¦)",C_ORANGE,size*0.9)
			
				-- --Îä¹¦ÄÚÁ¦ĞÔÖÊ
				--DrawString(bx*50,by*270+wz*by+(by*40+size),'Îä¹¦ÕĞÊ½',C_RED,size)
				--local wgid = JY.Person[id]["Îä¹¦" .. lb[3][cx][2]]
				--[[if CC.KFMove[wgid] ~= nil then
					for i=1 ,#CC.KFMove[wgid] do 
						DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   Æø¹¥: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
					end
				--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
				end	]]										
			
			end
		elseif lb1[cx1] == 1 then
			
				local li = cx + cot[1]
				if li > 4 then 
					lib.LoadPNG(91,161*2,0,0,1)
					if lb[1][li] ~= nil then
					local name = lb[1][li]
					tjm(bx*50,by*10,name,M_Yellow,size)
					if li == 5 then --tfjswz = [#tfjswz+1] = tfstr
						local tfstr = tfjswz1[mid]
						if mid == 0 and JY.Base['±ê×¼'] > 0 then
							tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
						else
							tfstr = tfjswz1[mid]
							if tfstr == nil then
								tfstr = '£×ÎŞ¸öÈËÌì¸³½éÉÜ'
							end	
							tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
						--	tjm(bx*50,by*80,tfstr,C_BLACK,size*0.7,14,h+10)
						end	
						
					else
						local tfstr = tfjswz[li-5]
						if li == 6 and (match_ID(id,26) or match_ID(id,592) or match_ID(id,577)) then
							tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
						else	
						--	tfstr = tfjswz1[j]
							tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
							--tjm(bx*35,by*50,li,M_Yellow,size*0.7,13,h+3)
						end	
					end	
				end
			end
		end
	end
end
	
	
	
   ShowScreen()
   local X,ktype,mx,my = lib.GetKey()
   if X == VK_SPACE or X == VK_RETURN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 1 then
			 page = 2		 
		  elseif page == 2 then 
			 if lb1[cx1] == 5 then
			 --   Personzb(id,cx)
			 elseif lb1[cx1] == 4 then	
				if cx == #lb[4] then 
				--  Menu_Jiali(id)
				--	say("²âÊÔÎ»ÖÃ1"..cx,0,1)
					Menu_Gongti(id,yg[cx][2])
				else 
				  Menu_Gongti(id,yg[cx][2])
				end
			 elseif lb1[cx1] == 3 then	
				--detailed_info(cur_thing)
				if cx <= #lb[3] then
					--say("ÏÖÔÚÎ»ÖÃ£º"..lb[3][cx][1],0,1)
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --¶ÁÈ¡ÎïÆ·
						if JY.Thing[j]["Á·³öÎä¹¦"] >= 0 and JY.Thing[j]["Á·³öÎä¹¦"] == lb[3][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 2 then
				if cx <= #lb[2] then
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --¶ÁÈ¡ÎïÆ·
						if JY.Thing[j]["Á·³öÎä¹¦"] >= 0 and JY.Thing[j]["Á·³öÎä¹¦"] == lb[2][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 1 then
				-- if cx >= 5 then 
				-- --  Menu_Jiali(id)
				-- --say("²âÊÔÎ»ÖÃ1"..cx,0,1)
					-- --Menu_Gongti(id,yg[cx][2])
					-- --lib.LoadPNG(91,165*2,bx*500,by*46+(cx*15),1)
					-- lib.LoadPNG(91,161*2,0,0,1)
					-- --local name = JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[3][cx][2]]]['Ãû³Æ']
					-- --DrawString(bx*50,by*12,name,M_Yellow,size)
					-- --DrawString(bx*300,by*12,'±àºÅ'..lb[3][cx][2],M_YellowGreen,size2)
					-- --DrawString(bx*200,by*80,'±àºÅ:'..lb[3][cx][2],M_YellowGreen,size)
					-- --for j = 1, #bossztwz do
						-- --local tfstr = bossztwz[j]
						-- --tjm(bx*50,by*80,tfstr,C_BLACK,size,10,h+10)
					-- --end	
					-- --for k = 1, tfjsbh do
						-- local n = 0
						-- local tfstr = tfjswz[cx-n] --= tfstr
						-- --local tfstr1 = tfjswz[cx-n] --= tfstr
						-- local h1 = 0
						-- if cx == 5 then
							-- --n = 5
							-- for j = 1 ,#tfjswz1 do
							-- tfstr = tfjswz1[j]
							-- tjm(bx*50,by*40+j*60,tfstr,C_BLACK,size*0.7,14,h+3)
							-- --tjm(bx*550,by*46+(cx*15)+j*20,tfstr,C_WHITE,size1,math.floor(bx*350/(size1)*0.8)+15,h+10)
							-- end
						-- --	say("×¨ÊôÌì¸³",0,1)
						-- else
							-- n = 5
							-- tfstr = tfjswz[cx-n]
							-- tjm(bx*50,by*80,tfstr,C_BLACK,size*0.7,14,h+10)
							-- --tjm(bx*550,by*46+(cx*15),tfstr,C_WHITE,size*0.8,math.floor(bx*350/(size)*0.8)+2,h+10)
						-- end

					-- --DrawString(bx*935-string.len('Î´¿ªÆôµÚ¶şÔË¹¦')/4*size,by*136-size/2,'Î´¿ªÆôµÚ¶şÔË¹¦',C_WHITE,size)
					-- ShowScreen()
					-- WaitKey()
				-- else 
				  -- --Menu_Gongti(id,yg[cx][2])
				-- end
			 end
		  end
	  --end
   elseif X == VK_ESCAPE or ktype == 4 then 
      if page == 2 then 
	     page = page - 1 
		 cx = 1 
		 cx1 = 1
	  else 	 
         break
	  end
	  fy = 0
   elseif X == VK_UP then
	  --page2ÈËÎïÊôĞÔÑ¡Ôñ
	  --if JY.Status ~= GAME_WMAP then
		if page == 2 then 
			if cot[cx1] > 0 then 
				cot[cx1] = cot[cx1] - 1
			else
				cx = cx - 1
				if cx < 1 then
					if #lb[lb1[cx1]] > 14 then
						cx = 14
						cot[cx1] = #lb[lb1[cx1]] - 14
					else
						cx = #lb[lb1[cx1]]
					end
				end	
			end
		end
		fy = 0
	 -- end
   elseif X == VK_DOWN then
	  --page2ÈËÎïÊôĞÔÑ¡Ôñ
	 -- if JY.Status ~= GAME_WMAP then
		  if page == 2 then 
			 cx = cx + 1
			 if cx > 14 then 
				cx = 14
				cot[cx1] = cot[cx1] + 1
			 end
			 if cx + cot[cx1] > #lb[lb1[cx1]] then
				cx = 1
				cot[cx1] = 0
			 end
			 fy = 0
		  end
	  --end
   elseif X == VK_LEFT  then
      --page1ÈËÎïÒ³ÃæÇĞ»»
	  if JY.Status ~= GAME_WMAP then
		  if page == 1 then 
			 t = t - 1 
			 if t < 1 then
				t = #team
			 end
			 id  = JY.Base['¶ÓÎé'..t]
		  end
	  end  --page2ÈËÎïÊôĞÔÑ¡Ôñ
		  if page == 2 then 
			 cx1 = cx1 - 1
			 cx = 1
			 if cx1 < 1 then 
				cx1 = #lb1
			 end
			 fy = 0
			 cot = {0,0,0,0,0}
			 
		  end
	-- end
   elseif X == VK_RIGHT  then
      --page1ÈËÎïÒ³ÃæÇĞ»»
	  if JY.Status ~= GAME_WMAP then
		  if page == 1 then
			 t = t + 1 
			 if t > #team then 
				t = 1
			 end
			 id  = JY.Base['¶ÓÎé'..t]
		  end
	 end
		  --page2ÈËÎïÊôĞÔÑ¡Ôñ
		  if page == 2 then 
			 cx1 = cx1 + 1
			 cx = 1
			 if cx1 > #lb1 then 
				cx1 = 1
			 end	
			 fy = 0
			 cot = {0,0,0,0,0}
		  end	
    --  end	  
   elseif X == VK_PGUP then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy - 1
			 if fy < 0 then 
				fy = 0
			 end	
		  end
	  --end
   elseif X == VK_PGDN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy + 1
			 if fy > fymax then
				fy = fymax 
			 end
		  end
	  --end
   else 
     -- if JY.Status ~= GAME_WMAP then
      local mxx = false 
	  if page == 1 then 
	     if ktype == 3 then 
		    page = 2
		 end
	  elseif page == 2 then 
	     if #lb[1] > 0 then 
		    for ii = 1,#lb[1] do
				if ii <= 14 then
					if mx >= bx*420 and mx <= bx*420 + bx*160 and 
					my >= by*50+(ii-1)*h and my <= by*50+(ii-1)*h + size1 then 
					cx = ii
					cx1 = lb2[1]
					mxx = true 
					break
					end
				end
			end
		 end	
		 if #lb[2] > 0 then 
		    for ii = 1,#lb[2] do 
				if ii <= 14 then
					if mx >= bx*660 and mx <= bx*660 +size1*4 and 
					my >= by*50+(ii-1)*h and my <= by*50+(ii-1)*h + size1 then 
					cx = ii 
					cx1 = lb2[2]
					mxx = true 
					break
					end
				end
			end
		 end
		 if #lb[3] > 0 and mxx == false then 
		    for ii = 1,#lb[3] do 
				if ii <= 14 then
					if mx >= bx*900 and mx <= bx*900 +size1*4 and 
					my >= by*50+(ii-1)*h and my <= by*50+(ii-1)*h + size1 then 
					cx = ii 
					cx1 = lb2[3]
					mxx = true 
					break
					end
				end
			end
		 end
		 if #lb[4] > 0 then 
		    for ii = 1,#lb[4] do 
			    if mx >= bx*1142 and mx <= bx*1345 and 
				   my >= by*78+(ii-1)*by*48-by*18 and my <= by*78+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[4]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[5] > 0 then 
		    for ii = 1,#lb[5] do 
			    if mx >= bx*422 and mx <= bx*622 and 
				   my >= by*488+(ii-1)*by*48-by*18 and my <= by*488+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[5]
				   mxx = true 
				   break
				end
			end
		 end
		 if mxx == true and ktype == 3 then 
	        if lb1[cx1] == 5 then
		    --   Personzb(id,cx)
		    elseif lb1[cx1] == 4 then	
		       if cx == #lb[4] then 
			    
				Menu_Gongti(id,yg[cx][2])
			   else 
			      Menu_Gongti(id,yg[cx][2])
			   end
		    elseif lb1[cx1] == 2 then
		    
		    end
		 end
	  end
	  --end
   end
   
   
   end
end 

function PersonStatusA(t,page)
   local bx = CC.ScreenW/1360
   local by = CC.ScreenH/768
   local size = CC.DefaultFont*0.7
   local size1 = CC.DefaultFont*0.6
   local size2 = CC.DefaultFont*0.55
   local h = by*size1*1.2
   local cx = 1 
   local cx1 = 1
   local fy = 0 --ÊôĞÔËµÃ÷·­Ò³
   local fymax = 0 --×î´ó·­Ò³
   local team = {}
	if JY.Restart == 1 then
		do return end
	end
	if t < 0 then
		do return end
	end	
   for tt = 1,CC.TeamNum do 
       if JY.Base['¶ÓÎé'..tt] >= 0 then 
	      team[#team+1] = JY.Base['¶ÓÎé'..tt]
	   end
   end 
   if page == nil then 
      page = 1 
   end
   
	
   
   -- if JY.Status == GAME_WMAP then
	    -- if WAR.Person[teamid]["ÎÒ·½"] == false then
	        -- pagenum = 2
	    -- end
	-- end
	local id = -1
   if JY.Status == GAME_WMAP then
       id = WAR.Person[t]["ÈËÎï±àºÅ"]
   else 
       id = t
   end
	local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
   if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
   if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
   while true do
   if JY.Restart == 1 then
		do return end
	end
   Cls()
   
   local p = JY.Person[id]
   local picx,picy = lib.GetPNGXY(1,psx(id,'°ëÉíÏñ')*2)
   local lb = {{},{},{},{},{}}
   local lb1 = {}
   local lb2 = {nil,nil,nil,nil,nil}
   local function DrawAttrib(str, x,y,color1,size)
		local i = 0
		--DrawString(x1, y1 + h * i, string.sub(4), color1, size)
		--¶îÍâÏµÊıÏÔÊ¾
		--local str;
		if str == "È­ÕÆ¹¦·ò" then
			local bonus = 0
			bonus = TrueQZ(id) - JY.Person[id]["È­ÕÆ¹¦·ò"] 
			if bonus > 0 then
				DrawString(x,y,  string.format("¡ü %s",bonus), color1, size)
			end
		end
		
		if str == "Ö¸·¨¼¼ÇÉ" then
			local bonus = 0
			
			bonus = TrueZF(id) - JY.Person[id]["Ö¸·¨¼¼ÇÉ"] 
			if bonus > 0 then
				DrawString(x, y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		
		if str == "Óù½£ÄÜÁ¦" then
			local bonus = 0
			bonus = TrueYJ(id) - JY.Person[id]["Óù½£ÄÜÁ¦"] 
			if bonus > 0 then
				DrawString(x, y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		
        if str == "Ë£µ¶¼¼ÇÉ" then
            local bonus = 0
			bonus = TrueSD(id) - JY.Person[id]["Ë£µ¶¼¼ÇÉ"] 		
			if bonus > 0 then
				DrawString(x, y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		
        if str == "ÌØÊâ±øÆ÷" then
            local bonus = 0
			bonus = TrueTS(id) - JY.Person[id]["ÌØÊâ±øÆ÷"]
			if bonus > 0 then
				DrawString(x,y, string.format("¡ü %s",bonus), color1, size)
			end
		end
		--Õ½³¡ÇéÂÂ¼Ó³É°µÆ÷¼¼ÇÉ
		if JY.Status == GAME_WMAP then
				if str == "Ò½ÁÆÄÜÁ¦" then
					for k,v in pairs(CC.AddDoc) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
									DrawString(x,y, "¡ü "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				if str == "ÓÃ¶¾ÄÜÁ¦" then
					for k,v in pairs(CC.AddPoi) do
						if match_ID(id, v[1]) then
							for wid = 0, WAR.PersonNum - 1 do
								if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
									DrawString(x,y, "¡ü "..v[3], color1, size)
									--break
								end
							end
						end
					end
					
				end
				
			i = i + 1
		end
	end

	-- if case == nil then
		-- if JY.Status ~= GAME_WMAP then
			-- DrawString(x1-size*5, y1 + h * (i)+2, "ÉÏÏÂ¼ü»»ÈË ¡ú¼üÏÔÊ¾ÈËÎïÌì¸³ ESCÍË³ö", M_PaleTurquoise, size*0.7)
		-- else
			-- DrawString(x1-size*5, y1 + h * (i)+2, "ÉÏÏÂ¼ü»»ÈË ¡ú¼üÏÔÊ¾ÈËÎïÌì¸³ ESCÍË³ö", Snow3, size*0.7)
		-- end
	-- else
		-- DrawString(x1-size*5, y1 + h * (i)+2, "ÉÏÏÂ¼üÑ¡ÔñÊôĞÔ ×óÓÒ¼ü¼õÉÙ/Ôö¼Ó »Ø³µ¼üÈ·ÈÏ¼Óµã", Snow3, size*0.7)
	-- end


  --[[ if psx(id,'Ìì¸³Íâ¹¦1') > 0 or psx(id,'Ìì¸³Íâ¹¦2') > 0 or psx(id,'Ìì¸³ÄÚ¹¦') > 0 or psx(id,'Ìì¸³Çá¹¦') > 0  then 
      lb1[#lb1+1] = 1
	  lb2[1] = #lb1
	  lb2[2] = lb2[1]
   end]]
   local i = 0
   --±³¾°Í¼
   --lib.PicLoadCache(99,121*2,CC.ScreenW/2,CC.ScreenH/2,2,256,nil,bx*1360)
   lib.LoadPNG(91, 149 * 2 ,0 , 0, 1)
   --ÈËÎï°ëÉíÏñ
   pngxy(90,psx(id,'°ëÉíÏñ')*2,bx*200,CC.ScreenH-by*300,2)
   --ÃÅÅÉ
   -- if MPPD(id) ~= nil and MPPD(id) > 0 then 
	  -- DrawString(bx*30,by*70,CC.MP[MPPD(id)][1]..CC.MPDJ[MPPD(id)][MPDJ(id)],C_ORANGE,size)
   -- else 
	  -- DrawString(bx*30,by*70,'½­ºşÈËÊ¿',C_WHITE,size)
   -- end
	if MPPD(id) ~= 0 then
		local mptype, mpdj = MPDISPLAY(id)
		local str = ""
		local str1 = ""
		local color = ""
		if mptype ~= nil then
			if MPPD(id) == 13 and match_ID(id,66) then
				str = "¡¾".."²¨Ë¹Ã÷½Ì".."¡¿"
				str1 = "¡¾".."Ê¥Å®".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, , M_Red, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 4 then
				str = "¡¾".."Ã÷½Ì".."¡¿"
				str1 = "¡¾".."´úĞĞÊ¹Õß".."¡¿"
				color = C_GOLD
				--DrawString(bx*30,by*70, "¡¾".."Ã÷½Ì´úĞĞÊ¹Õß".."¡¿", C_GOLD, size*0.8)
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["Æ·µÂ"] == 1 then
				str = "¡¾".."Ã÷½Ì".."¡¿"
				str1 = "¡¾".."ĞşĞÄÀÇÍõ".."¡¿"
				color = C_GOLD
			elseif MPPD(id) == 13 and id == 0 and MPDJ(id) == 3 and JY.Person[13]["Æ·µÂ"] == 100 then
				str = "¡¾".."Ã÷½Ì".."¡¿"
				str1 = "¡¾".."³àÑª÷ëÍõ".."¡¿"
				color = C_GOLD
			elseif MPPD(id) == 12 and match_ID(id,73) then
				str = "¡¾".."ÈÕÔÂÉñ½Ì".."¡¿"
				str1 = "¡¾".."Ê¥¹Ã".."¡¿"
				color = M_Red
			elseif MPPD(id) == 12 and match_ID(id,26) then	
				str = "¡¾".."ÈÕÔÂÉñ½Ì".."¡¿"
				str1 = "¡¾".."Ç°½ÌÖ÷".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÈÕÔÂÉñ½ÌÇ°½ÌÖ÷".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 14 and match_ID(id,140) then	
				str = "¡¾".."ÎåÔÀ½£ÅÉ".."¡¿"
				str1 = "¡¾".."Ì«ÉÏ³¤ÀÏ".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÎåÔÀ½£ÅÉÌ«ÉÏ³¤ÀÏ".."¡¿", M_Red, size*0.8)		
			elseif MPPD(id) == 10 and match_ID(id,588) then	
				str = "¡¾".."ÌÒ»¨µº".."¡¿"
				str1 = "¡¾".."µºÖ÷·òÈË".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÌÒ»¨µºÖ÷·òÈË".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,577) then	
				str = "¡¾".."ÉÙÁÖÅÉ".."¡¿"
				str1 = "¡¾".."é_ÅÉ×æÊ¦".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÉÙÁÖ×æÊ¦".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 5 and match_ID(id,114) then	
				str = "¡¾".."ÉÙÁÖÅÉ".."¡¿"
				str1 = "¡¾".."ÒşÊÀ¸ßÉ®".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÒşÊÀ¸ßÉ®".."¡¿", M_Red, size*0.8)	
			elseif MPTX(id,5,4) and id == 0 and CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ'] > 0 then	
				str = "¡¾".."ÉÙÁÖÅÉ".."¡¿"
				local str = {'½ğ¸ÕµîÖ÷','ÂŞººÌÃÖ÷','´ïÄ¦ÔºÖ÷'}
				str1 = "¡¾"..str[CC.TX['ÉÙÁÖÕÆÔºÑ¡Ôñ']].."¡¿"
				color = M_DeepSkyBlue	
			elseif MPPD(id) == 5 and match_ID(id,38) then	
				str = "¡¾".."·ğµÀ".."¡¿"
				str1 = "¡¾".."ĞÜ¶ú×ªÉú".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."ÒşÊÀ¸ßÉ®".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 2 and match_ID(id,50) then	
				str = "¡¾".."Ø¤°ï".."¡¿"
				str1 = "¡¾".."Ç°°ïÖ÷".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."Ø¤°ïÇ°°ïÖ÷".."¡¿", M_Red, size*0.8)
			elseif MPPD(id) == 15 and match_ID(id,499) then	
				str = "¡¾".."´óÀí".."¡¿"
				str1 = "¡¾".."×Ú×åÏÈ×æ".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."´óÀíÏÈ×æ".."¡¿", M_Red, size*0.8)	
			elseif MPPD(id) == 11 and match_ID(id,596) then	
				str = "¡¾".."Ò»µ¶Á÷".."¡¿"
				str1 = "¡¾".."ÉÙÖ÷".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."Ò»µ¶Á÷ÉÙÖ÷".."¡¿", M_Red, size*0.8)								
			elseif MPPD(id) == 20 and match_ID(id,523) then	
				str = "¡¾".."Ñ©Óğ×Ú".."¡¿"
				str1 = "¡¾".."×ÚÖ÷·òÈË".."¡¿"
				color = M_Red
				--DrawString(bx*30,by*70, "¡¾".."×ÚÖ÷·òÈË".."¡¿", M_Red, size*0.8)										
			elseif MPPD(id) == 24 and match_ID(id,525) then	
				str = "¡¾".."Ò¹ÓêÂ¥".."¡¿"
				str1 = "¡¾".."É±ÊÖ½ÌÍ·".."¡¿"
				color = M_Red
			elseif MPPD(id) == 23 and match_ID(id,637) then	
				str = "¡¾".."±³áÍ¾ü".."¡¿"
				str1 = "¡¾".."¾üÊ¦".."¡¿"
				color = M_Red	
			elseif MPPD(id) == 20 and match_ID(id,745) then	
				str = "¡¾".."Ñ©Óğ×Ú".."¡¿"
				str1 = "¡¾".."Ì«ÉÏÊ¦×ğ".."¡¿"
				color = M_Red		
			elseif MPPD(id) == 26 and match_ID(id,754) then	
				str = "¡¾".."ÔÆÃÎ½§".."¡¿"
				str1 = "¡¾".."Íò»¨Ö®Ö÷".."¡¿"
				color = M_Red			
			else
				str = "¡¾"..mptype.."¡¿"
				str1 = "¡¾"..mpdj.."¡¿"
				color =  M_DeepSkyBlue
				--DrawString(bx*30,by*70, "¡¾"..mptype..mpdj.."¡¿", M_DeepSkyBlue, size*0.8)
			end
		else
			str = "¡¾½­ºşÈËÊ¿¡¿"
			str1 = "¡¾ÎŞ¡¿"
			color = C_ORANGE
		end
		DrawString(bx*55,by*70, "ËùÊôÃÅÅÉ£º"..str, color, size)
		DrawString(bx*55,by*70+size+5, "ÃÅÅÉÎ»½×£º"..str1, color, size)
	else
		local str = "¡¾½­ºşÈËÊ¿¡¿"
		local str1 = "¡¾ÎŞ¡¿"
		local color = C_ORANGE
		DrawString(bx*55,by*70, "ËùÊôÃÅÅÉ£º"..str, color, size)
		DrawString(bx*55,by*70+size+5, "ÃÅÅÉÎ»½×£º"..str1, color, size)
	end
		local ch = nil
		local chcl = C_CYGOLD
		--local fj = {[0] = {"´«Ëµ",C_ORANGE},{"×ÚÊ¦",M_DarkRed},{"ºÀÏÀ",C_RED},{"Ò»Á÷",M_Pink},{"¶şÁ÷",M_Pink},{"ÈıÁ÷",M_Blue},{"µÜ×Ó",M_LightBlue},{"²ËÄñ",C_CYGOLD}}

        --local fjstr = "¡¾"..fj[p["³©Ïë·Ö½×"]][1].."¡¿"
        local nametre = p["ĞÕÃû"]
        local djstr = p["µÈ¼¶"].."¼¶"
        if id == 0 and (JY.Base['±ê×¼'] == nil or JY.Base['±ê×¼'] < 1 ) and JXPD(id,JY.Base['³©Ïë'],1) then
        	djstr = p["µÈ¼¶"].."¼¶"..'¡¾¾õĞÑ¡¿'
        elseif id ~= 0 and JXPD(id,id,1) then
        	djstr = p["µÈ¼¶"].."¼¶"..'¡¾¾õĞÑ¡¿'	
        end
        --local namex = CC.ScreenW/2-string.len(fjstr..nametre..djstr)/4*size
        --local fjx = namex + string.len(nametre)/2*size
       -- local djx = fjx + string.len(fjstr)/2*size
		-- DrawString(fjx, dx*24, fjstr, fj[JY.Person[id]["³©Ïë·Ö½×"]][2], size*0.8)
		-- DrawString(namex, dx*20, nametre, C_CYGOLD, size)		
		-- DrawString(djx, dx*24, djstr, C_CYGOLD, size*0.8)
   --ÈËÎïĞÕÃû
   --DrawString(bx*280,by*70,name(id),C_WHITE,size)
	   DrawString(bx*150,by*10,name(id)..""..djstr,M_Yellow,size*1.3)--..fjstr
	   local tfx1 = bx*55
	   local fty1 = by*79+50
	   local fty2 = 0
	   local fty3 = 0
	   --Ö÷½Ç
	   if id == 0 then
			local main_tf;
			--±êÖ÷
			if JY.Base["±ê×¼"] > 0 then
				main_tf = ZJTF[JY.Base["±ê×¼"]]
			--ÌØÊâ
			elseif JY.Base["ÌØÊâ"] > 0 then
				main_tf = " "
			--³©Ïë
			elseif JY.Base["³©Ïë"] > 0 then
				if RWTFLB[p["´úºÅ"]] ~= nil then
					main_tf = RWTFLB[p["´úºÅ"]]
				end
			end
			if main_tf ~= nil then
				DrawString(tfx1, fty1,"Ò»°ã³ÆºÅ£º".."¡¾"..main_tf.."¡¿", C_ORANGE, size)
			--else
				--main_tf = "ÎÔÁú·ü·ï"
				--DrawString(tfx1 -string.len(main_tf)/4*size*0.8, fty1,"Ò»°ã³ÆºÅ£º"..main_tf , C_ORANGE, size)
			fty2 = size + 5
			end
			
		end

		--ÆÕÍ¨½ÇÉ«Ìì¸³
		if id ~= 0 and RWTFLB[id] ~= nil then
			--DrawString(x1-7, y1 + h * (i)-142,RWTFLB[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"Ò»°ã³ÆºÅ£º".."¡¾".. RWTFLB[id].."¡¿", C_ORANGE, size)
			fty2 = size	+5	
		end
	  
		fty1 = fty1+fty2
		--Ö÷½Ç³ÆºÅ
		if id == 0 then
			local main_ch;
			--±êÖ÷
			if JY.Base["±ê×¼"] > 0 then
				if p["ÁùÈç¾õĞÑ"] == 0 then
					main_ch = "½­ºşĞ¡ÏºÃ×"
				else
					main_ch = "¾õĞÑÖ®²ÔÁú"
				end
			--ÌØÊâ
			elseif JY.Base["ÌØÊâ"] > 0 then
				main_ch = ''--TSTF[JY.Base["ÌØÊâ"]]
			--³©Ïë
			elseif JY.Base["³©Ïë"] > 0 then
				if RWWH[JY.Base["³©Ïë"]] ~= nil and JY.Base["³©Ïë"] ~= 35 and JY.Base["³©Ïë"] ~= 38 and JY.Base["³©Ïë"] ~= 49 
				and JY.Base["³©Ïë"] ~= 626 then
					main_ch = RWWH[JY.Base["³©Ïë"]]
				elseif JY.Base["³©Ïë"] == 35 then
					if JY.Person[id]["¸öÈË¾õĞÑ"] >= 2 then
						main_ch = RWWH["35"]
						--DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)	
					elseif JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
						main_ch = RWWH[35]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
						 --DrawString(tfx1 -string.len(RWWH["35"])/4*size*0.8, by*122,  RWWH["35"], C_ORANGE, size)		
					end
				elseif JY.Base["³©Ïë"] == 38 then
					if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
						main_ch =  RWWH["38"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
					    --DrawString(tfx1 -string.len(RWWH["38"])/4*size*0.8, by*122,  RWWH["38"], C_ORANGE, size)		
					end
				elseif JY.Base["³©Ïë"] == 49 then
					if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
						main_ch = RWWH["49"]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH["49"])/4*size*0.8, by*122,  RWWH["49"], C_ORANGE, size)	
					else
						main_ch = RWWH[49]
						--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
					   --DrawString(tfx1 -string.len(RWWH[49])/4*size*0.8, by*122,  RWWH[49], C_ORANGE, size)	
					end
				elseif JY.Base["³©Ïë"] == 626 then
					if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
						main_ch = RWWH["626"]
						--DrawString(tfx1 -string.len(RWWH["626"])/4*size*0.8, by*122,  RWWH["626"], C_ORANGE, size)
						--DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
					else
					main_ch = RWWH[626]
					--	DrawString(x1-7, y1 + h * (i)-100, RWWH[626], C_CYGOLD, size*0.8)
					 --DrawString(tfx1 -string.len(RWWH[626])/4*size*0.8, by*122,  RWWH[626], C_ORANGE, size)		
					end
			
				end
			end
			if main_ch ~= nil then
				--DrawString(x1-7, y1 + h * (i)-100, main_ch, C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..main_ch.."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--ÆäËûÈË³ÆºÅ
		if RWWH[id] ~= nil and id ~= 35 and id ~= 38 and id ~= 49 then
			--DrawString(x1-7, y1 + h * (i)-100, RWWH[id], C_CYGOLD, size*0.8)
		    DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[id].."¡¿", C_ORANGE, size)	
			fty3 = size+5
		end

		--Áîºü³å
		if id == 35 then
			if JY.Person[id]["¸öÈË¾õĞÑ"] >= 2 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["35"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["35"].."¡¿", C_ORANGE, size)
				fty3 = size
			elseif JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH[35], C_CYGOLD, size*0.8)
				 DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[35].."¡¿", C_ORANGE, size)
				fty3 = size+5
			end
		end

		--ĞéÖñ
		if id == 49 then
			if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["49"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["49"].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			else
				--DrawString(x1-7, y1 + h * (i)-100, RWWH[49], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[49].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	  
		--Ê¯ÆÆÌì
		if id == 38 then
			if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["38"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["38"].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		
		--¶«·½Òà
		if id == 457 then
			if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["457"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["457"].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end	
		
		--¹ùÏå
		if id == 626 then
			if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["626"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH["626"].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
		--Ïô°ëºÍ
		if id == 189 then
			if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
			--	DrawString(x1-7, y1 + h * (i)-100, RWWH["189"], C_CYGOLD, size*0.8)
				  DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[189].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end	 
		--ÃçÈË·ï
		if id == 633 then
			if JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				--DrawString(x1-7, y1 + h * (i)-100, RWWH["633"], C_CYGOLD, size*0.8)
				DrawString(tfx1, fty1,"Ìì¸³³ÆºÅ£º".."¡¾"..RWWH[633].."¡¿", C_ORANGE, size)	
				fty3 = size+5
			end
		end
	fty1 = fty1 + fty3
	local fj = {[0] = {"´«Ëµ",C_ORANGE},{"×ÚÊ¦",M_DarkRed},{"ºÀÏÀ",C_RED},{"Ò»Á÷",M_Pink},{"¶şÁ÷",M_Pink},{"ÈıÁ÷",M_Blue},{"µÜ×Ó",M_LightBlue},{"²ËÄñ",C_CYGOLD}}
    local fjstr = "¡¾"..fj[p["³©Ïë·Ö½×"]][1].."¡¿"
	DrawString(tfx1, fty1,"ĞŞÎª³ÆºÅ£º"..fjstr, fj[p["³©Ïë·Ö½×"]][2], size)
   --ÈËÎïËµÃ÷
    -- --ÈËÎïÌì¸³2
   if psx(id,'Ìì¸³Íâ¹¦1') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then 
         DrawString(bx*420,by*60+0*h,"Ìì¸³Íâ¹¦£º"..JY.Wugong[psx(id,'Ìì¸³Íâ¹¦1')]['Ãû³Æ'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+0*h,"Ìì¸³Íâ¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   
   if psx(id,'Ìì¸³Íâ¹¦2') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then JY.Wugong[psx(id,'Ìì¸³Íâ¹¦2')]['Ãû³Æ']
         DrawString(bx*420,by*60+1*h,"Ìì¸³Íâ¹¦£º"..JY.Wugong[psx(id,'Ìì¸³Íâ¹¦2')]['Ãû³Æ'],M_YellowGreen,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+1*h,"Ìì¸³Íâ¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'Ìì¸³ÄÚ¹¦') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then 
         DrawString(bx*420,by*60+2*h,"Ìì¸³ÄÚ¹¦£º"..JY.Wugong[psx(id,'Ìì¸³ÄÚ¹¦')]['Ãû³Æ'],M_Red,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+2*h,"Ìì¸³ÄÚ¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   if psx(id,'Ìì¸³Çá¹¦') > 0 then 
    --  if CC.TF[psx(id,'Ìì¸³2')] ~= nil then 
         DrawString(bx*420,by*60+3*h,"Ìì¸³Çá¹¦£º"..JY.Wugong[psx(id,'Ìì¸³Çá¹¦')]['Ãû³Æ'],M_Yellow,size1)
	--	 i = i + 1
	--  end
	else
		DrawString(bx*420,by*60+3*h,"Ìì¸³Çá¹¦£ºÎŞ",C_WHITE,size1)
	--	 i = i + 1
   end
   
   local tfid;
		--Ö÷½Ç
	if id == 0 then
		--±êÖ÷
		if JY.Base["±ê×¼"] > 0 then
			tfid = 0--546 + JY.Base["±ê×¼"]
		--ÌØÊâ
		elseif JY.Base["ÌØÊâ"] > 0 then
			tfid = ''
		--³©Ïë
		else
			tfid = JY.Base["³©Ïë"]
			--³©ÏëÔ¬³ĞÖ¾
			--[[if tfid == 54 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "54-1"
			--³©ÏëÊ¯ÆÆÌì
			elseif tfid == 38 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "38-1"
			--³©Ïë¹ùÏå
			elseif tfid == 626 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "626-1"				
			end]]
		end
	--¶ÓÓÑ
	else
		tfid = id
		--³©ÏëÔ¬³ĞÖ¾
			--[[if tfid == 54 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "54-1"
			--³©ÏëÊ¯ÆÆÌì
			elseif tfid == 38 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "38-1"
			--³©Ïë¹ùÏå
			elseif tfid == 626 and JY.Person[id]["¸öÈË¾õĞÑ"] >= 1 then
				tfid = "626-1"				
			end]]
	end
	if psx(id,'Ìì¸³Íâ¹¦1') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³Íâ¹¦1'
	end	 
	if psx(id,'Ìì¸³Íâ¹¦2') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³Íâ¹¦2'
	end
	if psx(id,'Ìì¸³ÄÚ¹¦') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³ÄÚ¹¦'
	end	 
	if psx(id,'Ìì¸³Çá¹¦') >= 0 then 
		lb[1][#lb[1]+1] = 'Ìì¸³Çá¹¦'
	end
	local me = {}
	local me1 = {}
	local me2 = {}
	local me3 = {}
	local me4 = {}
	local mid = tfid 
	local bz = {'È­','Ö¸','½£','µ¶','Ææ','î¸','ÈÊ','Ò½','¶¾','æÎ','Ä§','ÎŞ'}
	if JY.Base["±ê×¼"] > 0 and id == 0 then 
		mid = bz[JY.Base["±ê×¼"]]
	end
	
	local row = 0
	if TFJS[mid] ~= nil then
		for i = 1, #TFJS[mid] do
			me1[#me1+1] = TFJS[mid][i]
			if i == #TFJS[mid] then 
				me1[#me1+1] = "£Î"
				
			end
		end
	else
		me1[#me1+1] = '£ÄÎŞ¸öÈËÌì¸³'
	end

	if CC.PTF[tfid] ~= nil then -- and tfid ~= 0
		for i,v in pairs(CC.PTF[tfid]) do 
			if v == 1 then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
		   elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
			end
		end
	end
	
	if id == 0 then 
		for i,v in pairs(CC.PTF[id]) do
			if v == 1 then
				if CC.PTFSM[i] ~= nil then 
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
			elseif v == 2 and JXPD(id,id,1)then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end
		   elseif v == 3 and JXPD(id,id,2) then 
				if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
				end	
			end
		end
		-- for i = 1, #ZJZSJS do
			-- me[#me+1] = ZJZSJS[i]
			-- if i == #ZJZSJS then 
				-- me[#me+1] = "£Î"
				
			-- end
		-- end	
	end
	
	if id == 0 and JY.Base["³©Ïë"] ==52 then
		me1[#me1+1] = "£Ò".."ÆßÊ®¶ş±ä£º"
		if TFJS[JY.Person[0]["´úºÅ"]] ~= nil then
			for i = 1, #TFJS[JY.Person[0]["´úºÅ"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["´úºÅ"]][i]
				if i == #TFJS[JY.Person[0]["´úºÅ"]] then 
				me1[#me1+1] = "£Î"
				
				end
			end
		end
		if CC.PTF[JY.Person[0]["´úºÅ"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[0]["´úºÅ"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
						end
				end
			end
		end
	end
	
	if id == 512 then
		me1[#me1+1] = "£Ò".."ĞÄÄ§£º"
		if TFJS[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] ~= nil then
			for i = 1, #TFJS[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] do
				me1[#me1+1] = TFJS[JY.Person[0]["´úºÅ"]][i]
				if i == #TFJS[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] then 
				me1[#me1+1] = "£Î"
				
				end
			end
		end
		if CC.PTF[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]] ~= nil then 
			for i,v in pairs(CC.PTF[JY.Person[512]["ÔİÊ±ÎŞÓÃ"]]) do 
				if v == 1 then 
						if CC.PTFSM[i] ~= nil then
					--me[#me+1] = "£Î"
					me[#me+1] = '£Ì'..CC.PTFSM[i][1]
					me[#me+1] = '£×'..CC.PTFSM[i][2]
					me[#me+1] = "£Î"
					
						end
				end
			end
		end
	end
	if BOSSZT[mid] ~= nil then
		for i = 1, #BOSSZT[mid] do 
			me2[#me2+1] = BOSSZT[mid][i]
			--if i == #BOSSZT[mid] then
			--me2[#me2+1] = "£Î"
			--end
		end
	end
	if ZL[mid] ~= nil then
		for i = 1, #ZL[mid] do 
			me3[#me3+1] = ZL[mid][i]
			--if i == #ZL[mid] then
			--me3[#me3+1] = "£Î"
			--end
		end
	end
	if FY[mid] ~= nil then
		for i = 1, #FY[mid] do 
			me4[#me4+1] = FY[mid][i]
			--if i == #FY[mid] then
			--me4[#me4+1] = "£Î"
			--end
		end
	end
	local size = CC.DefaultFont
	local tfjsbh = 0
	local tfjswz = {}
	local tfjsbh1 = 0
	local tfjswz1 = {}
	local bossztwz = {}
	local rwzlwz = {}
	local fyjywz = {}
	local pdl = true
	for k = 1, #me1 do
		--local tfstr = me[k]
		local tfstr1 = me1[k]
		local h1 = 0
		-- if #tfstr > math.floor(bx*345/size2)+5 then
			-- --	i = i + 1
				-- row = row + 1
		-- end		
		--if string.sub(tfstr,1,2) == "£Î" then
			--row = row + 1
		--else
		if string.sub(tfstr1,1,2) == '£Ä' and pdl then
			tjm(bx*420,by*155+i*h,tfstr1,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			
			--h1=--tfstr = tfstr .. "£Î"
		--	i = i + 1
			lb[1][#lb[1]+1] = tfstr1
			
			pdl = false
		end
		if string.sub(tfstr1,1,2) == '£×' or string.sub(tfstr1,1,2) == '£Ú' then
		--	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
		--	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--row = row + 1
			--DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
			--tjm(bx*420,by*155+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			--tfjsbh1 = tfjsbh1 + 1
			if tfjswz1[mid] == nil then
				tfjswz1[mid] = tfstr1
			else
				tfjswz1[mid] = tfjswz1[mid] .."*".. tfstr1
			end	
			--h1=--tfstr = tfstr .. "£Î"
		--	i = i + 1
			--lb[1][#lb[1]+1] = tfstr
		end
		-- row = row + 1
		-- i = i + 0.33
	end
	for k = 1, #me2 do
		local tfstr = me2[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '£Ç' then
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			lb[1][#lb[1]+1] = tfstr
		end
		if string.sub(tfstr,1,2) == '£×' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--bossztwz[#bossztwz+1] = tfstr
		end
		--row = row + 1
		i = i + 0.5
	end
	for k = 1, #me3 do
		local tfstr = me3[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '£Ò' then
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			lb[1][#lb[1]+1] = tfstr
			--row = row + 1

		end
		if string.sub(tfstr,1,2) == '£×' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--rwzlwz[#rwzlwz+1] = tfstr
		end
		i = i + 0.5
	end
	for k = 1, #me4 do
		local tfstr = me4[k]
		local h1 = 0
		if string.sub(tfstr,1,2) == '£Ç' then
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			lb[1][#lb[1]+1] = tfstr
			
		end
		if string.sub(tfstr,1,2) == '£×' then
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--fyjywz[#fyjywz+1] = tfstr
		end
		--row = row + 1
		i = i + 0.5
	end
	for k = 1, #me do
		local tfstr = me[k]
		--local tfstr1 = me1[k]
		local h1 = 0
		-- if #tfstr > math.floor(bx*345/size2)+5 then
			-- --	i = i + 1
				-- row = row + 1
		-- end		
		--if string.sub(tfstr,1,2) == "£Î" then
			--row = row + 1
		--else
		
		
		if string.sub(tfstr,1,2) == '£Ì' then
		--	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
		--	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--row = row + 1
			--DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
			tjm(bx*420,by*175+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			
			--h1=--tfstr = tfstr .. "£Î"
		--	i = i + 1
			lb[1][#lb[1]+1] = tfstr
		end
		if string.sub(tfstr,1,2) == '£×' then
		--	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
		--	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
			--row = row + 1
			--DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
			--tjm(bx*420,by*155+i*h,tfstr,C_WHITE,size1,math.floor(bx*345/size1)+2,h)
			--tfjsbh = tfjsbh + 1
			tfjswz[#tfjswz+1] = tfstr
			--h1=--tfstr = tfstr .. "£Î"
		--	i = i + 1
			--lb[1][#lb[1]+1] = tfstr
		end
		row = row + 1
		i = i + 0.33
	end
   --if psx(id,'Ìì¸³Íâ¹¦1') > 0 or psx(id,'Ìì¸³Íâ¹¦2') > 0 or psx(id,'Ìì¸³ÄÚ¹¦') > 0 or psx(id,'Ìì¸³Çá¹¦') > 0  then 
	lb1[#lb1+1] = 1
	lb2[1] = #lb1
	lb2[2] = lb2[1]
   --end
   -- if TFJS[id] ~= nil then 
	  -- for i = 1,#TFJS[id]  do
		-- tjm9(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
	-- --	DrawString(bx*30,by*80+i*h,TFJS[id][i],C_WHITE,size)
	  -- end
   
      
   -- end
   
   --tjm9(bx*30,by*80+h,'¡¡¡¡ÆÆÏşËÄ´ó»¤·¨Ö®Ò»£¬ÉÃ³¤Ê¹ÓÃ½£·¨£¬³£ÄêÓÎµ´ÔÚ½­ºş£¬ÉÙÓĞÈËÖªÏşÆäÕæÃæÄ¿',C_WHITE,size2,math.floor(bx*345/size2)-1,h)
   
   -- --ÈËÎïÌì¸³1
   -- if CC.TG[id] ~= nil then 
    -- --  if CC.TF[psx(id,'Ìì¸³')] ~= nil then 
         
	-- --  end
	-- --	say("ÈËÎïÌì¸³1",0,1)
		-- for k,v in pairs(CC.TG[id]) do 
			-- if v == 1 then 
			-- --	say("ÈËÎïÌì¸³"..k,0,1)
				-- if CC.PTFSM[k] ~= nil then
					-- -- me[#me+1] = '£Ì'..CC.PTFSM[k][1]
					-- -- me[#me+1] = '£×'..CC.PTFSM[k][2]
					-- -- me[#me+1] = "£Î"
					
					-- DrawString(bx*420,by*60+i*h,CC.PTFSM[k][1],C_WHITE,size1)
					-- i = i + 1
					
				-- end
			-- end
		-- end
		
   -- end
	
   
   --×°±¸Ôö¼ÓµÄÊôĞÔ
		local str_gain, def_gain, agi_gain = 0, 0, 0
		local fb = 1
		if match_ID(id,546) then
			fb = 2
		end
		if p["ÎäÆ÷"] > -1 then
			if JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"] > 0 then
				str_gain = str_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*10 + JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"] < 0 then
				str_gain = str_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*10 - JY.Thing[p["ÎäÆ÷"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"] > 0 then
				def_gain = def_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*10 + JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"] < 0 then
				def_gain = def_gain + JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*10 - JY.Thing[p["ÎäÆ÷"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*10*fb + JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2*fb
			elseif JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*10*fb - JY.Thing[p["ÎäÆ÷"]]["¼ÓÇá¹¦"]*(JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"]-1)*2*fb
			end
		end
		if p["×øÆï"] > -1 then
			if JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"] > 0 then
				str_gain = str_gain + JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*10 + JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"] < 0 then
				str_gain = str_gain + JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*10 - JY.Thing[p["×øÆï"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"] > 0 then
				def_gain = def_gain + JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*10 + JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"] < 0 then
				def_gain = def_gain + JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*10 - JY.Thing[p["×øÆï"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*10*fb + JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2*fb
			elseif JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*10*fb - JY.Thing[p["×øÆï"]]["¼ÓÇá¹¦"]*(JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"]-1)*2*fb
			end
		end
		if p["·À¾ß"] > -1 then
			local n = 2
			if MPPD(id) == 2 then
				n=4
			end	
			if JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"] > 0 then
				str_gain = str_gain + JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*10 + JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2
			elseif JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"] < 0 then
				str_gain = str_gain + JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*10 - JY.Thing[p["·À¾ß"]]["¼Ó¹¥»÷Á¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"] > 0 then
				def_gain = def_gain + JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*10 + JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*n
			elseif JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"] < 0 then
				def_gain = def_gain + JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*10 - JY.Thing[p["·À¾ß"]]["¼Ó·ÀÓùÁ¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2
			end
			if JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"] > 0 then
				agi_gain = agi_gain + JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*10*fb + JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2*fb
			elseif JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"] < 0 then
				agi_gain = agi_gain + JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*10*fb - JY.Thing[p["·À¾ß"]]["¼ÓÇá¹¦"]*(JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"]-1)*2*fb
			end
		end
		--Ò×½î¾­¼Ó³É
		local level = 0
		local gj = 0
		local qg = 0
		local fy = 0
		local str1_gain, def1_gain, agi1_gain = psx(id,"¹¥»÷Á¦"), psx(id,"·ÀÓùÁ¦"), psx(id,"Çá¹¦")
		local str2_gain, def2_gain, agi2_gain = psx(id,"¹¥»÷Á¦"), psx(id,"·ÀÓùÁ¦"), psx(id,"Çá¹¦")
        --Õ½³¡¸÷ÖÖ¼Ó³É 
        if JY.Status == GAME_WMAP then
			--for i = 0, WAR.PersonNum-1 do
				--if WAR.Person[i]["ÈËÎï±àºÅ"] == id then
					str2_gain, def2_gain, agi2_gain = Atk(t),Def(t),Qg(t)
				--end
			--end	
			------------×ÊÖÊ¼Ó³É---------------
			gj = limitX((JY.Person[id]['ÄÚÁ¦'] - JY.Person[id]['×ÊÖÊ']*10)/60,0)
			str1_gain = str1_gain + gj
			fy = limitX((JY.Person[id]['ÄÚÁ¦'] - JY.Person[id]['×ÊÖÊ']*10)/60,0)
			def1_gain = def1_gain + fy
			qg = limitX((JY.Person[id]['ÄÚÁ¦'] - JY.Person[id]['×ÊÖÊ']*10)/60,0)
			agi1_gain = agi1_gain + qg
			------------×ÛºÏ¼Ó³É---------------
			for i =1,JY.Base["Îä¹¦ÊıÁ¿"] do               -- ²éÕÒµ±Ç°ÒÑ¾­Á¶³ÉÎä¹¦µÈ¼¶
				 if JY.Person[id]["Îä¹¦" .. i]==108 then
					if JY.Person[id]["Îä¹¦µÈ¼¶" .. i] > 900 then
						level = 10
					else	
						level=math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. i] /100)+1;	
					end	
					if level >= 1 then
						gj = math.modf (JY.Person[id]["¹¥»÷Á¦"]*0.03*(level))
						str1_gain = str1_gain +gj
						fy = math.modf(JY.Person[id]["·ÀÓùÁ¦"]*0.03*(level))
						def1_gain = def1_gain +fy
						qg = math.modf(JY.Person[id]["Çá¹¦"]*0.03*(level))
						agi1_gain = agi1_gain +qg
						break
					end	
				end		
			end
			if match_ID(id, 9930) or match_ID(id,9738) then				--ºÚ¼¶¸¡ÍÀ
				gj = math.modf(JY.Person[id]["¹¥»÷Á¦"]*0.6)
				str1_gain = str1_gain +gj
				fy = math.modf(JY.Person[id]["·ÀÓùÁ¦"]*0.6)
				def1_gain = def1_gain +fy
				qg = math.modf(JY.Person[id]["Çá¹¦"]*0.6)
				agi1_gain = agi1_gain +qg	
			end
			if match_ID(id, 604) or match_ID(id, 9805) then
				str1_gain = str1_gain + TrueYJ(id)
				def1_gain = def1_gain +TrueYJ(id)
			end
			--ÎäÄÂÒÅÊé ±ê¼ÇĞŞ¸Ä
			if Curr_NG(id,199) then
				local sz=math.modf(JY.Person[id]["ÊµÕ½"]/2)
				if not inteam(id) then
					sz=1000
				end
				str1_gain = str1_gain +sz
				def1_gain = def1_gain +sz
			end
			--»ôÇàÍ©£¬ÎÒ·½ÈËÊıÈËÔ½¶à£¬·ÀÓùÔ½¸ß    
            if match_ID(id, 74) then
				local hqtgj= 0
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == WAR.Person[i]["ÎÒ·½"] then
                     str1_gain =  str1_gain +10
					 def1_gain =  def1_gain+10
                    end		
                end	
            end		 
            --ÁÖÊâµĞ·½ÈËÊıÈËÔ½¶à£¬·ÀÓùÔ½¸ß    
            if match_ID(id, 508) then
                for j = 0, WAR.PersonNum - 1 do
                    if WAR.Person[j]["ËÀÍö"] == false and WAR.Person[j]["ÎÒ·½"] == false  then
                    def1_gain =  def1_gain+10
                    str1_gain =  str1_gain +10
                    end		
                end	
            end
			-----------¹¥»÷¼Ó³É-----------
			--¶ÓÓÑ¹¥»÷Á¦¼Ó³É
			for i,v in pairs(CC.AddAtk) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
							str1_gain = str1_gain + v[3]
						end
					end
				end
			end
			if WAR.PD['Ñª´ã'][id] ~= nil then
				str1_gain = str1_gain + WAR.PD['Ñª´ã'][id]
			end
			if PersonKF(id,263) then
				if Curr_NG(id,263) then
					str1_gain = math.modf(str1_gain*1.1)
				else
					str1_gain = math.modf(str1_gain*1.05)
				end
			end	
			if match_ID(id, 112) and WAR.XYS > 0 then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡¹¥»÷*1.5
				str1_gain = math.modf(str1_gain*1.5)
			end
			if WAR.PD['Î÷¹Ïµ¶¡¤ÌìÈË'][id] ~= nil then 
				str1_gain = math.modf(str1_gain*1.5)
			end
			---------------·ÀÓù¼Ó³É--------------
			--¶ÓÓÑ·ÀÓùÁ¦¼Ó³É
			for i,v in pairs(CC.AddDef) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
							def1_gain = def1_gain + v[3]
						end
					end
				end
			end
			if PersonKF(id,264) then
				if Curr_NG(id,264) then
					def1_gain = math.modf(def1_gain*1.1)
				else
					def1_gain = math.modf(def1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡·ÀÓù*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end	
			if  WAR.PD['Î÷¹Ïµ¶¡¤ÌìÈË'][id] ~= nil then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡·ÀÓù*1.5
				def1_gain = math.modf(def1_gain*1.5)
			end
			-------------Çá¹¦¼Ó³É--------------
			--¶ÓÓÑÇá¹¦¼Ó³É
			for i,v in pairs(CC.AddSpd) do
				if match_ID(id, v[1]) then
					for wid = 0, WAR.PersonNum - 1 do
						if match_ID(WAR.Person[wid]["ÈËÎï±àºÅ"], v[2]) and WAR.Person[wid]["ËÀÍö"] == false then
							agi1_gain = agi1_gain + v[3] 
						end
					end
				end
			end	
			if WAR.YWDJ[id] ~= nil and Curr_QG(id, 186) then    --Ò»Î­¶É½­Ôö¼ÓÇá¹¦
			   agi1_gain = agi1_gain + WAR.YWDJ[id]	
			end
			--Çá¹¦Ç¿»¯¼Ó³É
			if JY.Person[id]["Ö÷ÔËÇá¹¦"] > 0 and JY.Person[id]["³©Ïë·Ö½×"] < 2 then
				qg = math.modf(JY.Person[id]["Çá¹¦"]*0.3)
				agi1_gain = agi1_gain +qg
			elseif JY.Person[id]["Ö÷ÔËÇá¹¦"] > 0 and JY.Person[id]["³©Ïë·Ö½×"] < 4 then
				qg = math.modf(JY.Person[id]["Çá¹¦"]*0.15)
				agi1_gain = agi1_gain +qg
			end
			if PersonKF(id,259) then
				if Curr_NG(id,259) then
					agi1_gain = math.modf(agi1_gain*1.1)
				else
					agi1_gain = math.modf(agi1_gain*1.05)
				end
			end
			if match_ID(id, 112) and WAR.XYS > 0 then	--ÏôÔ¶É½É±ÆÆÀÇ»ù´¡Çá¹¦*1.5
				agi1_gain = math.modf(agi1_gain*1.5)
			end
			if WAR.PD['Î÷¹Ïµ¶¡¤ÌìÈË'][id] ~= nil then 
				agi1_gain = math.modf(agi1_gain * 1.5)
			end
			if MPPD(id) == 20 or match_ID(id,514) then
				agi1_gain = math.modf(agi1_gain*2)
			end
		end
	if str1_gain ~= nil and str1_gain > 0 then
		str1_gain = limitX(str1_gain,0,999+JY.Base["ÖÜÄ¿"])
	end	
    if def1_gain ~= nil and def1_gain > 0 then
		def1_gain = limitX(def1_gain,0,999+JY.Base["ÖÜÄ¿"])
	end	
    if agi1_gain ~= nil and agi1_gain > 0 then
		agi1_gain = limitX(agi1_gain,0,999+JY.Base["ÖÜÄ¿"])
	end
   --×°±¸ÏÔÊ¾
	local pyl = -40
	lib.LoadPNG(91,166*2,bx*450+pyl,by*470,1)
   
	if p["ÎäÆ÷"] > -1 then
		lib.PicLoadCache(2,p["ÎäÆ÷"] * 2,bx*450+pyl,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl,by*470,1)
		DrawString(bx*450+pyl,by*470, "LV"..JY.Thing[p["ÎäÆ÷"]]["×°±¸µÈ¼¶"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl,by*470+75, JY.Thing[p["ÎäÆ÷"]]["Ãû³Æ"],C_RED , size*0.5)

	end
	if p["·À¾ß"] > -1 then
		lib.PicLoadCache(2,p["·À¾ß"] * 2,bx*450+pyl+75,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+75,by*470,1)
		DrawString( bx*450+pyl+78,by*470, "LV"..JY.Thing[p["·À¾ß"]]["×°±¸µÈ¼¶"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+78,by*470+75, JY.Thing[p["·À¾ß"]]["Ãû³Æ"], C_ORANGE, size*0.5)
	end		
	if p["×øÆï"] > -1 then
		lib.PicLoadCache(2,p["×øÆï"] * 2,bx*450+pyl+150,by*470,1,0,0,-1,-1,0,0,72)
		lib.PicLoadCache(92,58*2,bx*450+pyl+150,by*470,1)
		DrawString( bx*450+pyl+154,by*470, "LV"..JY.Thing[p["×øÆï"]]["×°±¸µÈ¼¶"], M_DeepSkyBlue, size*0.5)
		DrawString( bx*450+pyl+154,by*470+75, JY.Thing[p["×øÆï"]]["Ãû³Æ"], M_Yellow, size*0.5)
	end
	--Ì××°ÏÔÊ¾
	if (p["ÎäÆ÷"] > -1 and p["·À¾ß"] > -1 and p["×øÆï"] > -1) then
		if p["·À¾ß"]==p["ÎäÆ÷"]+1 and p["×øÆï"]==p["ÎäÆ÷"]+2 then
			local color = C_RED
			local n = Setmeal[p["ÎäÆ÷"]][4]
			if  n==4 or n==7 or n==15 or n==16 or n==2 then
				color = C_ORANGE
			elseif n==21 or n==22 or n==24 or n==26 then
				color = M_DeepSkyBlue
			elseif n==1 or n==3 then
				color = M_Green
			end
			--local n= #ItemInfo[p["ÎäÆ÷"]]
			--say("Êı×é³¤¶È"..#ItemInfo[p["ÎäÆ÷"]],0,1)
			DrawString( bx*450+pyl,by*470+90, string.sub(ItemInfo[p["ÎäÆ÷"]][3], 3 , 12), C_GOLD, size*0.7)
			--tjm(bx*450+pyl,by*470+20+100,"¡ôÌØĞ§£º"..Xguo[Setmeal[p["ÎäÆ÷"]][4]]..'*'.."¡ôÌØĞ§£º"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]].."*".."¡ôÌØĞ§£º"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]].."*".."¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_GOLD,size*0.5,14,size*0.5)
			if n < 5 and n ~= 0 then
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n >= 5 then
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 7 then
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			if n > 9 then
				--DrawString( diyx/5+ax*8-240, diyy/4+ax*3+200+40-20,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2], C_RED, size*0.5)
				DrawString(bx*450+pyl,by*470+20+100, "¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..Xguo[Setmeal[p["ÎäÆ÷"]][4]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+40+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..FJXguo[Setmeal[p["ÎäÆ÷"]][5]], 9 , -1), color, size*0.5)
				DrawString(bx*450+pyl,by*470+60+100,"¡ô"..string.sub(ItemInfo[p["ÎäÆ÷"]][4]..":"..ZqXguo[Setmeal[p["ÎäÆ÷"]][6]], 9 , -1), color, size*0.5)
				tjm(bx*450+pyl,by*470+80+100,"¡ô"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][1]..":"..CC.PTFSM[Setmeal[p["ÎäÆ÷"]][7]][2],C_RED,size*0.5,13,size*0.5)
			end
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2, string.sub(ItemInfo[p["ÎäÆ÷"]][5], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+20,string.sub(ItemInfo[p["ÎäÆ÷"]][7], 5 , -1), M_YellowGreen, size*0.5)
			--DrawString( bx*zb2[3][1]+5-250,by*zb2[3][2]+2+40, string.sub(ItemInfo[p["ÎäÆ÷"]][9], 5 , -1), M_YellowGreen, size*0.5)
		end
	end
   
   
   
   i = 0
   --local wgbh = {'¢ñ','¢ò','¢ó','¢ô','¢õ','¢ö','¢÷','¢ø','¢ù','¢ú','¢û','¢ü','¢ú¢ó','¢ú¢ô','¢ú¢õ'}
   --ÈËÎïÎäÑ§
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,2,180,nil,bx*180)
   --lib.LoadPNG(91,124*2,bx*660+bx*70,by*60+by*25/2,1)
   for k = 1,JY.Base["Îä¹¦ÊıÁ¿"]  do 
       if psx(id,'Îä¹¦'..k) > 0 and JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ'] < 6 then
		----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
	      local lv = limitX(math.modf(psx(id,'Îä¹¦µÈ¼¶'..k)/100),1)+1
		  local lx = JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ']
		  -- lib.LoadPNG(91,(lv+74)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
		  -- lib.LoadPNG(91,(lx+149)*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  	local color = C_WHITE
	  	if wgnlxz(psx(id,'Îä¹¦'..k)) == 0 then
			color = LightPurple
		elseif wgnlxz(psx(id,'Îä¹¦'..k)) == 1 then
			color = C_GOLD
		end	
	  	if psx(id,'Îä¹¦µÈ¼¶'..k) > 900 then
			lib.LoadPNG(91,167*2,bx*660+size1*6,by*60+i*h,1)
		else	
		 	lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h,1)
		end 
		 lib.LoadPNG(91,(lx+74)*2,bx*660+size1*6+bx*50,by*60+i*h,1)
		 DrawString(bx*660,by*60+i*h,k,C_WHITE,size1)
          DrawString(bx*670,by*60+i*h,JY.Wugong[psx(id,'Îä¹¦'..k)]['Ãû³Æ'],color,size1)
		  i = i + 1
		  lb[2][#lb[2]+1] ={ psx(id,'Îä¹¦'..k),k}
	   end
   end
   -- if psx(id,'×óÓÒ»¥²«') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'×óÓÒµÈ¼¶')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'×óÓÒ»¥²«',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '×óÓÒ»¥²«'
	  
   -- end 
   -- if psx(id,'¶·×ª') == 1 then 
      -- local lv = limitX(math.modf(psx(id,'¶·×ªµÈ¼¶')/25),1)
      -- lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- lib.LoadPNG(91,129*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  -- DrawString(bx*660,by*60+i*h,'¶·×ªĞÇÒÆ',C_WHITE,size1)
	  -- i = i + 1
	  -- lb[2][#lb[2]+1] = '¶·×ª'
   -- end 
   
   if #lb[2] > 0 then 
      lb1[#lb1+1] = 2
	  --lb2[2] = lb2[1] + 1
	  lb2[2] = #lb1
   end
   
   i = 0
   --ÈËÎï»ù´¡Îä¹¦
   for k = 1,JY.Base["Îä¹¦ÊıÁ¿"] do 
       if psx(id,'Îä¹¦'..k) > 0 and JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ'] > 5 then 
		--JY.Wugong[JY.Person[id]["Îä¹¦" .. i]]["Îä¹¦ÀàĞÍ"]
	      --local lv = limitX(math.modf(psx(id,CC.Psx[k])/25),1)
		  --lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
		  local lv = limitX(math.modf(psx(id,'Îä¹¦µÈ¼¶'..k)/100),1)+1
		  local lx = JY.Wugong[psx(id,'Îä¹¦'..k)]['Îä¹¦ÀàĞÍ']
		  -- lib.LoadPNG(91,(lv+74)*2,bx*660+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
		  -- lib.LoadPNG(91,(lx+149)*2,bx*660+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
	  	local color = C_WHITE
	  	if wgnlxz(psx(id,'Îä¹¦'..k)) == 0 then
			color = LightPurple
		elseif wgnlxz(psx(id,'Îä¹¦'..k)) == 1 then
			color = C_GOLD
		end	
		  if psx(id,'Îä¹¦µÈ¼¶'..k) > 900 then
			lib.LoadPNG(91,167*2,bx*900+size1*6,by*60+i*h,1)
		else	
		 lib.LoadPNG(91,(lv+149)*2,bx*900+size1*6,by*60+i*h,1)
		end
		  --lib.LoadPNG(91,(lv+149)*2,bx*900+size1*6,by*60+i*h+size1/2,2,240,nil,bx*25)
		  lib.LoadPNG(91,(lx+74)*2,bx*900+size1*6+bx*50,by*60+i*h,1)
		  -- if k <= 7 then
		    -- -- lib.LoadPNG(91,(k+41)*2,bx*900+size1*6+bx*50,by*60+i*h+size1/2,2,240,nil,bx*25)
			 -- lib.LoadPNG(91,(k+41)*2,bx*900+size1*6+bx*50,by*60+i*h+size1/2,1)
		  -- end	 
          DrawString(bx*900,by*60+i*h,k,C_WHITE,size1)
          DrawString(bx*910,by*60+i*h,JY.Wugong[psx(id,'Îä¹¦'..k)]['Ãû³Æ'],color,size1)
		  i = i + 1
		  lb[3][#lb[3]+1] ={ psx(id,'Îä¹¦'..k),k}
	   end
   end

   if lb[3]~=nil and #lb[3] > 0 then
      lb1[#lb1+1] = 3
	  --lb2[3] = lb2[2] + 1
	  lb2[3] = #lb1
   end
   
   lb1[#lb1+1] = 4
   --lb2[4] = lb2[3] + 1
   lb2[4] = #lb1
   lb1[#lb1+1] = 5
   lb2[5] = #lb1
   --lb2[5] = lb2[4] + 1
   --ÈËÎïÔË¹¦
   i = 0
   local yg = {{'ÓÅÏÈÊ¹ÓÃ',1,'Íâ¹¦'},{'Ö÷ÔËÄÚ¹¦',2,'ÄÚ¹¦'},{'ÃÅÅÉ¼¼ÄÜ1',3,'ÄÚ¹¦'},{'Ö÷ÔËÇá¹¦',4,'Çá¹¦'},}
   -- if psx(id,'×óÓÒ»¥²«') == 0 then 
	  -- table.remove(yg,2)
   -- end
   for k = 1,#yg do 
	   local cl =C_GOLD
	   local str = ''
       --if yg[k][2] == 1 then
	   ----lib.LoadPNG(91, 18 * 2 ,dx*500, dy*90 + h * (i), 1)
	    --  lib.LoadPNG(91,160*2,bx*1242,by*60+i*by*48+by*18,1)
		  lib.LoadPNG(91,160*2,bx*1125+size1,by*60+i*bx*48+bx*18-size1,1)
		  if psx(id,yg[k][1]) > 0 then 
		     str = JY.Wugong[psx(id,yg[k][1])]['Ãû³Æ']
		  else 
		     str = 'ÎŞ'..yg[k][3]
			 cl =  C_WHITE
		  end
	      if lb1[cx1] == 4 and page == 2 then 
	         if cx == k then 
		        cl = C_RED
		     end
	      end
		  --DrawString(bx*935-string.len('Î´¿ªÆôµÚ¶şÔË¹¦')/4*size,by*136-size/2,'Î´¿ªÆôµÚ¶şÔË¹¦',C_WHITE,size)
		  DrawString(bx*1233+size1-string.len(str)/4*size1,by*60+i*bx*48+bx*18-size1/2-bx*3,str,cl,size1)
		  i = i + 1
		  lb[4][#lb[4]+1] = yg[k][1]
	   --end
   end
   -- lb[4][#lb[4]+1] = '¼ÓÁ¦'
   -- lib.LoadPNG(91,160*2,bx*1242,by*60+i*bx*48+bx*18,2,240,nil,bx*200)
   -- -- if lb1[cx1] == 4 and cx == #lb[4] and page == 2 then
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'ÄÚÁ¦ÔËÆø£º'..psx(id,'¼ÓÁ¦'),C_RED,size1)
   -- -- else 
      -- -- DrawString(bx*1140+size1,by*60+i*bx*48+bx*18-size1/2,'ÄÚÁ¦ÔËÆø£º'..psx(id,'¼ÓÁ¦'),C_WHITE,size1)
   -- -- end
   
   -- lb[5] = {'ÎäÆ÷','·À¾ß','Í·ÊÎ','ÊÎÆ·','Ğ¬×Ó'}
   -- --ÈËÎï×°±¸
   -- i = 0
   -- for k = 1,#lb[5] do 
       -- lib.LoadPNG(91,160*2,bx*522,by*470+i*by*48+by*18,2,240,nil,bx*200)
	   -- local cl = C_WHITE
	   -- local str = ''
	   -- if psx(id,lb[5][k]) > 0 then 
	      -- str = JY.Thing[psx(id,lb[5][k])]['Ãû³Æ']
	   -- else 
	      -- str = 'ÎŞ'..lb[5][k]
		  -- cl = C_GOLD
	   -- end
	   -- if lb1[cx1] == 5 then 
	      -- if cx == k then 
		     -- cl = C_RED
		  -- end
	   -- end
	   -- DrawString(bx*420+size1,by*470+i*bx*48+bx*18-size1/2,str,cl,size1)
	   -- i = i + 1
   -- end
	local bonus_q,bonus_z,bonus_j,bonus_d,bonus_t = psx(id,"È­ÕÆ¹¦·ò"),psx(id,"Ö¸·¨¼¼ÇÉ"),psx(id,"Óù½£ÄÜÁ¦"),psx(id,"Ë£µ¶¼¼ÇÉ"),psx(id,"ÌØÊâ±øÆ÷")
		
   
   --Îä³£ ÊµÕ½ ¼¯Æø
	local jqz = 0
	local jqz0 = 8
	local jqz1 = 0
	local jqz3 = 0
	local x = JY.Person[id]["Çá¹¦"]
	local jqz2 = 0
    local y = JY.Person[id]["ÄÚÁ¦"]	
	--local x3 = dx*427
	--local y3 = y1
	-- DrawString(x3 , y3,p["ÎäÑ§³£Ê¶"], C_CYGOLD, size*0.7)
     -- if p["ÊµÕ½"] >= 500 then
			-- DrawString(x3, y3+dh, string.format("%s", "¼«"), C_RED, size*0.7)
		-- else
			-- DrawString(x3, y3+dh, string.format("%s", p["ÊµÕ½"]), C_CYGOLD, size*0.7)
		-- end	
	--¼¯ÆøÌõ
	
	local function getnewmove(x)
		if x <= 0 then 
			return 0
		end
		return math.sqrt(x)
	end
	--ÎŞ¾Æ²»»¶£ºÄÚÁ¦¶ÔÓÚÈËÎï¼¯ÆøµÄÓ°Ïìº¯Êı
	local function getnewmove1(a, b)
		local x = (a*2+b)/3
		if x > 6000 then
			return 8 + math.min((x-6000)/1500, 2)
		elseif x > 4000 then
			return 6 + (x-4000)/1200
		elseif x > 2000 then
			return 4 + (x-2000)/1000
		elseif x > 1000 then
			return 2 + (x-1000)/800
		else
			return x/400
		end
	end

	--Õ½³¡Çá¹¦
	local function Qg1(i)

		id = i
		
		local qg = 0 
		
		qg = qg + JY.Person[id]['Çá¹¦']
		
		for i =1,JY.Base["Îä¹¦ÊıÁ¿"] do  
			local level = 0            
			if JY.Person[id]["Îä¹¦" .. i]==108 then
				level = math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. i]/100)+1;
				level = limitX(level/10,0,1)
				qg = qg + math.modf(JY.Person[id]["Çá¹¦"]*0.3*level)	
				break
			end
		end
		
		return qg
	end
	
	jqz = (getnewmove(Qg1(id)) + getnewmove1(JY.Person[id]["ÄÚÁ¦"], JY.Person[id]["ÄÚÁ¦×î´óÖµ"]) + JY.Person[id]["ÌåÁ¦"] / 30)
	
	if JY.Status == GAME_WMAP then
		jqz = (WAR.JQSDXS[id] or 0)
	else	
		jqz = math.modf(jqz)
	end	
   
   
   local cl = M_DeepSkyBlue
   local strcl = '(ÒõÄÚ)'
   if JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 0 then
		cl = M_DeepSkyBlue
		strcl = '(ÒõÄÚ)'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 1 then
		cl = C_ORANGE
		strcl = '(ÑôÄÚ)'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 2 then
		cl = C_CYGOLD
		strcl = '(µ÷ºÍ)'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 3 then
		cl = C_RED
		strcl = '(Ììî¸)'
   end
   --ÈËÎïÊôĞÔ1
   --local nk,dk,hk,bk,xk,fk = 100-nskx(id,100),100-zdkx(id,100),100-zskx(id,100),100-bfkx(id,100),100-lxkx(id,100),100-fxkx(id,100)
  -- if myns(id) then nk = 100 end if myzd(id) then dk = 100 end if myzs(id) then hk = 100 end if mybf(id) then bk = 100 end
  -- if mylx(id) then xk = 100 end if myfx(id) then fk = 100 end
 
   i = 0 
   DrawString(bx*660,by*475,'ÉúÃüÏÖÖµ¡¡ '..psx(id,'ÉúÃü'),M_PaleGreen,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÁ¦ÏÖÖµ¡¡ '..psx(id,'ÄÚÁ¦')..strcl,cl,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÊµÕ½¾­Ñé¡¡ '..p["ÊµÕ½"],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÎäÑ§³£Ê¶¡¡ '..p['ÎäÑ§³£Ê¶'],C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÉË¿¹ĞÔ¡¡ '..nk.."%",C_WHITE,size1)--string.format('%5s',)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÖĞ¶¾¿¹ĞÔ¡¡ '..dk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'×ÆÉÕ¿¹ĞÔ¡¡ '..hk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'±ù·â¿¹ĞÔ¡¡ '..bk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'Á÷Ñª¿¹ĞÔ¡¡ '..xk.."%",C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'·âÑ¨¿¹ĞÔ¡¡ '..fk.."%",C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'¾­Ñé¡¡¡¡'..string.format('%9s',psx(id,'ÊµÕ½¾­Ñé')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'Ç±ÄÜ¡¡¡¡'..string.format('%9s',psx(id,'ÎäÑ§Ç±ÄÜ')),C_WHITE,size1)
   -- i = i + 1
   --ÈËÎïÊôĞÔ1
   --[[ÈËÎïÊôĞÔ1
   i = 0 
   DrawString(bx*660,by*475,'ÉúÃü¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÉúÃü')),M_PaleGreen,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÁ¦¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÄÚÁ¦'))..strcl,cl,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÄÚÉË¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÊÜÉË³Ì¶È')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÖĞ¶¾¡¡¡¡¡¡'..string.format('%5s',psx(id,'ÖĞ¶¾³Ì¶È')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'´ø¶¾¡¡¡¡¡¡'..string.format('%5s',psx(id,'¹¥»÷´ø¶¾')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¿¹¶¾¡¡¡¡¡¡'..string.format('%5s',psx(id,'¿¹¶¾ÄÜÁ¦')),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'Îä³£¡¡¡¡¡¡'..string.format('%5s',p["ÎäÑ§³£Ê¶"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'ÊµÕ½¡¡¡¡¡¡'..string.format('%5s',p["ÊµÕ½"]),C_WHITE,size1)
   i = i + 1
   DrawString(bx*660,by*475+i*h,'¼¯Æø¡¡¡¡¡¡'..string.format('%5s',jqz),C_WHITE,size1)
   i = i + 1
   -- DrawString(bx*660,by*475+i*h,'¾­Ñé¡¡¡¡'..string.format('%9s',psx(id,'ÊµÕ½¾­Ñé')),C_WHITE,size1)
   -- i = i + 1
   -- DrawString(bx*660,by*475+i*h,'Ç±ÄÜ¡¡¡¡'..string.format('%9s',psx(id,'ÎäÑ§Ç±ÄÜ')),C_WHITE,size1)
   -- i = i + 1
   --ÈËÎïÊôĞÔ1]]
   
   
	i = 0 
	DrawString(bx*900,by*475,'×î´óÉúÃü¡¡ '..psx(id,'ÉúÃü×î´óÖµ'),M_PaleGreen,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'×î´óÄÚÁ¦¡¡ '..psx(id,'ÄÚÁ¦×î´óÖµ')..strcl,cl,size1)--string.format('%5s',)
	--i = i + 1--p["È­ÕÆ¹¦·ò"]+
	--DrawString(bx*900,by*475+i*h,'È­ÕÆ¹¦·ò¡¡'..bonus_q,M_YellowGreen,size1)--string.format('%5s',)   ¡ü
	if JY.Status == GAME_WMAP then
		--DrawAttrib("È­ÕÆ¹¦·ò", bx*890+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["È­ÕÆ¹¦·ò"]+
		DrawString(bx*900,by*475+i*h,'È­ÕÆ¹¦·ò¡¡ '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)--..' ¡ü '..TrueQZ(id)-bonus_q
		DrawAttrib("È­ÕÆ¹¦·ò", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["Ö¸·¨¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ö¸·¨¼¼ÇÉ¡¡ '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("Ö¸·¨¼¼ÇÉ", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["Óù½£ÄÜÁ¦"]+
		DrawString(bx*900,by*475+i*h,'Óù½£ÄÜÁ¦¡¡ '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("Óù½£ÄÜÁ¦", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["Ë£µ¶¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ë£µ¶¼¼ÇÉ¡¡ '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("Ë£µ¶¼¼ÇÉ", bx*900+150,by*475+i*h,M_YellowGreen,size1)
		i = i + 1--p["ÌØÊâ±øÆ÷"]+
		DrawString(bx*900,by*475+i*h,'ÆæÃÅ±øÆ÷¡¡ '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
		DrawAttrib("ÌØÊâ±øÆ÷", bx*900+150,by*475+i*h,M_YellowGreen,size1)
	else
		i = i + 1--p["È­ÕÆ¹¦·ò"]+
		DrawString(bx*900,by*475+i*h,'È­ÕÆ¹¦·ò¡¡ '..bonus_q,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["Ö¸·¨¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ö¸·¨¼¼ÇÉ¡¡ '..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["Óù½£ÄÜÁ¦"]+
		DrawString(bx*900,by*475+i*h,'Óù½£ÄÜÁ¦¡¡ '..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["Ë£µ¶¼¼ÇÉ"]+
		DrawString(bx*900,by*475+i*h,'Ë£µ¶¼¼ÇÉ¡¡ '..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
		i = i + 1--p["ÌØÊâ±øÆ÷"]+
		DrawString(bx*900,by*475+i*h,'ÆæÃÅ±øÆ÷¡¡ '..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
	end	
	--[[i = i + 1--p["Ö¸·¨¼¼ÇÉ"]+
	DrawString(bx*900,by*475+i*h,'Ö¸·¨¼¼ÇÉ¡¡'..bonus_z,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		 DrawAttrib("Ö¸·¨¼¼ÇÉ", bx*880+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["Óù½£ÄÜÁ¦"]+
	DrawString(bx*900,by*475+i*h,'Óù½£ÄÜÁ¦¡¡'..bonus_j,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("Óù½£ÄÜÁ¦", bx*870+150,by*475+i*h,M_YellowGreen,size1)
	end
  
	i = i + 1--p["Ë£µ¶¼¼ÇÉ"]+
	DrawString(bx*900,by*475+i*h,'Ë£µ¶¼¼ÇÉ¡¡'..bonus_d,M_YellowGreen,size1)--string.format('%5s',)
	if JY.Status == GAME_WMAP then
		DrawAttrib("Ë£µ¶¼¼ÇÉ", bx*860+150,by*475+i*h,M_YellowGreen,size1)
	end
   
	i = i + 1--p["ÌØÊâ±øÆ÷"]+
	DrawString(bx*900,by*475+i*h,'ÆæÃÅ±øÆ÷¡¡'..bonus_t,M_YellowGreen,size1)--string.format('%5s',)
    if JY.Status == GAME_WMAP then
		DrawAttrib("ÌØÊâ±øÆ÷", bx*850+150,by*475+i*h,M_YellowGreen,size1)
	end]]
  
	i = i + 1
 -- DrawString(bx*900,by*475+i*h,'°µÆ÷¡¡¡¡¡¡'..string.format('%5s',p["°µÆ÷¼¼ÇÉ"]),C_WHITE,size1)
	if p["ÃÅÅÉ¼¼ÄÜ2"] > 0 then
		local str = ""
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 458 then
			str = "(±ùÆÇ)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 450 then
			str = "(Åùö¨)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 459 then
			str = "(ÉúËÀ·û)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 460 then
			str = "(Í¸¹Ç)"
		end
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 469 then
			str = "(ºÚÑª)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 486 then
			str = "(Ï¸Óê)"
		end
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 489 then
			str = "(Îå¶¾)"
		end
		if p["ÃÅÅÉ¼¼ÄÜ2"] == 490 then
			str = "(½ğÉß)"
		end
		DrawString(bx*900,by*475+i*h,'°µÆ÷ÊÖ·¨¡¡ '..p["°µÆ÷¼¼ÇÉ"]..str,M_Orange,size1)--string.format('%5s',)
	else
		DrawString(bx*900,by*475+i*h,'°µÆ÷ÊÖ·¨¡¡ '..p["°µÆ÷¼¼ÇÉ"],M_Orange,size1)--string.format('%5s',)
	end
  
	i = i + 1
	DrawString(bx*900,by*475+i*h,'ÈËÎï×ÊÖÊ¡¡ '..p["×ÊÖÊ"],M_Red,size1)--string.format('%5s',)
	i = i + 1
	DrawString(bx*900,by*475+i*h,'ÈËÎïÌåÖÊ¡¡ '..p["ÉúÃüÔö³¤"] + limitX(math.modf(p['ÃÅÅÉ¼¼ÄÜ5'] *0.01),0,8),M_Red,size1)--string.format('%5s',)
	i = i + 1
   
   -- DrawString(bx*900,by*475+i*h,'Îä³£¡¡¡¡¡¡'..string.format('%5s',p["ÎäÑ§³£Ê¶"]),C_WHITE,size1)
   -- i = i + 1
	local zyhb = nil
	if ZYHBPD(id) >= 1 then
		if ZYHBPD(id) == 2 then
			zyhb  = "ÕæÚĞ"
		else
			zyhb  = "¡ò"
		end	
	else
		zyhb  = "¡ù"
	end
	
      local zyzd = nil	
	if ZhongYongZD1(id) or ZhongYongZD2(id) then
		if JY.Person[id]["ÖĞÓ¹"] == 3 then
			zyzd  = "ÌìÈË"
		else
			zyzd  = "¡ò"
		end	
	else
		zyzd  = "¡ù"
	end		
	
    local mrdz = nil	
	if MuRongDZ(id) == true  then
		if JY.Person[id]["ÃÅÅÉ¼¼ÄÜ3"] == 2 then
			mrdz  = "ÃØ´«"
		else
			mrdz  = "¡ò"
		end
	else
		mrdz  = "¡ù"
	end		
	
	local xshm = nil	
	if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ4'] > 0 then
		if JY.Person[id]["ÃÅÅÉ¼¼ÄÜ4"] == 1001 then
			xshm  = "Ö¤¹û"
		else
			xshm  = JY.Person[id]['ÃÅÅÉ¼¼ÄÜ4']
		end
	else
		xshm  = "¡ù"
	end	
	local yjmc = nil
	if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] > 0 then
		if JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] == 801 then
			yjmc = 'ÎŞÉÏ'
		elseif JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] > 400 and JY.Person[id]['ÃÅÅÉ¼¼ÄÜ5'] < 801 then
			yjmc = 'ÎŞ±È'
		else
			yjmc = '³õÑ§'
		end
	else
		yjmc = "¡ù"	
	end
   
   --ÈËÎïÊôĞÔ2
	i = 0
	DrawString(bx*1140,by*475,'¹¥»÷ÄÜÁ¦¡¡ '..str2_gain,M_Yellow,size1)
	if str_gain > 0 then
		DrawString(bx*1140+120,by*475,"¡¡ ¡ü "..str_gain,M_Yellow,size1)
	end	
	i = i + 1
	--DrawString(bx*1140,by*475+i*h,'·ÀÓùÁ¦¡¡¡¡¡¡'..string.format('%5s %2s %2s',def2_gain,"¡ü",def_gain),M_Yellow,size1)
	DrawString(bx*1140,by*475+i*h,'·ÀÓùÄÜÁ¦¡¡ '..def2_gain,M_Yellow,size1)
	if def_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"¡¡ ¡ü "..def_gain,M_Yellow,size1)
	end	
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'Çá¹¦Éí·¨¡¡ '..agi2_gain,M_Yellow,size1)
	if agi_gain > 0 then
		DrawString(bx*1140+120,by*475+i*h,"¡¡ ¡ü "..agi_gain,M_Yellow,size1)
	end	
  --DrawString(bx*1140,by*475+i*h,'Çá¹¦¡¡¡¡¡¡'..string.format('%5s %2s %2s',p["Çá¹¦"],"¡ü",agi1_gain),M_Yellow,size1)
	--[[if agi_gain > -1 then
		DrawString(bx*1140,by*475+i*h,'Çá¹¦Öµ¡¡¡¡¡¡'..string.format('%5s %2s %2s',agi2_gain,"¡ü",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	else
		agi_gain = -(agi_gain)
		DrawString(bx*1140,by*475+i*h,'Çá¹¦¡¡¡¡¡¡'..string.format('%5s %2s %2s',agi2_gain,"¡ı",agi_gain),M_Yellow,size1)
	--	DrawString(x1+w1*2,y1+dh*2, agi_gain, M_Yellow, size*0.7)			
	end]]

	i = i + 1
	if p["ÃÅÅÉ¼¼ÄÜ6"] > 0 then
		local str = ""
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 187 then
			str = "(×ÓÎç)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 188 then
			str = "(»ªÙ¢)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 189 then
			str = "(ÇàÅ£)"
		end	
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 190 then
			str = "(Ç§½ğ)"
		end
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 191 then
			str = "(»ÆµÛ)"
		end
		DrawString(bx*1140,by*475+i*h,'Ò½ÁÆÄÜÁ¦¡¡ '..psx(id,'Ò½ÁÆÄÜÁ¦')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'Ò½ÁÆÄÜÁ¦¡¡ '..psx(id,'Ò½ÁÆÄÜÁ¦'),M_PaleGreen,size1)
	end
	i = i + 1
	if p["ÃÅÅÉ¼¼ÄÜ6"] > 0 then
		local str = ""
		if p["ÃÅÅÉ¼¼ÄÜ6"] == 192 then
			str = "(¶¾¾­)"
		end	
		DrawString(bx*1140,by*475+i*h,'¶¾ÊõÔìÒè¡¡ '..psx(id,'ÓÃ¶¾ÄÜÁ¦')..str,M_PaleGreen,size1)
	else
		DrawString(bx*1140,by*475+i*h,'¶¾ÊõÔìÒè¡¡ '..psx(id,'ÓÃ¶¾ÄÜÁ¦'),M_PaleGreen,size1)
	end
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'×óÓÒ»¥²«¡¡ '..zyhb,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'ÖĞÓ¹Ö®µÀ¡¡ '..zyzd,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'¶·×ªĞÇÒÆ¡¡ '..mrdz,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'Ï´Ëè»»Âö¡¡ '..xshm,M_LightBlue,size1)
	i = i + 1
	DrawString(bx*1140,by*475+i*h,'è¤Ù¤ÃÜ³Ë¡¡ '..yjmc,M_LightBlue,size1)
	
   
   
   
   
   
   DrawString(bx*1140,by*475-160, "ĞŞÁ¶", C_CYGOLD, size*0.7)
	local thingid = p["ĞŞÁ¶ÎïÆ·"]
		if thingid > 0 then
			--lib.PicLoadCache(2, p["ĞŞÁ¶ÎïÆ·"] * 2, x1 + size*4, y1*19+96-100, 1)
            DrawString(bx*1140,by*475-140, JY.Thing[thingid]["Ãû³Æ"], M_DeepSkyBlue, size*0.7)			
			i = i + 1
			local n = TrainNeedExp(id)
			if n < math.huge then
				DrawString(bx*1140,by*475-120, string.format("%5d/%5d", p["ĞŞÁ¶µãÊı"], n), C_CYGOLD, size*0.7)
			else
				DrawString(bx*1140,by*475-120, string.format("%5d/===", p["ĞŞÁ¶µãÊı"]), C_CYGOLD, size*0.7)
			end
		else


	  --¾­ÑéÖµ
	  ---i = i + 1
		--DrawString(x1-130, y1 + 12*h * (i)-40, "Éı¼¶", C_CYGOLD, size*0.8)
		local kk = nil
		if p["µÈ¼¶"] >= 30 then
			kk = "   ="
		else
			p["µÈ¼¶"] = limitX(p["µÈ¼¶"],1,30)
			kk = 2 * (p["¾­Ñé"] - CC.Exp[p["µÈ¼¶"] - 1])
			if kk < 0 then
				kk = "  0"
			elseif kk < 10 then
				kk = "   " .. kk
			elseif kk < 100 then
				kk = "  " .. kk
			elseif kk < 1000 then
				kk = " " .. kk
			end
		end		
		
		
		
		--µÈ¼¶
	--	DrawString(dx*189, dy*390, kk, C_CYGOLD, size*0.8)
	--	local tmp = nil
	--	if CC.Level <= p["µÈ¼¶"] then
	--		tmp = "="
	--	else
	--		tmp = 2 * (CC.Exp[p["µÈ¼¶"]] - CC.Exp[p["µÈ¼¶"] - 1])
	--	end
	--	DrawString(dx*209, dy*390, "/" .. tmp, C_CYGOLD, size*0.8)
	end
   --ÉúÃüÄÚÁ¦´óĞ¡
	local ww = bx*78
	--local h = bx*7
	--ÉúÃü×ø±ê
	local x1,y1 = bx*200,bx*640
	--ÄÚÁ¦×ø±ê
	local x2,y2 = bx*200,bx*658
	--ÉúÃü
	local sm = JY.Person[id]['ÉúÃü']
	--ÄÚÁ¦
	local nl = JY.Person[id]['ÄÚÁ¦']
	--×î´óÉúÃü
	local smmax = JY.Person[id]['ÉúÃü×î´óÖµ']
	--×î´óÄÚÁ¦
	local nlmax = JY.Person[id]['ÄÚÁ¦×î´óÖµ']
	lib.LoadPNG(91, 35*2, x1, y1, 2)
	lib.LoadPNG(91, 35*2, x2, y2, 2)
	--ÉúÃüÌõ
	lib.SetClip(x1-ww,y1-bx*7,(x1-ww)+(ww*2)*(sm/smmax),y1+bx*7)
	lib.LoadPNG(91, 31*2, x1, y1, 2)
	
	lib.SetClip(0,0,0,0)
	--ÄÚÁ¦Ìõ
	lib.SetClip(x2-ww,y2-bx*7,(x2-ww)+(ww*2)*(nl/nlmax),y2+bx*7)
	lib.LoadPNG(91, 32*2, x2, y2, 2)
	
	lib.SetClip(0,0,0,0)
	-- --ÄÚÁ¦ÊôĞÔ
	-- local sx = {'Òõ','Ñô','µ÷ºÍ','Ììî¸'}
	-- --ÄÚÁ¦ÊôĞÔ
	-- local nlsx = sx[JY.Person[0]['ÄÚÁ¦ĞÔÖÊ']+1]
	local cl = M_DeepSkyBlue
   local strcl = 'ÒõÄÚ'
   if JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 0 then
		cl = M_DeepSkyBlue
		strcl = 'ÒõÄÚ'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 1 then
		cl = C_ORANGE
		strcl = 'ÑôÄÚ'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 2 then
		cl = C_CYGOLD
		strcl = 'µ÷ºÍ'
   elseif JY.Person[id]["ÄÚÁ¦ĞÔÖÊ"] == 3 then
		cl = C_RED
		strcl = 'Ììî¸'
   end
	
	--ÉúÃüÊı×Ö
	local smwz = sm..'/'..smmax
	--ÄÚÁ¦Êı×Ö
	local nlwz = nl..'/'..nlmax--..'£¨'..strcl..'£©'
	
	--ÉúÃü
	DrawString(x1-string.len(smwz)/4*size2,y1-size2/2,smwz,C_WHITE,size2)
	--ÄÚÁ¦
	DrawString(x2-string.len(nlwz)/4*size2,y2-size2/2,nlwz,cl,size2)
   
   
   
   i = 0
   local hh = 60
   local wh = lb1[cx1]
   if lb1[cx1] ~=nil and lb1[cx1] > 4 then 
      hh = 475
	  wh = 1
   end
   if page == 2 then
	if lb1[cx1] < 4 then
		--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
	    lib.LoadPNG(91,162*2,bx*420+bx*240*(wh-1)+bx*70-bx*70,by*hh+by*25/2+cx*h-h-by*15,1)
		if lb1[cx1] == 2 then
			local wz = 100
			local jg = 0
			local lv = math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. lb[2][cx][2]]/100)+1;
			local kungfuatk = get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[2][cx][2]], lv)
			lib.LoadPNG(91,161*2,0,0,1)
			--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
			--say("²âÊÔÎ»ÖÃ"..lb[lb1[cx1]][cx][1],0,1)
			local name = JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[2][cx][2]]]['Ãû³Æ']
	        DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'±àºÅ'..lb[2][cx][2],M_YellowGreen,size2)
			--Îä¹¦¹¥»÷·¶Î§ÏÔÊ¾
		    DrawString(bx*50,by*80,'¹¥»÷·¶Î§',C_BLACK,size)
			
			--DrawString(bx*200,by*80,'±àºÅ:'..lb[2][cx][2],M_YellowGreen,size)
			
		    tjm30(id,lb[lb1[cx1]][cx][1],bx*50,by*90+size)
			
			  DrawString(bx*50,by*270+wz*by,'Îä¹¦ÍşÁ¦',C_BLACK,size)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
		        --  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
		      DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[2][cx][2]], 11).."(×î´óÍşÁ¦)",C_ORANGE,size)
			
			
			DrawString(bx*50,by*270+wz*by+(by*40+size),'Îä¹¦ÕĞÊ½',C_RED,size)
		    local wgid = JY.Person[id]["Îä¹¦" .. lb[2][cx][2]]
			if CC.KFMove[wgid] ~= nil then
				for i=1 ,#CC.KFMove[wgid] do 
					DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   Æø¹¥: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
				end
			--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
			end
			
			--JY.Person[id]["Îä¹¦µÈ¼¶" .. i]
			--JY.Person[pid]["Îä¹¦" .. lb[2][cx][2]]
			-- lb[2][#lb[2]+1] ={ psx(id,'Îä¹¦'..k),k}
			--lb[2][cx][1]
			--ÏÔÊ¾Îä¹¦ÏêÏ¸
		elseif lb1[cx1] == 3 then
			lib.LoadPNG(91,161*2,0,0,1)
			local name = JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[3][cx][2]]]['Ãû³Æ']
			DrawString(bx*50,by*12,name,M_Yellow,size)
			DrawString(bx*300,by*12,'±àºÅ'..lb[3][cx][2],M_YellowGreen,size2)
			--DrawString(bx*200,by*80,'±àºÅ:'..lb[3][cx][2],M_YellowGreen,size)
			if JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[3][cx][2]]]['Îä¹¦ÀàĞÍ'] == 6 then
				local wz = 100
				local jg = 0
				local lv = math.modf(JY.Person[id]["Îä¹¦µÈ¼¶" .. lb[3][cx][2]]/100)+1;
				local kungfuatk = get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[3][cx][2]], lv)
				--lib.LoadPNG(91,161*2,0,0,1)
				--lib.LoadPNG(91,161*2,0,0,1,nil,nil,bx*420)
				--say("²âÊÔÎ»ÖÃ"..lb[lb1[cx1]][cx][1],0,1)
				
				
				--Îä¹¦¹¥»÷·¶Î§ÏÔÊ¾
				DrawString(bx*50,by*80,'¹¥»÷·¶Î§',C_BLACK,size)
				
				tjm30(id,lb[lb1[cx1]][cx][1],bx*50,by*90+size)
				DrawString(bx*50,by*270+wz*by,'Îä¹¦ÍşÁ¦',C_BLACK,size)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%4s',wgwl(id,wg)),C_BLACK,size2)
					--  DrawString(bx*50,by*270+wz*by+size,string.format('%6s','/'),C_BLACK,size2)
				DrawString(bx*50,by*270+wz*by+size,kungfuatk..' / '..get_skill_power(id, JY.Person[id]["Îä¹¦" .. lb[3][cx][2]], 11).."(×î´óÍşÁ¦)",C_ORANGE,size)
			
				-- --Îä¹¦ÄÚÁ¦ĞÔÖÊ
				--DrawString(bx*50,by*270+wz*by+(by*40+size),'Îä¹¦ÕĞÊ½',C_RED,size)
				--local wgid = JY.Person[id]["Îä¹¦" .. lb[3][cx][2]]
				--[[if CC.KFMove[wgid] ~= nil then
					for i=1 ,#CC.KFMove[wgid] do 
						DrawString(bx*50,by*360+wz*by+i*30,CC.KFMove[wgid][i][1].."   Æø¹¥: "..CC.KFMove[wgid][i][2],C_GOLD,size*0.6)
					end
				--	DrawString(bx*50,by*270+wz*by+(by*40+size),CC.KFMove[wgid][1][1],C_BLACK,size)
				end	]]										
			
			end
		elseif lb1[cx1] == 1 and cx > 4 then
			lib.LoadPNG(91,161*2,0,0,1)
			local name = lb[1][cx]
			tjm(bx*50,by*10,name,M_Yellow,size)
			if cx == 5 then --tfjswz = [#tfjswz+1] = tfstr
				--for j = 1, #tfjswz1 do
					local tfstr = tfjswz1[mid]
					if mid == 0 and JY.Base['±ê×¼'] > 0 then
						tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
					else
						tfstr = tfjswz1[mid]
						if tfstr == nil then
							tfstr = '£×ÎŞ¸öÈËÌì¸³½éÉÜ'
						end
						tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
					--	tjm(bx*50,by*80,tfstr,C_BLACK,size*0.7,14,h+10)
					end	
				--end
			--elseif cx == 6 and (match_ID(id,26) or match_ID(id,592) or match_ID(id,577)) then
				
			else
				--for j = 1, #tfjswz do
					local tfstr = tfjswz[cx-5]
					if cx == 6 and (match_ID(id,26) or match_ID(id,592) or match_ID(id,577)) then
						tjm(bx*35,by*60,tfstr,M_Yellow,size*0.7,13,h+3)
					else	
					--	tfstr = tfjswz1[j]
						tjm1(bx*35,by*60,tfstr,C_BLACK,size*0.7,13,h+3)
					end	
				--end
			end	
			--DrawString
			--DrawString(bx*300,by*12,'±àºÅ'..lb[3][cx][2],M_YellowGreen,size2)
			--DrawString(bx*200,by*80,'±àºÅ:'..lb[3][cx][2],M_YellowGreen,size)
			--for j = 1, #bossztwz do
				--local tfstr = bossztwz[j]
				--tjm(bx*50,by*80,tfstr,C_BLACK,size,10,h+10)
			--end	
		    --DrawString(bx*50,by*270+wz*by+(by*40+size),'Îä¹¦ÕĞÊ½',C_RED,size)
		end
	end
    
   end
	
   ShowScreen()
   local X,ktype,mx,my = lib.GetKey()
   if X == VK_SPACE or X == VK_RETURN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 1 then
			 page = 2		 
		  elseif page == 2 then 
			 if lb1[cx1] == 5 then
			 --   Personzb(id,cx)
			 elseif lb1[cx1] == 4 then	
				-- if cx == #lb[4] then 
				-- --  Menu_Jiali(id)
				-- --	say("²âÊÔÎ»ÖÃ1"..cx,0,1)
					-- Menu_Gongti(id,yg[cx][2])
				-- else 
				  -- Menu_Gongti(id,yg[cx][2])
				-- end
			 elseif lb1[cx1] == 3 then	
				--detailed_info(cur_thing)
				if cx <= #lb[3] then
					--say("ÏÖÔÚÎ»ÖÃ£º"..lb[3][cx][1],0,1)
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --¶ÁÈ¡ÎïÆ·
						if JY.Thing[j]["Á·³öÎä¹¦"] >= 0 and JY.Thing[j]["Á·³öÎä¹¦"] == lb[3][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 2 then
				if cx <= #lb[2] then
					local p = JY.Person[id]
					local thingid = 0
				
					for j = 0, JY.ThingNum - 1 do  --¶ÁÈ¡ÎïÆ·
						if JY.Thing[j]["Á·³öÎä¹¦"] >= 0 and JY.Thing[j]["Á·³öÎä¹¦"] == lb[2][cx][1] then											
							thingid = j
							break
						end	
					end
					
					--detailed_info(thingid)
				
				detailed_info(thingid)
				end
			 elseif lb1[cx1] == 1 then
				-- if cx >= 5 then 
				-- --  Menu_Jiali(id)
				-- --say("²âÊÔÎ»ÖÃ1"..cx,0,1)
					-- --Menu_Gongti(id,yg[cx][2])
					-- --lib.LoadPNG(91,165*2,bx*500,by*46+(cx*15),1)
					-- lib.LoadPNG(91,161*2,0,0,1)
					-- --local name = JY.Wugong[JY.Person[id]["Îä¹¦" .. lb[3][cx][2]]]['Ãû³Æ']
					-- --DrawString(bx*50,by*12,name,M_Yellow,size)
					-- --DrawString(bx*300,by*12,'±àºÅ'..lb[3][cx][2],M_YellowGreen,size2)
					-- --DrawString(bx*200,by*80,'±àºÅ:'..lb[3][cx][2],M_YellowGreen,size)
					-- --for j = 1, #bossztwz do
						-- --local tfstr = bossztwz[j]
						-- --tjm(bx*50,by*80,tfstr,C_BLACK,size,10,h+10)
					-- --end	
					-- --for k = 1, tfjsbh do
						-- local n = 0
						-- local tfstr = tfjswz[cx-n] --= tfstr
						-- --local tfstr1 = tfjswz[cx-n] --= tfstr
						-- local h1 = 0
						-- if cx == 5 then
							-- --n = 5
							-- for j = 1 ,#tfjswz1 do
							-- tfstr = tfjswz1[j]
							-- tjm(bx*50,by*40+j*60,tfstr,C_BLACK,size*0.6,12,h+3)
							-- --tjm(bx*550,by*46+(cx*15)+j*20,tfstr,C_WHITE,size1,math.floor(bx*350/(size1)*0.8)+15,h+10)
							-- end
						-- --	say("×¨ÊôÌì¸³",0,1)
						-- else
							-- n = 5
							-- tfstr = tfjswz[cx-n]
							-- tjm(bx*50,by*80,tfstr,C_BLACK,size,8,h+10)
							-- --tjm(bx*550,by*46+(cx*15),tfstr,C_WHITE,size*0.8,math.floor(bx*350/(size)*0.8)+2,h+10)
						-- end
						
						
						-- --if string.sub(tfstr,1,2) == '£×'  then
						-- --	h1 = tjm(bx*60, by*110 + size*0.8 * (row-istart), tfstr, C_WHITE, size*0.8,32,size*0.8,istart-row,max_row+1-row+istart)
						-- --	tjm9(bx*30,by*80+k*h,TFJS[id][k],C_WHITE,size2,math.floor(bx*345/size2)-1,h)
							-- --tjm9(bx*30,by*80+i*h+20,tfstr,C_WHITE,size2,math.floor(bx*345/size2)-1,h)
							-- --row = row + 1
							-- --DrawString(bx*420,by*160+i*h,tfstr,C_WHITE,size1)--,math.floor(bx*345/size2)+2,h
						
						-- -- tjm(bx*550,by*46+(cx*15),tfstr,C_WHITE,size*0.8,math.floor(bx*350/(size)*0.8)+2,h+10)
							-- --DrawString(bx*935-string.len(tfstr)/4*size,by*136-size/2,tfstr,C_WHITE,size)
							-- --h1=--tfstr = tfstr .. "£Î"
						-- --	i = i + 1
							-- --lb[1][#lb[1]+1] = tfstr
						-- --end
						-- --row = row + 1
						-- --i = i + 0.33
					-- --end
					
					-- --DrawString(bx*935-string.len('Î´¿ªÆôµÚ¶şÔË¹¦')/4*size,by*136-size/2,'Î´¿ªÆôµÚ¶şÔË¹¦',C_WHITE,size)
					-- ShowScreen()
					-- WaitKey()
				-- else 
				  -- --Menu_Gongti(id,yg[cx][2])
				-- end
			 end
		  end
	  --end
   elseif X == VK_ESCAPE or ktype == 4 then 
      if page == 2 then 
	     page = page - 1 
		 cx = 1 
		 cx1 = 1
	  else 	 
         break
	  end
	  fy = 0
   elseif X == VK_UP then
	  --page2ÈËÎïÊôĞÔÑ¡Ôñ
	  --if JY.Status ~= GAME_WMAP then
		if page == 2 then 
			cx = cx - 1
			if cx < 1 then
				cx = #lb[lb1[cx1]]
			end	
			
		end
		fy = 0
	 -- end
   elseif X == VK_DOWN then
	  --page2ÈËÎïÊôĞÔÑ¡Ôñ
	 -- if JY.Status ~= GAME_WMAP then
		  if page == 2 then 
			 cx = cx + 1
			 if cx > #lb[lb1[cx1]] then
				cx = 1
			 end
			 fy = 0
		  end
	  --end
   elseif X == VK_LEFT  then
      --page1ÈËÎïÒ³ÃæÇĞ»»
	  if JY.Status ~= GAME_WMAP then
		  if page == 1 then 
			 t = t - 1 
			 if t < 1 then
				t = #team
			 end
		  end
	  end  --page2ÈËÎïÊôĞÔÑ¡Ôñ
		  if page == 2 then 
			 cx1 = cx1 - 1
			 cx = 1
			 if cx1 < 1 then 
				cx1 = #lb1
			 end
			 fy = 0
		  end
	-- end
   elseif X == VK_RIGHT  then
      --page1ÈËÎïÒ³ÃæÇĞ»»
	    if JY.Status ~= GAME_WMAP then
			if page == 1 then
				t = t + 1 
				if t > #team then 
					t = 1
				end
			end
		end
		--page2ÈËÎïÊôĞÔÑ¡Ôñ
		if page == 2 then 
			cx1 = cx1 + 1
			cx = 1
			if cx1 > #lb1 then 
				cx1 = 1
			end	
			fy = 0
		end	
    --  end	  
   elseif X == VK_PGUP then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy - 1
			 if fy < 0 then 
				fy = 0
			 end	
		  end
	  --end
   elseif X == VK_PGDN then
      --if JY.Status ~= GAME_WMAP then
		  if page == 2 and lb1[cx1] == 2 then 
			 fy = fy + 1
			 if fy > fymax then
				fy = fymax 
			 end
		  end
	  --end
   else 
     -- if JY.Status ~= GAME_WMAP then
      local mxx = false 
	  if page == 1 then 
	     if ktype == 3 then 
		    page = 2
		 end
	  elseif page == 2 then 
	     if #lb[1] > 0 then 
		    for ii = 1,#lb[1] do 
			    if mx >= bx*420 and mx <= bx*420 + bx*160 and 
				   my >= by*60+(ii-1)*h and my <= by*60+(ii-1)*h + size1 then 
				   cx = ii
				   cx1 = lb2[1]
				   mxx = true 
				   break
				end
			end
		 end	
		 if #lb[2] > 0 then 
		    for ii = 1,#lb[2] do 
			    if mx >= bx*660 and mx <= bx*660 +size1*4 and 
				   my >= by*60+(ii-1)*h and my <= by*60+(ii-1)*h + size1 then 
				   cx = ii 
				   cx1 = lb2[2]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[3] > 0 and mxx == false then 
		    for ii = 1,#lb[3] do 
			    if mx >= bx*900 and mx <= bx*900 +size1*4 and 
				   my >= by*60+(ii-1)*h and my <= by*60+(ii-1)*h + size1 then 
				   cx = ii 
				   cx1 = lb2[3]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[4] > 0 then 
		    for ii = 1,#lb[4] do 
			    if mx >= bx*1142 and mx <= bx*1345 and 
				   my >= by*78+(ii-1)*by*48-by*18 and my <= by*78+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[4]
				   mxx = true 
				   break
				end
			end
		 end
		 if #lb[5] > 0 then 
		    for ii = 1,#lb[5] do 
			    if mx >= bx*422 and mx <= bx*622 and 
				   my >= by*488+(ii-1)*by*48-by*18 and my <= by*488+(ii-1)*by*48+by*18 then 
				   cx = ii 
				   cx1 = lb2[5]
				   mxx = true 
				   break
				end
			end
		 end
		 if mxx == true and ktype == 3 then 
	        if lb1[cx1] == 5 then
		    --   Personzb(id,cx)
		    elseif lb1[cx1] == 4 then	
		       if cx == #lb[4] then 
			    
				--Menu_Gongti(id,yg[cx][2])
			   else 
			     -- Menu_Gongti(id,yg[cx][2])
			   end
		    elseif lb1[cx1] == 2 then
		    
		    end
		 end
	  end
	  --end
   end
   
   
   end
end 

--ÈËÎïÊôĞÔ
function psx(id,str) 
	if str ~= nil then
		if str == 'ÊµÕ½¾­Ñé' then 
			return CC.SZJY[id]
		elseif str == 'ÎäÑ§Ç±ÄÜ' then
		    return CC.WXQN[id]
		else
		    return JY.Person[id][str]
		end
	end
end

--ÄÚÁ¦ĞÔÖÊ
function rwnlxz(id,xz)
	local nl = JY.Person[id]['ÄÚÁ¦ĞÔÖÊ']
	if xz ~= nil then
		if nl == 3 then
			return true
		end	
		if xz == nl then
			return true
		end	
		if match_ID(id,9757+xz) then
			return true
		end
		return false
	else
		return nl
	end		
end

function ztd(i,str,t)
	local id = WAR.Person[i]["ÈËÎï±àºÅ"]
	if i == nil or str == nil then
		do return end
	end	
	if JY.Status ~= GAME_WMAP then
		do return end
	end	
	if t == nil then
		t = 0
	else
		t = math.modf(t)	
	end	
	if WAR.TXXS[id] == nil then
		WAR.TXXS[id] = 1
	end	 
	if str == "ÉúÃüµãÊı" then
		if t < 0 then
			local hurt = math.abs(t)
			--ÎŞ¾Æ²»»¶£ºÉËº¦µÄ½áËãµ½´ËÎªÖ¹£¬¿Û³ı±»¹¥»÷·½ÑªÁ¿
			if hurt > 500 then
			    hurt = 500 + math.modf((hurt - 500)^0.95)
			    if hurt > 700 then
				    hurt = 700 + math.modf((hurt - 700)^0.9)
				    if hurt > 1500 then
				    	hurt = 1500 + math.modf((hurt - 1500 )^0.85)
					    if hurt > 3000 then
					        hurt = 3000 + math.modf((hurt - 3000)^0.8)
					    end
					end  
				end
			end
			t = -hurt	
			if (match_ID(id, 601) or match_ID(id,9808)) and WAR.SXTJ <= 50 then
				if t < -50 then
					t = -50
				end	
			end
			if NGQH(id,144) and WAR.PD['ÃâÒßÉ±Æø'][id] ~= nil and DWPD(WAR.CurID,i) then
				t = math.modf(t*0.5)
			end
			if match_ID(id,114) and WAR.PD['ÎŞĞÎÆøÇ½'][id] ~= nil and DWPD(WAR.CurID,i) then
				t = math.modf(t*0.3)
			end
			if WAR.PD['ÒõÑô¶şÆø'][id] ~= nil then
				local yyxt = 10 - (WAR.PD['ÒõÑô¶şÆø'][id] or 0)
				t = t + JY.Person[id]["Æ·µÂ"]*yyxt*(WAR.SPIRIT[id] or 0)/100
			end
		end
		if WAR.ZDDSSF == 1 then
			WAR.Person[i]["Realhurt"] = (WAR.Person[i]["Realhurt"] or 0) + t
			--WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"ÉúÃü",t)
		end	
	elseif str == "ÄÚÁ¦µãÊı" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"ÄÚÁ¦",t)
		end
	elseif str == "ÌåÁ¦µãÊı" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"ÌåÁ¦",t)
		end
	elseif str == "ÖĞ¶¾µãÊı" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"ÖĞ¶¾³Ì¶È",t)
		end
	elseif str == WAR.BFXS then
		if WAR.ZDDSSF == 1 then
			WAR.BFXS[id] = (WAR.BFXS[id] or 0) + t
		else
			WAR.BFXS[id] = 1
			AddPersonAttrib(id,"±ù·â³Ì¶È",t)
		end	
	elseif str == WAR.ZSXS then
		if WAR.ZDDSSF == 1 then
			WAR.ZSXS[id] = (WAR.ZSXS[id] or 0) + t
		else
			WAR.ZSXS[id] = 1
			AddPersonAttrib(id,"×ÆÉÕ³Ì¶È",t)
		end
	elseif str == WAR.FXXS then
		if WAR.ZDDSSF == 1 then
			WAR.FXXS[id] = 1
			WAR.FXDS[id] = (WAR.FXDS[id] or 0) + t
		else
			WAR.FXXS[id] = 1
			AddPersonAttrib(id,"·âÑ¨³Ì¶È",t)
		end
	elseif str == WAR.LXXS then
		if WAR.ZDDSSF == 1 then
			WAR.LXXS[id] = (WAR.LXXS[id] or 0) + t
		else
			WAR.LXXS[id] = 1
			AddPersonAttrib(id,"Á÷Ñª³Ì¶È",t)
		end
	elseif str == "ÄÚÉËµãÊı" then
		if WAR.ZDDSSF == 1 then
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t
		else
			WAR.Person[i][str] = (WAR.Person[i][str] or 0) + AddPersonAttrib(id,"ÊÜÉË³Ì¶È",t)
		end
	elseif str == "¼¯ÆøÎ»ÖÃ" then
		if t >= 0 then
			if WAR.PD['Äı½áÊ±¿Õ'][id] == 1 then
				t = 0
			end
			--WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-500,999)
			WAR.Person[i].TimeAdd = (WAR.Person[i].TimeAdd or 0 ) + t
			if WAR.Person[i].TimeAdd > 1000 then WAR.Person[i].TimeAdd = 1000 end
		else
			if WGZH(id,36,46) then
				WAR.Person[i]["ÉúÃüµãÊı"] = (WAR.Person[i]["ÉúÃüµãÊı"] or 0) + AddPersonAttrib(id,"ÉúÃü",-t)
			end
			if nokillspeed(i) == false then
				local jcqf = 0
				if t < -100 then
					if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] ~= nil and JY.Person[id]['Ö÷ÔËÄÚ¹¦'] > 0 then
						--jcqf = jcqf + get_skill_power(id,JY.Person[id]['Ö÷ÔËÄÚ¹¦'],11)
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['Ö÷ÔËÄÚ¹¦'],11) * 0.5)
						if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] == JY.Person[id]['Ìì¸³ÄÚ¹¦'] then
							jcqf = math.modf(jcqf * 1.2)
						end
					end 	
					if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] ~= nil and JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] > 1 then
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['Ö÷ÔËÄÚ¹¦'],11) * 0.25)
						if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] == JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] then
							jcqf = math.modf(jcqf * 1.1)
						end
					end 
					jcqf = math.modf(jcqf*0.06)
					t = math.modf(t+jcqf)
					if WAR.PD['²»ÆÆ·À'][id] ~= nil then
						t = math.modf(t*0.9)
					end
					if NGQH(id,203) and WAR.PD['³¤ÉúÕæÆø'][id] ~= nil then
						t = math.modf(t*0.7)
					end
				end	
				if t >= 0 then t = 0 end
				--if t < -250 then t = -250 end
				WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-1500,1500)
			end
		end	
	else
	
	end	
	--Cat('ÊıÖµÏÔÊ¾')
	--return WAR.Person[i][str]
end

--[[function ztd1(i,str,t)
	local id = WAR.Person[i]["ÈËÎï±àºÅ"]
	if i == nil or str == nil then
		do return end
	end	
	if t == nil then
		t = 0
	else
		t = math.modf(t)	
	end	
	if WAR.TXXS[id] == nil then
		WAR.TXXS[id] = 1
	end	 
	if str == "ÉúÃüµãÊı" then
		if NGQH(id,144) and WAR.PD['ÃâÒßÉ±Æø'][id] ~= nil and DWPD(WAR.CurID,i) and t < 0 then
			t = math.modf(t*0.5)
		end	
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"ÉúÃü",t)
	elseif str == "ÄÚÁ¦µãÊı" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"ÄÚÁ¦",t)
	elseif str == "ÌåÁ¦µãÊı" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"ÌåÁ¦",t)
	elseif str == "ÖĞ¶¾µãÊı" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"ÖĞ¶¾³Ì¶È",t)
	elseif str == WAR.BFXS then
		WAR.BFXS[id] = (WAR.BFXS[id] or 0) + t --1
		--AddPersonAttrib(id,"±ù·â³Ì¶È",t)
	elseif str == WAR.ZSXS then
		WAR.ZSXS[id] = (WAR.ZSXS[id] or 0) + t --1
		--AddPersonAttrib(id,"×ÆÉÕ³Ì¶È",t)
	elseif str == WAR.FXXS then
		WAR.FXXS[id] = (WAR.FXXS[id] or 0) + t --1
		--AddPersonAttrib(id,"·âÑ¨³Ì¶È",t)
	elseif str == WAR.LXXS then
		WAR.LXXS[id] = (WAR.LXXS[id] or 0) + t --1
		--AddPersonAttrib(id,"Á÷Ñª³Ì¶È",t)
	elseif str == "ÄÚÉËµãÊı" then
		WAR.Person[i][str] = (WAR.Person[i][str] or 0) + t--AddPersonAttrib(id,"ÊÜÉË³Ì¶È",t)
	elseif str == "¼¯ÆøÎ»ÖÃ" then
		if t >= 0 then
			--WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-500,999)
			WAR.Person[i].TimeAdd = (WAR.Person[i].TimeAdd or 0 ) + t
			if WAR.Person[i].TimeAdd > 1000 then WAR.Person[i].TimeAdd = 1000 end
		else
			if nokillspeed(i) == false then
				local jcqf = 0
				if t < -100 then
					if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] ~= nil and JY.Person[id]['Ö÷ÔËÄÚ¹¦'] > 0 then
						--jcqf = jcqf + get_skill_power(id,JY.Person[id]['Ö÷ÔËÄÚ¹¦'],11)
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['Ö÷ÔËÄÚ¹¦'],11) * 0.5)
						if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] == JY.Person[id]['Ìì¸³ÄÚ¹¦'] then
							jcqf = math.modf(jcqf * 1.2)
						end
					end 	
					if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] ~= nil and JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] > 1 then
						jcqf = jcqf + (get_skill_power(id,JY.Person[id]['Ö÷ÔËÄÚ¹¦'],11) * 0.25)
						if JY.Person[id]['Ö÷ÔËÄÚ¹¦'] == JY.Person[id]['ÃÅÅÉ¼¼ÄÜ1'] then
							jcqf = math.modf(jcqf * 1.1)
						end
					end 
					jcqf = math.modf(jcqf*0.067)
					t = math.modf(t+jcqf)
					if NGQH(id,203) and WAR.PD['³¤ÉúÕæÆø'][id] ~= nil then
						t = math.modf(t*0.7)
					end
				end	
				if t >= 0 then t = 0 end
				--if t < -250 then t = -250 end
				WAR.Person[i].TimeAdd = limitX((WAR.Person[i].TimeAdd or 0) + t,-1500,1500)
			end
		end	
	else
	
	end	
	--Cat('ÊıÖµÏÔÊ¾')
	--return WAR.Person[i][str]
end
]]

--pngÌùÍ¼Î»ÖÃ
function pngxy(id,pngid,x,y,z)
lib.LoadPNG(id,pngid,x,y,z)
end 

--picÌùÍ¼Î»ÖÃ
function picxy(id,picid,x,y,z,t)
lib.PicLoadCache(id,picid,x,y,z,t)
end 

--ÈËÎïĞÕÃû
function name(id) 
   return JY.Person[id]['ĞÕÃû']
end
-- function Menu_Jiali(pid)
   -- if psx(pid,'ÄÚ¹¦Ì×Â·') <= 0 then 
      -- return 0
   -- end
   -- local wg = psx(pid,'ÄÚ¹¦Ì×Â·')
   -- local dj = tjm.tjmhs1.tjm5(pid,wg)
   -- local nl = psx(pid,'ÄÚÁ¦×î´óÖµ')
   -- local dqjl = psx(pid,'¼ÓÁ¦')
   -- local jlmax = math.floor(nl/80*dj/100) --×î´óÄÚÁ¦/80*Îä¹¦µÈ¼¶/100
   
   -- --Ìì¸³39Ìì¹¦Ò»Ìå
   -- if ptf(pid,39) then 
      -- jlmax = jlmax*2
   -- end  
   
   -- local x2 = CC.ScreenW*0.5
   -- local y = CC.ScreenH*0.2 + CC.ScreenH/768*5
   -- local size = CC.DefaultFont*0.8
   -- local h = (CC.ScreenH-y-CC.ScreenH/768*30)/16
   -- local jl = InputNum("µ±Ç°ÄÚÁ¦ÔËÆø",0,jlmax,1,dqjl);
   -- if jl ~= nil then
      -- JY.Person[pid]['¼ÓÁ¦'] = jl
   -- end
-- end

function tjm9(x,y,str,color,size,xnum,hnum,first,last)
if xnum == nil then 
   xnum = #str
end  
 
if x==-1 then
   local ll=#str;
   local w=size*ll/2+2*CC.MenuBorderPixel;
   x=(CC.ScreenW-size/2*ll-2*CC.MenuBorderPixel)/2;
end

if y == -1 then
   y = (CC.ScreenH - size - 2 * CC.MenuBorderPixel) / 2
end
	
local ynum=size
local T2={{"£Ò",C_RED},{"£Ç",M_Green},{"£Â",C_BLACK},{"£×",C_WHITE},{"£Ï",C_ORANGE},{"£Í",M_Gray},{"£Ù",M_Yellow},{"£Ú",M_Orange}};

local cx,cy=0,0;
local sid=lib.SaveSur(0,0,CC.ScreenW,CC.ScreenH);
while string.len(str)>=1 do
 local try=string.sub(str,1,1)
 local control=false;

 local hs = size+CC.RowPixel
 if hnum ~= nil then 
    hs = hnum
 end
 if string.byte(try)>127 then --ÖĞÎÄ
    local s=string.sub(str,1,2);
    str=string.sub(str,3,-1);

    for i,v in pairs(T2) do
        if s==v[1] then
           color=v[2];
           control=true;
        break;
        end
    end

    if not control then
	   if first ~= nil then
	      if last ~= nil then
	         if cy >= first and cy < last then
                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
	         if cy >= first then
                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end	  
		  end
	   else 
          if last ~= nil then
	         if cy < last then
                lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
		     lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
          end		  
	   end
       cx=cx+1;
    end

 else
    local s=try
    str=string.sub(str,2,-1);
	   if first ~= nil then
	      if last ~= nil then
	         if cy >= first and cy < last then
				lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
	         if cy >= first then
				lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end	  
		  end
	   else 
          if last ~= nil then
	         if cy < last then
				lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
		     end
		  else 
			 lib.DrawStr(x+size*cx,y+(hs)*cy,s,color,size,CC.FontName,CC.SrcCharSet,CC.OSCharSet);
          end		  
	   end
    cx=cx+0.5;
 end

 if not control then

    if cx > xnum then
       cx = 0;
	   --×ÖÌå½áÊø²»ÔÙ½øÈëÏÂÒ»ĞĞ
	   if string.len(str) >= 1 then 
          cy = cy + 1;
	   end
       if cy >= ynum then
          cy = 0;
          WaitKey();
          lib.LoadSur(sid,0,0);
       end
    end
 end

 end

 lib.FreeSur(sid);
 return cy+1
end


function tjm30(id,wg,x,y)
   if x == nil or y == nil then 
      x,y = CC.ScreenW/2,CC.ScreenH/2
   end
   
   --Îä¹¦µÈ¼¶¸ù¾İµ±Ç°ÈËÎïÎä¹¦µÈ¼¶
   local level = math.modf(tjm5(id,wg)/100)+1
   --»ñÈ¡Îä¹¦µÄ·¶Î§
   --say("Îä¹¦µÈ¼¶"..level,0,1)
   if level == 10 then
	level = 11
   end
   if wg == 153 then
   	do return end
   end	
   local m1, m2, a1, a2, a3, a4, a5 = refw1(wg, level,id)-- refw(wg, level,id)
   local movefanwei = {m1, m2}   --¿ÉÒÆ¶¯µÄ·¶Î§
   local atkfanwei = {a1, a2, a3, a4, a5}   --¹¥»÷·¶Î§
   local xx,yy = 6,6 
   local px,py = xx,yy

   if a1 >= 10 and a1 <= 12 then
      yy = 6 + math.ceil(a2/2)-1
	  py = yy + 1
   end
   
  	tjm31(x,y,xx,yy,atkfanwei,px,py)
end
function tjm5(id,wgid)
   if wgid == '¶·×ª' then 
	  return psx(id,'¶·×ªµÈ¼¶')
   elseif wgid == '×óÓÒ»¥²«' then 
      return psx(id,'×óÓÒµÈ¼¶')
   end
   for i = 1,JY.Base["Îä¹¦ÊıÁ¿"] do 
      if JY.Person[id]["Îä¹¦"..i] == wgid and JY.Person[id]["Îä¹¦µÈ¼¶"..i] > 0 then
	     return JY.Person[id]["Îä¹¦µÈ¼¶"..i]  
      end 
   end
   return 0
end
function tjm31(zx,zy,x, y, fanwei, cx, cy)

  local x0, y0 = cx, cy

  local kind = fanwei[1]			--¹¥»÷·¶Î§
  local len1 = fanwei[2]
  local len2 = fanwei[3]
  local len3 = fanwei[4]
  local len4 = fanwei[5]
  local xy = {}
  local num = 0
  if kind == 0 then
    num = 1
    xy[1] = {x, y}

  elseif kind == 1 then
    if not len1 then
      len1 = 0
    end
    if not len2 then
      len2 = 0
    end
    num = num + 1
    xy[num] = {x, y}
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      num = num + 4
    end
    for i = 1, len2 do
      xy[num + 1] = {x + i, y + i}
      xy[num + 2] = {x - i, y - i}
      xy[num + 3] = {x - i, y + i}
      xy[num + 4] = {x + i, y - i}
      num = num + 4
    end

  elseif kind == 2 then
    for tx = x - len1, x + len1 do
      for ty = y - len1, y + len1 do
        if len1 < math.abs(tx - x) + math.abs(ty - y) then
          
        else
        	num = num + 1
        	xy[num] = {tx, ty}
        end
        
      end
    end
	
	
  elseif kind == 3 then
    if not len2 then
      len2 = len1
    end
    local dx, dy = math.abs(x - x0), math.abs(y - y0)
    if dy < dx then
      len1, len2 = len2, len1
    end
    for tx = x - len1, x + len1 do
      for ty = y - len2, y + len2 do
        num = num + 1
        xy[num] = {tx, ty}
      end
    end
  elseif kind == 5 then
    if not len1 then
      len1 = 0
    end
    if not len2 then
      len2 = 0
    end
    num = num + 1
    xy[num] = {x, y}
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      num = num + 4
    end
    if len2 > 0 then
      xy[num + 1] = {x + 1, y + 1}
      xy[num + 2] = {x + 1, y - 1}
      xy[num + 3] = {x - 1, y + 1}
      xy[num + 4] = {x - 1, y - 1}
      num = num + 4
    end
    for i = 2, len2 do
      xy[num + 1] = {x + i, y + 1}
      xy[num + 2] = {x - i, y - 1}
      xy[num + 3] = {x - i, y + 1}
      xy[num + 4] = {x + i, y - 1}
      xy[num + 5] = {x + 1, y + i}
      xy[num + 6] = {x - 1, y - i}
      xy[num + 7] = {x - 1, y + i}
      xy[num + 8] = {x + 1, y - i}
      num = num + 8
    end
  elseif kind == 6 then
    if not len2 then
      len2 = len1
    end
    xy[1] = {x + 1, y}
    xy[2] = {x - 1, y}
    xy[3] = {x, y + 1}
    xy[4] = {x, y - 1}
    num = num + 4
    if len1 > 0 or len2 > 0 then
      xy[5] = {x + 1, y + 1}
      xy[6] = {x + 1, y - 1}
      xy[7] = {x - 1, y + 1}
      xy[8] = {x - 1, y - 1}
      num = num + 4
      for i = 2, len1 do
        xy[num + 1] = {x + i, y + 1}
        xy[num + 2] = {x - i, y + 1}
        xy[num + 3] = {x + i, y - 1}
        xy[num + 4] = {x - i, y - 1}
        num = num + 4
      end
      for i = 2, len2 do
        xy[num + 1] = {x + 1, y + i}
        xy[num + 2] = {x + 1, y - i}
        xy[num + 3] = {x - 1, y + i}
        xy[num + 4] = {x - 1, y - i}
        num = num + 4
      end
    end
  elseif kind == 7 then
    if not len2 then
      len2 = len1
    end
    if len1 == 0 then
      for i = y - len2, y + len2 do
        num = num + 1
        xy[num] = {x, i}
      end
    elseif len2 == 0 then
      for i = x - len1, x + len1 do
        num = num + 1
        xy[num] = {i, y}
      end
    else
      for i = x - len1, x + len1 do
        num = num + 1
        xy[num] = {i, y}
        num = num + 1
        xy[num] = {i, y + len2}
        num = num + 1
        xy[num] = {i, y - len2}
      end
      for i = 1, len2 - 1 do
        xy[num + 1] = {x, y + i}
        xy[num + 2] = {x, y - i}
        xy[num + 3] = {x - len1, y + i}
        xy[num + 4] = {x - len1, y - i}
        xy[num + 5] = {x + len1, y + i}
        xy[num + 6] = {x + len1, y - i}
        num = num + 6
      end
    end
  elseif kind == 8 then
    xy[1] = {x, y}
    num = 1
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      xy[num + 5] = {x + i, y + len1}
      xy[num + 6] = {x - i, y - len1}
      xy[num + 7] = {x + len1, y - i}
      xy[num + 8] = {x - len1, y + i}
      num = num + 8
    end
  elseif kind == 9 then
    xy[1] = {x, y}
    num = 1
    for i = 1, len1 do
      xy[num + 1] = {x + i, y}
      xy[num + 2] = {x - i, y}
      xy[num + 3] = {x, y + i}
      xy[num + 4] = {x, y - i}
      xy[num + 5] = {x - i, y + len1}
      xy[num + 6] = {x + i, y - len1}
      xy[num + 7] = {x + len1, y + i}
      xy[num + 8] = {x - len1, y - i}
      num = num + 8
    end
  --elseif x == x0 and y == y0 then
  --  return 0
  elseif kind == 10 then
    if not len2 then
      len2 = 0
    end
    if not len3 then
      len3 = 0
    end
    if not len4 then
      len4 = 0
    end
    local fx, fy = x - x0, y - y0
    if fx > 0 then
      fx = 1
    elseif fx < 0 then
      fx = -1
    end
    if fy > 0 then
      fy = 1
    elseif fy < 0 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    dx1 = -(dx1 + fx) / 2
    dx2 = -(dx2 + fx) / 2
    dy1 = -(dy1 + fy) / 2
    dy2 = -(dy2 + fy) / 2
    if dx1 > 0 then
      dx1 = 1
    elseif dx1 < 0 then
      dx1 = -1
    end
    if dx2 > 0 then
      dx2 = 1
    elseif dx2 < 0 then
      dx2 = -1
    end
    if dy1 > 0 then
      dy1 = 1
    elseif dy1 < 0 then
      dy1 = -1
    end
    if dy2 > 0 then
      dy2 = 1
    elseif dy2 < 0 then
      dy2 = -1
    end
    for i = 0, len1 - 1 do
      num = num + 1
      xy[num] = {x + i * fx, y + i * fy}
    end
    for i = 0, len2 - 1 do
      num = num + 1
      xy[num] = {x + dx1 + i * fx, y + dy1 + i * fy}
      num = num + 1
      xy[num] = {x + dx2 + i * fx, y + dy2 + i * fy}
    end
    for i = 0, len3 - 1 do
      num = num + 1
      xy[num] = {x + 2 * dx1 + i * fx, y + 2 * dy1 + i * fy}
      num = num + 1
      xy[num] = {x + 2 * dx2 + i * fx, y + 2 * dy2 + i * fy}
    end
    for i = 0, len4 - 1 do
      num = num + 1
      xy[num] = {x + 3 * dx1 + i * fx, y + 3 * dy1 + i * fy}
      num = num + 1
      xy[num] = {x + 3 * dx2 + i * fx, y + 3 * dy2 + i * fy}
    end
  elseif kind == 11 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    if fx ~= 0 and fy ~= 0 then
      dx1 = -(dx1 + fx) / 2
      dx2 = -(dx2 + fx) / 2
      dy1 = -(dy1 + fy) / 2
      dy2 = -(dy2 + fy) / 2
      len1 = math.modf(len1 * 0.7071)
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, 2 * i + 1 do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    else
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, len1 - i do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    end
  elseif kind == 12 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local dx1, dy1, dx2, dy2 = -fy, fx, fy, -fx
    if fx ~= 0 and fy ~= 0 then
      dx1 = (dx1 + fx) / 2
      dx2 = (dx2 + fx) / 2
      dy1 = (dy1 + fy) / 2
      dy2 = (dy2 + fy) / 2
      len1 = math.modf(len1 * 1.41421)
      for i = 0, len1 do
        if i <= len1 / 2 then
          num = num + 1
          xy[num] = {x + i * fx, y + i * fy}
        end
        for j = 1, len1 - i * 2 do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    else
      for i = 0, len1 do
        num = num + 1
        xy[num] = {x + i * fx, y + i * fy}
        for j = 1, i do
          num = num + 1
          xy[num] = {x + i * fx + j * (dx1), y + i * fy + j * (dy1)}
          num = num + 1
          xy[num] = {x + i * fx + j * (dx2), y + i * fy + j * (dy2)}
        end
      end
    end
  elseif kind == 13 then
    local fx, fy = x - x0, y - y0
    if fx > 1 then
      fx = 1
    elseif fx < -1 then
      fx = -1
    end
    if fy > 1 then
      fy = 1
    elseif fy < -1 then
      fy = -1
    end
    local xx = x + fx * len1
    local yy = y + fy * len1
    for tx = xx - len1, xx + len1 do
      for ty = yy - len1, yy + len1 do
        if len1 < math.abs(tx - xx) + math.abs(ty - yy) then
          break;
        end
        num = num + 1
        xy[num] = {tx, ty}
      end
    end
  else
    return 0
  end

  local w = CC.ScreenW/1360*12
  local zx1 = zx + w
  local zy1 = zy + w
   
  local menu = {}
  -- for i = 1,11 do 
      -- menu[i] = {}
  -- end
  for i = 1,19 do 
      menu[i] = {}
  end
  
  --say("²âÊÔ"..num,0,1)
  for i = 1,num do 
      --menu[xy[i][1]+4][xy[i][2]+4] = 1
  end
  
  for i = 1,19 do 
      for j = 1,19 do
	      local color = 0
		  if menu[i][j] == 1 then
		     color = M_YellowGreen
		  end
		  if i == cx+4 and j == cy+4 then
		     if menu[i][j] == 1 then
				color = C_ORANGE
			 else 	
			    color = C_RED
			 end
		  end
		  lib.Background(zx+(i-1)*(w+1), zy+(j-1)*(w+1),zx1+(i-1)*(w+1),zy1+(j-1)*(w+1),128,color)
	  end
  end
   
end

function Menu_Gongti(pid,num) --¹¦ÌåÑ¡Ôñ 1Íâ¹¦£¬2Íâ¹¦¶ş£¬3ÄÚ¹¦£¬4Çá¹¦£¬5ÕĞ¼Ü
    local tl = {'ÓÅÏÈÊ¹ÓÃ','Ö÷ÔËÄÚ¹¦','ÃÅÅÉ¼¼ÄÜ1','Ö÷ÔËÇá¹¦'} 
    local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
	local size = CC.DefaultFont*0.7
	local size1 = CC.DefaultFont*0.6
	local menu = {};
	local menu1 = {};
	local xz = {'ÔË¹¦','Í£ÔË','È¡Ïû'}
	--lib.LoadPNG(91,(lv+149)*2,bx*660+size1*6,by*60+i*h,1)
    -- lib.LoadPNG(91,163*2,CC.ScreenW/2,CC.ScreenH/2-by*80,2,200,nil,bx*680)
    -- lib.LoadPNG(91,164*2,CC.ScreenW/2,CC.ScreenH/2-by*127.5+by*47.5,2,200,nil,bx*200)
    -- lib.LoadPNG(91,164*2,CC.ScreenW/2,CC.ScreenH/2-by*127.5+by*95,2,200,nil,bx*200)
    -- lib.LoadPNG(91,164*2,CC.ScreenW/2,CC.ScreenH/2-by*127.5,2,200,nil,bx*200)
	--local r = tjm13(xz,#xz,CC.ScreenW/2,CC.ScreenH/2-by*127.5,C_WHITE,size,nil,by*47.5)
	
	lib.LoadPNG(91,163*2,CC.ScreenW/2-by*350,CC.ScreenH/2-by*160,1)
    lib.LoadPNG(91,164*2,CC.ScreenW/2-by*100,CC.ScreenH/2-by*127.5+by*47.5-by*15,1)
    lib.LoadPNG(91,164*2,CC.ScreenW/2-by*100,CC.ScreenH/2-by*127.5+by*95-by*15,1)
    lib.LoadPNG(91,164*2,CC.ScreenW/2-by*100,CC.ScreenH/2-by*127.5-by*15,1)
    local r = tjm13(xz,#xz,CC.ScreenW/2,CC.ScreenH/2-by*127.5,C_WHITE,size,nil,by*47.5)
    if r == 3 or r <= 0 then 
       return 0;
    end
	--ÎŞ·¨Í£ÔË·ÇÔÚ¶ÓÈËÎï
    if r == 2 then 
		if inteam(pid) == false then
			return 0;
		end
	   JY.Person[pid][tl[num]] = 0
	   if tl[num] == 'Ö÷ÔËÄÚ¹¦' then 
	   --ÓÃÓÚË¢ĞÂ×î´óÉúÃüÄÚÁ¦ºÍµ±Ç°ÉúÃüÄÚÁ¦
	   --×î´óÉúÃüÄÚÁ¦ÎŞ·¨³¬¹ıÏŞÖÆÖµ
	   --µ±Ç°ÉúÃüÄÚÁ¦ÎŞ·¨³¬¹ı×î´óÉúÃüÄÚÁ¦
       --   tjm0(pid)
	   Hp_Max(pid)
	   end
	   return 0;
    end
	local WGid
	-- for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
	    -- WGid = JY.Person[pid]["Îä¹¦"..i];
		-- if WGid > 0 then
           -- if num < 3 then 
		      -- if JY.Wugong[WGid]['Îä¹¦ÀàĞÍ'] < 5 then 
		         -- menu[#menu+1] = JY.Wugong[WGid]['Ãû³Æ']
			     -- menu1[#menu1+1] = WGid
		      -- end
		   -- else
		      -- if wglx(WGid,num+2) then 
		         -- menu[#menu+1] = JY.Wugong[WGid]['Ãû³Æ']
			     -- menu1[#menu1+1] = WGid
		      -- end
		   -- end
		-- end
	-- end
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
	    WGid = JY.Person[pid]["Îä¹¦"..i];
		if WGid > 0 then
           if num == 1 then 
		      if JY.Wugong[WGid]['Îä¹¦ÀàĞÍ'] < 6 then 
		         menu[#menu+1] = JY.Wugong[WGid]['Ãû³Æ']
			     menu1[#menu1+1] = WGid
		      end
		   elseif num == 2 then
			 if JY.Wugong[WGid]['Îä¹¦ÀàĞÍ'] == 6 then 
		         menu[#menu+1] = JY.Wugong[WGid]['Ãû³Æ']
			     menu1[#menu1+1] = WGid
		     end
		   elseif num == 3 then
			if JY.Wugong[WGid]['Îä¹¦ÀàĞÍ'] == 6 then 
		         menu[#menu+1] = JY.Wugong[WGid]['Ãû³Æ']
			     menu1[#menu1+1] = WGid
		     end
		   elseif num == 4 then
		     if JY.Wugong[WGid]['Îä¹¦ÀàĞÍ'] == 7 then 
		         menu[#menu+1] = JY.Wugong[WGid]['Ãû³Æ']
			     menu1[#menu1+1] = WGid
		     end
		   end
		end
	end
	
	--lib.LoadPNG(91,126*2,bx*745,by*46,1,nil,nil,bx*380)
	lib.LoadPNG(91,165*2,bx*745,by*46,1)
	if #menu <= 0 or (num == 3 and JY.Person[pid][tl[num]] < 1) or inteam(pid) == false then
		if num == 3 and JY.Person[pid][tl[num]] < 1 then
			DrawString(bx*935-string.len('Î´¿ªÆôµÚ¶şÔË¹¦')/4*size,by*136-size/2,'Î´¿ªÆôµÚ¶şÔË¹¦',C_WHITE,size)
		else
		    DrawString(bx*935-string.len('Ã»ÓĞ¿ÉÔËÎä¹¦')/4*size,by*136-size/2,'Ã»ÓĞ¿ÉÔËÎä¹¦',C_WHITE,size)
		end
		ShowScreen()
		WaitKey()
		return 0;
	end
    local r = tjm13(menu,#menu,bx*935,by*56+size1,C_WHITE,size1,5,nil)
	if r <= 0 then 
	   return 0 
	end
	JY.Person[pid][tl[num]] = menu1[r] --ÉèÖÃ¹¦Ìå	
	
	--ÄÚ¹¦Ì×Â·¸ù¾İµ±Ç°ÄÚ¹¦µ÷ÕûÉúÃüÄÚÁ¦
	--ÇĞ»»ÄÚ¹¦Ğè½÷É÷
	if tl[num] == 'Ö÷ÔËÄÚ¹¦' then 
	   --ÓÃÓÚË¢ĞÂ×î´óÉúÃüÄÚÁ¦ºÍµ±Ç°ÉúÃüÄÚÁ¦
	   --×î´óÉúÃüÄÚÁ¦ÎŞ·¨³¬¹ıÏŞÖÆÖµ
	   --µ±Ç°ÉúÃüÄÚÁ¦ÎŞ·¨³¬¹ı×î´óÉúÃüÄÚÁ¦
    --   tjm0(pid)
		Hp_Max(pid)
	end
end

function wglx(wugong,a)
   if JY.Wugong[wugong]["Îä¹¦ÀàĞÍ"] == a then 
   return true
   end
   return false
end
function tjm0(id,flag)
   AddPersonAttrib(id,'ÄÚÁ¦×î´óÖµ',math.huge)
   AddPersonAttrib(id,'ÉúÃü×î´óÖµ',math.huge)
   AddPersonAttrib(id,'ÉúÃü',0)
   AddPersonAttrib(id,'ÄÚÁ¦',0)
   if flag == 1 then 
      AddPersonAttrib(id,'ÉúÃü',math.huge)
      AddPersonAttrib(id,'ÄÚÁ¦',math.huge)
   end	  
end
function tjm13(menu,menu1,x,y,color,size,num,high,flag)
   local bx = CC.ScreenW/1360
   local by = CC.ScreenH/768
   local p1x,p1y = bx*200,by*30
   local cont = 1
   local cont1 = 0
   local page = 1
   
   --Ä¬ÈÏ¸ß¶È¼ä¸ô
   local h = size*1.2
   
   --×Ô¶¨Òå¼ä¸ô
   if high ~= nil then 
      h = high
   end
   
   --×Ô¶¨ÒåÏÔÊ¾µÄÁĞ±íÊıÁ¿
   if num == nil then
      num = menu1
   else 
      if num > menu1 then 
         num = menu1
      end	  
   end  
   
   local tru = 0
   local surid = lib.SaveSur(0, 0, CC.ScreenW, CC.ScreenH)
   while true do 
      Cls() 
	  lib.LoadSur(surid,0,0)
	  for ii = 1,num do
	      local color = C_WHITE
		  if ii + cont1 == cont +cont1 then
		     color = C_RED
		  end 
		  if flag == nil then
		     DrawString(x-string.len(menu[ii+cont1])/4*size,y+(ii-1)*h-size/2, menu[ii+cont1], color, size)
		  else 
             DrawString(x,y+(ii-1)*h, menu[ii+cont1], color, size)
          end		  
	  end
	  
	  ShowScreen()
	  lib.Delay(20)
	    local X,ktype,mx,my = lib.GetKey()
	    if X == VK_SPACE or X == VK_RETURN then 
           tru = cont + cont1 
		   break
		elseif X == VK_ESCAPE or ktype == 4 then
          break
		elseif X == VK_UP then
		  if cont1 > 0 then 
		     if cont > 1 then 
		        cont = cont - 1
			 else 
                cont1 = cont1 - 1	  
			 end	
		  else
             cont = cont - 1		
		  if cont < 1 then 
		     cont = num
			 cont1 = menu1 - cont
		  end
		  end
		elseif X == VK_DOWN then
          cont = cont + 1		
		  if cont > num then 
		     cont = num
			 cont1 = cont1 + 1
		  end
		  if cont1 + cont > menu1 then 
		     cont1 = 0
			 cont = 1
		  end
		elseif X == VK_LEFT or ktype == 6 then
		        cont1 = cont1 - num
				cont = 1
				if cont1 < 0 then 
				   cont1 = 0 
				end
		elseif X == VK_RIGHT or ktype == 7 then
		        cont1 = cont1 + num
				cont = num
				if cont1 + cont > menu1 then 
				   cont1 = menu1-cont
				end	
	    else 
		    local mxx = false
            for ii = 1,num do 

		
            end		
            if ktype == 3 and mxx == true then 
		       tru = cont+cont1
		       break
            end	
	    end
   end
   lib.FreeSur(surid)
   return tru 
end
function QUANZHANGQX1()
	local teamid = Team()
	local id = -1
	if teamid ~= nil and teamid > 0 then
		id = JY.Base["¶ÓÎé" .. teamid]
	else
		do return end
	end	
	if id ~= nil  then	
		QUANZHANGQX(id)
	end
	
	
	
	
end

--function QUANZHANGQX(teamid)
function QUANZHANGQX(teamid)
	--Í¨ÓÃ
	--ÆæÑ¨ÏµÍ³
	-- local bx = CC.WX
	-- local by = CC.HY
	
	
	local bx = CC.ScreenW/1360
    local by = CC.ScreenH/768
	local lb = 2
	local tb = 1
	local tb1 = 1
	local pg = 1
	local ZUOBIAO1 = {{458,479},{559,479}}
	local WZ1 = {"¼¤»î","·µ»Ø"}
	local WZ2 = {"Éı¼¶","·µ»Ø"}
	local WZ3 = {"Âú¼¶","·µ»Ø"}	

	--local teamid = Team()
	--local id = JY.Base["¶ÓÎé" .. teamid]
	local id = teamid
	local size = CC.DefaultFont*0.7
	local tfstr
	local size1= CC.DefaultFont*0.9
	local SHUOMING = 0
	local JIANGE = 29
	local tb1x = 35 + bx*212
	local tb1y = 15 + by*33
	local tb2 = 1
	local p = JY.Person[id]
	--È­ÕÆÆæÑ¨
	local QZZB = {{159,351},					
				{247,260},{347,260},{448,260},{572,302},{785,260},								
				{247,351},{347,351},{448,351},{705,351},
				{247,449},{347,449},{545,449},{648,449},{785,449},
				{247,543},{448,543},{545,543},{648,543},{785,543},}
	
	local QZWZ = {"È­ÇãÌìÏÂ",
				"°ÔÍõ¾ªÀ×","ÅÅÉ½µ¹º£","·­½­µ¹º£","³ÁÔªÆÆÔÂ","Ì©É½Ñ¹¶¥",
				"¾ıÁÙÌìÏÂ","°Á¿´²ÔÉú","¼ÃÊÀÎª»³","¶÷Ôó²ÔÉú",
				"Ãû¶¯É½ºÓ","ÎÊ¶¦ÌìÏÂ","×İºáÓîÄÚ","Ìì»úÄÑÑ°","Ö÷Ô×ÈËÉñ",
				"»Ø»êÆß´Ì","Ğ°Ôª¹Æ¶¾","ÆßÎíÂéÏã","ÈıÈÕ¶Ï³¦","Ëø½îÊ´¹Ç"}
	local QZQX1 ={}
	local QZQX2 ={}
	local QZQX3 ={}
	local QZQX4 ={}
	local QZQX5 ={}
	local QZQX6 ={}	
	--Ö¸·¨
	local ZFZB = {
				{160,349},	{250,256},{347,256},{450,256},{554,256},{764,256},
							{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
							{250,446},{347,446},{554,446},{648,446},{764,446},
							{347,547},{450,547},{648,547},{764,547},
		}	
	local ZFQX0 ={}
	local ZFQX1 ={}
	local ZFQX2 ={}
	local ZFQX3 ={}
	local ZFQX4 ={}
	local ZFQX5 ={}
	local ZFQX6 ={}				
	--ÄÚ¹¦			
	local NGZB = {
					{357,256},{479,256},{597,256},{719,256},
					{164,349},{286,349},{412,349},{536,349},{662,349},{786,349},
					{164,442},{286,442},{536,442},{662,442},{786,442},
					{164,534},{286,534},{412,534},{536,534},{662,534},
					}			
	local NGQX0 ={}				
	local NGQX1 ={}
	local NGQX2 ={}
	local NGQX3 ={}
	local NGQX4 ={}
	local NGQX5 ={}
	local NGQX6 ={}	
	--½£·¨
	local JFZB = {
				{160,349},	{250,256},{347,256},{450,256},{554,256},{764,256},
							{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
							{250,446},{347,446},{554,446},{648,446},{764,446},
							{347,547},{450,547},{648,547},{764,547},
		}
	local JFQX0 ={}				
	local JFQX1 ={}
	local JFQX2 ={}
	local JFQX3 ={}
	local JFQX4 ={}
	local JFQX5 ={}
	local JFQX6 ={}		
	--Ë£µ¶
	local SDZB = {
				{160,349},	
				{250,256},{347,256},{450,256},{554,256},{764,256},
				{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
				{250,446},{347,446},{554,446},{648,446},{764,446},
				{347,547},{450,547},{648,547},{764,547},
		}
	local SDQX0 ={}				
	local SDQX1 ={}
	local SDQX2 ={}
	local SDQX3 ={}
	local SDQX4 ={}
	local SDQX5 ={}
	local SDQX6 ={}		
	--ÆæÃÅ
	local QMZB = {
				{160,349},	{250,256},{347,256},{450,256},{554,256},{764,256},
							{250,349},{347,349},{450,349},{554,349},{648,313},{764,349},
							{250,446},{347,446},{554,446},{648,446},{764,446},
							{347,547},{450,547},{648,547},{764,547},
		}
	local QMQX0 ={}				
	local QMQX1 ={}
	local QMQX2 ={}
	local QMQX3 ={}
	local QMQX4 ={}
	local QMQX5 ={}
	local QMQX6 ={}		
	while true do 
		if JY.Restart == 1 then
			break
		end
		Cls()	
		local dianshu = 0	
		local wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]
		local wxds1=JY.Person[523]["ÉùÍû"]
		local wxds2=JY.Person[524]["ÉùÍû"]
		local wxds3=JY.Person[525]["ÉùÍû"]	
		local wxds4=JY.Person[id]["ÎäÑ§µãÊı"]
		--È­ÕÆÆæÑ¨
		--lib.PicLoadCache(92,(5+i)*2,CC.ScreenW/2-((#menu-1)*bx*120)/2+(i-1)*bx*120,CC.ScreenH/2+by*60+py,6,150,nil,bx*100)
		--lib.PicLoadCache(92,jm[i+cont1][2]*2,(i)*w-num*w+sx+aa,y-CC.ScreenH/768*30,2,240,nil,CC.ScreenW/1360*85)
		if pg == 1 then	
			--lib.PicLoadCache(92,67*2,bx*212,by*33,1)
			lib.PicLoadCache(92,67*2,0,0,1)
			--lib.PicLoadCache(92,67*2,bx*212,by*33,2,240,nil,CC.ScreenW/1360*85)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["ĞÕÃû"])/2*size1,by*33+ by*73, JY.Person[id]["ĞÕÃû"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
					
			for i = 1,#QZWZ do
				local cl = C_CYGOLD
				local level = JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..i]
				if CC.QUAHZQX[i] ~= nil then
					QZQX1[#QZQX1+1] = '£Ç'..CC.QUAHZQX[i][1] --ÆæÑ¨Ãû×Ö
					QZQX2[#QZQX2+1] = '£Ì'..CC.QUAHZQX[i][2] --ÆæÑ¨¼¤»îÌõ¼ş	
					QZQX3[#QZQX3+1] = '£×'..CC.QUAHZQX[i][3] --ÆæÑ¨ËµÃ÷
					QZQX4[#QZQX4+1] = CC.QUAHZQX[i][4] --ÆæÑ¨Éı¼¶µãÊı
					QZQX5[#QZQX5+1] = CC.QUAHZQX[i][5] --ÆæÑ¨×î´óµÈ¼¶	
					QZQX6[#QZQX6+1] = CC.QUAHZQX[i][6] --ÆæÑ¨ĞèÇóÏµÊı														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..i] > 0  then
					lib.PicLoadCache(92,(70+i-1)*2,bx*212+bx*QZZB[i][1]-bx*22.5,by*33+by*QZZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(91+i-1)*2,bx*212+bx*QZZB[i][1]-bx*22.5,by*33+by*QZZB[i][2]-by*22.5,1)
				end	
				DrawString(bx*212+bx*QZZB[i][1]-string.len(QZWZ[i])/4*size*0.9,by*33+by*QZZB[i][2]-by*40,QZWZ[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0
										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),QZQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
					--if QZQX5[tb] - JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] > 0 then
					--	local XIAODIAN = math.modf(QZQX4[tb] + (QZQX4[tb] * JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] - 1)*0.2)+1
					--	h = tjm(bx*212+bx*360+string.len(QZQX1[tb])/4*size*1.4,by*33+  by*233+size* (hs-FY), "["..JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb].."/" .. QZQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
				--	else
					--	h = tjm(bx*212+bx*360+string.len(QZQX1[tb])/4*size*1.4,by*33+  by*233+size* (hs-FY), "["..JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb].."/" .. QZQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					--end	
					hs = hs + h
					if QZQX5[tb] - JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] > 0 then
						local XIAODIAN = math.modf(QZQX4[tb] + (QZQX4[tb] * JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] - 1)*0.2)+1
						h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),"["..JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb].."/" .. QZQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),"["..JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb].."/" .. QZQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end	
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),QZQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+  by*235+size* (hs-FY),QZQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] - QZQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = QZQX4[tb]
					if QZQX5[tb] - JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"ÒÑ¾­Éıµ½×î´óµÈ¼¶",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"Î´´ïµ½¼¤»îÌõ¼ş",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"ĞŞÁ¶µãÊı²»¹»",C_RED,size*1.4)
					end	
				end	
			end
		--Ö¸·¨
		elseif pg == 2 then
			lib.PicLoadCache(92,111*2,0,0,1)	
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["ĞÕÃû"])/2*size1,by*33+ by*73, JY.Person[id]["ĞÕÃû"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end			
			for i = 1,#ZFZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..i]
				if CC.ZHIFQX[i] ~= nil then
					ZFQX0[#ZFQX0+1] = CC.ZHIFQX[i][1] --ÆæÑ¨Ãû×Ö
					ZFQX1[#ZFQX1+1] = '£Ç'..CC.ZHIFQX[i][1] --ÆæÑ¨Ãû×Ö
					ZFQX2[#ZFQX2+1] = '£Ì'..CC.ZHIFQX[i][2] --ÆæÑ¨¼¤»îÌõ¼ş	
					ZFQX3[#ZFQX3+1] = '£×'..CC.ZHIFQX[i][3] --ÆæÑ¨ËµÃ÷
					ZFQX4[#ZFQX4+1] = CC.ZHIFQX[i][4] --ÆæÑ¨Éı¼¶µãÊı
					ZFQX5[#ZFQX5+1] = CC.ZHIFQX[i][5] --ÆæÑ¨×î´óµÈ¼¶	
					ZFQX6[#ZFQX6+1] = CC.ZHIFQX[i][6] --ÆæÑ¨ĞèÇóÏµÊı														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..i] > 0  then
					lib.PicLoadCache(92,(207+i-1)*2,bx*212+bx*ZFZB[i][1]-bx*22.5,by*33+by*ZFZB[i][2]-by*22.5,1)
					--lib.PicLoadCache(92,(165+i-1)*2,0,0,1)				 	
				else	
					lib.PicLoadCache(92,(228+i-1)*2,bx*212+bx*ZFZB[i][1]-bx*22.5,by*33+by*ZFZB[i][2]-by*22.5,1)
					--lib.PicLoadCache(92,(165+i-1)*2,0,0,1)
				end	
				--ÆæÑ¨Ãû×Ö
				DrawString(bx*212+bx*ZFZB[i][1]-string.len(ZFQX0[i])/4*size*0.9,by*33+by*ZFZB[i][2]-by*40,ZFQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),ZFQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
						
					hs = hs + h
					if ZFQX5[tb] - JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] > 0 then
						local XIAODIAN = ZFQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb].."/" .. ZFQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb].."/" .. ZFQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),ZFQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),ZFQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] - ZFQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = ZFQX4[tb]
					if ZFQX5[tb] - JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"ÒÑ¾­Éıµ½×î´óµÈ¼¶",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"Î´´ïµ½¼¤»îÌõ¼ş",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"ĞŞÁ¶µãÊı²»¹»",C_RED,size*1.4)
					end	
				end	
			end	
		--½£·¨
		elseif pg == 3 then
			lib.PicLoadCache(92,112*2,0,0,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["ĞÕÃû"])/2*size1, by*33+by*73, JY.Person[id]["ĞÕÃû"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end			
			for i = 1,#JFZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..i]
				if CC.JIANFQX[i] ~= nil then
					JFQX0[#JFQX0+1] = CC.JIANFQX[i][1] --ÆæÑ¨Ãû×Ö
					JFQX1[#JFQX1+1] = '£Ç'..CC.JIANFQX[i][1] --ÆæÑ¨Ãû×Ö
					JFQX2[#JFQX2+1] = '£Ì'..CC.JIANFQX[i][2] --ÆæÑ¨¼¤»îÌõ¼ş	
					JFQX3[#JFQX3+1] = '£×'..CC.JIANFQX[i][3] --ÆæÑ¨ËµÃ÷
					JFQX4[#JFQX4+1] = CC.JIANFQX[i][4] --ÆæÑ¨Éı¼¶µãÊı
					JFQX5[#JFQX5+1] = CC.JIANFQX[i][5] --ÆæÑ¨×î´óµÈ¼¶	
					JFQX6[#JFQX6+1] = CC.JIANFQX[i][6] --ÆæÑ¨ĞèÇóÏµÊı														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..i] > 0  then
					lib.PicLoadCache(92,(165+i-1)*2,bx*212+bx*JFZB[i][1]-bx*22.5,by*33+by*JFZB[i][2]-by*22.5,1)	
					
				else	
					lib.PicLoadCache(92,(186+i-1)*2,bx*212+bx*JFZB[i][1]-bx*22.5,by*33+by*JFZB[i][2]-by*22.5,1)
					
				end	
				--ÆæÑ¨Ãû×Ö
				DrawString(bx*212+bx*JFZB[i][1]-string.len(JFQX0[i])/4*size*0.9,by*33+by*JFZB[i][2]-by*40,JFQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0										
					h = tjm(bx*212+bx*328, by*33+by*230+size*1.4* (hs-FY),JFQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
						
					hs = hs + h
					if JFQX5[tb] - JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] > 0 then
						local XIAODIAN = JFQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb].."/" .. JFQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb].."/" .. JFQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),JFQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),JFQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] - JFQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = JFQX4[tb]
					if JFQX5[tb] - JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"ÒÑ¾­Éıµ½×î´óµÈ¼¶",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"Î´´ïµ½¼¤»îÌõ¼ş",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"ĞŞÁ¶µãÊı²»¹»",C_RED,size*1.4)
					end	
				end	
			end		
		--Ë£µ¶
		elseif pg == 4 then
			lib.PicLoadCache(92,113*2,0,0,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["ĞÕÃû"])/2*size1,by*33+ by*73, JY.Person[id]["ĞÕÃû"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
			--1Ãû³Æ £¬ 2 Ìõ¼ş£¬ 3Ğ§¹û£¬4ÏûºÄ£¬5µÈ¼¶£¬6Óù½£Ìõ¼ş
			for i = 1,#SDZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..i]
				if CC.SHUADQX[i] ~= nil then
					SDQX0[#SDQX0+1] = CC.SHUADQX[i][1] --ÆæÑ¨Ãû×Ö
					SDQX1[#SDQX1+1] = '£Ç'..CC.SHUADQX[i][1] --ÆæÑ¨Ãû×Ö
					SDQX2[#SDQX2+1] = '£Ì'..CC.SHUADQX[i][2] --ÆæÑ¨¼¤»îÌõ¼ş	
					SDQX3[#SDQX3+1] = '£×'..CC.SHUADQX[i][3] --ÆæÑ¨ËµÃ÷
					SDQX4[#SDQX4+1] = CC.SHUADQX[i][4] --ÆæÑ¨Éı¼¶µãÊı
					SDQX5[#SDQX5+1] = CC.SHUADQX[i][5] --ÆæÑ¨×î´óµÈ¼¶	
					SDQX6[#SDQX6+1] = CC.SHUADQX[i][6] --ÆæÑ¨ĞèÇóÏµÊı														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..i] > 0  then
					lib.PicLoadCache(92,(249+i-1)*2,bx*212+bx*SDZB[i][1]-bx*22.5,by*33+by*SDZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(270+i-1)*2,bx*212+bx*SDZB[i][1]-bx*22.5,by*33+by*SDZB[i][2]-by*22.5,1)
				end	
				--ÆæÑ¨Ãû×Ö
				DrawString(bx*212+bx*SDZB[i][1]-string.len(SDQX0[i])/4*size*0.9,by*33+by*SDZB[i][2]-by*40,SDQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0
										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),SDQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
					--if SDQX5[tb] - JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] > 0 then
						--local XIAODIAN = SDQX4[tb]
						--h = tjm(bx*212+bx*360+string.len(SDQX1[tb])/4*size*1.4,by*33+ by*33+by*233+size* (hs-FY), "["..JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb].."/" .. SDQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					--else
						--h = tjm(bx*212+bx*360+string.len(SDQX1[tb])/4*size*1.4,by*33+ by*233+size* (hs-FY), "["..JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb].."/" .. SDQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					--end	
					
					hs = hs + h
					if SDQX5[tb] - JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] > 0 then
						local XIAODIAN = SDQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb].."/" .. SDQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb].."/" .. SDQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end	
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),SDQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),SDQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] - SDQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = SDQX4[tb]
					if SDQX5[tb] - JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] == 0 then
						DrawString(bx*212+bx*382,by*33+ by*359,"ÒÑ¾­Éıµ½×î´óµÈ¼¶",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"Î´´ïµ½¼¤»îÌõ¼ş",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"ĞŞÁ¶µãÊı²»¹»",C_RED,size*1.4)
					end	
				end	
			end	
		--ÆæÃÅ
		elseif pg == 5 then
			lib.PicLoadCache(92,114*2,0,0,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["ĞÕÃû"])/2*size1, by*33+by*73, JY.Person[id]["ĞÕÃû"], C_CYGOLD, size1)
			if wxds3>0 then
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
			DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
			
			for i = 1,#QMZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..i]
				if CC.QIMQX[i] ~= nil then
					QMQX0[#QMQX0+1] = CC.QIMQX[i][1] --ÆæÑ¨Ãû×Ö
					QMQX1[#QMQX1+1] = '£Ç'..CC.QIMQX[i][1] --ÆæÑ¨Ãû×Ö
					QMQX2[#QMQX2+1] = '£Ì'..CC.QIMQX[i][2] --ÆæÑ¨¼¤»îÌõ¼ş	
					QMQX3[#QMQX3+1] = '£×'..CC.QIMQX[i][3] --ÆæÑ¨ËµÃ÷
					QMQX4[#QMQX4+1] = CC.QIMQX[i][4] --ÆæÑ¨Éı¼¶µãÊı
					QMQX5[#QMQX5+1] = CC.QIMQX[i][5] --ÆæÑ¨×î´óµÈ¼¶	
					QMQX6[#QMQX6+1] = CC.QIMQX[i][6] --ÆæÑ¨ĞèÇóÏµÊı														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..i] > 0  then
					lib.PicLoadCache(92,(291+i-1)*2,bx*212+bx*QMZB[i][1]-bx*22.5,by*33+by*QMZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(312+i-1)*2,bx*212+bx*QMZB[i][1]-bx*22.5,by*33+by*QMZB[i][2]-by*22.5,1)
				end	
				--ÆæÑ¨Ãû×Ö
				DrawString(bx*212+bx*QMZB[i][1]-string.len(QMQX0[i])/4*size*0.9,by*33+by*QMZB[i][2]-by*40,QMQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0
										
					h = tjm(bx*212+bx*328,by*33+ by*230+size*1.4* (hs-FY),QMQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
						
					hs = hs + h
					if QMQX5[tb] - JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] > 0 then
						local XIAODIAN = QMQX4[tb]
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb].."/" .. QMQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),"["..JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb].."/" .. QMQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),QMQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328,by*33+ by*235+size* (hs-FY),QMQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] - QMQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = QMQX4[tb]
					if QMQX5[tb] - JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] == 0 then
						DrawString(bx*212+bx*382, by*33+by*359,"ÒÑ¾­Éıµ½×î´óµÈ¼¶",C_RED,size*1.4)
					elseif wxds - XIAODIAN > 0  then
						DrawString(bx*212+bx*382,by*33+ by*359,"Î´´ïµ½¼¤»îÌõ¼ş",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382,by*33+ by*359,"ĞŞÁ¶µãÊı²»¹»",C_RED,size*1.4)
					end	
				end	
			end	
		--ÄÚ¹¦
		--[[elseif pg == 6 then
			lib.PicLoadCache(92,115*2,0,0,1)
			DrawString(bx*212+bx*515-string.len(JY.Person[id]["ĞÕÃû"])/2*size1,by*33+ by*73, JY.Person[id]["ĞÕÃû"], C_CYGOLD, size1)
			if wxds3>0 then
				DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 +"..wxds3.."/1500 -"..wxds4..")",C_CYGOLD,size)	
			else
				DrawString(bx*212+bx*380,by*33+by*125,"ÎäÑ§µãÊı "..wxds.." ("..wxds1.."/500 +"..wxds2.."/250 -"..wxds4..")",C_CYGOLD,size)	
			end
			for i = 1,#NGZB do
				local cl = C_CYGOLD
				local level = JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..i]
				if CC.NEIGQX[i] ~= nil then
					NGQX0[#NGQX0+1] = CC.NEIGQX[i][1] --ÆæÑ¨Ãû×Ö
					NGQX1[#NGQX1+1] = '£Ç'..CC.NEIGQX[i][1] --ÆæÑ¨Ãû×Ö
					NGQX2[#NGQX2+1] = '£Ì'..CC.NEIGQX[i][2] --ÆæÑ¨¼¤»îÌõ¼ş	
					NGQX3[#NGQX3+1] = '£×'..CC.NEIGQX[i][3] --ÆæÑ¨ËµÃ÷
					NGQX4[#NGQX4+1] = CC.NEIGQX[i][4] --ÆæÑ¨Éı¼¶µãÊı
					NGQX5[#NGQX5+1] = CC.NEIGQX[i][5] --ÆæÑ¨×î´óµÈ¼¶	
					NGQX6[#NGQX6+1] = CC.NEIGQX[i][6] --ÆæÑ¨ĞèÇóÏµÊı														
				end
				if  lb == 3 or lb == 4 or lb == 5 then				
					if tb == i then
						cl = C_RED													
					end	
				end		
				if JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..i] > 0  then
					lib.PicLoadCache(92,(125+i-1)*2,bx*212+bx*NGZB[i][1]-bx*22.5,by*33+by*NGZB[i][2]-by*22.5,1)				 	
				else	
					lib.PicLoadCache(92,(145+i-1)*2,bx*212+bx*NGZB[i][1]-bx*22.5,by*33+by*NGZB[i][2]-by*22.5,1)
				end	
				DrawString(bx*212+bx*NGZB[i][1]-string.len(NGQX0[i])/4*size*0.9,by*33+by*NGZB[i][2]-by*40,NGQX0[i],cl,size*0.9)	
				if lb == 4 then
					lib.PicLoadCache(92,69*2,bx*212+bx*300,by*33+by*226,1)						
					local hs = 0
					local FY = 0
					local ZUIDHS = 15
					local h = 0										
					h = tjm(bx*212+bx*328, by*33+by*230+size*1.4* (hs-FY),NGQX1[tb], C_WHITE, size*1.4,18,size*1.4,FY-hs,ZUIDHS+1-hs+FY)
					
					hs = hs + h
					if NGQX5[tb] - JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] > 0 then
						local XIAODIAN = NGQX4[tb]
						h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX2[tb],"["..JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb].."/" .. NGQX5[tb].."]" .. "ÏûºÄÎäÑ§µãÊı" .. XIAODIAN, LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					else
						h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX2[tb],"["..JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb].."/" .. NGQX5[tb].."]" .. "ÒÑÉıµ½×î´óµÈ¼¶", LightPurple, size,18,size,FY-hs,ZUIDHS+1-hs+FY)
					end	
					hs = hs + h
					h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX2[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					h = tjm(bx*212+bx*328, by*33+by*235+size* (hs-FY),NGQX3[tb], C_WHITE, size,16,size,FY-hs,ZUIDHS+1-hs+FY)
					hs = hs + h
					for zi = 1,#ZUOBIAO1 do						
						local cl1 = C_CYGOLD
						if tb2 == zi then
							cl1 = C_RED
						end		
						if JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] < 1 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ1[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ1[zi],cl1,size)	
						elseif 	JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] - NGQX5[tb] == 0 then
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ3[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ3[zi],cl1,size)	
						else
							DrawString(bx*212+bx*ZUOBIAO1[zi][1]-string.len(WZ2[zi])/4*size,by*33+by*ZUOBIAO1[zi][2]-by*14,WZ2[zi],cl1,size)	
						end		
					end
				end
				if lb == 5 then
					local XIAODIAN = NGQX4[tb]
					if NGQX5[tb] - JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] == 0 then
						DrawString(bx*212+bx*382, by*33+by*359,"ÒÑ¾­Éıµ½×î´óµÈ¼¶",C_RED,size*1.4)
					elseif wxds - XIAODIAN >= 0  then
						DrawString(bx*212+bx*382, by*33+by*359,"Î´´ïµ½¼¤»îÌõ¼ş",C_RED,size*1.4)
					else
						DrawString(bx*212+bx*382, by*33+by*359,"ĞŞÁ¶µãÊı²»¹»",C_RED,size*1.4)
					end	
				end	
			end	]]	
		end		
		lib.PicLoadCache(92,121*2,bx*212+bx*826, by*33+by*78,1)
		if SHUOMING == 1 then
			local size1 = CC.DefaultFont
			lib.PicLoadCache(92,122*2,bx*212+bx*300, by*33+by*226,1)			
			local hs = 0
			local FY = 0
			local ZUIDHS = 15
			local h = 0
			local CAOZSM = {}  
			for z = 1,#CC.QXCZSM do
				CAOZSM[#CAOZSM+1] = CC.QXCZSM[z]
			end	
			h = tjm(bx*212+bx*454,  by*33+by*227,CAOZSM[1], C_CYGOLD, size1*0.9,15,size1*0.9,FY-hs,ZUIDHS+1-hs+FY)	
			hs = hs + h							
			h = tjm(bx*212+bx*328,  by*33+by*260,CAOZSM[2], C_WHITE, size1*0.7,15,size1*0.7,FY-hs,ZUIDHS+1-hs+FY)
			hs = hs + h			
		end
		ShowScreen()
		lib.Delay(CC.BattleDelay)
		local X, ktype, mx, my = lib.GetKey();
		if X == VK_SPACE or X == VK_RETURN then
			if SHUOMING ==  1 then
				SHUOMING = 0
			elseif lb == 1 then
				lb = 2 
			elseif lb == 2 then
				lb = 3
			elseif lb == 3 then
				lb = 4
			elseif lb == 4  then
				if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then
					--È­ÕÆÆæÑ¨
					if pg == 1  then
						local PANDING = 0
						local XIAODIAN = QZQX4[tb]
						if wxds - XIAODIAN >= 0 and QZQX5[tb] - JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] > 0 and TrueQZ(id) - QZQX6[tb] >= 0 then										
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 then
								PANDING = 1	
							elseif tb == 2 and 	JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
								PANDING = 1										
							elseif tb == 7 and 	JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
								PANDING = 1
							elseif tb == 11 and JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
								PANDING = 1
							elseif tb == 16 and JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
								PANDING = 1
							elseif tb == 5 and JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶9"] >= 2 or JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶4"] >= 2 then
								PANDING = 1	
							end
							local m = {2,7,11,16,5}
							local pd = true 
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false 
								end
							end
							if  pd == true and JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..n] >= 2   then
								PANDING = 1	
							end							
							if PANDING ==  0 then
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] + 1
								JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN	
								wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]	
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if QZQX5[tb] - JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] < 1 then
							JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] = QZQX5[tb]						
						end
					--Ö¸·¨
					elseif pg == 2 then
						local PANDING = 0
						local XIAODIAN = ZFQX4[tb]
						if wxds - XIAODIAN >= 0 and ZFQX5[tb] - JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] > 0 and TrueZF(id) - ZFQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 then
								PANDING = 1	
							end	
							if tb == 2 and 	JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶1"] >= 3 then
								PANDING = 1
							end									
							if tb == 7 and 	JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶1"] >= 3 then
								PANDING = 1
							end	
							if tb == 12 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶10"] >= 2  then
								PANDING = 1
							end										
							if tb == 13 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶1"] >= 3  then
								PANDING = 1
							end	
							if tb == 14 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶13"] >= 2  then
								PANDING = 1	
							end							
							if tb == 19 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶15"] >= 2   then
								PANDING = 1	
							end	
							if tb == 18 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶19"] >= 5 then
								PANDING = 1	
							end	
							if tb == 20 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶15"] >= 2  then
								PANDING = 1	
							end
							local m = {2,7,12,13,14,18,19,20}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..n] >= 2 then
								PANDING = 1	
							end											
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] + 1
								JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN	
								wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]		
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if ZFQX5[tb] - JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] < 1 then
							JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] = ZFQX5[tb]						
						end
					
					--Óù½£
					elseif pg == 3 then
						local PANDING = 0
						local XIAODIAN = JFQX4[tb]
						if wxds - XIAODIAN >= 0 and JFQX5[tb] - JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] > 0 and TrueYJ(id)+(WuyueJFSL(id)*20) - JFQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end	
								if tb == 11 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶10"] >= 1  then
									PANDING = 1
								end			
								if tb == 12 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶10"] >= 1  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶13"] >= 2 then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶15"] >= 2 then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶19"] >= 5 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶15"] >= 2 then
									PANDING = 1	
								end
							local m = {2,7,11,12,13,14,18,19,20}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..n] >= 2 then
								PANDING = 1	
							end									
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] + 1
								JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN	
								wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]		
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if JFQX5[tb] - JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] < 1 then
							JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] = JFQX5[tb]						
						end
					--Ë£µ¶
					elseif pg == 4  then
						local PANDING = 0
						local XIAODIAN = SDQX4[tb]
						if wxds - XIAODIAN >= 0 and SDQX5[tb] - JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] > 0 and TrueSD(id) - SDQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 then
								PANDING = 1	
							end	
							if tb == 2 and 	JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶1"] >= 3 then
								PANDING = 1
							end									
							if tb == 7 and 	JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶1"] >= 3 then
								PANDING = 1
							end										
							if tb == 13 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶1"] >= 3  then
								PANDING = 1
							end							
							if tb == 18 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶1"] >= 5  then
								PANDING = 1	
							end	
							if tb == 19 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶18"] >= 1 then
								PANDING = 1	
							end	
							if tb == 20 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶19"] >= 1  then
								PANDING = 1	
							end
							if tb == 21 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶20"] >= 1  then
								PANDING = 1	
							end
							local m = {2,7,13,18,19,20,21}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..n] >= 2 then
								PANDING = 1	
							end											
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] + 1
								JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN
								wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]			
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if SDQX5[tb] - JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] < 1 then
							JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] = SDQX5[tb]						
						end
					--ÆæÃÅ
					elseif pg == 5  then
						local PANDING = 0
						local XIAODIAN = QMQX4[tb]
						if wxds - XIAODIAN >= 0 and QMQX5[tb] - JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] > 0 and TrueTS(id) - QMQX6[tb] >= 0 then
							local n = tb - 1
							if n < 1 then
								n = 1
							end											
							if tb == 1 and JY.Person[id]['ÌØÊâ±øÆ÷'] >= 100 then
								PANDING = 1	
							end	
							if tb == 5 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶4"] >= 2 then
								PANDING = 1
							end
							if tb == 6 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶5"] >= 2 then
								PANDING = 1
							end
							if tb == 7 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 3 then
								PANDING = 1
							end
							if tb == 10 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶9"] >= 2 then
								PANDING = 1
							end
							if tb == 11 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶10"] >= 2 then
								PANDING = 1
							end
							if tb == 12 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶11"] >= 1 then
								PANDING = 1
							end
							if tb == 13 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 4 then
								PANDING = 1
							end
							if tb == 14 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 4 then
								PANDING = 1
							end
							if tb == 15 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 4 then
								PANDING = 1
							end
							if tb == 16 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 4 then
								PANDING = 1
							end
							if tb == 17 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 4 then
								PANDING = 1
							end
							if tb == 18 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 5 then
								PANDING = 1
							end
							if tb == 19 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶18"] >= 1 then
								PANDING = 1
							end
							if tb == 20 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶19"] >= 1 then
								PANDING = 1
							end
							if tb == 21 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶20"] >= 1 then
								PANDING = 1
							end
							local m = {5,6,7,10,11,12,13,14,15,16,17,18,19,20,21}
							local pd = true
							for ti = 1,#m do
								if tb == m[ti] then
									pd = false
								end
							end
							if pd == true and  JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..n] >= 3 then
								PANDING = 1	
							end											
							if PANDING == 0 then	
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then								
								PlayWavE(84)
								JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] + 1
								JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN	
								wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]		
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if QMQX5[tb] - JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] < 1 then
							JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] = QMQX5[tb]						
						end
					--ÄÚ¹¦
					--[[elseif pg == 6  then
						local PANDING = 0
						local XIAODIAN = NGQX4[tb]
						if wxds - XIAODIAN >= 0 and NGQX5[tb] - JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] > 0  then
							local n = 0
							for ii =0,CC.MyThingNum - 1 do
								local thid = JY.Base["ÎïÆ·" .. ii + 1]									
								if thid == 187 or thid == 188 or thid == 189 or thid == 190 or thid == 191 or thid == 193 then
									n = n + 1
								end				
							end		
							if tb == 1 and PersonKFJ(id,108)  then
								PANDING = 1										
							elseif tb == 2 and (PersonKFJ(id,160) or PersonKFJ(id,163)) and PersonKFJ(id,87) then
								PANDING = 1
								--JY.Person[pid]["×ÊÖÊ"]
							elseif tb == 3 and PersonKFJ(id,105) and PersonKFJ(id,88) and PersonKFJ(id,93) and PersonKFJ(id,97) then
								PANDING = 1
							elseif tb == 4 and (PersonKFJ(id,91) or PersonKFJ(id,92)) and JY.Person[id]["ÊµÕ½"] >= 100 then
								PANDING = 1
							elseif tb == 5 and PersonKFJ(id,106) then
								PANDING = 1
							elseif tb == 6 and PersonKFJ(id,96) and PersonKFJ(id,144) then
								PANDING = 1		
							elseif tb == 7 and PersonKFJ(id,100) and  (PersonKFJ(id,94) or PersonKFJ(id,203))   then --615ĞŞ¸Ä
								PANDING = 1
							elseif tb == 8 and JY.Person[id]["ÊµÕ½"] >= 50 and PersonKFJ(id,207) and (PersonKFJ(id,227) or PersonKFJ(id,183))  then
								PANDING = 1
							elseif tb == 9 and PersonKFJ(id,107) then
								PANDING = 1			
							elseif tb == 10 and JY.Person[id]["ÊµÕ½"] >= 50 and PersonKFJ(id,317)  then
								PANDING = 1	
							elseif tb == 11 and PersonKFJ(id,103) and PersonKFJ(id,196) and rwnlxz(id,1) then
								PANDING = 1	
								JY.Person[id]["ÉúÃüÔö³¤"] = JY.Person[id]["ÉúÃüÔö³¤"] + 1
							elseif tb == 12 and p["·ÀÓùÁ¦"] >= 200 and (PersonKFJ(id,215) or PersonKFJ(id,204)) then
								PANDING = 1	
							elseif tb == 13 and PersonKFJ(id,102) then
								PANDING = 1	
							elseif tb == 14 and ((p["Óù½£ÄÜÁ¦"]+(WuyueJFSL(id)*20)) >= 200 or p["È­ÕÆ¹¦·ò"] >= 200 or p["Ö¸·¨¼¼ÇÉ"] >= 200 or p["Ë£µ¶¼¼ÇÉ"] >= 200 or p["ÌØÊâ±øÆ÷"] >= 200) and (PersonKFJ(id,95) or PersonKFJ(id,180)) and PersonKFJ(id,90) then
								PANDING = 1	
							elseif tb == 15 and PersonKFJ(id,85) and PersonKFJ(id,98) and PersonKFJ(id,101) and PersonKFJ(id,190)  then
								PANDING = 1	
							elseif tb == 16 and PersonKF(id,233) and ((p["Óù½£ÄÜÁ¦"]+(WuyueJFSL(id)*20)) >= 300 or p["È­ÕÆ¹¦·ò"] >= 300 or p["Ö¸·¨¼¼ÇÉ"] >= 300 or p["Ë£µ¶¼¼ÇÉ"] >= 300 or p["ÌØÊâ±øÆ÷"] >= 300) then
								PANDING = 1	
							elseif tb == 17  and (PersonKFJ(id,216) or PersonKFJ(id,213)) and rwnlxz(id,0) then
								PANDING = 1	
							elseif tb == 18  and PersonKFJ(id,199) and p["ÎäÑ§³£Ê¶"] >= 100 then
								PANDING = 1
							elseif tb == 19  and ((p["Óù½£ÄÜÁ¦"]+(WuyueJFSL(id)*20)) >= 100 or p["È­ÕÆ¹¦·ò"] >= 100 or p["Ö¸·¨¼¼ÇÉ"] >= 100 or p["Ë£µ¶¼¼ÇÉ"] >= 100 or p["ÌØÊâ±øÆ÷"] >= 100) and PersonKFJ(id,154)  then
								PANDING = 1	
							elseif tb == 20  and PersonKFJ(id,171) and (PersonKFJ(id,356) or PersonKFJ(id,177)) and JY.Person[id]["Ìì¸³ÄÚ¹¦"]==171 then
								PANDING = 1																																																																																																																												
							else 
								PlayWavE(77)
								lb = 5
							end
							if PANDING ==  1 then				
								PlayWavE(84)
								JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] + 1
								JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN
								wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]			
							end	
						else
							PlayWavE(79)
							lb = 5
						end
						if NGQX5[tb] - JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] < 1 then
							JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] = NGQX5[tb]			
						end
						PlayWavE(79)	]]				
					end
				else
					PlayWavE(77)
					lb = 3	
				end
			elseif lb == 5 then
				lb = 3		
			end
		elseif X == VK_ESCAPE or ktype == 4 then
			PlayWavE(77)
			if SHUOMING == 1 then
				SHUOMING =  0
			elseif lb == 4 or lb == 5 then
				lb = 3
			elseif lb == 3 then
				lb = 2
			elseif lb == 2 then	
				--lb = 1
			--elseif lb == 1 then
				return false			
			end
		elseif X == VK_UP  then
			PlayWavE(77)
			if lb == 2 then
				pg = pg - 1
				if pg < 1 then
					pg = 5
				end	
			elseif lb == 3 then
				if pg == 1 then 					
					if tb > 6 and tb < 11  then
						tb = tb - 5					
					elseif tb == 15  then
						tb = 6
					elseif tb > 15  then
						tb = tb - 5	
					else
						tb = tb - 4	
					end														
					if tb < 1 then
						tb = #QZZB
					end
				--Ö¸·¨
				elseif pg == 2 then	
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #ZFZB
					end
					if tb < 1 then
						tb = #ZFZB
					end	
				elseif pg == 3 then
					
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #JFZB
					end
					if tb < 1 then
						tb = #JFZB
					end	
				elseif pg == 4 then	
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #SDZB
					end
					if tb < 1 then
						tb = #SDZB
					end
				elseif pg == 5 then
					if tb == 2 then
						tb = 13 
					elseif tb == 3  then
						tb = 18
					elseif tb == 4 then
						tb = 19
					elseif tb == 5 then
						tb = 15
					elseif tb == 6 then
						tb = 21 
					elseif tb == 18 then
						tb = 14
					elseif tb == 19 then
						tb = 9
					elseif tb > 19 then
						tb = tb - 4
					elseif tb > 6 and tb < 11 then
						tb = tb - 5
					elseif tb ==13 or tb == 14 then
						tb = tb - 6	
					elseif tb > 14 and tb < 18 then
						tb = tb - 5		
					elseif tb == 11 then
						tb = 20
					elseif tb == 12 then
						tb = 6
					elseif tb == 1 then
						tb = #QMZB
					end
					if tb < 1 then
						tb = #QMZB
					end
				--[[elseif pg == 6 then
					if tb < 5 then
						tb = tb - 4
					elseif tb < 9 and tb > 4 then
						tb = tb - 4
					elseif tb == 9 or tb == 10 then
						tb = tb - 6
					elseif tb == 11 or tb == 12 then
						tb = tb - 6
					elseif tb == 13 or tb == 14 or tb == 15 then
						tb = tb - 5
					elseif tb > 15 then
						tb = tb - 5
						if tb < 1 then
							tb = #NGZB
						end	
					end]]
				end		
			elseif lb == 4 then
				tb1 = tb1 - 1 						
				if tb1 < 1 then
					tb1 = #ZUOBIAO1
				end		
			end	
		elseif X == VK_DOWN then
			PlayWavE(77)
			if lb == 2 then
				pg = pg + 1
				if pg > 5  then
					pg = 1
				end
			elseif lb == 3  then
				if pg == 1 then
					if tb > 6 and tb < 11  then
						tb = tb + 4
					elseif tb == 1 then
						tb = 16
					elseif tb < 6 and tb > 1 then
						tb = tb + 5
					elseif tb == 6 then
						tb = 15	
					elseif tb > 15  then
						tb = tb + 7	
					else
						tb = tb + 5	
					end									
					if tb > #QZZB then
						tb = 1
					end	
				--Ö¸·¨
				elseif pg == 2 then
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end		
				elseif pg == 3 then
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end		
				elseif pg == 4 then
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end	
				elseif pg == 5 then	
					if tb == 6 then
						tb = 12
					elseif tb >1 and tb < 6 then
						tb = tb + 5	
					elseif tb >9 and tb < 13 then
						tb = tb + 5		
					elseif tb > 6 and tb < 9 then
						tb = tb + 6
					elseif tb == 9 then
						tb = 19
					elseif tb == 13 then
						tb = 2
					elseif tb == 14 then
						tb = 18
					elseif tb == 15 then
						tb = 5	
					elseif tb == 16 then
						tb = 20
					elseif tb == 17 then
						tb = 21
					elseif tb == 18 then
						tb = 3 	 
					elseif tb == 19 then
						tb = 4
					elseif tb == 20 then
						tb = 11 
					elseif tb == 21 then
						tb = 6 		 		 			
					end	
				--[[elseif pg == 6 then
					if tb < 4 then
						tb = tb + 4
						if tb < 1 then
							tb = 1
						end
					elseif tb == 7 then
						tb = 18
					elseif tb == 5 or tb == 6 then
						tb = tb + 6
					elseif tb == 8 or tb == 9 or tb == 10 then
						tb = tb + 5
					elseif tb == 11 or tb == 12 then
						tb = tb + 5
					elseif tb == 13 or tb == 14 then
						tb = tb + 6
					elseif tb == 15 then
						tb = 10
					end]]
				end
			end	
			if lb == 4 then
				tb1 = tb1 + 1
				if tb1 > #ZUOBIAO1 then
					tb1 = 1
				end	
			end
		elseif  X == VK_LEFT then
			PlayWavE(77)
			if lb == 1 then
			--	return Tianfujm(id)
			elseif lb == 2 then
				pg = pg - 1
				if pg < 1 then
					pg = 5
				end		
			elseif lb == 3  then
				tb = tb - 1
				if pg == 1 then
					if tb < 1 then
						tb = #QZZB
					end
				elseif pg == 2 then
					if tb < 1 then
						tb = #ZFZB
					end	
				elseif pg == 3 then
					if tb < 1 then
						tb = #JFZB
					end		
				elseif pg == 4 then
					if tb < 1 then
						tb = #SDZB
					end	
				elseif pg == 5 then
					if tb < 1 then
						tb = #QMZB
					end	
				--[[elseif pg == 6 then
					if tb < 1 then
						tb = #NGZB
					end	]]	
				end	
			elseif lb == 4 then
				tb2 = tb2 - 1
				if tb2 < 1 then
					tb2 = #ZUOBIAO1
				end	
			end
		elseif  X == VK_RIGHT then
			PlayWavE(77)
			if lb == 1 then
			--	return Shezhijm(id)
			elseif lb == 2 then	
				pg = pg + 1
				if pg > 5 then
					pg = 1
				end	
			elseif lb == 3 then
				tb = tb + 1
				if pg == 1 then
					if tb > #QZZB then 
						tb = 1
					end	
				elseif pg == 2 then
					if tb > #ZFZB then
						tb = 1
					end	
				elseif pg == 3 then
					if tb > #JFZB then
						tb = 1
					end		
				elseif pg == 4 then
					if tb > #SDZB then
						tb = 1
					end	
				elseif pg == 5 then
					if tb > #QMZB then
						tb = 1
					end	
				--[[elseif pg == 6 then
					if tb > #NGZB then
						tb = 1
					end	]]	
				end
			elseif lb == 4  then
				tb2 = tb2 + 1
				if tb2 > #ZUOBIAO1 then
					tb2 = 1
				end	
			end
		else
			-- local bx,by = CC.WX,CC.HY
			local bx = CC.ScreenW/1360
			local by = CC.ScreenH/768
			local mx0 = false
			local mx1 = false
			local tb0 = 1
			local tb1 = 1
			local mxxx = false
			local bugao = 34 + by*33
			local bukuan = 22+bx*212
			
			--local È­ÕÆ = 0		
			if lb < 3 then
				local zhuzb = {{147,614},{222,614},{307,614},{392,614},{476,614}}
				local zhuzbH = 43
				local zhuzbW = 84							
				for i = 1,#zhuzb do
					if mx >= bx*zhuzb[i][1] and mx <= bx*zhuzb[i][1]+zhuzbW and my >= by*zhuzb[i][2] and my <= by*zhuzb[i][2] +zhuzbH then
						tb0 = i
						mx1 = true
						break	
					end
				end	
				if mx1 == true and ktype == 3 then
					PlayWavE(77)
					if tb0 == 1 then
						return Mianban(id)
					elseif tb0 == 2 then
					--	return Wugongjm(id)
					elseif tb0 == 3 then
					--	return Tianfujm(id)
					elseif tb0 == 4 then
						return QUANZHANGQX(id)
					elseif tb0 == 5 then
					--	return Shezhijm(id)	
					end	
				elseif mx1 == false and ktype == 3 then
					lb = 2
				end	
				local zb = {{123,157},
							{202,157},
							{281,157},
							{359,157},
							{437,157},
							{515,157},
							
							}
				local kx = 78
				local ky = 37	
				for i = 1,#zb do
					if mx > bx*zb[i][1] and mx < bx*zb[i][1] + bx*kx and my > zb[i][2] and my < by*zb[i][2]+by*ky then
						tb1 = i 
						mx0 = true
						break
					end	
				end
				if mx0 == true and ktype == 3 then
					PlayWavE(77)
					if tb1 == 1 then
						pg = 1
					elseif tb1 == 2	then
						pg  = 2
					elseif tb1 == 3 then
						pg = 3
					elseif tb1 == 4 then
						pg = 4
					elseif tb1 == 5 then
						pg = 5
					--[[elseif tb1 == 6 then
						pg = 6]]
					end
				elseif 	mx0 == false and ktype == 3 then
					lb = 3
				end
			elseif (lb == 1 or lb == 2) and mx1 == false and mx0 == false and ktype == 3 then
				lb = 3				
			elseif lb == 3  then
				if pg == 1 then
					for i = 1,#QZZB do
						if mx > bx*QZZB[i][1] - bx*bukuan and mx < bx*QZZB[i][1] + bx*bukuan and my > by*QZZB[i][2] - by*bugao and my < by*QZZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end
				elseif pg == 2 then	
					for i = 1,#ZFZB do
						if mx > bx*ZFZB[i][1] - bx*bukuan and mx < bx*ZFZB[i][1] + bx*bukuan and my > by*ZFZB[i][2] - by*bugao and my < by*ZFZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				elseif pg == 3 then
					for i = 1,#JFZB do
						if mx > bx*JFZB[i][1] - bx*bukuan and mx < bx*JFZB[i][1] + bx*bukuan and my > by*JFZB[i][2] - by*bugao and my < by*JFZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				elseif pg == 4 then
					for i = 1,#SDZB do
						if mx > bx*SDZB[i][1] - bx*bukuan and mx < bx*SDZB[i][1] + bx*bukuan and my > by*SDZB[i][2] - by*bugao and my < by*SDZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				elseif pg == 5 then	
					for i = 1,#QMZB do
						if mx > bx*QMZB[i][1] - bx*bukuan and mx < bx*QMZB[i][1] + bx*bukuan and my > by*QMZB[i][2] - by*bugao and my < by*QMZB[i][2] + by*bugao  then
							tb = i				
							mxxx = true						
							break
						end 
					end	
				--[[elseif pg == 6 then
					for i = 1,#NGZB do
						if mx > bx*NGZB[i][1] - bx*bukuan and mx < bx*NGZB[i][1] + bx*bukuan and my > by*NGZB[i][2] - by*bugao and my < by*NGZB[i][2] + by*bugao  then
							tb = i					
							mxxx = true						
							break
						end 
					end	]]
				end		
				if mxxx == true and ktype == 3  then
					lb = 4
				end					
			elseif lb == 4  then
				if pg == 1 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = QZQX4[tb]
							if wxds - XIAODIAN >= 0 and QZQX5[tb] - JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] > 0 and JY.Person[id]["È­ÕÆ¹¦·ò"] - QZQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								elseif tb == 2 and 	JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1										
								elseif tb == 7 and 	JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								elseif tb == 11 and JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								elseif tb == 16 and JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								elseif tb == 5 and (JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶9"] >= 2  or JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶4"] >= 2) then
									PANDING = 1	
								end
								local m = {2,7,11,16,5}
								local pd = true 
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false 
									end
								end
								if  pd == true and JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..n] >= 2   then
									PANDING = 1	
								end							
								if PANDING ==  0 then
									PlayWavE(77)
									lb = 5
								end								
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] + 1
									JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN
									wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]				
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if QZQX5[tb] - JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] < 1 then
								JY.Person[id]["È­ÕÆÆæÑ¨µÈ¼¶"..tb] = QZQX5[tb]						
							end	
							PlayWavE(79)					
						else
							PlayWavE(77)
							lb = 3
						end	
					end
				elseif pg == 2 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = ZFQX4[tb]
							if wxds - XIAODIAN >= 0 and ZFQX5[tb] - JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] > 0 and JY.Person[id]["Ö¸·¨¼¼ÇÉ"] - ZFQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶10"] >= 2  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶13"] >= 2  then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶15"] >= 2  then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶19"] >= 2 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶15"] >= 2  then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] + 1
									JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN
									wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if ZFQX5[tb] - JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] < 1 then
								JY.Person[id]["Ö¸·¨ÆæÑ¨µÈ¼¶"..tb] = ZFQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				elseif pg == 3 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = JFQX4[tb]
							if wxds - XIAODIAN >= 0 and JFQX5[tb] - JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] > 0 and JY.Person[id]["Óù½£ÄÜÁ¦"]+(WuyueJFSL(id)*20) - JFQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end	
								if tb == 11 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶10"] >= 1  then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶10"] >= 1  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶13"] >= 2 then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶15"] >= 2 then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶19"] >= 5 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶15"] >= 2 then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] + 1
									JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN
									wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if JFQX5[tb] - JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] < 1 then
								JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] = JFQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				elseif pg == 4 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = SDQX4[tb]
							if wxds - XIAODIAN >= 0 and SDQX5[tb] - JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] > 0 and JY.Person[id]["Ë£µ¶¼¼ÇÉ"] - SDQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶10"] >= 2  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶13"] >= 2  then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶15"] >= 2  then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶19"] >= 2 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶15"] >= 2  then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["Ë£µ¶ÆæÑ¨µÈ¼¶"..tb] + 1
									JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN	
									wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if SDQX5[tb] - JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] < 1 then
								JY.Person[id]["Óù½£ÆæÑ¨µÈ¼¶"..tb] = SDQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				elseif pg == 5 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then						
							local PANDING = 0
							local XIAODIAN = QMQX4[tb]
							if wxds - XIAODIAN >= 0 and QMQX5[tb] - JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] > 0 and JY.Person[id]["ÌØÊâ±øÆ÷"] - QMQX6[tb] >= 0 then
								local n = tb - 1
								if n < 1 then
									n = 1
								end											
								if tb == 1 then
									PANDING = 1	
								end	
								if tb == 2 and 	JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end									
								if tb == 7 and 	JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 3 then
									PANDING = 1
								end	
								if tb == 12 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶10"] >= 2  then
									PANDING = 1
								end										
								if tb == 13 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶1"] >= 3  then
									PANDING = 1
								end	
								if tb == 14 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶13"] >= 2  then
									PANDING = 1	
								end								
								if tb == 19 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶15"] >= 2  then
									PANDING = 1	
								end	
								if tb == 18 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶19"] >= 2 then
									PANDING = 1	
								end	
								if tb == 20 and JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶15"] >= 2  then
									PANDING = 1	
								end
								local m = {2,7,12,13,14,18,19,20}
								local pd = true
								for ti = 1,#m do
									if tb == m[ti] then
										pd = false
									end
								end
								if pd == true and  JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..n] >= 2 then
									PANDING = 1	
								end											
								if PANDING == 0 then	
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] + 1
									JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN
									wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]			
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if QMQX5[tb] - JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] < 1 then
								JY.Person[id]["ÆæÃÅÆæÑ¨µÈ¼¶"..tb] = QMQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end
				--[[elseif pg == 6 then
					for i = 1,#WZ1 do
						if mx > bx*ZUOBIAO1[i][1]-bx*tb1x and mx < bx*ZUOBIAO1[i][1]+bx*tb1x and my > by*ZUOBIAO1[i][2]-by*tb1y and my < by*ZUOBIAO1[i][2] + by*tb1y then
							tb2 = i 
							mxxx = true
							break
						end
					end
					if mxxx == true and ktype == 3  then		
						if tb2 == 1 and inteam(id) and JY.Status ~= GAME_WMAP then
						local PANDING = 0
						local XIAODIAN = NGQX4[tb]
						if wxds - XIAODIAN >= 0 and NGQX5[tb] - JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] > 0  then
							local n = 0
							for ii =0,CC.MyThingNum - 1 do
								local thid = JY.Base["ÎïÆ·" .. ii + 1]									
								if thid == 187 or thid == 188 or thid == 189 or thid == 190 or thid == 191 or thid == 193 then
									n = n + 1
								end				
							end								
							if tb == 1 and PersonKFJ(id,108)   then
								PANDING = 1										
							elseif tb == 2 and PersonKFJ(id,160) and PersonKFJ(id,87) then
								PANDING = 1
							elseif tb == 3 and PersonKFJ(id,105) and PersonKFJ(id,88) and PersonKFJ(id,93) and PersonKFJ(id,97) then
								PANDING = 1
							elseif tb == 4 and (PersonKFJ(id,91) or PersonKFJ(id,92)) and JY.Person[id]["ÊµÕ½"] >= 100 then
								PANDING = 1
							elseif tb == 5 and PersonKFJ(id,106)  then
								PANDING = 1
							elseif tb == 6 and PersonKFJ(id,96) and PersonKFJ(id,144) then
								PANDING = 1		
							elseif tb == 7 and PersonKFJ(id,100) and  (PersonKFJ(id,94) or PersonKFJ(id,203))   then	--615ĞŞ¸Ä
								PANDING = 1
							elseif tb == 8 and JY.Person[id]["ÊµÕ½"] >= 50 and (PersonKFJ(id,227) or PersonKFJ(id,183)) then
								PANDING = 1
							elseif tb == 9 and PersonKFJ(id,107)  then
								PANDING = 1			
							elseif tb == 10 and JY.Person[id]["ÊµÕ½"] >= 50 and PersonKFJ(id,317)  then
								PANDING = 1	
							elseif tb == 11 and PersonKFJ(id,103) and PersonKFJ(id,91) and PersonKFJ(id,196) and rwnlxz(id,1) then
								PANDING = 1	
								JY.Person[id]["ÉúÃüÔö³¤"] = JY.Person[id]["ÉúÃüÔö³¤"] + 1
							elseif tb == 12 and p["·ÀÓùÁ¦"] >= 200 and (PersonKFJ(id,215) or PersonKFJ(id,204)) then
								PANDING = 1	
							elseif tb == 13 and PersonKFJ(id,102)  then
								PANDING = 1	
							elseif tb == 14 and ((p["Óù½£ÄÜÁ¦"]+(WuyueJFSL(id)*20)) >= 200 or p["È­ÕÆ¹¦·ò"] >= 200 or p["Ö¸·¨¼¼ÇÉ"] >= 200 or p["Ë£µ¶¼¼ÇÉ"] >= 200 or p["ÌØÊâ±øÆ÷"] >= 200) and (PersonKFJ(id,95) or PersonKFJ(id,180)) and PersonKFJ(id,90) then
								PANDING = 1	
							elseif tb == 15 and PersonKFJ(id,85) and PersonKFJ(id,98) and PersonKFJ(id,101) and PersonKFJ(id,190)  then
								PANDING = 1	
							elseif tb == 16 and PersonKF(id,233) and ((p["Óù½£ÄÜÁ¦"]+(WuyueJFSL(id)*20)) >= 300 or p["È­ÕÆ¹¦·ò"] >= 300 or p["Ö¸·¨¼¼ÇÉ"] >= 300 or p["Ë£µ¶¼¼ÇÉ"] >= 300 or p["ÌØÊâ±øÆ÷"] >= 300) then
								PANDING = 1	
							elseif tb == 17  and (PersonKFJ(id,216) or PersonKFJ(id,213)) and rwnlxz(id,0) then
								PANDING = 1	
							elseif tb == 18  and PersonKFJ(id,199) and p["ÎäÑ§³£Ê¶"] >= 100 then
								PANDING = 1
							elseif tb == 19  and ((p["Óù½£ÄÜÁ¦"]+(WuyueJFSL(id)*20)) >= 100 or p["È­ÕÆ¹¦·ò"] >= 100 or p["Ö¸·¨¼¼ÇÉ"] >= 100 or p["Ë£µ¶¼¼ÇÉ"] >= 100 or p["ÌØÊâ±øÆ÷"] >= 100) and (PersonKFJ(id,154) or PersonKFJ(id,211))  then
								PANDING = 1	
							elseif tb == 20  and PersonKFJ(id,171) and (PersonKFJ(id,356) or PersonKFJ(id,177)) and JY.Person[id]["Ìì¸³ÄÚ¹¦"]==171 then
								PANDING = 1																																																																																																																		
								else 
									PlayWavE(77)
									lb = 5
								end
								if PANDING ==  1 then								
									PlayWavE(84)
									JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] = JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] + 1
									JY.Person[id]["ÎäÑ§µãÊı"] = JY.Person[id]["ÎäÑ§µãÊı"] + XIAODIAN
									wxds=JY.Person[523]["ÉùÍû"]+JY.Person[524]["ÉùÍû"]+JY.Person[525]["ÉùÍû"]-JY.Person[id]["ÎäÑ§µãÊı"]		
								end	
							else
								PlayWavE(79)
								lb = 5
							end
							if NGQX5[tb] - JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] < 1 then
								JY.Person[id]["ÄÚ¹¦ÆæÑ¨µÈ¼¶"..tb] = NGQX5[tb]						
							end					
						else
							PlayWavE(77)
							lb = 3
						end
					end	]]	
				end		
			elseif lb == 5 and ktype == 3 then
				lb = 3
			end
			local mxx3 = false
			if mx >= bx*829 and mx <=bx*849 and my >= by*76 and my <= by*102 then
				mxx3 = true
			end
			if mxx3 == true and ktype == 3 then
				SHUOMING = 1
			end				
		end	
	end	
end



function NGnum(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 6 then
			num = num + 1
		end
	end
	return num
end
function JFnum(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 3 then
			num = num + 1
		end
	end
	return num
end
function DFnum(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 4 then
			num = num + 1
		end
	end
	return num
end
function QZnum(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 1 then
			num = num + 1
		end
	end
	return num
end
function ZFnum(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 2 then
			num = num + 1
		end
	end
	return num
end
function QMnum(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 5 then
			num = num + 1
		end
	end
	return num
end
function QGnum(id)
	local num = 0
	for i = 1, JY.Base["Îä¹¦ÊıÁ¿"] do
		local kfid = JY.Person[id]["Îä¹¦"..i]
		if JY.Wugong[kfid]["Îä¹¦ÀàĞÍ"] == 7 then
			num = num + 1
		end
	end
	return num
end
function QUANQX(id,str)
	local a = -1
	for i = 1, #CC.QUAHZQX do
		if str == CC.QUAHZQX[i][1] then
			a = JY.Person[id]['È­ÕÆÆæÑ¨µÈ¼¶'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function ZHIQX(id,str)
	local a = -1
	for i = 1, #CC.ZHIFQX do
		if str == CC.ZHIFQX[i][1] then
			a = JY.Person[id]['Ö¸·¨ÆæÑ¨µÈ¼¶'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function JIANQX(id,str)
	local a = -1
	for i = 1, #CC.JIANFQX do
		if str == CC.JIANFQX[i][1] then
			a = JY.Person[id]['Óù½£ÆæÑ¨µÈ¼¶'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end	
	return a
end
function DAOQX(id,str)
	local a = -1
	for i = 1, #CC.SHUADQX do
		if str == CC.SHUADQX[i][1] then
			a = JY.Person[id]['Ë£µ¶ÆæÑ¨µÈ¼¶'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function QIQX(id,str)
	local a = -1
	for i = 1, #CC.QIMQX do
		if str == CC.QIMQX[i][1] then
			a = JY.Person[id]['ÆæÃÅÆæÑ¨µÈ¼¶'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end
function NEIQX(id,str)
	local a = -1
	for i = 1, #CC.NEIGQX do
		if str == CC.NEIGQX[i][1] then
			a = JY.Person[id]['ÄÚ¹¦ÆæÑ¨µÈ¼¶'..i]
			break
		end
	end	
	if a == nil or a < 0 then
		a = 0
	end
	return a
end

--ÌùÍ¼ÏÔÊ¾
function zssdz(pid) ----
    local a = JY.Person[pid]["Í·Ïñ´úºÅ"] * 2
    local dx = 0
    local dr = 0
    if pid == 65 then
        dx = 200
	    dr = 150
    end
    if  pid == 0 and JY.Base["±ê×¼"] > 0 then

    end
   
    for i = 1,121,60 do 
        lib.LoadPNG(90, a, CC.ScreenW/2+dx, CC.ScreenH/2+dr)
   	    ShowScreen()
    end
	ShowScreen()
	lib.Delay(100)
end

function zssdz2(pid)
    local dx = 0
    local dr = 200
    if pid == 65 then
        dx = 200
	    dr = 150
    end
    for i = 1,121,60 do 
        lib.LoadPNG(90, pid*2, CC.ScreenW/2+dx, CC.ScreenH/2+dr)
	    ShowScreen()
	    --lib.Delay(200)
    end
	ShowScreen()
	lib.Delay(100)
end

--ÖñÇåÏÒ¡¢ÉÌÓùÒş·ÀÃëÉ±
function FZMS(pid)
    if match_ID(pid,520) then
		return true
	elseif match_ID(pid,517) then
	    return true
	end
	return false
end

Ct['ÈÚºÏÇá¹¦'] = function (id)
	local k = JY.Person[id]
	--local menuwai = {}
	local menu  = {}
	local ng = 0
	for i = 1, JY.Base['Îä¹¦ÊıÁ¿'] do
		if JY.Person[id]["Îä¹¦"..i] > 0 then
			local kfname = JY.Wugong[k['Îä¹¦'..i]]["Ãû³Æ"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["Îä¹¦"..i] > 0 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['Îä¹¦'..i]]["Îä¹¦ÀàĞÍ"] == 7 then
					ng =ng + 1
					menu[i][3] = 1
				end
			end	
		end	
	end
	if ng < 2 then
		QZXS('Ëù»áÇá¹¦ÊıÁ¿²»×ã¶ş¸ö')
		do return end
	end	
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng1 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"Ñ¡ÔñµÚÒ»ÄÚ¹¦")
    if ng1 == 0 then
		return
	end
	menu  = {}
	for i = 1, JY.Base['Îä¹¦ÊıÁ¿'] do
		if JY.Person[id]["Îä¹¦"..i] > 0 then
			local kfname = JY.Wugong[k['Îä¹¦'..i]]["Ãû³Æ"]
			if string.len(kfname) == 8 then
				kfname = kfname.."  "
			elseif string.len(kfname) == 6 then
				kfname = kfname.."    "
			elseif string.len(kfname) == 4 then
				kfname = kfname.."      "
			end
			if JY.Person[id]["Îä¹¦"..i] > 0 and i ~= ng1 then
				menu[i] = {kfname,nil,2}
				if JY.Wugong[k['Îä¹¦'..i]]["Îä¹¦ÀàĞÍ"] == 7  then
					menu[i][3] = 1
				end
			end	
		end	
	end
	local nexty = CC.ScreenH/2-CC.DefaultFont*4 + CC.SingleLineHeight
    local ng2 = ShowMenu2(menu, #menu, 4, 5, CC.ScreenW/2-CC.DefaultFont*10-20, nexty, 0, 0, 1, 0, CC.DefaultFont, C_ORANGE, C_WHITE,"Ñ¡ÔñµÚ¶şÄÚ¹¦")
    if ng2 == 0 then
		return
	end
	if ng1 > 0 and ng2 > 0 then
		JY.Wugong[380]['Ãû³Æ'] = CONFIG.WoQGName
		JY.Wugong[380]['±ù·âÏµÊı'] = JY.Person[id]['Îä¹¦'..ng1]
		JY.Wugong[380]['×ÆÉÕÏµÊı'] = JY.Person[id]['Îä¹¦'..ng2]
		JY.Person[id]["Îä¹¦"..ng1] = 380
		JY.Person[id]["Îä¹¦µÈ¼¶"..ng1] = 999
		JY.Person[id]['Ö÷ÔËİp¹¦'] = 380
		for i = ng2, JY.Base['Îä¹¦ÊıÁ¿'] - 1 do
			if JY.Person[id]["Îä¹¦"..i] > 0  then
				JY.Person[id]["Îä¹¦"..i] = JY.Person[id]["Îä¹¦"..i+1]
				JY.Person[id]["Îä¹¦µÈ¼¶"..i] = JY.Person[id]["Îä¹¦µÈ¼¶"..i+1]
			end	
		end
		--JY.Person[0]["Îä¹¦" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
		--JY.Person[0]["Îä¹¦µÈ¼¶" .. JY.Base["Îä¹¦ÊıÁ¿"]] = 0
	end
end